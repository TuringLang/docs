<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Implementing samplers – Turing.jl</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../tutorials/docs-07-for-developers-variational-inference/index.html" rel="prev">
<link href="../../assets/favicon.ico" rel="icon">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<style>
  a {
    text-decoration: none;
  }
  a:hover {
    text-decoration: underline;
  }
</style>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../theming/styles.css">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="https://turinglang.org/" class="navbar-brand navbar-brand-logo">
    <img src="../../assets/images/turing-logo.svg" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="https://turinglang.org/">
    <span class="navbar-title">Turing.jl</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../tutorials/docs-00-getting-started/"> 
<span class="menu-text">Get Started</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../tutorials/00-introduction/"> 
<span class="menu-text">Tutorials</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/library/"> 
<span class="menu-text">Libraries</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/news/"> 
<span class="menu-text">News</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/team/"> 
<span class="menu-text">Team</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-v0.34" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">v0.34</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-v0.34">    
        <li>
    <a class="dropdown-item" href="https://turinglang.org/docs/changelog.html">
 <span class="dropdown-text">Changelog</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://turinglang.org/docs/versions.html">
 <span class="dropdown-text">All Versions</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
    <a href="https://x.com/TuringLang" title="Turing Twitter" class="quarto-navigation-tool px-1" aria-label="Turing Twitter"><i class="bi bi-twitter"></i></a>
    <a href="https://github.com/TuringLang/Turing.jl" title="Turing GitHub" class="quarto-navigation-tool px-1" aria-label="Turing GitHub"><i class="bi bi-github"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">For Developers</li><li class="breadcrumb-item"><a href="../../tutorials/docs-04-for-developers-abstractmcmc-turing/index.html">Developers: Inference</a></li><li class="breadcrumb-item"><a href="../../tutorials/docs-17-implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false">
 <span class="menu-text">For Users</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false">
 <span class="menu-text">Using the Turing library</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-00-getting-started/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Getting Started</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/00-introduction/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction to Turing</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-12-using-turing-guide/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Turing’s Core Functionality</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-17-mode-estimation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Mode Estimation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-09-using-turing-advanced/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Advanced Usage</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-10-using-turing-autodiff/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Automatic Differentiation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-13-using-turing-performance-tips/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Performance Tips</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-11-using-turing-dynamichmc/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using DynamicHMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-15-using-turing-sampler-viz/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Sampler Visualization</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-16-using-turing-external-samplers/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">External Samplers</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false">
 <span class="menu-text">Examples of Turing Models</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/01-gaussian-mixture-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Mixture Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/02-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/03-bayesian-neural-network/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Neural Networks</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/04-hidden-markov-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Hidden Markov Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/05-linear-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Linear Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/06-infinite-mixture-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Infinite Mixture Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/07-poisson-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Poisson Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/08-multinomial-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Multinomial Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/09-variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/10-bayesian-differential-equations/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Differential Equations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/11-probabilistic-pca/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Probabilistic PCA</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/13-seasonal-time-series/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Time Series Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/15-gaussian-processes/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction to Gaussian Processes</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/12-gplvm/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Process Latent Variable Models</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">For Developers</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false">
 <span class="menu-text">Contributing</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-01-contributing-guide/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">How to Contribute</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="false">
 <span class="menu-text">How Turing Works</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-05-for-developers-compiler/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Turing Compiler Design</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/14-minituring/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation I: Compiler</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/16-contexts/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation II: Contexts</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-06-for-developers-interface/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Interface Guide</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true">
 <span class="menu-text">Developers: Inference</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-04-for-developers-abstractmcmc-turing/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">How Turing implements AbstractMCMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-07-for-developers-variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-17-implementing-samplers/index.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Implementing Samplers</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of Contents</h2>
   
  <ul>
  <li><a href="#quick-overview-of-mala" id="toc-quick-overview-of-mala" class="nav-link active" data-scroll-target="#quick-overview-of-mala">Quick overview of MALA</a></li>
  <li><a href="#what-we-need-from-a-model-logdensityproblems.jl" id="toc-what-we-need-from-a-model-logdensityproblems.jl" class="nav-link" data-scroll-target="#what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: LogDensityProblems.jl</a></li>
  <li><a href="#implementing-mala-in-abstractmcmc.jl" id="toc-implementing-mala-in-abstractmcmc.jl" class="nav-link" data-scroll-target="#implementing-mala-in-abstractmcmc.jl">Implementing MALA in AbstractMCMC.jl</a></li>
  <li><a href="#using-our-sampler-with-turing.jl" id="toc-using-our-sampler-with-turing.jl" class="nav-link" data-scroll-target="#using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</a>
  <ul class="collapse">
  <li><a href="#models-with-constrained-parameters" id="toc-models-with-constrained-parameters" class="nav-link" data-scroll-target="#models-with-constrained-parameters">Models with constrained parameters</a></li>
  </ul></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/TuringLang/docs/edit/master/tutorials/docs-17-implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/docs/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">For Developers</li><li class="breadcrumb-item"><a href="../../tutorials/docs-04-for-developers-abstractmcmc-turing/index.html">Developers: Inference</a></li><li class="breadcrumb-item"><a href="../../tutorials/docs-17-implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Implementing samplers</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>In this tutorial, we’ll go through step-by-step how to implement a “simple” sampler in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> in such a way that it can be easily applied to Turing.jl models.</p>
<p>In particular, we’re going to implement a version of <strong>Metropolis-adjusted Langevin (MALA)</strong>.</p>
<p>Note that we will implement this sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> framework, completely “ignoring” Turing.jl until the very end of the tutorial, at which point we’ll use a single line of code to make the resulting sampler available to Turing.jl. This is to really drive home the point that one can implement samplers in a way that is accessible to all of Turing.jl’s users without having to use Turing.jl yourself.</p>
<section id="quick-overview-of-mala" class="level2">
<h2 class="anchored" data-anchor-id="quick-overview-of-mala">Quick overview of MALA</h2>
<p>We can view MALA as a single step of the leapfrog intergrator with resampling of momentum <span class="math inline">\(p\)</span> at every step.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> To make that statement a bit more concrete, we first define the <em>extended</em> target <span class="math inline">\(\bar{\gamma}(x, p)\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\log \bar{\gamma}(x, p) \propto \log \gamma(x) + \log \gamma_{\mathcal{N}(0, M)}(p)
\end{equation*}\]</span></p>
<p>where <span class="math inline">\(\gamma_{\mathcal{N}(0, M)}\)</span> denotes the density for a zero-centered Gaussian with covariance matrix <span class="math inline">\(M\)</span>. We then consider targeting this joint distribution over both <span class="math inline">\(x\)</span> and <span class="math inline">\(p\)</span> as follows. First we define the map</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  L_{\epsilon}: \quad &amp; \mathbb{R}^d \times \mathbb{R}^d \to \mathbb{R}^d \times \mathbb{R}^d \\
  &amp; (x, p) \mapsto (\tilde{x}, \tilde{p}) := L_{\epsilon}(x, p)
\end{split}
\end{equation*}\]</span></p>
<p>as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p_{1 / 2} &amp;:= p + \frac{\epsilon}{2} \nabla \log \gamma(x) \\
  \tilde{x} &amp;:= x + \epsilon M^{-1} p_{1 /2 } \\
  p_1 &amp;:= p_{1 / 2} + \frac{\epsilon}{2} \nabla \log \gamma(\tilde{x}) \\
  \tilde{p} &amp;:= - p_1
\end{split}
\end{equation*}\]</span></p>
<p>This might be familiar for some readers as a single step of the Leapfrog integrator. We then define the MALA kernel as follows: given the current iterate <span class="math inline">\(x_i\)</span>, we sample the next iterate <span class="math inline">\(x_{i + 1}\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p &amp;\sim \mathcal{N}(0, M) \\
  (\tilde{x}, \tilde{p}) &amp;:= L_{\epsilon}(x_i, p) \\
  \alpha &amp;:= \min \left\{ 1, \frac{\bar{\gamma}(\tilde{x}, \tilde{p})}{\bar{\gamma}(x_i, p)} \right\} \\
  x_{i + 1} &amp;:=
  \begin{cases}
    \tilde{x} \quad &amp; \text{ with prob. } \alpha \\
    x_i       \quad &amp; \text{ with prob. } 1 - \alpha
  \end{cases}
\end{split}
\end{equation*}\]</span></p>
<p>i.e.&nbsp;we accept the proposal <span class="math inline">\(\tilde{x}\)</span> with probability <span class="math inline">\(\alpha\)</span> and reject it, thus sticking with our current iterate, with probability <span class="math inline">\(1 - \alpha\)</span>.</p>
</section>
<section id="what-we-need-from-a-model-logdensityproblems.jl" class="level2">
<h2 class="anchored" data-anchor-id="what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a></h2>
<p>There are a few things we need from the “target” / “model” / density that we want to sample from:</p>
<ol type="1">
<li>We need access to log-density <em>evaluations</em> <span class="math inline">\(\log \gamma(x)\)</span> so we can compute the acceptance ratio involving <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>We need access to log-density <em>gradients</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span> so we can compute the Leapfrog steps <span class="math inline">\(L_{\epsilon}(x, p)\)</span>.</li>
<li>We also need access to the “size” of the model so we can determine the size of <span class="math inline">\(M\)</span>.</li>
</ol>
<p>Luckily for us, there is a package called <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> which provides an interface for <em>exactly</em> this!</p>
<p>To demonstrate how one can implement the “<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface”<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> we will use a simple Gaussian model as an example:</p>
<div id="4" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblems</span>: LogDensityProblems;</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's define some type that represents the model.</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> IsotropicNormalModel{M<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"mean of the isotropic Gaussian"</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    mean<span class="op">::</span><span class="dt">M</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Specifies what input length the model expects.</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">dimension</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> <span class="fu">length</span>(model.mean)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Implementation of the log-density evaluation of the model.</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x<span class="op">::</span><span class="dt">AbstractVector{&lt;:Real}</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">-</span> <span class="fu">sum</span>(abs2, x <span class="op">.-</span> model.mean) <span class="op">/</span> <span class="fl">2</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This gives us all of the properties we want for our MALA sampler with the exception of the computation of the <em>gradient</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span>. There is the method <code>LogDensityProblems.logdensity_and_gradient</code> which should return a 2-tuple where the first entry is the evaluation of the logdensity <span class="math inline">\(\log \gamma(x)\)</span> and the second entry is the gradient <span class="math inline">\(\nabla \log \gamma(x)\)</span>.</p>
<p>There are two ways to “implement” this method: 1) we implement it by hand, which is feasible in the case of our <code>IsotropicNormalModel</code>, or b) we defer the implementation of this to a automatic differentiation backend.</p>
<p>To implement it by hand we can simply do</p>
<div id="6" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl that first-order, i.e. gradient information, is available.</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{1}</span>()</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Implement `logdensity_and_gradient`.</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    logγ_x <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="op">-</span>x <span class="op">.*</span> (x <span class="op">-</span> model.mean)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> logγ_x, ∇logγ_x</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s just try it out:</p>
<div id="8" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate the problem.</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> <span class="fu">IsotropicNormalModel</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.])</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create some example input that we can test on.</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>x_example <span class="op">=</span> <span class="fu">randn</span>(LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate!</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-27.671246838313046</code></pre>
</div>
</div>
<p>To defer it to an automatic differentiation backend, we can do</p>
<div id="10" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl we only have access to 0-th order information.</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{0}</span>()</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Use `LogDensityProblemsAD`'s `ADgradient` in combination with some AD backend to implement `logdensity_and_gradient`.</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblemsAD</span>, <span class="bu">ADTypes</span>, <span class="bu">ForwardDiff</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>model_with_grad <span class="op">=</span> <span class="fu">ADgradient</span>(<span class="fu">AutoForwardDiff</span>(), model)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model_with_grad, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-27.671246838313046</code></pre>
</div>
</div>
<p>We’ll continue with the second approach in this tutorial since this is typically what one does in practice, because there are better hobbies to spend time on than deriving gradients by hand.</p>
<p>At this point, one might wonder how we’re going to tie this back to Turing.jl in the end. Effectively, when working with inference methods that only require log-density evaluations and / or higher-order information of the log-density, Turing.jl actually converts the user-provided <code>Model</code> into an object implementing the above methods for <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>. As a result, most samplers provided by Turing.jl are actually implemented to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, enabling their use both <em>within</em> Turing.jl and <em>outside</em> of Turing.jl! Morever, there exists similar conversions for Stan through BridgeStan and Stan<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, which means that a sampler supporting the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface can easily be used on both Turing.jl <em>and</em> Stan models (in addition to user-provided models, as our <code>IsotropicNormalModel</code> above)!</p>
<p>Anyways, let’s move on to actually implementing the sampler.</p>
</section>
<section id="implementing-mala-in-abstractmcmc.jl" class="level2">
<h2 class="anchored" data-anchor-id="implementing-mala-in-abstractmcmc.jl">Implementing MALA in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a></h2>
<p>Now that we’ve established that a model implementing the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface provides us with all the information we need from <span class="math inline">\(\log \gamma(x)\)</span>, we can address the question: given an object that implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, how can we define a sampler for it?</p>
<p>We’re going to do this by making our sampler a sub-type of <code>AbstractMCMC.AbstractSampler</code> in addition to implementing a few methods from <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>. Why? Because it gets us <em>a lot</em> of functionality for free, as we will see later.</p>
<p>Moreover, <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> provides a very natural interface for MCMC algorithms.</p>
<p>First, we’ll define our <code>MALA</code> type</p>
<div id="12" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">AbstractMCMC</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALA{T,A} <span class="op">&lt;:</span><span class="dt"> AbstractMCMC.AbstractSampler</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"stepsize used in the leapfrog step"</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    ϵ_init<span class="op">::</span><span class="dt">T</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"covariance matrix used for the momentum"</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    M_init<span class="op">::</span><span class="dt">A</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notice how we’ve added the suffix <code>_init</code> to both the stepsize and the covariance matrix. We’ve done this because a <code>AbstractMCMC.AbstractSampler</code> should be <em>immutable</em>. Of course there might be many scenarios where we want to allow something like the stepsize and / or the covariance matrix to vary between iterations, e.g.&nbsp;during the burn-in / adaptation phase of the sampling process we might want to adjust the parameters using statistics computed from these initial iterations. But information which can change between iterations <em>should not go in the sampler itself</em>! Instead, this information should go in the sampler <em>state</em>.</p>
<p>The sampler state should at the very least contain all the necessary information to perform the next MCMC iteration, but usually contains further information, e.g.&nbsp;quantities and statistics useful for evaluating whether the sampler has converged.</p>
<p>We will use the following sampler state for our <code>MALA</code> sampler:</p>
<div id="14" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALAState{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This might seem overly redundant: we’re defining a type <code>MALAState</code> and it only contains a simple vector of reals. In this particular case we indeed could have dropped this and simply used a <code>AbstractVector{&lt;:Real}</code> as our sampler state, but typically, as we will see later, one wants to include other quantities in the sampler state. For example, if we also wanted to adapt the parameters of our <code>MALA</code>, e.g.&nbsp;alter the stepsize depending on acceptance rates, in which case we should also put <code>ϵ</code> in the state, but for now we’ll keep things simple.</p>
<p>Moreover, we also want a <em>sample</em> type, which is a type meant for “public consumption”, i.e.&nbsp;the end-user. This is generally going to contain a subset of the information present in the state. But in such a simple scenario as this, we similarly only have a <code>AbstractVector{&lt;:Real}</code>:</p>
<div id="16" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALASample{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We currently have three things:</p>
<ol type="1">
<li>A <code>AbstractMCMC.AbstractSampler</code> implementation called <code>MALA</code>.</li>
<li>A state <code>MALAState</code> for our sampler <code>MALA</code>.</li>
<li>A sample <code>MALASample</code> for our sampler <code>MALA</code>.</li>
</ol>
<p>That means that we’re ready to implement the only thing that really matters: <code>AbstractMCMC.step</code>.</p>
<p><code>AbstractMCMC.step</code> defines the MCMC iteration of our <code>MALA</code> given the current <code>MALAState</code>. Specifically, the signature of the function is as follows:</p>
<div id="18" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The RNG to ensure reproducibility.</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The model that defines our target.</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.AbstractModel</span>,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The sampler for which we're taking a `step`.</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">AbstractMCMC.AbstractSampler</span>,</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The current sampler `state`.</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    state;</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Additional keyword arguments that we may or may not need.</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Moreover, there is a specific <code>AbstractMCMC.AbstractModel</code> which is used to indicate that the model that is provided implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface: <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Since, as we discussed earlier, in our case we’re indeed going to work with types that support the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, we’ll define <code>AbstractMCMC.step</code> for such a <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Note that <code>AbstractMCMC.LogDensityModel</code> has no other purpose; it has a single field called <code>logdensity</code>, and it does nothing else. But by wrapping the model in <code>AbstractMCMC.LogDensityModel</code>, it allows samplers that want to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> to define their <code>AbstractMCMC.step</code> on this type without running into method ambiguities.</p>
<p>All in all, that means that the signature for our <code>AbstractMCMC.step</code> is going to be the following:</p>
<div id="20" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># `LogDensityModel` so we know we're working with LogDensityProblems.jl model.</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler.</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler state.</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Great! Now let’s actually implement the full <code>AbstractMCMC.step</code> for our <code>MALA</code>.</p>
<p>Let’s remind ourselves what we’re going to do:</p>
<ol type="1">
<li>Sample a new momentum <span class="math inline">\(p\)</span>.</li>
<li>Compute the log-density of the extended target <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>Take a single leapfrog step <span class="math inline">\((\tilde{x}, \tilde{p}) = L_{\epsilon}(x, p)\)</span>.</li>
<li>Accept or reject the proposed <span class="math inline">\((\tilde{x}, \tilde{p})\)</span>.</li>
</ol>
<p>All in all, this results in the following:</p>
<div id="22" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>: Random</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Distributions</span>  <span class="co"># so we get the `MvNormal`</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the wrapped model which implements LogDensityProblems.jl.</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just extract the sampler parameters to make our lives easier.</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    ϵ <span class="op">=</span> sampler.ϵ_init</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    M <span class="op">=</span> sampler.M_init</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the current parameters.</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> state.x</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sample the momentum.</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>    p_dist <span class="op">=</span> <span class="fu">MvNormal</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)), M)</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> <span class="fu">rand</span>(rng, p_dist)</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Propose using a single leapfrog step.</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>    x̃, p̃ <span class="op">=</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Accept or reject proposal.</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>    logp <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p)</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>    logp̃ <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x̃) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p̃)</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>    logα <span class="op">=</span> logp̃ <span class="op">-</span> logp</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>    state_new <span class="op">=</span> <span class="cf">if</span> <span class="fu">log</span>(<span class="fu">rand</span>(rng)) <span class="op">&lt;</span> logα</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Accept.</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x̃)</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Reject.</span></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x)</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return the "sample" and the sampler state.</span></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(state_new.x), state_new</span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Fairly straight-forward.</p>
<p>Of course, we haven’t defined the <code>leapfrog_step</code> method yet, so let’s do that:</p>
<div id="24" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p` using "position" `x`.</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x))</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    p1 <span class="op">=</span> p <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update the "position" `x` using momentum `p1`.</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    x̃ <span class="op">=</span> x <span class="op">+</span> ϵ <span class="op">.*</span> (M <span class="op">\</span> p1)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p1` using position `x̃`</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x̃ <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x̃))</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    p2 <span class="op">=</span> p1 <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x̃</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Flip momentum `p2`.</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    p̃ <span class="op">=</span> <span class="op">-</span>p2</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x̃, p̃</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>leapfrog_step (generic function with 1 method)</code></pre>
</div>
</div>
<p>With all of this, we’re technically ready to sample!</p>
<div id="26" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>, <span class="bu">LinearAlgebra</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>rng <span class="op">=</span> <span class="bu">Random</span>.<span class="fu">default_rng</span>()</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>sampler <span class="op">=</span> <span class="fu">MALA</span>(<span class="fl">1</span>, I)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>state <span class="op">=</span> <span class="fu">MALAState</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)))</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>x_next, state_next <span class="op">=</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    rng,</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    AbstractMCMC.<span class="fu">LogDensityModel</span>(model),</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    state</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>(MALASample{Vector{Float64}}([-0.9367430431445177, 0.5657621292228942, 0.49991062553134863]), MALAState{Vector{Float64}}([-0.9367430431445177, 0.5657621292228942, 0.49991062553134863]))</code></pre>
</div>
</div>
<p>Great, it works!</p>
<p>And I promised we would get quite some functionality for free if we implemented <code>AbstractMCMC.step</code>, and so we can now simply call <code>sample</code> to perform standard MCMC sampling:</p>
<div id="28" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform 1000 iterations with our `MALA` sampler.</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; initial_state<span class="op">=</span>state, progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Concatenate into a matrix.</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000 Matrix{Float64}:
 -2.80137  -4.75143  -5.06116  -3.86123  …  -3.71621   -5.5588    -4.30105
 -1.03931  -1.28086  -1.74608  -1.08412      0.322052   0.697805   1.5501
  1.65203   2.55113   3.0488    5.96076      4.79991    4.61385    5.78028</code></pre>
</div>
</div>
<div id="30" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the marginal means and standard deviations.</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -4.96925    1.002
  0.0168812  1.00576
  5.01193    0.996045</code></pre>
</div>
</div>
<p>Let’s visualize the samples</p>
<div id="32" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">StatsPlots</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">transpose</span>(samples_matrix[<span class="op">:</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">:</span><span class="kw">end</span>]), alpha<span class="op">=</span><span class="fl">0.5</span>, legend<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<!--?xml version="1.0" encoding="utf-8"?-->
<svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" width="672" height="480" viewbox="0 0 2688 1920">
<defs>
  <clippath id="clip750">
    <rect x="0" y="0" width="2688" height="1920"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip750)" d="M0 1920 L2688 1920 L2688 0 L0 0  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip751">
    <rect x="537" y="0" width="1883" height="1883"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip750)" d="M151.747 1800.78 L2640.76 1800.78 L2640.76 47.2441 L151.747 47.2441  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip752">
    <rect x="151" y="47" width="2490" height="1755"></rect>
  </clippath>
</defs>
<polyline clip-path="url(#clip752)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="219.84,1800.78 219.84,47.2441 "></polyline>
<polyline clip-path="url(#clip752)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="807.458,1800.78 807.458,47.2441 "></polyline>
<polyline clip-path="url(#clip752)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1395.08,1800.78 1395.08,47.2441 "></polyline>
<polyline clip-path="url(#clip752)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1982.69,1800.78 1982.69,47.2441 "></polyline>
<polyline clip-path="url(#clip752)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="2570.31,1800.78 2570.31,47.2441 "></polyline>
<polyline clip-path="url(#clip752)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,1509.46 2640.76,1509.46 "></polyline>
<polyline clip-path="url(#clip752)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,1213 2640.76,1213 "></polyline>
<polyline clip-path="url(#clip752)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,916.531 2640.76,916.531 "></polyline>
<polyline clip-path="url(#clip752)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,620.065 2640.76,620.065 "></polyline>
<polyline clip-path="url(#clip752)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,323.599 2640.76,323.599 "></polyline>
<polyline clip-path="url(#clip750)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1800.78 2640.76,1800.78 "></polyline>
<polyline clip-path="url(#clip750)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="219.84,1800.78 219.84,1781.88 "></polyline>
<polyline clip-path="url(#clip750)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="807.458,1800.78 807.458,1781.88 "></polyline>
<polyline clip-path="url(#clip750)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1395.08,1800.78 1395.08,1781.88 "></polyline>
<polyline clip-path="url(#clip750)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1982.69,1800.78 1982.69,1781.88 "></polyline>
<polyline clip-path="url(#clip750)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="2570.31,1800.78 2570.31,1781.88 "></polyline>
<path clip-path="url(#clip750)" d="M219.84 1834 Q216.229 1834 214.4 1837.57 Q212.595 1841.11 212.595 1848.24 Q212.595 1855.34 214.4 1858.91 Q216.229 1862.45 219.84 1862.45 Q223.474 1862.45 225.28 1858.91 Q227.108 1855.34 227.108 1848.24 Q227.108 1841.11 225.28 1837.57 Q223.474 1834 219.84 1834 M219.84 1830.3 Q225.65 1830.3 228.706 1834.9 Q231.784 1839.49 231.784 1848.24 Q231.784 1856.96 228.706 1861.57 Q225.65 1866.15 219.84 1866.15 Q214.03 1866.15 210.951 1861.57 Q207.896 1856.96 207.896 1848.24 Q207.896 1839.49 210.951 1834.9 Q214.03 1830.3 219.84 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip750)" d="M771.15 1861.55 L787.47 1861.55 L787.47 1865.48 L765.525 1865.48 L765.525 1861.55 Q768.187 1858.79 772.771 1854.16 Q777.377 1849.51 778.558 1848.17 Q780.803 1845.65 781.683 1843.91 Q782.585 1842.15 782.585 1840.46 Q782.585 1837.71 780.641 1835.97 Q778.72 1834.23 775.618 1834.23 Q773.419 1834.23 770.965 1835 Q768.535 1835.76 765.757 1837.31 L765.757 1832.59 Q768.581 1831.46 771.035 1830.88 Q773.488 1830.3 775.525 1830.3 Q780.896 1830.3 784.09 1832.98 Q787.285 1835.67 787.285 1840.16 Q787.285 1842.29 786.474 1844.21 Q785.687 1846.11 783.581 1848.7 Q783.002 1849.37 779.9 1852.59 Q776.798 1855.78 771.15 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip750)" d="M797.331 1830.92 L815.687 1830.92 L815.687 1834.86 L801.613 1834.86 L801.613 1843.33 Q802.632 1842.98 803.65 1842.82 Q804.669 1842.64 805.687 1842.64 Q811.474 1842.64 814.854 1845.81 Q818.233 1848.98 818.233 1854.4 Q818.233 1859.97 814.761 1863.08 Q811.289 1866.15 804.97 1866.15 Q802.794 1866.15 800.525 1865.78 Q798.28 1865.41 795.872 1864.67 L795.872 1859.97 Q797.956 1861.11 800.178 1861.66 Q802.4 1862.22 804.877 1862.22 Q808.882 1862.22 811.22 1860.11 Q813.558 1858.01 813.558 1854.4 Q813.558 1850.78 811.22 1848.68 Q808.882 1846.57 804.877 1846.57 Q803.002 1846.57 801.127 1846.99 Q799.275 1847.4 797.331 1848.28 L797.331 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip750)" d="M837.446 1834 Q833.835 1834 832.007 1837.57 Q830.201 1841.11 830.201 1848.24 Q830.201 1855.34 832.007 1858.91 Q833.835 1862.45 837.446 1862.45 Q841.081 1862.45 842.886 1858.91 Q844.715 1855.34 844.715 1848.24 Q844.715 1841.11 842.886 1837.57 Q841.081 1834 837.446 1834 M837.446 1830.3 Q843.256 1830.3 846.312 1834.9 Q849.391 1839.49 849.391 1848.24 Q849.391 1856.96 846.312 1861.57 Q843.256 1866.15 837.446 1866.15 Q831.636 1866.15 828.557 1861.57 Q825.502 1856.96 825.502 1848.24 Q825.502 1839.49 828.557 1834.9 Q831.636 1830.3 837.446 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip750)" d="M1354.69 1830.92 L1373.05 1830.92 L1373.05 1834.86 L1358.98 1834.86 L1358.98 1843.33 Q1360 1842.98 1361.01 1842.82 Q1362.03 1842.64 1363.05 1842.64 Q1368.84 1842.64 1372.22 1845.81 Q1375.6 1848.98 1375.6 1854.4 Q1375.6 1859.97 1372.12 1863.08 Q1368.65 1866.15 1362.33 1866.15 Q1360.16 1866.15 1357.89 1865.78 Q1355.64 1865.41 1353.24 1864.67 L1353.24 1859.97 Q1355.32 1861.11 1357.54 1861.66 Q1359.76 1862.22 1362.24 1862.22 Q1366.25 1862.22 1368.58 1860.11 Q1370.92 1858.01 1370.92 1854.4 Q1370.92 1850.78 1368.58 1848.68 Q1366.25 1846.57 1362.24 1846.57 Q1360.37 1846.57 1358.49 1846.99 Q1356.64 1847.4 1354.69 1848.28 L1354.69 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip750)" d="M1394.81 1834 Q1391.2 1834 1389.37 1837.57 Q1387.56 1841.11 1387.56 1848.24 Q1387.56 1855.34 1389.37 1858.91 Q1391.2 1862.45 1394.81 1862.45 Q1398.44 1862.45 1400.25 1858.91 Q1402.08 1855.34 1402.08 1848.24 Q1402.08 1841.11 1400.25 1837.57 Q1398.44 1834 1394.81 1834 M1394.81 1830.3 Q1400.62 1830.3 1403.68 1834.9 Q1406.75 1839.49 1406.75 1848.24 Q1406.75 1856.96 1403.68 1861.57 Q1400.62 1866.15 1394.81 1866.15 Q1389 1866.15 1385.92 1861.57 Q1382.87 1856.96 1382.87 1848.24 Q1382.87 1839.49 1385.92 1834.9 Q1389 1830.3 1394.81 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip750)" d="M1424.97 1834 Q1421.36 1834 1419.53 1837.57 Q1417.73 1841.11 1417.73 1848.24 Q1417.73 1855.34 1419.53 1858.91 Q1421.36 1862.45 1424.97 1862.45 Q1428.61 1862.45 1430.41 1858.91 Q1432.24 1855.34 1432.24 1848.24 Q1432.24 1841.11 1430.41 1837.57 Q1428.61 1834 1424.97 1834 M1424.97 1830.3 Q1430.78 1830.3 1433.84 1834.9 Q1436.92 1839.49 1436.92 1848.24 Q1436.92 1856.96 1433.84 1861.57 Q1430.78 1866.15 1424.97 1866.15 Q1419.16 1866.15 1416.08 1861.57 Q1413.03 1856.96 1413.03 1848.24 Q1413.03 1839.49 1416.08 1834.9 Q1419.16 1830.3 1424.97 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip750)" d="M1940.97 1830.92 L1963.19 1830.92 L1963.19 1832.91 L1950.65 1865.48 L1945.76 1865.48 L1957.57 1834.86 L1940.97 1834.86 L1940.97 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip750)" d="M1972.36 1830.92 L1990.71 1830.92 L1990.71 1834.86 L1976.64 1834.86 L1976.64 1843.33 Q1977.66 1842.98 1978.68 1842.82 Q1979.7 1842.64 1980.72 1842.64 Q1986.5 1842.64 1989.88 1845.81 Q1993.26 1848.98 1993.26 1854.4 Q1993.26 1859.97 1989.79 1863.08 Q1986.32 1866.15 1980 1866.15 Q1977.82 1866.15 1975.55 1865.78 Q1973.31 1865.41 1970.9 1864.67 L1970.9 1859.97 Q1972.98 1861.11 1975.21 1861.66 Q1977.43 1862.22 1979.9 1862.22 Q1983.91 1862.22 1986.25 1860.11 Q1988.59 1858.01 1988.59 1854.4 Q1988.59 1850.78 1986.25 1848.68 Q1983.91 1846.57 1979.9 1846.57 Q1978.03 1846.57 1976.15 1846.99 Q1974.3 1847.4 1972.36 1848.28 L1972.36 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip750)" d="M2012.47 1834 Q2008.86 1834 2007.03 1837.57 Q2005.23 1841.11 2005.23 1848.24 Q2005.23 1855.34 2007.03 1858.91 Q2008.86 1862.45 2012.47 1862.45 Q2016.11 1862.45 2017.91 1858.91 Q2019.74 1855.34 2019.74 1848.24 Q2019.74 1841.11 2017.91 1837.57 Q2016.11 1834 2012.47 1834 M2012.47 1830.3 Q2018.28 1830.3 2021.34 1834.9 Q2024.42 1839.49 2024.42 1848.24 Q2024.42 1856.96 2021.34 1861.57 Q2018.28 1866.15 2012.47 1866.15 Q2006.66 1866.15 2003.59 1861.57 Q2000.53 1856.96 2000.53 1848.24 Q2000.53 1839.49 2003.59 1834.9 Q2006.66 1830.3 2012.47 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip750)" d="M2514.84 1861.55 L2522.48 1861.55 L2522.48 1835.18 L2514.17 1836.85 L2514.17 1832.59 L2522.43 1830.92 L2527.11 1830.92 L2527.11 1861.55 L2534.75 1861.55 L2534.75 1865.48 L2514.84 1865.48 L2514.84 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip750)" d="M2554.19 1834 Q2550.58 1834 2548.75 1837.57 Q2546.94 1841.11 2546.94 1848.24 Q2546.94 1855.34 2548.75 1858.91 Q2550.58 1862.45 2554.19 1862.45 Q2557.82 1862.45 2559.63 1858.91 Q2561.46 1855.34 2561.46 1848.24 Q2561.46 1841.11 2559.63 1837.57 Q2557.82 1834 2554.19 1834 M2554.19 1830.3 Q2560 1830.3 2563.06 1834.9 Q2566.13 1839.49 2566.13 1848.24 Q2566.13 1856.96 2563.06 1861.57 Q2560 1866.15 2554.19 1866.15 Q2548.38 1866.15 2545.3 1861.57 Q2542.25 1856.96 2542.25 1848.24 Q2542.25 1839.49 2545.3 1834.9 Q2548.38 1830.3 2554.19 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip750)" d="M2584.35 1834 Q2580.74 1834 2578.91 1837.57 Q2577.11 1841.11 2577.11 1848.24 Q2577.11 1855.34 2578.91 1858.91 Q2580.74 1862.45 2584.35 1862.45 Q2587.99 1862.45 2589.79 1858.91 Q2591.62 1855.34 2591.62 1848.24 Q2591.62 1841.11 2589.79 1837.57 Q2587.99 1834 2584.35 1834 M2584.35 1830.3 Q2590.16 1830.3 2593.22 1834.9 Q2596.3 1839.49 2596.3 1848.24 Q2596.3 1856.96 2593.22 1861.57 Q2590.16 1866.15 2584.35 1866.15 Q2578.54 1866.15 2575.46 1861.57 Q2572.41 1856.96 2572.41 1848.24 Q2572.41 1839.49 2575.46 1834.9 Q2578.54 1830.3 2584.35 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip750)" d="M2614.51 1834 Q2610.9 1834 2609.07 1837.57 Q2607.27 1841.11 2607.27 1848.24 Q2607.27 1855.34 2609.07 1858.91 Q2610.9 1862.45 2614.51 1862.45 Q2618.15 1862.45 2619.95 1858.91 Q2621.78 1855.34 2621.78 1848.24 Q2621.78 1841.11 2619.95 1837.57 Q2618.15 1834 2614.51 1834 M2614.51 1830.3 Q2620.32 1830.3 2623.38 1834.9 Q2626.46 1839.49 2626.46 1848.24 Q2626.46 1856.96 2623.38 1861.57 Q2620.32 1866.15 2614.51 1866.15 Q2608.7 1866.15 2605.62 1861.57 Q2602.57 1856.96 2602.57 1848.24 Q2602.57 1839.49 2605.62 1834.9 Q2608.7 1830.3 2614.51 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip750)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1800.78 151.747,47.2441 "></polyline>
<polyline clip-path="url(#clip750)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1509.46 170.644,1509.46 "></polyline>
<polyline clip-path="url(#clip750)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1213 170.644,1213 "></polyline>
<polyline clip-path="url(#clip750)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,916.531 170.644,916.531 "></polyline>
<polyline clip-path="url(#clip750)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,620.065 170.644,620.065 "></polyline>
<polyline clip-path="url(#clip750)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,323.599 170.644,323.599 "></polyline>
<path clip-path="url(#clip750)" d="M49.5521 1509.91 L79.2279 1509.91 L79.2279 1513.85 L49.5521 1513.85 L49.5521 1509.91 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip750)" d="M99.8991 1507.6 Q96.7509 1507.6 94.8991 1509.75 Q93.0704 1511.9 93.0704 1515.65 Q93.0704 1519.38 94.8991 1521.56 Q96.7509 1523.71 99.8991 1523.71 Q103.047 1523.71 104.876 1521.56 Q106.728 1519.38 106.728 1515.65 Q106.728 1511.9 104.876 1509.75 Q103.047 1507.6 99.8991 1507.6 M109.181 1492.95 L109.181 1497.21 Q107.422 1496.37 105.617 1495.93 Q103.834 1495.49 102.075 1495.49 Q97.4454 1495.49 94.9917 1498.62 Q92.5612 1501.74 92.2139 1508.06 Q93.5797 1506.05 95.6398 1504.98 Q97.7 1503.9 100.177 1503.9 Q105.385 1503.9 108.394 1507.07 Q111.427 1510.21 111.427 1515.65 Q111.427 1520.98 108.279 1524.2 Q105.131 1527.41 99.8991 1527.41 Q93.9037 1527.41 90.7325 1522.83 Q87.5612 1518.22 87.5612 1509.5 Q87.5612 1501.3 91.45 1496.44 Q95.3389 1491.56 101.89 1491.56 Q103.649 1491.56 105.431 1491.9 Q107.237 1492.25 109.181 1492.95 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip750)" d="M50.3623 1213.45 L80.0381 1213.45 L80.0381 1217.38 L50.3623 1217.38 L50.3623 1213.45 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip750)" d="M104.297 1211.64 Q107.654 1212.36 109.529 1214.63 Q111.427 1216.9 111.427 1220.23 Q111.427 1225.35 107.908 1228.15 Q104.39 1230.95 97.9083 1230.95 Q95.7324 1230.95 93.4176 1230.51 Q91.126 1230.09 88.6723 1229.23 L88.6723 1224.72 Q90.6167 1225.86 92.9315 1226.43 Q95.2463 1227.01 97.7695 1227.01 Q102.168 1227.01 104.459 1225.28 Q106.774 1223.54 106.774 1220.23 Q106.774 1217.17 104.621 1215.46 Q102.492 1213.73 98.6722 1213.73 L94.6445 1213.73 L94.6445 1209.88 L98.8574 1209.88 Q102.306 1209.88 104.135 1208.52 Q105.964 1207.13 105.964 1204.54 Q105.964 1201.87 104.066 1200.46 Q102.191 1199.03 98.6722 1199.03 Q96.7509 1199.03 94.5519 1199.44 Q92.3528 1199.86 89.7139 1200.74 L89.7139 1196.57 Q92.376 1195.83 94.6908 1195.46 Q97.0287 1195.09 99.0889 1195.09 Q104.413 1195.09 107.515 1197.52 Q110.617 1199.93 110.617 1204.05 Q110.617 1206.92 108.973 1208.91 Q107.33 1210.88 104.297 1211.64 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip750)" d="M99.4824 902.329 Q95.8713 902.329 94.0426 905.894 Q92.2371 909.436 92.2371 916.565 Q92.2371 923.672 94.0426 927.237 Q95.8713 930.778 99.4824 930.778 Q103.117 930.778 104.922 927.237 Q106.751 923.672 106.751 916.565 Q106.751 909.436 104.922 905.894 Q103.117 902.329 99.4824 902.329 M99.4824 898.626 Q105.293 898.626 108.348 903.232 Q111.427 907.816 111.427 916.565 Q111.427 925.292 108.348 929.899 Q105.293 934.482 99.4824 934.482 Q93.6723 934.482 90.5936 929.899 Q87.538 925.292 87.538 916.565 Q87.538 907.816 90.5936 903.232 Q93.6723 898.626 99.4824 898.626 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip750)" d="M104.297 618.711 Q107.654 619.429 109.529 621.697 Q111.427 623.966 111.427 627.299 Q111.427 632.415 107.908 635.215 Q104.39 638.016 97.9083 638.016 Q95.7324 638.016 93.4176 637.577 Q91.126 637.16 88.6723 636.303 L88.6723 631.79 Q90.6167 632.924 92.9315 633.502 Q95.2463 634.081 97.7695 634.081 Q102.168 634.081 104.459 632.345 Q106.774 630.609 106.774 627.299 Q106.774 624.243 104.621 622.53 Q102.492 620.794 98.6722 620.794 L94.6445 620.794 L94.6445 616.952 L98.8574 616.952 Q102.306 616.952 104.135 615.586 Q105.964 614.197 105.964 611.604 Q105.964 608.942 104.066 607.53 Q102.191 606.095 98.6722 606.095 Q96.7509 606.095 94.5519 606.512 Q92.3528 606.929 89.7139 607.808 L89.7139 603.642 Q92.376 602.901 94.6908 602.53 Q97.0287 602.16 99.0889 602.16 Q104.413 602.16 107.515 604.591 Q110.617 606.998 110.617 611.118 Q110.617 613.989 108.973 615.979 Q107.33 617.947 104.297 618.711 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip750)" d="M99.8991 321.736 Q96.7509 321.736 94.8991 323.889 Q93.0704 326.042 93.0704 329.791 Q93.0704 333.518 94.8991 335.694 Q96.7509 337.847 99.8991 337.847 Q103.047 337.847 104.876 335.694 Q106.728 333.518 106.728 329.791 Q106.728 326.042 104.876 323.889 Q103.047 321.736 99.8991 321.736 M109.181 307.083 L109.181 311.343 Q107.422 310.509 105.617 310.069 Q103.834 309.63 102.075 309.63 Q97.4454 309.63 94.9917 312.755 Q92.5612 315.88 92.2139 322.199 Q93.5797 320.185 95.6398 319.12 Q97.7 318.032 100.177 318.032 Q105.385 318.032 108.394 321.204 Q111.427 324.352 111.427 329.791 Q111.427 335.116 108.279 338.333 Q105.131 341.551 99.8991 341.551 Q93.9037 341.551 90.7325 336.967 Q87.5612 332.361 87.5612 323.634 Q87.5612 315.44 91.45 310.579 Q95.3389 305.694 101.89 305.694 Q103.649 305.694 105.431 306.042 Q107.237 306.389 109.181 307.083 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip752)" style="stroke:#009af9; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,1193.37 224.541,1490.87 226.891,1346.47 229.242,1400.19 231.592,1274.72 233.943,1369.03 236.293,1243.61 238.644,1236.05 240.994,1370.58 243.345,1469.88 245.695,1597.99 248.046,1410.49 250.396,1530.5 252.747,1490.29 255.097,1520.6 257.448,1414.17 259.798,1348.61 262.148,1434.82 264.499,1285.87 266.849,1316.17 269.2,1394.5 271.55,1521.41 273.901,1417.81 276.251,1490.45 278.602,1465.88 280.952,1442.19 283.303,1362.17 285.653,1486.78 288.004,1247.4 290.354,1670.67 292.705,1470.19 295.055,1448.15 297.406,1308.6 299.756,1379.67 302.107,1466.01 304.457,1368.04 306.807,1583.88 309.158,1354.15 311.508,1388.75 313.859,1407.72 316.209,1498.07 318.56,1370.7 320.91,1477.04 323.261,1526.45 325.611,1324.33 327.962,1521 330.312,1515.25 332.663,1380.71 335.013,1336.21 337.364,1405.54 339.714,1485.44 342.065,1443.77 344.415,1381.86 346.765,1433.04 349.116,1367.53 351.466,1359.25 353.817,1522.82 356.167,1392.76 358.518,1324.38 360.868,1285.83 363.219,1527 365.569,1492.12 367.92,1359.53 370.27,1349.37 372.621,1518.56 374.971,1537.94 377.322,1447.3 379.672,1591.03 382.023,1367.74 384.373,1322.69 386.724,1215.58 389.074,1396.62 391.424,1369.67 393.775,1383.2 396.125,1632.36 398.476,1281.17 400.826,1386.73 403.177,1423.66 405.527,1289.5 407.878,1399.71 410.228,1357.81 412.579,1570.14 414.929,1362.77 417.28,1524.6 419.63,1423.6 421.981,1308.9 424.331,1419.95 426.682,1484 429.032,1403.42 431.382,1509.64 433.733,1540.89 436.083,1520.93 438.434,1316.68 440.784,1374.77 443.135,1478.49 445.485,1306.03 447.836,1334.08 450.186,1331.16 452.537,1493.76 454.887,1374.08 457.238,1252.51 459.588,1478.75 461.939,1191.03 464.289,1351.39 466.64,1376.08 468.99,1583.01 471.341,1376.65 473.691,1183.08 476.041,1436.24 478.392,1266.38 480.742,1428.08 483.093,1436.39 485.443,1358.53 487.794,1283.68 490.144,1479.13 492.495,1372.06 494.845,1433.01 497.196,1441.28 499.546,1419.68 501.897,1377.81 504.247,1451.86 506.598,1359.82 508.948,1637.97 511.299,1411.44 513.649,1500.32 515.999,1330.37 518.35,1446.63 520.7,1539.33 523.051,1388.65 525.401,1487.85 527.752,1497.78 530.102,1189.5 532.453,1730.36 534.803,1517.58 537.154,1412.25 539.504,1500.12 541.855,1513.74 544.205,1345.38 546.556,1338.58 548.906,1338.96 551.257,1460.13 553.607,1569.07 555.958,1293.14 558.308,1388.66 560.658,1430.56 563.009,1528.58 565.359,1257.68 567.71,1258.3 570.06,1467.41 572.411,1322.49 574.761,1495.28 577.112,1570.91 579.462,1404.9 581.813,1400.21 584.163,1481.98 586.514,1369.04 588.864,1380.77 591.215,1381.8 593.565,1578.38 595.916,1373.71 598.266,1527.9 600.616,1302.93 602.967,1343.43 605.317,1415.4 607.668,1448.71 610.018,1427.44 612.369,1423.84 614.719,1403.77 617.07,1518.27 619.42,1245.88 621.771,1502.04 624.121,1340.96 626.472,1459.77 628.822,1422.72 631.173,1406.92 633.523,1337.26 635.874,1236.76 638.224,1271.13 640.575,1382.01 642.925,1330.06 645.275,1300.38 647.626,1422.99 649.976,1392.56 652.327,1424.8 654.677,1304.48 657.028,1453.25 659.378,1308.29 661.729,1385.06 664.079,1212.22 666.43,1401.66 668.78,1342.67 671.131,1435.12 673.481,1530.29 675.832,1272.32 678.182,1528.48 680.533,1560.48 682.883,1267.89 685.233,1456.88 687.584,1529.64 689.934,1239.47 692.285,1280.29 694.635,1284.29 696.986,1358.18 699.336,1480.89 701.687,1324.14 704.037,1295.2 706.388,1135.78 708.738,1433.83 711.089,1234.52 713.439,1465.08 715.79,1354.19 718.14,1547.38 720.491,1329.16 722.841,1355.96 725.192,1399.14 727.542,1360.26 729.892,1498.07 732.243,1305.73 734.593,1323.42 736.944,1444.23 739.294,1423.88 741.645,1582.52 743.995,1338.82 746.346,1285.04 748.696,1412.93 751.047,1382.81 753.397,1346.77 755.748,1476.25 758.098,1291.99 760.449,1394.95 762.799,1305.45 765.15,1469.83 767.5,1266.95 769.85,1504.3 772.201,1541.43 774.551,1379.26 776.902,1229.49 779.252,1358.13 781.603,1581.74 783.953,1442 786.304,1370.24 788.654,1466.07 791.005,1459.83 793.355,1496.05 795.706,1496.65 798.056,1410.43 800.407,1541.1 802.757,1391.59 805.108,1545.23 807.458,1383.65 809.809,1379.8 812.159,1516.3 814.509,1451.32 816.86,1169.77 819.21,1400.15 821.561,1446.9 823.911,1399.41 826.262,1462.66 828.612,1520.99 830.963,1593.93 833.313,1204.13 835.664,1361.75 838.014,1395.17 840.365,1590.16 842.715,1304.47 845.066,1253.43 847.416,1374.13 849.767,1570.91 852.117,1495.82 854.467,1354.86 856.818,1339.58 859.168,1447.33 861.519,1415.41 863.869,1375.75 866.22,1337.98 868.57,1555.09 870.921,1373.87 873.271,1462.75 875.622,1384.26 877.972,1448.37 880.323,1375.33 882.673,1436.97 885.024,1201.21 887.374,1489.06 889.725,1363.91 892.075,1363.69 894.426,1457.24 896.776,1469.85 899.126,1394.04 901.477,1255.87 903.827,1410.49 906.178,1361.25 908.528,1353.92 910.879,1447.8 913.229,1383.72 915.58,1505.67 917.93,1458.58 920.281,1602.9 922.631,1457.28 924.982,1358.5 927.332,1198.01 929.683,1335.13 932.033,1496.58 934.384,1398.53 936.734,1487.44 939.084,1494.54 941.435,1433.65 943.785,1299.63 946.136,1497.82 948.486,1461.76 950.837,1361.24 953.187,1329.57 955.538,1329.92 957.888,1299.99 960.239,1425.84 962.589,1382.32 964.94,1347.54 967.29,1465.25 969.641,1426.4 971.991,1389.99 974.342,1445.39 976.692,1751.15 979.043,1380.57 981.393,1412.11 983.743,1211.28 986.094,1373 988.444,1437.34 990.795,1508.23 993.145,1314.59 995.496,1398.57 997.846,1386.25 1000.2,1335.47 1002.55,1356.3 1004.9,1399.07 1007.25,1598.27 1009.6,1384.19 1011.95,1497.78 1014.3,1516.61 1016.65,1395.56 1019,1404.36 1021.35,1248.23 1023.7,1379.02 1026.05,1411.55 1028.4,1283.24 1030.75,1276.03 1033.1,1349.67 1035.45,1425.29 1037.8,1322.05 1040.15,1407.44 1042.51,1293.83 1044.86,1267.64 1047.21,1460.98 1049.56,1363.12 1051.91,1490.41 1054.26,1317.99 1056.61,1238.58 1058.96,1574.61 1061.31,1403.37 1063.66,1347.99 1066.01,1451.17 1068.36,1339.65 1070.71,1292.63 1073.06,1523.9 1075.41,1452.8 1077.76,1361.01 1080.11,1369.4 1082.46,1471.33 1084.81,1277.86 1087.16,1370.31 1089.51,1597.12 1091.87,1407.69 1094.22,1285.41 1096.57,1408.14 1098.92,1556.13 1101.27,1291.98 1103.62,1479.2 1105.97,1530.89 1108.32,1315.38 1110.67,1528.71 1113.02,1502.1 1115.37,1439.73 1117.72,1461.62 1120.07,1435.82 1122.42,1402.9 1124.77,1486.61 1127.12,1369.46 1129.47,1428.79 1131.82,1406.35 1134.17,1452.52 1136.52,1287.16 1138.87,1437.5 1141.23,1289.52 1143.58,1393.71 1145.93,1400.76 1148.28,1335.3 1150.63,1459.73 1152.98,1454.48 1155.33,1277.05 1157.68,1279.69 1160.03,1389.57 1162.38,1468.48 1164.73,1525.56 1167.08,1455.8 1169.43,1523.71 1171.78,1263.97 1174.13,1384.21 1176.48,1439.6 1178.83,1352.89 1181.18,1363.3 1183.53,1310.81 1185.88,1390.12 1188.23,1384.95 1190.59,1500.56 1192.94,1536.91 1195.29,1410.27 1197.64,1223.89 1199.99,1266.63 1202.34,1591.02 1204.69,1462.37 1207.04,1441.23 1209.39,1482.45 1211.74,1536.78 1214.09,1269.22 1216.44,1447.13 1218.79,1331.45 1221.14,1651.61 1223.49,1383.04 1225.84,1604.79 1228.19,1464.09 1230.54,1382.38 1232.89,1440.57 1235.24,1542.78 1237.59,1300.45 1239.94,1311.77 1242.3,1529.71 1244.65,1650.73 1247,1315.43 1249.35,1328.02 1251.7,1494.91 1254.05,1376.68 1256.4,1414.6 1258.75,1336.5 1261.1,1290.06 1263.45,1492.44 1265.8,1412.67 1268.15,1358.76 1270.5,1404.79 1272.85,1476.83 1275.2,1311.98 1277.55,1497.92 1279.9,1405.23 1282.25,1226.08 1284.6,1566.58 1286.95,1456.13 1289.3,1470.16 1291.66,1393.96 1294.01,1385.19 1296.36,1350.19 1298.71,1450.3 1301.06,1507.78 1303.41,1519.15 1305.76,1461.16 1308.11,1519.49 1310.46,1443.16 1312.81,1416.07 1315.16,1325.45 1317.51,1433.83 1319.86,1368.4 1322.21,1424.78 1324.56,1511.29 1326.91,1421.61 1329.26,1327.49 1331.61,1448.76 1333.96,1354.17 1336.31,1390.79 1338.66,1475.53 1341.02,1402.1 1343.37,1356.41 1345.72,1431.98 1348.07,1226.39 1350.42,1174.46 1352.77,1537.82 1355.12,1467.03 1357.47,1440.62 1359.82,1445.32 1362.17,1415.95 1364.52,1451.65 1366.87,1429.96 1369.22,1454.29 1371.57,1483.36 1373.92,1457.35 1376.27,1490.02 1378.62,1356.22 1380.97,1372.6 1383.32,1444.28 1385.67,1464.14 1388.02,1408.1 1390.38,1219.36 1392.73,1413 1395.08,1198.77 1397.43,1428.57 1399.78,1371.74 1402.13,1399.41 1404.48,1395.22 1406.83,1603.04 1409.18,1353.35 1411.53,1392.76 1413.88,1395.7 1416.23,1365.35 1418.58,1262.33 1420.93,1487.51 1423.28,1522.31 1425.63,1304.92 1427.98,1459.83 1430.33,1538.97 1432.68,1308.9 1435.03,1434.23 1437.38,1473.87 1439.74,1504.42 1442.09,1453.39 1444.44,1213.26 1446.79,1292.63 1449.14,1469.21 1451.49,1359.21 1453.84,1429.39 1456.19,1326.54 1458.54,1584.28 1460.89,1364.31 1463.24,1415.74 1465.59,1541.48 1467.94,1481.97 1470.29,1331.84 1472.64,1305.2 1474.99,1429.09 1477.34,1243.85 1479.69,1390.26 1482.04,1233.29 1484.39,1221.73 1486.74,1534.82 1489.1,1292.32 1491.45,1257.29 1493.8,1188.66 1496.15,1352.56 1498.5,1404.23 1500.85,1407.8 1503.2,1401.28 1505.55,1413.12 1507.9,1491.5 1510.25,1355.9 1512.6,1576 1514.95,1417.7 1517.3,1191.57 1519.65,1437.94 1522,1427.76 1524.35,1277.78 1526.7,1541.99 1529.05,1389.56 1531.4,1452.21 1533.75,1373.64 1536.1,1331.49 1538.45,1430.51 1540.81,1461.22 1543.16,1444.45 1545.51,1494.7 1547.86,1315.84 1550.21,1410.9 1552.56,1479.02 1554.91,1512.39 1557.26,1455.82 1559.61,1379.06 1561.96,1540.29 1564.31,1575.69 1566.66,1459.61 1569.01,1503.12 1571.36,1382.43 1573.71,1327.15 1576.06,1406.83 1578.41,1378.24 1580.76,1556.16 1583.11,1620.14 1585.46,1461.05 1587.81,1403.62 1590.17,1398.84 1592.52,1293.33 1594.87,1487.6 1597.22,1368.07 1599.57,1342.29 1601.92,1565.7 1604.27,1502.83 1606.62,1496.77 1608.97,1286.91 1611.32,1318.7 1613.67,1430.42 1616.02,1344.79 1618.37,1513.52 1620.72,1351.08 1623.07,1529.15 1625.42,1438.38 1627.77,1306.08 1630.12,1509.78 1632.47,1360.61 1634.82,1386.28 1637.17,1411 1639.53,1303.67 1641.88,1427.44 1644.23,1567.4 1646.58,1481.49 1648.93,1510.91 1651.28,1509.87 1653.63,1574.44 1655.98,1567.52 1658.33,1530.57 1660.68,1455.95 1663.03,1338.74 1665.38,1259.25 1667.73,1389.57 1670.08,1381.03 1672.43,1461.06 1674.78,1535.36 1677.13,1351.46 1679.48,1445.6 1681.83,1252.78 1684.18,1456.33 1686.53,1551.76 1688.89,1335.3 1691.24,1179.08 1693.59,1377.69 1695.94,1524.1 1698.29,1381.55 1700.64,1385.15 1702.99,1500.06 1705.34,1378.23 1707.69,1492.31 1710.04,1412.63 1712.39,1468.11 1714.74,1656.77 1717.09,1508.88 1719.44,1517.77 1721.79,1439.76 1724.14,1564.5 1726.49,1205.82 1728.84,1463.52 1731.19,1334.29 1733.54,1406.4 1735.89,1407.8 1738.25,1216.72 1740.6,1406.95 1742.95,1455.95 1745.3,1256.03 1747.65,1436.88 1750,1359.8 1752.35,1406.75 1754.7,1569.54 1757.05,1240.78 1759.4,1494.31 1761.75,1484.52 1764.1,1483.76 1766.45,1280.58 1768.8,1423.97 1771.15,1443.33 1773.5,1384.54 1775.85,1389.8 1778.2,1413.68 1780.55,1418.24 1782.9,1191.6 1785.25,1298.52 1787.6,1321.97 1789.96,1355.8 1792.31,1358.12 1794.66,1489.7 1797.01,1480.78 1799.36,1323.11 1801.71,1333.29 1804.06,1181.25 1806.41,1442.14 1808.76,1499.93 1811.11,1273.93 1813.46,1538.69 1815.81,1301.94 1818.16,1341.19 1820.51,1491.33 1822.86,1502.59 1825.21,1361.48 1827.56,1490.81 1829.91,1564.58 1832.26,1390.12 1834.61,1350.97 1836.96,1409.25 1839.32,1635.07 1841.67,1623.54 1844.02,1360.74 1846.37,1370.83 1848.72,1413.09 1851.07,1456.14 1853.42,1465.79 1855.77,1434.55 1858.12,1565.48 1860.47,1516.15 1862.82,1419.19 1865.17,1373.26 1867.52,1159.56 1869.87,1400.78 1872.22,1451.48 1874.57,1575.22 1876.92,1589.05 1879.27,1419.94 1881.62,1565.1 1883.97,1345.27 1886.32,1403.08 1888.68,1531.79 1891.03,1363.45 1893.38,1422.46 1895.73,1340.08 1898.08,1348.82 1900.43,1534.16 1902.78,1410.67 1905.13,1428.35 1907.48,1486.56 1909.83,1288.5 1912.18,1572.97 1914.53,1463.02 1916.88,1475.79 1919.23,1483.51 1921.58,1436.37 1923.93,1346.56 1926.28,1175.39 1928.63,1466.01 1930.98,1555.78 1933.33,1460.58 1935.68,1403.74 1938.04,1357.95 1940.39,1283.1 1942.74,1444.02 1945.09,1552.68 1947.44,1545.56 1949.79,1455.61 1952.14,1433.53 1954.49,1397.07 1956.84,1415.98 1959.19,1464.26 1961.54,1521 1963.89,1267.61 1966.24,1522.74 1968.59,1523.33 1970.94,1291.13 1973.29,1394.91 1975.64,1340.95 1977.99,1358.45 1980.34,1483 1982.69,1394.28 1985.04,1385.29 1987.4,1395 1989.75,1387.61 1992.1,1472.88 1994.45,1390.66 1996.8,1292.96 1999.15,1297.4 2001.5,1555.85 2003.85,1330.56 2006.2,1614.97 2008.55,1418.93 2010.9,1467.42 2013.25,1378.61 2015.6,1577.22 2017.95,1349.93 2020.3,1421.26 2022.65,1506.98 2025,1328.71 2027.35,1541.73 2029.7,1426.59 2032.05,1405.51 2034.4,1492.27 2036.76,1405.54 2039.11,1656 2041.46,1475.37 2043.81,1563.82 2046.16,1373.5 2048.51,1394.34 2050.86,1436.65 2053.21,1460.28 2055.56,1264.43 2057.91,1353.14 2060.26,1357.29 2062.61,1136.09 2064.96,1509.04 2067.31,1570.18 2069.66,1463.48 2072.01,1347.98 2074.36,1455.4 2076.71,1311.58 2079.06,1361.8 2081.41,1352.15 2083.76,1481.35 2086.11,1547.22 2088.47,1461.91 2090.82,1450.17 2093.17,1406.78 2095.52,1381.89 2097.87,1253.01 2100.22,1507.92 2102.57,1310.11 2104.92,1368.71 2107.27,1324.21 2109.62,1368.4 2111.97,1512.22 2114.32,1311.25 2116.67,1424.2 2119.02,1317.46 2121.37,1438.54 2123.72,1542.83 2126.07,1301.86 2128.42,1433.6 2130.77,1628.73 2133.12,1313.69 2135.47,1361.97 2137.83,1532.87 2140.18,1410.18 2142.53,1410.01 2144.88,1341.65 2147.23,1409.31 2149.58,1474.4 2151.93,1466.75 2154.28,1446.07 2156.63,1465.2 2158.98,1549.82 2161.33,1510.47 2163.68,1584.68 2166.03,1456.09 2168.38,1314.95 2170.73,1340.82 2173.08,1393.46 2175.43,1438.33 2177.78,1446.71 2180.13,1283.47 2182.48,1447.32 2184.83,1558.28 2187.19,1421.38 2189.54,1440.5 2191.89,1446.49 2194.24,1398.14 2196.59,1359.79 2198.94,1407.09 2201.29,1473.34 2203.64,1526.15 2205.99,1515.47 2208.34,1405.64 2210.69,1469.49 2213.04,1309.05 2215.39,1161.74 2217.74,1618.31 2220.09,1554.32 2222.44,1376.57 2224.79,1297 2227.14,1209.93 2229.49,1198.97 2231.84,1264.67 2234.19,1322.72 2236.55,1549.98 2238.9,1540.68 2241.25,1503.94 2243.6,1331.24 2245.95,1411.52 2248.3,1397.09 2250.65,1356.02 2253,1264.54 2255.35,1433.37 2257.7,1379.7 2260.05,1326.31 2262.4,1548.62 2264.75,1243.16 2267.1,1453.01 2269.45,1341.03 2271.8,1380 2274.15,1456.37 2276.5,1479.54 2278.85,1518.11 2281.2,1383.87 2283.55,1339.49 2285.91,1460.09 2288.26,1448.2 2290.61,1492.16 2292.96,1354.3 2295.31,1224.29 2297.66,1381.95 2300.01,1356.65 2302.36,1372.69 2304.71,1163.37 2307.06,1418.55 2309.41,1528.99 2311.76,1376.54 2314.11,1348.55 2316.46,1588.25 2318.81,1244.63 2321.16,1538.84 2323.51,1420.2 2325.86,1285.35 2328.21,1489.86 2330.56,1330.38 2332.91,1548.49 2335.27,1462.57 2337.62,1284.61 2339.97,1439.38 2342.32,1298.62 2344.67,1440.98 2347.02,1306.76 2349.37,1419.48 2351.72,1400.24 2354.07,1260.52 2356.42,1401.22 2358.77,1514.02 2361.12,1241.94 2363.47,1489.07 2365.82,1564.9 2368.17,1442.49 2370.52,1457.4 2372.87,1564.58 2375.22,1524.56 2377.57,1401.08 2379.92,1481.11 2382.27,1246.18 2384.62,1420.17 2386.98,1454.43 2389.33,1332.75 2391.68,1688.89 2394.03,1573.94 2396.38,1376.09 2398.73,1455.39 2401.08,1463.83 2403.43,1559.24 2405.78,1409.4 2408.13,1535.06 2410.48,1339.77 2412.83,1387.31 2415.18,1409.91 2417.53,1314.25 2419.88,1491.65 2422.23,1407.72 2424.58,1440.74 2426.93,1357.12 2429.28,1409.36 2431.63,1644.57 2433.98,1404.04 2436.34,1339.78 2438.69,1269.95 2441.04,1414.74 2443.39,1393.35 2445.74,1493.21 2448.09,1401.22 2450.44,1379.01 2452.79,1359.43 2455.14,1523.09 2457.49,1377.34 2459.84,1485.07 2462.19,1186.62 2464.54,1499.62 2466.89,1427.18 2469.24,1296.02 2471.59,1206.54 2473.94,1512.99 2476.29,1543.67 2478.64,1527.88 2480.99,1406.82 2483.34,1450.34 2485.7,1558.93 2488.05,1326.92 2490.4,1444.98 2492.75,1471.09 2495.1,1429.86 2497.45,1341.34 2499.8,1471.76 2502.15,1312.44 2504.5,1279.19 2506.85,1454.53 2509.2,1343.31 2511.55,1471.99 2513.9,1351.61 2516.25,1484.16 2518.6,1476.98 2520.95,1518.74 2523.3,1325.22 2525.65,1385.51 2528,1486.41 2530.35,1336.63 2532.7,1405.18 2535.06,1395.42 2537.41,1404.62 2539.76,1397.08 2542.11,1442.4 2544.46,1431.59 2546.81,1196.4 2549.16,1443.1 2551.51,1147.95 2553.86,1478.84 2556.21,1522.08 2558.56,1411.03 2560.91,1537.3 2563.26,1377.05 2565.61,1361.7 2567.96,1349.76 2570.31,1508.52 "></polyline>
<polyline clip-path="url(#clip752)" style="stroke:#e26f46; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,1019.24 224.541,1039.64 226.891,1064.34 229.242,948.702 231.592,760.833 233.943,831.098 236.293,880.495 238.644,974.848 240.994,912.777 243.345,857.363 245.695,962.326 248.046,986.347 250.396,882.237 252.747,974.039 255.097,866.243 257.448,1024.55 259.798,899.861 262.148,895.182 264.499,994.252 266.849,999.653 269.2,897.577 271.55,898.582 273.901,951.221 276.251,742.474 278.602,849.089 280.952,955.517 283.303,811.436 285.653,1004.57 288.004,823.391 290.354,885.79 292.705,838.537 295.055,921.982 297.406,875.615 299.756,872.716 302.107,1112.82 304.457,890.816 306.807,879.701 309.158,798.738 311.508,847.846 313.859,930.812 316.209,859.632 318.56,906.822 320.91,871.655 323.261,902.477 325.611,1039.02 327.962,813.325 330.312,882.046 332.663,930.857 335.013,967.382 337.364,1013.17 339.714,853.003 342.065,812.274 344.415,872.125 346.765,925.701 349.116,908.008 351.466,732.994 353.817,1008.57 356.167,908.623 358.518,1005.31 360.868,690.334 363.219,791.406 365.569,797.365 367.92,971.153 370.27,921.807 372.621,754.519 374.971,799.814 377.322,901.502 379.672,843.315 382.023,879.107 384.373,1020.27 386.724,953.94 389.074,898.077 391.424,729.344 393.775,801.877 396.125,1017.83 398.476,1037.37 400.826,745.848 403.177,1079.41 405.527,892.673 407.878,860.977 410.228,929.215 412.579,946.619 414.929,983.656 417.28,956.631 419.63,1026.27 421.981,901.041 424.331,882.499 426.682,821.714 429.032,903.371 431.382,848.613 433.733,1125.58 436.083,638.231 438.434,893.089 440.784,955.672 443.135,890.109 445.485,890.986 447.836,847.488 450.186,952.243 452.537,911.483 454.887,943.61 457.238,961.716 459.588,1056.35 461.939,868.536 464.289,891.128 466.64,977.933 468.99,828.133 471.341,962.866 473.691,976.371 476.041,887.477 478.392,1037.9 480.742,813.284 483.093,993.493 485.443,1076.67 487.794,893.267 490.144,1067.81 492.495,1138.6 494.845,953.843 497.196,859.056 499.546,959.619 501.897,1030.12 504.247,902.443 506.598,885.228 508.948,818.996 511.299,1018.15 513.649,1044.56 515.999,881.991 518.35,950.773 520.7,961.894 523.051,896.921 525.401,869.065 527.752,1052.61 530.102,864.716 532.453,833.175 534.803,999.626 537.154,980.163 539.504,861.37 541.855,852.276 544.205,869.19 546.556,991.387 548.906,810.326 551.257,1010.29 553.607,827.658 555.958,998.787 558.308,1113.66 560.658,987.18 563.009,878.248 565.359,1080.97 567.71,1027.64 570.06,942.957 572.411,917.204 574.761,842.101 577.112,983.449 579.462,831.328 581.813,725.884 584.163,839.33 586.514,724.742 588.864,982.792 591.215,831.037 593.565,862.228 595.916,704.483 598.266,936.454 600.616,840.852 602.967,869.191 605.317,832.423 607.668,997.883 610.018,972.43 612.369,966.154 614.719,1068.58 617.07,800.691 619.42,966.282 621.771,797.859 624.121,982.423 626.472,931.626 628.822,907.317 631.173,848.154 633.523,710.853 635.874,887.834 638.224,923.387 640.575,1108.77 642.925,856.819 645.275,1000.1 647.626,1078.64 649.976,854.951 652.327,876.702 654.677,851.795 657.028,823.089 659.378,1033.67 661.729,987.498 664.079,791.517 666.43,885.541 668.78,951.657 671.131,843.009 673.481,744.736 675.832,903.372 678.182,936.208 680.533,945.458 682.883,839.706 685.233,958.838 687.584,957.725 689.934,1019.77 692.285,1040.77 694.635,732.203 696.986,864.084 699.336,952.357 701.687,1058.22 704.037,1025.14 706.388,944.917 708.738,871.577 711.089,1006.55 713.439,944.3 715.79,897.258 718.14,1019.35 720.491,787.17 722.841,935.186 725.192,975.553 727.542,845.798 729.892,867.646 732.243,902.668 734.593,910.224 736.944,917.486 739.294,976.608 741.645,803.06 743.995,825.772 746.346,923.609 748.696,974.139 751.047,982.877 753.397,1013.59 755.748,851.702 758.098,902.25 760.449,844.535 762.799,941.261 765.15,1029.52 767.5,738.499 769.85,868.102 772.201,988.7 774.551,888.916 776.902,710.385 779.252,1017.69 781.603,804.691 783.953,862.105 786.304,887.282 788.654,871.688 791.005,844.749 793.355,922.096 795.706,824.653 798.056,898.375 800.407,901.409 802.757,714.872 805.108,861.602 807.458,927.52 809.809,954.644 812.159,781.241 814.509,901.543 816.86,1008.32 819.21,951.602 821.561,955.248 823.911,915.214 826.262,923.514 828.612,1031.41 830.963,995.554 833.313,692.777 835.664,618.206 838.014,1084.45 840.365,1053.86 842.715,1019.1 845.066,853.425 847.416,903.067 849.767,1032.81 852.117,766.014 854.467,820.672 856.818,813.54 859.168,980.742 861.519,885.348 863.869,782.971 866.22,980.767 868.57,985.697 870.921,1177.06 873.271,718.116 875.622,984.946 877.972,966.014 880.323,879.341 882.673,1009.62 885.024,1066.85 887.374,803.465 889.725,923.441 892.075,887.609 894.426,932.98 896.776,1004.29 899.126,792.891 901.477,815.119 903.827,847.573 906.178,957.982 908.528,830.939 910.879,914.108 913.229,886.243 915.58,1010.21 917.93,1006.18 920.281,952.428 922.631,843.67 924.982,840.969 927.332,887.567 929.683,990.352 932.033,849.928 934.384,824.314 936.734,794.518 939.084,809.984 941.435,927.348 943.785,853.173 946.136,840.897 948.486,895.02 950.837,761.511 953.187,1070.4 955.538,901.933 957.888,1046.83 960.239,929.662 962.589,982.79 964.94,991.571 967.29,967.352 969.641,957.961 971.991,1036.61 974.342,875.871 976.692,920.938 979.043,795.558 981.393,873.494 983.743,911.498 986.094,897.851 988.444,926.794 990.795,884.143 993.145,786.294 995.496,862.077 997.846,946.574 1000.2,804.3 1002.55,785.056 1004.9,943.034 1007.25,718.233 1009.6,1115.69 1011.95,946.499 1014.3,788.997 1016.65,913.655 1019,897.392 1021.35,758.443 1023.7,1050.95 1026.05,742.393 1028.4,954.22 1030.75,915.354 1033.1,812.481 1035.45,829.088 1037.8,929.772 1040.15,860.452 1042.51,972.07 1044.86,1014.09 1047.21,939.759 1049.56,1040.59 1051.91,882.695 1054.26,924.975 1056.61,925.965 1058.96,915.98 1061.31,879.52 1063.66,786.556 1066.01,773.002 1068.36,937.682 1070.71,841.51 1073.06,1095.09 1075.41,846.176 1077.76,1081.51 1080.11,1085.06 1082.46,969.08 1084.81,885.857 1087.16,851.975 1089.51,1047.87 1091.87,873.838 1094.22,1062.95 1096.57,864.158 1098.92,823.143 1101.27,888.918 1103.62,776.037 1105.97,858.226 1108.32,1035.73 1110.67,785.905 1113.02,775.492 1115.37,1026.67 1117.72,827.827 1120.07,1048.03 1122.42,754.525 1124.77,970.815 1127.12,805.137 1129.47,727.98 1131.82,1096 1134.17,955.523 1136.52,801.35 1138.87,997.032 1141.23,802.821 1143.58,882.596 1145.93,1038.54 1148.28,821.213 1150.63,711.15 1152.98,961.807 1155.33,901.205 1157.68,1102.71 1160.03,801.487 1162.38,997.647 1164.73,1173.33 1167.08,879.408 1169.43,867.314 1171.78,988.337 1174.13,802.681 1176.48,798.746 1178.83,1068.2 1181.18,1028.46 1183.53,999.94 1185.88,768.631 1188.23,792.164 1190.59,912.523 1192.94,874.769 1195.29,869.031 1197.64,871.72 1199.99,999.859 1202.34,918.105 1204.69,1066.55 1207.04,859.383 1209.39,1006.61 1211.74,1034.73 1214.09,836.662 1216.44,993.578 1218.79,990.773 1221.14,774.128 1223.49,946.24 1225.84,842.607 1228.19,1093.24 1230.54,1032.9 1232.89,1036.94 1235.24,1006.84 1237.59,925.923 1239.94,691.823 1242.3,834.456 1244.65,742.302 1247,671.637 1249.35,948.866 1251.7,854.875 1254.05,981.807 1256.4,1076.77 1258.75,986.986 1261.1,1066.97 1263.45,810.369 1265.8,903.232 1268.15,902.088 1270.5,785.945 1272.85,899.602 1275.2,891.258 1277.55,884.318 1279.9,898.392 1282.25,844.431 1284.6,1052.08 1286.95,963.722 1289.3,1058.69 1291.66,827.499 1294.01,911.782 1296.36,979.913 1298.71,936.17 1301.06,890.787 1303.41,968.297 1305.76,810.037 1308.11,883.392 1310.46,1095.99 1312.81,920.54 1315.16,756.157 1317.51,994.751 1319.86,1145.04 1322.21,715.996 1324.56,807.709 1326.91,922.872 1329.26,851.08 1331.61,981.138 1333.96,985.663 1336.31,930.735 1338.66,888.658 1341.02,882.91 1343.37,1006.39 1345.72,1035.17 1348.07,925.823 1350.42,954.162 1352.77,931.775 1355.12,972.695 1357.47,1001.61 1359.82,841.349 1362.17,780.206 1364.52,818.173 1366.87,1068.01 1369.22,859.92 1371.57,811.736 1373.92,904.121 1376.27,765.592 1378.62,877.378 1380.97,992.563 1383.32,915.137 1385.67,940.81 1388.02,811.406 1390.38,899.191 1392.73,1049.89 1395.08,829.12 1397.43,798.948 1399.78,876.158 1402.13,1056.52 1404.48,775.37 1406.83,1004.19 1409.18,880.506 1411.53,949.739 1413.88,870.048 1416.23,882.416 1418.58,755.217 1420.93,925.19 1423.28,697.369 1425.63,919.575 1427.98,872.694 1430.33,954.968 1432.68,927.179 1435.03,946.182 1437.38,1035.93 1439.74,970.931 1442.09,1031.44 1444.44,906.569 1446.79,778.27 1449.14,998.489 1451.49,976.25 1453.84,945.783 1456.19,791.705 1458.54,805.041 1460.89,777.067 1463.24,1083.94 1465.59,937.143 1467.94,847.281 1470.29,898.177 1472.64,868.726 1474.99,922.893 1477.34,1105.66 1479.69,742.394 1482.04,862.554 1484.39,852.359 1486.74,1037.05 1489.1,972.561 1491.45,859.559 1493.8,813.175 1496.15,741.903 1498.5,826.876 1500.85,950.311 1503.2,748.584 1505.55,788.737 1507.9,950.406 1510.25,802.983 1512.6,951.182 1514.95,1006.7 1517.3,821.086 1519.65,901.001 1522,832.67 1524.35,986.16 1526.7,859.872 1529.05,986.827 1531.4,973.831 1533.75,998.711 1536.1,1009.6 1538.45,983.706 1540.81,934.364 1543.16,978.139 1545.51,921.824 1547.86,982.226 1550.21,864.634 1552.56,1028.19 1554.91,850.078 1557.26,912.705 1559.61,819.02 1561.96,997.008 1564.31,985.291 1566.66,836.027 1569.01,945.672 1571.36,981.071 1573.71,1005.29 1576.06,956.232 1578.41,891.818 1580.76,831.41 1583.11,783.346 1585.46,802.268 1587.81,958.294 1590.17,1026.89 1592.52,859.964 1594.87,914.617 1597.22,1015.25 1599.57,962.091 1601.92,857.061 1604.27,984.845 1606.62,781.251 1608.97,945.45 1611.32,840.404 1613.67,830.769 1616.02,887.646 1618.37,1064.98 1620.72,954.538 1623.07,995.204 1625.42,972.659 1627.77,846.309 1630.12,955.212 1632.47,745.399 1634.82,643.862 1637.17,1015.94 1639.53,650.956 1641.88,698.272 1644.23,943.141 1646.58,792.167 1648.93,986.492 1651.28,953.625 1653.63,1009.66 1655.98,941.185 1658.33,914.548 1660.68,887.957 1663.03,818.4 1665.38,918.684 1667.73,736.141 1670.08,881.167 1672.43,764.579 1674.78,933.627 1677.13,836.301 1679.48,868.995 1681.83,864.846 1684.18,1011.18 1686.53,993.637 1688.89,1012.34 1691.24,763.217 1693.59,914.191 1695.94,1036.29 1698.29,925.332 1700.64,1050.01 1702.99,962.526 1705.34,928.704 1707.69,991.231 1710.04,1058.4 1712.39,851.335 1714.74,952.725 1717.09,691.514 1719.44,885.612 1721.79,915.849 1724.14,967.465 1726.49,865.91 1728.84,1074.57 1731.19,1001.23 1733.54,754.19 1735.89,981.688 1738.25,749.366 1740.6,878.755 1742.95,734.132 1745.3,938.374 1747.65,1014.9 1750,846.35 1752.35,872.993 1754.7,914.66 1757.05,883.25 1759.4,1081.88 1761.75,844.767 1764.1,748.102 1766.45,873.38 1768.8,805.55 1771.15,773.734 1773.5,853.657 1775.85,1024.33 1778.2,1008.17 1780.55,828.543 1782.9,979.004 1785.25,839.23 1787.6,772.434 1789.96,827.068 1792.31,991.326 1794.66,866.441 1797.01,823.679 1799.36,737.631 1801.71,842.38 1804.06,1145.44 1806.41,921.101 1808.76,628.571 1811.11,766.227 1813.46,849.95 1815.81,812.946 1818.16,1025.66 1820.51,1112.75 1822.86,958.527 1825.21,1031.29 1827.56,867.39 1829.91,961.325 1832.26,849.82 1834.61,1084.17 1836.96,767.641 1839.32,1145.84 1841.67,936.084 1844.02,739.958 1846.37,853.586 1848.72,1005.24 1851.07,832.144 1853.42,1146.99 1855.77,921.358 1858.12,1059.78 1860.47,827.244 1862.82,961.985 1865.17,1016.47 1867.52,1115.44 1869.87,841.301 1872.22,790.098 1874.57,1087.98 1876.92,900.234 1879.27,781.546 1881.62,906.696 1883.97,1092.34 1886.32,902.42 1888.68,724.094 1891.03,929.854 1893.38,958.325 1895.73,926.032 1898.08,736.496 1900.43,1090.04 1902.78,1110.95 1905.13,928.777 1907.48,897.537 1909.83,829.194 1912.18,1029.46 1914.53,1079.64 1916.88,965.173 1919.23,931.021 1921.58,962.698 1923.93,854.097 1926.28,940.59 1928.63,864.071 1930.98,846.415 1933.33,1075.73 1935.68,976.759 1938.04,929.714 1940.39,914.109 1942.74,901.813 1945.09,858.979 1947.44,1028.52 1949.79,791.297 1952.14,915.503 1954.49,855.977 1956.84,783.258 1959.19,713.105 1961.54,716.893 1963.89,972.53 1966.24,1021.74 1968.59,836.487 1970.94,986.025 1973.29,927.566 1975.64,817.116 1977.99,824.578 1980.34,1002.61 1982.69,855.861 1985.04,1030.1 1987.4,830.991 1989.75,890.563 1992.1,915.854 1994.45,872.587 1996.8,759.662 1999.15,823.223 2001.5,933.017 2003.85,883.297 2006.2,887.33 2008.55,878.765 2010.9,748.768 2013.25,929.386 2015.6,881.189 2017.95,977.071 2020.3,956.012 2022.65,936.488 2025,792.313 2027.35,1087.6 2029.7,993.311 2032.05,852.651 2034.4,779.738 2036.76,908.022 2039.11,697.704 2041.46,911.5 2043.81,984.698 2046.16,911.987 2048.51,889.706 2050.86,963.955 2053.21,964.05 2055.56,855.857 2057.91,840.004 2060.26,801.621 2062.61,853.132 2064.96,954.965 2067.31,846.141 2069.66,867.026 2072.01,786.789 2074.36,876.688 2076.71,895.045 2079.06,959.489 2081.41,918.746 2083.76,677.795 2086.11,934.758 2088.47,941.349 2090.82,909.82 2093.17,945.817 2095.52,824.27 2097.87,731.537 2100.22,812.46 2102.57,984.573 2104.92,1040.33 2107.27,789.415 2109.62,848.656 2111.97,976.921 2114.32,917.23 2116.67,1095.48 2119.02,990.873 2121.37,869.757 2123.72,1000.45 2126.07,844.83 2128.42,891.942 2130.77,959.158 2133.12,896.979 2135.47,1093.49 2137.83,961.005 2140.18,921.092 2142.53,1003.57 2144.88,928.141 2147.23,721.162 2149.58,967.601 2151.93,966.975 2154.28,845.391 2156.63,946.84 2158.98,994.183 2161.33,827.683 2163.68,771.564 2166.03,1047.5 2168.38,931.288 2170.73,895.463 2173.08,1169.77 2175.43,1000.18 2177.78,918.187 2180.13,858.187 2182.48,998.182 2184.83,831.181 2187.19,829.133 2189.54,1109.4 2191.89,1063.44 2194.24,1126.81 2196.59,982.259 2198.94,929.436 2201.29,681.449 2203.64,801.024 2205.99,937.646 2208.34,1031.33 2210.69,817.114 2213.04,949.607 2215.39,880.753 2217.74,983.392 2220.09,823.266 2222.44,903.61 2224.79,818.787 2227.14,1184.97 2229.49,883.752 2231.84,1049.83 2234.19,888.37 2236.55,836.131 2238.9,1011.34 2241.25,899.35 2243.6,885.228 2245.95,1053.69 2248.3,980.854 2250.65,832.999 2253,1101.9 2255.35,872.492 2257.7,810.814 2260.05,1028.01 2262.4,916.097 2264.75,933.843 2267.1,792.509 2269.45,1067.9 2271.8,972.239 2274.15,958.377 2276.5,873.955 2278.85,982.337 2281.2,944.284 2283.55,1003.15 2285.91,1111.7 2288.26,648.748 2290.61,834.13 2292.96,819.709 2295.31,834.619 2297.66,957.317 2300.01,901.746 2302.36,803.812 2304.71,908.121 2307.06,883.099 2309.41,1036.17 2311.76,1138.55 2314.11,1003.74 2316.46,1043.76 2318.81,837.012 2321.16,950.076 2323.51,955.337 2325.86,834.028 2328.21,990.313 2330.56,959.063 2332.91,866.332 2335.27,905.104 2337.62,855.305 2339.97,1035.59 2342.32,842.852 2344.67,888.118 2347.02,817.053 2349.37,1035.91 2351.72,1011.99 2354.07,962.979 2356.42,994.668 2358.77,885.38 2361.12,1050.57 2363.47,754.315 2365.82,764.356 2368.17,849.93 2370.52,973.247 2372.87,917.237 2375.22,922.579 2377.57,1101.51 2379.92,907.038 2382.27,980.491 2384.62,1010.65 2386.98,944.86 2389.33,909.468 2391.68,875.881 2394.03,1118.49 2396.38,878.343 2398.73,980.436 2401.08,796.093 2403.43,867.447 2405.78,847.94 2408.13,915.512 2410.48,893.93 2412.83,902.17 2415.18,1063.28 2417.53,864.309 2419.88,992.898 2422.23,1074.9 2424.58,917.965 2426.93,1002.16 2429.28,1001.48 2431.63,872.257 2433.98,920.848 2436.34,898.393 2438.69,950.613 2441.04,848.572 2443.39,836.092 2445.74,1075.7 2448.09,926.552 2450.44,977.878 2452.79,736.492 2455.14,1073.14 2457.49,676.084 2459.84,972.281 2462.19,828.333 2464.54,798.145 2466.89,842.223 2469.24,986.587 2471.59,1017.42 2473.94,877.124 2476.29,894.403 2478.64,1039 2480.99,820.555 2483.34,865.451 2485.7,796.834 2488.05,766.279 2490.4,880.47 2492.75,889.014 2495.1,940.413 2497.45,796.914 2499.8,905.657 2502.15,849.804 2504.5,875.949 2506.85,1152.43 2509.2,918.642 2511.55,821.056 2513.9,891.331 2516.25,789.462 2518.6,810.255 2520.95,751.154 2523.3,959.51 2525.65,849.989 2528,1096.28 2530.35,878.785 2532.7,798.119 2535.06,960.455 2537.41,905.261 2539.76,996.383 2542.11,913.617 2544.46,979.933 2546.81,977.279 2549.16,631.755 2551.51,791.269 2553.86,1020.02 2556.21,1070.57 2558.56,839.034 2560.91,756.062 2563.26,940.786 2565.61,1077.86 2567.96,995.781 2570.31,929.301 "></polyline>
<polyline clip-path="url(#clip752)" style="stroke:#3da44d; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,753.274 224.541,330.07 226.891,535.011 229.242,558.447 231.592,493.558 233.943,423.379 236.293,501.307 238.644,550.037 240.994,421.984 243.345,626.206 245.695,335.815 248.046,416.167 250.396,550.566 252.747,541.498 255.097,457.37 257.448,337.856 259.798,405.313 262.148,258.4 264.499,283.894 266.849,278.677 269.2,339.739 271.55,468.671 273.901,545.246 276.251,434.163 278.602,266.702 280.952,375.044 283.303,420.989 285.653,669.282 288.004,482.418 290.354,407.271 292.705,472.292 295.055,397.289 297.406,467.27 299.756,409.56 302.107,510.227 304.457,475.759 306.807,321.402 309.158,511.666 311.508,389.918 313.859,393.393 316.209,548.81 318.56,418.319 320.91,599.167 323.261,189.519 325.611,390.29 327.962,541.351 330.312,459.149 332.663,526.966 335.013,349.353 337.364,349.346 339.714,506.095 342.065,332.142 344.415,422.649 346.765,421.765 349.116,485.286 351.466,382.163 353.817,407.28 356.167,280.665 358.518,353.73 360.868,318.875 363.219,370.16 365.569,519.513 367.92,404.602 370.27,553.58 372.621,594.57 374.971,622.687 377.322,450.353 379.672,476.143 382.023,518.298 384.373,519.461 386.724,277.33 389.074,428.501 391.424,305.223 393.775,397.292 396.125,335.539 398.476,278.287 400.826,479.236 403.177,479.315 405.527,410.025 407.878,346.579 410.228,586.717 412.579,377.279 414.929,383.653 417.28,590.668 419.63,439.111 421.981,310.857 424.331,437.592 426.682,293.35 429.032,464.821 431.382,476.85 433.733,450.999 436.083,438.771 438.434,436.814 440.784,574.429 443.135,364.958 445.485,411.855 447.836,394.191 450.186,571.563 452.537,441.779 454.887,503.38 457.238,534.788 459.588,694.67 461.939,384.916 464.289,378.794 466.64,477.073 468.99,333.066 471.341,476.61 473.691,247.616 476.041,388.402 478.392,218.177 480.742,417.115 483.093,313.73 485.443,327.698 487.794,365.79 490.144,391.099 492.495,515.815 494.845,485.129 497.196,320.653 499.546,515.197 501.897,335.799 504.247,125.538 506.598,402.925 508.948,498.757 511.299,454.207 513.649,472.331 515.999,433.396 518.35,468.596 520.7,381.782 523.051,643.219 525.401,243.101 527.752,351.271 530.102,426.522 532.453,367.126 534.803,345.775 537.154,453.052 539.504,595.664 541.855,403.196 544.205,446.104 546.556,427.26 548.906,273.217 551.257,365.826 553.607,390.48 555.958,533.459 558.308,394.476 560.658,369.377 563.009,337.545 565.359,353.098 567.71,320.156 570.06,540.418 572.411,435.173 574.761,354.753 577.112,264.412 579.462,247.777 581.813,332.419 584.163,537.952 586.514,557.815 588.864,439.615 591.215,552.577 593.565,401.292 595.916,439.923 598.266,567.885 600.616,475.378 602.967,262.383 605.317,453.225 607.668,496.395 610.018,451.837 612.369,318.092 614.719,413.537 617.07,460.866 619.42,447.744 621.771,372.261 624.121,466.281 626.472,277.19 628.822,444.505 631.173,386.584 633.523,438.946 635.874,551.605 638.224,321.153 640.575,533.966 642.925,711.729 645.275,283.105 647.626,500.666 649.976,290.893 652.327,361.54 654.677,312.387 657.028,337.078 659.378,322.714 661.729,316.376 664.079,336.97 666.43,302.344 668.78,525.992 671.131,410.288 673.481,309.626 675.832,325.503 678.182,572.631 680.533,310.014 682.883,433.23 685.233,496.485 687.584,498.023 689.934,447.937 692.285,478.889 694.635,456.87 696.986,491.276 699.336,268.185 701.687,298.208 704.037,482.637 706.388,244.538 708.738,577.455 711.089,508.945 713.439,461.325 715.79,527.077 718.14,531.789 720.491,458.566 722.841,518.944 725.192,453.578 727.542,273.823 729.892,404.237 732.243,429.642 734.593,426.995 736.944,382.362 739.294,305.466 741.645,322.158 743.995,387.363 746.346,260.105 748.696,351.984 751.047,253.558 753.397,423.409 755.748,484.123 758.098,473.89 760.449,437.867 762.799,492.706 765.15,553.699 767.5,348.107 769.85,430.591 772.201,442.714 774.551,532.672 776.902,586.501 779.252,504.322 781.603,454.858 783.953,423.848 786.304,595.217 788.654,287.661 791.005,304.148 793.355,476.343 795.706,353.795 798.056,577.923 800.407,470.308 802.757,471.984 805.108,437.118 807.458,426.928 809.809,475.164 812.159,431.031 814.509,177.125 816.86,397.184 819.21,334.567 821.561,478.258 823.911,280.592 826.262,502.044 828.612,500.873 830.963,331.55 833.313,391.773 835.664,542.567 838.014,503.828 840.365,370.132 842.715,449.916 845.066,440.057 847.416,549.062 849.767,379.992 852.117,227.255 854.467,392.622 856.818,393.956 859.168,513.024 861.519,435.937 863.869,448.614 866.22,376.401 868.57,500.879 870.921,365.874 873.271,188.557 875.622,544.402 877.972,615.34 880.323,398.591 882.673,352.902 885.024,475.257 887.374,474.767 889.725,471.613 892.075,317.846 894.426,472.392 896.776,349.345 899.126,234.935 901.477,337.565 903.827,444.536 906.178,533.839 908.528,623.721 910.879,367.427 913.229,276.096 915.58,516.625 917.93,605.704 920.281,374.163 922.631,367.59 924.982,493.019 927.332,431.254 929.683,473.295 932.033,390.041 934.384,362.175 936.734,443.375 939.084,256.729 941.435,700.239 943.785,419.039 946.136,413.092 948.486,505.876 950.837,381.471 953.187,244.804 955.538,508.728 957.888,263.786 960.239,651.63 962.589,433.025 964.94,459.071 967.29,418.644 969.641,351.376 971.991,360.401 974.342,536.834 976.692,449.057 979.043,485.771 981.393,281.239 983.743,482.387 986.094,438.181 988.444,365.287 990.795,330.575 993.145,206.251 995.496,460.71 997.846,407.538 1000.2,558.619 1002.55,323.236 1004.9,424.012 1007.25,425.836 1009.6,335.438 1011.95,439.307 1014.3,514.286 1016.65,616.049 1019,388.557 1021.35,576.706 1023.7,432.391 1026.05,277.448 1028.4,478.91 1030.75,416.828 1033.1,406.751 1035.45,309.504 1037.8,254.599 1040.15,329.688 1042.51,452.46 1044.86,430.528 1047.21,405.707 1049.56,282.577 1051.91,324.07 1054.26,491.495 1056.61,351.414 1058.96,460.238 1061.31,336.544 1063.66,272.35 1066.01,522.223 1068.36,321.838 1070.71,615.419 1073.06,548.413 1075.41,475.666 1077.76,393.741 1080.11,492.705 1082.46,388.768 1084.81,460.157 1087.16,508.918 1089.51,340.152 1091.87,411.644 1094.22,421.959 1096.57,503.368 1098.92,478.315 1101.27,316.189 1103.62,476.67 1105.97,464.124 1108.32,340.98 1110.67,363.792 1113.02,528.402 1115.37,475.083 1117.72,429.615 1120.07,225.05 1122.42,482.917 1124.77,270.92 1127.12,503.637 1129.47,360.69 1131.82,374.481 1134.17,238.647 1136.52,450.804 1138.87,619.958 1141.23,382.953 1143.58,522.192 1145.93,455.111 1148.28,380.96 1150.63,447.628 1152.98,398.755 1155.33,502.123 1157.68,424.534 1160.03,415.494 1162.38,566.286 1164.73,509.677 1167.08,284.631 1169.43,590.048 1171.78,305.952 1174.13,558.599 1176.48,532.036 1178.83,613.4 1181.18,477.179 1183.53,434.359 1185.88,243.843 1188.23,356.203 1190.59,398.444 1192.94,311.37 1195.29,278.27 1197.64,463.222 1199.99,551.546 1202.34,380.268 1204.69,383.412 1207.04,359.165 1209.39,269.428 1211.74,336.17 1214.09,437.304 1216.44,337.238 1218.79,438.317 1221.14,392.302 1223.49,237.095 1225.84,495.768 1228.19,323.281 1230.54,605.198 1232.89,324.856 1235.24,328.234 1237.59,580.923 1239.94,573.581 1242.3,298.931 1244.65,335.96 1247,384.453 1249.35,409.92 1251.7,372.791 1254.05,362.463 1256.4,326.001 1258.75,506.486 1261.1,377.197 1263.45,415.301 1265.8,456.52 1268.15,397.892 1270.5,345.931 1272.85,465.419 1275.2,574.095 1277.55,459.597 1279.9,459.543 1282.25,440.149 1284.6,456.877 1286.95,284.881 1289.3,179.048 1291.66,361.404 1294.01,514.065 1296.36,179.333 1298.71,360.155 1301.06,405.566 1303.41,333.232 1305.76,383.18 1308.11,428.831 1310.46,451.623 1312.81,412.05 1315.16,488.591 1317.51,238.745 1319.86,495.21 1322.21,424.915 1324.56,332.88 1326.91,459.593 1329.26,425.264 1331.61,370.967 1333.96,471.918 1336.31,166.907 1338.66,477.195 1341.02,449.277 1343.37,516.26 1345.72,541.866 1348.07,376.232 1350.42,261.925 1352.77,240.623 1355.12,314.549 1357.47,393.304 1359.82,225.874 1362.17,554.989 1364.52,457.528 1366.87,362.153 1369.22,373.009 1371.57,426.851 1373.92,158.617 1376.27,254.251 1378.62,438.47 1380.97,546.247 1383.32,479.066 1385.67,456.625 1388.02,353.8 1390.38,457.447 1392.73,615.1 1395.08,469.671 1397.43,268.464 1399.78,433.956 1402.13,306.194 1404.48,623.845 1406.83,339.215 1409.18,446.259 1411.53,520.29 1413.88,289.626 1416.23,309.361 1418.58,312.172 1420.93,512.979 1423.28,357.557 1425.63,497.325 1427.98,291.875 1430.33,311.727 1432.68,531.734 1435.03,534.995 1437.38,385.231 1439.74,489.393 1442.09,616.069 1444.44,542.021 1446.79,578.183 1449.14,376.969 1451.49,608.048 1453.84,286.062 1456.19,517.068 1458.54,250.823 1460.89,432.891 1463.24,402.858 1465.59,491.156 1467.94,555.095 1470.29,411.048 1472.64,452.654 1474.99,407.432 1477.34,504.331 1479.69,471.349 1482.04,474.925 1484.39,505.869 1486.74,349.194 1489.1,366.31 1491.45,439.536 1493.8,508.519 1496.15,274.695 1498.5,539.816 1500.85,644.977 1503.2,336.83 1505.55,469.722 1507.9,547.8 1510.25,364.454 1512.6,306.236 1514.95,580.648 1517.3,327.088 1519.65,577.896 1522,658.181 1524.35,544.854 1526.7,463.907 1529.05,485.926 1531.4,463.693 1533.75,405.425 1536.1,433.637 1538.45,276.474 1540.81,339.609 1543.16,400.363 1545.51,364.442 1547.86,449.877 1550.21,468.961 1552.56,357.049 1554.91,253.848 1557.26,218.855 1559.61,339.765 1561.96,380.224 1564.31,196.035 1566.66,497.533 1569.01,471.632 1571.36,350.011 1573.71,412.19 1576.06,392.126 1578.41,386.421 1580.76,456.232 1583.11,489.701 1585.46,494.194 1587.81,573.127 1590.17,464.312 1592.52,332.967 1594.87,358.565 1597.22,383.352 1599.57,288.222 1601.92,395.004 1604.27,563.463 1606.62,489.21 1608.97,439.711 1611.32,320.031 1613.67,414.576 1616.02,761.752 1618.37,594.57 1620.72,524.693 1623.07,164.931 1625.42,425.179 1627.77,459.751 1630.12,404.256 1632.47,379.967 1634.82,448.174 1637.17,449.979 1639.53,428.871 1641.88,402.573 1644.23,495.626 1646.58,261.907 1648.93,435.248 1651.28,416.283 1653.63,423.731 1655.98,424.512 1658.33,386.621 1660.68,408.51 1663.03,400.433 1665.38,445.856 1667.73,497.395 1670.08,432.629 1672.43,356.072 1674.78,601.921 1677.13,420.301 1679.48,357.941 1681.83,487.915 1684.18,352.397 1686.53,314.858 1688.89,368.778 1691.24,249.208 1693.59,633.251 1695.94,539.097 1698.29,458.081 1700.64,294.34 1702.99,379.538 1705.34,387.868 1707.69,284.9 1710.04,374.768 1712.39,458.655 1714.74,324.481 1717.09,550.096 1719.44,550.835 1721.79,433.473 1724.14,396.295 1726.49,431.986 1728.84,470.049 1731.19,386.583 1733.54,123.154 1735.89,453.465 1738.25,291.211 1740.6,561.461 1742.95,554.654 1745.3,462.583 1747.65,442.712 1750,436.035 1752.35,274.153 1754.7,403.512 1757.05,470.536 1759.4,325.687 1761.75,415.977 1764.1,501.208 1766.45,254.751 1768.8,484.492 1771.15,500.939 1773.5,447.905 1775.85,352.618 1778.2,497.586 1780.55,245.668 1782.9,420.525 1785.25,337.396 1787.6,619.504 1789.96,549.717 1792.31,397.546 1794.66,425.527 1797.01,277.693 1799.36,496.19 1801.71,339.381 1804.06,484.717 1806.41,398.759 1808.76,302.395 1811.11,338.575 1813.46,441.036 1815.81,415.5 1818.16,445.787 1820.51,649.893 1822.86,580.263 1825.21,465.946 1827.56,503.32 1829.91,403.366 1832.26,334.802 1834.61,345.34 1836.96,468.685 1839.32,377.151 1841.67,588.644 1844.02,512.618 1846.37,452.377 1848.72,323.761 1851.07,96.8724 1853.42,448.053 1855.77,362.481 1858.12,409.187 1860.47,316.911 1862.82,353.923 1865.17,507.022 1867.52,399.096 1869.87,585.856 1872.22,378.427 1874.57,239.444 1876.92,643.838 1879.27,428.119 1881.62,260.802 1883.97,508.542 1886.32,483.721 1888.68,383.546 1891.03,414.124 1893.38,407.756 1895.73,532.222 1898.08,258.226 1900.43,232.531 1902.78,523.109 1905.13,458.806 1907.48,594.685 1909.83,354.787 1912.18,402.163 1914.53,483.062 1916.88,489.379 1919.23,373.801 1921.58,522.646 1923.93,344.69 1926.28,484.651 1928.63,424.537 1930.98,586.898 1933.33,520.922 1935.68,367.921 1938.04,480.737 1940.39,349.402 1942.74,488.427 1945.09,515.989 1947.44,393.664 1949.79,438.342 1952.14,382.943 1954.49,453.352 1956.84,415.526 1959.19,421.126 1961.54,455.475 1963.89,399.419 1966.24,472.806 1968.59,412.352 1970.94,357.732 1973.29,274.939 1975.64,511.476 1977.99,218.75 1980.34,347.499 1982.69,422.101 1985.04,308.579 1987.4,288.162 1989.75,633.204 1992.1,490.059 1994.45,521.716 1996.8,210.21 1999.15,299.717 2001.5,541.151 2003.85,482.318 2006.2,468.471 2008.55,571.161 2010.9,475.252 2013.25,438.396 2015.6,293.141 2017.95,439.86 2020.3,352.588 2022.65,389.161 2025,583.938 2027.35,584.786 2029.7,416.925 2032.05,522.33 2034.4,375.066 2036.76,474.752 2039.11,458.685 2041.46,577.033 2043.81,513.859 2046.16,462.937 2048.51,402.933 2050.86,372.202 2053.21,477.49 2055.56,472.322 2057.91,335.76 2060.26,519.918 2062.61,473.004 2064.96,507.318 2067.31,486.712 2069.66,467.575 2072.01,459.115 2074.36,522.33 2076.71,528.841 2079.06,499.12 2081.41,477.306 2083.76,428.363 2086.11,478.428 2088.47,358.403 2090.82,547.006 2093.17,494.227 2095.52,428.886 2097.87,309.336 2100.22,491.681 2102.57,278.971 2104.92,447.801 2107.27,359.665 2109.62,463.573 2111.97,375.694 2114.32,326.688 2116.67,491.634 2119.02,297.085 2121.37,388.632 2123.72,366.855 2126.07,495.681 2128.42,529.118 2130.77,575.275 2133.12,477.228 2135.47,305.743 2137.83,401.379 2140.18,406.687 2142.53,263.6 2144.88,445.145 2147.23,356.619 2149.58,191.865 2151.93,445.552 2154.28,525.827 2156.63,520.749 2158.98,324.68 2161.33,382.516 2163.68,372.348 2166.03,434.234 2168.38,482.007 2170.73,579.127 2173.08,317.642 2175.43,387.415 2177.78,437.844 2180.13,535.722 2182.48,342.913 2184.83,511.879 2187.19,521.184 2189.54,503.462 2191.89,533.791 2194.24,481.156 2196.59,372.164 2198.94,423.555 2201.29,618.694 2203.64,394.564 2205.99,549.871 2208.34,404.685 2210.69,294.849 2213.04,320.578 2215.39,583.459 2217.74,335.298 2220.09,309.639 2222.44,496.498 2224.79,356.499 2227.14,257.834 2229.49,339.669 2231.84,382.702 2234.19,336.034 2236.55,264.063 2238.9,347.806 2241.25,325.859 2243.6,460.882 2245.95,311.25 2248.3,513.431 2250.65,297.686 2253,427.607 2255.35,405.683 2257.7,390.353 2260.05,426.853 2262.4,614.619 2264.75,324.702 2267.1,481.683 2269.45,474.054 2271.8,272.217 2274.15,394.919 2276.5,478.179 2278.85,335.119 2281.2,419.992 2283.55,496.894 2285.91,340.549 2288.26,175.569 2290.61,441.13 2292.96,479.797 2295.31,385.001 2297.66,545.547 2300.01,546.218 2302.36,326.383 2304.71,511.237 2307.06,490.873 2309.41,411.005 2311.76,351.356 2314.11,333.527 2316.46,460.053 2318.81,423.025 2321.16,437.52 2323.51,527.785 2325.86,407.687 2328.21,504.226 2330.56,438.677 2332.91,537.236 2335.27,266.451 2337.62,349.397 2339.97,474.378 2342.32,422.624 2344.67,220.869 2347.02,385.627 2349.37,335.231 2351.72,535.5 2354.07,563.504 2356.42,426.471 2358.77,279.994 2361.12,411.401 2363.47,380.388 2365.82,386.335 2368.17,310.486 2370.52,608.482 2372.87,260.245 2375.22,383.465 2377.57,422.807 2379.92,325.869 2382.27,308.753 2384.62,493.874 2386.98,452.015 2389.33,481.246 2391.68,245.329 2394.03,289.369 2396.38,415.426 2398.73,547.511 2401.08,385.161 2403.43,361.645 2405.78,519.034 2408.13,295.025 2410.48,414.095 2412.83,519.215 2415.18,468.37 2417.53,413.988 2419.88,499.169 2422.23,244.355 2424.58,446.201 2426.93,446.788 2429.28,466.548 2431.63,429.612 2433.98,358.523 2436.34,406.159 2438.69,462.651 2441.04,380.738 2443.39,468.013 2445.74,308.687 2448.09,519.248 2450.44,469.439 2452.79,468.616 2455.14,495.34 2457.49,364.071 2459.84,428.726 2462.19,463.96 2464.54,466.767 2466.89,361.418 2469.24,361.053 2471.59,668.718 2473.94,550.975 2476.29,328.791 2478.64,350.726 2480.99,292.48 2483.34,350.612 2485.7,361.218 2488.05,231.947 2490.4,535.923 2492.75,233.705 2495.1,265.185 2497.45,541.027 2499.8,360.127 2502.15,613.689 2504.5,491.985 2506.85,461.318 2509.2,368.108 2511.55,488.161 2513.9,419.952 2516.25,552.202 2518.6,495.977 2520.95,486.239 2523.3,396.651 2525.65,426.009 2528,526.419 2530.35,312.723 2532.7,448.144 2535.06,431.266 2537.41,475.154 2539.76,313.126 2542.11,376.687 2544.46,418.922 2546.81,235.45 2549.16,283.153 2551.51,342.832 2553.86,508.587 2556.21,446.743 2558.56,255.84 2560.91,464.027 2563.26,457.605 2565.61,418.174 2567.96,444.094 2570.31,630.353 "></polyline>
</svg>
</div>
</div>
<p>Look at that! Things are working; amazin’.</p>
<p>We can also exploit <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>’s parallel sampling capabilities:</p>
<div id="34" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run separate 4 chains for 10 000 iterations using threads to parallelize.</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>num_chains <span class="op">=</span> <span class="fl">4</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    model_with_grad,</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">MCMCThreads</span>(),</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>,</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    num_chains;</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Note we need to provide an initial state for every chain.</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>    initial_state<span class="op">=</span><span class="fu">fill</span>(state, num_chains),</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>samples_array <span class="op">=</span> <span class="fu">stack</span>(<span class="fu">map</span>(<span class="bu">Base</span>.<span class="fu">Fix1</span>(stack, sample <span class="op">-&gt;</span> sample.x), samples))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000×4 Array{Float64, 3}:
[:, :, 1] =
 -2.53571  -5.4447    -6.67177   -6.90638  …  -3.79226  -5.35129   -3.57936
 -1.6421   -0.757473  -0.682086  -1.28314      2.73909   0.577763  -0.1053
  2.66737   5.69093    4.58673    4.3521       3.77719   1.42058    2.49052

[:, :, 2] =
 -3.54685  -5.4636     -5.72042  -5.21998  …  -4.12257   -5.71291  -5.27919
 -1.49056   0.0697048   1.22696   1.70166      0.374125   1.45189   1.93229
  3.40104   2.59587     4.36663   4.80899      7.30595    6.76689   5.562

[:, :, 3] =
 -2.46851   -4.50261  -3.9237   -3.9237   …  -4.49355  -5.62282    -4.93568
 -0.525665  -0.62861   0.88653   0.88653     -1.27511  -0.0419501  -0.634974
  2.00986    4.01974   3.75631   3.75631      3.82116   4.16489     4.10189

[:, :, 4] =
 -2.65191   -3.62556   -4.57914   -5.53108  …  -4.31076  -4.47297   -4.75283
 -0.754193  -0.749641  -0.935661  -0.3628       1.10186   0.546879   0.871544
  1.48592    4.26182    3.35562    2.76892      5.34619   5.53535    6.39131</code></pre>
</div>
</div>
<p>But the fact that we have to provide the <code>AbstractMCMC.sample</code> call, etc. with an <code>initial_state</code> to get started is a bit annoying. We can avoid this by also defining a <code>AbstractMCMC.step</code> <em>without</em> the <code>state</code> argument:</p>
<div id="36" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">::</span><span class="dt">MALA</span>;</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># </span><span class="al">NOTE</span><span class="co">: No state provided!</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just create the initial state by sampling using  a Gaussian.</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="fu">randn</span>(rng, LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(x), <span class="fu">MALAState</span>(x)</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Equipped with this, we no longer need to provide the <code>initial_state</code> everywhere:</p>
<div id="38" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -4.99907     1.00489
 -0.00916041  0.983256
  4.99492     0.984933</code></pre>
</div>
</div>
</section>
<section id="using-our-sampler-with-turing.jl" class="level2">
<h2 class="anchored" data-anchor-id="using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</h2>
<p>As we promised, all of this hassle of implementing our <code>MALA</code> sampler in a way that uses <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> and <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> gets us something more than <em>just</em> an “automatic” implementation of <code>AbstractMCMC.sample</code>.</p>
<p>It also enables use with Turing.jl through the <code>externalsampler</code>, but we need to do one final thing first: we need to tell Turing.jl how to extract a vector of parameters from the “sample” returned in our implementation of <code>AbstractMCMC.step</code>. In our case, the “sample” is a <code>MALASample</code>, so we just need the following line:</p>
<div id="40" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load Turing.jl.</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Turing</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Overload the `getparams` method for our "sample" type, which is just a vector.</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>Turing.Inference.<span class="fu">getparams</span>(<span class="op">::</span><span class="dt">Turing.Model</span>, sample<span class="op">::</span><span class="dt">MALASample</span>) <span class="op">=</span> sample.x</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And with that, we’re good to go!</p>
<div id="42" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Our previous model defined as a Turing.jl model.</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">mvnormal_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">MvNormal</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.], I)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate our model.</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">mvnormal_model</span>()</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Call `sample` but now we're passing in a Turing.jl `model` and wrapping</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co"># our `MALA` sampler in the `externalsampler` to tell Turing.jl that the sampler</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co"># expects something that implements LogDensityProblems.jl.</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×4×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 2.47 seconds
Compute duration  = 2.47 seconds
parameters        = x[1], x[2], x[3]
internals         = lp

Summary Statistics
  parameters      mean       std      mcse    ess_bulk    ess_tail      rhat   ⋯
      Symbol   Float64   Float64   Float64     Float64     Float64   Float64   ⋯

        x[1]   -5.0014    1.0016    0.0175   3297.0617   4798.9580    0.9999   ⋯
        x[2]    0.0174    0.9979    0.0170   3462.1318   4913.1050    1.0003   ⋯
        x[3]    4.9845    1.0077    0.0182   3074.0257   5477.3212    1.0000   ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

        x[1]   -6.9626   -5.6835   -4.9860   -4.3204   -3.0595
        x[2]   -1.9118   -0.6631    0.0162    0.6808    1.9887
        x[3]    3.0156    4.2939    4.9830    5.6620    6.9665</code></pre>
</div>
</div>
<p>Pretty neat, eh?</p>
<section id="models-with-constrained-parameters" class="level3">
<h3 class="anchored" data-anchor-id="models-with-constrained-parameters">Models with constrained parameters</h3>
<p>One thing we’ve sort of glossed over in all of the above is that MALA, at least how we’ve implemented it, requires <span class="math inline">\(x\)</span> to live in <span class="math inline">\(\mathbb{R}^d\)</span> for some <span class="math inline">\(d &gt; 0\)</span>. If some of the parameters were in fact constrained, e.g.&nbsp;we were working with a <code>Beta</code> distribution which has support on the interval <span class="math inline">\((0, 1)\)</span>, <em>not</em> on <span class="math inline">\(\mathbb{R}^d\)</span>, we could easily end up outside of the valid range <span class="math inline">\((0, 1)\)</span>.</p>
<div id="44" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">beta_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">beta_model</span>()</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 1.44 seconds
Compute duration  = 1.44 seconds
parameters        = x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse    ess_bulk    ess_tail      rhat   ⋯
      Symbol   Float64   Float64   Float64     Float64     Float64   Float64   ⋯

           x    0.5015    0.1873    0.0027   4663.5194   6165.3120    0.9999   ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

           x    0.1508    0.3652    0.5025    0.6388    0.8487</code></pre>
</div>
</div>
<p>Yep, that still works, but only because Turing.jl actually <em>transforms</em> the <code>turing_model</code> from constrained to unconstrained, so that the <code>sampler</code> provided to <code>externalsampler</code> is actually always working in unconstrained space! This is not always desirable, so we can turn this off:</p>
<div id="46" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 0.23 seconds
Compute duration  = 0.23 seconds
parameters        = x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse   ess_bulk   ess_tail      rhat   e ⋯
      Symbol   Float64   Float64   Float64    Float64    Float64   Float64     ⋯

           x    0.5024    0.1663    0.0111   163.9393    93.5894    1.0029     ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

           x    0.2559    0.3865    0.5039    0.6171    0.7496</code></pre>
</div>
</div>
<p>The fun thing is that this still sort of works because</p>
<div id="48" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">logpdf</span>(<span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>), <span class="fl">10.0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-Inf</code></pre>
</div>
</div>
<p>and so the samples that fall outside of the range are always rejected. But do notice how much worse all the diagnostics are, e.g.&nbsp;<code>ess_tail</code> is very poor compared to when we use <code>unconstrained=true</code>. Moreover, in more complex cases this won’t just result in a “nice” <code>-Inf</code> log-density value, but instead will error:</p>
<div id="50" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="kw">function</span> <span class="fu">demo</span>()</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>    σ² <span class="op">~</span> <span class="fu">truncated</span>(<span class="fu">Normal</span>(), lower<span class="op">=</span><span class="fl">0</span>)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If we end up with negative values for `σ²`, the `Normal` will error.</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>    x <span class="op">~</span> <span class="fu">Normal</span>(<span class="fl">0</span>, σ²)</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>DomainError: DomainError(Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}}(-1.8078729807126317,1.0,0.0), "Normal: the condition σ &gt;= zero(σ) is not satisfied.")
DomainError with Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}}(-1.8078729807126317,1.0,0.0):
Normal: the condition σ &gt;= zero(σ) is not satisfied.
Stacktrace:
  [1] #371
    @ ~/.julia/packages/Distributions/nmUhn/src/univariate/continuous/normal.jl:37 [inlined]
  [2] check_args
    @ ~/.julia/packages/Distributions/nmUhn/src/utils.jl:89 [inlined]
  [3] #Normal#370
    @ ~/.julia/packages/Distributions/nmUhn/src/univariate/continuous/normal.jl:37 [inlined]
  [4] Normal
    @ ~/.julia/packages/Distributions/nmUhn/src/univariate/continuous/normal.jl:36 [inlined]
  [5] Normal
    @ ~/.julia/packages/Distributions/nmUhn/src/univariate/continuous/normal.jl:42 [inlined]
  [6] macro expansion
    @ ~/.julia/packages/DynamicPPL/MjWTB/src/compiler.jl:579 [inlined]
  [7] demo(__model__::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, __varinfo__::DynamicPPL.ThreadSafeVarInfo{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}, Vector{Set{DynamicPPL.Selector}}}}, ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}, Vector{Base.RefValue{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}, __context__::DynamicPPL.DefaultContext)
    @ Main.Notebook ~/work/docs/docs/tutorials/docs-17-implementing-samplers/index.qmd:592
  [8] _evaluate!!
    @ ~/.julia/packages/DynamicPPL/MjWTB/src/model.jl:973 [inlined]
  [9] evaluate_threadsafe!!(model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, varinfo::DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}, Vector{Set{DynamicPPL.Selector}}}}, ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}, context::DynamicPPL.DefaultContext)
    @ DynamicPPL ~/.julia/packages/DynamicPPL/MjWTB/src/model.jl:962
 [10] evaluate!!
    @ ~/.julia/packages/DynamicPPL/MjWTB/src/model.jl:892 [inlined]
 [11] logdensity
    @ ~/.julia/packages/DynamicPPL/MjWTB/src/logdensityfunction.jl:140 [inlined]
 [12] Fix1
    @ ./operators.jl:1118 [inlined]
 [13] vector_mode_dual_eval!(f::Base.Fix1{typeof(LogDensityProblems.logdensity), LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, Nothing}}, cfg::ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}, x::Vector{Float64})
    @ ForwardDiff ~/.julia/packages/ForwardDiff/PcZ48/src/apiutils.jl:24
 [14] vector_mode_gradient!(result::DiffResults.MutableDiffResult{1, Float64, Tuple{Vector{Float64}}}, f::Base.Fix1{typeof(LogDensityProblems.logdensity), LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, Nothing}}, x::Vector{Float64}, cfg::ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}})
    @ ForwardDiff ~/.julia/packages/ForwardDiff/PcZ48/src/gradient.jl:96
 [15] gradient!
    @ ~/.julia/packages/ForwardDiff/PcZ48/src/gradient.jl:37 [inlined]
 [16] gradient!
    @ ~/.julia/packages/ForwardDiff/PcZ48/src/gradient.jl:35 [inlined]
 [17] logdensity_and_gradient
    @ ~/.julia/packages/LogDensityProblemsAD/rBlLq/ext/LogDensityProblemsADForwardDiffExt.jl:118 [inlined]
 [18] leapfrog_step(model::LogDensityProblemsADForwardDiffExt.ForwardDiffLogDensity{LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, Nothing}, ForwardDiff.Chunk{2}, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}, x::Vector{Float64}, p::Vector{Float64}, ϵ::Int64, M::UniformScaling{Bool})
    @ Main.Notebook ~/work/docs/docs/tutorials/docs-17-implementing-samplers/index.qmd:369
 [19] step(rng::TaskLocalRNG, model_wrapper::AbstractMCMC.LogDensityModel{LogDensityProblemsADForwardDiffExt.ForwardDiffLogDensity{LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, Nothing}, ForwardDiff.Chunk{2}, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}}, sampler::MALA{Int64, UniformScaling{Bool}}, state::MALAState{Vector{Float64}}; kwargs::@Kwargs{})
    @ Main.Notebook ~/work/docs/docs/tutorials/docs-17-implementing-samplers/index.qmd:334
 [20] step
    @ ~/work/docs/docs/tutorials/docs-17-implementing-samplers/index.qmd:316 [inlined]
 [21] #step#107
    @ ~/.julia/packages/Turing/Bv30p/src/mcmc/abstractmcmc.jl:155 [inlined]
 [22] step(rng::TaskLocalRNG, model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, sampler_wrapper::DynamicPPL.Sampler{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}, state::Turing.Inference.TuringState{MALAState{Vector{Float64}}, LogDensityProblemsADForwardDiffExt.ForwardDiffLogDensity{LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, Nothing}, ForwardDiff.Chunk{2}, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}})
    @ Turing.Inference ~/.julia/packages/Turing/Bv30p/src/mcmc/abstractmcmc.jl:144
 [23] macro expansion
    @ ~/.julia/packages/AbstractMCMC/YrmkI/src/sample.jl:176 [inlined]
 [24] macro expansion
    @ ~/.julia/packages/AbstractMCMC/YrmkI/src/logging.jl:16 [inlined]
 [25] mcmcsample(rng::TaskLocalRNG, model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, sampler::DynamicPPL.Sampler{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}, N::Int64; progress::Bool, progressname::String, callback::Nothing, discard_initial::Int64, thinning::Int64, chain_type::Type, initial_state::Nothing, kwargs::@Kwargs{})
    @ AbstractMCMC ~/.julia/packages/AbstractMCMC/YrmkI/src/sample.jl:120
 [26] sample(rng::TaskLocalRNG, model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, sampler::DynamicPPL.Sampler{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}, N::Int64; chain_type::Type, resume_from::Nothing, initial_state::Nothing, kwargs::@Kwargs{progress::Bool})
    @ DynamicPPL ~/.julia/packages/DynamicPPL/MjWTB/src/sampler.jl:93
 [27] sample
    @ ~/.julia/packages/DynamicPPL/MjWTB/src/sampler.jl:83 [inlined]
 [28] #sample#4
    @ ~/.julia/packages/Turing/Bv30p/src/mcmc/Inference.jl:276 [inlined]
 [29] sample
    @ ~/.julia/packages/Turing/Bv30p/src/mcmc/Inference.jl:267 [inlined]
 [30] #sample#3
    @ ~/.julia/packages/Turing/Bv30p/src/mcmc/Inference.jl:264 [inlined]
 [31] top-level scope
    @ ~/work/docs/docs/tutorials/docs-17-implementing-samplers/index.qmd:594</code></pre>
</div>
</div>
<p>As expected, we run into a <code>DomainError</code> at some point, while if we set <code>unconstrained=true</code>, letting Turing.jl transform the model to a unconstrained form behind the scenes, everything works as expected:</p>
<div id="52" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 0.54 seconds
Compute duration  = 0.54 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse   ess_bulk   ess_tail      rhat   e ⋯
      Symbol   Float64   Float64   Float64    Float64    Float64   Float64     ⋯

          σ²    0.8458    0.5546    0.0208   510.4603   237.2483    1.0005     ⋯
           x   -0.0276    0.9302    0.0437   509.9872   223.8076    1.0025     ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

          σ²    0.1225    0.4062    0.7309    1.1908    2.2294
           x   -1.9851   -0.4414   -0.0018    0.3753    2.0025</code></pre>
</div>
</div>
<p>Neat!</p>
<p>Similarly, which automatic differentiation backend one should use can be specified through the <code>adtype</code> keyword argument too. For example, if we want to use <a href="https://github.com/JuliaDiff/ReverseDiff.jl">ReverseDiff.jl</a> instead of the default <a href="https://github.com/JuliaDiff/ForwardDiff.jl">ForwardDiff.jl</a>:</p>
<div id="54" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">ReverseDiff</span>: ReverseDiff</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify that we want to use `AutoReverseDiff`.</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">demo</span>(),</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>, adtype<span class="op">=</span><span class="fu">AutoReverseDiff</span>()),</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>;</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 3.03 seconds
Compute duration  = 3.03 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse   ess_bulk   ess_tail      rhat   e ⋯
      Symbol   Float64   Float64   Float64    Float64    Float64   Float64     ⋯

          σ²    0.8020    0.6100    0.0523    90.0723    32.1377    1.0300     ⋯
           x    0.0183    0.8389    0.0353   769.8787   623.1839    1.0182     ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

          σ²    0.0614    0.3075    0.6878    1.1686    2.2974
           x   -1.9061   -0.3181   -0.0114    0.3569    1.8659</code></pre>
</div>
</div>
<p>Double-neat.</p>
</section>
</section>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<p>At this point it’s worth maybe reminding ourselves what we did and also <em>why</em> we did it:</p>
<ol type="1">
<li>We define our models in the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface because it makes the sampler agnostic to how the underlying model is implemented.</li>
<li>We implement our sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> interface, which just means that our sampler is a subtype of <code>AbstractMCMC.AbstractSampler</code> and we implement the MCMC transition in <code>AbstractMCMC.step</code>.</li>
<li>Points 1 and 2 makes it so our sampler can be used with a wide range of model implementations, amongst them being models implemented in both Turing.jl and Stan. This gives you, the inference implementer, a large collection of models to test your inference method on, in addition to allowing users of Turing.jl and Stan to try out your inference method with minimal effort.</li>
</ol>


</section>


<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a><div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>We’re going with the leapfrog formulation because in a future version of this tutorial we’ll add a section extending this simple “baseline” MALA sampler to more complex versions. See <a href="https://github.com/TuringLang/docs/issues/479">issue #479</a> for progress on this.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>There is no such thing as a proper interface in Julia (at least not officially), and so we use the word “interface” here to mean a few minimal methods that needs to be implemented by any type that we treat as a target model.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/turinglang\.org\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../tutorials/docs-07-for-developers-variational-inference/index.html" class="pagination-link" aria-label="Variational Inference">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Variational Inference</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Turing is created by <a href="http://mlg.eng.cam.ac.uk/hong/" target="_blank">Hong Ge</a>, and lovingly maintained by the <a href="https://github.com/TuringLang/Turing.jl/graphs/contributors" target="_blank">core team</a> of volunteers. <br> The contents of this website are © 2024 under the terms of the <a href="https://github.com/TuringLang/Turing.jl/blob/master/LICENCE" target="_blank">MIT License</a>.</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/TuringLang/docs/edit/master/tutorials/docs-17-implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/docs/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://x.com/TuringLang">
      <i class="bi bi-twitter" role="img" aria-label="Turing Twitter">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/TuringLang/Turing.jl">
      <i class="bi bi-github" role="img" aria-label="Turing GitHub">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




<script src="../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>