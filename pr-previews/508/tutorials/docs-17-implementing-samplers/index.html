<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Implementing samplers – Turing.jl</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../tutorials/docs-07-for-developers-variational-inference/index.html" rel="prev">
<link href="../../assets/favicon.ico" rel="icon">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<style>
  a {
    text-decoration: none;
  }
  a:hover {
    text-decoration: underline;
  }
</style>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../theming/styles.css">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="https://turinglang.org/" class="navbar-brand navbar-brand-logo">
    <img src="../../assets/images/turing-logo.svg" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="https://turinglang.org/">
    <span class="navbar-title">Turing.jl</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../tutorials/docs-00-getting-started/"> 
<span class="menu-text">Get Started</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../tutorials/00-introduction/"> 
<span class="menu-text">Tutorials</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/library/"> 
<span class="menu-text">Libraries</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/news/"> 
<span class="menu-text">News</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/team/"> 
<span class="menu-text">Team</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-v0.34" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">v0.34</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-v0.34">    
        <li>
    <a class="dropdown-item" href="https://turinglang.org/docs/changelog.html">
 <span class="dropdown-text">Changelog</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://turinglang.org/docs/versions.html">
 <span class="dropdown-text">All Versions</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools tools-wide">
    <a href="https://x.com/TuringLang" title="Turing Twitter" class="quarto-navigation-tool px-1" aria-label="Turing Twitter"><i class="bi bi-twitter"></i></a>
    <a href="https://github.com/TuringLang/Turing.jl" title="Turing GitHub" class="quarto-navigation-tool px-1" aria-label="Turing GitHub"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Developers</li><li class="breadcrumb-item"><a href="../../tutorials/docs-06-for-developers-interface/index.html">Inference (note: outdated)</a></li><li class="breadcrumb-item"><a href="../../tutorials/docs-17-implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false">
 <span class="menu-text">Users</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-00-getting-started/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Getting Started</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-12-using-turing-guide/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Core Functionality</span></a>
  </div>
</li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false">
 <span class="menu-text">Usage Tips</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-10-using-turing-autodiff/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Automatic Differentiation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/usage-custom-distribution/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Custom Distributions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/usage-modifying-logprob/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Modifying the Log Probability</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/usage-generated-quantities/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Generated Quantities</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-17-mode-estimation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Mode Estimation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-13-using-turing-performance-tips/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Performance Tips</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-15-using-turing-sampler-viz/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Sampler Visualization</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-11-using-turing-dynamichmc/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using DynamicHMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-16-using-turing-external-samplers/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using External Samplers</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false">
 <span class="menu-text">Tutorials</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/00-introduction/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction: Coin Flipping</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/01-gaussian-mixture-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Mixture Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/02-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/03-bayesian-neural-network/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Neural Networks</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/04-hidden-markov-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Hidden Markov Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/05-linear-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Linear Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/06-infinite-mixture-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Infinite Mixture Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/07-poisson-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Poisson Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/08-multinomial-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Multinomial Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/09-variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/10-bayesian-differential-equations/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Differential Equations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/11-probabilistic-pca/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Probabilistic PCA</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/13-seasonal-time-series/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Time Series Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/15-gaussian-processes/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction to Gaussian Processes</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/12-gplvm/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Process Latent Variable Models</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Developers</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false">
 <span class="menu-text">Contributing</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-01-contributing-guide/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">How to Contribute</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="false">
 <span class="menu-text">DynamicPPL in Depth</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/dev-model-manual/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Manually Defining a Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-05-for-developers-compiler/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Turing Compiler Design</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/14-minituring/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation I: Compiler</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/16-contexts/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation II: Contexts</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true">
 <span class="menu-text">Inference (note: outdated)</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-06-for-developers-interface/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Interface Guide</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-04-for-developers-abstractmcmc-turing/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">How Turing implements AbstractMCMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-07-for-developers-variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-17-implementing-samplers/index.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Implementing Samplers</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of Contents</h2>
   
  <ul>
  <li><a href="#quick-overview-of-mala" id="toc-quick-overview-of-mala" class="nav-link active" data-scroll-target="#quick-overview-of-mala">Quick overview of MALA</a></li>
  <li><a href="#what-we-need-from-a-model-logdensityproblems.jl" id="toc-what-we-need-from-a-model-logdensityproblems.jl" class="nav-link" data-scroll-target="#what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: LogDensityProblems.jl</a></li>
  <li><a href="#implementing-mala-in-abstractmcmc.jl" id="toc-implementing-mala-in-abstractmcmc.jl" class="nav-link" data-scroll-target="#implementing-mala-in-abstractmcmc.jl">Implementing MALA in AbstractMCMC.jl</a></li>
  <li><a href="#using-our-sampler-with-turing.jl" id="toc-using-our-sampler-with-turing.jl" class="nav-link" data-scroll-target="#using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</a>
  <ul class="collapse">
  <li><a href="#models-with-constrained-parameters" id="toc-models-with-constrained-parameters" class="nav-link" data-scroll-target="#models-with-constrained-parameters">Models with constrained parameters</a></li>
  </ul></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/TuringLang/docs/edit/master/tutorials/docs-17-implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/docs/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Developers</li><li class="breadcrumb-item"><a href="../../tutorials/docs-06-for-developers-interface/index.html">Inference (note: outdated)</a></li><li class="breadcrumb-item"><a href="../../tutorials/docs-17-implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Implementing samplers</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>In this tutorial, we’ll go through step-by-step how to implement a “simple” sampler in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> in such a way that it can be easily applied to Turing.jl models.</p>
<p>In particular, we’re going to implement a version of <strong>Metropolis-adjusted Langevin (MALA)</strong>.</p>
<p>Note that we will implement this sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> framework, completely “ignoring” Turing.jl until the very end of the tutorial, at which point we’ll use a single line of code to make the resulting sampler available to Turing.jl. This is to really drive home the point that one can implement samplers in a way that is accessible to all of Turing.jl’s users without having to use Turing.jl yourself.</p>
<section id="quick-overview-of-mala" class="level2">
<h2 class="anchored" data-anchor-id="quick-overview-of-mala">Quick overview of MALA</h2>
<p>We can view MALA as a single step of the leapfrog intergrator with resampling of momentum <span class="math inline">\(p\)</span> at every step.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> To make that statement a bit more concrete, we first define the <em>extended</em> target <span class="math inline">\(\bar{\gamma}(x, p)\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\log \bar{\gamma}(x, p) \propto \log \gamma(x) + \log \gamma_{\mathcal{N}(0, M)}(p)
\end{equation*}\]</span></p>
<p>where <span class="math inline">\(\gamma_{\mathcal{N}(0, M)}\)</span> denotes the density for a zero-centered Gaussian with covariance matrix <span class="math inline">\(M\)</span>. We then consider targeting this joint distribution over both <span class="math inline">\(x\)</span> and <span class="math inline">\(p\)</span> as follows. First we define the map</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  L_{\epsilon}: \quad &amp; \mathbb{R}^d \times \mathbb{R}^d \to \mathbb{R}^d \times \mathbb{R}^d \\
  &amp; (x, p) \mapsto (\tilde{x}, \tilde{p}) := L_{\epsilon}(x, p)
\end{split}
\end{equation*}\]</span></p>
<p>as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p_{1 / 2} &amp;:= p + \frac{\epsilon}{2} \nabla \log \gamma(x) \\
  \tilde{x} &amp;:= x + \epsilon M^{-1} p_{1 /2 } \\
  p_1 &amp;:= p_{1 / 2} + \frac{\epsilon}{2} \nabla \log \gamma(\tilde{x}) \\
  \tilde{p} &amp;:= - p_1
\end{split}
\end{equation*}\]</span></p>
<p>This might be familiar for some readers as a single step of the Leapfrog integrator. We then define the MALA kernel as follows: given the current iterate <span class="math inline">\(x_i\)</span>, we sample the next iterate <span class="math inline">\(x_{i + 1}\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p &amp;\sim \mathcal{N}(0, M) \\
  (\tilde{x}, \tilde{p}) &amp;:= L_{\epsilon}(x_i, p) \\
  \alpha &amp;:= \min \left\{ 1, \frac{\bar{\gamma}(\tilde{x}, \tilde{p})}{\bar{\gamma}(x_i, p)} \right\} \\
  x_{i + 1} &amp;:=
  \begin{cases}
    \tilde{x} \quad &amp; \text{ with prob. } \alpha \\
    x_i       \quad &amp; \text{ with prob. } 1 - \alpha
  \end{cases}
\end{split}
\end{equation*}\]</span></p>
<p>i.e.&nbsp;we accept the proposal <span class="math inline">\(\tilde{x}\)</span> with probability <span class="math inline">\(\alpha\)</span> and reject it, thus sticking with our current iterate, with probability <span class="math inline">\(1 - \alpha\)</span>.</p>
</section>
<section id="what-we-need-from-a-model-logdensityproblems.jl" class="level2">
<h2 class="anchored" data-anchor-id="what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a></h2>
<p>There are a few things we need from the “target” / “model” / density that we want to sample from:</p>
<ol type="1">
<li>We need access to log-density <em>evaluations</em> <span class="math inline">\(\log \gamma(x)\)</span> so we can compute the acceptance ratio involving <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>We need access to log-density <em>gradients</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span> so we can compute the Leapfrog steps <span class="math inline">\(L_{\epsilon}(x, p)\)</span>.</li>
<li>We also need access to the “size” of the model so we can determine the size of <span class="math inline">\(M\)</span>.</li>
</ol>
<p>Luckily for us, there is a package called <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> which provides an interface for <em>exactly</em> this!</p>
<p>To demonstrate how one can implement the “<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface”<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> we will use a simple Gaussian model as an example:</p>
<div id="4" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblems</span>: LogDensityProblems;</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's define some type that represents the model.</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> IsotropicNormalModel{M<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"mean of the isotropic Gaussian"</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    mean<span class="op">::</span><span class="dt">M</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Specifies what input length the model expects.</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">dimension</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> <span class="fu">length</span>(model.mean)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Implementation of the log-density evaluation of the model.</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x<span class="op">::</span><span class="dt">AbstractVector{&lt;:Real}</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">-</span> <span class="fu">sum</span>(abs2, x <span class="op">.-</span> model.mean) <span class="op">/</span> <span class="fl">2</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This gives us all of the properties we want for our MALA sampler with the exception of the computation of the <em>gradient</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span>. There is the method <code>LogDensityProblems.logdensity_and_gradient</code> which should return a 2-tuple where the first entry is the evaluation of the logdensity <span class="math inline">\(\log \gamma(x)\)</span> and the second entry is the gradient <span class="math inline">\(\nabla \log \gamma(x)\)</span>.</p>
<p>There are two ways to “implement” this method: 1) we implement it by hand, which is feasible in the case of our <code>IsotropicNormalModel</code>, or b) we defer the implementation of this to a automatic differentiation backend.</p>
<p>To implement it by hand we can simply do</p>
<div id="6" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl that first-order, i.e. gradient information, is available.</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{1}</span>()</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Implement `logdensity_and_gradient`.</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    logγ_x <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="op">-</span>x <span class="op">.*</span> (x <span class="op">-</span> model.mean)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> logγ_x, ∇logγ_x</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s just try it out:</p>
<div id="8" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate the problem.</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> <span class="fu">IsotropicNormalModel</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.])</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create some example input that we can test on.</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>x_example <span class="op">=</span> <span class="fu">randn</span>(LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate!</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-34.16199327315394</code></pre>
</div>
</div>
<p>To defer it to an automatic differentiation backend, we can do</p>
<div id="10" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl we only have access to 0-th order information.</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{0}</span>()</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Use `LogDensityProblemsAD`'s `ADgradient` in combination with some AD backend to implement `logdensity_and_gradient`.</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblemsAD</span>, <span class="bu">ADTypes</span>, <span class="bu">ForwardDiff</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>model_with_grad <span class="op">=</span> <span class="fu">ADgradient</span>(<span class="fu">AutoForwardDiff</span>(), model)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model_with_grad, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-34.16199327315394</code></pre>
</div>
</div>
<p>We’ll continue with the second approach in this tutorial since this is typically what one does in practice, because there are better hobbies to spend time on than deriving gradients by hand.</p>
<p>At this point, one might wonder how we’re going to tie this back to Turing.jl in the end. Effectively, when working with inference methods that only require log-density evaluations and / or higher-order information of the log-density, Turing.jl actually converts the user-provided <code>Model</code> into an object implementing the above methods for <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>. As a result, most samplers provided by Turing.jl are actually implemented to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, enabling their use both <em>within</em> Turing.jl and <em>outside</em> of Turing.jl! Morever, there exists similar conversions for Stan through BridgeStan and Stan<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, which means that a sampler supporting the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface can easily be used on both Turing.jl <em>and</em> Stan models (in addition to user-provided models, as our <code>IsotropicNormalModel</code> above)!</p>
<p>Anyways, let’s move on to actually implementing the sampler.</p>
</section>
<section id="implementing-mala-in-abstractmcmc.jl" class="level2">
<h2 class="anchored" data-anchor-id="implementing-mala-in-abstractmcmc.jl">Implementing MALA in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a></h2>
<p>Now that we’ve established that a model implementing the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface provides us with all the information we need from <span class="math inline">\(\log \gamma(x)\)</span>, we can address the question: given an object that implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, how can we define a sampler for it?</p>
<p>We’re going to do this by making our sampler a sub-type of <code>AbstractMCMC.AbstractSampler</code> in addition to implementing a few methods from <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>. Why? Because it gets us <em>a lot</em> of functionality for free, as we will see later.</p>
<p>Moreover, <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> provides a very natural interface for MCMC algorithms.</p>
<p>First, we’ll define our <code>MALA</code> type</p>
<div id="12" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">AbstractMCMC</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALA{T,A} <span class="op">&lt;:</span><span class="dt"> AbstractMCMC.AbstractSampler</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"stepsize used in the leapfrog step"</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    ϵ_init<span class="op">::</span><span class="dt">T</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"covariance matrix used for the momentum"</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    M_init<span class="op">::</span><span class="dt">A</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notice how we’ve added the suffix <code>_init</code> to both the stepsize and the covariance matrix. We’ve done this because a <code>AbstractMCMC.AbstractSampler</code> should be <em>immutable</em>. Of course there might be many scenarios where we want to allow something like the stepsize and / or the covariance matrix to vary between iterations, e.g.&nbsp;during the burn-in / adaptation phase of the sampling process we might want to adjust the parameters using statistics computed from these initial iterations. But information which can change between iterations <em>should not go in the sampler itself</em>! Instead, this information should go in the sampler <em>state</em>.</p>
<p>The sampler state should at the very least contain all the necessary information to perform the next MCMC iteration, but usually contains further information, e.g.&nbsp;quantities and statistics useful for evaluating whether the sampler has converged.</p>
<p>We will use the following sampler state for our <code>MALA</code> sampler:</p>
<div id="14" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALAState{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This might seem overly redundant: we’re defining a type <code>MALAState</code> and it only contains a simple vector of reals. In this particular case we indeed could have dropped this and simply used a <code>AbstractVector{&lt;:Real}</code> as our sampler state, but typically, as we will see later, one wants to include other quantities in the sampler state. For example, if we also wanted to adapt the parameters of our <code>MALA</code>, e.g.&nbsp;alter the stepsize depending on acceptance rates, in which case we should also put <code>ϵ</code> in the state, but for now we’ll keep things simple.</p>
<p>Moreover, we also want a <em>sample</em> type, which is a type meant for “public consumption”, i.e.&nbsp;the end-user. This is generally going to contain a subset of the information present in the state. But in such a simple scenario as this, we similarly only have a <code>AbstractVector{&lt;:Real}</code>:</p>
<div id="16" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALASample{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We currently have three things:</p>
<ol type="1">
<li>A <code>AbstractMCMC.AbstractSampler</code> implementation called <code>MALA</code>.</li>
<li>A state <code>MALAState</code> for our sampler <code>MALA</code>.</li>
<li>A sample <code>MALASample</code> for our sampler <code>MALA</code>.</li>
</ol>
<p>That means that we’re ready to implement the only thing that really matters: <code>AbstractMCMC.step</code>.</p>
<p><code>AbstractMCMC.step</code> defines the MCMC iteration of our <code>MALA</code> given the current <code>MALAState</code>. Specifically, the signature of the function is as follows:</p>
<div id="18" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The RNG to ensure reproducibility.</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The model that defines our target.</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.AbstractModel</span>,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The sampler for which we're taking a `step`.</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">AbstractMCMC.AbstractSampler</span>,</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The current sampler `state`.</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    state;</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Additional keyword arguments that we may or may not need.</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Moreover, there is a specific <code>AbstractMCMC.AbstractModel</code> which is used to indicate that the model that is provided implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface: <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Since, as we discussed earlier, in our case we’re indeed going to work with types that support the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, we’ll define <code>AbstractMCMC.step</code> for such a <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Note that <code>AbstractMCMC.LogDensityModel</code> has no other purpose; it has a single field called <code>logdensity</code>, and it does nothing else. But by wrapping the model in <code>AbstractMCMC.LogDensityModel</code>, it allows samplers that want to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> to define their <code>AbstractMCMC.step</code> on this type without running into method ambiguities.</p>
<p>All in all, that means that the signature for our <code>AbstractMCMC.step</code> is going to be the following:</p>
<div id="20" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># `LogDensityModel` so we know we're working with LogDensityProblems.jl model.</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler.</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler state.</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Great! Now let’s actually implement the full <code>AbstractMCMC.step</code> for our <code>MALA</code>.</p>
<p>Let’s remind ourselves what we’re going to do:</p>
<ol type="1">
<li>Sample a new momentum <span class="math inline">\(p\)</span>.</li>
<li>Compute the log-density of the extended target <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>Take a single leapfrog step <span class="math inline">\((\tilde{x}, \tilde{p}) = L_{\epsilon}(x, p)\)</span>.</li>
<li>Accept or reject the proposed <span class="math inline">\((\tilde{x}, \tilde{p})\)</span>.</li>
</ol>
<p>All in all, this results in the following:</p>
<div id="22" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>: Random</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Distributions</span>  <span class="co"># so we get the `MvNormal`</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the wrapped model which implements LogDensityProblems.jl.</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just extract the sampler parameters to make our lives easier.</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    ϵ <span class="op">=</span> sampler.ϵ_init</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    M <span class="op">=</span> sampler.M_init</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the current parameters.</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> state.x</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sample the momentum.</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>    p_dist <span class="op">=</span> <span class="fu">MvNormal</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)), M)</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> <span class="fu">rand</span>(rng, p_dist)</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Propose using a single leapfrog step.</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>    x̃, p̃ <span class="op">=</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Accept or reject proposal.</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>    logp <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p)</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>    logp̃ <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x̃) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p̃)</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>    logα <span class="op">=</span> logp̃ <span class="op">-</span> logp</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>    state_new <span class="op">=</span> <span class="cf">if</span> <span class="fu">log</span>(<span class="fu">rand</span>(rng)) <span class="op">&lt;</span> logα</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Accept.</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x̃)</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Reject.</span></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x)</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return the "sample" and the sampler state.</span></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(state_new.x), state_new</span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Fairly straight-forward.</p>
<p>Of course, we haven’t defined the <code>leapfrog_step</code> method yet, so let’s do that:</p>
<div id="24" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p` using "position" `x`.</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x))</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    p1 <span class="op">=</span> p <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update the "position" `x` using momentum `p1`.</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    x̃ <span class="op">=</span> x <span class="op">+</span> ϵ <span class="op">.*</span> (M <span class="op">\</span> p1)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p1` using position `x̃`</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x̃ <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x̃))</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    p2 <span class="op">=</span> p1 <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x̃</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Flip momentum `p2`.</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    p̃ <span class="op">=</span> <span class="op">-</span>p2</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x̃, p̃</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>leapfrog_step (generic function with 1 method)</code></pre>
</div>
</div>
<p>With all of this, we’re technically ready to sample!</p>
<div id="26" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>, <span class="bu">LinearAlgebra</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>rng <span class="op">=</span> <span class="bu">Random</span>.<span class="fu">default_rng</span>()</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>sampler <span class="op">=</span> <span class="fu">MALA</span>(<span class="fl">1</span>, I)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>state <span class="op">=</span> <span class="fu">MALAState</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)))</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>x_next, state_next <span class="op">=</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    rng,</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    AbstractMCMC.<span class="fu">LogDensityModel</span>(model),</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    state</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>(MALASample{Vector{Float64}}([0.0, 0.0, 0.0]), MALAState{Vector{Float64}}([0.0, 0.0, 0.0]))</code></pre>
</div>
</div>
<p>Great, it works!</p>
<p>And I promised we would get quite some functionality for free if we implemented <code>AbstractMCMC.step</code>, and so we can now simply call <code>sample</code> to perform standard MCMC sampling:</p>
<div id="28" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform 1000 iterations with our `MALA` sampler.</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; initial_state<span class="op">=</span>state, progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Concatenate into a matrix.</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000 Matrix{Float64}:
 -3.62276   -5.55961   -5.10308   …  -3.86881    -6.86708   -6.26426
  0.707219   0.950847  -0.581616      0.0774472  -0.621842  -1.28529
  2.673      4.67532    5.01656       3.56438     5.3949     3.43465</code></pre>
</div>
</div>
<div id="30" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the marginal means and standard deviations.</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -4.99496    1.00443
  0.0154098  0.98818
  4.988      0.99386</code></pre>
</div>
</div>
<p>Let’s visualize the samples</p>
<div id="32" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">StatsPlots</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">transpose</span>(samples_matrix[<span class="op">:</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">:</span><span class="kw">end</span>]), alpha<span class="op">=</span><span class="fl">0.5</span>, legend<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<!--?xml version="1.0" encoding="utf-8"?-->
<svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" width="672" height="480" viewbox="0 0 2688 1920">
<defs>
  <clippath id="clip230">
    <rect x="0" y="0" width="2688" height="1920"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip230)" d="M0 1920 L2688 1920 L2688 0 L0 0  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip231">
    <rect x="537" y="0" width="1883" height="1883"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip230)" d="M196.816 1800.78 L2640.76 1800.78 L2640.76 47.2441 L196.816 47.2441  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip232">
    <rect x="196" y="47" width="2445" height="1755"></rect>
  </clippath>
</defs>
<polyline clip-path="url(#clip232)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="263.676,1800.78 263.676,47.2441 "></polyline>
<polyline clip-path="url(#clip232)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="840.654,1800.78 840.654,47.2441 "></polyline>
<polyline clip-path="url(#clip232)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1417.63,1800.78 1417.63,47.2441 "></polyline>
<polyline clip-path="url(#clip232)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1994.61,1800.78 1994.61,47.2441 "></polyline>
<polyline clip-path="url(#clip232)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="2571.59,1800.78 2571.59,47.2441 "></polyline>
<polyline clip-path="url(#clip232)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,1687.4 2640.76,1687.4 "></polyline>
<polyline clip-path="url(#clip232)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,1442.37 2640.76,1442.37 "></polyline>
<polyline clip-path="url(#clip232)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,1197.34 2640.76,1197.34 "></polyline>
<polyline clip-path="url(#clip232)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,952.311 2640.76,952.311 "></polyline>
<polyline clip-path="url(#clip232)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,707.283 2640.76,707.283 "></polyline>
<polyline clip-path="url(#clip232)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,462.254 2640.76,462.254 "></polyline>
<polyline clip-path="url(#clip232)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,217.225 2640.76,217.225 "></polyline>
<polyline clip-path="url(#clip230)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1800.78 2640.76,1800.78 "></polyline>
<polyline clip-path="url(#clip230)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="263.676,1800.78 263.676,1781.88 "></polyline>
<polyline clip-path="url(#clip230)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="840.654,1800.78 840.654,1781.88 "></polyline>
<polyline clip-path="url(#clip230)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1417.63,1800.78 1417.63,1781.88 "></polyline>
<polyline clip-path="url(#clip230)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1994.61,1800.78 1994.61,1781.88 "></polyline>
<polyline clip-path="url(#clip230)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="2571.59,1800.78 2571.59,1781.88 "></polyline>
<path clip-path="url(#clip230)" d="M263.676 1834 Q260.065 1834 258.236 1837.57 Q256.431 1841.11 256.431 1848.24 Q256.431 1855.34 258.236 1858.91 Q260.065 1862.45 263.676 1862.45 Q267.31 1862.45 269.116 1858.91 Q270.945 1855.34 270.945 1848.24 Q270.945 1841.11 269.116 1837.57 Q267.31 1834 263.676 1834 M263.676 1830.3 Q269.486 1830.3 272.542 1834.9 Q275.621 1839.49 275.621 1848.24 Q275.621 1856.96 272.542 1861.57 Q269.486 1866.15 263.676 1866.15 Q257.866 1866.15 254.787 1861.57 Q251.732 1856.96 251.732 1848.24 Q251.732 1839.49 254.787 1834.9 Q257.866 1830.3 263.676 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip230)" d="M804.346 1861.55 L820.666 1861.55 L820.666 1865.48 L798.721 1865.48 L798.721 1861.55 Q801.383 1858.79 805.967 1854.16 Q810.573 1849.51 811.754 1848.17 Q813.999 1845.65 814.879 1843.91 Q815.782 1842.15 815.782 1840.46 Q815.782 1837.71 813.837 1835.97 Q811.916 1834.23 808.814 1834.23 Q806.615 1834.23 804.161 1835 Q801.731 1835.76 798.953 1837.31 L798.953 1832.59 Q801.777 1831.46 804.231 1830.88 Q806.684 1830.3 808.721 1830.3 Q814.092 1830.3 817.286 1832.98 Q820.481 1835.67 820.481 1840.16 Q820.481 1842.29 819.67 1844.21 Q818.883 1846.11 816.777 1848.7 Q816.198 1849.37 813.096 1852.59 Q809.995 1855.78 804.346 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip230)" d="M830.527 1830.92 L848.883 1830.92 L848.883 1834.86 L834.809 1834.86 L834.809 1843.33 Q835.828 1842.98 836.846 1842.82 Q837.865 1842.64 838.883 1842.64 Q844.67 1842.64 848.05 1845.81 Q851.43 1848.98 851.43 1854.4 Q851.43 1859.97 847.957 1863.08 Q844.485 1866.15 838.166 1866.15 Q835.99 1866.15 833.721 1865.78 Q831.476 1865.41 829.069 1864.67 L829.069 1859.97 Q831.152 1861.11 833.374 1861.66 Q835.596 1862.22 838.073 1862.22 Q842.078 1862.22 844.416 1860.11 Q846.754 1858.01 846.754 1854.4 Q846.754 1850.78 844.416 1848.68 Q842.078 1846.57 838.073 1846.57 Q836.198 1846.57 834.323 1846.99 Q832.471 1847.4 830.527 1848.28 L830.527 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip230)" d="M870.642 1834 Q867.031 1834 865.203 1837.57 Q863.397 1841.11 863.397 1848.24 Q863.397 1855.34 865.203 1858.91 Q867.031 1862.45 870.642 1862.45 Q874.277 1862.45 876.082 1858.91 Q877.911 1855.34 877.911 1848.24 Q877.911 1841.11 876.082 1837.57 Q874.277 1834 870.642 1834 M870.642 1830.3 Q876.453 1830.3 879.508 1834.9 Q882.587 1839.49 882.587 1848.24 Q882.587 1856.96 879.508 1861.57 Q876.453 1866.15 870.642 1866.15 Q864.832 1866.15 861.754 1861.57 Q858.698 1856.96 858.698 1848.24 Q858.698 1839.49 861.754 1834.9 Q864.832 1830.3 870.642 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip230)" d="M1377.25 1830.92 L1395.61 1830.92 L1395.61 1834.86 L1381.53 1834.86 L1381.53 1843.33 Q1382.55 1842.98 1383.57 1842.82 Q1384.59 1842.64 1385.61 1842.64 Q1391.39 1842.64 1394.77 1845.81 Q1398.15 1848.98 1398.15 1854.4 Q1398.15 1859.97 1394.68 1863.08 Q1391.21 1866.15 1384.89 1866.15 Q1382.71 1866.15 1380.44 1865.78 Q1378.2 1865.41 1375.79 1864.67 L1375.79 1859.97 Q1377.88 1861.11 1380.1 1861.66 Q1382.32 1862.22 1384.8 1862.22 Q1388.8 1862.22 1391.14 1860.11 Q1393.48 1858.01 1393.48 1854.4 Q1393.48 1850.78 1391.14 1848.68 Q1388.8 1846.57 1384.8 1846.57 Q1382.92 1846.57 1381.05 1846.99 Q1379.19 1847.4 1377.25 1848.28 L1377.25 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip230)" d="M1417.37 1834 Q1413.75 1834 1411.93 1837.57 Q1410.12 1841.11 1410.12 1848.24 Q1410.12 1855.34 1411.93 1858.91 Q1413.75 1862.45 1417.37 1862.45 Q1421 1862.45 1422.81 1858.91 Q1424.63 1855.34 1424.63 1848.24 Q1424.63 1841.11 1422.81 1837.57 Q1421 1834 1417.37 1834 M1417.37 1830.3 Q1423.18 1830.3 1426.23 1834.9 Q1429.31 1839.49 1429.31 1848.24 Q1429.31 1856.96 1426.23 1861.57 Q1423.18 1866.15 1417.37 1866.15 Q1411.56 1866.15 1408.48 1861.57 Q1405.42 1856.96 1405.42 1848.24 Q1405.42 1839.49 1408.48 1834.9 Q1411.56 1830.3 1417.37 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip230)" d="M1447.53 1834 Q1443.92 1834 1442.09 1837.57 Q1440.28 1841.11 1440.28 1848.24 Q1440.28 1855.34 1442.09 1858.91 Q1443.92 1862.45 1447.53 1862.45 Q1451.16 1862.45 1452.97 1858.91 Q1454.8 1855.34 1454.8 1848.24 Q1454.8 1841.11 1452.97 1837.57 Q1451.16 1834 1447.53 1834 M1447.53 1830.3 Q1453.34 1830.3 1456.39 1834.9 Q1459.47 1839.49 1459.47 1848.24 Q1459.47 1856.96 1456.39 1861.57 Q1453.34 1866.15 1447.53 1866.15 Q1441.72 1866.15 1438.64 1861.57 Q1435.58 1856.96 1435.58 1848.24 Q1435.58 1839.49 1438.64 1834.9 Q1441.72 1830.3 1447.53 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip230)" d="M1952.89 1830.92 L1975.11 1830.92 L1975.11 1832.91 L1962.56 1865.48 L1957.68 1865.48 L1969.48 1834.86 L1952.89 1834.86 L1952.89 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip230)" d="M1984.27 1830.92 L2002.63 1830.92 L2002.63 1834.86 L1988.56 1834.86 L1988.56 1843.33 Q1989.58 1842.98 1990.59 1842.82 Q1991.61 1842.64 1992.63 1842.64 Q1998.42 1842.64 2001.8 1845.81 Q2005.18 1848.98 2005.18 1854.4 Q2005.18 1859.97 2001.7 1863.08 Q1998.23 1866.15 1991.91 1866.15 Q1989.74 1866.15 1987.47 1865.78 Q1985.22 1865.41 1982.82 1864.67 L1982.82 1859.97 Q1984.9 1861.11 1987.12 1861.66 Q1989.34 1862.22 1991.82 1862.22 Q1995.83 1862.22 1998.16 1860.11 Q2000.5 1858.01 2000.5 1854.4 Q2000.5 1850.78 1998.16 1848.68 Q1995.83 1846.57 1991.82 1846.57 Q1989.95 1846.57 1988.07 1846.99 Q1986.22 1847.4 1984.27 1848.28 L1984.27 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip230)" d="M2024.39 1834 Q2020.78 1834 2018.95 1837.57 Q2017.14 1841.11 2017.14 1848.24 Q2017.14 1855.34 2018.95 1858.91 Q2020.78 1862.45 2024.39 1862.45 Q2028.02 1862.45 2029.83 1858.91 Q2031.66 1855.34 2031.66 1848.24 Q2031.66 1841.11 2029.83 1837.57 Q2028.02 1834 2024.39 1834 M2024.39 1830.3 Q2030.2 1830.3 2033.26 1834.9 Q2036.33 1839.49 2036.33 1848.24 Q2036.33 1856.96 2033.26 1861.57 Q2030.2 1866.15 2024.39 1866.15 Q2018.58 1866.15 2015.5 1861.57 Q2012.45 1856.96 2012.45 1848.24 Q2012.45 1839.49 2015.5 1834.9 Q2018.58 1830.3 2024.39 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip230)" d="M2516.11 1861.55 L2523.75 1861.55 L2523.75 1835.18 L2515.44 1836.85 L2515.44 1832.59 L2523.71 1830.92 L2528.38 1830.92 L2528.38 1861.55 L2536.02 1861.55 L2536.02 1865.48 L2516.11 1865.48 L2516.11 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip230)" d="M2555.47 1834 Q2551.85 1834 2550.03 1837.57 Q2548.22 1841.11 2548.22 1848.24 Q2548.22 1855.34 2550.03 1858.91 Q2551.85 1862.45 2555.47 1862.45 Q2559.1 1862.45 2560.9 1858.91 Q2562.73 1855.34 2562.73 1848.24 Q2562.73 1841.11 2560.9 1837.57 Q2559.1 1834 2555.47 1834 M2555.47 1830.3 Q2561.28 1830.3 2564.33 1834.9 Q2567.41 1839.49 2567.41 1848.24 Q2567.41 1856.96 2564.33 1861.57 Q2561.28 1866.15 2555.47 1866.15 Q2549.66 1866.15 2546.58 1861.57 Q2543.52 1856.96 2543.52 1848.24 Q2543.52 1839.49 2546.58 1834.9 Q2549.66 1830.3 2555.47 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip230)" d="M2585.63 1834 Q2582.02 1834 2580.19 1837.57 Q2578.38 1841.11 2578.38 1848.24 Q2578.38 1855.34 2580.19 1858.91 Q2582.02 1862.45 2585.63 1862.45 Q2589.26 1862.45 2591.07 1858.91 Q2592.9 1855.34 2592.9 1848.24 Q2592.9 1841.11 2591.07 1837.57 Q2589.26 1834 2585.63 1834 M2585.63 1830.3 Q2591.44 1830.3 2594.49 1834.9 Q2597.57 1839.49 2597.57 1848.24 Q2597.57 1856.96 2594.49 1861.57 Q2591.44 1866.15 2585.63 1866.15 Q2579.82 1866.15 2576.74 1861.57 Q2573.68 1856.96 2573.68 1848.24 Q2573.68 1839.49 2576.74 1834.9 Q2579.82 1830.3 2585.63 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip230)" d="M2615.79 1834 Q2612.18 1834 2610.35 1837.57 Q2608.54 1841.11 2608.54 1848.24 Q2608.54 1855.34 2610.35 1858.91 Q2612.18 1862.45 2615.79 1862.45 Q2619.42 1862.45 2621.23 1858.91 Q2623.06 1855.34 2623.06 1848.24 Q2623.06 1841.11 2621.23 1837.57 Q2619.42 1834 2615.79 1834 M2615.79 1830.3 Q2621.6 1830.3 2624.65 1834.9 Q2627.73 1839.49 2627.73 1848.24 Q2627.73 1856.96 2624.65 1861.57 Q2621.6 1866.15 2615.79 1866.15 Q2609.98 1866.15 2606.9 1861.57 Q2603.84 1856.96 2603.84 1848.24 Q2603.84 1839.49 2606.9 1834.9 Q2609.98 1830.3 2615.79 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip230)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1800.78 196.816,47.2441 "></polyline>
<polyline clip-path="url(#clip230)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1687.4 215.714,1687.4 "></polyline>
<polyline clip-path="url(#clip230)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1442.37 215.714,1442.37 "></polyline>
<polyline clip-path="url(#clip230)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1197.34 215.714,1197.34 "></polyline>
<polyline clip-path="url(#clip230)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,952.311 215.714,952.311 "></polyline>
<polyline clip-path="url(#clip230)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,707.283 215.714,707.283 "></polyline>
<polyline clip-path="url(#clip230)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,462.254 215.714,462.254 "></polyline>
<polyline clip-path="url(#clip230)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,217.225 215.714,217.225 "></polyline>
<path clip-path="url(#clip230)" d="M50.5475 1687.85 L80.2233 1687.85 L80.2233 1691.78 L50.5475 1691.78 L50.5475 1687.85 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip230)" d="M89.1352 1670.12 L111.357 1670.12 L111.357 1672.11 L98.8111 1704.68 L93.9269 1704.68 L105.732 1674.05 L89.1352 1674.05 L89.1352 1670.12 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip230)" d="M120.478 1698.8 L125.362 1698.8 L125.362 1704.68 L120.478 1704.68 L120.478 1698.8 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip230)" d="M135.593 1670.12 L153.95 1670.12 L153.95 1674.05 L139.876 1674.05 L139.876 1682.52 Q140.894 1682.18 141.913 1682.02 Q142.931 1681.83 143.95 1681.83 Q149.737 1681.83 153.116 1685 Q156.496 1688.17 156.496 1693.59 Q156.496 1699.17 153.024 1702.27 Q149.552 1705.35 143.232 1705.35 Q141.056 1705.35 138.788 1704.98 Q136.542 1704.61 134.135 1703.87 L134.135 1699.17 Q136.218 1700.3 138.441 1700.86 Q140.663 1701.41 143.14 1701.41 Q147.144 1701.41 149.482 1699.31 Q151.82 1697.2 151.82 1693.59 Q151.82 1689.98 149.482 1687.87 Q147.144 1685.77 143.14 1685.77 Q141.265 1685.77 139.39 1686.18 Q137.538 1686.6 135.593 1687.48 L135.593 1670.12 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip230)" d="M49.5521 1442.82 L79.2279 1442.82 L79.2279 1446.76 L49.5521 1446.76 L49.5521 1442.82 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip230)" d="M89.3667 1425.09 L107.723 1425.09 L107.723 1429.02 L93.6491 1429.02 L93.6491 1437.5 Q94.6676 1437.15 95.6861 1436.99 Q96.7047 1436.8 97.7232 1436.8 Q103.51 1436.8 106.89 1439.97 Q110.269 1443.14 110.269 1448.56 Q110.269 1454.14 106.797 1457.24 Q103.325 1460.32 97.0056 1460.32 Q94.8297 1460.32 92.5612 1459.95 Q90.3158 1459.58 87.9084 1458.84 L87.9084 1454.14 Q89.9917 1455.27 92.2139 1455.83 Q94.4361 1456.38 96.913 1456.38 Q100.918 1456.38 103.256 1454.28 Q105.593 1452.17 105.593 1448.56 Q105.593 1444.95 103.256 1442.84 Q100.918 1440.74 96.913 1440.74 Q95.038 1440.74 93.163 1441.15 Q91.3112 1441.57 89.3667 1442.45 L89.3667 1425.09 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip230)" d="M119.482 1453.77 L124.367 1453.77 L124.367 1459.65 L119.482 1459.65 L119.482 1453.77 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip230)" d="M144.552 1428.17 Q140.941 1428.17 139.112 1431.73 Q137.306 1435.27 137.306 1442.4 Q137.306 1449.51 139.112 1453.07 Q140.941 1456.62 144.552 1456.62 Q148.186 1456.62 149.991 1453.07 Q151.82 1449.51 151.82 1442.4 Q151.82 1435.27 149.991 1431.73 Q148.186 1428.17 144.552 1428.17 M144.552 1424.46 Q150.362 1424.46 153.417 1429.07 Q156.496 1433.65 156.496 1442.4 Q156.496 1451.13 153.417 1455.74 Q150.362 1460.32 144.552 1460.32 Q138.741 1460.32 135.663 1455.74 Q132.607 1451.13 132.607 1442.4 Q132.607 1433.65 135.663 1429.07 Q138.741 1424.46 144.552 1424.46 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip230)" d="M50.5475 1197.79 L80.2233 1197.79 L80.2233 1201.73 L50.5475 1201.73 L50.5475 1197.79 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip230)" d="M94.3436 1210.68 L110.663 1210.68 L110.663 1214.62 L88.7186 1214.62 L88.7186 1210.68 Q91.3806 1207.93 95.9639 1203.3 Q100.57 1198.65 101.751 1197.31 Q103.996 1194.78 104.876 1193.05 Q105.779 1191.29 105.779 1189.6 Q105.779 1186.84 103.834 1185.11 Q101.913 1183.37 98.8111 1183.37 Q96.6121 1183.37 94.1584 1184.13 Q91.7278 1184.9 88.9501 1186.45 L88.9501 1181.73 Q91.7741 1180.59 94.2278 1180.01 Q96.6815 1179.44 98.7185 1179.44 Q104.089 1179.44 107.283 1182.12 Q110.478 1184.81 110.478 1189.3 Q110.478 1191.43 109.668 1193.35 Q108.881 1195.25 106.774 1197.84 Q106.195 1198.51 103.094 1201.73 Q99.9917 1204.92 94.3436 1210.68 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip230)" d="M120.478 1208.74 L125.362 1208.74 L125.362 1214.62 L120.478 1214.62 L120.478 1208.74 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip230)" d="M135.593 1180.06 L153.95 1180.06 L153.95 1184 L139.876 1184 L139.876 1192.47 Q140.894 1192.12 141.913 1191.96 Q142.931 1191.77 143.95 1191.77 Q149.737 1191.77 153.116 1194.94 Q156.496 1198.12 156.496 1203.53 Q156.496 1209.11 153.024 1212.21 Q149.552 1215.29 143.232 1215.29 Q141.056 1215.29 138.788 1214.92 Q136.542 1214.55 134.135 1213.81 L134.135 1209.11 Q136.218 1210.25 138.441 1210.8 Q140.663 1211.36 143.14 1211.36 Q147.144 1211.36 149.482 1209.25 Q151.82 1207.14 151.82 1203.53 Q151.82 1199.92 149.482 1197.81 Q147.144 1195.71 143.14 1195.71 Q141.265 1195.71 139.39 1196.12 Q137.538 1196.54 135.593 1197.42 L135.593 1180.06 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip230)" d="M99.3204 938.11 Q95.7093 938.11 93.8806 941.675 Q92.075 945.217 92.075 952.346 Q92.075 959.453 93.8806 963.017 Q95.7093 966.559 99.3204 966.559 Q102.955 966.559 104.76 963.017 Q106.589 959.453 106.589 952.346 Q106.589 945.217 104.76 941.675 Q102.955 938.11 99.3204 938.11 M99.3204 934.406 Q105.131 934.406 108.186 939.013 Q111.265 943.596 111.265 952.346 Q111.265 961.073 108.186 965.679 Q105.131 970.263 99.3204 970.263 Q93.5102 970.263 90.4315 965.679 Q87.376 961.073 87.376 952.346 Q87.376 943.596 90.4315 939.013 Q93.5102 934.406 99.3204 934.406 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip230)" d="M119.482 963.712 L124.367 963.712 L124.367 969.591 L119.482 969.591 L119.482 963.712 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip230)" d="M144.552 938.11 Q140.941 938.11 139.112 941.675 Q137.306 945.217 137.306 952.346 Q137.306 959.453 139.112 963.017 Q140.941 966.559 144.552 966.559 Q148.186 966.559 149.991 963.017 Q151.82 959.453 151.82 952.346 Q151.82 945.217 149.991 941.675 Q148.186 938.11 144.552 938.11 M144.552 934.406 Q150.362 934.406 153.417 939.013 Q156.496 943.596 156.496 952.346 Q156.496 961.073 153.417 965.679 Q150.362 970.263 144.552 970.263 Q138.741 970.263 135.663 965.679 Q132.607 961.073 132.607 952.346 Q132.607 943.596 135.663 939.013 Q138.741 934.406 144.552 934.406 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip230)" d="M94.3436 720.628 L110.663 720.628 L110.663 724.563 L88.7186 724.563 L88.7186 720.628 Q91.3806 717.873 95.9639 713.243 Q100.57 708.591 101.751 707.248 Q103.996 704.725 104.876 702.989 Q105.779 701.229 105.779 699.54 Q105.779 696.785 103.834 695.049 Q101.913 693.313 98.8111 693.313 Q96.6121 693.313 94.1584 694.077 Q91.7278 694.841 88.9501 696.392 L88.9501 691.669 Q91.7741 690.535 94.2278 689.956 Q96.6815 689.378 98.7185 689.378 Q104.089 689.378 107.283 692.063 Q110.478 694.748 110.478 699.239 Q110.478 701.368 109.668 703.29 Q108.881 705.188 106.774 707.78 Q106.195 708.452 103.094 711.669 Q99.9917 714.864 94.3436 720.628 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip230)" d="M120.478 718.683 L125.362 718.683 L125.362 724.563 L120.478 724.563 L120.478 718.683 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip230)" d="M135.593 690.003 L153.95 690.003 L153.95 693.938 L139.876 693.938 L139.876 702.41 Q140.894 702.063 141.913 701.901 Q142.931 701.716 143.95 701.716 Q149.737 701.716 153.116 704.887 Q156.496 708.058 156.496 713.475 Q156.496 719.053 153.024 722.155 Q149.552 725.234 143.232 725.234 Q141.056 725.234 138.788 724.864 Q136.542 724.493 134.135 723.753 L134.135 719.053 Q136.218 720.188 138.441 720.743 Q140.663 721.299 143.14 721.299 Q147.144 721.299 149.482 719.192 Q151.82 717.086 151.82 713.475 Q151.82 709.864 149.482 707.757 Q147.144 705.651 143.14 705.651 Q141.265 705.651 139.39 706.067 Q137.538 706.484 135.593 707.364 L135.593 690.003 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip230)" d="M89.3667 444.974 L107.723 444.974 L107.723 448.909 L93.6491 448.909 L93.6491 457.381 Q94.6676 457.034 95.6861 456.872 Q96.7047 456.687 97.7232 456.687 Q103.51 456.687 106.89 459.858 Q110.269 463.029 110.269 468.446 Q110.269 474.025 106.797 477.127 Q103.325 480.205 97.0056 480.205 Q94.8297 480.205 92.5612 479.835 Q90.3158 479.465 87.9084 478.724 L87.9084 474.025 Q89.9917 475.159 92.2139 475.715 Q94.4361 476.27 96.913 476.27 Q100.918 476.27 103.256 474.164 Q105.593 472.057 105.593 468.446 Q105.593 464.835 103.256 462.729 Q100.918 460.622 96.913 460.622 Q95.038 460.622 93.163 461.039 Q91.3112 461.455 89.3667 462.335 L89.3667 444.974 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip230)" d="M119.482 473.654 L124.367 473.654 L124.367 479.534 L119.482 479.534 L119.482 473.654 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip230)" d="M144.552 448.053 Q140.941 448.053 139.112 451.617 Q137.306 455.159 137.306 462.289 Q137.306 469.395 139.112 472.96 Q140.941 476.502 144.552 476.502 Q148.186 476.502 149.991 472.96 Q151.82 469.395 151.82 462.289 Q151.82 455.159 149.991 451.617 Q148.186 448.053 144.552 448.053 M144.552 444.349 Q150.362 444.349 153.417 448.955 Q156.496 453.539 156.496 462.289 Q156.496 471.016 153.417 475.622 Q150.362 480.205 144.552 480.205 Q138.741 480.205 135.663 475.622 Q132.607 471.016 132.607 462.289 Q132.607 453.539 135.663 448.955 Q138.741 444.349 144.552 444.349 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip230)" d="M89.1352 199.945 L111.357 199.945 L111.357 201.936 L98.8111 234.505 L93.9269 234.505 L105.732 203.88 L89.1352 203.88 L89.1352 199.945 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip230)" d="M120.478 228.626 L125.362 228.626 L125.362 234.505 L120.478 234.505 L120.478 228.626 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip230)" d="M135.593 199.945 L153.95 199.945 L153.95 203.88 L139.876 203.88 L139.876 212.353 Q140.894 212.005 141.913 211.843 Q142.931 211.658 143.95 211.658 Q149.737 211.658 153.116 214.829 Q156.496 218.001 156.496 223.417 Q156.496 228.996 153.024 232.098 Q149.552 235.177 143.232 235.177 Q141.056 235.177 138.788 234.806 Q136.542 234.436 134.135 233.695 L134.135 228.996 Q136.218 230.13 138.441 230.686 Q140.663 231.241 143.14 231.241 Q147.144 231.241 149.482 229.135 Q151.82 227.028 151.82 223.417 Q151.82 219.806 149.482 217.7 Q147.144 215.593 143.14 215.593 Q141.265 215.593 139.39 216.01 Q137.538 216.427 135.593 217.306 L135.593 199.945 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip232)" style="stroke:#009af9; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="265.984,1307.38 268.292,1344.81 270.6,1498.8 272.908,1498.7 275.216,1495.8 277.524,1311.55 279.832,1608.96 282.139,1538.51 284.447,1455.73 286.755,1531.34 289.063,1320.52 291.371,1554.55 293.679,1400.72 295.987,1424.09 298.295,1373.09 300.603,1571.87 302.911,1260.32 305.219,1469.4 307.527,1532.1 309.834,1228.56 312.142,1564.56 314.45,1602.75 316.758,1508.1 319.066,1534.99 321.374,1314.77 323.682,1340.52 325.99,1410.58 328.298,1419.67 330.606,1514.38 332.914,1299.47 335.221,1544.4 337.529,1365.02 339.837,1358.64 342.145,1336.76 344.453,1458.47 346.761,1527.6 349.069,1470.27 351.377,1527.59 353.685,1635.67 355.993,1501.7 358.301,1365.43 360.608,1263.78 362.916,1375.87 365.224,1439.5 367.532,1477.69 369.84,1433.85 372.148,1513.35 374.456,1447.03 376.764,1492.02 379.072,1201.85 381.38,1558.59 383.688,1407.92 385.996,1265.1 388.303,1714.63 390.611,1620.86 392.919,1388.14 395.227,1503.12 397.535,1459.67 399.843,1296.19 402.151,1537.95 404.459,1461.9 406.767,1354.79 409.075,1606.84 411.383,1516.1 413.69,1481.62 415.998,1570.17 418.306,1439.3 420.614,1529.38 422.922,1467.2 425.23,1200.55 427.538,1358.51 429.846,1524.17 432.154,1589.22 434.462,1429.63 436.77,1442.84 439.077,1386.61 441.385,1464.86 443.693,1405.95 446.001,1348.8 448.309,1591.94 450.617,1675.53 452.925,1382.02 455.233,1523.47 457.541,1401.6 459.849,1321.64 462.157,1472.79 464.465,1407.93 466.772,1379.66 469.08,1441.04 471.388,1383.6 473.696,1428.35 476.004,1335.98 478.312,1331.56 480.62,1600.29 482.928,1372.48 485.236,1589.39 487.544,1520.02 489.852,1404.46 492.159,1566.97 494.467,1296 496.775,1409.73 499.083,1391.89 501.391,1584.47 503.699,1337.36 506.007,1598.54 508.315,1548 510.623,1429.02 512.931,1505.79 515.239,1384.88 517.546,1587.52 519.854,1397.32 522.162,1614.47 524.47,1514.45 526.778,1435.38 529.086,1297.29 531.394,1293.77 533.702,1417.91 536.01,1432.71 538.318,1351.37 540.626,1427.46 542.933,1484.16 545.241,1587.42 547.549,1625.15 549.857,1299.95 552.165,1553.23 554.473,1626.84 556.781,1535.66 559.089,1511.11 561.397,1442.02 563.705,1438.79 566.013,1345.91 568.321,1493.76 570.628,1532.25 572.936,1305.78 575.244,1448.61 577.552,1484.96 579.86,1605.39 582.168,1407.5 584.476,1495.03 586.784,1289.17 589.092,1561.47 591.4,1561.87 593.708,1386.39 596.015,1449.8 598.323,1540.29 600.631,1425.72 602.939,1428.6 605.247,1422.82 607.555,1353.1 609.863,1281.2 612.171,1449.69 614.479,1510.59 616.787,1419.97 619.095,1395.16 621.402,1517.13 623.71,1506.44 626.018,1328.77 628.326,1441.07 630.634,1393.75 632.942,1400.26 635.25,1613.63 637.558,1365.96 639.866,1423.21 642.174,1648.67 644.482,1441.04 646.79,1556.31 649.097,1522.24 651.405,1461.98 653.713,1489.93 656.021,1345.26 658.329,1360.88 660.637,1485.15 662.945,1403.11 665.253,1308.95 667.561,1502.08 669.869,1478.19 672.177,1520.56 674.484,1382.33 676.792,1471.84 679.1,1376.24 681.408,1380.19 683.716,1505.2 686.024,1402.31 688.332,1595.41 690.64,1455.43 692.948,1465.04 695.256,1403.63 697.564,1350.49 699.871,1374.37 702.179,1645.41 704.487,1271.47 706.795,1365.8 709.103,1511.7 711.411,1511.45 713.719,1538.18 716.027,1226.75 718.335,1518.59 720.643,1502.93 722.951,1453.02 725.259,1417.24 727.566,1469.11 729.874,1277.78 732.182,1395.45 734.49,1501.44 736.798,1540.23 739.106,1349.44 741.414,1491.76 743.722,1589.48 746.03,1298.9 748.338,1438.41 750.646,1443.14 752.953,1452.94 755.261,1396.95 757.569,1331.12 759.877,1595.7 762.185,1551.14 764.493,1620.17 766.801,1497.66 769.109,1430.08 771.417,1541.43 773.725,1446.85 776.033,1389.85 778.34,1423.79 780.648,1511.42 782.956,1561.23 785.264,1367.39 787.572,1489.34 789.88,1504.81 792.188,1478.97 794.496,1379.34 796.804,1291.35 799.112,1367.36 801.42,1448.4 803.728,1336.93 806.035,1325.52 808.343,1567.21 810.651,1338.1 812.959,1434.46 815.267,1308.58 817.575,1493.94 819.883,1494.46 822.191,1297.31 824.499,1392.5 826.807,1413.7 829.115,1634.41 831.422,1406.99 833.73,1465.29 836.038,1220.79 838.346,1446.38 840.654,1567.75 842.962,1446.87 845.27,1440.19 847.578,1455.59 849.886,1389.93 852.194,1493.82 854.502,1441.94 856.809,1489.54 859.117,1278.02 861.425,1419.55 863.733,1409.73 866.041,1524.31 868.349,1395.12 870.657,1571.06 872.965,1576.29 875.273,1659.04 877.581,1446.71 879.889,1334.85 882.197,1386.85 884.504,1473.54 886.812,1426.44 889.12,1326.5 891.428,1476.42 893.736,1645.69 896.044,1411.1 898.352,1417.44 900.66,1502.55 902.968,1389.32 905.276,1365.66 907.584,1567.06 909.891,1200.11 912.199,1264.96 914.507,1351.67 916.815,1396.3 919.123,1491.41 921.431,1410.36 923.739,1482.88 926.047,1546.83 928.355,1386.02 930.663,1589.7 932.971,1488.59 935.278,1411.5 937.586,1467.23 939.894,1425.75 942.202,1434.3 944.51,1411.45 946.818,1528.79 949.126,1512.64 951.434,1480.12 953.742,1355.26 956.05,1612.18 958.358,1214.43 960.665,1388.25 962.973,1386.63 965.281,1343.76 967.589,1435.01 969.897,1469.73 972.205,1463.97 974.513,1446.7 976.821,1620.55 979.129,1669.19 981.437,1463.97 983.745,1428.67 986.053,1534.44 988.36,1611.84 990.668,1396.63 992.976,1526.03 995.284,1433.6 997.592,1347.18 999.9,1217.63 1002.21,1726.29 1004.52,1342.24 1006.82,1685.92 1009.13,1564.92 1011.44,1270.6 1013.75,1515.76 1016.06,1275.68 1018.36,1409.33 1020.67,1465.3 1022.98,1295.86 1025.29,1704.75 1027.59,1477.83 1029.9,1337.93 1032.21,1306.8 1034.52,1415.85 1036.83,1407.18 1039.13,1456.1 1041.44,1319.37 1043.75,1517.83 1046.06,1486.42 1048.37,1653.85 1050.67,1491.14 1052.98,1480.69 1055.29,1450.68 1057.6,1381.33 1059.91,1511.79 1062.21,1259.11 1064.52,1360.54 1066.83,1485.69 1069.14,1517.49 1071.45,1569.1 1073.75,1486.18 1076.06,1487.96 1078.37,1306.87 1080.68,1470.73 1082.98,1592.57 1085.29,1350.65 1087.6,1434.71 1089.91,1414.69 1092.22,1290.28 1094.52,1584.26 1096.83,1597.23 1099.14,1507.71 1101.45,1270.27 1103.76,1336.84 1106.06,1352.31 1108.37,1495.34 1110.68,1341.08 1112.99,1448.96 1115.3,1352.76 1117.6,1259.47 1119.91,1517.36 1122.22,1634.76 1124.53,1369.11 1126.84,1417.87 1129.14,1444.91 1131.45,1431.55 1133.76,1453.49 1136.07,1499.54 1138.37,1457.44 1140.68,1318.16 1142.99,1495.83 1145.3,1392.52 1147.61,1465.26 1149.91,1401.21 1152.22,1553.3 1154.53,1378.68 1156.84,1413.33 1159.15,1265.66 1161.45,1403.73 1163.76,1559.63 1166.07,1418.12 1168.38,1280.34 1170.69,1490.32 1172.99,1498.56 1175.3,1481.3 1177.61,1388.04 1179.92,1595.9 1182.23,1475.15 1184.53,1370.26 1186.84,1392.09 1189.15,1467.56 1191.46,1311.12 1193.76,1510.54 1196.07,1315.08 1198.38,1252.22 1200.69,1430.03 1203,1388.29 1205.3,1542.54 1207.61,1374.29 1209.92,1490.98 1212.23,1363.57 1214.54,1424.05 1216.84,1427.33 1219.15,1476.66 1221.46,1625.92 1223.77,1280.94 1226.08,1421.13 1228.38,1567.19 1230.69,1479.41 1233,1342.43 1235.31,1453.41 1237.61,1612.88 1239.92,1423.62 1242.23,1406.46 1244.54,1427.14 1246.85,1591.26 1249.15,1430.29 1251.46,1515.44 1253.77,1634.36 1256.08,1303.19 1258.39,1564.06 1260.69,1447.89 1263,1345.59 1265.31,1534.71 1267.62,1206.4 1269.93,1608.61 1272.23,1418.28 1274.54,1373.26 1276.85,1522.37 1279.16,1352.86 1281.47,1370.1 1283.77,1422.06 1286.08,1366.87 1288.39,1443.93 1290.7,1558.48 1293,1450.21 1295.31,1751.15 1297.62,1533.43 1299.93,1466.51 1302.24,1599.13 1304.54,1455.46 1306.85,1496.68 1309.16,1400.08 1311.47,1386.48 1313.78,1405.02 1316.08,1461.71 1318.39,1511.98 1320.7,1318.2 1323.01,1374.73 1325.32,1433.13 1327.62,1580.49 1329.93,1322.74 1332.24,1352.05 1334.55,1329.67 1336.86,1514.69 1339.16,1524.04 1341.47,1526.99 1343.78,1323.56 1346.09,1322.22 1348.39,1484.71 1350.7,1544.91 1353.01,1524.63 1355.32,1405.09 1357.63,1349.42 1359.93,1511.27 1362.24,1324.28 1364.55,1187.05 1366.86,1443.16 1369.17,1450.65 1371.47,1329.33 1373.78,1331.65 1376.09,1300.2 1378.4,1412.86 1380.71,1211.46 1383.01,1401.51 1385.32,1377.61 1387.63,1435.95 1389.94,1434.01 1392.24,1311.38 1394.55,1264.69 1396.86,1506.55 1399.17,1676.87 1401.48,1690.77 1403.78,1320.49 1406.09,1369.91 1408.4,1524.43 1410.71,1552.66 1413.02,1443.88 1415.32,1408.2 1417.63,1453.15 1419.94,1454.82 1422.25,1539.87 1424.56,1283.94 1426.86,1378.21 1429.17,1638.4 1431.48,1457.82 1433.79,1411.31 1436.1,1396.32 1438.4,1464.04 1440.71,1625.06 1443.02,1269.81 1445.33,1314.18 1447.63,1438.18 1449.94,1494.7 1452.25,1388.21 1454.56,1450.61 1456.87,1271.01 1459.17,1385.66 1461.48,1443.23 1463.79,1437.68 1466.1,1522.53 1468.41,1409.3 1470.71,1400.97 1473.02,1393.41 1475.33,1517.3 1477.64,1271.71 1479.95,1343.22 1482.25,1619.72 1484.56,1570.56 1486.87,1304.39 1489.18,1581.9 1491.49,1399.18 1493.79,1476.11 1496.1,1332.71 1498.41,1326.08 1500.72,1660.46 1503.02,1451.54 1505.33,1475.18 1507.64,1351.21 1509.95,1413.03 1512.26,1390.3 1514.56,1472.58 1516.87,1317.55 1519.18,1438.86 1521.49,1443.85 1523.8,1492.32 1526.1,1582.96 1528.41,1457.57 1530.72,1502.64 1533.03,1376.64 1535.34,1486.33 1537.64,1270.97 1539.95,1451.67 1542.26,1325.12 1544.57,1546 1546.88,1513.38 1549.18,1436.82 1551.49,1425.39 1553.8,1565.61 1556.11,1303.01 1558.41,1437.55 1560.72,1445.76 1563.03,1439.93 1565.34,1576.52 1567.65,1500.74 1569.95,1492.34 1572.26,1490.2 1574.57,1460.36 1576.88,1155.03 1579.19,1421.83 1581.49,1398.95 1583.8,1370.89 1586.11,1488.4 1588.42,1391.15 1590.73,1524.53 1593.03,1434.6 1595.34,1501.27 1597.65,1395.67 1599.96,1292.8 1602.26,1524.42 1604.57,1430.95 1606.88,1542.2 1609.19,1268.29 1611.5,1429.74 1613.8,1591.26 1616.11,1521.45 1618.42,1542.41 1620.73,1294.08 1623.04,1460.56 1625.34,1567.72 1627.65,1440.55 1629.96,1578.33 1632.27,1511.43 1634.58,1365.82 1636.88,1515.97 1639.19,1522.29 1641.5,1540.04 1643.81,1476.15 1646.12,1509.09 1648.42,1403.77 1650.73,1395.66 1653.04,1445.7 1655.35,1314.2 1657.65,1611.58 1659.96,1413.82 1662.27,1308.36 1664.58,1429.99 1666.89,1510.25 1669.19,1410.4 1671.5,1306.13 1673.81,1244.61 1676.12,1410.56 1678.43,1450.29 1680.73,1392.25 1683.04,1404.25 1685.35,1511.27 1687.66,1611.94 1689.97,1276.03 1692.27,1421.23 1694.58,1477.27 1696.89,1518.53 1699.2,1470.41 1701.51,1571.1 1703.81,1335.2 1706.12,1644.8 1708.43,1572.29 1710.74,1523.39 1713.04,1446.28 1715.35,1232.06 1717.66,1368.42 1719.97,1471.8 1722.28,1547.77 1724.58,1382.27 1726.89,1564.58 1729.2,1453.97 1731.51,1520.24 1733.82,1385.56 1736.12,1605.02 1738.43,1395.74 1740.74,1558.05 1743.05,1489.48 1745.36,1379.51 1747.66,1517.82 1749.97,1498.33 1752.28,1386.42 1754.59,1498.57 1756.9,1252.88 1759.2,1359.91 1761.51,1601.96 1763.82,1366.1 1766.13,1485.66 1768.43,1525.11 1770.74,1488.79 1773.05,1360.1 1775.36,1404.24 1777.67,1437.74 1779.97,1305.84 1782.28,1379.45 1784.59,1452.5 1786.9,1491.91 1789.21,1330.84 1791.51,1497.7 1793.82,1387.48 1796.13,1403.46 1798.44,1388.6 1800.75,1465.66 1803.05,1429.83 1805.36,1363.26 1807.67,1415.96 1809.98,1200.47 1812.28,1347.37 1814.59,1515.36 1816.9,1417.61 1819.21,1498.84 1821.52,1340.3 1823.82,1331.01 1826.13,1497.28 1828.44,1394.03 1830.75,1462.95 1833.06,1413.8 1835.36,1603.98 1837.67,1333.7 1839.98,1425.22 1842.29,1559.62 1844.6,1360.42 1846.9,1556.43 1849.21,1393.23 1851.52,1413.75 1853.83,1339.69 1856.14,1495.19 1858.44,1326.19 1860.75,1457.12 1863.06,1410.08 1865.37,1370.15 1867.67,1322.69 1869.98,1503.34 1872.29,1379.17 1874.6,1514.59 1876.91,1463.33 1879.21,1417.79 1881.52,1294.86 1883.83,1584.8 1886.14,1573.25 1888.45,1522.54 1890.75,1292.11 1893.06,1350.38 1895.37,1446.04 1897.68,1378.49 1899.99,1600.19 1902.29,1360.48 1904.6,1481.48 1906.91,1500.8 1909.22,1477.41 1911.53,1469.96 1913.83,1408.78 1916.14,1375.7 1918.45,1554.54 1920.76,1393.42 1923.06,1328.82 1925.37,1649.19 1927.68,1597.92 1929.99,1601.86 1932.3,1478.9 1934.6,1525.64 1936.91,1407.48 1939.22,1391.73 1941.53,1413.43 1943.84,1490.53 1946.14,1531.77 1948.45,1483.85 1950.76,1562.58 1953.07,1634.95 1955.38,1518.34 1957.68,1302.47 1959.99,1547.38 1962.3,1348.65 1964.61,1441.74 1966.91,1269.16 1969.22,1512.67 1971.53,1401.62 1973.84,1394.13 1976.15,1511.09 1978.45,1506.52 1980.76,1594.54 1983.07,1523.49 1985.38,1417.32 1987.69,1510.8 1989.99,1449.25 1992.3,1327.98 1994.61,1397.28 1996.92,1507.52 1999.23,1547.11 2001.53,1392.05 2003.84,1374.02 2006.15,1296.73 2008.46,1502.09 2010.77,1276.09 2013.07,1385.42 2015.38,1508.93 2017.69,1401.91 2020,1480.63 2022.3,1441.15 2024.61,1349.96 2026.92,1363.08 2029.23,1399.95 2031.54,1538.33 2033.84,1416.11 2036.15,1484.67 2038.46,1560 2040.77,1340.58 2043.08,1386.11 2045.38,1619.03 2047.69,1391.73 2050,1476.25 2052.31,1469.34 2054.62,1353.15 2056.92,1168.6 2059.23,1572.12 2061.54,1408.46 2063.85,1510.71 2066.16,1404.68 2068.46,1524.55 2070.77,1446.85 2073.08,1403.97 2075.39,1361.99 2077.69,1403.89 2080,1405.79 2082.31,1472.73 2084.62,1308.13 2086.93,1545.92 2089.23,1494.66 2091.54,1482.87 2093.85,1404 2096.16,1493.68 2098.47,1454.73 2100.77,1318.08 2103.08,1455.12 2105.39,1297.42 2107.7,1553.53 2110.01,1516.12 2112.31,1532.65 2114.62,1506.65 2116.93,1403.23 2119.24,1561.12 2121.55,1467.47 2123.85,1494.08 2126.16,1553.1 2128.47,1395.57 2130.78,1334.15 2133.08,1378.4 2135.39,1240.64 2137.7,1472.5 2140.01,1417.97 2142.32,1513.46 2144.62,1394.43 2146.93,1453.3 2149.24,1614.66 2151.55,1331.62 2153.86,1370.69 2156.16,1318.84 2158.47,1515.54 2160.78,1275.3 2163.09,1662.58 2165.4,1479 2167.7,1490.81 2170.01,1497.92 2172.32,1459.34 2174.63,1534.98 2176.93,1344.43 2179.24,1532.58 2181.55,1347.04 2183.86,1473.32 2186.17,1470.51 2188.47,1408.4 2190.78,1472.81 2193.09,1524.26 2195.4,1430.33 2197.71,1402.41 2200.01,1449.66 2202.32,1344.31 2204.63,1409.95 2206.94,1387.44 2209.25,1448.62 2211.55,1417.62 2213.86,1277.5 2216.17,1348 2218.48,1574.38 2220.79,1540.31 2223.09,1499.29 2225.4,1438.53 2227.71,1294.16 2230.02,1516.34 2232.32,1458.15 2234.63,1358.07 2236.94,1614.72 2239.25,1617.6 2241.56,1320.98 2243.86,1470.55 2246.17,1485.34 2248.48,1579.72 2250.79,1459.31 2253.1,1379.46 2255.4,1413.19 2257.71,1335.75 2260.02,1422.66 2262.33,1346.77 2264.64,1378.65 2266.94,1324.38 2269.25,1402.22 2271.56,1434.22 2273.87,1486.08 2276.18,1373.75 2278.48,1356.36 2280.79,1339.69 2283.1,1356.28 2285.41,1345.4 2287.71,1696.59 2290.02,1646.91 2292.33,1495.91 2294.64,1664.58 2296.95,1512.88 2299.25,1460.59 2301.56,1424.42 2303.87,1649.4 2306.18,1517.1 2308.49,1316.98 2310.79,1371.32 2313.1,1364.13 2315.41,1391.87 2317.72,1395.09 2320.03,1319.88 2322.33,1604.03 2324.64,1563.44 2326.95,1333.72 2329.26,1563.74 2331.56,1471.35 2333.87,1366.1 2336.18,1323.6 2338.49,1528.94 2340.8,1396.62 2343.1,1586.5 2345.41,1476.97 2347.72,1516.97 2350.03,1381.62 2352.34,1417.39 2354.64,1562.25 2356.95,1412.61 2359.26,1352.88 2361.57,1334.06 2363.88,1416.51 2366.18,1654.43 2368.49,1442.3 2370.8,1312.87 2373.11,1314.62 2375.42,1601.63 2377.72,1330.96 2380.03,1262.95 2382.34,1529.52 2384.65,1349.14 2386.95,1432.77 2389.26,1392.28 2391.57,1470.73 2393.88,1391.16 2396.19,1375.89 2398.49,1507.75 2400.8,1412.59 2403.11,1449.4 2405.42,1261.56 2407.73,1502.87 2410.03,1296.96 2412.34,1551.43 2414.65,1489.18 2416.96,1346.34 2419.27,1292.28 2421.57,1314.42 2423.88,1424.55 2426.19,1448.48 2428.5,1465.87 2430.81,1506.22 2433.11,1403.54 2435.42,1594.25 2437.73,1441.19 2440.04,1375.47 2442.34,1417.24 2444.65,1332.78 2446.96,1403.37 2449.27,1495.24 2451.58,1485.13 2453.88,1490.68 2456.19,1435.39 2458.5,1491.45 2460.81,1637.8 2463.12,1375.98 2465.42,1418.82 2467.73,1391.23 2470.04,1527.5 2472.35,1417.08 2474.66,1395.34 2476.96,1452.67 2479.27,1456.96 2481.58,1395.3 2483.89,1373.96 2486.2,1521.38 2488.5,1357.2 2490.81,1484.37 2493.12,1395.9 2495.43,1423.18 2497.73,1476.54 2500.04,1490.39 2502.35,1489.08 2504.66,1492.66 2506.97,1553.29 2509.27,1472.39 2511.58,1432.48 2513.89,1344.54 2516.2,1457.88 2518.51,1432.28 2520.81,1314.82 2523.12,1542.19 2525.43,1438.31 2527.74,1312.34 2530.05,1453.94 2532.35,1385.73 2534.66,1386.49 2536.97,1419.22 2539.28,1494.62 2541.58,1411.35 2543.89,1372.03 2546.2,1521.51 2548.51,1548.12 2550.82,1585.78 2553.12,1604.03 2555.43,1426.08 2557.74,1351.97 2560.05,1505.85 2562.36,1379.76 2564.66,1263.76 2566.97,1281.7 2569.28,1261.05 2571.59,1323.7 "></polyline>
<polyline clip-path="url(#clip232)" style="stroke:#e26f46; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="265.984,882.996 268.292,1035.75 270.6,1057.93 272.908,856 275.216,1008.64 277.524,1022.37 279.832,1063.48 282.139,939.449 284.447,991.235 286.755,988.235 289.063,1027.26 291.371,1130.45 293.679,1035.37 295.987,994.254 298.295,988.443 300.603,955.783 302.911,813.366 305.219,873.397 307.527,1100.43 309.834,926.219 312.142,882.06 314.45,1090.27 316.758,971.87 319.066,979.374 321.374,1112.14 323.682,911.98 325.99,942.366 328.298,932.682 330.606,1087.29 332.914,1165.32 335.221,967.603 337.529,863.479 339.837,938.421 342.145,809.604 344.453,996.906 346.761,858.209 349.069,902.876 351.377,1000.04 353.685,902.269 355.993,898.205 358.301,927.985 360.608,1061.76 362.916,930.346 365.224,841.844 367.532,828.041 369.84,946.698 372.148,897.899 374.456,869.006 376.764,1048.56 379.072,940.529 381.38,833.448 383.688,888.018 385.996,910.089 388.303,826.556 390.611,1039.74 392.919,1097.32 395.227,991.38 397.535,896.731 399.843,847.709 402.151,860.575 404.459,965.443 406.767,749.596 409.075,994.01 411.383,967.995 413.69,876.072 415.998,864.646 418.306,930.157 420.614,839.351 422.922,1002.58 425.23,981.194 427.538,1037.56 429.846,796.609 432.154,989.687 434.462,846.781 436.77,933.024 439.077,972.185 441.385,1003.78 443.693,720.488 446.001,928.442 448.309,1051.93 450.617,969.086 452.925,931.103 455.233,810.741 457.541,1046.82 459.849,896.531 462.157,946.835 464.465,884.407 466.772,1068.65 469.08,953.292 471.388,861.966 473.696,898.673 476.004,989.892 478.312,1238.57 480.62,949.479 482.928,1025.82 485.236,883.485 487.544,1149.64 489.852,1045.02 492.159,890.125 494.467,895.413 496.775,809.724 499.083,834.087 501.391,868.071 503.699,901.974 506.007,920.365 508.315,833.906 510.623,949.573 512.931,923.123 515.239,829.666 517.546,863.596 519.854,974.354 522.162,983.283 524.47,704.97 526.778,895.999 529.086,873.708 531.394,809.666 533.702,900.422 536.01,888.692 538.318,933.037 540.626,1025.83 542.933,1036.03 545.241,880.342 547.549,822.208 549.857,938.708 552.165,857.027 554.473,1035.64 556.781,1037.48 559.089,829.317 561.397,1021.51 563.705,979.734 566.013,1077.42 568.321,947.528 570.628,904.991 572.936,1030.37 575.244,912.391 577.552,775.529 579.86,938.962 582.168,970.62 584.476,1019.62 586.784,887.748 589.092,1083.52 591.4,1029.87 593.708,968.219 596.015,822.597 598.323,969.677 600.631,1119.9 602.939,905.094 605.247,1091.52 607.555,961.01 609.863,998.155 612.171,812.427 614.479,878.297 616.787,776.374 619.095,892.569 621.402,971.888 623.71,934.957 626.018,885.861 628.326,832.566 630.634,853.936 632.942,835.682 635.25,949.805 637.558,971.42 639.866,1039.36 642.174,945.026 644.482,1040.13 646.79,999.658 649.097,981.23 651.405,830.075 653.713,1015.72 656.021,883.63 658.329,885.37 660.637,956.123 662.945,877.535 665.253,778.602 667.561,957.104 669.869,965.132 672.177,903.231 674.484,893.486 676.792,994.377 679.1,831.893 681.408,906.674 683.716,892.955 686.024,1012.92 688.332,1054.34 690.64,890.958 692.948,967.11 695.256,936.261 697.564,971.779 699.871,984.076 702.179,976.702 704.487,963.255 706.795,908.207 709.103,995.628 711.411,874.601 713.719,865.174 716.027,1067.84 718.335,1046.61 720.643,794.766 722.951,928.312 725.259,871.042 727.566,858.038 729.874,1015.44 732.182,964.022 734.49,877.002 736.798,1121.53 739.106,987.494 741.414,846.505 743.722,867.901 746.03,955.795 748.338,1104.76 750.646,944.947 752.953,846.715 755.261,814.286 757.569,1106.92 759.877,864.647 762.185,1101.37 764.493,929.087 766.801,744.904 769.109,931.55 771.417,1084.02 773.725,925.437 776.033,1046.82 778.34,927.257 780.648,1045.38 782.956,887.464 785.264,1009.04 787.572,801.803 789.88,1018.54 792.188,1009.21 794.496,968.898 796.804,1018.09 799.112,952.446 801.42,980.45 803.728,1133.25 806.035,898.435 808.343,860.572 810.651,911.792 812.959,912.497 815.267,865.039 817.575,1004.57 819.883,930.75 822.191,949.395 824.499,745.615 826.807,853.662 829.115,789.749 831.422,903.914 833.73,987.583 836.038,924.543 838.346,940.396 840.654,1087.59 842.962,920.154 845.27,1115.13 847.578,924.07 849.886,1019.2 852.194,922.722 854.502,1039.05 856.809,1023.33 859.117,993.932 861.425,1054.64 863.733,913.1 866.041,943.623 868.349,949.092 870.657,1002.95 872.965,1133.25 875.273,1001.3 877.581,844.447 879.889,897.374 882.197,1113.95 884.504,1048.22 886.812,1146.01 889.12,1085.52 891.428,1011.44 893.736,998.615 896.044,943.794 898.352,1114.69 900.66,910.825 902.968,1064.75 905.276,955.977 907.584,1039.57 909.891,930.053 912.199,973.83 914.507,1137.75 916.815,970.699 919.123,1114.01 921.431,777.108 923.739,971.002 926.047,1050.86 928.355,1047.77 930.663,967.985 932.971,828.971 935.278,806.689 937.586,1006.26 939.894,848.682 942.202,911.436 944.51,1021.78 946.818,904.057 949.126,1038.2 951.434,960.96 953.742,925.111 956.05,1031.19 958.358,764.036 960.665,847.432 962.973,933.437 965.281,1071.29 967.589,822.255 969.897,894.367 972.205,898.254 974.513,894.612 976.821,924.324 979.129,974.951 981.437,957.601 983.745,1036.1 986.053,959.202 988.36,834.614 990.668,937.98 992.976,1039.59 995.284,955.251 997.592,998.904 999.9,984.871 1002.21,923.51 1004.52,979.198 1006.82,728.798 1009.13,906.83 1011.44,912.519 1013.75,1050.36 1016.06,1007.67 1018.36,986.861 1020.67,1107.38 1022.98,873.412 1025.29,877.264 1027.59,724.792 1029.9,1029.59 1032.21,699.125 1034.52,915.075 1036.83,931.692 1039.13,951.12 1041.44,1147.1 1043.75,1031.36 1046.06,787.554 1048.37,770.635 1050.67,937.851 1052.98,926.72 1055.29,816.015 1057.6,986.394 1059.91,956.004 1062.21,990.309 1064.52,865.381 1066.83,932.261 1069.14,944.646 1071.45,856.156 1073.75,828.315 1076.06,950.036 1078.37,830.82 1080.68,991.138 1082.98,986.802 1085.29,861.615 1087.6,1053.39 1089.91,1065.59 1092.22,1021.65 1094.52,991.137 1096.83,921.662 1099.14,1015.19 1101.45,758.854 1103.76,940.671 1106.06,927.351 1108.37,688.551 1110.68,1127.1 1112.99,1081.09 1115.3,1005.2 1117.6,731.124 1119.91,890.73 1122.22,1002.58 1124.53,997.957 1126.84,937.843 1129.14,981.267 1131.45,1010.64 1133.76,909.416 1136.07,934.357 1138.37,952.396 1140.68,950.026 1142.99,1138.72 1145.3,1052.41 1147.61,938.256 1149.91,937.938 1152.22,999.466 1154.53,961.948 1156.84,827.617 1159.15,990.773 1161.45,961.46 1163.76,1045.33 1166.07,1010.37 1168.38,1028.88 1170.69,1047.31 1172.99,1042.86 1175.3,921.639 1177.61,1041 1179.92,937.104 1182.23,865.122 1184.53,875.253 1186.84,819.603 1189.15,1125.32 1191.46,948.312 1193.76,1077.3 1196.07,772.116 1198.38,1121.51 1200.69,983.852 1203,887.505 1205.3,938.749 1207.61,931.752 1209.92,846.831 1212.23,983.982 1214.54,988.154 1216.84,1040.19 1219.15,941.759 1221.46,989.129 1223.77,961.457 1226.08,899.124 1228.38,796.15 1230.69,925.466 1233,838.718 1235.31,1124.91 1237.61,839.975 1239.92,976.943 1242.23,919.019 1244.54,971.179 1246.85,994.901 1249.15,969.92 1251.46,890.417 1253.77,877.674 1256.08,887.859 1258.39,1027.79 1260.69,996.781 1263,1041.8 1265.31,793.967 1267.62,1059.91 1269.93,871.916 1272.23,769.4 1274.54,1010.52 1276.85,854.917 1279.16,878.437 1281.47,984.579 1283.77,755.811 1286.08,996.902 1288.39,952.34 1290.7,1010.15 1293,752.193 1295.31,947.335 1297.62,896.004 1299.93,948.206 1302.24,915.373 1304.54,1042.07 1306.85,763.577 1309.16,896.575 1311.47,1020.51 1313.78,908.978 1316.08,835.629 1318.39,1010.01 1320.7,896.768 1323.01,776.216 1325.32,901.988 1327.62,919.652 1329.93,890.911 1332.24,939.64 1334.55,897.412 1336.86,984.837 1339.16,920.159 1341.47,974.83 1343.78,919.592 1346.09,913.207 1348.39,1029.45 1350.7,951.541 1353.01,956.111 1355.32,969.543 1357.63,914.261 1359.93,934.3 1362.24,905.334 1364.55,1206.39 1366.86,1147.74 1369.17,794.203 1371.47,883.282 1373.78,904.755 1376.09,1062.65 1378.4,940.841 1380.71,897.332 1383.01,1009.72 1385.32,896.773 1387.63,1009.75 1389.94,998.6 1392.24,784.596 1394.55,901.282 1396.86,923.846 1399.17,942.892 1401.48,1102.3 1403.78,925.486 1406.09,865.87 1408.4,941.121 1410.71,904.096 1413.02,803.269 1415.32,1024.06 1417.63,793.283 1419.94,1062.07 1422.25,963.58 1424.56,1121.3 1426.86,776.283 1429.17,898.168 1431.48,1005.87 1433.79,930.986 1436.1,904.918 1438.4,1082.86 1440.71,935.535 1443.02,911.367 1445.33,935.54 1447.63,1089.34 1449.94,852.517 1452.25,1037.95 1454.56,937.885 1456.87,1053.57 1459.17,917.442 1461.48,788.516 1463.79,1064.54 1466.1,995.917 1468.41,846.916 1470.71,964.364 1473.02,1024.88 1475.33,881.613 1477.64,1162.25 1479.95,757.94 1482.25,1074.49 1484.56,812.894 1486.87,939.4 1489.18,1028.94 1491.49,817.442 1493.79,946.091 1496.1,1037.81 1498.41,934.539 1500.72,716.455 1503.02,997.656 1505.33,944.239 1507.64,838.495 1509.95,920.374 1512.26,890.041 1514.56,897.397 1516.87,946.549 1519.18,974.487 1521.49,763.786 1523.8,792.937 1526.1,749.259 1528.41,879.46 1530.72,1004.33 1533.03,866.651 1535.34,879.019 1537.64,973.911 1539.95,1007.35 1542.26,996.415 1544.57,984.628 1546.88,997.536 1549.18,814 1551.49,948.136 1553.8,825.621 1556.11,875.06 1558.41,914.952 1560.72,870.45 1563.03,958.6 1565.34,993.787 1567.65,970.492 1569.95,885.662 1572.26,1081.63 1574.57,896.48 1576.88,896.249 1579.19,1094.95 1581.49,1000.59 1583.8,872.886 1586.11,1005.21 1588.42,1112.92 1590.73,973.451 1593.03,1040.37 1595.34,1078.51 1597.65,1016.89 1599.96,987.024 1602.26,1034.95 1604.57,904.993 1606.88,1007.26 1609.19,822.262 1611.5,926.994 1613.8,930.867 1616.11,821.05 1618.42,854.613 1620.73,1032.78 1623.04,871.966 1625.34,1113.14 1627.65,881.638 1629.96,880.347 1632.27,941.489 1634.58,1008.21 1636.88,903.754 1639.19,1043.22 1641.5,872.169 1643.81,1116.23 1646.12,926.646 1648.42,969.035 1650.73,1040.37 1653.04,925.345 1655.35,914.253 1657.65,1058.18 1659.96,996.654 1662.27,773.414 1664.58,823.242 1666.89,862.374 1669.19,898.573 1671.5,942.46 1673.81,1019.16 1676.12,909.621 1678.43,989.016 1680.73,843.908 1683.04,947.9 1685.35,826.576 1687.66,867.045 1689.97,919.136 1692.27,935.407 1694.58,1054.99 1696.89,885.327 1699.2,940.94 1701.51,984.212 1703.81,1006.98 1706.12,961.471 1708.43,869.14 1710.74,1015.39 1713.04,961.995 1715.35,1073.52 1717.66,1038.91 1719.97,908.874 1722.28,902.961 1724.58,982.983 1726.89,1008.65 1729.2,958.703 1731.51,1032.77 1733.82,1093.92 1736.12,1062.84 1738.43,1009.6 1740.74,870.345 1743.05,1004.46 1745.36,903.837 1747.66,1117.85 1749.97,947.94 1752.28,753.161 1754.59,803.389 1756.9,916.623 1759.2,1075.76 1761.51,1016.74 1763.82,961.375 1766.13,961.483 1768.43,932.166 1770.74,909.105 1773.05,969.471 1775.36,879.679 1777.67,1011.18 1779.97,665.785 1782.28,969.047 1784.59,775.907 1786.9,1004.4 1789.21,967.16 1791.51,859.367 1793.82,887.233 1796.13,968.147 1798.44,969.712 1800.75,961.676 1803.05,882.498 1805.36,954.641 1807.67,866.428 1809.98,903.081 1812.28,1018.29 1814.59,1052.25 1816.9,961.543 1819.21,1034.01 1821.52,1035.84 1823.82,959.403 1826.13,865.141 1828.44,990.153 1830.75,968.684 1833.06,976.931 1835.36,859.936 1837.67,995.124 1839.98,1029.46 1842.29,972.643 1844.6,791.701 1846.9,801.567 1849.21,1044.9 1851.52,890.07 1853.83,802.625 1856.14,980.801 1858.44,904.59 1860.75,908.188 1863.06,1057.54 1865.37,927.685 1867.67,1067.6 1869.98,1061.11 1872.29,1023.66 1874.6,846.211 1876.91,1016.25 1879.21,956.891 1881.52,945.068 1883.83,1115.01 1886.14,1010.35 1888.45,890.334 1890.75,788.407 1893.06,896.553 1895.37,996.829 1897.68,993.824 1899.99,794.203 1902.29,939.616 1904.6,1057.72 1906.91,860.589 1909.22,899.134 1911.53,861.816 1913.83,982.109 1916.14,1024.84 1918.45,1049.06 1920.76,864.942 1923.06,850.763 1925.37,874.745 1927.68,1093.09 1929.99,1033.66 1932.3,866.078 1934.6,774.471 1936.91,868.274 1939.22,845.046 1941.53,981.945 1943.84,1002.1 1946.14,963.631 1948.45,972.44 1950.76,878.299 1953.07,853.052 1955.38,1059.29 1957.68,994.089 1959.99,938.289 1962.3,1014.51 1964.61,912.051 1966.91,918.253 1969.22,1110.04 1971.53,939.922 1973.84,947.173 1976.15,819.689 1978.45,946.481 1980.76,793.371 1983.07,776.417 1985.38,1010.83 1987.69,932.421 1989.99,905.674 1992.3,1140.17 1994.61,1105.08 1996.92,855.307 1999.23,897.595 2001.53,1016.55 2003.84,935.618 2006.15,868.671 2008.46,863.278 2010.77,919.123 2013.07,1093.7 2015.38,974.43 2017.69,1027.15 2020,1051 2022.3,1142.89 2024.61,789.513 2026.92,904.514 2029.23,987.851 2031.54,1030.96 2033.84,963.749 2036.15,1020.45 2038.46,935.493 2040.77,934.425 2043.08,1110.19 2045.38,815.946 2047.69,986.026 2050,784.733 2052.31,1088.52 2054.62,797.93 2056.92,994.804 2059.23,890.532 2061.54,822.29 2063.85,1133.66 2066.16,962.152 2068.46,1009.75 2070.77,921.777 2073.08,899.746 2075.39,944.9 2077.69,1029.75 2080,778.992 2082.31,928.104 2084.62,1098.09 2086.93,986.359 2089.23,1000.67 2091.54,1077.33 2093.85,738.444 2096.16,873.469 2098.47,934.862 2100.77,924.118 2103.08,997.9 2105.39,911.825 2107.7,871.121 2110.01,1136.67 2112.31,878.986 2114.62,957.507 2116.93,1017.25 2119.24,900.682 2121.55,931.403 2123.85,969.495 2126.16,978.83 2128.47,1026.58 2130.78,910.491 2133.08,902.717 2135.39,1073.57 2137.7,1004.81 2140.01,1061.8 2142.32,967.567 2144.62,1040.71 2146.93,1033.75 2149.24,1112.83 2151.55,864.471 2153.86,1003.57 2156.16,878.392 2158.47,863.882 2160.78,789.28 2163.09,802.262 2165.4,871.702 2167.7,1036.88 2170.01,931.473 2172.32,985.945 2174.63,1015.83 2176.93,985.767 2179.24,906.23 2181.55,1161.23 2183.86,840.289 2186.17,848.624 2188.47,1018.01 2190.78,1059.36 2193.09,930.204 2195.4,993.037 2197.71,1074.7 2200.01,986.398 2202.32,820.455 2204.63,1061.11 2206.94,939.615 2209.25,1057.47 2211.55,832.048 2213.86,1003.4 2216.17,796.423 2218.48,1054.02 2220.79,1071.96 2223.09,1031.26 2225.4,987.245 2227.71,917.19 2230.02,971.719 2232.32,909.023 2234.63,831.109 2236.94,833.939 2239.25,823.845 2241.56,898.947 2243.86,959.836 2246.17,1076.73 2248.48,1046.62 2250.79,892.733 2253.1,1268.56 2255.4,950.219 2257.71,789.096 2260.02,1102.13 2262.33,929.313 2264.64,1126.27 2266.94,865.855 2269.25,809.122 2271.56,884.11 2273.87,984.609 2276.18,898.381 2278.48,1054.74 2280.79,1061.47 2283.1,1008.67 2285.41,855.337 2287.71,862.627 2290.02,1040.62 2292.33,999.503 2294.64,1020.31 2296.95,899.014 2299.25,856.745 2301.56,1076.59 2303.87,1066.11 2306.18,976.21 2308.49,1068.65 2310.79,945.518 2313.1,951.221 2315.41,972.032 2317.72,901.945 2320.03,932.378 2322.33,1034.72 2324.64,917.964 2326.95,909.357 2329.26,1073.11 2331.56,903.359 2333.87,845.817 2336.18,871.608 2338.49,941.996 2340.8,909.023 2343.1,811.057 2345.41,1031.03 2347.72,1028.91 2350.03,926.747 2352.34,751.544 2354.64,867.095 2356.95,850.112 2359.26,990.352 2361.57,1023.16 2363.88,772.055 2366.18,653.554 2368.49,957.893 2370.8,1144.56 2373.11,1027.14 2375.42,975.214 2377.72,933.523 2380.03,872.394 2382.34,800.565 2384.65,972.571 2386.95,941.013 2389.26,838.453 2391.57,1085.68 2393.88,934.889 2396.19,972.393 2398.49,1027.01 2400.8,648.901 2403.11,1064.1 2405.42,911.955 2407.73,1049.06 2410.03,925.356 2412.34,886.419 2414.65,844.267 2416.96,941.481 2419.27,982.43 2421.57,883.596 2423.88,848.668 2426.19,890.923 2428.5,813.647 2430.81,850.327 2433.11,921.435 2435.42,1005.6 2437.73,879.834 2440.04,888.162 2442.34,927.031 2444.65,868.423 2446.96,957.328 2449.27,1133.76 2451.58,1034.37 2453.88,1035.08 2456.19,1064.28 2458.5,812.485 2460.81,1109.82 2463.12,988.809 2465.42,1072.49 2467.73,954.916 2470.04,1046.85 2472.35,749.394 2474.66,916.99 2476.96,937.596 2479.27,946.039 2481.58,851.39 2483.89,994.76 2486.2,905.657 2488.5,982.741 2490.81,1041.01 2493.12,1012.48 2495.43,834.506 2497.73,934.873 2500.04,1112.95 2502.35,985.145 2504.66,985.958 2506.97,953.293 2509.27,804.998 2511.58,974.534 2513.89,976.424 2516.2,848.408 2518.51,937.841 2520.81,1005.29 2523.12,875.872 2525.43,963.973 2527.74,964.322 2530.05,968.594 2532.35,1019.4 2534.66,925.932 2536.97,916.021 2539.28,809.639 2541.58,776.154 2543.89,900.856 2546.2,764.62 2548.51,942.543 2550.82,874.24 2553.12,911.295 2555.43,1019.92 2557.74,1073.38 2560.05,925.793 2562.36,895.117 2564.66,954.57 2566.97,890.203 2569.28,969.087 2571.59,1031.05 "></polyline>
<polyline clip-path="url(#clip232)" style="stroke:#3da44d; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="265.984,690.326 268.292,422.967 270.6,502.106 272.908,550.895 275.216,462.113 277.524,559.082 279.832,546.153 282.139,545.092 284.447,499.554 286.755,313.3 289.063,568.439 291.371,598.948 293.679,442.214 295.987,530.501 298.295,289.595 300.603,573.646 302.911,589.948 305.219,624.463 307.527,311.087 309.834,365.275 312.142,566.423 314.45,461.068 316.758,533.783 319.066,323.229 321.374,527.875 323.682,417.161 325.99,427.11 328.298,429.669 330.606,542.845 332.914,602.88 335.221,468.117 337.529,599.763 339.837,340.332 342.145,531.657 344.453,531.604 346.761,364.545 349.069,454.967 351.377,312.452 353.685,330.877 355.993,412.816 358.301,468.834 360.608,436.122 362.916,481.909 365.224,417.932 367.532,570.288 369.84,406.089 372.148,496.655 374.456,535.147 376.764,595.996 379.072,395.287 381.38,522.738 383.688,351.439 385.996,523.575 388.303,331.317 390.611,366.901 392.919,483.78 395.227,420.642 397.535,504.529 399.843,539.151 402.151,229.99 404.459,566.254 406.767,426.357 409.075,563.163 411.383,469.309 413.69,474.153 415.998,437.551 418.306,486.584 420.614,433.731 422.922,221.027 425.23,512.911 427.538,385.717 429.846,625.212 432.154,551.145 434.462,483.71 436.77,491.542 439.077,387.017 441.385,338.396 443.693,358.261 446.001,324.983 448.309,645.504 450.617,509.06 452.925,396.894 455.233,454.481 457.541,621.118 459.849,432.989 462.157,336.176 464.465,515.015 466.772,414.621 469.08,385.515 471.388,429.557 473.696,473.951 476.004,238.21 478.312,597.787 480.62,345.085 482.928,364.383 485.236,508.774 487.544,400.945 489.852,390.598 492.159,572.481 494.467,322.293 496.775,416.801 499.083,470.761 501.391,461.349 503.699,291.471 506.007,362.347 508.315,568.549 510.623,514.963 512.931,513.704 515.239,518.547 517.546,577.205 519.854,312.094 522.162,535.153 524.47,398.806 526.778,486.075 529.086,426.356 531.394,363.139 533.702,430.391 536.01,501.474 538.318,464.217 540.626,283.175 542.933,520.287 545.241,491.753 547.549,496.955 549.857,458.298 552.165,429.517 554.473,658.269 556.781,568.174 559.089,466.395 561.397,342.907 563.705,404.063 566.013,391.292 568.321,574.964 570.628,526.435 572.936,508.811 575.244,479.244 577.552,379.013 579.86,571.424 582.168,433.555 584.476,387.543 586.784,283.704 589.092,490.677 591.4,435.965 593.708,297.12 596.015,426.689 598.323,485.872 600.631,393.208 602.939,555.076 605.247,464.207 607.555,527.085 609.863,453.316 612.171,274.551 614.479,363.453 616.787,547.481 619.095,323.21 621.402,538.862 623.71,458.806 626.018,480.132 628.326,470.999 630.634,582.133 632.942,218.483 635.25,570.12 637.558,398.055 639.866,392.325 642.174,447.351 644.482,655.164 646.79,666.539 649.097,479.678 651.405,555.359 653.713,540.468 656.021,451.315 658.329,450.73 660.637,657.241 662.945,487.009 665.253,558.883 667.561,641.264 669.869,402.491 672.177,471.167 674.484,542.177 676.792,422.17 679.1,383.394 681.408,358.958 683.716,417.349 686.024,400.224 688.332,588.61 690.64,406.442 692.948,342.326 695.256,376.349 697.564,454.023 699.871,528.704 702.179,503.53 704.487,511.058 706.795,393.137 709.103,408.347 711.411,567.433 713.719,289.553 716.027,604.989 718.335,550.653 720.643,343.564 722.951,487.073 725.259,548.371 727.566,290.515 729.874,600.449 732.182,425.401 734.49,466.974 736.798,497.958 739.106,412.685 741.414,368.985 743.722,510.979 746.03,642.113 748.338,539.208 750.646,474.933 752.953,579.293 755.261,500.368 757.569,545.674 759.877,381.937 762.185,594.027 764.493,256.255 766.801,580.749 769.109,424.328 771.417,562.643 773.725,418.134 776.033,506.054 778.34,679.487 780.648,512.031 782.956,519.268 785.264,581.194 787.572,517.87 789.88,326.221 792.188,626.406 794.496,535.522 796.804,503.935 799.112,473.076 801.42,381.322 803.728,476.274 806.035,348.324 808.343,400.266 810.651,630.208 812.959,559.394 815.267,398.826 817.575,303 819.883,513.269 822.191,386.987 824.499,504.962 826.807,501.39 829.115,582.693 831.422,269.362 833.73,417.044 836.038,409.944 838.346,461.905 840.654,409.409 842.962,396.036 845.27,465.204 847.578,672.07 849.886,415.46 852.194,525.527 854.502,470.085 856.809,502.403 859.117,472.58 861.425,465.179 863.733,497.126 866.041,534.639 868.349,447.878 870.657,349.815 872.965,477.576 875.273,320.389 877.581,385.047 879.889,499.177 882.197,352.883 884.504,506.525 886.812,295.561 889.12,543.33 891.428,324.13 893.736,407.399 896.044,592.467 898.352,646.832 900.66,721.433 902.968,460.569 905.276,356.506 907.584,287.384 909.891,327.641 912.199,368.672 914.507,418.281 916.815,450.307 919.123,301.784 921.431,471.728 923.739,499.707 926.047,493.334 928.355,605.278 930.663,464.208 932.971,498.518 935.278,436.463 937.586,469.907 939.894,305.444 942.202,552.644 944.51,377.957 946.818,527.791 949.126,429.98 951.434,625.562 953.742,551.968 956.05,650.351 958.358,364.417 960.665,516.811 962.973,414.899 965.281,501.074 967.589,338.203 969.897,479.955 972.205,444.56 974.513,427.646 976.821,413.691 979.129,568.89 981.437,636.01 983.745,343.322 986.053,332.432 988.36,382.029 990.668,371.523 992.976,545.446 995.284,474.903 997.592,642.497 999.9,560.241 1002.21,471.646 1004.52,305.043 1006.82,385.695 1009.13,634.572 1011.44,300.602 1013.75,505.334 1016.06,451.432 1018.36,470.762 1020.67,525.782 1022.98,491.705 1025.29,423.469 1027.59,408.518 1029.9,419.52 1032.21,444.294 1034.52,367.78 1036.83,408.612 1039.13,460.321 1041.44,463.121 1043.75,425.235 1046.06,490.495 1048.37,428.766 1050.67,500.401 1052.98,365.169 1055.29,545.075 1057.6,452.773 1059.91,561.521 1062.21,424.834 1064.52,494.658 1066.83,553.783 1069.14,463.255 1071.45,490.049 1073.75,592.765 1076.06,532.836 1078.37,467.134 1080.68,508.529 1082.98,544.437 1085.29,395.282 1087.6,374.297 1089.91,408.496 1092.22,724.343 1094.52,529.196 1096.83,656.635 1099.14,436.487 1101.45,465.444 1103.76,285.47 1106.06,471.057 1108.37,363.301 1110.68,347.586 1112.99,499.189 1115.3,543.511 1117.6,390.651 1119.91,593.605 1122.22,442.151 1124.53,559.962 1126.84,518.185 1129.14,515.595 1131.45,484.907 1133.76,504.652 1136.07,477.677 1138.37,328.898 1140.68,438.319 1142.99,612.951 1145.3,410.32 1147.61,425.161 1149.91,533.923 1152.22,394.619 1154.53,441.064 1156.84,490.44 1159.15,451.725 1161.45,587.53 1163.76,435.235 1166.07,579.609 1168.38,589.843 1170.69,510.324 1172.99,293.839 1175.3,541.211 1177.61,645.605 1179.92,501.126 1182.23,334.237 1184.53,555.002 1186.84,401.264 1189.15,834.63 1191.46,438.409 1193.76,410.029 1196.07,572.872 1198.38,471.432 1200.69,594.055 1203,513.97 1205.3,490.078 1207.61,388.081 1209.92,668.391 1212.23,595.568 1214.54,552.99 1216.84,333.312 1219.15,335.018 1221.46,373.329 1223.77,284.751 1226.08,539.716 1228.38,440.184 1230.69,462.326 1233,355.626 1235.31,437.632 1237.61,514.641 1239.92,589.669 1242.23,492.815 1244.54,574.171 1246.85,346.314 1249.15,583.039 1251.46,417.979 1253.77,438.241 1256.08,286.212 1258.39,465.452 1260.69,481.261 1263,468.751 1265.31,398.937 1267.62,448.204 1269.93,509.241 1272.23,492.027 1274.54,619.457 1276.85,465.71 1279.16,461.388 1281.47,332.794 1283.77,332.547 1286.08,552.655 1288.39,489.385 1290.7,494.126 1293,504.297 1295.31,483.15 1297.62,414.354 1299.93,514.255 1302.24,421.678 1304.54,413.044 1306.85,477.363 1309.16,441.898 1311.47,630.934 1313.78,244.859 1316.08,459.969 1318.39,520.463 1320.7,489.628 1323.01,477.158 1325.32,432.913 1327.62,332.618 1329.93,411.478 1332.24,559.825 1334.55,362.09 1336.86,534.567 1339.16,487.218 1341.47,485.684 1343.78,386.661 1346.09,374.829 1348.39,477.753 1350.7,415.983 1353.01,628.199 1355.32,525.401 1357.63,614.736 1359.93,629.218 1362.24,493.468 1364.55,191.688 1366.86,528.25 1369.17,371.203 1371.47,423.546 1373.78,548.043 1376.09,447.268 1378.4,513.483 1380.71,591.783 1383.01,609.58 1385.32,453.244 1387.63,482.693 1389.94,586.755 1392.24,366.699 1394.55,394.271 1396.86,463.202 1399.17,329.23 1401.48,453.487 1403.78,558.261 1406.09,579.136 1408.4,696.828 1410.71,494.999 1413.02,618.566 1415.32,339.706 1417.63,462.166 1419.94,445.686 1422.25,690.53 1424.56,557.807 1426.86,372.142 1429.17,434.035 1431.48,611.367 1433.79,509.417 1436.1,426.036 1438.4,350.057 1440.71,331.838 1443.02,409.879 1445.33,551.92 1447.63,421.106 1449.94,577.733 1452.25,394.844 1454.56,486.788 1456.87,450.732 1459.17,472.403 1461.48,488.156 1463.79,453.558 1466.1,381.216 1468.41,397.427 1470.71,509.77 1473.02,346.072 1475.33,393.202 1477.64,589.819 1479.95,357.917 1482.25,621.283 1484.56,455.596 1486.87,503.457 1489.18,553.858 1491.49,548.361 1493.79,435.728 1496.1,515.281 1498.41,354.914 1500.72,290.824 1503.02,681.465 1505.33,357.914 1507.64,466.274 1509.95,478.425 1512.26,403.691 1514.56,516.142 1516.87,390.768 1519.18,403.074 1521.49,420.266 1523.8,487.224 1526.1,352.357 1528.41,506.218 1530.72,296.153 1533.03,619.557 1535.34,597.016 1537.64,430.678 1539.95,463.122 1542.26,451.41 1544.57,432.931 1546.88,322.385 1549.18,340.623 1551.49,487.291 1553.8,401.022 1556.11,411.499 1558.41,496.456 1560.72,475.13 1563.03,342.969 1565.34,447.365 1567.65,267.224 1569.95,601.929 1572.26,468.739 1574.57,404.66 1576.88,366.106 1579.19,490.583 1581.49,329.689 1583.8,291.554 1586.11,392.932 1588.42,698.74 1590.73,441.871 1593.03,373.952 1595.34,500.131 1597.65,393.734 1599.96,283.943 1602.26,488.021 1604.57,220.495 1606.88,572.562 1609.19,449.965 1611.5,455.878 1613.8,556.669 1616.11,453.204 1618.42,479.629 1620.73,301.412 1623.04,512.658 1625.34,469.601 1627.65,414.337 1629.96,361.926 1632.27,409.133 1634.58,215.256 1636.88,366.685 1639.19,440.223 1641.5,578.366 1643.81,469.004 1646.12,359.069 1648.42,457.62 1650.73,351.738 1653.04,467.632 1655.35,517.662 1657.65,441.564 1659.96,531.714 1662.27,363.192 1664.58,606.803 1666.89,380.395 1669.19,435.133 1671.5,581.526 1673.81,366.251 1676.12,555.603 1678.43,453.143 1680.73,482.251 1683.04,484.733 1685.35,480.441 1687.66,394.422 1689.97,383.341 1692.27,413.983 1694.58,613.772 1696.89,517.305 1699.2,648.209 1701.51,624.277 1703.81,422.36 1706.12,559.334 1708.43,591.17 1710.74,351.246 1713.04,447.969 1715.35,96.8724 1717.66,432.288 1719.97,505.813 1722.28,498.95 1724.58,469.673 1726.89,502.668 1729.2,420.623 1731.51,432.382 1733.82,381.859 1736.12,424.361 1738.43,400.339 1740.74,407.338 1743.05,408.008 1745.36,689.391 1747.66,480.63 1749.97,530.389 1752.28,557.828 1754.59,440.765 1756.9,664.063 1759.2,525.034 1761.51,530.31 1763.82,383.223 1766.13,528.368 1768.43,353.955 1770.74,335.394 1773.05,223.941 1775.36,445.388 1777.67,313.858 1779.97,423.127 1782.28,551.939 1784.59,358.481 1786.9,258.412 1789.21,344.825 1791.51,370.121 1793.82,417.132 1796.13,566.605 1798.44,336.275 1800.75,525.308 1803.05,392.257 1805.36,400.038 1807.67,384.737 1809.98,467.061 1812.28,735.828 1814.59,477.149 1816.9,354.133 1819.21,451.867 1821.52,526.345 1823.82,451.752 1826.13,588.088 1828.44,401.631 1830.75,466.143 1833.06,387.959 1835.36,292.786 1837.67,572.753 1839.98,596.732 1842.29,477.768 1844.6,354.112 1846.9,311.151 1849.21,616.872 1851.52,282.804 1853.83,562.5 1856.14,389.264 1858.44,403.099 1860.75,478.79 1863.06,566.83 1865.37,431.055 1867.67,313.32 1869.98,378.471 1872.29,568.023 1874.6,355.995 1876.91,698.671 1879.21,286.663 1881.52,229.172 1883.83,495.956 1886.14,516.819 1888.45,587.982 1890.75,431.428 1893.06,576.005 1895.37,497.21 1897.68,336.159 1899.99,530.509 1902.29,584.826 1904.6,482.296 1906.91,410.428 1909.22,279.262 1911.53,508.914 1913.83,423.575 1916.14,394.736 1918.45,406.062 1920.76,369.4 1923.06,391.289 1925.37,310.33 1927.68,489.547 1929.99,543.946 1932.3,560.36 1934.6,452.382 1936.91,571.217 1939.22,424.472 1941.53,469.517 1943.84,423.078 1946.14,698.037 1948.45,317.102 1950.76,669.4 1953.07,524.985 1955.38,506.932 1957.68,594.451 1959.99,598.458 1962.3,520.649 1964.61,528.993 1966.91,565.786 1969.22,356.343 1971.53,326.422 1973.84,594.239 1976.15,426.179 1978.45,376.231 1980.76,598.165 1983.07,366.695 1985.38,357.975 1987.69,576.227 1989.99,548.532 1992.3,249.911 1994.61,395.758 1996.92,413.744 1999.23,501.232 2001.53,348.634 2003.84,418.481 2006.15,470.986 2008.46,443.66 2010.77,350.471 2013.07,559.712 2015.38,415.313 2017.69,385.387 2020,462.864 2022.3,429.737 2024.61,521.656 2026.92,425.292 2029.23,308.913 2031.54,331.433 2033.84,582.577 2036.15,440.035 2038.46,692.575 2040.77,546.844 2043.08,273.452 2045.38,499.171 2047.69,630.097 2050,544.538 2052.31,446.043 2054.62,383.7 2056.92,634.265 2059.23,615.147 2061.54,410.784 2063.85,530.307 2066.16,511.189 2068.46,483.834 2070.77,548.295 2073.08,486.778 2075.39,481.133 2077.69,447.863 2080,409.678 2082.31,394.713 2084.62,512.473 2086.93,324.598 2089.23,430.668 2091.54,555.39 2093.85,545.875 2096.16,382.472 2098.47,343.819 2100.77,380.775 2103.08,497.722 2105.39,462.452 2107.7,486.695 2110.01,399.375 2112.31,587.231 2114.62,533.863 2116.93,489.98 2119.24,458.601 2121.55,490.963 2123.85,451.214 2126.16,477.895 2128.47,480.999 2130.78,398.524 2133.08,494.933 2135.39,423.071 2137.7,439.021 2140.01,633.853 2142.32,404.034 2144.62,660.84 2146.93,345.585 2149.24,444.45 2151.55,460.264 2153.86,385.186 2156.16,420.649 2158.47,540.563 2160.78,337.833 2163.09,466.437 2165.4,492.474 2167.7,432.553 2170.01,283.953 2172.32,261.637 2174.63,598.466 2176.93,606.603 2179.24,631.826 2181.55,599.954 2183.86,716.003 2186.17,335.3 2188.47,357.906 2190.78,550.061 2193.09,424.425 2195.4,374.188 2197.71,419.283 2200.01,205.515 2202.32,506.406 2204.63,717.579 2206.94,366.417 2209.25,289.793 2211.55,480.082 2213.86,590.975 2216.17,609.107 2218.48,490.974 2220.79,470.836 2223.09,693.2 2225.4,473.64 2227.71,450.448 2230.02,483.66 2232.32,484.784 2234.63,586.464 2236.94,502.068 2239.25,296.106 2241.56,431.213 2243.86,379.318 2246.17,691.778 2248.48,512.185 2250.79,567.469 2253.1,397.591 2255.4,607.997 2257.71,416.797 2260.02,578.151 2262.33,658.843 2264.64,463.051 2266.94,314.705 2269.25,584.997 2271.56,414.965 2273.87,673.32 2276.18,519.685 2278.48,369.53 2280.79,557.812 2283.1,400.298 2285.41,490.653 2287.71,515.676 2290.02,418.341 2292.33,430.698 2294.64,281.555 2296.95,542.589 2299.25,673.413 2301.56,519.176 2303.87,330.45 2306.18,326.19 2308.49,549.774 2310.79,505.718 2313.1,597.268 2315.41,581.352 2317.72,622.037 2320.03,441.833 2322.33,459.346 2324.64,506.002 2326.95,428.875 2329.26,508.162 2331.56,485.558 2333.87,420.753 2336.18,525.466 2338.49,368.69 2340.8,336.267 2343.1,347.604 2345.41,581.973 2347.72,386.561 2350.03,319.396 2352.34,532.069 2354.64,423.07 2356.95,495.462 2359.26,437.505 2361.57,391.668 2363.88,475.949 2366.18,478.543 2368.49,509.3 2370.8,361.802 2373.11,421.862 2375.42,503.482 2377.72,463.806 2380.03,527.241 2382.34,442.204 2384.65,544.162 2386.95,336.214 2389.26,568.306 2391.57,477.511 2393.88,407.762 2396.19,433.735 2398.49,487.046 2400.8,371.857 2403.11,622.018 2405.42,430.549 2407.73,427.433 2410.03,531.4 2412.34,506.995 2414.65,450.753 2416.96,466.695 2419.27,666.841 2421.57,639.262 2423.88,299.29 2426.19,436.996 2428.5,459.993 2430.81,490.064 2433.11,356.583 2435.42,340.052 2437.73,628.828 2440.04,345.66 2442.34,534.493 2444.65,282.624 2446.96,681.927 2449.27,586.343 2451.58,504.992 2453.88,593.833 2456.19,541.387 2458.5,452.686 2460.81,525.13 2463.12,441.435 2465.42,578.481 2467.73,467.286 2470.04,467.503 2472.35,376.233 2474.66,565.435 2476.96,602.161 2479.27,547.263 2481.58,544.06 2483.89,448.942 2486.2,273.617 2488.5,508.037 2490.81,279.209 2493.12,523.831 2495.43,388.235 2497.73,396.174 2500.04,384.024 2502.35,429.642 2504.66,578.801 2506.97,598.756 2509.27,467.494 2511.58,250.457 2513.89,598.062 2516.2,449.846 2518.51,488.044 2520.81,319.13 2523.12,489.152 2525.43,512.72 2527.74,470.185 2530.05,540.332 2532.35,504.897 2534.66,589.054 2536.97,489.739 2539.28,617.7 2541.58,410.71 2543.89,382.938 2546.2,433.362 2548.51,394.514 2550.82,453.638 2553.12,529.206 2555.43,544.278 2557.74,594.046 2560.05,429.045 2562.36,500.11 2564.66,489.205 2566.97,639.005 2569.28,389.582 2571.59,432.643 "></polyline>
</svg>
</div>
</div>
<p>Look at that! Things are working; amazin’.</p>
<p>We can also exploit <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>’s parallel sampling capabilities:</p>
<div id="34" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run separate 4 chains for 10 000 iterations using threads to parallelize.</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>num_chains <span class="op">=</span> <span class="fl">4</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    model_with_grad,</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">MCMCThreads</span>(),</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>,</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    num_chains;</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Note we need to provide an initial state for every chain.</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>    initial_state<span class="op">=</span><span class="fu">fill</span>(state, num_chains),</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>samples_array <span class="op">=</span> <span class="fu">stack</span>(<span class="fu">map</span>(<span class="bu">Base</span>.<span class="fu">Fix1</span>(stack, sample <span class="op">-&gt;</span> sample.x), samples))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000×4 Array{Float64, 3}:
[:, :, 1] =
 -1.83934  -4.5881    -4.5881    -4.6305   …  -5.50497   -4.68344  -4.68344
  1.88295  -0.731382  -0.731382  -1.71326      0.464217   1.42111   1.42111
  2.86992   5.02993    5.02993    4.91142      4.91285    4.16696   4.16696

[:, :, 2] =
 -2.59955   -3.16713   -4.76205   -4.80347  …  -4.3603   -4.89078  -6.53966
 -0.995258  -0.425144  -0.145106  -1.5653       0.95113   1.44806  -0.408587
  1.76401    3.17914    2.98276    3.59489      5.84249   4.31495   5.97772

[:, :, 3] =
 -3.4954   -3.36474   -3.76703   …  -5.67706   -5.67706   -5.67706
  1.17301   0.818164   0.772961     -0.389947  -0.389947  -0.389947
  1.88612   2.88405    4.34746       5.51698    5.51698    5.51698

[:, :, 4] =
 -3.86341   -5.73136   -7.81163  -6.45779   …  -4.99542   -5.10509   -5.16381
  0.272847  -0.547393  -1.11807  -0.816602      0.283666   0.900355   1.23238
  2.32298    1.73435    1.54546   2.50884       5.23062    4.14746    4.68053</code></pre>
</div>
</div>
<p>But the fact that we have to provide the <code>AbstractMCMC.sample</code> call, etc. with an <code>initial_state</code> to get started is a bit annoying. We can avoid this by also defining a <code>AbstractMCMC.step</code> <em>without</em> the <code>state</code> argument:</p>
<div id="36" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">::</span><span class="dt">MALA</span>;</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># </span><span class="al">NOTE</span><span class="co">: No state provided!</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just create the initial state by sampling using  a Gaussian.</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="fu">randn</span>(rng, LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(x), <span class="fu">MALAState</span>(x)</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Equipped with this, we no longer need to provide the <code>initial_state</code> everywhere:</p>
<div id="38" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -5.00059     1.01212
 -0.00897914  0.990702
  5.01604     1.00989</code></pre>
</div>
</div>
</section>
<section id="using-our-sampler-with-turing.jl" class="level2">
<h2 class="anchored" data-anchor-id="using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</h2>
<p>As we promised, all of this hassle of implementing our <code>MALA</code> sampler in a way that uses <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> and <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> gets us something more than <em>just</em> an “automatic” implementation of <code>AbstractMCMC.sample</code>.</p>
<p>It also enables use with Turing.jl through the <code>externalsampler</code>, but we need to do one final thing first: we need to tell Turing.jl how to extract a vector of parameters from the “sample” returned in our implementation of <code>AbstractMCMC.step</code>. In our case, the “sample” is a <code>MALASample</code>, so we just need the following line:</p>
<div id="40" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load Turing.jl.</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Turing</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Overload the `getparams` method for our "sample" type, which is just a vector.</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>Turing.Inference.<span class="fu">getparams</span>(<span class="op">::</span><span class="dt">Turing.Model</span>, sample<span class="op">::</span><span class="dt">MALASample</span>) <span class="op">=</span> sample.x</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And with that, we’re good to go!</p>
<div id="42" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Our previous model defined as a Turing.jl model.</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">mvnormal_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">MvNormal</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.], I)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate our model.</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">mvnormal_model</span>()</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Call `sample` but now we're passing in a Turing.jl `model` and wrapping</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co"># our `MALA` sampler in the `externalsampler` to tell Turing.jl that the sampler</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co"># expects something that implements LogDensityProblems.jl.</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×4×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 2.67 seconds
Compute duration  = 2.67 seconds
parameters        = x[1], x[2], x[3]
internals         = lp

Summary Statistics
  parameters      mean       std      mcse    ess_bulk    ess_tail      rhat   ⋯
      Symbol   Float64   Float64   Float64     Float64     Float64   Float64   ⋯

        x[1]   -5.0197    0.9991    0.0173   3343.6771   4806.2465    1.0000   ⋯
        x[2]    0.0282    1.0175    0.0179   3231.9766   5035.8102    1.0006   ⋯
        x[3]    4.9929    1.0064    0.0179   3167.4439   4713.4763    1.0009   ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

        x[1]   -6.9688   -5.6872   -5.0287   -4.3322   -3.0649
        x[2]   -1.9842   -0.6458    0.0187    0.7176    2.0162
        x[3]    3.0316    4.3218    4.9977    5.6877    6.9583</code></pre>
</div>
</div>
<p>Pretty neat, eh?</p>
<section id="models-with-constrained-parameters" class="level3">
<h3 class="anchored" data-anchor-id="models-with-constrained-parameters">Models with constrained parameters</h3>
<p>One thing we’ve sort of glossed over in all of the above is that MALA, at least how we’ve implemented it, requires <span class="math inline">\(x\)</span> to live in <span class="math inline">\(\mathbb{R}^d\)</span> for some <span class="math inline">\(d &gt; 0\)</span>. If some of the parameters were in fact constrained, e.g.&nbsp;we were working with a <code>Beta</code> distribution which has support on the interval <span class="math inline">\((0, 1)\)</span>, <em>not</em> on <span class="math inline">\(\mathbb{R}^d\)</span>, we could easily end up outside of the valid range <span class="math inline">\((0, 1)\)</span>.</p>
<div id="44" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">beta_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">beta_model</span>()</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 1.57 seconds
Compute duration  = 1.57 seconds
parameters        = x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse    ess_bulk    ess_tail      rhat   ⋯
      Symbol   Float64   Float64   Float64     Float64     Float64   Float64   ⋯

           x    0.5020    0.1876    0.0027   4581.1342   5688.8296    1.0000   ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

           x    0.1544    0.3626    0.4990    0.6420    0.8519</code></pre>
</div>
</div>
<p>Yep, that still works, but only because Turing.jl actually <em>transforms</em> the <code>turing_model</code> from constrained to unconstrained, so that the <code>sampler</code> provided to <code>externalsampler</code> is actually always working in unconstrained space! This is not always desirable, so we can turn this off:</p>
<div id="46" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 0.24 seconds
Compute duration  = 0.24 seconds
parameters        = x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse   ess_bulk   ess_tail      rhat   e ⋯
      Symbol   Float64   Float64   Float64    Float64    Float64   Float64     ⋯

           x    0.4971    0.1599    0.0164    81.7462    40.2031    1.0040     ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

           x    0.1967    0.3673    0.5017    0.6298    0.7682</code></pre>
</div>
</div>
<p>The fun thing is that this still sort of works because</p>
<div id="48" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">logpdf</span>(<span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>), <span class="fl">10.0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-Inf</code></pre>
</div>
</div>
<p>and so the samples that fall outside of the range are always rejected. But do notice how much worse all the diagnostics are, e.g.&nbsp;<code>ess_tail</code> is very poor compared to when we use <code>unconstrained=true</code>. Moreover, in more complex cases this won’t just result in a “nice” <code>-Inf</code> log-density value, but instead will error:</p>
<div id="50" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="kw">function</span> <span class="fu">demo</span>()</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>    σ² <span class="op">~</span> <span class="fu">truncated</span>(<span class="fu">Normal</span>(), lower<span class="op">=</span><span class="fl">0</span>)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If we end up with negative values for `σ²`, the `Normal` will error.</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>    x <span class="op">~</span> <span class="fu">Normal</span>(<span class="fl">0</span>, σ²)</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>DomainError: DomainError(-1.5604560933071199, "Normal: the condition σ &gt;= zero(σ) is not satisfied.")
DomainError with -1.5604560933071199:
Normal: the condition σ &gt;= zero(σ) is not satisfied.
Stacktrace:
  [1] #371
    @ ~/.julia/packages/Distributions/nmUhn/src/univariate/continuous/normal.jl:37 [inlined]
  [2] check_args
    @ ~/.julia/packages/Distributions/nmUhn/src/utils.jl:89 [inlined]
  [3] #Normal#370
    @ ~/.julia/packages/Distributions/nmUhn/src/univariate/continuous/normal.jl:37 [inlined]
  [4] Normal
    @ ~/.julia/packages/Distributions/nmUhn/src/univariate/continuous/normal.jl:36 [inlined]
  [5] Normal
    @ ~/.julia/packages/Distributions/nmUhn/src/univariate/continuous/normal.jl:42 [inlined]
  [6] macro expansion
    @ ~/.julia/packages/DynamicPPL/MjWTB/src/compiler.jl:579 [inlined]
  [7] demo(__model__::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, __varinfo__::DynamicPPL.ThreadSafeVarInfo{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, Vector{Base.RefValue{Float64}}}, __context__::DynamicPPL.ValuesAsInModelContext{OrderedDict{Any, Any}, DynamicPPL.DefaultContext})
    @ Main.Notebook ~/work/docs/docs/tutorials/docs-17-implementing-samplers/index.qmd:592
  [8] _evaluate!!
    @ ~/.julia/packages/DynamicPPL/MjWTB/src/model.jl:973 [inlined]
  [9] evaluate_threadsafe!!(model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, varinfo::DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, context::DynamicPPL.ValuesAsInModelContext{OrderedDict{Any, Any}, DynamicPPL.DefaultContext})
    @ DynamicPPL ~/.julia/packages/DynamicPPL/MjWTB/src/model.jl:962
 [10] evaluate!!
    @ ~/.julia/packages/DynamicPPL/MjWTB/src/model.jl:892 [inlined]
 [11] values_as_in_model
    @ ~/.julia/packages/DynamicPPL/MjWTB/src/values_as_in_model.jl:196 [inlined]
 [12] values_as_in_model
    @ ~/.julia/packages/DynamicPPL/MjWTB/src/values_as_in_model.jl:195 [inlined]
 [13] getparams(model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, vi::DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64})
    @ Turing.Inference ~/.julia/packages/Turing/Bv30p/src/mcmc/Inference.jl:343
 [14] Turing.Inference.Transition(model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, vi::DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, t::MALASample{Vector{Float64}})
    @ Turing.Inference ~/.julia/packages/Turing/Bv30p/src/mcmc/Inference.jl:226
 [15] transition_to_turing
    @ ~/.julia/packages/Turing/Bv30p/src/mcmc/abstractmcmc.jl:12 [inlined]
 [16] transition_to_turing(f::LogDensityProblemsADForwardDiffExt.ForwardDiffLogDensity{LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, Nothing}, ForwardDiff.Chunk{2}, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}, transition::MALASample{Vector{Float64}})
    @ Turing.Inference ~/.julia/packages/Turing/Bv30p/src/mcmc/abstractmcmc.jl:17
 [17] step(rng::TaskLocalRNG, model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, sampler_wrapper::DynamicPPL.Sampler{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}; initial_state::Nothing, initial_params::Nothing, kwargs::@Kwargs{})
    @ Turing.Inference ~/.julia/packages/Turing/Bv30p/src/mcmc/abstractmcmc.jl:141
 [18] step
    @ ~/.julia/packages/Turing/Bv30p/src/mcmc/abstractmcmc.jl:96 [inlined]
 [19] macro expansion
    @ ~/.julia/packages/AbstractMCMC/YrmkI/src/sample.jl:130 [inlined]
 [20] macro expansion
    @ ~/.julia/packages/AbstractMCMC/YrmkI/src/logging.jl:16 [inlined]
 [21] mcmcsample(rng::TaskLocalRNG, model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, sampler::DynamicPPL.Sampler{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}, N::Int64; progress::Bool, progressname::String, callback::Nothing, discard_initial::Int64, thinning::Int64, chain_type::Type, initial_state::Nothing, kwargs::@Kwargs{})
    @ AbstractMCMC ~/.julia/packages/AbstractMCMC/YrmkI/src/sample.jl:120
 [22] sample(rng::TaskLocalRNG, model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, sampler::DynamicPPL.Sampler{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}, N::Int64; chain_type::Type, resume_from::Nothing, initial_state::Nothing, kwargs::@Kwargs{progress::Bool})
    @ DynamicPPL ~/.julia/packages/DynamicPPL/MjWTB/src/sampler.jl:93
 [23] sample
    @ ~/.julia/packages/DynamicPPL/MjWTB/src/sampler.jl:83 [inlined]
 [24] #sample#4
    @ ~/.julia/packages/Turing/Bv30p/src/mcmc/Inference.jl:276 [inlined]
 [25] sample
    @ ~/.julia/packages/Turing/Bv30p/src/mcmc/Inference.jl:267 [inlined]
 [26] #sample#3
    @ ~/.julia/packages/Turing/Bv30p/src/mcmc/Inference.jl:264 [inlined]
 [27] top-level scope
    @ ~/work/docs/docs/tutorials/docs-17-implementing-samplers/index.qmd:594</code></pre>
</div>
</div>
<p>As expected, we run into a <code>DomainError</code> at some point, while if we set <code>unconstrained=true</code>, letting Turing.jl transform the model to a unconstrained form behind the scenes, everything works as expected:</p>
<div id="52" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 1.74 seconds
Compute duration  = 1.74 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse   ess_bulk   ess_tail      rhat   e ⋯
      Symbol   Float64   Float64   Float64    Float64    Float64   Float64     ⋯

          σ²    0.8476    0.5546    0.0216   436.8435   150.9999    1.0022     ⋯
           x    0.0208    0.9710    0.0444   658.5391   516.8065    0.9999     ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

          σ²    0.1179    0.3964    0.7394    1.1887    2.1147
           x   -2.1038   -0.3761    0.0043    0.4255    2.1910</code></pre>
</div>
</div>
<p>Neat!</p>
<p>Similarly, which automatic differentiation backend one should use can be specified through the <code>adtype</code> keyword argument too. For example, if we want to use <a href="https://github.com/JuliaDiff/ReverseDiff.jl">ReverseDiff.jl</a> instead of the default <a href="https://github.com/JuliaDiff/ForwardDiff.jl">ForwardDiff.jl</a>:</p>
<div id="54" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">ReverseDiff</span>: ReverseDiff</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify that we want to use `AutoReverseDiff`.</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">demo</span>(),</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>, adtype<span class="op">=</span><span class="fu">AutoReverseDiff</span>()),</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>;</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 3.14 seconds
Compute duration  = 3.14 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse   ess_bulk   ess_tail      rhat   e ⋯
      Symbol   Float64   Float64   Float64    Float64    Float64   Float64     ⋯

          σ²    0.3108    0.5369    0.0949    22.5994    20.9891    1.2669     ⋯
           x   -0.1342    0.5398    0.0451   204.5701    67.5832    1.2640     ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

          σ²    0.1124    0.1124    0.1124    0.1124    2.2822
           x   -1.8421   -0.1271   -0.1271   -0.1271    1.0747</code></pre>
</div>
</div>
<p>Double-neat.</p>
</section>
</section>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<p>At this point it’s worth maybe reminding ourselves what we did and also <em>why</em> we did it:</p>
<ol type="1">
<li>We define our models in the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface because it makes the sampler agnostic to how the underlying model is implemented.</li>
<li>We implement our sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> interface, which just means that our sampler is a subtype of <code>AbstractMCMC.AbstractSampler</code> and we implement the MCMC transition in <code>AbstractMCMC.step</code>.</li>
<li>Points 1 and 2 makes it so our sampler can be used with a wide range of model implementations, amongst them being models implemented in both Turing.jl and Stan. This gives you, the inference implementer, a large collection of models to test your inference method on, in addition to allowing users of Turing.jl and Stan to try out your inference method with minimal effort.</li>
</ol>


</section>


<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a><div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>We’re going with the leapfrog formulation because in a future version of this tutorial we’ll add a section extending this simple “baseline” MALA sampler to more complex versions. See <a href="https://github.com/TuringLang/docs/issues/479">issue #479</a> for progress on this.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>There is no such thing as a proper interface in Julia (at least not officially), and so we use the word “interface” here to mean a few minimal methods that needs to be implemented by any type that we treat as a target model.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/turinglang\.org\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../tutorials/docs-07-for-developers-variational-inference/index.html" class="pagination-link" aria-label="Variational Inference">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Variational Inference</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Turing is created by <a href="http://mlg.eng.cam.ac.uk/hong/" target="_blank">Hong Ge</a>, and lovingly maintained by the <a href="https://github.com/TuringLang/Turing.jl/graphs/contributors" target="_blank">core team</a> of volunteers. <br> The contents of this website are © 2024 under the terms of the <a href="https://github.com/TuringLang/Turing.jl/blob/master/LICENCE" target="_blank">MIT License</a>.</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/TuringLang/docs/edit/master/tutorials/docs-17-implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/docs/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://x.com/TuringLang">
      <i class="bi bi-twitter" role="img" aria-label="Turing Twitter">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/TuringLang/Turing.jl">
      <i class="bi bi-github" role="img" aria-label="Turing GitHub">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




<script src="../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>