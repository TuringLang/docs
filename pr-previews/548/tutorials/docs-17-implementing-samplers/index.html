<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.0">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Implementing samplers – Turing.jl</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../tutorials/docs-07-for-developers-variational-inference/index.html" rel="prev">
<link href="../../assets/favicon.ico" rel="icon">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-23b5d515405460ba008ebd3366b1cbf2.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark-1f07eb2c514cf428db5cebb7a2aa15a2.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-5a965d03c83b9a52a3a52c83f34fadca.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark-03f81fcb35c69179f531195cac5ac726.min.css" rel="prefetch" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<style>
  a {
    text-decoration: none;
  }
  a:hover {
    text-decoration: underline;
  }
</style>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../theming/styles.css">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="https://turinglang.org/" class="navbar-brand navbar-brand-logo">
    <img src="../../assets/images/turing-logo.svg" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="https://turinglang.org/">
    <span class="navbar-title">Turing.jl</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../tutorials/docs-00-getting-started/"> 
<span class="menu-text">Get Started</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../tutorials/00-introduction/"> 
<span class="menu-text">Tutorials</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/library/"> 
<span class="menu-text">Libraries</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/news/"> 
<span class="menu-text">News</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/team/"> 
<span class="menu-text">Team</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-v0.34" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">v0.34</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-v0.34">    
        <li>
    <a class="dropdown-item" href="https://turinglang.org/docs/changelog.html">
 <span class="dropdown-text">Changelog</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://turinglang.org/docs/versions.html">
 <span class="dropdown-text">All Versions</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools tools-wide">
    <a href="https://x.com/TuringLang" title="Turing Twitter" class="quarto-navigation-tool px-1" aria-label="Turing Twitter"><i class="bi bi-twitter"></i></a>
    <a href="https://github.com/TuringLang/Turing.jl" title="Turing GitHub" class="quarto-navigation-tool px-1" aria-label="Turing GitHub"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Developers</li><li class="breadcrumb-item"><a href="../../tutorials/docs-06-for-developers-interface/index.html">Inference (note: outdated)</a></li><li class="breadcrumb-item"><a href="../../tutorials/docs-17-implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false">
 <span class="menu-text">Users</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-00-getting-started/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Getting Started</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-12-using-turing-guide/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Core Functionality</span></a>
  </div>
</li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false">
 <span class="menu-text">Usage Tips</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-10-using-turing-autodiff/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Automatic Differentiation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/usage-custom-distribution/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Custom Distributions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/usage-probability-interface/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Querying Model Probabilities</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/usage-modifying-logprob/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Modifying the Log Probability</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/usage-generated-quantities/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Generated Quantities</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-17-mode-estimation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Mode Estimation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-13-using-turing-performance-tips/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Performance Tips</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-15-using-turing-sampler-viz/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Sampler Visualization</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-11-using-turing-dynamichmc/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using DynamicHMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-16-using-turing-external-samplers/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using External Samplers</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false">
 <span class="menu-text">Tutorials</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/00-introduction/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction: Coin Flipping</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/01-gaussian-mixture-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Mixture Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/02-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/03-bayesian-neural-network/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Neural Networks</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/04-hidden-markov-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Hidden Markov Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/05-linear-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Linear Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/06-infinite-mixture-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Infinite Mixture Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/07-poisson-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Poisson Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/08-multinomial-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Multinomial Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/09-variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/10-bayesian-differential-equations/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Differential Equations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/11-probabilistic-pca/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Probabilistic PCA</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/13-seasonal-time-series/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Time Series Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/15-gaussian-processes/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction to Gaussian Processes</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/12-gplvm/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Process Latent Variable Models</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Developers</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false">
 <span class="menu-text">Contributing</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-01-contributing-guide/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">How to Contribute</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="false">
 <span class="menu-text">DynamicPPL in Depth</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/dev-model-manual/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Manually Defining a Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-05-for-developers-compiler/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Turing Compiler Design</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/14-minituring/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation I: Compiler</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/16-contexts/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation II: Contexts</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true">
 <span class="menu-text">Inference (note: outdated)</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-06-for-developers-interface/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Interface Guide</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-04-for-developers-abstractmcmc-turing/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">How Turing implements AbstractMCMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-07-for-developers-variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-17-implementing-samplers/index.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Implementing Samplers</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of Contents</h2>
   
  <ul>
  <li><a href="#quick-overview-of-mala" id="toc-quick-overview-of-mala" class="nav-link active" data-scroll-target="#quick-overview-of-mala">Quick overview of MALA</a></li>
  <li><a href="#what-we-need-from-a-model-logdensityproblems.jl" id="toc-what-we-need-from-a-model-logdensityproblems.jl" class="nav-link" data-scroll-target="#what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: LogDensityProblems.jl</a></li>
  <li><a href="#implementing-mala-in-abstractmcmc.jl" id="toc-implementing-mala-in-abstractmcmc.jl" class="nav-link" data-scroll-target="#implementing-mala-in-abstractmcmc.jl">Implementing MALA in AbstractMCMC.jl</a></li>
  <li><a href="#using-our-sampler-with-turing.jl" id="toc-using-our-sampler-with-turing.jl" class="nav-link" data-scroll-target="#using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</a>
  <ul class="collapse">
  <li><a href="#models-with-constrained-parameters" id="toc-models-with-constrained-parameters" class="nav-link" data-scroll-target="#models-with-constrained-parameters">Models with constrained parameters</a></li>
  </ul></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/TuringLang/docs/edit/master/tutorials/docs-17-implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/docs/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Developers</li><li class="breadcrumb-item"><a href="../../tutorials/docs-06-for-developers-interface/index.html">Inference (note: outdated)</a></li><li class="breadcrumb-item"><a href="../../tutorials/docs-17-implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Implementing samplers</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>In this tutorial, we’ll go through step-by-step how to implement a “simple” sampler in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> in such a way that it can be easily applied to Turing.jl models.</p>
<p>In particular, we’re going to implement a version of <strong>Metropolis-adjusted Langevin (MALA)</strong>.</p>
<p>Note that we will implement this sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> framework, completely “ignoring” Turing.jl until the very end of the tutorial, at which point we’ll use a single line of code to make the resulting sampler available to Turing.jl. This is to really drive home the point that one can implement samplers in a way that is accessible to all of Turing.jl’s users without having to use Turing.jl yourself.</p>
<section id="quick-overview-of-mala" class="level2">
<h2 class="anchored" data-anchor-id="quick-overview-of-mala">Quick overview of MALA</h2>
<p>We can view MALA as a single step of the leapfrog intergrator with resampling of momentum <span class="math inline">\(p\)</span> at every step.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> To make that statement a bit more concrete, we first define the <em>extended</em> target <span class="math inline">\(\bar{\gamma}(x, p)\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\log \bar{\gamma}(x, p) \propto \log \gamma(x) + \log \gamma_{\mathcal{N}(0, M)}(p)
\end{equation*}\]</span></p>
<p>where <span class="math inline">\(\gamma_{\mathcal{N}(0, M)}\)</span> denotes the density for a zero-centered Gaussian with covariance matrix <span class="math inline">\(M\)</span>. We then consider targeting this joint distribution over both <span class="math inline">\(x\)</span> and <span class="math inline">\(p\)</span> as follows. First we define the map</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  L_{\epsilon}: \quad &amp; \mathbb{R}^d \times \mathbb{R}^d \to \mathbb{R}^d \times \mathbb{R}^d \\
  &amp; (x, p) \mapsto (\tilde{x}, \tilde{p}) := L_{\epsilon}(x, p)
\end{split}
\end{equation*}\]</span></p>
<p>as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p_{1 / 2} &amp;:= p + \frac{\epsilon}{2} \nabla \log \gamma(x) \\
  \tilde{x} &amp;:= x + \epsilon M^{-1} p_{1 /2 } \\
  p_1 &amp;:= p_{1 / 2} + \frac{\epsilon}{2} \nabla \log \gamma(\tilde{x}) \\
  \tilde{p} &amp;:= - p_1
\end{split}
\end{equation*}\]</span></p>
<p>This might be familiar for some readers as a single step of the Leapfrog integrator. We then define the MALA kernel as follows: given the current iterate <span class="math inline">\(x_i\)</span>, we sample the next iterate <span class="math inline">\(x_{i + 1}\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p &amp;\sim \mathcal{N}(0, M) \\
  (\tilde{x}, \tilde{p}) &amp;:= L_{\epsilon}(x_i, p) \\
  \alpha &amp;:= \min \left\{ 1, \frac{\bar{\gamma}(\tilde{x}, \tilde{p})}{\bar{\gamma}(x_i, p)} \right\} \\
  x_{i + 1} &amp;:=
  \begin{cases}
    \tilde{x} \quad &amp; \text{ with prob. } \alpha \\
    x_i       \quad &amp; \text{ with prob. } 1 - \alpha
  \end{cases}
\end{split}
\end{equation*}\]</span></p>
<p>i.e.&nbsp;we accept the proposal <span class="math inline">\(\tilde{x}\)</span> with probability <span class="math inline">\(\alpha\)</span> and reject it, thus sticking with our current iterate, with probability <span class="math inline">\(1 - \alpha\)</span>.</p>
</section>
<section id="what-we-need-from-a-model-logdensityproblems.jl" class="level2">
<h2 class="anchored" data-anchor-id="what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a></h2>
<p>There are a few things we need from the “target” / “model” / density that we want to sample from:</p>
<ol type="1">
<li>We need access to log-density <em>evaluations</em> <span class="math inline">\(\log \gamma(x)\)</span> so we can compute the acceptance ratio involving <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>We need access to log-density <em>gradients</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span> so we can compute the Leapfrog steps <span class="math inline">\(L_{\epsilon}(x, p)\)</span>.</li>
<li>We also need access to the “size” of the model so we can determine the size of <span class="math inline">\(M\)</span>.</li>
</ol>
<p>Luckily for us, there is a package called <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> which provides an interface for <em>exactly</em> this!</p>
<p>To demonstrate how one can implement the “<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface”<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> we will use a simple Gaussian model as an example:</p>
<div id="4" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblems</span>: LogDensityProblems;</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's define some type that represents the model.</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> IsotropicNormalModel{M<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"mean of the isotropic Gaussian"</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    mean<span class="op">::</span><span class="dt">M</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Specifies what input length the model expects.</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">dimension</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> <span class="fu">length</span>(model.mean)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Implementation of the log-density evaluation of the model.</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x<span class="op">::</span><span class="dt">AbstractVector{&lt;:Real}</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">-</span> <span class="fu">sum</span>(abs2, x <span class="op">.-</span> model.mean) <span class="op">/</span> <span class="fl">2</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This gives us all of the properties we want for our MALA sampler with the exception of the computation of the <em>gradient</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span>. There is the method <code>LogDensityProblems.logdensity_and_gradient</code> which should return a 2-tuple where the first entry is the evaluation of the logdensity <span class="math inline">\(\log \gamma(x)\)</span> and the second entry is the gradient <span class="math inline">\(\nabla \log \gamma(x)\)</span>.</p>
<p>There are two ways to “implement” this method: 1) we implement it by hand, which is feasible in the case of our <code>IsotropicNormalModel</code>, or b) we defer the implementation of this to a automatic differentiation backend.</p>
<p>To implement it by hand we can simply do</p>
<div id="6" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl that first-order, i.e. gradient information, is available.</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{1}</span>()</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Implement `logdensity_and_gradient`.</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    logγ_x <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="op">-</span>x <span class="op">.*</span> (x <span class="op">-</span> model.mean)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> logγ_x, ∇logγ_x</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s just try it out:</p>
<div id="8" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate the problem.</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> <span class="fu">IsotropicNormalModel</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.])</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create some example input that we can test on.</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>x_example <span class="op">=</span> <span class="fu">randn</span>(LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate!</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-32.58603445970911</code></pre>
</div>
</div>
<p>To defer it to an automatic differentiation backend, we can do</p>
<div id="10" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl we only have access to 0-th order information.</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{0}</span>()</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Use `LogDensityProblemsAD`'s `ADgradient` in combination with some AD backend to implement `logdensity_and_gradient`.</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblemsAD</span>, <span class="bu">ADTypes</span>, <span class="bu">ForwardDiff</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>model_with_grad <span class="op">=</span> <span class="fu">ADgradient</span>(<span class="fu">AutoForwardDiff</span>(), model)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model_with_grad, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-32.58603445970911</code></pre>
</div>
</div>
<p>We’ll continue with the second approach in this tutorial since this is typically what one does in practice, because there are better hobbies to spend time on than deriving gradients by hand.</p>
<p>At this point, one might wonder how we’re going to tie this back to Turing.jl in the end. Effectively, when working with inference methods that only require log-density evaluations and / or higher-order information of the log-density, Turing.jl actually converts the user-provided <code>Model</code> into an object implementing the above methods for <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>. As a result, most samplers provided by Turing.jl are actually implemented to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, enabling their use both <em>within</em> Turing.jl and <em>outside</em> of Turing.jl! Morever, there exists similar conversions for Stan through BridgeStan and Stan<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, which means that a sampler supporting the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface can easily be used on both Turing.jl <em>and</em> Stan models (in addition to user-provided models, as our <code>IsotropicNormalModel</code> above)!</p>
<p>Anyways, let’s move on to actually implementing the sampler.</p>
</section>
<section id="implementing-mala-in-abstractmcmc.jl" class="level2">
<h2 class="anchored" data-anchor-id="implementing-mala-in-abstractmcmc.jl">Implementing MALA in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a></h2>
<p>Now that we’ve established that a model implementing the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface provides us with all the information we need from <span class="math inline">\(\log \gamma(x)\)</span>, we can address the question: given an object that implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, how can we define a sampler for it?</p>
<p>We’re going to do this by making our sampler a sub-type of <code>AbstractMCMC.AbstractSampler</code> in addition to implementing a few methods from <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>. Why? Because it gets us <em>a lot</em> of functionality for free, as we will see later.</p>
<p>Moreover, <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> provides a very natural interface for MCMC algorithms.</p>
<p>First, we’ll define our <code>MALA</code> type</p>
<div id="12" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">AbstractMCMC</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALA{T,A} <span class="op">&lt;:</span><span class="dt"> AbstractMCMC.AbstractSampler</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"stepsize used in the leapfrog step"</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    ϵ_init<span class="op">::</span><span class="dt">T</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"covariance matrix used for the momentum"</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    M_init<span class="op">::</span><span class="dt">A</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notice how we’ve added the suffix <code>_init</code> to both the stepsize and the covariance matrix. We’ve done this because a <code>AbstractMCMC.AbstractSampler</code> should be <em>immutable</em>. Of course there might be many scenarios where we want to allow something like the stepsize and / or the covariance matrix to vary between iterations, e.g.&nbsp;during the burn-in / adaptation phase of the sampling process we might want to adjust the parameters using statistics computed from these initial iterations. But information which can change between iterations <em>should not go in the sampler itself</em>! Instead, this information should go in the sampler <em>state</em>.</p>
<p>The sampler state should at the very least contain all the necessary information to perform the next MCMC iteration, but usually contains further information, e.g.&nbsp;quantities and statistics useful for evaluating whether the sampler has converged.</p>
<p>We will use the following sampler state for our <code>MALA</code> sampler:</p>
<div id="14" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALAState{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This might seem overly redundant: we’re defining a type <code>MALAState</code> and it only contains a simple vector of reals. In this particular case we indeed could have dropped this and simply used a <code>AbstractVector{&lt;:Real}</code> as our sampler state, but typically, as we will see later, one wants to include other quantities in the sampler state. For example, if we also wanted to adapt the parameters of our <code>MALA</code>, e.g.&nbsp;alter the stepsize depending on acceptance rates, in which case we should also put <code>ϵ</code> in the state, but for now we’ll keep things simple.</p>
<p>Moreover, we also want a <em>sample</em> type, which is a type meant for “public consumption”, i.e.&nbsp;the end-user. This is generally going to contain a subset of the information present in the state. But in such a simple scenario as this, we similarly only have a <code>AbstractVector{&lt;:Real}</code>:</p>
<div id="16" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALASample{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We currently have three things:</p>
<ol type="1">
<li>A <code>AbstractMCMC.AbstractSampler</code> implementation called <code>MALA</code>.</li>
<li>A state <code>MALAState</code> for our sampler <code>MALA</code>.</li>
<li>A sample <code>MALASample</code> for our sampler <code>MALA</code>.</li>
</ol>
<p>That means that we’re ready to implement the only thing that really matters: <code>AbstractMCMC.step</code>.</p>
<p><code>AbstractMCMC.step</code> defines the MCMC iteration of our <code>MALA</code> given the current <code>MALAState</code>. Specifically, the signature of the function is as follows:</p>
<div id="18" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The RNG to ensure reproducibility.</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The model that defines our target.</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.AbstractModel</span>,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The sampler for which we're taking a `step`.</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">AbstractMCMC.AbstractSampler</span>,</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The current sampler `state`.</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    state;</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Additional keyword arguments that we may or may not need.</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Moreover, there is a specific <code>AbstractMCMC.AbstractModel</code> which is used to indicate that the model that is provided implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface: <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Since, as we discussed earlier, in our case we’re indeed going to work with types that support the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, we’ll define <code>AbstractMCMC.step</code> for such a <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Note that <code>AbstractMCMC.LogDensityModel</code> has no other purpose; it has a single field called <code>logdensity</code>, and it does nothing else. But by wrapping the model in <code>AbstractMCMC.LogDensityModel</code>, it allows samplers that want to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> to define their <code>AbstractMCMC.step</code> on this type without running into method ambiguities.</p>
<p>All in all, that means that the signature for our <code>AbstractMCMC.step</code> is going to be the following:</p>
<div id="20" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># `LogDensityModel` so we know we're working with LogDensityProblems.jl model.</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler.</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler state.</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Great! Now let’s actually implement the full <code>AbstractMCMC.step</code> for our <code>MALA</code>.</p>
<p>Let’s remind ourselves what we’re going to do:</p>
<ol type="1">
<li>Sample a new momentum <span class="math inline">\(p\)</span>.</li>
<li>Compute the log-density of the extended target <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>Take a single leapfrog step <span class="math inline">\((\tilde{x}, \tilde{p}) = L_{\epsilon}(x, p)\)</span>.</li>
<li>Accept or reject the proposed <span class="math inline">\((\tilde{x}, \tilde{p})\)</span>.</li>
</ol>
<p>All in all, this results in the following:</p>
<div id="22" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>: Random</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Distributions</span>  <span class="co"># so we get the `MvNormal`</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the wrapped model which implements LogDensityProblems.jl.</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just extract the sampler parameters to make our lives easier.</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    ϵ <span class="op">=</span> sampler.ϵ_init</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    M <span class="op">=</span> sampler.M_init</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the current parameters.</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> state.x</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sample the momentum.</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>    p_dist <span class="op">=</span> <span class="fu">MvNormal</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)), M)</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> <span class="fu">rand</span>(rng, p_dist)</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Propose using a single leapfrog step.</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>    x̃, p̃ <span class="op">=</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Accept or reject proposal.</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>    logp <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p)</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>    logp̃ <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x̃) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p̃)</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>    logα <span class="op">=</span> logp̃ <span class="op">-</span> logp</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>    state_new <span class="op">=</span> <span class="cf">if</span> <span class="fu">log</span>(<span class="fu">rand</span>(rng)) <span class="op">&lt;</span> logα</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Accept.</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x̃)</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Reject.</span></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x)</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return the "sample" and the sampler state.</span></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(state_new.x), state_new</span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Fairly straight-forward.</p>
<p>Of course, we haven’t defined the <code>leapfrog_step</code> method yet, so let’s do that:</p>
<div id="24" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p` using "position" `x`.</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x))</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    p1 <span class="op">=</span> p <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update the "position" `x` using momentum `p1`.</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    x̃ <span class="op">=</span> x <span class="op">+</span> ϵ <span class="op">.*</span> (M <span class="op">\</span> p1)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p1` using position `x̃`</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x̃ <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x̃))</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    p2 <span class="op">=</span> p1 <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x̃</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Flip momentum `p2`.</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    p̃ <span class="op">=</span> <span class="op">-</span>p2</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x̃, p̃</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>leapfrog_step (generic function with 1 method)</code></pre>
</div>
</div>
<p>With all of this, we’re technically ready to sample!</p>
<div id="26" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>, <span class="bu">LinearAlgebra</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>rng <span class="op">=</span> <span class="bu">Random</span>.<span class="fu">default_rng</span>()</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>sampler <span class="op">=</span> <span class="fu">MALA</span>(<span class="fl">1</span>, I)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>state <span class="op">=</span> <span class="fu">MALAState</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)))</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>x_next, state_next <span class="op">=</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    rng,</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    AbstractMCMC.<span class="fu">LogDensityModel</span>(model),</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    state</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>(MALASample{Vector{Float64}}([0.0, 0.0, 0.0]), MALAState{Vector{Float64}}([0.0, 0.0, 0.0]))</code></pre>
</div>
</div>
<p>Great, it works!</p>
<p>And I promised we would get quite some functionality for free if we implemented <code>AbstractMCMC.step</code>, and so we can now simply call <code>sample</code> to perform standard MCMC sampling:</p>
<div id="28" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform 1000 iterations with our `MALA` sampler.</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; initial_state<span class="op">=</span>state, progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Concatenate into a matrix.</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000 Matrix{Float64}:
 -5.24408   -5.28136   -5.28136   …  -5.19495   -5.19495   -5.50627
 -0.55776   -0.306278  -0.306278      0.114243   0.114243   0.958639
  0.610071   1.83533    1.83533       5.72423    5.72423    4.23489</code></pre>
</div>
</div>
<div id="30" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the marginal means and standard deviations.</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -5.02156    1.00494
 -0.0344916  0.989406
  4.98546    0.999507</code></pre>
</div>
</div>
<p>Let’s visualize the samples</p>
<div id="32" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">StatsPlots</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">transpose</span>(samples_matrix[<span class="op">:</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">:</span><span class="kw">end</span>]), alpha<span class="op">=</span><span class="fl">0.5</span>, legend<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<!--?xml version="1.0" encoding="utf-8"?-->
<svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" width="672" height="480" viewbox="0 0 2688 1920">
<defs>
  <clippath id="clip780">
    <rect x="0" y="0" width="2688" height="1920"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip780)" d="M0 1920 L2688 1920 L2688 0 L0 0  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip781">
    <rect x="537" y="0" width="1883" height="1883"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip780)" d="M196.816 1800.78 L2640.76 1800.78 L2640.76 47.2441 L196.816 47.2441  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip782">
    <rect x="196" y="47" width="2445" height="1755"></rect>
  </clippath>
</defs>
<polyline clip-path="url(#clip782)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="263.676,1800.78 263.676,47.2441 "></polyline>
<polyline clip-path="url(#clip782)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="840.654,1800.78 840.654,47.2441 "></polyline>
<polyline clip-path="url(#clip782)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1417.63,1800.78 1417.63,47.2441 "></polyline>
<polyline clip-path="url(#clip782)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1994.61,1800.78 1994.61,47.2441 "></polyline>
<polyline clip-path="url(#clip782)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="2571.59,1800.78 2571.59,47.2441 "></polyline>
<polyline clip-path="url(#clip782)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,1719.12 2640.76,1719.12 "></polyline>
<polyline clip-path="url(#clip782)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,1465.93 2640.76,1465.93 "></polyline>
<polyline clip-path="url(#clip782)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,1212.73 2640.76,1212.73 "></polyline>
<polyline clip-path="url(#clip782)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,959.538 2640.76,959.538 "></polyline>
<polyline clip-path="url(#clip782)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,706.342 2640.76,706.342 "></polyline>
<polyline clip-path="url(#clip782)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,453.147 2640.76,453.147 "></polyline>
<polyline clip-path="url(#clip782)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,199.951 2640.76,199.951 "></polyline>
<polyline clip-path="url(#clip780)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1800.78 2640.76,1800.78 "></polyline>
<polyline clip-path="url(#clip780)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="263.676,1800.78 263.676,1781.88 "></polyline>
<polyline clip-path="url(#clip780)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="840.654,1800.78 840.654,1781.88 "></polyline>
<polyline clip-path="url(#clip780)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1417.63,1800.78 1417.63,1781.88 "></polyline>
<polyline clip-path="url(#clip780)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1994.61,1800.78 1994.61,1781.88 "></polyline>
<polyline clip-path="url(#clip780)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="2571.59,1800.78 2571.59,1781.88 "></polyline>
<path clip-path="url(#clip780)" d="M263.676 1834 Q260.065 1834 258.236 1837.57 Q256.431 1841.11 256.431 1848.24 Q256.431 1855.34 258.236 1858.91 Q260.065 1862.45 263.676 1862.45 Q267.31 1862.45 269.116 1858.91 Q270.945 1855.34 270.945 1848.24 Q270.945 1841.11 269.116 1837.57 Q267.31 1834 263.676 1834 M263.676 1830.3 Q269.486 1830.3 272.542 1834.9 Q275.621 1839.49 275.621 1848.24 Q275.621 1856.96 272.542 1861.57 Q269.486 1866.15 263.676 1866.15 Q257.866 1866.15 254.787 1861.57 Q251.732 1856.96 251.732 1848.24 Q251.732 1839.49 254.787 1834.9 Q257.866 1830.3 263.676 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip780)" d="M804.346 1861.55 L820.666 1861.55 L820.666 1865.48 L798.721 1865.48 L798.721 1861.55 Q801.383 1858.79 805.967 1854.16 Q810.573 1849.51 811.754 1848.17 Q813.999 1845.65 814.879 1843.91 Q815.782 1842.15 815.782 1840.46 Q815.782 1837.71 813.837 1835.97 Q811.916 1834.23 808.814 1834.23 Q806.615 1834.23 804.161 1835 Q801.731 1835.76 798.953 1837.31 L798.953 1832.59 Q801.777 1831.46 804.231 1830.88 Q806.684 1830.3 808.721 1830.3 Q814.092 1830.3 817.286 1832.98 Q820.481 1835.67 820.481 1840.16 Q820.481 1842.29 819.67 1844.21 Q818.883 1846.11 816.777 1848.7 Q816.198 1849.37 813.096 1852.59 Q809.995 1855.78 804.346 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip780)" d="M830.527 1830.92 L848.883 1830.92 L848.883 1834.86 L834.809 1834.86 L834.809 1843.33 Q835.828 1842.98 836.846 1842.82 Q837.865 1842.64 838.883 1842.64 Q844.67 1842.64 848.05 1845.81 Q851.43 1848.98 851.43 1854.4 Q851.43 1859.97 847.957 1863.08 Q844.485 1866.15 838.166 1866.15 Q835.99 1866.15 833.721 1865.78 Q831.476 1865.41 829.069 1864.67 L829.069 1859.97 Q831.152 1861.11 833.374 1861.66 Q835.596 1862.22 838.073 1862.22 Q842.078 1862.22 844.416 1860.11 Q846.754 1858.01 846.754 1854.4 Q846.754 1850.78 844.416 1848.68 Q842.078 1846.57 838.073 1846.57 Q836.198 1846.57 834.323 1846.99 Q832.471 1847.4 830.527 1848.28 L830.527 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip780)" d="M870.642 1834 Q867.031 1834 865.203 1837.57 Q863.397 1841.11 863.397 1848.24 Q863.397 1855.34 865.203 1858.91 Q867.031 1862.45 870.642 1862.45 Q874.277 1862.45 876.082 1858.91 Q877.911 1855.34 877.911 1848.24 Q877.911 1841.11 876.082 1837.57 Q874.277 1834 870.642 1834 M870.642 1830.3 Q876.453 1830.3 879.508 1834.9 Q882.587 1839.49 882.587 1848.24 Q882.587 1856.96 879.508 1861.57 Q876.453 1866.15 870.642 1866.15 Q864.832 1866.15 861.754 1861.57 Q858.698 1856.96 858.698 1848.24 Q858.698 1839.49 861.754 1834.9 Q864.832 1830.3 870.642 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip780)" d="M1377.25 1830.92 L1395.61 1830.92 L1395.61 1834.86 L1381.53 1834.86 L1381.53 1843.33 Q1382.55 1842.98 1383.57 1842.82 Q1384.59 1842.64 1385.61 1842.64 Q1391.39 1842.64 1394.77 1845.81 Q1398.15 1848.98 1398.15 1854.4 Q1398.15 1859.97 1394.68 1863.08 Q1391.21 1866.15 1384.89 1866.15 Q1382.71 1866.15 1380.44 1865.78 Q1378.2 1865.41 1375.79 1864.67 L1375.79 1859.97 Q1377.88 1861.11 1380.1 1861.66 Q1382.32 1862.22 1384.8 1862.22 Q1388.8 1862.22 1391.14 1860.11 Q1393.48 1858.01 1393.48 1854.4 Q1393.48 1850.78 1391.14 1848.68 Q1388.8 1846.57 1384.8 1846.57 Q1382.92 1846.57 1381.05 1846.99 Q1379.19 1847.4 1377.25 1848.28 L1377.25 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip780)" d="M1417.37 1834 Q1413.75 1834 1411.93 1837.57 Q1410.12 1841.11 1410.12 1848.24 Q1410.12 1855.34 1411.93 1858.91 Q1413.75 1862.45 1417.37 1862.45 Q1421 1862.45 1422.81 1858.91 Q1424.63 1855.34 1424.63 1848.24 Q1424.63 1841.11 1422.81 1837.57 Q1421 1834 1417.37 1834 M1417.37 1830.3 Q1423.18 1830.3 1426.23 1834.9 Q1429.31 1839.49 1429.31 1848.24 Q1429.31 1856.96 1426.23 1861.57 Q1423.18 1866.15 1417.37 1866.15 Q1411.56 1866.15 1408.48 1861.57 Q1405.42 1856.96 1405.42 1848.24 Q1405.42 1839.49 1408.48 1834.9 Q1411.56 1830.3 1417.37 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip780)" d="M1447.53 1834 Q1443.92 1834 1442.09 1837.57 Q1440.28 1841.11 1440.28 1848.24 Q1440.28 1855.34 1442.09 1858.91 Q1443.92 1862.45 1447.53 1862.45 Q1451.16 1862.45 1452.97 1858.91 Q1454.8 1855.34 1454.8 1848.24 Q1454.8 1841.11 1452.97 1837.57 Q1451.16 1834 1447.53 1834 M1447.53 1830.3 Q1453.34 1830.3 1456.39 1834.9 Q1459.47 1839.49 1459.47 1848.24 Q1459.47 1856.96 1456.39 1861.57 Q1453.34 1866.15 1447.53 1866.15 Q1441.72 1866.15 1438.64 1861.57 Q1435.58 1856.96 1435.58 1848.24 Q1435.58 1839.49 1438.64 1834.9 Q1441.72 1830.3 1447.53 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip780)" d="M1952.89 1830.92 L1975.11 1830.92 L1975.11 1832.91 L1962.56 1865.48 L1957.68 1865.48 L1969.48 1834.86 L1952.89 1834.86 L1952.89 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip780)" d="M1984.27 1830.92 L2002.63 1830.92 L2002.63 1834.86 L1988.56 1834.86 L1988.56 1843.33 Q1989.58 1842.98 1990.59 1842.82 Q1991.61 1842.64 1992.63 1842.64 Q1998.42 1842.64 2001.8 1845.81 Q2005.18 1848.98 2005.18 1854.4 Q2005.18 1859.97 2001.7 1863.08 Q1998.23 1866.15 1991.91 1866.15 Q1989.74 1866.15 1987.47 1865.78 Q1985.22 1865.41 1982.82 1864.67 L1982.82 1859.97 Q1984.9 1861.11 1987.12 1861.66 Q1989.34 1862.22 1991.82 1862.22 Q1995.83 1862.22 1998.16 1860.11 Q2000.5 1858.01 2000.5 1854.4 Q2000.5 1850.78 1998.16 1848.68 Q1995.83 1846.57 1991.82 1846.57 Q1989.95 1846.57 1988.07 1846.99 Q1986.22 1847.4 1984.27 1848.28 L1984.27 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip780)" d="M2024.39 1834 Q2020.78 1834 2018.95 1837.57 Q2017.14 1841.11 2017.14 1848.24 Q2017.14 1855.34 2018.95 1858.91 Q2020.78 1862.45 2024.39 1862.45 Q2028.02 1862.45 2029.83 1858.91 Q2031.66 1855.34 2031.66 1848.24 Q2031.66 1841.11 2029.83 1837.57 Q2028.02 1834 2024.39 1834 M2024.39 1830.3 Q2030.2 1830.3 2033.26 1834.9 Q2036.33 1839.49 2036.33 1848.24 Q2036.33 1856.96 2033.26 1861.57 Q2030.2 1866.15 2024.39 1866.15 Q2018.58 1866.15 2015.5 1861.57 Q2012.45 1856.96 2012.45 1848.24 Q2012.45 1839.49 2015.5 1834.9 Q2018.58 1830.3 2024.39 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip780)" d="M2516.11 1861.55 L2523.75 1861.55 L2523.75 1835.18 L2515.44 1836.85 L2515.44 1832.59 L2523.71 1830.92 L2528.38 1830.92 L2528.38 1861.55 L2536.02 1861.55 L2536.02 1865.48 L2516.11 1865.48 L2516.11 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip780)" d="M2555.47 1834 Q2551.85 1834 2550.03 1837.57 Q2548.22 1841.11 2548.22 1848.24 Q2548.22 1855.34 2550.03 1858.91 Q2551.85 1862.45 2555.47 1862.45 Q2559.1 1862.45 2560.9 1858.91 Q2562.73 1855.34 2562.73 1848.24 Q2562.73 1841.11 2560.9 1837.57 Q2559.1 1834 2555.47 1834 M2555.47 1830.3 Q2561.28 1830.3 2564.33 1834.9 Q2567.41 1839.49 2567.41 1848.24 Q2567.41 1856.96 2564.33 1861.57 Q2561.28 1866.15 2555.47 1866.15 Q2549.66 1866.15 2546.58 1861.57 Q2543.52 1856.96 2543.52 1848.24 Q2543.52 1839.49 2546.58 1834.9 Q2549.66 1830.3 2555.47 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip780)" d="M2585.63 1834 Q2582.02 1834 2580.19 1837.57 Q2578.38 1841.11 2578.38 1848.24 Q2578.38 1855.34 2580.19 1858.91 Q2582.02 1862.45 2585.63 1862.45 Q2589.26 1862.45 2591.07 1858.91 Q2592.9 1855.34 2592.9 1848.24 Q2592.9 1841.11 2591.07 1837.57 Q2589.26 1834 2585.63 1834 M2585.63 1830.3 Q2591.44 1830.3 2594.49 1834.9 Q2597.57 1839.49 2597.57 1848.24 Q2597.57 1856.96 2594.49 1861.57 Q2591.44 1866.15 2585.63 1866.15 Q2579.82 1866.15 2576.74 1861.57 Q2573.68 1856.96 2573.68 1848.24 Q2573.68 1839.49 2576.74 1834.9 Q2579.82 1830.3 2585.63 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip780)" d="M2615.79 1834 Q2612.18 1834 2610.35 1837.57 Q2608.54 1841.11 2608.54 1848.24 Q2608.54 1855.34 2610.35 1858.91 Q2612.18 1862.45 2615.79 1862.45 Q2619.42 1862.45 2621.23 1858.91 Q2623.06 1855.34 2623.06 1848.24 Q2623.06 1841.11 2621.23 1837.57 Q2619.42 1834 2615.79 1834 M2615.79 1830.3 Q2621.6 1830.3 2624.65 1834.9 Q2627.73 1839.49 2627.73 1848.24 Q2627.73 1856.96 2624.65 1861.57 Q2621.6 1866.15 2615.79 1866.15 Q2609.98 1866.15 2606.9 1861.57 Q2603.84 1856.96 2603.84 1848.24 Q2603.84 1839.49 2606.9 1834.9 Q2609.98 1830.3 2615.79 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip780)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1800.78 196.816,47.2441 "></polyline>
<polyline clip-path="url(#clip780)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1719.12 215.714,1719.12 "></polyline>
<polyline clip-path="url(#clip780)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1465.93 215.714,1465.93 "></polyline>
<polyline clip-path="url(#clip780)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1212.73 215.714,1212.73 "></polyline>
<polyline clip-path="url(#clip780)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,959.538 215.714,959.538 "></polyline>
<polyline clip-path="url(#clip780)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,706.342 215.714,706.342 "></polyline>
<polyline clip-path="url(#clip780)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,453.147 215.714,453.147 "></polyline>
<polyline clip-path="url(#clip780)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,199.951 215.714,199.951 "></polyline>
<path clip-path="url(#clip780)" d="M50.5475 1719.58 L80.2233 1719.58 L80.2233 1723.51 L50.5475 1723.51 L50.5475 1719.58 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip780)" d="M89.1352 1701.84 L111.357 1701.84 L111.357 1703.83 L98.8111 1736.4 L93.9269 1736.4 L105.732 1705.78 L89.1352 1705.78 L89.1352 1701.84 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip780)" d="M120.478 1730.52 L125.362 1730.52 L125.362 1736.4 L120.478 1736.4 L120.478 1730.52 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip780)" d="M135.593 1701.84 L153.95 1701.84 L153.95 1705.78 L139.876 1705.78 L139.876 1714.25 Q140.894 1713.9 141.913 1713.74 Q142.931 1713.56 143.95 1713.56 Q149.737 1713.56 153.116 1716.73 Q156.496 1719.9 156.496 1725.32 Q156.496 1730.89 153.024 1734 Q149.552 1737.08 143.232 1737.08 Q141.056 1737.08 138.788 1736.7 Q136.542 1736.33 134.135 1735.59 L134.135 1730.89 Q136.218 1732.03 138.441 1732.58 Q140.663 1733.14 143.14 1733.14 Q147.144 1733.14 149.482 1731.03 Q151.82 1728.93 151.82 1725.32 Q151.82 1721.7 149.482 1719.6 Q147.144 1717.49 143.14 1717.49 Q141.265 1717.49 139.39 1717.91 Q137.538 1718.33 135.593 1719.2 L135.593 1701.84 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip780)" d="M49.5521 1466.38 L79.2279 1466.38 L79.2279 1470.32 L49.5521 1470.32 L49.5521 1466.38 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip780)" d="M89.3667 1448.65 L107.723 1448.65 L107.723 1452.58 L93.6491 1452.58 L93.6491 1461.06 Q94.6676 1460.71 95.6861 1460.55 Q96.7047 1460.36 97.7232 1460.36 Q103.51 1460.36 106.89 1463.53 Q110.269 1466.7 110.269 1472.12 Q110.269 1477.7 106.797 1480.8 Q103.325 1483.88 97.0056 1483.88 Q94.8297 1483.88 92.5612 1483.51 Q90.3158 1483.14 87.9084 1482.4 L87.9084 1477.7 Q89.9917 1478.83 92.2139 1479.39 Q94.4361 1479.94 96.913 1479.94 Q100.918 1479.94 103.256 1477.84 Q105.593 1475.73 105.593 1472.12 Q105.593 1468.51 103.256 1466.4 Q100.918 1464.3 96.913 1464.3 Q95.038 1464.3 93.163 1464.71 Q91.3112 1465.13 89.3667 1466.01 L89.3667 1448.65 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip780)" d="M119.482 1477.33 L124.367 1477.33 L124.367 1483.21 L119.482 1483.21 L119.482 1477.33 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip780)" d="M144.552 1451.73 Q140.941 1451.73 139.112 1455.29 Q137.306 1458.83 137.306 1465.96 Q137.306 1473.07 139.112 1476.63 Q140.941 1480.18 144.552 1480.18 Q148.186 1480.18 149.991 1476.63 Q151.82 1473.07 151.82 1465.96 Q151.82 1458.83 149.991 1455.29 Q148.186 1451.73 144.552 1451.73 M144.552 1448.02 Q150.362 1448.02 153.417 1452.63 Q156.496 1457.21 156.496 1465.96 Q156.496 1474.69 153.417 1479.3 Q150.362 1483.88 144.552 1483.88 Q138.741 1483.88 135.663 1479.3 Q132.607 1474.69 132.607 1465.96 Q132.607 1457.21 135.663 1452.63 Q138.741 1448.02 144.552 1448.02 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip780)" d="M50.5475 1213.18 L80.2233 1213.18 L80.2233 1217.12 L50.5475 1217.12 L50.5475 1213.18 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip780)" d="M94.3436 1226.08 L110.663 1226.08 L110.663 1230.01 L88.7186 1230.01 L88.7186 1226.08 Q91.3806 1223.32 95.9639 1218.69 Q100.57 1214.04 101.751 1212.7 Q103.996 1210.18 104.876 1208.44 Q105.779 1206.68 105.779 1204.99 Q105.779 1202.24 103.834 1200.5 Q101.913 1198.76 98.8111 1198.76 Q96.6121 1198.76 94.1584 1199.53 Q91.7278 1200.29 88.9501 1201.84 L88.9501 1197.12 Q91.7741 1195.99 94.2278 1195.41 Q96.6815 1194.83 98.7185 1194.83 Q104.089 1194.83 107.283 1197.51 Q110.478 1200.2 110.478 1204.69 Q110.478 1206.82 109.668 1208.74 Q108.881 1210.64 106.774 1213.23 Q106.195 1213.9 103.094 1217.12 Q99.9917 1220.31 94.3436 1226.08 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip780)" d="M120.478 1224.13 L125.362 1224.13 L125.362 1230.01 L120.478 1230.01 L120.478 1224.13 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip780)" d="M135.593 1195.45 L153.95 1195.45 L153.95 1199.39 L139.876 1199.39 L139.876 1207.86 Q140.894 1207.51 141.913 1207.35 Q142.931 1207.17 143.95 1207.17 Q149.737 1207.17 153.116 1210.34 Q156.496 1213.51 156.496 1218.93 Q156.496 1224.5 153.024 1227.61 Q149.552 1230.68 143.232 1230.68 Q141.056 1230.68 138.788 1230.31 Q136.542 1229.94 134.135 1229.2 L134.135 1224.5 Q136.218 1225.64 138.441 1226.19 Q140.663 1226.75 143.14 1226.75 Q147.144 1226.75 149.482 1224.64 Q151.82 1222.54 151.82 1218.93 Q151.82 1215.31 149.482 1213.21 Q147.144 1211.1 143.14 1211.1 Q141.265 1211.1 139.39 1211.52 Q137.538 1211.93 135.593 1212.81 L135.593 1195.45 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip780)" d="M99.3204 945.336 Q95.7093 945.336 93.8806 948.901 Q92.075 952.443 92.075 959.572 Q92.075 966.679 93.8806 970.244 Q95.7093 973.785 99.3204 973.785 Q102.955 973.785 104.76 970.244 Q106.589 966.679 106.589 959.572 Q106.589 952.443 104.76 948.901 Q102.955 945.336 99.3204 945.336 M99.3204 941.633 Q105.131 941.633 108.186 946.239 Q111.265 950.822 111.265 959.572 Q111.265 968.299 108.186 972.906 Q105.131 977.489 99.3204 977.489 Q93.5102 977.489 90.4315 972.906 Q87.376 968.299 87.376 959.572 Q87.376 950.822 90.4315 946.239 Q93.5102 941.633 99.3204 941.633 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip780)" d="M119.482 970.938 L124.367 970.938 L124.367 976.818 L119.482 976.818 L119.482 970.938 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip780)" d="M144.552 945.336 Q140.941 945.336 139.112 948.901 Q137.306 952.443 137.306 959.572 Q137.306 966.679 139.112 970.244 Q140.941 973.785 144.552 973.785 Q148.186 973.785 149.991 970.244 Q151.82 966.679 151.82 959.572 Q151.82 952.443 149.991 948.901 Q148.186 945.336 144.552 945.336 M144.552 941.633 Q150.362 941.633 153.417 946.239 Q156.496 950.822 156.496 959.572 Q156.496 968.299 153.417 972.906 Q150.362 977.489 144.552 977.489 Q138.741 977.489 135.663 972.906 Q132.607 968.299 132.607 959.572 Q132.607 950.822 135.663 946.239 Q138.741 941.633 144.552 941.633 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip780)" d="M94.3436 719.687 L110.663 719.687 L110.663 723.622 L88.7186 723.622 L88.7186 719.687 Q91.3806 716.932 95.9639 712.303 Q100.57 707.65 101.751 706.307 Q103.996 703.784 104.876 702.048 Q105.779 700.289 105.779 698.599 Q105.779 695.845 103.834 694.108 Q101.913 692.372 98.8111 692.372 Q96.6121 692.372 94.1584 693.136 Q91.7278 693.9 88.9501 695.451 L88.9501 690.729 Q91.7741 689.595 94.2278 689.016 Q96.6815 688.437 98.7185 688.437 Q104.089 688.437 107.283 691.122 Q110.478 693.808 110.478 698.298 Q110.478 700.428 109.668 702.349 Q108.881 704.247 106.774 706.84 Q106.195 707.511 103.094 710.729 Q99.9917 713.923 94.3436 719.687 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip780)" d="M120.478 717.743 L125.362 717.743 L125.362 723.622 L120.478 723.622 L120.478 717.743 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip780)" d="M135.593 689.062 L153.95 689.062 L153.95 692.997 L139.876 692.997 L139.876 701.47 Q140.894 701.122 141.913 700.96 Q142.931 700.775 143.95 700.775 Q149.737 700.775 153.116 703.946 Q156.496 707.118 156.496 712.534 Q156.496 718.113 153.024 721.215 Q149.552 724.293 143.232 724.293 Q141.056 724.293 138.788 723.923 Q136.542 723.553 134.135 722.812 L134.135 718.113 Q136.218 719.247 138.441 719.803 Q140.663 720.358 143.14 720.358 Q147.144 720.358 149.482 718.252 Q151.82 716.145 151.82 712.534 Q151.82 708.923 149.482 706.817 Q147.144 704.71 143.14 704.71 Q141.265 704.71 139.39 705.127 Q137.538 705.544 135.593 706.423 L135.593 689.062 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip780)" d="M89.3667 435.867 L107.723 435.867 L107.723 439.802 L93.6491 439.802 L93.6491 448.274 Q94.6676 447.927 95.6861 447.765 Q96.7047 447.58 97.7232 447.58 Q103.51 447.58 106.89 450.751 Q110.269 453.922 110.269 459.339 Q110.269 464.918 106.797 468.019 Q103.325 471.098 97.0056 471.098 Q94.8297 471.098 92.5612 470.728 Q90.3158 470.357 87.9084 469.617 L87.9084 464.918 Q89.9917 466.052 92.2139 466.607 Q94.4361 467.163 96.913 467.163 Q100.918 467.163 103.256 465.056 Q105.593 462.95 105.593 459.339 Q105.593 455.728 103.256 453.621 Q100.918 451.515 96.913 451.515 Q95.038 451.515 93.163 451.931 Q91.3112 452.348 89.3667 453.228 L89.3667 435.867 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip780)" d="M119.482 464.547 L124.367 464.547 L124.367 470.427 L119.482 470.427 L119.482 464.547 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip780)" d="M144.552 438.945 Q140.941 438.945 139.112 442.51 Q137.306 446.052 137.306 453.181 Q137.306 460.288 139.112 463.853 Q140.941 467.394 144.552 467.394 Q148.186 467.394 149.991 463.853 Q151.82 460.288 151.82 453.181 Q151.82 446.052 149.991 442.51 Q148.186 438.945 144.552 438.945 M144.552 435.242 Q150.362 435.242 153.417 439.848 Q156.496 444.432 156.496 453.181 Q156.496 461.908 153.417 466.515 Q150.362 471.098 144.552 471.098 Q138.741 471.098 135.663 466.515 Q132.607 461.908 132.607 453.181 Q132.607 444.432 135.663 439.848 Q138.741 435.242 144.552 435.242 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip780)" d="M89.1352 182.671 L111.357 182.671 L111.357 184.662 L98.8111 217.231 L93.9269 217.231 L105.732 186.606 L89.1352 186.606 L89.1352 182.671 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip780)" d="M120.478 211.352 L125.362 211.352 L125.362 217.231 L120.478 217.231 L120.478 211.352 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip780)" d="M135.593 182.671 L153.95 182.671 L153.95 186.606 L139.876 186.606 L139.876 195.079 Q140.894 194.731 141.913 194.569 Q142.931 194.384 143.95 194.384 Q149.737 194.384 153.116 197.556 Q156.496 200.727 156.496 206.143 Q156.496 211.722 153.024 214.824 Q149.552 217.903 143.232 217.903 Q141.056 217.903 138.788 217.532 Q136.542 217.162 134.135 216.421 L134.135 211.722 Q136.218 212.856 138.441 213.412 Q140.663 213.967 143.14 213.967 Q147.144 213.967 149.482 211.861 Q151.82 209.755 151.82 206.143 Q151.82 202.532 149.482 200.426 Q147.144 198.319 143.14 198.319 Q141.265 198.319 139.39 198.736 Q137.538 199.153 135.593 200.032 L135.593 182.671 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip782)" style="stroke:#009af9; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="265.984,1490.65 268.292,1602.47 270.6,1495.32 272.908,1464.4 275.216,1549.22 277.524,1543.79 279.832,1449.3 282.139,1345.77 284.447,1701.59 286.755,1408.9 289.063,1517.67 291.371,1412.17 293.679,1455.82 295.987,1615.07 298.295,1480.9 300.603,1486.94 302.911,1453.03 305.219,1649.54 307.527,1375.65 309.834,1388.18 312.142,1515.93 314.45,1370.16 316.758,1433.84 319.066,1481.78 321.374,1482.01 323.682,1486.18 325.99,1500.1 328.298,1455.26 330.606,1283.48 332.914,1258.55 335.221,1143.39 337.529,1507.71 339.837,1415.03 342.145,1479.28 344.453,1464.61 346.761,1458.45 349.069,1523.09 351.377,1498.11 353.685,1532.06 355.993,1510.6 358.301,1409.28 360.608,1302.95 362.916,1431.03 365.224,1416.11 367.532,1272.47 369.84,1567.86 372.148,1495.67 374.456,1422.98 376.764,1508.17 379.072,1493.44 381.38,1418.44 383.688,1447.46 385.996,1526.89 388.303,1507.9 390.611,1535.34 392.919,1456.21 395.227,1584.53 397.535,1544.99 399.843,1522.27 402.151,1590.08 404.459,1552.7 406.767,1650.79 409.075,1629.96 411.383,1267.34 413.69,1568.1 415.998,1619.09 418.306,1517.93 420.614,1453.03 422.922,1611.65 425.23,1222 427.538,1517.59 429.846,1448.01 432.154,1362.31 434.462,1322.75 436.77,1513.84 439.077,1455.4 441.385,1353.64 443.693,1399.07 446.001,1490.49 448.309,1508.71 450.617,1478.75 452.925,1380.97 455.233,1512.85 457.541,1500.25 459.849,1496.47 462.157,1459.51 464.465,1440.3 466.772,1464.79 469.08,1334.3 471.388,1450.48 473.696,1441.35 476.004,1427.14 478.312,1536.58 480.62,1423.59 482.928,1343.55 485.236,1533.09 487.544,1577.19 489.852,1527.81 492.159,1492.68 494.467,1493.03 496.775,1508.28 499.083,1421.27 501.391,1342.4 503.699,1559.73 506.007,1458.19 508.315,1450.12 510.623,1400.16 512.931,1456.81 515.239,1472.78 517.546,1383.18 519.854,1539.08 522.162,1391.55 524.47,1516.36 526.778,1410 529.086,1453.85 531.394,1227.77 533.702,1489.17 536.01,1553.82 538.318,1488.66 540.626,1568.59 542.933,1338.86 545.241,1331.14 547.549,1441.52 549.857,1467.74 552.165,1539.78 554.473,1531.16 556.781,1376.97 559.089,1431.77 561.397,1323.16 563.705,1555.2 566.013,1275.18 568.321,1367.62 570.628,1420.68 572.936,1585.37 575.244,1437.62 577.552,1445.25 579.86,1572.12 582.168,1486.36 584.476,1415.61 586.784,1343.64 589.092,1421.23 591.4,1604.38 593.708,1436.12 596.015,1451.13 598.323,1579.97 600.631,1499.58 602.939,1589.12 605.247,1544.34 607.555,1661.55 609.863,1508.98 612.171,1263.89 614.479,1441.04 616.787,1406.11 619.095,1482.87 621.402,1514.65 623.71,1677.25 626.018,1499.7 628.326,1402.55 630.634,1523.82 632.942,1634.87 635.25,1397.39 637.558,1532.06 639.866,1566.52 642.174,1610.53 644.482,1377.59 646.79,1485.69 649.097,1432.59 651.405,1526.09 653.713,1505.11 656.021,1419.75 658.329,1630.43 660.637,1498.98 662.945,1453.18 665.253,1425.42 667.561,1438.52 669.869,1352.69 672.177,1394.77 674.484,1281.41 676.792,1593.21 679.1,1347.82 681.408,1524.89 683.716,1185.67 686.024,1430.47 688.332,1371.35 690.64,1661.85 692.948,1485.86 695.256,1323.34 697.564,1581.43 699.871,1581.63 702.179,1356.97 704.487,1327.09 706.795,1420.78 709.103,1598.22 711.411,1268.3 713.719,1365.83 716.027,1261.58 718.335,1292.66 720.643,1354.35 722.951,1505.92 725.259,1472.41 727.566,1482.09 729.874,1548.67 732.182,1575.78 734.49,1497.96 736.798,1468.27 739.106,1392.94 741.414,1398.91 743.722,1670.07 746.03,1375.19 748.338,1438.39 750.646,1356.38 752.953,1557.31 755.261,1453.92 757.569,1577.96 759.877,1347.65 762.185,1530.18 764.493,1412.66 766.801,1346.06 769.109,1737.38 771.417,1690.88 773.725,1306.49 776.033,1330.99 778.34,1406.34 780.648,1209.81 782.956,1484.89 785.264,1483.84 787.572,1399.68 789.88,1553.22 792.188,1405.94 794.496,1346.94 796.804,1571.87 799.112,1621.3 801.42,1523.39 803.728,1368.54 806.035,1455.18 808.343,1597.99 810.651,1375.66 812.959,1332.02 815.267,1426.26 817.575,1448.58 819.883,1482.18 822.191,1603.88 824.499,1532.61 826.807,1523.25 829.115,1453.67 831.422,1461.03 833.73,1525.77 836.038,1623.11 838.346,1588.54 840.654,1446.88 842.962,1422.1 845.27,1481.42 847.578,1487.3 849.886,1561.9 852.194,1480.29 854.502,1480.83 856.809,1454.04 859.117,1562.32 861.425,1280.09 863.733,1469.28 866.041,1624.8 868.349,1428.65 870.657,1505.8 872.965,1451.21 875.273,1557.48 877.581,1370.18 879.889,1357.76 882.197,1414.08 884.504,1467.96 886.812,1424.59 889.12,1659.55 891.428,1577.87 893.736,1626.67 896.044,1424.84 898.352,1504.09 900.66,1499.79 902.968,1353.41 905.276,1457.87 907.584,1554.41 909.891,1447.51 912.199,1475.63 914.507,1426.88 916.815,1461.23 919.123,1353.5 921.431,1435.06 923.739,1404.96 926.047,1457.39 928.355,1539.96 930.663,1420.58 932.971,1546.99 935.278,1292.09 937.586,1574.82 939.894,1387.08 942.202,1448.97 944.51,1421.67 946.818,1499.04 949.126,1356.19 951.434,1419.99 953.742,1365.68 956.05,1390.49 958.358,1406.16 960.665,1419.02 962.973,1512.93 965.281,1497.18 967.589,1526.04 969.897,1512.97 972.205,1506.64 974.513,1518.16 976.821,1497.02 979.129,1300.94 981.437,1601.42 983.745,1430.92 986.053,1541.31 988.36,1381.59 990.668,1394.92 992.976,1422.08 995.284,1585.27 997.592,1344.11 999.9,1549.92 1002.21,1566.24 1004.52,1147.01 1006.82,1377.4 1009.13,1411.31 1011.44,1364.01 1013.75,1447.08 1016.06,1585.32 1018.36,1548.34 1020.67,1535.54 1022.98,1303.12 1025.29,1358.82 1027.59,1559.74 1029.9,1473 1032.21,1501.98 1034.52,1564.05 1036.83,1518.81 1039.13,1589.93 1041.44,1477.06 1043.75,1345.45 1046.06,1519.58 1048.37,1313.54 1050.67,1361.49 1052.98,1577.96 1055.29,1276.91 1057.6,1441.93 1059.91,1462.27 1062.21,1377.94 1064.52,1280.92 1066.83,1466.02 1069.14,1364.08 1071.45,1577.24 1073.75,1441.36 1076.06,1540.72 1078.37,1509.22 1080.68,1581.08 1082.98,1350.78 1085.29,1602.59 1087.6,1444.46 1089.91,1435.21 1092.22,1704.86 1094.52,1436.39 1096.83,1413.94 1099.14,1607.11 1101.45,1500.11 1103.76,1702.9 1106.06,1432.51 1108.37,1336.07 1110.68,1535.3 1112.99,1427.39 1115.3,1440.21 1117.6,1283.4 1119.91,1436.09 1122.22,1445.38 1124.53,1454.93 1126.84,1484.84 1129.14,1388.83 1131.45,1358.62 1133.76,1493.74 1136.07,1510.45 1138.37,1551.85 1140.68,1301.23 1142.99,1526.28 1145.3,1470.48 1147.61,1433.73 1149.91,1423.59 1152.22,1535.86 1154.53,1648.45 1156.84,1424.88 1159.15,1595.69 1161.45,1409.68 1163.76,1506.19 1166.07,1719.29 1168.38,1243.54 1170.69,1425.41 1172.99,1163.78 1175.3,1369.81 1177.61,1473.57 1179.92,1462.8 1182.23,1261.07 1184.53,1357 1186.84,1248.71 1189.15,1448.93 1191.46,1510.38 1193.76,1369.91 1196.07,1566.71 1198.38,1507.14 1200.69,1472.35 1203,1478.43 1205.3,1234.27 1207.61,1671.84 1209.92,1648.01 1212.23,1477.24 1214.54,1334.21 1216.84,1269.63 1219.15,1385.24 1221.46,1361.76 1223.77,1407.3 1226.08,1346.21 1228.38,1332.85 1230.69,1358.78 1233,1413.91 1235.31,1562.68 1237.61,1445.84 1239.92,1634.15 1242.23,1330.73 1244.54,1479.47 1246.85,1451.54 1249.15,1267.32 1251.46,1348.25 1253.77,1397.41 1256.08,1561.18 1258.39,1579.54 1260.69,1379.64 1263,1496.28 1265.31,1470.13 1267.62,1467.91 1269.93,1430.79 1272.23,1534.94 1274.54,1430.91 1276.85,1723.02 1279.16,1376.33 1281.47,1429.74 1283.77,1473.68 1286.08,1632.65 1288.39,1396.68 1290.7,1581.62 1293,1403.95 1295.31,1699.08 1297.62,1523.99 1299.93,1420.57 1302.24,1489.93 1304.54,1432.36 1306.85,1408.33 1309.16,1461.14 1311.47,1244.94 1313.78,1453.03 1316.08,1398.81 1318.39,1425.08 1320.7,1523.25 1323.01,1452.51 1325.32,1338.39 1327.62,1624.43 1329.93,1466.36 1332.24,1491.84 1334.55,1327.15 1336.86,1625.56 1339.16,1437.52 1341.47,1384.84 1343.78,1499.92 1346.09,1579.87 1348.39,1487.29 1350.7,1522.67 1353.01,1401.38 1355.32,1553.65 1357.63,1541.88 1359.93,1523.75 1362.24,1532.92 1364.55,1320.78 1366.86,1493.84 1369.17,1535.46 1371.47,1565.54 1373.78,1381.31 1376.09,1484.17 1378.4,1543.2 1380.71,1469.06 1383.01,1226.6 1385.32,1576.73 1387.63,1523.98 1389.94,1591.44 1392.24,1567.25 1394.55,1613.11 1396.86,1446.31 1399.17,1508.63 1401.48,1376.31 1403.78,1375.74 1406.09,1616.47 1408.4,1480.4 1410.71,1527.9 1413.02,1361.75 1415.32,1482.71 1417.63,1428.84 1419.94,1470.86 1422.25,1466.35 1424.56,1485.76 1426.86,1265.79 1429.17,1452.43 1431.48,1362.97 1433.79,1386.24 1436.1,1494.35 1438.4,1490.51 1440.71,1477.2 1443.02,1512.32 1445.33,1277.82 1447.63,1402.17 1449.94,1607.29 1452.25,1652.46 1454.56,1627.93 1456.87,1411.92 1459.17,1493.93 1461.48,1431.47 1463.79,1558.99 1466.1,1391.26 1468.41,1458.14 1470.71,1525.56 1473.02,1640.11 1475.33,1327.32 1477.64,1525.04 1479.95,1468.99 1482.25,1442.45 1484.56,1328.25 1486.87,1316.15 1489.18,1356.52 1491.49,1697.99 1493.79,1419.08 1496.1,1345.86 1498.41,1414.84 1500.72,1468.55 1503.02,1533.33 1505.33,1327.8 1507.64,1371.71 1509.95,1433.16 1512.26,1421.23 1514.56,1616.69 1516.87,1485.74 1519.18,1467.6 1521.49,1545.15 1523.8,1473.52 1526.1,1278.92 1528.41,1545.36 1530.72,1440.98 1533.03,1541.87 1535.34,1425.49 1537.64,1540.1 1539.95,1500.94 1542.26,1400.66 1544.57,1503.78 1546.88,1485.28 1549.18,1537.95 1551.49,1588.28 1553.8,1394.46 1556.11,1302.4 1558.41,1417.06 1560.72,1587.08 1563.03,1533.37 1565.34,1398.39 1567.65,1455.17 1569.95,1551.65 1572.26,1431.01 1574.57,1630.17 1576.88,1501.66 1579.19,1531.43 1581.49,1433.93 1583.8,1261.8 1586.11,1620.72 1588.42,1425.83 1590.73,1413.69 1593.03,1565.94 1595.34,1350.05 1597.65,1514.14 1599.96,1297.37 1602.26,1529.1 1604.57,1557.04 1606.88,1585.66 1609.19,1479.18 1611.5,1683.99 1613.8,1578.68 1616.11,1366.54 1618.42,1339.7 1620.73,1430.14 1623.04,1622.42 1625.34,1465.73 1627.65,1488.09 1629.96,1364.97 1632.27,1429.62 1634.58,1517.2 1636.88,1556.47 1639.19,1445.2 1641.5,1427.99 1643.81,1464.62 1646.12,1348.57 1648.42,1423.21 1650.73,1530.34 1653.04,1520.81 1655.35,1491.38 1657.65,1548 1659.96,1466.99 1662.27,1291.07 1664.58,1357.81 1666.89,1320.61 1669.19,1370.19 1671.5,1418.54 1673.81,1751.15 1676.12,1560.16 1678.43,1356.08 1680.73,1540.64 1683.04,1553.25 1685.35,1486.32 1687.66,1466.27 1689.97,1511.09 1692.27,1561.72 1694.58,1335.71 1696.89,1588.83 1699.2,1436.25 1701.51,1306.89 1703.81,1478.33 1706.12,1394.5 1708.43,1537.43 1710.74,1556.59 1713.04,1500.35 1715.35,1307.26 1717.66,1595.24 1719.97,1601.37 1722.28,1346.13 1724.58,1238.66 1726.89,1262.63 1729.2,1522.14 1731.51,1402.99 1733.82,1439.36 1736.12,1531.64 1738.43,1264.81 1740.74,1559.9 1743.05,1565.95 1745.36,1562.68 1747.66,1520.46 1749.97,1577.68 1752.28,1525.3 1754.59,1501.53 1756.9,1347.43 1759.2,1680.61 1761.51,1371.49 1763.82,1620.78 1766.13,1457.96 1768.43,1464.9 1770.74,1547.13 1773.05,1430.42 1775.36,1274.19 1777.67,1447.49 1779.97,1439.32 1782.28,1500.87 1784.59,1516.04 1786.9,1550.72 1789.21,1394.3 1791.51,1482.61 1793.82,1475.63 1796.13,1432.76 1798.44,1426.84 1800.75,1576.2 1803.05,1330.8 1805.36,1241.19 1807.67,1563.74 1809.98,1457.21 1812.28,1422.1 1814.59,1620.47 1816.9,1536.45 1819.21,1389.63 1821.52,1362.03 1823.82,1390.39 1826.13,1477.36 1828.44,1546.21 1830.75,1625.92 1833.06,1490.39 1835.36,1459.97 1837.67,1376.32 1839.98,1407.56 1842.29,1431.04 1844.6,1403.98 1846.9,1522.97 1849.21,1539.98 1851.52,1513.7 1853.83,1517.85 1856.14,1409.27 1858.44,1383.98 1860.75,1489.51 1863.06,1401.68 1865.37,1411.82 1867.67,1423.43 1869.98,1449.41 1872.29,1601.07 1874.6,1422.48 1876.91,1472.33 1879.21,1557.03 1881.52,1334.32 1883.83,1423.77 1886.14,1379.67 1888.45,1612.93 1890.75,1326.35 1893.06,1562.75 1895.37,1459.41 1897.68,1542.96 1899.99,1517.65 1902.29,1527.96 1904.6,1349.53 1906.91,1245.61 1909.22,1346.89 1911.53,1615.68 1913.83,1444.6 1916.14,1489.55 1918.45,1417.88 1920.76,1373.68 1923.06,1389.63 1925.37,1290.12 1927.68,1305.89 1929.99,1423.27 1932.3,1471.7 1934.6,1319.89 1936.91,1494.26 1939.22,1342.17 1941.53,1525.74 1943.84,1496.51 1946.14,1372.86 1948.45,1482.16 1950.76,1542.41 1953.07,1478.35 1955.38,1280.09 1957.68,1464.66 1959.99,1361.67 1962.3,1432.59 1964.61,1489.03 1966.91,1257.8 1969.22,1371.85 1971.53,1366.16 1973.84,1617.45 1976.15,1395.5 1978.45,1417.87 1980.76,1483.14 1983.07,1647.54 1985.38,1429.02 1987.69,1401.3 1989.99,1480.76 1992.3,1470.89 1994.61,1668.01 1996.92,1588.76 1999.23,1526.96 2001.53,1537.79 2003.84,1461.02 2006.15,1554.6 2008.46,1525.38 2010.77,1427.55 2013.07,1533.77 2015.38,1450.38 2017.69,1422.09 2020,1460.29 2022.3,1514.29 2024.61,1439.31 2026.92,1437.68 2029.23,1331.36 2031.54,1539.5 2033.84,1390.67 2036.15,1521.45 2038.46,1226.88 2040.77,1467.6 2043.08,1481.41 2045.38,1425.12 2047.69,1435.2 2050,1524.09 2052.31,1615.85 2054.62,1462.08 2056.92,1445.65 2059.23,1331.54 2061.54,1577.7 2063.85,1559.2 2066.16,1462.22 2068.46,1374.19 2070.77,1233.6 2073.08,1413.8 2075.39,1660.33 2077.69,1568.67 2080,1524.37 2082.31,1470.44 2084.62,1516.81 2086.93,1479.37 2089.23,1217.34 2091.54,1521.11 2093.85,1387.34 2096.16,1460.5 2098.47,1539.59 2100.77,1363.43 2103.08,1492.51 2105.39,1479.65 2107.7,1484.63 2110.01,1553.3 2112.31,1389.25 2114.62,1377.13 2116.93,1419.89 2119.24,1464.82 2121.55,1545.09 2123.85,1573.16 2126.16,1299.89 2128.47,1611.66 2130.78,1456.33 2133.08,1552.99 2135.39,1487.06 2137.7,1445.83 2140.01,1424.38 2142.32,1465.08 2144.62,1525.42 2146.93,1510.34 2149.24,1454.33 2151.55,1387.55 2153.86,1422.82 2156.16,1349.59 2158.47,1330.65 2160.78,1431.45 2163.09,1328 2165.4,1484.73 2167.7,1413.3 2170.01,1653.74 2172.32,1298.27 2174.63,1314.18 2176.93,1473.37 2179.24,1484.33 2181.55,1395.26 2183.86,1425.06 2186.17,1471.89 2188.47,1353.45 2190.78,1464.26 2193.09,1506.64 2195.4,1405.43 2197.71,1483.25 2200.01,1544.45 2202.32,1546.99 2204.63,1514.04 2206.94,1462.8 2209.25,1570.05 2211.55,1629.13 2213.86,1593.78 2216.17,1493.89 2218.48,1353 2220.79,1343.95 2223.09,1384.73 2225.4,1659.72 2227.71,1465.46 2230.02,1548.18 2232.32,1682.52 2234.63,1673.94 2236.94,1348.76 2239.25,1465.53 2241.56,1315.61 2243.86,1465.84 2246.17,1609.88 2248.48,1366.91 2250.79,1542.19 2253.1,1425.99 2255.4,1571.45 2257.71,1426.42 2260.02,1372.08 2262.33,1521.69 2264.64,1369.96 2266.94,1443.66 2269.25,1424.81 2271.56,1340.71 2273.87,1621.77 2276.18,1471.55 2278.48,1629.7 2280.79,1421.23 2283.1,1545.21 2285.41,1528.51 2287.71,1526.95 2290.02,1476.56 2292.33,1371.43 2294.64,1340.32 2296.95,1458.81 2299.25,1524.6 2301.56,1465.72 2303.87,1432 2306.18,1429.84 2308.49,1560.94 2310.79,1501.25 2313.1,1432.97 2315.41,1501.98 2317.72,1471.64 2320.03,1611.88 2322.33,1443.29 2324.64,1569.3 2326.95,1620.52 2329.26,1476.06 2331.56,1503.4 2333.87,1418.56 2336.18,1501.18 2338.49,1403.39 2340.8,1375.11 2343.1,1332.55 2345.41,1606.06 2347.72,1650.07 2350.03,1433.07 2352.34,1487.7 2354.64,1557.66 2356.95,1484.42 2359.26,1502.4 2361.57,1470.63 2363.88,1513.47 2366.18,1519.19 2368.49,1637.9 2370.8,1642.86 2373.11,1431.86 2375.42,1568.46 2377.72,1337.36 2380.03,1474.29 2382.34,1382.5 2384.65,1229.94 2386.95,1471.56 2389.26,1447.67 2391.57,1512.07 2393.88,1417.73 2396.19,1386.9 2398.49,1617.49 2400.8,1584.21 2403.11,1481.22 2405.42,1608.05 2407.73,1573.76 2410.03,1506.57 2412.34,1451.16 2414.65,1560.42 2416.96,1447.54 2419.27,1661.7 2421.57,1411.49 2423.88,1433.02 2426.19,1525.01 2428.5,1417.81 2430.81,1534.98 2433.11,1433.64 2435.42,1445.14 2437.73,1456.25 2440.04,1506.63 2442.34,1506.99 2444.65,1404.57 2446.96,1522.66 2449.27,1525.03 2451.58,1529.14 2453.88,1490.91 2456.19,1456.45 2458.5,1454.57 2460.81,1524.75 2463.12,1430.73 2465.42,1445.25 2467.73,1535.32 2470.04,1420.04 2472.35,1515.16 2474.66,1384.09 2476.96,1522.04 2479.27,1350.28 2481.58,1489.48 2483.89,1459.05 2486.2,1403.86 2488.5,1416.94 2490.81,1358.46 2493.12,1450.05 2495.43,1447.45 2497.73,1578.56 2500.04,1507.53 2502.35,1467.58 2504.66,1637.12 2506.97,1435.8 2509.27,1494.42 2511.58,1384.22 2513.89,1399.36 2516.2,1641.34 2518.51,1545.91 2520.81,1523.72 2523.12,1434.45 2525.43,1561.28 2527.74,1676.05 2530.05,1478.63 2532.35,1531.03 2534.66,1424.55 2536.97,1549.68 2539.28,1393.36 2541.58,1432.89 2543.89,1378.83 2546.2,1746.25 2548.51,1566.61 2550.82,1532.84 2553.12,1462.71 2555.43,1398.96 2557.74,1606.67 2560.05,1471.25 2562.36,1502.1 2564.66,1316.25 2566.97,1388.66 2569.28,1387.79 2571.59,1572.42 "></polyline>
<polyline clip-path="url(#clip782)" style="stroke:#e26f46; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="265.984,1016.03 268.292,785.154 270.6,979.24 272.908,812.79 275.216,1104.51 277.524,936.506 279.832,748.425 282.139,1008.32 284.447,919.517 286.755,978.747 289.063,1005.24 291.371,1067.24 293.679,896.035 295.987,1009.95 298.295,795.906 300.603,887.698 302.911,898.322 305.219,1040.18 307.527,960.634 309.834,1039.37 312.142,1126.15 314.45,1012.39 316.758,950.55 319.066,1041.45 321.374,1046.78 323.682,1063.08 325.99,907.976 328.298,806.161 330.606,977.141 332.914,1136.97 335.221,819.24 337.529,997.807 339.837,855.722 342.145,906.677 344.453,965.514 346.761,1091 349.069,848.073 351.377,883.093 353.685,1139.76 355.993,925.143 358.301,881.885 360.608,1027.99 362.916,835.897 365.224,786.123 367.532,1156.73 369.84,963.61 372.148,908.722 374.456,985.444 376.764,875.591 379.072,1132.89 381.38,874.859 383.688,989.503 385.996,1007.75 388.303,868.04 390.611,833.506 392.919,1039.58 395.227,963.043 397.535,1001.87 399.843,1056.71 402.151,825.108 404.459,941.594 406.767,916.876 409.075,912.13 411.383,1017.49 413.69,978.115 415.998,951.53 418.306,973.276 420.614,823.55 422.922,1020.89 425.23,963.242 427.538,997.002 429.846,922.353 432.154,978.874 434.462,877.545 436.77,730.708 439.077,758.633 441.385,1039.24 443.693,928.795 446.001,954.52 448.309,884.922 450.617,1129.04 452.925,925.96 455.233,880.605 457.541,977.388 459.849,1034.53 462.157,956.976 464.465,1070.96 466.772,1281.4 469.08,860.977 471.388,995.897 473.696,965.31 476.004,851.888 478.312,978.81 480.62,821.143 482.928,892.44 485.236,883.196 487.544,944.157 489.852,957.149 492.159,1015.44 494.467,1033.8 496.775,960.235 499.083,980.274 501.391,1073.63 503.699,1007.9 506.007,1072.46 508.315,862.545 510.623,1054.58 512.931,975.196 515.239,966.541 517.546,868.809 519.854,1103.03 522.162,956.556 524.47,743.615 526.778,913.883 529.086,1093.91 531.394,855.847 533.702,902.911 536.01,940.152 538.318,812.368 540.626,790.372 542.933,848.692 545.241,995.45 547.549,994.306 549.857,1012.47 552.165,868.492 554.473,820.934 556.781,1096.41 559.089,974.72 561.397,926.179 563.705,958.033 566.013,1063.97 568.321,1043.65 570.628,915.996 572.936,1068.38 575.244,967.376 577.552,1137.69 579.86,1019.97 582.168,903.901 584.476,1063.78 586.784,1106.47 589.092,879.98 591.4,1004.35 593.708,1151.4 596.015,878.797 598.323,739.697 600.631,909.928 602.939,1075.31 605.247,867.727 607.555,889.495 609.863,1017.07 612.171,1064.72 614.479,863.064 616.787,1003.59 619.095,869.729 621.402,944.454 623.71,828.224 626.018,1008.64 628.326,832.895 630.634,851.257 632.942,1049.97 635.25,1117.39 637.558,947.636 639.866,1064.48 642.174,973.708 644.482,982.973 646.79,1026.51 649.097,1062.84 651.405,1012.21 653.713,844.946 656.021,974.827 658.329,1139.43 660.637,852.834 662.945,1063.07 665.253,920.956 667.561,949.695 669.869,752.054 672.177,1060.88 674.484,986.078 676.792,1106.58 679.1,1107.81 681.408,891.932 683.716,928.541 686.024,1113.72 688.332,854.885 690.64,1019.58 692.948,932.287 695.256,1024.2 697.564,930.942 699.871,895.911 702.179,915.866 704.487,849.245 706.795,1088.13 709.103,858.85 711.411,1021.22 713.719,861.704 716.027,1055.96 718.335,820.505 720.643,884.867 722.951,914.598 725.259,904.002 727.566,1007.89 729.874,934.375 732.182,961.702 734.49,1011.1 736.798,908.946 739.106,807.213 741.414,1003.75 743.722,973.926 746.03,1096.39 748.338,1113.35 750.646,940.798 752.953,1015.15 755.261,914.725 757.569,1011.62 759.877,1063.95 762.185,965.978 764.493,888.671 766.801,910.009 769.109,879.428 771.417,906.126 773.725,1021.3 776.033,989.909 778.34,861.213 780.648,973.124 782.956,890.036 785.264,1022.26 787.572,834.802 789.88,953.187 792.188,1109.25 794.496,959.156 796.804,978.205 799.112,850.215 801.42,963.892 803.728,1017.7 806.035,930.446 808.343,1010.41 810.651,978.777 812.959,851.616 815.267,847.255 817.575,964.198 819.883,790.202 822.191,1066.83 824.499,867.455 826.807,882.51 829.115,988.595 831.422,1009.98 833.73,1217.74 836.038,1003.47 838.346,959.043 840.654,1012.75 842.962,927.414 845.27,870.535 847.578,919.33 849.886,846.289 852.194,895.521 854.502,1225.2 856.809,918.239 859.117,932.65 861.425,881.749 863.733,981.124 866.041,872.248 868.349,1069.69 870.657,1091.56 872.965,979.962 875.273,933.686 877.581,1077.22 879.889,1081.64 882.197,922.421 884.504,900.214 886.812,961.305 889.12,853.064 891.428,1103.9 893.736,951.701 896.044,1101.5 898.352,923.771 900.66,1030.9 902.968,845.891 905.276,949.702 907.584,1050.97 909.891,975.287 912.199,897.775 914.507,752.106 916.815,1180.44 919.123,917.928 921.431,844.491 923.739,920.949 926.047,974.372 928.355,934.147 930.663,1162.11 932.971,1052.82 935.278,1020.95 937.586,816.661 939.894,1038.59 942.202,875.035 944.51,1224.71 946.818,933.499 949.126,970.944 951.434,958.124 953.742,1077.29 956.05,1040.58 958.358,953.928 960.665,933.119 962.973,975.884 965.281,894.488 967.589,852.02 969.897,958.691 972.205,860.444 974.513,985.32 976.821,926.672 979.129,1155.4 981.437,976.998 983.745,879.317 986.053,925.83 988.36,894.356 990.668,1272.29 992.976,957.677 995.284,1164.74 997.592,1135.37 999.9,759.275 1002.21,1031.15 1004.52,737.008 1006.82,868.647 1009.13,943.624 1011.44,949.535 1013.75,942.517 1016.06,1108.22 1018.36,1067.96 1020.67,851.272 1022.98,1146.55 1025.29,882.028 1027.59,987.515 1029.9,881.384 1032.21,1057.1 1034.52,763.454 1036.83,1041.37 1039.13,1099.6 1041.44,940.032 1043.75,849.978 1046.06,1034.81 1048.37,1091.21 1050.67,921.742 1052.98,992.452 1055.29,849.792 1057.6,897.935 1059.91,1096.16 1062.21,1108.92 1064.52,1060.53 1066.83,1010.92 1069.14,867.367 1071.45,1003.79 1073.75,943.192 1076.06,1019.08 1078.37,1002.58 1080.68,1002.42 1082.98,887.268 1085.29,1098.4 1087.6,962.936 1089.91,886.546 1092.22,818.739 1094.52,891.419 1096.83,830.63 1099.14,1012.19 1101.45,1058.53 1103.76,896.488 1106.06,975.279 1108.37,974.466 1110.68,958.118 1112.99,1114.31 1115.3,912.941 1117.6,963.641 1119.91,923.673 1122.22,899.992 1124.53,928.49 1126.84,939.317 1129.14,1015.62 1131.45,927.103 1133.76,902.545 1136.07,1056.21 1138.37,839.527 1140.68,1102.78 1142.99,862.739 1145.3,932.588 1147.61,1125.56 1149.91,1016.26 1152.22,868.632 1154.53,950.682 1156.84,972.393 1159.15,986.105 1161.45,952.406 1163.76,907.036 1166.07,951.609 1168.38,1053.27 1170.69,911.497 1172.99,849.374 1175.3,1055.38 1177.61,946.703 1179.92,994.741 1182.23,850.216 1184.53,879.475 1186.84,910.827 1189.15,978.878 1191.46,951.7 1193.76,832.907 1196.07,881.691 1198.38,1110.44 1200.69,885.754 1203,1052.4 1205.3,963.821 1207.61,772.953 1209.92,984.732 1212.23,790.5 1214.54,924.498 1216.84,1024.17 1219.15,965.136 1221.46,859.477 1223.77,965.572 1226.08,1106.5 1228.38,983.377 1230.69,920.53 1233,1000.1 1235.31,956.267 1237.61,797.308 1239.92,786.33 1242.23,832.809 1244.54,950.288 1246.85,925.163 1249.15,888.213 1251.46,1013.16 1253.77,925.354 1256.08,1110.18 1258.39,881.817 1260.69,936.277 1263,916.751 1265.31,1025.75 1267.62,890.225 1269.93,1015.7 1272.23,993.986 1274.54,971.58 1276.85,721.442 1279.16,1054.29 1281.47,1018.84 1283.77,1240.57 1286.08,887.914 1288.39,881.316 1290.7,871.98 1293,1023.14 1295.31,1126.11 1297.62,982.68 1299.93,835.01 1302.24,1068.85 1304.54,1023.65 1306.85,922.511 1309.16,852.614 1311.47,927.442 1313.78,945.576 1316.08,1019.3 1318.39,1048.57 1320.7,985.04 1323.01,1000.53 1325.32,981.768 1327.62,1091.4 1329.93,1034.85 1332.24,1126.76 1334.55,928.243 1336.86,835.885 1339.16,870.768 1341.47,915.124 1343.78,1095.73 1346.09,959.32 1348.39,890.703 1350.7,996.258 1353.01,1173.62 1355.32,935.372 1357.63,1075.86 1359.93,961.357 1362.24,1041.2 1364.55,779.281 1366.86,1126.34 1369.17,919.986 1371.47,1000.02 1373.78,989.696 1376.09,839.074 1378.4,1027.52 1380.71,1003.24 1383.01,1200.1 1385.32,1027.23 1387.63,1044.92 1389.94,1064.25 1392.24,1093.3 1394.55,807.39 1396.86,993.785 1399.17,930.693 1401.48,1003.93 1403.78,1042.67 1406.09,1041.94 1408.4,1116.82 1410.71,869.406 1413.02,1164.01 1415.32,1032.69 1417.63,1002.22 1419.94,874.089 1422.25,853.507 1424.56,937.592 1426.86,1053.34 1429.17,912.933 1431.48,826.038 1433.79,970.308 1436.1,1059.8 1438.4,1084.38 1440.71,1044.4 1443.02,1048.96 1445.33,1029.26 1447.63,1053.17 1449.94,764.856 1452.25,1048.94 1454.56,982.735 1456.87,934.036 1459.17,1021.45 1461.48,1009.9 1463.79,1060.7 1466.1,887.276 1468.41,1079.79 1470.71,1001.9 1473.02,1130.19 1475.33,952.917 1477.64,900.099 1479.95,828.834 1482.25,771.27 1484.56,1055.82 1486.87,871.365 1489.18,920.762 1491.49,1004.74 1493.79,970.578 1496.1,823.466 1498.41,1017.56 1500.72,994.697 1503.02,1038.99 1505.33,1028.22 1507.64,1132.54 1509.95,1091.97 1512.26,1003.08 1514.56,1068.8 1516.87,844.005 1519.18,953.995 1521.49,885.564 1523.8,1036.54 1526.1,892.728 1528.41,1051.53 1530.72,918.13 1533.03,809.147 1535.34,1067.2 1537.64,953.706 1539.95,1042.34 1542.26,1144.01 1544.57,888.76 1546.88,792.03 1549.18,975.482 1551.49,1054.83 1553.8,1007.16 1556.11,970.942 1558.41,974.019 1560.72,882.646 1563.03,912.114 1565.34,825.233 1567.65,959.685 1569.95,1042.16 1572.26,836.05 1574.57,1034.74 1576.88,1018.81 1579.19,1071.61 1581.49,928.585 1583.8,948.78 1586.11,990.232 1588.42,817.87 1590.73,1084.28 1593.03,943.331 1595.34,896.688 1597.65,937.754 1599.96,944.149 1602.26,1002.02 1604.57,1042.26 1606.88,951.814 1609.19,912.655 1611.5,1013.8 1613.8,951.109 1616.11,1018.86 1618.42,838.041 1620.73,1116.8 1623.04,948.654 1625.34,848.042 1627.65,938.98 1629.96,1003.61 1632.27,875.763 1634.58,868.383 1636.88,941.124 1639.19,879.677 1641.5,911.643 1643.81,983.378 1646.12,1108.75 1648.42,864.659 1650.73,902.976 1653.04,1030.31 1655.35,1155.19 1657.65,1141.86 1659.96,1120.16 1662.27,951.851 1664.58,946.312 1666.89,959.176 1669.19,958.611 1671.5,892.988 1673.81,1003.4 1676.12,1058.53 1678.43,1028.75 1680.73,979.68 1683.04,1090.74 1685.35,1203.12 1687.66,865.011 1689.97,987.48 1692.27,1133.48 1694.58,888.161 1696.89,966.64 1699.2,1028.05 1701.51,1119.34 1703.81,848.889 1706.12,951.039 1708.43,892.317 1710.74,951.154 1713.04,1090.51 1715.35,907.681 1717.66,853.449 1719.97,1077.57 1722.28,1061.77 1724.58,876.785 1726.89,935.781 1729.2,830.431 1731.51,734.108 1733.82,1080.01 1736.12,1115.94 1738.43,811.502 1740.74,1069.16 1743.05,1078.35 1745.36,1043.35 1747.66,823.3 1749.97,910.67 1752.28,1057.62 1754.59,630.074 1756.9,1033.49 1759.2,1058.58 1761.51,887 1763.82,957.607 1766.13,971.579 1768.43,945.409 1770.74,960.518 1773.05,1002.36 1775.36,996.467 1777.67,953.302 1779.97,1046.1 1782.28,934.734 1784.59,963.307 1786.9,954.716 1789.21,1103.97 1791.51,884.349 1793.82,994.823 1796.13,1073.6 1798.44,870.075 1800.75,915.86 1803.05,975.414 1805.36,989.648 1807.67,1092.8 1809.98,742.879 1812.28,1018.18 1814.59,798.699 1816.9,836.795 1819.21,945.027 1821.52,971.31 1823.82,817.846 1826.13,959.043 1828.44,918.202 1830.75,1085.25 1833.06,1037.89 1835.36,931.296 1837.67,844.741 1839.98,790.07 1842.29,785.993 1844.6,845.947 1846.9,1016.42 1849.21,1001.68 1851.52,1099.29 1853.83,926.761 1856.14,901.335 1858.44,1056.77 1860.75,963.488 1863.06,967.759 1865.37,938.633 1867.67,1007.7 1869.98,884.835 1872.29,1114.76 1874.6,1054.6 1876.91,862.047 1879.21,1064.56 1881.52,957.421 1883.83,869.86 1886.14,1014.42 1888.45,1053.97 1890.75,961.548 1893.06,885.378 1895.37,909.575 1897.68,1073 1899.99,959.422 1902.29,1036.64 1904.6,867.82 1906.91,969.813 1909.22,898.018 1911.53,1073.38 1913.83,906.061 1916.14,899.095 1918.45,714.673 1920.76,916.246 1923.06,1091.44 1925.37,932.096 1927.68,901.84 1929.99,1121.68 1932.3,1045.35 1934.6,841.303 1936.91,951.276 1939.22,954.511 1941.53,984.105 1943.84,1028.91 1946.14,851.429 1948.45,969.926 1950.76,819.127 1953.07,873.534 1955.38,1093.75 1957.68,1044.5 1959.99,852.658 1962.3,986.918 1964.61,936.641 1966.91,859.514 1969.22,802.854 1971.53,1039.24 1973.84,790.608 1976.15,860.071 1978.45,950.438 1980.76,883.96 1983.07,1019.57 1985.38,1184.56 1987.69,873.026 1989.99,1073.68 1992.3,1050.67 1994.61,820.219 1996.92,1049.72 1999.23,997.66 2001.53,1051.35 2003.84,1136.66 2006.15,956.87 2008.46,945.036 2010.77,848.71 2013.07,989.435 2015.38,977.727 2017.69,843.563 2020,999.067 2022.3,1037.15 2024.61,975.121 2026.92,1021.62 2029.23,1206.7 2031.54,978.99 2033.84,1023.32 2036.15,972.77 2038.46,684.453 2040.77,867.903 2043.08,992.273 2045.38,901.64 2047.69,983.256 2050,812.044 2052.31,867.497 2054.62,967.236 2056.92,957.419 2059.23,1032.42 2061.54,929.974 2063.85,958.333 2066.16,1107.26 2068.46,1008.95 2070.77,1120.94 2073.08,1042.68 2075.39,962.957 2077.69,1071.64 2080,1214.93 2082.31,808.272 2084.62,1000.5 2086.93,1002.74 2089.23,1137.25 2091.54,955.377 2093.85,739.694 2096.16,1108.36 2098.47,1087.02 2100.77,970.108 2103.08,984.738 2105.39,1003.45 2107.7,987.781 2110.01,1018.9 2112.31,811.177 2114.62,1097.4 2116.93,1004.17 2119.24,1000.87 2121.55,999.075 2123.85,1009.68 2126.16,981.531 2128.47,1073.78 2130.78,842.196 2133.08,1103.11 2135.39,1010.7 2137.7,1060.35 2140.01,964.703 2142.32,902.931 2144.62,1026.85 2146.93,908.14 2149.24,900.819 2151.55,1094.41 2153.86,776.445 2156.16,969.457 2158.47,969.723 2160.78,1006.78 2163.09,1001.47 2165.4,880.949 2167.7,885.9 2170.01,885.166 2172.32,1037.79 2174.63,706.892 2176.93,1120.33 2179.24,1089.03 2181.55,886.015 2183.86,881.57 2186.17,796.315 2188.47,1019.62 2190.78,1033.36 2193.09,1015.66 2195.4,1154.61 2197.71,1025.25 2200.01,838.706 2202.32,948.985 2204.63,1035.16 2206.94,970.971 2209.25,981.37 2211.55,1057.05 2213.86,823.716 2216.17,1069.07 2218.48,909.61 2220.79,893.889 2223.09,841.472 2225.4,930.181 2227.71,1113.97 2230.02,1013.93 2232.32,1060.22 2234.63,1078.34 2236.94,950.178 2239.25,961.681 2241.56,887.45 2243.86,916.344 2246.17,947.635 2248.48,1031.23 2250.79,912.715 2253.1,923.06 2255.4,910.281 2257.71,957.773 2260.02,839.803 2262.33,1023.78 2264.64,1122.55 2266.94,866.886 2269.25,944.66 2271.56,961.827 2273.87,1034.07 2276.18,944.941 2278.48,899.92 2280.79,899.489 2283.1,1029.52 2285.41,916.706 2287.71,1043.52 2290.02,912.94 2292.33,831.972 2294.64,1004.92 2296.95,795.326 2299.25,1106.51 2301.56,999.179 2303.87,840.275 2306.18,831.067 2308.49,783.945 2310.79,880.341 2313.1,942.283 2315.41,867.977 2317.72,818.056 2320.03,925.407 2322.33,924.345 2324.64,894.648 2326.95,850.005 2329.26,837.112 2331.56,858.985 2333.87,1005.87 2336.18,1084.9 2338.49,1046.38 2340.8,1030.1 2343.1,1114.66 2345.41,1032.69 2347.72,887.406 2350.03,1046.31 2352.34,1016.03 2354.64,939.41 2356.95,952.915 2359.26,861.501 2361.57,995.311 2363.88,1137.7 2366.18,894.815 2368.49,903.737 2370.8,859.964 2373.11,991.381 2375.42,1115.99 2377.72,881.897 2380.03,821.145 2382.34,839.627 2384.65,998.102 2386.95,859.025 2389.26,1008.16 2391.57,1028.77 2393.88,925.986 2396.19,910.292 2398.49,923.325 2400.8,993.098 2403.11,771.095 2405.42,1017.56 2407.73,1179.85 2410.03,956.913 2412.34,938.602 2414.65,840.887 2416.96,924.238 2419.27,1007.78 2421.57,887.675 2423.88,1109.08 2426.19,916.346 2428.5,841.547 2430.81,827.221 2433.11,791.52 2435.42,964.843 2437.73,787.811 2440.04,919.825 2442.34,1064.41 2444.65,952.276 2446.96,983.372 2449.27,1025.11 2451.58,822.357 2453.88,950.451 2456.19,994.031 2458.5,744.786 2460.81,1093.46 2463.12,875.14 2465.42,941.673 2467.73,957.661 2470.04,885.935 2472.35,946.311 2474.66,844.168 2476.96,991.135 2479.27,943.891 2481.58,933.421 2483.89,1059.92 2486.2,1073.79 2488.5,1030.1 2490.81,838.429 2493.12,878.758 2495.43,834.46 2497.73,1003.83 2500.04,1014.72 2502.35,944.605 2504.66,916.877 2506.97,1015.33 2509.27,968.674 2511.58,813.462 2513.89,863.107 2516.2,1049.38 2518.51,873.312 2520.81,729.117 2523.12,1032.08 2525.43,879.45 2527.74,871.319 2530.05,639.904 2532.35,862.526 2534.66,842.948 2536.97,856.418 2539.28,983.14 2541.58,815.429 2543.89,1055.78 2546.2,1032.48 2548.51,808.353 2550.82,935.475 2553.12,1036.89 2555.43,904.826 2557.74,946.629 2560.05,864.681 2562.36,934.275 2564.66,923.282 2566.97,864.304 2569.28,955.948 2571.59,763.327 "></polyline>
<polyline clip-path="url(#clip782)" style="stroke:#3da44d; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="265.984,897.751 268.292,393.509 270.6,253.602 272.908,464.455 275.216,536.666 277.524,266.138 279.832,378.886 282.139,148.34 284.447,263.418 286.755,343.706 289.063,452.241 291.371,540.603 293.679,268.382 295.987,462.191 298.295,328.97 300.603,325.585 302.911,372.106 305.219,506.974 307.527,381.649 309.834,493.801 312.142,507.401 314.45,600.006 316.758,296.244 319.066,524.881 321.374,544.574 323.682,366.801 325.99,588.065 328.298,472.048 330.606,356.665 332.914,347.444 335.221,434.297 337.529,429.049 339.837,385.463 342.145,506.093 344.453,299.973 346.761,634.918 349.069,139.249 351.377,519.392 353.685,471.637 355.993,595.275 358.301,117.059 360.608,561.746 362.916,504.216 365.224,445.456 367.532,524.247 369.84,542.327 372.148,519.186 374.456,611.195 376.764,388.724 379.072,520.957 381.38,398.848 383.688,370.223 385.996,427.848 388.303,508.867 390.611,428.233 392.919,327.935 395.227,432.486 397.535,461.061 399.843,491.381 402.151,431.648 404.459,416.346 406.767,725.991 409.075,532.439 411.383,411.659 413.69,402.201 415.998,474.831 418.306,382.82 420.614,526.384 422.922,500.977 425.23,505.502 427.538,508.009 429.846,325.873 432.154,641.8 434.462,399.514 436.77,434.073 439.077,571.237 441.385,425.566 443.693,509.119 446.001,441.776 448.309,716.974 450.617,430.145 452.925,598.261 455.233,321.737 457.541,640.393 459.849,493.979 462.157,410.002 464.465,458.387 466.772,595.119 469.08,315.567 471.388,557.419 473.696,414.685 476.004,366.233 478.312,522.983 480.62,416.822 482.928,235.519 485.236,474.23 487.544,406.196 489.852,629.058 492.159,522.071 494.467,400.18 496.775,591.467 499.083,546.961 501.391,442.752 503.699,397.829 506.007,489.77 508.315,510.877 510.623,324.422 512.931,347.949 515.239,388.474 517.546,578.983 519.854,394.956 522.162,490.359 524.47,463.977 526.778,372.623 529.086,276.375 531.394,667.978 533.702,380.905 536.01,654.081 538.318,540.329 540.626,522.431 542.933,507.045 545.241,294.314 547.549,503.976 549.857,390.253 552.165,441.867 554.473,528.61 556.781,631.643 559.089,484.177 561.397,459.444 563.705,446.022 566.013,529.5 568.321,555.965 570.628,502.919 572.936,548.274 575.244,564.034 577.552,392.74 579.86,374.025 582.168,364.336 584.476,306.727 586.784,501.369 589.092,287.062 591.4,305.212 593.708,556.996 596.015,489.627 598.323,530.92 600.631,432.346 602.939,485.516 605.247,409.226 607.555,472.056 609.863,581.3 612.171,513.014 614.479,423.587 616.787,644.711 619.095,382.819 621.402,447.331 623.71,555.107 626.018,632.532 628.326,482.127 630.634,484.311 632.942,385.481 635.25,118.613 637.558,373.472 639.866,529.26 642.174,474.763 644.482,684.191 646.79,580.401 649.097,314.896 651.405,262.283 653.713,282.624 656.021,343.857 658.329,444.801 660.637,345.743 662.945,379.854 665.253,470.594 667.561,411.97 669.869,527.476 672.177,400.466 674.484,531.197 676.792,307.4 679.1,393.152 681.408,541.673 683.716,561.578 686.024,549.397 688.332,405.804 690.64,512.265 692.948,416.083 695.256,409.031 697.564,594.61 699.871,535.32 702.179,417.878 704.487,514.835 706.795,514.009 709.103,315.19 711.411,311.264 713.719,680.867 716.027,411.379 718.335,489.35 720.643,650.525 722.951,212.31 725.259,347.188 727.566,180.189 729.874,474.526 732.182,484.474 734.49,550.146 736.798,553.94 739.106,361.931 741.414,612.311 743.722,431.565 746.03,300.017 748.338,612.193 750.646,476.724 752.953,657.466 755.261,415.31 757.569,452.285 759.877,484.733 762.185,450.543 764.493,600.168 766.801,313.042 769.109,340.231 771.417,473.649 773.725,395.088 776.033,473.486 778.34,359.207 780.648,465.62 782.956,401.945 785.264,433.565 787.572,321.915 789.88,448.523 792.188,386.868 794.496,467.593 796.804,405.791 799.112,574.059 801.42,292.893 803.728,314.627 806.035,387.721 808.343,343.184 810.651,625.751 812.959,472.391 815.267,516.862 817.575,523.936 819.883,430.133 822.191,422.74 824.499,460.488 826.807,538.457 829.115,451.354 831.422,286.628 833.73,373.338 836.038,265.899 838.346,481.792 840.654,376.207 842.962,429.181 845.27,335.15 847.578,366.499 849.886,371.839 852.194,248.193 854.502,426.807 856.809,562.616 859.117,515.903 861.425,538.351 863.733,305.074 866.041,648.668 868.349,326.757 870.657,494.33 872.965,302.26 875.273,283.986 877.581,377.188 879.889,622.334 882.197,313.987 884.504,431.779 886.812,512.339 889.12,527.734 891.428,475.665 893.736,572.235 896.044,542.078 898.352,433.248 900.66,423.049 902.968,428.673 905.276,502.453 907.584,560.688 909.891,569.447 912.199,414.392 914.507,494.58 916.815,469.23 919.123,420.366 921.431,364.374 923.739,447.99 926.047,585.373 928.355,391.345 930.663,407.857 932.971,340.335 935.278,369.502 937.586,513.989 939.894,426.877 942.202,402.986 944.51,247.017 946.818,468.122 949.126,578.466 951.434,512.786 953.742,263.584 956.05,475.212 958.358,601.946 960.665,554.167 962.973,599.065 965.281,574.204 967.589,396.742 969.897,364.381 972.205,467.147 974.513,561.031 976.821,395.179 979.129,261.797 981.437,582.327 983.745,420.605 986.053,332.751 988.36,474.869 990.668,547.646 992.976,444.874 995.284,145.376 997.592,400.132 999.9,521.527 1002.21,382.068 1004.52,393.199 1006.82,653.763 1009.13,544.665 1011.44,452.562 1013.75,562.219 1016.06,512.49 1018.36,510.638 1020.67,366.075 1022.98,491.863 1025.29,442.949 1027.59,463.066 1029.9,283.102 1032.21,428.971 1034.52,363.509 1036.83,430.673 1039.13,581.869 1041.44,631.285 1043.75,574.331 1046.06,530.214 1048.37,330.318 1050.67,426.614 1052.98,541.142 1055.29,398.815 1057.6,363.74 1059.91,640.07 1062.21,595.106 1064.52,428.526 1066.83,340.691 1069.14,571.21 1071.45,519.503 1073.75,390.239 1076.06,539.949 1078.37,566.186 1080.68,416.977 1082.98,613.201 1085.29,539.184 1087.6,477.399 1089.91,410.528 1092.22,412.213 1094.52,548.341 1096.83,451.918 1099.14,349.608 1101.45,430.82 1103.76,431.917 1106.06,282.586 1108.37,550.241 1110.68,506.01 1112.99,358.541 1115.3,484.21 1117.6,185.104 1119.91,674.423 1122.22,414.539 1124.53,469.19 1126.84,447.051 1129.14,438.991 1131.45,385.723 1133.76,394.859 1136.07,542.295 1138.37,337.702 1140.68,486.921 1142.99,510.673 1145.3,303.423 1147.61,463.371 1149.91,521.474 1152.22,573.974 1154.53,368.748 1156.84,406.392 1159.15,651.335 1161.45,327.537 1163.76,445.215 1166.07,440.36 1168.38,418.617 1170.69,652.231 1172.99,510.879 1175.3,601.325 1177.61,521.032 1179.92,354.657 1182.23,265.122 1184.53,595.864 1186.84,451.069 1189.15,408.473 1191.46,481.472 1193.76,616.257 1196.07,425.394 1198.38,501.643 1200.69,370.567 1203,539.812 1205.3,474.124 1207.61,438.874 1209.92,519.194 1212.23,437.692 1214.54,439.775 1216.84,579.268 1219.15,575.401 1221.46,552.584 1223.77,426.299 1226.08,363.234 1228.38,585.972 1230.69,397.834 1233,558.068 1235.31,485.614 1237.61,214.059 1239.92,578.336 1242.23,383.816 1244.54,277.041 1246.85,477.72 1249.15,590.983 1251.46,232.721 1253.77,568.273 1256.08,510.347 1258.39,606.306 1260.69,554.932 1263,328.964 1265.31,491.12 1267.62,376.731 1269.93,294.467 1272.23,427.208 1274.54,341.86 1276.85,486.824 1279.16,536.595 1281.47,477.191 1283.77,379.328 1286.08,430.767 1288.39,436.503 1290.7,501.074 1293,387.641 1295.31,571.49 1297.62,497.959 1299.93,339.102 1302.24,601.801 1304.54,538.266 1306.85,466.885 1309.16,619.552 1311.47,526.106 1313.78,371.52 1316.08,340.443 1318.39,409.833 1320.7,416.771 1323.01,423.41 1325.32,386.379 1327.62,457.472 1329.93,294.073 1332.24,476.403 1334.55,392.742 1336.86,539.185 1339.16,248.653 1341.47,509.819 1343.78,471.947 1346.09,404.586 1348.39,357.316 1350.7,450.558 1353.01,548.634 1355.32,535.283 1357.63,487.309 1359.93,432.567 1362.24,490.301 1364.55,379.566 1366.86,482.985 1369.17,388.678 1371.47,438.33 1373.78,371.964 1376.09,485.918 1378.4,485.256 1380.71,510.566 1383.01,508.224 1385.32,542.284 1387.63,297.262 1389.94,265.41 1392.24,533.598 1394.55,251.929 1396.86,318.336 1399.17,362.336 1401.48,425.727 1403.78,509.355 1406.09,454.169 1408.4,400.848 1410.71,488.278 1413.02,528.396 1415.32,331.897 1417.63,394.849 1419.94,335.08 1422.25,434.939 1424.56,431.379 1426.86,400.616 1429.17,425.607 1431.48,161.001 1433.79,348.883 1436.1,613.626 1438.4,613.837 1440.71,699.542 1443.02,463.496 1445.33,454.801 1447.63,425.275 1449.94,348.703 1452.25,256.057 1454.56,444.887 1456.87,418.117 1459.17,421.032 1461.48,450.075 1463.79,448.441 1466.1,531.21 1468.41,550.823 1470.71,500.243 1473.02,346.365 1475.33,612.489 1477.64,425.442 1479.95,490.226 1482.25,289.119 1484.56,362.759 1486.87,250.102 1489.18,454.645 1491.49,495.202 1493.79,687.544 1496.1,370.216 1498.41,660.992 1500.72,456.086 1503.02,425.622 1505.33,506.053 1507.64,576.107 1509.95,547.204 1512.26,503.523 1514.56,614.859 1516.87,398.783 1519.18,657.389 1521.49,251.782 1523.8,270.781 1526.1,444.261 1528.41,434.176 1530.72,370.05 1533.03,354.983 1535.34,320.795 1537.64,503.251 1539.95,470.401 1542.26,407.391 1544.57,442.422 1546.88,291.332 1549.18,560.571 1551.49,517.992 1553.8,592.329 1556.11,376.272 1558.41,507.387 1560.72,515.127 1563.03,510.723 1565.34,635.283 1567.65,437.82 1569.95,581.644 1572.26,627.269 1574.57,466.013 1576.88,519.099 1579.19,527.524 1581.49,384.605 1583.8,524.761 1586.11,329.016 1588.42,534.696 1590.73,385.418 1593.03,568.206 1595.34,433.073 1597.65,288.975 1599.96,399.085 1602.26,480.72 1604.57,570.548 1606.88,566.988 1609.19,285.281 1611.5,493.183 1613.8,532.241 1616.11,332.934 1618.42,409.323 1620.73,390.109 1623.04,314.291 1625.34,351.773 1627.65,340.556 1629.96,537.179 1632.27,451.93 1634.58,492.36 1636.88,400.529 1639.19,374.378 1641.5,304.266 1643.81,474.989 1646.12,498.074 1648.42,539.162 1650.73,541.135 1653.04,428.089 1655.35,453.211 1657.65,535.499 1659.96,314.963 1662.27,442.25 1664.58,517.401 1666.89,382.238 1669.19,522.946 1671.5,506.164 1673.81,593.895 1676.12,316.018 1678.43,590.194 1680.73,571.969 1683.04,443.338 1685.35,425.779 1687.66,226.311 1689.97,417.985 1692.27,385.697 1694.58,570.884 1696.89,585.684 1699.2,473.693 1701.51,625.769 1703.81,310.211 1706.12,563.928 1708.43,497.8 1710.74,359.15 1713.04,510.921 1715.35,478.244 1717.66,466.891 1719.97,442.801 1722.28,654.752 1724.58,552.415 1726.89,498.754 1729.2,501.314 1731.51,494.262 1733.82,569.639 1736.12,431.293 1738.43,454.943 1740.74,571.49 1743.05,527.109 1745.36,486.444 1747.66,598.116 1749.97,648.177 1752.28,531.895 1754.59,332.662 1756.9,400.776 1759.2,254.768 1761.51,458.365 1763.82,582.168 1766.13,426.248 1768.43,263.36 1770.74,406.989 1773.05,485.483 1775.36,343.583 1777.67,96.8724 1779.97,476.857 1782.28,386.7 1784.59,573.004 1786.9,461.733 1789.21,354.248 1791.51,492.523 1793.82,374.39 1796.13,506.354 1798.44,646.222 1800.75,535.103 1803.05,422.439 1805.36,315.979 1807.67,362.202 1809.98,436.095 1812.28,372.378 1814.59,378.881 1816.9,378.579 1819.21,464.187 1821.52,489.717 1823.82,506.369 1826.13,522.401 1828.44,547.101 1830.75,415.816 1833.06,469.855 1835.36,536.325 1837.67,411.114 1839.98,540.123 1842.29,437.247 1844.6,529.675 1846.9,523.677 1849.21,499.361 1851.52,585.816 1853.83,432.364 1856.14,546.961 1858.44,312.076 1860.75,330.396 1863.06,448.234 1865.37,435.607 1867.67,457.331 1869.98,500.398 1872.29,343.35 1874.6,515.497 1876.91,478.013 1879.21,550.88 1881.52,427.456 1883.83,437.772 1886.14,325.516 1888.45,440.851 1890.75,238.607 1893.06,285.573 1895.37,493.507 1897.68,571.876 1899.99,599.75 1902.29,552.028 1904.6,321.36 1906.91,400.742 1909.22,560.541 1911.53,462.544 1913.83,369.966 1916.14,287.731 1918.45,345.767 1920.76,371.743 1923.06,554.281 1925.37,472.152 1927.68,507.387 1929.99,462.27 1932.3,387.971 1934.6,546.412 1936.91,452.323 1939.22,371.623 1941.53,518.801 1943.84,404.334 1946.14,452.478 1948.45,437.151 1950.76,442.674 1953.07,473.092 1955.38,637.186 1957.68,433.386 1959.99,404.044 1962.3,416.721 1964.61,336.104 1966.91,614.615 1969.22,565.651 1971.53,706.388 1973.84,388.389 1976.15,469.736 1978.45,275.501 1980.76,307.004 1983.07,302.029 1985.38,355.643 1987.69,388.233 1989.99,557.633 1992.3,617.602 1994.61,429.486 1996.92,450.916 1999.23,224.737 2001.53,451.336 2003.84,361.972 2006.15,390.859 2008.46,387.011 2010.77,335.558 2013.07,517.578 2015.38,546.966 2017.69,522.292 2020,339.185 2022.3,552.806 2024.61,497.523 2026.92,506.514 2029.23,374.441 2031.54,463.464 2033.84,471.771 2036.15,371.294 2038.46,288.783 2040.77,281.268 2043.08,391.532 2045.38,370.472 2047.69,451.535 2050,562.351 2052.31,439.675 2054.62,523.829 2056.92,412.753 2059.23,361.44 2061.54,289.817 2063.85,697.012 2066.16,368.578 2068.46,345.129 2070.77,430.999 2073.08,392.181 2075.39,436.58 2077.69,481.166 2080,258.029 2082.31,253.427 2084.62,460.691 2086.93,572.256 2089.23,562.878 2091.54,291.412 2093.85,408.518 2096.16,490.363 2098.47,481.4 2100.77,387.899 2103.08,522.776 2105.39,477.225 2107.7,490.38 2110.01,382.127 2112.31,539.557 2114.62,428.58 2116.93,229.163 2119.24,428.331 2121.55,484.968 2123.85,526.172 2126.16,331.378 2128.47,485.328 2130.78,339.287 2133.08,226.15 2135.39,517.715 2137.7,380.916 2140.01,270.369 2142.32,580.725 2144.62,542.711 2146.93,368.085 2149.24,292.193 2151.55,515.354 2153.86,403.721 2156.16,574.337 2158.47,477.305 2160.78,207.687 2163.09,481.45 2165.4,212.136 2167.7,397.844 2170.01,462.413 2172.32,457.125 2174.63,549.474 2176.93,393.839 2179.24,526.833 2181.55,512.639 2183.86,514.877 2186.17,363.857 2188.47,544.446 2190.78,412.316 2193.09,514.863 2195.4,468.582 2197.71,573.347 2200.01,549.193 2202.32,418.663 2204.63,369.014 2206.94,250.717 2209.25,584.195 2211.55,422.151 2213.86,434.026 2216.17,621.105 2218.48,251.542 2220.79,648.712 2223.09,445.671 2225.4,441.07 2227.71,312.89 2230.02,537.742 2232.32,566.201 2234.63,521.54 2236.94,427.061 2239.25,694.687 2241.56,718.645 2243.86,387.314 2246.17,602.428 2248.48,488.292 2250.79,500.092 2253.1,353.04 2255.4,362.871 2257.71,349.936 2260.02,282.203 2262.33,661.258 2264.64,389.554 2266.94,533.331 2269.25,662.622 2271.56,360.399 2273.87,633.236 2276.18,451.023 2278.48,498.661 2280.79,354.928 2283.1,185.631 2285.41,338.837 2287.71,341.903 2290.02,252.851 2292.33,313.707 2294.64,548.437 2296.95,335.227 2299.25,330.991 2301.56,593.439 2303.87,661.152 2306.18,522.336 2308.49,709.875 2310.79,331.771 2313.1,405.55 2315.41,435.709 2317.72,339.034 2320.03,614.78 2322.33,413.443 2324.64,468.145 2326.95,302.945 2329.26,502.813 2331.56,359.601 2333.87,372.571 2336.18,469.177 2338.49,511.527 2340.8,435.845 2343.1,572.745 2345.41,206.394 2347.72,323.149 2350.03,464.371 2352.34,320.594 2354.64,388.162 2356.95,460.178 2359.26,356.584 2361.57,616.785 2363.88,559.971 2366.18,716.954 2368.49,562.248 2370.8,477.408 2373.11,392.482 2375.42,560.876 2377.72,401.323 2380.03,538.504 2382.34,512.024 2384.65,587.649 2386.95,475.032 2389.26,200.15 2391.57,574.831 2393.88,601.243 2396.19,449.785 2398.49,435.731 2400.8,547.413 2403.11,402.152 2405.42,217.99 2407.73,526.444 2410.03,497.683 2412.34,485.013 2414.65,424.277 2416.96,530.823 2419.27,562.588 2421.57,331.83 2423.88,606.633 2426.19,304.489 2428.5,384.131 2430.81,474.727 2433.11,534.113 2435.42,539.086 2437.73,485.894 2440.04,378.432 2442.34,449.525 2444.65,666.241 2446.96,517.912 2449.27,325.568 2451.58,467.341 2453.88,611.867 2456.19,572.601 2458.5,398.211 2460.81,296.48 2463.12,355.611 2465.42,418.377 2467.73,268.207 2470.04,619.964 2472.35,493.852 2474.66,384.238 2476.96,525.534 2479.27,467.575 2481.58,484.184 2483.89,657.132 2486.2,438.444 2488.5,436.075 2490.81,533.411 2493.12,507.992 2495.43,622.228 2497.73,371.512 2500.04,570.684 2502.35,487.064 2504.66,460.732 2506.97,568.416 2509.27,628.506 2511.58,446.641 2513.89,562.872 2516.2,502.952 2518.51,358.801 2520.81,521.63 2523.12,455.169 2525.43,501.462 2527.74,250.503 2530.05,425.703 2532.35,544.93 2534.66,544.037 2536.97,454.136 2539.28,493.546 2541.58,605.997 2543.89,355.371 2546.2,390.068 2548.51,473.172 2550.82,377.593 2553.12,553.594 2555.43,246.171 2557.74,472.417 2560.05,397.179 2562.36,505.985 2564.66,688.73 2566.97,309.875 2569.28,324.025 2571.59,621.821 "></polyline>
</svg>
</div>
</div>
<p>Look at that! Things are working; amazin’.</p>
<p>We can also exploit <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>’s parallel sampling capabilities:</p>
<div id="34" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run separate 4 chains for 10 000 iterations using threads to parallelize.</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>num_chains <span class="op">=</span> <span class="fl">4</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    model_with_grad,</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">MCMCThreads</span>(),</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>,</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    num_chains;</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Note we need to provide an initial state for every chain.</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>    initial_state<span class="op">=</span><span class="fu">fill</span>(state, num_chains),</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>samples_array <span class="op">=</span> <span class="fu">stack</span>(<span class="fu">map</span>(<span class="bu">Base</span>.<span class="fu">Fix1</span>(stack, sample <span class="op">-&gt;</span> sample.x), samples))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000×4 Array{Float64, 3}:
[:, :, 1] =
 -2.22215   -2.36113  -2.67117  -5.13411   …  -3.33434   -4.37447   -4.49378
 -0.476095  -1.7219   -1.19046  -0.779288     -0.487285   0.357582   1.27467
  1.83975    4.80841   5.58551   4.68212       3.29026    3.29206    4.78257

[:, :, 2] =
 -2.38854   -3.41989    -3.41989    …  -2.94393   -4.07439   -3.73379
 -0.300929  -0.0547721  -0.0547721      0.862177  -0.934278  -0.182297
  2.39163    5.23334     5.23334        6.82115    5.57579    4.255

[:, :, 3] =
  0.406425   -1.98763   -1.98763   …  -4.94625  -4.94625  -5.78659
 -0.0864282  -0.250046  -0.250046     -0.48089  -0.48089   0.679759
  1.22947     4.20492    4.20492       4.99899   4.99899   6.06607

[:, :, 4] =
 -3.46868   -4.5053   -5.17706   -5.29281   …  -4.81266  -3.69148  -3.69148
 -0.732695  -2.31203  -0.671593  -0.106963      2.69531  -0.28912  -0.28912
  2.79836    4.31866   3.38568    4.05717       4.50934   5.26682   5.26682</code></pre>
</div>
</div>
<p>But the fact that we have to provide the <code>AbstractMCMC.sample</code> call, etc. with an <code>initial_state</code> to get started is a bit annoying. We can avoid this by also defining a <code>AbstractMCMC.step</code> <em>without</em> the <code>state</code> argument:</p>
<div id="36" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">::</span><span class="dt">MALA</span>;</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># </span><span class="al">NOTE</span><span class="co">: No state provided!</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just create the initial state by sampling using  a Gaussian.</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="fu">randn</span>(rng, LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(x), <span class="fu">MALAState</span>(x)</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Equipped with this, we no longer need to provide the <code>initial_state</code> everywhere:</p>
<div id="38" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -4.9926     1.01653
  0.0148617  0.999312
  4.96757    0.99785</code></pre>
</div>
</div>
</section>
<section id="using-our-sampler-with-turing.jl" class="level2">
<h2 class="anchored" data-anchor-id="using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</h2>
<p>As we promised, all of this hassle of implementing our <code>MALA</code> sampler in a way that uses <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> and <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> gets us something more than <em>just</em> an “automatic” implementation of <code>AbstractMCMC.sample</code>.</p>
<p>It also enables use with Turing.jl through the <code>externalsampler</code>, but we need to do one final thing first: we need to tell Turing.jl how to extract a vector of parameters from the “sample” returned in our implementation of <code>AbstractMCMC.step</code>. In our case, the “sample” is a <code>MALASample</code>, so we just need the following line:</p>
<div id="40" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load Turing.jl.</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Turing</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Overload the `getparams` method for our "sample" type, which is just a vector.</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>Turing.Inference.<span class="fu">getparams</span>(<span class="op">::</span><span class="dt">Turing.Model</span>, sample<span class="op">::</span><span class="dt">MALASample</span>) <span class="op">=</span> sample.x</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And with that, we’re good to go!</p>
<div id="42" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Our previous model defined as a Turing.jl model.</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">mvnormal_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">MvNormal</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.], I)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate our model.</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">mvnormal_model</span>()</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Call `sample` but now we're passing in a Turing.jl `model` and wrapping</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co"># our `MALA` sampler in the `externalsampler` to tell Turing.jl that the sampler</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co"># expects something that implements LogDensityProblems.jl.</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×4×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 2.41 seconds
Compute duration  = 2.41 seconds
parameters        = x[1], x[2], x[3]
internals         = lp

Summary Statistics
  parameters      mean       std      mcse    ess_bulk    ess_tail      rhat   ⋯
      Symbol   Float64   Float64   Float64     Float64     Float64   Float64   ⋯

        x[1]   -5.0207    1.0148    0.0175   3385.2937   5180.4046    1.0000   ⋯
        x[2]   -0.0000    0.9939    0.0167   3534.1169   5686.2753    1.0000   ⋯
        x[3]    5.0010    0.9946    0.0173   3318.0577   5737.7130    1.0000   ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

        x[1]   -7.0264   -5.7041   -5.0214   -4.3444   -3.0382
        x[2]   -1.9444   -0.6801    0.0023    0.6728    1.9458
        x[3]    3.0758    4.3099    4.9956    5.6645    6.9617</code></pre>
</div>
</div>
<p>Pretty neat, eh?</p>
<section id="models-with-constrained-parameters" class="level3">
<h3 class="anchored" data-anchor-id="models-with-constrained-parameters">Models with constrained parameters</h3>
<p>One thing we’ve sort of glossed over in all of the above is that MALA, at least how we’ve implemented it, requires <span class="math inline">\(x\)</span> to live in <span class="math inline">\(\mathbb{R}^d\)</span> for some <span class="math inline">\(d &gt; 0\)</span>. If some of the parameters were in fact constrained, e.g.&nbsp;we were working with a <code>Beta</code> distribution which has support on the interval <span class="math inline">\((0, 1)\)</span>, <em>not</em> on <span class="math inline">\(\mathbb{R}^d\)</span>, we could easily end up outside of the valid range <span class="math inline">\((0, 1)\)</span>.</p>
<div id="44" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">beta_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">beta_model</span>()</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 1.4 seconds
Compute duration  = 1.4 seconds
parameters        = x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse    ess_bulk    ess_tail      rhat   ⋯
      Symbol   Float64   Float64   Float64     Float64     Float64   Float64   ⋯

           x    0.4988    0.1896    0.0028   4557.5439   6028.5710    1.0000   ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

           x    0.1479    0.3577    0.4973    0.6418    0.8512</code></pre>
</div>
</div>
<p>Yep, that still works, but only because Turing.jl actually <em>transforms</em> the <code>turing_model</code> from constrained to unconstrained, so that the <code>sampler</code> provided to <code>externalsampler</code> is actually always working in unconstrained space! This is not always desirable, so we can turn this off:</p>
<div id="46" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 0.23 seconds
Compute duration  = 0.23 seconds
parameters        = x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse   ess_bulk   ess_tail      rhat   e ⋯
      Symbol   Float64   Float64   Float64    Float64    Float64   Float64     ⋯

           x    0.5613    0.1921    0.0334    30.1758        NaN    1.0088     ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

           x    0.2380    0.4043    0.5677    0.7915    0.7915</code></pre>
</div>
</div>
<p>The fun thing is that this still sort of works because</p>
<div id="48" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">logpdf</span>(<span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>), <span class="fl">10.0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-Inf</code></pre>
</div>
</div>
<p>and so the samples that fall outside of the range are always rejected. But do notice how much worse all the diagnostics are, e.g.&nbsp;<code>ess_tail</code> is very poor compared to when we use <code>unconstrained=true</code>. Moreover, in more complex cases this won’t just result in a “nice” <code>-Inf</code> log-density value, but instead will error:</p>
<div id="50" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="kw">function</span> <span class="fu">demo</span>()</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>    σ² <span class="op">~</span> <span class="fu">truncated</span>(<span class="fu">Normal</span>(), lower<span class="op">=</span><span class="fl">0</span>)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If we end up with negative values for `σ²`, the `Normal` will error.</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>    x <span class="op">~</span> <span class="fu">Normal</span>(<span class="fl">0</span>, σ²)</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>DomainError: DomainError(Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}}(-0.20243672757288622,1.0,0.0), "Normal: the condition σ &gt;= zero(σ) is not satisfied.")
DomainError with Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}}(-0.20243672757288622,1.0,0.0):
Normal: the condition σ &gt;= zero(σ) is not satisfied.
Stacktrace:
  [1] #371
    @ ~/.julia/packages/Distributions/Qeo2J/src/univariate/continuous/normal.jl:37 [inlined]
  [2] check_args
    @ ~/.julia/packages/Distributions/Qeo2J/src/utils.jl:89 [inlined]
  [3] #Normal#370
    @ ~/.julia/packages/Distributions/Qeo2J/src/univariate/continuous/normal.jl:37 [inlined]
  [4] Normal
    @ ~/.julia/packages/Distributions/Qeo2J/src/univariate/continuous/normal.jl:36 [inlined]
  [5] Normal
    @ ~/.julia/packages/Distributions/Qeo2J/src/univariate/continuous/normal.jl:42 [inlined]
  [6] macro expansion
    @ ~/.julia/packages/DynamicPPL/ooLj8/src/compiler.jl:579 [inlined]
  [7] demo(__model__::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, __varinfo__::DynamicPPL.ThreadSafeVarInfo{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}, Vector{Set{DynamicPPL.Selector}}}}, ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}, Vector{Base.RefValue{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}, __context__::DynamicPPL.DefaultContext)
    @ Main.Notebook ~/work/docs/docs/tutorials/docs-17-implementing-samplers/index.qmd:593
  [8] _evaluate!!
    @ ~/.julia/packages/DynamicPPL/ooLj8/src/model.jl:975 [inlined]
  [9] evaluate_threadsafe!!(model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, varinfo::DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}, Vector{Set{DynamicPPL.Selector}}}}, ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}, context::DynamicPPL.DefaultContext)
    @ DynamicPPL ~/.julia/packages/DynamicPPL/ooLj8/src/model.jl:964
 [10] evaluate!!
    @ ~/.julia/packages/DynamicPPL/ooLj8/src/model.jl:894 [inlined]
 [11] logdensity
    @ ~/.julia/packages/DynamicPPL/ooLj8/src/logdensityfunction.jl:140 [inlined]
 [12] Fix1
    @ ./operators.jl:1118 [inlined]
 [13] vector_mode_dual_eval!(f::Base.Fix1{typeof(LogDensityProblems.logdensity), LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, Nothing}}, cfg::ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}, x::Vector{Float64})
    @ ForwardDiff ~/.julia/packages/ForwardDiff/UBbGT/src/apiutils.jl:24
 [14] vector_mode_gradient!(result::DiffResults.MutableDiffResult{1, Float64, Tuple{Vector{Float64}}}, f::Base.Fix1{typeof(LogDensityProblems.logdensity), LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, Nothing}}, x::Vector{Float64}, cfg::ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}})
    @ ForwardDiff ~/.julia/packages/ForwardDiff/UBbGT/src/gradient.jl:98
 [15] gradient!
    @ ~/.julia/packages/ForwardDiff/UBbGT/src/gradient.jl:39 [inlined]
 [16] gradient!
    @ ~/.julia/packages/ForwardDiff/UBbGT/src/gradient.jl:36 [inlined]
 [17] logdensity_and_gradient
    @ ~/.julia/packages/LogDensityProblemsAD/9uEsH/ext/LogDensityProblemsADForwardDiffExt.jl:116 [inlined]
 [18] leapfrog_step(model::LogDensityProblemsADForwardDiffExt.ForwardDiffLogDensity{LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, Nothing}, ForwardDiff.Chunk{2}, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}, x::Vector{Float64}, p::Vector{Float64}, ϵ::Int64, M::UniformScaling{Bool})
    @ Main.Notebook ~/work/docs/docs/tutorials/docs-17-implementing-samplers/index.qmd:369
 [19] step(rng::TaskLocalRNG, model_wrapper::AbstractMCMC.LogDensityModel{LogDensityProblemsADForwardDiffExt.ForwardDiffLogDensity{LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, Nothing}, ForwardDiff.Chunk{2}, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}}, sampler::MALA{Int64, UniformScaling{Bool}}, state::MALAState{Vector{Float64}}; kwargs::@Kwargs{})
    @ Main.Notebook ~/work/docs/docs/tutorials/docs-17-implementing-samplers/index.qmd:334
 [20] step
    @ ~/work/docs/docs/tutorials/docs-17-implementing-samplers/index.qmd:316 [inlined]
 [21] #step#103
    @ ~/.julia/packages/Turing/bUZEC/src/mcmc/abstractmcmc.jl:161 [inlined]
 [22] step(rng::TaskLocalRNG, model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, sampler_wrapper::DynamicPPL.Sampler{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}, state::Turing.Inference.TuringState{MALAState{Vector{Float64}}, LogDensityProblemsADForwardDiffExt.ForwardDiffLogDensity{LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, Nothing}, ForwardDiff.Chunk{2}, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}})
    @ Turing.Inference ~/.julia/packages/Turing/bUZEC/src/mcmc/abstractmcmc.jl:150
 [23] macro expansion
    @ ~/.julia/packages/AbstractMCMC/FSyVk/src/sample.jl:217 [inlined]
 [24] macro expansion
    @ ~/.julia/packages/AbstractMCMC/FSyVk/src/logging.jl:16 [inlined]
 [25] mcmcsample(rng::TaskLocalRNG, model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, sampler::DynamicPPL.Sampler{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}, N::Int64; progress::Bool, progressname::String, callback::Nothing, num_warmup::Int64, discard_initial::Int64, thinning::Int64, chain_type::Type, initial_state::Nothing, kwargs::@Kwargs{})
    @ AbstractMCMC ~/.julia/packages/AbstractMCMC/FSyVk/src/sample.jl:142
 [26] sample(rng::TaskLocalRNG, model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, sampler::DynamicPPL.Sampler{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}, N::Int64; chain_type::Type, resume_from::Nothing, initial_state::Nothing, kwargs::@Kwargs{progress::Bool})
    @ DynamicPPL ~/.julia/packages/DynamicPPL/ooLj8/src/sampler.jl:93
 [27] sample
    @ ~/.julia/packages/DynamicPPL/ooLj8/src/sampler.jl:83 [inlined]
 [28] #sample#4
    @ ~/.julia/packages/Turing/bUZEC/src/mcmc/Inference.jl:305 [inlined]
 [29] sample
    @ ~/.julia/packages/Turing/bUZEC/src/mcmc/Inference.jl:296 [inlined]
 [30] #sample#3
    @ ~/.julia/packages/Turing/bUZEC/src/mcmc/Inference.jl:293 [inlined]
 [31] top-level scope
    @ ~/work/docs/docs/tutorials/docs-17-implementing-samplers/index.qmd:595</code></pre>
</div>
</div>
<p>As expected, we run into a <code>DomainError</code> at some point, while if we set <code>unconstrained=true</code>, letting Turing.jl transform the model to a unconstrained form behind the scenes, everything works as expected:</p>
<div id="52" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 0.55 seconds
Compute duration  = 0.55 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse   ess_bulk   ess_tail      rhat   e ⋯
      Symbol   Float64   Float64   Float64    Float64    Float64   Float64     ⋯

          σ²    0.8668    0.5297    0.0185   635.4038   441.7453    1.0023     ⋯
           x    0.0569    0.8714    0.0327   882.6765   675.6325    1.0000     ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

          σ²    0.1439    0.4398    0.7615    1.1967    2.1425
           x   -1.7188   -0.3467    0.0297    0.4808    1.9468</code></pre>
</div>
</div>
<p>Neat!</p>
<p>Similarly, which automatic differentiation backend one should use can be specified through the <code>adtype</code> keyword argument too. For example, if we want to use <a href="https://github.com/JuliaDiff/ReverseDiff.jl">ReverseDiff.jl</a> instead of the default <a href="https://github.com/JuliaDiff/ForwardDiff.jl">ForwardDiff.jl</a>:</p>
<div id="54" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">ReverseDiff</span>: ReverseDiff</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify that we want to use `AutoReverseDiff`.</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">demo</span>(),</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>, adtype<span class="op">=</span><span class="fu">AutoReverseDiff</span>()),</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>;</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 3.01 seconds
Compute duration  = 3.01 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse   ess_bulk   ess_tail      rhat   e ⋯
      Symbol   Float64   Float64   Float64    Float64    Float64   Float64     ⋯

          σ²    0.8762    0.5943    0.0268   421.0633   242.7635    1.0001     ⋯
           x    0.0717    1.1751    0.0705   485.1072   340.3943    1.0013     ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

          σ²    0.1324    0.4014    0.7568    1.2069    2.3313
           x   -2.2351   -0.4203    0.0153    0.4584    2.3497</code></pre>
</div>
</div>
<p>Double-neat.</p>
</section>
</section>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<p>At this point it’s worth maybe reminding ourselves what we did and also <em>why</em> we did it:</p>
<ol type="1">
<li>We define our models in the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface because it makes the sampler agnostic to how the underlying model is implemented.</li>
<li>We implement our sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> interface, which just means that our sampler is a subtype of <code>AbstractMCMC.AbstractSampler</code> and we implement the MCMC transition in <code>AbstractMCMC.step</code>.</li>
<li>Points 1 and 2 makes it so our sampler can be used with a wide range of model implementations, amongst them being models implemented in both Turing.jl and Stan. This gives you, the inference implementer, a large collection of models to test your inference method on, in addition to allowing users of Turing.jl and Stan to try out your inference method with minimal effort.</li>
</ol>


</section>


<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a><div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>We’re going with the leapfrog formulation because in a future version of this tutorial we’ll add a section extending this simple “baseline” MALA sampler to more complex versions. See <a href="https://github.com/TuringLang/docs/issues/479">issue #479</a> for progress on this.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>There is no such thing as a proper interface in Julia (at least not officially), and so we use the word “interface” here to mean a few minimal methods that needs to be implemented by any type that we treat as a target model.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/turinglang\.org\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../tutorials/docs-07-for-developers-variational-inference/index.html" class="pagination-link" aria-label="Variational Inference">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Variational Inference</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Turing is created by <a href="http://mlg.eng.cam.ac.uk/hong/" target="_blank">Hong Ge</a>, and lovingly maintained by the <a href="https://github.com/TuringLang/Turing.jl/graphs/contributors" target="_blank">core team</a> of volunteers. <br> The contents of this website are © 2024 under the terms of the <a href="https://github.com/TuringLang/Turing.jl/blob/master/LICENCE" target="_blank">MIT License</a>.</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/TuringLang/docs/edit/master/tutorials/docs-17-implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/docs/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://x.com/TuringLang">
      <i class="bi bi-twitter" role="img" aria-label="Turing Twitter">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/TuringLang/Turing.jl">
      <i class="bi bi-github" role="img" aria-label="Turing GitHub">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




<script src="../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>