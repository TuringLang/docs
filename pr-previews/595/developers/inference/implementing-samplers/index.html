<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Implementing Samplers – Turing.jl</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<link href="../../../developers/inference/variational-inference/index.html" rel="prev">
<link href="../../../assets/favicon.ico" rel="icon">
<script src="../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-dark-b53751a350365c71b6c909e95f209ed1.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap-34237cea2e2cc12c7515d5a9baa4807c.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../../site_libs/bootstrap/bootstrap-dark-2ce616a69abdabb5d8b1d1ad44f632cf.min.css" rel="prefetch" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<style>
  a {
    text-decoration: none;
  }
  a:hover {
    text-decoration: underline;
  }
</style>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../../theming/styles.css">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="https://turinglang.org/" class="navbar-brand navbar-brand-logo">
    <img src="../../../assets/images/turing-logo.svg" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="https://turinglang.org/">
    <span class="navbar-title">Turing.jl</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../getting-started/"> 
<span class="menu-text">Get Started</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../tutorials/coin-flipping/"> 
<span class="menu-text">Tutorials</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/library/"> 
<span class="menu-text">Libraries</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/news/"> 
<span class="menu-text">News</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/team/"> 
<span class="menu-text">Team</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-v0.37" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">v0.37</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-v0.37">    
        <li>
    <a class="dropdown-item" href="https://turinglang.org/docs/changelog.html">
 <span class="dropdown-text">Changelog</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://turinglang.org/docs/versions.html">
 <span class="dropdown-text">All Versions</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools tools-wide">
    <a href="https://x.com/TuringLang" title="Turing Twitter" class="quarto-navigation-tool px-1" aria-label="Turing Twitter"><i class="bi bi-twitter"></i></a>
    <a href="https://github.com/TuringLang/Turing.jl" title="Turing GitHub" class="quarto-navigation-tool px-1" aria-label="Turing GitHub"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../../developers/contributing/index.html">Developers</a></li><li class="breadcrumb-item"><a href="../../../developers/inference/abstractmcmc-interface/index.html">Inference (note: outdated)</a></li><li class="breadcrumb-item"><a href="../../../developers/inference/implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../getting-started/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Getting Started</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../core-functionality/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Core Functionality</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false">
 <span class="menu-text">User Guide</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/automatic-differentiation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Automatic Differentiation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/custom-distribution/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Custom Distributions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/probability-interface/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Querying Model Probabilities</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/modifying-logprob/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Modifying the Log Probability</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/generated-quantities/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Generated Quantities</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/mode-estimation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Mode Estimation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/performance-tips/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Performance Tips</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/sampler-visualisation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Sampler Visualization</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/dynamichmc/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using DynamicHMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/external-samplers/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using External Samplers</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false">
 <span class="menu-text">Tutorials</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/coin-flipping/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction: Coin Flipping</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/gaussian-mixture-models/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Mixture Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-neural-networks/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Neural Networks</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/hidden-markov-models/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Hidden Markov Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-linear-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Linear Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/infinite-mixture-models/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Infinite Mixture Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-poisson-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Poisson Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/multinomial-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Multinomial Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-differential-equations/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Differential Equations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/probabilistic-pca/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Probabilistic PCA</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-time-series-analysis/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Time Series Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/gaussian-processes-introduction/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Processes: Introduction</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/gaussian-process-latent-variable-models/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Process Latent Variable Models</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Developers</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/contributing/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Contributing</span></a>
  </div>
</li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false">
 <span class="menu-text">DynamicPPL’s Compiler</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/compiler/model-manual/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Manually Defining a Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/compiler/minituring-compiler/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation I: Compiler</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/compiler/minituring-contexts/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation II: Contexts</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/compiler/design-overview/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Turing Compiler Design (Outdated)</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false">
 <span class="menu-text">Variable Transformations</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/transforms/distributions/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Distributions and the Jacobian</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/transforms/bijectors/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bijectors in MCMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/transforms/dynamicppl/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variable transformations in DynamicPPL</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true">
 <span class="menu-text">Inference (note: outdated)</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/inference/abstractmcmc-interface/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Interface Guide</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/inference/abstractmcmc-turing/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">How Turing Implements AbstractMCMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/inference/variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/inference/implementing-samplers/index.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Implementing Samplers</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of Contents</h2>
   
  <ul>
  <li><a href="#quick-overview-of-mala" id="toc-quick-overview-of-mala" class="nav-link active" data-scroll-target="#quick-overview-of-mala">Quick overview of MALA</a></li>
  <li><a href="#what-we-need-from-a-model-logdensityproblems.jl" id="toc-what-we-need-from-a-model-logdensityproblems.jl" class="nav-link" data-scroll-target="#what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: LogDensityProblems.jl</a></li>
  <li><a href="#implementing-mala-in-abstractmcmc.jl" id="toc-implementing-mala-in-abstractmcmc.jl" class="nav-link" data-scroll-target="#implementing-mala-in-abstractmcmc.jl">Implementing MALA in AbstractMCMC.jl</a></li>
  <li><a href="#using-our-sampler-with-turing.jl" id="toc-using-our-sampler-with-turing.jl" class="nav-link" data-scroll-target="#using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</a>
  <ul class="collapse">
  <li><a href="#models-with-constrained-parameters" id="toc-models-with-constrained-parameters" class="nav-link" data-scroll-target="#models-with-constrained-parameters">Models with constrained parameters</a></li>
  </ul></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/TuringLang/docs/edit/main/developers/inference/implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/docs/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../../developers/contributing/index.html">Developers</a></li><li class="breadcrumb-item"><a href="../../../developers/inference/abstractmcmc-interface/index.html">Inference (note: outdated)</a></li><li class="breadcrumb-item"><a href="../../../developers/inference/implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Implementing Samplers</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>In this tutorial, we’ll go through step-by-step how to implement a “simple” sampler in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> in such a way that it can be easily applied to Turing.jl models.</p>
<p>In particular, we’re going to implement a version of <strong>Metropolis-adjusted Langevin (MALA)</strong>.</p>
<p>Note that we will implement this sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> framework, completely “ignoring” Turing.jl until the very end of the tutorial, at which point we’ll use a single line of code to make the resulting sampler available to Turing.jl. This is to really drive home the point that one can implement samplers in a way that is accessible to all of Turing.jl’s users without having to use Turing.jl yourself.</p>
<section id="quick-overview-of-mala" class="level2">
<h2 class="anchored" data-anchor-id="quick-overview-of-mala">Quick overview of MALA</h2>
<p>We can view MALA as a single step of the leapfrog intergrator with resampling of momentum <span class="math inline">\(p\)</span> at every step.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> To make that statement a bit more concrete, we first define the <em>extended</em> target <span class="math inline">\(\bar{\gamma}(x, p)\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\log \bar{\gamma}(x, p) \propto \log \gamma(x) + \log \gamma_{\mathcal{N}(0, M)}(p)
\end{equation*}\]</span></p>
<p>where <span class="math inline">\(\gamma_{\mathcal{N}(0, M)}\)</span> denotes the density for a zero-centered Gaussian with covariance matrix <span class="math inline">\(M\)</span>. We then consider targeting this joint distribution over both <span class="math inline">\(x\)</span> and <span class="math inline">\(p\)</span> as follows. First we define the map</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  L_{\epsilon}: \quad &amp; \mathbb{R}^d \times \mathbb{R}^d \to \mathbb{R}^d \times \mathbb{R}^d \\
  &amp; (x, p) \mapsto (\tilde{x}, \tilde{p}) := L_{\epsilon}(x, p)
\end{split}
\end{equation*}\]</span></p>
<p>as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p_{1 / 2} &amp;:= p + \frac{\epsilon}{2} \nabla \log \gamma(x) \\
  \tilde{x} &amp;:= x + \epsilon M^{-1} p_{1 /2 } \\
  p_1 &amp;:= p_{1 / 2} + \frac{\epsilon}{2} \nabla \log \gamma(\tilde{x}) \\
  \tilde{p} &amp;:= - p_1
\end{split}
\end{equation*}\]</span></p>
<p>This might be familiar for some readers as a single step of the Leapfrog integrator. We then define the MALA kernel as follows: given the current iterate <span class="math inline">\(x_i\)</span>, we sample the next iterate <span class="math inline">\(x_{i + 1}\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p &amp;\sim \mathcal{N}(0, M) \\
  (\tilde{x}, \tilde{p}) &amp;:= L_{\epsilon}(x_i, p) \\
  \alpha &amp;:= \min \left\{ 1, \frac{\bar{\gamma}(\tilde{x}, \tilde{p})}{\bar{\gamma}(x_i, p)} \right\} \\
  x_{i + 1} &amp;:=
  \begin{cases}
    \tilde{x} \quad &amp; \text{ with prob. } \alpha \\
    x_i       \quad &amp; \text{ with prob. } 1 - \alpha
  \end{cases}
\end{split}
\end{equation*}\]</span></p>
<p>i.e.&nbsp;we accept the proposal <span class="math inline">\(\tilde{x}\)</span> with probability <span class="math inline">\(\alpha\)</span> and reject it, thus sticking with our current iterate, with probability <span class="math inline">\(1 - \alpha\)</span>.</p>
</section>
<section id="what-we-need-from-a-model-logdensityproblems.jl" class="level2">
<h2 class="anchored" data-anchor-id="what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a></h2>
<p>There are a few things we need from the “target” / “model” / density that we want to sample from:</p>
<ol type="1">
<li>We need access to log-density <em>evaluations</em> <span class="math inline">\(\log \gamma(x)\)</span> so we can compute the acceptance ratio involving <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>We need access to log-density <em>gradients</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span> so we can compute the Leapfrog steps <span class="math inline">\(L_{\epsilon}(x, p)\)</span>.</li>
<li>We also need access to the “size” of the model so we can determine the size of <span class="math inline">\(M\)</span>.</li>
</ol>
<p>Luckily for us, there is a package called <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> which provides an interface for <em>exactly</em> this!</p>
<p>To demonstrate how one can implement the “<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface”<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> we will use a simple Gaussian model as an example:</p>
<div id="4" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblems</span>: LogDensityProblems;</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's define some type that represents the model.</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> IsotropicNormalModel{M<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"mean of the isotropic Gaussian"</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    mean<span class="op">::</span><span class="dt">M</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Specifies what input length the model expects.</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">dimension</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> <span class="fu">length</span>(model.mean)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Implementation of the log-density evaluation of the model.</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x<span class="op">::</span><span class="dt">AbstractVector{&lt;:Real}</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">-</span> <span class="fu">sum</span>(abs2, x <span class="op">.-</span> model.mean) <span class="op">/</span> <span class="fl">2</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This gives us all of the properties we want for our MALA sampler with the exception of the computation of the <em>gradient</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span>. There is the method <code>LogDensityProblems.logdensity_and_gradient</code> which should return a 2-tuple where the first entry is the evaluation of the logdensity <span class="math inline">\(\log \gamma(x)\)</span> and the second entry is the gradient <span class="math inline">\(\nabla \log \gamma(x)\)</span>.</p>
<p>There are two ways to “implement” this method: 1) we implement it by hand, which is feasible in the case of our <code>IsotropicNormalModel</code>, or b) we defer the implementation of this to a automatic differentiation backend.</p>
<p>To implement it by hand we can simply do</p>
<div id="6" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl that first-order, i.e. gradient information, is available.</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{1}</span>()</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Implement `logdensity_and_gradient`.</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    logγ_x <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="op">-</span>x <span class="op">.*</span> (x <span class="op">-</span> model.mean)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> logγ_x, ∇logγ_x</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s just try it out:</p>
<div id="8" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate the problem.</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> <span class="fu">IsotropicNormalModel</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.])</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create some example input that we can test on.</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>x_example <span class="op">=</span> <span class="fu">randn</span>(LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate!</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-20.968186006695866</code></pre>
</div>
</div>
<p>To defer it to an automatic differentiation backend, we can do</p>
<div id="10" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl we only have access to 0-th order information.</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{0}</span>()</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Use `LogDensityProblemsAD`'s `ADgradient` in combination with some AD backend to implement `logdensity_and_gradient`.</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblemsAD</span>, <span class="bu">ADTypes</span>, <span class="bu">ForwardDiff</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>model_with_grad <span class="op">=</span> <span class="fu">ADgradient</span>(<span class="fu">AutoForwardDiff</span>(), model)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model_with_grad, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-20.968186006695866</code></pre>
</div>
</div>
<p>We’ll continue with the second approach in this tutorial since this is typically what one does in practice, because there are better hobbies to spend time on than deriving gradients by hand.</p>
<p>At this point, one might wonder how we’re going to tie this back to Turing.jl in the end. Effectively, when working with inference methods that only require log-density evaluations and / or higher-order information of the log-density, Turing.jl actually converts the user-provided <code>Model</code> into an object implementing the above methods for <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>. As a result, most samplers provided by Turing.jl are actually implemented to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, enabling their use both <em>within</em> Turing.jl and <em>outside</em> of Turing.jl! Morever, there exists similar conversions for Stan through BridgeStan and Stan<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, which means that a sampler supporting the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface can easily be used on both Turing.jl <em>and</em> Stan models (in addition to user-provided models, as our <code>IsotropicNormalModel</code> above)!</p>
<p>Anyways, let’s move on to actually implementing the sampler.</p>
</section>
<section id="implementing-mala-in-abstractmcmc.jl" class="level2">
<h2 class="anchored" data-anchor-id="implementing-mala-in-abstractmcmc.jl">Implementing MALA in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a></h2>
<p>Now that we’ve established that a model implementing the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface provides us with all the information we need from <span class="math inline">\(\log \gamma(x)\)</span>, we can address the question: given an object that implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, how can we define a sampler for it?</p>
<p>We’re going to do this by making our sampler a sub-type of <code>AbstractMCMC.AbstractSampler</code> in addition to implementing a few methods from <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>. Why? Because it gets us <em>a lot</em> of functionality for free, as we will see later.</p>
<p>Moreover, <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> provides a very natural interface for MCMC algorithms.</p>
<p>First, we’ll define our <code>MALA</code> type</p>
<div id="12" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">AbstractMCMC</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALA{T,A} <span class="op">&lt;:</span><span class="dt"> AbstractMCMC.AbstractSampler</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"stepsize used in the leapfrog step"</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    ϵ_init<span class="op">::</span><span class="dt">T</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"covariance matrix used for the momentum"</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    M_init<span class="op">::</span><span class="dt">A</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notice how we’ve added the suffix <code>_init</code> to both the stepsize and the covariance matrix. We’ve done this because a <code>AbstractMCMC.AbstractSampler</code> should be <em>immutable</em>. Of course there might be many scenarios where we want to allow something like the stepsize and / or the covariance matrix to vary between iterations, e.g.&nbsp;during the burn-in / adaptation phase of the sampling process we might want to adjust the parameters using statistics computed from these initial iterations. But information which can change between iterations <em>should not go in the sampler itself</em>! Instead, this information should go in the sampler <em>state</em>.</p>
<p>The sampler state should at the very least contain all the necessary information to perform the next MCMC iteration, but usually contains further information, e.g.&nbsp;quantities and statistics useful for evaluating whether the sampler has converged.</p>
<p>We will use the following sampler state for our <code>MALA</code> sampler:</p>
<div id="14" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALAState{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This might seem overly redundant: we’re defining a type <code>MALAState</code> and it only contains a simple vector of reals. In this particular case we indeed could have dropped this and simply used a <code>AbstractVector{&lt;:Real}</code> as our sampler state, but typically, as we will see later, one wants to include other quantities in the sampler state. For example, if we also wanted to adapt the parameters of our <code>MALA</code>, e.g.&nbsp;alter the stepsize depending on acceptance rates, in which case we should also put <code>ϵ</code> in the state, but for now we’ll keep things simple.</p>
<p>Moreover, we also want a <em>sample</em> type, which is a type meant for “public consumption”, i.e.&nbsp;the end-user. This is generally going to contain a subset of the information present in the state. But in such a simple scenario as this, we similarly only have a <code>AbstractVector{&lt;:Real}</code>:</p>
<div id="16" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALASample{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We currently have three things:</p>
<ol type="1">
<li>A <code>AbstractMCMC.AbstractSampler</code> implementation called <code>MALA</code>.</li>
<li>A state <code>MALAState</code> for our sampler <code>MALA</code>.</li>
<li>A sample <code>MALASample</code> for our sampler <code>MALA</code>.</li>
</ol>
<p>That means that we’re ready to implement the only thing that really matters: <code>AbstractMCMC.step</code>.</p>
<p><code>AbstractMCMC.step</code> defines the MCMC iteration of our <code>MALA</code> given the current <code>MALAState</code>. Specifically, the signature of the function is as follows:</p>
<div id="18" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The RNG to ensure reproducibility.</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The model that defines our target.</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.AbstractModel</span>,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The sampler for which we're taking a `step`.</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">AbstractMCMC.AbstractSampler</span>,</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The current sampler `state`.</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    state;</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Additional keyword arguments that we may or may not need.</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Moreover, there is a specific <code>AbstractMCMC.AbstractModel</code> which is used to indicate that the model that is provided implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface: <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Since, as we discussed earlier, in our case we’re indeed going to work with types that support the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, we’ll define <code>AbstractMCMC.step</code> for such a <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Note that <code>AbstractMCMC.LogDensityModel</code> has no other purpose; it has a single field called <code>logdensity</code>, and it does nothing else. But by wrapping the model in <code>AbstractMCMC.LogDensityModel</code>, it allows samplers that want to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> to define their <code>AbstractMCMC.step</code> on this type without running into method ambiguities.</p>
<p>All in all, that means that the signature for our <code>AbstractMCMC.step</code> is going to be the following:</p>
<div id="20" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># `LogDensityModel` so we know we're working with LogDensityProblems.jl model.</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler.</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler state.</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Great! Now let’s actually implement the full <code>AbstractMCMC.step</code> for our <code>MALA</code>.</p>
<p>Let’s remind ourselves what we’re going to do:</p>
<ol type="1">
<li>Sample a new momentum <span class="math inline">\(p\)</span>.</li>
<li>Compute the log-density of the extended target <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>Take a single leapfrog step <span class="math inline">\((\tilde{x}, \tilde{p}) = L_{\epsilon}(x, p)\)</span>.</li>
<li>Accept or reject the proposed <span class="math inline">\((\tilde{x}, \tilde{p})\)</span>.</li>
</ol>
<p>All in all, this results in the following:</p>
<div id="22" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>: Random</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Distributions</span>  <span class="co"># so we get the `MvNormal`</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the wrapped model which implements LogDensityProblems.jl.</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just extract the sampler parameters to make our lives easier.</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    ϵ <span class="op">=</span> sampler.ϵ_init</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    M <span class="op">=</span> sampler.M_init</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the current parameters.</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> state.x</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sample the momentum.</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>    p_dist <span class="op">=</span> <span class="fu">MvNormal</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)), M)</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> <span class="fu">rand</span>(rng, p_dist)</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Propose using a single leapfrog step.</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>    x̃, p̃ <span class="op">=</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Accept or reject proposal.</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>    logp <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p)</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>    logp̃ <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x̃) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p̃)</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>    logα <span class="op">=</span> logp̃ <span class="op">-</span> logp</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>    state_new <span class="op">=</span> <span class="cf">if</span> <span class="fu">log</span>(<span class="fu">rand</span>(rng)) <span class="op">&lt;</span> logα</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Accept.</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x̃)</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Reject.</span></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x)</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return the "sample" and the sampler state.</span></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(state_new.x), state_new</span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Fairly straight-forward.</p>
<p>Of course, we haven’t defined the <code>leapfrog_step</code> method yet, so let’s do that:</p>
<div id="24" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p` using "position" `x`.</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x))</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    p1 <span class="op">=</span> p <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update the "position" `x` using momentum `p1`.</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    x̃ <span class="op">=</span> x <span class="op">+</span> ϵ <span class="op">.*</span> (M <span class="op">\</span> p1)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p1` using position `x̃`</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x̃ <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x̃))</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    p2 <span class="op">=</span> p1 <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x̃</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Flip momentum `p2`.</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    p̃ <span class="op">=</span> <span class="op">-</span>p2</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x̃, p̃</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>leapfrog_step (generic function with 1 method)</code></pre>
</div>
</div>
<p>With all of this, we’re technically ready to sample!</p>
<div id="26" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>, <span class="bu">LinearAlgebra</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>rng <span class="op">=</span> <span class="bu">Random</span>.<span class="fu">default_rng</span>()</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>sampler <span class="op">=</span> <span class="fu">MALA</span>(<span class="fl">1</span>, I)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>state <span class="op">=</span> <span class="fu">MALAState</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)))</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>x_next, state_next <span class="op">=</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    rng,</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    AbstractMCMC.<span class="fu">LogDensityModel</span>(model),</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    state</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>(MALASample{Vector{Float64}}([0.0, 0.0, 0.0]), MALAState{Vector{Float64}}([0.0, 0.0, 0.0]))</code></pre>
</div>
</div>
<p>Great, it works!</p>
<p>And I promised we would get quite some functionality for free if we implemented <code>AbstractMCMC.step</code>, and so we can now simply call <code>sample</code> to perform standard MCMC sampling:</p>
<div id="28" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform 1000 iterations with our `MALA` sampler.</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; initial_state<span class="op">=</span>state, progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Concatenate into a matrix.</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000 Matrix{Float64}:
 -1.11984   -3.21418   -3.41043  -3.41043  …  -5.00763   -5.00763   -4.65141
  0.199635   0.459058  -1.1164   -1.1164       0.462384   0.462384   0.72668
  3.03909    3.94478    3.58974   3.58974      4.23883    4.23883    4.27152</code></pre>
</div>
</div>
<div id="30" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the marginal means and standard deviations.</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -4.98628     1.01061
 -0.00557397  1.02946
  4.9785      1.01418</code></pre>
</div>
</div>
<p>Let’s visualize the samples</p>
<div id="32" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">StatsPlots</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">transpose</span>(samples_matrix[<span class="op">:</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">:</span><span class="kw">end</span>]), alpha<span class="op">=</span><span class="fl">0.5</span>, legend<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<!--?xml version="1.0" encoding="utf-8"?-->
<svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" width="672" height="480" viewbox="0 0 2688 1920">
<defs>
  <clippath id="clip680">
    <rect x="0" y="0" width="2688" height="1920"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip680)" d="M0 1920 L2688 1920 L2688 0 L0 0  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip681">
    <rect x="537" y="0" width="1883" height="1883"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip680)" d="M151.747 1800.78 L2640.76 1800.78 L2640.76 47.2441 L151.747 47.2441  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip682">
    <rect x="151" y="47" width="2490" height="1755"></rect>
  </clippath>
</defs>
<polyline clip-path="url(#clip682)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="219.84,1800.78 219.84,47.2441 "></polyline>
<polyline clip-path="url(#clip682)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="807.458,1800.78 807.458,47.2441 "></polyline>
<polyline clip-path="url(#clip682)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1395.08,1800.78 1395.08,47.2441 "></polyline>
<polyline clip-path="url(#clip682)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1982.69,1800.78 1982.69,47.2441 "></polyline>
<polyline clip-path="url(#clip682)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="2570.31,1800.78 2570.31,47.2441 "></polyline>
<polyline clip-path="url(#clip682)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,1510.99 2640.76,1510.99 "></polyline>
<polyline clip-path="url(#clip682)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,1211.24 2640.76,1211.24 "></polyline>
<polyline clip-path="url(#clip682)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,911.487 2640.76,911.487 "></polyline>
<polyline clip-path="url(#clip682)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,611.735 2640.76,611.735 "></polyline>
<polyline clip-path="url(#clip682)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,311.983 2640.76,311.983 "></polyline>
<polyline clip-path="url(#clip680)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1800.78 2640.76,1800.78 "></polyline>
<polyline clip-path="url(#clip680)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="219.84,1800.78 219.84,1781.88 "></polyline>
<polyline clip-path="url(#clip680)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="807.458,1800.78 807.458,1781.88 "></polyline>
<polyline clip-path="url(#clip680)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1395.08,1800.78 1395.08,1781.88 "></polyline>
<polyline clip-path="url(#clip680)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1982.69,1800.78 1982.69,1781.88 "></polyline>
<polyline clip-path="url(#clip680)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="2570.31,1800.78 2570.31,1781.88 "></polyline>
<path clip-path="url(#clip680)" d="M219.84 1834 Q216.229 1834 214.4 1837.57 Q212.595 1841.11 212.595 1848.24 Q212.595 1855.34 214.4 1858.91 Q216.229 1862.45 219.84 1862.45 Q223.474 1862.45 225.28 1858.91 Q227.108 1855.34 227.108 1848.24 Q227.108 1841.11 225.28 1837.57 Q223.474 1834 219.84 1834 M219.84 1830.3 Q225.65 1830.3 228.706 1834.9 Q231.784 1839.49 231.784 1848.24 Q231.784 1856.96 228.706 1861.57 Q225.65 1866.15 219.84 1866.15 Q214.03 1866.15 210.951 1861.57 Q207.896 1856.96 207.896 1848.24 Q207.896 1839.49 210.951 1834.9 Q214.03 1830.3 219.84 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip680)" d="M771.15 1861.55 L787.47 1861.55 L787.47 1865.48 L765.525 1865.48 L765.525 1861.55 Q768.187 1858.79 772.771 1854.16 Q777.377 1849.51 778.558 1848.17 Q780.803 1845.65 781.683 1843.91 Q782.585 1842.15 782.585 1840.46 Q782.585 1837.71 780.641 1835.97 Q778.72 1834.23 775.618 1834.23 Q773.419 1834.23 770.965 1835 Q768.535 1835.76 765.757 1837.31 L765.757 1832.59 Q768.581 1831.46 771.035 1830.88 Q773.488 1830.3 775.525 1830.3 Q780.896 1830.3 784.09 1832.98 Q787.285 1835.67 787.285 1840.16 Q787.285 1842.29 786.474 1844.21 Q785.687 1846.11 783.581 1848.7 Q783.002 1849.37 779.9 1852.59 Q776.798 1855.78 771.15 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip680)" d="M797.331 1830.92 L815.687 1830.92 L815.687 1834.86 L801.613 1834.86 L801.613 1843.33 Q802.632 1842.98 803.65 1842.82 Q804.669 1842.64 805.687 1842.64 Q811.474 1842.64 814.854 1845.81 Q818.233 1848.98 818.233 1854.4 Q818.233 1859.97 814.761 1863.08 Q811.289 1866.15 804.97 1866.15 Q802.794 1866.15 800.525 1865.78 Q798.28 1865.41 795.872 1864.67 L795.872 1859.97 Q797.956 1861.11 800.178 1861.66 Q802.4 1862.22 804.877 1862.22 Q808.882 1862.22 811.22 1860.11 Q813.558 1858.01 813.558 1854.4 Q813.558 1850.78 811.22 1848.68 Q808.882 1846.57 804.877 1846.57 Q803.002 1846.57 801.127 1846.99 Q799.275 1847.4 797.331 1848.28 L797.331 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip680)" d="M837.446 1834 Q833.835 1834 832.007 1837.57 Q830.201 1841.11 830.201 1848.24 Q830.201 1855.34 832.007 1858.91 Q833.835 1862.45 837.446 1862.45 Q841.081 1862.45 842.886 1858.91 Q844.715 1855.34 844.715 1848.24 Q844.715 1841.11 842.886 1837.57 Q841.081 1834 837.446 1834 M837.446 1830.3 Q843.256 1830.3 846.312 1834.9 Q849.391 1839.49 849.391 1848.24 Q849.391 1856.96 846.312 1861.57 Q843.256 1866.15 837.446 1866.15 Q831.636 1866.15 828.557 1861.57 Q825.502 1856.96 825.502 1848.24 Q825.502 1839.49 828.557 1834.9 Q831.636 1830.3 837.446 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip680)" d="M1354.69 1830.92 L1373.05 1830.92 L1373.05 1834.86 L1358.98 1834.86 L1358.98 1843.33 Q1360 1842.98 1361.01 1842.82 Q1362.03 1842.64 1363.05 1842.64 Q1368.84 1842.64 1372.22 1845.81 Q1375.6 1848.98 1375.6 1854.4 Q1375.6 1859.97 1372.12 1863.08 Q1368.65 1866.15 1362.33 1866.15 Q1360.16 1866.15 1357.89 1865.78 Q1355.64 1865.41 1353.24 1864.67 L1353.24 1859.97 Q1355.32 1861.11 1357.54 1861.66 Q1359.76 1862.22 1362.24 1862.22 Q1366.25 1862.22 1368.58 1860.11 Q1370.92 1858.01 1370.92 1854.4 Q1370.92 1850.78 1368.58 1848.68 Q1366.25 1846.57 1362.24 1846.57 Q1360.37 1846.57 1358.49 1846.99 Q1356.64 1847.4 1354.69 1848.28 L1354.69 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip680)" d="M1394.81 1834 Q1391.2 1834 1389.37 1837.57 Q1387.56 1841.11 1387.56 1848.24 Q1387.56 1855.34 1389.37 1858.91 Q1391.2 1862.45 1394.81 1862.45 Q1398.44 1862.45 1400.25 1858.91 Q1402.08 1855.34 1402.08 1848.24 Q1402.08 1841.11 1400.25 1837.57 Q1398.44 1834 1394.81 1834 M1394.81 1830.3 Q1400.62 1830.3 1403.68 1834.9 Q1406.75 1839.49 1406.75 1848.24 Q1406.75 1856.96 1403.68 1861.57 Q1400.62 1866.15 1394.81 1866.15 Q1389 1866.15 1385.92 1861.57 Q1382.87 1856.96 1382.87 1848.24 Q1382.87 1839.49 1385.92 1834.9 Q1389 1830.3 1394.81 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip680)" d="M1424.97 1834 Q1421.36 1834 1419.53 1837.57 Q1417.73 1841.11 1417.73 1848.24 Q1417.73 1855.34 1419.53 1858.91 Q1421.36 1862.45 1424.97 1862.45 Q1428.61 1862.45 1430.41 1858.91 Q1432.24 1855.34 1432.24 1848.24 Q1432.24 1841.11 1430.41 1837.57 Q1428.61 1834 1424.97 1834 M1424.97 1830.3 Q1430.78 1830.3 1433.84 1834.9 Q1436.92 1839.49 1436.92 1848.24 Q1436.92 1856.96 1433.84 1861.57 Q1430.78 1866.15 1424.97 1866.15 Q1419.16 1866.15 1416.08 1861.57 Q1413.03 1856.96 1413.03 1848.24 Q1413.03 1839.49 1416.08 1834.9 Q1419.16 1830.3 1424.97 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip680)" d="M1940.97 1830.92 L1963.19 1830.92 L1963.19 1832.91 L1950.65 1865.48 L1945.76 1865.48 L1957.57 1834.86 L1940.97 1834.86 L1940.97 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip680)" d="M1972.36 1830.92 L1990.71 1830.92 L1990.71 1834.86 L1976.64 1834.86 L1976.64 1843.33 Q1977.66 1842.98 1978.68 1842.82 Q1979.7 1842.64 1980.72 1842.64 Q1986.5 1842.64 1989.88 1845.81 Q1993.26 1848.98 1993.26 1854.4 Q1993.26 1859.97 1989.79 1863.08 Q1986.32 1866.15 1980 1866.15 Q1977.82 1866.15 1975.55 1865.78 Q1973.31 1865.41 1970.9 1864.67 L1970.9 1859.97 Q1972.98 1861.11 1975.21 1861.66 Q1977.43 1862.22 1979.9 1862.22 Q1983.91 1862.22 1986.25 1860.11 Q1988.59 1858.01 1988.59 1854.4 Q1988.59 1850.78 1986.25 1848.68 Q1983.91 1846.57 1979.9 1846.57 Q1978.03 1846.57 1976.15 1846.99 Q1974.3 1847.4 1972.36 1848.28 L1972.36 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip680)" d="M2012.47 1834 Q2008.86 1834 2007.03 1837.57 Q2005.23 1841.11 2005.23 1848.24 Q2005.23 1855.34 2007.03 1858.91 Q2008.86 1862.45 2012.47 1862.45 Q2016.11 1862.45 2017.91 1858.91 Q2019.74 1855.34 2019.74 1848.24 Q2019.74 1841.11 2017.91 1837.57 Q2016.11 1834 2012.47 1834 M2012.47 1830.3 Q2018.28 1830.3 2021.34 1834.9 Q2024.42 1839.49 2024.42 1848.24 Q2024.42 1856.96 2021.34 1861.57 Q2018.28 1866.15 2012.47 1866.15 Q2006.66 1866.15 2003.59 1861.57 Q2000.53 1856.96 2000.53 1848.24 Q2000.53 1839.49 2003.59 1834.9 Q2006.66 1830.3 2012.47 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip680)" d="M2514.84 1861.55 L2522.48 1861.55 L2522.48 1835.18 L2514.17 1836.85 L2514.17 1832.59 L2522.43 1830.92 L2527.11 1830.92 L2527.11 1861.55 L2534.75 1861.55 L2534.75 1865.48 L2514.84 1865.48 L2514.84 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip680)" d="M2554.19 1834 Q2550.58 1834 2548.75 1837.57 Q2546.94 1841.11 2546.94 1848.24 Q2546.94 1855.34 2548.75 1858.91 Q2550.58 1862.45 2554.19 1862.45 Q2557.82 1862.45 2559.63 1858.91 Q2561.46 1855.34 2561.46 1848.24 Q2561.46 1841.11 2559.63 1837.57 Q2557.82 1834 2554.19 1834 M2554.19 1830.3 Q2560 1830.3 2563.06 1834.9 Q2566.13 1839.49 2566.13 1848.24 Q2566.13 1856.96 2563.06 1861.57 Q2560 1866.15 2554.19 1866.15 Q2548.38 1866.15 2545.3 1861.57 Q2542.25 1856.96 2542.25 1848.24 Q2542.25 1839.49 2545.3 1834.9 Q2548.38 1830.3 2554.19 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip680)" d="M2584.35 1834 Q2580.74 1834 2578.91 1837.57 Q2577.11 1841.11 2577.11 1848.24 Q2577.11 1855.34 2578.91 1858.91 Q2580.74 1862.45 2584.35 1862.45 Q2587.99 1862.45 2589.79 1858.91 Q2591.62 1855.34 2591.62 1848.24 Q2591.62 1841.11 2589.79 1837.57 Q2587.99 1834 2584.35 1834 M2584.35 1830.3 Q2590.16 1830.3 2593.22 1834.9 Q2596.3 1839.49 2596.3 1848.24 Q2596.3 1856.96 2593.22 1861.57 Q2590.16 1866.15 2584.35 1866.15 Q2578.54 1866.15 2575.46 1861.57 Q2572.41 1856.96 2572.41 1848.24 Q2572.41 1839.49 2575.46 1834.9 Q2578.54 1830.3 2584.35 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip680)" d="M2614.51 1834 Q2610.9 1834 2609.07 1837.57 Q2607.27 1841.11 2607.27 1848.24 Q2607.27 1855.34 2609.07 1858.91 Q2610.9 1862.45 2614.51 1862.45 Q2618.15 1862.45 2619.95 1858.91 Q2621.78 1855.34 2621.78 1848.24 Q2621.78 1841.11 2619.95 1837.57 Q2618.15 1834 2614.51 1834 M2614.51 1830.3 Q2620.32 1830.3 2623.38 1834.9 Q2626.46 1839.49 2626.46 1848.24 Q2626.46 1856.96 2623.38 1861.57 Q2620.32 1866.15 2614.51 1866.15 Q2608.7 1866.15 2605.62 1861.57 Q2602.57 1856.96 2602.57 1848.24 Q2602.57 1839.49 2605.62 1834.9 Q2608.7 1830.3 2614.51 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip680)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1800.78 151.747,47.2441 "></polyline>
<polyline clip-path="url(#clip680)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1510.99 170.644,1510.99 "></polyline>
<polyline clip-path="url(#clip680)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1211.24 170.644,1211.24 "></polyline>
<polyline clip-path="url(#clip680)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,911.487 170.644,911.487 "></polyline>
<polyline clip-path="url(#clip680)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,611.735 170.644,611.735 "></polyline>
<polyline clip-path="url(#clip680)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,311.983 170.644,311.983 "></polyline>
<path clip-path="url(#clip680)" d="M49.5521 1511.44 L79.2279 1511.44 L79.2279 1515.38 L49.5521 1515.38 L49.5521 1511.44 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip680)" d="M99.8991 1509.13 Q96.7509 1509.13 94.8991 1511.28 Q93.0704 1513.43 93.0704 1517.18 Q93.0704 1520.91 94.8991 1523.09 Q96.7509 1525.24 99.8991 1525.24 Q103.047 1525.24 104.876 1523.09 Q106.728 1520.91 106.728 1517.18 Q106.728 1513.43 104.876 1511.28 Q103.047 1509.13 99.8991 1509.13 M109.181 1494.47 L109.181 1498.73 Q107.422 1497.9 105.617 1497.46 Q103.834 1497.02 102.075 1497.02 Q97.4454 1497.02 94.9917 1500.15 Q92.5612 1503.27 92.2139 1509.59 Q93.5797 1507.58 95.6398 1506.51 Q97.7 1505.42 100.177 1505.42 Q105.385 1505.42 108.394 1508.59 Q111.427 1511.74 111.427 1517.18 Q111.427 1522.51 108.279 1525.72 Q105.131 1528.94 99.8991 1528.94 Q93.9037 1528.94 90.7325 1524.36 Q87.5612 1519.75 87.5612 1511.03 Q87.5612 1502.83 91.45 1497.97 Q95.3389 1493.09 101.89 1493.09 Q103.649 1493.09 105.431 1493.43 Q107.237 1493.78 109.181 1494.47 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip680)" d="M50.3623 1211.69 L80.0381 1211.69 L80.0381 1215.63 L50.3623 1215.63 L50.3623 1211.69 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip680)" d="M104.297 1209.88 Q107.654 1210.6 109.529 1212.87 Q111.427 1215.14 111.427 1218.47 Q111.427 1223.59 107.908 1226.39 Q104.39 1229.19 97.9083 1229.19 Q95.7324 1229.19 93.4176 1228.75 Q91.126 1228.33 88.6723 1227.48 L88.6723 1222.96 Q90.6167 1224.1 92.9315 1224.68 Q95.2463 1225.25 97.7695 1225.25 Q102.168 1225.25 104.459 1223.52 Q106.774 1221.78 106.774 1218.47 Q106.774 1215.42 104.621 1213.7 Q102.492 1211.97 98.6722 1211.97 L94.6445 1211.97 L94.6445 1208.13 L98.8574 1208.13 Q102.306 1208.13 104.135 1206.76 Q105.964 1205.37 105.964 1202.78 Q105.964 1200.12 104.066 1198.7 Q102.191 1197.27 98.6722 1197.27 Q96.7509 1197.27 94.5519 1197.69 Q92.3528 1198.1 89.7139 1198.98 L89.7139 1194.81 Q92.376 1194.07 94.6908 1193.7 Q97.0287 1193.33 99.0889 1193.33 Q104.413 1193.33 107.515 1195.76 Q110.617 1198.17 110.617 1202.29 Q110.617 1205.16 108.973 1207.15 Q107.33 1209.12 104.297 1209.88 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip680)" d="M99.4824 897.285 Q95.8713 897.285 94.0426 900.85 Q92.2371 904.392 92.2371 911.521 Q92.2371 918.628 94.0426 922.192 Q95.8713 925.734 99.4824 925.734 Q103.117 925.734 104.922 922.192 Q106.751 918.628 106.751 911.521 Q106.751 904.392 104.922 900.85 Q103.117 897.285 99.4824 897.285 M99.4824 893.582 Q105.293 893.582 108.348 898.188 Q111.427 902.771 111.427 911.521 Q111.427 920.248 108.348 924.855 Q105.293 929.438 99.4824 929.438 Q93.6723 929.438 90.5936 924.855 Q87.538 920.248 87.538 911.521 Q87.538 902.771 90.5936 898.188 Q93.6723 893.582 99.4824 893.582 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip680)" d="M104.297 610.38 Q107.654 611.098 109.529 613.367 Q111.427 615.635 111.427 618.968 Q111.427 624.084 107.908 626.885 Q104.39 629.686 97.9083 629.686 Q95.7324 629.686 93.4176 629.246 Q91.126 628.829 88.6723 627.973 L88.6723 623.459 Q90.6167 624.593 92.9315 625.172 Q95.2463 625.751 97.7695 625.751 Q102.168 625.751 104.459 624.015 Q106.774 622.279 106.774 618.968 Q106.774 615.913 104.621 614.2 Q102.492 612.464 98.6722 612.464 L94.6445 612.464 L94.6445 608.621 L98.8574 608.621 Q102.306 608.621 104.135 607.255 Q105.964 605.867 105.964 603.274 Q105.964 600.612 104.066 599.2 Q102.191 597.765 98.6722 597.765 Q96.7509 597.765 94.5519 598.181 Q92.3528 598.598 89.7139 599.478 L89.7139 595.311 Q92.376 594.57 94.6908 594.2 Q97.0287 593.83 99.0889 593.83 Q104.413 593.83 107.515 596.26 Q110.617 598.668 110.617 602.788 Q110.617 605.658 108.973 607.649 Q107.33 609.617 104.297 610.38 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip680)" d="M99.8991 310.119 Q96.7509 310.119 94.8991 312.272 Q93.0704 314.425 93.0704 318.175 Q93.0704 321.902 94.8991 324.078 Q96.7509 326.23 99.8991 326.23 Q103.047 326.23 104.876 324.078 Q106.728 321.902 106.728 318.175 Q106.728 314.425 104.876 312.272 Q103.047 310.119 99.8991 310.119 M109.181 295.467 L109.181 299.726 Q107.422 298.892 105.617 298.453 Q103.834 298.013 102.075 298.013 Q97.4454 298.013 94.9917 301.138 Q92.5612 304.263 92.2139 310.582 Q93.5797 308.568 95.6398 307.504 Q97.7 306.416 100.177 306.416 Q105.385 306.416 108.394 309.587 Q111.427 312.735 111.427 318.175 Q111.427 323.499 108.279 326.716 Q105.131 329.934 99.8991 329.934 Q93.9037 329.934 90.7325 325.351 Q87.5612 320.744 87.5612 312.017 Q87.5612 303.823 91.45 298.962 Q95.3389 294.078 101.89 294.078 Q103.649 294.078 105.431 294.425 Q107.237 294.772 109.181 295.467 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip682)" style="stroke:#009af9; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,1023.38 224.541,1407.75 226.891,1444.64 229.242,1298.88 231.592,1403.5 233.943,1350.33 236.293,1272.41 238.644,1466.3 240.994,1398.35 243.345,1369.74 245.695,1609.16 248.046,1447.15 250.396,1427.56 252.747,1372.44 255.097,1397.62 257.448,1361.78 259.798,1471.88 262.148,1576.38 264.499,1350.68 266.849,1391.26 269.2,1282.2 271.55,1253.37 273.901,1438.37 276.251,1326.34 278.602,1379.45 280.952,1184.65 283.303,1288.44 285.653,1317.08 288.004,1415.28 290.354,1444.54 292.705,1342.49 295.055,1263.49 297.406,1412.35 299.756,1339.98 302.107,1299.01 304.457,1418.78 306.807,1530.67 309.158,1382.55 311.508,1252.11 313.859,1423.34 316.209,1343.43 318.56,1396.81 320.91,1509.48 323.261,1465.26 325.611,1401.37 327.962,1409.9 330.312,1262.31 332.663,1540.81 335.013,1422.24 337.364,1488.6 339.714,1350.09 342.065,1303.1 344.415,1274.86 346.765,1411.14 349.116,1422.11 351.466,1461.7 353.817,1356.24 356.167,1447.65 358.518,1566.02 360.868,1469.88 363.219,1548.38 365.569,1589.54 367.92,1522.46 370.27,1486.53 372.621,1319.86 374.971,1345.63 377.322,1470.39 379.672,1494.89 382.023,1303.75 384.373,1403.3 386.724,1303.91 389.074,1449.33 391.424,1180.51 393.775,1490.23 396.125,1445.75 398.476,1402.8 400.826,1389.13 403.177,1325.05 405.527,1447.94 407.878,1465.41 410.228,1460.9 412.579,1431.08 414.929,1335.36 417.28,1269.31 419.63,1303.33 421.981,1287.04 424.331,1528.31 426.682,1348.23 429.032,1348.23 431.382,1275.38 433.733,1550.32 436.083,1224.55 438.434,1432.79 440.784,1416.6 443.135,1396.38 445.485,1550.13 447.836,1158.47 450.186,1411.9 452.537,1349.59 454.887,1414.45 457.238,1132.29 459.588,1594.24 461.939,1379.59 464.289,1581.92 466.64,1446.67 468.99,1464.03 471.341,1201.12 473.691,1304.71 476.041,1425.55 478.392,1516.63 480.742,1425.93 483.093,1377.42 485.443,1400.34 487.794,1547.84 490.144,1312.54 492.495,1621.14 494.845,1356.94 497.196,1305.68 499.546,1384.02 501.897,1444.93 504.247,1560.77 506.598,1347.47 508.948,1540.42 511.299,1392.52 513.649,1541.7 515.999,1510.92 518.35,1325.02 520.7,1340.11 523.051,1473.9 525.401,1290.44 527.752,1335.11 530.102,1422.36 532.453,1355.64 534.803,1386.07 537.154,1522.89 539.504,1333.62 541.855,1387.81 544.205,1304 546.556,1625.85 548.906,1479.51 551.257,1401.33 553.607,1345.68 555.958,1289.38 558.308,1466.24 560.658,1458.83 563.009,1315.73 565.359,1295.48 567.71,1367.89 570.06,1636.01 572.411,1442.74 574.761,1383.92 577.112,1554.59 579.462,1591.71 581.813,1550.5 584.163,1347.4 586.514,1413.22 588.864,1374.68 591.215,1496.44 593.565,1751.15 595.916,1479.24 598.266,1303.5 600.616,1357.87 602.967,1396.21 605.317,1397.98 607.668,1592.19 610.018,1288.33 612.369,1556.16 614.719,1296.91 617.07,1276.53 619.42,1324.52 621.771,1222.01 624.121,1356.02 626.472,1305.97 628.822,1461.6 631.173,1380.24 633.523,1396.07 635.874,1505.66 638.224,1434.91 640.575,1374.37 642.925,1425.57 645.275,1453.32 647.626,1430.96 649.976,1470.23 652.327,1430.71 654.677,1301.48 657.028,1424.9 659.378,1391.79 661.729,1617.91 664.079,1396.2 666.43,1386.26 668.78,1496.28 671.131,1375.92 673.481,1516.7 675.832,1414.28 678.182,1532.23 680.533,1431.46 682.883,1389.14 685.233,1325.16 687.584,1356.79 689.934,1392.3 692.285,1236.31 694.635,1495.94 696.986,1450.51 699.336,1279.91 701.687,1402.08 704.037,1324.09 706.388,1666.89 708.738,1397.17 711.089,1606.34 713.439,1329.42 715.79,1222.94 718.14,1309.25 720.491,1312.12 722.841,1555.95 725.192,1290.62 727.542,1413.85 729.892,1660.4 732.243,1341.8 734.593,1450.41 736.944,1448.15 739.294,1391.29 741.645,1366.18 743.995,1321.83 746.346,1130.77 748.696,1556.46 751.047,1401.56 753.397,1323.17 755.748,1447.67 758.098,1560.28 760.449,1211.17 762.799,1511.33 765.15,1399.83 767.5,1706.74 769.85,1352.87 772.201,1350.11 774.551,1512.32 776.902,1426.96 779.252,1399.31 781.603,1488.2 783.953,1431.14 786.304,1396.48 788.654,1501.94 791.005,1421.72 793.355,1551.77 795.706,1451.62 798.056,1464.53 800.407,1407.39 802.757,1394.38 805.108,1202.99 807.458,1276.78 809.809,1437.02 812.159,1415.13 814.509,1238.94 816.86,1450.03 819.21,1411 821.561,1249.45 823.911,1408.15 826.262,1401.4 828.612,1372.94 830.963,1367.6 833.313,1295.4 835.664,1506.03 838.014,1475.84 840.365,1428.31 842.715,1426.34 845.066,1399.74 847.416,1260.84 849.767,1496.59 852.117,1492.04 854.467,1514.22 856.818,1257.09 859.168,1410.55 861.519,1374.56 863.869,1386.67 866.22,1463.31 868.57,1421.62 870.921,1483.42 873.271,1154.38 875.622,1258.07 877.972,1335.69 880.323,1518.29 882.673,1311.91 885.024,1427.2 887.374,1402.02 889.725,1376.04 892.075,1275.65 894.426,1439.26 896.776,1478.03 899.126,1248.69 901.477,1318.77 903.827,1318.85 906.178,1670.36 908.528,1366.98 910.879,1246.36 913.229,1494.14 915.58,1242.89 917.93,1364.71 920.281,1559.54 922.631,1515.42 924.982,1417.2 927.332,1313.32 929.683,1558.96 932.033,1434.6 934.384,1362.56 936.734,1374.41 939.084,1425.43 941.435,1319.2 943.785,1457.22 946.136,1425.86 948.486,1564.37 950.837,1459.42 953.187,1368.95 955.538,1244.35 957.888,1435.26 960.239,1435.36 962.589,1428.5 964.94,1462.68 967.29,1380.53 969.641,1354.98 971.991,1231.51 974.342,1393.18 976.692,1356.04 979.043,1371.88 981.393,1574.32 983.743,1481.94 986.094,1507.75 988.444,1438.98 990.795,1482.9 993.145,1272.11 995.496,1437.49 997.846,1380.39 1000.2,1221.69 1002.55,1499.1 1004.9,1385.11 1007.25,1279.55 1009.6,1425.8 1011.95,1353.1 1014.3,1470.21 1016.65,1462.1 1019,1368.03 1021.35,1531.3 1023.7,1371.13 1026.05,1434.76 1028.4,1650.18 1030.75,1494.71 1033.1,1405.91 1035.45,1316.18 1037.8,1320.87 1040.15,1504.07 1042.51,1262.24 1044.86,1440.21 1047.21,1506.88 1049.56,1420.25 1051.91,1203.23 1054.26,1399.88 1056.61,1477.51 1058.96,1449.16 1061.31,1471.29 1063.66,1374.96 1066.01,1398.94 1068.36,1233.96 1070.71,1489.06 1073.06,1412.62 1075.41,1378.47 1077.76,1525.57 1080.11,1338.96 1082.46,1515.83 1084.81,1381.16 1087.16,1448.78 1089.51,1377.25 1091.87,1440.6 1094.22,1389.48 1096.57,1419.08 1098.92,1478.05 1101.27,1545.53 1103.62,1375.7 1105.97,1371.96 1108.32,1240.9 1110.67,1352.56 1113.02,1371.16 1115.37,1395.68 1117.72,1399.81 1120.07,1472.7 1122.42,1428.21 1124.77,1426.01 1127.12,1367.99 1129.47,1454.43 1131.82,1425.82 1134.17,1478.57 1136.52,1410.87 1138.87,1618.21 1141.23,1415.63 1143.58,1622.68 1145.93,1338.59 1148.28,1349.77 1150.63,1457.81 1152.98,1486.43 1155.33,1422.06 1157.68,1442.95 1160.03,1422.55 1162.38,1419.38 1164.73,1468.54 1167.08,1517.38 1169.43,1405.45 1171.78,1502.31 1174.13,1377.61 1176.48,1373.13 1178.83,1323.54 1181.18,1325.26 1183.53,1485.52 1185.88,1167.94 1188.23,1475.77 1190.59,1363.45 1192.94,1475.46 1195.29,1327.16 1197.64,1443.78 1199.99,1528.79 1202.34,1398.7 1204.69,1518.88 1207.04,1522.47 1209.39,1466.93 1211.74,1465.63 1214.09,1413.19 1216.44,1389.3 1218.79,1485.7 1221.14,1220.68 1223.49,1366.5 1225.84,1331.95 1228.19,1352.23 1230.54,1348.88 1232.89,1306.42 1235.24,1528.09 1237.59,1344.39 1239.94,1490.85 1242.3,1535.18 1244.65,1291.18 1247,1366.14 1249.35,1567.03 1251.7,1413.5 1254.05,1444.99 1256.4,1632.1 1258.75,1398.21 1261.1,1499.44 1263.45,1426.31 1265.8,1410.68 1268.15,1374.06 1270.5,1518.39 1272.85,1416.76 1275.2,1190.22 1277.55,1491.65 1279.9,1381.92 1282.25,1298.4 1284.6,1473.77 1286.95,1419.71 1289.3,1436.94 1291.66,1444.65 1294.01,1382.66 1296.36,1287.24 1298.71,1368.43 1301.06,1462.36 1303.41,1523.92 1305.76,1460.78 1308.11,1515.09 1310.46,1382.73 1312.81,1547.75 1315.16,1355.59 1317.51,1328.68 1319.86,1215.63 1322.21,1423.24 1324.56,1431.39 1326.91,1406.23 1329.26,1249.53 1331.61,1383.64 1333.96,1388.07 1336.31,1435.29 1338.66,1338.41 1341.02,1282.77 1343.37,1382.93 1345.72,1345.02 1348.07,1370.22 1350.42,1521.23 1352.77,1335.67 1355.12,1373.79 1357.47,1397.5 1359.82,1394.97 1362.17,1379.76 1364.52,1293.72 1366.87,1405.77 1369.22,1600.66 1371.57,1443.54 1373.92,1381.23 1376.27,1501.03 1378.62,1363.21 1380.97,1345.04 1383.32,1464.78 1385.67,1223.9 1388.02,1202.06 1390.38,1423.19 1392.73,1579.31 1395.08,1241.75 1397.43,1411.49 1399.78,1376.6 1402.13,1310.29 1404.48,1579.61 1406.83,1414.39 1409.18,1488.74 1411.53,1308.98 1413.88,1429.7 1416.23,1512.32 1418.58,1362.47 1420.93,1413.21 1423.28,1385.51 1425.63,1480.89 1427.98,1373 1430.33,1269.74 1432.68,1535.5 1435.03,1405.37 1437.38,1428.94 1439.74,1361.24 1442.09,1573.68 1444.44,1594.97 1446.79,1553.82 1449.14,1288.54 1451.49,1431.48 1453.84,1473.22 1456.19,1544.66 1458.54,1393.4 1460.89,1641.74 1463.24,1457.52 1465.59,1226.67 1467.94,1330.35 1470.29,1417.93 1472.64,1327.72 1474.99,1376.1 1477.34,1568.85 1479.69,1343.49 1482.04,1619.17 1484.39,1239.48 1486.74,1306.21 1489.1,1654.19 1491.45,1492.93 1493.8,1436.53 1496.15,1179.68 1498.5,1180.79 1500.85,1501.72 1503.2,1501.83 1505.55,1386.41 1507.9,1288.06 1510.25,1378.14 1512.6,1268.64 1514.95,1582.92 1517.3,1586.19 1519.65,1392.57 1522,1322.39 1524.35,1444.96 1526.7,1354.09 1529.05,1427.44 1531.4,1482.61 1533.75,1520.52 1536.1,1250.4 1538.45,1452.82 1540.81,1316.59 1543.16,1459.16 1545.51,1420.61 1547.86,1501.7 1550.21,1461.41 1552.56,1309.97 1554.91,1378.13 1557.26,1522.76 1559.61,1446.39 1561.96,1450.49 1564.31,1475.38 1566.66,1280.09 1569.01,1422.69 1571.36,1364.17 1573.71,1471.75 1576.06,1394.26 1578.41,1332.94 1580.76,1405.22 1583.11,1462.42 1585.46,1419.19 1587.81,1330.38 1590.17,1518.68 1592.52,1366.64 1594.87,1481.03 1597.22,1518.54 1599.57,1573.24 1601.92,1373.17 1604.27,1483.5 1606.62,1335.32 1608.97,1352.3 1611.32,1311.22 1613.67,1421.75 1616.02,1439.71 1618.37,1514.43 1620.72,1518.08 1623.07,1335.94 1625.42,1353.25 1627.77,1418.17 1630.12,1593.82 1632.47,1493.45 1634.82,1637.16 1637.17,1577.87 1639.53,1330.84 1641.88,1240.74 1644.23,1178.72 1646.58,1316.34 1648.93,1387.15 1651.28,1327.65 1653.63,1398.65 1655.98,1294.05 1658.33,1304.24 1660.68,1418.76 1663.03,1304.87 1665.38,1350.57 1667.73,1384.25 1670.08,1394.1 1672.43,1478 1674.78,1347.65 1677.13,1272.45 1679.48,1322.97 1681.83,1563.01 1684.18,1419.72 1686.53,1405.81 1688.89,1476.12 1691.24,1406.45 1693.59,1237.92 1695.94,1253.76 1698.29,1498.22 1700.64,1409.69 1702.99,1521.81 1705.34,1470.61 1707.69,1420.43 1710.04,1408.78 1712.39,1448.77 1714.74,1396.94 1717.09,1499.43 1719.44,1426.85 1721.79,1241.35 1724.14,1218.4 1726.49,1534.2 1728.84,1384.75 1731.19,1245.84 1733.54,1475 1735.89,1257.57 1738.25,1569.11 1740.6,1424.23 1742.95,1372.77 1745.3,1441.85 1747.65,1505.64 1750,1424.86 1752.35,1412.5 1754.7,1498.29 1757.05,1429.07 1759.4,1539.67 1761.75,1289.18 1764.1,1567.55 1766.45,1150.93 1768.8,1366.38 1771.15,1160.24 1773.5,1379.4 1775.85,1580.01 1778.2,1511.93 1780.55,1300.87 1782.9,1458.32 1785.25,1341.28 1787.6,1339.21 1789.96,1432.05 1792.31,1536.17 1794.66,1351.34 1797.01,1549.75 1799.36,1328.66 1801.71,1602.47 1804.06,1113.27 1806.41,1488.95 1808.76,1451.19 1811.11,1294.66 1813.46,1479.48 1815.81,1535.15 1818.16,1345.26 1820.51,1406.17 1822.86,1436.73 1825.21,1352.36 1827.56,1481.72 1829.91,1211.25 1832.26,1479.58 1834.61,1388.68 1836.96,1480.13 1839.32,1340.91 1841.67,1346.72 1844.02,1507.01 1846.37,1288.19 1848.72,1506.64 1851.07,1313.04 1853.42,1308.58 1855.77,1298.23 1858.12,1253.84 1860.47,1372.99 1862.82,1480.26 1865.17,1590.48 1867.52,1363.78 1869.87,1385.18 1872.22,1360.2 1874.57,1332.42 1876.92,1401.16 1879.27,1562.75 1881.62,1413.99 1883.97,1384.03 1886.32,1575.66 1888.68,1314.87 1891.03,1330.71 1893.38,1445.46 1895.73,1395.33 1898.08,1372.17 1900.43,1231.47 1902.78,1480.58 1905.13,1352.61 1907.48,1279.19 1909.83,1385.47 1912.18,1396.88 1914.53,1256.42 1916.88,1304.5 1919.23,1335.35 1921.58,1557.56 1923.93,1362.29 1926.28,1414.9 1928.63,1324.17 1930.98,1460.68 1933.33,1430.88 1935.68,1412.64 1938.04,1302.02 1940.39,1479.99 1942.74,1305.64 1945.09,1269.14 1947.44,1550.57 1949.79,1115.58 1952.14,1455.46 1954.49,1487.47 1956.84,1744.53 1959.19,1492.07 1961.54,1309.29 1963.89,1420.74 1966.24,1440.12 1968.59,1486.73 1970.94,1535.84 1973.29,1423.46 1975.64,1281.11 1977.99,1285.25 1980.34,1209.76 1982.69,1315.56 1985.04,1476.35 1987.4,1347.48 1989.75,1348.23 1992.1,1351.49 1994.45,1376.48 1996.8,1318.81 1999.15,1385.38 2001.5,1412.17 2003.85,1336.46 2006.2,1363.38 2008.55,1329.45 2010.9,1390.3 2013.25,1339.05 2015.6,1360.02 2017.95,1439.54 2020.3,1455.46 2022.65,1331.16 2025,1395.34 2027.35,1564.25 2029.7,1478.1 2032.05,1458.73 2034.4,1267.7 2036.76,1420.64 2039.11,1342.99 2041.46,1596.32 2043.81,1381.8 2046.16,1432.96 2048.51,1466.07 2050.86,1334.7 2053.21,1313.45 2055.56,1495.72 2057.91,1319.41 2060.26,1432.58 2062.61,1323.82 2064.96,1585.65 2067.31,1513.13 2069.66,1487.83 2072.01,1575.87 2074.36,1306.36 2076.71,1333.87 2079.06,1424.77 2081.41,1221.73 2083.76,1577.19 2086.11,1515.04 2088.47,1416.76 2090.82,1625.5 2093.17,1443.99 2095.52,1472.17 2097.87,1418.07 2100.22,1490.45 2102.57,1368.53 2104.92,1440.07 2107.27,1522.75 2109.62,1381.39 2111.97,1582 2114.32,1429.02 2116.67,1464.45 2119.02,1419.93 2121.37,1318.07 2123.72,1230.2 2126.07,1377.75 2128.42,1335.62 2130.77,1379.77 2133.12,1411.91 2135.47,1437.88 2137.83,1408.36 2140.18,1539.24 2142.53,1394.23 2144.88,1388.53 2147.23,1276.89 2149.58,1420.64 2151.93,1522.83 2154.28,1428.27 2156.63,1377.05 2158.98,1503.32 2161.33,1379.75 2163.68,1255.56 2166.03,1376.03 2168.38,1490.52 2170.73,1299.48 2173.08,1483.35 2175.43,1324.11 2177.78,1441.77 2180.13,1417.56 2182.48,1326.08 2184.83,1444.57 2187.19,1375.55 2189.54,1436.85 2191.89,1300.58 2194.24,1403.48 2196.59,1231.31 2198.94,1342.23 2201.29,1375.17 2203.64,1476.93 2205.99,1444.68 2208.34,1330.61 2210.69,1372.79 2213.04,1320.98 2215.39,1331.96 2217.74,1535.2 2220.09,1062.19 2222.44,1329.55 2224.79,1385.89 2227.14,1345.29 2229.49,1468.15 2231.84,1326.33 2234.19,1678.9 2236.55,1417.39 2238.9,1640.42 2241.25,1439.16 2243.6,1524.9 2245.95,1550.99 2248.3,1358.03 2250.65,1288.15 2253,1345.93 2255.35,1453.24 2257.7,1245.75 2260.05,1486.21 2262.4,1329.5 2264.75,1279.34 2267.1,1336.79 2269.45,1535.87 2271.8,1259.5 2274.15,1402.78 2276.5,1312.2 2278.85,1347.55 2281.2,1508.62 2283.55,1263.12 2285.91,1550.24 2288.26,1461.41 2290.61,1276 2292.96,1311.85 2295.31,1410.74 2297.66,1412.18 2300.01,1344.53 2302.36,1521.72 2304.71,1409.62 2307.06,1437.11 2309.41,1283.74 2311.76,1438.83 2314.11,1381.65 2316.46,1415.97 2318.81,1456.98 2321.16,1331.5 2323.51,1188.97 2325.86,1328.69 2328.21,1462.26 2330.56,1371.14 2332.91,1371.46 2335.27,1402.71 2337.62,1400.32 2339.97,1416.47 2342.32,1534.94 2344.67,1555.92 2347.02,1387.26 2349.37,1420.08 2351.72,1252.34 2354.07,1429.99 2356.42,1483.86 2358.77,1608.3 2361.12,1333.05 2363.47,1406.91 2365.82,1649.67 2368.17,1481.65 2370.52,1455.24 2372.87,1301.99 2375.22,1514.7 2377.57,1337.09 2379.92,1423.95 2382.27,1490.25 2384.62,1424.2 2386.98,1341.58 2389.33,1359.37 2391.68,1405.2 2394.03,1528.63 2396.38,1433.5 2398.73,1406.25 2401.08,1526.04 2403.43,1402.82 2405.78,1375.97 2408.13,1285.4 2410.48,1259.79 2412.83,1435.35 2415.18,1474.81 2417.53,1394.56 2419.88,1489.06 2422.23,1304.98 2424.58,1395.57 2426.93,1483.85 2429.28,1366.82 2431.63,1530.99 2433.98,1263.53 2436.34,1362.23 2438.69,1356.35 2441.04,1375.69 2443.39,1581.79 2445.74,1351.95 2448.09,1385.66 2450.44,1580.66 2452.79,1522.37 2455.14,1451.41 2457.49,1266.69 2459.84,1257.24 2462.19,1253.85 2464.54,1509.1 2466.89,1435.9 2469.24,1356.36 2471.59,1516.29 2473.94,1440.83 2476.29,1344.86 2478.64,1431.75 2480.99,1302.04 2483.34,1525.63 2485.7,1370.48 2488.05,1242.99 2490.4,1420.43 2492.75,1381.69 2495.1,1502.91 2497.45,1614.34 2499.8,1412.61 2502.15,1485.88 2504.5,1434.36 2506.85,1571.7 2509.2,1363.38 2511.55,1520 2513.9,1307.74 2516.25,1389.74 2518.6,1389.97 2520.95,1361.04 2523.3,1548.77 2525.65,1377.35 2528,1250.79 2530.35,1558.25 2532.7,1337.44 2535.06,1399.86 2537.41,1385.73 2539.76,1578.15 2542.11,1298.89 2544.46,1295.31 2546.81,1251.84 2549.16,1528.62 2551.51,1429.15 2553.86,1429.57 2556.21,1533.58 2558.56,1276.11 2560.91,1322.21 2563.26,1325.72 2565.61,1440.97 2567.96,1431.46 2570.31,1569.07 "></polyline>
<polyline clip-path="url(#clip682)" style="stroke:#e26f46; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,891.54 224.541,1073.84 226.891,993.327 229.242,783.464 231.592,915.82 233.943,983.727 236.293,869.783 238.644,879.526 240.994,974.677 243.345,1037.18 245.695,983.622 248.046,997.093 250.396,812.232 252.747,830.748 255.097,918.164 257.448,1012.7 259.798,1049.21 262.148,789.545 264.499,782.965 266.849,916.329 269.2,912.966 271.55,1000.47 273.901,935.24 276.251,1015.6 278.602,888.414 280.952,937.809 283.303,798.724 285.653,941.683 288.004,897.104 290.354,977.195 292.705,1106.82 295.055,841.644 297.406,972.765 299.756,885.886 302.107,903.678 304.457,931.481 306.807,868.336 309.158,731.167 311.508,1002.42 313.859,857.912 316.209,998.604 318.56,812.043 320.91,909.905 323.261,981.404 325.611,944.054 327.962,980.84 330.312,858.179 332.663,934.471 335.013,927.246 337.364,863.563 339.714,871.878 342.065,778.514 344.415,1034.33 346.765,936.981 349.116,1090.8 351.466,1020.76 353.817,845.547 356.167,1031.82 358.518,851.948 360.868,1005.49 363.219,998.654 365.569,775.03 367.92,954.326 370.27,965.401 372.621,1104.98 374.971,794.686 377.322,1031.08 379.672,988.678 382.023,851.883 384.373,904.071 386.724,628.263 389.074,879.461 391.424,803.788 393.775,709.969 396.125,962.632 398.476,834.123 400.826,718.669 403.177,887.333 405.527,988.871 407.878,1015.13 410.228,713.934 412.579,957.961 414.929,922.18 417.28,889.326 419.63,1151.99 421.981,795.326 424.331,825.226 426.682,870.274 429.032,948.448 431.382,996.401 433.733,794.785 436.083,803.22 438.434,1018.88 440.784,805.915 443.135,1000.62 445.485,931.947 447.836,880.753 450.186,814.57 452.537,870.884 454.887,980.889 457.238,912.671 459.588,967.567 461.939,847.84 464.289,1045.62 466.64,978.065 468.99,777.693 471.341,1101.76 473.691,1041.35 476.041,955.203 478.392,951.358 480.742,774.649 483.093,1082.4 485.443,772.9 487.794,1114.07 490.144,671.616 492.495,795.828 494.845,902.31 497.196,1055.42 499.546,936.843 501.897,897.7 504.247,811.372 506.598,864.063 508.948,984.228 511.299,894.215 513.649,889.441 515.999,955.847 518.35,915.256 520.7,1032.71 523.051,945.463 525.401,1059.88 527.752,935.319 530.102,933.267 532.453,741.872 534.803,841.511 537.154,980.593 539.504,1008.69 541.855,814.862 544.205,980.937 546.556,916.246 548.906,761.215 551.257,1066.42 553.607,850.966 555.958,1122.87 558.308,948.851 560.658,892.657 563.009,869.469 565.359,855.441 567.71,888.49 570.06,967.441 572.411,1053.48 574.761,860.028 577.112,842.685 579.462,871.561 581.813,871.786 584.163,927.4 586.514,838.654 588.864,951.88 591.215,813.41 593.565,923.182 595.916,753.956 598.266,1010.35 600.616,1027.1 602.967,781.956 605.317,948.053 607.668,613.583 610.018,1066.5 612.369,1117.86 614.719,929.072 617.07,998.758 619.42,850.627 621.771,784.722 624.121,864.952 626.472,940.074 628.822,919.983 631.173,916.818 633.523,1011.89 635.874,1048.9 638.224,1097.28 640.575,852.427 642.925,775.56 645.275,1022.25 647.626,990.212 649.976,925.391 652.327,802.665 654.677,959.137 657.028,905.284 659.378,941.91 661.729,839.068 664.079,821.779 666.43,715.364 668.78,890.848 671.131,750.567 673.481,1050.2 675.832,877.248 678.182,831.233 680.533,1038.02 682.883,816.037 685.233,777.395 687.584,959.544 689.934,796.992 692.285,851.746 694.635,981.164 696.986,913.242 699.336,947.013 701.687,968.477 704.037,901.163 706.388,929.831 708.738,1037.28 711.089,1003.24 713.439,1062.1 715.79,852.994 718.14,989.172 720.491,1080.64 722.841,914.346 725.192,915.708 727.542,1058.44 729.892,837.747 732.243,775.371 734.593,967.543 736.944,775.506 739.294,881.9 741.645,789.505 743.995,882.533 746.346,982.122 748.696,926.888 751.047,938.442 753.397,745.818 755.748,802.376 758.098,864.484 760.449,701.398 762.799,913.737 765.15,956.691 767.5,873.848 769.85,742.144 772.201,840.499 774.551,900.134 776.902,877.898 779.252,883.366 781.603,1106.8 783.953,952.627 786.304,1079.1 788.654,1007.46 791.005,1076.12 793.355,967.483 795.706,940.255 798.056,891.517 800.407,949.048 802.757,863.785 805.108,750.545 807.458,946.141 809.809,723.65 812.159,960.791 814.509,885.855 816.86,909.456 819.21,954.574 821.561,605.966 823.911,1073.45 826.262,1061.48 828.612,1037.87 830.963,1107.8 833.313,872.412 835.664,761.91 838.014,873.93 840.365,817.248 842.715,826.512 845.066,961.714 847.416,713.02 849.767,828.358 852.117,821.969 854.467,951.561 856.818,909.961 859.168,827.172 861.519,998.307 863.869,838.981 866.22,984.458 868.57,821.606 870.921,851.354 873.271,958.647 875.622,1008.62 877.972,909.287 880.323,925.285 882.673,1107.26 885.024,950.72 887.374,1022.25 889.725,971.282 892.075,1080.33 894.426,933.486 896.776,885.346 899.126,825.458 901.477,703.176 903.827,1011.2 906.178,998.915 908.528,938.007 910.879,839.921 913.229,917.38 915.58,982.093 917.93,1034.43 920.281,861.527 922.631,939.515 924.982,883.8 927.332,798.904 929.683,999.787 932.033,834.225 934.384,748.766 936.734,965.804 939.084,787.947 941.435,840.401 943.785,841.523 946.136,996.697 948.486,947.861 950.837,841.136 953.187,759.488 955.538,864.46 957.888,926.264 960.239,850.698 962.589,903.242 964.94,826.816 967.29,710.16 969.641,871.091 971.991,782.257 974.342,924.407 976.692,972.648 979.043,842.431 981.393,933.732 983.743,869.719 986.094,894.395 988.444,933.741 990.795,858.374 993.145,985.663 995.496,1016.01 997.846,930.538 1000.2,942.725 1002.55,938.141 1004.9,899.58 1007.25,753.022 1009.6,961.651 1011.95,768.885 1014.3,989.574 1016.65,837.353 1019,1039.29 1021.35,913.442 1023.7,833.859 1026.05,970.002 1028.4,799.146 1030.75,997.53 1033.1,1082.63 1035.45,811.895 1037.8,881.373 1040.15,859.622 1042.51,764.456 1044.86,785.822 1047.21,791.433 1049.56,822.001 1051.91,949.771 1054.26,814.616 1056.61,1116.24 1058.96,838.378 1061.31,862.053 1063.66,869.874 1066.01,1051.21 1068.36,978.665 1070.71,906.346 1073.06,733.637 1075.41,899.809 1077.76,857.654 1080.11,953.823 1082.46,893.694 1084.81,854.361 1087.16,1076.57 1089.51,914.422 1091.87,1016.54 1094.22,1060.92 1096.57,866.439 1098.92,1136.84 1101.27,997.391 1103.62,1037.99 1105.97,816.431 1108.32,1058.13 1110.67,1101.89 1113.02,1041.81 1115.37,856.431 1117.72,988.403 1120.07,828.497 1122.42,900.519 1124.77,963.77 1127.12,712.234 1129.47,831.712 1131.82,845.235 1134.17,939.868 1136.52,964.544 1138.87,870.471 1141.23,828.199 1143.58,860.284 1145.93,857.588 1148.28,980.427 1150.63,1073.72 1152.98,995.227 1155.33,944.11 1157.68,887.818 1160.03,885.67 1162.38,951.183 1164.73,1000.87 1167.08,908.789 1169.43,795.229 1171.78,766.966 1174.13,761.207 1176.48,718.474 1178.83,866.031 1181.18,1133.96 1183.53,938.35 1185.88,1073.27 1188.23,1041.82 1190.59,890.997 1192.94,918.351 1195.29,661.88 1197.64,910.532 1199.99,1001.79 1202.34,821.823 1204.69,862.706 1207.04,889.847 1209.39,795.112 1211.74,852.317 1214.09,1038.63 1216.44,950.574 1218.79,847.704 1221.14,781.831 1223.49,951.846 1225.84,892.029 1228.19,829.241 1230.54,960.227 1232.89,958.402 1235.24,837.09 1237.59,952.205 1239.94,910.963 1242.3,1056.48 1244.65,784.379 1247,806.218 1249.35,907.039 1251.7,841.057 1254.05,974.682 1256.4,835.301 1258.75,796.068 1261.1,766.072 1263.45,764.518 1265.8,827.294 1268.15,884.875 1270.5,882.115 1272.85,1008.32 1275.2,897.199 1277.55,875.873 1279.9,904.833 1282.25,930.886 1284.6,949.173 1286.95,1026.07 1289.3,925.894 1291.66,776.344 1294.01,879.424 1296.36,909.878 1298.71,1019.08 1301.06,1004.35 1303.41,870.355 1305.76,1072.65 1308.11,884.329 1310.46,917.915 1312.81,697.28 1315.16,899.129 1317.51,848.51 1319.86,860.432 1322.21,818.124 1324.56,965.398 1326.91,1065.27 1329.26,904.729 1331.61,934.651 1333.96,946.515 1336.31,884.411 1338.66,990.05 1341.02,761.811 1343.37,963.943 1345.72,961.846 1348.07,953.113 1350.42,1022.4 1352.77,1001.28 1355.12,976.908 1357.47,1030.16 1359.82,926.367 1362.17,937.434 1364.52,981.369 1366.87,815.569 1369.22,1044.51 1371.57,1028.29 1373.92,818.192 1376.27,819.03 1378.62,949.659 1380.97,1080.88 1383.32,1039.25 1385.67,916.823 1388.02,930.234 1390.38,949.111 1392.73,950.051 1395.08,943.243 1397.43,860.752 1399.78,764.008 1402.13,746.951 1404.48,759.33 1406.83,797.125 1409.18,699.306 1411.53,1001.59 1413.88,1008.21 1416.23,982.416 1418.58,890.078 1420.93,836.462 1423.28,907.551 1425.63,913.711 1427.98,827.614 1430.33,849.273 1432.68,1092.98 1435.03,829.87 1437.38,794.72 1439.74,849.48 1442.09,1024.42 1444.44,904.085 1446.79,846.017 1449.14,862.09 1451.49,1002.46 1453.84,969.665 1456.19,846.038 1458.54,734.353 1460.89,925.775 1463.24,996.951 1465.59,1079.3 1467.94,817.154 1470.29,869.934 1472.64,1083.21 1474.99,809.856 1477.34,721.888 1479.69,1051.15 1482.04,947.48 1484.39,967.692 1486.74,1221.64 1489.1,829.167 1491.45,1001.95 1493.8,949.127 1496.15,918.327 1498.5,898.018 1500.85,756.644 1503.2,786.025 1505.55,761.957 1507.9,774.839 1510.25,707.651 1512.6,900.836 1514.95,743.099 1517.3,992.473 1519.65,964.449 1522,902.93 1524.35,1100.32 1526.7,764.326 1529.05,827.437 1531.4,946.677 1533.75,863.282 1536.1,903.446 1538.45,908.017 1540.81,769.528 1543.16,908.856 1545.51,912.946 1547.86,698.327 1550.21,893.327 1552.56,980.488 1554.91,1241.59 1557.26,864.692 1559.61,888.037 1561.96,1039.92 1564.31,988.361 1566.66,843.691 1569.01,1020.01 1571.36,811.964 1573.71,1092.39 1576.06,818.122 1578.41,973.882 1580.76,872.541 1583.11,775.135 1585.46,860.349 1587.81,865.67 1590.17,950.769 1592.52,896.043 1594.87,943.719 1597.22,970.079 1599.57,745.382 1601.92,1069.74 1604.27,1025.72 1606.62,1073.18 1608.97,987.045 1611.32,929.089 1613.67,779.987 1616.02,912.593 1618.37,839.12 1620.72,839.2 1623.07,947.493 1625.42,765.763 1627.77,973.861 1630.12,859.779 1632.47,924.331 1634.82,940.31 1637.17,935.344 1639.53,982.091 1641.88,899.693 1644.23,995.776 1646.58,1041.6 1648.93,812.532 1651.28,907.369 1653.63,833.558 1655.98,782.662 1658.33,779.339 1660.68,853.829 1663.03,764.703 1665.38,889.687 1667.73,865.163 1670.08,985.254 1672.43,1056.37 1674.78,977.567 1677.13,800.641 1679.48,1075.17 1681.83,770.942 1684.18,753.472 1686.53,871.589 1688.89,748.357 1691.24,1159.45 1693.59,784.801 1695.94,1039.33 1698.29,896.311 1700.64,663.778 1702.99,839.633 1705.34,917.812 1707.69,935.48 1710.04,1031.82 1712.39,811.685 1714.74,997.652 1717.09,945.153 1719.44,854.085 1721.79,931.768 1724.14,819.432 1726.49,650.233 1728.84,862.684 1731.19,665.848 1733.54,857.741 1735.89,864.297 1738.25,851.637 1740.6,1048.51 1742.95,826.082 1745.3,959.881 1747.65,840.474 1750,897.46 1752.35,855.105 1754.7,1074.87 1757.05,953.879 1759.4,1011.14 1761.75,1087.13 1764.1,882.728 1766.45,844.96 1768.8,1004.62 1771.15,770.461 1773.5,867.522 1775.85,853.461 1778.2,1147.74 1780.55,821.167 1782.9,972.215 1785.25,920.559 1787.6,1038.88 1789.96,905.527 1792.31,1032.05 1794.66,851.37 1797.01,944.121 1799.36,1100.63 1801.71,998.918 1804.06,802.085 1806.41,885.709 1808.76,876.061 1811.11,713.1 1813.46,891.62 1815.81,1111.17 1818.16,840.816 1820.51,1019.88 1822.86,903.858 1825.21,921.259 1827.56,927.331 1829.91,903.991 1832.26,882.615 1834.61,847.134 1836.96,904.327 1839.32,848.179 1841.67,691.479 1844.02,703.017 1846.37,779.692 1848.72,1024.15 1851.07,943.648 1853.42,1038.06 1855.77,979.866 1858.12,860.589 1860.47,804.8 1862.82,889.834 1865.17,1032.76 1867.52,981.236 1869.87,785.491 1872.22,915.063 1874.57,923.312 1876.92,771.713 1879.27,829.113 1881.62,867.164 1883.97,1134.42 1886.32,893.837 1888.68,979.168 1891.03,1112.77 1893.38,861.47 1895.73,913.117 1898.08,1045.3 1900.43,614.992 1902.78,910.133 1905.13,741.181 1907.48,799.173 1909.83,1038.14 1912.18,1022.9 1914.53,984.734 1916.88,954.99 1919.23,749.865 1921.58,647.195 1923.93,908.334 1926.28,662.439 1928.63,1000.58 1930.98,837.54 1933.33,904.297 1935.68,918.512 1938.04,1031.65 1940.39,846.685 1942.74,1031.84 1945.09,888.045 1947.44,934.724 1949.79,1050.27 1952.14,1161.02 1954.49,1021.65 1956.84,869.288 1959.19,844.824 1961.54,913.157 1963.89,765.209 1966.24,1002.42 1968.59,986.731 1970.94,780.959 1973.29,916.606 1975.64,1062.82 1977.99,909.768 1980.34,853.302 1982.69,745.157 1985.04,960.387 1987.4,968.287 1989.75,814.339 1992.1,943.751 1994.45,774.451 1996.8,962.975 1999.15,842.229 2001.5,830.005 2003.85,980.874 2006.2,833.693 2008.55,834.397 2010.9,890.697 2013.25,919.316 2015.6,1031.6 2017.95,948.878 2020.3,779.402 2022.65,976.451 2025,1079.11 2027.35,935.187 2029.7,1089.08 2032.05,802.361 2034.4,1030.82 2036.76,961.847 2039.11,1014.43 2041.46,762.024 2043.81,1000.79 2046.16,761.247 2048.51,888.435 2050.86,607.921 2053.21,918.191 2055.56,936.18 2057.91,897.028 2060.26,989.113 2062.61,754.158 2064.96,1161.43 2067.31,934.17 2069.66,777.28 2072.01,882.714 2074.36,988.959 2076.71,959.633 2079.06,952.591 2081.41,875.509 2083.76,1131.81 2086.11,1087.53 2088.47,866.96 2090.82,802.508 2093.17,995.501 2095.52,853.24 2097.87,851.2 2100.22,1071.53 2102.57,838.054 2104.92,902.527 2107.27,861.055 2109.62,816.16 2111.97,812.819 2114.32,935.719 2116.67,868.365 2119.02,815.5 2121.37,1123.54 2123.72,1040.24 2126.07,1016.08 2128.42,956.891 2130.77,794.466 2133.12,968.779 2135.47,772.049 2137.83,917.433 2140.18,873.03 2142.53,961.329 2144.88,857.899 2147.23,1077.6 2149.58,822.763 2151.93,987.373 2154.28,840.452 2156.63,754.891 2158.98,929.148 2161.33,917.6 2163.68,829.316 2166.03,1102.17 2168.38,999.29 2170.73,1056.01 2173.08,823.133 2175.43,955.404 2177.78,840.723 2180.13,1036.04 2182.48,961.806 2184.83,879.687 2187.19,1003.74 2189.54,959.175 2191.89,922.158 2194.24,859.469 2196.59,1086.13 2198.94,806.523 2201.29,976.501 2203.64,606.363 2205.99,950.567 2208.34,1034.88 2210.69,998.703 2213.04,859.416 2215.39,1013.97 2217.74,801.454 2220.09,819.304 2222.44,1024.01 2224.79,950.504 2227.14,949.395 2229.49,857.039 2231.84,996.615 2234.19,1122.02 2236.55,784.885 2238.9,853.743 2241.25,791.063 2243.6,859.174 2245.95,942.152 2248.3,805.97 2250.65,1126.2 2253,1007.77 2255.35,783.059 2257.7,934.575 2260.05,971.231 2262.4,969.815 2264.75,958.49 2267.1,1017.62 2269.45,912.126 2271.8,1008.1 2274.15,876.215 2276.5,932.673 2278.85,852.674 2281.2,934.19 2283.55,972.942 2285.91,884.536 2288.26,861.594 2290.61,977.628 2292.96,976.341 2295.31,1015.86 2297.66,948.78 2300.01,908.746 2302.36,896.638 2304.71,897.651 2307.06,928.11 2309.41,988.946 2311.76,987.126 2314.11,1014.51 2316.46,1001.56 2318.81,831.638 2321.16,674.306 2323.51,1068.49 2325.86,899.715 2328.21,855.744 2330.56,1006.88 2332.91,934.664 2335.27,764.131 2337.62,827.752 2339.97,930.932 2342.32,987.176 2344.67,882.373 2347.02,868.327 2349.37,788.693 2351.72,1021.03 2354.07,1124.87 2356.42,719.085 2358.77,765.53 2361.12,715.683 2363.47,947.877 2365.82,978.538 2368.17,869.938 2370.52,994.642 2372.87,860.879 2375.22,1045.27 2377.57,1004.03 2379.92,917.209 2382.27,725.869 2384.62,907.41 2386.98,968.481 2389.33,894.392 2391.68,944.81 2394.03,884.539 2396.38,926.975 2398.73,871.74 2401.08,882.489 2403.43,795.206 2405.78,961.751 2408.13,1007.35 2410.48,988.294 2412.83,1035.95 2415.18,954.154 2417.53,927.788 2419.88,1004.77 2422.23,925.734 2424.58,979.131 2426.93,922.035 2429.28,782.226 2431.63,852.521 2433.98,1063.13 2436.34,1008.45 2438.69,964.679 2441.04,887.144 2443.39,871.091 2445.74,901.515 2448.09,1107.68 2450.44,899.751 2452.79,954.123 2455.14,867.841 2457.49,915.219 2459.84,891.244 2462.19,1053.56 2464.54,995.023 2466.89,877.914 2469.24,968.808 2471.59,889.38 2473.94,809.117 2476.29,828.518 2478.64,1016.31 2480.99,1115.03 2483.34,699.311 2485.7,893.164 2488.05,708.982 2490.4,838.513 2492.75,905.942 2495.1,828.081 2497.45,925.199 2499.8,927.481 2502.15,1067.76 2504.5,785.108 2506.85,929.868 2509.2,928.54 2511.55,898.163 2513.9,862.303 2516.25,850.279 2518.6,859.654 2520.95,1064.01 2523.3,854.787 2525.65,1043.82 2528,946.417 2530.35,957.442 2532.7,1027.5 2535.06,866.667 2537.41,865.173 2539.76,1047.16 2542.11,875.587 2544.46,926.676 2546.81,1112.72 2549.16,958.376 2551.51,1028.56 2553.86,997.404 2556.21,1013.79 2558.56,872.837 2560.91,720.076 2563.26,748.289 2565.61,923.606 2567.96,886.975 2570.31,920.075 "></polyline>
<polyline clip-path="url(#clip682)" style="stroke:#3da44d; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,607.829 224.541,439.997 226.891,397.254 229.242,309.287 231.592,356.885 233.943,399.476 236.293,518.256 238.644,450.433 240.994,482.173 243.345,473.874 245.695,330.355 248.046,536.429 250.396,445.95 252.747,749.61 255.097,555.823 257.448,394.896 259.798,463.928 262.148,434.222 264.499,514.399 266.849,235.92 269.2,709.343 271.55,407.283 273.901,297.099 276.251,349.661 278.602,388.856 280.952,183.37 283.303,487.314 285.653,449.798 288.004,407.241 290.354,290.95 292.705,461.558 295.055,292.446 297.406,558.291 299.756,438.445 302.107,513.364 304.457,309.371 306.807,399.063 309.158,411.837 311.508,393.284 313.859,456.968 316.209,574.901 318.56,434.056 320.91,605.962 323.261,380.872 325.611,417.009 327.962,395.128 330.312,302.913 332.663,278.494 335.013,503.689 337.364,321.293 339.714,194.171 342.065,455.435 344.415,482.691 346.765,349.649 349.116,553.43 351.466,309.39 353.817,501.869 356.167,299.403 358.518,444.713 360.868,522.33 363.219,299.892 365.569,404.364 367.92,378.702 370.27,544.686 372.621,463.493 374.971,269.651 377.322,431.605 379.672,367.455 382.023,514.242 384.373,384.389 386.724,466.201 389.074,315.746 391.424,406.237 393.775,276.524 396.125,545.605 398.476,388.504 400.826,472.009 403.177,692.887 405.527,380.059 407.878,365.121 410.228,405.538 412.579,449.114 414.929,432.7 417.28,325.568 419.63,563.989 421.981,396.148 424.331,502.42 426.682,527.433 429.032,464.004 431.382,260.67 433.733,217.48 436.083,504.753 438.434,529.791 440.784,378.607 443.135,470.354 445.485,253.245 447.836,313.221 450.186,382.811 452.537,408.665 454.887,412.563 457.238,225.343 459.588,506.555 461.939,330.556 464.289,518.856 466.64,394.278 468.99,452.012 471.341,420.007 473.691,219.869 476.041,345.759 478.392,388.312 480.742,635.668 483.093,407.056 485.443,493.92 487.794,325.874 490.144,550.805 492.495,292.739 494.845,484.721 497.196,252.897 499.546,237.386 501.897,504.054 504.247,534.475 506.598,379.644 508.948,482.33 511.299,276.583 513.649,530.92 515.999,327.97 518.35,425.341 520.7,281.161 523.051,332.037 525.401,491.843 527.752,497.734 530.102,473.188 532.453,383.993 534.803,527.686 537.154,461.779 539.504,323.794 541.855,416.596 544.205,282.067 546.556,558.01 548.906,366.376 551.257,486.207 553.607,220.455 555.958,386.644 558.308,477.596 560.658,408.843 563.009,441.905 565.359,442.865 567.71,435.324 570.06,261.693 572.411,469.75 574.761,456.427 577.112,422.005 579.462,333.649 581.813,448.768 584.163,271.332 586.514,461.734 588.864,411.337 591.215,430.315 593.565,419.177 595.916,462.037 598.266,282.332 600.616,546.532 602.967,379.442 605.317,453.904 607.668,531.845 610.018,462.189 612.369,357.078 614.719,473.335 617.07,423.745 619.42,371.301 621.771,428.304 624.121,469.789 626.472,406.933 628.822,455.567 631.173,592.773 633.523,348.776 635.874,447.085 638.224,502.38 640.575,425.471 642.925,406.43 645.275,357.198 647.626,523.356 649.976,387.976 652.327,538.215 654.677,452.947 657.028,340.319 659.378,463.941 661.729,191.582 664.079,403.187 666.43,371.036 668.78,430.253 671.131,325.164 673.481,315.188 675.832,507.412 678.182,409.056 680.533,374.18 682.883,418.447 685.233,431.361 687.584,167.92 689.934,368.702 692.285,363.276 694.635,276.669 696.986,424.982 699.336,247.431 701.687,309.703 704.037,429.925 706.388,229.628 708.738,477.402 711.089,405.999 713.439,554.67 715.79,456.611 718.14,443 720.491,518.99 722.841,362.778 725.192,346.507 727.542,220.9 729.892,396.771 732.243,397.213 734.593,314.176 736.944,484.947 739.294,250.99 741.645,398.991 743.995,329.429 746.346,386.196 748.696,282.836 751.047,442.29 753.397,433.695 755.748,236.489 758.098,270.964 760.449,165.542 762.799,370.796 765.15,429.347 767.5,330.295 769.85,379.992 772.201,464.624 774.551,391.874 776.902,440.63 779.252,396.686 781.603,512.32 783.953,311.859 786.304,289.33 788.654,423.716 791.005,365.405 793.355,498.091 795.706,473.001 798.056,254.362 800.407,505.955 802.757,592.724 805.108,349.73 807.458,415.47 809.809,392.182 812.159,454.351 814.509,175.026 816.86,480.029 819.21,294.867 821.561,426.472 823.911,302.659 826.262,451.443 828.612,333.173 830.963,308.33 833.313,482.858 835.664,367.784 838.014,573.457 840.365,556.071 842.715,351.052 845.066,341.82 847.416,429.122 849.767,431.926 852.117,419.669 854.467,449.009 856.818,505.925 859.168,443.178 861.519,345.47 863.869,289.495 866.22,357.399 868.57,447.337 870.921,181.427 873.271,364.898 875.622,461.474 877.972,440.502 880.323,391.11 882.673,477.971 885.024,535.871 887.374,483.062 889.725,409.843 892.075,590.562 894.426,511.017 896.776,252.86 899.126,390.211 901.477,375.184 903.827,466.341 906.178,437.126 908.528,370.017 910.879,144.754 913.229,470.062 915.58,392.766 917.93,411.315 920.281,316.031 922.631,391.351 924.982,276.823 927.332,535.066 929.683,483.784 932.033,335.192 934.384,576.896 936.734,449.269 939.084,302.36 941.435,320.033 943.785,367.571 946.136,264.457 948.486,370.104 950.837,230.512 953.187,475.871 955.538,554.987 957.888,287.918 960.239,502.818 962.589,297.782 964.94,408.083 967.29,310.322 969.641,537.769 971.991,378.661 974.342,397.279 976.692,442.365 979.043,338.019 981.393,371.316 983.743,360.865 986.094,399.811 988.444,658.347 990.795,451.594 993.145,479.106 995.496,551.994 997.846,468.297 1000.2,451.192 1002.55,407.615 1004.9,390.49 1007.25,297.733 1009.6,551.684 1011.95,478.705 1014.3,420.353 1016.65,323.948 1019,341.827 1021.35,541.729 1023.7,513.72 1026.05,355.8 1028.4,439.094 1030.75,429.933 1033.1,537.933 1035.45,580.521 1037.8,236.851 1040.15,352.616 1042.51,514.795 1044.86,420.208 1047.21,468.837 1049.56,507.28 1051.91,314.372 1054.26,647.707 1056.61,296.98 1058.96,558.374 1061.31,442.899 1063.66,480.281 1066.01,594.042 1068.36,590.731 1070.71,454.061 1073.06,388.873 1075.41,341.393 1077.76,601.358 1080.11,426.544 1082.46,647.431 1084.81,596.693 1087.16,386.145 1089.51,369.816 1091.87,560.416 1094.22,354.977 1096.57,302.678 1098.92,340.241 1101.27,289.252 1103.62,518.28 1105.97,534.806 1108.32,354.674 1110.67,302.858 1113.02,350.406 1115.37,560.128 1117.72,408.847 1120.07,281.302 1122.42,434.489 1124.77,382.65 1127.12,426.55 1129.47,378.732 1131.82,638.54 1134.17,448.235 1136.52,230.253 1138.87,465.546 1141.23,381.262 1143.58,181.125 1145.93,306.44 1148.28,478.393 1150.63,496.261 1152.98,399.509 1155.33,481.207 1157.68,496.555 1160.03,389.123 1162.38,297.282 1164.73,411.18 1167.08,203.214 1169.43,424.562 1171.78,439.613 1174.13,394.72 1176.48,374.396 1178.83,299.309 1181.18,411.158 1183.53,467.036 1185.88,313.328 1188.23,406.318 1190.59,179.087 1192.94,442.87 1195.29,449.861 1197.64,484.913 1199.99,432.953 1202.34,455.219 1204.69,473.78 1207.04,348.587 1209.39,401.369 1211.74,318.699 1214.09,383.159 1216.44,463.019 1218.79,430.722 1221.14,314.733 1223.49,516.233 1225.84,407.496 1228.19,277.197 1230.54,453.801 1232.89,374.43 1235.24,523.537 1237.59,222.832 1239.94,566.454 1242.3,470.464 1244.65,396.673 1247,616.339 1249.35,523.067 1251.7,328.163 1254.05,388.841 1256.4,482.609 1258.75,333.411 1261.1,542.016 1263.45,295.315 1265.8,493.079 1268.15,459.158 1270.5,501.804 1272.85,409.049 1275.2,300.883 1277.55,408.806 1279.9,590.508 1282.25,535.805 1284.6,428.554 1286.95,253.62 1289.3,441.08 1291.66,634.65 1294.01,607.28 1296.36,241.052 1298.71,301.376 1301.06,457.582 1303.41,250.607 1305.76,433.676 1308.11,245.551 1310.46,831.113 1312.81,510.597 1315.16,423.363 1317.51,379.829 1319.86,406.18 1322.21,463.995 1324.56,401.704 1326.91,346.983 1329.26,227.158 1331.61,437.784 1333.96,354.002 1336.31,413.123 1338.66,534.471 1341.02,367.256 1343.37,545.97 1345.72,510.313 1348.07,468.402 1350.42,379.452 1352.77,575.205 1355.12,447.762 1357.47,489.869 1359.82,423.423 1362.17,377.324 1364.52,593.779 1366.87,431.825 1369.22,469.375 1371.57,319.089 1373.92,531.986 1376.27,426.394 1378.62,367.014 1380.97,488.248 1383.32,421.835 1385.67,295.213 1388.02,404.839 1390.38,410.14 1392.73,160.101 1395.08,309.548 1397.43,180.97 1399.78,395.702 1402.13,407.675 1404.48,241.184 1406.83,408.438 1409.18,508.482 1411.53,388.556 1413.88,414.183 1416.23,537.284 1418.58,237.018 1420.93,464.71 1423.28,430.393 1425.63,339.09 1427.98,491.516 1430.33,526.303 1432.68,536.031 1435.03,377.466 1437.38,548.963 1439.74,544.257 1442.09,496.97 1444.44,482.62 1446.79,546.2 1449.14,350.703 1451.49,295.646 1453.84,399.772 1456.19,338.563 1458.54,405.039 1460.89,369.654 1463.24,513.336 1465.59,480.208 1467.94,227.598 1470.29,465.408 1472.64,530.22 1474.99,738.446 1477.34,490.964 1479.69,537.07 1482.04,345.375 1484.39,476.024 1486.74,566.954 1489.1,669.324 1491.45,385.886 1493.8,428.446 1496.15,478.83 1498.5,447.265 1500.85,234.352 1503.2,260.765 1505.55,473.211 1507.9,395.094 1510.25,169.485 1512.6,413.898 1514.95,599.17 1517.3,560.975 1519.65,447.787 1522,419.983 1524.35,508.975 1526.7,260.114 1529.05,347.933 1531.4,458.054 1533.75,587.771 1536.1,394.88 1538.45,565.226 1540.81,281.467 1543.16,475.24 1545.51,465.46 1547.86,273.331 1550.21,140.706 1552.56,406.274 1554.91,330.189 1557.26,327.747 1559.61,313.973 1561.96,401.81 1564.31,397.247 1566.66,431.66 1569.01,220.113 1571.36,533.23 1573.71,510.329 1576.06,562.199 1578.41,262.814 1580.76,343.548 1583.11,314.625 1585.46,503.775 1587.81,268.996 1590.17,299.042 1592.52,458.41 1594.87,334.809 1597.22,386.414 1599.57,484.45 1601.92,388.295 1604.27,244.95 1606.62,391.951 1608.97,395.054 1611.32,446.125 1613.67,589.846 1616.02,374.737 1618.37,166.659 1620.72,309.016 1623.07,241.555 1625.42,647.935 1627.77,556.319 1630.12,416.661 1632.47,360.188 1634.82,454.72 1637.17,424.126 1639.53,274.171 1641.88,461.372 1644.23,301.528 1646.58,507.977 1648.93,528.289 1651.28,328.86 1653.63,434.693 1655.98,585.315 1658.33,463.736 1660.68,271.787 1663.03,331.471 1665.38,284.028 1667.73,607.215 1670.08,378.872 1672.43,435.089 1674.78,452.947 1677.13,458.373 1679.48,221.022 1681.83,396.724 1684.18,518.627 1686.53,439.322 1688.89,371.661 1691.24,567.426 1693.59,475.193 1695.94,437.583 1698.29,286.865 1700.64,592.155 1702.99,291.371 1705.34,456.853 1707.69,472.56 1710.04,313.149 1712.39,441.718 1714.74,337.805 1717.09,301.612 1719.44,730.606 1721.79,400.25 1724.14,279.85 1726.49,440.937 1728.84,417.335 1731.19,514.418 1733.54,577.68 1735.89,633.18 1738.25,458.228 1740.6,528.787 1742.95,490.456 1745.3,398.397 1747.65,558.952 1750,224.764 1752.35,513.993 1754.7,356.381 1757.05,543.252 1759.4,560.278 1761.75,283.153 1764.1,531.577 1766.45,478.142 1768.8,351.623 1771.15,317.517 1773.5,323.141 1775.85,120.475 1778.2,441.22 1780.55,689.639 1782.9,446.997 1785.25,487.309 1787.6,470.749 1789.96,427.87 1792.31,386.809 1794.66,304.409 1797.01,412.182 1799.36,449.321 1801.71,439.859 1804.06,374.981 1806.41,442.639 1808.76,500.794 1811.11,495.433 1813.46,566.396 1815.81,462.735 1818.16,234.538 1820.51,297.904 1822.86,424.732 1825.21,308.331 1827.56,241.599 1829.91,440.27 1832.26,394.029 1834.61,323.453 1836.96,406.21 1839.32,460.915 1841.67,250.288 1844.02,480.852 1846.37,468.982 1848.72,572.09 1851.07,348.624 1853.42,325.331 1855.77,302.445 1858.12,467.046 1860.47,530.908 1862.82,452.879 1865.17,428.298 1867.52,373.911 1869.87,340.49 1872.22,443.108 1874.57,322.629 1876.92,537.771 1879.27,345.403 1881.62,312.772 1883.97,463.313 1886.32,474.33 1888.68,398.524 1891.03,357.671 1893.38,524.106 1895.73,369.355 1898.08,354.971 1900.43,433.04 1902.78,514.82 1905.13,486.912 1907.48,409.843 1909.83,367.372 1912.18,395.274 1914.53,316.384 1916.88,445.167 1919.23,382.241 1921.58,374.276 1923.93,434.863 1926.28,431.876 1928.63,396.971 1930.98,404.218 1933.33,354.546 1935.68,341.93 1938.04,336.955 1940.39,137.242 1942.74,503.564 1945.09,474.525 1947.44,329.892 1949.79,373.724 1952.14,329.609 1954.49,424.366 1956.84,421.914 1959.19,533.305 1961.54,342.216 1963.89,480.645 1966.24,336.837 1968.59,380.316 1970.94,551.747 1973.29,263.176 1975.64,522.341 1977.99,444.001 1980.34,333.795 1982.69,447.787 1985.04,449.338 1987.4,291.743 1989.75,362.236 1992.1,321.094 1994.45,517.667 1996.8,552.672 1999.15,471.633 2001.5,571.554 2003.85,523.037 2006.2,286.899 2008.55,406.493 2010.9,506.022 2013.25,418.714 2015.6,315.763 2017.95,296.61 2020.3,510.154 2022.65,354.967 2025,513.677 2027.35,578.438 2029.7,495.365 2032.05,387.577 2034.4,622.05 2036.76,466.087 2039.11,299.938 2041.46,402.932 2043.81,422.807 2046.16,377.31 2048.51,474.818 2050.86,343.557 2053.21,450.96 2055.56,381.547 2057.91,366.162 2060.26,387.379 2062.61,346.03 2064.96,447.326 2067.31,234.267 2069.66,432.051 2072.01,294.328 2074.36,257.018 2076.71,601.104 2079.06,260.16 2081.41,221.277 2083.76,375.391 2086.11,542.5 2088.47,435.91 2090.82,378.804 2093.17,198.947 2095.52,329.63 2097.87,692.88 2100.22,476.312 2102.57,543.145 2104.92,252.552 2107.27,448.773 2109.62,464.022 2111.97,378.704 2114.32,458.274 2116.67,377.856 2119.02,475.895 2121.37,481.021 2123.72,528.419 2126.07,463.944 2128.42,531.695 2130.77,320.863 2133.12,548.699 2135.47,290.183 2137.83,388.271 2140.18,636.964 2142.53,436.741 2144.88,298.205 2147.23,397.783 2149.58,297.171 2151.93,720.659 2154.28,215.39 2156.63,140.083 2158.98,428.134 2161.33,442.192 2163.68,164.013 2166.03,472.196 2168.38,496.957 2170.73,372.123 2173.08,405.561 2175.43,389.146 2177.78,551.63 2180.13,535.807 2182.48,372.03 2184.83,543.448 2187.19,302.515 2189.54,386.898 2191.89,516.364 2194.24,400.567 2196.59,359.137 2198.94,374.925 2201.29,313.609 2203.64,208.575 2205.99,241.449 2208.34,396.845 2210.69,279.397 2213.04,592.13 2215.39,430.256 2217.74,486.342 2220.09,367.003 2222.44,324.326 2224.79,469.895 2227.14,430.777 2229.49,441.718 2231.84,380.412 2234.19,394.716 2236.55,473.106 2238.9,541.654 2241.25,372.512 2243.6,393.663 2245.95,296.341 2248.3,487.39 2250.65,579.822 2253,290.088 2255.35,534.527 2257.7,169.56 2260.05,332.358 2262.4,278.723 2264.75,350.742 2267.1,410.077 2269.45,459.542 2271.8,469.952 2274.15,466.457 2276.5,300.183 2278.85,276.835 2281.2,411.932 2283.55,495.014 2285.91,329.028 2288.26,679.029 2290.61,502.869 2292.96,403.758 2295.31,417.658 2297.66,250.402 2300.01,489.349 2302.36,420.82 2304.71,299.504 2307.06,566.643 2309.41,277.153 2311.76,338.271 2314.11,512.401 2316.46,308.255 2318.81,308.583 2321.16,355.44 2323.51,521.491 2325.86,413.974 2328.21,252.431 2330.56,413.698 2332.91,287.12 2335.27,473.709 2337.62,244.905 2339.97,468.958 2342.32,121.265 2344.67,397.923 2347.02,411.129 2349.37,501.841 2351.72,506.363 2354.07,477.552 2356.42,300.677 2358.77,373.901 2361.12,410.625 2363.47,499.865 2365.82,400.748 2368.17,308.494 2370.52,554.95 2372.87,378.378 2375.22,484.799 2377.57,406.009 2379.92,415.997 2382.27,421.531 2384.62,614.036 2386.98,517.152 2389.33,501.342 2391.68,323.819 2394.03,408.323 2396.38,441.683 2398.73,552.25 2401.08,429.833 2403.43,421.628 2405.78,542.588 2408.13,301.925 2410.48,276.486 2412.83,542.462 2415.18,406.233 2417.53,336.705 2419.88,365.038 2422.23,422.277 2424.58,559.199 2426.93,400.313 2429.28,509.323 2431.63,250.546 2433.98,372.231 2436.34,348.833 2438.69,529.871 2441.04,563.797 2443.39,471.173 2445.74,402.393 2448.09,592.751 2450.44,393.306 2452.79,482.1 2455.14,503.008 2457.49,350.226 2459.84,438.018 2462.19,388.142 2464.54,468.917 2466.89,485.657 2469.24,366.508 2471.59,311.999 2473.94,397.021 2476.29,364.192 2478.64,538.943 2480.99,360.686 2483.34,473.569 2485.7,319.145 2488.05,412.914 2490.4,305.053 2492.75,488.609 2495.1,150.977 2497.45,509.328 2499.8,521.342 2502.15,235.589 2504.5,469.666 2506.85,407.466 2509.2,284.054 2511.55,445.063 2513.9,398.63 2516.25,265.55 2518.6,399.096 2520.95,376.132 2523.3,409.253 2525.65,296.393 2528,297.159 2530.35,447.388 2532.7,514.291 2535.06,317.458 2537.41,182.948 2539.76,376.481 2542.11,332.974 2544.46,605.224 2546.81,518.099 2549.16,450.93 2551.51,519.842 2553.86,397.519 2556.21,96.8724 2558.56,470.924 2560.91,198.24 2563.26,657.67 2565.61,418.123 2567.96,426.284 2570.31,325.929 "></polyline>
</svg>
</div>
</div>
<p>Look at that! Things are working; amazin’.</p>
<p>We can also exploit <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>’s parallel sampling capabilities:</p>
<div id="34" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run separate 4 chains for 10 000 iterations using threads to parallelize.</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>num_chains <span class="op">=</span> <span class="fl">4</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    model_with_grad,</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">MCMCThreads</span>(),</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>,</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    num_chains;</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Note we need to provide an initial state for every chain.</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>    initial_state<span class="op">=</span><span class="fu">fill</span>(state, num_chains),</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>samples_array <span class="op">=</span> <span class="fu">stack</span>(<span class="fu">map</span>(<span class="bu">Base</span>.<span class="fu">Fix1</span>(stack, sample <span class="op">-&gt;</span> sample.x), samples))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000×4 Array{Float64, 3}:
[:, :, 1] =
 -0.0226004  -0.867528  -4.06805  -4.06805  …  -5.30478  -4.49653   -3.65323
  0.394145    1.64124    1.33394   1.33394      1.29182   0.720423   1.02787
  2.02333     4.00844    3.71873   3.71873      6.50176   6.71141    6.97432

[:, :, 2] =
 -2.13079  -3.61889   -3.32753   -2.19832   …  -4.43738   -4.43738   -5.27672
  0.13451   0.605046  -0.336286  -0.949048     -0.659897  -0.659897   1.17101
  2.53362   4.13421    4.5047     3.84352       5.6375     5.6375     6.21705

[:, :, 3] =
 -2.24445   -2.39262     -4.09015   …  -4.75093  -4.87097  -4.87097
  0.718989  -0.00283257   0.438648      1.41262   1.19672   1.19672
  1.93947    2.39677      4.52865       5.48572   3.76195   3.76195

[:, :, 4] =
 -2.77412  -2.94378   -4.45869   -4.73632   …  -4.11611   -4.62477   -4.74092
  1.69758   0.798709  -0.297053  -0.224512     -0.399674   0.567476   1.40238
  3.16472   5.55052    4.57942    4.8118        5.84519    5.36088    4.92654</code></pre>
</div>
</div>
<p>But the fact that we have to provide the <code>AbstractMCMC.sample</code> call, etc. with an <code>initial_state</code> to get started is a bit annoying. We can avoid this by also defining a <code>AbstractMCMC.step</code> <em>without</em> the <code>state</code> argument:</p>
<div id="36" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">::</span><span class="dt">MALA</span>;</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># </span><span class="al">NOTE</span><span class="co">: No state provided!</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just create the initial state by sampling using  a Gaussian.</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="fu">randn</span>(rng, LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(x), <span class="fu">MALAState</span>(x)</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Equipped with this, we no longer need to provide the <code>initial_state</code> everywhere:</p>
<div id="38" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -5.00949     1.01163
 -0.00165928  0.988114
  5.02293     1.00806</code></pre>
</div>
</div>
</section>
<section id="using-our-sampler-with-turing.jl" class="level2">
<h2 class="anchored" data-anchor-id="using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</h2>
<p>As we promised, all of this hassle of implementing our <code>MALA</code> sampler in a way that uses <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> and <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> gets us something more than <em>just</em> an “automatic” implementation of <code>AbstractMCMC.sample</code>.</p>
<p>It also enables use with Turing.jl through the <code>externalsampler</code>, but we need to do one final thing first: we need to tell Turing.jl how to extract a vector of parameters from the “sample” returned in our implementation of <code>AbstractMCMC.step</code>. In our case, the “sample” is a <code>MALASample</code>, so we just need the following line:</p>
<div id="40" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load Turing.jl.</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Turing</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Overload the `getparams` method for our "sample" type, which is just a vector.</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>Turing.Inference.<span class="fu">getparams</span>(<span class="op">::</span><span class="dt">Turing.Model</span>, sample<span class="op">::</span><span class="dt">MALASample</span>) <span class="op">=</span> sample.x</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And with that, we’re good to go!</p>
<div id="42" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Our previous model defined as a Turing.jl model.</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">mvnormal_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">MvNormal</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.], I)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate our model.</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">mvnormal_model</span>()</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Call `sample` but now we're passing in a Turing.jl `model` and wrapping</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co"># our `MALA` sampler in the `externalsampler` to tell Turing.jl that the sampler</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co"># expects something that implements LogDensityProblems.jl.</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×4×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 3.05 seconds
Compute duration  = 3.05 seconds
parameters        = x[1], x[2], x[3]
internals         = lp

Summary Statistics
  parameters      mean       std      mcse    ess_bulk    ess_tail      rhat   ⋯
      Symbol   Float64   Float64   Float64     Float64     Float64   Float64   ⋯

        x[1]   -4.9967    0.9941    0.0175   3238.7521   5102.4644    1.0001   ⋯
        x[2]    0.0285    0.9981    0.0177   3162.9809   5164.7686    1.0005   ⋯
        x[3]    5.0074    0.9970    0.0178   3146.0213   5328.6098    1.0000   ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

        x[1]   -6.9573   -5.6734   -4.9923   -4.3335   -3.0775
        x[2]   -1.9365   -0.6414    0.0291    0.6941    2.0249
        x[3]    3.0266    4.3398    5.0089    5.6842    6.9042</code></pre>
</div>
</div>
<p>Pretty neat, eh?</p>
<section id="models-with-constrained-parameters" class="level3">
<h3 class="anchored" data-anchor-id="models-with-constrained-parameters">Models with constrained parameters</h3>
<p>One thing we’ve sort of glossed over in all of the above is that MALA, at least how we’ve implemented it, requires <span class="math inline">\(x\)</span> to live in <span class="math inline">\(\mathbb{R}^d\)</span> for some <span class="math inline">\(d &gt; 0\)</span>. If some of the parameters were in fact constrained, e.g.&nbsp;we were working with a <code>Beta</code> distribution which has support on the interval <span class="math inline">\((0, 1)\)</span>, <em>not</em> on <span class="math inline">\(\mathbb{R}^d\)</span>, we could easily end up outside of the valid range <span class="math inline">\((0, 1)\)</span>.</p>
<div id="44" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">beta_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">beta_model</span>()</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 1.96 seconds
Compute duration  = 1.96 seconds
parameters        = x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse    ess_bulk    ess_tail      rhat   ⋯
      Symbol   Float64   Float64   Float64     Float64     Float64   Float64   ⋯

           x    0.4952    0.1878    0.0028   4343.9798   5740.3378    1.0000   ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

           x    0.1453    0.3572    0.4910    0.6337    0.8526</code></pre>
</div>
</div>
<p>Yep, that still works, but only because Turing.jl actually <em>transforms</em> the <code>turing_model</code> from constrained to unconstrained, so that the <code>sampler</code> provided to <code>externalsampler</code> is actually always working in unconstrained space! This is not always desirable, so we can turn this off:</p>
<div id="46" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 0.17 seconds
Compute duration  = 0.17 seconds
parameters        = x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse    ess_bulk    ess_tail      rhat   ⋯
      Symbol   Float64   Float64   Float64     Float64     Float64   Float64   ⋯

           x    0.0542    0.0207    0.0004   2332.6010   2332.6010    1.0003   ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

           x    0.0538    0.0538    0.0538    0.0538    0.0538</code></pre>
</div>
</div>
<p>The fun thing is that this still sort of works because</p>
<div id="48" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">logpdf</span>(<span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>), <span class="fl">10.0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-Inf</code></pre>
</div>
</div>
<p>and so the samples that fall outside of the range are always rejected. But do notice how much worse all the diagnostics are, e.g.&nbsp;<code>ess_tail</code> is very poor compared to when we use <code>unconstrained=true</code>. Moreover, in more complex cases this won’t just result in a “nice” <code>-Inf</code> log-density value, but instead will error:</p>
<div id="50" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="kw">function</span> <span class="fu">demo</span>()</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>    σ² <span class="op">~</span> <span class="fu">truncated</span>(<span class="fu">Normal</span>(), lower<span class="op">=</span><span class="fl">0</span>)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If we end up with negative values for `σ²`, the `Normal` will error.</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>    x <span class="op">~</span> <span class="fu">Normal</span>(<span class="fl">0</span>, σ²)</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>DomainError: DomainError(Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}}(-0.7566760820963971,1.0,0.0), "Normal: the condition σ &gt;= zero(σ) is not satisfied.")
DomainError with Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}}(-0.7566760820963971,1.0,0.0):
Normal: the condition σ &gt;= zero(σ) is not satisfied.
Stacktrace:
  [1] #371
    @ ~/.julia/packages/Distributions/fi8Qd/src/univariate/continuous/normal.jl:37 [inlined]
  [2] check_args
    @ ~/.julia/packages/Distributions/fi8Qd/src/utils.jl:89 [inlined]
  [3] #Normal#370
    @ ~/.julia/packages/Distributions/fi8Qd/src/univariate/continuous/normal.jl:37 [inlined]
  [4] Normal
    @ ~/.julia/packages/Distributions/fi8Qd/src/univariate/continuous/normal.jl:36 [inlined]
  [5] Normal
    @ ~/.julia/packages/Distributions/fi8Qd/src/univariate/continuous/normal.jl:42 [inlined]
  [6] macro expansion
    @ ~/.julia/packages/DynamicPPL/l7W1f/src/compiler.jl:574 [inlined]
  [7] demo(__model__::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, __varinfo__::DynamicPPL.ThreadSafeVarInfo{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}, ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}, Vector{Base.RefValue{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}, __context__::DynamicPPL.DefaultContext)
    @ Main.Notebook ~/work/docs/docs/developers/inference/implementing-samplers/index.qmd:595
  [8] _evaluate!!
    @ ~/.julia/packages/DynamicPPL/l7W1f/src/model.jl:936 [inlined]
  [9] evaluate_threadsafe!!(model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, varinfo::DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}, ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}, context::DynamicPPL.DefaultContext)
    @ DynamicPPL ~/.julia/packages/DynamicPPL/l7W1f/src/model.jl:925
 [10] evaluate!!
    @ ~/.julia/packages/DynamicPPL/l7W1f/src/model.jl:855 [inlined]
 [11] logdensity_at
    @ ~/.julia/packages/DynamicPPL/l7W1f/src/logdensityfunction.jl:184 [inlined]
 [12] FixTail
    @ ~/.julia/packages/DifferentiationInterface/7eD1K/src/utils/context.jl:169 [inlined]
 [13] vector_mode_dual_eval!(f::DifferentiationInterface.FixTail{typeof(DynamicPPL.logdensity_at), Tuple{DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}, DynamicPPL.DefaultContext}}, cfg::ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}, x::Vector{Float64})
    @ ForwardDiff ~/.julia/packages/ForwardDiff/UBbGT/src/apiutils.jl:24
 [14] vector_mode_gradient!
    @ ~/.julia/packages/ForwardDiff/UBbGT/src/gradient.jl:98 [inlined]
 [15] gradient!(result::DiffResults.MutableDiffResult{1, Float64, Tuple{Vector{Float64}}}, f::DifferentiationInterface.FixTail{typeof(DynamicPPL.logdensity_at), Tuple{DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}, DynamicPPL.DefaultContext}}, x::Vector{Float64}, cfg::ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}, ::Val{false})
    @ ForwardDiff ~/.julia/packages/ForwardDiff/UBbGT/src/gradient.jl:39
 [16] value_and_gradient(::typeof(DynamicPPL.logdensity_at), ::DifferentiationInterfaceForwardDiffExt.ForwardDiffGradientPrep{Nothing, ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}, Tuple{Nothing, Nothing, Nothing}}, ::AutoForwardDiff{2, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}}, ::Vector{Float64}, ::DifferentiationInterface.Constant{DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}}, ::DifferentiationInterface.Constant{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}}, ::DifferentiationInterface.Constant{DynamicPPL.DefaultContext})
    @ DifferentiationInterfaceForwardDiffExt ~/.julia/packages/DifferentiationInterface/7eD1K/ext/DifferentiationInterfaceForwardDiffExt/onearg.jl:417
 [17] logdensity_and_gradient(f::LogDensityFunction{DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}, DynamicPPL.DefaultContext, AutoForwardDiff{2, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}}}, x::Vector{Float64})
    @ DynamicPPL ~/.julia/packages/DynamicPPL/l7W1f/src/logdensityfunction.jl:215
 [18] leapfrog_step(model::LogDensityFunction{DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}, DynamicPPL.DefaultContext, AutoForwardDiff{2, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}}}, x::Vector{Float64}, p::Vector{Float64}, ϵ::Int64, M::UniformScaling{Bool})
    @ Main.Notebook ~/work/docs/docs/developers/inference/implementing-samplers/index.qmd:371
 [19] step(rng::TaskLocalRNG, model_wrapper::AbstractMCMC.LogDensityModel{LogDensityFunction{DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}, DynamicPPL.DefaultContext, AutoForwardDiff{2, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}}}}, sampler::MALA{Int64, UniformScaling{Bool}}, state::MALAState{Vector{Float64}}; kwargs::@Kwargs{})
    @ Main.Notebook ~/work/docs/docs/developers/inference/implementing-samplers/index.qmd:336
 [20] step(rng::TaskLocalRNG, model_wrapper::AbstractMCMC.LogDensityModel{LogDensityFunction{DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}, DynamicPPL.DefaultContext, AutoForwardDiff{2, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}}}}, sampler::MALA{Int64, UniformScaling{Bool}}, state::MALAState{Vector{Float64}})
    @ Main.Notebook ~/work/docs/docs/developers/inference/implementing-samplers/index.qmd:318
 [21] step(rng::TaskLocalRNG, model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, sampler_wrapper::DynamicPPL.Sampler{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}, state::Turing.Inference.TuringState{MALAState{Vector{Float64}}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}, DynamicPPL.DefaultContext}; kwargs::@Kwargs{})
    @ Turing.Inference ~/.julia/packages/Turing/IXycm/src/mcmc/abstractmcmc.jl:91
 [22] step(rng::TaskLocalRNG, model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, sampler_wrapper::DynamicPPL.Sampler{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}, state::Turing.Inference.TuringState{MALAState{Vector{Float64}}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}, DynamicPPL.DefaultContext})
    @ Turing.Inference ~/.julia/packages/Turing/IXycm/src/mcmc/abstractmcmc.jl:80
 [23] macro expansion
    @ ~/.julia/packages/AbstractMCMC/FSyVk/src/sample.jl:217 [inlined]
 [24] macro expansion
    @ ~/.julia/packages/AbstractMCMC/FSyVk/src/logging.jl:16 [inlined]
 [25] mcmcsample(rng::TaskLocalRNG, model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, sampler::DynamicPPL.Sampler{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}, N::Int64; progress::Bool, progressname::String, callback::Nothing, num_warmup::Int64, discard_initial::Int64, thinning::Int64, chain_type::Type, initial_state::Nothing, kwargs::@Kwargs{})
    @ AbstractMCMC ~/.julia/packages/AbstractMCMC/FSyVk/src/sample.jl:142
 [26] sample(rng::TaskLocalRNG, model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, sampler::DynamicPPL.Sampler{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}, N::Int64; chain_type::Type, resume_from::Nothing, initial_state::Nothing, kwargs::@Kwargs{progress::Bool})
    @ DynamicPPL ~/.julia/packages/DynamicPPL/l7W1f/src/sampler.jl:102
 [27] sample
    @ ~/.julia/packages/DynamicPPL/l7W1f/src/sampler.jl:92 [inlined]
 [28] #sample#8
    @ ~/.julia/packages/Turing/IXycm/src/mcmc/Inference.jl:278 [inlined]
 [29] sample
    @ ~/.julia/packages/Turing/IXycm/src/mcmc/Inference.jl:269 [inlined]
 [30] #sample#7
    @ ~/.julia/packages/Turing/IXycm/src/mcmc/Inference.jl:266 [inlined]
 [31] top-level scope
    @ ~/work/docs/docs/developers/inference/implementing-samplers/index.qmd:597</code></pre>
</div>
</div>
<p>As expected, we run into a <code>DomainError</code> at some point, while if we set <code>unconstrained=true</code>, letting Turing.jl transform the model to a unconstrained form behind the scenes, everything works as expected:</p>
<div id="52" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 0.61 seconds
Compute duration  = 0.61 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse   ess_bulk   ess_tail      rhat   e ⋯
      Symbol   Float64   Float64   Float64    Float64    Float64   Float64     ⋯

          σ²    0.8231    0.5672    0.0411   100.6198    26.4402    1.0197     ⋯
           x    0.0507    0.8844    0.0364   728.1096   510.1521    1.0235     ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

          σ²    0.0597    0.3733    0.7190    1.1629    2.1289
           x   -1.8756   -0.3373    0.0197    0.4402    2.0367</code></pre>
</div>
</div>
<p>Neat!</p>
<p>Similarly, which automatic differentiation backend one should use can be specified through the <code>adtype</code> keyword argument too. For example, if we want to use <a href="https://github.com/JuliaDiff/ReverseDiff.jl">ReverseDiff.jl</a> instead of the default <a href="https://github.com/JuliaDiff/ForwardDiff.jl">ForwardDiff.jl</a>:</p>
<div id="54" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">ReverseDiff</span>: ReverseDiff</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify that we want to use `AutoReverseDiff`.</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">demo</span>(),</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>, adtype<span class="op">=</span><span class="fu">AutoReverseDiff</span>()),</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>;</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 2.88 seconds
Compute duration  = 2.88 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse   ess_bulk   ess_tail      rhat   e ⋯
      Symbol   Float64   Float64   Float64    Float64    Float64   Float64     ⋯

          σ²    0.8286    0.5797    0.0296   254.2666    85.5259    1.0009     ⋯
           x    0.0197    0.9242    0.0501   548.1978   428.8152    1.0011     ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

          σ²    0.0847    0.3638    0.7114    1.1663    2.3231
           x   -2.0060   -0.3158    0.0196    0.4017    1.9663</code></pre>
</div>
</div>
<p>Double-neat.</p>
</section>
</section>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<p>At this point it’s worth maybe reminding ourselves what we did and also <em>why</em> we did it:</p>
<ol type="1">
<li>We define our models in the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface because it makes the sampler agnostic to how the underlying model is implemented.</li>
<li>We implement our sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> interface, which just means that our sampler is a subtype of <code>AbstractMCMC.AbstractSampler</code> and we implement the MCMC transition in <code>AbstractMCMC.step</code>.</li>
<li>Points 1 and 2 makes it so our sampler can be used with a wide range of model implementations, amongst them being models implemented in both Turing.jl and Stan. This gives you, the inference implementer, a large collection of models to test your inference method on, in addition to allowing users of Turing.jl and Stan to try out your inference method with minimal effort.</li>
</ol>


</section>


<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a><div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>We’re going with the leapfrog formulation because in a future version of this tutorial we’ll add a section extending this simple “baseline” MALA sampler to more complex versions. See <a href="https://github.com/TuringLang/docs/issues/479">issue #479</a> for progress on this.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>There is no such thing as a proper interface in Julia (at least not officially), and so we use the word “interface” here to mean a few minimal methods that needs to be implemented by any type that we treat as a target model.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/turinglang\.org\/docs\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../../developers/inference/variational-inference/index.html" class="pagination-link" aria-label="Variational Inference">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Variational Inference</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Turing is created by <a href="http://mlg.eng.cam.ac.uk/hong/" target="_blank">Hong Ge</a>, and lovingly maintained by the <a href="https://github.com/TuringLang/Turing.jl/graphs/contributors" target="_blank">core team</a> of volunteers. <br> The contents of this website are © 2024 under the terms of the <a href="https://github.com/TuringLang/Turing.jl/blob/main/LICENCE" target="_blank">MIT License</a>.</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/TuringLang/docs/edit/main/developers/inference/implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/docs/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://x.com/TuringLang">
      <i class="bi bi-twitter" role="img" aria-label="Turing Twitter">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/TuringLang/Turing.jl">
      <i class="bi bi-github" role="img" aria-label="Turing GitHub">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




<script src="../../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>