<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Implementing Samplers – Turing.jl</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<link href="../../../developers/inference/variational-inference/index.html" rel="prev">
<link href="../../../assets/favicon.ico" rel="icon">
<script src="../../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-dark-2fef5ea3f8957b3e4ecc936fc74692ca.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap-18ccf09ac862cdae137f1cff9f0dff93.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../../site_libs/bootstrap/bootstrap-dark-5bdfca418a03f22e36e5c4143ed53dd5.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="../../../site_libs/bootstrap/bootstrap-18ccf09ac862cdae137f1cff9f0dff93.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<style>
  a {
    text-decoration: none;
  }
  a:hover {
    text-decoration: underline;
  }
</style>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../../theming/styles.css">
</head>

<body class="nav-sidebar floating nav-fixed quarto-light"><script id="quarto-html-before-body" type="application/javascript">
    const toggleBodyColorMode = (bsSheetEl) => {
      const mode = bsSheetEl.getAttribute("data-mode");
      const bodyEl = window.document.querySelector("body");
      if (mode === "dark") {
        bodyEl.classList.add("quarto-dark");
        bodyEl.classList.remove("quarto-light");
      } else {
        bodyEl.classList.add("quarto-light");
        bodyEl.classList.remove("quarto-dark");
      }
    }
    const toggleBodyColorPrimary = () => {
      const bsSheetEl = window.document.querySelector("link#quarto-bootstrap:not([rel=disabled-stylesheet])");
      if (bsSheetEl) {
        toggleBodyColorMode(bsSheetEl);
      }
    }
    const setColorSchemeToggle = (alternate) => {
      const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
      for (let i=0; i < toggles.length; i++) {
        const toggle = toggles[i];
        if (toggle) {
          if (alternate) {
            toggle.classList.add("alternate");
          } else {
            toggle.classList.remove("alternate");
          }
        }
      }
    };
    const toggleColorMode = (alternate) => {
      // Switch the stylesheets
      const primaryStylesheets = window.document.querySelectorAll('link.quarto-color-scheme:not(.quarto-color-alternate)');
      const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
      manageTransitions('#quarto-margin-sidebar .nav-link', false);
      if (alternate) {
        // note: dark is layered on light, we don't disable primary!
        enableStylesheet(alternateStylesheets);
        for (const sheetNode of alternateStylesheets) {
          if (sheetNode.id === "quarto-bootstrap") {
            toggleBodyColorMode(sheetNode);
          }
        }
      } else {
        disableStylesheet(alternateStylesheets);
        enableStylesheet(primaryStylesheets)
        toggleBodyColorPrimary();
      }
      manageTransitions('#quarto-margin-sidebar .nav-link', true);
      // Switch the toggles
      setColorSchemeToggle(alternate)
      // Hack to workaround the fact that safari doesn't
      // properly recolor the scrollbar when toggling (#1455)
      if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
        manageTransitions("body", false);
        window.scrollTo(0, 1);
        setTimeout(() => {
          window.scrollTo(0, 0);
          manageTransitions("body", true);
        }, 40);
      }
    }
    const disableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        stylesheet.rel = 'disabled-stylesheet';
      }
    }
    const enableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        if(stylesheet.rel !== 'stylesheet') { // for Chrome, which will still FOUC without this check
          stylesheet.rel = 'stylesheet';
        }
      }
    }
    const manageTransitions = (selector, allowTransitions) => {
      const els = window.document.querySelectorAll(selector);
      for (let i=0; i < els.length; i++) {
        const el = els[i];
        if (allowTransitions) {
          el.classList.remove('notransition');
        } else {
          el.classList.add('notransition');
        }
      }
    }
    const isFileUrl = () => {
      return window.location.protocol === 'file:';
    }
    const hasAlternateSentinel = () => {
      let styleSentinel = getColorSchemeSentinel();
      if (styleSentinel !== null) {
        return styleSentinel === "alternate";
      } else {
        return false;
      }
    }
    const setStyleSentinel = (alternate) => {
      const value = alternate ? "alternate" : "default";
      if (!isFileUrl()) {
        window.localStorage.setItem("quarto-color-scheme", value);
      } else {
        localAlternateSentinel = value;
      }
    }
    const getColorSchemeSentinel = () => {
      if (!isFileUrl()) {
        const storageValue = window.localStorage.getItem("quarto-color-scheme");
        return storageValue != null ? storageValue : localAlternateSentinel;
      } else {
        return localAlternateSentinel;
      }
    }
    const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
      const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
      const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
      let newTheme = '';
      if(authorPrefersDark) {
        newTheme = isAlternate ? baseTheme : alternateTheme;
      } else {
        newTheme = isAlternate ? alternateTheme : baseTheme;
      }
      const changeGiscusTheme = () => {
        // From: https://github.com/giscus/giscus/issues/336
        const sendMessage = (message) => {
          const iframe = document.querySelector('iframe.giscus-frame');
          if (!iframe) return;
          iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
        }
        sendMessage({
          setConfig: {
            theme: newTheme
          }
        });
      }
      const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
      if (isGiscussLoaded) {
        changeGiscusTheme();
      }
    };
    const authorPrefersDark = false;
    const darkModeDefault = authorPrefersDark;
      document.querySelector('link#quarto-text-highlighting-styles.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
      document.querySelector('link#quarto-bootstrap.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
    let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
    // Dark / light mode switch
    window.quartoToggleColorScheme = () => {
      // Read the current dark / light value
      let toAlternate = !hasAlternateSentinel();
      toggleColorMode(toAlternate);
      setStyleSentinel(toAlternate);
      toggleGiscusIfUsed(toAlternate, darkModeDefault);
      window.dispatchEvent(new Event('resize'));
    };
    // Switch to dark mode if need be
    if (hasAlternateSentinel()) {
      toggleColorMode(true);
    } else {
      toggleColorMode(false);
    }
  </script>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="https://turinglang.org/" class="navbar-brand navbar-brand-logo">
    <img src="../../../assets/images/turing-logo.svg" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="https://turinglang.org/">
    <span class="navbar-title">Turing.jl</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../getting-started/"> 
<span class="menu-text">Get Started</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../tutorials/coin-flipping/"> 
<span class="menu-text">Tutorials</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/library/"> 
<span class="menu-text">Libraries</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/news/"> 
<span class="menu-text">News</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/team/"> 
<span class="menu-text">Team</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-v0.39" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">v0.39</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-v0.39">    
        <li>
    <a class="dropdown-item" href="https://turinglang.org/docs/changelog.html">
 <span class="dropdown-text">Changelog</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://turinglang.org/docs/versions.html">
 <span class="dropdown-text">All Versions</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools tools-wide">
    <a href="https://x.com/TuringLang" title="Turing Twitter" class="quarto-navigation-tool px-1" aria-label="Turing Twitter"><i class="bi bi-twitter"></i></a>
    <a href="https://github.com/TuringLang/Turing.jl" title="Turing GitHub" class="quarto-navigation-tool px-1" aria-label="Turing GitHub"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../../developers/contributing/index.html">Developers</a></li><li class="breadcrumb-item"><a href="../../../developers/inference/variational-inference/index.html">Inference in Detail</a></li><li class="breadcrumb-item"><a href="../../../developers/inference/implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../getting-started/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Getting Started</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../core-functionality/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Core Functionality</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false">
 <span class="menu-text">User Guide</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/automatic-differentiation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Automatic Differentiation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/custom-distribution/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Custom Distributions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/probability-interface/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Querying Model Probabilities</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/modifying-logprob/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Modifying the Log Probability</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/tracking-extra-quantities/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Tracking Extra Quantities</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/mode-estimation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Mode Estimation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/performance-tips/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Performance Tips</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/sampler-visualisation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Sampler Visualization</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/dynamichmc/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using DynamicHMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/external-samplers/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using External Samplers</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/troubleshooting/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Troubleshooting</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false">
 <span class="menu-text">Tutorials</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/coin-flipping/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction: Coin Flipping</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/gaussian-mixture-models/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Mixture Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-neural-networks/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Neural Networks</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/hidden-markov-models/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Hidden Markov Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-linear-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Linear Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/infinite-mixture-models/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Infinite Mixture Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-poisson-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Poisson Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/multinomial-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Multinomial Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-differential-equations/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Differential Equations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/probabilistic-pca/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Probabilistic PCA</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-time-series-analysis/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Time Series Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/gaussian-processes-introduction/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Processes: Introduction</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/gaussian-process-latent-variable-models/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Process Latent Variable Models</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Developers</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/contributing/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Contributing</span></a>
  </div>
</li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false">
 <span class="menu-text">DynamicPPL’s Compiler</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/compiler/model-manual/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Manually Defining a Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/compiler/minituring-compiler/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation I: Compiler</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/compiler/minituring-contexts/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation II: Contexts</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/compiler/design-overview/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Turing Compiler Design (Outdated)</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false">
 <span class="menu-text">DynamicPPL Contexts</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/contexts/submodel-condition/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Conditioning and fixing in submodels</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="false">
 <span class="menu-text">Variable Transformations</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/transforms/distributions/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Distributions and the Jacobian</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/transforms/bijectors/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bijectors in MCMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/transforms/dynamicppl/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variable transformations in DynamicPPL</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true">
 <span class="menu-text">Inference in Detail</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/inference/variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/inference/implementing-samplers/index.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Implementing Samplers</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of Contents</h2>
   
  <ul>
  <li><a href="#quick-overview-of-mala" id="toc-quick-overview-of-mala" class="nav-link active" data-scroll-target="#quick-overview-of-mala">Quick overview of MALA</a></li>
  <li><a href="#what-we-need-from-a-model-logdensityproblems.jl" id="toc-what-we-need-from-a-model-logdensityproblems.jl" class="nav-link" data-scroll-target="#what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: LogDensityProblems.jl</a></li>
  <li><a href="#implementing-mala-in-abstractmcmc.jl" id="toc-implementing-mala-in-abstractmcmc.jl" class="nav-link" data-scroll-target="#implementing-mala-in-abstractmcmc.jl">Implementing MALA in AbstractMCMC.jl</a></li>
  <li><a href="#using-our-sampler-with-turing.jl" id="toc-using-our-sampler-with-turing.jl" class="nav-link" data-scroll-target="#using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</a>
  <ul class="collapse">
  <li><a href="#models-with-constrained-parameters" id="toc-models-with-constrained-parameters" class="nav-link" data-scroll-target="#models-with-constrained-parameters">Models with constrained parameters</a></li>
  </ul></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/TuringLang/docs/edit/main/developers/inference/implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/docs/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">


<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../../developers/contributing/index.html">Developers</a></li><li class="breadcrumb-item"><a href="../../../developers/inference/variational-inference/index.html">Inference in Detail</a></li><li class="breadcrumb-item"><a href="../../../developers/inference/implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Implementing Samplers</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>In this tutorial, we’ll go through step-by-step how to implement a “simple” sampler in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> in such a way that it can be easily applied to Turing.jl models.</p>
<p>In particular, we’re going to implement a version of <strong>Metropolis-adjusted Langevin (MALA)</strong>.</p>
<p>Note that we will implement this sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> framework, completely “ignoring” Turing.jl until the very end of the tutorial, at which point we’ll use a single line of code to make the resulting sampler available to Turing.jl. This is to really drive home the point that one can implement samplers in a way that is accessible to all of Turing.jl’s users without having to use Turing.jl yourself.</p>
<section id="quick-overview-of-mala" class="level2">
<h2 class="anchored" data-anchor-id="quick-overview-of-mala">Quick overview of MALA</h2>
<p>We can view MALA as a single step of the leapfrog intergrator with resampling of momentum <span class="math inline">\(p\)</span> at every step.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> To make that statement a bit more concrete, we first define the <em>extended</em> target <span class="math inline">\(\bar{\gamma}(x, p)\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\log \bar{\gamma}(x, p) \propto \log \gamma(x) + \log \gamma_{\mathcal{N}(0, M)}(p)
\end{equation*}\]</span></p>
<p>where <span class="math inline">\(\gamma_{\mathcal{N}(0, M)}\)</span> denotes the density for a zero-centered Gaussian with covariance matrix <span class="math inline">\(M\)</span>. We then consider targeting this joint distribution over both <span class="math inline">\(x\)</span> and <span class="math inline">\(p\)</span> as follows. First we define the map</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  L_{\epsilon}: \quad &amp; \mathbb{R}^d \times \mathbb{R}^d \to \mathbb{R}^d \times \mathbb{R}^d \\
  &amp; (x, p) \mapsto (\tilde{x}, \tilde{p}) := L_{\epsilon}(x, p)
\end{split}
\end{equation*}\]</span></p>
<p>as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p_{1 / 2} &amp;:= p + \frac{\epsilon}{2} \nabla \log \gamma(x) \\
  \tilde{x} &amp;:= x + \epsilon M^{-1} p_{1 /2 } \\
  p_1 &amp;:= p_{1 / 2} + \frac{\epsilon}{2} \nabla \log \gamma(\tilde{x}) \\
  \tilde{p} &amp;:= - p_1
\end{split}
\end{equation*}\]</span></p>
<p>This might be familiar for some readers as a single step of the Leapfrog integrator. We then define the MALA kernel as follows: given the current iterate <span class="math inline">\(x_i\)</span>, we sample the next iterate <span class="math inline">\(x_{i + 1}\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p &amp;\sim \mathcal{N}(0, M) \\
  (\tilde{x}, \tilde{p}) &amp;:= L_{\epsilon}(x_i, p) \\
  \alpha &amp;:= \min \left\{ 1, \frac{\bar{\gamma}(\tilde{x}, \tilde{p})}{\bar{\gamma}(x_i, p)} \right\} \\
  x_{i + 1} &amp;:=
  \begin{cases}
    \tilde{x} \quad &amp; \text{ with prob. } \alpha \\
    x_i       \quad &amp; \text{ with prob. } 1 - \alpha
  \end{cases}
\end{split}
\end{equation*}\]</span></p>
<p>i.e.&nbsp;we accept the proposal <span class="math inline">\(\tilde{x}\)</span> with probability <span class="math inline">\(\alpha\)</span> and reject it, thus sticking with our current iterate, with probability <span class="math inline">\(1 - \alpha\)</span>.</p>
</section>
<section id="what-we-need-from-a-model-logdensityproblems.jl" class="level2">
<h2 class="anchored" data-anchor-id="what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a></h2>
<p>There are a few things we need from the “target” / “model” / density that we want to sample from:</p>
<ol type="1">
<li>We need access to log-density <em>evaluations</em> <span class="math inline">\(\log \gamma(x)\)</span> so we can compute the acceptance ratio involving <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>We need access to log-density <em>gradients</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span> so we can compute the Leapfrog steps <span class="math inline">\(L_{\epsilon}(x, p)\)</span>.</li>
<li>We also need access to the “size” of the model so we can determine the size of <span class="math inline">\(M\)</span>.</li>
</ol>
<p>Luckily for us, there is a package called <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> which provides an interface for <em>exactly</em> this!</p>
<p>To demonstrate how one can implement the “<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface”<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> we will use a simple Gaussian model as an example:</p>
<div id="4" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblems</span>: LogDensityProblems;</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's define some type that represents the model.</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> IsotropicNormalModel{M<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"mean of the isotropic Gaussian"</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    mean<span class="op">::</span><span class="dt">M</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Specifies what input length the model expects.</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">dimension</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> <span class="fu">length</span>(model.mean)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Implementation of the log-density evaluation of the model.</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x<span class="op">::</span><span class="dt">AbstractVector{&lt;:Real}</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">-</span> <span class="fu">sum</span>(abs2, x <span class="op">.-</span> model.mean) <span class="op">/</span> <span class="fl">2</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This gives us all of the properties we want for our MALA sampler with the exception of the computation of the <em>gradient</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span>. There is the method <code>LogDensityProblems.logdensity_and_gradient</code> which should return a 2-tuple where the first entry is the evaluation of the logdensity <span class="math inline">\(\log \gamma(x)\)</span> and the second entry is the gradient <span class="math inline">\(\nabla \log \gamma(x)\)</span>.</p>
<p>There are two ways to “implement” this method: 1) we implement it by hand, which is feasible in the case of our <code>IsotropicNormalModel</code>, or b) we defer the implementation of this to a automatic differentiation backend.</p>
<p>To implement it by hand we can simply do</p>
<div id="6" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl that first-order, i.e. gradient information, is available.</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{1}</span>()</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Implement `logdensity_and_gradient`.</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    logγ_x <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="op">-</span>x <span class="op">.*</span> (x <span class="op">-</span> model.mean)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> logγ_x, ∇logγ_x</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s just try it out:</p>
<div id="8" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate the problem.</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> <span class="fu">IsotropicNormalModel</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.])</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create some example input that we can test on.</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>x_example <span class="op">=</span> <span class="fu">randn</span>(LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate!</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-10.666370451570634</code></pre>
</div>
</div>
<p>To defer it to an automatic differentiation backend, we can do</p>
<div id="10" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl we only have access to 0-th order information.</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{0}</span>()</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Use `LogDensityProblemsAD`'s `ADgradient` in combination with some AD backend to implement `logdensity_and_gradient`.</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblemsAD</span>, <span class="bu">ADTypes</span>, <span class="bu">ForwardDiff</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>model_with_grad <span class="op">=</span> <span class="fu">ADgradient</span>(<span class="fu">AutoForwardDiff</span>(), model)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model_with_grad, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-10.666370451570634</code></pre>
</div>
</div>
<p>We’ll continue with the second approach in this tutorial since this is typically what one does in practice, because there are better hobbies to spend time on than deriving gradients by hand.</p>
<p>At this point, one might wonder how we’re going to tie this back to Turing.jl in the end. Effectively, when working with inference methods that only require log-density evaluations and / or higher-order information of the log-density, Turing.jl actually converts the user-provided <code>Model</code> into an object implementing the above methods for <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>. As a result, most samplers provided by Turing.jl are actually implemented to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, enabling their use both <em>within</em> Turing.jl and <em>outside</em> of Turing.jl! Morever, there exists similar conversions for Stan through BridgeStan and Stan<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, which means that a sampler supporting the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface can easily be used on both Turing.jl <em>and</em> Stan models (in addition to user-provided models, as our <code>IsotropicNormalModel</code> above)!</p>
<p>Anyways, let’s move on to actually implementing the sampler.</p>
</section>
<section id="implementing-mala-in-abstractmcmc.jl" class="level2">
<h2 class="anchored" data-anchor-id="implementing-mala-in-abstractmcmc.jl">Implementing MALA in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a></h2>
<p>Now that we’ve established that a model implementing the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface provides us with all the information we need from <span class="math inline">\(\log \gamma(x)\)</span>, we can address the question: given an object that implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, how can we define a sampler for it?</p>
<p>We’re going to do this by making our sampler a sub-type of <code>AbstractMCMC.AbstractSampler</code> in addition to implementing a few methods from <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>. Why? Because it gets us <em>a lot</em> of functionality for free, as we will see later.</p>
<p>Moreover, <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> provides a very natural interface for MCMC algorithms.</p>
<p>First, we’ll define our <code>MALA</code> type</p>
<div id="12" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">AbstractMCMC</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALA{T,A} <span class="op">&lt;:</span><span class="dt"> AbstractMCMC.AbstractSampler</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"stepsize used in the leapfrog step"</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    ϵ_init<span class="op">::</span><span class="dt">T</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"covariance matrix used for the momentum"</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    M_init<span class="op">::</span><span class="dt">A</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notice how we’ve added the suffix <code>_init</code> to both the stepsize and the covariance matrix. We’ve done this because a <code>AbstractMCMC.AbstractSampler</code> should be <em>immutable</em>. Of course there might be many scenarios where we want to allow something like the stepsize and / or the covariance matrix to vary between iterations, e.g.&nbsp;during the burn-in / adaptation phase of the sampling process we might want to adjust the parameters using statistics computed from these initial iterations. But information which can change between iterations <em>should not go in the sampler itself</em>! Instead, this information should go in the sampler <em>state</em>.</p>
<p>The sampler state should at the very least contain all the necessary information to perform the next MCMC iteration, but usually contains further information, e.g.&nbsp;quantities and statistics useful for evaluating whether the sampler has converged.</p>
<p>We will use the following sampler state for our <code>MALA</code> sampler:</p>
<div id="14" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALAState{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This might seem overly redundant: we’re defining a type <code>MALAState</code> and it only contains a simple vector of reals. In this particular case we indeed could have dropped this and simply used a <code>AbstractVector{&lt;:Real}</code> as our sampler state, but typically, as we will see later, one wants to include other quantities in the sampler state. For example, if we also wanted to adapt the parameters of our <code>MALA</code>, e.g.&nbsp;alter the stepsize depending on acceptance rates, in which case we should also put <code>ϵ</code> in the state, but for now we’ll keep things simple.</p>
<p>Moreover, we also want a <em>sample</em> type, which is a type meant for “public consumption”, i.e.&nbsp;the end-user. This is generally going to contain a subset of the information present in the state. But in such a simple scenario as this, we similarly only have a <code>AbstractVector{&lt;:Real}</code>:</p>
<div id="16" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALASample{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We currently have three things:</p>
<ol type="1">
<li>A <code>AbstractMCMC.AbstractSampler</code> implementation called <code>MALA</code>.</li>
<li>A state <code>MALAState</code> for our sampler <code>MALA</code>.</li>
<li>A sample <code>MALASample</code> for our sampler <code>MALA</code>.</li>
</ol>
<p>That means that we’re ready to implement the only thing that really matters: <code>AbstractMCMC.step</code>.</p>
<p><code>AbstractMCMC.step</code> defines the MCMC iteration of our <code>MALA</code> given the current <code>MALAState</code>. Specifically, the signature of the function is as follows:</p>
<div id="18" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The RNG to ensure reproducibility.</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The model that defines our target.</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.AbstractModel</span>,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The sampler for which we're taking a `step`.</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">AbstractMCMC.AbstractSampler</span>,</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The current sampler `state`.</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    state;</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Additional keyword arguments that we may or may not need.</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Moreover, there is a specific <code>AbstractMCMC.AbstractModel</code> which is used to indicate that the model that is provided implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface: <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Since, as we discussed earlier, in our case we’re indeed going to work with types that support the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, we’ll define <code>AbstractMCMC.step</code> for such a <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Note that <code>AbstractMCMC.LogDensityModel</code> has no other purpose; it has a single field called <code>logdensity</code>, and it does nothing else. But by wrapping the model in <code>AbstractMCMC.LogDensityModel</code>, it allows samplers that want to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> to define their <code>AbstractMCMC.step</code> on this type without running into method ambiguities.</p>
<p>All in all, that means that the signature for our <code>AbstractMCMC.step</code> is going to be the following:</p>
<div id="20" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># `LogDensityModel` so we know we're working with LogDensityProblems.jl model.</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler.</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler state.</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Great! Now let’s actually implement the full <code>AbstractMCMC.step</code> for our <code>MALA</code>.</p>
<p>Let’s remind ourselves what we’re going to do:</p>
<ol type="1">
<li>Sample a new momentum <span class="math inline">\(p\)</span>.</li>
<li>Compute the log-density of the extended target <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>Take a single leapfrog step <span class="math inline">\((\tilde{x}, \tilde{p}) = L_{\epsilon}(x, p)\)</span>.</li>
<li>Accept or reject the proposed <span class="math inline">\((\tilde{x}, \tilde{p})\)</span>.</li>
</ol>
<p>All in all, this results in the following:</p>
<div id="22" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>: Random</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Distributions</span>  <span class="co"># so we get the `MvNormal`</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the wrapped model which implements LogDensityProblems.jl.</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just extract the sampler parameters to make our lives easier.</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    ϵ <span class="op">=</span> sampler.ϵ_init</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    M <span class="op">=</span> sampler.M_init</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the current parameters.</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> state.x</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sample the momentum.</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>    p_dist <span class="op">=</span> <span class="fu">MvNormal</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)), M)</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> <span class="fu">rand</span>(rng, p_dist)</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Propose using a single leapfrog step.</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>    x̃, p̃ <span class="op">=</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Accept or reject proposal.</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>    logp <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p)</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>    logp̃ <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x̃) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p̃)</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>    logα <span class="op">=</span> logp̃ <span class="op">-</span> logp</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>    state_new <span class="op">=</span> <span class="cf">if</span> <span class="fu">log</span>(<span class="fu">rand</span>(rng)) <span class="op">&lt;</span> logα</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Accept.</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x̃)</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Reject.</span></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x)</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return the "sample" and the sampler state.</span></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(state_new.x), state_new</span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Fairly straight-forward.</p>
<p>Of course, we haven’t defined the <code>leapfrog_step</code> method yet, so let’s do that:</p>
<div id="24" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p` using "position" `x`.</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x))</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    p1 <span class="op">=</span> p <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update the "position" `x` using momentum `p1`.</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    x̃ <span class="op">=</span> x <span class="op">+</span> ϵ <span class="op">.*</span> (M <span class="op">\</span> p1)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p1` using position `x̃`</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x̃ <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x̃))</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    p2 <span class="op">=</span> p1 <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x̃</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Flip momentum `p2`.</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    p̃ <span class="op">=</span> <span class="op">-</span>p2</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x̃, p̃</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>leapfrog_step (generic function with 1 method)</code></pre>
</div>
</div>
<p>With all of this, we’re technically ready to sample!</p>
<div id="26" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>, <span class="bu">LinearAlgebra</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>rng <span class="op">=</span> <span class="bu">Random</span>.<span class="fu">default_rng</span>()</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>sampler <span class="op">=</span> <span class="fu">MALA</span>(<span class="fl">1</span>, I)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>state <span class="op">=</span> <span class="fu">MALAState</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)))</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>x_next, state_next <span class="op">=</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    rng,</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    AbstractMCMC.<span class="fu">LogDensityModel</span>(model),</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    state</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>(MALASample{Vector{Float64}}([0.0, 0.0, 0.0]), MALAState{Vector{Float64}}([0.0, 0.0, 0.0]))</code></pre>
</div>
</div>
<p>Great, it works!</p>
<p>And I promised we would get quite some functionality for free if we implemented <code>AbstractMCMC.step</code>, and so we can now simply call <code>sample</code> to perform standard MCMC sampling:</p>
<div id="28" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform 1000 iterations with our `MALA` sampler.</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; initial_state<span class="op">=</span>state, progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Concatenate into a matrix.</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000 Matrix{Float64}:
 -3.02215   -4.18985   -4.33756   …  -5.77629   -4.46499   -5.10741
  0.819383   0.747481   0.634659      0.389889   0.198575   0.681981
  2.49328    2.24099    4.4364        6.37496    4.54525    5.15927</code></pre>
</div>
</div>
<div id="30" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the marginal means and standard deviations.</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -4.99205     1.01626
  0.00451456  0.997924
  5.02224     0.992918</code></pre>
</div>
</div>
<p>Let’s visualize the samples</p>
<div id="32" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">StatsPlots</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">transpose</span>(samples_matrix[<span class="op">:</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">:</span><span class="kw">end</span>]), alpha<span class="op">=</span><span class="fl">0.5</span>, legend<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<!--?xml version="1.0" encoding="utf-8"?-->
<svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" width="672" height="480" viewbox="0 0 2688 1920">
<defs>
  <clippath id="clip780">
    <rect x="0" y="0" width="2688" height="1920"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip780)" d="M0 1920 L2688 1920 L2688 0 L0 0  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip781">
    <rect x="537" y="0" width="1883" height="1883"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip780)" d="M151.747 1800.78 L2640.76 1800.78 L2640.76 47.2441 L151.747 47.2441  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip782">
    <rect x="151" y="47" width="2490" height="1755"></rect>
  </clippath>
</defs>
<polyline clip-path="url(#clip782)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="219.84,1800.78 219.84,47.2441 "></polyline>
<polyline clip-path="url(#clip782)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="807.458,1800.78 807.458,47.2441 "></polyline>
<polyline clip-path="url(#clip782)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1395.08,1800.78 1395.08,47.2441 "></polyline>
<polyline clip-path="url(#clip782)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1982.69,1800.78 1982.69,47.2441 "></polyline>
<polyline clip-path="url(#clip782)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="2570.31,1800.78 2570.31,47.2441 "></polyline>
<polyline clip-path="url(#clip782)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,1540.2 2640.76,1540.2 "></polyline>
<polyline clip-path="url(#clip782)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,1233.48 2640.76,1233.48 "></polyline>
<polyline clip-path="url(#clip782)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,926.757 2640.76,926.757 "></polyline>
<polyline clip-path="url(#clip782)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,620.036 2640.76,620.036 "></polyline>
<polyline clip-path="url(#clip782)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,313.315 2640.76,313.315 "></polyline>
<polyline clip-path="url(#clip780)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1800.78 2640.76,1800.78 "></polyline>
<polyline clip-path="url(#clip780)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="219.84,1800.78 219.84,1781.88 "></polyline>
<polyline clip-path="url(#clip780)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="807.458,1800.78 807.458,1781.88 "></polyline>
<polyline clip-path="url(#clip780)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1395.08,1800.78 1395.08,1781.88 "></polyline>
<polyline clip-path="url(#clip780)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1982.69,1800.78 1982.69,1781.88 "></polyline>
<polyline clip-path="url(#clip780)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="2570.31,1800.78 2570.31,1781.88 "></polyline>
<path clip-path="url(#clip780)" d="M219.84 1834 Q216.229 1834 214.4 1837.57 Q212.595 1841.11 212.595 1848.24 Q212.595 1855.34 214.4 1858.91 Q216.229 1862.45 219.84 1862.45 Q223.474 1862.45 225.28 1858.91 Q227.108 1855.34 227.108 1848.24 Q227.108 1841.11 225.28 1837.57 Q223.474 1834 219.84 1834 M219.84 1830.3 Q225.65 1830.3 228.706 1834.9 Q231.784 1839.49 231.784 1848.24 Q231.784 1856.96 228.706 1861.57 Q225.65 1866.15 219.84 1866.15 Q214.03 1866.15 210.951 1861.57 Q207.896 1856.96 207.896 1848.24 Q207.896 1839.49 210.951 1834.9 Q214.03 1830.3 219.84 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip780)" d="M771.15 1861.55 L787.47 1861.55 L787.47 1865.48 L765.525 1865.48 L765.525 1861.55 Q768.187 1858.79 772.771 1854.16 Q777.377 1849.51 778.558 1848.17 Q780.803 1845.65 781.683 1843.91 Q782.585 1842.15 782.585 1840.46 Q782.585 1837.71 780.641 1835.97 Q778.72 1834.23 775.618 1834.23 Q773.419 1834.23 770.965 1835 Q768.535 1835.76 765.757 1837.31 L765.757 1832.59 Q768.581 1831.46 771.035 1830.88 Q773.488 1830.3 775.525 1830.3 Q780.896 1830.3 784.09 1832.98 Q787.285 1835.67 787.285 1840.16 Q787.285 1842.29 786.474 1844.21 Q785.687 1846.11 783.581 1848.7 Q783.002 1849.37 779.9 1852.59 Q776.798 1855.78 771.15 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip780)" d="M797.331 1830.92 L815.687 1830.92 L815.687 1834.86 L801.613 1834.86 L801.613 1843.33 Q802.632 1842.98 803.65 1842.82 Q804.669 1842.64 805.687 1842.64 Q811.474 1842.64 814.854 1845.81 Q818.233 1848.98 818.233 1854.4 Q818.233 1859.97 814.761 1863.08 Q811.289 1866.15 804.97 1866.15 Q802.794 1866.15 800.525 1865.78 Q798.28 1865.41 795.872 1864.67 L795.872 1859.97 Q797.956 1861.11 800.178 1861.66 Q802.4 1862.22 804.877 1862.22 Q808.882 1862.22 811.22 1860.11 Q813.558 1858.01 813.558 1854.4 Q813.558 1850.78 811.22 1848.68 Q808.882 1846.57 804.877 1846.57 Q803.002 1846.57 801.127 1846.99 Q799.275 1847.4 797.331 1848.28 L797.331 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip780)" d="M837.446 1834 Q833.835 1834 832.007 1837.57 Q830.201 1841.11 830.201 1848.24 Q830.201 1855.34 832.007 1858.91 Q833.835 1862.45 837.446 1862.45 Q841.081 1862.45 842.886 1858.91 Q844.715 1855.34 844.715 1848.24 Q844.715 1841.11 842.886 1837.57 Q841.081 1834 837.446 1834 M837.446 1830.3 Q843.256 1830.3 846.312 1834.9 Q849.391 1839.49 849.391 1848.24 Q849.391 1856.96 846.312 1861.57 Q843.256 1866.15 837.446 1866.15 Q831.636 1866.15 828.557 1861.57 Q825.502 1856.96 825.502 1848.24 Q825.502 1839.49 828.557 1834.9 Q831.636 1830.3 837.446 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip780)" d="M1354.69 1830.92 L1373.05 1830.92 L1373.05 1834.86 L1358.98 1834.86 L1358.98 1843.33 Q1360 1842.98 1361.01 1842.82 Q1362.03 1842.64 1363.05 1842.64 Q1368.84 1842.64 1372.22 1845.81 Q1375.6 1848.98 1375.6 1854.4 Q1375.6 1859.97 1372.12 1863.08 Q1368.65 1866.15 1362.33 1866.15 Q1360.16 1866.15 1357.89 1865.78 Q1355.64 1865.41 1353.24 1864.67 L1353.24 1859.97 Q1355.32 1861.11 1357.54 1861.66 Q1359.76 1862.22 1362.24 1862.22 Q1366.25 1862.22 1368.58 1860.11 Q1370.92 1858.01 1370.92 1854.4 Q1370.92 1850.78 1368.58 1848.68 Q1366.25 1846.57 1362.24 1846.57 Q1360.37 1846.57 1358.49 1846.99 Q1356.64 1847.4 1354.69 1848.28 L1354.69 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip780)" d="M1394.81 1834 Q1391.2 1834 1389.37 1837.57 Q1387.56 1841.11 1387.56 1848.24 Q1387.56 1855.34 1389.37 1858.91 Q1391.2 1862.45 1394.81 1862.45 Q1398.44 1862.45 1400.25 1858.91 Q1402.08 1855.34 1402.08 1848.24 Q1402.08 1841.11 1400.25 1837.57 Q1398.44 1834 1394.81 1834 M1394.81 1830.3 Q1400.62 1830.3 1403.68 1834.9 Q1406.75 1839.49 1406.75 1848.24 Q1406.75 1856.96 1403.68 1861.57 Q1400.62 1866.15 1394.81 1866.15 Q1389 1866.15 1385.92 1861.57 Q1382.87 1856.96 1382.87 1848.24 Q1382.87 1839.49 1385.92 1834.9 Q1389 1830.3 1394.81 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip780)" d="M1424.97 1834 Q1421.36 1834 1419.53 1837.57 Q1417.73 1841.11 1417.73 1848.24 Q1417.73 1855.34 1419.53 1858.91 Q1421.36 1862.45 1424.97 1862.45 Q1428.61 1862.45 1430.41 1858.91 Q1432.24 1855.34 1432.24 1848.24 Q1432.24 1841.11 1430.41 1837.57 Q1428.61 1834 1424.97 1834 M1424.97 1830.3 Q1430.78 1830.3 1433.84 1834.9 Q1436.92 1839.49 1436.92 1848.24 Q1436.92 1856.96 1433.84 1861.57 Q1430.78 1866.15 1424.97 1866.15 Q1419.16 1866.15 1416.08 1861.57 Q1413.03 1856.96 1413.03 1848.24 Q1413.03 1839.49 1416.08 1834.9 Q1419.16 1830.3 1424.97 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip780)" d="M1940.97 1830.92 L1963.19 1830.92 L1963.19 1832.91 L1950.65 1865.48 L1945.76 1865.48 L1957.57 1834.86 L1940.97 1834.86 L1940.97 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip780)" d="M1972.36 1830.92 L1990.71 1830.92 L1990.71 1834.86 L1976.64 1834.86 L1976.64 1843.33 Q1977.66 1842.98 1978.68 1842.82 Q1979.7 1842.64 1980.72 1842.64 Q1986.5 1842.64 1989.88 1845.81 Q1993.26 1848.98 1993.26 1854.4 Q1993.26 1859.97 1989.79 1863.08 Q1986.32 1866.15 1980 1866.15 Q1977.82 1866.15 1975.55 1865.78 Q1973.31 1865.41 1970.9 1864.67 L1970.9 1859.97 Q1972.98 1861.11 1975.21 1861.66 Q1977.43 1862.22 1979.9 1862.22 Q1983.91 1862.22 1986.25 1860.11 Q1988.59 1858.01 1988.59 1854.4 Q1988.59 1850.78 1986.25 1848.68 Q1983.91 1846.57 1979.9 1846.57 Q1978.03 1846.57 1976.15 1846.99 Q1974.3 1847.4 1972.36 1848.28 L1972.36 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip780)" d="M2012.47 1834 Q2008.86 1834 2007.03 1837.57 Q2005.23 1841.11 2005.23 1848.24 Q2005.23 1855.34 2007.03 1858.91 Q2008.86 1862.45 2012.47 1862.45 Q2016.11 1862.45 2017.91 1858.91 Q2019.74 1855.34 2019.74 1848.24 Q2019.74 1841.11 2017.91 1837.57 Q2016.11 1834 2012.47 1834 M2012.47 1830.3 Q2018.28 1830.3 2021.34 1834.9 Q2024.42 1839.49 2024.42 1848.24 Q2024.42 1856.96 2021.34 1861.57 Q2018.28 1866.15 2012.47 1866.15 Q2006.66 1866.15 2003.59 1861.57 Q2000.53 1856.96 2000.53 1848.24 Q2000.53 1839.49 2003.59 1834.9 Q2006.66 1830.3 2012.47 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip780)" d="M2514.84 1861.55 L2522.48 1861.55 L2522.48 1835.18 L2514.17 1836.85 L2514.17 1832.59 L2522.43 1830.92 L2527.11 1830.92 L2527.11 1861.55 L2534.75 1861.55 L2534.75 1865.48 L2514.84 1865.48 L2514.84 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip780)" d="M2554.19 1834 Q2550.58 1834 2548.75 1837.57 Q2546.94 1841.11 2546.94 1848.24 Q2546.94 1855.34 2548.75 1858.91 Q2550.58 1862.45 2554.19 1862.45 Q2557.82 1862.45 2559.63 1858.91 Q2561.46 1855.34 2561.46 1848.24 Q2561.46 1841.11 2559.63 1837.57 Q2557.82 1834 2554.19 1834 M2554.19 1830.3 Q2560 1830.3 2563.06 1834.9 Q2566.13 1839.49 2566.13 1848.24 Q2566.13 1856.96 2563.06 1861.57 Q2560 1866.15 2554.19 1866.15 Q2548.38 1866.15 2545.3 1861.57 Q2542.25 1856.96 2542.25 1848.24 Q2542.25 1839.49 2545.3 1834.9 Q2548.38 1830.3 2554.19 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip780)" d="M2584.35 1834 Q2580.74 1834 2578.91 1837.57 Q2577.11 1841.11 2577.11 1848.24 Q2577.11 1855.34 2578.91 1858.91 Q2580.74 1862.45 2584.35 1862.45 Q2587.99 1862.45 2589.79 1858.91 Q2591.62 1855.34 2591.62 1848.24 Q2591.62 1841.11 2589.79 1837.57 Q2587.99 1834 2584.35 1834 M2584.35 1830.3 Q2590.16 1830.3 2593.22 1834.9 Q2596.3 1839.49 2596.3 1848.24 Q2596.3 1856.96 2593.22 1861.57 Q2590.16 1866.15 2584.35 1866.15 Q2578.54 1866.15 2575.46 1861.57 Q2572.41 1856.96 2572.41 1848.24 Q2572.41 1839.49 2575.46 1834.9 Q2578.54 1830.3 2584.35 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip780)" d="M2614.51 1834 Q2610.9 1834 2609.07 1837.57 Q2607.27 1841.11 2607.27 1848.24 Q2607.27 1855.34 2609.07 1858.91 Q2610.9 1862.45 2614.51 1862.45 Q2618.15 1862.45 2619.95 1858.91 Q2621.78 1855.34 2621.78 1848.24 Q2621.78 1841.11 2619.95 1837.57 Q2618.15 1834 2614.51 1834 M2614.51 1830.3 Q2620.32 1830.3 2623.38 1834.9 Q2626.46 1839.49 2626.46 1848.24 Q2626.46 1856.96 2623.38 1861.57 Q2620.32 1866.15 2614.51 1866.15 Q2608.7 1866.15 2605.62 1861.57 Q2602.57 1856.96 2602.57 1848.24 Q2602.57 1839.49 2605.62 1834.9 Q2608.7 1830.3 2614.51 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip780)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1800.78 151.747,47.2441 "></polyline>
<polyline clip-path="url(#clip780)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1540.2 170.644,1540.2 "></polyline>
<polyline clip-path="url(#clip780)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1233.48 170.644,1233.48 "></polyline>
<polyline clip-path="url(#clip780)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,926.757 170.644,926.757 "></polyline>
<polyline clip-path="url(#clip780)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,620.036 170.644,620.036 "></polyline>
<polyline clip-path="url(#clip780)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,313.315 170.644,313.315 "></polyline>
<path clip-path="url(#clip780)" d="M49.5521 1540.65 L79.2279 1540.65 L79.2279 1544.58 L49.5521 1544.58 L49.5521 1540.65 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip780)" d="M99.8991 1538.33 Q96.7509 1538.33 94.8991 1540.49 Q93.0704 1542.64 93.0704 1546.39 Q93.0704 1550.12 94.8991 1552.29 Q96.7509 1554.45 99.8991 1554.45 Q103.047 1554.45 104.876 1552.29 Q106.728 1550.12 106.728 1546.39 Q106.728 1542.64 104.876 1540.49 Q103.047 1538.33 99.8991 1538.33 M109.181 1523.68 L109.181 1527.94 Q107.422 1527.11 105.617 1526.67 Q103.834 1526.23 102.075 1526.23 Q97.4454 1526.23 94.9917 1529.35 Q92.5612 1532.48 92.2139 1538.8 Q93.5797 1536.78 95.6398 1535.72 Q97.7 1534.63 100.177 1534.63 Q105.385 1534.63 108.394 1537.8 Q111.427 1540.95 111.427 1546.39 Q111.427 1551.71 108.279 1554.93 Q105.131 1558.15 99.8991 1558.15 Q93.9037 1558.15 90.7325 1553.57 Q87.5612 1548.96 87.5612 1540.23 Q87.5612 1532.04 91.45 1527.18 Q95.3389 1522.29 101.89 1522.29 Q103.649 1522.29 105.431 1522.64 Q107.237 1522.99 109.181 1523.68 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip780)" d="M50.3623 1233.93 L80.0381 1233.93 L80.0381 1237.86 L50.3623 1237.86 L50.3623 1233.93 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip780)" d="M104.297 1232.12 Q107.654 1232.84 109.529 1235.11 Q111.427 1237.38 111.427 1240.71 Q111.427 1245.83 107.908 1248.63 Q104.39 1251.43 97.9083 1251.43 Q95.7324 1251.43 93.4176 1250.99 Q91.126 1250.57 88.6723 1249.72 L88.6723 1245.2 Q90.6167 1246.34 92.9315 1246.91 Q95.2463 1247.49 97.7695 1247.49 Q102.168 1247.49 104.459 1245.76 Q106.774 1244.02 106.774 1240.71 Q106.774 1237.66 104.621 1235.94 Q102.492 1234.21 98.6722 1234.21 L94.6445 1234.21 L94.6445 1230.36 L98.8574 1230.36 Q102.306 1230.36 104.135 1229 Q105.964 1227.61 105.964 1225.02 Q105.964 1222.35 104.066 1220.94 Q102.191 1219.51 98.6722 1219.51 Q96.7509 1219.51 94.5519 1219.92 Q92.3528 1220.34 89.7139 1221.22 L89.7139 1217.05 Q92.376 1216.31 94.6908 1215.94 Q97.0287 1215.57 99.0889 1215.57 Q104.413 1215.57 107.515 1218 Q110.617 1220.41 110.617 1224.53 Q110.617 1227.4 108.973 1229.39 Q107.33 1231.36 104.297 1232.12 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip780)" d="M99.4824 912.555 Q95.8713 912.555 94.0426 916.12 Q92.2371 919.662 92.2371 926.791 Q92.2371 933.898 94.0426 937.463 Q95.8713 941.004 99.4824 941.004 Q103.117 941.004 104.922 937.463 Q106.751 933.898 106.751 926.791 Q106.751 919.662 104.922 916.12 Q103.117 912.555 99.4824 912.555 M99.4824 908.852 Q105.293 908.852 108.348 913.458 Q111.427 918.042 111.427 926.791 Q111.427 935.518 108.348 940.125 Q105.293 944.708 99.4824 944.708 Q93.6723 944.708 90.5936 940.125 Q87.538 935.518 87.538 926.791 Q87.538 918.042 90.5936 913.458 Q93.6723 908.852 99.4824 908.852 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip780)" d="M104.297 618.682 Q107.654 619.399 109.529 621.668 Q111.427 623.936 111.427 627.27 Q111.427 632.385 107.908 635.186 Q104.39 637.987 97.9083 637.987 Q95.7324 637.987 93.4176 637.547 Q91.126 637.131 88.6723 636.274 L88.6723 631.76 Q90.6167 632.895 92.9315 633.473 Q95.2463 634.052 97.7695 634.052 Q102.168 634.052 104.459 632.316 Q106.774 630.58 106.774 627.27 Q106.774 624.214 104.621 622.501 Q102.492 620.765 98.6722 620.765 L94.6445 620.765 L94.6445 616.923 L98.8574 616.923 Q102.306 616.923 104.135 615.557 Q105.964 614.168 105.964 611.575 Q105.964 608.913 104.066 607.501 Q102.191 606.066 98.6722 606.066 Q96.7509 606.066 94.5519 606.483 Q92.3528 606.899 89.7139 607.779 L89.7139 603.612 Q92.376 602.872 94.6908 602.501 Q97.0287 602.131 99.0889 602.131 Q104.413 602.131 107.515 604.562 Q110.617 606.969 110.617 611.089 Q110.617 613.96 108.973 615.95 Q107.33 617.918 104.297 618.682 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip780)" d="M99.8991 311.452 Q96.7509 311.452 94.8991 313.605 Q93.0704 315.757 93.0704 319.507 Q93.0704 323.234 94.8991 325.41 Q96.7509 327.563 99.8991 327.563 Q103.047 327.563 104.876 325.41 Q106.728 323.234 106.728 319.507 Q106.728 315.757 104.876 313.605 Q103.047 311.452 99.8991 311.452 M109.181 296.799 L109.181 301.058 Q107.422 300.225 105.617 299.785 Q103.834 299.345 102.075 299.345 Q97.4454 299.345 94.9917 302.47 Q92.5612 305.595 92.2139 311.915 Q93.5797 309.901 95.6398 308.836 Q97.7 307.748 100.177 307.748 Q105.385 307.748 108.394 310.919 Q111.427 314.067 111.427 319.507 Q111.427 324.831 108.279 328.049 Q105.131 331.266 99.8991 331.266 Q93.9037 331.266 90.7325 326.683 Q87.5612 322.077 87.5612 313.35 Q87.5612 305.155 91.45 300.294 Q95.3389 295.41 101.89 295.41 Q103.649 295.41 105.431 295.757 Q107.237 296.105 109.181 296.799 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip782)" style="stroke:#009af9; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,1235.74 224.541,1428.24 226.891,1384.79 229.242,1531.23 231.592,1573.82 233.943,1423.6 236.293,1442.62 238.644,1467.82 240.994,1387.77 243.345,1197.15 245.695,1477.37 248.046,1340.3 250.396,1446.58 252.747,1390.48 255.097,1466.24 257.448,1608.69 259.798,1687 262.148,1417.74 264.499,1372.5 266.849,1391.18 269.2,1676.94 271.55,1342.46 273.901,1262.59 276.251,1364.49 278.602,1751.15 280.952,1536.95 283.303,1475.76 285.653,1395.72 288.004,1540.53 290.354,1424.77 292.705,1362.43 295.055,1545.43 297.406,1610.14 299.756,1443.9 302.107,1306.96 304.457,1594.05 306.807,1404.01 309.158,1383.36 311.508,1531.64 313.859,1496.71 316.209,1443.8 318.56,1425.94 320.91,1431.84 323.261,1549.47 325.611,1467 327.962,1420.48 330.312,1332.81 332.663,1492.75 335.013,1450.82 337.364,1240.14 339.714,1407.15 342.065,1554.49 344.415,1324.27 346.765,1489.61 349.116,1576.29 351.466,1600.65 353.817,1571.89 356.167,1344.57 358.518,1449.33 360.868,1500.71 363.219,1470.77 365.569,1530.01 367.92,1308.88 370.27,1656.15 372.621,1331.11 374.971,1325.11 377.322,1231.8 379.672,1451.21 382.023,1508.93 384.373,1560.58 386.724,1285.16 389.074,1472.58 391.424,1400.67 393.775,1377.62 396.125,1401.35 398.476,1240.51 400.826,1363.51 403.177,1363.02 405.527,1304.15 407.878,1370.22 410.228,1467.05 412.579,1179.44 414.929,1444.78 417.28,1596.71 419.63,1522.41 421.981,1466.19 424.331,1465.71 426.682,1645.93 429.032,1395.63 431.382,1481.43 433.733,1311.73 436.083,1410.84 438.434,1636.32 440.784,1378.87 443.135,1365.25 445.485,1273.39 447.836,1496.7 450.186,1641.73 452.537,1421.14 454.887,1182.3 457.238,1478.61 459.588,1356.34 461.939,1537.6 464.289,1351.43 466.64,1402.9 468.99,1543.23 471.341,1170.08 473.691,1231.57 476.041,1568.42 478.392,1551.5 480.742,1250.76 483.093,1419.93 485.443,1375.34 487.794,1277.36 490.144,1400.84 492.495,1284.9 494.845,1500.11 497.196,1624.33 499.546,1478.99 501.897,1460.75 504.247,1418.18 506.598,1698.35 508.948,1314.4 511.299,1347.13 513.649,1461.67 515.999,1515.97 518.35,1429.54 520.7,1576.76 523.051,1406.33 525.401,1414.77 527.752,1374.96 530.102,1456.99 532.453,1446.77 534.803,1333.7 537.154,1521.47 539.504,1356.97 541.855,1274.23 544.205,1345.13 546.556,1205.22 548.906,1479.72 551.257,1387.04 553.607,1496.98 555.958,1405.3 558.308,1602.67 560.658,1334.78 563.009,1281.83 565.359,1437.02 567.71,1437.53 570.06,1474.08 572.411,1577.77 574.761,1409.4 577.112,1514.78 579.462,1568.66 581.813,1447.85 584.163,1447 586.514,1381.99 588.864,1281.17 591.215,1270.56 593.565,1435 595.916,1348.22 598.266,1598.83 600.616,1339.99 602.967,1367.13 605.317,1433.8 607.668,1439.16 610.018,1340.03 612.369,1426.88 614.719,1469.67 617.07,1517.41 619.42,1377.54 621.771,1495.98 624.121,1579.52 626.472,1371.06 628.822,1463.88 631.173,1461.32 633.523,1552.77 635.874,1226.02 638.224,1475.95 640.575,1245.72 642.925,1383.08 645.275,1408.52 647.626,1501.61 649.976,1411.26 652.327,1452.96 654.677,1652.91 657.028,1452.53 659.378,1421.29 661.729,1223.73 664.079,1447.13 666.43,1485.7 668.78,1410.75 671.131,1329.4 673.481,1485.37 675.832,1275.82 678.182,1519.18 680.533,1392.41 682.883,1480.68 685.233,1450.79 687.584,1495.43 689.934,1462.83 692.285,1486.81 694.635,1675.97 696.986,1312.5 699.336,1510.65 701.687,1182.22 704.037,1491.77 706.388,1529.75 708.738,1419.94 711.089,1294.38 713.439,1495.85 715.79,1371.11 718.14,1574.06 720.491,1423.12 722.841,1380.73 725.192,1326.16 727.542,1597.63 729.892,1320.91 732.243,1625.67 734.593,1515.87 736.944,1426.21 739.294,1341.33 741.645,1372.23 743.995,1360.51 746.346,1270.57 748.696,1409.76 751.047,1358.02 753.397,1387.25 755.748,1476.52 758.098,1600.11 760.449,1428.36 762.799,1415.98 765.15,1305.29 767.5,1426.39 769.85,1496.29 772.201,1524.44 774.551,1325.46 776.902,1656.68 779.252,1447.4 781.603,1374.27 783.953,1495.85 786.304,1452.36 788.654,1538.33 791.005,1314.7 793.355,1367.6 795.706,1454.59 798.056,1240.46 800.407,1414.11 802.757,1457.77 805.108,1338.68 807.458,1500.06 809.809,1378.73 812.159,1686.24 814.509,1478.79 816.86,1263.09 819.21,1489.76 821.561,1326.13 823.911,1390.25 826.262,1315.71 828.612,1490.64 830.963,1400.46 833.313,1430.95 835.664,1506.35 838.014,1248.97 840.365,1557.05 842.715,1356.43 845.066,1440.94 847.416,1434.92 849.767,1363.32 852.117,1468.35 854.467,1319.4 856.818,1428.93 859.168,1343.13 861.519,1265.77 863.869,1275.43 866.22,1531.19 868.57,1538.87 870.921,1383.76 873.271,1502.99 875.622,1424.63 877.972,1472.68 880.323,1446.71 882.673,1300.3 885.024,1398.14 887.374,1457.39 889.725,1372.32 892.075,1414.77 894.426,1356.43 896.776,1418.09 899.126,1485.48 901.477,1433.35 903.827,1473.98 906.178,1385.89 908.528,1624.15 910.879,1415.03 913.229,1255.71 915.58,1511.12 917.93,1274.91 920.281,1438.55 922.631,1608.66 924.982,1339.12 927.332,1413.13 929.683,1421.27 932.033,1591.19 934.384,1246.88 936.734,1434.61 939.084,1341.94 941.435,1633.14 943.785,1552.88 946.136,1509.43 948.486,1325.6 950.837,1508.09 953.187,1439.33 955.538,1306.24 957.888,1531.22 960.239,1346.44 962.589,1375.27 964.94,1533.62 967.29,1431.44 969.641,1418.47 971.991,1497.25 974.342,1428.44 976.692,1304.39 979.043,1486.51 981.393,1473.58 983.743,1488.52 986.094,1411.76 988.444,1375.53 990.795,1470.1 993.145,1486.15 995.496,1441.92 997.846,1345.69 1000.2,1477.81 1002.55,1377.69 1004.9,1333.1 1007.25,1587.69 1009.6,1449.65 1011.95,1559.37 1014.3,1366.21 1016.65,1528.34 1019,1451.63 1021.35,1429.1 1023.7,1519.92 1026.05,1514.32 1028.4,1372.23 1030.75,1358.25 1033.1,1491.69 1035.45,1443.31 1037.8,1389.29 1040.15,1345.93 1042.51,1513.09 1044.86,1353.14 1047.21,1591.75 1049.56,1403.05 1051.91,1274.32 1054.26,1386.19 1056.61,1237.5 1058.96,1402.61 1061.31,1399.52 1063.66,1748.28 1066.01,1387.53 1068.36,1489.23 1070.71,1503 1073.06,1410.88 1075.41,1521.8 1077.76,1416.86 1080.11,1476.53 1082.46,1481.91 1084.81,1469.71 1087.16,1094.49 1089.51,1472.12 1091.87,1348.51 1094.22,1406.45 1096.57,1531.08 1098.92,1378.75 1101.27,1504.68 1103.62,1304.03 1105.97,1317.23 1108.32,1377.13 1110.67,1429.56 1113.02,1339.06 1115.37,1291.16 1117.72,1310.19 1120.07,1325.17 1122.42,1353.56 1124.77,1353.04 1127.12,1277.99 1129.47,1595.88 1131.82,1380.74 1134.17,1324.19 1136.52,1560.3 1138.87,1303.4 1141.23,1467.54 1143.58,1419.03 1145.93,1652.72 1148.28,1602.26 1150.63,1462.99 1152.98,1466.58 1155.33,1296.25 1157.68,1243.28 1160.03,1322.36 1162.38,1544.07 1164.73,1446.14 1167.08,1427.39 1169.43,1440.51 1171.78,1573.16 1174.13,1366.79 1176.48,1533.05 1178.83,1458.45 1181.18,1333.8 1183.53,1468.66 1185.88,1374.31 1188.23,1439.61 1190.59,1278.38 1192.94,1356.35 1195.29,1606.17 1197.64,1609.6 1199.99,1290.64 1202.34,1432.91 1204.69,1530.64 1207.04,1371.85 1209.39,1224.89 1211.74,1449.45 1214.09,1273.86 1216.44,1625.98 1218.79,1510.45 1221.14,1510.29 1223.49,1568.02 1225.84,1552.89 1228.19,1252.32 1230.54,1547.97 1232.89,1382.53 1235.24,1603.15 1237.59,1607.58 1239.94,1351.76 1242.3,1309.47 1244.65,1246.04 1247,1474.75 1249.35,1485.47 1251.7,1398.89 1254.05,1508.91 1256.4,1390.28 1258.75,1391.25 1261.1,1553.25 1263.45,1274.06 1265.8,1197.49 1268.15,1286.77 1270.5,1598.57 1272.85,1300.47 1275.2,1394.15 1277.55,1377.13 1279.9,1382.56 1282.25,1478.85 1284.6,1484.82 1286.95,1426.29 1289.3,1381.41 1291.66,1483.03 1294.01,1463.89 1296.36,1479.9 1298.71,1573.13 1301.06,1424.63 1303.41,1334.71 1305.76,1344.8 1308.11,1304.31 1310.46,1629.44 1312.81,1406.57 1315.16,1279.91 1317.51,1503.43 1319.86,1536.14 1322.21,1501.86 1324.56,1654.34 1326.91,1593.82 1329.26,1471.13 1331.61,1667.57 1333.96,1367.86 1336.31,1498.05 1338.66,1438.17 1341.02,1445.21 1343.37,1372.8 1345.72,1565.53 1348.07,1386.83 1350.42,1550.7 1352.77,1610.01 1355.12,1368.75 1357.47,1342.64 1359.82,1428.5 1362.17,1480.66 1364.52,1390.51 1366.87,1451.68 1369.22,1433.55 1371.57,1607.7 1373.92,1282.54 1376.27,1364.42 1378.62,1381.36 1380.97,1343.74 1383.32,1554.75 1385.67,1531.9 1388.02,1451.65 1390.38,1583.39 1392.73,1581.08 1395.08,1474.72 1397.43,1495.8 1399.78,1351.19 1402.13,1516.22 1404.48,1388.63 1406.83,1478.89 1409.18,1570.25 1411.53,1478.92 1413.88,1519.32 1416.23,1330.86 1418.58,1481.93 1420.93,1366.07 1423.28,1508.93 1425.63,1448.35 1427.98,1504.96 1430.33,1565.89 1432.68,1300.57 1435.03,1492.78 1437.38,1325.57 1439.74,1446.58 1442.09,1366.83 1444.44,1251.07 1446.79,1480.05 1449.14,1411.46 1451.49,1313.76 1453.84,1571.82 1456.19,1480.9 1458.54,1254.51 1460.89,1353.81 1463.24,1517.6 1465.59,1643.05 1467.94,1430.56 1470.29,1429.18 1472.64,1406.59 1474.99,1477.72 1477.34,1320.32 1479.69,1444.93 1482.04,1625.93 1484.39,1521.68 1486.74,1290.51 1489.1,1270 1491.45,1399.9 1493.8,1452.53 1496.15,1427.18 1498.5,1417.78 1500.85,1407.3 1503.2,1339.62 1505.55,1236.41 1507.9,1344.4 1510.25,1468.53 1512.6,1211.38 1514.95,1491.28 1517.3,1441.11 1519.65,1485.91 1522,1364.36 1524.35,1612.32 1526.7,1423.01 1529.05,1369.02 1531.4,1566.32 1533.75,1609.53 1536.1,1399.95 1538.45,1588.18 1540.81,1479.24 1543.16,1609.84 1545.51,1429.19 1547.86,1536.27 1550.21,1440.35 1552.56,1518.98 1554.91,1541.59 1557.26,1201.24 1559.61,1335.8 1561.96,1432.92 1564.31,1331.89 1566.66,1320.18 1569.01,1290.8 1571.36,1504.02 1573.71,1518.58 1576.06,1378.83 1578.41,1390.63 1580.76,1338.2 1583.11,1670.24 1585.46,1247.41 1587.81,1420.91 1590.17,1360.96 1592.52,1502.92 1594.87,1550.13 1597.22,1460.79 1599.57,1316.28 1601.92,1313.91 1604.27,1543.05 1606.62,1520.83 1608.97,1545.9 1611.32,1424.87 1613.67,1389.28 1616.02,1241.13 1618.37,1365.82 1620.72,1294.29 1623.07,1540.7 1625.42,1465.01 1627.77,1712.76 1630.12,1325.68 1632.47,1538.07 1634.82,1573.75 1637.17,1364.72 1639.53,1373.12 1641.88,1467.35 1644.23,1603.98 1646.58,1433.25 1648.93,1545.22 1651.28,1080.71 1653.63,1372.5 1655.98,1498.52 1658.33,1522.16 1660.68,1477.23 1663.03,1318.53 1665.38,1403.85 1667.73,1545.34 1670.08,1435.95 1672.43,1359.72 1674.78,1421.16 1677.13,1332.82 1679.48,1211.97 1681.83,1390.97 1684.18,1561.26 1686.53,1288.64 1688.89,1492.53 1691.24,1424.27 1693.59,1449.53 1695.94,1425.63 1698.29,1620.06 1700.64,1347.83 1702.99,1507.35 1705.34,1489.79 1707.69,1379.7 1710.04,1295.8 1712.39,1321.02 1714.74,1529.31 1717.09,1325.37 1719.44,1394.81 1721.79,1346.3 1724.14,1481.36 1726.49,1474.18 1728.84,1362.67 1731.19,1544.56 1733.54,1462.14 1735.89,1470.8 1738.25,1364.41 1740.6,1330.02 1742.95,1430.87 1745.3,1504.31 1747.65,1398.94 1750,1375.81 1752.35,1368.33 1754.7,1284.82 1757.05,1325.87 1759.4,1431.87 1761.75,1463.69 1764.1,1548.16 1766.45,1469.1 1768.8,1322.79 1771.15,1631.74 1773.5,1442.66 1775.85,1344.16 1778.2,1501.88 1780.55,1541.49 1782.9,1373 1785.25,1488.31 1787.6,1400.19 1789.96,1355.82 1792.31,1387.48 1794.66,1444.35 1797.01,1402.58 1799.36,1361.73 1801.71,1430.93 1804.06,1618.98 1806.41,1500.69 1808.76,1383.84 1811.11,1568.91 1813.46,1609.9 1815.81,1481.16 1818.16,1339.11 1820.51,1517.7 1822.86,1421.73 1825.21,1390.58 1827.56,1449.99 1829.91,1464.94 1832.26,1400.69 1834.61,1480.85 1836.96,1489.75 1839.32,1533.1 1841.67,1558.82 1844.02,1442.26 1846.37,1368.45 1848.72,1551.62 1851.07,1419.22 1853.42,1503.86 1855.77,1442.7 1858.12,1521.5 1860.47,1560.9 1862.82,1286.43 1865.17,1522.46 1867.52,1543.08 1869.87,1580.16 1872.22,1462.94 1874.57,1473.61 1876.92,1561.38 1879.27,1672.45 1881.62,1301.05 1883.97,1490.9 1886.32,1211.78 1888.68,1344.8 1891.03,1505.29 1893.38,1469.02 1895.73,1382.72 1898.08,1402.78 1900.43,1478.97 1902.78,1460.46 1905.13,1527.53 1907.48,1390.32 1909.83,1400.52 1912.18,1384.21 1914.53,1411.24 1916.88,1317.65 1919.23,1479.12 1921.58,1339.84 1923.93,1585.04 1926.28,1604.51 1928.63,1328.78 1930.98,1454.46 1933.33,1374.55 1935.68,1295.89 1938.04,1300.56 1940.39,1410.53 1942.74,1434.03 1945.09,1497.68 1947.44,1418.33 1949.79,1520.06 1952.14,1376.52 1954.49,1356.35 1956.84,1586.81 1959.19,1418.48 1961.54,1455.43 1963.89,1397.28 1966.24,1267.57 1968.59,1571.31 1970.94,1318.35 1973.29,1464.88 1975.64,1487.79 1977.99,1480.01 1980.34,1601.16 1982.69,1379.83 1985.04,1348.47 1987.4,1330.25 1989.75,1483.21 1992.1,1438.37 1994.45,1381.83 1996.8,1631.01 1999.15,1471.86 2001.5,1413.23 2003.85,1328.14 2006.2,1489.74 2008.55,1433.54 2010.9,1604.97 2013.25,1644.42 2015.6,1467.53 2017.95,1420.32 2020.3,1559.83 2022.65,1546.43 2025,1632.33 2027.35,1323.97 2029.7,1481.89 2032.05,1459.05 2034.4,1509.19 2036.76,1328.75 2039.11,1185.18 2041.46,1283.84 2043.81,1439.83 2046.16,1501.24 2048.51,1484.38 2050.86,1402.71 2053.21,1271.77 2055.56,1339.47 2057.91,1530.88 2060.26,1523.12 2062.61,1459.37 2064.96,1499.75 2067.31,1444.5 2069.66,1509.81 2072.01,1206.97 2074.36,1562.22 2076.71,1526.26 2079.06,1362.73 2081.41,1285.8 2083.76,1702.8 2086.11,1356.65 2088.47,1447.41 2090.82,1271.26 2093.17,1334.79 2095.52,1197.91 2097.87,1359.06 2100.22,1539.36 2102.57,1583.12 2104.92,1559.58 2107.27,1425.98 2109.62,1348.98 2111.97,1436.95 2114.32,1460.31 2116.67,1380.66 2119.02,1325.02 2121.37,1443.3 2123.72,1396.78 2126.07,1403.44 2128.42,1382.22 2130.77,1350.65 2133.12,1393.14 2135.47,1582.52 2137.83,1451.31 2140.18,1509.48 2142.53,1508.59 2144.88,1347.79 2147.23,1487.01 2149.58,1458.56 2151.93,1596.79 2154.28,1462.95 2156.63,1477.25 2158.98,1454.13 2161.33,1405.14 2163.68,1502.3 2166.03,1538.53 2168.38,1478.38 2170.73,1525.19 2173.08,1463.43 2175.43,1626.32 2177.78,1392.71 2180.13,1535.57 2182.48,1354.96 2184.83,1581.6 2187.19,1543.78 2189.54,1600.54 2191.89,1470.61 2194.24,1306.89 2196.59,1360.03 2198.94,1468.8 2201.29,1545.96 2203.64,1343.95 2205.99,1258.09 2208.34,1452.35 2210.69,1574.69 2213.04,1611.36 2215.39,1453.33 2217.74,1468.2 2220.09,1429.99 2222.44,1208.27 2224.79,1491.65 2227.14,1271.13 2229.49,1414.44 2231.84,1567.32 2234.19,1692.18 2236.55,1492.33 2238.9,1416.06 2241.25,1316.28 2243.6,1225.63 2245.95,1447.36 2248.3,1485.19 2250.65,1658.93 2253,1443.73 2255.35,1476.69 2257.7,1432.53 2260.05,1551.84 2262.4,1604.39 2264.75,1350.72 2267.1,1324.82 2269.45,1467.78 2271.8,1302.43 2274.15,1134.7 2276.5,1516.75 2278.85,1588.5 2281.2,1378.93 2283.55,1416.8 2285.91,1386.81 2288.26,1459.01 2290.61,1533.68 2292.96,1405.01 2295.31,1287.29 2297.66,1550.01 2300.01,1358.46 2302.36,1456.51 2304.71,1431.02 2307.06,1498.69 2309.41,1594.82 2311.76,1420.13 2314.11,1470.35 2316.46,1372.1 2318.81,1330.39 2321.16,1334.03 2323.51,1401.55 2325.86,1501.25 2328.21,1163.82 2330.56,1444.46 2332.91,1432.98 2335.27,1287.37 2337.62,1464.58 2339.97,1383.74 2342.32,1523.25 2344.67,1473.67 2347.02,1496.48 2349.37,1453.31 2351.72,1478.88 2354.07,1558.86 2356.42,1417.73 2358.77,1427.7 2361.12,1332.23 2363.47,1388.28 2365.82,1408.56 2368.17,1576.19 2370.52,1324.97 2372.87,1568.08 2375.22,1354.64 2377.57,1456.67 2379.92,1499.09 2382.27,1432.76 2384.62,1407.88 2386.98,1716.38 2389.33,1471.42 2391.68,1480.69 2394.03,1569.91 2396.38,1218.94 2398.73,1470.39 2401.08,1512.16 2403.43,1553.82 2405.78,1186.88 2408.13,1579.58 2410.48,1286.09 2412.83,1457.29 2415.18,1388.37 2417.53,1458.15 2419.88,1534.88 2422.23,1521.01 2424.58,1453.56 2426.93,1426.41 2429.28,1416.91 2431.63,1439.57 2433.98,1441.27 2436.34,1343.31 2438.69,1561.58 2441.04,1452.11 2443.39,1310.47 2445.74,1410.72 2448.09,1354.7 2450.44,1461.26 2452.79,1336.89 2455.14,1515.54 2457.49,1364.97 2459.84,1424.2 2462.19,1558.47 2464.54,1511.96 2466.89,1349.7 2469.24,1340 2471.59,1462.92 2473.94,1440.73 2476.29,1386.65 2478.64,1477.29 2480.99,1427.43 2483.34,1442.5 2485.7,1483.13 2488.05,1484.67 2490.4,1512.2 2492.75,1436.09 2495.1,1336.01 2497.45,1434.68 2499.8,1365.15 2502.15,1355.81 2504.5,1254.26 2506.85,1392.9 2509.2,1519.43 2511.55,1376.88 2513.9,1366.4 2516.25,1250.15 2518.6,1617.18 2520.95,1455.11 2523.3,1487.3 2525.65,1487.04 2528,1640.8 2530.35,1339.64 2532.7,1355.56 2535.06,1484.68 2537.41,1249.54 2539.76,1562.64 2542.11,1537.41 2544.46,1530.41 2546.81,1292.52 2549.16,1453.8 2551.51,1505.92 2553.86,1316.98 2556.21,1377.31 2558.56,1572.18 2560.91,1415.75 2563.26,1530.66 2565.61,1444.13 2567.96,1562.74 2570.31,1519.47 "></polyline>
<polyline clip-path="url(#clip782)" style="stroke:#e26f46; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,842.983 224.541,971.209 226.891,978.515 229.242,893.204 231.592,1035.01 233.943,833.334 236.293,970.807 238.644,897.455 240.994,999.035 243.345,904.349 245.695,1040.36 248.046,759.919 250.396,822.408 252.747,984.246 255.097,1069.38 257.448,1082.55 259.798,997.186 262.148,675.36 264.499,1041.19 266.849,1057.82 269.2,863.892 271.55,907.245 273.901,688.198 276.251,850.588 278.602,990.746 280.952,922.223 283.303,892.797 285.653,775.124 288.004,984.931 290.354,884.065 292.705,1030.25 295.055,826.034 297.406,878.753 299.756,702.458 302.107,951.955 304.457,831.329 306.807,971.245 309.158,970.983 311.508,936.069 313.859,906.399 316.209,1087.64 318.56,837.089 320.91,875.264 323.261,941.235 325.611,987.624 327.962,925.502 330.312,966.571 332.663,871.271 335.013,851.128 337.364,974.031 339.714,806.989 342.065,954.577 344.415,848.747 346.765,891.551 349.116,969.056 351.466,882.179 353.817,965.283 356.167,1009.3 358.518,779.524 360.868,872.468 363.219,832.98 365.569,1067.71 367.92,839.827 370.27,929.566 372.621,831.229 374.971,897.776 377.322,856.225 379.672,932.307 382.023,969.193 384.373,944.175 386.724,1022.64 389.074,874.697 391.424,875.391 393.775,829.115 396.125,817.204 398.476,818.125 400.826,1056.49 403.177,868.257 405.527,1097.83 407.878,1052.35 410.228,933.056 412.579,1034.21 414.929,795.501 417.28,934.352 419.63,869.308 421.981,935.756 424.331,927.316 426.682,912.971 429.032,917.289 431.382,971.654 433.733,1019.48 436.083,951.81 438.434,818.273 440.784,774.226 443.135,813.962 445.485,835.872 447.836,1079.46 450.186,714.521 452.537,905.667 454.887,778.506 457.238,916.3 459.588,895.344 461.939,771.455 464.289,870.038 466.64,1073.08 468.99,887.67 471.341,654.139 473.691,1036.99 476.041,833.452 478.392,843.473 480.742,1075.97 483.093,713.482 485.443,909.423 487.794,1052.84 490.144,1069.83 492.495,977.823 494.845,721.863 497.196,978.708 499.546,939.581 501.897,1016.35 504.247,867.826 506.598,864.624 508.948,871.764 511.299,1183.65 513.649,891.971 515.999,1046.33 518.35,936.382 520.7,1107.36 523.051,911.006 525.401,905.809 527.752,780.136 530.102,900.095 532.453,851.258 534.803,782.041 537.154,952.296 539.504,1035.87 541.855,794.579 544.205,993.415 546.556,869.87 548.906,731.75 551.257,896.434 553.607,1015.5 555.958,1051.04 558.308,907.435 560.658,1044.09 563.009,726.081 565.359,736.437 567.71,851.228 570.06,906.782 572.411,1054.11 574.761,805.451 577.112,1035.96 579.462,644.952 581.813,875.36 584.163,986.994 586.514,759.578 588.864,933.473 591.215,850.644 593.565,873.009 595.916,1093.77 598.266,1007.89 600.616,900.7 602.967,874.424 605.317,872.603 607.668,925.09 610.018,961.149 612.369,745.438 614.719,951.67 617.07,794.35 619.42,1021.84 621.771,887.815 624.121,860.945 626.472,709.338 628.822,924.522 631.173,905.969 633.523,1011.8 635.874,1054.23 638.224,999.549 640.575,968.929 642.925,891.113 645.275,747.764 647.626,799.269 649.976,1035.17 652.327,894.903 654.677,1049.1 657.028,904.035 659.378,1015.42 661.729,801.871 664.079,922.003 666.43,882.462 668.78,973.443 671.131,1019.8 673.481,1069.7 675.832,1016.6 678.182,752.812 680.533,1121.3 682.883,987.909 685.233,772.852 687.584,1029 689.934,869.847 692.285,880.287 694.635,860.604 696.986,1020.78 699.336,871.979 701.687,966.647 704.037,958.391 706.388,987.272 708.738,874.434 711.089,908.7 713.439,813.669 715.79,776.646 718.14,916.584 720.491,989.688 722.841,865.279 725.192,785.04 727.542,909.507 729.892,1003.23 732.243,923.617 734.593,1025.62 736.944,1022.33 739.294,821.793 741.645,974.657 743.995,924.072 746.346,864.188 748.696,874.593 751.047,1125.77 753.397,981.71 755.748,871.586 758.098,931.243 760.449,795.814 762.799,978.801 765.15,815.384 767.5,942.943 769.85,955.042 772.201,880.249 774.551,1018.03 776.902,859.972 779.252,799.963 781.603,947.135 783.953,974.168 786.304,1116.16 788.654,741.551 791.005,968.135 793.355,946.523 795.706,1058.97 798.056,908.811 800.407,970.865 802.757,957.625 805.108,895.141 807.458,840.619 809.809,1118.2 812.159,919.914 814.509,769.925 816.86,767.109 819.21,913.329 821.561,911.299 823.911,1039.2 826.262,969.174 828.612,910.293 830.963,1052.34 833.313,934.379 835.664,943.849 838.014,1066.22 840.365,936.926 842.715,699.047 845.066,823.523 847.416,925.668 849.767,770.995 852.117,715.238 854.467,944.504 856.818,788.022 859.168,1133.19 861.519,1012.26 863.869,890.506 866.22,1068.27 868.57,801.294 870.921,844.357 873.271,812.165 875.622,656.098 877.972,914.84 880.323,1055.81 882.673,770.408 885.024,857.946 887.374,911.207 889.725,1011.48 892.075,925.128 894.426,889.34 896.776,1029.99 899.126,1012.09 901.477,1211.27 903.827,934.101 906.178,1026.04 908.528,670.093 910.879,938.258 913.229,1131.58 915.58,972.348 917.93,767.064 920.281,777.85 922.631,890.154 924.982,881.023 927.332,923.822 929.683,916.533 932.033,719.475 934.384,892.519 936.734,968.321 939.084,847.92 941.435,878.419 943.785,994.61 946.136,732.852 948.486,814.14 950.837,990.841 953.187,895.825 955.538,863.723 957.888,827.988 960.239,963.566 962.589,1101.06 964.94,743.304 967.29,881.686 969.641,926.828 971.991,1078.11 974.342,871.786 976.692,974.057 979.043,964.121 981.393,900.19 983.743,1001.24 986.094,917.057 988.444,1001.6 990.795,1032.75 993.145,786.526 995.496,979.672 997.846,965.428 1000.2,732.867 1002.55,923.523 1004.9,763.014 1007.25,852.798 1009.6,934.383 1011.95,929.89 1014.3,969.504 1016.65,835.476 1019,898.739 1021.35,1209.01 1023.7,1026.47 1026.05,956.066 1028.4,991.761 1030.75,881.478 1033.1,858.454 1035.45,988.362 1037.8,843.567 1040.15,877.63 1042.51,1018.88 1044.86,943.963 1047.21,947.693 1049.56,906.964 1051.91,1029.33 1054.26,765.312 1056.61,909.312 1058.96,904.399 1061.31,1057.38 1063.66,939.8 1066.01,946.253 1068.36,1048.89 1070.71,1043.01 1073.06,1007.56 1075.41,985.265 1077.76,1016.44 1080.11,936.124 1082.46,928.644 1084.81,1047.4 1087.16,936.352 1089.51,870.38 1091.87,864.965 1094.22,842.51 1096.57,891.126 1098.92,972.977 1101.27,903.715 1103.62,922.814 1105.97,951.725 1108.32,947.136 1110.67,865.232 1113.02,855.467 1115.37,1034.79 1117.72,923.285 1120.07,865.559 1122.42,944.767 1124.77,830.401 1127.12,739.262 1129.47,882.738 1131.82,1046.29 1134.17,739.466 1136.52,1040.38 1138.87,1021.93 1141.23,917.06 1143.58,939.829 1145.93,1163.74 1148.28,1030.12 1150.63,987.587 1152.98,985.136 1155.33,982.644 1157.68,904.119 1160.03,866.841 1162.38,887.161 1164.73,848.488 1167.08,1054.97 1169.43,857.019 1171.78,841.479 1174.13,1042.82 1176.48,848.633 1178.83,861.791 1181.18,867.451 1183.53,858.647 1185.88,783.953 1188.23,1009.19 1190.59,678.29 1192.94,1003.91 1195.29,919.825 1197.64,1041.41 1199.99,1003.16 1202.34,933.095 1204.69,958.963 1207.04,1006.91 1209.39,894.695 1211.74,965.376 1214.09,746.122 1216.44,1131.95 1218.79,969.248 1221.14,1079.63 1223.49,1005.14 1225.84,730.532 1228.19,924.009 1230.54,868.012 1232.89,919.866 1235.24,1059.74 1237.59,978.656 1239.94,844.976 1242.3,919.687 1244.65,983.161 1247,933.158 1249.35,948.512 1251.7,961.427 1254.05,959.098 1256.4,779.776 1258.75,1032.41 1261.1,839.587 1263.45,1019.65 1265.8,1025.87 1268.15,932.857 1270.5,827.659 1272.85,930.904 1275.2,887.92 1277.55,998.944 1279.9,1049.56 1282.25,825.475 1284.6,753.847 1286.95,801.078 1289.3,843.831 1291.66,883.205 1294.01,867.39 1296.36,844.057 1298.71,935.131 1301.06,1027.41 1303.41,787.001 1305.76,842.93 1308.11,838.781 1310.46,822.944 1312.81,1000.97 1315.16,886.174 1317.51,1017.47 1319.86,785.372 1322.21,1105.81 1324.56,897.176 1326.91,929.869 1329.26,987.474 1331.61,814.578 1333.96,944.182 1336.31,1010.06 1338.66,651.272 1341.02,1042.82 1343.37,838.544 1345.72,998.011 1348.07,926.465 1350.42,826.602 1352.77,758.707 1355.12,801.341 1357.47,828.696 1359.82,1037.15 1362.17,799.581 1364.52,1068.12 1366.87,1052.96 1369.22,941.529 1371.57,756.821 1373.92,744.127 1376.27,793.912 1378.62,764.632 1380.97,918.892 1383.32,789.165 1385.67,865.136 1388.02,889.657 1390.38,963.889 1392.73,945.44 1395.08,1170.33 1397.43,926.771 1399.78,714.961 1402.13,722.27 1404.48,1032.16 1406.83,983.339 1409.18,887.813 1411.53,839.572 1413.88,911.709 1416.23,889.751 1418.58,703.152 1420.93,940.511 1423.28,1123.76 1425.63,911.313 1427.98,824.034 1430.33,737.923 1432.68,848.042 1435.03,831.564 1437.38,877.346 1439.74,1101.04 1442.09,827.25 1444.44,835.022 1446.79,982.699 1449.14,767.102 1451.49,832.8 1453.84,913.447 1456.19,981.155 1458.54,1060.58 1460.89,1023.25 1463.24,896.057 1465.59,1024.02 1467.94,930.132 1470.29,1009.56 1472.64,1016.3 1474.99,945.642 1477.34,1013.54 1479.69,887.179 1482.04,908.958 1484.39,1050.54 1486.74,1051.61 1489.1,881.268 1491.45,1145.69 1493.8,996.62 1496.15,983.452 1498.5,994.308 1500.85,861.233 1503.2,768.949 1505.55,976.947 1507.9,1059.03 1510.25,750.748 1512.6,881.984 1514.95,995.98 1517.3,1104.8 1519.65,918.263 1522,947.69 1524.35,977.9 1526.7,935.028 1529.05,855.824 1531.4,775.246 1533.75,922.063 1536.1,927.794 1538.45,886.569 1540.81,739.38 1543.16,1032.86 1545.51,981.953 1547.86,999.014 1550.21,1026.01 1552.56,981.985 1554.91,726.955 1557.26,959.515 1559.61,885.542 1561.96,828.977 1564.31,868.266 1566.66,828.601 1569.01,1148.19 1571.36,979.261 1573.71,1037.57 1576.06,917.709 1578.41,887.238 1580.76,876.967 1583.11,929.113 1585.46,1019.2 1587.81,1043.03 1590.17,917.14 1592.52,895.452 1594.87,913.192 1597.22,929.188 1599.57,1083.02 1601.92,958.986 1604.27,1080.3 1606.62,900.034 1608.97,966.345 1611.32,1168.69 1613.67,845.859 1616.02,861.39 1618.37,971.255 1620.72,870.987 1623.07,1019.24 1625.42,806.141 1627.77,906.321 1630.12,911.757 1632.47,866.164 1634.82,974.202 1637.17,1019.74 1639.53,868.837 1641.88,1058.82 1644.23,1129.18 1646.58,886.892 1648.93,1040.14 1651.28,1046.36 1653.63,969.825 1655.98,916.959 1658.33,1047.09 1660.68,882.425 1663.03,988.886 1665.38,918.915 1667.73,950.609 1670.08,962.482 1672.43,803.732 1674.78,873.633 1677.13,952.834 1679.48,1100.3 1681.83,1001.84 1684.18,1044.1 1686.53,949.7 1688.89,896.324 1691.24,873.184 1693.59,739.458 1695.94,949.645 1698.29,996.736 1700.64,905.803 1702.99,925.562 1705.34,816.762 1707.69,1067.73 1710.04,963.744 1712.39,1074.42 1714.74,959.144 1717.09,961.654 1719.44,1082.78 1721.79,783.811 1724.14,706.873 1726.49,709.84 1728.84,840.17 1731.19,763.548 1733.54,1096.1 1735.89,989.748 1738.25,970.046 1740.6,823.809 1742.95,1036.9 1745.3,994.434 1747.65,965.288 1750,1000.3 1752.35,944.058 1754.7,1026.4 1757.05,1135.32 1759.4,916.43 1761.75,676.933 1764.1,1043.04 1766.45,887.963 1768.8,1070.87 1771.15,932.302 1773.5,1124.86 1775.85,1107.59 1778.2,976.92 1780.55,957.074 1782.9,747.019 1785.25,924.85 1787.6,865.053 1789.96,942.902 1792.31,967.246 1794.66,1113.52 1797.01,750.499 1799.36,1047.64 1801.71,955.038 1804.06,782.736 1806.41,748.167 1808.76,835.86 1811.11,1069.28 1813.46,804.81 1815.81,1017.74 1818.16,1032.77 1820.51,923.861 1822.86,856.717 1825.21,936.717 1827.56,803.913 1829.91,817.971 1832.26,1049.09 1834.61,1028.51 1836.96,884.723 1839.32,840.337 1841.67,925.462 1844.02,940.541 1846.37,924.474 1848.72,901.582 1851.07,799.799 1853.42,902.111 1855.77,675.345 1858.12,981.64 1860.47,981.787 1862.82,873.685 1865.17,896.029 1867.52,753.934 1869.87,844.505 1872.22,888.39 1874.57,885.913 1876.92,833.168 1879.27,941.807 1881.62,1019.04 1883.97,866.843 1886.32,994.907 1888.68,1214.37 1891.03,1096.16 1893.38,853.285 1895.73,934.366 1898.08,848.292 1900.43,1069.55 1902.78,1000.31 1905.13,754.762 1907.48,846.607 1909.83,875.125 1912.18,935.991 1914.53,913.559 1916.88,767.954 1919.23,947.738 1921.58,850.009 1923.93,972.124 1926.28,855.314 1928.63,962.32 1930.98,922.296 1933.33,877.306 1935.68,1007.01 1938.04,824.39 1940.39,808.619 1942.74,972.977 1945.09,914.439 1947.44,974.928 1949.79,917.695 1952.14,954 1954.49,857.538 1956.84,820.708 1959.19,992.211 1961.54,866.095 1963.89,993.558 1966.24,956.37 1968.59,845.128 1970.94,902.343 1973.29,935.828 1975.64,1045.8 1977.99,908.232 1980.34,897.535 1982.69,982.753 1985.04,1234.63 1987.4,888.277 1989.75,857.131 1992.1,954.663 1994.45,761.174 1996.8,922.123 1999.15,893.546 2001.5,936.725 2003.85,934.594 2006.2,987.685 2008.55,885.304 2010.9,788.551 2013.25,808.094 2015.6,884.656 2017.95,1202.04 2020.3,848.741 2022.65,912.781 2025,826.545 2027.35,979.701 2029.7,847.391 2032.05,947.026 2034.4,1000.09 2036.76,783.002 2039.11,823.492 2041.46,832.645 2043.81,1067.63 2046.16,901.944 2048.51,939.87 2050.86,1031.46 2053.21,871.843 2055.56,981.581 2057.91,856.705 2060.26,983.091 2062.61,801.614 2064.96,984.221 2067.31,884.091 2069.66,848.024 2072.01,886.321 2074.36,897.465 2076.71,804.577 2079.06,1001.01 2081.41,924.546 2083.76,1069.43 2086.11,745.371 2088.47,940.578 2090.82,893.964 2093.17,906.308 2095.52,1009.93 2097.87,864.342 2100.22,893.204 2102.57,876.946 2104.92,1023.37 2107.27,893.67 2109.62,947.497 2111.97,846.183 2114.32,874.451 2116.67,971.568 2119.02,1096.04 2121.37,949.12 2123.72,1013.75 2126.07,1086.07 2128.42,792.014 2130.77,956.244 2133.12,933.93 2135.47,824.64 2137.83,926.771 2140.18,753.669 2142.53,1049.87 2144.88,634.466 2147.23,721.093 2149.58,912.839 2151.93,936.916 2154.28,903.627 2156.63,902.271 2158.98,884.542 2161.33,859.977 2163.68,882.107 2166.03,889.679 2168.38,992.653 2170.73,818.071 2173.08,971.45 2175.43,1038.71 2177.78,838.769 2180.13,908.8 2182.48,968.218 2184.83,918.708 2187.19,999.195 2189.54,1124.6 2191.89,865.716 2194.24,887.857 2196.59,726.482 2198.94,874.747 2201.29,841.859 2203.64,851.37 2205.99,978.718 2208.34,793.781 2210.69,900.829 2213.04,765.569 2215.39,1029.25 2217.74,1081.72 2220.09,834.758 2222.44,845.797 2224.79,897.29 2227.14,816.166 2229.49,954.602 2231.84,817.852 2234.19,800.188 2236.55,995.757 2238.9,1174.9 2241.25,985.111 2243.6,879.361 2245.95,936.606 2248.3,1072.23 2250.65,982.644 2253,987.706 2255.35,909.074 2257.7,1125.26 2260.05,874.273 2262.4,873.126 2264.75,777.685 2267.1,938.924 2269.45,790.692 2271.8,886.529 2274.15,1164.26 2276.5,1060.47 2278.85,903.147 2281.2,904.283 2283.55,975.391 2285.91,1059.93 2288.26,875.188 2290.61,851.531 2292.96,1126.44 2295.31,1102.96 2297.66,870.751 2300.01,814.151 2302.36,881.77 2304.71,1075.54 2307.06,932.098 2309.41,945.797 2311.76,918.096 2314.11,1021.72 2316.46,741.322 2318.81,921.056 2321.16,919.928 2323.51,966.878 2325.86,960.557 2328.21,807.65 2330.56,1016.3 2332.91,908.327 2335.27,1082.73 2337.62,777.284 2339.97,972.778 2342.32,1030 2344.67,1040.18 2347.02,886.774 2349.37,890.823 2351.72,939.671 2354.07,932.367 2356.42,871.717 2358.77,1019.69 2361.12,961.035 2363.47,953.216 2365.82,874.642 2368.17,1068.15 2370.52,847.029 2372.87,728.917 2375.22,705.873 2377.57,980.804 2379.92,962.114 2382.27,1060.37 2384.62,1002.63 2386.98,876.123 2389.33,977.717 2391.68,1000.04 2394.03,906.9 2396.38,910.576 2398.73,1032.53 2401.08,837.588 2403.43,939.546 2405.78,888.616 2408.13,799.886 2410.48,977.995 2412.83,907.899 2415.18,974.371 2417.53,1022.8 2419.88,927.426 2422.23,869.754 2424.58,938.906 2426.93,892.037 2429.28,1007.46 2431.63,804.718 2433.98,702.719 2436.34,977.399 2438.69,765.302 2441.04,1056.68 2443.39,1019.79 2445.74,727.013 2448.09,996.023 2450.44,854.034 2452.79,849.082 2455.14,972.987 2457.49,1046.35 2459.84,890.095 2462.19,991.73 2464.54,844.685 2466.89,632.748 2469.24,943.762 2471.59,892.543 2473.94,880.372 2476.29,948.507 2478.64,972.522 2480.99,863.351 2483.34,972.399 2485.7,988.171 2488.05,882.684 2490.4,844.324 2492.75,915.769 2495.1,729.278 2497.45,1008.35 2499.8,827.735 2502.15,891.914 2504.5,925.235 2506.85,1008.87 2509.2,947.174 2511.55,689.758 2513.9,987.707 2516.25,905.71 2518.6,816.265 2520.95,969.093 2523.3,788.111 2525.65,989.897 2528,991.783 2530.35,797.2 2532.7,954.414 2535.06,809.575 2537.41,874.766 2539.76,1022.47 2542.11,985.144 2544.46,745.767 2546.81,955.972 2549.16,802.175 2551.51,922.893 2553.86,915.382 2556.21,951.449 2558.56,908.849 2560.91,784.955 2563.26,748.767 2565.61,1044.24 2567.96,973.518 2570.31,1002.74 "></polyline>
<polyline clip-path="url(#clip782)" style="stroke:#3da44d; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,671.844 224.541,330.996 226.891,166.495 229.242,512.699 231.592,433.588 233.943,369.928 236.293,400.872 238.644,497.69 240.994,452.03 243.345,449.287 245.695,383.58 248.046,287.407 250.396,577.532 252.747,488.469 255.097,295.379 257.448,330.069 259.798,649.223 262.148,277.317 264.499,690.718 266.849,537.573 269.2,258.646 271.55,408.166 273.901,512.929 276.251,363.617 278.602,465.568 280.952,312.985 283.303,499.237 285.653,533.556 288.004,444.948 290.354,275.047 292.705,379.257 295.055,609.481 297.406,365.041 299.756,479.397 302.107,492.021 304.457,367.3 306.807,364.887 309.158,447.171 311.508,485.994 313.859,410.419 316.209,542.851 318.56,229.571 320.91,545.519 323.261,308.772 325.611,509.538 327.962,283.52 330.312,440.698 332.663,259.405 335.013,570.048 337.364,469.212 339.714,305.531 342.065,304.002 344.415,414.641 346.765,442.934 349.116,272.743 351.466,314.481 353.817,448.412 356.167,171.486 358.518,598.332 360.868,368.856 363.219,529.635 365.569,452.218 367.92,385.745 370.27,504.177 372.621,502.26 374.971,361.864 377.322,254.571 379.672,455.488 382.023,396.261 384.373,348.476 386.724,426.079 389.074,178.973 391.424,431.51 393.775,240.34 396.125,312.038 398.476,376.782 400.826,552.021 403.177,359.337 405.527,519.762 407.878,540.457 410.228,575.015 412.579,404.501 414.929,610.364 417.28,417.974 419.63,387.429 421.981,255.09 424.331,563.741 426.682,515.349 429.032,413.677 431.382,436.79 433.733,443.2 436.083,338.862 438.434,528.379 440.784,326.976 443.135,511.349 445.485,318.746 447.836,405.317 450.186,393.411 452.537,486.866 454.887,430.279 457.238,267.408 459.588,434.122 461.939,340.828 464.289,353.602 466.64,409.598 468.99,444.101 471.341,351.662 473.691,512.174 476.041,719.57 478.392,405.484 480.742,511.334 483.093,387.358 485.443,447.9 487.794,466.04 490.144,354.915 492.495,320.875 494.845,238.035 497.196,493.741 499.546,203.708 501.897,484.834 504.247,369.187 506.598,446.615 508.948,672.363 511.299,484.981 513.649,501.93 515.999,556.078 518.35,535.582 520.7,561.505 523.051,357.253 525.401,367.436 527.752,683.819 530.102,319.312 532.453,247.865 534.803,521.853 537.154,487.382 539.504,386.742 541.855,412.541 544.205,426.2 546.556,270.902 548.906,428.497 551.257,365.331 553.607,258.268 555.958,466.155 558.308,488.189 560.658,437.332 563.009,449.908 565.359,428.192 567.71,299.026 570.06,457.022 572.411,548.127 574.761,472.678 577.112,604.091 579.462,309.785 581.813,527.007 584.163,320.473 586.514,406.208 588.864,391.181 591.215,352.696 593.565,491.784 595.916,407.716 598.266,545.765 600.616,353.644 602.967,241.621 605.317,228.72 607.668,310.683 610.018,610.841 612.369,377.509 614.719,301.541 617.07,443.409 619.42,415.997 621.771,530.587 624.121,462.411 626.472,350.021 628.822,216.958 631.173,198.912 633.523,541.8 635.874,581.972 638.224,403.304 640.575,541.185 642.925,324.6 645.275,503.618 647.626,495.476 649.976,461.652 652.327,510.573 654.677,394.868 657.028,536.556 659.378,552.779 661.729,487.144 664.079,341.749 666.43,457.078 668.78,297.783 671.131,367.341 673.481,632.39 675.832,220.227 678.182,359.313 680.533,337.171 682.883,386.057 685.233,466.235 687.584,525.897 689.934,607.925 692.285,549.69 694.635,463.734 696.986,357.627 699.336,482.56 701.687,250.747 704.037,427.668 706.388,274.549 708.738,463.557 711.089,377.44 713.439,431.555 715.79,503.534 718.14,470.121 720.491,520.109 722.841,430.967 725.192,337.638 727.542,551.558 729.892,377.838 732.243,432.916 734.593,423.385 736.944,411.567 739.294,437.826 741.645,399.071 743.995,351.096 746.346,383.756 748.696,286.544 751.047,333.615 753.397,587.467 755.748,455.243 758.098,424.493 760.449,470.777 762.799,445.988 765.15,576.552 767.5,508.305 769.85,377.014 772.201,403.218 774.551,370.329 776.902,284.176 779.252,507.676 781.603,409.624 783.953,310.651 786.304,354.34 788.654,362.736 791.005,328.752 793.355,346.64 795.706,484.143 798.056,415.787 800.407,294.443 802.757,712.798 805.108,529.447 807.458,464.598 809.809,342.604 812.159,325.862 814.509,387.969 816.86,438.344 819.21,444.048 821.561,400.988 823.911,305.531 826.262,148.425 828.612,385.341 830.963,403.578 833.313,510.655 835.664,418.569 838.014,539.868 840.365,503.663 842.715,527.301 845.066,399.642 847.416,481.165 849.767,514.381 852.117,520.06 854.467,527.651 856.818,354.144 859.168,212.756 861.519,419.391 863.869,362.736 866.22,203.697 868.57,488.315 870.921,296.407 873.271,393.879 875.622,437.244 877.972,435.06 880.323,391.304 882.673,417.855 885.024,315.009 887.374,511.779 889.725,388.09 892.075,437.023 894.426,539.674 896.776,343.925 899.126,377.117 901.477,319.055 903.827,340.332 906.178,416.029 908.528,444.016 910.879,418.266 913.229,470.03 915.58,542.621 917.93,422.447 920.281,392.993 922.631,604.913 924.982,345.266 927.332,299.432 929.683,426.819 932.033,356.591 934.384,330.589 936.734,391.487 939.084,421.207 941.435,158.354 943.785,316.554 946.136,345.673 948.486,492.57 950.837,400.5 953.187,266.992 955.538,451.437 957.888,154.935 960.239,404.877 962.589,417.284 964.94,350.617 967.29,96.8724 969.641,431.284 971.991,344.138 974.342,606.078 976.692,422.624 979.043,472.565 981.393,282.971 983.743,389.389 986.094,484.131 988.444,443.981 990.795,516.1 993.145,488.722 995.496,366.812 997.846,374.392 1000.2,297.678 1002.55,308.254 1004.9,436.902 1007.25,456.122 1009.6,451.992 1011.95,441.067 1014.3,600.688 1016.65,427.24 1019,445.686 1021.35,465.277 1023.7,316.921 1026.05,350.574 1028.4,385.207 1030.75,419.501 1033.1,327.239 1035.45,414.886 1037.8,170.27 1040.15,419.833 1042.51,427.358 1044.86,164.079 1047.21,411.086 1049.56,476.035 1051.91,371.124 1054.26,505.772 1056.61,382.705 1058.96,432.112 1061.31,553.946 1063.66,570.486 1066.01,366.214 1068.36,535.219 1070.71,555.452 1073.06,401.396 1075.41,378.863 1077.76,340.324 1080.11,268.007 1082.46,327.424 1084.81,398.031 1087.16,373.197 1089.51,655.574 1091.87,453.474 1094.22,461.606 1096.57,450.026 1098.92,415.232 1101.27,453.636 1103.62,362.615 1105.97,388.479 1108.32,384.19 1110.67,437.17 1113.02,489.843 1115.37,480.427 1117.72,380.175 1120.07,290.217 1122.42,619.83 1124.77,541.94 1127.12,511.77 1129.47,371.217 1131.82,481.174 1134.17,346.132 1136.52,223.429 1138.87,463.726 1141.23,292.908 1143.58,409.569 1145.93,431.387 1148.28,364.57 1150.63,358.918 1152.98,573.489 1155.33,471.872 1157.68,451.004 1160.03,526.809 1162.38,541.593 1164.73,410.084 1167.08,252.875 1169.43,234.814 1171.78,329.174 1174.13,341.051 1176.48,562.375 1178.83,322.306 1181.18,475.503 1183.53,379.855 1185.88,471.459 1188.23,215.762 1190.59,270.643 1192.94,466.794 1195.29,528.318 1197.64,356.047 1199.99,216.223 1202.34,330.036 1204.69,408.671 1207.04,300.464 1209.39,458.325 1211.74,465.872 1214.09,467.899 1216.44,306.934 1218.79,363.429 1221.14,401.366 1223.49,489.438 1225.84,454.621 1228.19,326.761 1230.54,297.077 1232.89,503.784 1235.24,394.09 1237.59,671.435 1239.94,426.057 1242.3,329.947 1244.65,509.482 1247,368.256 1249.35,103.835 1251.7,469.939 1254.05,365.383 1256.4,382.379 1258.75,412.225 1261.1,284.035 1263.45,330.083 1265.8,392.711 1268.15,200.081 1270.5,280.468 1272.85,455.936 1275.2,603.843 1277.55,418.3 1279.9,310.757 1282.25,417.975 1284.6,392.407 1286.95,449.709 1289.3,476.605 1291.66,280.603 1294.01,407.145 1296.36,331.894 1298.71,332.744 1301.06,463.532 1303.41,388.163 1305.76,395.439 1308.11,341.925 1310.46,340.331 1312.81,357.073 1315.16,501.485 1317.51,339.33 1319.86,488.42 1322.21,312.93 1324.56,335.412 1326.91,374.787 1329.26,565.655 1331.61,679.542 1333.96,490.124 1336.31,437.287 1338.66,427.395 1341.02,443.116 1343.37,418.498 1345.72,337.091 1348.07,389.737 1350.42,534.279 1352.77,402.601 1355.12,417.074 1357.47,447.403 1359.82,479.078 1362.17,411.237 1364.52,460.046 1366.87,312.197 1369.22,453.843 1371.57,545.257 1373.92,494.393 1376.27,473.027 1378.62,357.428 1380.97,264.819 1383.32,443.615 1385.67,398.76 1388.02,497.254 1390.38,427.944 1392.73,567.361 1395.08,465.194 1397.43,713.153 1399.78,573.162 1402.13,376.579 1404.48,432.149 1406.83,329.282 1409.18,346.578 1411.53,588.649 1413.88,398.726 1416.23,346.838 1418.58,450.167 1420.93,376.642 1423.28,579.038 1425.63,511.728 1427.98,500.893 1430.33,438.637 1432.68,441.393 1435.03,397.258 1437.38,296.464 1439.74,428.211 1442.09,504.979 1444.44,502.829 1446.79,472.884 1449.14,172.341 1451.49,380.338 1453.84,406.265 1456.19,352.844 1458.54,179.669 1460.89,567.521 1463.24,586.948 1465.59,596.627 1467.94,207.105 1470.29,376.479 1472.64,465.77 1474.99,587.539 1477.34,473.82 1479.69,102.021 1482.04,438.071 1484.39,236.338 1486.74,337.494 1489.1,470.136 1491.45,425.209 1493.8,556.865 1496.15,281.372 1498.5,330.286 1500.85,430.139 1503.2,367.073 1505.55,333.678 1507.9,360.373 1510.25,486.193 1512.6,435.499 1514.95,481.016 1517.3,548.026 1519.65,564.009 1522,511.037 1524.35,341.406 1526.7,531.149 1529.05,513.671 1531.4,501.735 1533.75,430.922 1536.1,435.725 1538.45,354.887 1540.81,395.906 1543.16,357.951 1545.51,407.968 1547.86,372.23 1550.21,258.411 1552.56,344.406 1554.91,286.884 1557.26,518.366 1559.61,516.925 1561.96,363.756 1564.31,368.962 1566.66,453.064 1569.01,455.339 1571.36,261.387 1573.71,344.508 1576.06,404.103 1578.41,285.621 1580.76,311.872 1583.11,425.661 1585.46,554.074 1587.81,511.59 1590.17,231.282 1592.52,433.784 1594.87,447.8 1597.22,222.674 1599.57,489.867 1601.92,268.886 1604.27,380.4 1606.62,338.193 1608.97,434.743 1611.32,395.961 1613.67,493.734 1616.02,440.389 1618.37,498.175 1620.72,399.586 1623.07,679.74 1625.42,236.505 1627.77,407.767 1630.12,626.941 1632.47,312.159 1634.82,415.95 1637.17,419.479 1639.53,439.402 1641.88,462.626 1644.23,538.479 1646.58,444.975 1648.93,542.303 1651.28,511.204 1653.63,399.561 1655.98,408.128 1658.33,284.379 1660.68,420.931 1663.03,480.006 1665.38,441.147 1667.73,474.265 1670.08,414.869 1672.43,376.158 1674.78,448.765 1677.13,443.542 1679.48,489.954 1681.83,661.777 1684.18,410.793 1686.53,521.302 1688.89,397.297 1691.24,272.5 1693.59,717.87 1695.94,499.798 1698.29,250.597 1700.64,451.881 1702.99,430.986 1705.34,341.254 1707.69,311.347 1710.04,411.99 1712.39,302.036 1714.74,342.356 1717.09,534.301 1719.44,371.699 1721.79,435.188 1724.14,333.648 1726.49,662.368 1728.84,330.732 1731.19,458.627 1733.54,464.996 1735.89,368.133 1738.25,529.479 1740.6,196.523 1742.95,218.726 1745.3,429.55 1747.65,418.514 1750,248.35 1752.35,392.129 1754.7,428.507 1757.05,341.207 1759.4,459.062 1761.75,507.54 1764.1,298.023 1766.45,320.853 1768.8,438.778 1771.15,376.968 1773.5,439.254 1775.85,439.668 1778.2,503.418 1780.55,513.067 1782.9,303.062 1785.25,408.092 1787.6,336.236 1789.96,277.576 1792.31,287.828 1794.66,470.431 1797.01,371.61 1799.36,384.863 1801.71,468.043 1804.06,452.344 1806.41,379.959 1808.76,567.186 1811.11,289.421 1813.46,390.121 1815.81,358.031 1818.16,431.63 1820.51,475.42 1822.86,516.064 1825.21,373.801 1827.56,509.166 1829.91,498.919 1832.26,312.754 1834.61,356.152 1836.96,210.727 1839.32,441.874 1841.67,329.99 1844.02,506.611 1846.37,316.488 1848.72,331.505 1851.07,370.031 1853.42,452.673 1855.77,414.645 1858.12,354.542 1860.47,367.012 1862.82,424.589 1865.17,517.421 1867.52,451.694 1869.87,441.365 1872.22,369.616 1874.57,500.102 1876.92,415.324 1879.27,395.6 1881.62,541.626 1883.97,267.434 1886.32,548.398 1888.68,294.608 1891.03,371.329 1893.38,415.432 1895.73,332.832 1898.08,615.958 1900.43,348.076 1902.78,307.178 1905.13,496.771 1907.48,393.047 1909.83,190.814 1912.18,477.817 1914.53,328.642 1916.88,220.116 1919.23,281.791 1921.58,295.97 1923.93,496.6 1926.28,443.466 1928.63,304.168 1930.98,477.936 1933.33,419.96 1935.68,537.079 1938.04,420.042 1940.39,391.745 1942.74,458.087 1945.09,333.786 1947.44,355.297 1949.79,428.955 1952.14,498.86 1954.49,490.987 1956.84,445.255 1959.19,531.105 1961.54,561.93 1963.89,324.496 1966.24,549.368 1968.59,464.445 1970.94,575.091 1973.29,243.984 1975.64,486.597 1977.99,585.711 1980.34,397.825 1982.69,445.87 1985.04,401.808 1987.4,283.664 1989.75,363.274 1992.1,286.984 1994.45,340.859 1996.8,386.91 1999.15,345.72 2001.5,417.72 2003.85,393.669 2006.2,527.8 2008.55,330.475 2010.9,477.113 2013.25,424.569 2015.6,432.993 2017.95,584.158 2020.3,444.551 2022.65,418.274 2025,447.189 2027.35,331.707 2029.7,423.435 2032.05,419.423 2034.4,512.092 2036.76,318.096 2039.11,508.136 2041.46,512.901 2043.81,386.683 2046.16,514.253 2048.51,551.314 2050.86,462.602 2053.21,476.764 2055.56,548.595 2057.91,619.44 2060.26,391.125 2062.61,304.316 2064.96,371.766 2067.31,524.559 2069.66,602.536 2072.01,378.882 2074.36,541.204 2076.71,297.365 2079.06,306.998 2081.41,507.809 2083.76,415.515 2086.11,422.317 2088.47,526.496 2090.82,154.834 2093.17,382.221 2095.52,339.982 2097.87,275.81 2100.22,351.967 2102.57,453.809 2104.92,277.413 2107.27,464.469 2109.62,619.874 2111.97,474.8 2114.32,499.068 2116.67,375.469 2119.02,408.284 2121.37,476.05 2123.72,442.701 2126.07,403.992 2128.42,140.251 2130.77,609.29 2133.12,534.432 2135.47,352.21 2137.83,391.816 2140.18,429.822 2142.53,360.665 2144.88,651.657 2147.23,399.436 2149.58,289.907 2151.93,307.904 2154.28,283.281 2156.63,514.071 2158.98,410.226 2161.33,442.699 2163.68,620.417 2166.03,336.356 2168.38,480.356 2170.73,574.244 2173.08,639.718 2175.43,348.046 2177.78,326.535 2180.13,346.711 2182.48,289.852 2184.83,432.981 2187.19,383.415 2189.54,284.239 2191.89,459.174 2194.24,367.234 2196.59,320.552 2198.94,455.486 2201.29,486.255 2203.64,551.492 2205.99,399.355 2208.34,423.523 2210.69,455.889 2213.04,446.65 2215.39,375.339 2217.74,338.01 2220.09,376.306 2222.44,421.456 2224.79,397.135 2227.14,336.974 2229.49,362.646 2231.84,392.142 2234.19,371.504 2236.55,288.344 2238.9,304.633 2241.25,544.34 2243.6,287.269 2245.95,433.55 2248.3,357.506 2250.65,342.226 2253,450.263 2255.35,332.269 2257.7,669.638 2260.05,634.2 2262.4,539.787 2264.75,411.269 2267.1,513.983 2269.45,488.062 2271.8,465.127 2274.15,343.322 2276.5,302.533 2278.85,556.829 2281.2,567.875 2283.55,397.738 2285.91,388.92 2288.26,382.641 2290.61,406.004 2292.96,354.136 2295.31,352.812 2297.66,410.658 2300.01,325.35 2302.36,530.124 2304.71,534.837 2307.06,389.108 2309.41,556.318 2311.76,449.504 2314.11,515.085 2316.46,296.757 2318.81,343.152 2321.16,367.865 2323.51,400.079 2325.86,250.985 2328.21,367.337 2330.56,506.214 2332.91,571.055 2335.27,529.264 2337.62,533.43 2339.97,222.735 2342.32,609.204 2344.67,445.624 2347.02,492.506 2349.37,302.433 2351.72,502.831 2354.07,410.737 2356.42,198.843 2358.77,431.312 2361.12,309.139 2363.47,192.121 2365.82,427.977 2368.17,291.433 2370.52,502.087 2372.87,403.937 2375.22,343.808 2377.57,481.906 2379.92,393.631 2382.27,174.657 2384.62,332.619 2386.98,605.128 2389.33,483.967 2391.68,310.644 2394.03,471.981 2396.38,571.864 2398.73,264.231 2401.08,390.688 2403.43,492.903 2405.78,342.932 2408.13,493.649 2410.48,210.535 2412.83,448.192 2415.18,404.912 2417.53,354.797 2419.88,580.552 2422.23,497.197 2424.58,607.411 2426.93,310.123 2429.28,317.41 2431.63,456.271 2433.98,405.892 2436.34,296.017 2438.69,439.896 2441.04,338.758 2443.39,408.231 2445.74,353.23 2448.09,365.81 2450.44,355.951 2452.79,270.896 2455.14,491.314 2457.49,283.717 2459.84,493.023 2462.19,379.591 2464.54,521.223 2466.89,422.534 2469.24,343.749 2471.59,520.547 2473.94,233.484 2476.29,349.482 2478.64,359.14 2480.99,501.696 2483.34,423.499 2485.7,427.226 2488.05,517.233 2490.4,295.836 2492.75,167.894 2495.1,514.85 2497.45,574.406 2499.8,242.051 2502.15,261.325 2504.5,354.394 2506.85,439.874 2509.2,322.643 2511.55,331.693 2513.9,323.948 2516.25,379.017 2518.6,423.889 2520.95,485.671 2523.3,397.798 2525.65,241.722 2528,220.939 2530.35,184.55 2532.7,538.268 2535.06,411.362 2537.41,300.331 2539.76,514.676 2542.11,273.917 2544.46,385.903 2546.81,356.984 2549.16,465.578 2551.51,375.249 2553.86,382.769 2556.21,224.498 2558.56,395.754 2560.91,470.705 2563.26,529.484 2565.61,214.163 2567.96,417.618 2570.31,339.79 "></polyline>
</svg>
</div>
</div>
<p>Look at that! Things are working; amazin’.</p>
<p>We can also exploit <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>’s parallel sampling capabilities:</p>
<div id="34" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run separate 4 chains for 10 000 iterations using threads to parallelize.</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>num_chains <span class="op">=</span> <span class="fl">4</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    model_with_grad,</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">MCMCThreads</span>(),</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>,</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    num_chains;</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Note we need to provide an initial state for every chain.</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>    initial_state<span class="op">=</span><span class="fu">fill</span>(state, num_chains),</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>samples_array <span class="op">=</span> <span class="fu">stack</span>(<span class="fu">map</span>(<span class="bu">Base</span>.<span class="fu">Fix1</span>(stack, sample <span class="op">-&gt;</span> sample.x), samples))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000×4 Array{Float64, 3}:
[:, :, 1] =
 -0.818246  -2.8578    -3.60081   -4.13363   …  -4.81205  -6.54784  -5.70442
  0.124629   0.461006  -0.303345  -0.919378      1.9949    0.52488  -0.73463
  2.23473    1.89568    5.35892    5.37493       2.22677   4.17403   5.47231

[:, :, 2] =
 -3.24613   -3.80049   -3.49278    …  -5.92699   -4.7534   -5.60753
 -0.596419   0.873842  -0.0518204     -0.996466  -2.51199  -0.915322
  5.60703    6.78188    4.99943        3.51144    4.11717   3.90729

[:, :, 3] =
 -3.41475   -4.58518   -5.19103  -4.95403  …  -4.48299   -4.48299   -6.39414
 -0.793532  -0.171085  -1.28973  -1.54949     -0.802821  -0.802821  -1.24755
  2.52712    3.56821    4.21211   5.12961      3.05681    3.05681    4.25144

[:, :, 4] =
 -1.77827   -4.68405  -4.68405  -4.68405  …  -5.08742   -4.84527  -5.98175
  0.543802   1.08107   1.08107   1.08107     -0.444264  -1.79343   0.737915
  1.15352    4.59211   4.59211   4.59211      4.26259    4.92901   5.87408</code></pre>
</div>
</div>
<p>But the fact that we have to provide the <code>AbstractMCMC.sample</code> call, etc. with an <code>initial_state</code> to get started is a bit annoying. We can avoid this by also defining a <code>AbstractMCMC.step</code> <em>without</em> the <code>state</code> argument:</p>
<div id="36" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">::</span><span class="dt">MALA</span>;</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># </span><span class="al">NOTE</span><span class="co">: No state provided!</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just create the initial state by sampling using  a Gaussian.</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="fu">randn</span>(rng, LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(x), <span class="fu">MALAState</span>(x)</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Equipped with this, we no longer need to provide the <code>initial_state</code> everywhere:</p>
<div id="38" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -4.99401    0.998157
 -0.0602257  0.983866
  5.00643    0.99564</code></pre>
</div>
</div>
</section>
<section id="using-our-sampler-with-turing.jl" class="level2">
<h2 class="anchored" data-anchor-id="using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</h2>
<p>As we promised, all of this hassle of implementing our <code>MALA</code> sampler in a way that uses <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> and <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> gets us something more than <em>just</em> an “automatic” implementation of <code>AbstractMCMC.sample</code>.</p>
<p>It also enables use with Turing.jl through the <code>externalsampler</code>, but we need to do one final thing first: we need to tell Turing.jl how to extract a vector of parameters from the “sample” returned in our implementation of <code>AbstractMCMC.step</code>. In our case, the “sample” is a <code>MALASample</code>, so we just need the following line:</p>
<div id="40" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Turing</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">DynamicPPL</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Overload the `getparams` method for our "sample" type, which is just a vector.</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>Turing.Inference.<span class="fu">getparams</span>(<span class="op">::</span><span class="dt">DynamicPPL.Model</span>, sample<span class="op">::</span><span class="dt">MALASample</span>) <span class="op">=</span> sample.x</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And with that, we’re good to go!</p>
<div id="42" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Our previous model defined as a Turing.jl model.</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">mvnormal_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">MvNormal</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.], I)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate our model.</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">mvnormal_model</span>()</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Call `sample` but now we're passing in a Turing.jl `model` and wrapping</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co"># our `MALA` sampler in the `externalsampler` to tell Turing.jl that the sampler</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co"># expects something that implements LogDensityProblems.jl.</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×4×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 3.28 seconds
Compute duration  = 3.28 seconds
parameters        = x[1], x[2], x[3]
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters  </span><span class="ansi-bold">    mean  </span><span class="ansi-bold">     std  </span><span class="ansi-bold">    mcse  </span><span class="ansi-bold">  ess_bulk  </span><span class="ansi-bold">  ess_tail  </span><span class="ansi-bold">    rhat  </span><span class="ansi-bold"> ⋯
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">   Float64  </span><span class="ansi-bright-black-fg ansi-bold">   Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> ⋯

        x[1]   -4.9712    1.0017    0.0177   3182.7211   5389.2716    1.0001   ⋯
        x[2]   -0.0216    1.0076    0.0180   3126.0227   4967.9609    0.9999   ⋯
        x[3]    5.0074    1.0066    0.0178   3193.9168   5222.3459    1.0000   ⋯
</span><span class="ansi-cyan-fg ansi-bold">                                                                1 column omitted

Quantiles
 </span><span class="ansi-cyan-fg ansi-bold"> parameters  </span><span class="ansi-cyan-fg ansi-bold">    2.5%  </span><span class="ansi-cyan-fg ansi-bold">   25.0%  </span><span class="ansi-cyan-fg ansi-bold">   50.0%  </span><span class="ansi-cyan-fg ansi-bold">   75.0%  </span><span class="ansi-cyan-fg ansi-bold">   97.5%
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64

        x[1]   -6.8890   -5.6398   -4.9932   -4.3012   -2.9803
        x[2]   -2.0244   -0.7004   -0.0171    0.6614    1.9527
        x[3]    3.0803    4.3283    5.0150    5.6723    7.0166
</span></pre>
</div>
</div>
</div>
<p>Pretty neat, eh?</p>
<section id="models-with-constrained-parameters" class="level3">
<h3 class="anchored" data-anchor-id="models-with-constrained-parameters">Models with constrained parameters</h3>
<p>One thing we’ve sort of glossed over in all of the above is that MALA, at least how we’ve implemented it, requires <span class="math inline">\(x\)</span> to live in <span class="math inline">\(\mathbb{R}^d\)</span> for some <span class="math inline">\(d &gt; 0\)</span>. If some of the parameters were in fact constrained, e.g.&nbsp;we were working with a <code>Beta</code> distribution which has support on the interval <span class="math inline">\((0, 1)\)</span>, <em>not</em> on <span class="math inline">\(\mathbb{R}^d\)</span>, we could easily end up outside of the valid range <span class="math inline">\((0, 1)\)</span>.</p>
<div id="44" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">beta_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">beta_model</span>()</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 1.94 seconds
Compute duration  = 1.94 seconds
parameters        = x
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters  </span><span class="ansi-bold">    mean  </span><span class="ansi-bold">     std  </span><span class="ansi-bold">    mcse  </span><span class="ansi-bold">  ess_bulk  </span><span class="ansi-bold">  ess_tail  </span><span class="ansi-bold">    rhat  </span><span class="ansi-bold"> ⋯
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">   Float64  </span><span class="ansi-bright-black-fg ansi-bold">   Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> ⋯

           x    0.4939    0.1892    0.0028   4574.9621   5634.4522    0.9999   ⋯
</span><span class="ansi-cyan-fg ansi-bold">                                                                1 column omitted

Quantiles
 </span><span class="ansi-cyan-fg ansi-bold"> parameters  </span><span class="ansi-cyan-fg ansi-bold">    2.5%  </span><span class="ansi-cyan-fg ansi-bold">   25.0%  </span><span class="ansi-cyan-fg ansi-bold">   50.0%  </span><span class="ansi-cyan-fg ansi-bold">   75.0%  </span><span class="ansi-cyan-fg ansi-bold">   97.5%
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64

           x    0.1374    0.3527    0.4907    0.6357    0.8436
</span></pre>
</div>
</div>
</div>
<p>Yep, that still works, but only because Turing.jl actually <em>transforms</em> the <code>turing_model</code> from constrained to unconstrained, so that the <code>sampler</code> provided to <code>externalsampler</code> is actually always working in unconstrained space! This is not always desirable, so we can turn this off:</p>
<div id="46" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 0.17 seconds
Compute duration  = 0.17 seconds
parameters        = x
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters  </span><span class="ansi-bold">    mean  </span><span class="ansi-bold">     std  </span><span class="ansi-bold">    mcse  </span><span class="ansi-bold">  ess_bulk  </span><span class="ansi-bold"> ess_tail  </span><span class="ansi-bold">    rhat  </span><span class="ansi-bold">  ⋯
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">   Float64  </span><span class="ansi-bright-black-fg ansi-bold">  Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">  ⋯

           x    0.9751    0.0448    0.0009   2332.6010        NaN    1.0003    ⋯
</span><span class="ansi-cyan-fg ansi-bold">                                                                1 column omitted

Quantiles
 </span><span class="ansi-cyan-fg ansi-bold"> parameters  </span><span class="ansi-cyan-fg ansi-bold">    2.5%  </span><span class="ansi-cyan-fg ansi-bold">   25.0%  </span><span class="ansi-cyan-fg ansi-bold">   50.0%  </span><span class="ansi-cyan-fg ansi-bold">   75.0%  </span><span class="ansi-cyan-fg ansi-bold">   97.5%
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64

           x    0.9760    0.9760    0.9760    0.9760    0.9760
</span></pre>
</div>
</div>
</div>
<p>The fun thing is that this still sort of works because</p>
<div id="48" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">logpdf</span>(<span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>), <span class="fl">10.0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-Inf</code></pre>
</div>
</div>
<p>and so the samples that fall outside of the range are always rejected. But do notice how much worse all the diagnostics are, e.g.&nbsp;<code>ess_tail</code> is very poor compared to when we use <code>unconstrained=true</code>. Moreover, in more complex cases this won’t just result in a “nice” <code>-Inf</code> log-density value, but instead will error:</p>
<div id="50" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="kw">function</span> <span class="fu">demo</span>()</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>    σ² <span class="op">~</span> <span class="fu">truncated</span>(<span class="fu">Normal</span>(), lower<span class="op">=</span><span class="fl">0</span>)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If we end up with negative values for `σ²`, the `Normal` will error.</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>    x <span class="op">~</span> <span class="fu">Normal</span>(<span class="fl">0</span>, σ²)</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre>DomainError with -0.3032439635270801:
Normal: the condition σ &gt;= zero(σ) is not satisfied.
Stacktrace:
  [1] <span class="ansi-bold">#371</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/YQSrn/src/univariate/continuous/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">normal.jl:37</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [2] <span class="ansi-bold">check_args</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/YQSrn/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">utils.jl:89</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [3] <span class="ansi-bold">#Normal#370</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/YQSrn/src/univariate/continuous/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">normal.jl:37</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [4] <span class="ansi-bold">Normal</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/YQSrn/src/univariate/continuous/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">normal.jl:36</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [5] <span class="ansi-bold">Normal</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/YQSrn/src/univariate/continuous/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">normal.jl:42</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [6] <span class="ansi-bold">macro expansion</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/I9lST/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">compiler.jl:558</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [7] <span class="ansi-bold">demo</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">__model__</span>::Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DefaultContext}</span>, <span class="ansi-bright-black-fg">__varinfo__</span>::DynamicPPL.ThreadSafeVarInfo<span class="ansi-bright-black-fg">{VarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}, Vector{Base.RefValue{Float64}}}</span>, <span class="ansi-bright-black-fg">__context__</span>::DynamicPPL.ValuesAsInModelContext<span class="ansi-bright-black-fg">{DefaultContext}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-magenta-fg">Main.Notebook</span> <span class="ansi-bright-black-fg">~/work/docs/docs/developers/inference/implementing-samplers/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">index.qmd:457</span>
  [8] <span class="ansi-bold">_evaluate!!</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/I9lST/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">model.jl:913</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [9] <span class="ansi-bold">evaluate_threadsafe!!</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">model</span>::Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DefaultContext}</span>, <span class="ansi-bright-black-fg">varinfo</span>::VarInfo<span class="ansi-bright-black-fg">{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}</span>, <span class="ansi-bright-black-fg">context</span>::DynamicPPL.ValuesAsInModelContext<span class="ansi-bright-black-fg">{DefaultContext}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-cyan-fg">DynamicPPL</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/I9lST/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">model.jl:902</span>
 [10] <span class="ansi-bold">evaluate!!</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/I9lST/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">model.jl:832</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [11] <span class="ansi-bold">values_as_in_model</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/I9lST/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">values_as_in_model.jl:173</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [12] <span class="ansi-bold">values_as_in_model</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/I9lST/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">values_as_in_model.jl:172</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [13] <span class="ansi-bold">getparams</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">model</span>::Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DefaultContext}</span>, <span class="ansi-bright-black-fg">vi</span>::VarInfo<span class="ansi-bright-black-fg">{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-green-fg">Turing.Inference</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/1Egt9/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">Inference.jl:176</span>
 [14] <span class="ansi-bold">Turing.Inference.Transition</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">model</span>::Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DefaultContext}</span>, <span class="ansi-bright-black-fg">vi</span>::VarInfo<span class="ansi-bright-black-fg">{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}</span>, <span class="ansi-bright-black-fg">t</span>::MALASample<span class="ansi-bright-black-fg">{Vector{Float64}}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-green-fg">Turing.Inference</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/1Egt9/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">Inference.jl:138</span>
 [15] <span class="ansi-bold">transition_to_turing</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">f</span>::LogDensityFunction<span class="ansi-bright-black-fg">{Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DefaultContext}, VarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}, DefaultContext, AutoForwardDiff{2, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}}}</span>, <span class="ansi-bright-black-fg">transition</span>::MALASample<span class="ansi-bright-black-fg">{Vector{Float64}}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-green-fg">Turing.Inference</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/1Egt9/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">external_sampler.jl:80</span>
 [16] <span class="ansi-bold">step</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">rng</span>::TaskLocalRNG, <span class="ansi-bright-black-fg">model</span>::Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DefaultContext}</span>, <span class="ansi-bright-black-fg">sampler_wrapper</span>::Sampler<span class="ansi-bright-black-fg">{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}</span>; <span class="ansi-bright-black-fg">initial_state</span>::Nothing, <span class="ansi-bright-black-fg">initial_params</span>::Nothing, <span class="ansi-bright-black-fg">kwargs</span>::@Kwargs<span class="ansi-bright-black-fg">{}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-green-fg">Turing.Inference</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/1Egt9/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">external_sampler.jl:145</span>
 [17] <span class="ansi-bold">macro expansion</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/AbstractMCMC/kwj9g/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">sample.jl:0</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [18] <span class="ansi-bold">macro expansion</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/AbstractMCMC/kwj9g/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">logging.jl:16</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [19] <span class="ansi-bold">mcmcsample</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">rng</span>::TaskLocalRNG, <span class="ansi-bright-black-fg">model</span>::Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DefaultContext}</span>, <span class="ansi-bright-black-fg">sampler</span>::Sampler<span class="ansi-bright-black-fg">{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}</span>, <span class="ansi-bright-black-fg">N</span>::Int64; <span class="ansi-bright-black-fg">progress</span>::Bool, <span class="ansi-bright-black-fg">progressname</span>::String, <span class="ansi-bright-black-fg">callback</span>::Nothing, <span class="ansi-bright-black-fg">num_warmup</span>::Int64, <span class="ansi-bright-black-fg">discard_initial</span>::Int64, <span class="ansi-bright-black-fg">thinning</span>::Int64, <span class="ansi-bright-black-fg">chain_type</span>::Type, <span class="ansi-bright-black-fg">initial_state</span>::Nothing, <span class="ansi-bright-black-fg">kwargs</span>::@Kwargs<span class="ansi-bright-black-fg">{}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-yellow-fg">AbstractMCMC</span> <span class="ansi-bright-black-fg">~/.julia/packages/AbstractMCMC/kwj9g/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">sample.jl:144</span>
 [20] <span class="ansi-bold">sample</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">rng</span>::TaskLocalRNG, <span class="ansi-bright-black-fg">model</span>::Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DefaultContext}</span>, <span class="ansi-bright-black-fg">sampler</span>::Sampler<span class="ansi-bright-black-fg">{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}</span>, <span class="ansi-bright-black-fg">N</span>::Int64; <span class="ansi-bright-black-fg">chain_type</span>::Type, <span class="ansi-bright-black-fg">resume_from</span>::Nothing, <span class="ansi-bright-black-fg">initial_state</span>::Nothing, <span class="ansi-bright-black-fg">kwargs</span>::@Kwargs<span class="ansi-bright-black-fg">{progress::Bool}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-cyan-fg">DynamicPPL</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/I9lST/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">sampler.jl:102</span>
 [21] <span class="ansi-bold">sample</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/I9lST/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">sampler.jl:92</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [22] <span class="ansi-bold">#sample#101</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/1Egt9/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">abstractmcmc.jl:29</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [23] <span class="ansi-bold">sample</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/1Egt9/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">abstractmcmc.jl:20</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [24] <span class="ansi-bold">#sample#100</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/1Egt9/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">abstractmcmc.jl:17</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [25] top-level scope
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/work/docs/docs/developers/inference/implementing-samplers/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">index.qmd:459</span></pre>
</div>
</div>
</div>
<p>As expected, we run into a <code>DomainError</code> at some point, while if we set <code>unconstrained=true</code>, letting Turing.jl transform the model to a unconstrained form behind the scenes, everything works as expected:</p>
<div id="52" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 2.14 seconds
Compute duration  = 2.14 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters  </span><span class="ansi-bold">    mean  </span><span class="ansi-bold">     std  </span><span class="ansi-bold">    mcse  </span><span class="ansi-bold"> ess_bulk  </span><span class="ansi-bold"> ess_tail  </span><span class="ansi-bold">    rhat  </span><span class="ansi-bold"> e ⋯
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">  Float64  </span><span class="ansi-bright-black-fg ansi-bold">  Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">   ⋯

          σ²    0.5155    0.5642    0.1023    24.7190    20.5178    2.0389     ⋯
           x    0.0034    0.6956    0.0321   609.4914   133.6018    2.0207     ⋯
</span><span class="ansi-cyan-fg ansi-bold">                                                                1 column omitted

Quantiles
 </span><span class="ansi-cyan-fg ansi-bold"> parameters  </span><span class="ansi-cyan-fg ansi-bold">    2.5%  </span><span class="ansi-cyan-fg ansi-bold">   25.0%  </span><span class="ansi-cyan-fg ansi-bold">   50.0%  </span><span class="ansi-cyan-fg ansi-bold">   75.0%  </span><span class="ansi-cyan-fg ansi-bold">   97.5%
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64

          σ²    0.0698    0.0698    0.2524    0.8331    1.9332
           x   -1.7561   -0.0476    0.0348    0.0669    1.7670
</span></pre>
</div>
</div>
</div>
<p>Neat!</p>
<p>Similarly, which automatic differentiation backend one should use can be specified through the <code>adtype</code> keyword argument too. For example, if we want to use <a href="https://github.com/JuliaDiff/ReverseDiff.jl">ReverseDiff.jl</a> instead of the default <a href="https://github.com/JuliaDiff/ForwardDiff.jl">ForwardDiff.jl</a>:</p>
<div id="54" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">ReverseDiff</span>: ReverseDiff</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify that we want to use `AutoReverseDiff`.</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">demo</span>(),</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>, adtype<span class="op">=</span><span class="fu">AutoReverseDiff</span>()),</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>;</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 3.13 seconds
Compute duration  = 3.13 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters  </span><span class="ansi-bold">    mean  </span><span class="ansi-bold">     std  </span><span class="ansi-bold">    mcse  </span><span class="ansi-bold"> ess_bulk  </span><span class="ansi-bold"> ess_tail  </span><span class="ansi-bold">    rhat  </span><span class="ansi-bold"> e ⋯
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">  Float64  </span><span class="ansi-bright-black-fg ansi-bold">  Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">   ⋯

          σ²    0.8687    0.5944    0.0312   328.6888   230.6750    1.0033     ⋯
           x    0.0663    1.0636    0.0683   395.7800   194.2865    1.0008     ⋯
</span><span class="ansi-cyan-fg ansi-bold">                                                                1 column omitted

Quantiles
 </span><span class="ansi-cyan-fg ansi-bold"> parameters  </span><span class="ansi-cyan-fg ansi-bold">    2.5%  </span><span class="ansi-cyan-fg ansi-bold">   25.0%  </span><span class="ansi-cyan-fg ansi-bold">   50.0%  </span><span class="ansi-cyan-fg ansi-bold">   75.0%  </span><span class="ansi-cyan-fg ansi-bold">   97.5%
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64

          σ²    0.0979    0.3997    0.7345    1.2192    2.2631
           x   -1.9424   -0.3906    0.0019    0.4506    2.8088
</span></pre>
</div>
</div>
</div>
<p>Double-neat.</p>
</section>
</section>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<p>At this point it’s worth maybe reminding ourselves what we did and also <em>why</em> we did it:</p>
<ol type="1">
<li>We define our models in the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface because it makes the sampler agnostic to how the underlying model is implemented.</li>
<li>We implement our sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> interface, which just means that our sampler is a subtype of <code>AbstractMCMC.AbstractSampler</code> and we implement the MCMC transition in <code>AbstractMCMC.step</code>.</li>
<li>Points 1 and 2 makes it so our sampler can be used with a wide range of model implementations, amongst them being models implemented in both Turing.jl and Stan. This gives you, the inference implementer, a large collection of models to test your inference method on, in addition to allowing users of Turing.jl and Stan to try out your inference method with minimal effort.</li>
</ol>


</section>


<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a><div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>We’re going with the leapfrog formulation because in a future version of this tutorial we’ll add a section extending this simple “baseline” MALA sampler to more complex versions. See <a href="https://github.com/TuringLang/docs/issues/479">issue #479</a> for progress on this.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>There is no such thing as a proper interface in Julia (at least not officially), and so we use the word “interface” here to mean a few minimal methods that needs to be implemented by any type that we treat as a target model.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    // Ensure there is a toggle, if there isn't float one in the top right
    if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
      const a = window.document.createElement('a');
      a.classList.add('top-right');
      a.classList.add('quarto-color-scheme-toggle');
      a.href = "";
      a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
      const i = window.document.createElement("i");
      i.classList.add('bi');
      a.appendChild(i);
      window.document.body.appendChild(a);
    }
    setColorSchemeToggle(hasAlternateSentinel())
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/turinglang\.org\/docs\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../../developers/inference/variational-inference/index.html" class="pagination-link" aria-label="Variational Inference">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Variational Inference</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Turing is created by <a href="http://mlg.eng.cam.ac.uk/hong/" target="_blank">Hong Ge</a>, and lovingly maintained by the <a href="https://github.com/TuringLang/Turing.jl/graphs/contributors" target="_blank">core team</a> of volunteers. <br> The contents of this website are © 2018–2025 under the terms of the <a href="https://github.com/TuringLang/docs/blob/main/LICENCE" target="_blank">MIT License</a>.</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/TuringLang/docs/edit/main/developers/inference/implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/docs/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://x.com/TuringLang">
      <i class="bi bi-twitter" role="img" aria-label="Turing Twitter">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/TuringLang/Turing.jl">
      <i class="bi bi-github" role="img" aria-label="Turing GitHub">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




<script src="../../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>