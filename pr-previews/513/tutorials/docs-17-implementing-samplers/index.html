<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Implementing samplers – Turing.jl</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../tutorials/docs-07-for-developers-variational-inference/index.html" rel="prev">
<link href="../../assets/favicon.ico" rel="icon">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<style>
  a {
    text-decoration: none;
  }
  a:hover {
    text-decoration: underline;
  }
</style>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../theming/styles.css">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="https://turinglang.org/" class="navbar-brand navbar-brand-logo">
    <img src="../../assets/images/turing-logo.svg" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="https://turinglang.org/">
    <span class="navbar-title">Turing.jl</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../tutorials/docs-00-getting-started/"> 
<span class="menu-text">Get Started</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../tutorials/00-introduction/"> 
<span class="menu-text">Tutorials</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/library/"> 
<span class="menu-text">Libraries</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/news/"> 
<span class="menu-text">News</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/team/"> 
<span class="menu-text">Team</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-v0.34" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">v0.34</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-v0.34">    
        <li>
    <a class="dropdown-item" href="https://turinglang.org/docs/changelog.html">
 <span class="dropdown-text">Changelog</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://turinglang.org/docs/versions.html">
 <span class="dropdown-text">All Versions</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
    <a href="https://x.com/TuringLang" title="Turing Twitter" class="quarto-navigation-tool px-1" aria-label="Turing Twitter"><i class="bi bi-twitter"></i></a>
    <a href="https://github.com/TuringLang/Turing.jl" title="Turing GitHub" class="quarto-navigation-tool px-1" aria-label="Turing GitHub"><i class="bi bi-github"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Documentation</li><li class="breadcrumb-item"><a href="../../tutorials/docs-04-for-developers-abstractmcmc-turing/index.html">Developers: Inference</a></li><li class="breadcrumb-item"><a href="../../tutorials/docs-17-implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Documentation</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false">
 <span class="menu-text">Using Turing - Modelling Syntax and Interface</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-00-getting-started/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Getting Started</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-14-using-turing-quick-start/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Quick Start</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-12-using-turing-guide/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Guide</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-17-mode-estimation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Mode Estimation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-09-using-turing-advanced/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Advanced Usage</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-10-using-turing-autodiff/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Automatic Differentiation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-13-using-turing-performance-tips/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Performance Tips</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-11-using-turing-dynamichmc/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using DynamicHMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-15-using-turing-sampler-viz/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Sampler Visualization</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-16-using-turing-external-samplers/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">External Samplers</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false">
 <span class="menu-text">Using Turing - Tutorials</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/00-introduction/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction to Turing</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/01-gaussian-mixture-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Mixture Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/02-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/03-bayesian-neural-network/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Neural Networks</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/04-hidden-markov-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Hidden Markov Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/05-linear-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Linear Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/06-infinite-mixture-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Infinite Mixture Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/07-poisson-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Poisson Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/08-multinomial-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Multinomial Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/09-variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/10-bayesian-differential-equations/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Differential Equations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/11-probabilistic-pca/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Probabilistic PCA</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/13-seasonal-time-series/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Time Series Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/15-gaussian-processes/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction to Gaussian Processes</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/12-gplvm/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Process Latent Variable Models</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false">
 <span class="menu-text">Developers: Contributing</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-01-contributing-guide/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">How to Contribute</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false">
 <span class="menu-text">Developers: PPL</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-05-for-developers-compiler/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Turing Compiler Design</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/14-minituring/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation I: Compiler</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/16-contexts/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation II: Contexts</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-06-for-developers-interface/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Interface Guide</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true">
 <span class="menu-text">Developers: Inference</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-04-for-developers-abstractmcmc-turing/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">How Turing implements AbstractMCMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-07-for-developers-variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-17-implementing-samplers/index.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Implementing Samplers</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of Contents</h2>
   
  <ul>
  <li><a href="#quick-overview-of-mala" id="toc-quick-overview-of-mala" class="nav-link active" data-scroll-target="#quick-overview-of-mala">Quick overview of MALA</a></li>
  <li><a href="#what-we-need-from-a-model-logdensityproblems.jl" id="toc-what-we-need-from-a-model-logdensityproblems.jl" class="nav-link" data-scroll-target="#what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: LogDensityProblems.jl</a></li>
  <li><a href="#implementing-mala-in-abstractmcmc.jl" id="toc-implementing-mala-in-abstractmcmc.jl" class="nav-link" data-scroll-target="#implementing-mala-in-abstractmcmc.jl">Implementing MALA in AbstractMCMC.jl</a></li>
  <li><a href="#using-our-sampler-with-turing.jl" id="toc-using-our-sampler-with-turing.jl" class="nav-link" data-scroll-target="#using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</a>
  <ul class="collapse">
  <li><a href="#models-with-constrained-parameters" id="toc-models-with-constrained-parameters" class="nav-link" data-scroll-target="#models-with-constrained-parameters">Models with constrained parameters</a></li>
  </ul></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/TuringLang/docs/edit/master/tutorials/docs-17-implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/docs/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Documentation</li><li class="breadcrumb-item"><a href="../../tutorials/docs-04-for-developers-abstractmcmc-turing/index.html">Developers: Inference</a></li><li class="breadcrumb-item"><a href="../../tutorials/docs-17-implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Implementing samplers</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>In this tutorial, we’ll go through step-by-step how to implement a “simple” sampler in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> in such a way that it can be easily applied to Turing.jl models.</p>
<p>In particular, we’re going to implement a version of <strong>Metropolis-adjusted Langevin (MALA)</strong>.</p>
<p>Note that we will implement this sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> framework, completely “ignoring” Turing.jl until the very end of the tutorial, at which point we’ll use a single line of code to make the resulting sampler available to Turing.jl. This is to really drive home the point that one can implement samplers in a way that is accessible to all of Turing.jl’s users without having to use Turing.jl yourself.</p>
<section id="quick-overview-of-mala" class="level2">
<h2 class="anchored" data-anchor-id="quick-overview-of-mala">Quick overview of MALA</h2>
<p>We can view MALA as a single step of the leapfrog intergrator with resampling of momentum <span class="math inline">\(p\)</span> at every step.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> To make that statement a bit more concrete, we first define the <em>extended</em> target <span class="math inline">\(\bar{\gamma}(x, p)\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\log \bar{\gamma}(x, p) \propto \log \gamma(x) + \log \gamma_{\mathcal{N}(0, M)}(p)
\end{equation*}\]</span></p>
<p>where <span class="math inline">\(\gamma_{\mathcal{N}(0, M)}\)</span> denotes the density for a zero-centered Gaussian with covariance matrix <span class="math inline">\(M\)</span>. We then consider targeting this joint distribution over both <span class="math inline">\(x\)</span> and <span class="math inline">\(p\)</span> as follows. First we define the map</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  L_{\epsilon}: \quad &amp; \mathbb{R}^d \times \mathbb{R}^d \to \mathbb{R}^d \times \mathbb{R}^d \\
  &amp; (x, p) \mapsto (\tilde{x}, \tilde{p}) := L_{\epsilon}(x, p)
\end{split}
\end{equation*}\]</span></p>
<p>as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p_{1 / 2} &amp;:= p + \frac{\epsilon}{2} \nabla \log \gamma(x) \\
  \tilde{x} &amp;:= x + \epsilon M^{-1} p_{1 /2 } \\
  p_1 &amp;:= p_{1 / 2} + \frac{\epsilon}{2} \nabla \log \gamma(\tilde{x}) \\
  \tilde{p} &amp;:= - p_1
\end{split}
\end{equation*}\]</span></p>
<p>This might be familiar for some readers as a single step of the Leapfrog integrator. We then define the MALA kernel as follows: given the current iterate <span class="math inline">\(x_i\)</span>, we sample the next iterate <span class="math inline">\(x_{i + 1}\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p &amp;\sim \mathcal{N}(0, M) \\
  (\tilde{x}, \tilde{p}) &amp;:= L_{\epsilon}(x_i, p) \\
  \alpha &amp;:= \min \left\{ 1, \frac{\bar{\gamma}(\tilde{x}, \tilde{p})}{\bar{\gamma}(x_i, p)} \right\} \\
  x_{i + 1} &amp;:=
  \begin{cases}
    \tilde{x} \quad &amp; \text{ with prob. } \alpha \\
    x_i       \quad &amp; \text{ with prob. } 1 - \alpha
  \end{cases}
\end{split}
\end{equation*}\]</span></p>
<p>i.e.&nbsp;we accept the proposal <span class="math inline">\(\tilde{x}\)</span> with probability <span class="math inline">\(\alpha\)</span> and reject it, thus sticking with our current iterate, with probability <span class="math inline">\(1 - \alpha\)</span>.</p>
</section>
<section id="what-we-need-from-a-model-logdensityproblems.jl" class="level2">
<h2 class="anchored" data-anchor-id="what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a></h2>
<p>There are a few things we need from the “target” / “model” / density that we want to sample from:</p>
<ol type="1">
<li>We need access to log-density <em>evaluations</em> <span class="math inline">\(\log \gamma(x)\)</span> so we can compute the acceptance ratio involving <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>We need access to log-density <em>gradients</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span> so we can compute the Leapfrog steps <span class="math inline">\(L_{\epsilon}(x, p)\)</span>.</li>
<li>We also need access to the “size” of the model so we can determine the size of <span class="math inline">\(M\)</span>.</li>
</ol>
<p>Luckily for us, there is a package called <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> which provides an interface for <em>exactly</em> this!</p>
<p>To demonstrate how one can implement the “<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface”<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> we will use a simple Gaussian model as an example:</p>
<div id="4" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblems</span>: LogDensityProblems;</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's define some type that represents the model.</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> IsotropicNormalModel{M<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"mean of the isotropic Gaussian"</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    mean<span class="op">::</span><span class="dt">M</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Specifies what input length the model expects.</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">dimension</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> <span class="fu">length</span>(model.mean)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Implementation of the log-density evaluation of the model.</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x<span class="op">::</span><span class="dt">AbstractVector{&lt;:Real}</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">-</span> <span class="fu">sum</span>(abs2, x <span class="op">.-</span> model.mean) <span class="op">/</span> <span class="fl">2</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This gives us all of the properties we want for our MALA sampler with the exception of the computation of the <em>gradient</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span>. There is the method <code>LogDensityProblems.logdensity_and_gradient</code> which should return a 2-tuple where the first entry is the evaluation of the logdensity <span class="math inline">\(\log \gamma(x)\)</span> and the second entry is the gradient <span class="math inline">\(\nabla \log \gamma(x)\)</span>.</p>
<p>There are two ways to “implement” this method: 1) we implement it by hand, which is feasible in the case of our <code>IsotropicNormalModel</code>, or b) we defer the implementation of this to a automatic differentiation backend.</p>
<p>To implement it by hand we can simply do</p>
<div id="6" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl that first-order, i.e. gradient information, is available.</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{1}</span>()</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Implement `logdensity_and_gradient`.</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    logγ_x <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="op">-</span>x <span class="op">.*</span> (x <span class="op">-</span> model.mean)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> logγ_x, ∇logγ_x</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s just try it out:</p>
<div id="8" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate the problem.</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> <span class="fu">IsotropicNormalModel</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.])</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create some example input that we can test on.</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>x_example <span class="op">=</span> <span class="fu">randn</span>(LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate!</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-28.52584692088686</code></pre>
</div>
</div>
<p>To defer it to an automatic differentiation backend, we can do</p>
<div id="10" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl we only have access to 0-th order information.</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{0}</span>()</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Use `LogDensityProblemsAD`'s `ADgradient` in combination with some AD backend to implement `logdensity_and_gradient`.</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblemsAD</span>, <span class="bu">ADTypes</span>, <span class="bu">ForwardDiff</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>model_with_grad <span class="op">=</span> <span class="fu">ADgradient</span>(<span class="fu">AutoForwardDiff</span>(), model)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model_with_grad, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-28.52584692088686</code></pre>
</div>
</div>
<p>We’ll continue with the second approach in this tutorial since this is typically what one does in practice, because there are better hobbies to spend time on than deriving gradients by hand.</p>
<p>At this point, one might wonder how we’re going to tie this back to Turing.jl in the end. Effectively, when working with inference methods that only require log-density evaluations and / or higher-order information of the log-density, Turing.jl actually converts the user-provided <code>Model</code> into an object implementing the above methods for <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>. As a result, most samplers provided by Turing.jl are actually implemented to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, enabling their use both <em>within</em> Turing.jl and <em>outside</em> of Turing.jl! Morever, there exists similar conversions for Stan through BridgeStan and Stan<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, which means that a sampler supporting the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface can easily be used on both Turing.jl <em>and</em> Stan models (in addition to user-provided models, as our <code>IsotropicNormalModel</code> above)!</p>
<p>Anyways, let’s move on to actually implementing the sampler.</p>
</section>
<section id="implementing-mala-in-abstractmcmc.jl" class="level2">
<h2 class="anchored" data-anchor-id="implementing-mala-in-abstractmcmc.jl">Implementing MALA in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a></h2>
<p>Now that we’ve established that a model implementing the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface provides us with all the information we need from <span class="math inline">\(\log \gamma(x)\)</span>, we can address the question: given an object that implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, how can we define a sampler for it?</p>
<p>We’re going to do this by making our sampler a sub-type of <code>AbstractMCMC.AbstractSampler</code> in addition to implementing a few methods from <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>. Why? Because it gets us <em>a lot</em> of functionality for free, as we will see later.</p>
<p>Moreover, <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> provides a very natural interface for MCMC algorithms.</p>
<p>First, we’ll define our <code>MALA</code> type</p>
<div id="12" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">AbstractMCMC</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALA{T,A} <span class="op">&lt;:</span><span class="dt"> AbstractMCMC.AbstractSampler</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"stepsize used in the leapfrog step"</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    ϵ_init<span class="op">::</span><span class="dt">T</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"covariance matrix used for the momentum"</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    M_init<span class="op">::</span><span class="dt">A</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notice how we’ve added the suffix <code>_init</code> to both the stepsize and the covariance matrix. We’ve done this because a <code>AbstractMCMC.AbstractSampler</code> should be <em>immutable</em>. Of course there might be many scenarios where we want to allow something like the stepsize and / or the covariance matrix to vary between iterations, e.g.&nbsp;during the burn-in / adaptation phase of the sampling process we might want to adjust the parameters using statistics computed from these initial iterations. But information which can change between iterations <em>should not go in the sampler itself</em>! Instead, this information should go in the sampler <em>state</em>.</p>
<p>The sampler state should at the very least contain all the necessary information to perform the next MCMC iteration, but usually contains further information, e.g.&nbsp;quantities and statistics useful for evaluating whether the sampler has converged.</p>
<p>We will use the following sampler state for our <code>MALA</code> sampler:</p>
<div id="14" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALAState{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This might seem overly redundant: we’re defining a type <code>MALAState</code> and it only contains a simple vector of reals. In this particular case we indeed could have dropped this and simply used a <code>AbstractVector{&lt;:Real}</code> as our sampler state, but typically, as we will see later, one wants to include other quantities in the sampler state. For example, if we also wanted to adapt the parameters of our <code>MALA</code>, e.g.&nbsp;alter the stepsize depending on acceptance rates, in which case we should also put <code>ϵ</code> in the state, but for now we’ll keep things simple.</p>
<p>Moreover, we also want a <em>sample</em> type, which is a type meant for “public consumption”, i.e.&nbsp;the end-user. This is generally going to contain a subset of the information present in the state. But in such a simple scenario as this, we similarly only have a <code>AbstractVector{&lt;:Real}</code>:</p>
<div id="16" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALASample{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We currently have three things:</p>
<ol type="1">
<li>A <code>AbstractMCMC.AbstractSampler</code> implementation called <code>MALA</code>.</li>
<li>A state <code>MALAState</code> for our sampler <code>MALA</code>.</li>
<li>A sample <code>MALASample</code> for our sampler <code>MALA</code>.</li>
</ol>
<p>That means that we’re ready to implement the only thing that really matters: <code>AbstractMCMC.step</code>.</p>
<p><code>AbstractMCMC.step</code> defines the MCMC iteration of our <code>MALA</code> given the current <code>MALAState</code>. Specifically, the signature of the function is as follows:</p>
<div id="18" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The RNG to ensure reproducibility.</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The model that defines our target.</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.AbstractModel</span>,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The sampler for which we're taking a `step`.</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">AbstractMCMC.AbstractSampler</span>,</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The current sampler `state`.</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    state;</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Additional keyword arguments that we may or may not need.</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Moreover, there is a specific <code>AbstractMCMC.AbstractModel</code> which is used to indicate that the model that is provided implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface: <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Since, as we discussed earlier, in our case we’re indeed going to work with types that support the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, we’ll define <code>AbstractMCMC.step</code> for such a <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Note that <code>AbstractMCMC.LogDensityModel</code> has no other purpose; it has a single field called <code>logdensity</code>, and it does nothing else. But by wrapping the model in <code>AbstractMCMC.LogDensityModel</code>, it allows samplers that want to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> to define their <code>AbstractMCMC.step</code> on this type without running into method ambiguities.</p>
<p>All in all, that means that the signature for our <code>AbstractMCMC.step</code> is going to be the following:</p>
<div id="20" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># `LogDensityModel` so we know we're working with LogDensityProblems.jl model.</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler.</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler state.</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Great! Now let’s actually implement the full <code>AbstractMCMC.step</code> for our <code>MALA</code>.</p>
<p>Let’s remind ourselves what we’re going to do:</p>
<ol type="1">
<li>Sample a new momentum <span class="math inline">\(p\)</span>.</li>
<li>Compute the log-density of the extended target <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>Take a single leapfrog step <span class="math inline">\((\tilde{x}, \tilde{p}) = L_{\epsilon}(x, p)\)</span>.</li>
<li>Accept or reject the proposed <span class="math inline">\((\tilde{x}, \tilde{p})\)</span>.</li>
</ol>
<p>All in all, this results in the following:</p>
<div id="22" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>: Random</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Distributions</span>  <span class="co"># so we get the `MvNormal`</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the wrapped model which implements LogDensityProblems.jl.</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just extract the sampler parameters to make our lives easier.</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    ϵ <span class="op">=</span> sampler.ϵ_init</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    M <span class="op">=</span> sampler.M_init</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the current parameters.</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> state.x</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sample the momentum.</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>    p_dist <span class="op">=</span> <span class="fu">MvNormal</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)), M)</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> <span class="fu">rand</span>(rng, p_dist)</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Propose using a single leapfrog step.</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>    x̃, p̃ <span class="op">=</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Accept or reject proposal.</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>    logp <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p)</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>    logp̃ <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x̃) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p̃)</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>    logα <span class="op">=</span> logp̃ <span class="op">-</span> logp</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>    state_new <span class="op">=</span> <span class="cf">if</span> <span class="fu">log</span>(<span class="fu">rand</span>(rng)) <span class="op">&lt;</span> logα</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Accept.</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x̃)</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Reject.</span></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x)</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return the "sample" and the sampler state.</span></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(state_new.x), state_new</span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Fairly straight-forward.</p>
<p>Of course, we haven’t defined the <code>leapfrog_step</code> method yet, so let’s do that:</p>
<div id="24" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p` using "position" `x`.</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x))</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    p1 <span class="op">=</span> p <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update the "position" `x` using momentum `p1`.</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    x̃ <span class="op">=</span> x <span class="op">+</span> ϵ <span class="op">.*</span> (M <span class="op">\</span> p1)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p1` using position `x̃`</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x̃ <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x̃))</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    p2 <span class="op">=</span> p1 <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x̃</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Flip momentum `p2`.</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    p̃ <span class="op">=</span> <span class="op">-</span>p2</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x̃, p̃</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>leapfrog_step (generic function with 1 method)</code></pre>
</div>
</div>
<p>With all of this, we’re technically ready to sample!</p>
<div id="26" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>, <span class="bu">LinearAlgebra</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>rng <span class="op">=</span> <span class="bu">Random</span>.<span class="fu">default_rng</span>()</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>sampler <span class="op">=</span> <span class="fu">MALA</span>(<span class="fl">1</span>, I)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>state <span class="op">=</span> <span class="fu">MALAState</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)))</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>x_next, state_next <span class="op">=</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    rng,</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    AbstractMCMC.<span class="fu">LogDensityModel</span>(model),</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    state</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>(MALASample{Vector{Float64}}([0.0, 0.0, 0.0]), MALAState{Vector{Float64}}([0.0, 0.0, 0.0]))</code></pre>
</div>
</div>
<p>Great, it works!</p>
<p>And I promised we would get quite some functionality for free if we implemented <code>AbstractMCMC.step</code>, and so we can now simply call <code>sample</code> to perform standard MCMC sampling:</p>
<div id="28" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform 1000 iterations with our `MALA` sampler.</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; initial_state<span class="op">=</span>state, progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Concatenate into a matrix.</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000 Matrix{Float64}:
 -1.71283  -2.94305   -4.004    -4.80427   …  -3.97805   -4.64406  -4.66201
  1.01361  -0.710701  -1.83381   0.210243     -0.676727  -1.28915   0.595456
  2.74797   4.48841    5.41799   3.97546       4.13925    2.83108   3.27753</code></pre>
</div>
</div>
<div id="30" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the marginal means and standard deviations.</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -4.98149     0.984762
  0.00695471  0.993914
  4.99296     0.989176</code></pre>
</div>
</div>
<p>Let’s visualize the samples</p>
<div id="32" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">StatsPlots</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">transpose</span>(samples_matrix[<span class="op">:</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">:</span><span class="kw">end</span>]), alpha<span class="op">=</span><span class="fl">0.5</span>, legend<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<!--?xml version="1.0" encoding="utf-8"?-->
<svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" width="672" height="480" viewbox="0 0 2688 1920">
<defs>
  <clippath id="clip770">
    <rect x="0" y="0" width="2688" height="1920"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip770)" d="M0 1920 L2688 1920 L2688 0 L0 0  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip771">
    <rect x="537" y="0" width="1883" height="1883"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip770)" d="M151.747 1800.78 L2640.76 1800.78 L2640.76 47.2441 L151.747 47.2441  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip772">
    <rect x="151" y="47" width="2490" height="1755"></rect>
  </clippath>
</defs>
<polyline clip-path="url(#clip772)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="219.84,1800.78 219.84,47.2441 "></polyline>
<polyline clip-path="url(#clip772)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="807.458,1800.78 807.458,47.2441 "></polyline>
<polyline clip-path="url(#clip772)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1395.08,1800.78 1395.08,47.2441 "></polyline>
<polyline clip-path="url(#clip772)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1982.69,1800.78 1982.69,47.2441 "></polyline>
<polyline clip-path="url(#clip772)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="2570.31,1800.78 2570.31,47.2441 "></polyline>
<polyline clip-path="url(#clip772)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,1507.98 2640.76,1507.98 "></polyline>
<polyline clip-path="url(#clip772)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,1206.17 2640.76,1206.17 "></polyline>
<polyline clip-path="url(#clip772)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,904.367 2640.76,904.367 "></polyline>
<polyline clip-path="url(#clip772)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,602.562 2640.76,602.562 "></polyline>
<polyline clip-path="url(#clip772)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,300.756 2640.76,300.756 "></polyline>
<polyline clip-path="url(#clip770)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1800.78 2640.76,1800.78 "></polyline>
<polyline clip-path="url(#clip770)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="219.84,1800.78 219.84,1781.88 "></polyline>
<polyline clip-path="url(#clip770)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="807.458,1800.78 807.458,1781.88 "></polyline>
<polyline clip-path="url(#clip770)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1395.08,1800.78 1395.08,1781.88 "></polyline>
<polyline clip-path="url(#clip770)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1982.69,1800.78 1982.69,1781.88 "></polyline>
<polyline clip-path="url(#clip770)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="2570.31,1800.78 2570.31,1781.88 "></polyline>
<path clip-path="url(#clip770)" d="M219.84 1834 Q216.229 1834 214.4 1837.57 Q212.595 1841.11 212.595 1848.24 Q212.595 1855.34 214.4 1858.91 Q216.229 1862.45 219.84 1862.45 Q223.474 1862.45 225.28 1858.91 Q227.108 1855.34 227.108 1848.24 Q227.108 1841.11 225.28 1837.57 Q223.474 1834 219.84 1834 M219.84 1830.3 Q225.65 1830.3 228.706 1834.9 Q231.784 1839.49 231.784 1848.24 Q231.784 1856.96 228.706 1861.57 Q225.65 1866.15 219.84 1866.15 Q214.03 1866.15 210.951 1861.57 Q207.896 1856.96 207.896 1848.24 Q207.896 1839.49 210.951 1834.9 Q214.03 1830.3 219.84 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip770)" d="M771.15 1861.55 L787.47 1861.55 L787.47 1865.48 L765.525 1865.48 L765.525 1861.55 Q768.187 1858.79 772.771 1854.16 Q777.377 1849.51 778.558 1848.17 Q780.803 1845.65 781.683 1843.91 Q782.585 1842.15 782.585 1840.46 Q782.585 1837.71 780.641 1835.97 Q778.72 1834.23 775.618 1834.23 Q773.419 1834.23 770.965 1835 Q768.535 1835.76 765.757 1837.31 L765.757 1832.59 Q768.581 1831.46 771.035 1830.88 Q773.488 1830.3 775.525 1830.3 Q780.896 1830.3 784.09 1832.98 Q787.285 1835.67 787.285 1840.16 Q787.285 1842.29 786.474 1844.21 Q785.687 1846.11 783.581 1848.7 Q783.002 1849.37 779.9 1852.59 Q776.798 1855.78 771.15 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip770)" d="M797.331 1830.92 L815.687 1830.92 L815.687 1834.86 L801.613 1834.86 L801.613 1843.33 Q802.632 1842.98 803.65 1842.82 Q804.669 1842.64 805.687 1842.64 Q811.474 1842.64 814.854 1845.81 Q818.233 1848.98 818.233 1854.4 Q818.233 1859.97 814.761 1863.08 Q811.289 1866.15 804.97 1866.15 Q802.794 1866.15 800.525 1865.78 Q798.28 1865.41 795.872 1864.67 L795.872 1859.97 Q797.956 1861.11 800.178 1861.66 Q802.4 1862.22 804.877 1862.22 Q808.882 1862.22 811.22 1860.11 Q813.558 1858.01 813.558 1854.4 Q813.558 1850.78 811.22 1848.68 Q808.882 1846.57 804.877 1846.57 Q803.002 1846.57 801.127 1846.99 Q799.275 1847.4 797.331 1848.28 L797.331 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip770)" d="M837.446 1834 Q833.835 1834 832.007 1837.57 Q830.201 1841.11 830.201 1848.24 Q830.201 1855.34 832.007 1858.91 Q833.835 1862.45 837.446 1862.45 Q841.081 1862.45 842.886 1858.91 Q844.715 1855.34 844.715 1848.24 Q844.715 1841.11 842.886 1837.57 Q841.081 1834 837.446 1834 M837.446 1830.3 Q843.256 1830.3 846.312 1834.9 Q849.391 1839.49 849.391 1848.24 Q849.391 1856.96 846.312 1861.57 Q843.256 1866.15 837.446 1866.15 Q831.636 1866.15 828.557 1861.57 Q825.502 1856.96 825.502 1848.24 Q825.502 1839.49 828.557 1834.9 Q831.636 1830.3 837.446 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip770)" d="M1354.69 1830.92 L1373.05 1830.92 L1373.05 1834.86 L1358.98 1834.86 L1358.98 1843.33 Q1360 1842.98 1361.01 1842.82 Q1362.03 1842.64 1363.05 1842.64 Q1368.84 1842.64 1372.22 1845.81 Q1375.6 1848.98 1375.6 1854.4 Q1375.6 1859.97 1372.12 1863.08 Q1368.65 1866.15 1362.33 1866.15 Q1360.16 1866.15 1357.89 1865.78 Q1355.64 1865.41 1353.24 1864.67 L1353.24 1859.97 Q1355.32 1861.11 1357.54 1861.66 Q1359.76 1862.22 1362.24 1862.22 Q1366.25 1862.22 1368.58 1860.11 Q1370.92 1858.01 1370.92 1854.4 Q1370.92 1850.78 1368.58 1848.68 Q1366.25 1846.57 1362.24 1846.57 Q1360.37 1846.57 1358.49 1846.99 Q1356.64 1847.4 1354.69 1848.28 L1354.69 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip770)" d="M1394.81 1834 Q1391.2 1834 1389.37 1837.57 Q1387.56 1841.11 1387.56 1848.24 Q1387.56 1855.34 1389.37 1858.91 Q1391.2 1862.45 1394.81 1862.45 Q1398.44 1862.45 1400.25 1858.91 Q1402.08 1855.34 1402.08 1848.24 Q1402.08 1841.11 1400.25 1837.57 Q1398.44 1834 1394.81 1834 M1394.81 1830.3 Q1400.62 1830.3 1403.68 1834.9 Q1406.75 1839.49 1406.75 1848.24 Q1406.75 1856.96 1403.68 1861.57 Q1400.62 1866.15 1394.81 1866.15 Q1389 1866.15 1385.92 1861.57 Q1382.87 1856.96 1382.87 1848.24 Q1382.87 1839.49 1385.92 1834.9 Q1389 1830.3 1394.81 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip770)" d="M1424.97 1834 Q1421.36 1834 1419.53 1837.57 Q1417.73 1841.11 1417.73 1848.24 Q1417.73 1855.34 1419.53 1858.91 Q1421.36 1862.45 1424.97 1862.45 Q1428.61 1862.45 1430.41 1858.91 Q1432.24 1855.34 1432.24 1848.24 Q1432.24 1841.11 1430.41 1837.57 Q1428.61 1834 1424.97 1834 M1424.97 1830.3 Q1430.78 1830.3 1433.84 1834.9 Q1436.92 1839.49 1436.92 1848.24 Q1436.92 1856.96 1433.84 1861.57 Q1430.78 1866.15 1424.97 1866.15 Q1419.16 1866.15 1416.08 1861.57 Q1413.03 1856.96 1413.03 1848.24 Q1413.03 1839.49 1416.08 1834.9 Q1419.16 1830.3 1424.97 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip770)" d="M1940.97 1830.92 L1963.19 1830.92 L1963.19 1832.91 L1950.65 1865.48 L1945.76 1865.48 L1957.57 1834.86 L1940.97 1834.86 L1940.97 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip770)" d="M1972.36 1830.92 L1990.71 1830.92 L1990.71 1834.86 L1976.64 1834.86 L1976.64 1843.33 Q1977.66 1842.98 1978.68 1842.82 Q1979.7 1842.64 1980.72 1842.64 Q1986.5 1842.64 1989.88 1845.81 Q1993.26 1848.98 1993.26 1854.4 Q1993.26 1859.97 1989.79 1863.08 Q1986.32 1866.15 1980 1866.15 Q1977.82 1866.15 1975.55 1865.78 Q1973.31 1865.41 1970.9 1864.67 L1970.9 1859.97 Q1972.98 1861.11 1975.21 1861.66 Q1977.43 1862.22 1979.9 1862.22 Q1983.91 1862.22 1986.25 1860.11 Q1988.59 1858.01 1988.59 1854.4 Q1988.59 1850.78 1986.25 1848.68 Q1983.91 1846.57 1979.9 1846.57 Q1978.03 1846.57 1976.15 1846.99 Q1974.3 1847.4 1972.36 1848.28 L1972.36 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip770)" d="M2012.47 1834 Q2008.86 1834 2007.03 1837.57 Q2005.23 1841.11 2005.23 1848.24 Q2005.23 1855.34 2007.03 1858.91 Q2008.86 1862.45 2012.47 1862.45 Q2016.11 1862.45 2017.91 1858.91 Q2019.74 1855.34 2019.74 1848.24 Q2019.74 1841.11 2017.91 1837.57 Q2016.11 1834 2012.47 1834 M2012.47 1830.3 Q2018.28 1830.3 2021.34 1834.9 Q2024.42 1839.49 2024.42 1848.24 Q2024.42 1856.96 2021.34 1861.57 Q2018.28 1866.15 2012.47 1866.15 Q2006.66 1866.15 2003.59 1861.57 Q2000.53 1856.96 2000.53 1848.24 Q2000.53 1839.49 2003.59 1834.9 Q2006.66 1830.3 2012.47 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip770)" d="M2514.84 1861.55 L2522.48 1861.55 L2522.48 1835.18 L2514.17 1836.85 L2514.17 1832.59 L2522.43 1830.92 L2527.11 1830.92 L2527.11 1861.55 L2534.75 1861.55 L2534.75 1865.48 L2514.84 1865.48 L2514.84 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip770)" d="M2554.19 1834 Q2550.58 1834 2548.75 1837.57 Q2546.94 1841.11 2546.94 1848.24 Q2546.94 1855.34 2548.75 1858.91 Q2550.58 1862.45 2554.19 1862.45 Q2557.82 1862.45 2559.63 1858.91 Q2561.46 1855.34 2561.46 1848.24 Q2561.46 1841.11 2559.63 1837.57 Q2557.82 1834 2554.19 1834 M2554.19 1830.3 Q2560 1830.3 2563.06 1834.9 Q2566.13 1839.49 2566.13 1848.24 Q2566.13 1856.96 2563.06 1861.57 Q2560 1866.15 2554.19 1866.15 Q2548.38 1866.15 2545.3 1861.57 Q2542.25 1856.96 2542.25 1848.24 Q2542.25 1839.49 2545.3 1834.9 Q2548.38 1830.3 2554.19 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip770)" d="M2584.35 1834 Q2580.74 1834 2578.91 1837.57 Q2577.11 1841.11 2577.11 1848.24 Q2577.11 1855.34 2578.91 1858.91 Q2580.74 1862.45 2584.35 1862.45 Q2587.99 1862.45 2589.79 1858.91 Q2591.62 1855.34 2591.62 1848.24 Q2591.62 1841.11 2589.79 1837.57 Q2587.99 1834 2584.35 1834 M2584.35 1830.3 Q2590.16 1830.3 2593.22 1834.9 Q2596.3 1839.49 2596.3 1848.24 Q2596.3 1856.96 2593.22 1861.57 Q2590.16 1866.15 2584.35 1866.15 Q2578.54 1866.15 2575.46 1861.57 Q2572.41 1856.96 2572.41 1848.24 Q2572.41 1839.49 2575.46 1834.9 Q2578.54 1830.3 2584.35 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip770)" d="M2614.51 1834 Q2610.9 1834 2609.07 1837.57 Q2607.27 1841.11 2607.27 1848.24 Q2607.27 1855.34 2609.07 1858.91 Q2610.9 1862.45 2614.51 1862.45 Q2618.15 1862.45 2619.95 1858.91 Q2621.78 1855.34 2621.78 1848.24 Q2621.78 1841.11 2619.95 1837.57 Q2618.15 1834 2614.51 1834 M2614.51 1830.3 Q2620.32 1830.3 2623.38 1834.9 Q2626.46 1839.49 2626.46 1848.24 Q2626.46 1856.96 2623.38 1861.57 Q2620.32 1866.15 2614.51 1866.15 Q2608.7 1866.15 2605.62 1861.57 Q2602.57 1856.96 2602.57 1848.24 Q2602.57 1839.49 2605.62 1834.9 Q2608.7 1830.3 2614.51 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip770)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1800.78 151.747,47.2441 "></polyline>
<polyline clip-path="url(#clip770)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1507.98 170.644,1507.98 "></polyline>
<polyline clip-path="url(#clip770)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1206.17 170.644,1206.17 "></polyline>
<polyline clip-path="url(#clip770)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,904.367 170.644,904.367 "></polyline>
<polyline clip-path="url(#clip770)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,602.562 170.644,602.562 "></polyline>
<polyline clip-path="url(#clip770)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,300.756 170.644,300.756 "></polyline>
<path clip-path="url(#clip770)" d="M49.5521 1508.43 L79.2279 1508.43 L79.2279 1512.37 L49.5521 1512.37 L49.5521 1508.43 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip770)" d="M99.8991 1506.12 Q96.7509 1506.12 94.8991 1508.27 Q93.0704 1510.42 93.0704 1514.17 Q93.0704 1517.9 94.8991 1520.07 Q96.7509 1522.23 99.8991 1522.23 Q103.047 1522.23 104.876 1520.07 Q106.728 1517.9 106.728 1514.17 Q106.728 1510.42 104.876 1508.27 Q103.047 1506.12 99.8991 1506.12 M109.181 1491.46 L109.181 1495.72 Q107.422 1494.89 105.617 1494.45 Q103.834 1494.01 102.075 1494.01 Q97.4454 1494.01 94.9917 1497.13 Q92.5612 1500.26 92.2139 1506.58 Q93.5797 1504.56 95.6398 1503.5 Q97.7 1502.41 100.177 1502.41 Q105.385 1502.41 108.394 1505.58 Q111.427 1508.73 111.427 1514.17 Q111.427 1519.5 108.279 1522.71 Q105.131 1525.93 99.8991 1525.93 Q93.9037 1525.93 90.7325 1521.35 Q87.5612 1516.74 87.5612 1508.01 Q87.5612 1499.82 91.45 1494.96 Q95.3389 1490.07 101.89 1490.07 Q103.649 1490.07 105.431 1490.42 Q107.237 1490.77 109.181 1491.46 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip770)" d="M50.3623 1206.62 L80.0381 1206.62 L80.0381 1210.56 L50.3623 1210.56 L50.3623 1206.62 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip770)" d="M104.297 1204.82 Q107.654 1205.54 109.529 1207.81 Q111.427 1210.07 111.427 1213.41 Q111.427 1218.52 107.908 1221.32 Q104.39 1224.12 97.9083 1224.12 Q95.7324 1224.12 93.4176 1223.68 Q91.126 1223.27 88.6723 1222.41 L88.6723 1217.9 Q90.6167 1219.03 92.9315 1219.61 Q95.2463 1220.19 97.7695 1220.19 Q102.168 1220.19 104.459 1218.45 Q106.774 1216.72 106.774 1213.41 Q106.774 1210.35 104.621 1208.64 Q102.492 1206.9 98.6722 1206.9 L94.6445 1206.9 L94.6445 1203.06 L98.8574 1203.06 Q102.306 1203.06 104.135 1201.69 Q105.964 1200.31 105.964 1197.71 Q105.964 1195.05 104.066 1193.64 Q102.191 1192.2 98.6722 1192.2 Q96.7509 1192.2 94.5519 1192.62 Q92.3528 1193.04 89.7139 1193.92 L89.7139 1189.75 Q92.376 1189.01 94.6908 1188.64 Q97.0287 1188.27 99.0889 1188.27 Q104.413 1188.27 107.515 1190.7 Q110.617 1193.11 110.617 1197.23 Q110.617 1200.1 108.973 1202.09 Q107.33 1204.06 104.297 1204.82 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip770)" d="M99.4824 890.166 Q95.8713 890.166 94.0426 893.731 Q92.2371 897.273 92.2371 904.402 Q92.2371 911.509 94.0426 915.073 Q95.8713 918.615 99.4824 918.615 Q103.117 918.615 104.922 915.073 Q106.751 911.509 106.751 904.402 Q106.751 897.273 104.922 893.731 Q103.117 890.166 99.4824 890.166 M99.4824 886.462 Q105.293 886.462 108.348 891.069 Q111.427 895.652 111.427 904.402 Q111.427 913.129 108.348 917.735 Q105.293 922.319 99.4824 922.319 Q93.6723 922.319 90.5936 917.735 Q87.538 913.129 87.538 904.402 Q87.538 895.652 90.5936 891.069 Q93.6723 886.462 99.4824 886.462 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip770)" d="M104.297 601.207 Q107.654 601.925 109.529 604.194 Q111.427 606.462 111.427 609.795 Q111.427 614.911 107.908 617.712 Q104.39 620.513 97.9083 620.513 Q95.7324 620.513 93.4176 620.073 Q91.126 619.656 88.6723 618.8 L88.6723 614.286 Q90.6167 615.42 92.9315 615.999 Q95.2463 616.578 97.7695 616.578 Q102.168 616.578 104.459 614.842 Q106.774 613.106 106.774 609.795 Q106.774 606.74 104.621 605.027 Q102.492 603.291 98.6722 603.291 L94.6445 603.291 L94.6445 599.448 L98.8574 599.448 Q102.306 599.448 104.135 598.082 Q105.964 596.694 105.964 594.101 Q105.964 591.439 104.066 590.027 Q102.191 588.592 98.6722 588.592 Q96.7509 588.592 94.5519 589.008 Q92.3528 589.425 89.7139 590.305 L89.7139 586.138 Q92.376 585.397 94.6908 585.027 Q97.0287 584.657 99.0889 584.657 Q104.413 584.657 107.515 587.087 Q110.617 589.495 110.617 593.615 Q110.617 596.485 108.973 598.476 Q107.33 600.444 104.297 601.207 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip770)" d="M99.8991 298.892 Q96.7509 298.892 94.8991 301.045 Q93.0704 303.198 93.0704 306.948 Q93.0704 310.675 94.8991 312.851 Q96.7509 315.003 99.8991 315.003 Q103.047 315.003 104.876 312.851 Q106.728 310.675 106.728 306.948 Q106.728 303.198 104.876 301.045 Q103.047 298.892 99.8991 298.892 M109.181 284.24 L109.181 288.499 Q107.422 287.666 105.617 287.226 Q103.834 286.786 102.075 286.786 Q97.4454 286.786 94.9917 289.911 Q92.5612 293.036 92.2139 299.355 Q93.5797 297.342 95.6398 296.277 Q97.7 295.189 100.177 295.189 Q105.385 295.189 108.394 298.36 Q111.427 301.508 111.427 306.948 Q111.427 312.272 108.279 315.49 Q105.131 318.707 99.8991 318.707 Q93.9037 318.707 90.7325 314.124 Q87.5612 309.517 87.5612 300.791 Q87.5612 292.596 91.45 287.735 Q95.3389 282.851 101.89 282.851 Q103.649 282.851 105.431 283.198 Q107.237 283.545 109.181 284.24 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip772)" style="stroke:#009af9; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,1076.68 224.541,1228.29 226.891,1292.57 229.242,1313.94 231.592,1365.1 233.943,1309.58 236.293,1482.94 238.644,1519.02 240.994,1297.67 243.345,1443.47 245.695,1417.18 248.046,1394.11 250.396,1402.37 252.747,1336.61 255.097,1442.1 257.448,1276.31 259.798,1440.13 262.148,1409.36 264.499,1424.25 266.849,1462.16 269.2,1391.95 271.55,1353.15 273.901,1506.87 276.251,1414.56 278.602,1383.48 280.952,1352.62 283.303,1364.39 285.653,1545.8 288.004,1412.33 290.354,1320.17 292.705,1391.35 295.055,1521.81 297.406,1310.59 299.756,1463.39 302.107,1479.35 304.457,1412.93 306.807,1237.11 309.158,1413.67 311.508,1333.17 313.859,1390.25 316.209,1236.64 318.56,1416.78 320.91,1395.13 323.261,1342.57 325.611,1516.62 327.962,1445.69 330.312,1381.15 332.663,1361.53 335.013,1293.16 337.364,1247.49 339.714,1375.72 342.065,1501.2 344.415,1253.52 346.765,1485 349.116,1369.72 351.466,1347.2 353.817,1350.51 356.167,1354.34 358.518,1381.67 360.868,1334.78 363.219,1381.05 365.569,1237.03 367.92,1147.33 370.27,1359.55 372.621,1339.2 374.971,1541.39 377.322,1402.81 379.672,1385.96 382.023,1307.45 384.373,1398.5 386.724,1426.74 389.074,1330.98 391.424,1627.61 393.775,1494.8 396.125,1334.96 398.476,1210.67 400.826,1421.64 403.177,1434.1 405.527,1457.49 407.878,1497.52 410.228,1409.85 412.579,1427.93 414.929,1368.46 417.28,1402.63 419.63,1502.14 421.981,1397.18 424.331,1244.07 426.682,1542.37 429.032,1307.41 431.382,1333.32 433.733,1446.39 436.083,1429.15 438.434,1269.67 440.784,1503.27 443.135,1474.03 445.485,1340.77 447.836,1459.21 450.186,1392.64 452.537,1408.29 454.887,1263.7 457.238,1349.9 459.588,1085.24 461.939,1222.77 464.289,1463.8 466.64,1360.83 468.99,1378.53 471.341,1384.82 473.691,1470.51 476.041,1558.71 478.392,1382.23 480.742,1430.44 483.093,1381.06 485.443,1502.09 487.794,1687.12 490.144,1286.49 492.495,1490.91 494.845,1308.81 497.196,1680.33 499.546,1445.26 501.897,1228.21 504.247,1447.98 506.598,1428.63 508.948,1326.46 511.299,1379.86 513.649,1202.31 515.999,1395.44 518.35,1411.44 520.7,1354.22 523.051,1428.87 525.401,1487.34 527.752,1333.02 530.102,1617.63 532.453,1400.34 534.803,1500.27 537.154,1518.18 539.504,1574.11 541.855,1416.89 544.205,1348.7 546.556,1432.36 548.906,1346.86 551.257,1381.97 553.607,1339.09 555.958,1439.22 558.308,1398.22 560.658,1445.33 563.009,1406.63 565.359,1333.08 567.71,1255.58 570.06,1420.07 572.411,1326.42 574.761,1365.35 577.112,1378.44 579.462,1388.29 581.813,1543.88 584.163,1400.61 586.514,1412.65 588.864,1317.78 591.215,1327.02 593.565,1496.52 595.916,1147.07 598.266,1480.83 600.616,1612.94 602.967,1342.35 605.317,1331.92 607.668,1473.32 610.018,1234.97 612.369,1333.64 614.719,1375.87 617.07,1523.78 619.42,1340.96 621.771,1305.35 624.121,1539.35 626.472,1249.99 628.822,1372.27 631.173,1413.52 633.523,1467.16 635.874,1371.46 638.224,1540.33 640.575,1228.55 642.925,1474.11 645.275,1589.5 647.626,1392.05 649.976,1339.34 652.327,1488.62 654.677,1303.32 657.028,1318.52 659.378,1280.17 661.729,1364.36 664.079,1545.94 666.43,1405.36 668.78,1515.69 671.131,1408.85 673.481,1514.3 675.832,1434.78 678.182,1417.41 680.533,1248.17 682.883,1573.2 685.233,1432.37 687.584,1313.43 689.934,1318.89 692.285,1338.9 694.635,1700.7 696.986,1225.33 699.336,1400.74 701.687,1337.82 704.037,1295.62 706.388,1394.61 708.738,1368.49 711.089,1304.88 713.439,1161.37 715.79,1419.6 718.14,1450.05 720.491,1552.31 722.841,1325.28 725.192,1398.09 727.542,1424.58 729.892,1443.36 732.243,1250.33 734.593,1692.28 736.944,1271.86 739.294,1474.95 741.645,1578.05 743.995,1533.77 746.346,1489.91 748.696,1565.3 751.047,1372.42 753.397,1575.26 755.748,1448.37 758.098,1293.54 760.449,1258.94 762.799,1331.72 765.15,1369.35 767.5,1311.05 769.85,1465.06 772.201,1464.07 774.551,1465.49 776.902,1459.78 779.252,1519.08 781.603,1332.2 783.953,1496.01 786.304,1555.55 788.654,1348 791.005,1532.69 793.355,1392.37 795.706,1367.16 798.056,1497.34 800.407,1580.15 802.757,1375.18 805.108,1240.47 807.458,1490.44 809.809,1362.55 812.159,1402.94 814.509,1415.77 816.86,1430.85 819.21,1625.67 821.561,1291.98 823.911,1278.43 826.262,1372.14 828.612,1388.35 830.963,1377.1 833.313,1373.54 835.664,1425.22 838.014,1466.31 840.365,1426.51 842.715,1384.32 845.066,1475.2 847.416,1207.32 849.767,1370.74 852.117,1423.4 854.467,1374.52 856.818,1341.68 859.168,1514.16 861.519,1369.69 863.869,1244.34 866.22,1287.73 868.57,1512.61 870.921,1506.74 873.271,1493.86 875.622,1624.67 877.972,1489.9 880.323,1395.76 882.673,1486.1 885.024,1453.68 887.374,1511.8 889.725,1253.53 892.075,1219.48 894.426,1362.65 896.776,1424.23 899.126,1355.04 901.477,1295.09 903.827,1393.05 906.178,1482.78 908.528,1395.71 910.879,1482.11 913.229,1505.23 915.58,1398.23 917.93,1267 920.281,1494.76 922.631,1507.84 924.982,1661.09 927.332,1627.35 929.683,1605.28 932.033,1265.73 934.384,1383.95 936.734,1234.79 939.084,1526.89 941.435,1446.76 943.785,1513.37 946.136,1299.95 948.486,1411.64 950.837,1580.82 953.187,1372.31 955.538,1437.91 957.888,1494.11 960.239,1397.87 962.589,1613.39 964.94,1444.34 967.29,1434.41 969.641,1277.32 971.991,1577.38 974.342,1362.26 976.692,1205.81 979.043,1415.96 981.393,1303.84 983.743,1335.87 986.094,1420.81 988.444,1387.72 990.795,1346.04 993.145,1502.03 995.496,1406.85 997.846,1380.81 1000.2,1306.39 1002.55,1587.93 1004.9,1348.67 1007.25,1286.97 1009.6,1410.27 1011.95,1399.48 1014.3,1546.04 1016.65,1493.03 1019,1299.01 1021.35,1586.93 1023.7,1348.93 1026.05,1307.01 1028.4,1311.68 1030.75,1425.22 1033.1,1477.42 1035.45,1475.11 1037.8,1106.69 1040.15,1374.43 1042.51,1456.3 1044.86,1463.37 1047.21,1428.93 1049.56,1401.93 1051.91,1316.47 1054.26,1371 1056.61,1384.92 1058.96,1246.25 1061.31,1348.8 1063.66,1323.93 1066.01,1411.37 1068.36,1572.26 1070.71,1417.02 1073.06,1226.72 1075.41,1326.41 1077.76,1401.2 1080.11,1387.48 1082.46,1594.8 1084.81,1394.5 1087.16,1438.36 1089.51,1395.89 1091.87,1430.85 1094.22,1437.57 1096.57,1392.47 1098.92,1313.27 1101.27,1458.57 1103.62,1232.27 1105.97,1331.36 1108.32,1258.3 1110.67,1359.24 1113.02,1493.93 1115.37,1415.4 1117.72,1372.59 1120.07,1419.53 1122.42,1434.27 1124.77,1505.38 1127.12,1441.79 1129.47,1281.32 1131.82,1348.01 1134.17,1517.92 1136.52,1372.61 1138.87,1302.96 1141.23,1401.85 1143.58,1264.91 1145.93,1572.59 1148.28,1404.45 1150.63,1446.89 1152.98,1253.98 1155.33,1419.13 1157.68,1403.58 1160.03,1314.44 1162.38,1259.39 1164.73,1367.5 1167.08,1204.54 1169.43,1364.53 1171.78,1434.4 1174.13,1435.64 1176.48,1504.25 1178.83,1461.87 1181.18,1272.96 1183.53,1593.51 1185.88,1426.23 1188.23,1247.54 1190.59,1441.75 1192.94,1448.22 1195.29,1414.21 1197.64,1377.9 1199.99,1389.34 1202.34,1442.59 1204.69,1549.24 1207.04,1278.38 1209.39,1511.87 1211.74,1440.17 1214.09,1215.28 1216.44,1395.27 1218.79,1452.61 1221.14,1527.91 1223.49,1462.01 1225.84,1425.4 1228.19,1345.98 1230.54,1428.25 1232.89,1429.62 1235.24,1503.42 1237.59,1318.32 1239.94,1443.22 1242.3,1506.59 1244.65,1424.88 1247,1453.59 1249.35,1422.27 1251.7,1307.98 1254.05,1404.65 1256.4,1378.04 1258.75,1456.71 1261.1,1493.26 1263.45,1441.65 1265.8,1398.13 1268.15,1440.03 1270.5,1393.24 1272.85,1437.65 1275.2,1443.19 1277.55,1439.89 1279.9,1545.25 1282.25,1421.74 1284.6,1509.18 1286.95,1359.44 1289.3,1315.13 1291.66,1509.68 1294.01,1414.17 1296.36,1285.84 1298.71,1631.31 1301.06,1393.2 1303.41,1275.75 1305.76,1447.9 1308.11,1524.8 1310.46,1263.31 1312.81,1372.6 1315.16,1239.6 1317.51,1384.88 1319.86,1436.85 1322.21,1613.22 1324.56,1395.85 1326.91,1471.17 1329.26,1401.42 1331.61,1409.73 1333.96,1279.3 1336.31,1425.9 1338.66,1395.44 1341.02,1297.13 1343.37,1237.07 1345.72,1356.58 1348.07,1474.31 1350.42,1474 1352.77,1372.31 1355.12,1557.22 1357.47,1415.95 1359.82,1447.68 1362.17,1386.49 1364.52,1360.9 1366.87,1247.98 1369.22,1471.68 1371.57,1354.71 1373.92,1486.71 1376.27,1512.01 1378.62,1434.46 1380.97,1512.3 1383.32,1337.02 1385.67,1492.24 1388.02,1414.46 1390.38,1319.13 1392.73,1349 1395.08,1516.36 1397.43,1407.19 1399.78,1551.01 1402.13,1583.81 1404.48,1426.98 1406.83,1154.25 1409.18,1517.57 1411.53,1447.33 1413.88,1320.1 1416.23,1500.22 1418.58,1322.62 1420.93,1438.07 1423.28,1401.7 1425.63,1535.69 1427.98,1547.37 1430.33,1260.89 1432.68,1445.13 1435.03,1220.72 1437.38,1370.81 1439.74,1304.72 1442.09,1440.08 1444.44,1659.3 1446.79,1296.04 1449.14,1169.26 1451.49,1423.83 1453.84,1441.78 1456.19,1611.15 1458.54,1442.32 1460.89,1338.23 1463.24,1329.32 1465.59,1476.63 1467.94,1571.25 1470.29,1296.01 1472.64,1345.68 1474.99,1291.95 1477.34,1471.46 1479.69,1411.85 1482.04,1536.1 1484.39,1272.82 1486.74,1369.43 1489.1,1337.1 1491.45,1541.15 1493.8,1452.13 1496.15,1488.39 1498.5,1246.85 1500.85,1423.25 1503.2,1327.9 1505.55,1490.88 1507.9,1299.98 1510.25,1425.18 1512.6,1425.47 1514.95,1381 1517.3,1318.32 1519.65,1433.56 1522,1398.22 1524.35,1311.89 1526.7,1289.25 1529.05,1448.26 1531.4,1306.11 1533.75,1467.19 1536.1,1357.43 1538.45,1414.55 1540.81,1437.24 1543.16,1207.38 1545.51,1395.25 1547.86,1453.26 1550.21,1314.53 1552.56,1563.46 1554.91,1528.31 1557.26,1289.39 1559.61,1625.69 1561.96,1455.34 1564.31,1468.75 1566.66,1324.02 1569.01,1371.48 1571.36,1360.83 1573.71,1400.41 1576.06,1364.13 1578.41,1290.49 1580.76,1464.47 1583.11,1359.25 1585.46,1306 1587.81,1484.27 1590.17,1392.91 1592.52,1404.56 1594.87,1277.07 1597.22,1363.84 1599.57,1320.18 1601.92,1331.83 1604.27,1402.39 1606.62,1407.78 1608.97,1366.1 1611.32,1423.94 1613.67,1327.3 1616.02,1369.64 1618.37,1507.68 1620.72,1460.75 1623.07,1566.01 1625.42,1439.36 1627.77,1561.78 1630.12,1440.79 1632.47,1385.16 1634.82,1373.69 1637.17,1522.55 1639.53,1439.78 1641.88,1425.91 1644.23,1436.85 1646.58,1416.32 1648.93,1606.69 1651.28,1406.51 1653.63,1356.09 1655.98,1464.29 1658.33,1517.94 1660.68,1379.78 1663.03,1315.14 1665.38,1347.7 1667.73,1481.11 1670.08,1449.41 1672.43,1156.31 1674.78,1396.36 1677.13,1321.7 1679.48,1575.73 1681.83,1365.48 1684.18,1518.54 1686.53,1415.55 1688.89,1479.09 1691.24,1340.11 1693.59,1542.04 1695.94,1386.12 1698.29,1534.44 1700.64,1311.02 1702.99,1364.04 1705.34,1247.82 1707.69,1572.9 1710.04,1437.79 1712.39,1487.19 1714.74,1405.67 1717.09,1410.29 1719.44,1268.76 1721.79,1377.95 1724.14,1448.29 1726.49,1428.89 1728.84,1322.8 1731.19,1470.99 1733.54,1556.19 1735.89,1379.31 1738.25,1396.42 1740.6,1466.99 1742.95,1446.35 1745.3,1469.87 1747.65,1531.01 1750,1400.24 1752.35,1446.1 1754.7,1259.45 1757.05,1415.43 1759.4,1404.64 1761.75,1469.7 1764.1,1355.65 1766.45,1533.28 1768.8,1488.51 1771.15,1347.37 1773.5,1344.47 1775.85,1364.4 1778.2,1391.96 1780.55,1249.52 1782.9,1433.79 1785.25,1142.32 1787.6,1093.08 1789.96,1429.42 1792.31,1352.62 1794.66,1474.04 1797.01,1504.34 1799.36,1387.28 1801.71,1467.05 1804.06,1515.34 1806.41,1365.19 1808.76,1418.95 1811.11,1269.49 1813.46,1555.26 1815.81,1397.63 1818.16,1468.3 1820.51,1237.81 1822.86,1436.15 1825.21,1460.61 1827.56,1450.43 1829.91,1242.62 1832.26,1313.91 1834.61,1255.23 1836.96,1374.23 1839.32,1295.61 1841.67,1405.61 1844.02,1449.02 1846.37,1486.79 1848.72,1481.05 1851.07,1479 1853.42,1404.36 1855.77,1313.48 1858.12,1423.01 1860.47,1576.67 1862.82,1461.08 1865.17,1363.85 1867.52,1311.06 1869.87,1391.69 1872.22,1369.98 1874.57,1363.46 1876.92,1508.83 1879.27,1340.64 1881.62,1465.56 1883.97,1203.69 1886.32,1311.73 1888.68,1530.21 1891.03,1492.67 1893.38,1333.97 1895.73,1473.82 1898.08,1487.42 1900.43,1395.03 1902.78,1378.69 1905.13,1333.83 1907.48,1407.14 1909.83,1408.87 1912.18,1413.23 1914.53,1440.72 1916.88,1416.5 1919.23,1376.17 1921.58,1261.62 1923.93,1193.22 1926.28,1397.12 1928.63,1429.36 1930.98,1431.22 1933.33,1352.26 1935.68,1413.91 1938.04,1465.68 1940.39,1496.53 1942.74,1379.27 1945.09,1323.1 1947.44,1210.56 1949.79,1230.59 1952.14,1286.57 1954.49,1477.59 1956.84,1520.39 1959.19,1378.08 1961.54,1466.89 1963.89,1328.91 1966.24,1413.97 1968.59,1481.29 1970.94,1424.34 1973.29,1419.94 1975.64,1374.41 1977.99,1469.94 1980.34,1586.08 1982.69,1417.94 1985.04,1432.31 1987.4,1751.15 1989.75,1474.2 1992.1,1430.4 1994.45,1383.96 1996.8,1485.66 1999.15,1209.74 2001.5,1612.8 2003.85,1338.42 2006.2,1436.6 2008.55,1340.18 2010.9,1348.76 2013.25,1338.92 2015.6,1424.03 2017.95,1360.43 2020.3,1336.73 2022.65,1612.97 2025,1458.07 2027.35,1387.8 2029.7,1434.1 2032.05,1460.21 2034.4,1462.99 2036.76,1438.54 2039.11,1392.03 2041.46,1518.29 2043.81,1282.14 2046.16,1206.52 2048.51,1446.62 2050.86,1395.11 2053.21,1383.09 2055.56,1508.05 2057.91,1436 2060.26,1252.42 2062.61,1119.48 2064.96,1433.85 2067.31,1451.57 2069.66,1246.63 2072.01,1441.52 2074.36,1401.31 2076.71,1408.49 2079.06,1396.06 2081.41,1435.67 2083.76,1487.38 2086.11,1312.48 2088.47,1307.98 2090.82,1339.44 2093.17,1450.52 2095.52,1340.64 2097.87,1591.9 2100.22,1392.65 2102.57,1472.34 2104.92,1393.88 2107.27,1385.58 2109.62,1282.6 2111.97,1585.54 2114.32,1277.63 2116.67,1385.75 2119.02,1370.23 2121.37,1417.86 2123.72,1444.47 2126.07,1391.72 2128.42,1502.17 2130.77,1240.59 2133.12,1394.09 2135.47,1498.92 2137.83,1483.29 2140.18,1326.4 2142.53,1490.6 2144.88,1442.93 2147.23,1530.92 2149.58,1544.67 2151.93,1589.82 2154.28,1532.33 2156.63,1490.01 2158.98,1523.87 2161.33,1312.86 2163.68,1368.75 2166.03,1456.09 2168.38,1456.24 2170.73,1487.48 2173.08,1379.12 2175.43,1438.9 2177.78,1318.26 2180.13,1474.64 2182.48,1371.58 2184.83,1236.03 2187.19,1496.43 2189.54,1427.27 2191.89,1435.88 2194.24,1376.91 2196.59,1516.34 2198.94,1289.45 2201.29,1341.62 2203.64,1390.27 2205.99,1397.71 2208.34,1383.88 2210.69,1320.27 2213.04,1435.62 2215.39,1261.96 2217.74,1420.93 2220.09,1287.56 2222.44,1260.29 2224.79,1315.91 2227.14,1492.34 2229.49,1399.06 2231.84,1399.5 2234.19,1459.37 2236.55,1482.1 2238.9,1224.05 2241.25,1360.9 2243.6,1330.25 2245.95,1416.52 2248.3,1616.34 2250.65,1345.49 2253,1365.29 2255.35,1336.74 2257.7,1496.9 2260.05,1346.12 2262.4,1285.21 2264.75,1527.08 2267.1,1538.71 2269.45,1238.58 2271.8,1671.94 2274.15,1417.08 2276.5,1395.12 2278.85,1395.18 2281.2,1467.41 2283.55,1370.26 2285.91,1520.2 2288.26,1472.12 2290.61,1276.61 2292.96,1527.11 2295.31,1435.3 2297.66,1383.66 2300.01,1400.74 2302.36,1261.26 2304.71,1411.29 2307.06,1387.46 2309.41,1441.67 2311.76,1454.09 2314.11,1390.39 2316.46,1363.02 2318.81,1331.63 2321.16,1463.62 2323.51,1441.12 2325.86,1347.15 2328.21,1326.44 2330.56,1446.21 2332.91,1544.61 2335.27,1481.18 2337.62,1548.21 2339.97,1514.88 2342.32,1469.01 2344.67,1367.27 2347.02,1456.08 2349.37,1625.9 2351.72,1506.43 2354.07,1430.47 2356.42,1468.39 2358.77,1339.18 2361.12,1557.21 2363.47,1557 2365.82,1515 2368.17,1251.87 2370.52,1545.88 2372.87,1306.74 2375.22,1509.44 2377.57,1558.15 2379.92,1251.43 2382.27,1630.19 2384.62,1371.48 2386.98,1378.7 2389.33,1504.62 2391.68,1498.36 2394.03,1606.38 2396.38,1457.82 2398.73,1318.17 2401.08,1476.9 2403.43,1498.33 2405.78,1473.14 2408.13,1335.69 2410.48,1384.61 2412.83,1470 2415.18,1614.16 2417.53,1292.19 2419.88,1395 2422.23,1294.18 2424.58,1310.08 2426.93,1732.87 2429.28,1358.1 2431.63,1242.4 2433.98,1257.35 2436.34,1312.06 2438.69,1474.42 2441.04,1358.04 2443.39,1380.29 2445.74,1489.04 2448.09,1286.42 2450.44,1352.33 2452.79,1335.06 2455.14,1511.11 2457.49,1329.81 2459.84,1368.13 2462.19,1596.47 2464.54,1488.38 2466.89,1462.86 2469.24,1511.07 2471.59,1229.94 2473.94,1247.65 2476.29,1431.9 2478.64,1330.27 2480.99,1475.19 2483.34,1446.23 2485.7,1531.84 2488.05,1418.93 2490.4,1481.86 2492.75,1422.69 2495.1,1350.67 2497.45,1290.9 2499.8,1466.14 2502.15,1460.12 2504.5,1468 2506.85,1354.6 2509.2,1165.86 2511.55,1324.29 2513.9,1360.34 2516.25,1569.27 2518.6,1373.27 2520.95,1573.12 2523.3,1417.89 2525.65,1491.58 2528,1468.67 2530.35,1335.83 2532.7,1423.93 2535.06,1502.81 2537.41,1528.59 2539.76,1516.71 2542.11,1419.29 2544.46,1330.82 2546.81,1416.36 2549.16,1433.69 2551.51,1401.64 2553.86,1370.04 2556.21,1460.15 2558.56,1446.82 2560.91,1342.71 2563.26,1425.45 2565.61,1497.2 2567.96,1517.75 2570.31,1505.71 "></polyline>
<polyline clip-path="url(#clip772)" style="stroke:#e26f46; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,802.397 224.541,848.735 226.891,962.388 229.242,967.784 231.592,875.107 233.943,853.793 236.293,880.02 238.644,676.185 240.994,1031.64 243.345,894.192 245.695,945.193 248.046,1078.24 250.396,988.9 252.747,818.477 255.097,895.181 257.448,1060.34 259.798,857.64 262.148,1005.75 264.499,957.482 266.849,1020.59 269.2,1105.48 271.55,779.878 273.901,761.098 276.251,765.814 278.602,1064.38 280.952,1000.62 283.303,1016.27 285.653,995.468 288.004,1023.2 290.354,740.324 292.705,769.826 295.055,944.647 297.406,869.173 299.756,877.004 302.107,929.576 304.457,826.314 306.807,790.478 309.158,970.165 311.508,667.988 313.859,839.283 316.209,1005.92 318.56,841.708 320.91,854.185 323.261,1124.47 325.611,1066.21 327.962,962.283 330.312,975.519 332.663,855.337 335.013,752.49 337.364,913.397 339.714,966.027 342.065,984.839 344.415,889.958 346.765,840.561 349.116,736.802 351.466,932.836 353.817,865.492 356.167,816.19 358.518,930.692 360.868,773.904 363.219,910.295 365.569,776.018 367.92,763.847 370.27,925.601 372.621,957.028 374.971,873.211 377.322,779.971 379.672,936.776 382.023,857.659 384.373,1044.72 386.724,877.836 389.074,821.409 391.424,820.586 393.775,751.94 396.125,840.365 398.476,879.272 400.826,799.768 403.177,1090.39 405.527,869.5 407.878,959.539 410.228,710.048 412.579,955.72 414.929,854.078 417.28,966.887 419.63,860.969 421.981,1050.81 424.331,975.241 426.682,1070.69 429.032,815.785 431.382,878.465 433.733,887.466 436.083,948.37 438.434,939.873 440.784,843.75 443.135,866.451 445.485,909.449 447.836,1055.18 450.186,764.003 452.537,928.013 454.887,821.208 457.238,853.755 459.588,1003.99 461.939,910.686 464.289,982.484 466.64,900.858 468.99,899.892 471.341,962.5 473.691,946.491 476.041,964.67 478.392,719.92 480.742,945.419 483.093,956.956 485.443,810.499 487.794,849.273 490.144,789.34 492.495,905.28 494.845,1010.78 497.196,1039.61 499.546,980.446 501.897,770.678 504.247,896.736 506.598,740.712 508.948,871.173 511.299,1004.34 513.649,965.434 515.999,780.94 518.35,1035.58 520.7,954.471 523.051,1009.2 525.401,886.427 527.752,1165.4 530.102,875.785 532.453,901.179 534.803,928.599 537.154,858.104 539.504,1101.77 541.855,763.152 544.205,1035.29 546.556,887.145 548.906,838.13 551.257,1018.73 553.607,898.866 555.958,805.172 558.308,981.723 560.658,926.034 563.009,948.881 565.359,773.859 567.71,992.563 570.06,841.837 572.411,1022.89 574.761,1034.84 577.112,868.259 579.462,764.391 581.813,1003.62 584.163,795.165 586.514,874.77 588.864,937.209 591.215,787.739 593.565,977.648 595.916,922.157 598.266,914.72 600.616,846.084 602.967,1005.9 605.317,1038.57 607.668,892.582 610.018,875.644 612.369,1015.43 614.719,976.618 617.07,900.795 619.42,1040.42 621.771,819.504 624.121,1182.57 626.472,1091.56 628.822,1057.58 631.173,978.333 633.523,728.588 635.874,714.551 638.224,998.204 640.575,935.763 642.925,876.917 645.275,1023.18 647.626,847.559 649.976,1151.02 652.327,846.932 654.677,789.753 657.028,952.286 659.378,828.07 661.729,971.901 664.079,898.754 666.43,835.913 668.78,810.215 671.131,811.489 673.481,907.584 675.832,823.366 678.182,907.606 680.533,773.923 682.883,816.379 685.233,740.528 687.584,864.964 689.934,950.361 692.285,923.771 694.635,1032.68 696.986,910.639 699.336,871.813 701.687,986.877 704.037,895.508 706.388,1024.48 708.738,891.62 711.089,841.687 713.439,1019.09 715.79,929.41 718.14,863.611 720.491,852.389 722.841,892.867 725.192,1017.53 727.542,764.41 729.892,834.034 732.243,1023.32 734.593,842.951 736.944,855.044 739.294,965.536 741.645,890.75 743.995,907.59 746.346,884.405 748.696,880.954 751.047,760.728 753.397,1059.32 755.748,786.221 758.098,954.994 760.449,839.506 762.799,981.994 765.15,835.03 767.5,844.515 769.85,956.171 772.201,657.696 774.551,850.4 776.902,975.461 779.252,969.703 781.603,749.192 783.953,918.656 786.304,948.305 788.654,977.26 791.005,941.23 793.355,1016.82 795.706,1000.55 798.056,1006.44 800.407,830.985 802.757,1015.45 805.108,1012.51 807.458,963.918 809.809,1026.48 812.159,853.957 814.509,920.53 816.86,718.664 819.21,974.578 821.561,952.149 823.911,757.933 826.262,982.173 828.612,857.59 830.963,907.055 833.313,970.196 835.664,869.342 838.014,903.911 840.365,742.233 842.715,933.183 845.066,859.85 847.416,788.637 849.767,818.566 852.117,886.787 854.467,904.728 856.818,1063.32 859.168,1008.46 861.519,990.831 863.869,863.715 866.22,954 868.57,959.946 870.921,1017.89 873.271,868.711 875.622,914.186 877.972,783.128 880.323,930.625 882.673,862.27 885.024,908.963 887.374,851.905 889.725,948.379 892.075,1014.86 894.426,775.297 896.776,757.493 899.126,995.58 901.477,836.232 903.827,865.719 906.178,957.756 908.528,836.162 910.879,888.524 913.229,925.569 915.58,743.272 917.93,887.598 920.281,781.109 922.631,779.823 924.982,1015.11 927.332,827.592 929.683,1034.52 932.033,913.903 934.384,890.405 936.734,960.07 939.084,933.955 941.435,834.052 943.785,840.869 946.136,753.87 948.486,1038.3 950.837,970.32 953.187,835.161 955.538,733.628 957.888,711.927 960.239,812.268 962.589,897.376 964.94,770.725 967.29,914.602 969.641,865.503 971.991,934.043 974.342,829.707 976.692,883.253 979.043,896.028 981.393,941.891 983.743,846.831 986.094,890.572 988.444,899.396 990.795,881.565 993.145,939.812 995.496,975.99 997.846,814.001 1000.2,896.734 1002.55,916.206 1004.9,981.221 1007.25,992.742 1009.6,649.191 1011.95,699.655 1014.3,993.646 1016.65,818.681 1019,989.817 1021.35,863.999 1023.7,832.427 1026.05,978.513 1028.4,919.161 1030.75,806.971 1033.1,1077.51 1035.45,1019.92 1037.8,974.126 1040.15,887.198 1042.51,898.58 1044.86,744.198 1047.21,795.248 1049.56,917.677 1051.91,918.324 1054.26,1000.7 1056.61,942.015 1058.96,953.115 1061.31,860.71 1063.66,927.785 1066.01,822.232 1068.36,847.395 1070.71,881.269 1073.06,903.979 1075.41,856.045 1077.76,813.016 1080.11,856.575 1082.46,964.85 1084.81,878.717 1087.16,906.713 1089.51,897.656 1091.87,1091.58 1094.22,865.549 1096.57,800.49 1098.92,990.748 1101.27,908.839 1103.62,905.736 1105.97,969.563 1108.32,906.546 1110.67,691.458 1113.02,644.153 1115.37,940.221 1117.72,917.62 1120.07,737.326 1122.42,862.838 1124.77,946.833 1127.12,960.365 1129.47,1070.52 1131.82,694.71 1134.17,962.617 1136.52,862.275 1138.87,901.105 1141.23,898.674 1143.58,710.014 1145.93,983.305 1148.28,886.834 1150.63,1032.38 1152.98,778.264 1155.33,895.94 1157.68,1043.79 1160.03,883.75 1162.38,866.694 1164.73,773.882 1167.08,867.903 1169.43,849.78 1171.78,929.216 1174.13,1036.7 1176.48,882.919 1178.83,866.829 1181.18,866.065 1183.53,920.504 1185.88,844.598 1188.23,945.34 1190.59,869.849 1192.94,954.583 1195.29,873.411 1197.64,1101.78 1199.99,709.716 1202.34,1014.04 1204.69,848.552 1207.04,791.225 1209.39,864.422 1211.74,1016.67 1214.09,763.178 1216.44,997.976 1218.79,933.757 1221.14,913.183 1223.49,1090.99 1225.84,832.022 1228.19,726.484 1230.54,968.305 1232.89,761.192 1235.24,981.864 1237.59,972.592 1239.94,755.618 1242.3,1074.3 1244.65,975.855 1247,878.971 1249.35,1000.58 1251.7,837.949 1254.05,922.227 1256.4,947.47 1258.75,835.105 1261.1,1101.47 1263.45,863.252 1265.8,716.32 1268.15,912.581 1270.5,990.903 1272.85,865.111 1275.2,924.106 1277.55,898.081 1279.9,823.419 1282.25,1021.48 1284.6,961.92 1286.95,861.721 1289.3,910.584 1291.66,1096.28 1294.01,737.346 1296.36,676.569 1298.71,1023.07 1301.06,799.362 1303.41,710.247 1305.76,991.005 1308.11,837.125 1310.46,795.191 1312.81,887.301 1315.16,1009.05 1317.51,825.107 1319.86,862.641 1322.21,1051.81 1324.56,808.847 1326.91,954.361 1329.26,925.091 1331.61,929.869 1333.96,957.643 1336.31,904.902 1338.66,816.585 1341.02,885.41 1343.37,785.975 1345.72,818.218 1348.07,1011.19 1350.42,1058.63 1352.77,915.562 1355.12,936.112 1357.47,804.761 1359.82,942.487 1362.17,818.505 1364.52,895.549 1366.87,918.509 1369.22,945.15 1371.57,957.281 1373.92,1019.53 1376.27,794.614 1378.62,729.556 1380.97,933.474 1383.32,775.393 1385.67,828.956 1388.02,924.194 1390.38,1036.81 1392.73,856.463 1395.08,1056.87 1397.43,938.069 1399.78,859.725 1402.13,904.953 1404.48,1024.59 1406.83,957.218 1409.18,1127.71 1411.53,1209.51 1413.88,874.135 1416.23,948.028 1418.58,1009.8 1420.93,915.09 1423.28,974.518 1425.63,914.32 1427.98,890.767 1430.33,998.901 1432.68,1102.44 1435.03,943.079 1437.38,1109.9 1439.74,893.688 1442.09,869.159 1444.44,753.402 1446.79,854.402 1449.14,714.99 1451.49,756.204 1453.84,921.967 1456.19,867.369 1458.54,819.203 1460.89,873.541 1463.24,836.665 1465.59,1051.69 1467.94,838.109 1470.29,976.179 1472.64,988.614 1474.99,929.035 1477.34,943.838 1479.69,802.43 1482.04,974.942 1484.39,813.978 1486.74,749.27 1489.1,882.942 1491.45,808.478 1493.8,804.663 1496.15,784.511 1498.5,876.475 1500.85,927.782 1503.2,967.202 1505.55,748.867 1507.9,1071.71 1510.25,1108.66 1512.6,940.508 1514.95,808.2 1517.3,917.752 1519.65,797.764 1522,826.645 1524.35,926.226 1526.7,846.87 1529.05,797.972 1531.4,900.55 1533.75,804.814 1536.1,1015.37 1538.45,1032.94 1540.81,797.932 1543.16,941.653 1545.51,767.147 1547.86,1002.02 1550.21,757.063 1552.56,966.324 1554.91,865.385 1557.26,915.8 1559.61,1006.17 1561.96,907.23 1564.31,923.806 1566.66,939.487 1569.01,951.172 1571.36,707.58 1573.71,982.509 1576.06,944.324 1578.41,1082.77 1580.76,831.543 1583.11,878.734 1585.46,851.646 1587.81,904.571 1590.17,910.365 1592.52,923.546 1594.87,903.615 1597.22,838.675 1599.57,878.928 1601.92,892.465 1604.27,909.148 1606.62,810.918 1608.97,843.14 1611.32,904.154 1613.67,879.993 1616.02,933.594 1618.37,1071.51 1620.72,854.381 1623.07,858.105 1625.42,953.089 1627.77,752.985 1630.12,900.839 1632.47,822.634 1634.82,829.248 1637.17,765.366 1639.53,931.825 1641.88,989.097 1644.23,828.199 1646.58,779.306 1648.93,920.108 1651.28,776.657 1653.63,878.783 1655.98,731.387 1658.33,871.741 1660.68,773.9 1663.03,949.138 1665.38,1049.15 1667.73,826.272 1670.08,864.128 1672.43,814.581 1674.78,917.005 1677.13,927.404 1679.48,800.876 1681.83,958.126 1684.18,842.912 1686.53,802.129 1688.89,872.433 1691.24,1024.3 1693.59,845.29 1695.94,1033.54 1698.29,941.319 1700.64,751.374 1702.99,1014.8 1705.34,993.449 1707.69,1053.99 1710.04,624.686 1712.39,993.744 1714.74,934.513 1717.09,837.865 1719.44,1002.33 1721.79,1024.99 1724.14,1001.8 1726.49,803.13 1728.84,1081.14 1731.19,987.029 1733.54,1095.91 1735.89,921.201 1738.25,925.339 1740.6,907.179 1742.95,959.465 1745.3,868.222 1747.65,893.847 1750,950.258 1752.35,953.555 1754.7,843.588 1757.05,1014.42 1759.4,1009.5 1761.75,866.852 1764.1,921.226 1766.45,847.826 1768.8,885.204 1771.15,1044.69 1773.5,970.478 1775.85,688.764 1778.2,854.322 1780.55,956.743 1782.9,1066.07 1785.25,921.392 1787.6,911.653 1789.96,988.973 1792.31,966.087 1794.66,815.79 1797.01,747.137 1799.36,987.305 1801.71,913.724 1804.06,939.094 1806.41,708.095 1808.76,646.961 1811.11,955.729 1813.46,865.637 1815.81,1014.4 1818.16,946.481 1820.51,659.156 1822.86,983.624 1825.21,995.298 1827.56,890.215 1829.91,908.073 1832.26,912.715 1834.61,856.256 1836.96,933.022 1839.32,901.152 1841.67,783.268 1844.02,940.578 1846.37,874.584 1848.72,821.946 1851.07,1111.65 1853.42,754.425 1855.77,911.597 1858.12,826.714 1860.47,972.902 1862.82,981.821 1865.17,1017.74 1867.52,1075.47 1869.87,812.919 1872.22,813.206 1874.57,791.531 1876.92,904.754 1879.27,782.64 1881.62,895.904 1883.97,785.441 1886.32,766.502 1888.68,1039.11 1891.03,797.291 1893.38,878.575 1895.73,931.509 1898.08,835.994 1900.43,739.941 1902.78,869.606 1905.13,1046.5 1907.48,946.876 1909.83,780.326 1912.18,808.787 1914.53,1043.25 1916.88,895.431 1919.23,823.194 1921.58,929.184 1923.93,1063.57 1926.28,1024.93 1928.63,842.595 1930.98,885.673 1933.33,932.297 1935.68,937.627 1938.04,891.739 1940.39,969.985 1942.74,868.046 1945.09,920.019 1947.44,932.158 1949.79,1001.22 1952.14,826.359 1954.49,846.133 1956.84,696.82 1959.19,916.461 1961.54,866.302 1963.89,1020.94 1966.24,939.345 1968.59,823.12 1970.94,724.881 1973.29,1005.98 1975.64,844.749 1977.99,870.854 1980.34,1167.99 1982.69,948.973 1985.04,930.489 1987.4,978.261 1989.75,790.716 1992.1,732.548 1994.45,839.093 1996.8,841.066 1999.15,738.871 2001.5,966.655 2003.85,965.958 2006.2,839.488 2008.55,916.027 2010.9,929.993 2013.25,913.383 2015.6,883.976 2017.95,1036.45 2020.3,966.146 2022.65,822.412 2025,894.839 2027.35,875.31 2029.7,784.313 2032.05,776.655 2034.4,894.023 2036.76,850.069 2039.11,997.629 2041.46,1053.58 2043.81,796.496 2046.16,782.716 2048.51,963.122 2050.86,1056.66 2053.21,856.755 2055.56,975.754 2057.91,772.494 2060.26,834.623 2062.61,896.053 2064.96,860.602 2067.31,1042.34 2069.66,912.69 2072.01,859.058 2074.36,848.996 2076.71,893.65 2079.06,732.863 2081.41,800.657 2083.76,656.033 2086.11,948.977 2088.47,942.996 2090.82,966.414 2093.17,1018.53 2095.52,847.428 2097.87,993.226 2100.22,921.071 2102.57,980.223 2104.92,895.593 2107.27,957.849 2109.62,730.403 2111.97,946.117 2114.32,942.313 2116.67,939.648 2119.02,942.732 2121.37,699.919 2123.72,1043.24 2126.07,880.767 2128.42,968.234 2130.77,919.998 2133.12,778.495 2135.47,909.935 2137.83,824.85 2140.18,1055.69 2142.53,817.09 2144.88,940.735 2147.23,1067.27 2149.58,845.058 2151.93,799.978 2154.28,970.176 2156.63,838.583 2158.98,1122.54 2161.33,1188.39 2163.68,1021.08 2166.03,984.539 2168.38,975.871 2170.73,898.362 2173.08,982.962 2175.43,1026.85 2177.78,883.858 2180.13,994.546 2182.48,878.764 2184.83,836.152 2187.19,977.836 2189.54,784.848 2191.89,882.56 2194.24,965.561 2196.59,861.876 2198.94,915.763 2201.29,952.112 2203.64,965.333 2205.99,851.827 2208.34,1043.56 2210.69,861.875 2213.04,840.766 2215.39,814.007 2217.74,938.647 2220.09,900.452 2222.44,809.195 2224.79,827.852 2227.14,776.596 2229.49,999.483 2231.84,685.328 2234.19,1083.89 2236.55,1036.87 2238.9,822.014 2241.25,860.582 2243.6,880.466 2245.95,948.44 2248.3,653.709 2250.65,1141.99 2253,984.048 2255.35,907.052 2257.7,789.819 2260.05,1075.11 2262.4,958.92 2264.75,892.506 2267.1,910.348 2269.45,763.052 2271.8,932.122 2274.15,954.154 2276.5,954.587 2278.85,710.419 2281.2,1068.96 2283.55,1077.05 2285.91,896.185 2288.26,841.945 2290.61,851.872 2292.96,931.745 2295.31,808.285 2297.66,1121.05 2300.01,976.829 2302.36,735.716 2304.71,1016.44 2307.06,835.492 2309.41,1097.81 2311.76,958.087 2314.11,825.877 2316.46,841.131 2318.81,912.981 2321.16,999.133 2323.51,949.083 2325.86,941.72 2328.21,1052.11 2330.56,890.354 2332.91,1024.21 2335.27,993.973 2337.62,826.945 2339.97,837.839 2342.32,654.269 2344.67,814.815 2347.02,848.767 2349.37,957.411 2351.72,927.418 2354.07,846.63 2356.42,873.23 2358.77,1088.27 2361.12,756.416 2363.47,1076.28 2365.82,936.56 2368.17,1082.12 2370.52,881.092 2372.87,800.473 2375.22,942.375 2377.57,757.899 2379.92,907.915 2382.27,828.25 2384.62,769.009 2386.98,892.781 2389.33,877.982 2391.68,795.485 2394.03,964.434 2396.38,912.06 2398.73,909.85 2401.08,1067 2403.43,857.309 2405.78,1056.75 2408.13,717.802 2410.48,832.73 2412.83,858.2 2415.18,658.304 2417.53,872.436 2419.88,701.709 2422.23,908.541 2424.58,1059.91 2426.93,927.126 2429.28,662.65 2431.63,1026.08 2433.98,986.881 2436.34,937.413 2438.69,962.011 2441.04,750.406 2443.39,1094.3 2445.74,921.27 2448.09,836.809 2450.44,847.648 2452.79,1071.49 2455.14,995.475 2457.49,877.274 2459.84,965.675 2462.19,718.497 2464.54,986.785 2466.89,910.131 2469.24,750.936 2471.59,789.223 2473.94,801.716 2476.29,842.009 2478.64,1085.29 2480.99,823.886 2483.34,789.864 2485.7,850.447 2488.05,1077.32 2490.4,806.563 2492.75,791.73 2495.1,715.298 2497.45,737.481 2499.8,888.671 2502.15,713.677 2504.5,799.248 2506.85,818.867 2509.2,984.823 2511.55,676.571 2513.9,1007.53 2516.25,855.587 2518.6,972.956 2520.95,828.659 2523.3,826.846 2525.65,814.357 2528,730.125 2530.35,883.567 2532.7,832.796 2535.06,811.112 2537.41,707.234 2539.76,939.039 2542.11,933.483 2544.46,857.598 2546.81,782.536 2549.16,911.914 2551.51,768.854 2553.86,829.882 2556.21,870.167 2558.56,823.768 2560.91,871.529 2563.26,1036.19 2565.61,851.725 2567.96,732.43 2570.31,738.861 "></polyline>
<polyline clip-path="url(#clip772)" style="stroke:#3da44d; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,627.917 224.541,402.239 226.891,337.85 229.242,392.22 231.592,300.059 233.943,383.668 236.293,311.991 238.644,526.854 240.994,459.442 243.345,208.526 245.695,282.993 248.046,526.819 250.396,433.444 252.747,484.994 255.097,356.944 257.448,280.831 259.798,343.571 262.148,524.514 264.499,466.918 266.849,432.819 269.2,451.62 271.55,454.485 273.901,400.87 276.251,362.683 278.602,372.06 280.952,458.473 283.303,348.543 285.653,416.281 288.004,170.174 290.354,436.938 292.705,461.022 295.055,126.476 297.406,543.681 299.756,422.588 302.107,404.8 304.457,323.104 306.807,223.133 309.158,514.301 311.508,573.135 313.859,615.739 316.209,564.204 318.56,268.679 320.91,293.561 323.261,430.337 325.611,439.016 327.962,477.308 330.312,447.089 332.663,371.294 335.013,430.203 337.364,475.567 339.714,474.511 342.065,421.784 344.415,170.573 346.765,356.48 349.116,371.804 351.466,445.92 353.817,322.595 356.167,431.971 358.518,324.115 360.868,358.495 363.219,477.826 365.569,436.923 367.92,324.576 370.27,457.355 372.621,303.303 374.971,528.819 377.322,436.913 379.672,268.062 382.023,400.025 384.373,578.767 386.724,319.54 389.074,381.227 391.424,372.636 393.775,518.159 396.125,349.558 398.476,370.896 400.826,412.099 403.177,380.079 405.527,423.388 407.878,517.601 410.228,407.213 412.579,408.474 414.929,425.159 417.28,451.897 419.63,238.238 421.981,420.171 424.331,359.18 426.682,524.471 429.032,550.325 431.382,471.749 433.733,375.929 436.083,382.974 438.434,239.081 440.784,163.964 443.135,458.934 445.485,452.958 447.836,394.993 450.186,462.666 452.537,434.145 454.887,472.655 457.238,313.825 459.588,363.436 461.939,313.046 464.289,379.209 466.64,374.077 468.99,369.204 471.341,469.445 473.691,192.992 476.041,388.309 478.392,269.64 480.742,302.06 483.093,301.014 485.443,438.253 487.794,446.402 490.144,297.693 492.495,273.238 494.845,381.788 497.196,395.793 499.546,380.108 501.897,384.416 504.247,404.323 506.598,412.548 508.948,194.355 511.299,483.154 513.649,566.542 515.999,277.611 518.35,497.264 520.7,526.051 523.051,184.28 525.401,398.467 527.752,492.204 530.102,442.43 532.453,360.695 534.803,581.465 537.154,322.779 539.504,260.531 541.855,353.221 544.205,414.149 546.556,455.73 548.906,475.755 551.257,532.194 553.607,545.305 555.958,403.461 558.308,409.189 560.658,428.332 563.009,472.2 565.359,358.869 567.71,277.26 570.06,655.938 572.411,346.934 574.761,439.729 577.112,506.943 579.462,375.958 581.813,443.024 584.163,332.55 586.514,497.788 588.864,403.326 591.215,438.714 593.565,371.435 595.916,513.827 598.266,359.039 600.616,442.954 602.967,570.529 605.317,444.816 607.668,427.248 610.018,245.689 612.369,204.152 614.719,348.847 617.07,246.575 619.42,387.971 621.771,330.233 624.121,510.511 626.472,230.115 628.822,308.173 631.173,347.646 633.523,369.202 635.874,375.451 638.224,442.751 640.575,332.908 642.925,474.135 645.275,396.189 647.626,403.175 649.976,436.355 652.327,548.818 654.677,505.768 657.028,406.058 659.378,500.317 661.729,497.082 664.079,225.84 666.43,446.538 668.78,319.838 671.131,471.81 673.481,405.422 675.832,381.517 678.182,374.985 680.533,251.726 682.883,280.516 685.233,471.09 687.584,287.854 689.934,503.22 692.285,323.751 694.635,286.504 696.986,509.45 699.336,327.378 701.687,521.292 704.037,351.656 706.388,491.543 708.738,610.761 711.089,406.904 713.439,461.215 715.79,312.512 718.14,224.848 720.491,556.887 722.841,486.247 725.192,660.49 727.542,317.066 729.892,260.291 732.243,451.46 734.593,391.803 736.944,443.085 739.294,290.259 741.645,449.904 743.995,270.686 746.346,488.37 748.696,438.983 751.047,357.778 753.397,367.278 755.748,576.548 758.098,382.795 760.449,414.444 762.799,326.659 765.15,399.669 767.5,358.969 769.85,355.36 772.201,365.331 774.551,411.192 776.902,430.698 779.252,383.981 781.603,489.273 783.953,328.265 786.304,253.646 788.654,404.214 791.005,350.338 793.355,312.875 795.706,467.165 798.056,205.981 800.407,234.41 802.757,411.882 805.108,559.773 807.458,237.862 809.809,343.69 812.159,612.964 814.509,417.592 816.86,219.328 819.21,388.338 821.561,356.063 823.911,480.261 826.262,295.169 828.612,486.984 830.963,424.41 833.313,447.171 835.664,179.335 838.014,333.141 840.365,434.933 842.715,400.057 845.066,304.601 847.416,188.977 849.767,540.785 852.117,404.514 854.467,444.599 856.818,397.439 859.168,363.728 861.519,489.42 863.869,352.63 866.22,349.059 868.57,500.201 870.921,483.422 873.271,288.741 875.622,438.62 877.972,411.2 880.323,422.262 882.673,396.811 885.024,430.884 887.374,713.297 889.725,294.716 892.075,399.832 894.426,454.028 896.776,539.373 899.126,505.384 901.477,407.118 903.827,242.248 906.178,269.812 908.528,410.92 910.879,303.377 913.229,435.693 915.58,264.806 917.93,407.639 920.281,362.208 922.631,313.121 924.982,393.674 927.332,498.907 929.683,254.712 932.033,258.071 934.384,405.208 936.734,553.88 939.084,357.8 941.435,356.13 943.785,378.966 946.136,380.256 948.486,341.709 950.837,317.552 953.187,393.911 955.538,417.145 957.888,451.935 960.239,486.153 962.589,400.349 964.94,483.942 967.29,227.716 969.641,190.233 971.991,424.187 974.342,452.76 976.692,515.004 979.043,287.473 981.393,345.289 983.743,205.558 986.094,378.068 988.444,385.496 990.795,416.611 993.145,367.072 995.496,366.66 997.846,414.955 1000.2,211.548 1002.55,232.29 1004.9,433.992 1007.25,407.182 1009.6,517.052 1011.95,503.593 1014.3,323.139 1016.65,165.647 1019,392.926 1021.35,450.848 1023.7,334.542 1026.05,512.691 1028.4,532.028 1030.75,452.976 1033.1,375.117 1035.45,634.449 1037.8,420.126 1040.15,490.089 1042.51,518.849 1044.86,486.416 1047.21,556.835 1049.56,400.145 1051.91,493.701 1054.26,409.36 1056.61,490.836 1058.96,376.501 1061.31,374.443 1063.66,560.039 1066.01,225.829 1068.36,473.239 1070.71,360.101 1073.06,325.074 1075.41,387.614 1077.76,354.465 1080.11,560.768 1082.46,331.784 1084.81,309.427 1087.16,457.924 1089.51,334.176 1091.87,388.476 1094.22,279.88 1096.57,416.037 1098.92,463.843 1101.27,192.278 1103.62,214.797 1105.97,414.001 1108.32,561.134 1110.67,502.393 1113.02,390.533 1115.37,530.785 1117.72,295.775 1120.07,379.792 1122.42,465.431 1124.77,368.4 1127.12,420.113 1129.47,463.385 1131.82,455.97 1134.17,441.889 1136.52,334.022 1138.87,335.093 1141.23,448.465 1143.58,527.239 1145.93,353.741 1148.28,311.063 1150.63,542.241 1152.98,389.158 1155.33,452.645 1157.68,359.785 1160.03,335.862 1162.38,396.746 1164.73,358.155 1167.08,487.087 1169.43,245.988 1171.78,350.194 1174.13,328.967 1176.48,426.628 1178.83,311.18 1181.18,498.571 1183.53,441.615 1185.88,360.302 1188.23,411.137 1190.59,438.342 1192.94,473.507 1195.29,406.653 1197.64,432.705 1199.99,444.046 1202.34,402.38 1204.69,220.342 1207.04,569.422 1209.39,483.044 1211.74,274.253 1214.09,275.838 1216.44,415.562 1218.79,440.598 1221.14,651.378 1223.49,302.809 1225.84,431.701 1228.19,512.386 1230.54,390.644 1232.89,284.853 1235.24,417.16 1237.59,404.426 1239.94,427.765 1242.3,462.664 1244.65,482.724 1247,484.081 1249.35,321.976 1251.7,435.305 1254.05,222.616 1256.4,414.517 1258.75,319.01 1261.1,381.485 1263.45,449.08 1265.8,424.7 1268.15,567.428 1270.5,277.157 1272.85,347.288 1275.2,416.466 1277.55,266.205 1279.9,422.789 1282.25,560.945 1284.6,356.954 1286.95,468.022 1289.3,468.046 1291.66,384.693 1294.01,330.188 1296.36,405.516 1298.71,272.489 1301.06,573.908 1303.41,355.02 1305.76,315.163 1308.11,458.362 1310.46,468.53 1312.81,433.199 1315.16,307.255 1317.51,465.986 1319.86,406.142 1322.21,464.039 1324.56,590.027 1326.91,466.779 1329.26,484.678 1331.61,318.87 1333.96,322.598 1336.31,179.074 1338.66,352.045 1341.02,277.503 1343.37,121.29 1345.72,217.959 1348.07,441.036 1350.42,503.862 1352.77,346.971 1355.12,417.972 1357.47,262.996 1359.82,411.435 1362.17,489.277 1364.52,398.422 1366.87,360.978 1369.22,540.309 1371.57,330.606 1373.92,557.426 1376.27,487.921 1378.62,447.327 1380.97,419.149 1383.32,276.705 1385.67,501.432 1388.02,334.819 1390.38,475.562 1392.73,568.519 1395.08,393.006 1397.43,250.874 1399.78,488.059 1402.13,712.029 1404.48,230.248 1406.83,364.01 1409.18,487.094 1411.53,225.086 1413.88,452.554 1416.23,318.966 1418.58,407.189 1420.93,340.71 1423.28,459.306 1425.63,511.988 1427.98,401.86 1430.33,465.841 1432.68,253.367 1435.03,309.777 1437.38,370.882 1439.74,367.294 1442.09,296.723 1444.44,207.278 1446.79,262.268 1449.14,424.333 1451.49,273.177 1453.84,598.195 1456.19,430.991 1458.54,383.753 1460.89,457.918 1463.24,514.267 1465.59,291.632 1467.94,400.245 1470.29,441.476 1472.64,223.552 1474.99,388.448 1477.34,376.338 1479.69,568.737 1482.04,382.629 1484.39,292.993 1486.74,361.813 1489.1,434.26 1491.45,491.538 1493.8,370.239 1496.15,249.024 1498.5,285.842 1500.85,488.409 1503.2,312.173 1505.55,322.22 1507.9,581.149 1510.25,331.904 1512.6,375.604 1514.95,290.198 1517.3,418.075 1519.65,341.498 1522,454.397 1524.35,458.304 1526.7,391.41 1529.05,421.86 1531.4,425.969 1533.75,265.908 1536.1,231.407 1538.45,481.773 1540.81,414.326 1543.16,296.148 1545.51,295.664 1547.86,464.303 1550.21,527.623 1552.56,494.176 1554.91,476.685 1557.26,557.753 1559.61,457.415 1561.96,300.681 1564.31,383.436 1566.66,383.102 1569.01,464.941 1571.36,373.136 1573.71,483.657 1576.06,348.382 1578.41,297.106 1580.76,283.012 1583.11,486.709 1585.46,380.878 1587.81,335.395 1590.17,340.014 1592.52,426.125 1594.87,661.267 1597.22,402.594 1599.57,374.085 1601.92,457.97 1604.27,278.126 1606.62,304.806 1608.97,499.12 1611.32,417.128 1613.67,444.583 1616.02,426.017 1618.37,281.515 1620.72,442.365 1623.07,475.597 1625.42,206.715 1627.77,356.061 1630.12,376.033 1632.47,347.683 1634.82,513.295 1637.17,513.415 1639.53,308.211 1641.88,409.487 1644.23,282.119 1646.58,96.8724 1648.93,310.92 1651.28,530.886 1653.63,355.329 1655.98,448.766 1658.33,443.965 1660.68,257.998 1663.03,283.442 1665.38,371.112 1667.73,347.885 1670.08,395.542 1672.43,564.972 1674.78,425.777 1677.13,325.892 1679.48,367.812 1681.83,316.611 1684.18,415.827 1686.53,329.461 1688.89,548.546 1691.24,402.523 1693.59,304.157 1695.94,413.077 1698.29,292.424 1700.64,454.084 1702.99,398.352 1705.34,549.586 1707.69,506.858 1710.04,294.025 1712.39,310.523 1714.74,466.817 1717.09,562.649 1719.44,340.924 1721.79,305.826 1724.14,342.333 1726.49,508.206 1728.84,404.57 1731.19,332.938 1733.54,449.494 1735.89,402.247 1738.25,420.296 1740.6,342.954 1742.95,281.685 1745.3,504.167 1747.65,493.531 1750,259.501 1752.35,234.033 1754.7,422.458 1757.05,395.03 1759.4,407.686 1761.75,272.321 1764.1,539.812 1766.45,399.491 1768.8,525.195 1771.15,497.259 1773.5,431.554 1775.85,368.789 1778.2,269.196 1780.55,313.376 1782.9,477.711 1785.25,296.171 1787.6,449.66 1789.96,480.349 1792.31,401.934 1794.66,566.658 1797.01,530.417 1799.36,438.437 1801.71,473.052 1804.06,404.581 1806.41,451.922 1808.76,446.366 1811.11,409.367 1813.46,385.344 1815.81,569.841 1818.16,311.106 1820.51,334.871 1822.86,344.243 1825.21,557.658 1827.56,452.819 1829.91,386.774 1832.26,568.69 1834.61,389.165 1836.96,254.068 1839.32,367.641 1841.67,333.808 1844.02,318.762 1846.37,328.644 1848.72,348.162 1851.07,411.723 1853.42,287.115 1855.77,307.833 1858.12,532.325 1860.47,249.887 1862.82,520.561 1865.17,541.99 1867.52,361.872 1869.87,325.445 1872.22,315.648 1874.57,337.498 1876.92,429.941 1879.27,261.828 1881.62,528.091 1883.97,467.032 1886.32,270.627 1888.68,258.852 1891.03,474.424 1893.38,428.105 1895.73,474.95 1898.08,361.891 1900.43,437.512 1902.78,375.05 1905.13,474.112 1907.48,469.438 1909.83,522.404 1912.18,486.07 1914.53,411.602 1916.88,279.57 1919.23,491.884 1921.58,442.53 1923.93,284.377 1926.28,290.177 1928.63,536.846 1930.98,367.205 1933.33,466.811 1935.68,527.989 1938.04,397.471 1940.39,361.987 1942.74,400.875 1945.09,410.733 1947.44,303.523 1949.79,494.864 1952.14,183.846 1954.49,347.955 1956.84,475.832 1959.19,467.296 1961.54,410.383 1963.89,386.309 1966.24,224.61 1968.59,339.55 1970.94,434.333 1973.29,483.725 1975.64,282.696 1977.99,245.366 1980.34,527.179 1982.69,363.562 1985.04,378.171 1987.4,289.57 1989.75,357.69 1992.1,382.13 1994.45,489.628 1996.8,428.159 1999.15,218.416 2001.5,572.316 2003.85,215.595 2006.2,503.816 2008.55,446.141 2010.9,302.746 2013.25,592.455 2015.6,224.971 2017.95,420.202 2020.3,455.336 2022.65,242.446 2025,427.392 2027.35,493.95 2029.7,526.661 2032.05,380.499 2034.4,274.938 2036.76,380.563 2039.11,424.351 2041.46,562.309 2043.81,528.442 2046.16,483.765 2048.51,591.301 2050.86,514.449 2053.21,152.593 2055.56,433.162 2057.91,314.954 2060.26,488.498 2062.61,430.414 2064.96,354.798 2067.31,325.573 2069.66,443.11 2072.01,370.001 2074.36,411.511 2076.71,337.017 2079.06,661.821 2081.41,462.403 2083.76,225.141 2086.11,323.726 2088.47,444.425 2090.82,350.241 2093.17,393.376 2095.52,393.168 2097.87,406.006 2100.22,321.795 2102.57,379.33 2104.92,347.842 2107.27,338.166 2109.62,390.722 2111.97,402.948 2114.32,348.238 2116.67,160.947 2119.02,407.567 2121.37,463.579 2123.72,296.495 2126.07,412.627 2128.42,426.815 2130.77,365.866 2133.12,546.092 2135.47,494.227 2137.83,205.881 2140.18,580.101 2142.53,377.523 2144.88,619.347 2147.23,441.043 2149.58,392.987 2151.93,499.462 2154.28,615.101 2156.63,481.292 2158.98,398.224 2161.33,466.436 2163.68,242.6 2166.03,304.169 2168.38,260.002 2170.73,340.382 2173.08,334.036 2175.43,274.696 2177.78,478.982 2180.13,554.548 2182.48,263.465 2184.83,310.814 2187.19,505.626 2189.54,333.431 2191.89,520.897 2194.24,484.483 2196.59,308.988 2198.94,344.476 2201.29,385.14 2203.64,287.251 2205.99,467.22 2208.34,615.305 2210.69,369.697 2213.04,498.017 2215.39,566.571 2217.74,393.315 2220.09,509.784 2222.44,349.219 2224.79,522.168 2227.14,337.163 2229.49,351.105 2231.84,288.576 2234.19,357.969 2236.55,570.64 2238.9,490.093 2241.25,266.317 2243.6,453.229 2245.95,266.663 2248.3,394.832 2250.65,586.266 2253,505.023 2255.35,523.158 2257.7,400.743 2260.05,273.421 2262.4,417.478 2264.75,435.032 2267.1,296.252 2269.45,413.296 2271.8,413.967 2274.15,343.082 2276.5,485.777 2278.85,533.641 2281.2,484.444 2283.55,243.964 2285.91,441.704 2288.26,208.536 2290.61,344.469 2292.96,684.66 2295.31,443.707 2297.66,493.829 2300.01,435.169 2302.36,427.801 2304.71,407.284 2307.06,482.072 2309.41,301.326 2311.76,311.139 2314.11,512.71 2316.46,604.002 2318.81,552.122 2321.16,335.756 2323.51,480.748 2325.86,592.064 2328.21,569.905 2330.56,291.565 2332.91,397.68 2335.27,365.853 2337.62,333.13 2339.97,365.093 2342.32,424.458 2344.67,401.516 2347.02,418.004 2349.37,224.296 2351.72,436.62 2354.07,413.913 2356.42,308.218 2358.77,356.824 2361.12,539.06 2363.47,341.322 2365.82,311.71 2368.17,359.543 2370.52,700.095 2372.87,447.246 2375.22,372.608 2377.57,591.488 2379.92,512.803 2382.27,277.724 2384.62,434.938 2386.98,453.324 2389.33,412.509 2391.68,588.627 2394.03,368.74 2396.38,476.777 2398.73,347.662 2401.08,327.68 2403.43,278.913 2405.78,295.838 2408.13,365.884 2410.48,517.176 2412.83,279.651 2415.18,411.428 2417.53,364.21 2419.88,170.931 2422.23,428.096 2424.58,308.452 2426.93,434.788 2429.28,397.569 2431.63,564.31 2433.98,495.591 2436.34,542.172 2438.69,344.127 2441.04,358.589 2443.39,411.136 2445.74,391.444 2448.09,348.359 2450.44,411.999 2452.79,380.471 2455.14,330.82 2457.49,237.132 2459.84,536.994 2462.19,358.539 2464.54,542.638 2466.89,348.345 2469.24,389.043 2471.59,248.422 2473.94,352.646 2476.29,412.072 2478.64,289.416 2480.99,433.571 2483.34,398.096 2485.7,281.62 2488.05,445.383 2490.4,199.676 2492.75,374.404 2495.1,398.581 2497.45,397.489 2499.8,441.81 2502.15,410.206 2504.5,285.437 2506.85,457.039 2509.2,297.953 2511.55,232.34 2513.9,541.787 2516.25,332.375 2518.6,332.176 2520.95,586.019 2523.3,473.08 2525.65,413.576 2528,326.222 2530.35,309.664 2532.7,323.18 2535.06,205.537 2537.41,350.886 2539.76,248.43 2542.11,285.425 2544.46,470.381 2546.81,266.464 2549.16,410.92 2551.51,338.97 2553.86,517.152 2556.21,126.407 2558.56,309.484 2560.91,423.999 2563.26,434.178 2565.61,324.43 2567.96,317.208 2570.31,363.942 "></polyline>
</svg>
</div>
</div>
<p>Look at that! Things are working; amazin’.</p>
<p>We can also exploit <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>’s parallel sampling capabilities:</p>
<div id="34" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run separate 4 chains for 10 000 iterations using threads to parallelize.</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>num_chains <span class="op">=</span> <span class="fl">4</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    model_with_grad,</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">MCMCThreads</span>(),</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>,</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    num_chains;</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Note we need to provide an initial state for every chain.</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>    initial_state<span class="op">=</span><span class="fu">fill</span>(state, num_chains),</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>samples_array <span class="op">=</span> <span class="fu">stack</span>(<span class="fu">map</span>(<span class="bu">Base</span>.<span class="fu">Fix1</span>(stack, sample <span class="op">-&gt;</span> sample.x), samples))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000×4 Array{Float64, 3}:
[:, :, 1] =
 -2.24349  -3.43126   -4.38053   …  -5.78883   -5.03885   -3.97646
  1.41815   0.951764   0.250041     -0.242751   0.526591   0.333956
  1.99898   3.83028    3.75546       4.02259    3.96426    5.42645

[:, :, 2] =
 -1.50467  -1.7434   -4.29     -4.29     …  -6.41252  -5.2382   -5.2382
  1.50575   1.51004   1.81078   1.81078      1.21225   1.62668   1.62668
  2.66465   3.00001   3.24705   3.24705      5.05973   3.83765   3.83765

[:, :, 3] =
 -1.35408   -0.934289  -1.68747   -1.74583   …  -5.158     -2.98038  -2.98038
 -0.585656  -0.104657  -0.205105   0.894073     -0.370938  -1.83116  -1.83116
  2.42107    3.15456    2.40609    2.46091       2.6228     5.71469   5.71469

[:, :, 4] =
 -1.21551   -2.96569   -4.69122  -4.03495  …  -5.24956  -4.19654   -5.39629
 -0.588707  -0.368116  -2.30979  -0.62706     -1.40935  -0.691321  -0.0547883
  1.99158    4.75904    4.8778    5.32307      4.66726   4.56329    5.38309</code></pre>
</div>
</div>
<p>But the fact that we have to provide the <code>AbstractMCMC.sample</code> call, etc. with an <code>initial_state</code> to get started is a bit annoying. We can avoid this by also defining a <code>AbstractMCMC.step</code> <em>without</em> the <code>state</code> argument:</p>
<div id="36" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">::</span><span class="dt">MALA</span>;</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># </span><span class="al">NOTE</span><span class="co">: No state provided!</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just create the initial state by sampling using  a Gaussian.</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="fu">randn</span>(rng, LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(x), <span class="fu">MALAState</span>(x)</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Equipped with this, we no longer need to provide the <code>initial_state</code> everywhere:</p>
<div id="38" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -4.97746    1.01112
  0.0116811  1.01035
  5.00222    1.02045</code></pre>
</div>
</div>
</section>
<section id="using-our-sampler-with-turing.jl" class="level2">
<h2 class="anchored" data-anchor-id="using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</h2>
<p>As we promised, all of this hassle of implementing our <code>MALA</code> sampler in a way that uses <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> and <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> gets us something more than <em>just</em> an “automatic” implementation of <code>AbstractMCMC.sample</code>.</p>
<p>It also enables use with Turing.jl through the <code>externalsampler</code>, but we need to do one final thing first: we need to tell Turing.jl how to extract a vector of parameters from the “sample” returned in our implementation of <code>AbstractMCMC.step</code>. In our case, the “sample” is a <code>MALASample</code>, so we just need the following line:</p>
<div id="40" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load Turing.jl.</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Turing</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Overload the `getparams` method for our "sample" type, which is just a vector.</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>Turing.Inference.<span class="fu">getparams</span>(<span class="op">::</span><span class="dt">Turing.Model</span>, sample<span class="op">::</span><span class="dt">MALASample</span>) <span class="op">=</span> sample.x</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And with that, we’re good to go!</p>
<div id="42" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Our previous model defined as a Turing.jl model.</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">mvnormal_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">MvNormal</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.], I)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate our model.</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">mvnormal_model</span>()</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Call `sample` but now we're passing in a Turing.jl `model` and wrapping</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co"># our `MALA` sampler in the `externalsampler` to tell Turing.jl that the sampler</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co"># expects something that implements LogDensityProblems.jl.</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×4×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 2.93 seconds
Compute duration  = 2.93 seconds
parameters        = x[1], x[2], x[3]
internals         = lp

Summary Statistics
  parameters      mean       std      mcse    ess_bulk    ess_tail      rhat   ⋯
      Symbol   Float64   Float64   Float64     Float64     Float64   Float64   ⋯

        x[1]   -4.9741    0.9968    0.0167   3550.3016   5540.3799    1.0003   ⋯
        x[2]   -0.0094    0.9867    0.0168   3470.8700   4807.6256    0.9999   ⋯
        x[3]    4.9757    0.9988    0.0172   3370.3453   5210.5797    0.9999   ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

        x[1]   -6.9351   -5.6352   -4.9885   -4.3012   -3.0149
        x[2]   -1.9474   -0.6781    0.0056    0.6692    1.9103
        x[3]    3.0164    4.2989    4.9877    5.6409    6.9485</code></pre>
</div>
</div>
<p>Pretty neat, eh?</p>
<section id="models-with-constrained-parameters" class="level3">
<h3 class="anchored" data-anchor-id="models-with-constrained-parameters">Models with constrained parameters</h3>
<p>One thing we’ve sort of glossed over in all of the above is that MALA, at least how we’ve implemented it, requires <span class="math inline">\(x\)</span> to live in <span class="math inline">\(\mathbb{R}^d\)</span> for some <span class="math inline">\(d &gt; 0\)</span>. If some of the parameters were in fact constrained, e.g.&nbsp;we were working with a <code>Beta</code> distribution which has support on the interval <span class="math inline">\((0, 1)\)</span>, <em>not</em> on <span class="math inline">\(\mathbb{R}^d\)</span>, we could easily end up outside of the valid range <span class="math inline">\((0, 1)\)</span>.</p>
<div id="44" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">beta_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">beta_model</span>()</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 1.7 seconds
Compute duration  = 1.7 seconds
parameters        = x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse    ess_bulk    ess_tail      rhat   ⋯
      Symbol   Float64   Float64   Float64     Float64     Float64   Float64   ⋯

           x    0.5012    0.1883    0.0030   3879.6264   5642.6409    1.0005   ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

           x    0.1441    0.3622    0.5024    0.6402    0.8571</code></pre>
</div>
</div>
<p>Yep, that still works, but only because Turing.jl actually <em>transforms</em> the <code>turing_model</code> from constrained to unconstrained, so that the <code>sampler</code> provided to <code>externalsampler</code> is actually always working in unconstrained space! This is not always desirable, so we can turn this off:</p>
<div id="46" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 0.26 seconds
Compute duration  = 0.26 seconds
parameters        = x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse   ess_bulk   ess_tail      rhat   e ⋯
      Symbol   Float64   Float64   Float64    Float64    Float64   Float64     ⋯

           x    0.1392    0.0000    0.0000        NaN        NaN       NaN     ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

           x    0.1392    0.1392    0.1392    0.1392    0.1392</code></pre>
</div>
</div>
<p>The fun thing is that this still sort of works because</p>
<div id="48" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">logpdf</span>(<span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>), <span class="fl">10.0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-Inf</code></pre>
</div>
</div>
<p>and so the samples that fall outside of the range are always rejected. But do notice how much worse all the diagnostics are, e.g.&nbsp;<code>ess_tail</code> is very poor compared to when we use <code>unconstrained=true</code>. Moreover, in more complex cases this won’t just result in a “nice” <code>-Inf</code> log-density value, but instead will error:</p>
<div id="50" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="kw">function</span> <span class="fu">demo</span>()</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>    σ² <span class="op">~</span> <span class="fu">truncated</span>(<span class="fu">Normal</span>(), lower<span class="op">=</span><span class="fl">0</span>)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If we end up with negative values for `σ²`, the `Normal` will error.</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>    x <span class="op">~</span> <span class="fu">Normal</span>(<span class="fl">0</span>, σ²)</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>DomainError: DomainError(Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}}(-2.949431525158351,1.0,0.0), "Normal: the condition σ &gt;= zero(σ) is not satisfied.")
DomainError with Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}}(-2.949431525158351,1.0,0.0):
Normal: the condition σ &gt;= zero(σ) is not satisfied.
Stacktrace:
  [1] #371
    @ ~/.julia/packages/Distributions/nmUhn/src/univariate/continuous/normal.jl:37 [inlined]
  [2] check_args
    @ ~/.julia/packages/Distributions/nmUhn/src/utils.jl:89 [inlined]
  [3] #Normal#370
    @ ~/.julia/packages/Distributions/nmUhn/src/univariate/continuous/normal.jl:37 [inlined]
  [4] Normal
    @ ~/.julia/packages/Distributions/nmUhn/src/univariate/continuous/normal.jl:36 [inlined]
  [5] Normal
    @ ~/.julia/packages/Distributions/nmUhn/src/univariate/continuous/normal.jl:42 [inlined]
  [6] macro expansion
    @ ~/.julia/packages/DynamicPPL/MjWTB/src/compiler.jl:579 [inlined]
  [7] demo(__model__::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, __varinfo__::DynamicPPL.ThreadSafeVarInfo{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}, Vector{Set{DynamicPPL.Selector}}}}, ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}, Vector{Base.RefValue{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}, __context__::DynamicPPL.DefaultContext)
    @ Main.Notebook ~/work/docs/docs/tutorials/docs-17-implementing-samplers/index.qmd:592
  [8] _evaluate!!
    @ ~/.julia/packages/DynamicPPL/MjWTB/src/model.jl:973 [inlined]
  [9] evaluate_threadsafe!!(model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, varinfo::DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}, Vector{Set{DynamicPPL.Selector}}}}, ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}, context::DynamicPPL.DefaultContext)
    @ DynamicPPL ~/.julia/packages/DynamicPPL/MjWTB/src/model.jl:962
 [10] evaluate!!
    @ ~/.julia/packages/DynamicPPL/MjWTB/src/model.jl:892 [inlined]
 [11] logdensity
    @ ~/.julia/packages/DynamicPPL/MjWTB/src/logdensityfunction.jl:140 [inlined]
 [12] Fix1
    @ ./operators.jl:1118 [inlined]
 [13] vector_mode_dual_eval!(f::Base.Fix1{typeof(LogDensityProblems.logdensity), LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, Nothing}}, cfg::ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}, x::Vector{Float64})
    @ ForwardDiff ~/.julia/packages/ForwardDiff/PcZ48/src/apiutils.jl:24
 [14] vector_mode_gradient!(result::DiffResults.MutableDiffResult{1, Float64, Tuple{Vector{Float64}}}, f::Base.Fix1{typeof(LogDensityProblems.logdensity), LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, Nothing}}, x::Vector{Float64}, cfg::ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}})
    @ ForwardDiff ~/.julia/packages/ForwardDiff/PcZ48/src/gradient.jl:96
 [15] gradient!
    @ ~/.julia/packages/ForwardDiff/PcZ48/src/gradient.jl:37 [inlined]
 [16] gradient!
    @ ~/.julia/packages/ForwardDiff/PcZ48/src/gradient.jl:35 [inlined]
 [17] logdensity_and_gradient
    @ ~/.julia/packages/LogDensityProblemsAD/rBlLq/ext/LogDensityProblemsADForwardDiffExt.jl:118 [inlined]
 [18] leapfrog_step(model::LogDensityProblemsADForwardDiffExt.ForwardDiffLogDensity{LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, Nothing}, ForwardDiff.Chunk{2}, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}, x::Vector{Float64}, p::Vector{Float64}, ϵ::Int64, M::UniformScaling{Bool})
    @ Main.Notebook ~/work/docs/docs/tutorials/docs-17-implementing-samplers/index.qmd:369
 [19] step(rng::TaskLocalRNG, model_wrapper::AbstractMCMC.LogDensityModel{LogDensityProblemsADForwardDiffExt.ForwardDiffLogDensity{LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, Nothing}, ForwardDiff.Chunk{2}, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}}, sampler::MALA{Int64, UniformScaling{Bool}}, state::MALAState{Vector{Float64}}; kwargs::@Kwargs{})
    @ Main.Notebook ~/work/docs/docs/tutorials/docs-17-implementing-samplers/index.qmd:334
 [20] step
    @ ~/work/docs/docs/tutorials/docs-17-implementing-samplers/index.qmd:316 [inlined]
 [21] #step#107
    @ ~/.julia/packages/Turing/Bv30p/src/mcmc/abstractmcmc.jl:155 [inlined]
 [22] step(rng::TaskLocalRNG, model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, sampler_wrapper::DynamicPPL.Sampler{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}, state::Turing.Inference.TuringState{MALAState{Vector{Float64}}, LogDensityProblemsADForwardDiffExt.ForwardDiffLogDensity{LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, Nothing}, ForwardDiff.Chunk{2}, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}})
    @ Turing.Inference ~/.julia/packages/Turing/Bv30p/src/mcmc/abstractmcmc.jl:144
 [23] macro expansion
    @ ~/.julia/packages/AbstractMCMC/YrmkI/src/sample.jl:176 [inlined]
 [24] macro expansion
    @ ~/.julia/packages/AbstractMCMC/YrmkI/src/logging.jl:16 [inlined]
 [25] mcmcsample(rng::TaskLocalRNG, model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, sampler::DynamicPPL.Sampler{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}, N::Int64; progress::Bool, progressname::String, callback::Nothing, discard_initial::Int64, thinning::Int64, chain_type::Type, initial_state::Nothing, kwargs::@Kwargs{})
    @ AbstractMCMC ~/.julia/packages/AbstractMCMC/YrmkI/src/sample.jl:120
 [26] sample(rng::TaskLocalRNG, model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, sampler::DynamicPPL.Sampler{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}, N::Int64; chain_type::Type, resume_from::Nothing, initial_state::Nothing, kwargs::@Kwargs{progress::Bool})
    @ DynamicPPL ~/.julia/packages/DynamicPPL/MjWTB/src/sampler.jl:93
 [27] sample
    @ ~/.julia/packages/DynamicPPL/MjWTB/src/sampler.jl:83 [inlined]
 [28] #sample#4
    @ ~/.julia/packages/Turing/Bv30p/src/mcmc/Inference.jl:276 [inlined]
 [29] sample
    @ ~/.julia/packages/Turing/Bv30p/src/mcmc/Inference.jl:267 [inlined]
 [30] #sample#3
    @ ~/.julia/packages/Turing/Bv30p/src/mcmc/Inference.jl:264 [inlined]
 [31] top-level scope
    @ ~/work/docs/docs/tutorials/docs-17-implementing-samplers/index.qmd:594</code></pre>
</div>
</div>
<p>As expected, we run into a <code>DomainError</code> at some point, while if we set <code>unconstrained=true</code>, letting Turing.jl transform the model to a unconstrained form behind the scenes, everything works as expected:</p>
<div id="52" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 0.59 seconds
Compute duration  = 0.59 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse   ess_bulk   ess_tail      rhat   e ⋯
      Symbol   Float64   Float64   Float64    Float64    Float64   Float64     ⋯

          σ²    4.7231    0.0000    0.0000        NaN        NaN       NaN     ⋯
           x   -0.4680    0.0000    0.0000        NaN        NaN       NaN     ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

          σ²    4.7231    4.7231    4.7231    4.7231    4.7231
           x   -0.4680   -0.4680   -0.4680   -0.4680   -0.4680</code></pre>
</div>
</div>
<p>Neat!</p>
<p>Similarly, which automatic differentiation backend one should use can be specified through the <code>adtype</code> keyword argument too. For example, if we want to use <a href="https://github.com/JuliaDiff/ReverseDiff.jl">ReverseDiff.jl</a> instead of the default <a href="https://github.com/JuliaDiff/ForwardDiff.jl">ForwardDiff.jl</a>:</p>
<div id="54" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">ReverseDiff</span>: ReverseDiff</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify that we want to use `AutoReverseDiff`.</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">demo</span>(),</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>, adtype<span class="op">=</span><span class="fu">AutoReverseDiff</span>()),</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>;</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 3.47 seconds
Compute duration  = 3.47 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse   ess_bulk   ess_tail      rhat   e ⋯
      Symbol   Float64   Float64   Float64    Float64    Float64   Float64     ⋯

          σ²    5.2131    0.0000    0.0000        NaN        NaN       NaN     ⋯
           x    0.8319    0.0000    0.0000        NaN        NaN       NaN     ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

          σ²    5.2131    5.2131    5.2131    5.2131    5.2131
           x    0.8319    0.8319    0.8319    0.8319    0.8319</code></pre>
</div>
</div>
<p>Double-neat.</p>
</section>
</section>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<p>At this point it’s worth maybe reminding ourselves what we did and also <em>why</em> we did it:</p>
<ol type="1">
<li>We define our models in the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface because it makes the sampler agnostic to how the underlying model is implemented.</li>
<li>We implement our sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> interface, which just means that our sampler is a subtype of <code>AbstractMCMC.AbstractSampler</code> and we implement the MCMC transition in <code>AbstractMCMC.step</code>.</li>
<li>Points 1 and 2 makes it so our sampler can be used with a wide range of model implementations, amongst them being models implemented in both Turing.jl and Stan. This gives you, the inference implementer, a large collection of models to test your inference method on, in addition to allowing users of Turing.jl and Stan to try out your inference method with minimal effort.</li>
</ol>


</section>


<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a><div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>We’re going with the leapfrog formulation because in a future version of this tutorial we’ll add a section extending this simple “baseline” MALA sampler to more complex versions. See <a href="https://github.com/TuringLang/docs/issues/479">issue #479</a> for progress on this.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>There is no such thing as a proper interface in Julia (at least not officially), and so we use the word “interface” here to mean a few minimal methods that needs to be implemented by any type that we treat as a target model.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/turinglang\.org\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../tutorials/docs-07-for-developers-variational-inference/index.html" class="pagination-link" aria-label="Variational Inference">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Variational Inference</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Turing is created by <a href="http://mlg.eng.cam.ac.uk/hong/" target="_blank">Hong Ge</a>, and lovingly maintained by the <a href="https://github.com/TuringLang/Turing.jl/graphs/contributors" target="_blank">core team</a> of volunteers. <br> The contents of this website are © 2024 under the terms of the <a href="https://github.com/TuringLang/Turing.jl/blob/master/LICENCE" target="_blank">MIT License</a>.</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/TuringLang/docs/edit/master/tutorials/docs-17-implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/docs/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://x.com/TuringLang">
      <i class="bi bi-twitter" role="img" aria-label="Turing Twitter">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/TuringLang/Turing.jl">
      <i class="bi bi-github" role="img" aria-label="Turing GitHub">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




<script src="../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>