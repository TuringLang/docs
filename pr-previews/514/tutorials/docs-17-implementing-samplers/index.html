<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Implementing samplers – Turing.jl</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../tutorials/docs-07-for-developers-variational-inference/index.html" rel="prev">
<link href="../../assets/favicon.ico" rel="icon">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<style>
  a {
    text-decoration: none;
  }
  a:hover {
    text-decoration: underline;
  }
</style>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../theming/styles.css">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="https://turinglang.org/" class="navbar-brand navbar-brand-logo">
    <img src="../../assets/images/turing-logo.svg" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="https://turinglang.org/">
    <span class="navbar-title">Turing.jl</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../tutorials/docs-00-getting-started/"> 
<span class="menu-text">Get Started</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../tutorials/00-introduction/"> 
<span class="menu-text">Tutorials</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/library/"> 
<span class="menu-text">Libraries</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/news/"> 
<span class="menu-text">News</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/team/"> 
<span class="menu-text">Team</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-v0.34" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">v0.34</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-v0.34">    
        <li>
    <a class="dropdown-item" href="https://turinglang.org/docs/changelog.html">
 <span class="dropdown-text">Changelog</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://turinglang.org/docs/versions.html">
 <span class="dropdown-text">All Versions</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
    <a href="https://x.com/TuringLang" title="Turing Twitter" class="quarto-navigation-tool px-1" aria-label="Turing Twitter"><i class="bi bi-twitter"></i></a>
    <a href="https://github.com/TuringLang/Turing.jl" title="Turing GitHub" class="quarto-navigation-tool px-1" aria-label="Turing GitHub"><i class="bi bi-github"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">For Developers</li><li class="breadcrumb-item"><a href="../../tutorials/docs-04-for-developers-abstractmcmc-turing/index.html">Developers: Inference</a></li><li class="breadcrumb-item"><a href="../../tutorials/docs-17-implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false">
 <span class="menu-text">For Users</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false">
 <span class="menu-text">Using the Turing library</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-00-getting-started/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Getting Started</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/00-introduction/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction to Turing</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-12-using-turing-guide/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Turing’s Core Functionality</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-17-mode-estimation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Mode Estimation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-09-using-turing-advanced/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Advanced Usage</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-10-using-turing-autodiff/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Automatic Differentiation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-13-using-turing-performance-tips/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Performance Tips</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-11-using-turing-dynamichmc/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using DynamicHMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-15-using-turing-sampler-viz/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Sampler Visualization</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-16-using-turing-external-samplers/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">External Samplers</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false">
 <span class="menu-text">Examples of Turing Models</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/01-gaussian-mixture-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Mixture Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/02-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/03-bayesian-neural-network/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Neural Networks</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/04-hidden-markov-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Hidden Markov Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/05-linear-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Linear Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/06-infinite-mixture-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Infinite Mixture Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/07-poisson-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Poisson Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/08-multinomial-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Multinomial Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/09-variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/10-bayesian-differential-equations/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Differential Equations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/11-probabilistic-pca/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Probabilistic PCA</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/13-seasonal-time-series/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Time Series Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/15-gaussian-processes/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction to Gaussian Processes</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/12-gplvm/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Process Latent Variable Models</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">For Developers</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false">
 <span class="menu-text">Contributing</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-01-contributing-guide/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">How to Contribute</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="false">
 <span class="menu-text">How Turing Works</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-05-for-developers-compiler/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Turing Compiler Design</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/14-minituring/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation I: Compiler</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/16-contexts/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation II: Contexts</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-06-for-developers-interface/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Interface Guide</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true">
 <span class="menu-text">Developers: Inference</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-04-for-developers-abstractmcmc-turing/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">How Turing implements AbstractMCMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-07-for-developers-variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-17-implementing-samplers/index.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Implementing Samplers</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of Contents</h2>
   
  <ul>
  <li><a href="#quick-overview-of-mala" id="toc-quick-overview-of-mala" class="nav-link active" data-scroll-target="#quick-overview-of-mala">Quick overview of MALA</a></li>
  <li><a href="#what-we-need-from-a-model-logdensityproblems.jl" id="toc-what-we-need-from-a-model-logdensityproblems.jl" class="nav-link" data-scroll-target="#what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: LogDensityProblems.jl</a></li>
  <li><a href="#implementing-mala-in-abstractmcmc.jl" id="toc-implementing-mala-in-abstractmcmc.jl" class="nav-link" data-scroll-target="#implementing-mala-in-abstractmcmc.jl">Implementing MALA in AbstractMCMC.jl</a></li>
  <li><a href="#using-our-sampler-with-turing.jl" id="toc-using-our-sampler-with-turing.jl" class="nav-link" data-scroll-target="#using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</a>
  <ul class="collapse">
  <li><a href="#models-with-constrained-parameters" id="toc-models-with-constrained-parameters" class="nav-link" data-scroll-target="#models-with-constrained-parameters">Models with constrained parameters</a></li>
  </ul></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/TuringLang/docs/edit/master/tutorials/docs-17-implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/docs/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">For Developers</li><li class="breadcrumb-item"><a href="../../tutorials/docs-04-for-developers-abstractmcmc-turing/index.html">Developers: Inference</a></li><li class="breadcrumb-item"><a href="../../tutorials/docs-17-implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Implementing samplers</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>In this tutorial, we’ll go through step-by-step how to implement a “simple” sampler in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> in such a way that it can be easily applied to Turing.jl models.</p>
<p>In particular, we’re going to implement a version of <strong>Metropolis-adjusted Langevin (MALA)</strong>.</p>
<p>Note that we will implement this sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> framework, completely “ignoring” Turing.jl until the very end of the tutorial, at which point we’ll use a single line of code to make the resulting sampler available to Turing.jl. This is to really drive home the point that one can implement samplers in a way that is accessible to all of Turing.jl’s users without having to use Turing.jl yourself.</p>
<section id="quick-overview-of-mala" class="level2">
<h2 class="anchored" data-anchor-id="quick-overview-of-mala">Quick overview of MALA</h2>
<p>We can view MALA as a single step of the leapfrog intergrator with resampling of momentum <span class="math inline">\(p\)</span> at every step.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> To make that statement a bit more concrete, we first define the <em>extended</em> target <span class="math inline">\(\bar{\gamma}(x, p)\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\log \bar{\gamma}(x, p) \propto \log \gamma(x) + \log \gamma_{\mathcal{N}(0, M)}(p)
\end{equation*}\]</span></p>
<p>where <span class="math inline">\(\gamma_{\mathcal{N}(0, M)}\)</span> denotes the density for a zero-centered Gaussian with covariance matrix <span class="math inline">\(M\)</span>. We then consider targeting this joint distribution over both <span class="math inline">\(x\)</span> and <span class="math inline">\(p\)</span> as follows. First we define the map</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  L_{\epsilon}: \quad &amp; \mathbb{R}^d \times \mathbb{R}^d \to \mathbb{R}^d \times \mathbb{R}^d \\
  &amp; (x, p) \mapsto (\tilde{x}, \tilde{p}) := L_{\epsilon}(x, p)
\end{split}
\end{equation*}\]</span></p>
<p>as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p_{1 / 2} &amp;:= p + \frac{\epsilon}{2} \nabla \log \gamma(x) \\
  \tilde{x} &amp;:= x + \epsilon M^{-1} p_{1 /2 } \\
  p_1 &amp;:= p_{1 / 2} + \frac{\epsilon}{2} \nabla \log \gamma(\tilde{x}) \\
  \tilde{p} &amp;:= - p_1
\end{split}
\end{equation*}\]</span></p>
<p>This might be familiar for some readers as a single step of the Leapfrog integrator. We then define the MALA kernel as follows: given the current iterate <span class="math inline">\(x_i\)</span>, we sample the next iterate <span class="math inline">\(x_{i + 1}\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p &amp;\sim \mathcal{N}(0, M) \\
  (\tilde{x}, \tilde{p}) &amp;:= L_{\epsilon}(x_i, p) \\
  \alpha &amp;:= \min \left\{ 1, \frac{\bar{\gamma}(\tilde{x}, \tilde{p})}{\bar{\gamma}(x_i, p)} \right\} \\
  x_{i + 1} &amp;:=
  \begin{cases}
    \tilde{x} \quad &amp; \text{ with prob. } \alpha \\
    x_i       \quad &amp; \text{ with prob. } 1 - \alpha
  \end{cases}
\end{split}
\end{equation*}\]</span></p>
<p>i.e.&nbsp;we accept the proposal <span class="math inline">\(\tilde{x}\)</span> with probability <span class="math inline">\(\alpha\)</span> and reject it, thus sticking with our current iterate, with probability <span class="math inline">\(1 - \alpha\)</span>.</p>
</section>
<section id="what-we-need-from-a-model-logdensityproblems.jl" class="level2">
<h2 class="anchored" data-anchor-id="what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a></h2>
<p>There are a few things we need from the “target” / “model” / density that we want to sample from:</p>
<ol type="1">
<li>We need access to log-density <em>evaluations</em> <span class="math inline">\(\log \gamma(x)\)</span> so we can compute the acceptance ratio involving <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>We need access to log-density <em>gradients</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span> so we can compute the Leapfrog steps <span class="math inline">\(L_{\epsilon}(x, p)\)</span>.</li>
<li>We also need access to the “size” of the model so we can determine the size of <span class="math inline">\(M\)</span>.</li>
</ol>
<p>Luckily for us, there is a package called <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> which provides an interface for <em>exactly</em> this!</p>
<p>To demonstrate how one can implement the “<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface”<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> we will use a simple Gaussian model as an example:</p>
<div id="4" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblems</span>: LogDensityProblems;</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's define some type that represents the model.</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> IsotropicNormalModel{M<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"mean of the isotropic Gaussian"</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    mean<span class="op">::</span><span class="dt">M</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Specifies what input length the model expects.</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">dimension</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> <span class="fu">length</span>(model.mean)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Implementation of the log-density evaluation of the model.</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x<span class="op">::</span><span class="dt">AbstractVector{&lt;:Real}</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">-</span> <span class="fu">sum</span>(abs2, x <span class="op">.-</span> model.mean) <span class="op">/</span> <span class="fl">2</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This gives us all of the properties we want for our MALA sampler with the exception of the computation of the <em>gradient</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span>. There is the method <code>LogDensityProblems.logdensity_and_gradient</code> which should return a 2-tuple where the first entry is the evaluation of the logdensity <span class="math inline">\(\log \gamma(x)\)</span> and the second entry is the gradient <span class="math inline">\(\nabla \log \gamma(x)\)</span>.</p>
<p>There are two ways to “implement” this method: 1) we implement it by hand, which is feasible in the case of our <code>IsotropicNormalModel</code>, or b) we defer the implementation of this to a automatic differentiation backend.</p>
<p>To implement it by hand we can simply do</p>
<div id="6" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl that first-order, i.e. gradient information, is available.</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{1}</span>()</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Implement `logdensity_and_gradient`.</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    logγ_x <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="op">-</span>x <span class="op">.*</span> (x <span class="op">-</span> model.mean)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> logγ_x, ∇logγ_x</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s just try it out:</p>
<div id="8" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate the problem.</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> <span class="fu">IsotropicNormalModel</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.])</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create some example input that we can test on.</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>x_example <span class="op">=</span> <span class="fu">randn</span>(LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate!</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-26.776308382992376</code></pre>
</div>
</div>
<p>To defer it to an automatic differentiation backend, we can do</p>
<div id="10" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl we only have access to 0-th order information.</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{0}</span>()</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Use `LogDensityProblemsAD`'s `ADgradient` in combination with some AD backend to implement `logdensity_and_gradient`.</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblemsAD</span>, <span class="bu">ADTypes</span>, <span class="bu">ForwardDiff</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>model_with_grad <span class="op">=</span> <span class="fu">ADgradient</span>(<span class="fu">AutoForwardDiff</span>(), model)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model_with_grad, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-26.776308382992376</code></pre>
</div>
</div>
<p>We’ll continue with the second approach in this tutorial since this is typically what one does in practice, because there are better hobbies to spend time on than deriving gradients by hand.</p>
<p>At this point, one might wonder how we’re going to tie this back to Turing.jl in the end. Effectively, when working with inference methods that only require log-density evaluations and / or higher-order information of the log-density, Turing.jl actually converts the user-provided <code>Model</code> into an object implementing the above methods for <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>. As a result, most samplers provided by Turing.jl are actually implemented to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, enabling their use both <em>within</em> Turing.jl and <em>outside</em> of Turing.jl! Morever, there exists similar conversions for Stan through BridgeStan and Stan<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, which means that a sampler supporting the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface can easily be used on both Turing.jl <em>and</em> Stan models (in addition to user-provided models, as our <code>IsotropicNormalModel</code> above)!</p>
<p>Anyways, let’s move on to actually implementing the sampler.</p>
</section>
<section id="implementing-mala-in-abstractmcmc.jl" class="level2">
<h2 class="anchored" data-anchor-id="implementing-mala-in-abstractmcmc.jl">Implementing MALA in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a></h2>
<p>Now that we’ve established that a model implementing the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface provides us with all the information we need from <span class="math inline">\(\log \gamma(x)\)</span>, we can address the question: given an object that implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, how can we define a sampler for it?</p>
<p>We’re going to do this by making our sampler a sub-type of <code>AbstractMCMC.AbstractSampler</code> in addition to implementing a few methods from <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>. Why? Because it gets us <em>a lot</em> of functionality for free, as we will see later.</p>
<p>Moreover, <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> provides a very natural interface for MCMC algorithms.</p>
<p>First, we’ll define our <code>MALA</code> type</p>
<div id="12" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">AbstractMCMC</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALA{T,A} <span class="op">&lt;:</span><span class="dt"> AbstractMCMC.AbstractSampler</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"stepsize used in the leapfrog step"</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    ϵ_init<span class="op">::</span><span class="dt">T</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"covariance matrix used for the momentum"</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    M_init<span class="op">::</span><span class="dt">A</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notice how we’ve added the suffix <code>_init</code> to both the stepsize and the covariance matrix. We’ve done this because a <code>AbstractMCMC.AbstractSampler</code> should be <em>immutable</em>. Of course there might be many scenarios where we want to allow something like the stepsize and / or the covariance matrix to vary between iterations, e.g.&nbsp;during the burn-in / adaptation phase of the sampling process we might want to adjust the parameters using statistics computed from these initial iterations. But information which can change between iterations <em>should not go in the sampler itself</em>! Instead, this information should go in the sampler <em>state</em>.</p>
<p>The sampler state should at the very least contain all the necessary information to perform the next MCMC iteration, but usually contains further information, e.g.&nbsp;quantities and statistics useful for evaluating whether the sampler has converged.</p>
<p>We will use the following sampler state for our <code>MALA</code> sampler:</p>
<div id="14" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALAState{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This might seem overly redundant: we’re defining a type <code>MALAState</code> and it only contains a simple vector of reals. In this particular case we indeed could have dropped this and simply used a <code>AbstractVector{&lt;:Real}</code> as our sampler state, but typically, as we will see later, one wants to include other quantities in the sampler state. For example, if we also wanted to adapt the parameters of our <code>MALA</code>, e.g.&nbsp;alter the stepsize depending on acceptance rates, in which case we should also put <code>ϵ</code> in the state, but for now we’ll keep things simple.</p>
<p>Moreover, we also want a <em>sample</em> type, which is a type meant for “public consumption”, i.e.&nbsp;the end-user. This is generally going to contain a subset of the information present in the state. But in such a simple scenario as this, we similarly only have a <code>AbstractVector{&lt;:Real}</code>:</p>
<div id="16" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALASample{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We currently have three things:</p>
<ol type="1">
<li>A <code>AbstractMCMC.AbstractSampler</code> implementation called <code>MALA</code>.</li>
<li>A state <code>MALAState</code> for our sampler <code>MALA</code>.</li>
<li>A sample <code>MALASample</code> for our sampler <code>MALA</code>.</li>
</ol>
<p>That means that we’re ready to implement the only thing that really matters: <code>AbstractMCMC.step</code>.</p>
<p><code>AbstractMCMC.step</code> defines the MCMC iteration of our <code>MALA</code> given the current <code>MALAState</code>. Specifically, the signature of the function is as follows:</p>
<div id="18" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The RNG to ensure reproducibility.</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The model that defines our target.</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.AbstractModel</span>,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The sampler for which we're taking a `step`.</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">AbstractMCMC.AbstractSampler</span>,</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The current sampler `state`.</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    state;</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Additional keyword arguments that we may or may not need.</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Moreover, there is a specific <code>AbstractMCMC.AbstractModel</code> which is used to indicate that the model that is provided implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface: <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Since, as we discussed earlier, in our case we’re indeed going to work with types that support the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, we’ll define <code>AbstractMCMC.step</code> for such a <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Note that <code>AbstractMCMC.LogDensityModel</code> has no other purpose; it has a single field called <code>logdensity</code>, and it does nothing else. But by wrapping the model in <code>AbstractMCMC.LogDensityModel</code>, it allows samplers that want to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> to define their <code>AbstractMCMC.step</code> on this type without running into method ambiguities.</p>
<p>All in all, that means that the signature for our <code>AbstractMCMC.step</code> is going to be the following:</p>
<div id="20" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># `LogDensityModel` so we know we're working with LogDensityProblems.jl model.</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler.</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler state.</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Great! Now let’s actually implement the full <code>AbstractMCMC.step</code> for our <code>MALA</code>.</p>
<p>Let’s remind ourselves what we’re going to do:</p>
<ol type="1">
<li>Sample a new momentum <span class="math inline">\(p\)</span>.</li>
<li>Compute the log-density of the extended target <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>Take a single leapfrog step <span class="math inline">\((\tilde{x}, \tilde{p}) = L_{\epsilon}(x, p)\)</span>.</li>
<li>Accept or reject the proposed <span class="math inline">\((\tilde{x}, \tilde{p})\)</span>.</li>
</ol>
<p>All in all, this results in the following:</p>
<div id="22" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>: Random</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Distributions</span>  <span class="co"># so we get the `MvNormal`</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the wrapped model which implements LogDensityProblems.jl.</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just extract the sampler parameters to make our lives easier.</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    ϵ <span class="op">=</span> sampler.ϵ_init</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    M <span class="op">=</span> sampler.M_init</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the current parameters.</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> state.x</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sample the momentum.</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>    p_dist <span class="op">=</span> <span class="fu">MvNormal</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)), M)</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> <span class="fu">rand</span>(rng, p_dist)</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Propose using a single leapfrog step.</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>    x̃, p̃ <span class="op">=</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Accept or reject proposal.</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>    logp <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p)</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>    logp̃ <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x̃) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p̃)</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>    logα <span class="op">=</span> logp̃ <span class="op">-</span> logp</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>    state_new <span class="op">=</span> <span class="cf">if</span> <span class="fu">log</span>(<span class="fu">rand</span>(rng)) <span class="op">&lt;</span> logα</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Accept.</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x̃)</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Reject.</span></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x)</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return the "sample" and the sampler state.</span></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(state_new.x), state_new</span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Fairly straight-forward.</p>
<p>Of course, we haven’t defined the <code>leapfrog_step</code> method yet, so let’s do that:</p>
<div id="24" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p` using "position" `x`.</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x))</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    p1 <span class="op">=</span> p <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update the "position" `x` using momentum `p1`.</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    x̃ <span class="op">=</span> x <span class="op">+</span> ϵ <span class="op">.*</span> (M <span class="op">\</span> p1)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p1` using position `x̃`</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x̃ <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x̃))</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    p2 <span class="op">=</span> p1 <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x̃</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Flip momentum `p2`.</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    p̃ <span class="op">=</span> <span class="op">-</span>p2</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x̃, p̃</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>leapfrog_step (generic function with 1 method)</code></pre>
</div>
</div>
<p>With all of this, we’re technically ready to sample!</p>
<div id="26" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>, <span class="bu">LinearAlgebra</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>rng <span class="op">=</span> <span class="bu">Random</span>.<span class="fu">default_rng</span>()</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>sampler <span class="op">=</span> <span class="fu">MALA</span>(<span class="fl">1</span>, I)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>state <span class="op">=</span> <span class="fu">MALAState</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)))</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>x_next, state_next <span class="op">=</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    rng,</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    AbstractMCMC.<span class="fu">LogDensityModel</span>(model),</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    state</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>(MALASample{Vector{Float64}}([-0.5931525639533283, -1.347600322330193, 0.5815343404412082]), MALAState{Vector{Float64}}([-0.5931525639533283, -1.347600322330193, 0.5815343404412082]))</code></pre>
</div>
</div>
<p>Great, it works!</p>
<p>And I promised we would get quite some functionality for free if we implemented <code>AbstractMCMC.step</code>, and so we can now simply call <code>sample</code> to perform standard MCMC sampling:</p>
<div id="28" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform 1000 iterations with our `MALA` sampler.</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; initial_state<span class="op">=</span>state, progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Concatenate into a matrix.</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000 Matrix{Float64}:
 -3.01532   -4.41837   -4.71715   …  -5.03328   -4.4815    -3.1263
 -0.316046   0.228112   0.830989     -0.476637  -0.724743  -0.688257
  4.61189    3.18001    5.12241       4.9989     5.37868    4.9005</code></pre>
</div>
</div>
<div id="30" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the marginal means and standard deviations.</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -5.0041      1.01329
 -0.00229031  0.992862
  5.00293     1.00446</code></pre>
</div>
</div>
<p>Let’s visualize the samples</p>
<div id="32" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">StatsPlots</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">transpose</span>(samples_matrix[<span class="op">:</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">:</span><span class="kw">end</span>]), alpha<span class="op">=</span><span class="fl">0.5</span>, legend<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<!--?xml version="1.0" encoding="utf-8"?-->
<svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" width="672" height="480" viewbox="0 0 2688 1920">
<defs>
  <clippath id="clip960">
    <rect x="0" y="0" width="2688" height="1920"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip960)" d="M0 1920 L2688 1920 L2688 0 L0 0  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip961">
    <rect x="537" y="0" width="1883" height="1883"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip960)" d="M151.747 1800.78 L2640.76 1800.78 L2640.76 47.2441 L151.747 47.2441  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip962">
    <rect x="151" y="47" width="2490" height="1755"></rect>
  </clippath>
</defs>
<polyline clip-path="url(#clip962)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="219.84,1800.78 219.84,47.2441 "></polyline>
<polyline clip-path="url(#clip962)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="807.458,1800.78 807.458,47.2441 "></polyline>
<polyline clip-path="url(#clip962)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1395.08,1800.78 1395.08,47.2441 "></polyline>
<polyline clip-path="url(#clip962)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1982.69,1800.78 1982.69,47.2441 "></polyline>
<polyline clip-path="url(#clip962)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="2570.31,1800.78 2570.31,47.2441 "></polyline>
<polyline clip-path="url(#clip962)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,1506.38 2640.76,1506.38 "></polyline>
<polyline clip-path="url(#clip962)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,1206.26 2640.76,1206.26 "></polyline>
<polyline clip-path="url(#clip962)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,906.129 2640.76,906.129 "></polyline>
<polyline clip-path="url(#clip962)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,606.003 2640.76,606.003 "></polyline>
<polyline clip-path="url(#clip962)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,305.876 2640.76,305.876 "></polyline>
<polyline clip-path="url(#clip960)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1800.78 2640.76,1800.78 "></polyline>
<polyline clip-path="url(#clip960)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="219.84,1800.78 219.84,1781.88 "></polyline>
<polyline clip-path="url(#clip960)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="807.458,1800.78 807.458,1781.88 "></polyline>
<polyline clip-path="url(#clip960)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1395.08,1800.78 1395.08,1781.88 "></polyline>
<polyline clip-path="url(#clip960)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1982.69,1800.78 1982.69,1781.88 "></polyline>
<polyline clip-path="url(#clip960)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="2570.31,1800.78 2570.31,1781.88 "></polyline>
<path clip-path="url(#clip960)" d="M219.84 1834 Q216.229 1834 214.4 1837.57 Q212.595 1841.11 212.595 1848.24 Q212.595 1855.34 214.4 1858.91 Q216.229 1862.45 219.84 1862.45 Q223.474 1862.45 225.28 1858.91 Q227.108 1855.34 227.108 1848.24 Q227.108 1841.11 225.28 1837.57 Q223.474 1834 219.84 1834 M219.84 1830.3 Q225.65 1830.3 228.706 1834.9 Q231.784 1839.49 231.784 1848.24 Q231.784 1856.96 228.706 1861.57 Q225.65 1866.15 219.84 1866.15 Q214.03 1866.15 210.951 1861.57 Q207.896 1856.96 207.896 1848.24 Q207.896 1839.49 210.951 1834.9 Q214.03 1830.3 219.84 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip960)" d="M771.15 1861.55 L787.47 1861.55 L787.47 1865.48 L765.525 1865.48 L765.525 1861.55 Q768.187 1858.79 772.771 1854.16 Q777.377 1849.51 778.558 1848.17 Q780.803 1845.65 781.683 1843.91 Q782.585 1842.15 782.585 1840.46 Q782.585 1837.71 780.641 1835.97 Q778.72 1834.23 775.618 1834.23 Q773.419 1834.23 770.965 1835 Q768.535 1835.76 765.757 1837.31 L765.757 1832.59 Q768.581 1831.46 771.035 1830.88 Q773.488 1830.3 775.525 1830.3 Q780.896 1830.3 784.09 1832.98 Q787.285 1835.67 787.285 1840.16 Q787.285 1842.29 786.474 1844.21 Q785.687 1846.11 783.581 1848.7 Q783.002 1849.37 779.9 1852.59 Q776.798 1855.78 771.15 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip960)" d="M797.331 1830.92 L815.687 1830.92 L815.687 1834.86 L801.613 1834.86 L801.613 1843.33 Q802.632 1842.98 803.65 1842.82 Q804.669 1842.64 805.687 1842.64 Q811.474 1842.64 814.854 1845.81 Q818.233 1848.98 818.233 1854.4 Q818.233 1859.97 814.761 1863.08 Q811.289 1866.15 804.97 1866.15 Q802.794 1866.15 800.525 1865.78 Q798.28 1865.41 795.872 1864.67 L795.872 1859.97 Q797.956 1861.11 800.178 1861.66 Q802.4 1862.22 804.877 1862.22 Q808.882 1862.22 811.22 1860.11 Q813.558 1858.01 813.558 1854.4 Q813.558 1850.78 811.22 1848.68 Q808.882 1846.57 804.877 1846.57 Q803.002 1846.57 801.127 1846.99 Q799.275 1847.4 797.331 1848.28 L797.331 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip960)" d="M837.446 1834 Q833.835 1834 832.007 1837.57 Q830.201 1841.11 830.201 1848.24 Q830.201 1855.34 832.007 1858.91 Q833.835 1862.45 837.446 1862.45 Q841.081 1862.45 842.886 1858.91 Q844.715 1855.34 844.715 1848.24 Q844.715 1841.11 842.886 1837.57 Q841.081 1834 837.446 1834 M837.446 1830.3 Q843.256 1830.3 846.312 1834.9 Q849.391 1839.49 849.391 1848.24 Q849.391 1856.96 846.312 1861.57 Q843.256 1866.15 837.446 1866.15 Q831.636 1866.15 828.557 1861.57 Q825.502 1856.96 825.502 1848.24 Q825.502 1839.49 828.557 1834.9 Q831.636 1830.3 837.446 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip960)" d="M1354.69 1830.92 L1373.05 1830.92 L1373.05 1834.86 L1358.98 1834.86 L1358.98 1843.33 Q1360 1842.98 1361.01 1842.82 Q1362.03 1842.64 1363.05 1842.64 Q1368.84 1842.64 1372.22 1845.81 Q1375.6 1848.98 1375.6 1854.4 Q1375.6 1859.97 1372.12 1863.08 Q1368.65 1866.15 1362.33 1866.15 Q1360.16 1866.15 1357.89 1865.78 Q1355.64 1865.41 1353.24 1864.67 L1353.24 1859.97 Q1355.32 1861.11 1357.54 1861.66 Q1359.76 1862.22 1362.24 1862.22 Q1366.25 1862.22 1368.58 1860.11 Q1370.92 1858.01 1370.92 1854.4 Q1370.92 1850.78 1368.58 1848.68 Q1366.25 1846.57 1362.24 1846.57 Q1360.37 1846.57 1358.49 1846.99 Q1356.64 1847.4 1354.69 1848.28 L1354.69 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip960)" d="M1394.81 1834 Q1391.2 1834 1389.37 1837.57 Q1387.56 1841.11 1387.56 1848.24 Q1387.56 1855.34 1389.37 1858.91 Q1391.2 1862.45 1394.81 1862.45 Q1398.44 1862.45 1400.25 1858.91 Q1402.08 1855.34 1402.08 1848.24 Q1402.08 1841.11 1400.25 1837.57 Q1398.44 1834 1394.81 1834 M1394.81 1830.3 Q1400.62 1830.3 1403.68 1834.9 Q1406.75 1839.49 1406.75 1848.24 Q1406.75 1856.96 1403.68 1861.57 Q1400.62 1866.15 1394.81 1866.15 Q1389 1866.15 1385.92 1861.57 Q1382.87 1856.96 1382.87 1848.24 Q1382.87 1839.49 1385.92 1834.9 Q1389 1830.3 1394.81 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip960)" d="M1424.97 1834 Q1421.36 1834 1419.53 1837.57 Q1417.73 1841.11 1417.73 1848.24 Q1417.73 1855.34 1419.53 1858.91 Q1421.36 1862.45 1424.97 1862.45 Q1428.61 1862.45 1430.41 1858.91 Q1432.24 1855.34 1432.24 1848.24 Q1432.24 1841.11 1430.41 1837.57 Q1428.61 1834 1424.97 1834 M1424.97 1830.3 Q1430.78 1830.3 1433.84 1834.9 Q1436.92 1839.49 1436.92 1848.24 Q1436.92 1856.96 1433.84 1861.57 Q1430.78 1866.15 1424.97 1866.15 Q1419.16 1866.15 1416.08 1861.57 Q1413.03 1856.96 1413.03 1848.24 Q1413.03 1839.49 1416.08 1834.9 Q1419.16 1830.3 1424.97 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip960)" d="M1940.97 1830.92 L1963.19 1830.92 L1963.19 1832.91 L1950.65 1865.48 L1945.76 1865.48 L1957.57 1834.86 L1940.97 1834.86 L1940.97 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip960)" d="M1972.36 1830.92 L1990.71 1830.92 L1990.71 1834.86 L1976.64 1834.86 L1976.64 1843.33 Q1977.66 1842.98 1978.68 1842.82 Q1979.7 1842.64 1980.72 1842.64 Q1986.5 1842.64 1989.88 1845.81 Q1993.26 1848.98 1993.26 1854.4 Q1993.26 1859.97 1989.79 1863.08 Q1986.32 1866.15 1980 1866.15 Q1977.82 1866.15 1975.55 1865.78 Q1973.31 1865.41 1970.9 1864.67 L1970.9 1859.97 Q1972.98 1861.11 1975.21 1861.66 Q1977.43 1862.22 1979.9 1862.22 Q1983.91 1862.22 1986.25 1860.11 Q1988.59 1858.01 1988.59 1854.4 Q1988.59 1850.78 1986.25 1848.68 Q1983.91 1846.57 1979.9 1846.57 Q1978.03 1846.57 1976.15 1846.99 Q1974.3 1847.4 1972.36 1848.28 L1972.36 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip960)" d="M2012.47 1834 Q2008.86 1834 2007.03 1837.57 Q2005.23 1841.11 2005.23 1848.24 Q2005.23 1855.34 2007.03 1858.91 Q2008.86 1862.45 2012.47 1862.45 Q2016.11 1862.45 2017.91 1858.91 Q2019.74 1855.34 2019.74 1848.24 Q2019.74 1841.11 2017.91 1837.57 Q2016.11 1834 2012.47 1834 M2012.47 1830.3 Q2018.28 1830.3 2021.34 1834.9 Q2024.42 1839.49 2024.42 1848.24 Q2024.42 1856.96 2021.34 1861.57 Q2018.28 1866.15 2012.47 1866.15 Q2006.66 1866.15 2003.59 1861.57 Q2000.53 1856.96 2000.53 1848.24 Q2000.53 1839.49 2003.59 1834.9 Q2006.66 1830.3 2012.47 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip960)" d="M2514.84 1861.55 L2522.48 1861.55 L2522.48 1835.18 L2514.17 1836.85 L2514.17 1832.59 L2522.43 1830.92 L2527.11 1830.92 L2527.11 1861.55 L2534.75 1861.55 L2534.75 1865.48 L2514.84 1865.48 L2514.84 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip960)" d="M2554.19 1834 Q2550.58 1834 2548.75 1837.57 Q2546.94 1841.11 2546.94 1848.24 Q2546.94 1855.34 2548.75 1858.91 Q2550.58 1862.45 2554.19 1862.45 Q2557.82 1862.45 2559.63 1858.91 Q2561.46 1855.34 2561.46 1848.24 Q2561.46 1841.11 2559.63 1837.57 Q2557.82 1834 2554.19 1834 M2554.19 1830.3 Q2560 1830.3 2563.06 1834.9 Q2566.13 1839.49 2566.13 1848.24 Q2566.13 1856.96 2563.06 1861.57 Q2560 1866.15 2554.19 1866.15 Q2548.38 1866.15 2545.3 1861.57 Q2542.25 1856.96 2542.25 1848.24 Q2542.25 1839.49 2545.3 1834.9 Q2548.38 1830.3 2554.19 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip960)" d="M2584.35 1834 Q2580.74 1834 2578.91 1837.57 Q2577.11 1841.11 2577.11 1848.24 Q2577.11 1855.34 2578.91 1858.91 Q2580.74 1862.45 2584.35 1862.45 Q2587.99 1862.45 2589.79 1858.91 Q2591.62 1855.34 2591.62 1848.24 Q2591.62 1841.11 2589.79 1837.57 Q2587.99 1834 2584.35 1834 M2584.35 1830.3 Q2590.16 1830.3 2593.22 1834.9 Q2596.3 1839.49 2596.3 1848.24 Q2596.3 1856.96 2593.22 1861.57 Q2590.16 1866.15 2584.35 1866.15 Q2578.54 1866.15 2575.46 1861.57 Q2572.41 1856.96 2572.41 1848.24 Q2572.41 1839.49 2575.46 1834.9 Q2578.54 1830.3 2584.35 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip960)" d="M2614.51 1834 Q2610.9 1834 2609.07 1837.57 Q2607.27 1841.11 2607.27 1848.24 Q2607.27 1855.34 2609.07 1858.91 Q2610.9 1862.45 2614.51 1862.45 Q2618.15 1862.45 2619.95 1858.91 Q2621.78 1855.34 2621.78 1848.24 Q2621.78 1841.11 2619.95 1837.57 Q2618.15 1834 2614.51 1834 M2614.51 1830.3 Q2620.32 1830.3 2623.38 1834.9 Q2626.46 1839.49 2626.46 1848.24 Q2626.46 1856.96 2623.38 1861.57 Q2620.32 1866.15 2614.51 1866.15 Q2608.7 1866.15 2605.62 1861.57 Q2602.57 1856.96 2602.57 1848.24 Q2602.57 1839.49 2605.62 1834.9 Q2608.7 1830.3 2614.51 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip960)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1800.78 151.747,47.2441 "></polyline>
<polyline clip-path="url(#clip960)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1506.38 170.644,1506.38 "></polyline>
<polyline clip-path="url(#clip960)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1206.26 170.644,1206.26 "></polyline>
<polyline clip-path="url(#clip960)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,906.129 170.644,906.129 "></polyline>
<polyline clip-path="url(#clip960)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,606.003 170.644,606.003 "></polyline>
<polyline clip-path="url(#clip960)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,305.876 170.644,305.876 "></polyline>
<path clip-path="url(#clip960)" d="M49.5521 1506.83 L79.2279 1506.83 L79.2279 1510.77 L49.5521 1510.77 L49.5521 1506.83 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip960)" d="M99.8991 1504.52 Q96.7509 1504.52 94.8991 1506.67 Q93.0704 1508.82 93.0704 1512.57 Q93.0704 1516.3 94.8991 1518.48 Q96.7509 1520.63 99.8991 1520.63 Q103.047 1520.63 104.876 1518.48 Q106.728 1516.3 106.728 1512.57 Q106.728 1508.82 104.876 1506.67 Q103.047 1504.52 99.8991 1504.52 M109.181 1489.87 L109.181 1494.12 Q107.422 1493.29 105.617 1492.85 Q103.834 1492.41 102.075 1492.41 Q97.4454 1492.41 94.9917 1495.54 Q92.5612 1498.66 92.2139 1504.98 Q93.5797 1502.97 95.6398 1501.9 Q97.7 1500.81 100.177 1500.81 Q105.385 1500.81 108.394 1503.99 Q111.427 1507.13 111.427 1512.57 Q111.427 1517.9 108.279 1521.12 Q105.131 1524.33 99.8991 1524.33 Q93.9037 1524.33 90.7325 1519.75 Q87.5612 1515.14 87.5612 1506.42 Q87.5612 1498.22 91.45 1493.36 Q95.3389 1488.48 101.89 1488.48 Q103.649 1488.48 105.431 1488.82 Q107.237 1489.17 109.181 1489.87 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip960)" d="M50.3623 1206.71 L80.0381 1206.71 L80.0381 1210.64 L50.3623 1210.64 L50.3623 1206.71 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip960)" d="M104.297 1204.9 Q107.654 1205.62 109.529 1207.89 Q111.427 1210.16 111.427 1213.49 Q111.427 1218.6 107.908 1221.41 Q104.39 1224.21 97.9083 1224.21 Q95.7324 1224.21 93.4176 1223.77 Q91.126 1223.35 88.6723 1222.49 L88.6723 1217.98 Q90.6167 1219.11 92.9315 1219.69 Q95.2463 1220.27 97.7695 1220.27 Q102.168 1220.27 104.459 1218.54 Q106.774 1216.8 106.774 1213.49 Q106.774 1210.43 104.621 1208.72 Q102.492 1206.98 98.6722 1206.98 L94.6445 1206.98 L94.6445 1203.14 L98.8574 1203.14 Q102.306 1203.14 104.135 1201.78 Q105.964 1200.39 105.964 1197.79 Q105.964 1195.13 104.066 1193.72 Q102.191 1192.29 98.6722 1192.29 Q96.7509 1192.29 94.5519 1192.7 Q92.3528 1193.12 89.7139 1194 L89.7139 1189.83 Q92.376 1189.09 94.6908 1188.72 Q97.0287 1188.35 99.0889 1188.35 Q104.413 1188.35 107.515 1190.78 Q110.617 1193.19 110.617 1197.31 Q110.617 1200.18 108.973 1202.17 Q107.33 1204.14 104.297 1204.9 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip960)" d="M99.4824 891.928 Q95.8713 891.928 94.0426 895.492 Q92.2371 899.034 92.2371 906.164 Q92.2371 913.27 94.0426 916.835 Q95.8713 920.377 99.4824 920.377 Q103.117 920.377 104.922 916.835 Q106.751 913.27 106.751 906.164 Q106.751 899.034 104.922 895.492 Q103.117 891.928 99.4824 891.928 M99.4824 888.224 Q105.293 888.224 108.348 892.83 Q111.427 897.414 111.427 906.164 Q111.427 914.89 108.348 919.497 Q105.293 924.08 99.4824 924.08 Q93.6723 924.08 90.5936 919.497 Q87.538 914.89 87.538 906.164 Q87.538 897.414 90.5936 892.83 Q93.6723 888.224 99.4824 888.224 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip960)" d="M104.297 604.648 Q107.654 605.366 109.529 607.635 Q111.427 609.903 111.427 613.236 Q111.427 618.352 107.908 621.153 Q104.39 623.954 97.9083 623.954 Q95.7324 623.954 93.4176 623.514 Q91.126 623.097 88.6723 622.241 L88.6723 617.727 Q90.6167 618.861 92.9315 619.44 Q95.2463 620.019 97.7695 620.019 Q102.168 620.019 104.459 618.283 Q106.774 616.547 106.774 613.236 Q106.774 610.181 104.621 608.468 Q102.492 606.732 98.6722 606.732 L94.6445 606.732 L94.6445 602.889 L98.8574 602.889 Q102.306 602.889 104.135 601.523 Q105.964 600.135 105.964 597.542 Q105.964 594.88 104.066 593.468 Q102.191 592.033 98.6722 592.033 Q96.7509 592.033 94.5519 592.449 Q92.3528 592.866 89.7139 593.746 L89.7139 589.579 Q92.376 588.838 94.6908 588.468 Q97.0287 588.098 99.0889 588.098 Q104.413 588.098 107.515 590.528 Q110.617 592.936 110.617 597.056 Q110.617 599.926 108.973 601.917 Q107.33 603.885 104.297 604.648 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip960)" d="M99.8991 304.013 Q96.7509 304.013 94.8991 306.166 Q93.0704 308.318 93.0704 312.068 Q93.0704 315.795 94.8991 317.971 Q96.7509 320.124 99.8991 320.124 Q103.047 320.124 104.876 317.971 Q106.728 315.795 106.728 312.068 Q106.728 308.318 104.876 306.166 Q103.047 304.013 99.8991 304.013 M109.181 289.36 L109.181 293.619 Q107.422 292.786 105.617 292.346 Q103.834 291.906 102.075 291.906 Q97.4454 291.906 94.9917 295.031 Q92.5612 298.156 92.2139 304.476 Q93.5797 302.462 95.6398 301.397 Q97.7 300.309 100.177 300.309 Q105.385 300.309 108.394 303.48 Q111.427 306.629 111.427 312.068 Q111.427 317.392 108.279 320.61 Q105.131 323.828 99.8991 323.828 Q93.9037 323.828 90.7325 319.244 Q87.5612 314.638 87.5612 305.911 Q87.5612 297.717 91.45 292.856 Q95.3389 287.971 101.89 287.971 Q103.649 287.971 105.431 288.319 Q107.237 288.666 109.181 289.36 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip962)" style="stroke:#009af9; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,1207.79 224.541,1236.97 226.891,1452.06 229.242,1598.13 231.592,1485.14 233.943,1511.13 236.293,1322.19 238.644,1315.25 240.994,1339.5 243.345,1538.38 245.695,1519.88 248.046,1453.88 250.396,1331.81 252.747,1485.05 255.097,1507.02 257.448,1346.8 259.798,1409.44 262.148,1417.85 264.499,1357.08 266.849,1503.68 269.2,1433.02 271.55,1348.44 273.901,1332.04 276.251,1430.89 278.602,1307.95 280.952,1429.64 283.303,1462.15 285.653,1319.39 288.004,1450.06 290.354,1405.17 292.705,1357.11 295.055,1580.76 297.406,1454.49 299.756,1516.29 302.107,1299.12 304.457,1384.15 306.807,1396.51 309.158,1696.13 311.508,1347.46 313.859,1402.75 316.209,1519.45 318.56,1261.59 320.91,1389.52 323.261,1455.6 325.611,1235.82 327.962,1522.12 330.312,1115.05 332.663,1283.08 335.013,1471.21 337.364,1363.87 339.714,1319.75 342.065,1372.35 344.415,1381.59 346.765,1449.12 349.116,1342.68 351.466,1579.81 353.817,1218.97 356.167,1566.11 358.518,1226.07 360.868,1375.49 363.219,1409.46 365.569,1596.97 367.92,1166.25 370.27,1317.41 372.621,1311.6 374.971,1368.93 377.322,1433.36 379.672,1406.76 382.023,1454.69 384.373,1446.87 386.724,1348.78 389.074,1283.18 391.424,1358.1 393.775,1430.64 396.125,1415.2 398.476,1329.57 400.826,1359.96 403.177,1364.24 405.527,1271.33 407.878,1403.48 410.228,1507.92 412.579,1479.31 414.929,1345.96 417.28,1520.66 419.63,1412.64 421.981,1339.14 424.331,1247.06 426.682,1426.67 429.032,1325.9 431.382,1361.78 433.733,1265.15 436.083,1230.8 438.434,1406.89 440.784,1492.23 443.135,1493.25 445.485,1589.23 447.836,1425.05 450.186,1520.47 452.537,1248.49 454.887,1574.24 457.238,1538.13 459.588,1488.98 461.939,1497.76 464.289,1317.89 466.64,1288.16 468.99,1406.08 471.341,1382.88 473.691,1427.83 476.041,1321.12 478.392,1515.5 480.742,1425.69 483.093,1389.47 485.443,1304.78 487.794,1464.99 490.144,1373.94 492.495,1348.72 494.845,1438.38 497.196,1490.86 499.546,1399.76 501.897,1199.78 504.247,1328.54 506.598,1565.6 508.948,1279.36 511.299,1377.56 513.649,1398.14 515.999,1457.5 518.35,1282.46 520.7,1356.61 523.051,1234.55 525.401,1365.96 527.752,1182.52 530.102,1196.53 532.453,1441.76 534.803,1300.54 537.154,1566.73 539.504,1540.8 541.855,1253.51 544.205,1459.96 546.556,1455.81 548.906,1385.42 551.257,1466.84 553.607,1635.25 555.958,1576.9 558.308,1376.8 560.658,1304.6 563.009,1366.73 565.359,1371.8 567.71,1446.21 570.06,1398.83 572.411,1349.6 574.761,1536.72 577.112,1453.12 579.462,1371.09 581.813,1282.75 584.163,1425.42 586.514,1412.01 588.864,1393.44 591.215,1639.35 593.565,1535.3 595.916,1541.03 598.266,1439.4 600.616,1509.45 602.967,1312.57 605.317,1184.82 607.668,1266.65 610.018,1272.46 612.369,1517.68 614.719,1501.7 617.07,1427.85 619.42,1433.46 621.771,1658.04 624.121,1187.91 626.472,1440.15 628.822,1358.95 631.173,1542.21 633.523,1389.26 635.874,1410.71 638.224,1586.78 640.575,1369.47 642.925,1394.3 645.275,1392.89 647.626,1562.24 649.976,1421.11 652.327,1362.88 654.677,1323.98 657.028,1467.72 659.378,1367.8 661.729,1365.03 664.079,1403.02 666.43,1376.12 668.78,1512.28 671.131,1409.89 673.481,1501.15 675.832,1517.93 678.182,1675.99 680.533,1486.12 682.883,1336.74 685.233,1344.92 687.584,1386.26 689.934,1396.95 692.285,1524.83 694.635,1411.65 696.986,1307.15 699.336,1172.54 701.687,1224.43 704.037,1559.98 706.388,1499.6 708.738,1421.05 711.089,1443.18 713.439,1372.26 715.79,1386.09 718.14,1436.55 720.491,1387.85 722.841,1311.64 725.192,1394.61 727.542,1490.54 729.892,1423.89 732.243,1420.88 734.593,1220.35 736.944,1607.33 739.294,1324.85 741.645,1334.21 743.995,1359.1 746.346,1570.38 748.696,1460.95 751.047,1422.23 753.397,1393.53 755.748,1630.23 758.098,1393.35 760.449,1395.12 762.799,1694.58 765.15,1436.3 767.5,1158.58 769.85,1332.55 772.201,1378.8 774.551,1254.51 776.902,1420.42 779.252,1394.31 781.603,1425.06 783.953,1441.5 786.304,1372.76 788.654,1401.67 791.005,1531.46 793.355,1410.77 795.706,1476.39 798.056,1509.42 800.407,1505.24 802.757,1455.27 805.108,1544.86 807.458,1369.75 809.809,1439.46 812.159,1423 814.509,1510.24 816.86,1411.27 819.21,1433.14 821.561,1509.44 823.911,1369.36 826.262,1600.16 828.612,1495.73 830.963,1602.4 833.313,1375.15 835.664,1442.28 838.014,1367.92 840.365,1434.44 842.715,1501.48 845.066,1234.68 847.416,1374.75 849.767,1379.9 852.117,1470.58 854.467,1421.15 856.818,1376.38 859.168,1313.09 861.519,1372.91 863.869,1327.17 866.22,1512.05 868.57,1424.52 870.921,1374.03 873.271,1430.41 875.622,1438.26 877.972,1369.13 880.323,1532.94 882.673,1386.19 885.024,1317.58 887.374,1398.25 889.725,1478.89 892.075,1393.58 894.426,1504.37 896.776,1421.3 899.126,1307.6 901.477,1441.7 903.827,1382.83 906.178,1529.36 908.528,1477.64 910.879,1274.46 913.229,1369.81 915.58,1458.65 917.93,1565.71 920.281,1437.51 922.631,1490.7 924.982,1498.66 927.332,1371.1 929.683,1654.88 932.033,1508.1 934.384,1264.33 936.734,1281.84 939.084,1313.09 941.435,1352.89 943.785,1265.14 946.136,1394.68 948.486,1356.49 950.837,1363.98 953.187,1253.65 955.538,1548.91 957.888,1577.69 960.239,1277.89 962.589,1299.84 964.94,1382.73 967.29,1405.57 969.641,1470.35 971.991,1406.69 974.342,1334.31 976.692,1578.71 979.043,1346.51 981.393,1491.65 983.743,1301.19 986.094,1308.29 988.444,1409.31 990.795,1513.75 993.145,1275.78 995.496,1472.48 997.846,1550.32 1000.2,1477.37 1002.55,1488.05 1004.9,1241.03 1007.25,1483.24 1009.6,1552.94 1011.95,1586.56 1014.3,1314 1016.65,1491.17 1019,1408.47 1021.35,1253.76 1023.7,1422.35 1026.05,1300.62 1028.4,1244.39 1030.75,1461.8 1033.1,1296.75 1035.45,1391.6 1037.8,1471.35 1040.15,1462.73 1042.51,1417.39 1044.86,1574.25 1047.21,1350.68 1049.56,1500.95 1051.91,1222.78 1054.26,1412.02 1056.61,1424.87 1058.96,1458.3 1061.31,1315.61 1063.66,1261.82 1066.01,1538.04 1068.36,1486.62 1070.71,1300.74 1073.06,1233.05 1075.41,1444.18 1077.76,1384.9 1080.11,1316.54 1082.46,1557.54 1084.81,1423.09 1087.16,1422.11 1089.51,1229.73 1091.87,1299.01 1094.22,1429.41 1096.57,1502.39 1098.92,1342.01 1101.27,1543.38 1103.62,1353.99 1105.97,1526.65 1108.32,1473.99 1110.67,1523.2 1113.02,1300.74 1115.37,1338.01 1117.72,1567.92 1120.07,1586.28 1122.42,1291.1 1124.77,1581.33 1127.12,1388.23 1129.47,1483.62 1131.82,1218.36 1134.17,1406.85 1136.52,1508.93 1138.87,1390.8 1141.23,1492.03 1143.58,1303.21 1145.93,1632.26 1148.28,1230.7 1150.63,1370.17 1152.98,1228.03 1155.33,1307.72 1157.68,1335.43 1160.03,1536.41 1162.38,1400.04 1164.73,1366.37 1167.08,1512.2 1169.43,1339.72 1171.78,1485.83 1174.13,1323.19 1176.48,1494.11 1178.83,1348.13 1181.18,1446.2 1183.53,1478.1 1185.88,1391.03 1188.23,1450.97 1190.59,1356.91 1192.94,1476.62 1195.29,1282.81 1197.64,1452.9 1199.99,1406.14 1202.34,1313.17 1204.69,1490.51 1207.04,1482.5 1209.39,1356.37 1211.74,1395.09 1214.09,1505.73 1216.44,1426.26 1218.79,1167.39 1221.14,1464.56 1223.49,1442.79 1225.84,1452.78 1228.19,1568.03 1230.54,1476.06 1232.89,1340.36 1235.24,1416.1 1237.59,1293.19 1239.94,1260.58 1242.3,1313.46 1244.65,1456.54 1247,1502.22 1249.35,1430.57 1251.7,1395.62 1254.05,1496.12 1256.4,1469.99 1258.75,1506.44 1261.1,1532.41 1263.45,1438.11 1265.8,1354.18 1268.15,1556.8 1270.5,1369.77 1272.85,1505.69 1275.2,1593.59 1277.55,1145.82 1279.9,1151.43 1282.25,1277.26 1284.6,1385.93 1286.95,1315.83 1289.3,1295.14 1291.66,1317.72 1294.01,1466.58 1296.36,1443.93 1298.71,1503.56 1301.06,1311.99 1303.41,1591.84 1305.76,1390.08 1308.11,1501.69 1310.46,1294.37 1312.81,1494.5 1315.16,1304.44 1317.51,1552.3 1319.86,1199.52 1322.21,1458 1324.56,1467.78 1326.91,1496.32 1329.26,1602.08 1331.61,1751.15 1333.96,1357.68 1336.31,1319.22 1338.66,1356.67 1341.02,1631.41 1343.37,1461.16 1345.72,1334.33 1348.07,1442.89 1350.42,1432.61 1352.77,1485.12 1355.12,1498.47 1357.47,1213.39 1359.82,1274.27 1362.17,1494.23 1364.52,1522.71 1366.87,1391.48 1369.22,1332.04 1371.57,1573.81 1373.92,1434.28 1376.27,1294.17 1378.62,1525.63 1380.97,1360.19 1383.32,1285.95 1385.67,1478.24 1388.02,1238.8 1390.38,1211.02 1392.73,1513.71 1395.08,1476.29 1397.43,1402.33 1399.78,1445.06 1402.13,1490.58 1404.48,1324.21 1406.83,1564.46 1409.18,1318.8 1411.53,1378.04 1413.88,1366.82 1416.23,1364.87 1418.58,1475.26 1420.93,1267.02 1423.28,1384.72 1425.63,1386.48 1427.98,1354.31 1430.33,1260.78 1432.68,1256.96 1435.03,1280.6 1437.38,1373.45 1439.74,1519.46 1442.09,1401.38 1444.44,1348.61 1446.79,1523.91 1449.14,1227.63 1451.49,1163.42 1453.84,1246.92 1456.19,1715.64 1458.54,1325.95 1460.89,1381.73 1463.24,1331.2 1465.59,1439.36 1467.94,1311.56 1470.29,1264.05 1472.64,1297.87 1474.99,1418.08 1477.34,1402.95 1479.69,1301.99 1482.04,1307.31 1484.39,1454.68 1486.74,1335.55 1489.1,1370.48 1491.45,1472.41 1493.8,1455.84 1496.15,1361.58 1498.5,1292.98 1500.85,1420.66 1503.2,1298.92 1505.55,1369.96 1507.9,1390.39 1510.25,1465.1 1512.6,1474.11 1514.95,1194.21 1517.3,1288.9 1519.65,1317.45 1522,1287.78 1524.35,1382.15 1526.7,1367.04 1529.05,1360.28 1531.4,1434.17 1533.75,1380.66 1536.1,1421.03 1538.45,1465.15 1540.81,1362.84 1543.16,1658.08 1545.51,1375.43 1547.86,1359.73 1550.21,1303.95 1552.56,1468.94 1554.91,1333.57 1557.26,1383.92 1559.61,1276.66 1561.96,1693.92 1564.31,1516.16 1566.66,1359.46 1569.01,1390.14 1571.36,1459.39 1573.71,1356.56 1576.06,1319.52 1578.41,1354.64 1580.76,1477.63 1583.11,1372.41 1585.46,1303.92 1587.81,1518.49 1590.17,1481.94 1592.52,1544.13 1594.87,1506.52 1597.22,1408.41 1599.57,1489.85 1601.92,1461.84 1604.27,1270.99 1606.62,1513.44 1608.97,1352.69 1611.32,1403.12 1613.67,1431.21 1616.02,1583.48 1618.37,1287.3 1620.72,1342.13 1623.07,1408.88 1625.42,1523.28 1627.77,1387.94 1630.12,1614.82 1632.47,1390.44 1634.82,1357.49 1637.17,1241.73 1639.53,1376.21 1641.88,1379.87 1644.23,1313.44 1646.58,1426.26 1648.93,1284.79 1651.28,1460.21 1653.63,1357.03 1655.98,1300.21 1658.33,1512.08 1660.68,1337.63 1663.03,1368.88 1665.38,1384.96 1667.73,1218.51 1670.08,1330.94 1672.43,1328.18 1674.78,1483.9 1677.13,1354.93 1679.48,1331.42 1681.83,1365.54 1684.18,1421.64 1686.53,1184.97 1688.89,1454.64 1691.24,1368.5 1693.59,1419.6 1695.94,1417.46 1698.29,1369.77 1700.64,1438.15 1702.99,1312.72 1705.34,1640.47 1707.69,1107.91 1710.04,1361.75 1712.39,1534.19 1714.74,1487.5 1717.09,1629.7 1719.44,1528.3 1721.79,1434.22 1724.14,1369.05 1726.49,1448.27 1728.84,1474.3 1731.19,1345.07 1733.54,1389.04 1735.89,1511.25 1738.25,1502.47 1740.6,1414.59 1742.95,1346.43 1745.3,1273.68 1747.65,1564.15 1750,1252.81 1752.35,1570.2 1754.7,1425.29 1757.05,1388.85 1759.4,1307.45 1761.75,1563.56 1764.1,1666.11 1766.45,1452.67 1768.8,1201.16 1771.15,1546.1 1773.5,1419.53 1775.85,1387.2 1778.2,1441.2 1780.55,1233.48 1782.9,1197.5 1785.25,1330.89 1787.6,1368.12 1789.96,1451.05 1792.31,1495.9 1794.66,1489.31 1797.01,1338.05 1799.36,1359.11 1801.71,1550.36 1804.06,1503.5 1806.41,1492.19 1808.76,1437.17 1811.11,1431.16 1813.46,1344.22 1815.81,1337.49 1818.16,1334.42 1820.51,1455.72 1822.86,1532.06 1825.21,1276.19 1827.56,1348.62 1829.91,1269.09 1832.26,1299.85 1834.61,1524.73 1836.96,1429.84 1839.32,1363.64 1841.67,1457.31 1844.02,1348.65 1846.37,1425.6 1848.72,1313.76 1851.07,1167.56 1853.42,1375.13 1855.77,1406.59 1858.12,1340.39 1860.47,1346.63 1862.82,1457.39 1865.17,1283.68 1867.52,1269.6 1869.87,1500 1872.22,1434.71 1874.57,1381.44 1876.92,1341.23 1879.27,1346.28 1881.62,1313.28 1883.97,1471.92 1886.32,1380.62 1888.68,1379.29 1891.03,1367.97 1893.38,1325.62 1895.73,1304.71 1898.08,1371.07 1900.43,1460.16 1902.78,1440.98 1905.13,1285.4 1907.48,1634.7 1909.83,1432.67 1912.18,1384.93 1914.53,1222.63 1916.88,1288.68 1919.23,1483.05 1921.58,1476.42 1923.93,1519.03 1926.28,1465.22 1928.63,1295.65 1930.98,1301.96 1933.33,1435.5 1935.68,1539.92 1938.04,1358.13 1940.39,1347.03 1942.74,1353.47 1945.09,1321.21 1947.44,1352.8 1949.79,1279.35 1952.14,1456.69 1954.49,1153.66 1956.84,1353.54 1959.19,1530.53 1961.54,1460.03 1963.89,1348.81 1966.24,1371.96 1968.59,1554.54 1970.94,1396.13 1973.29,1371.62 1975.64,1353.62 1977.99,1379.61 1980.34,1473.51 1982.69,1340.89 1985.04,1323.67 1987.4,1414.77 1989.75,1419.82 1992.1,1460.34 1994.45,1342.66 1996.8,1314.66 1999.15,1431.93 2001.5,1422.89 2003.85,1434.07 2006.2,1573.34 2008.55,1598.43 2010.9,1235.9 2013.25,1569.23 2015.6,1394.15 2017.95,1385.75 2020.3,1373.32 2022.65,1455.66 2025,1394.04 2027.35,1506.88 2029.7,1339.49 2032.05,1201.02 2034.4,1280.94 2036.76,1681.6 2039.11,1312.31 2041.46,1385.45 2043.81,1282.94 2046.16,1350.94 2048.51,1382.44 2050.86,1251.5 2053.21,1571.85 2055.56,1402.71 2057.91,1420.51 2060.26,1438.19 2062.61,1417.54 2064.96,1468.09 2067.31,1417.96 2069.66,1615.56 2072.01,1253.37 2074.36,1450.69 2076.71,1550.73 2079.06,1406.05 2081.41,1266.18 2083.76,1336.14 2086.11,1310.85 2088.47,1266.73 2090.82,1234.62 2093.17,1195.53 2095.52,1540.06 2097.87,1454.77 2100.22,1473.51 2102.57,1495.99 2104.92,1331.83 2107.27,1423.79 2109.62,1228.82 2111.97,1505.5 2114.32,1386.12 2116.67,1338.29 2119.02,1584.99 2121.37,1353.72 2123.72,1393.69 2126.07,1530.51 2128.42,1553.06 2130.77,1327.95 2133.12,1309.36 2135.47,1451.08 2137.83,1501.29 2140.18,1379.37 2142.53,1364.18 2144.88,1425.92 2147.23,1458.91 2149.58,1627.45 2151.93,1366.64 2154.28,1321.31 2156.63,1375.42 2158.98,1565.39 2161.33,1270.52 2163.68,1593.36 2166.03,1477.13 2168.38,1408.19 2170.73,1569.8 2173.08,1387.01 2175.43,1369.71 2177.78,1338.62 2180.13,1335.2 2182.48,1474.78 2184.83,1314.97 2187.19,1567.2 2189.54,1267.31 2191.89,1431.36 2194.24,1623 2196.59,1620.8 2198.94,1501.23 2201.29,1433.36 2203.64,1171.42 2205.99,1346.48 2208.34,1389.16 2210.69,1489.35 2213.04,1532.58 2215.39,1299.47 2217.74,1438.86 2220.09,1422.76 2222.44,1369.85 2224.79,1390.62 2227.14,1378.85 2229.49,1349.49 2231.84,1357.17 2234.19,1219.03 2236.55,1527.44 2238.9,1515.97 2241.25,1360.94 2243.6,1312.69 2245.95,1353.34 2248.3,1454.99 2250.65,1261.98 2253,1560.94 2255.35,1254.79 2257.7,1479.7 2260.05,1246.02 2262.4,1377.91 2264.75,1502.96 2267.1,1297.21 2269.45,1364.98 2271.8,1431.98 2274.15,1306.37 2276.5,1097.29 2278.85,1489.53 2281.2,1309.42 2283.55,1538.78 2285.91,1354.12 2288.26,1447.37 2290.61,1437.1 2292.96,1450.03 2295.31,1301.82 2297.66,1385.74 2300.01,1504.39 2302.36,1277.52 2304.71,1400.48 2307.06,1474.97 2309.41,1548.59 2311.76,1358.72 2314.11,1556.14 2316.46,1315.11 2318.81,1254.05 2321.16,1356.69 2323.51,1432.56 2325.86,1286.78 2328.21,1394.39 2330.56,1401.9 2332.91,1273.52 2335.27,1557.88 2337.62,1423.19 2339.97,1543.25 2342.32,1533.14 2344.67,1438.99 2347.02,1448.23 2349.37,1575.18 2351.72,1226.96 2354.07,1250.2 2356.42,1367.59 2358.77,1374.94 2361.12,1327.68 2363.47,1275.89 2365.82,1374.64 2368.17,1500.72 2370.52,1438.55 2372.87,1435.78 2375.22,1448.74 2377.57,1496.33 2379.92,1293.78 2382.27,1550.96 2384.62,1534.8 2386.98,1531.27 2389.33,1411.46 2391.68,1338.73 2394.03,1212.52 2396.38,1668.19 2398.73,1472.57 2401.08,1313.75 2403.43,1272.78 2405.78,1474.69 2408.13,1493.77 2410.48,1419.16 2412.83,1478.32 2415.18,1301.62 2417.53,1442.02 2419.88,1237.12 2422.23,1368.67 2424.58,1529.34 2426.93,1400.09 2429.28,1461.79 2431.63,1329.29 2433.98,1535.02 2436.34,1444.68 2438.69,1323.33 2441.04,1446.67 2443.39,1394.76 2445.74,1524.78 2448.09,1536.06 2450.44,1444.89 2452.79,1265.76 2455.14,1253.04 2457.49,1337.8 2459.84,1470.84 2462.19,1375.71 2464.54,1549.66 2466.89,1191.7 2469.24,1301.38 2471.59,1423.01 2473.94,1438.46 2476.29,1353.15 2478.64,1389.08 2480.99,1480.33 2483.34,1395.31 2485.7,1532.83 2488.05,1541.12 2490.4,1319.3 2492.75,1555.98 2495.1,1218.34 2497.45,1541.58 2499.8,1191.56 2502.15,1207.88 2504.5,1372.47 2506.85,1438.61 2509.2,1515.02 2511.55,1272.07 2513.9,1430.15 2516.25,1306.75 2518.6,1466.58 2520.95,1440.17 2523.3,1415.28 2525.65,1289.89 2528,1494.92 2530.35,1590.14 2532.7,1325.99 2535.06,1321.19 2537.41,1353.27 2539.76,1293.11 2542.11,1418.06 2544.46,1248.35 2546.81,1385.12 2549.16,1585.18 2551.51,1360.19 2553.86,1528.39 2556.21,1384.03 2558.56,1452.6 2560.91,1507.62 2563.26,1330.03 2565.61,1384.77 2567.96,1320.21 2570.31,1343.71 "></polyline>
<polyline clip-path="url(#clip962)" style="stroke:#e26f46; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,937.747 224.541,1104.32 226.891,833.422 229.242,1052.5 231.592,923.686 233.943,780.417 236.293,898.3 238.644,888.982 240.994,777.602 243.345,1007.42 245.695,1019.47 248.046,844.344 250.396,1052.77 252.747,1072.36 255.097,987.094 257.448,925.946 259.798,798.816 262.148,894.24 264.499,972.497 266.849,943.572 269.2,942.476 271.55,947.978 273.901,856.332 276.251,840.307 278.602,1002.67 280.952,822.508 283.303,824.896 285.653,883.597 288.004,941.861 290.354,921.071 292.705,865.166 295.055,891.606 297.406,1026.22 299.756,930.966 302.107,966.416 304.457,948.637 306.807,917.798 309.158,995.306 311.508,1049.96 313.859,926.852 316.209,1002.25 318.56,929.181 320.91,893.475 323.261,913.345 325.611,682.469 327.962,785.246 330.312,872.277 332.663,902.153 335.013,814.615 337.364,686.949 339.714,970.76 342.065,934.549 344.415,839.939 346.765,989.013 349.116,960.128 351.466,939.737 353.817,898.749 356.167,940.422 358.518,815.03 360.868,1010.22 363.219,940.395 365.569,1016.48 367.92,871.398 370.27,1051.15 372.621,912.302 374.971,892.037 377.322,863.697 379.672,987.028 382.023,977.418 384.373,807.474 386.724,974.053 389.074,791.379 391.424,1043.3 393.775,897.004 396.125,924.634 398.476,956.268 400.826,865.947 403.177,996.892 405.527,759.887 407.878,819.797 410.228,823.962 412.579,811.521 414.929,992.14 417.28,971.323 419.63,784.438 421.981,937.335 424.331,1001.66 426.682,802.995 429.032,711.926 431.382,986.779 433.733,891.734 436.083,1054.84 438.434,1205.19 440.784,899.535 443.135,818.777 445.485,752.562 447.836,873.91 450.186,736.654 452.537,901.482 454.887,908.259 457.238,906.669 459.588,764.697 461.939,779.823 464.289,1019.75 466.64,807.612 468.99,785.13 471.341,792.602 473.691,614.456 476.041,715.799 478.392,955.067 480.742,809.19 483.093,1009.36 485.443,871.32 487.794,1038.84 490.144,1089.81 492.495,959.949 494.845,989.244 497.196,945.454 499.546,901.437 501.897,934.724 504.247,973.082 506.598,1045.5 508.948,940.931 511.299,870.468 513.649,832.249 515.999,965.392 518.35,876.743 520.7,668.3 523.051,743.827 525.401,1027.67 527.752,903.852 530.102,744.765 532.453,906.423 534.803,867.687 537.154,1073.34 539.504,841.884 541.855,929.183 544.205,685.973 546.556,930.443 548.906,838.73 551.257,709.66 553.607,978.641 555.958,1120.57 558.308,883.604 560.658,948.855 563.009,960.098 565.359,920.246 567.71,852.104 570.06,1061.66 572.411,994.739 574.761,1073.75 577.112,895.764 579.462,844.02 581.813,750.965 584.163,947.728 586.514,1018.82 588.864,828.508 591.215,862.255 593.565,912.393 595.916,859.1 598.266,1059.93 600.616,919.009 602.967,962.048 605.317,906.526 607.668,691.119 610.018,1027.64 612.369,828.314 614.719,991.196 617.07,858.04 619.42,940.229 621.771,690.291 624.121,820.276 626.472,848.326 628.822,924.368 631.173,621.086 633.523,1001.6 635.874,823.625 638.224,942.92 640.575,714.855 642.925,714.005 645.275,696.648 647.626,900.136 649.976,919.234 652.327,843.553 654.677,867.941 657.028,1059.87 659.378,869.342 661.729,932.654 664.079,1102.21 666.43,929.573 668.78,930.905 671.131,858.764 673.481,901.242 675.832,843.036 678.182,972.488 680.533,918.187 682.883,818.215 685.233,896.767 687.584,927.537 689.934,912.242 692.285,767.04 694.635,755.167 696.986,890.652 699.336,938.1 701.687,912.91 704.037,786.427 706.388,1052.69 708.738,902.088 711.089,1053.39 713.439,811.447 715.79,967.798 718.14,1049.24 720.491,888.98 722.841,960.304 725.192,869.329 727.542,856.586 729.892,841.214 732.243,945.894 734.593,1027.79 736.944,983.147 739.294,924.978 741.645,1128.16 743.995,884.591 746.346,798.931 748.696,858.94 751.047,735.327 753.397,995.014 755.748,1131.51 758.098,953.837 760.449,906.125 762.799,916.001 765.15,847.378 767.5,897.573 769.85,1035.82 772.201,899.925 774.551,1123.2 776.902,909.645 779.252,900.767 781.603,998.16 783.953,953.924 786.304,804.798 788.654,826.637 791.005,1043.81 793.355,984.406 795.706,832.292 798.056,910.133 800.407,989.89 802.757,908.774 805.108,925.631 807.458,924.64 809.809,828.603 812.159,974.872 814.509,848.672 816.86,1031.62 819.21,1016.6 821.561,718.985 823.911,987.857 826.262,782.343 828.612,858.566 830.963,998.611 833.313,870.931 835.664,878.846 838.014,852.46 840.365,899.584 842.715,836.616 845.066,919.279 847.416,849.546 849.767,1015.73 852.117,882.521 854.467,835.852 856.818,968.561 859.168,977.783 861.519,865.388 863.869,814.971 866.22,830.439 868.57,889.84 870.921,1010.64 873.271,913.775 875.622,949.442 877.972,812.859 880.323,825.156 882.673,878.884 885.024,778.086 887.374,1085.58 889.725,953.99 892.075,941.254 894.426,842.165 896.776,822.546 899.126,880.147 901.477,790.127 903.827,861.645 906.178,1014.35 908.528,837.533 910.879,899.145 913.229,802.654 915.58,729.555 917.93,976.262 920.281,906.179 922.631,918.153 924.982,791.374 927.332,954.154 929.683,739.607 932.033,1052.81 934.384,877.515 936.734,958.248 939.084,768.682 941.435,900.442 943.785,794.164 946.136,888.307 948.486,903.719 950.837,909.788 953.187,829.44 955.538,824.373 957.888,909.44 960.239,756.731 962.589,670.217 964.94,876.321 967.29,888.278 969.641,878.602 971.991,1005.13 974.342,910.878 976.692,1050.03 979.043,1159.89 981.393,822.075 983.743,1021.49 986.094,872.389 988.444,874.864 990.795,943.621 993.145,1020.95 995.496,873.577 997.846,917.859 1000.2,776.185 1002.55,876.384 1004.9,845.92 1007.25,873.334 1009.6,850.133 1011.95,848.591 1014.3,992.203 1016.65,705.784 1019,1174.28 1021.35,914.288 1023.7,954.35 1026.05,912.283 1028.4,767.612 1030.75,1076.46 1033.1,717.377 1035.45,954.845 1037.8,783.386 1040.15,754.68 1042.51,807.503 1044.86,878.856 1047.21,888.478 1049.56,874.08 1051.91,934.092 1054.26,943.244 1056.61,843.093 1058.96,897.466 1061.31,925.842 1063.66,937.608 1066.01,823.063 1068.36,780.888 1070.71,785.536 1073.06,852.314 1075.41,793.343 1077.76,880.494 1080.11,944.897 1082.46,897.555 1084.81,859.346 1087.16,1059.64 1089.51,712.63 1091.87,899.395 1094.22,901.891 1096.57,899.512 1098.92,854.676 1101.27,877.37 1103.62,800.094 1105.97,736.459 1108.32,822.017 1110.67,725.322 1113.02,1034.02 1115.37,952.082 1117.72,823.998 1120.07,945.491 1122.42,925.757 1124.77,781.604 1127.12,1095.7 1129.47,955.135 1131.82,1059.06 1134.17,1002.1 1136.52,653.723 1138.87,848.421 1141.23,1176.29 1143.58,849.098 1145.93,921.074 1148.28,962.259 1150.63,710.45 1152.98,904.963 1155.33,851.836 1157.68,912.594 1160.03,754.367 1162.38,890.799 1164.73,904.121 1167.08,921.053 1169.43,1045.17 1171.78,1032.81 1174.13,1037.45 1176.48,1104.21 1178.83,884.699 1181.18,919.353 1183.53,785.459 1185.88,936.611 1188.23,815.744 1190.59,998.19 1192.94,938.099 1195.29,937.246 1197.64,950.142 1199.99,869.381 1202.34,851.485 1204.69,842.401 1207.04,858.339 1209.39,915.876 1211.74,963.491 1214.09,828.613 1216.44,807.672 1218.79,1177.48 1221.14,816.999 1223.49,788.578 1225.84,851.482 1228.19,605.744 1230.54,912.414 1232.89,920.573 1235.24,865.848 1237.59,919.298 1239.94,827.246 1242.3,1091.35 1244.65,994.912 1247,888.788 1249.35,965.446 1251.7,882.296 1254.05,1007.1 1256.4,719.848 1258.75,966.681 1261.1,719.004 1263.45,914.941 1265.8,995.657 1268.15,766.277 1270.5,1124.86 1272.85,1052.01 1275.2,924.18 1277.55,867.76 1279.9,881.562 1282.25,887.727 1284.6,882.855 1286.95,844.023 1289.3,1025.69 1291.66,760.799 1294.01,817.629 1296.36,849.779 1298.71,1093.47 1301.06,811.589 1303.41,849.874 1305.76,869.67 1308.11,969.431 1310.46,935.217 1312.81,1046.03 1315.16,827.314 1317.51,866.382 1319.86,783.381 1322.21,887.393 1324.56,990.987 1326.91,912.261 1329.26,741.561 1331.61,993.699 1333.96,916.969 1336.31,878.811 1338.66,750.117 1341.02,874.24 1343.37,779.169 1345.72,857.491 1348.07,949.163 1350.42,929.625 1352.77,1039.33 1355.12,834.243 1357.47,1002.79 1359.82,925.3 1362.17,829.229 1364.52,950.769 1366.87,781.935 1369.22,853.134 1371.57,959.861 1373.92,947.305 1376.27,867.651 1378.62,806.295 1380.97,1054.69 1383.32,766.347 1385.67,964.203 1388.02,791.533 1390.38,866.936 1392.73,974.695 1395.08,945.832 1397.43,750.243 1399.78,937.036 1402.13,1026.35 1404.48,941.92 1406.83,948.37 1409.18,742.92 1411.53,1000.81 1413.88,1020.79 1416.23,753.121 1418.58,910.825 1420.93,919.767 1423.28,966.201 1425.63,932.765 1427.98,1008.49 1430.33,922.322 1432.68,1060.65 1435.03,866.276 1437.38,1028.7 1439.74,809.461 1442.09,879.414 1444.44,860.657 1446.79,1142.62 1449.14,782.52 1451.49,1049.61 1453.84,725.152 1456.19,925.98 1458.54,835.054 1460.89,973.421 1463.24,864.557 1465.59,918.223 1467.94,935.274 1470.29,1006.8 1472.64,950.531 1474.99,884.005 1477.34,808.622 1479.69,753.27 1482.04,779.264 1484.39,872.096 1486.74,920.322 1489.1,925.182 1491.45,841.92 1493.8,1090.76 1496.15,949.349 1498.5,1028.51 1500.85,814.805 1503.2,993.627 1505.55,993.647 1507.9,669.574 1510.25,1025.23 1512.6,861.969 1514.95,813.019 1517.3,776.773 1519.65,912.939 1522,744.402 1524.35,897.15 1526.7,922.623 1529.05,780.106 1531.4,843.027 1533.75,924.231 1536.1,907.597 1538.45,953.974 1540.81,1066.36 1543.16,929.234 1545.51,866.13 1547.86,799.5 1550.21,939.52 1552.56,964.044 1554.91,1032.82 1557.26,900.839 1559.61,817.423 1561.96,700.477 1564.31,893.149 1566.66,881.408 1569.01,1118.78 1571.36,830.808 1573.71,741.337 1576.06,962.003 1578.41,811.002 1580.76,893.33 1583.11,1056.36 1585.46,891.916 1587.81,883.877 1590.17,810.853 1592.52,826.582 1594.87,970.377 1597.22,849.485 1599.57,1141.97 1601.92,843.759 1604.27,999.813 1606.62,876.624 1608.97,874.495 1611.32,909.492 1613.67,806.075 1616.02,1112.24 1618.37,870.171 1620.72,886.452 1623.07,918.957 1625.42,803.019 1627.77,987.102 1630.12,1045.65 1632.47,912.164 1634.82,855.501 1637.17,828.136 1639.53,956.318 1641.88,792.277 1644.23,998.207 1646.58,900.242 1648.93,892.244 1651.28,918.759 1653.63,975.458 1655.98,853.345 1658.33,860.774 1660.68,908.073 1663.03,856.888 1665.38,873.36 1667.73,824.72 1670.08,834.594 1672.43,1008.88 1674.78,984.115 1677.13,855.751 1679.48,953.637 1681.83,650.174 1684.18,963.124 1686.53,887.307 1688.89,992.774 1691.24,1061.74 1693.59,769.476 1695.94,965.983 1698.29,1211.97 1700.64,828.661 1702.99,757.254 1705.34,862.842 1707.69,969.927 1710.04,884.55 1712.39,879.852 1714.74,1075.3 1717.09,879.093 1719.44,1020.84 1721.79,775.33 1724.14,839.055 1726.49,929.486 1728.84,892.607 1731.19,887.071 1733.54,871.1 1735.89,788.709 1738.25,836.108 1740.6,891.527 1742.95,781.692 1745.3,923.265 1747.65,941.809 1750,966.608 1752.35,855.144 1754.7,949.679 1757.05,946.747 1759.4,957.826 1761.75,991.777 1764.1,875.247 1766.45,1050.86 1768.8,916.634 1771.15,1002.92 1773.5,891.419 1775.85,750.616 1778.2,903.166 1780.55,811.452 1782.9,665.638 1785.25,1084.89 1787.6,864.732 1789.96,934.222 1792.31,773.322 1794.66,1112.22 1797.01,1020.24 1799.36,883.921 1801.71,871.692 1804.06,973.288 1806.41,912.423 1808.76,1036.87 1811.11,968.926 1813.46,821.133 1815.81,1026.91 1818.16,960.916 1820.51,845.457 1822.86,858.681 1825.21,945.2 1827.56,870.972 1829.91,909.523 1832.26,935.647 1834.61,907.055 1836.96,885.933 1839.32,1283.72 1841.67,797.811 1844.02,883.12 1846.37,1024.46 1848.72,827.475 1851.07,926.408 1853.42,964.203 1855.77,714.342 1858.12,892.288 1860.47,778.63 1862.82,1057.99 1865.17,870.84 1867.52,842.851 1869.87,831.493 1872.22,886.349 1874.57,778.535 1876.92,1009.53 1879.27,977.742 1881.62,932.366 1883.97,816.778 1886.32,897.935 1888.68,975.324 1891.03,1000.59 1893.38,1085.87 1895.73,747.544 1898.08,971.96 1900.43,904.073 1902.78,690.828 1905.13,993.384 1907.48,978.058 1909.83,975.589 1912.18,1036.06 1914.53,1066.17 1916.88,857.438 1919.23,1081.88 1921.58,964.686 1923.93,810.213 1926.28,953.57 1928.63,811.752 1930.98,872.372 1933.33,966.937 1935.68,884.311 1938.04,814.313 1940.39,991.374 1942.74,833.288 1945.09,791.968 1947.44,988.75 1949.79,852.134 1952.14,816.928 1954.49,997.831 1956.84,913.489 1959.19,1000 1961.54,1126.7 1963.89,924.1 1966.24,985.028 1968.59,971.572 1970.94,1190.33 1973.29,776.978 1975.64,1007.05 1977.99,1032.03 1980.34,858.515 1982.69,1005.86 1985.04,938.082 1987.4,1101.71 1989.75,911.622 1992.1,1092.9 1994.45,911.719 1996.8,972.006 1999.15,898.577 2001.5,902.349 2003.85,999.313 2006.2,968.799 2008.55,809.168 2010.9,894.162 2013.25,871.301 2015.6,784.339 2017.95,762.217 2020.3,957.155 2022.65,1022.13 2025,1048.23 2027.35,1114.15 2029.7,934.764 2032.05,957.483 2034.4,912.786 2036.76,1084.18 2039.11,829.252 2041.46,1020.45 2043.81,811.408 2046.16,859.511 2048.51,806.57 2050.86,925.533 2053.21,859.81 2055.56,941.476 2057.91,939.199 2060.26,963.48 2062.61,935.439 2064.96,852.106 2067.31,866.772 2069.66,975.6 2072.01,1076.4 2074.36,789.417 2076.71,814.861 2079.06,886.827 2081.41,923.823 2083.76,689.8 2086.11,934.989 2088.47,1018.05 2090.82,1111.93 2093.17,1005.39 2095.52,1066.14 2097.87,894.07 2100.22,929.355 2102.57,838.659 2104.92,761.15 2107.27,834.709 2109.62,935.809 2111.97,829.814 2114.32,931.63 2116.67,898.901 2119.02,1000.05 2121.37,860.093 2123.72,939.091 2126.07,950.091 2128.42,842.12 2130.77,883.841 2133.12,895.412 2135.47,886.62 2137.83,914.668 2140.18,925.454 2142.53,859.612 2144.88,1025.91 2147.23,1127.74 2149.58,995.907 2151.93,973.132 2154.28,915.015 2156.63,936.687 2158.98,837.959 2161.33,918.233 2163.68,916.874 2166.03,919.691 2168.38,860.061 2170.73,1045.91 2173.08,988.432 2175.43,1075.71 2177.78,901.395 2180.13,1017.5 2182.48,850.743 2184.83,940.777 2187.19,993.186 2189.54,928.268 2191.89,930.015 2194.24,801.068 2196.59,956.445 2198.94,861.71 2201.29,873.439 2203.64,959.595 2205.99,856.506 2208.34,838.256 2210.69,850.132 2213.04,991.716 2215.39,927.344 2217.74,977.039 2220.09,811.69 2222.44,761.154 2224.79,986.741 2227.14,823.796 2229.49,806.081 2231.84,872.306 2234.19,1084.29 2236.55,801.12 2238.9,845.726 2241.25,980.671 2243.6,1063.69 2245.95,959.078 2248.3,881.203 2250.65,991.265 2253,893.258 2255.35,909.021 2257.7,1055.02 2260.05,832.877 2262.4,1125.29 2264.75,939.381 2267.1,916.878 2269.45,680.014 2271.8,883.979 2274.15,946.32 2276.5,877.27 2278.85,888.569 2281.2,959.164 2283.55,801.62 2285.91,955.698 2288.26,931.321 2290.61,992.096 2292.96,781.544 2295.31,980.156 2297.66,979.362 2300.01,780.266 2302.36,951.418 2304.71,931.857 2307.06,996.542 2309.41,1005.83 2311.76,783.541 2314.11,924.26 2316.46,870.602 2318.81,928.048 2321.16,894.97 2323.51,1059.83 2325.86,990.887 2328.21,933.937 2330.56,811.624 2332.91,893.447 2335.27,885.523 2337.62,968.996 2339.97,1025.71 2342.32,752.674 2344.67,832.622 2347.02,1181 2349.37,888.8 2351.72,817.931 2354.07,1024.83 2356.42,833.068 2358.77,798.145 2361.12,1021.7 2363.47,785.168 2365.82,1013.48 2368.17,917.856 2370.52,899.751 2372.87,965.773 2375.22,680.861 2377.57,876.931 2379.92,1003.44 2382.27,698.693 2384.62,968.855 2386.98,951.218 2389.33,870.65 2391.68,889.662 2394.03,944.878 2396.38,983.206 2398.73,858.516 2401.08,956.965 2403.43,833.311 2405.78,957.479 2408.13,925.793 2410.48,678.405 2412.83,857.02 2415.18,900.913 2417.53,934.011 2419.88,705.43 2422.23,743.007 2424.58,681.601 2426.93,781.54 2429.28,1063.48 2431.63,805.531 2433.98,1063.05 2436.34,772.345 2438.69,956.909 2441.04,936.469 2443.39,799.599 2445.74,834.697 2448.09,749.61 2450.44,772.264 2452.79,884.142 2455.14,768.273 2457.49,793.609 2459.84,1105.98 2462.19,1137.47 2464.54,809.952 2466.89,975.388 2469.24,939.237 2471.59,1028.82 2473.94,726.039 2476.29,988.975 2478.64,884.255 2480.99,958.592 2483.34,1046.75 2485.7,654.48 2488.05,772.268 2490.4,823.098 2492.75,1016.88 2495.1,1056.07 2497.45,841.918 2499.8,816.893 2502.15,805.439 2504.5,934.106 2506.85,1003.87 2509.2,847.298 2511.55,1105.65 2513.9,877.658 2516.25,822.183 2518.6,883.934 2520.95,905.678 2523.3,800.986 2525.65,992.283 2528,1015.81 2530.35,806.011 2532.7,1035.68 2535.06,1067.11 2537.41,899.479 2539.76,1058.08 2542.11,888.035 2544.46,1008.32 2546.81,855.138 2549.16,1106 2551.51,970.822 2553.86,1005.47 2556.21,896.888 2558.56,916.598 2560.91,774.694 2563.26,899.113 2565.61,973.988 2567.96,969.223 2570.31,910.889 "></polyline>
<polyline clip-path="url(#clip962)" style="stroke:#3da44d; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,444.746 224.541,464.065 226.891,418.745 229.242,274.534 231.592,440.781 233.943,268.842 236.293,175.467 238.644,371.813 240.994,331.783 243.345,337.269 245.695,306.21 248.046,412.417 250.396,306.379 252.747,358.689 255.097,363.48 257.448,627.15 259.798,597.085 262.148,384.052 264.499,260.082 266.849,475.846 269.2,366.692 271.55,463.464 273.901,301.506 276.251,344.559 278.602,297.161 280.952,399.957 283.303,402.444 285.653,375.695 288.004,529.451 290.354,563.741 292.705,254.538 295.055,522.066 297.406,363.604 299.756,526.404 302.107,333.722 304.457,401.462 306.807,472.626 309.158,427.505 311.508,301.718 313.859,480.607 316.209,443.008 318.56,649.633 320.91,619.054 323.261,469.528 325.611,380.24 327.962,337.034 330.312,551.456 332.663,588.921 335.013,312.433 337.364,416.609 339.714,409.093 342.065,222.948 344.415,436.082 346.765,520.407 349.116,393.54 351.466,499.969 353.817,506.924 356.167,521.872 358.518,554.866 360.868,242.998 363.219,391.873 365.569,253.156 367.92,546.466 370.27,337.825 372.621,356.142 374.971,300.02 377.322,439.622 379.672,385.998 382.023,433.506 384.373,383.292 386.724,372.266 389.074,425.264 391.424,482.031 393.775,305.029 396.125,286.983 398.476,432.549 400.826,385.268 403.177,398.279 405.527,249.233 407.878,282.786 410.228,506.787 412.579,474.217 414.929,501.014 417.28,516.606 419.63,450.809 421.981,352.525 424.331,352.758 426.682,306.844 429.032,407.204 431.382,483.519 433.733,354.323 436.083,342.852 438.434,431.348 440.784,295.297 443.135,351.043 445.485,456.765 447.836,292.394 450.186,410.016 452.537,495.422 454.887,533.55 457.238,323.428 459.588,438.431 461.939,389.257 464.289,428.73 466.64,321.644 468.99,336.565 471.341,471.589 473.691,312.935 476.041,460.659 478.392,249.986 480.742,236.442 483.093,263.212 485.443,240.63 487.794,550.946 490.144,402.599 492.495,306.524 494.845,637.183 497.196,372.035 499.546,283.818 501.897,537.991 504.247,459.575 506.598,445.066 508.948,284.126 511.299,369.124 513.649,593.329 515.999,262.932 518.35,549.311 520.7,610.59 523.051,382.769 525.401,458.359 527.752,248.968 530.102,415.17 532.453,468.682 534.803,420.83 537.154,258.16 539.504,382.093 541.855,357.891 544.205,314.628 546.556,319.179 548.906,551.072 551.257,385.492 553.607,376.164 555.958,505.581 558.308,402.407 560.658,483.128 563.009,461.657 565.359,409.749 567.71,399.542 570.06,330.533 572.411,381.841 574.761,457.889 577.112,433.262 579.462,450.778 581.813,427.187 584.163,433.27 586.514,428.303 588.864,500.03 591.215,419.661 593.565,344.253 595.916,490.795 598.266,248.602 600.616,346.157 602.967,365.314 605.317,451.573 607.668,470.173 610.018,720.033 612.369,464.98 614.719,470.527 617.07,433.844 619.42,547.243 621.771,411.129 624.121,395.025 626.472,385.979 628.822,344.2 631.173,379.804 633.523,498.595 635.874,523.175 638.224,431.682 640.575,462.078 642.925,509.467 645.275,419.058 647.626,251.915 649.976,368.571 652.327,365.247 654.677,404.361 657.028,658.023 659.378,447.289 661.729,466.551 664.079,386.761 666.43,396.109 668.78,327.946 671.131,516.619 673.481,499.799 675.832,382.836 678.182,260.669 680.533,212.507 682.883,420.259 685.233,247.328 687.584,314.277 689.934,432.63 692.285,417.818 694.635,433.21 696.986,499.288 699.336,238.456 701.687,413.245 704.037,456.044 706.388,548.552 708.738,486.651 711.089,384.725 713.439,327.826 715.79,363.004 718.14,313.329 720.491,383.657 722.841,324.701 725.192,500.245 727.542,289.504 729.892,306.412 732.243,486.443 734.593,451.41 736.944,314.99 739.294,286.716 741.645,490.801 743.995,340.925 746.346,487.08 748.696,285.438 751.047,490.25 753.397,398.775 755.748,237.229 758.098,470.514 760.449,359.202 762.799,294.229 765.15,445.123 767.5,355.526 769.85,359.441 772.201,403.41 774.551,435.94 776.902,446.995 779.252,431.75 781.603,439.626 783.953,323.087 786.304,354.107 788.654,486.298 791.005,425.632 793.355,590.07 795.706,444.734 798.056,364.166 800.407,255.442 802.757,531.271 805.108,331.182 807.458,380.044 809.809,306.683 812.159,326.115 814.509,319.882 816.86,366.609 819.21,303.384 821.561,548.895 823.911,346.275 826.262,375.589 828.612,417.699 830.963,354.065 833.313,664.086 835.664,477.497 838.014,496.364 840.365,536.367 842.715,214.953 845.066,320.081 847.416,438.292 849.767,470.178 852.117,239.358 854.467,477.345 856.818,404.033 859.168,233.591 861.519,383.074 863.869,480.455 866.22,203.553 868.57,422.595 870.921,564.822 873.271,256.22 875.622,321.076 877.972,497.354 880.323,555.712 882.673,418.179 885.024,342.938 887.374,457.641 889.725,470.825 892.075,434.656 894.426,401.628 896.776,411.652 899.126,494.103 901.477,488.76 903.827,559.12 906.178,442.391 908.528,409.806 910.879,511.244 913.229,566.786 915.58,389.183 917.93,339.81 920.281,390.939 922.631,365.023 924.982,378.277 927.332,319.03 929.683,464.759 932.033,405.582 934.384,304.413 936.734,475.324 939.084,288.475 941.435,217.348 943.785,533.861 946.136,236.231 948.486,453.783 950.837,326.177 953.187,334.051 955.538,427.211 957.888,463.253 960.239,474.342 962.589,586.222 964.94,381.214 967.29,498.759 969.641,402.274 971.991,440.83 974.342,650.348 976.692,472.384 979.043,347.817 981.393,476.241 983.743,435.482 986.094,591.724 988.444,372.135 990.795,339.172 993.145,474.026 995.496,360.118 997.846,228.905 1000.2,273.721 1002.55,386.014 1004.9,532.652 1007.25,219.08 1009.6,329.826 1011.95,397.208 1014.3,421.388 1016.65,283.475 1019,415.847 1021.35,524.065 1023.7,318.349 1026.05,324.529 1028.4,243.153 1030.75,408.749 1033.1,351.176 1035.45,493.978 1037.8,414.41 1040.15,213.349 1042.51,400.894 1044.86,395.718 1047.21,478.251 1049.56,446.766 1051.91,384.564 1054.26,422.664 1056.61,217.62 1058.96,583.486 1061.31,299.155 1063.66,352.836 1066.01,338.604 1068.36,345.221 1070.71,398.402 1073.06,414.947 1075.41,289.772 1077.76,541.944 1080.11,464.254 1082.46,422.72 1084.81,247.186 1087.16,425.229 1089.51,468.394 1091.87,319.421 1094.22,548.85 1096.57,499.794 1098.92,166.215 1101.27,280.243 1103.62,408.171 1105.97,435.91 1108.32,182.874 1110.67,213.615 1113.02,570.354 1115.37,503.42 1117.72,342.798 1120.07,389.482 1122.42,402.487 1124.77,384.414 1127.12,378.576 1129.47,452.422 1131.82,266.999 1134.17,429.871 1136.52,411.775 1138.87,393.835 1141.23,455.614 1143.58,553.547 1145.93,543.254 1148.28,455.646 1150.63,546.764 1152.98,312.2 1155.33,323.273 1157.68,451.304 1160.03,386.822 1162.38,421.821 1164.73,515.584 1167.08,494.668 1169.43,423.35 1171.78,389.862 1174.13,293.872 1176.48,408.032 1178.83,495.361 1181.18,500.798 1183.53,444.96 1185.88,297.689 1188.23,280.294 1190.59,467.552 1192.94,306.55 1195.29,333.641 1197.64,470.33 1199.99,412.006 1202.34,387.862 1204.69,429.972 1207.04,429.201 1209.39,305.742 1211.74,582.505 1214.09,276.306 1216.44,583.989 1218.79,360.639 1221.14,466.33 1223.49,400.792 1225.84,446.208 1228.19,517.969 1230.54,327.421 1232.89,417.158 1235.24,311.263 1237.59,363.85 1239.94,322.505 1242.3,424.22 1244.65,299.596 1247,280.851 1249.35,267.567 1251.7,336.916 1254.05,434.376 1256.4,408.596 1258.75,260.075 1261.1,378.642 1263.45,398.14 1265.8,348.65 1268.15,553.446 1270.5,375.354 1272.85,535.723 1275.2,510.096 1277.55,415.362 1279.9,349.195 1282.25,366.919 1284.6,414.775 1286.95,451.954 1289.3,395.399 1291.66,529.162 1294.01,464.981 1296.36,327.15 1298.71,458.39 1301.06,388.789 1303.41,337.645 1305.76,508.054 1308.11,477.155 1310.46,531.374 1312.81,406.96 1315.16,407.891 1317.51,496.339 1319.86,400.214 1322.21,448.165 1324.56,235.694 1326.91,339.807 1329.26,373.174 1331.61,307.863 1333.96,454.163 1336.31,449.934 1338.66,380.914 1341.02,379.952 1343.37,360.663 1345.72,241.578 1348.07,267.87 1350.42,344.651 1352.77,438.081 1355.12,630.155 1357.47,348.221 1359.82,354.343 1362.17,417.295 1364.52,689.921 1366.87,578.389 1369.22,410.19 1371.57,376.807 1373.92,450.801 1376.27,317.445 1378.62,465.041 1380.97,580.944 1383.32,365.726 1385.67,303.811 1388.02,360.981 1390.38,516.262 1392.73,517.674 1395.08,339.233 1397.43,542.274 1399.78,313.863 1402.13,442.584 1404.48,235.06 1406.83,371.256 1409.18,461.66 1411.53,409.78 1413.88,490.65 1416.23,393.055 1418.58,374.326 1420.93,464.27 1423.28,502.339 1425.63,288.35 1427.98,422.02 1430.33,323.775 1432.68,449.377 1435.03,312.493 1437.38,461.847 1439.74,331.317 1442.09,425.478 1444.44,470.514 1446.79,451.038 1449.14,384.842 1451.49,342.427 1453.84,512.217 1456.19,506.051 1458.54,618.956 1460.89,583.704 1463.24,337.154 1465.59,562.544 1467.94,431.669 1470.29,415.161 1472.64,336.915 1474.99,96.8724 1477.34,399.258 1479.69,545.986 1482.04,352.374 1484.39,344.407 1486.74,507.361 1489.1,329.918 1491.45,521.171 1493.8,383.939 1496.15,565.009 1498.5,182.831 1500.85,206.868 1503.2,265.05 1505.55,349.982 1507.9,397.474 1510.25,249.213 1512.6,528.247 1514.95,324.182 1517.3,407.713 1519.65,436.715 1522,450.498 1524.35,387.152 1526.7,301.406 1529.05,519.732 1531.4,496.856 1533.75,507.966 1536.1,334.868 1538.45,330.171 1540.81,456.74 1543.16,622.073 1545.51,376.884 1547.86,528.896 1550.21,436.98 1552.56,503.639 1554.91,351.328 1557.26,402.984 1559.61,222.34 1561.96,381.882 1564.31,448.165 1566.66,303.07 1569.01,504.853 1571.36,420.303 1573.71,401.5 1576.06,598.505 1578.41,210.472 1580.76,343.077 1583.11,517.407 1585.46,509.672 1587.81,361.288 1590.17,357.583 1592.52,273.896 1594.87,482.23 1597.22,394.503 1599.57,413.811 1601.92,480.195 1604.27,203.342 1606.62,287.626 1608.97,619.007 1611.32,280.974 1613.67,378.161 1616.02,414.849 1618.37,406.293 1620.72,395.466 1623.07,384.258 1625.42,568.524 1627.77,640.327 1630.12,313.9 1632.47,328.835 1634.82,345.171 1637.17,188.781 1639.53,397.709 1641.88,511.482 1644.23,516.158 1646.58,481.397 1648.93,420.034 1651.28,457.747 1653.63,449.431 1655.98,369.41 1658.33,379.397 1660.68,320.456 1663.03,543.227 1665.38,349.684 1667.73,524.044 1670.08,179.322 1672.43,383.676 1674.78,420.223 1677.13,535.094 1679.48,404.784 1681.83,477.974 1684.18,403.005 1686.53,191.605 1688.89,569.913 1691.24,483.354 1693.59,358.136 1695.94,484.163 1698.29,500.647 1700.64,347.719 1702.99,459.333 1705.34,447.162 1707.69,368.791 1710.04,330.406 1712.39,533.296 1714.74,319.665 1717.09,620.448 1719.44,382.423 1721.79,345.617 1724.14,324.395 1726.49,378.605 1728.84,273.495 1731.19,461.402 1733.54,264.494 1735.89,484.831 1738.25,379.541 1740.6,525.433 1742.95,184.372 1745.3,374.713 1747.65,388.371 1750,426.99 1752.35,333.066 1754.7,328.231 1757.05,338.95 1759.4,369.108 1761.75,280.264 1764.1,312.952 1766.45,441.289 1768.8,591.776 1771.15,374.155 1773.5,636.788 1775.85,342 1778.2,368.319 1780.55,372.182 1782.9,592.218 1785.25,331.316 1787.6,492.995 1789.96,569.862 1792.31,475.112 1794.66,410.799 1797.01,379.677 1799.36,372.771 1801.71,533.469 1804.06,526.993 1806.41,471.751 1808.76,381.408 1811.11,339.595 1813.46,637.265 1815.81,396.663 1818.16,413.439 1820.51,470.222 1822.86,330.852 1825.21,387.857 1827.56,331.871 1829.91,427.417 1832.26,317.935 1834.61,361.596 1836.96,431.434 1839.32,235.124 1841.67,353.063 1844.02,223.546 1846.37,475.342 1848.72,468.847 1851.07,402.994 1853.42,366.148 1855.77,444.57 1858.12,323.241 1860.47,428.603 1862.82,394.815 1865.17,554.775 1867.52,333.763 1869.87,416.786 1872.22,323.071 1874.57,307.388 1876.92,411.321 1879.27,557.1 1881.62,468.232 1883.97,334.754 1886.32,483.159 1888.68,367.134 1891.03,270.021 1893.38,328.466 1895.73,321.47 1898.08,457.872 1900.43,596.343 1902.78,362.552 1905.13,400.55 1907.48,520.112 1909.83,397.228 1912.18,396.556 1914.53,554.543 1916.88,329.43 1919.23,238.089 1921.58,503.212 1923.93,334.97 1926.28,604.635 1928.63,384.602 1930.98,440.918 1933.33,360.573 1935.68,497.365 1938.04,512.819 1940.39,341.251 1942.74,391.853 1945.09,400.361 1947.44,475.462 1949.79,284.699 1952.14,250.104 1954.49,294.22 1956.84,380.341 1959.19,472.9 1961.54,540.263 1963.89,525.508 1966.24,419.583 1968.59,362.653 1970.94,434.946 1973.29,457.13 1975.64,523.529 1977.99,391.558 1980.34,378.433 1982.69,283.312 1985.04,410.116 1987.4,407.943 1989.75,476.584 1992.1,425.153 1994.45,428.871 1996.8,498.121 1999.15,293.55 2001.5,259.113 2003.85,433.901 2006.2,353.272 2008.55,386.68 2010.9,324.82 2013.25,217.55 2015.6,357.225 2017.95,364.269 2020.3,379.146 2022.65,461.025 2025,468.77 2027.35,455.546 2029.7,390.418 2032.05,341.393 2034.4,486.784 2036.76,461.53 2039.11,469.891 2041.46,436.615 2043.81,411.691 2046.16,232.098 2048.51,463.329 2050.86,624.063 2053.21,398.623 2055.56,405.635 2057.91,545.726 2060.26,481.317 2062.61,622.439 2064.96,486.754 2067.31,423.299 2069.66,549.849 2072.01,333.834 2074.36,693.932 2076.71,465.515 2079.06,437.146 2081.41,461.016 2083.76,317.455 2086.11,412.293 2088.47,487.526 2090.82,431.535 2093.17,412.115 2095.52,271.706 2097.87,441.887 2100.22,232.283 2102.57,601.161 2104.92,371.089 2107.27,377.175 2109.62,253.482 2111.97,406.89 2114.32,441.928 2116.67,559.649 2119.02,433.371 2121.37,543.767 2123.72,586.252 2126.07,364.284 2128.42,244.386 2130.77,410.534 2133.12,610.219 2135.47,297.557 2137.83,517.932 2140.18,400.18 2142.53,407.615 2144.88,294.676 2147.23,303.31 2149.58,478.012 2151.93,421.844 2154.28,258.929 2156.63,255.297 2158.98,319.902 2161.33,227.332 2163.68,408.8 2166.03,492.597 2168.38,401.102 2170.73,353.118 2173.08,427.859 2175.43,553.571 2177.78,481.645 2180.13,270.704 2182.48,305.281 2184.83,347.008 2187.19,368.247 2189.54,256.471 2191.89,342.896 2194.24,502.656 2196.59,412.965 2198.94,382.133 2201.29,369.868 2203.64,409.249 2205.99,462.149 2208.34,426.094 2210.69,418.17 2213.04,410.664 2215.39,383.48 2217.74,302.81 2220.09,419.084 2222.44,382.503 2224.79,354.892 2227.14,340.737 2229.49,482.04 2231.84,262.086 2234.19,418.127 2236.55,422.839 2238.9,359.597 2241.25,598.618 2243.6,475.839 2245.95,316.709 2248.3,412.151 2250.65,411.627 2253,308.017 2255.35,395.294 2257.7,409.944 2260.05,441.954 2262.4,337.752 2264.75,425.469 2267.1,391.139 2269.45,483.771 2271.8,148.422 2274.15,344.806 2276.5,432.919 2278.85,281.64 2281.2,366.657 2283.55,496.007 2285.91,245.747 2288.26,457.086 2290.61,173.501 2292.96,419.644 2295.31,548.743 2297.66,454.57 2300.01,403.113 2302.36,284.549 2304.71,472.577 2307.06,362.134 2309.41,405.517 2311.76,359.497 2314.11,391.671 2316.46,379.85 2318.81,341.518 2321.16,597.533 2323.51,370.041 2325.86,398.575 2328.21,558.8 2330.56,345.874 2332.91,304.77 2335.27,495.368 2337.62,534.539 2339.97,539.825 2342.32,644.615 2344.67,465.768 2347.02,366.754 2349.37,464.887 2351.72,313.658 2354.07,492.84 2356.42,448.542 2358.77,191.022 2361.12,432.133 2363.47,283.555 2365.82,442.801 2368.17,491.152 2370.52,404.197 2372.87,310.366 2375.22,391.751 2377.57,437.477 2379.92,362.377 2382.27,324.523 2384.62,684.251 2386.98,605.432 2389.33,349.467 2391.68,392.825 2394.03,337.838 2396.38,472.452 2398.73,339.741 2401.08,567.638 2403.43,399.014 2405.78,424.395 2408.13,467.938 2410.48,247.71 2412.83,341.523 2415.18,608.827 2417.53,229.291 2419.88,214.62 2422.23,561.046 2424.58,307.809 2426.93,455.231 2429.28,429.311 2431.63,296.829 2433.98,457.457 2436.34,406.228 2438.69,397.212 2441.04,514.42 2443.39,404.932 2445.74,380.541 2448.09,471.655 2450.44,262.22 2452.79,538.258 2455.14,471.954 2457.49,524.197 2459.84,302.533 2462.19,513.319 2464.54,495.032 2466.89,477.153 2469.24,398.088 2471.59,329.743 2473.94,417.249 2476.29,416.023 2478.64,374.349 2480.99,324.158 2483.34,381.649 2485.7,307.401 2488.05,377.377 2490.4,535.658 2492.75,342.128 2495.1,255.64 2497.45,388.48 2499.8,230.719 2502.15,439.459 2504.5,475.911 2506.85,480.434 2509.2,218.498 2511.55,526.564 2513.9,494.87 2516.25,308.93 2518.6,461.459 2520.95,241.419 2523.3,343.174 2525.65,474.118 2528,458.519 2530.35,493.462 2532.7,341.779 2535.06,209.895 2537.41,430.869 2539.76,522.686 2542.11,528.238 2544.46,324.818 2546.81,439.417 2549.16,499.438 2551.51,219.2 2553.86,429.505 2556.21,447.914 2558.56,403.492 2560.91,575.971 2563.26,387.169 2565.61,462.491 2567.96,451.223 2570.31,358.724 "></polyline>
</svg>
</div>
</div>
<p>Look at that! Things are working; amazin’.</p>
<p>We can also exploit <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>’s parallel sampling capabilities:</p>
<div id="34" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run separate 4 chains for 10 000 iterations using threads to parallelize.</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>num_chains <span class="op">=</span> <span class="fl">4</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    model_with_grad,</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">MCMCThreads</span>(),</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>,</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    num_chains;</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Note we need to provide an initial state for every chain.</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>    initial_state<span class="op">=</span><span class="fu">fill</span>(state, num_chains),</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>samples_array <span class="op">=</span> <span class="fu">stack</span>(<span class="fu">map</span>(<span class="bu">Base</span>.<span class="fu">Fix1</span>(stack, sample <span class="op">-&gt;</span> sample.x), samples))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000×4 Array{Float64, 3}:
[:, :, 1] =
 -3.60298   -4.08755  -4.72     -5.75841  …  -5.6304    -5.6304    -5.6304
 -0.935291  -1.15013  -3.07755  -1.7425       0.109269   0.109269   0.109269
  3.38175    4.48865   4.30757   4.66613      4.13947    4.13947    4.13947

[:, :, 2] =
 -1.12248  -2.14839  -3.54571  -5.8304    …  -4.5114    -5.34719  -6.17847
  1.5343   -1.2372   -1.46861   0.399556      0.308106   1.41184  -0.447853
  3.01267   4.84896   4.81593   3.63371       2.67293    3.82626   3.32958

[:, :, 3] =
 -3.61053  -4.33758   -4.33758   …  -3.17318   -6.17508  -6.28913
  1.23678   0.459142   0.459142     -0.096114  -1.04403   0.0870045
  3.39196   4.39656    4.39656       6.22074    5.93314   4.89511

[:, :, 4] =
 -2.53313   -4.05296   -3.0161    …  -4.70413   -2.95374   -3.73873
 -0.317783   0.820679   0.960297      0.872343  -0.335397  -0.389937
  0.760687   3.09299    5.3717        2.88794    3.3479     4.15353</code></pre>
</div>
</div>
<p>But the fact that we have to provide the <code>AbstractMCMC.sample</code> call, etc. with an <code>initial_state</code> to get started is a bit annoying. We can avoid this by also defining a <code>AbstractMCMC.step</code> <em>without</em> the <code>state</code> argument:</p>
<div id="36" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">::</span><span class="dt">MALA</span>;</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># </span><span class="al">NOTE</span><span class="co">: No state provided!</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just create the initial state by sampling using  a Gaussian.</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="fu">randn</span>(rng, LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(x), <span class="fu">MALAState</span>(x)</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Equipped with this, we no longer need to provide the <code>initial_state</code> everywhere:</p>
<div id="38" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -4.96756    0.996651
 -0.0302609  0.998431
  4.98319    1.00737</code></pre>
</div>
</div>
</section>
<section id="using-our-sampler-with-turing.jl" class="level2">
<h2 class="anchored" data-anchor-id="using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</h2>
<p>As we promised, all of this hassle of implementing our <code>MALA</code> sampler in a way that uses <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> and <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> gets us something more than <em>just</em> an “automatic” implementation of <code>AbstractMCMC.sample</code>.</p>
<p>It also enables use with Turing.jl through the <code>externalsampler</code>, but we need to do one final thing first: we need to tell Turing.jl how to extract a vector of parameters from the “sample” returned in our implementation of <code>AbstractMCMC.step</code>. In our case, the “sample” is a <code>MALASample</code>, so we just need the following line:</p>
<div id="40" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load Turing.jl.</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Turing</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Overload the `getparams` method for our "sample" type, which is just a vector.</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>Turing.Inference.<span class="fu">getparams</span>(<span class="op">::</span><span class="dt">Turing.Model</span>, sample<span class="op">::</span><span class="dt">MALASample</span>) <span class="op">=</span> sample.x</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And with that, we’re good to go!</p>
<div id="42" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Our previous model defined as a Turing.jl model.</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">mvnormal_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">MvNormal</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.], I)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate our model.</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">mvnormal_model</span>()</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Call `sample` but now we're passing in a Turing.jl `model` and wrapping</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co"># our `MALA` sampler in the `externalsampler` to tell Turing.jl that the sampler</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co"># expects something that implements LogDensityProblems.jl.</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×4×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 2.47 seconds
Compute duration  = 2.47 seconds
parameters        = x[1], x[2], x[3]
internals         = lp

Summary Statistics
  parameters      mean       std      mcse    ess_bulk    ess_tail      rhat   ⋯
      Symbol   Float64   Float64   Float64     Float64     Float64   Float64   ⋯

        x[1]   -5.0011    0.9957    0.0170   3434.2110   5212.9657    0.9999   ⋯
        x[2]   -0.0001    1.0080    0.0184   2996.1040   4747.6060    1.0000   ⋯
        x[3]    4.9973    1.0103    0.0179   3182.9796   5143.0437    1.0001   ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

        x[1]   -6.9716   -5.6687   -4.9832   -4.3343   -3.0565
        x[2]   -1.9821   -0.6900   -0.0047    0.6718    1.9655
        x[3]    2.9934    4.3186    4.9943    5.6778    6.9823</code></pre>
</div>
</div>
<p>Pretty neat, eh?</p>
<section id="models-with-constrained-parameters" class="level3">
<h3 class="anchored" data-anchor-id="models-with-constrained-parameters">Models with constrained parameters</h3>
<p>One thing we’ve sort of glossed over in all of the above is that MALA, at least how we’ve implemented it, requires <span class="math inline">\(x\)</span> to live in <span class="math inline">\(\mathbb{R}^d\)</span> for some <span class="math inline">\(d &gt; 0\)</span>. If some of the parameters were in fact constrained, e.g.&nbsp;we were working with a <code>Beta</code> distribution which has support on the interval <span class="math inline">\((0, 1)\)</span>, <em>not</em> on <span class="math inline">\(\mathbb{R}^d\)</span>, we could easily end up outside of the valid range <span class="math inline">\((0, 1)\)</span>.</p>
<div id="44" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">beta_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">beta_model</span>()</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 1.44 seconds
Compute duration  = 1.44 seconds
parameters        = x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse    ess_bulk    ess_tail      rhat   ⋯
      Symbol   Float64   Float64   Float64     Float64     Float64   Float64   ⋯

           x    0.5060    0.1907    0.0028   4411.3970   6061.6812    0.9999   ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

           x    0.1491    0.3642    0.5048    0.6477    0.8641</code></pre>
</div>
</div>
<p>Yep, that still works, but only because Turing.jl actually <em>transforms</em> the <code>turing_model</code> from constrained to unconstrained, so that the <code>sampler</code> provided to <code>externalsampler</code> is actually always working in unconstrained space! This is not always desirable, so we can turn this off:</p>
<div id="46" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 0.24 seconds
Compute duration  = 0.24 seconds
parameters        = x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse   ess_bulk   ess_tail      rhat   e ⋯
      Symbol   Float64   Float64   Float64    Float64    Float64   Float64     ⋯

           x    0.5089    0.1459    0.0114   130.2059    34.0091    1.0157     ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

           x    0.2818    0.3812    0.5006    0.6250    0.7803</code></pre>
</div>
</div>
<p>The fun thing is that this still sort of works because</p>
<div id="48" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">logpdf</span>(<span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>), <span class="fl">10.0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-Inf</code></pre>
</div>
</div>
<p>and so the samples that fall outside of the range are always rejected. But do notice how much worse all the diagnostics are, e.g.&nbsp;<code>ess_tail</code> is very poor compared to when we use <code>unconstrained=true</code>. Moreover, in more complex cases this won’t just result in a “nice” <code>-Inf</code> log-density value, but instead will error:</p>
<div id="50" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="kw">function</span> <span class="fu">demo</span>()</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>    σ² <span class="op">~</span> <span class="fu">truncated</span>(<span class="fu">Normal</span>(), lower<span class="op">=</span><span class="fl">0</span>)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If we end up with negative values for `σ²`, the `Normal` will error.</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>    x <span class="op">~</span> <span class="fu">Normal</span>(<span class="fl">0</span>, σ²)</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>DomainError: DomainError(-0.20255313720334697, "Normal: the condition σ &gt;= zero(σ) is not satisfied.")
DomainError with -0.20255313720334697:
Normal: the condition σ &gt;= zero(σ) is not satisfied.
Stacktrace:
  [1] #371
    @ ~/.julia/packages/Distributions/nmUhn/src/univariate/continuous/normal.jl:37 [inlined]
  [2] check_args
    @ ~/.julia/packages/Distributions/nmUhn/src/utils.jl:89 [inlined]
  [3] #Normal#370
    @ ~/.julia/packages/Distributions/nmUhn/src/univariate/continuous/normal.jl:37 [inlined]
  [4] Normal
    @ ~/.julia/packages/Distributions/nmUhn/src/univariate/continuous/normal.jl:36 [inlined]
  [5] Normal
    @ ~/.julia/packages/Distributions/nmUhn/src/univariate/continuous/normal.jl:42 [inlined]
  [6] macro expansion
    @ ~/.julia/packages/DynamicPPL/MjWTB/src/compiler.jl:579 [inlined]
  [7] demo(__model__::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, __varinfo__::DynamicPPL.ThreadSafeVarInfo{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, Vector{Base.RefValue{Float64}}}, __context__::DynamicPPL.ValuesAsInModelContext{OrderedDict{Any, Any}, DynamicPPL.DefaultContext})
    @ Main.Notebook ~/work/docs/docs/tutorials/docs-17-implementing-samplers/index.qmd:592
  [8] _evaluate!!
    @ ~/.julia/packages/DynamicPPL/MjWTB/src/model.jl:973 [inlined]
  [9] evaluate_threadsafe!!(model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, varinfo::DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, context::DynamicPPL.ValuesAsInModelContext{OrderedDict{Any, Any}, DynamicPPL.DefaultContext})
    @ DynamicPPL ~/.julia/packages/DynamicPPL/MjWTB/src/model.jl:962
 [10] evaluate!!
    @ ~/.julia/packages/DynamicPPL/MjWTB/src/model.jl:892 [inlined]
 [11] values_as_in_model
    @ ~/.julia/packages/DynamicPPL/MjWTB/src/values_as_in_model.jl:196 [inlined]
 [12] values_as_in_model
    @ ~/.julia/packages/DynamicPPL/MjWTB/src/values_as_in_model.jl:195 [inlined]
 [13] getparams(model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, vi::DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64})
    @ Turing.Inference ~/.julia/packages/Turing/Bv30p/src/mcmc/Inference.jl:343
 [14] Turing.Inference.Transition(model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, vi::DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, t::MALASample{Vector{Float64}})
    @ Turing.Inference ~/.julia/packages/Turing/Bv30p/src/mcmc/Inference.jl:226
 [15] transition_to_turing
    @ ~/.julia/packages/Turing/Bv30p/src/mcmc/abstractmcmc.jl:12 [inlined]
 [16] transition_to_turing(f::LogDensityProblemsADForwardDiffExt.ForwardDiffLogDensity{LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, Nothing}, ForwardDiff.Chunk{2}, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}, transition::MALASample{Vector{Float64}})
    @ Turing.Inference ~/.julia/packages/Turing/Bv30p/src/mcmc/abstractmcmc.jl:17
 [17] step(rng::TaskLocalRNG, model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, sampler_wrapper::DynamicPPL.Sampler{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}; initial_state::Nothing, initial_params::Nothing, kwargs::@Kwargs{})
    @ Turing.Inference ~/.julia/packages/Turing/Bv30p/src/mcmc/abstractmcmc.jl:141
 [18] step
    @ ~/.julia/packages/Turing/Bv30p/src/mcmc/abstractmcmc.jl:96 [inlined]
 [19] macro expansion
    @ ~/.julia/packages/AbstractMCMC/YrmkI/src/sample.jl:130 [inlined]
 [20] macro expansion
    @ ~/.julia/packages/AbstractMCMC/YrmkI/src/logging.jl:16 [inlined]
 [21] mcmcsample(rng::TaskLocalRNG, model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, sampler::DynamicPPL.Sampler{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}, N::Int64; progress::Bool, progressname::String, callback::Nothing, discard_initial::Int64, thinning::Int64, chain_type::Type, initial_state::Nothing, kwargs::@Kwargs{})
    @ AbstractMCMC ~/.julia/packages/AbstractMCMC/YrmkI/src/sample.jl:120
 [22] sample(rng::TaskLocalRNG, model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, sampler::DynamicPPL.Sampler{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}, N::Int64; chain_type::Type, resume_from::Nothing, initial_state::Nothing, kwargs::@Kwargs{progress::Bool})
    @ DynamicPPL ~/.julia/packages/DynamicPPL/MjWTB/src/sampler.jl:93
 [23] sample
    @ ~/.julia/packages/DynamicPPL/MjWTB/src/sampler.jl:83 [inlined]
 [24] #sample#4
    @ ~/.julia/packages/Turing/Bv30p/src/mcmc/Inference.jl:276 [inlined]
 [25] sample
    @ ~/.julia/packages/Turing/Bv30p/src/mcmc/Inference.jl:267 [inlined]
 [26] #sample#3
    @ ~/.julia/packages/Turing/Bv30p/src/mcmc/Inference.jl:264 [inlined]
 [27] top-level scope
    @ ~/work/docs/docs/tutorials/docs-17-implementing-samplers/index.qmd:594</code></pre>
</div>
</div>
<p>As expected, we run into a <code>DomainError</code> at some point, while if we set <code>unconstrained=true</code>, letting Turing.jl transform the model to a unconstrained form behind the scenes, everything works as expected:</p>
<div id="52" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 1.6 seconds
Compute duration  = 1.6 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse   ess_bulk   ess_tail      rhat   e ⋯
      Symbol   Float64   Float64   Float64    Float64    Float64   Float64     ⋯

          σ²    0.8981    0.5291    0.0195   705.2896   613.8579    1.0009     ⋯
           x    0.1017    1.0607    0.0626   405.3641   182.6354    1.0007     ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

          σ²    0.1771    0.4614    0.8167    1.2343    2.1590
           x   -2.0438   -0.4315    0.0469    0.5549    2.8771</code></pre>
</div>
</div>
<p>Neat!</p>
<p>Similarly, which automatic differentiation backend one should use can be specified through the <code>adtype</code> keyword argument too. For example, if we want to use <a href="https://github.com/JuliaDiff/ReverseDiff.jl">ReverseDiff.jl</a> instead of the default <a href="https://github.com/JuliaDiff/ForwardDiff.jl">ForwardDiff.jl</a>:</p>
<div id="54" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">ReverseDiff</span>: ReverseDiff</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify that we want to use `AutoReverseDiff`.</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">demo</span>(),</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>, adtype<span class="op">=</span><span class="fu">AutoReverseDiff</span>()),</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>;</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 2.92 seconds
Compute duration  = 2.92 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse   ess_bulk   ess_tail      rhat   e ⋯
      Symbol   Float64   Float64   Float64    Float64    Float64   Float64     ⋯

          σ²    0.8793    0.6188    0.0344   292.5834   130.7817    1.0136     ⋯
           x   -0.0769    1.0847    0.0735   477.2879   242.6337    1.0059     ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

          σ²    0.0925    0.3954    0.7313    1.2054    2.5179
           x   -2.6085   -0.4605   -0.0079    0.3561    1.9906</code></pre>
</div>
</div>
<p>Double-neat.</p>
</section>
</section>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<p>At this point it’s worth maybe reminding ourselves what we did and also <em>why</em> we did it:</p>
<ol type="1">
<li>We define our models in the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface because it makes the sampler agnostic to how the underlying model is implemented.</li>
<li>We implement our sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> interface, which just means that our sampler is a subtype of <code>AbstractMCMC.AbstractSampler</code> and we implement the MCMC transition in <code>AbstractMCMC.step</code>.</li>
<li>Points 1 and 2 makes it so our sampler can be used with a wide range of model implementations, amongst them being models implemented in both Turing.jl and Stan. This gives you, the inference implementer, a large collection of models to test your inference method on, in addition to allowing users of Turing.jl and Stan to try out your inference method with minimal effort.</li>
</ol>


</section>


<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a><div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>We’re going with the leapfrog formulation because in a future version of this tutorial we’ll add a section extending this simple “baseline” MALA sampler to more complex versions. See <a href="https://github.com/TuringLang/docs/issues/479">issue #479</a> for progress on this.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>There is no such thing as a proper interface in Julia (at least not officially), and so we use the word “interface” here to mean a few minimal methods that needs to be implemented by any type that we treat as a target model.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/turinglang\.org\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../tutorials/docs-07-for-developers-variational-inference/index.html" class="pagination-link" aria-label="Variational Inference">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Variational Inference</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Turing is created by <a href="http://mlg.eng.cam.ac.uk/hong/" target="_blank">Hong Ge</a>, and lovingly maintained by the <a href="https://github.com/TuringLang/Turing.jl/graphs/contributors" target="_blank">core team</a> of volunteers. <br> The contents of this website are © 2024 under the terms of the <a href="https://github.com/TuringLang/Turing.jl/blob/master/LICENCE" target="_blank">MIT License</a>.</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/TuringLang/docs/edit/master/tutorials/docs-17-implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/docs/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://x.com/TuringLang">
      <i class="bi bi-twitter" role="img" aria-label="Turing Twitter">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/TuringLang/Turing.jl">
      <i class="bi bi-github" role="img" aria-label="Turing GitHub">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




<script src="../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>