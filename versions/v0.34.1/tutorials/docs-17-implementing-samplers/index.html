<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Implementing samplers – Turing.jl</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../tutorials/docs-07-for-developers-variational-inference/index.html" rel="prev">
<link href="../../assets/favicon.ico" rel="icon">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<style>
  a {
    text-decoration: none;
  }
  a:hover {
    text-decoration: underline;
  }
</style>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../theming/styles.css">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="https://turinglang.org/" class="navbar-brand navbar-brand-logo">
    <img src="../../assets/images/turing-logo.svg" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="https://turinglang.org/">
    <span class="navbar-title">Turing.jl</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../tutorials/docs-00-getting-started/"> 
<span class="menu-text">Get Started</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../tutorials/00-introduction/"> 
<span class="menu-text">Tutorials</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/library/"> 
<span class="menu-text">Libraries</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/news/"> 
<span class="menu-text">News</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/team/"> 
<span class="menu-text">Team</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-v0.34" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">v0.34</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-v0.34">    
        <li>
    <a class="dropdown-item" href="https://turinglang.org/docs/changelog.html">
 <span class="dropdown-text">Changelog</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://turinglang.org/docs/versions.html">
 <span class="dropdown-text">All Versions</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools tools-wide">
    <a href="https://x.com/TuringLang" title="Turing Twitter" class="quarto-navigation-tool px-1" aria-label="Turing Twitter"><i class="bi bi-twitter"></i></a>
    <a href="https://github.com/TuringLang/Turing.jl" title="Turing GitHub" class="quarto-navigation-tool px-1" aria-label="Turing GitHub"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Developers</li><li class="breadcrumb-item"><a href="../../tutorials/docs-06-for-developers-interface/index.html">Inference (note: outdated)</a></li><li class="breadcrumb-item"><a href="../../tutorials/docs-17-implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false">
 <span class="menu-text">Users</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-00-getting-started/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Getting Started</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-12-using-turing-guide/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Core Functionality</span></a>
  </div>
</li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false">
 <span class="menu-text">Usage Tips</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-10-using-turing-autodiff/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Automatic Differentiation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/usage-custom-distribution/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Custom Distributions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/usage-probability-interface/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Querying Model Probabilities</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/usage-modifying-logprob/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Modifying the Log Probability</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/usage-generated-quantities/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Generated Quantities</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-17-mode-estimation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Mode Estimation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-13-using-turing-performance-tips/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Performance Tips</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-15-using-turing-sampler-viz/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Sampler Visualization</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-11-using-turing-dynamichmc/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using DynamicHMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-16-using-turing-external-samplers/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using External Samplers</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false">
 <span class="menu-text">Tutorials</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/00-introduction/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction: Coin Flipping</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/01-gaussian-mixture-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Mixture Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/02-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/03-bayesian-neural-network/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Neural Networks</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/04-hidden-markov-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Hidden Markov Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/05-linear-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Linear Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/06-infinite-mixture-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Infinite Mixture Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/07-poisson-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Poisson Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/08-multinomial-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Multinomial Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/09-variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/10-bayesian-differential-equations/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Differential Equations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/11-probabilistic-pca/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Probabilistic PCA</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/13-seasonal-time-series/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Time Series Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/15-gaussian-processes/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction to Gaussian Processes</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/12-gplvm/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Process Latent Variable Models</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Developers</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false">
 <span class="menu-text">Contributing</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-01-contributing-guide/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">How to Contribute</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="false">
 <span class="menu-text">DynamicPPL in Depth</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/dev-model-manual/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Manually Defining a Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-05-for-developers-compiler/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Turing Compiler Design</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/14-minituring/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation I: Compiler</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/16-contexts/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation II: Contexts</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true">
 <span class="menu-text">Inference (note: outdated)</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-06-for-developers-interface/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Interface Guide</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-04-for-developers-abstractmcmc-turing/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">How Turing implements AbstractMCMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-07-for-developers-variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-17-implementing-samplers/index.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Implementing Samplers</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of Contents</h2>
   
  <ul>
  <li><a href="#quick-overview-of-mala" id="toc-quick-overview-of-mala" class="nav-link active" data-scroll-target="#quick-overview-of-mala">Quick overview of MALA</a></li>
  <li><a href="#what-we-need-from-a-model-logdensityproblems.jl" id="toc-what-we-need-from-a-model-logdensityproblems.jl" class="nav-link" data-scroll-target="#what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: LogDensityProblems.jl</a></li>
  <li><a href="#implementing-mala-in-abstractmcmc.jl" id="toc-implementing-mala-in-abstractmcmc.jl" class="nav-link" data-scroll-target="#implementing-mala-in-abstractmcmc.jl">Implementing MALA in AbstractMCMC.jl</a></li>
  <li><a href="#using-our-sampler-with-turing.jl" id="toc-using-our-sampler-with-turing.jl" class="nav-link" data-scroll-target="#using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</a>
  <ul class="collapse">
  <li><a href="#models-with-constrained-parameters" id="toc-models-with-constrained-parameters" class="nav-link" data-scroll-target="#models-with-constrained-parameters">Models with constrained parameters</a></li>
  </ul></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/TuringLang/docs/edit/master/tutorials/docs-17-implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/docs/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Developers</li><li class="breadcrumb-item"><a href="../../tutorials/docs-06-for-developers-interface/index.html">Inference (note: outdated)</a></li><li class="breadcrumb-item"><a href="../../tutorials/docs-17-implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Implementing samplers</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>In this tutorial, we’ll go through step-by-step how to implement a “simple” sampler in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> in such a way that it can be easily applied to Turing.jl models.</p>
<p>In particular, we’re going to implement a version of <strong>Metropolis-adjusted Langevin (MALA)</strong>.</p>
<p>Note that we will implement this sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> framework, completely “ignoring” Turing.jl until the very end of the tutorial, at which point we’ll use a single line of code to make the resulting sampler available to Turing.jl. This is to really drive home the point that one can implement samplers in a way that is accessible to all of Turing.jl’s users without having to use Turing.jl yourself.</p>
<section id="quick-overview-of-mala" class="level2">
<h2 class="anchored" data-anchor-id="quick-overview-of-mala">Quick overview of MALA</h2>
<p>We can view MALA as a single step of the leapfrog intergrator with resampling of momentum <span class="math inline">\(p\)</span> at every step.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> To make that statement a bit more concrete, we first define the <em>extended</em> target <span class="math inline">\(\bar{\gamma}(x, p)\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\log \bar{\gamma}(x, p) \propto \log \gamma(x) + \log \gamma_{\mathcal{N}(0, M)}(p)
\end{equation*}\]</span></p>
<p>where <span class="math inline">\(\gamma_{\mathcal{N}(0, M)}\)</span> denotes the density for a zero-centered Gaussian with covariance matrix <span class="math inline">\(M\)</span>. We then consider targeting this joint distribution over both <span class="math inline">\(x\)</span> and <span class="math inline">\(p\)</span> as follows. First we define the map</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  L_{\epsilon}: \quad &amp; \mathbb{R}^d \times \mathbb{R}^d \to \mathbb{R}^d \times \mathbb{R}^d \\
  &amp; (x, p) \mapsto (\tilde{x}, \tilde{p}) := L_{\epsilon}(x, p)
\end{split}
\end{equation*}\]</span></p>
<p>as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p_{1 / 2} &amp;:= p + \frac{\epsilon}{2} \nabla \log \gamma(x) \\
  \tilde{x} &amp;:= x + \epsilon M^{-1} p_{1 /2 } \\
  p_1 &amp;:= p_{1 / 2} + \frac{\epsilon}{2} \nabla \log \gamma(\tilde{x}) \\
  \tilde{p} &amp;:= - p_1
\end{split}
\end{equation*}\]</span></p>
<p>This might be familiar for some readers as a single step of the Leapfrog integrator. We then define the MALA kernel as follows: given the current iterate <span class="math inline">\(x_i\)</span>, we sample the next iterate <span class="math inline">\(x_{i + 1}\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p &amp;\sim \mathcal{N}(0, M) \\
  (\tilde{x}, \tilde{p}) &amp;:= L_{\epsilon}(x_i, p) \\
  \alpha &amp;:= \min \left\{ 1, \frac{\bar{\gamma}(\tilde{x}, \tilde{p})}{\bar{\gamma}(x_i, p)} \right\} \\
  x_{i + 1} &amp;:=
  \begin{cases}
    \tilde{x} \quad &amp; \text{ with prob. } \alpha \\
    x_i       \quad &amp; \text{ with prob. } 1 - \alpha
  \end{cases}
\end{split}
\end{equation*}\]</span></p>
<p>i.e.&nbsp;we accept the proposal <span class="math inline">\(\tilde{x}\)</span> with probability <span class="math inline">\(\alpha\)</span> and reject it, thus sticking with our current iterate, with probability <span class="math inline">\(1 - \alpha\)</span>.</p>
</section>
<section id="what-we-need-from-a-model-logdensityproblems.jl" class="level2">
<h2 class="anchored" data-anchor-id="what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a></h2>
<p>There are a few things we need from the “target” / “model” / density that we want to sample from:</p>
<ol type="1">
<li>We need access to log-density <em>evaluations</em> <span class="math inline">\(\log \gamma(x)\)</span> so we can compute the acceptance ratio involving <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>We need access to log-density <em>gradients</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span> so we can compute the Leapfrog steps <span class="math inline">\(L_{\epsilon}(x, p)\)</span>.</li>
<li>We also need access to the “size” of the model so we can determine the size of <span class="math inline">\(M\)</span>.</li>
</ol>
<p>Luckily for us, there is a package called <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> which provides an interface for <em>exactly</em> this!</p>
<p>To demonstrate how one can implement the “<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface”<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> we will use a simple Gaussian model as an example:</p>
<div id="4" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblems</span>: LogDensityProblems;</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's define some type that represents the model.</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> IsotropicNormalModel{M<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"mean of the isotropic Gaussian"</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    mean<span class="op">::</span><span class="dt">M</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Specifies what input length the model expects.</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">dimension</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> <span class="fu">length</span>(model.mean)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Implementation of the log-density evaluation of the model.</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x<span class="op">::</span><span class="dt">AbstractVector{&lt;:Real}</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">-</span> <span class="fu">sum</span>(abs2, x <span class="op">.-</span> model.mean) <span class="op">/</span> <span class="fl">2</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This gives us all of the properties we want for our MALA sampler with the exception of the computation of the <em>gradient</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span>. There is the method <code>LogDensityProblems.logdensity_and_gradient</code> which should return a 2-tuple where the first entry is the evaluation of the logdensity <span class="math inline">\(\log \gamma(x)\)</span> and the second entry is the gradient <span class="math inline">\(\nabla \log \gamma(x)\)</span>.</p>
<p>There are two ways to “implement” this method: 1) we implement it by hand, which is feasible in the case of our <code>IsotropicNormalModel</code>, or b) we defer the implementation of this to a automatic differentiation backend.</p>
<p>To implement it by hand we can simply do</p>
<div id="6" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl that first-order, i.e. gradient information, is available.</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{1}</span>()</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Implement `logdensity_and_gradient`.</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    logγ_x <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="op">-</span>x <span class="op">.*</span> (x <span class="op">-</span> model.mean)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> logγ_x, ∇logγ_x</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s just try it out:</p>
<div id="8" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate the problem.</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> <span class="fu">IsotropicNormalModel</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.])</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create some example input that we can test on.</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>x_example <span class="op">=</span> <span class="fu">randn</span>(LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate!</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-23.851182000941407</code></pre>
</div>
</div>
<p>To defer it to an automatic differentiation backend, we can do</p>
<div id="10" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl we only have access to 0-th order information.</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{0}</span>()</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Use `LogDensityProblemsAD`'s `ADgradient` in combination with some AD backend to implement `logdensity_and_gradient`.</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblemsAD</span>, <span class="bu">ADTypes</span>, <span class="bu">ForwardDiff</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>model_with_grad <span class="op">=</span> <span class="fu">ADgradient</span>(<span class="fu">AutoForwardDiff</span>(), model)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model_with_grad, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-23.851182000941407</code></pre>
</div>
</div>
<p>We’ll continue with the second approach in this tutorial since this is typically what one does in practice, because there are better hobbies to spend time on than deriving gradients by hand.</p>
<p>At this point, one might wonder how we’re going to tie this back to Turing.jl in the end. Effectively, when working with inference methods that only require log-density evaluations and / or higher-order information of the log-density, Turing.jl actually converts the user-provided <code>Model</code> into an object implementing the above methods for <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>. As a result, most samplers provided by Turing.jl are actually implemented to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, enabling their use both <em>within</em> Turing.jl and <em>outside</em> of Turing.jl! Morever, there exists similar conversions for Stan through BridgeStan and Stan<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, which means that a sampler supporting the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface can easily be used on both Turing.jl <em>and</em> Stan models (in addition to user-provided models, as our <code>IsotropicNormalModel</code> above)!</p>
<p>Anyways, let’s move on to actually implementing the sampler.</p>
</section>
<section id="implementing-mala-in-abstractmcmc.jl" class="level2">
<h2 class="anchored" data-anchor-id="implementing-mala-in-abstractmcmc.jl">Implementing MALA in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a></h2>
<p>Now that we’ve established that a model implementing the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface provides us with all the information we need from <span class="math inline">\(\log \gamma(x)\)</span>, we can address the question: given an object that implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, how can we define a sampler for it?</p>
<p>We’re going to do this by making our sampler a sub-type of <code>AbstractMCMC.AbstractSampler</code> in addition to implementing a few methods from <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>. Why? Because it gets us <em>a lot</em> of functionality for free, as we will see later.</p>
<p>Moreover, <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> provides a very natural interface for MCMC algorithms.</p>
<p>First, we’ll define our <code>MALA</code> type</p>
<div id="12" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">AbstractMCMC</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALA{T,A} <span class="op">&lt;:</span><span class="dt"> AbstractMCMC.AbstractSampler</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"stepsize used in the leapfrog step"</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    ϵ_init<span class="op">::</span><span class="dt">T</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"covariance matrix used for the momentum"</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    M_init<span class="op">::</span><span class="dt">A</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notice how we’ve added the suffix <code>_init</code> to both the stepsize and the covariance matrix. We’ve done this because a <code>AbstractMCMC.AbstractSampler</code> should be <em>immutable</em>. Of course there might be many scenarios where we want to allow something like the stepsize and / or the covariance matrix to vary between iterations, e.g.&nbsp;during the burn-in / adaptation phase of the sampling process we might want to adjust the parameters using statistics computed from these initial iterations. But information which can change between iterations <em>should not go in the sampler itself</em>! Instead, this information should go in the sampler <em>state</em>.</p>
<p>The sampler state should at the very least contain all the necessary information to perform the next MCMC iteration, but usually contains further information, e.g.&nbsp;quantities and statistics useful for evaluating whether the sampler has converged.</p>
<p>We will use the following sampler state for our <code>MALA</code> sampler:</p>
<div id="14" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALAState{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This might seem overly redundant: we’re defining a type <code>MALAState</code> and it only contains a simple vector of reals. In this particular case we indeed could have dropped this and simply used a <code>AbstractVector{&lt;:Real}</code> as our sampler state, but typically, as we will see later, one wants to include other quantities in the sampler state. For example, if we also wanted to adapt the parameters of our <code>MALA</code>, e.g.&nbsp;alter the stepsize depending on acceptance rates, in which case we should also put <code>ϵ</code> in the state, but for now we’ll keep things simple.</p>
<p>Moreover, we also want a <em>sample</em> type, which is a type meant for “public consumption”, i.e.&nbsp;the end-user. This is generally going to contain a subset of the information present in the state. But in such a simple scenario as this, we similarly only have a <code>AbstractVector{&lt;:Real}</code>:</p>
<div id="16" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALASample{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We currently have three things:</p>
<ol type="1">
<li>A <code>AbstractMCMC.AbstractSampler</code> implementation called <code>MALA</code>.</li>
<li>A state <code>MALAState</code> for our sampler <code>MALA</code>.</li>
<li>A sample <code>MALASample</code> for our sampler <code>MALA</code>.</li>
</ol>
<p>That means that we’re ready to implement the only thing that really matters: <code>AbstractMCMC.step</code>.</p>
<p><code>AbstractMCMC.step</code> defines the MCMC iteration of our <code>MALA</code> given the current <code>MALAState</code>. Specifically, the signature of the function is as follows:</p>
<div id="18" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The RNG to ensure reproducibility.</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The model that defines our target.</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.AbstractModel</span>,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The sampler for which we're taking a `step`.</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">AbstractMCMC.AbstractSampler</span>,</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The current sampler `state`.</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    state;</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Additional keyword arguments that we may or may not need.</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Moreover, there is a specific <code>AbstractMCMC.AbstractModel</code> which is used to indicate that the model that is provided implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface: <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Since, as we discussed earlier, in our case we’re indeed going to work with types that support the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, we’ll define <code>AbstractMCMC.step</code> for such a <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Note that <code>AbstractMCMC.LogDensityModel</code> has no other purpose; it has a single field called <code>logdensity</code>, and it does nothing else. But by wrapping the model in <code>AbstractMCMC.LogDensityModel</code>, it allows samplers that want to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> to define their <code>AbstractMCMC.step</code> on this type without running into method ambiguities.</p>
<p>All in all, that means that the signature for our <code>AbstractMCMC.step</code> is going to be the following:</p>
<div id="20" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># `LogDensityModel` so we know we're working with LogDensityProblems.jl model.</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler.</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler state.</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Great! Now let’s actually implement the full <code>AbstractMCMC.step</code> for our <code>MALA</code>.</p>
<p>Let’s remind ourselves what we’re going to do:</p>
<ol type="1">
<li>Sample a new momentum <span class="math inline">\(p\)</span>.</li>
<li>Compute the log-density of the extended target <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>Take a single leapfrog step <span class="math inline">\((\tilde{x}, \tilde{p}) = L_{\epsilon}(x, p)\)</span>.</li>
<li>Accept or reject the proposed <span class="math inline">\((\tilde{x}, \tilde{p})\)</span>.</li>
</ol>
<p>All in all, this results in the following:</p>
<div id="22" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>: Random</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Distributions</span>  <span class="co"># so we get the `MvNormal`</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the wrapped model which implements LogDensityProblems.jl.</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just extract the sampler parameters to make our lives easier.</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    ϵ <span class="op">=</span> sampler.ϵ_init</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    M <span class="op">=</span> sampler.M_init</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the current parameters.</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> state.x</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sample the momentum.</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>    p_dist <span class="op">=</span> <span class="fu">MvNormal</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)), M)</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> <span class="fu">rand</span>(rng, p_dist)</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Propose using a single leapfrog step.</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>    x̃, p̃ <span class="op">=</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Accept or reject proposal.</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>    logp <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p)</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>    logp̃ <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x̃) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p̃)</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>    logα <span class="op">=</span> logp̃ <span class="op">-</span> logp</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>    state_new <span class="op">=</span> <span class="cf">if</span> <span class="fu">log</span>(<span class="fu">rand</span>(rng)) <span class="op">&lt;</span> logα</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Accept.</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x̃)</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Reject.</span></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x)</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return the "sample" and the sampler state.</span></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(state_new.x), state_new</span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Fairly straight-forward.</p>
<p>Of course, we haven’t defined the <code>leapfrog_step</code> method yet, so let’s do that:</p>
<div id="24" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p` using "position" `x`.</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x))</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    p1 <span class="op">=</span> p <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update the "position" `x` using momentum `p1`.</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    x̃ <span class="op">=</span> x <span class="op">+</span> ϵ <span class="op">.*</span> (M <span class="op">\</span> p1)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p1` using position `x̃`</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x̃ <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x̃))</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    p2 <span class="op">=</span> p1 <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x̃</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Flip momentum `p2`.</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    p̃ <span class="op">=</span> <span class="op">-</span>p2</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x̃, p̃</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>leapfrog_step (generic function with 1 method)</code></pre>
</div>
</div>
<p>With all of this, we’re technically ready to sample!</p>
<div id="26" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>, <span class="bu">LinearAlgebra</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>rng <span class="op">=</span> <span class="bu">Random</span>.<span class="fu">default_rng</span>()</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>sampler <span class="op">=</span> <span class="fu">MALA</span>(<span class="fl">1</span>, I)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>state <span class="op">=</span> <span class="fu">MALAState</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)))</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>x_next, state_next <span class="op">=</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    rng,</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    AbstractMCMC.<span class="fu">LogDensityModel</span>(model),</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    state</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>(MALASample{Vector{Float64}}([0.0, 0.0, 0.0]), MALAState{Vector{Float64}}([0.0, 0.0, 0.0]))</code></pre>
</div>
</div>
<p>Great, it works!</p>
<p>And I promised we would get quite some functionality for free if we implemented <code>AbstractMCMC.step</code>, and so we can now simply call <code>sample</code> to perform standard MCMC sampling:</p>
<div id="28" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform 1000 iterations with our `MALA` sampler.</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; initial_state<span class="op">=</span>state, progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Concatenate into a matrix.</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000 Matrix{Float64}:
 -3.61308   -3.61308   -2.82943   …  -6.01579   -6.01579   -5.81622
 -0.739007  -0.739007  -0.336483     -0.187648  -0.187648  -0.996667
  3.02455    3.02455    3.03401       5.59995    5.59995    5.40854</code></pre>
</div>
</div>
<div id="30" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the marginal means and standard deviations.</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -5.02368    0.999798
 -0.0364327  1.00144
  5.0232     0.994223</code></pre>
</div>
</div>
<p>Let’s visualize the samples</p>
<div id="32" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">StatsPlots</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">transpose</span>(samples_matrix[<span class="op">:</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">:</span><span class="kw">end</span>]), alpha<span class="op">=</span><span class="fl">0.5</span>, legend<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<!--?xml version="1.0" encoding="utf-8"?-->
<svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" width="672" height="480" viewbox="0 0 2688 1920">
<defs>
  <clippath id="clip470">
    <rect x="0" y="0" width="2688" height="1920"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip470)" d="M0 1920 L2688 1920 L2688 0 L0 0  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip471">
    <rect x="537" y="0" width="1883" height="1883"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip470)" d="M151.747 1800.78 L2640.76 1800.78 L2640.76 47.2441 L151.747 47.2441  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip472">
    <rect x="151" y="47" width="2490" height="1755"></rect>
  </clippath>
</defs>
<polyline clip-path="url(#clip472)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="219.84,1800.78 219.84,47.2441 "></polyline>
<polyline clip-path="url(#clip472)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="807.458,1800.78 807.458,47.2441 "></polyline>
<polyline clip-path="url(#clip472)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1395.08,1800.78 1395.08,47.2441 "></polyline>
<polyline clip-path="url(#clip472)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1982.69,1800.78 1982.69,47.2441 "></polyline>
<polyline clip-path="url(#clip472)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="2570.31,1800.78 2570.31,47.2441 "></polyline>
<polyline clip-path="url(#clip472)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,1543.07 2640.76,1543.07 "></polyline>
<polyline clip-path="url(#clip472)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,1230.44 2640.76,1230.44 "></polyline>
<polyline clip-path="url(#clip472)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,917.801 2640.76,917.801 "></polyline>
<polyline clip-path="url(#clip472)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,605.164 2640.76,605.164 "></polyline>
<polyline clip-path="url(#clip472)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,292.527 2640.76,292.527 "></polyline>
<polyline clip-path="url(#clip470)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1800.78 2640.76,1800.78 "></polyline>
<polyline clip-path="url(#clip470)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="219.84,1800.78 219.84,1781.88 "></polyline>
<polyline clip-path="url(#clip470)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="807.458,1800.78 807.458,1781.88 "></polyline>
<polyline clip-path="url(#clip470)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1395.08,1800.78 1395.08,1781.88 "></polyline>
<polyline clip-path="url(#clip470)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1982.69,1800.78 1982.69,1781.88 "></polyline>
<polyline clip-path="url(#clip470)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="2570.31,1800.78 2570.31,1781.88 "></polyline>
<path clip-path="url(#clip470)" d="M219.84 1834 Q216.229 1834 214.4 1837.57 Q212.595 1841.11 212.595 1848.24 Q212.595 1855.34 214.4 1858.91 Q216.229 1862.45 219.84 1862.45 Q223.474 1862.45 225.28 1858.91 Q227.108 1855.34 227.108 1848.24 Q227.108 1841.11 225.28 1837.57 Q223.474 1834 219.84 1834 M219.84 1830.3 Q225.65 1830.3 228.706 1834.9 Q231.784 1839.49 231.784 1848.24 Q231.784 1856.96 228.706 1861.57 Q225.65 1866.15 219.84 1866.15 Q214.03 1866.15 210.951 1861.57 Q207.896 1856.96 207.896 1848.24 Q207.896 1839.49 210.951 1834.9 Q214.03 1830.3 219.84 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip470)" d="M771.15 1861.55 L787.47 1861.55 L787.47 1865.48 L765.525 1865.48 L765.525 1861.55 Q768.187 1858.79 772.771 1854.16 Q777.377 1849.51 778.558 1848.17 Q780.803 1845.65 781.683 1843.91 Q782.585 1842.15 782.585 1840.46 Q782.585 1837.71 780.641 1835.97 Q778.72 1834.23 775.618 1834.23 Q773.419 1834.23 770.965 1835 Q768.535 1835.76 765.757 1837.31 L765.757 1832.59 Q768.581 1831.46 771.035 1830.88 Q773.488 1830.3 775.525 1830.3 Q780.896 1830.3 784.09 1832.98 Q787.285 1835.67 787.285 1840.16 Q787.285 1842.29 786.474 1844.21 Q785.687 1846.11 783.581 1848.7 Q783.002 1849.37 779.9 1852.59 Q776.798 1855.78 771.15 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip470)" d="M797.331 1830.92 L815.687 1830.92 L815.687 1834.86 L801.613 1834.86 L801.613 1843.33 Q802.632 1842.98 803.65 1842.82 Q804.669 1842.64 805.687 1842.64 Q811.474 1842.64 814.854 1845.81 Q818.233 1848.98 818.233 1854.4 Q818.233 1859.97 814.761 1863.08 Q811.289 1866.15 804.97 1866.15 Q802.794 1866.15 800.525 1865.78 Q798.28 1865.41 795.872 1864.67 L795.872 1859.97 Q797.956 1861.11 800.178 1861.66 Q802.4 1862.22 804.877 1862.22 Q808.882 1862.22 811.22 1860.11 Q813.558 1858.01 813.558 1854.4 Q813.558 1850.78 811.22 1848.68 Q808.882 1846.57 804.877 1846.57 Q803.002 1846.57 801.127 1846.99 Q799.275 1847.4 797.331 1848.28 L797.331 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip470)" d="M837.446 1834 Q833.835 1834 832.007 1837.57 Q830.201 1841.11 830.201 1848.24 Q830.201 1855.34 832.007 1858.91 Q833.835 1862.45 837.446 1862.45 Q841.081 1862.45 842.886 1858.91 Q844.715 1855.34 844.715 1848.24 Q844.715 1841.11 842.886 1837.57 Q841.081 1834 837.446 1834 M837.446 1830.3 Q843.256 1830.3 846.312 1834.9 Q849.391 1839.49 849.391 1848.24 Q849.391 1856.96 846.312 1861.57 Q843.256 1866.15 837.446 1866.15 Q831.636 1866.15 828.557 1861.57 Q825.502 1856.96 825.502 1848.24 Q825.502 1839.49 828.557 1834.9 Q831.636 1830.3 837.446 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip470)" d="M1354.69 1830.92 L1373.05 1830.92 L1373.05 1834.86 L1358.98 1834.86 L1358.98 1843.33 Q1360 1842.98 1361.01 1842.82 Q1362.03 1842.64 1363.05 1842.64 Q1368.84 1842.64 1372.22 1845.81 Q1375.6 1848.98 1375.6 1854.4 Q1375.6 1859.97 1372.12 1863.08 Q1368.65 1866.15 1362.33 1866.15 Q1360.16 1866.15 1357.89 1865.78 Q1355.64 1865.41 1353.24 1864.67 L1353.24 1859.97 Q1355.32 1861.11 1357.54 1861.66 Q1359.76 1862.22 1362.24 1862.22 Q1366.25 1862.22 1368.58 1860.11 Q1370.92 1858.01 1370.92 1854.4 Q1370.92 1850.78 1368.58 1848.68 Q1366.25 1846.57 1362.24 1846.57 Q1360.37 1846.57 1358.49 1846.99 Q1356.64 1847.4 1354.69 1848.28 L1354.69 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip470)" d="M1394.81 1834 Q1391.2 1834 1389.37 1837.57 Q1387.56 1841.11 1387.56 1848.24 Q1387.56 1855.34 1389.37 1858.91 Q1391.2 1862.45 1394.81 1862.45 Q1398.44 1862.45 1400.25 1858.91 Q1402.08 1855.34 1402.08 1848.24 Q1402.08 1841.11 1400.25 1837.57 Q1398.44 1834 1394.81 1834 M1394.81 1830.3 Q1400.62 1830.3 1403.68 1834.9 Q1406.75 1839.49 1406.75 1848.24 Q1406.75 1856.96 1403.68 1861.57 Q1400.62 1866.15 1394.81 1866.15 Q1389 1866.15 1385.92 1861.57 Q1382.87 1856.96 1382.87 1848.24 Q1382.87 1839.49 1385.92 1834.9 Q1389 1830.3 1394.81 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip470)" d="M1424.97 1834 Q1421.36 1834 1419.53 1837.57 Q1417.73 1841.11 1417.73 1848.24 Q1417.73 1855.34 1419.53 1858.91 Q1421.36 1862.45 1424.97 1862.45 Q1428.61 1862.45 1430.41 1858.91 Q1432.24 1855.34 1432.24 1848.24 Q1432.24 1841.11 1430.41 1837.57 Q1428.61 1834 1424.97 1834 M1424.97 1830.3 Q1430.78 1830.3 1433.84 1834.9 Q1436.92 1839.49 1436.92 1848.24 Q1436.92 1856.96 1433.84 1861.57 Q1430.78 1866.15 1424.97 1866.15 Q1419.16 1866.15 1416.08 1861.57 Q1413.03 1856.96 1413.03 1848.24 Q1413.03 1839.49 1416.08 1834.9 Q1419.16 1830.3 1424.97 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip470)" d="M1940.97 1830.92 L1963.19 1830.92 L1963.19 1832.91 L1950.65 1865.48 L1945.76 1865.48 L1957.57 1834.86 L1940.97 1834.86 L1940.97 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip470)" d="M1972.36 1830.92 L1990.71 1830.92 L1990.71 1834.86 L1976.64 1834.86 L1976.64 1843.33 Q1977.66 1842.98 1978.68 1842.82 Q1979.7 1842.64 1980.72 1842.64 Q1986.5 1842.64 1989.88 1845.81 Q1993.26 1848.98 1993.26 1854.4 Q1993.26 1859.97 1989.79 1863.08 Q1986.32 1866.15 1980 1866.15 Q1977.82 1866.15 1975.55 1865.78 Q1973.31 1865.41 1970.9 1864.67 L1970.9 1859.97 Q1972.98 1861.11 1975.21 1861.66 Q1977.43 1862.22 1979.9 1862.22 Q1983.91 1862.22 1986.25 1860.11 Q1988.59 1858.01 1988.59 1854.4 Q1988.59 1850.78 1986.25 1848.68 Q1983.91 1846.57 1979.9 1846.57 Q1978.03 1846.57 1976.15 1846.99 Q1974.3 1847.4 1972.36 1848.28 L1972.36 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip470)" d="M2012.47 1834 Q2008.86 1834 2007.03 1837.57 Q2005.23 1841.11 2005.23 1848.24 Q2005.23 1855.34 2007.03 1858.91 Q2008.86 1862.45 2012.47 1862.45 Q2016.11 1862.45 2017.91 1858.91 Q2019.74 1855.34 2019.74 1848.24 Q2019.74 1841.11 2017.91 1837.57 Q2016.11 1834 2012.47 1834 M2012.47 1830.3 Q2018.28 1830.3 2021.34 1834.9 Q2024.42 1839.49 2024.42 1848.24 Q2024.42 1856.96 2021.34 1861.57 Q2018.28 1866.15 2012.47 1866.15 Q2006.66 1866.15 2003.59 1861.57 Q2000.53 1856.96 2000.53 1848.24 Q2000.53 1839.49 2003.59 1834.9 Q2006.66 1830.3 2012.47 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip470)" d="M2514.84 1861.55 L2522.48 1861.55 L2522.48 1835.18 L2514.17 1836.85 L2514.17 1832.59 L2522.43 1830.92 L2527.11 1830.92 L2527.11 1861.55 L2534.75 1861.55 L2534.75 1865.48 L2514.84 1865.48 L2514.84 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip470)" d="M2554.19 1834 Q2550.58 1834 2548.75 1837.57 Q2546.94 1841.11 2546.94 1848.24 Q2546.94 1855.34 2548.75 1858.91 Q2550.58 1862.45 2554.19 1862.45 Q2557.82 1862.45 2559.63 1858.91 Q2561.46 1855.34 2561.46 1848.24 Q2561.46 1841.11 2559.63 1837.57 Q2557.82 1834 2554.19 1834 M2554.19 1830.3 Q2560 1830.3 2563.06 1834.9 Q2566.13 1839.49 2566.13 1848.24 Q2566.13 1856.96 2563.06 1861.57 Q2560 1866.15 2554.19 1866.15 Q2548.38 1866.15 2545.3 1861.57 Q2542.25 1856.96 2542.25 1848.24 Q2542.25 1839.49 2545.3 1834.9 Q2548.38 1830.3 2554.19 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip470)" d="M2584.35 1834 Q2580.74 1834 2578.91 1837.57 Q2577.11 1841.11 2577.11 1848.24 Q2577.11 1855.34 2578.91 1858.91 Q2580.74 1862.45 2584.35 1862.45 Q2587.99 1862.45 2589.79 1858.91 Q2591.62 1855.34 2591.62 1848.24 Q2591.62 1841.11 2589.79 1837.57 Q2587.99 1834 2584.35 1834 M2584.35 1830.3 Q2590.16 1830.3 2593.22 1834.9 Q2596.3 1839.49 2596.3 1848.24 Q2596.3 1856.96 2593.22 1861.57 Q2590.16 1866.15 2584.35 1866.15 Q2578.54 1866.15 2575.46 1861.57 Q2572.41 1856.96 2572.41 1848.24 Q2572.41 1839.49 2575.46 1834.9 Q2578.54 1830.3 2584.35 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip470)" d="M2614.51 1834 Q2610.9 1834 2609.07 1837.57 Q2607.27 1841.11 2607.27 1848.24 Q2607.27 1855.34 2609.07 1858.91 Q2610.9 1862.45 2614.51 1862.45 Q2618.15 1862.45 2619.95 1858.91 Q2621.78 1855.34 2621.78 1848.24 Q2621.78 1841.11 2619.95 1837.57 Q2618.15 1834 2614.51 1834 M2614.51 1830.3 Q2620.32 1830.3 2623.38 1834.9 Q2626.46 1839.49 2626.46 1848.24 Q2626.46 1856.96 2623.38 1861.57 Q2620.32 1866.15 2614.51 1866.15 Q2608.7 1866.15 2605.62 1861.57 Q2602.57 1856.96 2602.57 1848.24 Q2602.57 1839.49 2605.62 1834.9 Q2608.7 1830.3 2614.51 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip470)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1800.78 151.747,47.2441 "></polyline>
<polyline clip-path="url(#clip470)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1543.07 170.644,1543.07 "></polyline>
<polyline clip-path="url(#clip470)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1230.44 170.644,1230.44 "></polyline>
<polyline clip-path="url(#clip470)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,917.801 170.644,917.801 "></polyline>
<polyline clip-path="url(#clip470)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,605.164 170.644,605.164 "></polyline>
<polyline clip-path="url(#clip470)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,292.527 170.644,292.527 "></polyline>
<path clip-path="url(#clip470)" d="M49.5521 1543.53 L79.2279 1543.53 L79.2279 1547.46 L49.5521 1547.46 L49.5521 1543.53 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip470)" d="M99.8991 1541.21 Q96.7509 1541.21 94.8991 1543.36 Q93.0704 1545.52 93.0704 1549.27 Q93.0704 1552.99 94.8991 1555.17 Q96.7509 1557.32 99.8991 1557.32 Q103.047 1557.32 104.876 1555.17 Q106.728 1552.99 106.728 1549.27 Q106.728 1545.52 104.876 1543.36 Q103.047 1541.21 99.8991 1541.21 M109.181 1526.56 L109.181 1530.82 Q107.422 1529.98 105.617 1529.54 Q103.834 1529.1 102.075 1529.1 Q97.4454 1529.1 94.9917 1532.23 Q92.5612 1535.35 92.2139 1541.67 Q93.5797 1539.66 95.6398 1538.6 Q97.7 1537.51 100.177 1537.51 Q105.385 1537.51 108.394 1540.68 Q111.427 1543.83 111.427 1549.27 Q111.427 1554.59 108.279 1557.81 Q105.131 1561.03 99.8991 1561.03 Q93.9037 1561.03 90.7325 1556.44 Q87.5612 1551.84 87.5612 1543.11 Q87.5612 1534.91 91.45 1530.05 Q95.3389 1525.17 101.89 1525.17 Q103.649 1525.17 105.431 1525.52 Q107.237 1525.86 109.181 1526.56 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip470)" d="M50.3623 1230.89 L80.0381 1230.89 L80.0381 1234.82 L50.3623 1234.82 L50.3623 1230.89 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip470)" d="M104.297 1229.08 Q107.654 1229.8 109.529 1232.07 Q111.427 1234.34 111.427 1237.67 Q111.427 1242.79 107.908 1245.59 Q104.39 1248.39 97.9083 1248.39 Q95.7324 1248.39 93.4176 1247.95 Q91.126 1247.53 88.6723 1246.68 L88.6723 1242.16 Q90.6167 1243.3 92.9315 1243.87 Q95.2463 1244.45 97.7695 1244.45 Q102.168 1244.45 104.459 1242.72 Q106.774 1240.98 106.774 1237.67 Q106.774 1234.62 104.621 1232.9 Q102.492 1231.17 98.6722 1231.17 L94.6445 1231.17 L94.6445 1227.32 L98.8574 1227.32 Q102.306 1227.32 104.135 1225.96 Q105.964 1224.57 105.964 1221.98 Q105.964 1219.31 104.066 1217.9 Q102.191 1216.47 98.6722 1216.47 Q96.7509 1216.47 94.5519 1216.88 Q92.3528 1217.3 89.7139 1218.18 L89.7139 1214.01 Q92.376 1213.27 94.6908 1212.9 Q97.0287 1212.53 99.0889 1212.53 Q104.413 1212.53 107.515 1214.96 Q110.617 1217.37 110.617 1221.49 Q110.617 1224.36 108.973 1226.35 Q107.33 1228.32 104.297 1229.08 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip470)" d="M99.4824 903.599 Q95.8713 903.599 94.0426 907.164 Q92.2371 910.706 92.2371 917.835 Q92.2371 924.942 94.0426 928.506 Q95.8713 932.048 99.4824 932.048 Q103.117 932.048 104.922 928.506 Q106.751 924.942 106.751 917.835 Q106.751 910.706 104.922 907.164 Q103.117 903.599 99.4824 903.599 M99.4824 899.896 Q105.293 899.896 108.348 904.502 Q111.427 909.085 111.427 917.835 Q111.427 926.562 108.348 931.169 Q105.293 935.752 99.4824 935.752 Q93.6723 935.752 90.5936 931.169 Q87.538 926.562 87.538 917.835 Q87.538 909.085 90.5936 904.502 Q93.6723 899.896 99.4824 899.896 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip470)" d="M104.297 603.809 Q107.654 604.527 109.529 606.795 Q111.427 609.064 111.427 612.397 Q111.427 617.513 107.908 620.314 Q104.39 623.115 97.9083 623.115 Q95.7324 623.115 93.4176 622.675 Q91.126 622.258 88.6723 621.402 L88.6723 616.888 Q90.6167 618.022 92.9315 618.601 Q95.2463 619.18 97.7695 619.18 Q102.168 619.18 104.459 617.444 Q106.774 615.707 106.774 612.397 Q106.774 609.342 104.621 607.629 Q102.492 605.893 98.6722 605.893 L94.6445 605.893 L94.6445 602.05 L98.8574 602.05 Q102.306 602.05 104.135 600.684 Q105.964 599.296 105.964 596.703 Q105.964 594.041 104.066 592.629 Q102.191 591.194 98.6722 591.194 Q96.7509 591.194 94.5519 591.61 Q92.3528 592.027 89.7139 592.907 L89.7139 588.74 Q92.376 587.999 94.6908 587.629 Q97.0287 587.259 99.0889 587.259 Q104.413 587.259 107.515 589.689 Q110.617 592.096 110.617 596.217 Q110.617 599.087 108.973 601.078 Q107.33 603.045 104.297 603.809 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip470)" d="M99.8991 290.663 Q96.7509 290.663 94.8991 292.816 Q93.0704 294.969 93.0704 298.719 Q93.0704 302.445 94.8991 304.621 Q96.7509 306.774 99.8991 306.774 Q103.047 306.774 104.876 304.621 Q106.728 302.445 106.728 298.719 Q106.728 294.969 104.876 292.816 Q103.047 290.663 99.8991 290.663 M109.181 276.01 L109.181 280.27 Q107.422 279.436 105.617 278.997 Q103.834 278.557 102.075 278.557 Q97.4454 278.557 94.9917 281.682 Q92.5612 284.807 92.2139 291.126 Q93.5797 289.112 95.6398 288.047 Q97.7 286.959 100.177 286.959 Q105.385 286.959 108.394 290.131 Q111.427 293.279 111.427 298.719 Q111.427 304.043 108.279 307.26 Q105.131 310.478 99.8991 310.478 Q93.9037 310.478 90.7325 305.895 Q87.5612 301.288 87.5612 292.561 Q87.5612 284.367 91.45 279.506 Q95.3389 274.622 101.89 274.622 Q103.649 274.622 105.431 274.969 Q107.237 275.316 109.181 276.01 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip472)" style="stroke:#009af9; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,1294.33 224.541,1302.88 226.891,1394.3 229.242,1422.72 231.592,1363.21 233.943,1343.03 236.293,1371.06 238.644,1584.48 240.994,1333.95 243.345,1387.54 245.695,1339.46 248.046,1506.1 250.396,1407.57 252.747,1373.83 255.097,1299.04 257.448,1531.81 259.798,1368.92 262.148,1357.61 264.499,1249.78 266.849,1308.37 269.2,1447.71 271.55,1598.92 273.901,1588.16 276.251,1380.46 278.602,1385.33 280.952,1486.44 283.303,1412.92 285.653,1590.35 288.004,1324.89 290.354,1646.98 292.705,1651.27 295.055,1539.48 297.406,1377.35 299.756,1301.79 302.107,1341.59 304.457,1373.57 306.807,1489.48 309.158,1531.28 311.508,1495.62 313.859,1466.52 316.209,1418.97 318.56,1305.89 320.91,1368.94 323.261,1604 325.611,1433 327.962,1527.7 330.312,1237.87 332.663,1544.74 335.013,1548.22 337.364,1354.39 339.714,1597.43 342.065,1393.26 344.415,1482.98 346.765,1417.52 349.116,1302.22 351.466,1539.44 353.817,1507.7 356.167,1485.25 358.518,1378.28 360.868,1402.18 363.219,1320.03 365.569,1604.4 367.92,1391.34 370.27,1356.13 372.621,1405.01 374.971,1362.2 377.322,1484.85 379.672,1495.42 382.023,1317.61 384.373,1396.74 386.724,1322.66 389.074,1526.66 391.424,1556.37 393.775,1489.91 396.125,1343.66 398.476,1581.61 400.826,1380.17 403.177,1496.61 405.527,1642.76 407.878,1343.24 410.228,1391.72 412.579,1431.23 414.929,1515.59 417.28,1455.27 419.63,1630.71 421.981,1569.33 424.331,1488.57 426.682,1374.51 429.032,1354.14 431.382,1401.66 433.733,1281.18 436.083,1476.87 438.434,1338.02 440.784,1486.94 443.135,1420.26 445.485,1333.89 447.836,1278.13 450.186,1545.45 452.537,1499.97 454.887,1405.88 457.238,1534.31 459.588,1424.31 461.939,1566.58 464.289,1446.08 466.64,1542.45 468.99,1304.39 471.341,1426.59 473.691,1407.28 476.041,1400.95 478.392,1252.95 480.742,1388.2 483.093,1519.1 485.443,1563.32 487.794,1378.62 490.144,1430.22 492.495,1379.86 494.845,1424.46 497.196,1459.24 499.546,1425.11 501.897,1378.63 504.247,1384.86 506.598,1488.47 508.948,1537.24 511.299,1477.02 513.649,1413.86 515.999,1267.41 518.35,1462.8 520.7,1460.52 523.051,1621.01 525.401,1586.99 527.752,1620.79 530.102,1405.3 532.453,1363.18 534.803,1575.39 537.154,1475.24 539.504,1500.32 541.855,1321.38 544.205,1431.42 546.556,1348.94 548.906,1368.57 551.257,1441.26 553.607,1585.78 555.958,1382.92 558.308,1556.43 560.658,1307.62 563.009,1619.34 565.359,1445.78 567.71,1454.63 570.06,1377.46 572.411,1405.01 574.761,1583.15 577.112,1474.23 579.462,1642.1 581.813,1314.89 584.163,1402.55 586.514,1319.9 588.864,1556.05 591.215,1257.31 593.565,1330.49 595.916,1414.79 598.266,1422.5 600.616,1492.69 602.967,1532.67 605.317,1443.34 607.668,1370.31 610.018,1452.2 612.369,1447.17 614.719,1471.36 617.07,1555.03 619.42,1278.65 621.771,1579.15 624.121,1448.34 626.472,1476.99 628.822,1538 631.173,1506.48 633.523,1404.4 635.874,1476.81 638.224,1575.93 640.575,1374.49 642.925,1357.5 645.275,1487.9 647.626,1412.63 649.976,1564.27 652.327,1342.58 654.677,1341.57 657.028,1488.03 659.378,1242.97 661.729,1607.67 664.079,1339.36 666.43,1400.16 668.78,1264.14 671.131,1454.65 673.481,1370.13 675.832,1371.72 678.182,1354.85 680.533,1407.02 682.883,1457.65 685.233,1376.64 687.584,1591.25 689.934,1321.78 692.285,1613.11 694.635,1387.91 696.986,1459.62 699.336,1325.89 701.687,1457.48 704.037,1537.83 706.388,1620.24 708.738,1462.18 711.089,1422.45 713.439,1386.9 715.79,1416.61 718.14,1452.38 720.491,1513.21 722.841,1402.32 725.192,1553.61 727.542,1442.59 729.892,1543.34 732.243,1431.2 734.593,1366.76 736.944,1515.08 739.294,1448.65 741.645,1679.67 743.995,1652.77 746.346,1583.04 748.696,1560.97 751.047,1453.6 753.397,1561.47 755.748,1504.55 758.098,1449.1 760.449,1362 762.799,1593.44 765.15,1438.52 767.5,1448.06 769.85,1391.85 772.201,1551.25 774.551,1481.51 776.902,1345.33 779.252,1333.59 781.603,1509.29 783.953,1365.82 786.304,1310.87 788.654,1528.81 791.005,1319.82 793.355,1345.1 795.706,1295.29 798.056,1300.99 800.407,1459.62 802.757,1472.25 805.108,1426.68 807.458,1498.02 809.809,1437.69 812.159,1498.77 814.509,1312.24 816.86,1499.24 819.21,1482.07 821.561,1543.85 823.911,1541.52 826.262,1397.3 828.612,1651.85 830.963,1393.66 833.313,1265.15 835.664,1419.29 838.014,1268.22 840.365,1281.98 842.715,1343.24 845.066,1461.62 847.416,1460.69 849.767,1452.64 852.117,1464.89 854.467,1382.83 856.818,1287.51 859.168,1367.52 861.519,1529.54 863.869,1441.82 866.22,1471.04 868.57,1450.15 870.921,1600.06 873.271,1515.48 875.622,1324.74 877.972,1274.66 880.323,1441.54 882.673,1359.85 885.024,1477.66 887.374,1539.9 889.725,1532.68 892.075,1549.88 894.426,1530.04 896.776,1523.28 899.126,1434.94 901.477,1589.12 903.827,1442.45 906.178,1464.73 908.528,1445.97 910.879,1435.65 913.229,1440.11 915.58,1264.52 917.93,1548.62 920.281,1416.48 922.631,1355.87 924.982,1294.91 927.332,1335.99 929.683,1400.55 932.033,1582.2 934.384,1482.72 936.734,1270.44 939.084,1444.96 941.435,1425.29 943.785,1447.27 946.136,1297.78 948.486,1380.31 950.837,1523.34 953.187,1547.96 955.538,1524.48 957.888,1470.81 960.239,1409.01 962.589,1494.09 964.94,1422.62 967.29,1353.69 969.641,1480.38 971.991,1381.66 974.342,1581.25 976.692,1490.12 979.043,1439.26 981.393,1415.07 983.743,1568.82 986.094,1441.85 988.444,1405.39 990.795,1384.66 993.145,1310.42 995.496,1520.77 997.846,1607.25 1000.2,1364.92 1002.55,1588.9 1004.9,1487.85 1007.25,1579.85 1009.6,1418.28 1011.95,1334.42 1014.3,1464.96 1016.65,1517.93 1019,1304.06 1021.35,1577.93 1023.7,1300.99 1026.05,1517.88 1028.4,1239.72 1030.75,1278.34 1033.1,1403.7 1035.45,1477.67 1037.8,1563.56 1040.15,1671.74 1042.51,1526.42 1044.86,1516.43 1047.21,1435.38 1049.56,1394.77 1051.91,1230.2 1054.26,1556.94 1056.61,1487.48 1058.96,1542.1 1061.31,1639.87 1063.66,1371.04 1066.01,1505.32 1068.36,1365.93 1070.71,1446.81 1073.06,1418.86 1075.41,1422.34 1077.76,1566.64 1080.11,1608.08 1082.46,1477.59 1084.81,1354.08 1087.16,1482.73 1089.51,1418.58 1091.87,1363.66 1094.22,1542.89 1096.57,1558.32 1098.92,1434.05 1101.27,1395.73 1103.62,1464.86 1105.97,1393.93 1108.32,1352.99 1110.67,1331.86 1113.02,1449.36 1115.37,1317.18 1117.72,1273.14 1120.07,1650.53 1122.42,1372.09 1124.77,1371.01 1127.12,1455.56 1129.47,1430.05 1131.82,1425.95 1134.17,1616.85 1136.52,1390.26 1138.87,1452.99 1141.23,1363.83 1143.58,1354.91 1145.93,1446.11 1148.28,1406.52 1150.63,1321.08 1152.98,1562.6 1155.33,1316.18 1157.68,1405.12 1160.03,1597.15 1162.38,1474.54 1164.73,1496.91 1167.08,1344.88 1169.43,1378.29 1171.78,1315.6 1174.13,1374.74 1176.48,1607.16 1178.83,1467.66 1181.18,1489.86 1183.53,1515.44 1185.88,1452.5 1188.23,1530.47 1190.59,1508.54 1192.94,1324 1195.29,1619.74 1197.64,1336.27 1199.99,1283.05 1202.34,1408.83 1204.69,1518.38 1207.04,1394.34 1209.39,1329.33 1211.74,1507.76 1214.09,1402.13 1216.44,1650.88 1218.79,1353.53 1221.14,1444.01 1223.49,1594.95 1225.84,1407.28 1228.19,1524.79 1230.54,1529.74 1232.89,1397.85 1235.24,1416.32 1237.59,1551.2 1239.94,1293.82 1242.3,1322.27 1244.65,1323.29 1247,1497 1249.35,1289.08 1251.7,1446.98 1254.05,1672.19 1256.4,1370.79 1258.75,1480.09 1261.1,1592.57 1263.45,1410.84 1265.8,1320.83 1268.15,1348.41 1270.5,1525.09 1272.85,1517.7 1275.2,1283.96 1277.55,1483.62 1279.9,1570.72 1282.25,1481.96 1284.6,1522.22 1286.95,1505.19 1289.3,1335.48 1291.66,1379.89 1294.01,1451.52 1296.36,1383.71 1298.71,1453.46 1301.06,1524.82 1303.41,1537.36 1305.76,1462.01 1308.11,1413.65 1310.46,1427.48 1312.81,1273.34 1315.16,1355.45 1317.51,1348.11 1319.86,1315.38 1322.21,1544.43 1324.56,1372.79 1326.91,1470.28 1329.26,1348.94 1331.61,1237.49 1333.96,1322.19 1336.31,1300.83 1338.66,1556.24 1341.02,1513.6 1343.37,1514.25 1345.72,1323.01 1348.07,1265.94 1350.42,1574.94 1352.77,1497.38 1355.12,1396.67 1357.47,1520.81 1359.82,1522.93 1362.17,1372.58 1364.52,1630.55 1366.87,1373 1369.22,1346.65 1371.57,1307.85 1373.92,1426.12 1376.27,1688.14 1378.62,1420.12 1380.97,1396.56 1383.32,1467.53 1385.67,1486.16 1388.02,1354.51 1390.38,1332.6 1392.73,1545.31 1395.08,1403.32 1397.43,1283.56 1399.78,1450.61 1402.13,1381.79 1404.48,1423.27 1406.83,1463.66 1409.18,1466.57 1411.53,1328.26 1413.88,1673.26 1416.23,1353.87 1418.58,1561.77 1420.93,1463.53 1423.28,1550.14 1425.63,1296.11 1427.98,1642.15 1430.33,1413.21 1432.68,1347.93 1435.03,1208.64 1437.38,1462.93 1439.74,1584.2 1442.09,1517.34 1444.44,1315.03 1446.79,1401.09 1449.14,1386.79 1451.49,1663.03 1453.84,1350.22 1456.19,1494.93 1458.54,1382.1 1460.89,1575.34 1463.24,1305.87 1465.59,1249.16 1467.94,1437.92 1470.29,1421.42 1472.64,1394.62 1474.99,1562.85 1477.34,1378.76 1479.69,1465.69 1482.04,1436.4 1484.39,1401.78 1486.74,1503.97 1489.1,1548.66 1491.45,1503.83 1493.8,1491.99 1496.15,1294.89 1498.5,1269.79 1500.85,1385.16 1503.2,1305.26 1505.55,1266.19 1507.9,1395.17 1510.25,1649.11 1512.6,1417.53 1514.95,1275.71 1517.3,1353.07 1519.65,1671.42 1522,1430.04 1524.35,1460.85 1526.7,1537.13 1529.05,1422.29 1531.4,1394.15 1533.75,1495.02 1536.1,1366.08 1538.45,1499.5 1540.81,1323.72 1543.16,1397.5 1545.51,1408.75 1547.86,1398.4 1550.21,1397.12 1552.56,1412.17 1554.91,1496.76 1557.26,1539.83 1559.61,1477.55 1561.96,1423.31 1564.31,1227.54 1566.66,1480 1569.01,1568.03 1571.36,1638.89 1573.71,1256.15 1576.06,1478.52 1578.41,1458.07 1580.76,1356.85 1583.11,1341.21 1585.46,1321.86 1587.81,1474.14 1590.17,1602.03 1592.52,1380.33 1594.87,1307.93 1597.22,1369.84 1599.57,1569.97 1601.92,1576.8 1604.27,1585.25 1606.62,1608.51 1608.97,1392.37 1611.32,1504.32 1613.67,1586.52 1616.02,1363.77 1618.37,1367.45 1620.72,1614.39 1623.07,1333.59 1625.42,1496.97 1627.77,1542.99 1630.12,1461.67 1632.47,1485.48 1634.82,1460.14 1637.17,1701.72 1639.53,1338.33 1641.88,1437.95 1644.23,1479.5 1646.58,1271.03 1648.93,1646.12 1651.28,1577.07 1653.63,1547.9 1655.98,1538.54 1658.33,1528.67 1660.68,1376.19 1663.03,1395.7 1665.38,1473.16 1667.73,1505.83 1670.08,1267.75 1672.43,1322.82 1674.78,1478.21 1677.13,1359.84 1679.48,1411.83 1681.83,1391.15 1684.18,1479.37 1686.53,1519.7 1688.89,1459.2 1691.24,1337.77 1693.59,1446.75 1695.94,1696.6 1698.29,1471.82 1700.64,1476.06 1702.99,1301.1 1705.34,1487.63 1707.69,1596.65 1710.04,1197.22 1712.39,1381.4 1714.74,1497.16 1717.09,1598.6 1719.44,1472.63 1721.79,1274.96 1724.14,1280.38 1726.49,1419.24 1728.84,1571.79 1731.19,1408.02 1733.54,1383.63 1735.89,1253.85 1738.25,1447.22 1740.6,1353.34 1742.95,1372.65 1745.3,1320.12 1747.65,1442.98 1750,1447.22 1752.35,1423.5 1754.7,1415.93 1757.05,1336.04 1759.4,1433.16 1761.75,1349.3 1764.1,1342.47 1766.45,1369.56 1768.8,1585.05 1771.15,1633.53 1773.5,1400.4 1775.85,1472.11 1778.2,1576.62 1780.55,1573.09 1782.9,1481.51 1785.25,1466.72 1787.6,1375.66 1789.96,1435.76 1792.31,1421.67 1794.66,1599.98 1797.01,1496.63 1799.36,1469.12 1801.71,1358.84 1804.06,1482.67 1806.41,1273.54 1808.76,1330.46 1811.11,1514.44 1813.46,1388.78 1815.81,1253.94 1818.16,1690 1820.51,1511.51 1822.86,1538.85 1825.21,1326.22 1827.56,1342.25 1829.91,1587.08 1832.26,1394.86 1834.61,1425.04 1836.96,1420.46 1839.32,1347.62 1841.67,1432.51 1844.02,1525.2 1846.37,1278.52 1848.72,1517.78 1851.07,1577.24 1853.42,1507.12 1855.77,1341.46 1858.12,1394.03 1860.47,1500.3 1862.82,1538.64 1865.17,1434.14 1867.52,1370.98 1869.87,1331.94 1872.22,1188.15 1874.57,1440.14 1876.92,1392.25 1879.27,1276.58 1881.62,1445.51 1883.97,1475.93 1886.32,1267.23 1888.68,1532.46 1891.03,1276.39 1893.38,1151.83 1895.73,1346.77 1898.08,1458.04 1900.43,1397.55 1902.78,1325.4 1905.13,1292.91 1907.48,1458.2 1909.83,1444.39 1912.18,1535.57 1914.53,1248.92 1916.88,1549.2 1919.23,1452.64 1921.58,1370.76 1923.93,1314.24 1926.28,1540.95 1928.63,1462.25 1930.98,1322.66 1933.33,1549.92 1935.68,1566.17 1938.04,1599.87 1940.39,1352.12 1942.74,1370.79 1945.09,1653.51 1947.44,1541.41 1949.79,1441.35 1952.14,1486.28 1954.49,1416.13 1956.84,1391.94 1959.19,1454.08 1961.54,1531.01 1963.89,1604.35 1966.24,1500.79 1968.59,1548.99 1970.94,1330.49 1973.29,1378.81 1975.64,1479.27 1977.99,1434.22 1980.34,1376.85 1982.69,1202.84 1985.04,1395.68 1987.4,1415.16 1989.75,1574.81 1992.1,1412.07 1994.45,1339.87 1996.8,1397.85 1999.15,1513.38 2001.5,1360.72 2003.85,1496.33 2006.2,1596.08 2008.55,1487.75 2010.9,1377.14 2013.25,1369.62 2015.6,1393.65 2017.95,1396.89 2020.3,1501.98 2022.65,1433.74 2025,1388.62 2027.35,1473.54 2029.7,1576.68 2032.05,1376.63 2034.4,1478.55 2036.76,1525.71 2039.11,1494.1 2041.46,1334.98 2043.81,1446.53 2046.16,1445.4 2048.51,1390.34 2050.86,1525.54 2053.21,1288.42 2055.56,1547.34 2057.91,1206.74 2060.26,1311.05 2062.61,1454.87 2064.96,1369.7 2067.31,1446.69 2069.66,1478.33 2072.01,1313.09 2074.36,1295.28 2076.71,1467.3 2079.06,1425.6 2081.41,1229.2 2083.76,1416.03 2086.11,1371.93 2088.47,1399.84 2090.82,1488.15 2093.17,1626.05 2095.52,1451.23 2097.87,1426.96 2100.22,1320.15 2102.57,1432.95 2104.92,1385.22 2107.27,1502.67 2109.62,1526.29 2111.97,1432.08 2114.32,1329.24 2116.67,1406.55 2119.02,1623.26 2121.37,1448.03 2123.72,1530.34 2126.07,1565.02 2128.42,1432.51 2130.77,1539.8 2133.12,1310.02 2135.47,1571.23 2137.83,1316.45 2140.18,1468.48 2142.53,1510.92 2144.88,1486.79 2147.23,1493.99 2149.58,1666.46 2151.93,1394.11 2154.28,1390.47 2156.63,1412.25 2158.98,1539.15 2161.33,1412.26 2163.68,1584.79 2166.03,1402.31 2168.38,1271.64 2170.73,1472.33 2173.08,1408.52 2175.43,1406.85 2177.78,1321.58 2180.13,1444.1 2182.48,1296.8 2184.83,1300 2187.19,1388.48 2189.54,1478.57 2191.89,1302.37 2194.24,1284.82 2196.59,1381.65 2198.94,1472.99 2201.29,1469.12 2203.64,1270.28 2205.99,1418.24 2208.34,1363.57 2210.69,1319.95 2213.04,1473.86 2215.39,1308.93 2217.74,1487.14 2220.09,1546.24 2222.44,1501.43 2224.79,1534.85 2227.14,1476.11 2229.49,1493.05 2231.84,1472.77 2234.19,1751.15 2236.55,1488.65 2238.9,1458.31 2241.25,1603.54 2243.6,1456.98 2245.95,1458.54 2248.3,1499.24 2250.65,1362.27 2253,1482.66 2255.35,1316.54 2257.7,1338.02 2260.05,1611.38 2262.4,1569.95 2264.75,1422.69 2267.1,1258.57 2269.45,1431.66 2271.8,1318.7 2274.15,1390.71 2276.5,1654.43 2278.85,1292.23 2281.2,1411.27 2283.55,1389.33 2285.91,1446.67 2288.26,1412.1 2290.61,1482.75 2292.96,1311.76 2295.31,1584.44 2297.66,1316.78 2300.01,1329.79 2302.36,1329.51 2304.71,1439.67 2307.06,1418.25 2309.41,1515.01 2311.76,1422.4 2314.11,1597.4 2316.46,1374.02 2318.81,1429.81 2321.16,1483.41 2323.51,1540.04 2325.86,1466.06 2328.21,1363.18 2330.56,1542.18 2332.91,1422.13 2335.27,1431.46 2337.62,1247.11 2339.97,1383.03 2342.32,1497.95 2344.67,1384.49 2347.02,1431.98 2349.37,1390.22 2351.72,1308.33 2354.07,1422.12 2356.42,1392.31 2358.77,1487.16 2361.12,1316.14 2363.47,1736.74 2365.82,1489.5 2368.17,1496.05 2370.52,1556.95 2372.87,1453.2 2375.22,1403.38 2377.57,1423.41 2379.92,1389.62 2382.27,1378 2384.62,1401.49 2386.98,1557.25 2389.33,1373.93 2391.68,1220.16 2394.03,1388.52 2396.38,1264.45 2398.73,1227.43 2401.08,1334.5 2403.43,1271.3 2405.78,1432.93 2408.13,1344.1 2410.48,1323.65 2412.83,1317.93 2415.18,1323.74 2417.53,1418.37 2419.88,1387.53 2422.23,1285.75 2424.58,1476.24 2426.93,1522.67 2429.28,1530.78 2431.63,1494.41 2433.98,1543.66 2436.34,1599.47 2438.69,1406.23 2441.04,1467.25 2443.39,1289.07 2445.74,1402.47 2448.09,1433.55 2450.44,1561.3 2452.79,1253.68 2455.14,1407.72 2457.49,1504 2459.84,1479.08 2462.19,1518.18 2464.54,1452.43 2466.89,1520.44 2469.24,1336.46 2471.59,1363.01 2473.94,1368.36 2476.29,1420.02 2478.64,1429.66 2480.99,1523.31 2483.34,1423 2485.7,1426.16 2488.05,1506.22 2490.4,1469.32 2492.75,1566.37 2495.1,1574.62 2497.45,1498.94 2499.8,1637.56 2502.15,1464.11 2504.5,1468.38 2506.85,1407.77 2509.2,1241.09 2511.55,1492.72 2513.9,1370.61 2516.25,1447.82 2518.6,1388.33 2520.95,1456.63 2523.3,1633.16 2525.65,1397.59 2528,1360.82 2530.35,1510.62 2532.7,1367.67 2535.06,1314.01 2537.41,1447.4 2539.76,1354.32 2542.11,1469.63 2544.46,1348.29 2546.81,1469.62 2549.16,1433.41 2551.51,1559.97 2553.86,1445.89 2556.21,1394.59 2558.56,1417.75 2560.91,1657.33 2563.26,1681.11 2565.61,1557.86 2567.96,1433.51 2570.31,1372.63 "></polyline>
<polyline clip-path="url(#clip472)" style="stroke:#e26f46; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,994.814 224.541,978.893 226.891,1105.3 229.242,936.917 231.592,915.313 233.943,667.389 236.293,859.681 238.644,877.858 240.994,874.546 243.345,962.544 245.695,1001.65 248.046,1004.13 250.396,1005.17 252.747,939.686 255.097,939.194 257.448,995.078 259.798,805.945 262.148,950.41 264.499,932.209 266.849,1026.1 269.2,809.044 271.55,928.379 273.901,1205.33 276.251,849.727 278.602,891.119 280.952,965.549 283.303,914.416 285.653,979.817 288.004,1043.26 290.354,735.28 292.705,883.727 295.055,1032.51 297.406,852.781 299.756,766.677 302.107,829.574 304.457,934.947 306.807,800.797 309.158,838.194 311.508,939.516 313.859,941.343 316.209,820.524 318.56,1134.9 320.91,1055.81 323.261,870.054 325.611,749.599 327.962,965.633 330.312,735.17 332.663,919.237 335.013,926.158 337.364,972.403 339.714,1052 342.065,740.973 344.415,881.645 346.765,1046.86 349.116,941.53 351.466,833.305 353.817,847.79 356.167,970.052 358.518,897.597 360.868,817.648 363.219,927.852 365.569,973.942 367.92,834.016 370.27,967.279 372.621,1046.43 374.971,918.338 377.322,757.797 379.672,772.144 382.023,776.783 384.373,940.355 386.724,885.111 389.074,972.164 391.424,843.98 393.775,941.755 396.125,1008.51 398.476,736.543 400.826,809 403.177,847.797 405.527,1156.91 407.878,1025.27 410.228,981.711 412.579,1034.12 414.929,833.657 417.28,748.985 419.63,1007.54 421.981,1015.5 424.331,1010.77 426.682,960.609 429.032,854.781 431.382,1040.75 433.733,919.825 436.083,1090.68 438.434,740.873 440.784,802.53 443.135,1039.83 445.485,970.989 447.836,939.973 450.186,885.227 452.537,666.802 454.887,1155.35 457.238,1022.76 459.588,982.214 461.939,926.029 464.289,903.853 466.64,865.068 468.99,955.852 471.341,982.188 473.691,813.607 476.041,811.773 478.392,1043.19 480.742,933.584 483.093,745.611 485.443,837.354 487.794,1140.86 490.144,945.067 492.495,997.202 494.845,864.443 497.196,868.59 499.546,1116.89 501.897,774.037 504.247,1060.41 506.598,940.187 508.948,853.264 511.299,982.406 513.649,893.927 515.999,912.436 518.35,944.356 520.7,949.545 523.051,912.774 525.401,793.168 527.752,892.236 530.102,886.836 532.453,716.696 534.803,896.802 537.154,904.27 539.504,909.175 541.855,955.259 544.205,944.017 546.556,1094.42 548.906,918.514 551.257,1014.59 553.607,969.517 555.958,913.463 558.308,934.994 560.658,979.208 563.009,979.48 565.359,798.778 567.71,835.201 570.06,705.032 572.411,970.524 574.761,732.064 577.112,899.804 579.462,1148.05 581.813,824.859 584.163,946.055 586.514,811.65 588.864,1043.65 591.215,802.6 593.565,974.115 595.916,974.152 598.266,954.067 600.616,1195.89 602.967,895.107 605.317,1091.33 607.668,851.025 610.018,1019.76 612.369,874.076 614.719,840.005 617.07,1090.17 619.42,812.803 621.771,857.661 624.121,856.101 626.472,876.69 628.822,834.831 631.173,1024.62 633.523,1072.12 635.874,767.044 638.224,702.482 640.575,852.806 642.925,740.566 645.275,913.318 647.626,962.84 649.976,879.381 652.327,1135.26 654.677,859.259 657.028,838.221 659.378,1040.62 661.729,1161.23 664.079,695.262 666.43,691.265 668.78,725.255 671.131,1013.92 673.481,1052.62 675.832,860.611 678.182,978.195 680.533,836.643 682.883,981.58 685.233,1032.05 687.584,890.588 689.934,889.233 692.285,840.44 694.635,949.799 696.986,1057.15 699.336,830.919 701.687,947.455 704.037,904.639 706.388,764.097 708.738,948.559 711.089,993.068 713.439,795.204 715.79,1022.61 718.14,916.149 720.491,945.499 722.841,972.635 725.192,885.581 727.542,955.394 729.892,1013.92 732.243,1028.89 734.593,908.708 736.944,874.634 739.294,907.352 741.645,1004.06 743.995,1057.28 746.346,1028.75 748.696,898.73 751.047,884.816 753.397,959.385 755.748,601.047 758.098,767.241 760.449,752.469 762.799,947.82 765.15,870.544 767.5,1078.94 769.85,827.729 772.201,1005.06 774.551,937.369 776.902,1048.77 779.252,906.885 781.603,883.436 783.953,901.851 786.304,973.787 788.654,914.311 791.005,940.345 793.355,956.395 795.706,903.526 798.056,848.262 800.407,854.078 802.757,838.859 805.108,948.936 807.458,896.966 809.809,916.824 812.159,998.487 814.509,703.699 816.86,830.935 819.21,892.448 821.561,892.357 823.911,1040.63 826.262,830.818 828.612,1116.73 830.963,948.801 833.313,870.826 835.664,1051.15 838.014,871.868 840.365,891.909 842.715,1010.46 845.066,930.724 847.416,827.574 849.767,922.534 852.117,775.091 854.467,932.11 856.818,798.32 859.168,822.034 861.519,713.351 863.869,1040.23 866.22,978.9 868.57,1025.57 870.921,783.804 873.271,1012.6 875.622,1064.91 877.972,843.635 880.323,933.941 882.673,949.692 885.024,987.039 887.374,683.963 889.725,858.397 892.075,900.563 894.426,1137.86 896.776,908.724 899.126,820.126 901.477,813.384 903.827,1051.81 906.178,925.886 908.528,768.291 910.879,827.89 913.229,1031.47 915.58,936.868 917.93,846.839 920.281,1058.69 922.631,922.849 924.982,829.265 927.332,863.148 929.683,947.798 932.033,974.803 934.384,980.501 936.734,865.372 939.084,1036.01 941.435,908.972 943.785,968.57 946.136,910.153 948.486,1047.84 950.837,946.84 953.187,845.658 955.538,1106.08 957.888,1028.04 960.239,855.569 962.589,862.9 964.94,829.639 967.29,946.867 969.641,806.287 971.991,807.78 974.342,948.526 976.692,683.693 979.043,1083.66 981.393,1058.6 983.743,838.039 986.094,945.905 988.444,868.672 990.795,964.063 993.145,836.643 995.496,929.298 997.846,1122.15 1000.2,709.524 1002.55,802.918 1004.9,1015.21 1007.25,1012.65 1009.6,815.127 1011.95,890.449 1014.3,843.285 1016.65,1100.97 1019,892.825 1021.35,751.528 1023.7,1085.91 1026.05,893.552 1028.4,795.73 1030.75,839.295 1033.1,820.488 1035.45,927.746 1037.8,932.42 1040.15,1006.49 1042.51,925.921 1044.86,905.447 1047.21,972.347 1049.56,928.197 1051.91,941.743 1054.26,837.081 1056.61,886.227 1058.96,741.869 1061.31,872.013 1063.66,965.528 1066.01,981.42 1068.36,882.531 1070.71,979.866 1073.06,809.529 1075.41,988.769 1077.76,951.009 1080.11,798.271 1082.46,969.299 1084.81,1106.26 1087.16,871.165 1089.51,860.176 1091.87,918.673 1094.22,925.1 1096.57,941.257 1098.92,980.341 1101.27,1067.39 1103.62,899.715 1105.97,932.934 1108.32,921.542 1110.67,934.448 1113.02,975.876 1115.37,736.457 1117.72,826.216 1120.07,866.521 1122.42,884.658 1124.77,1125.91 1127.12,966.342 1129.47,861.506 1131.82,873.913 1134.17,767.681 1136.52,828.813 1138.87,890.703 1141.23,769.35 1143.58,756.669 1145.93,1004.39 1148.28,1025.25 1150.63,646.487 1152.98,945.475 1155.33,973.578 1157.68,1089.38 1160.03,1108.97 1162.38,942.261 1164.73,860.558 1167.08,964.659 1169.43,996.35 1171.78,807.713 1174.13,1003.55 1176.48,859.135 1178.83,781.432 1181.18,745.922 1183.53,1155.09 1185.88,996.645 1188.23,977.081 1190.59,935.171 1192.94,917.526 1195.29,859.204 1197.64,883.774 1199.99,951.037 1202.34,871.956 1204.69,947.243 1207.04,861.13 1209.39,831.041 1211.74,950.902 1214.09,1084.46 1216.44,1093.04 1218.79,983.083 1221.14,916.789 1223.49,661.116 1225.84,925.949 1228.19,991.718 1230.54,1008.27 1232.89,1032.28 1235.24,969.195 1237.59,724.071 1239.94,821.753 1242.3,937.708 1244.65,904.104 1247,853.1 1249.35,922.753 1251.7,929.736 1254.05,794.193 1256.4,1070.92 1258.75,1100.67 1261.1,795.452 1263.45,991.953 1265.8,594.439 1268.15,724.128 1270.5,928.219 1272.85,1007.92 1275.2,980.698 1277.55,991.39 1279.9,999.901 1282.25,961.111 1284.6,1043.42 1286.95,961.437 1289.3,1074.68 1291.66,911.908 1294.01,1082.75 1296.36,816.219 1298.71,1010.32 1301.06,1135.63 1303.41,869.04 1305.76,900.261 1308.11,806.93 1310.46,939.182 1312.81,1005 1315.16,926.252 1317.51,904.576 1319.86,975.913 1322.21,737.879 1324.56,793.689 1326.91,1016.81 1329.26,743.457 1331.61,978.721 1333.96,950.578 1336.31,939.665 1338.66,976.631 1341.02,893.069 1343.37,889.793 1345.72,851.912 1348.07,806.889 1350.42,896.497 1352.77,917.853 1355.12,1018.27 1357.47,840.751 1359.82,976.666 1362.17,716.595 1364.52,872.993 1366.87,806.197 1369.22,1037.65 1371.57,871.816 1373.92,1186.93 1376.27,911.179 1378.62,1080.6 1380.97,972.488 1383.32,831.56 1385.67,939.816 1388.02,856.318 1390.38,955.534 1392.73,986.41 1395.08,1185.44 1397.43,1020.99 1399.78,824.277 1402.13,909.926 1404.48,727.082 1406.83,1169.23 1409.18,1098.32 1411.53,951.051 1413.88,893.566 1416.23,927.741 1418.58,796.566 1420.93,889.817 1423.28,1058.13 1425.63,973.067 1427.98,1082.72 1430.33,878.56 1432.68,975.493 1435.03,802.496 1437.38,815.239 1439.74,792.682 1442.09,904.982 1444.44,892.123 1446.79,804.923 1449.14,794.924 1451.49,794.732 1453.84,825.344 1456.19,992.369 1458.54,921.07 1460.89,890.623 1463.24,1112.64 1465.59,865.055 1467.94,894.195 1470.29,933.796 1472.64,907.173 1474.99,849.781 1477.34,956.303 1479.69,909.315 1482.04,877.437 1484.39,839.061 1486.74,843.677 1489.1,710.431 1491.45,1067.64 1493.8,1001.22 1496.15,940.747 1498.5,740.754 1500.85,1010.81 1503.2,1069.76 1505.55,673.286 1507.9,931.353 1510.25,795.419 1512.6,905.306 1514.95,1060.56 1517.3,911.653 1519.65,947.151 1522,980.396 1524.35,911.811 1526.7,940.452 1529.05,744.508 1531.4,1044.44 1533.75,762.42 1536.1,999.635 1538.45,1050.06 1540.81,756.94 1543.16,801.78 1545.51,970.143 1547.86,989.096 1550.21,785.223 1552.56,1007.68 1554.91,1036.76 1557.26,926.966 1559.61,1035.02 1561.96,785.819 1564.31,812.839 1566.66,905.362 1569.01,993.927 1571.36,888.032 1573.71,906.125 1576.06,875.234 1578.41,994.336 1580.76,1042.63 1583.11,838.58 1585.46,845.231 1587.81,983.188 1590.17,760.501 1592.52,982.301 1594.87,1038.95 1597.22,852.654 1599.57,813.419 1601.92,897.937 1604.27,1089.8 1606.62,789.04 1608.97,825.803 1611.32,729.299 1613.67,933.305 1616.02,787.98 1618.37,940.313 1620.72,749.978 1623.07,873.536 1625.42,912.249 1627.77,906.491 1630.12,829.442 1632.47,1060.11 1634.82,953.025 1637.17,967.151 1639.53,973.274 1641.88,831.934 1644.23,757.463 1646.58,893.229 1648.93,1142.2 1651.28,1055.33 1653.63,972.365 1655.98,830.095 1658.33,823.016 1660.68,812.687 1663.03,966.128 1665.38,759.766 1667.73,1036.52 1670.08,1035.48 1672.43,679.889 1674.78,871.425 1677.13,994.366 1679.48,945.274 1681.83,860.774 1684.18,840.673 1686.53,1158.41 1688.89,880.984 1691.24,879.741 1693.59,1130.45 1695.94,744.467 1698.29,783.417 1700.64,888.697 1702.99,830.343 1705.34,964.373 1707.69,974.654 1710.04,907.079 1712.39,1010.66 1714.74,870.222 1717.09,834.383 1719.44,962.23 1721.79,840.561 1724.14,758.688 1726.49,1108.07 1728.84,888.035 1731.19,822.876 1733.54,897.274 1735.89,870.183 1738.25,1118.19 1740.6,1017.94 1742.95,838.303 1745.3,1037.99 1747.65,1073.2 1750,1027.73 1752.35,863.629 1754.7,826.482 1757.05,807.577 1759.4,858.428 1761.75,797.276 1764.1,918.264 1766.45,1150.89 1768.8,810.556 1771.15,1031.78 1773.5,870.695 1775.85,980.166 1778.2,983.497 1780.55,850.848 1782.9,858.998 1785.25,811.139 1787.6,829.631 1789.96,789.854 1792.31,897.559 1794.66,831.262 1797.01,1089.61 1799.36,784.429 1801.71,1043.89 1804.06,882.337 1806.41,1028.9 1808.76,1200.11 1811.11,935.169 1813.46,1053.48 1815.81,730.578 1818.16,990.809 1820.51,792.255 1822.86,781.925 1825.21,1105.93 1827.56,872.976 1829.91,967.596 1832.26,795.716 1834.61,804.547 1836.96,851.002 1839.32,860.517 1841.67,961.237 1844.02,985.538 1846.37,725.589 1848.72,902.91 1851.07,1084.9 1853.42,963.64 1855.77,713.492 1858.12,930.609 1860.47,921.314 1862.82,778.309 1865.17,796.499 1867.52,980.384 1869.87,941.469 1872.22,984.033 1874.57,844.231 1876.92,893.714 1879.27,770.817 1881.62,1056.82 1883.97,896.836 1886.32,917.589 1888.68,1093.56 1891.03,943.451 1893.38,927.534 1895.73,1049.07 1898.08,907.025 1900.43,1024.38 1902.78,984.286 1905.13,916.731 1907.48,832.547 1909.83,857.489 1912.18,629.071 1914.53,919.633 1916.88,675.276 1919.23,1062.2 1921.58,949.038 1923.93,921.95 1926.28,1011.77 1928.63,697.827 1930.98,917.726 1933.33,1014.49 1935.68,895.342 1938.04,888.378 1940.39,955.26 1942.74,789.031 1945.09,813.576 1947.44,887.018 1949.79,883.778 1952.14,928.579 1954.49,1017.52 1956.84,889.258 1959.19,843.448 1961.54,699.235 1963.89,1119.46 1966.24,1000.1 1968.59,910.49 1970.94,868.804 1973.29,813.506 1975.64,963.667 1977.99,1168.94 1980.34,1076.76 1982.69,1075.89 1985.04,1092.61 1987.4,794.484 1989.75,979.403 1992.1,1057.3 1994.45,763.411 1996.8,842.173 1999.15,809.032 2001.5,1091.07 2003.85,681.752 2006.2,706.556 2008.55,823.282 2010.9,1113.41 2013.25,951.242 2015.6,813.403 2017.95,922.478 2020.3,900.843 2022.65,756.181 2025,848.423 2027.35,1033.79 2029.7,990.793 2032.05,861.325 2034.4,797.021 2036.76,874.359 2039.11,893.626 2041.46,753.739 2043.81,905.906 2046.16,840.04 2048.51,1033.55 2050.86,931.329 2053.21,763.153 2055.56,1011.33 2057.91,1152.88 2060.26,1108.54 2062.61,764.867 2064.96,649.327 2067.31,775.118 2069.66,1003.61 2072.01,1006.43 2074.36,909.191 2076.71,831.347 2079.06,930.114 2081.41,676.683 2083.76,898.79 2086.11,938.666 2088.47,991.936 2090.82,877.457 2093.17,927.487 2095.52,820.357 2097.87,891.432 2100.22,928.185 2102.57,872.379 2104.92,943.787 2107.27,924.713 2109.62,869.775 2111.97,1044.09 2114.32,825.53 2116.67,924.902 2119.02,1036.95 2121.37,1116.33 2123.72,866.169 2126.07,1022.04 2128.42,894.163 2130.77,928.564 2133.12,975.546 2135.47,906.119 2137.83,916.811 2140.18,879.993 2142.53,1033.08 2144.88,1081.03 2147.23,1126.87 2149.58,1093.16 2151.93,847.309 2154.28,686.358 2156.63,862.202 2158.98,1006.07 2161.33,778.406 2163.68,781.563 2166.03,866.342 2168.38,883.761 2170.73,841.248 2173.08,860.355 2175.43,769.344 2177.78,757.009 2180.13,895.314 2182.48,793.088 2184.83,810.733 2187.19,982.592 2189.54,733.758 2191.89,963.1 2194.24,944.716 2196.59,940.923 2198.94,853.78 2201.29,1183.69 2203.64,1087.69 2205.99,898.113 2208.34,1030.48 2210.69,1139.7 2213.04,959.281 2215.39,967.274 2217.74,1102.9 2220.09,874.371 2222.44,890.598 2224.79,978.414 2227.14,867.82 2229.49,1130.26 2231.84,866.907 2234.19,1153.57 2236.55,1071.17 2238.9,1141.34 2241.25,896.037 2243.6,737.499 2245.95,847.04 2248.3,860.114 2250.65,787.069 2253,703.244 2255.35,1196.66 2257.7,927.794 2260.05,822.39 2262.4,858.099 2264.75,1013.31 2267.1,900.226 2269.45,964.339 2271.8,811.784 2274.15,571.932 2276.5,1108.32 2278.85,875.023 2281.2,985.063 2283.55,1038.75 2285.91,966.596 2288.26,921.052 2290.61,783.47 2292.96,836.612 2295.31,1001.42 2297.66,636.912 2300.01,957.997 2302.36,1036.43 2304.71,731.002 2307.06,941.989 2309.41,1130.6 2311.76,1076.79 2314.11,921.83 2316.46,873.001 2318.81,980.133 2321.16,1017.38 2323.51,844.018 2325.86,1025.37 2328.21,694.082 2330.56,881.343 2332.91,932.824 2335.27,979.733 2337.62,872.84 2339.97,1157.37 2342.32,1129.3 2344.67,1013.11 2347.02,916.984 2349.37,630.094 2351.72,871.228 2354.07,1079.77 2356.42,1034.13 2358.77,968.114 2361.12,904.589 2363.47,1018.4 2365.82,1026.83 2368.17,839.704 2370.52,975.827 2372.87,942.4 2375.22,929.155 2377.57,778.51 2379.92,769.177 2382.27,946.641 2384.62,956.82 2386.98,935.177 2389.33,839.353 2391.68,812.154 2394.03,846.575 2396.38,973.104 2398.73,876.256 2401.08,968.294 2403.43,829.752 2405.78,969.557 2408.13,710.736 2410.48,808.518 2412.83,1009.6 2415.18,933.501 2417.53,976.616 2419.88,972.352 2422.23,843.336 2424.58,992.98 2426.93,1206.08 2429.28,1054.71 2431.63,984.515 2433.98,913.751 2436.34,841.63 2438.69,896.999 2441.04,884.404 2443.39,885.636 2445.74,893.566 2448.09,901.06 2450.44,1088.9 2452.79,738.808 2455.14,1007.57 2457.49,923.644 2459.84,984.736 2462.19,1077.07 2464.54,817.619 2466.89,905.118 2469.24,1075.29 2471.59,861.596 2473.94,1033.82 2476.29,770.571 2478.64,847.317 2480.99,1126.48 2483.34,982.147 2485.7,766.033 2488.05,964.191 2490.4,1093.65 2492.75,912.086 2495.1,1010.53 2497.45,952.598 2499.8,1227.38 2502.15,1103.94 2504.5,1052.75 2506.85,980.566 2509.2,838.652 2511.55,992.515 2513.9,761.748 2516.25,887.594 2518.6,936.261 2520.95,869.11 2523.3,888.964 2525.65,1035.8 2528,862.167 2530.35,838.896 2532.7,875.017 2535.06,938.188 2537.41,934.035 2539.76,834.962 2542.11,877.152 2544.46,850.229 2546.81,929.294 2549.16,907.583 2551.51,843.583 2553.86,861.716 2556.21,823.455 2558.56,952.636 2560.91,837.879 2563.26,931.764 2565.61,1003.5 2567.96,898.971 2570.31,1088.03 "></polyline>
<polyline clip-path="url(#clip472)" style="stroke:#3da44d; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,602.605 224.541,554.963 226.891,353.054 229.242,299.225 231.592,372.246 233.943,616.75 236.293,344.677 238.644,406.78 240.994,303 243.345,426.384 245.695,217.095 248.046,329.943 250.396,383.676 252.747,379.303 255.097,418.243 257.448,302.575 259.798,563.302 262.148,278.034 264.499,467.914 266.849,343.624 269.2,260.099 271.55,520.691 273.901,299.828 276.251,310.302 278.602,356.231 280.952,341.501 283.303,503.794 285.653,562.681 288.004,300.998 290.354,501.666 292.705,158.278 295.055,482.672 297.406,500.396 299.756,423.168 302.107,278.87 304.457,566.182 306.807,208.547 309.158,356.233 311.508,564.5 313.859,541.52 316.209,249.562 318.56,422.362 320.91,428.546 323.261,376.912 325.611,548.251 327.962,181.662 330.312,453.514 332.663,329.836 335.013,363.776 337.364,390.184 339.714,488.223 342.065,495.997 344.415,497.798 346.765,148.906 349.116,467.135 351.466,322.811 353.817,507.78 356.167,343.583 358.518,402.552 360.868,494.026 363.219,365.633 365.569,323.443 367.92,546.342 370.27,330.554 372.621,475.433 374.971,378.887 377.322,220.19 379.672,395.836 382.023,427.719 384.373,375.214 386.724,135.448 389.074,232.517 391.424,482.378 393.775,356.61 396.125,305.959 398.476,368.283 400.826,500.346 403.177,390.975 405.527,485.775 407.878,367.604 410.228,438.549 412.579,414.001 414.929,414.899 417.28,421.491 419.63,330.901 421.981,417.608 424.331,442.907 426.682,360.198 429.032,587.159 431.382,351.124 433.733,361.233 436.083,320.711 438.434,430.737 440.784,662.373 443.135,385.498 445.485,497.567 447.836,401.214 450.186,437.666 452.537,579.634 454.887,169.391 457.238,348.06 459.588,411.09 461.939,562.904 464.289,364.338 466.64,375.382 468.99,364.168 471.341,215.118 473.691,410.204 476.041,347.905 478.392,441.697 480.742,296.307 483.093,412.101 485.443,440.502 487.794,326.204 490.144,365.872 492.495,453.069 494.845,447.552 497.196,516.684 499.546,410.813 501.897,521.603 504.247,400.363 506.598,448.949 508.948,450.83 511.299,478.983 513.649,332.136 515.999,310.803 518.35,387.612 520.7,346.638 523.051,196.833 525.401,135.145 527.752,405.528 530.102,498.217 532.453,457.06 534.803,402.432 537.154,560.141 539.504,550.114 541.855,468.673 544.205,348.223 546.556,348.765 548.906,436.981 551.257,556.168 553.607,436.59 555.958,446.984 558.308,392.543 560.658,582.964 563.009,209.546 565.359,327.078 567.71,293.654 570.06,405.274 572.411,620.421 574.761,415.029 577.112,450.365 579.462,472.519 581.813,629.754 584.163,473.734 586.514,292.264 588.864,580.026 591.215,226.727 593.565,419.038 595.916,345.372 598.266,292.375 600.616,529.333 602.967,525.133 605.317,380.486 607.668,252.793 610.018,461.183 612.369,149.452 614.719,462.017 617.07,375.788 619.42,264.246 621.771,278.324 624.121,384.605 626.472,388.038 628.822,433.456 631.173,416.561 633.523,296.657 635.874,319.071 638.224,264.692 640.575,378.41 642.925,783.268 645.275,453.116 647.626,552.009 649.976,384.386 652.327,451.82 654.677,474.892 657.028,351.479 659.378,225.307 661.729,343.946 664.079,319.519 666.43,346.229 668.78,490.588 671.131,565.486 673.481,434.171 675.832,509.868 678.182,547.713 680.533,340.595 682.883,288.454 685.233,259.677 687.584,492.108 689.934,468.79 692.285,237.482 694.635,263.795 696.986,370.829 699.336,381.613 701.687,139.985 704.037,327.204 706.388,486.1 708.738,128.458 711.089,504.386 713.439,330.162 715.79,463.704 718.14,444.51 720.491,441.989 722.841,524.034 725.192,621.842 727.542,458.99 729.892,361.355 732.243,221.692 734.593,304.923 736.944,370.307 739.294,394.108 741.645,439.86 743.995,573.338 746.346,415.01 748.696,279.014 751.047,362.796 753.397,345.912 755.748,527.108 758.098,441.685 760.449,305.882 762.799,354.283 765.15,376.453 767.5,346.452 769.85,243.131 772.201,470.296 774.551,235.645 776.902,456.07 779.252,608.507 781.603,428.544 783.953,472.882 786.304,477.972 788.654,344.34 791.005,329.007 793.355,519.368 795.706,425.114 798.056,241.723 800.407,354.485 802.757,368.475 805.108,280.556 807.458,428.557 809.809,393.093 812.159,517.059 814.509,572.406 816.86,368.006 819.21,478.378 821.561,521.23 823.911,544.637 826.262,441.073 828.612,500.115 830.963,358.653 833.313,382.763 835.664,395.877 838.014,274.794 840.365,393.228 842.715,309.678 845.066,322.849 847.416,356.16 849.767,269.548 852.117,380.259 854.467,469.912 856.818,504.565 859.168,297.165 861.519,430.932 863.869,496.677 866.22,352.262 868.57,240.861 870.921,586.393 873.271,444.065 875.622,383.971 877.972,399.266 880.323,338.202 882.673,426.397 885.024,106.999 887.374,215.123 889.725,275.23 892.075,396.384 894.426,290.534 896.776,395.23 899.126,316.398 901.477,414.846 903.827,488.434 906.178,328.56 908.528,223.923 910.879,542.665 913.229,357.144 915.58,165.365 917.93,269.058 920.281,534.847 922.631,432.647 924.982,370.718 927.332,354.08 929.683,404.682 932.033,446.671 934.384,482.769 936.734,372.023 939.084,339.281 941.435,438.846 943.785,456.242 946.136,325.891 948.486,384.011 950.837,187.914 953.187,535.998 955.538,294.279 957.888,487.168 960.239,258.005 962.589,349.154 964.94,462.998 967.29,428.387 969.641,389.882 971.991,640.528 974.342,333.209 976.692,360.616 979.043,162.793 981.393,682.639 983.743,139.513 986.094,355.847 988.444,382.01 990.795,425.689 993.145,319.72 995.496,383.051 997.846,479.424 1000.2,258.222 1002.55,404.484 1004.9,323.992 1007.25,318.523 1009.6,432.717 1011.95,443.973 1014.3,312.941 1016.65,398.523 1019,301.53 1021.35,399.587 1023.7,378.425 1026.05,411.199 1028.4,450.089 1030.75,267.33 1033.1,346.27 1035.45,145.992 1037.8,507.16 1040.15,389.044 1042.51,440.16 1044.86,465.896 1047.21,445.669 1049.56,480.536 1051.91,378.636 1054.26,368.076 1056.61,318.582 1058.96,521.001 1061.31,283.75 1063.66,510.579 1066.01,374.295 1068.36,436.814 1070.71,405.675 1073.06,308.466 1075.41,439.393 1077.76,472.366 1080.11,435.007 1082.46,333.791 1084.81,382.485 1087.16,540.634 1089.51,245.905 1091.87,293.047 1094.22,424.053 1096.57,379.413 1098.92,546.373 1101.27,527.463 1103.62,341.739 1105.97,334.923 1108.32,630.599 1110.67,339.406 1113.02,224.914 1115.37,581.788 1117.72,247.67 1120.07,487.389 1122.42,511.26 1124.77,388.472 1127.12,411.14 1129.47,582.739 1131.82,469.683 1134.17,357.548 1136.52,490.918 1138.87,404.889 1141.23,606.462 1143.58,438.13 1145.93,218.441 1148.28,403.605 1150.63,371.237 1152.98,329.814 1155.33,239.838 1157.68,413.847 1160.03,480.294 1162.38,316.227 1164.73,407.509 1167.08,486.914 1169.43,401.219 1171.78,443.846 1174.13,350.816 1176.48,453.795 1178.83,328.815 1181.18,219.517 1183.53,360.375 1185.88,448.589 1188.23,384.934 1190.59,330.161 1192.94,548.707 1195.29,314.555 1197.64,359.716 1199.99,470.108 1202.34,279.546 1204.69,420.892 1207.04,335.484 1209.39,437.872 1211.74,296.237 1214.09,375.982 1216.44,422.799 1218.79,294.288 1221.14,351.591 1223.49,512.382 1225.84,430.991 1228.19,394.68 1230.54,323.871 1232.89,412.929 1235.24,457.455 1237.59,414.831 1239.94,216.044 1242.3,320.191 1244.65,378.035 1247,187.163 1249.35,251.265 1251.7,441.337 1254.05,404.839 1256.4,152.929 1258.75,359.758 1261.1,595.732 1263.45,190.203 1265.8,341.79 1268.15,378.659 1270.5,406.985 1272.85,430.376 1275.2,314.828 1277.55,456.183 1279.9,452.397 1282.25,593.641 1284.6,546.189 1286.95,350.137 1289.3,495.226 1291.66,406.602 1294.01,471.757 1296.36,327.116 1298.71,350.795 1301.06,372.516 1303.41,682.142 1305.76,452.02 1308.11,435.115 1310.46,473.535 1312.81,307.365 1315.16,342.34 1317.51,582.083 1319.86,206.084 1322.21,296.641 1324.56,299.042 1326.91,275.423 1329.26,282.886 1331.61,517.129 1333.96,393.623 1336.31,143.76 1338.66,389.965 1341.02,377.438 1343.37,331.658 1345.72,292.952 1348.07,236.489 1350.42,538.707 1352.77,449.473 1355.12,384.227 1357.47,350.778 1359.82,414.44 1362.17,507.312 1364.52,410.574 1366.87,407.563 1369.22,294.831 1371.57,165.372 1373.92,412.438 1376.27,492.281 1378.62,623.435 1380.97,478.913 1383.32,388.986 1385.67,333.33 1388.02,397.022 1390.38,595.217 1392.73,427.238 1395.08,356.378 1397.43,397.038 1399.78,304.013 1402.13,496.783 1404.48,412.707 1406.83,438.122 1409.18,402.653 1411.53,289.175 1413.88,290.699 1416.23,518.39 1418.58,293.922 1420.93,461.323 1423.28,431.352 1425.63,498.65 1427.98,374.617 1430.33,379.091 1432.68,250.139 1435.03,437.345 1437.38,286.681 1439.74,444.285 1442.09,365.954 1444.44,345.496 1446.79,353.179 1449.14,401.712 1451.49,539.355 1453.84,419.835 1456.19,367.524 1458.54,357.895 1460.89,509.528 1463.24,419.593 1465.59,401.73 1467.94,494.233 1470.29,152.228 1472.64,197.352 1474.99,532.393 1477.34,462.482 1479.69,249.943 1482.04,422.678 1484.39,655.433 1486.74,274.703 1489.1,366.502 1491.45,294.156 1493.8,357.747 1496.15,383.548 1498.5,431.459 1500.85,305.908 1503.2,328.079 1505.55,318.565 1507.9,450.556 1510.25,548.688 1512.6,348.025 1514.95,296.013 1517.3,409.141 1519.65,517.023 1522,343.621 1524.35,466.94 1526.7,537.224 1529.05,466.113 1531.4,493.839 1533.75,430.731 1536.1,355.72 1538.45,445.046 1540.81,367.084 1543.16,370.249 1545.51,330.687 1547.86,596.243 1550.21,532.026 1552.56,520.143 1554.91,362.087 1557.26,512.512 1559.61,299.793 1561.96,352.557 1564.31,573.251 1566.66,200.095 1569.01,496.122 1571.36,585.558 1573.71,466.064 1576.06,524.611 1578.41,333.756 1580.76,412.843 1583.11,295.935 1585.46,418.091 1587.81,160.23 1590.17,150.938 1592.52,442.31 1594.87,288.471 1597.22,379.11 1599.57,434.975 1601.92,442.158 1604.27,233.375 1606.62,481.596 1608.97,391.165 1611.32,430.19 1613.67,378.179 1616.02,603.956 1618.37,398.833 1620.72,363.753 1623.07,442.247 1625.42,201.783 1627.77,467.046 1630.12,454.257 1632.47,266.458 1634.82,258.316 1637.17,364.165 1639.53,395.604 1641.88,390.166 1644.23,321.01 1646.58,482.094 1648.93,421.969 1651.28,362.95 1653.63,350.007 1655.98,371.439 1658.33,422.89 1660.68,358.908 1663.03,183.819 1665.38,499.238 1667.73,530.436 1670.08,522.662 1672.43,468.001 1674.78,334.968 1677.13,427.986 1679.48,323.757 1681.83,355.896 1684.18,465.913 1686.53,495.108 1688.89,167.566 1691.24,377.915 1693.59,365.386 1695.94,481.708 1698.29,356.933 1700.64,437.017 1702.99,377.41 1705.34,293.499 1707.69,394.411 1710.04,198.251 1712.39,417.588 1714.74,298.632 1717.09,498.304 1719.44,450.964 1721.79,298.776 1724.14,238.869 1726.49,372.99 1728.84,422.805 1731.19,391.544 1733.54,338.439 1735.89,224.341 1738.25,422.837 1740.6,561.349 1742.95,448.075 1745.3,367.504 1747.65,645.858 1750,265.273 1752.35,106.254 1754.7,380.829 1757.05,337.766 1759.4,472.233 1761.75,508.942 1764.1,354.905 1766.45,308.855 1768.8,326.438 1771.15,424.759 1773.5,238.832 1775.85,167.155 1778.2,248.165 1780.55,452.091 1782.9,386.32 1785.25,373.48 1787.6,331.658 1789.96,344.616 1792.31,322.205 1794.66,464.426 1797.01,573.523 1799.36,495.644 1801.71,314.042 1804.06,480.152 1806.41,479.703 1808.76,491.324 1811.11,367.293 1813.46,208.562 1815.81,438.578 1818.16,481.449 1820.51,461.576 1822.86,328.097 1825.21,419.107 1827.56,295.623 1829.91,593.815 1832.26,337.457 1834.61,649.762 1836.96,677.477 1839.32,482.96 1841.67,524.297 1844.02,552.968 1846.37,331.658 1848.72,472.981 1851.07,289.627 1853.42,370.939 1855.77,430.598 1858.12,439.14 1860.47,348.571 1862.82,416.338 1865.17,449.327 1867.52,580.202 1869.87,491.107 1872.22,433.65 1874.57,351.54 1876.92,538.493 1879.27,328.004 1881.62,452.913 1883.97,380.087 1886.32,527.912 1888.68,476.67 1891.03,206.67 1893.38,372.857 1895.73,237.022 1898.08,307.566 1900.43,268.857 1902.78,385.043 1905.13,488.258 1907.48,475.412 1909.83,331.343 1912.18,422.651 1914.53,482.99 1916.88,225.2 1919.23,284.714 1921.58,384.101 1923.93,407.289 1926.28,281.502 1928.63,271.751 1930.98,371.31 1933.33,459.767 1935.68,424.932 1938.04,188.365 1940.39,378.123 1942.74,430.244 1945.09,290.301 1947.44,382.847 1949.79,647.923 1952.14,469.299 1954.49,338.886 1956.84,316.781 1959.19,445.524 1961.54,192.365 1963.89,231.36 1966.24,551.375 1968.59,289.103 1970.94,224.281 1973.29,384.254 1975.64,208.377 1977.99,415.841 1980.34,284.848 1982.69,630.427 1985.04,447.094 1987.4,506.65 1989.75,339.391 1992.1,372.529 1994.45,439.064 1996.8,415.653 1999.15,343.295 2001.5,331.179 2003.85,497.99 2006.2,311.193 2008.55,408.63 2010.9,358.456 2013.25,434.873 2015.6,774.957 2017.95,528.005 2020.3,356.713 2022.65,299.073 2025,403.187 2027.35,348.023 2029.7,520.845 2032.05,396.848 2034.4,327.739 2036.76,429.324 2039.11,347.849 2041.46,431.814 2043.81,459.04 2046.16,371.266 2048.51,276.464 2050.86,403.31 2053.21,249.42 2055.56,287.595 2057.91,422.944 2060.26,435.422 2062.61,393.753 2064.96,374.307 2067.31,395.476 2069.66,639.878 2072.01,565.885 2074.36,410.924 2076.71,446.29 2079.06,366.329 2081.41,502.812 2083.76,634.09 2086.11,404.728 2088.47,419.217 2090.82,589.707 2093.17,349.255 2095.52,500.072 2097.87,470.265 2100.22,272.503 2102.57,468.252 2104.92,482.086 2107.27,402.09 2109.62,464.667 2111.97,495.796 2114.32,420.344 2116.67,494.98 2119.02,279.411 2121.37,430.135 2123.72,419.302 2126.07,307.548 2128.42,316.979 2130.77,410.767 2133.12,256.671 2135.47,426.617 2137.83,475.463 2140.18,363.801 2142.53,337.526 2144.88,448.574 2147.23,227.402 2149.58,369.506 2151.93,301.253 2154.28,465.112 2156.63,406.521 2158.98,567.427 2161.33,383.01 2163.68,363.506 2166.03,291.626 2168.38,342.96 2170.73,432.209 2173.08,156.933 2175.43,467.961 2177.78,440.885 2180.13,636.428 2182.48,292.698 2184.83,459.409 2187.19,584.513 2189.54,340.493 2191.89,210.889 2194.24,315.467 2196.59,352.412 2198.94,384.478 2201.29,227.844 2203.64,232.52 2205.99,241.441 2208.34,314.307 2210.69,280.718 2213.04,458.481 2215.39,365.715 2217.74,491.013 2220.09,474.732 2222.44,411.51 2224.79,475.072 2227.14,315.212 2229.49,275.296 2231.84,462.519 2234.19,498.578 2236.55,249.501 2238.9,536.477 2241.25,350.266 2243.6,330.705 2245.95,337.869 2248.3,398.102 2250.65,432.416 2253,278.665 2255.35,363.573 2257.7,315.265 2260.05,333.268 2262.4,424.41 2264.75,408.753 2267.1,359.947 2269.45,312.648 2271.8,189.062 2274.15,514.073 2276.5,326.206 2278.85,404.27 2281.2,501.017 2283.55,376.171 2285.91,361.911 2288.26,409.653 2290.61,222.773 2292.96,316.03 2295.31,506.72 2297.66,355.352 2300.01,381.676 2302.36,337.028 2304.71,532.06 2307.06,326.395 2309.41,357.208 2311.76,463.781 2314.11,444.81 2316.46,524.173 2318.81,390.402 2321.16,442.048 2323.51,315.366 2325.86,345.944 2328.21,329.963 2330.56,96.8724 2332.91,261.216 2335.27,245.015 2337.62,472.569 2339.97,442.97 2342.32,289.595 2344.67,425.317 2347.02,291.03 2349.37,398.962 2351.72,271.532 2354.07,399.937 2356.42,391.646 2358.77,441.669 2361.12,430.57 2363.47,420.434 2365.82,467.778 2368.17,327.596 2370.52,293.743 2372.87,380.238 2375.22,286.104 2377.57,338.751 2379.92,268.006 2382.27,427.12 2384.62,309.381 2386.98,335.72 2389.33,182.736 2391.68,337.989 2394.03,308.979 2396.38,487.609 2398.73,466.466 2401.08,378.982 2403.43,282.032 2405.78,227.542 2408.13,328.889 2410.48,293.518 2412.83,346.437 2415.18,486.428 2417.53,367.667 2419.88,285.922 2422.23,497.391 2424.58,242.398 2426.93,323.495 2429.28,447.479 2431.63,458.454 2433.98,265.442 2436.34,316.606 2438.69,260.609 2441.04,518.8 2443.39,726.517 2445.74,175.009 2448.09,281.767 2450.44,299.189 2452.79,405.905 2455.14,491.902 2457.49,531.668 2459.84,310.966 2462.19,345.694 2464.54,561.382 2466.89,340.319 2469.24,190.736 2471.59,611.357 2473.94,348.7 2476.29,515.937 2478.64,475.653 2480.99,544.622 2483.34,316.34 2485.7,482.448 2488.05,502.978 2490.4,300.63 2492.75,431.765 2495.1,297.958 2497.45,397.286 2499.8,336.917 2502.15,517.325 2504.5,398.124 2506.85,437.709 2509.2,576.576 2511.55,316.104 2513.9,415.527 2516.25,179.337 2518.6,348.1 2520.95,205.596 2523.3,370.852 2525.65,375.109 2528,427.29 2530.35,438.516 2532.7,517.33 2535.06,337.343 2537.41,348.994 2539.76,478.386 2542.11,316.609 2544.46,343.93 2546.81,571.149 2549.16,120.614 2551.51,388.639 2553.86,379.658 2556.21,350.447 2558.56,427.156 2560.91,425.816 2563.26,488.037 2565.61,283.905 2567.96,531.241 2570.31,487.428 "></polyline>
</svg>
</div>
</div>
<p>Look at that! Things are working; amazin’.</p>
<p>We can also exploit <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>’s parallel sampling capabilities:</p>
<div id="34" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run separate 4 chains for 10 000 iterations using threads to parallelize.</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>num_chains <span class="op">=</span> <span class="fl">4</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    model_with_grad,</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">MCMCThreads</span>(),</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>,</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    num_chains;</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Note we need to provide an initial state for every chain.</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>    initial_state<span class="op">=</span><span class="fu">fill</span>(state, num_chains),</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>samples_array <span class="op">=</span> <span class="fu">stack</span>(<span class="fu">map</span>(<span class="bu">Base</span>.<span class="fu">Fix1</span>(stack, sample <span class="op">-&gt;</span> sample.x), samples))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000×4 Array{Float64, 3}:
[:, :, 1] =
 -2.50329   -2.50329   -4.18457   -5.3153   …  -4.48753   -5.52916  -5.88633
 -0.297814  -0.297814   0.598353   1.34562      0.408441  -1.01375   1.37869
  3.78033    3.78033    6.07122    5.16659      5.38221    4.89745   4.47164

[:, :, 2] =
 -3.48805  -5.37627   -4.60213   …  -5.69203   -7.05298   -7.30684
 -1.05761  -0.615223   0.140972      0.710281  -0.884859  -0.492389
  3.3225    4.09486    5.10977       4.8743     5.08587    5.57446

[:, :, 3] =
 -0.956553  -3.61694   -3.7284    …  -5.50609   -3.87882   -4.72811
  0.943585   0.955765   0.122487      0.932724  -0.510153  -0.737288
  3.10631    3.71928    4.2115        5.34656    4.85087    6.74225

[:, :, 4] =
 -4.98038   -2.99699   -2.99699   -4.26124  …  -4.89262   -4.51478   -4.60759
  0.129852  -0.316769  -0.316769  -1.90077     -0.674127   0.534046  -1.97594
  2.76998    4.20413    4.20413    4.5308       5.89203    5.37027    4.77863</code></pre>
</div>
</div>
<p>But the fact that we have to provide the <code>AbstractMCMC.sample</code> call, etc. with an <code>initial_state</code> to get started is a bit annoying. We can avoid this by also defining a <code>AbstractMCMC.step</code> <em>without</em> the <code>state</code> argument:</p>
<div id="36" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">::</span><span class="dt">MALA</span>;</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># </span><span class="al">NOTE</span><span class="co">: No state provided!</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just create the initial state by sampling using  a Gaussian.</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="fu">randn</span>(rng, LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(x), <span class="fu">MALAState</span>(x)</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Equipped with this, we no longer need to provide the <code>initial_state</code> everywhere:</p>
<div id="38" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -4.98068    1.00642
 -0.0183499  0.996776
  4.97859    1.01138</code></pre>
</div>
</div>
</section>
<section id="using-our-sampler-with-turing.jl" class="level2">
<h2 class="anchored" data-anchor-id="using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</h2>
<p>As we promised, all of this hassle of implementing our <code>MALA</code> sampler in a way that uses <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> and <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> gets us something more than <em>just</em> an “automatic” implementation of <code>AbstractMCMC.sample</code>.</p>
<p>It also enables use with Turing.jl through the <code>externalsampler</code>, but we need to do one final thing first: we need to tell Turing.jl how to extract a vector of parameters from the “sample” returned in our implementation of <code>AbstractMCMC.step</code>. In our case, the “sample” is a <code>MALASample</code>, so we just need the following line:</p>
<div id="40" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load Turing.jl.</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Turing</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Overload the `getparams` method for our "sample" type, which is just a vector.</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>Turing.Inference.<span class="fu">getparams</span>(<span class="op">::</span><span class="dt">Turing.Model</span>, sample<span class="op">::</span><span class="dt">MALASample</span>) <span class="op">=</span> sample.x</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And with that, we’re good to go!</p>
<div id="42" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Our previous model defined as a Turing.jl model.</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">mvnormal_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">MvNormal</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.], I)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate our model.</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">mvnormal_model</span>()</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Call `sample` but now we're passing in a Turing.jl `model` and wrapping</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co"># our `MALA` sampler in the `externalsampler` to tell Turing.jl that the sampler</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co"># expects something that implements LogDensityProblems.jl.</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×4×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 2.6 seconds
Compute duration  = 2.6 seconds
parameters        = x[1], x[2], x[3]
internals         = lp

Summary Statistics
  parameters      mean       std      mcse    ess_bulk    ess_tail      rhat   ⋯
      Symbol   Float64   Float64   Float64     Float64     Float64   Float64   ⋯

        x[1]   -4.9827    0.9936    0.0174   3253.1752   5111.3677    1.0000   ⋯
        x[2]    0.0050    1.0010    0.0182   3023.2470   4477.0745    0.9999   ⋯
        x[3]    5.0153    0.9879    0.0174   3215.8387   5319.7688    1.0000   ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

        x[1]   -6.9502   -5.6445   -4.9662   -4.2994   -3.0689
        x[2]   -1.9698   -0.6724    0.0069    0.6780    2.0164
        x[3]    3.0790    4.3616    5.0201    5.6885    6.9067</code></pre>
</div>
</div>
<p>Pretty neat, eh?</p>
<section id="models-with-constrained-parameters" class="level3">
<h3 class="anchored" data-anchor-id="models-with-constrained-parameters">Models with constrained parameters</h3>
<p>One thing we’ve sort of glossed over in all of the above is that MALA, at least how we’ve implemented it, requires <span class="math inline">\(x\)</span> to live in <span class="math inline">\(\mathbb{R}^d\)</span> for some <span class="math inline">\(d &gt; 0\)</span>. If some of the parameters were in fact constrained, e.g.&nbsp;we were working with a <code>Beta</code> distribution which has support on the interval <span class="math inline">\((0, 1)\)</span>, <em>not</em> on <span class="math inline">\(\mathbb{R}^d\)</span>, we could easily end up outside of the valid range <span class="math inline">\((0, 1)\)</span>.</p>
<div id="44" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">beta_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">beta_model</span>()</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 1.56 seconds
Compute duration  = 1.56 seconds
parameters        = x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse    ess_bulk    ess_tail      rhat   ⋯
      Symbol   Float64   Float64   Float64     Float64     Float64   Float64   ⋯

           x    0.4937    0.1890    0.0028   4586.0200   5862.0278    0.9999   ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

           x    0.1450    0.3533    0.4915    0.6362    0.8462</code></pre>
</div>
</div>
<p>Yep, that still works, but only because Turing.jl actually <em>transforms</em> the <code>turing_model</code> from constrained to unconstrained, so that the <code>sampler</code> provided to <code>externalsampler</code> is actually always working in unconstrained space! This is not always desirable, so we can turn this off:</p>
<div id="46" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 0.24 seconds
Compute duration  = 0.24 seconds
parameters        = x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse   ess_bulk   ess_tail      rhat   e ⋯
      Symbol   Float64   Float64   Float64    Float64    Float64   Float64     ⋯

           x    0.5223    0.1627    0.0131   119.9413    37.4018    1.0047     ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

           x    0.2682    0.4010    0.5256    0.6573    0.7774</code></pre>
</div>
</div>
<p>The fun thing is that this still sort of works because</p>
<div id="48" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">logpdf</span>(<span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>), <span class="fl">10.0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-Inf</code></pre>
</div>
</div>
<p>and so the samples that fall outside of the range are always rejected. But do notice how much worse all the diagnostics are, e.g.&nbsp;<code>ess_tail</code> is very poor compared to when we use <code>unconstrained=true</code>. Moreover, in more complex cases this won’t just result in a “nice” <code>-Inf</code> log-density value, but instead will error:</p>
<div id="50" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="kw">function</span> <span class="fu">demo</span>()</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>    σ² <span class="op">~</span> <span class="fu">truncated</span>(<span class="fu">Normal</span>(), lower<span class="op">=</span><span class="fl">0</span>)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If we end up with negative values for `σ²`, the `Normal` will error.</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>    x <span class="op">~</span> <span class="fu">Normal</span>(<span class="fl">0</span>, σ²)</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>DomainError: DomainError(-0.17240308728065007, "Normal: the condition σ &gt;= zero(σ) is not satisfied.")
DomainError with -0.17240308728065007:
Normal: the condition σ &gt;= zero(σ) is not satisfied.
Stacktrace:
  [1] #371
    @ ~/.julia/packages/Distributions/nmUhn/src/univariate/continuous/normal.jl:37 [inlined]
  [2] check_args
    @ ~/.julia/packages/Distributions/nmUhn/src/utils.jl:89 [inlined]
  [3] #Normal#370
    @ ~/.julia/packages/Distributions/nmUhn/src/univariate/continuous/normal.jl:37 [inlined]
  [4] Normal
    @ ~/.julia/packages/Distributions/nmUhn/src/univariate/continuous/normal.jl:36 [inlined]
  [5] Normal
    @ ~/.julia/packages/Distributions/nmUhn/src/univariate/continuous/normal.jl:42 [inlined]
  [6] macro expansion
    @ ~/.julia/packages/DynamicPPL/MjWTB/src/compiler.jl:579 [inlined]
  [7] demo(__model__::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, __varinfo__::DynamicPPL.ThreadSafeVarInfo{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, Vector{Base.RefValue{Float64}}}, __context__::DynamicPPL.ValuesAsInModelContext{OrderedDict{Any, Any}, DynamicPPL.DefaultContext})
    @ Main.Notebook ~/work/docs/docs/tutorials/docs-17-implementing-samplers/index.qmd:593
  [8] _evaluate!!
    @ ~/.julia/packages/DynamicPPL/MjWTB/src/model.jl:973 [inlined]
  [9] evaluate_threadsafe!!(model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, varinfo::DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, context::DynamicPPL.ValuesAsInModelContext{OrderedDict{Any, Any}, DynamicPPL.DefaultContext})
    @ DynamicPPL ~/.julia/packages/DynamicPPL/MjWTB/src/model.jl:962
 [10] evaluate!!
    @ ~/.julia/packages/DynamicPPL/MjWTB/src/model.jl:892 [inlined]
 [11] values_as_in_model
    @ ~/.julia/packages/DynamicPPL/MjWTB/src/values_as_in_model.jl:196 [inlined]
 [12] values_as_in_model
    @ ~/.julia/packages/DynamicPPL/MjWTB/src/values_as_in_model.jl:195 [inlined]
 [13] getparams(model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, vi::DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64})
    @ Turing.Inference ~/.julia/packages/Turing/Bv30p/src/mcmc/Inference.jl:343
 [14] Turing.Inference.Transition(model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, vi::DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, t::MALASample{Vector{Float64}})
    @ Turing.Inference ~/.julia/packages/Turing/Bv30p/src/mcmc/Inference.jl:226
 [15] transition_to_turing
    @ ~/.julia/packages/Turing/Bv30p/src/mcmc/abstractmcmc.jl:12 [inlined]
 [16] transition_to_turing(f::LogDensityProblemsADForwardDiffExt.ForwardDiffLogDensity{LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, Nothing}, ForwardDiff.Chunk{2}, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}, transition::MALASample{Vector{Float64}})
    @ Turing.Inference ~/.julia/packages/Turing/Bv30p/src/mcmc/abstractmcmc.jl:17
 [17] step(rng::TaskLocalRNG, model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, sampler_wrapper::DynamicPPL.Sampler{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}; initial_state::Nothing, initial_params::Nothing, kwargs::@Kwargs{})
    @ Turing.Inference ~/.julia/packages/Turing/Bv30p/src/mcmc/abstractmcmc.jl:141
 [18] step
    @ ~/.julia/packages/Turing/Bv30p/src/mcmc/abstractmcmc.jl:96 [inlined]
 [19] macro expansion
    @ ~/.julia/packages/AbstractMCMC/YrmkI/src/sample.jl:130 [inlined]
 [20] macro expansion
    @ ~/.julia/packages/AbstractMCMC/YrmkI/src/logging.jl:16 [inlined]
 [21] mcmcsample(rng::TaskLocalRNG, model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, sampler::DynamicPPL.Sampler{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}, N::Int64; progress::Bool, progressname::String, callback::Nothing, discard_initial::Int64, thinning::Int64, chain_type::Type, initial_state::Nothing, kwargs::@Kwargs{})
    @ AbstractMCMC ~/.julia/packages/AbstractMCMC/YrmkI/src/sample.jl:120
 [22] sample(rng::TaskLocalRNG, model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, sampler::DynamicPPL.Sampler{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}, N::Int64; chain_type::Type, resume_from::Nothing, initial_state::Nothing, kwargs::@Kwargs{progress::Bool})
    @ DynamicPPL ~/.julia/packages/DynamicPPL/MjWTB/src/sampler.jl:93
 [23] sample
    @ ~/.julia/packages/DynamicPPL/MjWTB/src/sampler.jl:83 [inlined]
 [24] #sample#4
    @ ~/.julia/packages/Turing/Bv30p/src/mcmc/Inference.jl:276 [inlined]
 [25] sample
    @ ~/.julia/packages/Turing/Bv30p/src/mcmc/Inference.jl:267 [inlined]
 [26] #sample#3
    @ ~/.julia/packages/Turing/Bv30p/src/mcmc/Inference.jl:264 [inlined]
 [27] top-level scope
    @ ~/work/docs/docs/tutorials/docs-17-implementing-samplers/index.qmd:595</code></pre>
</div>
</div>
<p>As expected, we run into a <code>DomainError</code> at some point, while if we set <code>unconstrained=true</code>, letting Turing.jl transform the model to a unconstrained form behind the scenes, everything works as expected:</p>
<div id="52" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 1.64 seconds
Compute duration  = 1.64 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse   ess_bulk   ess_tail      rhat   e ⋯
      Symbol   Float64   Float64   Float64    Float64    Float64   Float64     ⋯

          σ²    0.5297    0.5421    0.0787    33.7832    22.2918    1.0363     ⋯
           x   -0.1320    0.8828    0.0768   194.8781   157.7387    1.0432     ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

          σ²    0.1532    0.1532    0.2281    0.7780    2.0374
           x   -2.1618   -0.2493   -0.2493    0.0559    2.0031</code></pre>
</div>
</div>
<p>Neat!</p>
<p>Similarly, which automatic differentiation backend one should use can be specified through the <code>adtype</code> keyword argument too. For example, if we want to use <a href="https://github.com/JuliaDiff/ReverseDiff.jl">ReverseDiff.jl</a> instead of the default <a href="https://github.com/JuliaDiff/ForwardDiff.jl">ForwardDiff.jl</a>:</p>
<div id="54" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">ReverseDiff</span>: ReverseDiff</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify that we want to use `AutoReverseDiff`.</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">demo</span>(),</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>, adtype<span class="op">=</span><span class="fu">AutoReverseDiff</span>()),</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>;</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 3.04 seconds
Compute duration  = 3.04 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse   ess_bulk   ess_tail      rhat   e ⋯
      Symbol   Float64   Float64   Float64    Float64    Float64   Float64     ⋯

          σ²    0.8750    0.5602    0.0304   222.3308    77.8318    1.0037     ⋯
           x    0.0722    1.0924    0.0608   493.4720   239.3117    1.0006     ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

          σ²    0.1244    0.4154    0.7579    1.2374    2.1207
           x   -2.2226   -0.3827    0.0417    0.4521    2.9033</code></pre>
</div>
</div>
<p>Double-neat.</p>
</section>
</section>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<p>At this point it’s worth maybe reminding ourselves what we did and also <em>why</em> we did it:</p>
<ol type="1">
<li>We define our models in the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface because it makes the sampler agnostic to how the underlying model is implemented.</li>
<li>We implement our sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> interface, which just means that our sampler is a subtype of <code>AbstractMCMC.AbstractSampler</code> and we implement the MCMC transition in <code>AbstractMCMC.step</code>.</li>
<li>Points 1 and 2 makes it so our sampler can be used with a wide range of model implementations, amongst them being models implemented in both Turing.jl and Stan. This gives you, the inference implementer, a large collection of models to test your inference method on, in addition to allowing users of Turing.jl and Stan to try out your inference method with minimal effort.</li>
</ol>


</section>


<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a><div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>We’re going with the leapfrog formulation because in a future version of this tutorial we’ll add a section extending this simple “baseline” MALA sampler to more complex versions. See <a href="https://github.com/TuringLang/docs/issues/479">issue #479</a> for progress on this.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>There is no such thing as a proper interface in Julia (at least not officially), and so we use the word “interface” here to mean a few minimal methods that needs to be implemented by any type that we treat as a target model.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/turinglang\.org\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../tutorials/docs-07-for-developers-variational-inference/index.html" class="pagination-link" aria-label="Variational Inference">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Variational Inference</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Turing is created by <a href="http://mlg.eng.cam.ac.uk/hong/" target="_blank">Hong Ge</a>, and lovingly maintained by the <a href="https://github.com/TuringLang/Turing.jl/graphs/contributors" target="_blank">core team</a> of volunteers. <br> The contents of this website are © 2024 under the terms of the <a href="https://github.com/TuringLang/Turing.jl/blob/master/LICENCE" target="_blank">MIT License</a>.</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/TuringLang/docs/edit/master/tutorials/docs-17-implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/docs/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://x.com/TuringLang">
      <i class="bi bi-twitter" role="img" aria-label="Turing Twitter">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/TuringLang/Turing.jl">
      <i class="bi bi-github" role="img" aria-label="Turing GitHub">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




<script src="../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>