<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Implementing samplers – Turing.jl</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../tutorials/docs-07-for-developers-variational-inference/index.html" rel="prev">
<link href="../../assets/favicon.ico" rel="icon">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<style>
  a {
    text-decoration: none;
  }
  a:hover {
    text-decoration: underline;
  }
</style>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../theming/styles.css">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="https://turinglang.org/" class="navbar-brand navbar-brand-logo">
    <img src="../../assets/images/turing-logo.svg" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="https://turinglang.org/">
    <span class="navbar-title">Turing.jl</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../tutorials/docs-00-getting-started/"> 
<span class="menu-text">Get Started</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../tutorials/00-introduction/"> 
<span class="menu-text">Tutorials</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/library/"> 
<span class="menu-text">Libraries</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/news/"> 
<span class="menu-text">News</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/team/"> 
<span class="menu-text">Team</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-v0.34" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">v0.34</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-v0.34">    
        <li>
    <a class="dropdown-item" href="https://turinglang.org/docs/changelog.html">
 <span class="dropdown-text">Changelog</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://turinglang.org/docs/versions.html">
 <span class="dropdown-text">All Versions</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools tools-wide">
    <a href="https://x.com/TuringLang" title="Turing Twitter" class="quarto-navigation-tool px-1" aria-label="Turing Twitter"><i class="bi bi-twitter"></i></a>
    <a href="https://github.com/TuringLang/Turing.jl" title="Turing GitHub" class="quarto-navigation-tool px-1" aria-label="Turing GitHub"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Developers</li><li class="breadcrumb-item"><a href="../../tutorials/docs-06-for-developers-interface/index.html">Inference (note: outdated)</a></li><li class="breadcrumb-item"><a href="../../tutorials/docs-17-implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false">
 <span class="menu-text">Users</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-00-getting-started/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Getting Started</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-12-using-turing-guide/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Core Functionality</span></a>
  </div>
</li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false">
 <span class="menu-text">Usage Tips</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-10-using-turing-autodiff/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Automatic Differentiation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/usage-custom-distribution/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Custom Distributions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/usage-probability-interface/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Querying Model Probabilities</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/usage-modifying-logprob/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Modifying the Log Probability</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/usage-generated-quantities/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Generated Quantities</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-17-mode-estimation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Mode Estimation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-13-using-turing-performance-tips/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Performance Tips</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-15-using-turing-sampler-viz/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Sampler Visualization</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-11-using-turing-dynamichmc/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using DynamicHMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-16-using-turing-external-samplers/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using External Samplers</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false">
 <span class="menu-text">Tutorials</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/00-introduction/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction: Coin Flipping</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/01-gaussian-mixture-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Mixture Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/02-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/03-bayesian-neural-network/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Neural Networks</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/04-hidden-markov-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Hidden Markov Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/05-linear-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Linear Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/06-infinite-mixture-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Infinite Mixture Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/07-poisson-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Poisson Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/08-multinomial-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Multinomial Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/09-variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/10-bayesian-differential-equations/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Differential Equations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/11-probabilistic-pca/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Probabilistic PCA</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/13-seasonal-time-series/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Time Series Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/15-gaussian-processes/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction to Gaussian Processes</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/12-gplvm/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Process Latent Variable Models</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Developers</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false">
 <span class="menu-text">Contributing</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-01-contributing-guide/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">How to Contribute</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="false">
 <span class="menu-text">DynamicPPL in Depth</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/dev-model-manual/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Manually Defining a Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-05-for-developers-compiler/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Turing Compiler Design</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/14-minituring/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation I: Compiler</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/16-contexts/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation II: Contexts</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true">
 <span class="menu-text">Inference (note: outdated)</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-06-for-developers-interface/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Interface Guide</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-04-for-developers-abstractmcmc-turing/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">How Turing implements AbstractMCMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-07-for-developers-variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-17-implementing-samplers/index.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Implementing Samplers</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of Contents</h2>
   
  <ul>
  <li><a href="#quick-overview-of-mala" id="toc-quick-overview-of-mala" class="nav-link active" data-scroll-target="#quick-overview-of-mala">Quick overview of MALA</a></li>
  <li><a href="#what-we-need-from-a-model-logdensityproblems.jl" id="toc-what-we-need-from-a-model-logdensityproblems.jl" class="nav-link" data-scroll-target="#what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: LogDensityProblems.jl</a></li>
  <li><a href="#implementing-mala-in-abstractmcmc.jl" id="toc-implementing-mala-in-abstractmcmc.jl" class="nav-link" data-scroll-target="#implementing-mala-in-abstractmcmc.jl">Implementing MALA in AbstractMCMC.jl</a></li>
  <li><a href="#using-our-sampler-with-turing.jl" id="toc-using-our-sampler-with-turing.jl" class="nav-link" data-scroll-target="#using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</a>
  <ul class="collapse">
  <li><a href="#models-with-constrained-parameters" id="toc-models-with-constrained-parameters" class="nav-link" data-scroll-target="#models-with-constrained-parameters">Models with constrained parameters</a></li>
  </ul></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/TuringLang/docs/edit/master/tutorials/docs-17-implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/docs/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Developers</li><li class="breadcrumb-item"><a href="../../tutorials/docs-06-for-developers-interface/index.html">Inference (note: outdated)</a></li><li class="breadcrumb-item"><a href="../../tutorials/docs-17-implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Implementing samplers</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>In this tutorial, we’ll go through step-by-step how to implement a “simple” sampler in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> in such a way that it can be easily applied to Turing.jl models.</p>
<p>In particular, we’re going to implement a version of <strong>Metropolis-adjusted Langevin (MALA)</strong>.</p>
<p>Note that we will implement this sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> framework, completely “ignoring” Turing.jl until the very end of the tutorial, at which point we’ll use a single line of code to make the resulting sampler available to Turing.jl. This is to really drive home the point that one can implement samplers in a way that is accessible to all of Turing.jl’s users without having to use Turing.jl yourself.</p>
<section id="quick-overview-of-mala" class="level2">
<h2 class="anchored" data-anchor-id="quick-overview-of-mala">Quick overview of MALA</h2>
<p>We can view MALA as a single step of the leapfrog intergrator with resampling of momentum <span class="math inline">\(p\)</span> at every step.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> To make that statement a bit more concrete, we first define the <em>extended</em> target <span class="math inline">\(\bar{\gamma}(x, p)\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\log \bar{\gamma}(x, p) \propto \log \gamma(x) + \log \gamma_{\mathcal{N}(0, M)}(p)
\end{equation*}\]</span></p>
<p>where <span class="math inline">\(\gamma_{\mathcal{N}(0, M)}\)</span> denotes the density for a zero-centered Gaussian with covariance matrix <span class="math inline">\(M\)</span>. We then consider targeting this joint distribution over both <span class="math inline">\(x\)</span> and <span class="math inline">\(p\)</span> as follows. First we define the map</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  L_{\epsilon}: \quad &amp; \mathbb{R}^d \times \mathbb{R}^d \to \mathbb{R}^d \times \mathbb{R}^d \\
  &amp; (x, p) \mapsto (\tilde{x}, \tilde{p}) := L_{\epsilon}(x, p)
\end{split}
\end{equation*}\]</span></p>
<p>as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p_{1 / 2} &amp;:= p + \frac{\epsilon}{2} \nabla \log \gamma(x) \\
  \tilde{x} &amp;:= x + \epsilon M^{-1} p_{1 /2 } \\
  p_1 &amp;:= p_{1 / 2} + \frac{\epsilon}{2} \nabla \log \gamma(\tilde{x}) \\
  \tilde{p} &amp;:= - p_1
\end{split}
\end{equation*}\]</span></p>
<p>This might be familiar for some readers as a single step of the Leapfrog integrator. We then define the MALA kernel as follows: given the current iterate <span class="math inline">\(x_i\)</span>, we sample the next iterate <span class="math inline">\(x_{i + 1}\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p &amp;\sim \mathcal{N}(0, M) \\
  (\tilde{x}, \tilde{p}) &amp;:= L_{\epsilon}(x_i, p) \\
  \alpha &amp;:= \min \left\{ 1, \frac{\bar{\gamma}(\tilde{x}, \tilde{p})}{\bar{\gamma}(x_i, p)} \right\} \\
  x_{i + 1} &amp;:=
  \begin{cases}
    \tilde{x} \quad &amp; \text{ with prob. } \alpha \\
    x_i       \quad &amp; \text{ with prob. } 1 - \alpha
  \end{cases}
\end{split}
\end{equation*}\]</span></p>
<p>i.e.&nbsp;we accept the proposal <span class="math inline">\(\tilde{x}\)</span> with probability <span class="math inline">\(\alpha\)</span> and reject it, thus sticking with our current iterate, with probability <span class="math inline">\(1 - \alpha\)</span>.</p>
</section>
<section id="what-we-need-from-a-model-logdensityproblems.jl" class="level2">
<h2 class="anchored" data-anchor-id="what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a></h2>
<p>There are a few things we need from the “target” / “model” / density that we want to sample from:</p>
<ol type="1">
<li>We need access to log-density <em>evaluations</em> <span class="math inline">\(\log \gamma(x)\)</span> so we can compute the acceptance ratio involving <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>We need access to log-density <em>gradients</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span> so we can compute the Leapfrog steps <span class="math inline">\(L_{\epsilon}(x, p)\)</span>.</li>
<li>We also need access to the “size” of the model so we can determine the size of <span class="math inline">\(M\)</span>.</li>
</ol>
<p>Luckily for us, there is a package called <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> which provides an interface for <em>exactly</em> this!</p>
<p>To demonstrate how one can implement the “<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface”<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> we will use a simple Gaussian model as an example:</p>
<div id="4" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblems</span>: LogDensityProblems;</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's define some type that represents the model.</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> IsotropicNormalModel{M<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"mean of the isotropic Gaussian"</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    mean<span class="op">::</span><span class="dt">M</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Specifies what input length the model expects.</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">dimension</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> <span class="fu">length</span>(model.mean)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Implementation of the log-density evaluation of the model.</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x<span class="op">::</span><span class="dt">AbstractVector{&lt;:Real}</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">-</span> <span class="fu">sum</span>(abs2, x <span class="op">.-</span> model.mean) <span class="op">/</span> <span class="fl">2</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This gives us all of the properties we want for our MALA sampler with the exception of the computation of the <em>gradient</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span>. There is the method <code>LogDensityProblems.logdensity_and_gradient</code> which should return a 2-tuple where the first entry is the evaluation of the logdensity <span class="math inline">\(\log \gamma(x)\)</span> and the second entry is the gradient <span class="math inline">\(\nabla \log \gamma(x)\)</span>.</p>
<p>There are two ways to “implement” this method: 1) we implement it by hand, which is feasible in the case of our <code>IsotropicNormalModel</code>, or b) we defer the implementation of this to a automatic differentiation backend.</p>
<p>To implement it by hand we can simply do</p>
<div id="6" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl that first-order, i.e. gradient information, is available.</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{1}</span>()</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Implement `logdensity_and_gradient`.</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    logγ_x <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="op">-</span>x <span class="op">.*</span> (x <span class="op">-</span> model.mean)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> logγ_x, ∇logγ_x</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s just try it out:</p>
<div id="8" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate the problem.</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> <span class="fu">IsotropicNormalModel</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.])</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create some example input that we can test on.</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>x_example <span class="op">=</span> <span class="fu">randn</span>(LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate!</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-30.256855327962494</code></pre>
</div>
</div>
<p>To defer it to an automatic differentiation backend, we can do</p>
<div id="10" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl we only have access to 0-th order information.</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{0}</span>()</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Use `LogDensityProblemsAD`'s `ADgradient` in combination with some AD backend to implement `logdensity_and_gradient`.</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblemsAD</span>, <span class="bu">ADTypes</span>, <span class="bu">ForwardDiff</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>model_with_grad <span class="op">=</span> <span class="fu">ADgradient</span>(<span class="fu">AutoForwardDiff</span>(), model)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model_with_grad, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-30.256855327962494</code></pre>
</div>
</div>
<p>We’ll continue with the second approach in this tutorial since this is typically what one does in practice, because there are better hobbies to spend time on than deriving gradients by hand.</p>
<p>At this point, one might wonder how we’re going to tie this back to Turing.jl in the end. Effectively, when working with inference methods that only require log-density evaluations and / or higher-order information of the log-density, Turing.jl actually converts the user-provided <code>Model</code> into an object implementing the above methods for <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>. As a result, most samplers provided by Turing.jl are actually implemented to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, enabling their use both <em>within</em> Turing.jl and <em>outside</em> of Turing.jl! Morever, there exists similar conversions for Stan through BridgeStan and Stan<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, which means that a sampler supporting the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface can easily be used on both Turing.jl <em>and</em> Stan models (in addition to user-provided models, as our <code>IsotropicNormalModel</code> above)!</p>
<p>Anyways, let’s move on to actually implementing the sampler.</p>
</section>
<section id="implementing-mala-in-abstractmcmc.jl" class="level2">
<h2 class="anchored" data-anchor-id="implementing-mala-in-abstractmcmc.jl">Implementing MALA in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a></h2>
<p>Now that we’ve established that a model implementing the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface provides us with all the information we need from <span class="math inline">\(\log \gamma(x)\)</span>, we can address the question: given an object that implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, how can we define a sampler for it?</p>
<p>We’re going to do this by making our sampler a sub-type of <code>AbstractMCMC.AbstractSampler</code> in addition to implementing a few methods from <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>. Why? Because it gets us <em>a lot</em> of functionality for free, as we will see later.</p>
<p>Moreover, <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> provides a very natural interface for MCMC algorithms.</p>
<p>First, we’ll define our <code>MALA</code> type</p>
<div id="12" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">AbstractMCMC</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALA{T,A} <span class="op">&lt;:</span><span class="dt"> AbstractMCMC.AbstractSampler</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"stepsize used in the leapfrog step"</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    ϵ_init<span class="op">::</span><span class="dt">T</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"covariance matrix used for the momentum"</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    M_init<span class="op">::</span><span class="dt">A</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notice how we’ve added the suffix <code>_init</code> to both the stepsize and the covariance matrix. We’ve done this because a <code>AbstractMCMC.AbstractSampler</code> should be <em>immutable</em>. Of course there might be many scenarios where we want to allow something like the stepsize and / or the covariance matrix to vary between iterations, e.g.&nbsp;during the burn-in / adaptation phase of the sampling process we might want to adjust the parameters using statistics computed from these initial iterations. But information which can change between iterations <em>should not go in the sampler itself</em>! Instead, this information should go in the sampler <em>state</em>.</p>
<p>The sampler state should at the very least contain all the necessary information to perform the next MCMC iteration, but usually contains further information, e.g.&nbsp;quantities and statistics useful for evaluating whether the sampler has converged.</p>
<p>We will use the following sampler state for our <code>MALA</code> sampler:</p>
<div id="14" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALAState{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This might seem overly redundant: we’re defining a type <code>MALAState</code> and it only contains a simple vector of reals. In this particular case we indeed could have dropped this and simply used a <code>AbstractVector{&lt;:Real}</code> as our sampler state, but typically, as we will see later, one wants to include other quantities in the sampler state. For example, if we also wanted to adapt the parameters of our <code>MALA</code>, e.g.&nbsp;alter the stepsize depending on acceptance rates, in which case we should also put <code>ϵ</code> in the state, but for now we’ll keep things simple.</p>
<p>Moreover, we also want a <em>sample</em> type, which is a type meant for “public consumption”, i.e.&nbsp;the end-user. This is generally going to contain a subset of the information present in the state. But in such a simple scenario as this, we similarly only have a <code>AbstractVector{&lt;:Real}</code>:</p>
<div id="16" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALASample{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We currently have three things:</p>
<ol type="1">
<li>A <code>AbstractMCMC.AbstractSampler</code> implementation called <code>MALA</code>.</li>
<li>A state <code>MALAState</code> for our sampler <code>MALA</code>.</li>
<li>A sample <code>MALASample</code> for our sampler <code>MALA</code>.</li>
</ol>
<p>That means that we’re ready to implement the only thing that really matters: <code>AbstractMCMC.step</code>.</p>
<p><code>AbstractMCMC.step</code> defines the MCMC iteration of our <code>MALA</code> given the current <code>MALAState</code>. Specifically, the signature of the function is as follows:</p>
<div id="18" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The RNG to ensure reproducibility.</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The model that defines our target.</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.AbstractModel</span>,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The sampler for which we're taking a `step`.</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">AbstractMCMC.AbstractSampler</span>,</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The current sampler `state`.</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    state;</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Additional keyword arguments that we may or may not need.</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Moreover, there is a specific <code>AbstractMCMC.AbstractModel</code> which is used to indicate that the model that is provided implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface: <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Since, as we discussed earlier, in our case we’re indeed going to work with types that support the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, we’ll define <code>AbstractMCMC.step</code> for such a <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Note that <code>AbstractMCMC.LogDensityModel</code> has no other purpose; it has a single field called <code>logdensity</code>, and it does nothing else. But by wrapping the model in <code>AbstractMCMC.LogDensityModel</code>, it allows samplers that want to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> to define their <code>AbstractMCMC.step</code> on this type without running into method ambiguities.</p>
<p>All in all, that means that the signature for our <code>AbstractMCMC.step</code> is going to be the following:</p>
<div id="20" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># `LogDensityModel` so we know we're working with LogDensityProblems.jl model.</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler.</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler state.</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Great! Now let’s actually implement the full <code>AbstractMCMC.step</code> for our <code>MALA</code>.</p>
<p>Let’s remind ourselves what we’re going to do:</p>
<ol type="1">
<li>Sample a new momentum <span class="math inline">\(p\)</span>.</li>
<li>Compute the log-density of the extended target <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>Take a single leapfrog step <span class="math inline">\((\tilde{x}, \tilde{p}) = L_{\epsilon}(x, p)\)</span>.</li>
<li>Accept or reject the proposed <span class="math inline">\((\tilde{x}, \tilde{p})\)</span>.</li>
</ol>
<p>All in all, this results in the following:</p>
<div id="22" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>: Random</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Distributions</span>  <span class="co"># so we get the `MvNormal`</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the wrapped model which implements LogDensityProblems.jl.</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just extract the sampler parameters to make our lives easier.</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    ϵ <span class="op">=</span> sampler.ϵ_init</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    M <span class="op">=</span> sampler.M_init</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the current parameters.</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> state.x</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sample the momentum.</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>    p_dist <span class="op">=</span> <span class="fu">MvNormal</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)), M)</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> <span class="fu">rand</span>(rng, p_dist)</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Propose using a single leapfrog step.</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>    x̃, p̃ <span class="op">=</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Accept or reject proposal.</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>    logp <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p)</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>    logp̃ <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x̃) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p̃)</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>    logα <span class="op">=</span> logp̃ <span class="op">-</span> logp</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>    state_new <span class="op">=</span> <span class="cf">if</span> <span class="fu">log</span>(<span class="fu">rand</span>(rng)) <span class="op">&lt;</span> logα</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Accept.</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x̃)</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Reject.</span></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x)</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return the "sample" and the sampler state.</span></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(state_new.x), state_new</span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Fairly straight-forward.</p>
<p>Of course, we haven’t defined the <code>leapfrog_step</code> method yet, so let’s do that:</p>
<div id="24" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p` using "position" `x`.</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x))</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    p1 <span class="op">=</span> p <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update the "position" `x` using momentum `p1`.</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    x̃ <span class="op">=</span> x <span class="op">+</span> ϵ <span class="op">.*</span> (M <span class="op">\</span> p1)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p1` using position `x̃`</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x̃ <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x̃))</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    p2 <span class="op">=</span> p1 <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x̃</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Flip momentum `p2`.</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    p̃ <span class="op">=</span> <span class="op">-</span>p2</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x̃, p̃</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>leapfrog_step (generic function with 1 method)</code></pre>
</div>
</div>
<p>With all of this, we’re technically ready to sample!</p>
<div id="26" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>, <span class="bu">LinearAlgebra</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>rng <span class="op">=</span> <span class="bu">Random</span>.<span class="fu">default_rng</span>()</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>sampler <span class="op">=</span> <span class="fu">MALA</span>(<span class="fl">1</span>, I)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>state <span class="op">=</span> <span class="fu">MALAState</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)))</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>x_next, state_next <span class="op">=</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    rng,</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    AbstractMCMC.<span class="fu">LogDensityModel</span>(model),</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    state</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>(MALASample{Vector{Float64}}([0.0, 0.0, 0.0]), MALAState{Vector{Float64}}([0.0, 0.0, 0.0]))</code></pre>
</div>
</div>
<p>Great, it works!</p>
<p>And I promised we would get quite some functionality for free if we implemented <code>AbstractMCMC.step</code>, and so we can now simply call <code>sample</code> to perform standard MCMC sampling:</p>
<div id="28" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform 1000 iterations with our `MALA` sampler.</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; initial_state<span class="op">=</span>state, progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Concatenate into a matrix.</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000 Matrix{Float64}:
 -2.34302   -5.25517  -3.66891  -3.54178  …  -4.89748   -4.19068    -4.77634
  0.413205  -0.26376  -1.58778  -1.7581       0.949752   0.0774685   0.602217
  1.80475    4.43755   5.76483   3.88946      4.59658    5.25363     5.29174</code></pre>
</div>
</div>
<div id="30" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the marginal means and standard deviations.</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -4.99324    1.00158
  0.0100837  1.00517
  4.99367    0.999611</code></pre>
</div>
</div>
<p>Let’s visualize the samples</p>
<div id="32" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">StatsPlots</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">transpose</span>(samples_matrix[<span class="op">:</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">:</span><span class="kw">end</span>]), alpha<span class="op">=</span><span class="fl">0.5</span>, legend<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<!--?xml version="1.0" encoding="utf-8"?-->
<svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" width="672" height="480" viewbox="0 0 2688 1920">
<defs>
  <clippath id="clip290">
    <rect x="0" y="0" width="2688" height="1920"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip290)" d="M0 1920 L2688 1920 L2688 0 L0 0  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip291">
    <rect x="537" y="0" width="1883" height="1883"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip290)" d="M151.747 1800.78 L2640.76 1800.78 L2640.76 47.2441 L151.747 47.2441  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip292">
    <rect x="151" y="47" width="2490" height="1755"></rect>
  </clippath>
</defs>
<polyline clip-path="url(#clip292)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="219.84,1800.78 219.84,47.2441 "></polyline>
<polyline clip-path="url(#clip292)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="807.458,1800.78 807.458,47.2441 "></polyline>
<polyline clip-path="url(#clip292)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1395.08,1800.78 1395.08,47.2441 "></polyline>
<polyline clip-path="url(#clip292)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1982.69,1800.78 1982.69,47.2441 "></polyline>
<polyline clip-path="url(#clip292)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="2570.31,1800.78 2570.31,47.2441 "></polyline>
<polyline clip-path="url(#clip292)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,1517.67 2640.76,1517.67 "></polyline>
<polyline clip-path="url(#clip292)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,1220.95 2640.76,1220.95 "></polyline>
<polyline clip-path="url(#clip292)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,924.218 2640.76,924.218 "></polyline>
<polyline clip-path="url(#clip292)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,627.49 2640.76,627.49 "></polyline>
<polyline clip-path="url(#clip292)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,330.763 2640.76,330.763 "></polyline>
<polyline clip-path="url(#clip290)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1800.78 2640.76,1800.78 "></polyline>
<polyline clip-path="url(#clip290)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="219.84,1800.78 219.84,1781.88 "></polyline>
<polyline clip-path="url(#clip290)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="807.458,1800.78 807.458,1781.88 "></polyline>
<polyline clip-path="url(#clip290)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1395.08,1800.78 1395.08,1781.88 "></polyline>
<polyline clip-path="url(#clip290)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1982.69,1800.78 1982.69,1781.88 "></polyline>
<polyline clip-path="url(#clip290)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="2570.31,1800.78 2570.31,1781.88 "></polyline>
<path clip-path="url(#clip290)" d="M219.84 1834 Q216.229 1834 214.4 1837.57 Q212.595 1841.11 212.595 1848.24 Q212.595 1855.34 214.4 1858.91 Q216.229 1862.45 219.84 1862.45 Q223.474 1862.45 225.28 1858.91 Q227.108 1855.34 227.108 1848.24 Q227.108 1841.11 225.28 1837.57 Q223.474 1834 219.84 1834 M219.84 1830.3 Q225.65 1830.3 228.706 1834.9 Q231.784 1839.49 231.784 1848.24 Q231.784 1856.96 228.706 1861.57 Q225.65 1866.15 219.84 1866.15 Q214.03 1866.15 210.951 1861.57 Q207.896 1856.96 207.896 1848.24 Q207.896 1839.49 210.951 1834.9 Q214.03 1830.3 219.84 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip290)" d="M771.15 1861.55 L787.47 1861.55 L787.47 1865.48 L765.525 1865.48 L765.525 1861.55 Q768.187 1858.79 772.771 1854.16 Q777.377 1849.51 778.558 1848.17 Q780.803 1845.65 781.683 1843.91 Q782.585 1842.15 782.585 1840.46 Q782.585 1837.71 780.641 1835.97 Q778.72 1834.23 775.618 1834.23 Q773.419 1834.23 770.965 1835 Q768.535 1835.76 765.757 1837.31 L765.757 1832.59 Q768.581 1831.46 771.035 1830.88 Q773.488 1830.3 775.525 1830.3 Q780.896 1830.3 784.09 1832.98 Q787.285 1835.67 787.285 1840.16 Q787.285 1842.29 786.474 1844.21 Q785.687 1846.11 783.581 1848.7 Q783.002 1849.37 779.9 1852.59 Q776.798 1855.78 771.15 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip290)" d="M797.331 1830.92 L815.687 1830.92 L815.687 1834.86 L801.613 1834.86 L801.613 1843.33 Q802.632 1842.98 803.65 1842.82 Q804.669 1842.64 805.687 1842.64 Q811.474 1842.64 814.854 1845.81 Q818.233 1848.98 818.233 1854.4 Q818.233 1859.97 814.761 1863.08 Q811.289 1866.15 804.97 1866.15 Q802.794 1866.15 800.525 1865.78 Q798.28 1865.41 795.872 1864.67 L795.872 1859.97 Q797.956 1861.11 800.178 1861.66 Q802.4 1862.22 804.877 1862.22 Q808.882 1862.22 811.22 1860.11 Q813.558 1858.01 813.558 1854.4 Q813.558 1850.78 811.22 1848.68 Q808.882 1846.57 804.877 1846.57 Q803.002 1846.57 801.127 1846.99 Q799.275 1847.4 797.331 1848.28 L797.331 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip290)" d="M837.446 1834 Q833.835 1834 832.007 1837.57 Q830.201 1841.11 830.201 1848.24 Q830.201 1855.34 832.007 1858.91 Q833.835 1862.45 837.446 1862.45 Q841.081 1862.45 842.886 1858.91 Q844.715 1855.34 844.715 1848.24 Q844.715 1841.11 842.886 1837.57 Q841.081 1834 837.446 1834 M837.446 1830.3 Q843.256 1830.3 846.312 1834.9 Q849.391 1839.49 849.391 1848.24 Q849.391 1856.96 846.312 1861.57 Q843.256 1866.15 837.446 1866.15 Q831.636 1866.15 828.557 1861.57 Q825.502 1856.96 825.502 1848.24 Q825.502 1839.49 828.557 1834.9 Q831.636 1830.3 837.446 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip290)" d="M1354.69 1830.92 L1373.05 1830.92 L1373.05 1834.86 L1358.98 1834.86 L1358.98 1843.33 Q1360 1842.98 1361.01 1842.82 Q1362.03 1842.64 1363.05 1842.64 Q1368.84 1842.64 1372.22 1845.81 Q1375.6 1848.98 1375.6 1854.4 Q1375.6 1859.97 1372.12 1863.08 Q1368.65 1866.15 1362.33 1866.15 Q1360.16 1866.15 1357.89 1865.78 Q1355.64 1865.41 1353.24 1864.67 L1353.24 1859.97 Q1355.32 1861.11 1357.54 1861.66 Q1359.76 1862.22 1362.24 1862.22 Q1366.25 1862.22 1368.58 1860.11 Q1370.92 1858.01 1370.92 1854.4 Q1370.92 1850.78 1368.58 1848.68 Q1366.25 1846.57 1362.24 1846.57 Q1360.37 1846.57 1358.49 1846.99 Q1356.64 1847.4 1354.69 1848.28 L1354.69 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip290)" d="M1394.81 1834 Q1391.2 1834 1389.37 1837.57 Q1387.56 1841.11 1387.56 1848.24 Q1387.56 1855.34 1389.37 1858.91 Q1391.2 1862.45 1394.81 1862.45 Q1398.44 1862.45 1400.25 1858.91 Q1402.08 1855.34 1402.08 1848.24 Q1402.08 1841.11 1400.25 1837.57 Q1398.44 1834 1394.81 1834 M1394.81 1830.3 Q1400.62 1830.3 1403.68 1834.9 Q1406.75 1839.49 1406.75 1848.24 Q1406.75 1856.96 1403.68 1861.57 Q1400.62 1866.15 1394.81 1866.15 Q1389 1866.15 1385.92 1861.57 Q1382.87 1856.96 1382.87 1848.24 Q1382.87 1839.49 1385.92 1834.9 Q1389 1830.3 1394.81 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip290)" d="M1424.97 1834 Q1421.36 1834 1419.53 1837.57 Q1417.73 1841.11 1417.73 1848.24 Q1417.73 1855.34 1419.53 1858.91 Q1421.36 1862.45 1424.97 1862.45 Q1428.61 1862.45 1430.41 1858.91 Q1432.24 1855.34 1432.24 1848.24 Q1432.24 1841.11 1430.41 1837.57 Q1428.61 1834 1424.97 1834 M1424.97 1830.3 Q1430.78 1830.3 1433.84 1834.9 Q1436.92 1839.49 1436.92 1848.24 Q1436.92 1856.96 1433.84 1861.57 Q1430.78 1866.15 1424.97 1866.15 Q1419.16 1866.15 1416.08 1861.57 Q1413.03 1856.96 1413.03 1848.24 Q1413.03 1839.49 1416.08 1834.9 Q1419.16 1830.3 1424.97 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip290)" d="M1940.97 1830.92 L1963.19 1830.92 L1963.19 1832.91 L1950.65 1865.48 L1945.76 1865.48 L1957.57 1834.86 L1940.97 1834.86 L1940.97 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip290)" d="M1972.36 1830.92 L1990.71 1830.92 L1990.71 1834.86 L1976.64 1834.86 L1976.64 1843.33 Q1977.66 1842.98 1978.68 1842.82 Q1979.7 1842.64 1980.72 1842.64 Q1986.5 1842.64 1989.88 1845.81 Q1993.26 1848.98 1993.26 1854.4 Q1993.26 1859.97 1989.79 1863.08 Q1986.32 1866.15 1980 1866.15 Q1977.82 1866.15 1975.55 1865.78 Q1973.31 1865.41 1970.9 1864.67 L1970.9 1859.97 Q1972.98 1861.11 1975.21 1861.66 Q1977.43 1862.22 1979.9 1862.22 Q1983.91 1862.22 1986.25 1860.11 Q1988.59 1858.01 1988.59 1854.4 Q1988.59 1850.78 1986.25 1848.68 Q1983.91 1846.57 1979.9 1846.57 Q1978.03 1846.57 1976.15 1846.99 Q1974.3 1847.4 1972.36 1848.28 L1972.36 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip290)" d="M2012.47 1834 Q2008.86 1834 2007.03 1837.57 Q2005.23 1841.11 2005.23 1848.24 Q2005.23 1855.34 2007.03 1858.91 Q2008.86 1862.45 2012.47 1862.45 Q2016.11 1862.45 2017.91 1858.91 Q2019.74 1855.34 2019.74 1848.24 Q2019.74 1841.11 2017.91 1837.57 Q2016.11 1834 2012.47 1834 M2012.47 1830.3 Q2018.28 1830.3 2021.34 1834.9 Q2024.42 1839.49 2024.42 1848.24 Q2024.42 1856.96 2021.34 1861.57 Q2018.28 1866.15 2012.47 1866.15 Q2006.66 1866.15 2003.59 1861.57 Q2000.53 1856.96 2000.53 1848.24 Q2000.53 1839.49 2003.59 1834.9 Q2006.66 1830.3 2012.47 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip290)" d="M2514.84 1861.55 L2522.48 1861.55 L2522.48 1835.18 L2514.17 1836.85 L2514.17 1832.59 L2522.43 1830.92 L2527.11 1830.92 L2527.11 1861.55 L2534.75 1861.55 L2534.75 1865.48 L2514.84 1865.48 L2514.84 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip290)" d="M2554.19 1834 Q2550.58 1834 2548.75 1837.57 Q2546.94 1841.11 2546.94 1848.24 Q2546.94 1855.34 2548.75 1858.91 Q2550.58 1862.45 2554.19 1862.45 Q2557.82 1862.45 2559.63 1858.91 Q2561.46 1855.34 2561.46 1848.24 Q2561.46 1841.11 2559.63 1837.57 Q2557.82 1834 2554.19 1834 M2554.19 1830.3 Q2560 1830.3 2563.06 1834.9 Q2566.13 1839.49 2566.13 1848.24 Q2566.13 1856.96 2563.06 1861.57 Q2560 1866.15 2554.19 1866.15 Q2548.38 1866.15 2545.3 1861.57 Q2542.25 1856.96 2542.25 1848.24 Q2542.25 1839.49 2545.3 1834.9 Q2548.38 1830.3 2554.19 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip290)" d="M2584.35 1834 Q2580.74 1834 2578.91 1837.57 Q2577.11 1841.11 2577.11 1848.24 Q2577.11 1855.34 2578.91 1858.91 Q2580.74 1862.45 2584.35 1862.45 Q2587.99 1862.45 2589.79 1858.91 Q2591.62 1855.34 2591.62 1848.24 Q2591.62 1841.11 2589.79 1837.57 Q2587.99 1834 2584.35 1834 M2584.35 1830.3 Q2590.16 1830.3 2593.22 1834.9 Q2596.3 1839.49 2596.3 1848.24 Q2596.3 1856.96 2593.22 1861.57 Q2590.16 1866.15 2584.35 1866.15 Q2578.54 1866.15 2575.46 1861.57 Q2572.41 1856.96 2572.41 1848.24 Q2572.41 1839.49 2575.46 1834.9 Q2578.54 1830.3 2584.35 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip290)" d="M2614.51 1834 Q2610.9 1834 2609.07 1837.57 Q2607.27 1841.11 2607.27 1848.24 Q2607.27 1855.34 2609.07 1858.91 Q2610.9 1862.45 2614.51 1862.45 Q2618.15 1862.45 2619.95 1858.91 Q2621.78 1855.34 2621.78 1848.24 Q2621.78 1841.11 2619.95 1837.57 Q2618.15 1834 2614.51 1834 M2614.51 1830.3 Q2620.32 1830.3 2623.38 1834.9 Q2626.46 1839.49 2626.46 1848.24 Q2626.46 1856.96 2623.38 1861.57 Q2620.32 1866.15 2614.51 1866.15 Q2608.7 1866.15 2605.62 1861.57 Q2602.57 1856.96 2602.57 1848.24 Q2602.57 1839.49 2605.62 1834.9 Q2608.7 1830.3 2614.51 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip290)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1800.78 151.747,47.2441 "></polyline>
<polyline clip-path="url(#clip290)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1517.67 170.644,1517.67 "></polyline>
<polyline clip-path="url(#clip290)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1220.95 170.644,1220.95 "></polyline>
<polyline clip-path="url(#clip290)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,924.218 170.644,924.218 "></polyline>
<polyline clip-path="url(#clip290)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,627.49 170.644,627.49 "></polyline>
<polyline clip-path="url(#clip290)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,330.763 170.644,330.763 "></polyline>
<path clip-path="url(#clip290)" d="M49.5521 1518.12 L79.2279 1518.12 L79.2279 1522.06 L49.5521 1522.06 L49.5521 1518.12 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip290)" d="M99.8991 1515.81 Q96.7509 1515.81 94.8991 1517.96 Q93.0704 1520.12 93.0704 1523.87 Q93.0704 1527.59 94.8991 1529.77 Q96.7509 1531.92 99.8991 1531.92 Q103.047 1531.92 104.876 1529.77 Q106.728 1527.59 106.728 1523.87 Q106.728 1520.12 104.876 1517.96 Q103.047 1515.81 99.8991 1515.81 M109.181 1501.16 L109.181 1505.42 Q107.422 1504.58 105.617 1504.14 Q103.834 1503.7 102.075 1503.7 Q97.4454 1503.7 94.9917 1506.83 Q92.5612 1509.95 92.2139 1516.27 Q93.5797 1514.26 95.6398 1513.19 Q97.7 1512.11 100.177 1512.11 Q105.385 1512.11 108.394 1515.28 Q111.427 1518.43 111.427 1523.87 Q111.427 1529.19 108.279 1532.41 Q105.131 1535.62 99.8991 1535.62 Q93.9037 1535.62 90.7325 1531.04 Q87.5612 1526.43 87.5612 1517.71 Q87.5612 1509.51 91.45 1504.65 Q95.3389 1499.77 101.89 1499.77 Q103.649 1499.77 105.431 1500.12 Q107.237 1500.46 109.181 1501.16 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip290)" d="M50.3623 1221.4 L80.0381 1221.4 L80.0381 1225.33 L50.3623 1225.33 L50.3623 1221.4 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip290)" d="M104.297 1219.59 Q107.654 1220.31 109.529 1222.58 Q111.427 1224.85 111.427 1228.18 Q111.427 1233.29 107.908 1236.1 Q104.39 1238.9 97.9083 1238.9 Q95.7324 1238.9 93.4176 1238.46 Q91.126 1238.04 88.6723 1237.18 L88.6723 1232.67 Q90.6167 1233.8 92.9315 1234.38 Q95.2463 1234.96 97.7695 1234.96 Q102.168 1234.96 104.459 1233.23 Q106.774 1231.49 106.774 1228.18 Q106.774 1225.12 104.621 1223.41 Q102.492 1221.67 98.6722 1221.67 L94.6445 1221.67 L94.6445 1217.83 L98.8574 1217.83 Q102.306 1217.83 104.135 1216.47 Q105.964 1215.08 105.964 1212.48 Q105.964 1209.82 104.066 1208.41 Q102.191 1206.98 98.6722 1206.98 Q96.7509 1206.98 94.5519 1207.39 Q92.3528 1207.81 89.7139 1208.69 L89.7139 1204.52 Q92.376 1203.78 94.6908 1203.41 Q97.0287 1203.04 99.0889 1203.04 Q104.413 1203.04 107.515 1205.47 Q110.617 1207.88 110.617 1212 Q110.617 1214.87 108.973 1216.86 Q107.33 1218.83 104.297 1219.59 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip290)" d="M99.4824 910.017 Q95.8713 910.017 94.0426 913.581 Q92.2371 917.123 92.2371 924.253 Q92.2371 931.359 94.0426 934.924 Q95.8713 938.465 99.4824 938.465 Q103.117 938.465 104.922 934.924 Q106.751 931.359 106.751 924.253 Q106.751 917.123 104.922 913.581 Q103.117 910.017 99.4824 910.017 M99.4824 906.313 Q105.293 906.313 108.348 910.919 Q111.427 915.503 111.427 924.253 Q111.427 932.979 108.348 937.586 Q105.293 942.169 99.4824 942.169 Q93.6723 942.169 90.5936 937.586 Q87.538 932.979 87.538 924.253 Q87.538 915.503 90.5936 910.919 Q93.6723 906.313 99.4824 906.313 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip290)" d="M104.297 626.136 Q107.654 626.854 109.529 629.122 Q111.427 631.391 111.427 634.724 Q111.427 639.84 107.908 642.641 Q104.39 645.442 97.9083 645.442 Q95.7324 645.442 93.4176 645.002 Q91.126 644.585 88.6723 643.729 L88.6723 639.215 Q90.6167 640.349 92.9315 640.928 Q95.2463 641.506 97.7695 641.506 Q102.168 641.506 104.459 639.77 Q106.774 638.034 106.774 634.724 Q106.774 631.668 104.621 629.956 Q102.492 628.219 98.6722 628.219 L94.6445 628.219 L94.6445 624.377 L98.8574 624.377 Q102.306 624.377 104.135 623.011 Q105.964 621.622 105.964 619.03 Q105.964 616.368 104.066 614.956 Q102.191 613.52 98.6722 613.52 Q96.7509 613.52 94.5519 613.937 Q92.3528 614.354 89.7139 615.233 L89.7139 611.067 Q92.376 610.326 94.6908 609.956 Q97.0287 609.585 99.0889 609.585 Q104.413 609.585 107.515 612.016 Q110.617 614.423 110.617 618.544 Q110.617 621.414 108.973 623.405 Q107.33 625.372 104.297 626.136 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip290)" d="M99.8991 328.899 Q96.7509 328.899 94.8991 331.052 Q93.0704 333.205 93.0704 336.955 Q93.0704 340.682 94.8991 342.858 Q96.7509 345.01 99.8991 345.01 Q103.047 345.01 104.876 342.858 Q106.728 340.682 106.728 336.955 Q106.728 333.205 104.876 331.052 Q103.047 328.899 99.8991 328.899 M109.181 314.247 L109.181 318.506 Q107.422 317.672 105.617 317.233 Q103.834 316.793 102.075 316.793 Q97.4454 316.793 94.9917 319.918 Q92.5612 323.043 92.2139 329.362 Q93.5797 327.348 95.6398 326.284 Q97.7 325.196 100.177 325.196 Q105.385 325.196 108.394 328.367 Q111.427 331.515 111.427 336.955 Q111.427 342.279 108.279 345.496 Q105.131 348.714 99.8991 348.714 Q93.9037 348.714 90.7325 344.131 Q87.5612 339.524 87.5612 330.797 Q87.5612 322.603 91.45 317.742 Q95.3389 312.858 101.89 312.858 Q103.649 312.858 105.431 313.205 Q107.237 313.552 109.181 314.247 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip292)" style="stroke:#009af9; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,1155.96 224.541,1374.23 226.891,1520.08 229.242,1368.92 231.592,1490.81 233.943,1416.41 236.293,1563.31 238.644,1412.29 240.994,1297.66 243.345,1454.7 245.695,1470.46 248.046,1550.18 250.396,1327.27 252.747,1337.48 255.097,1485.8 257.448,1308.86 259.798,1534.01 262.148,1419.3 264.499,1390.1 266.849,1371.25 269.2,1244.6 271.55,1339.49 273.901,1623.83 276.251,1605.88 278.602,1537.7 280.952,1450.36 283.303,1445.71 285.653,1488.16 288.004,1529.36 290.354,1502.27 292.705,1547.16 295.055,1413.91 297.406,1539.98 299.756,1459.08 302.107,1280.89 304.457,1476.33 306.807,1560.7 309.158,1551.97 311.508,1462.04 313.859,1308.61 316.209,1526.13 318.56,1348.61 320.91,1392.16 323.261,1499.52 325.611,1469.5 327.962,1348.67 330.312,1455.53 332.663,1227.62 335.013,1368.13 337.364,1404.62 339.714,1310.16 342.065,1180.92 344.415,1455.48 346.765,1510.73 349.116,1346.04 351.466,1352.25 353.817,1442.19 356.167,1479.84 358.518,1471.34 360.868,1586.4 363.219,1537.85 365.569,1608.14 367.92,1510.17 370.27,1371.88 372.621,1251.01 374.971,1388.12 377.322,1457.75 379.672,1318.6 382.023,1434.18 384.373,1560.34 386.724,1461.76 389.074,1261.01 391.424,1360.38 393.775,1363.57 396.125,1512.96 398.476,1418.65 400.826,1334.71 403.177,1582.88 405.527,1451.59 407.878,1377.56 410.228,1400.37 412.579,1451.62 414.929,1528.35 417.28,1420.27 419.63,1342.06 421.981,1398.65 424.331,1538.32 426.682,1424.98 429.032,1420.61 431.382,1372.12 433.733,1344.84 436.083,1425.54 438.434,1505.87 440.784,1287.53 443.135,1350.02 445.485,1547.41 447.836,1402.05 450.186,1380.33 452.537,1269.36 454.887,1455.3 457.238,1448.1 459.588,1376.09 461.939,1365.21 464.289,1445.71 466.64,1409.82 468.99,1330.68 471.341,1508.82 473.691,1375.92 476.041,1377.47 478.392,1459.81 480.742,1639.91 483.093,1399.88 485.443,1358.7 487.794,1563.97 490.144,1300.6 492.495,1439.1 494.845,1267.98 497.196,1433.79 499.546,1358.29 501.897,1358.57 504.247,1382.14 506.598,1480.49 508.948,1247.57 511.299,1372.54 513.649,1462.19 515.999,1257.36 518.35,1487.02 520.7,1468.64 523.051,1425.62 525.401,1623.08 527.752,1444.86 530.102,1527.46 532.453,1495.45 534.803,1448.94 537.154,1383.56 539.504,1240.73 541.855,1387.27 544.205,1441.12 546.556,1396.36 548.906,1575.48 551.257,1603.28 553.607,1526.84 555.958,1561.36 558.308,1302.49 560.658,1376.39 563.009,1456.4 565.359,1212.41 567.71,1495.01 570.06,1420.77 572.411,1615.05 574.761,1529.6 577.112,1444.08 579.462,1495.59 581.813,1466.11 584.163,1383.43 586.514,1360.84 588.864,1284.89 591.215,1458.37 593.565,1386.71 595.916,1339.79 598.266,1541.4 600.616,1303.46 602.967,1283.09 605.317,1314.53 607.668,1418.25 610.018,1391.88 612.369,1436.8 614.719,1525.17 617.07,1446.32 619.42,1484.44 621.771,1319.6 624.121,1314.67 626.472,1412.44 628.822,1372.48 631.173,1657.71 633.523,1466.39 635.874,1345.13 638.224,1562.67 640.575,1333.37 642.925,1233.71 645.275,1218.63 647.626,1751.15 649.976,1332.4 652.327,1614.13 654.677,1374.8 657.028,1400.62 659.378,1274.87 661.729,1231.23 664.079,1298.32 666.43,1466.22 668.78,1450.98 671.131,1381.21 673.481,1278.28 675.832,1550.32 678.182,1597.22 680.533,1391.85 682.883,1355.19 685.233,1455.33 687.584,1545.35 689.934,1427.69 692.285,1445.43 694.635,1469.57 696.986,1515.37 699.336,1547.56 701.687,1498.81 704.037,1615.17 706.388,1344.32 708.738,1336.38 711.089,1518.33 713.439,1415.59 715.79,1414.68 718.14,1306.32 720.491,1628.37 722.841,1395.78 725.192,1549.59 727.542,1362.6 729.892,1568.24 732.243,1436.42 734.593,1381.17 736.944,1416.46 739.294,1307.18 741.645,1282.84 743.995,1316.7 746.346,1476.09 748.696,1595.86 751.047,1511.96 753.397,1457.08 755.748,1264.91 758.098,1458.25 760.449,1082.48 762.799,1424.36 765.15,1501.19 767.5,1404.56 769.85,1435.94 772.201,1322.17 774.551,1547.26 776.902,1358.4 779.252,1614.83 781.603,1303.21 783.953,1368.1 786.304,1481.23 788.654,1288.08 791.005,1461.99 793.355,1418.99 795.706,1440.64 798.056,1479.09 800.407,1401.19 802.757,1327.95 805.108,1525.43 807.458,1406.57 809.809,1348.91 812.159,1426.95 814.509,1368.38 816.86,1485.24 819.21,1469.86 821.561,1326.24 823.911,1268.94 826.262,1469.59 828.612,1345.66 830.963,1402.58 833.313,1385.37 835.664,1121.36 838.014,1471.29 840.365,1446.45 842.715,1577.54 845.066,1564.52 847.416,1527.05 849.767,1614.99 852.117,1429.5 854.467,1555.57 856.818,1401.77 859.168,1281.04 861.519,1610.42 863.869,1619.97 866.22,1345.36 868.57,1447.47 870.921,1427.32 873.271,1212.85 875.622,1522.94 877.972,1278.12 880.323,1514.85 882.673,1396.84 885.024,1434.03 887.374,1409.34 889.725,1349.97 892.075,1205.98 894.426,1613.15 896.776,1491.13 899.126,1496.04 901.477,1525.02 903.827,1440.15 906.178,1371.49 908.528,1351.26 910.879,1527.67 913.229,1345.98 915.58,1218.49 917.93,1474.72 920.281,1512.24 922.631,1413 924.982,1395.65 927.332,1488.06 929.683,1485.09 932.033,1258.16 934.384,1328.08 936.734,1389.42 939.084,1441.57 941.435,1444.63 943.785,1233.61 946.136,1244.72 948.486,1340.91 950.837,1409.6 953.187,1447.67 955.538,1379.97 957.888,1471.55 960.239,1485.48 962.589,1505.26 964.94,1584.36 967.29,1288.16 969.641,1564.27 971.991,1327.73 974.342,1365.07 976.692,1440.42 979.043,1423.37 981.393,1482.26 983.743,1499.31 986.094,1262.46 988.444,1569.79 990.795,1290.64 993.145,1613.87 995.496,1402.51 997.846,1295.32 1000.2,1417.32 1002.55,1630.42 1004.9,1391.45 1007.25,1332.02 1009.6,1371.7 1011.95,1454.77 1014.3,1270.65 1016.65,1506.04 1019,1498.27 1021.35,1373.29 1023.7,1438.3 1026.05,1418.2 1028.4,1390.8 1030.75,1387.22 1033.1,1439.29 1035.45,1547.29 1037.8,1428.39 1040.15,1487.4 1042.51,1517.27 1044.86,1416.16 1047.21,1514.69 1049.56,1291.13 1051.91,1481.97 1054.26,1444.35 1056.61,1450.67 1058.96,1523.01 1061.31,1333.45 1063.66,1378.47 1066.01,1564.19 1068.36,1279.59 1070.71,1384.25 1073.06,1245.32 1075.41,1189.46 1077.76,1380.89 1080.11,1383.72 1082.46,1439.04 1084.81,1324.18 1087.16,1176.59 1089.51,1386.43 1091.87,1518.59 1094.22,1543.31 1096.57,1392.01 1098.92,1453.25 1101.27,1396.16 1103.62,1358.2 1105.97,1368.27 1108.32,1462.31 1110.67,1303.25 1113.02,1399.26 1115.37,1253.83 1117.72,1415.34 1120.07,1414.87 1122.42,1513.39 1124.77,1405.79 1127.12,1471.62 1129.47,1511.62 1131.82,1386.3 1134.17,1435.73 1136.52,1393.01 1138.87,1354.75 1141.23,1379.94 1143.58,1236.86 1145.93,1437.2 1148.28,1492.52 1150.63,1515.09 1152.98,1417.19 1155.33,1490.23 1157.68,1289.38 1160.03,1468.73 1162.38,1283.64 1164.73,1485.43 1167.08,1516.83 1169.43,1475.04 1171.78,1526.92 1174.13,1307.22 1176.48,1461.97 1178.83,1515.47 1181.18,1337.35 1183.53,1463.02 1185.88,1385.91 1188.23,1501.36 1190.59,1320.64 1192.94,1256.22 1195.29,1455.96 1197.64,1547.68 1199.99,1492.7 1202.34,1462.36 1204.69,1288.19 1207.04,1558.61 1209.39,1240.14 1211.74,1484.02 1214.09,1355.97 1216.44,1467.32 1218.79,1322 1221.14,1460.12 1223.49,1403.77 1225.84,1338.1 1228.19,1504.73 1230.54,1466.41 1232.89,1369.49 1235.24,1436.84 1237.59,1491.47 1239.94,1399.92 1242.3,1408.43 1244.65,1181.6 1247,1322.71 1249.35,1422.76 1251.7,1267.63 1254.05,1522.36 1256.4,1309.96 1258.75,1396.05 1261.1,1288.53 1263.45,1553.7 1265.8,1556.08 1268.15,1154.62 1270.5,1459.73 1272.85,1349.02 1275.2,1358.38 1277.55,1377.91 1279.9,1394.22 1282.25,1373.87 1284.6,1480.65 1286.95,1551.47 1289.3,1534.33 1291.66,1577.84 1294.01,1245.78 1296.36,1587.8 1298.71,1445.92 1301.06,1508.16 1303.41,1533.64 1305.76,1454.47 1308.11,1450.96 1310.46,1420.77 1312.81,1535.82 1315.16,1476.49 1317.51,1614.43 1319.86,1312.66 1322.21,1303.06 1324.56,1393.27 1326.91,1489.35 1329.26,1456.32 1331.61,1446.45 1333.96,1498.37 1336.31,1402.85 1338.66,1536.06 1341.02,1213.41 1343.37,1282.96 1345.72,1423.28 1348.07,1366.73 1350.42,1258.1 1352.77,1438.99 1355.12,1459.25 1357.47,1394.94 1359.82,1495.5 1362.17,1464.45 1364.52,1527.99 1366.87,1376.38 1369.22,1398.85 1371.57,1498.44 1373.92,1439.11 1376.27,1456.28 1378.62,1493.87 1380.97,1280.3 1383.32,1384.81 1385.67,1573.81 1388.02,1292 1390.38,1426.59 1392.73,1457.77 1395.08,1462.53 1397.43,1414.39 1399.78,1472.86 1402.13,1360.81 1404.48,1462.67 1406.83,1298.79 1409.18,1497.52 1411.53,1284 1413.88,1491.39 1416.23,1392.24 1418.58,1224.45 1420.93,1295.99 1423.28,1350.16 1425.63,1432.85 1427.98,1542.27 1430.33,1560.6 1432.68,1478.14 1435.03,1473.32 1437.38,1489.7 1439.74,1674.64 1442.09,1406.55 1444.44,1420.88 1446.79,1488.13 1449.14,1520.53 1451.49,1387.3 1453.84,1422.22 1456.19,1348.85 1458.54,1530.81 1460.89,1450.48 1463.24,1369.3 1465.59,1298.38 1467.94,1520.99 1470.29,1446.15 1472.64,1119.65 1474.99,1533.13 1477.34,1233.07 1479.69,1467.55 1482.04,1466.93 1484.39,1573.89 1486.74,1389.96 1489.1,1520.61 1491.45,1191.42 1493.8,1553.07 1496.15,1454.8 1498.5,1469.48 1500.85,1543.61 1503.2,1519.17 1505.55,1415.69 1507.9,1611.1 1510.25,1346.31 1512.6,1417.75 1514.95,1282.47 1517.3,1420.09 1519.65,1403.32 1522,1396.1 1524.35,1367.61 1526.7,1509.62 1529.05,1311.34 1531.4,1505.84 1533.75,1466.28 1536.1,1515.61 1538.45,1402.57 1540.81,1467.11 1543.16,1400.17 1545.51,1511.55 1547.86,1344.54 1550.21,1606.79 1552.56,1472.16 1554.91,1535.95 1557.26,1302.59 1559.61,1351.48 1561.96,1529.25 1564.31,1466.18 1566.66,1399.31 1569.01,1345.68 1571.36,1494.08 1573.71,1449.43 1576.06,1413.49 1578.41,1379.98 1580.76,1202.82 1583.11,1366.8 1585.46,1576.49 1587.81,1470.09 1590.17,1339.17 1592.52,1500.47 1594.87,1309.6 1597.22,1324.59 1599.57,1416.35 1601.92,1425.86 1604.27,1493.48 1606.62,1542.64 1608.97,1467.93 1611.32,1463.77 1613.67,1383.81 1616.02,1461.72 1618.37,1339.33 1620.72,1444.9 1623.07,1206.71 1625.42,1649.8 1627.77,1448.4 1630.12,1514.21 1632.47,1509.54 1634.82,1489.74 1637.17,1611.32 1639.53,1484.1 1641.88,1520.34 1644.23,1537.12 1646.58,1565.25 1648.93,1523 1651.28,1604.95 1653.63,1541.14 1655.98,1217.11 1658.33,1391.66 1660.68,1296.1 1663.03,1559.86 1665.38,1448.38 1667.73,1392.93 1670.08,1407.88 1672.43,1490.85 1674.78,1402.49 1677.13,1390.63 1679.48,1540.43 1681.83,1343.35 1684.18,1488.42 1686.53,1281.39 1688.89,1387.88 1691.24,1442.19 1693.59,1327.88 1695.94,1474.1 1698.29,1388.92 1700.64,1469.12 1702.99,1385.52 1705.34,1417.09 1707.69,1508.41 1710.04,1389.85 1712.39,1560.2 1714.74,1401.14 1717.09,1519.48 1719.44,1460.86 1721.79,1298.95 1724.14,1477.07 1726.49,1199.04 1728.84,1389.9 1731.19,1560.84 1733.54,1420.1 1735.89,1435.46 1738.25,1412.13 1740.6,1411.7 1742.95,1355.76 1745.3,1261.13 1747.65,1594.39 1750,1458.03 1752.35,1399.48 1754.7,1464.37 1757.05,1532.52 1759.4,1427.92 1761.75,1500.65 1764.1,1423.08 1766.45,1442.54 1768.8,1219.02 1771.15,1388.78 1773.5,1493.6 1775.85,1562.77 1778.2,1466.28 1780.55,1249.28 1782.9,1421.26 1785.25,1430.96 1787.6,1323.09 1789.96,1243.75 1792.31,1223.11 1794.66,1504.25 1797.01,1506.41 1799.36,1179.44 1801.71,1601.94 1804.06,1408.34 1806.41,1341.56 1808.76,1195.88 1811.11,1362.57 1813.46,1257.85 1815.81,1441.58 1818.16,1416.33 1820.51,1388.51 1822.86,1441.77 1825.21,1498.23 1827.56,1349.56 1829.91,1438.8 1832.26,1467.17 1834.61,1508.72 1836.96,1426.15 1839.32,1325.44 1841.67,1478.6 1844.02,1503.23 1846.37,1357.94 1848.72,1321.97 1851.07,1435.33 1853.42,1197.67 1855.77,1403.63 1858.12,1431.49 1860.47,1401.73 1862.82,1614.03 1865.17,1490.71 1867.52,1278.94 1869.87,1461.14 1872.22,1489.32 1874.57,1523.57 1876.92,1425.37 1879.27,1201.46 1881.62,1362.76 1883.97,1471.09 1886.32,1342.6 1888.68,1466.16 1891.03,1453.64 1893.38,1467.71 1895.73,1374.54 1898.08,1397.99 1900.43,1588.93 1902.78,1312.12 1905.13,1545.25 1907.48,1530.36 1909.83,1320.93 1912.18,1556.29 1914.53,1463.8 1916.88,1488.25 1919.23,1357.61 1921.58,1376.76 1923.93,1442.06 1926.28,1420.5 1928.63,1405.56 1930.98,1445.22 1933.33,1486.72 1935.68,1304.21 1938.04,1220.39 1940.39,1469.11 1942.74,1488.34 1945.09,1413.39 1947.44,1401.44 1949.79,1322.18 1952.14,1369.07 1954.49,1420.51 1956.84,1294.57 1959.19,1452.88 1961.54,1636.4 1963.89,1423.33 1966.24,1501.59 1968.59,1335.79 1970.94,1376.67 1973.29,1450.11 1975.64,1371.62 1977.99,1386.64 1980.34,1388.34 1982.69,1292.81 1985.04,1289.17 1987.4,1186.01 1989.75,1466.46 1992.1,1533.91 1994.45,1450.57 1996.8,1323.01 1999.15,1413.24 2001.5,1351.35 2003.85,1475.74 2006.2,1547.48 2008.55,1445.16 2010.9,1404.26 2013.25,1419.11 2015.6,1543.25 2017.95,1313.31 2020.3,1386.5 2022.65,1404.21 2025,1286.72 2027.35,1396.17 2029.7,1259.55 2032.05,1573.39 2034.4,1530.91 2036.76,1484.3 2039.11,1384.64 2041.46,1574.53 2043.81,1466.36 2046.16,1466.02 2048.51,1523.77 2050.86,1191.84 2053.21,1410.68 2055.56,1442.18 2057.91,1410.03 2060.26,1418.04 2062.61,1521.39 2064.96,1561.88 2067.31,1403.09 2069.66,1276.74 2072.01,1404 2074.36,1152.08 2076.71,1554.35 2079.06,1506.19 2081.41,1373.35 2083.76,1555.6 2086.11,1304.06 2088.47,1575.07 2090.82,1626.25 2093.17,1612.2 2095.52,1419.45 2097.87,1301.34 2100.22,1426.09 2102.57,1530.76 2104.92,1386.43 2107.27,1515.21 2109.62,1576.41 2111.97,1307.58 2114.32,1373.64 2116.67,1363.83 2119.02,1436.42 2121.37,1674.55 2123.72,1493.74 2126.07,1425.27 2128.42,1477.36 2130.77,1338 2133.12,1289.5 2135.47,1425.54 2137.83,1272.56 2140.18,1394.06 2142.53,1433.06 2144.88,1421.65 2147.23,1236.73 2149.58,1365.48 2151.93,1406.7 2154.28,1470.79 2156.63,1453.15 2158.98,1527.77 2161.33,1414.7 2163.68,1442.93 2166.03,1287.47 2168.38,1470.06 2170.73,1484.32 2173.08,1409.02 2175.43,1281.49 2177.78,1373.29 2180.13,1412.38 2182.48,1370.75 2184.83,1473.48 2187.19,1440.7 2189.54,1426.88 2191.89,1440.6 2194.24,1503.27 2196.59,1335.25 2198.94,1469 2201.29,1500.41 2203.64,1286.52 2205.99,1361.37 2208.34,1564.12 2210.69,1270.6 2213.04,1369.91 2215.39,1474.14 2217.74,1383.49 2220.09,1567.66 2222.44,1389.18 2224.79,1486.35 2227.14,1239.04 2229.49,1465.42 2231.84,1522.01 2234.19,1641.7 2236.55,1437.95 2238.9,1251.65 2241.25,1227.78 2243.6,1411.09 2245.95,1540.3 2248.3,1451.94 2250.65,1308.52 2253,1365.93 2255.35,1416.79 2257.7,1429.53 2260.05,1601.04 2262.4,1418.88 2264.75,1313.59 2267.1,1517.56 2269.45,1460.6 2271.8,1480.79 2274.15,1311.47 2276.5,1254.32 2278.85,1568.82 2281.2,1226.41 2283.55,1325.98 2285.91,1335.78 2288.26,1513.89 2290.61,1306.1 2292.96,1504.15 2295.31,1392.54 2297.66,1282.42 2300.01,1423.27 2302.36,1623.34 2304.71,1435.33 2307.06,1489.53 2309.41,1433.31 2311.76,1425.43 2314.11,1273.97 2316.46,1442.69 2318.81,1645.24 2321.16,1511.36 2323.51,1416.14 2325.86,1292.78 2328.21,1507.57 2330.56,1399.58 2332.91,1483.73 2335.27,1444.23 2337.62,1383.57 2339.97,1543.15 2342.32,1552.87 2344.67,1479.52 2347.02,1432.24 2349.37,1467.89 2351.72,1393.84 2354.07,1346.5 2356.42,1344.91 2358.77,1448.8 2361.12,1479.23 2363.47,1434.57 2365.82,1558.39 2368.17,1349.37 2370.52,1306.32 2372.87,1388.13 2375.22,1290.39 2377.57,1533.09 2379.92,1556.9 2382.27,1371.57 2384.62,1396.41 2386.98,1469.13 2389.33,1272.37 2391.68,1495.23 2394.03,1404.65 2396.38,1392.8 2398.73,1549.08 2401.08,1359.6 2403.43,1392.63 2405.78,1564.23 2408.13,1579.84 2410.48,1492.41 2412.83,1521.99 2415.18,1313.05 2417.53,1460.27 2419.88,1241.18 2422.23,1330.75 2424.58,1493.98 2426.93,1265.51 2429.28,1498.94 2431.63,1582.1 2433.98,1366.36 2436.34,1266.93 2438.69,1510.68 2441.04,1380.49 2443.39,1497.04 2445.74,1432.6 2448.09,1345.26 2450.44,1528.94 2452.79,1530.88 2455.14,1478.36 2457.49,1355.04 2459.84,1311.84 2462.19,1295.84 2464.54,1365.88 2466.89,1564.87 2469.24,1560.9 2471.59,1514.9 2473.94,1482.12 2476.29,1290.18 2478.64,1314.85 2480.99,1261.35 2483.34,1328.12 2485.7,1364.37 2488.05,1453.13 2490.4,1485.41 2492.75,1198.52 2495.1,1416.69 2497.45,1387.71 2499.8,1301.24 2502.15,1344.3 2504.5,1450.38 2506.85,1569.28 2509.2,1257.26 2511.55,1416.82 2513.9,1323.47 2516.25,1434.34 2518.6,1427.53 2520.95,1567.83 2523.3,1372.03 2525.65,1562.16 2528,1517.98 2530.35,1445.24 2532.7,1268.99 2535.06,1511.95 2537.41,1351.09 2539.76,1494.11 2542.11,1344.23 2544.46,1499.15 2546.81,1511.45 2549.16,1574.91 2551.51,1384.76 2553.86,1427.29 2556.21,1290.34 2558.56,1318.35 2560.91,1440.23 2563.26,1496.37 2565.61,1441.86 2567.96,1388.06 2570.31,1490.62 "></polyline>
<polyline clip-path="url(#clip292)" style="stroke:#e26f46; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,883.348 224.541,931.297 226.891,919.296 229.242,897.525 231.592,964.721 233.943,876.858 236.293,907.065 238.644,692.367 240.994,951.189 243.345,909.448 245.695,779.832 248.046,1010.33 250.396,925.449 252.747,1220.39 255.097,989.909 257.448,1021.52 259.798,978.856 262.148,880.182 264.499,1015.02 266.849,899.907 269.2,931.536 271.55,803.149 273.901,931.66 276.251,875.353 278.602,871.66 280.952,980.234 283.303,876.662 285.653,1016.1 288.004,684.763 290.354,756.922 292.705,956.47 295.055,828.331 297.406,743.362 299.756,985.962 302.107,949.363 304.457,926.92 306.807,980.272 309.158,954.739 311.508,1082.24 313.859,861.497 316.209,887.403 318.56,943.105 320.91,1009.68 323.261,920.447 325.611,793.718 327.962,1047.12 330.312,899.696 332.663,947.745 335.013,1002.83 337.364,829.28 339.714,813.758 342.065,735.916 344.415,866.547 346.765,879.976 349.116,1106.53 351.466,1046.96 353.817,972.544 356.167,844.746 358.518,862.84 360.868,1182.1 363.219,891.291 365.569,844.507 367.92,927.365 370.27,850.442 372.621,1012.24 374.971,1098.33 377.322,943.368 379.672,1023.24 382.023,740.115 384.373,982.944 386.724,839.433 389.074,887.218 391.424,1008.41 393.775,881.605 396.125,962.685 398.476,994.88 400.826,899.596 403.177,831.712 405.527,974.047 407.878,910.698 410.228,860.485 412.579,1101.06 414.929,941.835 417.28,788.968 419.63,921.52 421.981,892.504 424.331,753.174 426.682,1048.13 429.032,896.192 431.382,906.799 433.733,880.162 436.083,900.738 438.434,957.97 440.784,915.81 443.135,966.429 445.485,927.129 447.836,950.727 450.186,987.468 452.537,902.293 454.887,927.9 457.238,903.326 459.588,916.654 461.939,862.302 464.289,666.339 466.64,978.853 468.99,919.139 471.341,852.431 473.691,948.459 476.041,936.497 478.392,793.951 480.742,732.172 483.093,939.734 485.443,1058.38 487.794,825.554 490.144,1091.37 492.495,1094.72 494.845,881.387 497.196,889.348 499.546,1053.17 501.897,856.992 504.247,979.86 506.598,921.355 508.948,1075.47 511.299,951.935 513.649,1076.12 515.999,930.7 518.35,736.867 520.7,854.06 523.051,936.915 525.401,1014.78 527.752,963.761 530.102,965.378 532.453,748.627 534.803,969.62 537.154,892.346 539.504,1091.59 541.855,967.979 544.205,903.644 546.556,727.097 548.906,806.392 551.257,905.285 553.607,1003.7 555.958,1069.85 558.308,887.449 560.658,948.166 563.009,922.202 565.359,896.753 567.71,940.227 570.06,1027.28 572.411,1028.2 574.761,744.545 577.112,973.978 579.462,836.828 581.813,930.16 584.163,907.711 586.514,981.106 588.864,1171.54 591.215,769.395 593.565,954.906 595.916,779.166 598.266,998.286 600.616,1046.16 602.967,1111.53 605.317,943.915 607.668,803.871 610.018,900.547 612.369,1010.62 614.719,889.556 617.07,903.156 619.42,1034.82 621.771,900.624 624.121,967.518 626.472,1060.15 628.822,772.994 631.173,968.349 633.523,1127.55 635.874,842.966 638.224,959.304 640.575,985.727 642.925,878.862 645.275,814.825 647.626,921.074 649.976,888.109 652.327,962.456 654.677,827.82 657.028,906.465 659.378,941.361 661.729,866.558 664.079,867.375 666.43,827.543 668.78,958.07 671.131,950.033 673.481,832.683 675.832,1072.98 678.182,815.355 680.533,941.435 682.883,952.532 685.233,1074.35 687.584,1118.21 689.934,965.907 692.285,1074.05 694.635,803.215 696.986,922.113 699.336,880.854 701.687,966.666 704.037,860.7 706.388,1134.49 708.738,880.151 711.089,952.543 713.439,840.445 715.79,836.487 718.14,1049.16 720.491,1098.29 722.841,892.164 725.192,854.855 727.542,821.466 729.892,944.847 732.243,919.445 734.593,839.6 736.944,869.377 739.294,774.085 741.645,872.812 743.995,807.281 746.346,947.16 748.696,992.728 751.047,861.321 753.397,950.497 755.748,801.318 758.098,1059.03 760.449,715.757 762.799,1011.94 765.15,813.811 767.5,868.862 769.85,960.055 772.201,820.155 774.551,797.861 776.902,797.162 779.252,985.317 781.603,779.147 783.953,798.154 786.304,1006.4 788.654,1022.62 791.005,900.259 793.355,783.018 795.706,880.34 798.056,936.277 800.407,811.094 802.757,840.609 805.108,1035.18 807.458,872.263 809.809,877.003 812.159,1085.64 814.509,993.213 816.86,917.784 819.21,859.793 821.561,947.434 823.911,1162.48 826.262,1101.71 828.612,959.298 830.963,938.943 833.313,1050.2 835.664,932.727 838.014,861.472 840.365,880.897 842.715,971.287 845.066,915.169 847.416,897.818 849.767,1046.29 852.117,947.719 854.467,967.752 856.818,953.289 859.168,881.025 861.519,779.333 863.869,889.306 866.22,1071.29 868.57,935.106 870.921,841.805 873.271,950.62 875.622,970.044 877.972,1043.85 880.323,850.75 882.673,1019.8 885.024,952.711 887.374,943.895 889.725,801.025 892.075,1018.14 894.426,910.026 896.776,1031.58 899.126,755.786 901.477,953.253 903.827,940.158 906.178,940.501 908.528,1157.91 910.879,1036.67 913.229,825.231 915.58,964.626 917.93,1051.48 920.281,1050.9 922.631,866.47 924.982,839.322 927.332,855.699 929.683,914.985 932.033,866.946 934.384,823.717 936.734,1007.57 939.084,987.534 941.435,783.957 943.785,751.082 946.136,782.114 948.486,840.565 950.837,1112.8 953.187,969.606 955.538,970.14 957.888,1033.55 960.239,768.802 962.589,875.2 964.94,879.714 967.29,1061.58 969.641,934.1 971.991,909.673 974.342,964.857 976.692,918.944 979.043,785.995 981.393,982.625 983.743,965.864 986.094,934.618 988.444,949.526 990.795,817.11 993.145,880.396 995.496,885.439 997.846,1027.59 1000.2,994.955 1002.55,926.444 1004.9,970.401 1007.25,1175.12 1009.6,999.712 1011.95,958.709 1014.3,806.156 1016.65,851.861 1019,798.847 1021.35,1059.21 1023.7,700.869 1026.05,903.232 1028.4,1078.83 1030.75,836.972 1033.1,800.803 1035.45,985.094 1037.8,1097.59 1040.15,902.607 1042.51,943.16 1044.86,801.089 1047.21,1046.55 1049.56,1037.54 1051.91,1036.25 1054.26,1160.49 1056.61,966.246 1058.96,910.719 1061.31,946.238 1063.66,851.832 1066.01,805.633 1068.36,926.435 1070.71,764.03 1073.06,878.129 1075.41,814.788 1077.76,824.175 1080.11,893.274 1082.46,777.88 1084.81,1072.83 1087.16,1058.01 1089.51,1041.8 1091.87,1013.75 1094.22,721.254 1096.57,918.681 1098.92,959.578 1101.27,953.888 1103.62,830.54 1105.97,831.066 1108.32,1049.78 1110.67,998.51 1113.02,980.456 1115.37,855.397 1117.72,1115.18 1120.07,875.764 1122.42,824.002 1124.77,870.574 1127.12,882.996 1129.47,958.581 1131.82,842.55 1134.17,996.43 1136.52,906.116 1138.87,901.166 1141.23,902.727 1143.58,858.571 1145.93,984.654 1148.28,876.187 1150.63,1045.9 1152.98,866.507 1155.33,963.681 1157.68,986.366 1160.03,910.043 1162.38,1058.65 1164.73,1134.6 1167.08,939.095 1169.43,1038.64 1171.78,910.509 1174.13,967.24 1176.48,908.551 1178.83,1000.42 1181.18,919.757 1183.53,965.279 1185.88,1046.57 1188.23,733.27 1190.59,945.921 1192.94,1024.49 1195.29,771.155 1197.64,892.235 1199.99,940.348 1202.34,907.718 1204.69,959.395 1207.04,848.374 1209.39,725.9 1211.74,1152.2 1214.09,1104.1 1216.44,1036.31 1218.79,836.303 1221.14,1062.42 1223.49,874.164 1225.84,910.314 1228.19,722.31 1230.54,886.321 1232.89,864.914 1235.24,724.143 1237.59,1022.93 1239.94,1075.51 1242.3,1029.18 1244.65,1053.3 1247,1007.23 1249.35,977.395 1251.7,919.055 1254.05,1025.95 1256.4,900.164 1258.75,1073.52 1261.1,1045.47 1263.45,1122.86 1265.8,835.439 1268.15,1030.26 1270.5,848.069 1272.85,953.595 1275.2,984.173 1277.55,996.252 1279.9,933.329 1282.25,1098.7 1284.6,824.074 1286.95,861.77 1289.3,944.05 1291.66,791.755 1294.01,911.019 1296.36,1078.32 1298.71,895.033 1301.06,794.679 1303.41,908.759 1305.76,994.32 1308.11,947.568 1310.46,901.567 1312.81,975.254 1315.16,854.421 1317.51,1033.16 1319.86,1047.64 1322.21,1012.73 1324.56,953.63 1326.91,617.273 1329.26,924.754 1331.61,976.897 1333.96,882.338 1336.31,870.546 1338.66,985.585 1341.02,936.937 1343.37,920.348 1345.72,757.598 1348.07,813.763 1350.42,839.829 1352.77,1046.42 1355.12,960.169 1357.47,777.378 1359.82,920.813 1362.17,995.276 1364.52,955.812 1366.87,920.616 1369.22,805.434 1371.57,894.075 1373.92,1158.13 1376.27,847.09 1378.62,1192.18 1380.97,725.966 1383.32,1002.84 1385.67,989.645 1388.02,815.427 1390.38,1022.44 1392.73,968.206 1395.08,906.712 1397.43,857.107 1399.78,1016.63 1402.13,975.867 1404.48,643.107 1406.83,903.162 1409.18,886.702 1411.53,962.382 1413.88,921.992 1416.23,1087.04 1418.58,854.928 1420.93,975.685 1423.28,937.291 1425.63,843.909 1427.98,1029.27 1430.33,1027.42 1432.68,928.285 1435.03,839.447 1437.38,930.207 1439.74,856.064 1442.09,750.189 1444.44,1069.4 1446.79,915.935 1449.14,1024.1 1451.49,764.643 1453.84,1009.7 1456.19,885.832 1458.54,719.393 1460.89,923.323 1463.24,1014.05 1465.59,745.576 1467.94,813.16 1470.29,886.7 1472.64,836.759 1474.99,1020.72 1477.34,776.4 1479.69,954.804 1482.04,848.804 1484.39,753.283 1486.74,881.922 1489.1,960.172 1491.45,1011.73 1493.8,923.959 1496.15,945.008 1498.5,1005.86 1500.85,971.799 1503.2,876.654 1505.55,1023.61 1507.9,985.332 1510.25,906.708 1512.6,1113.93 1514.95,885.8 1517.3,933.814 1519.65,831.101 1522,971.815 1524.35,948.455 1526.7,1065.96 1529.05,866.621 1531.4,864.159 1533.75,923.686 1536.1,991.773 1538.45,949.27 1540.81,921.107 1543.16,787.486 1545.51,862.859 1547.86,1067.49 1550.21,843.975 1552.56,859.224 1554.91,760.115 1557.26,884.452 1559.61,816.509 1561.96,818.638 1564.31,950.306 1566.66,851.711 1569.01,878.41 1571.36,1044.46 1573.71,825.465 1576.06,1048.31 1578.41,985.03 1580.76,927.571 1583.11,900.757 1585.46,928.455 1587.81,894.82 1590.17,913.662 1592.52,903.163 1594.87,902.308 1597.22,1037.24 1599.57,739.938 1601.92,921.61 1604.27,714.769 1606.62,771.571 1608.97,989.456 1611.32,913.665 1613.67,790.553 1616.02,923.066 1618.37,859.357 1620.72,1011.59 1623.07,923.399 1625.42,851.254 1627.77,851.067 1630.12,757.462 1632.47,884.744 1634.82,914.657 1637.17,995.809 1639.53,995.89 1641.88,792.103 1644.23,860.502 1646.58,893.236 1648.93,950.71 1651.28,794.219 1653.63,726.108 1655.98,961.669 1658.33,853.637 1660.68,851.481 1663.03,1024.96 1665.38,1079.77 1667.73,823.135 1670.08,877.27 1672.43,878.67 1674.78,874.42 1677.13,682.671 1679.48,978.604 1681.83,1005.14 1684.18,860.218 1686.53,826.587 1688.89,635.384 1691.24,1157.65 1693.59,985.28 1695.94,886.586 1698.29,983.849 1700.64,998.429 1702.99,828.22 1705.34,1108.73 1707.69,979.786 1710.04,983.919 1712.39,878.254 1714.74,1019.23 1717.09,1050.65 1719.44,723.821 1721.79,951.56 1724.14,1025.88 1726.49,991.461 1728.84,900.175 1731.19,1002.67 1733.54,948.815 1735.89,760.955 1738.25,912.244 1740.6,986.61 1742.95,833.737 1745.3,1038.02 1747.65,943.206 1750,894.185 1752.35,1140.31 1754.7,931.548 1757.05,920.546 1759.4,928.606 1761.75,948.354 1764.1,831.498 1766.45,853.862 1768.8,911.185 1771.15,684.962 1773.5,862.451 1775.85,858.591 1778.2,961.249 1780.55,966.522 1782.9,860.955 1785.25,943.451 1787.6,954.242 1789.96,1006.45 1792.31,902.491 1794.66,870.125 1797.01,793.247 1799.36,911.54 1801.71,1114.74 1804.06,995.552 1806.41,918.363 1808.76,826.934 1811.11,924.828 1813.46,924.752 1815.81,845.067 1818.16,864.057 1820.51,986.441 1822.86,1008.9 1825.21,854.21 1827.56,826.99 1829.91,1060.44 1832.26,801.897 1834.61,898.563 1836.96,820.809 1839.32,1029.92 1841.67,980.324 1844.02,980.071 1846.37,887.861 1848.72,1022.29 1851.07,834.323 1853.42,1119.96 1855.77,837.604 1858.12,958.702 1860.47,907.901 1862.82,884.278 1865.17,967.481 1867.52,996.812 1869.87,1034.02 1872.22,904.302 1874.57,973.519 1876.92,932.396 1879.27,1009.85 1881.62,908.425 1883.97,960.545 1886.32,876.173 1888.68,978.135 1891.03,1094.6 1893.38,978.612 1895.73,870.392 1898.08,1017.63 1900.43,1042.25 1902.78,938.386 1905.13,1155.65 1907.48,850.027 1909.83,1069.65 1912.18,880.904 1914.53,1124.77 1916.88,969.935 1919.23,1002.03 1921.58,874.192 1923.93,1065.15 1926.28,983.014 1928.63,887.961 1930.98,987.58 1933.33,880.016 1935.68,891.44 1938.04,930.044 1940.39,942.225 1942.74,959.669 1945.09,883.994 1947.44,952.324 1949.79,926.918 1952.14,932.882 1954.49,907.743 1956.84,1047.18 1959.19,826.114 1961.54,1006.91 1963.89,1002.38 1966.24,703.859 1968.59,843.242 1970.94,844.286 1973.29,812.824 1975.64,716.763 1977.99,1077.3 1980.34,796.322 1982.69,836.626 1985.04,1034.3 1987.4,1022.26 1989.75,1023.09 1992.1,723.22 1994.45,903.977 1996.8,843.812 1999.15,847.378 2001.5,919.599 2003.85,979.867 2006.2,941.783 2008.55,977.325 2010.9,987.877 2013.25,1072.91 2015.6,1089.63 2017.95,864.489 2020.3,837.333 2022.65,1012.98 2025,929.415 2027.35,851.307 2029.7,957.606 2032.05,872.986 2034.4,1169.31 2036.76,807.273 2039.11,1081.86 2041.46,969.166 2043.81,904.125 2046.16,1019.38 2048.51,805.884 2050.86,746.66 2053.21,988.256 2055.56,940.997 2057.91,822.488 2060.26,1033.39 2062.61,1145.62 2064.96,816.12 2067.31,903.547 2069.66,912.335 2072.01,1130.81 2074.36,837.981 2076.71,863.968 2079.06,897.892 2081.41,906.739 2083.76,955.48 2086.11,910.52 2088.47,906.309 2090.82,832.528 2093.17,841.688 2095.52,1005.14 2097.87,853.126 2100.22,1004.33 2102.57,960.601 2104.92,945.223 2107.27,1033.47 2109.62,769.318 2111.97,897.331 2114.32,935.227 2116.67,939.945 2119.02,997.578 2121.37,1036.39 2123.72,910.248 2126.07,945.924 2128.42,746.757 2130.77,921.578 2133.12,714.332 2135.47,971.554 2137.83,1039.6 2140.18,940.776 2142.53,904.851 2144.88,725.419 2147.23,885.029 2149.58,952.235 2151.93,1048.94 2154.28,972.238 2156.63,1054.9 2158.98,953.043 2161.33,887.558 2163.68,943.014 2166.03,930.439 2168.38,1038.89 2170.73,967.31 2173.08,784.253 2175.43,1006.94 2177.78,888.103 2180.13,951.02 2182.48,755.67 2184.83,933.845 2187.19,951.428 2189.54,950.273 2191.89,908.49 2194.24,990.625 2196.59,877.646 2198.94,1093.28 2201.29,912.726 2203.64,967.787 2205.99,1025 2208.34,944.102 2210.69,936.641 2213.04,1000.33 2215.39,833.84 2217.74,951.997 2220.09,891.787 2222.44,1084.49 2224.79,836.208 2227.14,1101.07 2229.49,848.254 2231.84,843.492 2234.19,1001.95 2236.55,888.828 2238.9,942.614 2241.25,832.975 2243.6,899.148 2245.95,1030.08 2248.3,1001.75 2250.65,883.658 2253,1019.61 2255.35,1030.01 2257.7,1047.48 2260.05,942.045 2262.4,775.228 2264.75,895.879 2267.1,884.61 2269.45,1034.99 2271.8,1155.51 2274.15,1117.26 2276.5,886.317 2278.85,918.391 2281.2,991.535 2283.55,960.238 2285.91,852.989 2288.26,897.224 2290.61,913.065 2292.96,1009.14 2295.31,815.69 2297.66,1020.64 2300.01,761.541 2302.36,1036.19 2304.71,796.755 2307.06,975.085 2309.41,1103.34 2311.76,1006.3 2314.11,993.342 2316.46,991.88 2318.81,957.059 2321.16,978.489 2323.51,774.353 2325.86,835.309 2328.21,897.823 2330.56,941.446 2332.91,1072.76 2335.27,920.343 2337.62,1063.11 2339.97,939.512 2342.32,916.375 2344.67,925.847 2347.02,1067.04 2349.37,739.046 2351.72,925.814 2354.07,909.044 2356.42,917.875 2358.77,847.755 2361.12,1122.06 2363.47,873.521 2365.82,818.589 2368.17,980.551 2370.52,995.684 2372.87,1037.48 2375.22,981.186 2377.57,850.605 2379.92,1190.49 2382.27,759.441 2384.62,946.267 2386.98,1096.84 2389.33,1108.12 2391.68,1135.72 2394.03,983.918 2396.38,1008.89 2398.73,926.866 2401.08,816.333 2403.43,947.18 2405.78,1110.88 2408.13,764.319 2410.48,901.924 2412.83,963.04 2415.18,961.916 2417.53,913.301 2419.88,862.552 2422.23,889.197 2424.58,1074.46 2426.93,1087.03 2429.28,1018.05 2431.63,903.564 2433.98,894.373 2436.34,861.329 2438.69,839.446 2441.04,904.465 2443.39,893.718 2445.74,1038.84 2448.09,840.956 2450.44,928.854 2452.79,923.631 2455.14,852.237 2457.49,886.314 2459.84,923.201 2462.19,647.815 2464.54,940.187 2466.89,783.857 2469.24,881.431 2471.59,989.845 2473.94,885.49 2476.29,928.191 2478.64,880.937 2480.99,825.538 2483.34,841.826 2485.7,1071.88 2488.05,943.809 2490.4,873.805 2492.75,992.796 2495.1,877.886 2497.45,989.303 2499.8,881.115 2502.15,982.469 2504.5,829.67 2506.85,1015.52 2509.2,605.758 2511.55,895.054 2513.9,1147.92 2516.25,868.847 2518.6,996.636 2520.95,862.133 2523.3,977.554 2525.65,954.893 2528,805.635 2530.35,1044.43 2532.7,961.139 2535.06,1077.6 2537.41,1056.15 2539.76,969.062 2542.11,962.947 2544.46,1037.25 2546.81,1105.73 2549.16,997.37 2551.51,859.602 2553.86,877.443 2556.21,861.059 2558.56,814.603 2560.91,869.011 2563.26,988.174 2565.61,871.81 2567.96,1104.66 2570.31,782.646 "></polyline>
<polyline clip-path="url(#clip292)" style="stroke:#3da44d; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,745.711 224.541,390.819 226.891,525.303 229.242,437.442 231.592,426.152 233.943,372.769 236.293,456.731 238.644,391.602 240.994,462.005 243.345,418.395 245.695,465.697 248.046,291.243 250.396,654.701 252.747,452.218 255.097,399.69 257.448,323.894 259.798,401.205 262.148,549.457 264.499,439.818 266.849,266.619 269.2,302.732 271.55,524.066 273.901,216.809 276.251,366.276 278.602,376.461 280.952,389.31 283.303,465.044 285.653,180.372 288.004,321.768 290.354,477.283 292.705,622.638 295.055,652.929 297.406,277.97 299.756,579.493 302.107,533.648 304.457,415.608 306.807,387.571 309.158,517.52 311.508,434.188 313.859,486.243 316.209,347.11 318.56,401.243 320.91,187.476 323.261,570.19 325.611,505.663 327.962,414.722 330.312,183.877 332.663,360.806 335.013,379.199 337.364,283.665 339.714,312.582 342.065,670.431 344.415,597.296 346.765,287.59 349.116,388.735 351.466,393.033 353.817,443.559 356.167,390.016 358.518,317.443 360.868,483.497 363.219,567.323 365.569,539.162 367.92,397.596 370.27,397.557 372.621,449.821 374.971,381.806 377.322,498.059 379.672,398.192 382.023,631.115 384.373,392.183 386.724,356.781 389.074,346.309 391.424,461.1 393.775,476.261 396.125,426.033 398.476,527.026 400.826,385.246 403.177,510.512 405.527,280.299 407.878,599.304 410.228,498.181 412.579,511.13 414.929,400.679 417.28,447.691 419.63,502.846 421.981,397.218 424.331,562.901 426.682,385.308 429.032,304.837 431.382,442.439 433.733,440.472 436.083,393.696 438.434,406.891 440.784,465.784 443.135,444.788 445.485,459.726 447.836,539.775 450.186,557.377 452.537,338.586 454.887,325.957 457.238,368.383 459.588,382.286 461.939,499.238 464.289,426.857 466.64,258.19 468.99,435.806 471.341,406.65 473.691,564.571 476.041,453.536 478.392,590.633 480.742,546.515 483.093,362.664 485.443,270.059 487.794,407.591 490.144,348.17 492.495,427.192 494.845,364.82 497.196,470 499.546,389.028 501.897,431.318 504.247,370.812 506.598,514.184 508.948,494.149 511.299,310.772 513.649,426.745 515.999,504.377 518.35,325.825 520.7,466.189 523.051,352.83 525.401,227.656 527.752,551.035 530.102,581.314 532.453,395.555 534.803,363.703 537.154,418.786 539.504,450.421 541.855,503.476 544.205,396.307 546.556,439.761 548.906,327.562 551.257,493.686 553.607,522.904 555.958,454.975 558.308,342.464 560.658,391.94 563.009,511.278 565.359,508.012 567.71,357.709 570.06,294.366 572.411,532.683 574.761,359.158 577.112,366.167 579.462,467.019 581.813,374.488 584.163,482.966 586.514,448.11 588.864,517.355 591.215,421.612 593.565,439.523 595.916,488.035 598.266,282.57 600.616,244.52 602.967,469.491 605.317,302.26 607.668,373.321 610.018,393.574 612.369,401.237 614.719,341.252 617.07,549.538 619.42,467.888 621.771,361.674 624.121,484.393 626.472,362.408 628.822,421.131 631.173,478.752 633.523,395.942 635.874,454.569 638.224,440.088 640.575,390.563 642.925,414.569 645.275,469.634 647.626,309.307 649.976,436.896 652.327,336.06 654.677,439.197 657.028,490.169 659.378,456.678 661.729,708.153 664.079,317.815 666.43,551.626 668.78,199.38 671.131,468.233 673.481,369.029 675.832,443.811 678.182,385.312 680.533,346.853 682.883,260.095 685.233,458.901 687.584,273.162 689.934,420.753 692.285,301.571 694.635,559.226 696.986,265.803 699.336,546.564 701.687,474.468 704.037,370.617 706.388,528.149 708.738,368.276 711.089,449.245 713.439,497.041 715.79,499.495 718.14,458.165 720.491,430.987 722.841,437.823 725.192,652.981 727.542,429.66 729.892,316.934 732.243,415.615 734.593,415.512 736.944,472.304 739.294,318.486 741.645,409.956 743.995,505.347 746.346,470.303 748.696,569.796 751.047,526.633 753.397,486.995 755.748,332.627 758.098,498.577 760.449,476.309 762.799,383.769 765.15,508.935 767.5,628.556 769.85,378.188 772.201,413.094 774.551,408.602 776.902,229.075 779.252,475.449 781.603,556.803 783.953,214.874 786.304,361.612 788.654,553.917 791.005,637.416 793.355,143.976 795.706,336.672 798.056,557.083 800.407,357.648 802.757,495.39 805.108,271.426 807.458,427.449 809.809,602.188 812.159,289.908 814.509,268.247 816.86,313.379 819.21,442.985 821.561,487.149 823.911,511.798 826.262,401.026 828.612,485.506 830.963,402.375 833.313,452.077 835.664,340.788 838.014,396.469 840.365,285.146 842.715,491.398 845.066,580.429 847.416,395.292 849.767,465.792 852.117,555.232 854.467,284.788 856.818,321.456 859.168,325.126 861.519,472.298 863.869,263.233 866.22,426.498 868.57,269.116 870.921,292.687 873.271,348.788 875.622,351.302 877.972,479.23 880.323,412.657 882.673,412.401 885.024,317.035 887.374,383.859 889.725,533.907 892.075,536.541 894.426,445.02 896.776,329.718 899.126,531.049 901.477,400.163 903.827,500.377 906.178,522.744 908.528,545.788 910.879,588.053 913.229,359.263 915.58,499.528 917.93,223.985 920.281,540.473 922.631,335.862 924.982,467.926 927.332,529.719 929.683,491.695 932.033,618.82 934.384,508.67 936.734,444.052 939.084,134.063 941.435,343.529 943.785,303.83 946.136,473.752 948.486,459.353 950.837,322.63 953.187,267.951 955.538,389.097 957.888,457.765 960.239,624.494 962.589,362.358 964.94,371.068 967.29,454.643 969.641,403.921 971.991,362.353 974.342,446.414 976.692,530.826 979.043,395.822 981.393,297.584 983.743,487.041 986.094,414.107 988.444,404.874 990.795,470.724 993.145,310.555 995.496,352.434 997.846,485.246 1000.2,470.006 1002.55,440.526 1004.9,291.518 1007.25,322.929 1009.6,444.563 1011.95,259.603 1014.3,318.241 1016.65,616.199 1019,455.443 1021.35,373.884 1023.7,286.311 1026.05,491.368 1028.4,522.957 1030.75,347.99 1033.1,316.383 1035.45,509.757 1037.8,327.258 1040.15,294.668 1042.51,412.245 1044.86,640.275 1047.21,561.403 1049.56,556.471 1051.91,393.55 1054.26,220.94 1056.61,326.144 1058.96,329.917 1061.31,486.07 1063.66,569.833 1066.01,485.669 1068.36,376.859 1070.71,360.576 1073.06,485.815 1075.41,323.852 1077.76,588.268 1080.11,421.163 1082.46,460.45 1084.81,286.049 1087.16,336.254 1089.51,506.152 1091.87,666.775 1094.22,517.822 1096.57,283.991 1098.92,389.789 1101.27,234.616 1103.62,325.596 1105.97,342.51 1108.32,459.114 1110.67,346.411 1113.02,313.542 1115.37,442.002 1117.72,576.367 1120.07,546.952 1122.42,393.366 1124.77,450.927 1127.12,223.009 1129.47,466.709 1131.82,272.881 1134.17,474.387 1136.52,533.925 1138.87,453.596 1141.23,318.183 1143.58,345.778 1145.93,380.608 1148.28,401.201 1150.63,261.495 1152.98,421.581 1155.33,514.086 1157.68,248.888 1160.03,522.957 1162.38,576.309 1164.73,518.612 1167.08,495.588 1169.43,359.5 1171.78,381.217 1174.13,382.629 1176.48,572.479 1178.83,443.837 1181.18,551.584 1183.53,283.25 1185.88,324.23 1188.23,400.974 1190.59,413.572 1192.94,392.723 1195.29,685.431 1197.64,345.963 1199.99,451.489 1202.34,475.546 1204.69,515.594 1207.04,499.483 1209.39,341.441 1211.74,490.777 1214.09,331.625 1216.44,366.223 1218.79,401.333 1221.14,515.946 1223.49,314.136 1225.84,153.851 1228.19,504.788 1230.54,531.204 1232.89,367.588 1235.24,384.971 1237.59,272.383 1239.94,588.14 1242.3,465.743 1244.65,425.563 1247,627.31 1249.35,472.495 1251.7,320.972 1254.05,438.281 1256.4,546.771 1258.75,454.472 1261.1,499.019 1263.45,467.978 1265.8,396.598 1268.15,649.182 1270.5,444.315 1272.85,340.464 1275.2,520.899 1277.55,470.885 1279.9,490.986 1282.25,312.753 1284.6,349.304 1286.95,417.21 1289.3,560.941 1291.66,263.078 1294.01,525.198 1296.36,399.862 1298.71,429.469 1301.06,460.849 1303.41,498.175 1305.76,411.307 1308.11,502.552 1310.46,305.567 1312.81,410.302 1315.16,373.392 1317.51,246.419 1319.86,407.382 1322.21,672.314 1324.56,465.276 1326.91,437.41 1329.26,154.333 1331.61,442.709 1333.96,377.968 1336.31,447.922 1338.66,506.993 1341.02,473.291 1343.37,624.081 1345.72,345.811 1348.07,398.968 1350.42,357.458 1352.77,362.393 1355.12,469.107 1357.47,491.181 1359.82,281.416 1362.17,360.801 1364.52,468.579 1366.87,417.938 1369.22,278.107 1371.57,621.772 1373.92,430.667 1376.27,436.18 1378.62,108.687 1380.97,477.218 1383.32,398.152 1385.67,664.777 1388.02,391.928 1390.38,408.861 1392.73,514.476 1395.08,500.461 1397.43,401.102 1399.78,386.003 1402.13,383.479 1404.48,348.185 1406.83,455.943 1409.18,616.343 1411.53,389.873 1413.88,359.812 1416.23,486.475 1418.58,414.192 1420.93,455.814 1423.28,330.403 1425.63,449.068 1427.98,275.235 1430.33,320.715 1432.68,375.333 1435.03,453.681 1437.38,385.516 1439.74,455.748 1442.09,383.043 1444.44,534.235 1446.79,454.557 1449.14,517.031 1451.49,294.328 1453.84,332.968 1456.19,520.714 1458.54,402.547 1460.89,459.483 1463.24,448.599 1465.59,506.244 1467.94,429.321 1470.29,447.38 1472.64,379.94 1474.99,313.065 1477.34,514.905 1479.69,425.563 1482.04,445.354 1484.39,381.896 1486.74,297.408 1489.1,421.168 1491.45,433.345 1493.8,450.421 1496.15,561.584 1498.5,316.13 1500.85,537.67 1503.2,400.192 1505.55,350.953 1507.9,468.4 1510.25,609.41 1512.6,364.531 1514.95,486.837 1517.3,355.851 1519.65,355.845 1522,401.694 1524.35,340.404 1526.7,552.384 1529.05,316.923 1531.4,392.415 1533.75,610.331 1536.1,411.438 1538.45,526.174 1540.81,395.315 1543.16,360.136 1545.51,344.827 1547.86,336.36 1550.21,445.022 1552.56,383.81 1554.91,295.88 1557.26,516.959 1559.61,257.666 1561.96,438.432 1564.31,361.957 1566.66,558.01 1569.01,590.261 1571.36,412.442 1573.71,510.732 1576.06,281.075 1578.41,530.386 1580.76,480.518 1583.11,496.821 1585.46,547.557 1587.81,448.821 1590.17,439.399 1592.52,372.33 1594.87,390.226 1597.22,396.336 1599.57,470.213 1601.92,599.968 1604.27,407.511 1606.62,564.311 1608.97,281.465 1611.32,328.008 1613.67,405.536 1616.02,357.743 1618.37,390.764 1620.72,560.518 1623.07,466.708 1625.42,482.547 1627.77,494.531 1630.12,311.731 1632.47,220.714 1634.82,321.152 1637.17,342.041 1639.53,470.199 1641.88,586.484 1644.23,495.446 1646.58,475.187 1648.93,367.999 1651.28,336.594 1653.63,607 1655.98,394.838 1658.33,482.328 1660.68,421.671 1663.03,357.582 1665.38,304.276 1667.73,268.464 1670.08,465.278 1672.43,471.864 1674.78,468.586 1677.13,444.172 1679.48,384.285 1681.83,463.531 1684.18,432.752 1686.53,376.318 1688.89,425.433 1691.24,621.235 1693.59,524.133 1695.94,487.584 1698.29,492.443 1700.64,349.261 1702.99,509.183 1705.34,493.217 1707.69,415.683 1710.04,286.225 1712.39,596.637 1714.74,493.106 1717.09,442.357 1719.44,300.985 1721.79,316.206 1724.14,440.111 1726.49,404.658 1728.84,338.554 1731.19,308.141 1733.54,377.195 1735.89,460.76 1738.25,467.339 1740.6,503.629 1742.95,369.395 1745.3,379.8 1747.65,399.021 1750,369.908 1752.35,322.596 1754.7,494.678 1757.05,382.472 1759.4,450.499 1761.75,396.502 1764.1,332.814 1766.45,441.279 1768.8,443.421 1771.15,404.129 1773.5,413.26 1775.85,457.368 1778.2,492.157 1780.55,467.006 1782.9,378.88 1785.25,370.927 1787.6,429.783 1789.96,431.763 1792.31,293.34 1794.66,481.666 1797.01,454.233 1799.36,471.707 1801.71,282.643 1804.06,577.668 1806.41,602.86 1808.76,452.197 1811.11,438.341 1813.46,488.805 1815.81,443.067 1818.16,591.151 1820.51,388.107 1822.86,396.469 1825.21,399.993 1827.56,201.288 1829.91,467.742 1832.26,416.571 1834.61,595.266 1836.96,235.796 1839.32,452.109 1841.67,540.717 1844.02,481.806 1846.37,399.621 1848.72,347.218 1851.07,575.189 1853.42,308.118 1855.77,545.774 1858.12,427.97 1860.47,333.359 1862.82,386.523 1865.17,442.782 1867.52,332.793 1869.87,495.294 1872.22,433.838 1874.57,469.576 1876.92,437.932 1879.27,160.186 1881.62,467.282 1883.97,455.295 1886.32,449.592 1888.68,449.994 1891.03,555.944 1893.38,381.195 1895.73,305.553 1898.08,469.7 1900.43,657.151 1902.78,530.139 1905.13,327.279 1907.48,562.376 1909.83,408.41 1912.18,392.722 1914.53,455.313 1916.88,463.706 1919.23,315.586 1921.58,544.794 1923.93,592.081 1926.28,550.868 1928.63,285.891 1930.98,565.462 1933.33,336.247 1935.68,642.627 1938.04,497.329 1940.39,483.104 1942.74,472.879 1945.09,445.802 1947.44,422.066 1949.79,361.514 1952.14,464.144 1954.49,541.449 1956.84,445.15 1959.19,510.054 1961.54,622.01 1963.89,249.694 1966.24,227.533 1968.59,450.996 1970.94,306.114 1973.29,526.431 1975.64,218.029 1977.99,677.518 1980.34,534.003 1982.69,617.207 1985.04,374.033 1987.4,567.344 1989.75,167.26 1992.1,96.8724 1994.45,309.572 1996.8,306.743 1999.15,449.189 2001.5,416.488 2003.85,385.206 2006.2,476.392 2008.55,524.642 2010.9,567.82 2013.25,517.816 2015.6,203.358 2017.95,443.353 2020.3,368.46 2022.65,385.771 2025,461.39 2027.35,493.77 2029.7,501.285 2032.05,380.381 2034.4,356.371 2036.76,362.191 2039.11,685.431 2041.46,542.335 2043.81,553.072 2046.16,482.444 2048.51,404.422 2050.86,442.12 2053.21,327.871 2055.56,405.846 2057.91,538.206 2060.26,275.144 2062.61,412.295 2064.96,597.236 2067.31,336.203 2069.66,315.292 2072.01,688.893 2074.36,409.098 2076.71,571.724 2079.06,627.926 2081.41,555.615 2083.76,540.114 2086.11,412.964 2088.47,489.27 2090.82,317.643 2093.17,357.396 2095.52,453.34 2097.87,548.9 2100.22,463.21 2102.57,425.333 2104.92,456.757 2107.27,458.835 2109.62,377.725 2111.97,665.894 2114.32,460.362 2116.67,492.65 2119.02,404.173 2121.37,511.067 2123.72,694.776 2126.07,424.67 2128.42,532.909 2130.77,451.754 2133.12,270.108 2135.47,551.041 2137.83,335.342 2140.18,365.234 2142.53,372.142 2144.88,308.318 2147.23,485.091 2149.58,297.896 2151.93,353.77 2154.28,421.703 2156.63,452.518 2158.98,392.604 2161.33,505.618 2163.68,378.658 2166.03,329.112 2168.38,516.878 2170.73,415.235 2173.08,521.311 2175.43,375.965 2177.78,413.708 2180.13,424.639 2182.48,340.479 2184.83,437.963 2187.19,367.445 2189.54,417.467 2191.89,322.053 2194.24,398.448 2196.59,400.01 2198.94,483.368 2201.29,501.883 2203.64,309.224 2205.99,363.329 2208.34,430.005 2210.69,458.052 2213.04,459.739 2215.39,514.546 2217.74,357.324 2220.09,536.841 2222.44,348.451 2224.79,243.952 2227.14,473.916 2229.49,493.161 2231.84,315.865 2234.19,498.986 2236.55,543.106 2238.9,303.233 2241.25,520.434 2243.6,426.108 2245.95,521.157 2248.3,318.441 2250.65,496.645 2253,465.211 2255.35,293.732 2257.7,378.298 2260.05,580.37 2262.4,429.651 2264.75,540.302 2267.1,492.423 2269.45,572.968 2271.8,396.526 2274.15,229.799 2276.5,594.163 2278.85,411.539 2281.2,571.419 2283.55,533.036 2285.91,522.492 2288.26,616.552 2290.61,586.385 2292.96,537.164 2295.31,487.016 2297.66,471.736 2300.01,610.14 2302.36,481.225 2304.71,444.761 2307.06,333.564 2309.41,615.529 2311.76,154.625 2314.11,345.701 2316.46,468.484 2318.81,480.694 2321.16,648.428 2323.51,485.477 2325.86,467.67 2328.21,434.974 2330.56,549.315 2332.91,521.287 2335.27,217.381 2337.62,439.406 2339.97,361.891 2342.32,587.433 2344.67,383.5 2347.02,495.551 2349.37,495.735 2351.72,388.01 2354.07,465.545 2356.42,404.06 2358.77,194.747 2361.12,393.262 2363.47,474.028 2365.82,430.772 2368.17,383.467 2370.52,447.738 2372.87,370.36 2375.22,411.236 2377.57,481.821 2379.92,397.956 2382.27,655.786 2384.62,297.117 2386.98,395.047 2389.33,527.042 2391.68,497.556 2394.03,381.895 2396.38,314.928 2398.73,335.304 2401.08,443.158 2403.43,481.429 2405.78,349.527 2408.13,587.944 2410.48,551.318 2412.83,469.692 2415.18,543.795 2417.53,574.486 2419.88,501.636 2422.23,518.63 2424.58,267.542 2426.93,439.299 2429.28,494.562 2431.63,405.503 2433.98,438.887 2436.34,538.609 2438.69,331.925 2441.04,516.683 2443.39,399.955 2445.74,478.138 2448.09,362.532 2450.44,289.755 2452.79,539.114 2455.14,436.67 2457.49,486.803 2459.84,405.928 2462.19,428.107 2464.54,342.938 2466.89,377.069 2469.24,460.949 2471.59,419.903 2473.94,439.592 2476.29,406.347 2478.64,431.941 2480.99,343.881 2483.34,331.551 2485.7,263.266 2488.05,490.151 2490.4,354.814 2492.75,682.583 2495.1,382.113 2497.45,368.824 2499.8,518.577 2502.15,380.921 2504.5,385.372 2506.85,386.479 2509.2,356.52 2511.55,372.697 2513.9,612.999 2516.25,599.166 2518.6,472.79 2520.95,373.275 2523.3,711.397 2525.65,389.379 2528,528.526 2530.35,535.963 2532.7,309.851 2535.06,464.978 2537.41,337.807 2539.76,381.531 2542.11,647.282 2544.46,350.672 2546.81,506.818 2549.16,531.492 2551.51,438.227 2553.86,467.811 2556.21,435.506 2558.56,430.304 2560.91,317.704 2563.26,363.945 2565.61,539.49 2567.96,381.011 2570.31,489.989 "></polyline>
</svg>
</div>
</div>
<p>Look at that! Things are working; amazin’.</p>
<p>We can also exploit <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>’s parallel sampling capabilities:</p>
<div id="34" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run separate 4 chains for 10 000 iterations using threads to parallelize.</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>num_chains <span class="op">=</span> <span class="fl">4</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    model_with_grad,</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">MCMCThreads</span>(),</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>,</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    num_chains;</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Note we need to provide an initial state for every chain.</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>    initial_state<span class="op">=</span><span class="fu">fill</span>(state, num_chains),</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>samples_array <span class="op">=</span> <span class="fu">stack</span>(<span class="fu">map</span>(<span class="bu">Base</span>.<span class="fu">Fix1</span>(stack, sample <span class="op">-&gt;</span> sample.x), samples))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000×4 Array{Float64, 3}:
[:, :, 1] =
 -0.938748  -3.68354  -5.40108  -6.64902  …  -4.57677   -4.81598    -5.03467
  1.73555    2.66638   1.50591   1.65335     -0.158822   0.0706623   0.76836
  3.84495    4.07601   5.20693   4.80336      5.67019    5.28983     3.65819

[:, :, 2] =
 -3.94085   -4.79538  -4.79538  -6.18311   …  -6.93351   -6.72999   -5.88598
  1.1565    -1.11746  -1.11746  -0.191129      0.595886   0.303511  -0.722169
  0.728033   4.26857   4.26857   5.02066       6.45237    5.88295    5.52828

[:, :, 3] =
 -2.60138   -5.17042  -6.61277  -5.84504   …  -6.22018  -6.75606  -6.13073
 -0.801893  -1.83473  -1.52617  -0.317858     -2.18776  -0.38023  -2.55113
  1.43146    3.42422   3.52678   2.78978       4.38895   4.86738   6.24466

[:, :, 4] =
 -2.95995   -4.03353  -3.3193   -2.98593   …  -4.91871   -4.91871   -4.07987
  1.5541    -1.52963  -1.46107  -0.434082      0.516025   0.516025  -0.552098
  0.864628   2.4356    2.68605   5.02742       4.52904    4.52904    4.99468</code></pre>
</div>
</div>
<p>But the fact that we have to provide the <code>AbstractMCMC.sample</code> call, etc. with an <code>initial_state</code> to get started is a bit annoying. We can avoid this by also defining a <code>AbstractMCMC.step</code> <em>without</em> the <code>state</code> argument:</p>
<div id="36" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">::</span><span class="dt">MALA</span>;</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># </span><span class="al">NOTE</span><span class="co">: No state provided!</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just create the initial state by sampling using  a Gaussian.</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="fu">randn</span>(rng, LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(x), <span class="fu">MALAState</span>(x)</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Equipped with this, we no longer need to provide the <code>initial_state</code> everywhere:</p>
<div id="38" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -4.97663    0.982351
 -0.0403118  0.989537
  4.97457    1.01312</code></pre>
</div>
</div>
</section>
<section id="using-our-sampler-with-turing.jl" class="level2">
<h2 class="anchored" data-anchor-id="using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</h2>
<p>As we promised, all of this hassle of implementing our <code>MALA</code> sampler in a way that uses <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> and <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> gets us something more than <em>just</em> an “automatic” implementation of <code>AbstractMCMC.sample</code>.</p>
<p>It also enables use with Turing.jl through the <code>externalsampler</code>, but we need to do one final thing first: we need to tell Turing.jl how to extract a vector of parameters from the “sample” returned in our implementation of <code>AbstractMCMC.step</code>. In our case, the “sample” is a <code>MALASample</code>, so we just need the following line:</p>
<div id="40" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load Turing.jl.</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Turing</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Overload the `getparams` method for our "sample" type, which is just a vector.</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>Turing.Inference.<span class="fu">getparams</span>(<span class="op">::</span><span class="dt">Turing.Model</span>, sample<span class="op">::</span><span class="dt">MALASample</span>) <span class="op">=</span> sample.x</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And with that, we’re good to go!</p>
<div id="42" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Our previous model defined as a Turing.jl model.</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">mvnormal_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">MvNormal</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.], I)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate our model.</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">mvnormal_model</span>()</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Call `sample` but now we're passing in a Turing.jl `model` and wrapping</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co"># our `MALA` sampler in the `externalsampler` to tell Turing.jl that the sampler</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co"># expects something that implements LogDensityProblems.jl.</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×4×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 2.6 seconds
Compute duration  = 2.6 seconds
parameters        = x[1], x[2], x[3]
internals         = lp

Summary Statistics
  parameters      mean       std      mcse    ess_bulk    ess_tail      rhat   ⋯
      Symbol   Float64   Float64   Float64     Float64     Float64   Float64   ⋯

        x[1]   -5.0392    0.9934    0.0173   3299.5981   5549.5797    1.0011   ⋯
        x[2]    0.0210    1.0081    0.0179   3188.7374   5084.3207    0.9999   ⋯
        x[3]    4.9953    1.0044    0.0181   3076.5154   5055.8776    1.0000   ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

        x[1]   -7.0199   -5.6973   -5.0439   -4.3780   -3.0759
        x[2]   -1.9368   -0.6506    0.0191    0.7101    2.0178
        x[3]    3.0197    4.3239    4.9934    5.6827    6.9850</code></pre>
</div>
</div>
<p>Pretty neat, eh?</p>
<section id="models-with-constrained-parameters" class="level3">
<h3 class="anchored" data-anchor-id="models-with-constrained-parameters">Models with constrained parameters</h3>
<p>One thing we’ve sort of glossed over in all of the above is that MALA, at least how we’ve implemented it, requires <span class="math inline">\(x\)</span> to live in <span class="math inline">\(\mathbb{R}^d\)</span> for some <span class="math inline">\(d &gt; 0\)</span>. If some of the parameters were in fact constrained, e.g.&nbsp;we were working with a <code>Beta</code> distribution which has support on the interval <span class="math inline">\((0, 1)\)</span>, <em>not</em> on <span class="math inline">\(\mathbb{R}^d\)</span>, we could easily end up outside of the valid range <span class="math inline">\((0, 1)\)</span>.</p>
<div id="44" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">beta_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">beta_model</span>()</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 1.54 seconds
Compute duration  = 1.54 seconds
parameters        = x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse    ess_bulk    ess_tail      rhat   ⋯
      Symbol   Float64   Float64   Float64     Float64     Float64   Float64   ⋯

           x    0.5010    0.1874    0.0028   4478.3587   5733.7386    1.0008   ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

           x    0.1487    0.3655    0.4991    0.6367    0.8563</code></pre>
</div>
</div>
<p>Yep, that still works, but only because Turing.jl actually <em>transforms</em> the <code>turing_model</code> from constrained to unconstrained, so that the <code>sampler</code> provided to <code>externalsampler</code> is actually always working in unconstrained space! This is not always desirable, so we can turn this off:</p>
<div id="46" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 0.24 seconds
Compute duration  = 0.24 seconds
parameters        = x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse   ess_bulk   ess_tail      rhat   e ⋯
      Symbol   Float64   Float64   Float64    Float64    Float64   Float64     ⋯

           x    0.0207    0.2517    0.0245   105.3373        NaN    1.0088     ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

           x    0.0444    0.0444    0.0444    0.0444    0.0444</code></pre>
</div>
</div>
<p>The fun thing is that this still sort of works because</p>
<div id="48" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">logpdf</span>(<span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>), <span class="fl">10.0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-Inf</code></pre>
</div>
</div>
<p>and so the samples that fall outside of the range are always rejected. But do notice how much worse all the diagnostics are, e.g.&nbsp;<code>ess_tail</code> is very poor compared to when we use <code>unconstrained=true</code>. Moreover, in more complex cases this won’t just result in a “nice” <code>-Inf</code> log-density value, but instead will error:</p>
<div id="50" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="kw">function</span> <span class="fu">demo</span>()</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>    σ² <span class="op">~</span> <span class="fu">truncated</span>(<span class="fu">Normal</span>(), lower<span class="op">=</span><span class="fl">0</span>)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If we end up with negative values for `σ²`, the `Normal` will error.</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>    x <span class="op">~</span> <span class="fu">Normal</span>(<span class="fl">0</span>, σ²)</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>DomainError: DomainError(Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}}(-0.5085216629318141,1.0,0.0), "Normal: the condition σ &gt;= zero(σ) is not satisfied.")
DomainError with Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}}(-0.5085216629318141,1.0,0.0):
Normal: the condition σ &gt;= zero(σ) is not satisfied.
Stacktrace:
  [1] #371
    @ ~/.julia/packages/Distributions/nmUhn/src/univariate/continuous/normal.jl:37 [inlined]
  [2] check_args
    @ ~/.julia/packages/Distributions/nmUhn/src/utils.jl:89 [inlined]
  [3] #Normal#370
    @ ~/.julia/packages/Distributions/nmUhn/src/univariate/continuous/normal.jl:37 [inlined]
  [4] Normal
    @ ~/.julia/packages/Distributions/nmUhn/src/univariate/continuous/normal.jl:36 [inlined]
  [5] Normal
    @ ~/.julia/packages/Distributions/nmUhn/src/univariate/continuous/normal.jl:42 [inlined]
  [6] macro expansion
    @ ~/.julia/packages/DynamicPPL/MjWTB/src/compiler.jl:579 [inlined]
  [7] demo(__model__::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, __varinfo__::DynamicPPL.ThreadSafeVarInfo{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}, Vector{Set{DynamicPPL.Selector}}}}, ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}, Vector{Base.RefValue{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}, __context__::DynamicPPL.DefaultContext)
    @ Main.Notebook ~/work/docs/docs/tutorials/docs-17-implementing-samplers/index.qmd:592
  [8] _evaluate!!
    @ ~/.julia/packages/DynamicPPL/MjWTB/src/model.jl:973 [inlined]
  [9] evaluate_threadsafe!!(model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, varinfo::DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}, Vector{Set{DynamicPPL.Selector}}}}, ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}, context::DynamicPPL.DefaultContext)
    @ DynamicPPL ~/.julia/packages/DynamicPPL/MjWTB/src/model.jl:962
 [10] evaluate!!
    @ ~/.julia/packages/DynamicPPL/MjWTB/src/model.jl:892 [inlined]
 [11] logdensity
    @ ~/.julia/packages/DynamicPPL/MjWTB/src/logdensityfunction.jl:140 [inlined]
 [12] Fix1
    @ ./operators.jl:1118 [inlined]
 [13] vector_mode_dual_eval!(f::Base.Fix1{typeof(LogDensityProblems.logdensity), LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, Nothing}}, cfg::ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}, x::Vector{Float64})
    @ ForwardDiff ~/.julia/packages/ForwardDiff/PcZ48/src/apiutils.jl:24
 [14] vector_mode_gradient!(result::DiffResults.MutableDiffResult{1, Float64, Tuple{Vector{Float64}}}, f::Base.Fix1{typeof(LogDensityProblems.logdensity), LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, Nothing}}, x::Vector{Float64}, cfg::ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}})
    @ ForwardDiff ~/.julia/packages/ForwardDiff/PcZ48/src/gradient.jl:96
 [15] gradient!
    @ ~/.julia/packages/ForwardDiff/PcZ48/src/gradient.jl:37 [inlined]
 [16] gradient!
    @ ~/.julia/packages/ForwardDiff/PcZ48/src/gradient.jl:35 [inlined]
 [17] logdensity_and_gradient
    @ ~/.julia/packages/LogDensityProblemsAD/rBlLq/ext/LogDensityProblemsADForwardDiffExt.jl:118 [inlined]
 [18] leapfrog_step(model::LogDensityProblemsADForwardDiffExt.ForwardDiffLogDensity{LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, Nothing}, ForwardDiff.Chunk{2}, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}, x::Vector{Float64}, p::Vector{Float64}, ϵ::Int64, M::UniformScaling{Bool})
    @ Main.Notebook ~/work/docs/docs/tutorials/docs-17-implementing-samplers/index.qmd:369
 [19] step(rng::TaskLocalRNG, model_wrapper::AbstractMCMC.LogDensityModel{LogDensityProblemsADForwardDiffExt.ForwardDiffLogDensity{LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, Nothing}, ForwardDiff.Chunk{2}, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}}, sampler::MALA{Int64, UniformScaling{Bool}}, state::MALAState{Vector{Float64}}; kwargs::@Kwargs{})
    @ Main.Notebook ~/work/docs/docs/tutorials/docs-17-implementing-samplers/index.qmd:334
 [20] step
    @ ~/work/docs/docs/tutorials/docs-17-implementing-samplers/index.qmd:316 [inlined]
 [21] #step#107
    @ ~/.julia/packages/Turing/Bv30p/src/mcmc/abstractmcmc.jl:155 [inlined]
 [22] step(rng::TaskLocalRNG, model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, sampler_wrapper::DynamicPPL.Sampler{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}, state::Turing.Inference.TuringState{MALAState{Vector{Float64}}, LogDensityProblemsADForwardDiffExt.ForwardDiffLogDensity{LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, Nothing}, ForwardDiff.Chunk{2}, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}})
    @ Turing.Inference ~/.julia/packages/Turing/Bv30p/src/mcmc/abstractmcmc.jl:144
 [23] macro expansion
    @ ~/.julia/packages/AbstractMCMC/YrmkI/src/sample.jl:176 [inlined]
 [24] macro expansion
    @ ~/.julia/packages/AbstractMCMC/YrmkI/src/logging.jl:16 [inlined]
 [25] mcmcsample(rng::TaskLocalRNG, model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, sampler::DynamicPPL.Sampler{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}, N::Int64; progress::Bool, progressname::String, callback::Nothing, discard_initial::Int64, thinning::Int64, chain_type::Type, initial_state::Nothing, kwargs::@Kwargs{})
    @ AbstractMCMC ~/.julia/packages/AbstractMCMC/YrmkI/src/sample.jl:120
 [26] sample(rng::TaskLocalRNG, model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, sampler::DynamicPPL.Sampler{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}, N::Int64; chain_type::Type, resume_from::Nothing, initial_state::Nothing, kwargs::@Kwargs{progress::Bool})
    @ DynamicPPL ~/.julia/packages/DynamicPPL/MjWTB/src/sampler.jl:93
 [27] sample
    @ ~/.julia/packages/DynamicPPL/MjWTB/src/sampler.jl:83 [inlined]
 [28] #sample#4
    @ ~/.julia/packages/Turing/Bv30p/src/mcmc/Inference.jl:276 [inlined]
 [29] sample
    @ ~/.julia/packages/Turing/Bv30p/src/mcmc/Inference.jl:267 [inlined]
 [30] #sample#3
    @ ~/.julia/packages/Turing/Bv30p/src/mcmc/Inference.jl:264 [inlined]
 [31] top-level scope
    @ ~/work/docs/docs/tutorials/docs-17-implementing-samplers/index.qmd:594</code></pre>
</div>
</div>
<p>As expected, we run into a <code>DomainError</code> at some point, while if we set <code>unconstrained=true</code>, letting Turing.jl transform the model to a unconstrained form behind the scenes, everything works as expected:</p>
<div id="52" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 0.56 seconds
Compute duration  = 0.56 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse   ess_bulk   ess_tail      rhat   e ⋯
      Symbol   Float64   Float64   Float64    Float64    Float64   Float64     ⋯

          σ²    0.8298    0.5618    0.0253   303.8798   122.1964    1.0046     ⋯
           x    0.0159    0.9177    0.0432   557.2721   477.4626    1.0045     ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

          σ²    0.1164    0.3914    0.7094    1.1696    2.1496
           x   -2.0752   -0.3600    0.0034    0.3957    2.1688</code></pre>
</div>
</div>
<p>Neat!</p>
<p>Similarly, which automatic differentiation backend one should use can be specified through the <code>adtype</code> keyword argument too. For example, if we want to use <a href="https://github.com/JuliaDiff/ReverseDiff.jl">ReverseDiff.jl</a> instead of the default <a href="https://github.com/JuliaDiff/ForwardDiff.jl">ForwardDiff.jl</a>:</p>
<div id="54" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">ReverseDiff</span>: ReverseDiff</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify that we want to use `AutoReverseDiff`.</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">demo</span>(),</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>, adtype<span class="op">=</span><span class="fu">AutoReverseDiff</span>()),</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>;</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 3.01 seconds
Compute duration  = 3.01 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse   ess_bulk   ess_tail      rhat   e ⋯
      Symbol   Float64   Float64   Float64    Float64    Float64   Float64     ⋯

          σ²    0.0886    0.0000    0.0000        NaN        NaN       NaN     ⋯
           x    0.7884    0.0000    0.0000        NaN        NaN       NaN     ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

          σ²    0.0886    0.0886    0.0886    0.0886    0.0886
           x    0.7884    0.7884    0.7884    0.7884    0.7884</code></pre>
</div>
</div>
<p>Double-neat.</p>
</section>
</section>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<p>At this point it’s worth maybe reminding ourselves what we did and also <em>why</em> we did it:</p>
<ol type="1">
<li>We define our models in the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface because it makes the sampler agnostic to how the underlying model is implemented.</li>
<li>We implement our sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> interface, which just means that our sampler is a subtype of <code>AbstractMCMC.AbstractSampler</code> and we implement the MCMC transition in <code>AbstractMCMC.step</code>.</li>
<li>Points 1 and 2 makes it so our sampler can be used with a wide range of model implementations, amongst them being models implemented in both Turing.jl and Stan. This gives you, the inference implementer, a large collection of models to test your inference method on, in addition to allowing users of Turing.jl and Stan to try out your inference method with minimal effort.</li>
</ol>


</section>


<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a><div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>We’re going with the leapfrog formulation because in a future version of this tutorial we’ll add a section extending this simple “baseline” MALA sampler to more complex versions. See <a href="https://github.com/TuringLang/docs/issues/479">issue #479</a> for progress on this.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>There is no such thing as a proper interface in Julia (at least not officially), and so we use the word “interface” here to mean a few minimal methods that needs to be implemented by any type that we treat as a target model.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/turinglang\.org\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../tutorials/docs-07-for-developers-variational-inference/index.html" class="pagination-link" aria-label="Variational Inference">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Variational Inference</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Turing is created by <a href="http://mlg.eng.cam.ac.uk/hong/" target="_blank">Hong Ge</a>, and lovingly maintained by the <a href="https://github.com/TuringLang/Turing.jl/graphs/contributors" target="_blank">core team</a> of volunteers. <br> The contents of this website are © 2024 under the terms of the <a href="https://github.com/TuringLang/Turing.jl/blob/master/LICENCE" target="_blank">MIT License</a>.</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/TuringLang/docs/edit/master/tutorials/docs-17-implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/docs/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://x.com/TuringLang">
      <i class="bi bi-twitter" role="img" aria-label="Turing Twitter">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/TuringLang/Turing.jl">
      <i class="bi bi-github" role="img" aria-label="Turing GitHub">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




<script src="../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>