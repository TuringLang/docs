<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Implementing Samplers – Turing.jl</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<link href="../../../developers/inference/variational-inference/index.html" rel="prev">
<link href="../../../assets/favicon.ico" rel="icon">
<script src="../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-dark-b53751a350365c71b6c909e95f209ed1.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap-34237cea2e2cc12c7515d5a9baa4807c.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../../site_libs/bootstrap/bootstrap-dark-2ce616a69abdabb5d8b1d1ad44f632cf.min.css" rel="prefetch" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<style>
  a {
    text-decoration: none;
  }
  a:hover {
    text-decoration: underline;
  }
</style>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../../theming/styles.css">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="https://turinglang.org/" class="navbar-brand navbar-brand-logo">
    <img src="../../../assets/images/turing-logo.svg" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="https://turinglang.org/">
    <span class="navbar-title">Turing.jl</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../getting-started/"> 
<span class="menu-text">Get Started</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../tutorials/coin-flipping/"> 
<span class="menu-text">Tutorials</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/library/"> 
<span class="menu-text">Libraries</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/news/"> 
<span class="menu-text">News</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/team/"> 
<span class="menu-text">Team</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-v0.37" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">v0.37</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-v0.37">    
        <li>
    <a class="dropdown-item" href="https://turinglang.org/docs/changelog.html">
 <span class="dropdown-text">Changelog</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://turinglang.org/docs/versions.html">
 <span class="dropdown-text">All Versions</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools tools-wide">
    <a href="https://x.com/TuringLang" title="Turing Twitter" class="quarto-navigation-tool px-1" aria-label="Turing Twitter"><i class="bi bi-twitter"></i></a>
    <a href="https://github.com/TuringLang/Turing.jl" title="Turing GitHub" class="quarto-navigation-tool px-1" aria-label="Turing GitHub"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../../developers/contributing/index.html">Developers</a></li><li class="breadcrumb-item"><a href="../../../developers/inference/abstractmcmc-interface/index.html">Inference (note: outdated)</a></li><li class="breadcrumb-item"><a href="../../../developers/inference/implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../getting-started/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Getting Started</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../core-functionality/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Core Functionality</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false">
 <span class="menu-text">User Guide</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/automatic-differentiation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Automatic Differentiation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/custom-distribution/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Custom Distributions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/probability-interface/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Querying Model Probabilities</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/modifying-logprob/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Modifying the Log Probability</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/generated-quantities/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Generated Quantities</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/mode-estimation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Mode Estimation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/performance-tips/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Performance Tips</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/sampler-visualisation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Sampler Visualization</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/dynamichmc/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using DynamicHMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/external-samplers/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using External Samplers</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false">
 <span class="menu-text">Tutorials</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/coin-flipping/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction: Coin Flipping</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/gaussian-mixture-models/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Mixture Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-neural-networks/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Neural Networks</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/hidden-markov-models/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Hidden Markov Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-linear-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Linear Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/infinite-mixture-models/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Infinite Mixture Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-poisson-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Poisson Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/multinomial-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Multinomial Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-differential-equations/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Differential Equations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/probabilistic-pca/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Probabilistic PCA</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-time-series-analysis/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Time Series Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/gaussian-processes-introduction/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Processes: Introduction</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/gaussian-process-latent-variable-models/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Process Latent Variable Models</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Developers</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/contributing/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Contributing</span></a>
  </div>
</li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false">
 <span class="menu-text">DynamicPPL’s Compiler</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/compiler/model-manual/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Manually Defining a Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/compiler/minituring-compiler/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation I: Compiler</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/compiler/minituring-contexts/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation II: Contexts</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/compiler/design-overview/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Turing Compiler Design (Outdated)</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false">
 <span class="menu-text">Variable Transformations</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/transforms/distributions/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Distributions and the Jacobian</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/transforms/bijectors/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bijectors in MCMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/transforms/dynamicppl/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variable transformations in DynamicPPL</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true">
 <span class="menu-text">Inference (note: outdated)</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/inference/abstractmcmc-interface/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Interface Guide</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/inference/abstractmcmc-turing/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">How Turing Implements AbstractMCMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/inference/variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/inference/implementing-samplers/index.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Implementing Samplers</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of Contents</h2>
   
  <ul>
  <li><a href="#quick-overview-of-mala" id="toc-quick-overview-of-mala" class="nav-link active" data-scroll-target="#quick-overview-of-mala">Quick overview of MALA</a></li>
  <li><a href="#what-we-need-from-a-model-logdensityproblems.jl" id="toc-what-we-need-from-a-model-logdensityproblems.jl" class="nav-link" data-scroll-target="#what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: LogDensityProblems.jl</a></li>
  <li><a href="#implementing-mala-in-abstractmcmc.jl" id="toc-implementing-mala-in-abstractmcmc.jl" class="nav-link" data-scroll-target="#implementing-mala-in-abstractmcmc.jl">Implementing MALA in AbstractMCMC.jl</a></li>
  <li><a href="#using-our-sampler-with-turing.jl" id="toc-using-our-sampler-with-turing.jl" class="nav-link" data-scroll-target="#using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</a>
  <ul class="collapse">
  <li><a href="#models-with-constrained-parameters" id="toc-models-with-constrained-parameters" class="nav-link" data-scroll-target="#models-with-constrained-parameters">Models with constrained parameters</a></li>
  </ul></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/TuringLang/docs/edit/main/developers/inference/implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/docs/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../../developers/contributing/index.html">Developers</a></li><li class="breadcrumb-item"><a href="../../../developers/inference/abstractmcmc-interface/index.html">Inference (note: outdated)</a></li><li class="breadcrumb-item"><a href="../../../developers/inference/implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Implementing Samplers</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>In this tutorial, we’ll go through step-by-step how to implement a “simple” sampler in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> in such a way that it can be easily applied to Turing.jl models.</p>
<p>In particular, we’re going to implement a version of <strong>Metropolis-adjusted Langevin (MALA)</strong>.</p>
<p>Note that we will implement this sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> framework, completely “ignoring” Turing.jl until the very end of the tutorial, at which point we’ll use a single line of code to make the resulting sampler available to Turing.jl. This is to really drive home the point that one can implement samplers in a way that is accessible to all of Turing.jl’s users without having to use Turing.jl yourself.</p>
<section id="quick-overview-of-mala" class="level2">
<h2 class="anchored" data-anchor-id="quick-overview-of-mala">Quick overview of MALA</h2>
<p>We can view MALA as a single step of the leapfrog intergrator with resampling of momentum <span class="math inline">\(p\)</span> at every step.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> To make that statement a bit more concrete, we first define the <em>extended</em> target <span class="math inline">\(\bar{\gamma}(x, p)\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\log \bar{\gamma}(x, p) \propto \log \gamma(x) + \log \gamma_{\mathcal{N}(0, M)}(p)
\end{equation*}\]</span></p>
<p>where <span class="math inline">\(\gamma_{\mathcal{N}(0, M)}\)</span> denotes the density for a zero-centered Gaussian with covariance matrix <span class="math inline">\(M\)</span>. We then consider targeting this joint distribution over both <span class="math inline">\(x\)</span> and <span class="math inline">\(p\)</span> as follows. First we define the map</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  L_{\epsilon}: \quad &amp; \mathbb{R}^d \times \mathbb{R}^d \to \mathbb{R}^d \times \mathbb{R}^d \\
  &amp; (x, p) \mapsto (\tilde{x}, \tilde{p}) := L_{\epsilon}(x, p)
\end{split}
\end{equation*}\]</span></p>
<p>as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p_{1 / 2} &amp;:= p + \frac{\epsilon}{2} \nabla \log \gamma(x) \\
  \tilde{x} &amp;:= x + \epsilon M^{-1} p_{1 /2 } \\
  p_1 &amp;:= p_{1 / 2} + \frac{\epsilon}{2} \nabla \log \gamma(\tilde{x}) \\
  \tilde{p} &amp;:= - p_1
\end{split}
\end{equation*}\]</span></p>
<p>This might be familiar for some readers as a single step of the Leapfrog integrator. We then define the MALA kernel as follows: given the current iterate <span class="math inline">\(x_i\)</span>, we sample the next iterate <span class="math inline">\(x_{i + 1}\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p &amp;\sim \mathcal{N}(0, M) \\
  (\tilde{x}, \tilde{p}) &amp;:= L_{\epsilon}(x_i, p) \\
  \alpha &amp;:= \min \left\{ 1, \frac{\bar{\gamma}(\tilde{x}, \tilde{p})}{\bar{\gamma}(x_i, p)} \right\} \\
  x_{i + 1} &amp;:=
  \begin{cases}
    \tilde{x} \quad &amp; \text{ with prob. } \alpha \\
    x_i       \quad &amp; \text{ with prob. } 1 - \alpha
  \end{cases}
\end{split}
\end{equation*}\]</span></p>
<p>i.e.&nbsp;we accept the proposal <span class="math inline">\(\tilde{x}\)</span> with probability <span class="math inline">\(\alpha\)</span> and reject it, thus sticking with our current iterate, with probability <span class="math inline">\(1 - \alpha\)</span>.</p>
</section>
<section id="what-we-need-from-a-model-logdensityproblems.jl" class="level2">
<h2 class="anchored" data-anchor-id="what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a></h2>
<p>There are a few things we need from the “target” / “model” / density that we want to sample from:</p>
<ol type="1">
<li>We need access to log-density <em>evaluations</em> <span class="math inline">\(\log \gamma(x)\)</span> so we can compute the acceptance ratio involving <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>We need access to log-density <em>gradients</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span> so we can compute the Leapfrog steps <span class="math inline">\(L_{\epsilon}(x, p)\)</span>.</li>
<li>We also need access to the “size” of the model so we can determine the size of <span class="math inline">\(M\)</span>.</li>
</ol>
<p>Luckily for us, there is a package called <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> which provides an interface for <em>exactly</em> this!</p>
<p>To demonstrate how one can implement the “<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface”<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> we will use a simple Gaussian model as an example:</p>
<div id="4" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblems</span>: LogDensityProblems;</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's define some type that represents the model.</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> IsotropicNormalModel{M<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"mean of the isotropic Gaussian"</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    mean<span class="op">::</span><span class="dt">M</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Specifies what input length the model expects.</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">dimension</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> <span class="fu">length</span>(model.mean)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Implementation of the log-density evaluation of the model.</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x<span class="op">::</span><span class="dt">AbstractVector{&lt;:Real}</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">-</span> <span class="fu">sum</span>(abs2, x <span class="op">.-</span> model.mean) <span class="op">/</span> <span class="fl">2</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This gives us all of the properties we want for our MALA sampler with the exception of the computation of the <em>gradient</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span>. There is the method <code>LogDensityProblems.logdensity_and_gradient</code> which should return a 2-tuple where the first entry is the evaluation of the logdensity <span class="math inline">\(\log \gamma(x)\)</span> and the second entry is the gradient <span class="math inline">\(\nabla \log \gamma(x)\)</span>.</p>
<p>There are two ways to “implement” this method: 1) we implement it by hand, which is feasible in the case of our <code>IsotropicNormalModel</code>, or b) we defer the implementation of this to a automatic differentiation backend.</p>
<p>To implement it by hand we can simply do</p>
<div id="6" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl that first-order, i.e. gradient information, is available.</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{1}</span>()</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Implement `logdensity_and_gradient`.</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    logγ_x <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="op">-</span>x <span class="op">.*</span> (x <span class="op">-</span> model.mean)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> logγ_x, ∇logγ_x</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s just try it out:</p>
<div id="8" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate the problem.</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> <span class="fu">IsotropicNormalModel</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.])</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create some example input that we can test on.</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>x_example <span class="op">=</span> <span class="fu">randn</span>(LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate!</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-35.41079101557165</code></pre>
</div>
</div>
<p>To defer it to an automatic differentiation backend, we can do</p>
<div id="10" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl we only have access to 0-th order information.</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{0}</span>()</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Use `LogDensityProblemsAD`'s `ADgradient` in combination with some AD backend to implement `logdensity_and_gradient`.</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblemsAD</span>, <span class="bu">ADTypes</span>, <span class="bu">ForwardDiff</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>model_with_grad <span class="op">=</span> <span class="fu">ADgradient</span>(<span class="fu">AutoForwardDiff</span>(), model)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model_with_grad, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-35.41079101557165</code></pre>
</div>
</div>
<p>We’ll continue with the second approach in this tutorial since this is typically what one does in practice, because there are better hobbies to spend time on than deriving gradients by hand.</p>
<p>At this point, one might wonder how we’re going to tie this back to Turing.jl in the end. Effectively, when working with inference methods that only require log-density evaluations and / or higher-order information of the log-density, Turing.jl actually converts the user-provided <code>Model</code> into an object implementing the above methods for <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>. As a result, most samplers provided by Turing.jl are actually implemented to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, enabling their use both <em>within</em> Turing.jl and <em>outside</em> of Turing.jl! Morever, there exists similar conversions for Stan through BridgeStan and Stan<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, which means that a sampler supporting the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface can easily be used on both Turing.jl <em>and</em> Stan models (in addition to user-provided models, as our <code>IsotropicNormalModel</code> above)!</p>
<p>Anyways, let’s move on to actually implementing the sampler.</p>
</section>
<section id="implementing-mala-in-abstractmcmc.jl" class="level2">
<h2 class="anchored" data-anchor-id="implementing-mala-in-abstractmcmc.jl">Implementing MALA in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a></h2>
<p>Now that we’ve established that a model implementing the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface provides us with all the information we need from <span class="math inline">\(\log \gamma(x)\)</span>, we can address the question: given an object that implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, how can we define a sampler for it?</p>
<p>We’re going to do this by making our sampler a sub-type of <code>AbstractMCMC.AbstractSampler</code> in addition to implementing a few methods from <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>. Why? Because it gets us <em>a lot</em> of functionality for free, as we will see later.</p>
<p>Moreover, <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> provides a very natural interface for MCMC algorithms.</p>
<p>First, we’ll define our <code>MALA</code> type</p>
<div id="12" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">AbstractMCMC</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALA{T,A} <span class="op">&lt;:</span><span class="dt"> AbstractMCMC.AbstractSampler</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"stepsize used in the leapfrog step"</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    ϵ_init<span class="op">::</span><span class="dt">T</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"covariance matrix used for the momentum"</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    M_init<span class="op">::</span><span class="dt">A</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notice how we’ve added the suffix <code>_init</code> to both the stepsize and the covariance matrix. We’ve done this because a <code>AbstractMCMC.AbstractSampler</code> should be <em>immutable</em>. Of course there might be many scenarios where we want to allow something like the stepsize and / or the covariance matrix to vary between iterations, e.g.&nbsp;during the burn-in / adaptation phase of the sampling process we might want to adjust the parameters using statistics computed from these initial iterations. But information which can change between iterations <em>should not go in the sampler itself</em>! Instead, this information should go in the sampler <em>state</em>.</p>
<p>The sampler state should at the very least contain all the necessary information to perform the next MCMC iteration, but usually contains further information, e.g.&nbsp;quantities and statistics useful for evaluating whether the sampler has converged.</p>
<p>We will use the following sampler state for our <code>MALA</code> sampler:</p>
<div id="14" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALAState{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This might seem overly redundant: we’re defining a type <code>MALAState</code> and it only contains a simple vector of reals. In this particular case we indeed could have dropped this and simply used a <code>AbstractVector{&lt;:Real}</code> as our sampler state, but typically, as we will see later, one wants to include other quantities in the sampler state. For example, if we also wanted to adapt the parameters of our <code>MALA</code>, e.g.&nbsp;alter the stepsize depending on acceptance rates, in which case we should also put <code>ϵ</code> in the state, but for now we’ll keep things simple.</p>
<p>Moreover, we also want a <em>sample</em> type, which is a type meant for “public consumption”, i.e.&nbsp;the end-user. This is generally going to contain a subset of the information present in the state. But in such a simple scenario as this, we similarly only have a <code>AbstractVector{&lt;:Real}</code>:</p>
<div id="16" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALASample{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We currently have three things:</p>
<ol type="1">
<li>A <code>AbstractMCMC.AbstractSampler</code> implementation called <code>MALA</code>.</li>
<li>A state <code>MALAState</code> for our sampler <code>MALA</code>.</li>
<li>A sample <code>MALASample</code> for our sampler <code>MALA</code>.</li>
</ol>
<p>That means that we’re ready to implement the only thing that really matters: <code>AbstractMCMC.step</code>.</p>
<p><code>AbstractMCMC.step</code> defines the MCMC iteration of our <code>MALA</code> given the current <code>MALAState</code>. Specifically, the signature of the function is as follows:</p>
<div id="18" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The RNG to ensure reproducibility.</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The model that defines our target.</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.AbstractModel</span>,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The sampler for which we're taking a `step`.</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">AbstractMCMC.AbstractSampler</span>,</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The current sampler `state`.</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    state;</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Additional keyword arguments that we may or may not need.</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Moreover, there is a specific <code>AbstractMCMC.AbstractModel</code> which is used to indicate that the model that is provided implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface: <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Since, as we discussed earlier, in our case we’re indeed going to work with types that support the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, we’ll define <code>AbstractMCMC.step</code> for such a <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Note that <code>AbstractMCMC.LogDensityModel</code> has no other purpose; it has a single field called <code>logdensity</code>, and it does nothing else. But by wrapping the model in <code>AbstractMCMC.LogDensityModel</code>, it allows samplers that want to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> to define their <code>AbstractMCMC.step</code> on this type without running into method ambiguities.</p>
<p>All in all, that means that the signature for our <code>AbstractMCMC.step</code> is going to be the following:</p>
<div id="20" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># `LogDensityModel` so we know we're working with LogDensityProblems.jl model.</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler.</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler state.</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Great! Now let’s actually implement the full <code>AbstractMCMC.step</code> for our <code>MALA</code>.</p>
<p>Let’s remind ourselves what we’re going to do:</p>
<ol type="1">
<li>Sample a new momentum <span class="math inline">\(p\)</span>.</li>
<li>Compute the log-density of the extended target <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>Take a single leapfrog step <span class="math inline">\((\tilde{x}, \tilde{p}) = L_{\epsilon}(x, p)\)</span>.</li>
<li>Accept or reject the proposed <span class="math inline">\((\tilde{x}, \tilde{p})\)</span>.</li>
</ol>
<p>All in all, this results in the following:</p>
<div id="22" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>: Random</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Distributions</span>  <span class="co"># so we get the `MvNormal`</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the wrapped model which implements LogDensityProblems.jl.</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just extract the sampler parameters to make our lives easier.</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    ϵ <span class="op">=</span> sampler.ϵ_init</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    M <span class="op">=</span> sampler.M_init</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the current parameters.</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> state.x</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sample the momentum.</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>    p_dist <span class="op">=</span> <span class="fu">MvNormal</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)), M)</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> <span class="fu">rand</span>(rng, p_dist)</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Propose using a single leapfrog step.</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>    x̃, p̃ <span class="op">=</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Accept or reject proposal.</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>    logp <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p)</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>    logp̃ <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x̃) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p̃)</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>    logα <span class="op">=</span> logp̃ <span class="op">-</span> logp</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>    state_new <span class="op">=</span> <span class="cf">if</span> <span class="fu">log</span>(<span class="fu">rand</span>(rng)) <span class="op">&lt;</span> logα</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Accept.</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x̃)</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Reject.</span></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x)</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return the "sample" and the sampler state.</span></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(state_new.x), state_new</span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Fairly straight-forward.</p>
<p>Of course, we haven’t defined the <code>leapfrog_step</code> method yet, so let’s do that:</p>
<div id="24" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p` using "position" `x`.</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x))</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    p1 <span class="op">=</span> p <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update the "position" `x` using momentum `p1`.</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    x̃ <span class="op">=</span> x <span class="op">+</span> ϵ <span class="op">.*</span> (M <span class="op">\</span> p1)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p1` using position `x̃`</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x̃ <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x̃))</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    p2 <span class="op">=</span> p1 <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x̃</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Flip momentum `p2`.</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    p̃ <span class="op">=</span> <span class="op">-</span>p2</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x̃, p̃</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>leapfrog_step (generic function with 1 method)</code></pre>
</div>
</div>
<p>With all of this, we’re technically ready to sample!</p>
<div id="26" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>, <span class="bu">LinearAlgebra</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>rng <span class="op">=</span> <span class="bu">Random</span>.<span class="fu">default_rng</span>()</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>sampler <span class="op">=</span> <span class="fu">MALA</span>(<span class="fl">1</span>, I)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>state <span class="op">=</span> <span class="fu">MALAState</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)))</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>x_next, state_next <span class="op">=</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    rng,</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    AbstractMCMC.<span class="fu">LogDensityModel</span>(model),</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    state</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>(MALASample{Vector{Float64}}([-0.968481776284132, 0.06606593468328537, 0.3760907849579927]), MALAState{Vector{Float64}}([-0.968481776284132, 0.06606593468328537, 0.3760907849579927]))</code></pre>
</div>
</div>
<p>Great, it works!</p>
<p>And I promised we would get quite some functionality for free if we implemented <code>AbstractMCMC.step</code>, and so we can now simply call <code>sample</code> to perform standard MCMC sampling:</p>
<div id="28" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform 1000 iterations with our `MALA` sampler.</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; initial_state<span class="op">=</span>state, progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Concatenate into a matrix.</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000 Matrix{Float64}:
 -2.05386  -1.75877  -3.1312    …  -5.2136    -6.0594    -6.0594
 -0.89143  -2.18772  -0.698545      0.277921  -0.809311  -0.809311
  1.0746    3.03962   6.1543        4.3114     4.07219    4.07219</code></pre>
</div>
</div>
<div id="30" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the marginal means and standard deviations.</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -4.98779     0.992866
  0.00281697  0.994193
  4.98078     1.00741</code></pre>
</div>
</div>
<p>Let’s visualize the samples</p>
<div id="32" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">StatsPlots</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">transpose</span>(samples_matrix[<span class="op">:</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">:</span><span class="kw">end</span>]), alpha<span class="op">=</span><span class="fl">0.5</span>, legend<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<!--?xml version="1.0" encoding="utf-8"?-->
<svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" width="672" height="480" viewbox="0 0 2688 1920">
<defs>
  <clippath id="clip110">
    <rect x="0" y="0" width="2688" height="1920"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip110)" d="M0 1920 L2688 1920 L2688 0 L0 0  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip111">
    <rect x="537" y="0" width="1883" height="1883"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip110)" d="M151.747 1800.78 L2640.76 1800.78 L2640.76 47.2441 L151.747 47.2441  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip112">
    <rect x="151" y="47" width="2490" height="1755"></rect>
  </clippath>
</defs>
<polyline clip-path="url(#clip112)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="219.84,1800.78 219.84,47.2441 "></polyline>
<polyline clip-path="url(#clip112)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="807.458,1800.78 807.458,47.2441 "></polyline>
<polyline clip-path="url(#clip112)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1395.08,1800.78 1395.08,47.2441 "></polyline>
<polyline clip-path="url(#clip112)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1982.69,1800.78 1982.69,47.2441 "></polyline>
<polyline clip-path="url(#clip112)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="2570.31,1800.78 2570.31,47.2441 "></polyline>
<polyline clip-path="url(#clip112)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,1502.93 2640.76,1502.93 "></polyline>
<polyline clip-path="url(#clip112)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,1202.48 2640.76,1202.48 "></polyline>
<polyline clip-path="url(#clip112)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,902.042 2640.76,902.042 "></polyline>
<polyline clip-path="url(#clip112)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,601.6 2640.76,601.6 "></polyline>
<polyline clip-path="url(#clip112)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,301.158 2640.76,301.158 "></polyline>
<polyline clip-path="url(#clip110)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1800.78 2640.76,1800.78 "></polyline>
<polyline clip-path="url(#clip110)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="219.84,1800.78 219.84,1781.88 "></polyline>
<polyline clip-path="url(#clip110)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="807.458,1800.78 807.458,1781.88 "></polyline>
<polyline clip-path="url(#clip110)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1395.08,1800.78 1395.08,1781.88 "></polyline>
<polyline clip-path="url(#clip110)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1982.69,1800.78 1982.69,1781.88 "></polyline>
<polyline clip-path="url(#clip110)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="2570.31,1800.78 2570.31,1781.88 "></polyline>
<path clip-path="url(#clip110)" d="M219.84 1834 Q216.229 1834 214.4 1837.57 Q212.595 1841.11 212.595 1848.24 Q212.595 1855.34 214.4 1858.91 Q216.229 1862.45 219.84 1862.45 Q223.474 1862.45 225.28 1858.91 Q227.108 1855.34 227.108 1848.24 Q227.108 1841.11 225.28 1837.57 Q223.474 1834 219.84 1834 M219.84 1830.3 Q225.65 1830.3 228.706 1834.9 Q231.784 1839.49 231.784 1848.24 Q231.784 1856.96 228.706 1861.57 Q225.65 1866.15 219.84 1866.15 Q214.03 1866.15 210.951 1861.57 Q207.896 1856.96 207.896 1848.24 Q207.896 1839.49 210.951 1834.9 Q214.03 1830.3 219.84 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip110)" d="M771.15 1861.55 L787.47 1861.55 L787.47 1865.48 L765.525 1865.48 L765.525 1861.55 Q768.187 1858.79 772.771 1854.16 Q777.377 1849.51 778.558 1848.17 Q780.803 1845.65 781.683 1843.91 Q782.585 1842.15 782.585 1840.46 Q782.585 1837.71 780.641 1835.97 Q778.72 1834.23 775.618 1834.23 Q773.419 1834.23 770.965 1835 Q768.535 1835.76 765.757 1837.31 L765.757 1832.59 Q768.581 1831.46 771.035 1830.88 Q773.488 1830.3 775.525 1830.3 Q780.896 1830.3 784.09 1832.98 Q787.285 1835.67 787.285 1840.16 Q787.285 1842.29 786.474 1844.21 Q785.687 1846.11 783.581 1848.7 Q783.002 1849.37 779.9 1852.59 Q776.798 1855.78 771.15 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip110)" d="M797.331 1830.92 L815.687 1830.92 L815.687 1834.86 L801.613 1834.86 L801.613 1843.33 Q802.632 1842.98 803.65 1842.82 Q804.669 1842.64 805.687 1842.64 Q811.474 1842.64 814.854 1845.81 Q818.233 1848.98 818.233 1854.4 Q818.233 1859.97 814.761 1863.08 Q811.289 1866.15 804.97 1866.15 Q802.794 1866.15 800.525 1865.78 Q798.28 1865.41 795.872 1864.67 L795.872 1859.97 Q797.956 1861.11 800.178 1861.66 Q802.4 1862.22 804.877 1862.22 Q808.882 1862.22 811.22 1860.11 Q813.558 1858.01 813.558 1854.4 Q813.558 1850.78 811.22 1848.68 Q808.882 1846.57 804.877 1846.57 Q803.002 1846.57 801.127 1846.99 Q799.275 1847.4 797.331 1848.28 L797.331 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip110)" d="M837.446 1834 Q833.835 1834 832.007 1837.57 Q830.201 1841.11 830.201 1848.24 Q830.201 1855.34 832.007 1858.91 Q833.835 1862.45 837.446 1862.45 Q841.081 1862.45 842.886 1858.91 Q844.715 1855.34 844.715 1848.24 Q844.715 1841.11 842.886 1837.57 Q841.081 1834 837.446 1834 M837.446 1830.3 Q843.256 1830.3 846.312 1834.9 Q849.391 1839.49 849.391 1848.24 Q849.391 1856.96 846.312 1861.57 Q843.256 1866.15 837.446 1866.15 Q831.636 1866.15 828.557 1861.57 Q825.502 1856.96 825.502 1848.24 Q825.502 1839.49 828.557 1834.9 Q831.636 1830.3 837.446 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip110)" d="M1354.69 1830.92 L1373.05 1830.92 L1373.05 1834.86 L1358.98 1834.86 L1358.98 1843.33 Q1360 1842.98 1361.01 1842.82 Q1362.03 1842.64 1363.05 1842.64 Q1368.84 1842.64 1372.22 1845.81 Q1375.6 1848.98 1375.6 1854.4 Q1375.6 1859.97 1372.12 1863.08 Q1368.65 1866.15 1362.33 1866.15 Q1360.16 1866.15 1357.89 1865.78 Q1355.64 1865.41 1353.24 1864.67 L1353.24 1859.97 Q1355.32 1861.11 1357.54 1861.66 Q1359.76 1862.22 1362.24 1862.22 Q1366.25 1862.22 1368.58 1860.11 Q1370.92 1858.01 1370.92 1854.4 Q1370.92 1850.78 1368.58 1848.68 Q1366.25 1846.57 1362.24 1846.57 Q1360.37 1846.57 1358.49 1846.99 Q1356.64 1847.4 1354.69 1848.28 L1354.69 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip110)" d="M1394.81 1834 Q1391.2 1834 1389.37 1837.57 Q1387.56 1841.11 1387.56 1848.24 Q1387.56 1855.34 1389.37 1858.91 Q1391.2 1862.45 1394.81 1862.45 Q1398.44 1862.45 1400.25 1858.91 Q1402.08 1855.34 1402.08 1848.24 Q1402.08 1841.11 1400.25 1837.57 Q1398.44 1834 1394.81 1834 M1394.81 1830.3 Q1400.62 1830.3 1403.68 1834.9 Q1406.75 1839.49 1406.75 1848.24 Q1406.75 1856.96 1403.68 1861.57 Q1400.62 1866.15 1394.81 1866.15 Q1389 1866.15 1385.92 1861.57 Q1382.87 1856.96 1382.87 1848.24 Q1382.87 1839.49 1385.92 1834.9 Q1389 1830.3 1394.81 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip110)" d="M1424.97 1834 Q1421.36 1834 1419.53 1837.57 Q1417.73 1841.11 1417.73 1848.24 Q1417.73 1855.34 1419.53 1858.91 Q1421.36 1862.45 1424.97 1862.45 Q1428.61 1862.45 1430.41 1858.91 Q1432.24 1855.34 1432.24 1848.24 Q1432.24 1841.11 1430.41 1837.57 Q1428.61 1834 1424.97 1834 M1424.97 1830.3 Q1430.78 1830.3 1433.84 1834.9 Q1436.92 1839.49 1436.92 1848.24 Q1436.92 1856.96 1433.84 1861.57 Q1430.78 1866.15 1424.97 1866.15 Q1419.16 1866.15 1416.08 1861.57 Q1413.03 1856.96 1413.03 1848.24 Q1413.03 1839.49 1416.08 1834.9 Q1419.16 1830.3 1424.97 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip110)" d="M1940.97 1830.92 L1963.19 1830.92 L1963.19 1832.91 L1950.65 1865.48 L1945.76 1865.48 L1957.57 1834.86 L1940.97 1834.86 L1940.97 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip110)" d="M1972.36 1830.92 L1990.71 1830.92 L1990.71 1834.86 L1976.64 1834.86 L1976.64 1843.33 Q1977.66 1842.98 1978.68 1842.82 Q1979.7 1842.64 1980.72 1842.64 Q1986.5 1842.64 1989.88 1845.81 Q1993.26 1848.98 1993.26 1854.4 Q1993.26 1859.97 1989.79 1863.08 Q1986.32 1866.15 1980 1866.15 Q1977.82 1866.15 1975.55 1865.78 Q1973.31 1865.41 1970.9 1864.67 L1970.9 1859.97 Q1972.98 1861.11 1975.21 1861.66 Q1977.43 1862.22 1979.9 1862.22 Q1983.91 1862.22 1986.25 1860.11 Q1988.59 1858.01 1988.59 1854.4 Q1988.59 1850.78 1986.25 1848.68 Q1983.91 1846.57 1979.9 1846.57 Q1978.03 1846.57 1976.15 1846.99 Q1974.3 1847.4 1972.36 1848.28 L1972.36 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip110)" d="M2012.47 1834 Q2008.86 1834 2007.03 1837.57 Q2005.23 1841.11 2005.23 1848.24 Q2005.23 1855.34 2007.03 1858.91 Q2008.86 1862.45 2012.47 1862.45 Q2016.11 1862.45 2017.91 1858.91 Q2019.74 1855.34 2019.74 1848.24 Q2019.74 1841.11 2017.91 1837.57 Q2016.11 1834 2012.47 1834 M2012.47 1830.3 Q2018.28 1830.3 2021.34 1834.9 Q2024.42 1839.49 2024.42 1848.24 Q2024.42 1856.96 2021.34 1861.57 Q2018.28 1866.15 2012.47 1866.15 Q2006.66 1866.15 2003.59 1861.57 Q2000.53 1856.96 2000.53 1848.24 Q2000.53 1839.49 2003.59 1834.9 Q2006.66 1830.3 2012.47 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip110)" d="M2514.84 1861.55 L2522.48 1861.55 L2522.48 1835.18 L2514.17 1836.85 L2514.17 1832.59 L2522.43 1830.92 L2527.11 1830.92 L2527.11 1861.55 L2534.75 1861.55 L2534.75 1865.48 L2514.84 1865.48 L2514.84 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip110)" d="M2554.19 1834 Q2550.58 1834 2548.75 1837.57 Q2546.94 1841.11 2546.94 1848.24 Q2546.94 1855.34 2548.75 1858.91 Q2550.58 1862.45 2554.19 1862.45 Q2557.82 1862.45 2559.63 1858.91 Q2561.46 1855.34 2561.46 1848.24 Q2561.46 1841.11 2559.63 1837.57 Q2557.82 1834 2554.19 1834 M2554.19 1830.3 Q2560 1830.3 2563.06 1834.9 Q2566.13 1839.49 2566.13 1848.24 Q2566.13 1856.96 2563.06 1861.57 Q2560 1866.15 2554.19 1866.15 Q2548.38 1866.15 2545.3 1861.57 Q2542.25 1856.96 2542.25 1848.24 Q2542.25 1839.49 2545.3 1834.9 Q2548.38 1830.3 2554.19 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip110)" d="M2584.35 1834 Q2580.74 1834 2578.91 1837.57 Q2577.11 1841.11 2577.11 1848.24 Q2577.11 1855.34 2578.91 1858.91 Q2580.74 1862.45 2584.35 1862.45 Q2587.99 1862.45 2589.79 1858.91 Q2591.62 1855.34 2591.62 1848.24 Q2591.62 1841.11 2589.79 1837.57 Q2587.99 1834 2584.35 1834 M2584.35 1830.3 Q2590.16 1830.3 2593.22 1834.9 Q2596.3 1839.49 2596.3 1848.24 Q2596.3 1856.96 2593.22 1861.57 Q2590.16 1866.15 2584.35 1866.15 Q2578.54 1866.15 2575.46 1861.57 Q2572.41 1856.96 2572.41 1848.24 Q2572.41 1839.49 2575.46 1834.9 Q2578.54 1830.3 2584.35 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip110)" d="M2614.51 1834 Q2610.9 1834 2609.07 1837.57 Q2607.27 1841.11 2607.27 1848.24 Q2607.27 1855.34 2609.07 1858.91 Q2610.9 1862.45 2614.51 1862.45 Q2618.15 1862.45 2619.95 1858.91 Q2621.78 1855.34 2621.78 1848.24 Q2621.78 1841.11 2619.95 1837.57 Q2618.15 1834 2614.51 1834 M2614.51 1830.3 Q2620.32 1830.3 2623.38 1834.9 Q2626.46 1839.49 2626.46 1848.24 Q2626.46 1856.96 2623.38 1861.57 Q2620.32 1866.15 2614.51 1866.15 Q2608.7 1866.15 2605.62 1861.57 Q2602.57 1856.96 2602.57 1848.24 Q2602.57 1839.49 2605.62 1834.9 Q2608.7 1830.3 2614.51 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip110)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1800.78 151.747,47.2441 "></polyline>
<polyline clip-path="url(#clip110)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1502.93 170.644,1502.93 "></polyline>
<polyline clip-path="url(#clip110)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1202.48 170.644,1202.48 "></polyline>
<polyline clip-path="url(#clip110)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,902.042 170.644,902.042 "></polyline>
<polyline clip-path="url(#clip110)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,601.6 170.644,601.6 "></polyline>
<polyline clip-path="url(#clip110)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,301.158 170.644,301.158 "></polyline>
<path clip-path="url(#clip110)" d="M49.5521 1503.38 L79.2279 1503.38 L79.2279 1507.31 L49.5521 1507.31 L49.5521 1503.38 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip110)" d="M99.8991 1501.06 Q96.7509 1501.06 94.8991 1503.21 Q93.0704 1505.37 93.0704 1509.12 Q93.0704 1512.84 94.8991 1515.02 Q96.7509 1517.17 99.8991 1517.17 Q103.047 1517.17 104.876 1515.02 Q106.728 1512.84 106.728 1509.12 Q106.728 1505.37 104.876 1503.21 Q103.047 1501.06 99.8991 1501.06 M109.181 1486.41 L109.181 1490.67 Q107.422 1489.84 105.617 1489.4 Q103.834 1488.96 102.075 1488.96 Q97.4454 1488.96 94.9917 1492.08 Q92.5612 1495.21 92.2139 1501.52 Q93.5797 1499.51 95.6398 1498.45 Q97.7 1497.36 100.177 1497.36 Q105.385 1497.36 108.394 1500.53 Q111.427 1503.68 111.427 1509.12 Q111.427 1514.44 108.279 1517.66 Q105.131 1520.88 99.8991 1520.88 Q93.9037 1520.88 90.7325 1516.29 Q87.5612 1511.69 87.5612 1502.96 Q87.5612 1494.77 91.45 1489.9 Q95.3389 1485.02 101.89 1485.02 Q103.649 1485.02 105.431 1485.37 Q107.237 1485.71 109.181 1486.41 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip110)" d="M50.3623 1202.93 L80.0381 1202.93 L80.0381 1206.87 L50.3623 1206.87 L50.3623 1202.93 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip110)" d="M104.297 1201.13 Q107.654 1201.85 109.529 1204.12 Q111.427 1206.38 111.427 1209.72 Q111.427 1214.83 107.908 1217.63 Q104.39 1220.43 97.9083 1220.43 Q95.7324 1220.43 93.4176 1219.99 Q91.126 1219.58 88.6723 1218.72 L88.6723 1214.21 Q90.6167 1215.34 92.9315 1215.92 Q95.2463 1216.5 97.7695 1216.5 Q102.168 1216.5 104.459 1214.76 Q106.774 1213.03 106.774 1209.72 Q106.774 1206.66 104.621 1204.95 Q102.492 1203.21 98.6722 1203.21 L94.6445 1203.21 L94.6445 1199.37 L98.8574 1199.37 Q102.306 1199.37 104.135 1198 Q105.964 1196.62 105.964 1194.02 Q105.964 1191.36 104.066 1189.95 Q102.191 1188.51 98.6722 1188.51 Q96.7509 1188.51 94.5519 1188.93 Q92.3528 1189.35 89.7139 1190.23 L89.7139 1186.06 Q92.376 1185.32 94.6908 1184.95 Q97.0287 1184.58 99.0889 1184.58 Q104.413 1184.58 107.515 1187.01 Q110.617 1189.42 110.617 1193.54 Q110.617 1196.41 108.973 1198.4 Q107.33 1200.37 104.297 1201.13 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip110)" d="M99.4824 887.84 Q95.8713 887.84 94.0426 891.405 Q92.2371 894.947 92.2371 902.076 Q92.2371 909.183 94.0426 912.748 Q95.8713 916.289 99.4824 916.289 Q103.117 916.289 104.922 912.748 Q106.751 909.183 106.751 902.076 Q106.751 894.947 104.922 891.405 Q103.117 887.84 99.4824 887.84 M99.4824 884.137 Q105.293 884.137 108.348 888.743 Q111.427 893.326 111.427 902.076 Q111.427 910.803 108.348 915.41 Q105.293 919.993 99.4824 919.993 Q93.6723 919.993 90.5936 915.41 Q87.538 910.803 87.538 902.076 Q87.538 893.326 90.5936 888.743 Q93.6723 884.137 99.4824 884.137 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip110)" d="M104.297 600.245 Q107.654 600.963 109.529 603.232 Q111.427 605.5 111.427 608.833 Q111.427 613.949 107.908 616.75 Q104.39 619.551 97.9083 619.551 Q95.7324 619.551 93.4176 619.111 Q91.126 618.694 88.6723 617.838 L88.6723 613.324 Q90.6167 614.458 92.9315 615.037 Q95.2463 615.616 97.7695 615.616 Q102.168 615.616 104.459 613.88 Q106.774 612.144 106.774 608.833 Q106.774 605.778 104.621 604.065 Q102.492 602.329 98.6722 602.329 L94.6445 602.329 L94.6445 598.486 L98.8574 598.486 Q102.306 598.486 104.135 597.12 Q105.964 595.732 105.964 593.139 Q105.964 590.477 104.066 589.065 Q102.191 587.63 98.6722 587.63 Q96.7509 587.63 94.5519 588.046 Q92.3528 588.463 89.7139 589.343 L89.7139 585.176 Q92.376 584.435 94.6908 584.065 Q97.0287 583.695 99.0889 583.695 Q104.413 583.695 107.515 586.125 Q110.617 588.533 110.617 592.653 Q110.617 595.523 108.973 597.514 Q107.33 599.482 104.297 600.245 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip110)" d="M99.8991 299.294 Q96.7509 299.294 94.8991 301.447 Q93.0704 303.6 93.0704 307.35 Q93.0704 311.077 94.8991 313.253 Q96.7509 315.405 99.8991 315.405 Q103.047 315.405 104.876 313.253 Q106.728 311.077 106.728 307.35 Q106.728 303.6 104.876 301.447 Q103.047 299.294 99.8991 299.294 M109.181 284.642 L109.181 288.901 Q107.422 288.067 105.617 287.628 Q103.834 287.188 102.075 287.188 Q97.4454 287.188 94.9917 290.313 Q92.5612 293.438 92.2139 299.757 Q93.5797 297.743 95.6398 296.679 Q97.7 295.591 100.177 295.591 Q105.385 295.591 108.394 298.762 Q111.427 301.91 111.427 307.35 Q111.427 312.674 108.279 315.891 Q105.131 319.109 99.8991 319.109 Q93.9037 319.109 90.7325 314.526 Q87.5612 309.919 87.5612 301.192 Q87.5612 292.998 91.45 288.137 Q95.3389 283.253 101.89 283.253 Q103.649 283.253 105.431 283.6 Q107.237 283.947 109.181 284.642 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip112)" style="stroke:#009af9; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,1107.73 224.541,1425.07 226.891,1225.35 229.242,1193.73 231.592,1319.26 233.943,1352.73 236.293,1411.11 238.644,1389.75 240.994,1370.54 243.345,1263.38 245.695,1501.29 248.046,1423.77 250.396,1254.7 252.747,1247.79 255.097,1350.7 257.448,1377.16 259.798,1276.24 262.148,1386.03 264.499,1538.77 266.849,1261.54 269.2,1286.32 271.55,1452.2 273.901,1317.34 276.251,1508.1 278.602,1275.95 280.952,1388.39 283.303,1366.52 285.653,1508.41 288.004,1269.67 290.354,1258.51 292.705,1550.73 295.055,1413.38 297.406,1512.96 299.756,1442.84 302.107,1490.21 304.457,1460.89 306.807,1366.58 309.158,1234.02 311.508,1424.17 313.859,1502.34 316.209,1473.99 318.56,1246.11 320.91,1430.6 323.261,1295.59 325.611,1412.28 327.962,1340.05 330.312,1580.21 332.663,1467.62 335.013,1289.22 337.364,1567.72 339.714,1427.08 342.065,1439.68 344.415,1480.22 346.765,1296.46 349.116,1526.75 351.466,1510.69 353.817,1463.98 356.167,1601.52 358.518,1531.15 360.868,1438.44 363.219,1424.61 365.569,1388.44 367.92,1442.71 370.27,1504.7 372.621,1452.57 374.971,1211.49 377.322,1523.54 379.672,1510.15 382.023,1448.83 384.373,1379.82 386.724,1458.94 389.074,1411.92 391.424,1443.66 393.775,1359.59 396.125,1459.2 398.476,1530.87 400.826,1404.61 403.177,1443.47 405.527,1477.78 407.878,1591.28 410.228,1368.71 412.579,1207.66 414.929,1425.22 417.28,1440.92 419.63,1533.92 421.981,1553.27 424.331,1346.57 426.682,1500.64 429.032,1344.02 431.382,1336.72 433.733,1375.03 436.083,1417.43 438.434,1470.33 440.784,1250.33 443.135,1396.01 445.485,1462.47 447.836,1497.49 450.186,1434.24 452.537,1347.33 454.887,1337 457.238,1476.46 459.588,1363.39 461.939,1534.38 464.289,1305.02 466.64,1385.22 468.99,1351.24 471.341,1443.97 473.691,1512.34 476.041,1362.4 478.392,1276.55 480.742,1524.8 483.093,1542.35 485.443,1319.48 487.794,1546.09 490.144,1361.71 492.495,1496.34 494.845,1364.04 497.196,1463.36 499.546,1470.81 501.897,1634.26 504.247,1521.58 506.598,1322.71 508.948,1521.94 511.299,1471.9 513.649,1501 515.999,1249.42 518.35,1453.38 520.7,1285.03 523.051,1354.21 525.401,1316.52 527.752,1453.72 530.102,1576.39 532.453,1309.92 534.803,1383.33 537.154,1357.15 539.504,1348.7 541.855,1434.02 544.205,1405.15 546.556,1454.01 548.906,1407.15 551.257,1251.09 553.607,1485.23 555.958,1391.78 558.308,1264.24 560.658,1388.16 563.009,1275.89 565.359,1228.42 567.71,1348.82 570.06,1433.89 572.411,1344.13 574.761,1501.75 577.112,1436.92 579.462,1581.91 581.813,1375.33 584.163,1305.67 586.514,1315.58 588.864,1487.54 591.215,1303.96 593.565,1412.52 595.916,1483.38 598.266,1651.24 600.616,1595.78 602.967,1270.98 605.317,1369.99 607.668,1406.65 610.018,1315.31 612.369,1542.94 614.719,1539.18 617.07,1625.44 619.42,1481.8 621.771,1517.41 624.121,1433.72 626.472,1315.26 628.822,1262.18 631.173,1516.41 633.523,1483.83 635.874,1325.4 638.224,1354.24 640.575,1424.41 642.925,1224.89 645.275,1297.63 647.626,1497.68 649.976,1332.2 652.327,1356.61 654.677,1447.73 657.028,1043.36 659.378,1581.46 661.729,1454.05 664.079,1384.87 666.43,1314.69 668.78,1439.45 671.131,1192.78 673.481,1434.14 675.832,1337.34 678.182,1411.54 680.533,1379.29 682.883,1407.75 685.233,1494.28 687.584,1448.36 689.934,1261.62 692.285,1525.73 694.635,1112.83 696.986,1475.11 699.336,1515.77 701.687,1455.36 704.037,1370.73 706.388,1503.14 708.738,1437.26 711.089,1360.06 713.439,1474.18 715.79,1475.41 718.14,1452.72 720.491,1578.29 722.841,1412.43 725.192,1481 727.542,1342.46 729.892,1377.79 732.243,1385.51 734.593,1265.8 736.944,1493.42 739.294,1390.31 741.645,1459.86 743.995,1549.72 746.346,1288.65 748.696,1434.8 751.047,1501.1 753.397,1235.79 755.748,1354.96 758.098,1369.45 760.449,1328.73 762.799,1441.03 765.15,1476.01 767.5,1428.68 769.85,1389.14 772.201,1354.44 774.551,1357.21 776.902,1562.23 779.252,1429.88 781.603,1459.96 783.953,1266.32 786.304,1326.13 788.654,1301.82 791.005,1492.89 793.355,1456.23 795.706,1295.83 798.056,1499.75 800.407,1486.55 802.757,1412.8 805.108,1485.65 807.458,1458.67 809.809,1494.17 812.159,1433.49 814.509,1462.25 816.86,1557.28 819.21,1467.43 821.561,1311.44 823.911,1550.01 826.262,1284.47 828.612,1297.99 830.963,1474.17 833.313,1157 835.664,1441.38 838.014,1435.37 840.365,1258.44 842.715,1440.47 845.066,1502.29 847.416,1208.05 849.767,1482.41 852.117,1375.5 854.467,1552.43 856.818,1456.67 859.168,1307.16 861.519,1447.23 863.869,1284.96 866.22,1575.61 868.57,1234.79 870.921,1492.53 873.271,1511.61 875.622,1342.31 877.972,1341.82 880.323,1444.1 882.673,1277.76 885.024,1517.58 887.374,1447.59 889.725,1543.43 892.075,1383.74 894.426,1247.28 896.776,1404.72 899.126,1288.53 901.477,1395.82 903.827,1488.85 906.178,1188.75 908.528,1488.33 910.879,1487.7 913.229,1594.96 915.58,1412.05 917.93,1427.56 920.281,1383.78 922.631,1498.54 924.982,1531.99 927.332,1336.98 929.683,1374.47 932.033,1515.01 934.384,1338.29 936.734,1505.27 939.084,1257.54 941.435,1339.66 943.785,1428.65 946.136,1321.57 948.486,1303.31 950.837,1514.71 953.187,1310.34 955.538,1452.06 957.888,1324.46 960.239,1369.02 962.589,1217.36 964.94,1483.83 967.29,1446.84 969.641,1502.98 971.991,1551.22 974.342,1505.67 976.692,1366.75 979.043,1614.06 981.393,1448.33 983.743,1501.64 986.094,1335.99 988.444,1554.01 990.795,1544.2 993.145,1355.82 995.496,1200.7 997.846,1389.14 1000.2,1418 1002.55,1253.65 1004.9,1375.49 1007.25,1452.97 1009.6,1340.47 1011.95,1352.15 1014.3,1544.73 1016.65,1486.07 1019,1459.82 1021.35,1301.64 1023.7,1316.66 1026.05,1488.96 1028.4,1462.16 1030.75,1345.27 1033.1,1425.27 1035.45,1332.49 1037.8,1442.45 1040.15,1334.13 1042.51,1412.34 1044.86,1505.37 1047.21,1357.41 1049.56,1305.61 1051.91,1454.54 1054.26,1552.61 1056.61,1502.22 1058.96,1400 1061.31,1567.81 1063.66,1270.23 1066.01,1493.48 1068.36,1302.03 1070.71,1437.46 1073.06,1474.38 1075.41,1493.49 1077.76,1563.2 1080.11,1526.86 1082.46,1412.91 1084.81,1258.82 1087.16,1471.84 1089.51,1282.4 1091.87,1272.22 1094.22,1416.47 1096.57,1751.15 1098.92,1335.57 1101.27,1342.69 1103.62,1320.36 1105.97,1398.29 1108.32,1515.04 1110.67,1517.83 1113.02,1320.93 1115.37,1401.49 1117.72,1498.98 1120.07,1362.94 1122.42,1436.64 1124.77,1288.05 1127.12,1303.53 1129.47,1385.5 1131.82,1454.99 1134.17,1276.16 1136.52,1323.01 1138.87,1389.08 1141.23,1499.14 1143.58,1306.16 1145.93,1322.79 1148.28,1355.64 1150.63,1328.94 1152.98,1250.04 1155.33,1280.83 1157.68,1432.85 1160.03,1394.19 1162.38,1431.91 1164.73,1293.06 1167.08,1408.18 1169.43,1475.62 1171.78,1559.65 1174.13,1450.52 1176.48,1383.66 1178.83,1446.49 1181.18,1550.07 1183.53,1494.54 1185.88,1512.44 1188.23,1355.07 1190.59,1411.34 1192.94,1395.53 1195.29,1345.31 1197.64,1443.54 1199.99,1379 1202.34,1337.28 1204.69,1458.68 1207.04,1498.88 1209.39,1285.19 1211.74,1365.42 1214.09,1340.46 1216.44,1320.05 1218.79,1608.53 1221.14,1445.38 1223.49,1187.01 1225.84,1574.21 1228.19,1365.61 1230.54,1416.85 1232.89,1281.61 1235.24,1389.19 1237.59,1520.16 1239.94,1606.6 1242.3,1509.68 1244.65,1329.77 1247,1314.43 1249.35,1317.53 1251.7,1387.44 1254.05,1481.38 1256.4,1296.15 1258.75,1454.35 1261.1,1278.09 1263.45,1222.96 1265.8,1307.59 1268.15,1491.53 1270.5,1268.77 1272.85,1243.65 1275.2,1319.86 1277.55,1366.28 1279.9,1237.51 1282.25,1232.11 1284.6,1433.11 1286.95,1204.19 1289.3,1456.79 1291.66,1395.9 1294.01,1297.69 1296.36,1386.1 1298.71,1402.88 1301.06,1441.19 1303.41,1313.61 1305.76,1419.81 1308.11,1257.31 1310.46,1347.65 1312.81,1615.05 1315.16,1254.92 1317.51,1438.08 1319.86,1352.88 1322.21,1573.98 1324.56,1331.56 1326.91,1347.93 1329.26,1423.43 1331.61,1454.21 1333.96,1435.48 1336.31,1546.61 1338.66,1264.65 1341.02,1412.26 1343.37,1400.39 1345.72,1366.8 1348.07,1411.88 1350.42,1546.01 1352.77,1354.12 1355.12,1549.9 1357.47,1294.98 1359.82,1457.54 1362.17,1279.7 1364.52,1254.42 1366.87,1401.56 1369.22,1308.4 1371.57,1419.41 1373.92,1352.38 1376.27,1244.72 1378.62,1475.91 1380.97,1402.19 1383.32,1385.39 1385.67,1394.49 1388.02,1410.16 1390.38,1466.42 1392.73,1473.23 1395.08,1412.39 1397.43,1192.05 1399.78,1346.28 1402.13,1337.68 1404.48,1507.57 1406.83,1399.64 1409.18,1425.55 1411.53,1318.19 1413.88,1541.71 1416.23,1414.86 1418.58,1471.87 1420.93,1317.26 1423.28,1437.31 1425.63,1360.81 1427.98,1282 1430.33,1306.23 1432.68,1516.8 1435.03,1567.34 1437.38,1443.54 1439.74,1421.16 1442.09,1302.59 1444.44,1481.98 1446.79,1437.01 1449.14,1379.9 1451.49,1398.88 1453.84,1235.4 1456.19,1403.63 1458.54,1358.54 1460.89,1494.13 1463.24,1216.34 1465.59,1436.97 1467.94,1397.54 1470.29,1272.55 1472.64,1311.01 1474.99,1554.74 1477.34,1354.07 1479.69,1508.1 1482.04,1502.87 1484.39,1334.77 1486.74,1310.29 1489.1,1420.34 1491.45,1439.58 1493.8,1259.38 1496.15,1337.45 1498.5,1393.8 1500.85,1434.1 1503.2,1368.1 1505.55,1272.06 1507.9,1285.12 1510.25,1345.8 1512.6,1399.55 1514.95,1378.26 1517.3,1468.52 1519.65,1473.8 1522,1371.82 1524.35,1470.79 1526.7,1425.88 1529.05,1472.64 1531.4,1313.27 1533.75,1274.95 1536.1,1309 1538.45,1540.64 1540.81,1339.37 1543.16,1479.48 1545.51,1306.62 1547.86,1345.98 1550.21,1255.23 1552.56,1322.22 1554.91,1385.96 1557.26,1287.39 1559.61,1389.73 1561.96,1228.85 1564.31,1207.47 1566.66,1473.08 1569.01,1408.64 1571.36,1455.06 1573.71,1217.61 1576.06,1259.48 1578.41,1424.28 1580.76,1329.54 1583.11,1308.74 1585.46,1409.82 1587.81,1304.3 1590.17,1541.13 1592.52,1370.02 1594.87,1494 1597.22,1336.68 1599.57,1486.49 1601.92,1254.3 1604.27,1566.15 1606.62,1349.24 1608.97,1501.03 1611.32,1351.45 1613.67,1393.43 1616.02,1346.79 1618.37,1658.61 1620.72,1510.94 1623.07,1657.53 1625.42,1456.88 1627.77,1453.35 1630.12,1289.99 1632.47,1321.18 1634.82,1458.41 1637.17,1412.69 1639.53,1562.92 1641.88,1427.44 1644.23,1439.08 1646.58,1435.47 1648.93,1382.47 1651.28,1346.93 1653.63,1392.58 1655.98,1427.82 1658.33,1392.29 1660.68,1437.35 1663.03,1252.57 1665.38,1477.19 1667.73,1411.27 1670.08,1603.25 1672.43,1236.54 1674.78,1207.24 1677.13,1558.9 1679.48,1325.15 1681.83,1492.69 1684.18,1505.24 1686.53,1171.6 1688.89,1490.71 1691.24,1523.3 1693.59,1430.01 1695.94,1189.59 1698.29,1455.05 1700.64,1190.45 1702.99,1348.33 1705.34,1252.8 1707.69,1525.5 1710.04,1396.73 1712.39,1291.83 1714.74,1262.18 1717.09,1390.24 1719.44,1394.12 1721.79,1519.44 1724.14,1454.24 1726.49,1509.59 1728.84,1298.34 1731.19,1462.97 1733.54,1407.8 1735.89,1598.28 1738.25,1238.89 1740.6,1361.67 1742.95,1444.67 1745.3,1443.34 1747.65,1386.65 1750,1422.84 1752.35,1405.71 1754.7,1467.13 1757.05,1319.2 1759.4,1368.12 1761.75,1570.38 1764.1,1436.15 1766.45,1316.27 1768.8,1361.45 1771.15,1403.29 1773.5,1534.66 1775.85,1336.35 1778.2,1562.85 1780.55,1403.38 1782.9,1495.37 1785.25,1270.59 1787.6,1336.9 1789.96,1454.6 1792.31,1400.64 1794.66,1210.06 1797.01,1409.21 1799.36,1372.49 1801.71,1485.06 1804.06,1485.64 1806.41,1284.22 1808.76,1287.03 1811.11,1395 1813.46,1356.8 1815.81,1241.59 1818.16,1429.79 1820.51,1405.59 1822.86,1315.25 1825.21,1469.95 1827.56,1487.07 1829.91,1349.36 1832.26,1481.33 1834.61,1293.28 1836.96,1362.27 1839.32,1360.43 1841.67,1361.52 1844.02,1368.45 1846.37,1363.69 1848.72,1424.59 1851.07,1432.72 1853.42,1288.36 1855.77,1396.81 1858.12,1457.31 1860.47,1549.98 1862.82,1406.3 1865.17,1482.88 1867.52,1429.7 1869.87,1344.45 1872.22,1232.57 1874.57,1458.6 1876.92,1306.99 1879.27,1420.72 1881.62,1290.98 1883.97,1488.25 1886.32,1260.03 1888.68,1464.31 1891.03,1369.15 1893.38,1357.84 1895.73,1225.91 1898.08,1422.79 1900.43,1388.29 1902.78,1531.79 1905.13,1359.36 1907.48,1374.98 1909.83,1303.58 1912.18,1346.66 1914.53,1315.65 1916.88,1363.42 1919.23,1307.69 1921.58,1344.71 1923.93,1473.77 1926.28,1379.05 1928.63,1346 1930.98,1212.76 1933.33,1437.16 1935.68,1462.77 1938.04,1594.28 1940.39,1421.3 1942.74,1536.29 1945.09,1289.73 1947.44,1508.88 1949.79,1261.07 1952.14,1531.5 1954.49,1321.62 1956.84,1453.45 1959.19,1502.63 1961.54,1268.56 1963.89,1413.35 1966.24,1522.06 1968.59,1337.75 1970.94,1348.87 1973.29,1385.87 1975.64,1285.02 1977.99,1348.55 1980.34,1470.28 1982.69,1109.02 1985.04,1484.16 1987.4,1266.99 1989.75,1444.6 1992.1,1432.1 1994.45,1289.23 1996.8,1571.79 1999.15,1291.45 2001.5,1494.93 2003.85,1367.54 2006.2,1302.63 2008.55,1559.06 2010.9,1241.73 2013.25,1513 2015.6,1463.69 2017.95,1376.62 2020.3,1312.85 2022.65,1534.87 2025,1472.76 2027.35,1353.77 2029.7,1566.13 2032.05,1387.12 2034.4,1356.34 2036.76,1422.27 2039.11,1604.84 2041.46,1582.68 2043.81,1419.97 2046.16,1518.18 2048.51,1449.03 2050.86,1331.02 2053.21,1386.04 2055.56,1336.59 2057.91,1468.5 2060.26,1427.71 2062.61,1564.41 2064.96,1486.12 2067.31,1536.84 2069.66,1253.03 2072.01,1478.86 2074.36,1364.73 2076.71,1422.32 2079.06,1342.45 2081.41,1669.3 2083.76,1341.62 2086.11,1465.36 2088.47,1327.88 2090.82,1402.62 2093.17,1262.96 2095.52,1518.43 2097.87,1337.88 2100.22,1429.76 2102.57,1520.1 2104.92,1445.39 2107.27,1491.15 2109.62,1354.55 2111.97,1458.78 2114.32,1424.18 2116.67,1491.46 2119.02,1593.16 2121.37,1416.34 2123.72,1247.65 2126.07,1271.93 2128.42,1433.4 2130.77,1296.32 2133.12,1544.71 2135.47,1348.39 2137.83,1334.14 2140.18,1420.26 2142.53,1403.15 2144.88,1279.51 2147.23,1403.05 2149.58,1461.2 2151.93,1430.68 2154.28,1317.28 2156.63,1430.55 2158.98,1268.5 2161.33,1422.33 2163.68,1464.5 2166.03,1331.99 2168.38,1300.08 2170.73,1396.86 2173.08,1444.84 2175.43,1294.52 2177.78,1407.15 2180.13,1397.04 2182.48,1495.73 2184.83,1373.75 2187.19,1269.13 2189.54,1476.95 2191.89,1427.66 2194.24,1515.52 2196.59,1284.08 2198.94,1343.72 2201.29,1330.13 2203.64,1410.99 2205.99,1473.29 2208.34,1321.4 2210.69,1521.69 2213.04,1376.12 2215.39,1468.64 2217.74,1388.12 2220.09,1566.77 2222.44,1445.91 2224.79,1511.36 2227.14,1306.47 2229.49,1391.4 2231.84,1404.08 2234.19,1307.81 2236.55,1418.11 2238.9,1450.78 2241.25,1288.96 2243.6,1478.71 2245.95,1445.24 2248.3,1458.36 2250.65,1377.8 2253,1247.95 2255.35,1342.47 2257.7,1352.78 2260.05,1545.67 2262.4,1132.86 2264.75,1421.8 2267.1,1489.1 2269.45,1318.35 2271.8,1531.1 2274.15,1392.72 2276.5,1348.78 2278.85,1489.85 2281.2,1596.37 2283.55,1479.32 2285.91,1458.84 2288.26,1197.34 2290.61,1433.42 2292.96,1448.15 2295.31,1397.01 2297.66,1524.81 2300.01,1404.17 2302.36,1453.39 2304.71,1398.59 2307.06,1328.58 2309.41,1291.98 2311.76,1456.95 2314.11,1221.1 2316.46,1373.61 2318.81,1453.88 2321.16,1427.69 2323.51,1255.39 2325.86,1456.48 2328.21,1411.35 2330.56,1481.37 2332.91,1300.06 2335.27,1405.09 2337.62,1515.08 2339.97,1375.89 2342.32,1339.53 2344.67,1429.71 2347.02,1372.67 2349.37,1341.44 2351.72,1358.85 2354.07,1468.26 2356.42,1475.65 2358.77,1547.92 2361.12,1268.21 2363.47,1568.48 2365.82,1408.42 2368.17,1382.38 2370.52,1458.64 2372.87,1365.39 2375.22,1340.07 2377.57,1283.13 2379.92,1451.56 2382.27,1285.37 2384.62,1413.17 2386.98,1365.19 2389.33,1484.62 2391.68,1397.18 2394.03,1394.43 2396.38,1379.08 2398.73,1384.09 2401.08,1355.04 2403.43,1370.99 2405.78,1284.58 2408.13,1466.35 2410.48,1419.28 2412.83,1483.82 2415.18,1352.71 2417.53,1445.41 2419.88,1118.14 2422.23,1346.52 2424.58,1419.65 2426.93,1356.54 2429.28,1395.19 2431.63,1426.97 2433.98,1300.75 2436.34,1338.9 2438.69,1315.38 2441.04,1285.88 2443.39,1238.01 2445.74,1488.94 2448.09,1361.26 2450.44,1414.63 2452.79,1666.61 2455.14,1296.75 2457.49,1311.98 2459.84,1337.43 2462.19,1448.69 2464.54,1329.14 2466.89,1232.04 2469.24,1478 2471.59,1389.77 2473.94,1192.9 2476.29,1341.7 2478.64,1362.73 2480.99,1436.7 2483.34,1379.78 2485.7,1429.76 2488.05,1183.76 2490.4,1276.56 2492.75,1383.87 2495.1,1339.23 2497.45,1314.36 2499.8,1376.01 2502.15,1276.43 2504.5,1340.48 2506.85,1365.06 2509.2,1393.8 2511.55,1319.25 2513.9,1385.17 2516.25,1269.84 2518.6,1716.18 2520.95,1465.75 2523.3,1401.97 2525.65,1393.08 2528,1478.23 2530.35,1445.16 2532.7,1390.13 2535.06,1443.34 2537.41,1517.36 2539.76,1476.66 2542.11,1268.86 2544.46,1194.49 2546.81,1513.47 2549.16,1375.89 2551.51,1289.7 2553.86,1390.62 2556.21,1474.01 2558.56,1525.06 2560.91,1535.57 2563.26,1415.48 2565.61,1203.39 2567.96,1423.15 2570.31,1473.72 "></polyline>
<polyline clip-path="url(#clip112)" style="stroke:#e26f46; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,991.316 224.541,954.342 226.891,886.475 229.242,943.081 231.592,834.478 233.943,978.585 236.293,744.211 238.644,996.24 240.994,777.569 243.345,962.816 245.695,1062.85 248.046,1005.44 250.396,957.484 252.747,932.764 255.097,912.358 257.448,854.395 259.798,879.293 262.148,889.672 264.499,878.316 266.849,903.236 269.2,900.074 271.55,1006.71 273.901,913.001 276.251,895.066 278.602,925.045 280.952,998.69 283.303,963.593 285.653,752.724 288.004,841.565 290.354,835.948 292.705,825.28 295.055,676.992 297.406,962.462 299.756,1096.38 302.107,953.916 304.457,1046.83 306.807,1053.15 309.158,847.397 311.508,711.038 313.859,801.136 316.209,937.586 318.56,806.498 320.91,920.084 323.261,884.85 325.611,945.963 327.962,617.427 330.312,974.204 332.663,923.132 335.013,985.986 337.364,942.773 339.714,854.866 342.065,554.205 344.415,856.761 346.765,920.535 349.116,793.47 351.466,1086.16 353.817,938.406 356.167,1007.04 358.518,939.939 360.868,890.187 363.219,890.034 365.569,974.264 367.92,889.611 370.27,851.114 372.621,695.746 374.971,806.629 377.322,990.878 379.672,922.57 382.023,900.352 384.373,818.426 386.724,827.875 389.074,814.76 391.424,907.76 393.775,1022.25 396.125,761.045 398.476,948.994 400.826,960.077 403.177,1033.69 405.527,827.281 407.878,930.641 410.228,788.513 412.579,897.507 414.929,964.976 417.28,877.14 419.63,981.593 421.981,701.475 424.331,929.017 426.682,984.559 429.032,892.415 431.382,993.491 433.733,721.892 436.083,716.826 438.434,817.281 440.784,830.471 443.135,1003.7 445.485,1130.43 447.836,859.315 450.186,881.061 452.537,914.451 454.887,1006.4 457.238,923.489 459.588,890.765 461.939,888.831 464.289,838.623 466.64,954.713 468.99,772.731 471.341,776.814 473.691,695.25 476.041,971.162 478.392,912.872 480.742,1044.19 483.093,949.664 485.443,903.997 487.794,839.273 490.144,900.36 492.495,848.399 494.845,998.472 497.196,873.751 499.546,1070.88 501.897,952.098 504.247,941.014 506.598,916.531 508.948,770.134 511.299,906.491 513.649,834.45 515.999,794.43 518.35,1005.27 520.7,838.275 523.051,742.432 525.401,901.776 527.752,1033.6 530.102,1000.07 532.453,953.741 534.803,1015.2 537.154,1137.37 539.504,930.737 541.855,637.58 544.205,917.706 546.556,738.694 548.906,934.271 551.257,960.549 553.607,951.938 555.958,929.803 558.308,883.05 560.658,962.953 563.009,960.495 565.359,980.735 567.71,843.885 570.06,686.769 572.411,817.948 574.761,811.04 577.112,908.836 579.462,929.941 581.813,818.052 584.163,763.593 586.514,1055.64 588.864,700.42 591.215,785.869 593.565,923.789 595.916,778.846 598.266,976.024 600.616,742.296 602.967,864.884 605.317,823.594 607.668,877.972 610.018,826.365 612.369,932.34 614.719,895.355 617.07,889.634 619.42,742.372 621.771,930.51 624.121,856.31 626.472,1062.38 628.822,901.141 631.173,715.708 633.523,1003.24 635.874,800.135 638.224,928.425 640.575,968.607 642.925,927.153 645.275,1049.97 647.626,1007.58 649.976,947.899 652.327,861.223 654.677,837.874 657.028,1013.4 659.378,843.596 661.729,789.305 664.079,997.887 666.43,1006.21 668.78,1010.09 671.131,760.302 673.481,1163.37 675.832,911.272 678.182,1024 680.533,963.178 682.883,956.244 685.233,760.928 687.584,946.146 689.934,950.855 692.285,910.441 694.635,1005.03 696.986,940.097 699.336,928.858 701.687,987.972 704.037,929.306 706.388,987.532 708.738,1132.99 711.089,885.237 713.439,996.688 715.79,911.324 718.14,992.034 720.491,779.925 722.841,876.562 725.192,1031.82 727.542,891.881 729.892,939.763 732.243,978.175 734.593,995.675 736.944,930.352 739.294,925.115 741.645,761.378 743.995,937.496 746.346,793.853 748.696,799.966 751.047,948.846 753.397,795.815 755.748,864.119 758.098,990.138 760.449,867.666 762.799,832.229 765.15,1032.84 767.5,838.906 769.85,1112.63 772.201,916.668 774.551,881.878 776.902,1101.05 779.252,907.687 781.603,688.977 783.953,716.794 786.304,920.983 788.654,769.701 791.005,762.579 793.355,883.711 795.706,1015.09 798.056,1011.54 800.407,920.829 802.757,1085.69 805.108,1000.56 807.458,1002.05 809.809,715.119 812.159,869.48 814.509,811.589 816.86,1005.24 819.21,834.791 821.561,1003.35 823.911,936.491 826.262,939.675 828.612,906.564 830.963,909.22 833.313,914.008 835.664,782.786 838.014,862.005 840.365,874.741 842.715,727.812 845.066,954.456 847.416,931.604 849.767,1003.82 852.117,856.776 854.467,888.131 856.818,1220.51 859.168,1081.67 861.519,1010.86 863.869,777.242 866.22,747.8 868.57,931.774 870.921,1105.82 873.271,901.402 875.622,750.745 877.972,995.505 880.323,814.239 882.673,858.478 885.024,658.82 887.374,859.936 889.725,860.302 892.075,698.202 894.426,1027.93 896.776,869.92 899.126,927.363 901.477,770.666 903.827,948.697 906.178,743.829 908.528,940.033 910.879,846.056 913.229,875.042 915.58,803.827 917.93,915.733 920.281,900.54 922.631,938.838 924.982,828.01 927.332,652.679 929.683,1011.05 932.033,586.611 934.384,903.315 936.734,923.743 939.084,953.047 941.435,899.989 943.785,951.363 946.136,843.882 948.486,1068.69 950.837,742.547 953.187,907.179 955.538,891.734 957.888,924.684 960.239,853.022 962.589,1167.93 964.94,904.292 967.29,957.911 969.641,920.977 971.991,847.315 974.342,900.754 976.692,908.828 979.043,937.638 981.393,966.684 983.743,901.043 986.094,987.353 988.444,864.955 990.795,929.789 993.145,741.119 995.496,939.782 997.846,930.301 1000.2,771.165 1002.55,898.499 1004.9,877.641 1007.25,933.089 1009.6,759.907 1011.95,801.621 1014.3,948.633 1016.65,969.225 1019,876.812 1021.35,785.921 1023.7,973.574 1026.05,899.177 1028.4,936.386 1030.75,797.951 1033.1,901.766 1035.45,933.427 1037.8,928.726 1040.15,925.062 1042.51,739.742 1044.86,876.963 1047.21,882.719 1049.56,966.461 1051.91,1021.24 1054.26,868.337 1056.61,898.234 1058.96,882.6 1061.31,960.819 1063.66,945.266 1066.01,861.056 1068.36,1031.89 1070.71,1006.05 1073.06,1040.48 1075.41,912.269 1077.76,1046.72 1080.11,974.54 1082.46,881.839 1084.81,875.856 1087.16,1009.32 1089.51,898.829 1091.87,991.103 1094.22,926.657 1096.57,724.144 1098.92,824.735 1101.27,795.815 1103.62,838.076 1105.97,848.195 1108.32,881.971 1110.67,998.59 1113.02,824.97 1115.37,821.066 1117.72,735.191 1120.07,890.185 1122.42,745.886 1124.77,915.914 1127.12,845.859 1129.47,770.268 1131.82,1010.01 1134.17,774.518 1136.52,905.735 1138.87,810.275 1141.23,1016.72 1143.58,859.117 1145.93,887.433 1148.28,955.446 1150.63,879.298 1152.98,1043.19 1155.33,1029.55 1157.68,1054.59 1160.03,752.192 1162.38,771.873 1164.73,961.767 1167.08,706.054 1169.43,930.183 1171.78,783.363 1174.13,941.469 1176.48,987.068 1178.83,913.765 1181.18,971.391 1183.53,966.907 1185.88,711.586 1188.23,897.941 1190.59,999.96 1192.94,839.423 1195.29,1013.54 1197.64,1024.27 1199.99,950.582 1202.34,877.153 1204.69,973.699 1207.04,994.314 1209.39,1035.59 1211.74,814.78 1214.09,978.543 1216.44,949.545 1218.79,907.597 1221.14,867.016 1223.49,997.645 1225.84,1167.97 1228.19,932.932 1230.54,891.755 1232.89,754.206 1235.24,906.302 1237.59,851.444 1239.94,820.945 1242.3,812.314 1244.65,933.009 1247,882.383 1249.35,933.04 1251.7,887.369 1254.05,722.904 1256.4,923.881 1258.75,874.495 1261.1,979.441 1263.45,739.437 1265.8,910.068 1268.15,996.864 1270.5,921.363 1272.85,667.916 1275.2,880.406 1277.55,930.984 1279.9,1083.59 1282.25,963.382 1284.6,951.277 1286.95,985.278 1289.3,824.988 1291.66,924.824 1294.01,884.344 1296.36,916.427 1298.71,878.01 1301.06,797.093 1303.41,834.281 1305.76,906.867 1308.11,721.56 1310.46,971.797 1312.81,1003.24 1315.16,761.828 1317.51,910.611 1319.86,838.474 1322.21,900.019 1324.56,880.361 1326.91,869.143 1329.26,974.909 1331.61,896.976 1333.96,826.423 1336.31,971.847 1338.66,973.273 1341.02,1112.13 1343.37,767.525 1345.72,804.581 1348.07,902.336 1350.42,861.03 1352.77,882.07 1355.12,965.77 1357.47,1079.53 1359.82,1078.96 1362.17,924.357 1364.52,922.141 1366.87,877.207 1369.22,996.935 1371.57,872.715 1373.92,767.283 1376.27,799.831 1378.62,959.853 1380.97,977.221 1383.32,843.792 1385.67,876.914 1388.02,892.965 1390.38,1040.92 1392.73,1015.5 1395.08,875.378 1397.43,871.12 1399.78,1020.96 1402.13,899.2 1404.48,852.032 1406.83,847.842 1409.18,943.678 1411.53,961.154 1413.88,802.92 1416.23,878.161 1418.58,963.947 1420.93,704.034 1423.28,1055.06 1425.63,942.554 1427.98,973.392 1430.33,889.834 1432.68,891.004 1435.03,809.51 1437.38,967.894 1439.74,960.234 1442.09,1006.51 1444.44,1044.03 1446.79,768.925 1449.14,963.992 1451.49,849.109 1453.84,842.628 1456.19,664.975 1458.54,969.791 1460.89,969.085 1463.24,954.343 1465.59,857.719 1467.94,844.126 1470.29,809.183 1472.64,954.125 1474.99,807.638 1477.34,865.449 1479.69,991.296 1482.04,829.911 1484.39,914.263 1486.74,756.386 1489.1,958.241 1491.45,914.112 1493.8,853.142 1496.15,792.659 1498.5,919.055 1500.85,761.794 1503.2,993.495 1505.55,1010.65 1507.9,814.965 1510.25,826.023 1512.6,937.834 1514.95,828.825 1517.3,613.113 1519.65,860.707 1522,1052.04 1524.35,961.403 1526.7,1082.13 1529.05,900.046 1531.4,1088.79 1533.75,1004.98 1536.1,1061.71 1538.45,886.105 1540.81,929.847 1543.16,891.754 1545.51,930.863 1547.86,1034 1550.21,890.018 1552.56,732.403 1554.91,1030.88 1557.26,989.533 1559.61,743.377 1561.96,874.072 1564.31,811.694 1566.66,969.934 1569.01,998.971 1571.36,942.176 1573.71,961.03 1576.06,990.44 1578.41,970.877 1580.76,837.719 1583.11,1019.22 1585.46,930.315 1587.81,861.803 1590.17,955.704 1592.52,842.072 1594.87,1015.81 1597.22,931.718 1599.57,821.042 1601.92,1013.97 1604.27,720.408 1606.62,922.008 1608.97,1021.31 1611.32,898.505 1613.67,786.447 1616.02,678.291 1618.37,889.187 1620.72,889.225 1623.07,951.976 1625.42,918.269 1627.77,925.513 1630.12,898.543 1632.47,869.257 1634.82,763.402 1637.17,860.521 1639.53,681.067 1641.88,954.354 1644.23,804.294 1646.58,872.043 1648.93,850.453 1651.28,883.57 1653.63,993.845 1655.98,695.038 1658.33,978.332 1660.68,997.944 1663.03,718.984 1665.38,923.762 1667.73,1018.51 1670.08,944.005 1672.43,1032.61 1674.78,824.882 1677.13,758.356 1679.48,988.618 1681.83,798.62 1684.18,792.747 1686.53,930.213 1688.89,891.13 1691.24,960.536 1693.59,816.109 1695.94,949.382 1698.29,824.668 1700.64,938.411 1702.99,972.585 1705.34,964.951 1707.69,989.364 1710.04,898.585 1712.39,839.481 1714.74,902.074 1717.09,681.602 1719.44,992.911 1721.79,986.587 1724.14,791.929 1726.49,728.074 1728.84,1090.42 1731.19,866.516 1733.54,804.706 1735.89,900.724 1738.25,1051.2 1740.6,923.516 1742.95,825.782 1745.3,922.242 1747.65,833.897 1750,910.791 1752.35,889.026 1754.7,866.954 1757.05,671.376 1759.4,945.984 1761.75,952.019 1764.1,866.693 1766.45,919.523 1768.8,990.677 1771.15,887.756 1773.5,886.727 1775.85,1081.55 1778.2,936.968 1780.55,968.249 1782.9,1031.65 1785.25,927.853 1787.6,906.66 1789.96,1041.61 1792.31,1052.62 1794.66,747.963 1797.01,1023.85 1799.36,924.819 1801.71,970.211 1804.06,963.972 1806.41,917.453 1808.76,927.882 1811.11,977.027 1813.46,711.24 1815.81,879.476 1818.16,1033.67 1820.51,934.594 1822.86,880.231 1825.21,851.745 1827.56,836.426 1829.91,962.768 1832.26,1116.92 1834.61,978.449 1836.96,845.153 1839.32,914.52 1841.67,698.524 1844.02,881.586 1846.37,795.483 1848.72,960.28 1851.07,825.904 1853.42,922.135 1855.77,855.573 1858.12,803.356 1860.47,797.632 1862.82,905.032 1865.17,775.11 1867.52,791.795 1869.87,1092.06 1872.22,931.591 1874.57,749.173 1876.92,764.411 1879.27,940.282 1881.62,754.307 1883.97,825.087 1886.32,871.441 1888.68,773.468 1891.03,1015.14 1893.38,873.856 1895.73,864.561 1898.08,1005.13 1900.43,1013.61 1902.78,848.86 1905.13,932.41 1907.48,963.788 1909.83,966.426 1912.18,859.671 1914.53,708.441 1916.88,801.545 1919.23,822.857 1921.58,903.594 1923.93,957.308 1926.28,1002.05 1928.63,1026.71 1930.98,1079.89 1933.33,1063.71 1935.68,916.706 1938.04,867.393 1940.39,1064 1942.74,842.021 1945.09,993.86 1947.44,1055.85 1949.79,916.899 1952.14,1024.07 1954.49,956.652 1956.84,1057.17 1959.19,861.579 1961.54,919.915 1963.89,838.075 1966.24,962.798 1968.59,761.652 1970.94,968.552 1973.29,904.952 1975.64,985.07 1977.99,788.619 1980.34,745.478 1982.69,850.203 1985.04,947.613 1987.4,793.692 1989.75,857.234 1992.1,913.05 1994.45,820.917 1996.8,1078.98 1999.15,855.555 2001.5,973.701 2003.85,726.055 2006.2,971.574 2008.55,986.186 2010.9,978.475 2013.25,1161.56 2015.6,1009.81 2017.95,941.198 2020.3,817.565 2022.65,800.075 2025,900.364 2027.35,717.431 2029.7,958.905 2032.05,960.954 2034.4,883.372 2036.76,1013.57 2039.11,852.969 2041.46,799.333 2043.81,853.202 2046.16,841.897 2048.51,916.578 2050.86,776.891 2053.21,975.914 2055.56,774.045 2057.91,927.69 2060.26,928.684 2062.61,906.616 2064.96,968.15 2067.31,812.874 2069.66,781.943 2072.01,924.097 2074.36,916.943 2076.71,868.489 2079.06,818.105 2081.41,1035.17 2083.76,910.654 2086.11,882.017 2088.47,932.013 2090.82,793.467 2093.17,931.008 2095.52,825.955 2097.87,906.404 2100.22,952.125 2102.57,903.308 2104.92,943.417 2107.27,1029.47 2109.62,1003.05 2111.97,834.196 2114.32,853.831 2116.67,855.564 2119.02,927.595 2121.37,942.977 2123.72,1094.4 2126.07,895.877 2128.42,950.476 2130.77,1071.96 2133.12,859.35 2135.47,743.028 2137.83,1002.59 2140.18,943.066 2142.53,841.682 2144.88,917.599 2147.23,891.886 2149.58,878.774 2151.93,941.797 2154.28,938.507 2156.63,815.721 2158.98,1013.11 2161.33,1044.82 2163.68,763.686 2166.03,1142.24 2168.38,845.813 2170.73,908.993 2173.08,785.39 2175.43,1130.38 2177.78,992.743 2180.13,870.908 2182.48,959.411 2184.83,946.119 2187.19,696.388 2189.54,680.499 2191.89,748.352 2194.24,888.963 2196.59,807.169 2198.94,942.784 2201.29,785.888 2203.64,960.275 2205.99,806.141 2208.34,925.409 2210.69,751.667 2213.04,956.992 2215.39,848.808 2217.74,815.425 2220.09,939.469 2222.44,745.425 2224.79,771.222 2227.14,1062.6 2229.49,831.039 2231.84,862.691 2234.19,929.493 2236.55,985.617 2238.9,815.98 2241.25,741.084 2243.6,891.519 2245.95,1011.8 2248.3,848.578 2250.65,777.201 2253,756.596 2255.35,772.406 2257.7,1060.52 2260.05,924.408 2262.4,917.98 2264.75,885.538 2267.1,1070.78 2269.45,1093.34 2271.8,870.845 2274.15,918.582 2276.5,749.133 2278.85,779.77 2281.2,958.461 2283.55,1021.21 2285.91,863.8 2288.26,681.925 2290.61,725.13 2292.96,724.115 2295.31,928.628 2297.66,911.538 2300.01,880.808 2302.36,766.667 2304.71,831.165 2307.06,848.526 2309.41,918.684 2311.76,1030.54 2314.11,985.113 2316.46,908.945 2318.81,792.678 2321.16,831.833 2323.51,885.976 2325.86,899.205 2328.21,1074.58 2330.56,849.248 2332.91,933.57 2335.27,894.815 2337.62,856.509 2339.97,687.888 2342.32,852.369 2344.67,988.09 2347.02,837.59 2349.37,967.717 2351.72,802.264 2354.07,762.163 2356.42,975.394 2358.77,861.409 2361.12,998.298 2363.47,1016.76 2365.82,759.932 2368.17,952.929 2370.52,709.623 2372.87,699.852 2375.22,919.489 2377.57,901.722 2379.92,588.526 2382.27,718.624 2384.62,964.681 2386.98,901.432 2389.33,980.359 2391.68,973.646 2394.03,676.125 2396.38,685.277 2398.73,987.343 2401.08,982.828 2403.43,881.265 2405.78,786.063 2408.13,917.722 2410.48,1122.65 2412.83,827.492 2415.18,858.998 2417.53,872.64 2419.88,876.453 2422.23,992.106 2424.58,1093.39 2426.93,830.513 2429.28,989.18 2431.63,656.024 2433.98,776.296 2436.34,906.574 2438.69,993.326 2441.04,931.161 2443.39,1019.42 2445.74,858.166 2448.09,1150.87 2450.44,865.699 2452.79,1044.14 2455.14,932.54 2457.49,854.341 2459.84,975.166 2462.19,812.506 2464.54,782.328 2466.89,804.779 2469.24,969.706 2471.59,791.706 2473.94,864.976 2476.29,949.1 2478.64,921.019 2480.99,889.595 2483.34,936.686 2485.7,982.599 2488.05,983.649 2490.4,1130.04 2492.75,774.376 2495.1,764.783 2497.45,840.358 2499.8,989.401 2502.15,646.214 2504.5,915.211 2506.85,935.748 2509.2,814.665 2511.55,847.98 2513.9,987.345 2516.25,895.298 2518.6,874.338 2520.95,837.239 2523.3,887.39 2525.65,970.073 2528,942.183 2530.35,990.068 2532.7,915.665 2535.06,903.011 2537.41,945.874 2539.76,945.945 2542.11,902.444 2544.46,920.443 2546.81,822.67 2549.16,922.702 2551.51,949.682 2553.86,717.849 2556.21,973.387 2558.56,943.736 2560.91,791.661 2563.26,996.998 2565.61,778.12 2567.96,830.011 2570.31,857.281 "></polyline>
<polyline clip-path="url(#clip112)" style="stroke:#3da44d; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,794.423 224.541,588.949 226.891,154.658 229.242,307.457 231.592,433.525 233.943,324.078 236.293,499.416 238.644,381.462 240.994,545.985 243.345,430.089 245.695,377.024 248.046,623.056 250.396,157.297 252.747,469.117 255.097,377.662 257.448,513.783 259.798,427.865 262.148,353.02 264.499,415.233 266.849,255.677 269.2,464.302 271.55,390.765 273.901,280.618 276.251,262.352 278.602,622.521 280.952,345.79 283.303,406.077 285.653,402.643 288.004,358.285 290.354,447.813 292.705,267.897 295.055,476.785 297.406,472.214 299.756,172.507 302.107,372.598 304.457,479.102 306.807,325.713 309.158,316.875 311.508,367.204 313.859,483.721 316.209,489.761 318.56,543.537 320.91,246.968 323.261,393.852 325.611,575.671 327.962,281.03 330.312,538.935 332.663,536.536 335.013,479.413 337.364,355.99 339.714,454.864 342.065,374.768 344.415,276.257 346.765,472.134 349.116,337.223 351.466,319.02 353.817,500.18 356.167,321.626 358.518,301.381 360.868,355.387 363.219,256.613 365.569,316.942 367.92,431.923 370.27,473.212 372.621,675.06 374.971,315.508 377.322,334.448 379.672,339.982 382.023,490.708 384.373,341.987 386.724,592.602 389.074,421.851 391.424,416.908 393.775,331.719 396.125,450.141 398.476,369.476 400.826,372.564 403.177,426.066 405.527,473.327 407.878,240.162 410.228,310.499 412.579,347.765 414.929,303.767 417.28,305.045 419.63,426.331 421.981,407.087 424.331,426.531 426.682,395.115 429.032,462.197 431.382,290.699 433.733,401.821 436.083,570.673 438.434,556.545 440.784,312.501 443.135,258.02 445.485,337.288 447.836,708.868 450.186,578.102 452.537,553.822 454.887,431.664 457.238,435.957 459.588,559.353 461.939,415.594 464.289,408.072 466.64,289.486 468.99,339.93 471.341,521.988 473.691,269.228 476.041,341.758 478.392,502.332 480.742,382.455 483.093,335.595 485.443,364.042 487.794,476.047 490.144,292.112 492.495,339.507 494.845,643.835 497.196,421.262 499.546,187.642 501.897,318.435 504.247,463.266 506.598,532.117 508.948,450.546 511.299,550.143 513.649,366.015 515.999,375.148 518.35,298.501 520.7,203.128 523.051,404.985 525.401,439.813 527.752,390.755 530.102,428.585 532.453,407.255 534.803,506.111 537.154,438.383 539.504,459.999 541.855,298.936 544.205,420.817 546.556,408.823 548.906,384.152 551.257,370.728 553.607,575.212 555.958,414.146 558.308,331.157 560.658,506.917 563.009,219.713 565.359,339.046 567.71,356.786 570.06,597.84 572.411,354.595 574.761,449.788 577.112,392.956 579.462,365.882 581.813,351.774 584.163,273.623 586.514,468.926 588.864,403.258 591.215,474.786 593.565,459.313 595.916,384.74 598.266,482.65 600.616,597.739 602.967,347.449 605.317,262.657 607.668,499.016 610.018,469.209 612.369,263.253 614.719,391.152 617.07,481.696 619.42,437.16 621.771,451.978 624.121,398.324 626.472,388.186 628.822,245.587 631.173,620.057 633.523,450.211 635.874,467.876 638.224,416.569 640.575,442.847 642.925,451.73 645.275,444.428 647.626,366.331 649.976,467.463 652.327,501.173 654.677,523.268 657.028,350.226 659.378,398.114 661.729,455.918 664.079,501.693 666.43,489.047 668.78,454.558 671.131,459.789 673.481,317.886 675.832,280.527 678.182,292.811 680.533,470.763 682.883,498.459 685.233,312.163 687.584,446.946 689.934,396.096 692.285,348.609 694.635,668.578 696.986,333.64 699.336,316.873 701.687,352.861 704.037,289.619 706.388,455.439 708.738,328.073 711.089,445.773 713.439,497.006 715.79,536.85 718.14,432.41 720.491,572.963 722.841,447.041 725.192,399.161 727.542,329.483 729.892,259.667 732.243,135.976 734.593,540.032 736.944,248.842 739.294,361.572 741.645,449.276 743.995,417.859 746.346,502.633 748.696,563.743 751.047,510.159 753.397,345.145 755.748,440.258 758.098,301.469 760.449,168.768 762.799,513.729 765.15,522.778 767.5,335.756 769.85,352.221 772.201,575.387 774.551,519.887 776.902,451.256 779.252,361.051 781.603,289.818 783.953,249.52 786.304,329.578 788.654,477.076 791.005,460.963 793.355,378.66 795.706,254.157 798.056,390.5 800.407,334.736 802.757,458.788 805.108,363.481 807.458,504.907 809.809,429.621 812.159,288.86 814.509,293.016 816.86,512.606 819.21,413.991 821.561,398.498 823.911,265.619 826.262,364.269 828.612,415.016 830.963,235.286 833.313,425.875 835.664,484.911 838.014,540.795 840.365,501.478 842.715,317.886 845.066,445.857 847.416,394.438 849.767,507.844 852.117,322.477 854.467,406.394 856.818,341.486 859.168,333.023 861.519,423.648 863.869,477.457 866.22,318.279 868.57,459.991 870.921,316.125 873.271,360.784 875.622,622.514 877.972,395.413 880.323,315.171 882.673,382.606 885.024,514.834 887.374,351.199 889.725,248.134 892.075,337.964 894.426,485.491 896.776,471.608 899.126,303.118 901.477,328.476 903.827,289.205 906.178,491.074 908.528,370.299 910.879,256.901 913.229,367.869 915.58,631.755 917.93,405.831 920.281,451.244 922.631,558.45 924.982,499.576 927.332,450.286 929.683,360.971 932.033,615.6 934.384,368.359 936.734,440.749 939.084,588.342 941.435,473.394 943.785,498.275 946.136,517.225 948.486,439.705 950.837,273.47 953.187,413.875 955.538,334.657 957.888,449.416 960.239,308.88 962.589,369.935 964.94,308.806 967.29,447.112 969.641,471.237 971.991,368.305 974.342,428.44 976.692,531.543 979.043,394.463 981.393,394.702 983.743,320.088 986.094,551.309 988.444,552.562 990.795,336.072 993.145,560.896 995.496,563.977 997.846,444.379 1000.2,479.012 1002.55,584.343 1004.9,442.113 1007.25,383.05 1009.6,417.896 1011.95,580.689 1014.3,300.546 1016.65,372.212 1019,363.282 1021.35,424.857 1023.7,442.907 1026.05,388.175 1028.4,335.457 1030.75,408.644 1033.1,359.728 1035.45,516.78 1037.8,341.285 1040.15,323.028 1042.51,434.807 1044.86,310.968 1047.21,480.745 1049.56,479.456 1051.91,456.906 1054.26,278.61 1056.61,393.113 1058.96,357.366 1061.31,205.91 1063.66,488.264 1066.01,351.509 1068.36,393.13 1070.71,324.075 1073.06,403.749 1075.41,314.658 1077.76,400.356 1080.11,498.249 1082.46,345.907 1084.81,535.768 1087.16,358.535 1089.51,203.192 1091.87,357.427 1094.22,347.227 1096.57,448.598 1098.92,403.914 1101.27,451.498 1103.62,525.434 1105.97,331.269 1108.32,541.702 1110.67,425.059 1113.02,524.923 1115.37,372.841 1117.72,445.151 1120.07,375.513 1122.42,293.743 1124.77,435.927 1127.12,411.608 1129.47,423.572 1131.82,369.733 1134.17,334.36 1136.52,488.199 1138.87,532.702 1141.23,606.328 1143.58,434.062 1145.93,279.824 1148.28,384.723 1150.63,229.905 1152.98,463.529 1155.33,584.148 1157.68,438.021 1160.03,461.553 1162.38,373.602 1164.73,441.545 1167.08,297.728 1169.43,300.996 1171.78,410.007 1174.13,430.697 1176.48,333.838 1178.83,442.186 1181.18,354.523 1183.53,285.814 1185.88,480.842 1188.23,455.355 1190.59,459.704 1192.94,158.596 1195.29,396.244 1197.64,546.416 1199.99,314.236 1202.34,389.377 1204.69,454.32 1207.04,357.566 1209.39,411.462 1211.74,589.773 1214.09,439.268 1216.44,398.449 1218.79,332.777 1221.14,445.723 1223.49,576.809 1225.84,441.274 1228.19,370.022 1230.54,374.62 1232.89,379.684 1235.24,372.058 1237.59,443.933 1239.94,402.051 1242.3,469.343 1244.65,321.65 1247,469.938 1249.35,557.776 1251.7,281.64 1254.05,291.865 1256.4,283.264 1258.75,320.461 1261.1,305.235 1263.45,96.8724 1265.8,299.342 1268.15,420.02 1270.5,293.704 1272.85,373.475 1275.2,433.817 1277.55,409.734 1279.9,464.366 1282.25,394.393 1284.6,450.187 1286.95,411.546 1289.3,316.924 1291.66,465.083 1294.01,399.659 1296.36,427.554 1298.71,585.463 1301.06,464.275 1303.41,430.632 1305.76,304.8 1308.11,433.729 1310.46,318.16 1312.81,432.871 1315.16,438.665 1317.51,343.509 1319.86,445.125 1322.21,485.484 1324.56,586.533 1326.91,280.129 1329.26,470.582 1331.61,341.37 1333.96,488.75 1336.31,333.098 1338.66,367.195 1341.02,342.888 1343.37,595.841 1345.72,520.838 1348.07,309.213 1350.42,374.453 1352.77,447.921 1355.12,426.511 1357.47,340.717 1359.82,242.271 1362.17,243.631 1364.52,305.076 1366.87,466.073 1369.22,365.46 1371.57,603.872 1373.92,334.414 1376.27,691.426 1378.62,466.956 1380.97,484.387 1383.32,438.183 1385.67,193.541 1388.02,254.384 1390.38,204.79 1392.73,436.005 1395.08,397.696 1397.43,260.991 1399.78,372.909 1402.13,480.341 1404.48,147.03 1406.83,517.446 1409.18,640.068 1411.53,434.913 1413.88,577.805 1416.23,378.945 1418.58,321.631 1420.93,372.527 1423.28,363.686 1425.63,542.827 1427.98,506.281 1430.33,395.304 1432.68,309.589 1435.03,397.489 1437.38,516.008 1439.74,341.494 1442.09,349.4 1444.44,402.906 1446.79,509.688 1449.14,371.322 1451.49,594.225 1453.84,263.989 1456.19,425.431 1458.54,437.127 1460.89,426.992 1463.24,348.624 1465.59,494.158 1467.94,637.611 1470.29,402.518 1472.64,421.149 1474.99,333.909 1477.34,262.548 1479.69,402.045 1482.04,307.316 1484.39,514.093 1486.74,449.397 1489.1,391.415 1491.45,402.341 1493.8,376.484 1496.15,486.559 1498.5,326.685 1500.85,548.769 1503.2,626.757 1505.55,423.675 1507.9,347.252 1510.25,363.559 1512.6,324.709 1514.95,192.355 1517.3,366.22 1519.65,458.628 1522,448.404 1524.35,436.091 1526.7,372.594 1529.05,332.601 1531.4,406.195 1533.75,486.067 1536.1,415.443 1538.45,247.639 1540.81,302.245 1543.16,429.499 1545.51,366.244 1547.86,460.488 1550.21,560.981 1552.56,513.447 1554.91,488.203 1557.26,247.695 1559.61,620.654 1561.96,513.183 1564.31,316.944 1566.66,479.552 1569.01,418.699 1571.36,440.676 1573.71,363.147 1576.06,361.598 1578.41,424.176 1580.76,209.02 1583.11,467.12 1585.46,336.787 1587.81,240.233 1590.17,244.659 1592.52,461.679 1594.87,502.749 1597.22,585.65 1599.57,394.531 1601.92,351.908 1604.27,322.897 1606.62,497.915 1608.97,488.707 1611.32,404.536 1613.67,309.919 1616.02,381.495 1618.37,527.671 1620.72,451.878 1623.07,443.395 1625.42,387.208 1627.77,282.222 1630.12,363.953 1632.47,303.17 1634.82,377.784 1637.17,567.002 1639.53,402.074 1641.88,454.245 1644.23,502.061 1646.58,427.998 1648.93,477.318 1651.28,518.278 1653.63,313.361 1655.98,535.682 1658.33,282.278 1660.68,444.803 1663.03,345.582 1665.38,322.095 1667.73,364.433 1670.08,331.39 1672.43,347.608 1674.78,372.407 1677.13,404.107 1679.48,556.776 1681.83,370.488 1684.18,405.157 1686.53,323.086 1688.89,664.591 1691.24,307.857 1693.59,456.751 1695.94,505.702 1698.29,575.128 1700.64,309.284 1702.99,561.174 1705.34,621.74 1707.69,376.094 1710.04,390.012 1712.39,482.615 1714.74,532.719 1717.09,463.858 1719.44,397.152 1721.79,502.153 1724.14,473.556 1726.49,398.584 1728.84,328.549 1731.19,437.067 1733.54,144.561 1735.89,571.756 1738.25,375.346 1740.6,477.723 1742.95,230.518 1745.3,543.545 1747.65,372.036 1750,410.691 1752.35,428.411 1754.7,535.46 1757.05,609.401 1759.4,328.662 1761.75,439.519 1764.1,393.812 1766.45,425.388 1768.8,504.016 1771.15,379.509 1773.5,394.473 1775.85,385.226 1778.2,405.367 1780.55,404.542 1782.9,512.317 1785.25,450.169 1787.6,257.879 1789.96,476.902 1792.31,434.614 1794.66,389.174 1797.01,413.096 1799.36,528.073 1801.71,476.182 1804.06,621.529 1806.41,592.852 1808.76,353.389 1811.11,412.199 1813.46,497.573 1815.81,416.297 1818.16,340.313 1820.51,425.654 1822.86,517.385 1825.21,533.207 1827.56,424.242 1829.91,388.86 1832.26,432.794 1834.61,666.39 1836.96,436.034 1839.32,506.696 1841.67,404.009 1844.02,384.179 1846.37,391.347 1848.72,478.265 1851.07,162.662 1853.42,323.939 1855.77,383.5 1858.12,421.105 1860.47,481.882 1862.82,380.282 1865.17,382.107 1867.52,411.935 1869.87,401.639 1872.22,499.985 1874.57,455.118 1876.92,377.722 1879.27,316.333 1881.62,385.864 1883.97,500.1 1886.32,232.875 1888.68,328.399 1891.03,214.911 1893.38,247.742 1895.73,429.974 1898.08,522.417 1900.43,310.832 1902.78,474.308 1905.13,263.985 1907.48,366.682 1909.83,450.739 1912.18,423.424 1914.53,363.899 1916.88,286.38 1919.23,337.751 1921.58,343.618 1923.93,525.835 1926.28,400.008 1928.63,437.736 1930.98,334.787 1933.33,395.429 1935.68,473.83 1938.04,461.51 1940.39,443.795 1942.74,518.205 1945.09,476.1 1947.44,442.936 1949.79,464.34 1952.14,277.399 1954.49,284.982 1956.84,465.907 1959.19,422.492 1961.54,308.252 1963.89,334.942 1966.24,450.071 1968.59,176.191 1970.94,406.974 1973.29,345.322 1975.64,404.305 1977.99,441.479 1980.34,470.922 1982.69,191.058 1985.04,212.338 1987.4,403.225 1989.75,324.836 1992.1,463.051 1994.45,282.639 1996.8,492.895 1999.15,347.537 2001.5,410.248 2003.85,388.596 2006.2,431.263 2008.55,275.672 2010.9,235.112 2013.25,288.72 2015.6,493.764 2017.95,387.996 2020.3,413.637 2022.65,179.961 2025,426.184 2027.35,557.055 2029.7,469.995 2032.05,419.828 2034.4,516.794 2036.76,241.055 2039.11,307.461 2041.46,250.487 2043.81,296.69 2046.16,402.238 2048.51,429.929 2050.86,572.96 2053.21,320.746 2055.56,427.114 2057.91,454.208 2060.26,321.913 2062.61,314.832 2064.96,444.181 2067.31,512.897 2069.66,502.855 2072.01,361.78 2074.36,360.018 2076.71,344.705 2079.06,310.463 2081.41,382.527 2083.76,456.17 2086.11,443.667 2088.47,568.605 2090.82,679.951 2093.17,359.624 2095.52,465.548 2097.87,218.75 2100.22,331.6 2102.57,426.698 2104.92,429.258 2107.27,254.536 2109.62,244.875 2111.97,315.728 2114.32,371.198 2116.67,498.966 2119.02,464.716 2121.37,440.067 2123.72,368.176 2126.07,399.584 2128.42,375.911 2130.77,520.732 2133.12,448.007 2135.47,327.748 2137.83,299.101 2140.18,579.019 2142.53,387.291 2144.88,145.349 2147.23,441.121 2149.58,503.119 2151.93,406.421 2154.28,474.012 2156.63,482.576 2158.98,458.185 2161.33,362.746 2163.68,413.361 2166.03,347.534 2168.38,252.994 2170.73,438.47 2173.08,404.866 2175.43,371.74 2177.78,301.241 2180.13,373.57 2182.48,512.21 2184.83,482.799 2187.19,571.144 2189.54,451.93 2191.89,284.46 2194.24,506.009 2196.59,399.734 2198.94,434.169 2201.29,406.301 2203.64,326.372 2205.99,547.041 2208.34,397.226 2210.69,323.571 2213.04,489.7 2215.39,500.14 2217.74,589.376 2220.09,349.334 2222.44,540.268 2224.79,482.811 2227.14,242.339 2229.49,321.814 2231.84,466.922 2234.19,546.206 2236.55,457.376 2238.9,376.292 2241.25,338.547 2243.6,444.889 2245.95,282.549 2248.3,457.853 2250.65,237.585 2253,681.199 2255.35,316.925 2257.7,314.414 2260.05,307.151 2262.4,251.639 2264.75,498.701 2267.1,558.685 2269.45,305.14 2271.8,636.324 2274.15,422.699 2276.5,393.669 2278.85,356.233 2281.2,352.797 2283.55,435.694 2285.91,569.497 2288.26,200.63 2290.61,427.471 2292.96,216.562 2295.31,314.169 2297.66,424.517 2300.01,318.304 2302.36,309.862 2304.71,277.038 2307.06,417.38 2309.41,335.01 2311.76,307.488 2314.11,359.95 2316.46,326.309 2318.81,495.626 2321.16,456.442 2323.51,359.96 2325.86,389.805 2328.21,348.649 2330.56,464.698 2332.91,423.638 2335.27,340.666 2337.62,515.484 2339.97,354.988 2342.32,558.604 2344.67,241.402 2347.02,534.17 2349.37,399.472 2351.72,414.277 2354.07,279.92 2356.42,506.651 2358.77,277.507 2361.12,363.467 2363.47,439.048 2365.82,294.769 2368.17,416.304 2370.52,438.787 2372.87,609.728 2375.22,454.867 2377.57,406.965 2379.92,496.424 2382.27,420.462 2384.62,321.797 2386.98,502.793 2389.33,247.992 2391.68,531.066 2394.03,509.256 2396.38,481.308 2398.73,299.772 2401.08,410.595 2403.43,307.741 2405.78,381.336 2408.13,218.262 2410.48,433.543 2412.83,416.639 2415.18,428.966 2417.53,196.516 2419.88,205.149 2422.23,317.052 2424.58,271.528 2426.93,308.308 2429.28,441.966 2431.63,422.745 2433.98,436.598 2436.34,387.395 2438.69,385.012 2441.04,430.136 2443.39,295.814 2445.74,537.551 2448.09,477.895 2450.44,437.271 2452.79,327.935 2455.14,292.826 2457.49,466.324 2459.84,493.84 2462.19,561.184 2464.54,340.951 2466.89,454.512 2469.24,518.984 2471.59,398.048 2473.94,266.602 2476.29,468.709 2478.64,426.506 2480.99,409.034 2483.34,276.238 2485.7,561.993 2488.05,514.269 2490.4,419.593 2492.75,398.97 2495.1,352.43 2497.45,552.565 2499.8,361.43 2502.15,189.033 2504.5,407.325 2506.85,316.79 2509.2,487.46 2511.55,298.267 2513.9,343.301 2516.25,608.056 2518.6,574.26 2520.95,234.474 2523.3,310.115 2525.65,567.711 2528,434.695 2530.35,129.154 2532.7,345.992 2535.06,323.984 2537.41,308.363 2539.76,304.639 2542.11,386.576 2544.46,485.248 2546.81,243.487 2549.16,341.307 2551.51,355.267 2553.86,442.318 2556.21,447.98 2558.56,306.039 2560.91,447.192 2563.26,363.246 2565.61,541.039 2567.96,670.916 2570.31,468.032 "></polyline>
</svg>
</div>
</div>
<p>Look at that! Things are working; amazin’.</p>
<p>We can also exploit <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>’s parallel sampling capabilities:</p>
<div id="34" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run separate 4 chains for 10 000 iterations using threads to parallelize.</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>num_chains <span class="op">=</span> <span class="fl">4</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    model_with_grad,</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">MCMCThreads</span>(),</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>,</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    num_chains;</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Note we need to provide an initial state for every chain.</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>    initial_state<span class="op">=</span><span class="fu">fill</span>(state, num_chains),</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>samples_array <span class="op">=</span> <span class="fu">stack</span>(<span class="fu">map</span>(<span class="bu">Base</span>.<span class="fu">Fix1</span>(stack, sample <span class="op">-&gt;</span> sample.x), samples))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000×4 Array{Float64, 3}:
[:, :, 1] =
 -2.83532   -4.63332    -5.36965  …  -5.02878   -3.07954   -2.34226
 -0.633526   0.0719491  -1.08766      0.692829   0.359935   0.0421314
  4.11979    6.82351     5.89994      5.71221    6.21666    6.84527

[:, :, 2] =
 -2.4453   -3.57067   -4.77552  -7.37955  …  -4.07065   -4.35415    -3.49111
  1.02882  -0.543388  -2.19463  -1.54334     -0.246555  -0.0169571   1.11083
  1.17531   2.53391    6.08813   6.04708      5.47238    6.0917      4.69788

[:, :, 3] =
 -4.36178   -4.54355   -5.32579   -4.97959   …  -4.9673    -4.12477  -4.65661
 -0.660568  -0.409034   0.445763  -0.516582      0.728868   1.49533   1.1629
  1.01367    2.08304    4.74142    5.23296       5.82634    4.18186   3.47455

[:, :, 4] =
 -3.08271   -3.08271   -2.8644    -5.57719  …  -4.69849   -3.52424  -4.46994
 -0.159874  -0.159874  -0.253531  -1.22714     -0.480945   1.69244  -0.787415
  3.93411    3.93411    4.35994    6.31186      6.25431    4.03877   5.65363</code></pre>
</div>
</div>
<p>But the fact that we have to provide the <code>AbstractMCMC.sample</code> call, etc. with an <code>initial_state</code> to get started is a bit annoying. We can avoid this by also defining a <code>AbstractMCMC.step</code> <em>without</em> the <code>state</code> argument:</p>
<div id="36" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">::</span><span class="dt">MALA</span>;</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># </span><span class="al">NOTE</span><span class="co">: No state provided!</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just create the initial state by sampling using  a Gaussian.</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="fu">randn</span>(rng, LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(x), <span class="fu">MALAState</span>(x)</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Equipped with this, we no longer need to provide the <code>initial_state</code> everywhere:</p>
<div id="38" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -5.0024      1.0088
  0.00966357  1.00022
  5.00892     0.986519</code></pre>
</div>
</div>
</section>
<section id="using-our-sampler-with-turing.jl" class="level2">
<h2 class="anchored" data-anchor-id="using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</h2>
<p>As we promised, all of this hassle of implementing our <code>MALA</code> sampler in a way that uses <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> and <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> gets us something more than <em>just</em> an “automatic” implementation of <code>AbstractMCMC.sample</code>.</p>
<p>It also enables use with Turing.jl through the <code>externalsampler</code>, but we need to do one final thing first: we need to tell Turing.jl how to extract a vector of parameters from the “sample” returned in our implementation of <code>AbstractMCMC.step</code>. In our case, the “sample” is a <code>MALASample</code>, so we just need the following line:</p>
<div id="40" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load Turing.jl.</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Turing</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Overload the `getparams` method for our "sample" type, which is just a vector.</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>Turing.Inference.<span class="fu">getparams</span>(<span class="op">::</span><span class="dt">Turing.Model</span>, sample<span class="op">::</span><span class="dt">MALASample</span>) <span class="op">=</span> sample.x</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And with that, we’re good to go!</p>
<div id="42" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Our previous model defined as a Turing.jl model.</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">mvnormal_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">MvNormal</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.], I)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate our model.</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">mvnormal_model</span>()</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Call `sample` but now we're passing in a Turing.jl `model` and wrapping</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co"># our `MALA` sampler in the `externalsampler` to tell Turing.jl that the sampler</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co"># expects something that implements LogDensityProblems.jl.</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×4×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 3.26 seconds
Compute duration  = 3.26 seconds
parameters        = x[1], x[2], x[3]
internals         = lp

Summary Statistics
  parameters      mean       std      mcse    ess_bulk    ess_tail      rhat   ⋯
      Symbol   Float64   Float64   Float64     Float64     Float64   Float64   ⋯

        x[1]   -4.9804    0.9836    0.0174   3202.4833   5247.4481    1.0002   ⋯
        x[2]   -0.0038    1.0091    0.0171   3495.3406   5709.5058    0.9999   ⋯
        x[3]    4.9977    1.0057    0.0183   3022.8334   5351.4215    1.0000   ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

        x[1]   -6.9280   -5.6330   -4.9724   -4.3156   -3.0503
        x[2]   -1.9648   -0.6944   -0.0124    0.6794    1.9894
        x[3]    3.0372    4.3237    4.9941    5.6584    6.9991</code></pre>
</div>
</div>
<p>Pretty neat, eh?</p>
<section id="models-with-constrained-parameters" class="level3">
<h3 class="anchored" data-anchor-id="models-with-constrained-parameters">Models with constrained parameters</h3>
<p>One thing we’ve sort of glossed over in all of the above is that MALA, at least how we’ve implemented it, requires <span class="math inline">\(x\)</span> to live in <span class="math inline">\(\mathbb{R}^d\)</span> for some <span class="math inline">\(d &gt; 0\)</span>. If some of the parameters were in fact constrained, e.g.&nbsp;we were working with a <code>Beta</code> distribution which has support on the interval <span class="math inline">\((0, 1)\)</span>, <em>not</em> on <span class="math inline">\(\mathbb{R}^d\)</span>, we could easily end up outside of the valid range <span class="math inline">\((0, 1)\)</span>.</p>
<div id="44" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">beta_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">beta_model</span>()</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 1.94 seconds
Compute duration  = 1.94 seconds
parameters        = x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse    ess_bulk    ess_tail      rhat   ⋯
      Symbol   Float64   Float64   Float64     Float64     Float64   Float64   ⋯

           x    0.4965    0.1893    0.0028   4333.3167   6206.2488    1.0001   ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

           x    0.1431    0.3583    0.4888    0.6387    0.8496</code></pre>
</div>
</div>
<p>Yep, that still works, but only because Turing.jl actually <em>transforms</em> the <code>turing_model</code> from constrained to unconstrained, so that the <code>sampler</code> provided to <code>externalsampler</code> is actually always working in unconstrained space! This is not always desirable, so we can turn this off:</p>
<div id="46" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 0.17 seconds
Compute duration  = 0.17 seconds
parameters        = x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse   ess_bulk   ess_tail      rhat   e ⋯
      Symbol   Float64   Float64   Float64    Float64    Float64   Float64     ⋯

           x    0.4986    0.1433    0.0090   217.0484    95.4443    1.0051     ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

           x    0.2542    0.3787    0.4861    0.6277    0.7399</code></pre>
</div>
</div>
<p>The fun thing is that this still sort of works because</p>
<div id="48" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">logpdf</span>(<span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>), <span class="fl">10.0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-Inf</code></pre>
</div>
</div>
<p>and so the samples that fall outside of the range are always rejected. But do notice how much worse all the diagnostics are, e.g.&nbsp;<code>ess_tail</code> is very poor compared to when we use <code>unconstrained=true</code>. Moreover, in more complex cases this won’t just result in a “nice” <code>-Inf</code> log-density value, but instead will error:</p>
<div id="50" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="kw">function</span> <span class="fu">demo</span>()</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>    σ² <span class="op">~</span> <span class="fu">truncated</span>(<span class="fu">Normal</span>(), lower<span class="op">=</span><span class="fl">0</span>)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If we end up with negative values for `σ²`, the `Normal` will error.</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>    x <span class="op">~</span> <span class="fu">Normal</span>(<span class="fl">0</span>, σ²)</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>DomainError: DomainError(Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}}(-0.4756174483081308,1.0,0.0), "Normal: the condition σ &gt;= zero(σ) is not satisfied.")
DomainError with Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}}(-0.4756174483081308,1.0,0.0):
Normal: the condition σ &gt;= zero(σ) is not satisfied.
Stacktrace:
  [1] #371
    @ ~/.julia/packages/Distributions/fi8Qd/src/univariate/continuous/normal.jl:37 [inlined]
  [2] check_args
    @ ~/.julia/packages/Distributions/fi8Qd/src/utils.jl:89 [inlined]
  [3] #Normal#370
    @ ~/.julia/packages/Distributions/fi8Qd/src/univariate/continuous/normal.jl:37 [inlined]
  [4] Normal
    @ ~/.julia/packages/Distributions/fi8Qd/src/univariate/continuous/normal.jl:36 [inlined]
  [5] Normal
    @ ~/.julia/packages/Distributions/fi8Qd/src/univariate/continuous/normal.jl:42 [inlined]
  [6] macro expansion
    @ ~/.julia/packages/DynamicPPL/DxBhI/src/compiler.jl:574 [inlined]
  [7] demo(__model__::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, __varinfo__::DynamicPPL.ThreadSafeVarInfo{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}, ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}, Vector{Base.RefValue{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}, __context__::DynamicPPL.DefaultContext)
    @ Main.Notebook ~/work/docs/docs/developers/inference/implementing-samplers/index.qmd:595
  [8] _evaluate!!
    @ ~/.julia/packages/DynamicPPL/DxBhI/src/model.jl:936 [inlined]
  [9] evaluate_threadsafe!!(model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, varinfo::DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}, ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}, context::DynamicPPL.DefaultContext)
    @ DynamicPPL ~/.julia/packages/DynamicPPL/DxBhI/src/model.jl:925
 [10] evaluate!!
    @ ~/.julia/packages/DynamicPPL/DxBhI/src/model.jl:855 [inlined]
 [11] logdensity_at
    @ ~/.julia/packages/DynamicPPL/DxBhI/src/logdensityfunction.jl:184 [inlined]
 [12] FixTail
    @ ~/.julia/packages/DifferentiationInterface/Vap8g/src/utils/context.jl:169 [inlined]
 [13] vector_mode_dual_eval!(f::DifferentiationInterface.FixTail{typeof(DynamicPPL.logdensity_at), Tuple{DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}, DynamicPPL.DefaultContext}}, cfg::ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}, x::Vector{Float64})
    @ ForwardDiff ~/.julia/packages/ForwardDiff/UBbGT/src/apiutils.jl:24
 [14] vector_mode_gradient!
    @ ~/.julia/packages/ForwardDiff/UBbGT/src/gradient.jl:98 [inlined]
 [15] gradient!(result::DiffResults.MutableDiffResult{1, Float64, Tuple{Vector{Float64}}}, f::DifferentiationInterface.FixTail{typeof(DynamicPPL.logdensity_at), Tuple{DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}, DynamicPPL.DefaultContext}}, x::Vector{Float64}, cfg::ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}, ::Val{false})
    @ ForwardDiff ~/.julia/packages/ForwardDiff/UBbGT/src/gradient.jl:39
 [16] value_and_gradient(::typeof(DynamicPPL.logdensity_at), ::DifferentiationInterfaceForwardDiffExt.ForwardDiffGradientPrep{Nothing, ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}, Tuple{Nothing, Nothing, Nothing}}, ::AutoForwardDiff{2, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}}, ::Vector{Float64}, ::DifferentiationInterface.Constant{DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}}, ::DifferentiationInterface.Constant{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}}, ::DifferentiationInterface.Constant{DynamicPPL.DefaultContext})
    @ DifferentiationInterfaceForwardDiffExt ~/.julia/packages/DifferentiationInterface/Vap8g/ext/DifferentiationInterfaceForwardDiffExt/onearg.jl:417
 [17] logdensity_and_gradient(f::LogDensityFunction{DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}, DynamicPPL.DefaultContext, AutoForwardDiff{2, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}}}, x::Vector{Float64})
    @ DynamicPPL ~/.julia/packages/DynamicPPL/DxBhI/src/logdensityfunction.jl:215
 [18] leapfrog_step(model::LogDensityFunction{DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}, DynamicPPL.DefaultContext, AutoForwardDiff{2, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}}}, x::Vector{Float64}, p::Vector{Float64}, ϵ::Int64, M::UniformScaling{Bool})
    @ Main.Notebook ~/work/docs/docs/developers/inference/implementing-samplers/index.qmd:371
 [19] step(rng::TaskLocalRNG, model_wrapper::AbstractMCMC.LogDensityModel{LogDensityFunction{DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}, DynamicPPL.DefaultContext, AutoForwardDiff{2, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}}}}, sampler::MALA{Int64, UniformScaling{Bool}}, state::MALAState{Vector{Float64}}; kwargs::@Kwargs{})
    @ Main.Notebook ~/work/docs/docs/developers/inference/implementing-samplers/index.qmd:336
 [20] step(rng::TaskLocalRNG, model_wrapper::AbstractMCMC.LogDensityModel{LogDensityFunction{DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}, DynamicPPL.DefaultContext, AutoForwardDiff{2, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}}}}, sampler::MALA{Int64, UniformScaling{Bool}}, state::MALAState{Vector{Float64}})
    @ Main.Notebook ~/work/docs/docs/developers/inference/implementing-samplers/index.qmd:318
 [21] step(rng::TaskLocalRNG, model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, sampler_wrapper::DynamicPPL.Sampler{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}, state::Turing.Inference.TuringState{MALAState{Vector{Float64}}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}, DynamicPPL.DefaultContext}; kwargs::@Kwargs{})
    @ Turing.Inference ~/.julia/packages/Turing/IXycm/src/mcmc/abstractmcmc.jl:91
 [22] step(rng::TaskLocalRNG, model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, sampler_wrapper::DynamicPPL.Sampler{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}, state::Turing.Inference.TuringState{MALAState{Vector{Float64}}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}, DynamicPPL.DefaultContext})
    @ Turing.Inference ~/.julia/packages/Turing/IXycm/src/mcmc/abstractmcmc.jl:80
 [23] macro expansion
    @ ~/.julia/packages/AbstractMCMC/FSyVk/src/sample.jl:217 [inlined]
 [24] macro expansion
    @ ~/.julia/packages/AbstractMCMC/FSyVk/src/logging.jl:16 [inlined]
 [25] mcmcsample(rng::TaskLocalRNG, model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, sampler::DynamicPPL.Sampler{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}, N::Int64; progress::Bool, progressname::String, callback::Nothing, num_warmup::Int64, discard_initial::Int64, thinning::Int64, chain_type::Type, initial_state::Nothing, kwargs::@Kwargs{})
    @ AbstractMCMC ~/.julia/packages/AbstractMCMC/FSyVk/src/sample.jl:142
 [26] sample(rng::TaskLocalRNG, model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, sampler::DynamicPPL.Sampler{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}, N::Int64; chain_type::Type, resume_from::Nothing, initial_state::Nothing, kwargs::@Kwargs{progress::Bool})
    @ DynamicPPL ~/.julia/packages/DynamicPPL/DxBhI/src/sampler.jl:102
 [27] sample
    @ ~/.julia/packages/DynamicPPL/DxBhI/src/sampler.jl:92 [inlined]
 [28] #sample#8
    @ ~/.julia/packages/Turing/IXycm/src/mcmc/Inference.jl:278 [inlined]
 [29] sample
    @ ~/.julia/packages/Turing/IXycm/src/mcmc/Inference.jl:269 [inlined]
 [30] #sample#7
    @ ~/.julia/packages/Turing/IXycm/src/mcmc/Inference.jl:266 [inlined]
 [31] top-level scope
    @ ~/work/docs/docs/developers/inference/implementing-samplers/index.qmd:597</code></pre>
</div>
</div>
<p>As expected, we run into a <code>DomainError</code> at some point, while if we set <code>unconstrained=true</code>, letting Turing.jl transform the model to a unconstrained form behind the scenes, everything works as expected:</p>
<div id="52" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 0.61 seconds
Compute duration  = 0.61 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse   ess_bulk   ess_tail      rhat   e ⋯
      Symbol   Float64   Float64   Float64    Float64    Float64   Float64     ⋯

          σ²    0.8681    0.5499    0.0230   370.6624   120.3194    1.0015     ⋯
           x   -0.0411    0.9637    0.0471   549.0436   356.3007    1.0022     ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

          σ²    0.1301    0.4307    0.7527    1.2009    2.2273
           x   -2.1434   -0.4396   -0.0144    0.4115    1.9530</code></pre>
</div>
</div>
<p>Neat!</p>
<p>Similarly, which automatic differentiation backend one should use can be specified through the <code>adtype</code> keyword argument too. For example, if we want to use <a href="https://github.com/JuliaDiff/ReverseDiff.jl">ReverseDiff.jl</a> instead of the default <a href="https://github.com/JuliaDiff/ForwardDiff.jl">ForwardDiff.jl</a>:</p>
<div id="54" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">ReverseDiff</span>: ReverseDiff</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify that we want to use `AutoReverseDiff`.</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">demo</span>(),</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>, adtype<span class="op">=</span><span class="fu">AutoReverseDiff</span>()),</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>;</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 2.91 seconds
Compute duration  = 2.91 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse   ess_bulk   ess_tail      rhat   e ⋯
      Symbol   Float64   Float64   Float64    Float64    Float64   Float64     ⋯

          σ²    1.0749    0.8935    0.1532    57.2449        NaN    1.0555     ⋯
           x    0.1105    0.9270    0.0624   194.4315   468.9043    1.0166     ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

          σ²    0.0819    0.4112    0.8236    1.4332    3.2646
           x   -1.9618   -0.3213    0.0356    0.6903    2.1104</code></pre>
</div>
</div>
<p>Double-neat.</p>
</section>
</section>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<p>At this point it’s worth maybe reminding ourselves what we did and also <em>why</em> we did it:</p>
<ol type="1">
<li>We define our models in the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface because it makes the sampler agnostic to how the underlying model is implemented.</li>
<li>We implement our sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> interface, which just means that our sampler is a subtype of <code>AbstractMCMC.AbstractSampler</code> and we implement the MCMC transition in <code>AbstractMCMC.step</code>.</li>
<li>Points 1 and 2 makes it so our sampler can be used with a wide range of model implementations, amongst them being models implemented in both Turing.jl and Stan. This gives you, the inference implementer, a large collection of models to test your inference method on, in addition to allowing users of Turing.jl and Stan to try out your inference method with minimal effort.</li>
</ol>


</section>


<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a><div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>We’re going with the leapfrog formulation because in a future version of this tutorial we’ll add a section extending this simple “baseline” MALA sampler to more complex versions. See <a href="https://github.com/TuringLang/docs/issues/479">issue #479</a> for progress on this.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>There is no such thing as a proper interface in Julia (at least not officially), and so we use the word “interface” here to mean a few minimal methods that needs to be implemented by any type that we treat as a target model.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/turinglang\.org\/docs\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../../developers/inference/variational-inference/index.html" class="pagination-link" aria-label="Variational Inference">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Variational Inference</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Turing is created by <a href="http://mlg.eng.cam.ac.uk/hong/" target="_blank">Hong Ge</a>, and lovingly maintained by the <a href="https://github.com/TuringLang/Turing.jl/graphs/contributors" target="_blank">core team</a> of volunteers. <br> The contents of this website are © 2024 under the terms of the <a href="https://github.com/TuringLang/Turing.jl/blob/main/LICENCE" target="_blank">MIT License</a>.</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/TuringLang/docs/edit/main/developers/inference/implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/docs/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://x.com/TuringLang">
      <i class="bi bi-twitter" role="img" aria-label="Turing Twitter">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/TuringLang/Turing.jl">
      <i class="bi bi-github" role="img" aria-label="Turing GitHub">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




<script src="../../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>