<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Implementing Samplers – Turing.jl</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<link href="../../../developers/inference/variational-inference/index.html" rel="prev">
<link href="../../../assets/favicon.ico" rel="icon">
<script src="../../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-dark-2fef5ea3f8957b3e4ecc936fc74692ca.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap-8ca65573be89ab5a614a0758d6e79fa7.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../../site_libs/bootstrap/bootstrap-dark-e4bf857d3af38d284e31ad2f58e22145.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="../../../site_libs/bootstrap/bootstrap-8ca65573be89ab5a614a0758d6e79fa7.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<style>
  a {
    text-decoration: none;
  }
  a:hover {
    text-decoration: underline;
  }
</style>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../../theming/styles.css">
</head>

<body class="nav-sidebar floating nav-fixed quarto-light"><script id="quarto-html-before-body" type="application/javascript">
    const toggleBodyColorMode = (bsSheetEl) => {
      const mode = bsSheetEl.getAttribute("data-mode");
      const bodyEl = window.document.querySelector("body");
      if (mode === "dark") {
        bodyEl.classList.add("quarto-dark");
        bodyEl.classList.remove("quarto-light");
      } else {
        bodyEl.classList.add("quarto-light");
        bodyEl.classList.remove("quarto-dark");
      }
    }
    const toggleBodyColorPrimary = () => {
      const bsSheetEl = window.document.querySelector("link#quarto-bootstrap:not([rel=disabled-stylesheet])");
      if (bsSheetEl) {
        toggleBodyColorMode(bsSheetEl);
      }
    }
    const setColorSchemeToggle = (alternate) => {
      const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
      for (let i=0; i < toggles.length; i++) {
        const toggle = toggles[i];
        if (toggle) {
          if (alternate) {
            toggle.classList.add("alternate");
          } else {
            toggle.classList.remove("alternate");
          }
        }
      }
    };
    const toggleColorMode = (alternate) => {
      // Switch the stylesheets
      const primaryStylesheets = window.document.querySelectorAll('link.quarto-color-scheme:not(.quarto-color-alternate)');
      const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
      manageTransitions('#quarto-margin-sidebar .nav-link', false);
      if (alternate) {
        // note: dark is layered on light, we don't disable primary!
        enableStylesheet(alternateStylesheets);
        for (const sheetNode of alternateStylesheets) {
          if (sheetNode.id === "quarto-bootstrap") {
            toggleBodyColorMode(sheetNode);
          }
        }
      } else {
        disableStylesheet(alternateStylesheets);
        enableStylesheet(primaryStylesheets)
        toggleBodyColorPrimary();
      }
      manageTransitions('#quarto-margin-sidebar .nav-link', true);
      // Switch the toggles
      setColorSchemeToggle(alternate)
      // Hack to workaround the fact that safari doesn't
      // properly recolor the scrollbar when toggling (#1455)
      if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
        manageTransitions("body", false);
        window.scrollTo(0, 1);
        setTimeout(() => {
          window.scrollTo(0, 0);
          manageTransitions("body", true);
        }, 40);
      }
    }
    const disableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        stylesheet.rel = 'disabled-stylesheet';
      }
    }
    const enableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        if(stylesheet.rel !== 'stylesheet') { // for Chrome, which will still FOUC without this check
          stylesheet.rel = 'stylesheet';
        }
      }
    }
    const manageTransitions = (selector, allowTransitions) => {
      const els = window.document.querySelectorAll(selector);
      for (let i=0; i < els.length; i++) {
        const el = els[i];
        if (allowTransitions) {
          el.classList.remove('notransition');
        } else {
          el.classList.add('notransition');
        }
      }
    }
    const isFileUrl = () => {
      return window.location.protocol === 'file:';
    }
    const hasAlternateSentinel = () => {
      let styleSentinel = getColorSchemeSentinel();
      if (styleSentinel !== null) {
        return styleSentinel === "alternate";
      } else {
        return false;
      }
    }
    const setStyleSentinel = (alternate) => {
      const value = alternate ? "alternate" : "default";
      if (!isFileUrl()) {
        window.localStorage.setItem("quarto-color-scheme", value);
      } else {
        localAlternateSentinel = value;
      }
    }
    const getColorSchemeSentinel = () => {
      if (!isFileUrl()) {
        const storageValue = window.localStorage.getItem("quarto-color-scheme");
        return storageValue != null ? storageValue : localAlternateSentinel;
      } else {
        return localAlternateSentinel;
      }
    }
    const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
      const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
      const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
      let newTheme = '';
      if(authorPrefersDark) {
        newTheme = isAlternate ? baseTheme : alternateTheme;
      } else {
        newTheme = isAlternate ? alternateTheme : baseTheme;
      }
      const changeGiscusTheme = () => {
        // From: https://github.com/giscus/giscus/issues/336
        const sendMessage = (message) => {
          const iframe = document.querySelector('iframe.giscus-frame');
          if (!iframe) return;
          iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
        }
        sendMessage({
          setConfig: {
            theme: newTheme
          }
        });
      }
      const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
      if (isGiscussLoaded) {
        changeGiscusTheme();
      }
    };
    const authorPrefersDark = false;
    const darkModeDefault = authorPrefersDark;
      document.querySelector('link#quarto-text-highlighting-styles.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
      document.querySelector('link#quarto-bootstrap.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
    let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
    // Dark / light mode switch
    window.quartoToggleColorScheme = () => {
      // Read the current dark / light value
      let toAlternate = !hasAlternateSentinel();
      toggleColorMode(toAlternate);
      setStyleSentinel(toAlternate);
      toggleGiscusIfUsed(toAlternate, darkModeDefault);
      window.dispatchEvent(new Event('resize'));
    };
    // Switch to dark mode if need be
    if (hasAlternateSentinel()) {
      toggleColorMode(true);
    } else {
      toggleColorMode(false);
    }
  </script>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="https://turinglang.org/" class="navbar-brand navbar-brand-logo">
    <img src="../../../assets/images/turing-logo.svg" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="https://turinglang.org/">
    <span class="navbar-title">Turing.jl</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../getting-started/"> 
<span class="menu-text">Get Started</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../tutorials/coin-flipping/"> 
<span class="menu-text">Tutorials</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../faq/"> 
<span class="menu-text">FAQ</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/library/"> 
<span class="menu-text">Libraries</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/news/"> 
<span class="menu-text">News</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/team/"> 
<span class="menu-text">Team</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-v0.39" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">v0.39</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-v0.39">    
        <li>
    <a class="dropdown-item" href="https://turinglang.org/docs/changelog.html">
 <span class="dropdown-text">Changelog</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://turinglang.org/docs/versions.html">
 <span class="dropdown-text">All Versions</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools tools-wide">
    <a href="https://x.com/TuringLang" title="Turing Twitter" class="quarto-navigation-tool px-1" aria-label="Turing Twitter"><i class="bi bi-twitter"></i></a>
    <a href="https://github.com/TuringLang/Turing.jl" title="Turing GitHub" class="quarto-navigation-tool px-1" aria-label="Turing GitHub"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../../developers/contributing/index.html">Developers</a></li><li class="breadcrumb-item"><a href="../../../developers/inference/variational-inference/index.html">Inference in Detail</a></li><li class="breadcrumb-item"><a href="../../../developers/inference/implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../getting-started/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Getting Started</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../core-functionality/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Core Functionality</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false">
 <span class="menu-text">User Guide</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/automatic-differentiation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Automatic Differentiation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/custom-distribution/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Custom Distributions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/probability-interface/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Querying Model Probabilities</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/modifying-logprob/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Modifying the Log Probability</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/tracking-extra-quantities/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Tracking Extra Quantities</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/mode-estimation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Mode Estimation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/performance-tips/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Performance Tips</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/sampler-visualisation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Sampler Visualization</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/dynamichmc/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using DynamicHMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/external-samplers/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using External Samplers</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/troubleshooting/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Troubleshooting</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false">
 <span class="menu-text">Tutorials</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/coin-flipping/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction: Coin Flipping</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/gaussian-mixture-models/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Mixture Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-neural-networks/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Neural Networks</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/hidden-markov-models/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Hidden Markov Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-linear-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Linear Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/infinite-mixture-models/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Infinite Mixture Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-poisson-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Poisson Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/multinomial-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Multinomial Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-differential-equations/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Differential Equations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/probabilistic-pca/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Probabilistic PCA</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-time-series-analysis/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Time Series Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/gaussian-processes-introduction/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Processes: Introduction</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/gaussian-process-latent-variable-models/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Process Latent Variable Models</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Developers</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/contributing/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Contributing</span></a>
  </div>
</li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false">
 <span class="menu-text">DynamicPPL’s Compiler</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/compiler/model-manual/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Manually Defining a Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/compiler/minituring-compiler/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation I: Compiler</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/compiler/minituring-contexts/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation II: Contexts</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/compiler/design-overview/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Turing Compiler Design (Outdated)</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false">
 <span class="menu-text">DynamicPPL Contexts</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/contexts/submodel-condition/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Conditioning and fixing in submodels</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="false">
 <span class="menu-text">Variable Transformations</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/transforms/distributions/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Distributions and the Jacobian</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/transforms/bijectors/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bijectors in MCMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/transforms/dynamicppl/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variable transformations in DynamicPPL</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true">
 <span class="menu-text">Inference in Detail</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/inference/variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/inference/implementing-samplers/index.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Implementing Samplers</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of Contents</h2>
   
  <ul>
  <li><a href="#quick-overview-of-mala" id="toc-quick-overview-of-mala" class="nav-link active" data-scroll-target="#quick-overview-of-mala">Quick overview of MALA</a></li>
  <li><a href="#what-we-need-from-a-model-logdensityproblems.jl" id="toc-what-we-need-from-a-model-logdensityproblems.jl" class="nav-link" data-scroll-target="#what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: LogDensityProblems.jl</a></li>
  <li><a href="#implementing-mala-in-abstractmcmc.jl" id="toc-implementing-mala-in-abstractmcmc.jl" class="nav-link" data-scroll-target="#implementing-mala-in-abstractmcmc.jl">Implementing MALA in AbstractMCMC.jl</a></li>
  <li><a href="#using-our-sampler-with-turing.jl" id="toc-using-our-sampler-with-turing.jl" class="nav-link" data-scroll-target="#using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</a>
  <ul class="collapse">
  <li><a href="#models-with-constrained-parameters" id="toc-models-with-constrained-parameters" class="nav-link" data-scroll-target="#models-with-constrained-parameters">Models with constrained parameters</a></li>
  </ul></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/TuringLang/docs/edit/main/developers/inference/implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/docs/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">


<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../../developers/contributing/index.html">Developers</a></li><li class="breadcrumb-item"><a href="../../../developers/inference/variational-inference/index.html">Inference in Detail</a></li><li class="breadcrumb-item"><a href="../../../developers/inference/implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Implementing Samplers</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>In this tutorial, we’ll go through step-by-step how to implement a “simple” sampler in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> in such a way that it can be easily applied to Turing.jl models.</p>
<p>In particular, we’re going to implement a version of <strong>Metropolis-adjusted Langevin (MALA)</strong>.</p>
<p>Note that we will implement this sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> framework, completely “ignoring” Turing.jl until the very end of the tutorial, at which point we’ll use a single line of code to make the resulting sampler available to Turing.jl. This is to really drive home the point that one can implement samplers in a way that is accessible to all of Turing.jl’s users without having to use Turing.jl yourself.</p>
<section id="quick-overview-of-mala" class="level2">
<h2 class="anchored" data-anchor-id="quick-overview-of-mala">Quick overview of MALA</h2>
<p>We can view MALA as a single step of the leapfrog intergrator with resampling of momentum <span class="math inline">\(p\)</span> at every step.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> To make that statement a bit more concrete, we first define the <em>extended</em> target <span class="math inline">\(\bar{\gamma}(x, p)\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\log \bar{\gamma}(x, p) \propto \log \gamma(x) + \log \gamma_{\mathcal{N}(0, M)}(p)
\end{equation*}\]</span></p>
<p>where <span class="math inline">\(\gamma_{\mathcal{N}(0, M)}\)</span> denotes the density for a zero-centered Gaussian with covariance matrix <span class="math inline">\(M\)</span>. We then consider targeting this joint distribution over both <span class="math inline">\(x\)</span> and <span class="math inline">\(p\)</span> as follows. First we define the map</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  L_{\epsilon}: \quad &amp; \mathbb{R}^d \times \mathbb{R}^d \to \mathbb{R}^d \times \mathbb{R}^d \\
  &amp; (x, p) \mapsto (\tilde{x}, \tilde{p}) := L_{\epsilon}(x, p)
\end{split}
\end{equation*}\]</span></p>
<p>as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p_{1 / 2} &amp;:= p + \frac{\epsilon}{2} \nabla \log \gamma(x) \\
  \tilde{x} &amp;:= x + \epsilon M^{-1} p_{1 /2 } \\
  p_1 &amp;:= p_{1 / 2} + \frac{\epsilon}{2} \nabla \log \gamma(\tilde{x}) \\
  \tilde{p} &amp;:= - p_1
\end{split}
\end{equation*}\]</span></p>
<p>This might be familiar for some readers as a single step of the Leapfrog integrator. We then define the MALA kernel as follows: given the current iterate <span class="math inline">\(x_i\)</span>, we sample the next iterate <span class="math inline">\(x_{i + 1}\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p &amp;\sim \mathcal{N}(0, M) \\
  (\tilde{x}, \tilde{p}) &amp;:= L_{\epsilon}(x_i, p) \\
  \alpha &amp;:= \min \left\{ 1, \frac{\bar{\gamma}(\tilde{x}, \tilde{p})}{\bar{\gamma}(x_i, p)} \right\} \\
  x_{i + 1} &amp;:=
  \begin{cases}
    \tilde{x} \quad &amp; \text{ with prob. } \alpha \\
    x_i       \quad &amp; \text{ with prob. } 1 - \alpha
  \end{cases}
\end{split}
\end{equation*}\]</span></p>
<p>i.e.&nbsp;we accept the proposal <span class="math inline">\(\tilde{x}\)</span> with probability <span class="math inline">\(\alpha\)</span> and reject it, thus sticking with our current iterate, with probability <span class="math inline">\(1 - \alpha\)</span>.</p>
</section>
<section id="what-we-need-from-a-model-logdensityproblems.jl" class="level2">
<h2 class="anchored" data-anchor-id="what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a></h2>
<p>There are a few things we need from the “target” / “model” / density that we want to sample from:</p>
<ol type="1">
<li>We need access to log-density <em>evaluations</em> <span class="math inline">\(\log \gamma(x)\)</span> so we can compute the acceptance ratio involving <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>We need access to log-density <em>gradients</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span> so we can compute the Leapfrog steps <span class="math inline">\(L_{\epsilon}(x, p)\)</span>.</li>
<li>We also need access to the “size” of the model so we can determine the size of <span class="math inline">\(M\)</span>.</li>
</ol>
<p>Luckily for us, there is a package called <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> which provides an interface for <em>exactly</em> this!</p>
<p>To demonstrate how one can implement the “<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface”<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> we will use a simple Gaussian model as an example:</p>
<div id="4" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblems</span>: LogDensityProblems;</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's define some type that represents the model.</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> IsotropicNormalModel{M<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"mean of the isotropic Gaussian"</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    mean<span class="op">::</span><span class="dt">M</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Specifies what input length the model expects.</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">dimension</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> <span class="fu">length</span>(model.mean)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Implementation of the log-density evaluation of the model.</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x<span class="op">::</span><span class="dt">AbstractVector{&lt;:Real}</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">-</span> <span class="fu">sum</span>(abs2, x <span class="op">.-</span> model.mean) <span class="op">/</span> <span class="fl">2</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This gives us all of the properties we want for our MALA sampler with the exception of the computation of the <em>gradient</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span>. There is the method <code>LogDensityProblems.logdensity_and_gradient</code> which should return a 2-tuple where the first entry is the evaluation of the logdensity <span class="math inline">\(\log \gamma(x)\)</span> and the second entry is the gradient <span class="math inline">\(\nabla \log \gamma(x)\)</span>.</p>
<p>There are two ways to “implement” this method: 1) we implement it by hand, which is feasible in the case of our <code>IsotropicNormalModel</code>, or b) we defer the implementation of this to a automatic differentiation backend.</p>
<p>To implement it by hand we can simply do</p>
<div id="6" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl that first-order, i.e. gradient information, is available.</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{1}</span>()</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Implement `logdensity_and_gradient`.</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    logγ_x <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="op">-</span>x <span class="op">.*</span> (x <span class="op">-</span> model.mean)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> logγ_x, ∇logγ_x</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s just try it out:</p>
<div id="8" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate the problem.</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> <span class="fu">IsotropicNormalModel</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.])</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create some example input that we can test on.</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>x_example <span class="op">=</span> <span class="fu">randn</span>(LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate!</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-32.000211397369945</code></pre>
</div>
</div>
<p>To defer it to an automatic differentiation backend, we can do</p>
<div id="10" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl we only have access to 0-th order information.</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{0}</span>()</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Use `LogDensityProblemsAD`'s `ADgradient` in combination with some AD backend to implement `logdensity_and_gradient`.</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblemsAD</span>, <span class="bu">ADTypes</span>, <span class="bu">ForwardDiff</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>model_with_grad <span class="op">=</span> <span class="fu">ADgradient</span>(<span class="fu">AutoForwardDiff</span>(), model)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model_with_grad, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-32.000211397369945</code></pre>
</div>
</div>
<p>We’ll continue with the second approach in this tutorial since this is typically what one does in practice, because there are better hobbies to spend time on than deriving gradients by hand.</p>
<p>At this point, one might wonder how we’re going to tie this back to Turing.jl in the end. Effectively, when working with inference methods that only require log-density evaluations and / or higher-order information of the log-density, Turing.jl actually converts the user-provided <code>Model</code> into an object implementing the above methods for <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>. As a result, most samplers provided by Turing.jl are actually implemented to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, enabling their use both <em>within</em> Turing.jl and <em>outside</em> of Turing.jl! Morever, there exists similar conversions for Stan through BridgeStan and Stan<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, which means that a sampler supporting the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface can easily be used on both Turing.jl <em>and</em> Stan models (in addition to user-provided models, as our <code>IsotropicNormalModel</code> above)!</p>
<p>Anyways, let’s move on to actually implementing the sampler.</p>
</section>
<section id="implementing-mala-in-abstractmcmc.jl" class="level2">
<h2 class="anchored" data-anchor-id="implementing-mala-in-abstractmcmc.jl">Implementing MALA in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a></h2>
<p>Now that we’ve established that a model implementing the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface provides us with all the information we need from <span class="math inline">\(\log \gamma(x)\)</span>, we can address the question: given an object that implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, how can we define a sampler for it?</p>
<p>We’re going to do this by making our sampler a sub-type of <code>AbstractMCMC.AbstractSampler</code> in addition to implementing a few methods from <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>. Why? Because it gets us <em>a lot</em> of functionality for free, as we will see later.</p>
<p>Moreover, <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> provides a very natural interface for MCMC algorithms.</p>
<p>First, we’ll define our <code>MALA</code> type</p>
<div id="12" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">AbstractMCMC</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALA{T,A} <span class="op">&lt;:</span><span class="dt"> AbstractMCMC.AbstractSampler</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"stepsize used in the leapfrog step"</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    ϵ_init<span class="op">::</span><span class="dt">T</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"covariance matrix used for the momentum"</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    M_init<span class="op">::</span><span class="dt">A</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notice how we’ve added the suffix <code>_init</code> to both the stepsize and the covariance matrix. We’ve done this because a <code>AbstractMCMC.AbstractSampler</code> should be <em>immutable</em>. Of course there might be many scenarios where we want to allow something like the stepsize and / or the covariance matrix to vary between iterations, e.g.&nbsp;during the burn-in / adaptation phase of the sampling process we might want to adjust the parameters using statistics computed from these initial iterations. But information which can change between iterations <em>should not go in the sampler itself</em>! Instead, this information should go in the sampler <em>state</em>.</p>
<p>The sampler state should at the very least contain all the necessary information to perform the next MCMC iteration, but usually contains further information, e.g.&nbsp;quantities and statistics useful for evaluating whether the sampler has converged.</p>
<p>We will use the following sampler state for our <code>MALA</code> sampler:</p>
<div id="14" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALAState{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This might seem overly redundant: we’re defining a type <code>MALAState</code> and it only contains a simple vector of reals. In this particular case we indeed could have dropped this and simply used a <code>AbstractVector{&lt;:Real}</code> as our sampler state, but typically, as we will see later, one wants to include other quantities in the sampler state. For example, if we also wanted to adapt the parameters of our <code>MALA</code>, e.g.&nbsp;alter the stepsize depending on acceptance rates, in which case we should also put <code>ϵ</code> in the state, but for now we’ll keep things simple.</p>
<p>Moreover, we also want a <em>sample</em> type, which is a type meant for “public consumption”, i.e.&nbsp;the end-user. This is generally going to contain a subset of the information present in the state. But in such a simple scenario as this, we similarly only have a <code>AbstractVector{&lt;:Real}</code>:</p>
<div id="16" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALASample{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We currently have three things:</p>
<ol type="1">
<li>A <code>AbstractMCMC.AbstractSampler</code> implementation called <code>MALA</code>.</li>
<li>A state <code>MALAState</code> for our sampler <code>MALA</code>.</li>
<li>A sample <code>MALASample</code> for our sampler <code>MALA</code>.</li>
</ol>
<p>That means that we’re ready to implement the only thing that really matters: <code>AbstractMCMC.step</code>.</p>
<p><code>AbstractMCMC.step</code> defines the MCMC iteration of our <code>MALA</code> given the current <code>MALAState</code>. Specifically, the signature of the function is as follows:</p>
<div id="18" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The RNG to ensure reproducibility.</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The model that defines our target.</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.AbstractModel</span>,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The sampler for which we're taking a `step`.</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">AbstractMCMC.AbstractSampler</span>,</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The current sampler `state`.</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    state;</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Additional keyword arguments that we may or may not need.</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Moreover, there is a specific <code>AbstractMCMC.AbstractModel</code> which is used to indicate that the model that is provided implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface: <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Since, as we discussed earlier, in our case we’re indeed going to work with types that support the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, we’ll define <code>AbstractMCMC.step</code> for such a <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Note that <code>AbstractMCMC.LogDensityModel</code> has no other purpose; it has a single field called <code>logdensity</code>, and it does nothing else. But by wrapping the model in <code>AbstractMCMC.LogDensityModel</code>, it allows samplers that want to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> to define their <code>AbstractMCMC.step</code> on this type without running into method ambiguities.</p>
<p>All in all, that means that the signature for our <code>AbstractMCMC.step</code> is going to be the following:</p>
<div id="20" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># `LogDensityModel` so we know we're working with LogDensityProblems.jl model.</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler.</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler state.</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Great! Now let’s actually implement the full <code>AbstractMCMC.step</code> for our <code>MALA</code>.</p>
<p>Let’s remind ourselves what we’re going to do:</p>
<ol type="1">
<li>Sample a new momentum <span class="math inline">\(p\)</span>.</li>
<li>Compute the log-density of the extended target <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>Take a single leapfrog step <span class="math inline">\((\tilde{x}, \tilde{p}) = L_{\epsilon}(x, p)\)</span>.</li>
<li>Accept or reject the proposed <span class="math inline">\((\tilde{x}, \tilde{p})\)</span>.</li>
</ol>
<p>All in all, this results in the following:</p>
<div id="22" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>: Random</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Distributions</span>  <span class="co"># so we get the `MvNormal`</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the wrapped model which implements LogDensityProblems.jl.</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just extract the sampler parameters to make our lives easier.</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    ϵ <span class="op">=</span> sampler.ϵ_init</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    M <span class="op">=</span> sampler.M_init</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the current parameters.</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> state.x</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sample the momentum.</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>    p_dist <span class="op">=</span> <span class="fu">MvNormal</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)), M)</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> <span class="fu">rand</span>(rng, p_dist)</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Propose using a single leapfrog step.</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>    x̃, p̃ <span class="op">=</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Accept or reject proposal.</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>    logp <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p)</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>    logp̃ <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x̃) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p̃)</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>    logα <span class="op">=</span> logp̃ <span class="op">-</span> logp</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>    state_new <span class="op">=</span> <span class="cf">if</span> <span class="fu">log</span>(<span class="fu">rand</span>(rng)) <span class="op">&lt;</span> logα</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Accept.</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x̃)</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Reject.</span></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x)</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return the "sample" and the sampler state.</span></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(state_new.x), state_new</span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Fairly straight-forward.</p>
<p>Of course, we haven’t defined the <code>leapfrog_step</code> method yet, so let’s do that:</p>
<div id="24" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p` using "position" `x`.</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x))</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    p1 <span class="op">=</span> p <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update the "position" `x` using momentum `p1`.</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    x̃ <span class="op">=</span> x <span class="op">+</span> ϵ <span class="op">.*</span> (M <span class="op">\</span> p1)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p1` using position `x̃`</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x̃ <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x̃))</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    p2 <span class="op">=</span> p1 <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x̃</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Flip momentum `p2`.</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    p̃ <span class="op">=</span> <span class="op">-</span>p2</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x̃, p̃</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>leapfrog_step (generic function with 1 method)</code></pre>
</div>
</div>
<p>With all of this, we’re technically ready to sample!</p>
<div id="26" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>, <span class="bu">LinearAlgebra</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>rng <span class="op">=</span> <span class="bu">Random</span>.<span class="fu">default_rng</span>()</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>sampler <span class="op">=</span> <span class="fu">MALA</span>(<span class="fl">1</span>, I)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>state <span class="op">=</span> <span class="fu">MALAState</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)))</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>x_next, state_next <span class="op">=</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    rng,</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    AbstractMCMC.<span class="fu">LogDensityModel</span>(model),</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    state</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>(MALASample{Vector{Float64}}([0.0, 0.0, 0.0]), MALAState{Vector{Float64}}([0.0, 0.0, 0.0]))</code></pre>
</div>
</div>
<p>Great, it works!</p>
<p>And I promised we would get quite some functionality for free if we implemented <code>AbstractMCMC.step</code>, and so we can now simply call <code>sample</code> to perform standard MCMC sampling:</p>
<div id="28" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform 1000 iterations with our `MALA` sampler.</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; initial_state<span class="op">=</span>state, progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Concatenate into a matrix.</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000 Matrix{Float64}:
 -3.26069   -4.25926   -4.25926   …  -5.31792   -3.77733  -4.77923
 -0.387774   0.141075   0.141075      0.874302  -1.10052   0.276058
  2.52405    3.69929    3.69929       3.43744    5.13172   6.8315</code></pre>
</div>
</div>
<div id="30" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the marginal means and standard deviations.</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -4.98232     0.998855
  0.00386362  0.994362
  4.99626     1.00722</code></pre>
</div>
</div>
<p>Let’s visualize the samples</p>
<div id="32" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">StatsPlots</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">transpose</span>(samples_matrix[<span class="op">:</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">:</span><span class="kw">end</span>]), alpha<span class="op">=</span><span class="fl">0.5</span>, legend<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<!--?xml version="1.0" encoding="utf-8"?-->
<svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" width="672" height="480" viewbox="0 0 2688 1920">
<defs>
  <clippath id="clip380">
    <rect x="0" y="0" width="2688" height="1920"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip380)" d="M0 1920 L2688 1920 L2688 0 L0 0  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip381">
    <rect x="537" y="0" width="1883" height="1883"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip380)" d="M196.816 1800.78 L2640.76 1800.78 L2640.76 47.2441 L196.816 47.2441  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip382">
    <rect x="196" y="47" width="2445" height="1755"></rect>
  </clippath>
</defs>
<polyline clip-path="url(#clip382)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="263.676,1800.78 263.676,47.2441 "></polyline>
<polyline clip-path="url(#clip382)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="840.654,1800.78 840.654,47.2441 "></polyline>
<polyline clip-path="url(#clip382)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1417.63,1800.78 1417.63,47.2441 "></polyline>
<polyline clip-path="url(#clip382)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1994.61,1800.78 1994.61,47.2441 "></polyline>
<polyline clip-path="url(#clip382)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="2571.59,1800.78 2571.59,47.2441 "></polyline>
<polyline clip-path="url(#clip382)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,1643.38 2640.76,1643.38 "></polyline>
<polyline clip-path="url(#clip382)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,1400.26 2640.76,1400.26 "></polyline>
<polyline clip-path="url(#clip382)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,1157.15 2640.76,1157.15 "></polyline>
<polyline clip-path="url(#clip382)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,914.039 2640.76,914.039 "></polyline>
<polyline clip-path="url(#clip382)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,670.927 2640.76,670.927 "></polyline>
<polyline clip-path="url(#clip382)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,427.815 2640.76,427.815 "></polyline>
<polyline clip-path="url(#clip382)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,184.704 2640.76,184.704 "></polyline>
<polyline clip-path="url(#clip380)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1800.78 2640.76,1800.78 "></polyline>
<polyline clip-path="url(#clip380)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="263.676,1800.78 263.676,1781.88 "></polyline>
<polyline clip-path="url(#clip380)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="840.654,1800.78 840.654,1781.88 "></polyline>
<polyline clip-path="url(#clip380)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1417.63,1800.78 1417.63,1781.88 "></polyline>
<polyline clip-path="url(#clip380)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1994.61,1800.78 1994.61,1781.88 "></polyline>
<polyline clip-path="url(#clip380)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="2571.59,1800.78 2571.59,1781.88 "></polyline>
<path clip-path="url(#clip380)" d="M263.676 1834 Q260.065 1834 258.236 1837.57 Q256.431 1841.11 256.431 1848.24 Q256.431 1855.34 258.236 1858.91 Q260.065 1862.45 263.676 1862.45 Q267.31 1862.45 269.116 1858.91 Q270.945 1855.34 270.945 1848.24 Q270.945 1841.11 269.116 1837.57 Q267.31 1834 263.676 1834 M263.676 1830.3 Q269.486 1830.3 272.542 1834.9 Q275.621 1839.49 275.621 1848.24 Q275.621 1856.96 272.542 1861.57 Q269.486 1866.15 263.676 1866.15 Q257.866 1866.15 254.787 1861.57 Q251.732 1856.96 251.732 1848.24 Q251.732 1839.49 254.787 1834.9 Q257.866 1830.3 263.676 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip380)" d="M804.346 1861.55 L820.666 1861.55 L820.666 1865.48 L798.721 1865.48 L798.721 1861.55 Q801.383 1858.79 805.967 1854.16 Q810.573 1849.51 811.754 1848.17 Q813.999 1845.65 814.879 1843.91 Q815.782 1842.15 815.782 1840.46 Q815.782 1837.71 813.837 1835.97 Q811.916 1834.23 808.814 1834.23 Q806.615 1834.23 804.161 1835 Q801.731 1835.76 798.953 1837.31 L798.953 1832.59 Q801.777 1831.46 804.231 1830.88 Q806.684 1830.3 808.721 1830.3 Q814.092 1830.3 817.286 1832.98 Q820.481 1835.67 820.481 1840.16 Q820.481 1842.29 819.67 1844.21 Q818.883 1846.11 816.777 1848.7 Q816.198 1849.37 813.096 1852.59 Q809.995 1855.78 804.346 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip380)" d="M830.527 1830.92 L848.883 1830.92 L848.883 1834.86 L834.809 1834.86 L834.809 1843.33 Q835.828 1842.98 836.846 1842.82 Q837.865 1842.64 838.883 1842.64 Q844.67 1842.64 848.05 1845.81 Q851.43 1848.98 851.43 1854.4 Q851.43 1859.97 847.957 1863.08 Q844.485 1866.15 838.166 1866.15 Q835.99 1866.15 833.721 1865.78 Q831.476 1865.41 829.069 1864.67 L829.069 1859.97 Q831.152 1861.11 833.374 1861.66 Q835.596 1862.22 838.073 1862.22 Q842.078 1862.22 844.416 1860.11 Q846.754 1858.01 846.754 1854.4 Q846.754 1850.78 844.416 1848.68 Q842.078 1846.57 838.073 1846.57 Q836.198 1846.57 834.323 1846.99 Q832.471 1847.4 830.527 1848.28 L830.527 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip380)" d="M870.642 1834 Q867.031 1834 865.203 1837.57 Q863.397 1841.11 863.397 1848.24 Q863.397 1855.34 865.203 1858.91 Q867.031 1862.45 870.642 1862.45 Q874.277 1862.45 876.082 1858.91 Q877.911 1855.34 877.911 1848.24 Q877.911 1841.11 876.082 1837.57 Q874.277 1834 870.642 1834 M870.642 1830.3 Q876.453 1830.3 879.508 1834.9 Q882.587 1839.49 882.587 1848.24 Q882.587 1856.96 879.508 1861.57 Q876.453 1866.15 870.642 1866.15 Q864.832 1866.15 861.754 1861.57 Q858.698 1856.96 858.698 1848.24 Q858.698 1839.49 861.754 1834.9 Q864.832 1830.3 870.642 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip380)" d="M1377.25 1830.92 L1395.61 1830.92 L1395.61 1834.86 L1381.53 1834.86 L1381.53 1843.33 Q1382.55 1842.98 1383.57 1842.82 Q1384.59 1842.64 1385.61 1842.64 Q1391.39 1842.64 1394.77 1845.81 Q1398.15 1848.98 1398.15 1854.4 Q1398.15 1859.97 1394.68 1863.08 Q1391.21 1866.15 1384.89 1866.15 Q1382.71 1866.15 1380.44 1865.78 Q1378.2 1865.41 1375.79 1864.67 L1375.79 1859.97 Q1377.88 1861.11 1380.1 1861.66 Q1382.32 1862.22 1384.8 1862.22 Q1388.8 1862.22 1391.14 1860.11 Q1393.48 1858.01 1393.48 1854.4 Q1393.48 1850.78 1391.14 1848.68 Q1388.8 1846.57 1384.8 1846.57 Q1382.92 1846.57 1381.05 1846.99 Q1379.19 1847.4 1377.25 1848.28 L1377.25 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip380)" d="M1417.37 1834 Q1413.75 1834 1411.93 1837.57 Q1410.12 1841.11 1410.12 1848.24 Q1410.12 1855.34 1411.93 1858.91 Q1413.75 1862.45 1417.37 1862.45 Q1421 1862.45 1422.81 1858.91 Q1424.63 1855.34 1424.63 1848.24 Q1424.63 1841.11 1422.81 1837.57 Q1421 1834 1417.37 1834 M1417.37 1830.3 Q1423.18 1830.3 1426.23 1834.9 Q1429.31 1839.49 1429.31 1848.24 Q1429.31 1856.96 1426.23 1861.57 Q1423.18 1866.15 1417.37 1866.15 Q1411.56 1866.15 1408.48 1861.57 Q1405.42 1856.96 1405.42 1848.24 Q1405.42 1839.49 1408.48 1834.9 Q1411.56 1830.3 1417.37 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip380)" d="M1447.53 1834 Q1443.92 1834 1442.09 1837.57 Q1440.28 1841.11 1440.28 1848.24 Q1440.28 1855.34 1442.09 1858.91 Q1443.92 1862.45 1447.53 1862.45 Q1451.16 1862.45 1452.97 1858.91 Q1454.8 1855.34 1454.8 1848.24 Q1454.8 1841.11 1452.97 1837.57 Q1451.16 1834 1447.53 1834 M1447.53 1830.3 Q1453.34 1830.3 1456.39 1834.9 Q1459.47 1839.49 1459.47 1848.24 Q1459.47 1856.96 1456.39 1861.57 Q1453.34 1866.15 1447.53 1866.15 Q1441.72 1866.15 1438.64 1861.57 Q1435.58 1856.96 1435.58 1848.24 Q1435.58 1839.49 1438.64 1834.9 Q1441.72 1830.3 1447.53 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip380)" d="M1952.89 1830.92 L1975.11 1830.92 L1975.11 1832.91 L1962.56 1865.48 L1957.68 1865.48 L1969.48 1834.86 L1952.89 1834.86 L1952.89 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip380)" d="M1984.27 1830.92 L2002.63 1830.92 L2002.63 1834.86 L1988.56 1834.86 L1988.56 1843.33 Q1989.58 1842.98 1990.59 1842.82 Q1991.61 1842.64 1992.63 1842.64 Q1998.42 1842.64 2001.8 1845.81 Q2005.18 1848.98 2005.18 1854.4 Q2005.18 1859.97 2001.7 1863.08 Q1998.23 1866.15 1991.91 1866.15 Q1989.74 1866.15 1987.47 1865.78 Q1985.22 1865.41 1982.82 1864.67 L1982.82 1859.97 Q1984.9 1861.11 1987.12 1861.66 Q1989.34 1862.22 1991.82 1862.22 Q1995.83 1862.22 1998.16 1860.11 Q2000.5 1858.01 2000.5 1854.4 Q2000.5 1850.78 1998.16 1848.68 Q1995.83 1846.57 1991.82 1846.57 Q1989.95 1846.57 1988.07 1846.99 Q1986.22 1847.4 1984.27 1848.28 L1984.27 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip380)" d="M2024.39 1834 Q2020.78 1834 2018.95 1837.57 Q2017.14 1841.11 2017.14 1848.24 Q2017.14 1855.34 2018.95 1858.91 Q2020.78 1862.45 2024.39 1862.45 Q2028.02 1862.45 2029.83 1858.91 Q2031.66 1855.34 2031.66 1848.24 Q2031.66 1841.11 2029.83 1837.57 Q2028.02 1834 2024.39 1834 M2024.39 1830.3 Q2030.2 1830.3 2033.26 1834.9 Q2036.33 1839.49 2036.33 1848.24 Q2036.33 1856.96 2033.26 1861.57 Q2030.2 1866.15 2024.39 1866.15 Q2018.58 1866.15 2015.5 1861.57 Q2012.45 1856.96 2012.45 1848.24 Q2012.45 1839.49 2015.5 1834.9 Q2018.58 1830.3 2024.39 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip380)" d="M2516.11 1861.55 L2523.75 1861.55 L2523.75 1835.18 L2515.44 1836.85 L2515.44 1832.59 L2523.71 1830.92 L2528.38 1830.92 L2528.38 1861.55 L2536.02 1861.55 L2536.02 1865.48 L2516.11 1865.48 L2516.11 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip380)" d="M2555.47 1834 Q2551.85 1834 2550.03 1837.57 Q2548.22 1841.11 2548.22 1848.24 Q2548.22 1855.34 2550.03 1858.91 Q2551.85 1862.45 2555.47 1862.45 Q2559.1 1862.45 2560.9 1858.91 Q2562.73 1855.34 2562.73 1848.24 Q2562.73 1841.11 2560.9 1837.57 Q2559.1 1834 2555.47 1834 M2555.47 1830.3 Q2561.28 1830.3 2564.33 1834.9 Q2567.41 1839.49 2567.41 1848.24 Q2567.41 1856.96 2564.33 1861.57 Q2561.28 1866.15 2555.47 1866.15 Q2549.66 1866.15 2546.58 1861.57 Q2543.52 1856.96 2543.52 1848.24 Q2543.52 1839.49 2546.58 1834.9 Q2549.66 1830.3 2555.47 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip380)" d="M2585.63 1834 Q2582.02 1834 2580.19 1837.57 Q2578.38 1841.11 2578.38 1848.24 Q2578.38 1855.34 2580.19 1858.91 Q2582.02 1862.45 2585.63 1862.45 Q2589.26 1862.45 2591.07 1858.91 Q2592.9 1855.34 2592.9 1848.24 Q2592.9 1841.11 2591.07 1837.57 Q2589.26 1834 2585.63 1834 M2585.63 1830.3 Q2591.44 1830.3 2594.49 1834.9 Q2597.57 1839.49 2597.57 1848.24 Q2597.57 1856.96 2594.49 1861.57 Q2591.44 1866.15 2585.63 1866.15 Q2579.82 1866.15 2576.74 1861.57 Q2573.68 1856.96 2573.68 1848.24 Q2573.68 1839.49 2576.74 1834.9 Q2579.82 1830.3 2585.63 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip380)" d="M2615.79 1834 Q2612.18 1834 2610.35 1837.57 Q2608.54 1841.11 2608.54 1848.24 Q2608.54 1855.34 2610.35 1858.91 Q2612.18 1862.45 2615.79 1862.45 Q2619.42 1862.45 2621.23 1858.91 Q2623.06 1855.34 2623.06 1848.24 Q2623.06 1841.11 2621.23 1837.57 Q2619.42 1834 2615.79 1834 M2615.79 1830.3 Q2621.6 1830.3 2624.65 1834.9 Q2627.73 1839.49 2627.73 1848.24 Q2627.73 1856.96 2624.65 1861.57 Q2621.6 1866.15 2615.79 1866.15 Q2609.98 1866.15 2606.9 1861.57 Q2603.84 1856.96 2603.84 1848.24 Q2603.84 1839.49 2606.9 1834.9 Q2609.98 1830.3 2615.79 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip380)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1800.78 196.816,47.2441 "></polyline>
<polyline clip-path="url(#clip380)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1643.38 215.714,1643.38 "></polyline>
<polyline clip-path="url(#clip380)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1400.26 215.714,1400.26 "></polyline>
<polyline clip-path="url(#clip380)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1157.15 215.714,1157.15 "></polyline>
<polyline clip-path="url(#clip380)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,914.039 215.714,914.039 "></polyline>
<polyline clip-path="url(#clip380)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,670.927 215.714,670.927 "></polyline>
<polyline clip-path="url(#clip380)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,427.815 215.714,427.815 "></polyline>
<polyline clip-path="url(#clip380)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,184.704 215.714,184.704 "></polyline>
<path clip-path="url(#clip380)" d="M50.5475 1643.83 L80.2233 1643.83 L80.2233 1647.76 L50.5475 1647.76 L50.5475 1643.83 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip380)" d="M89.1352 1626.1 L111.357 1626.1 L111.357 1628.09 L98.8111 1660.66 L93.9269 1660.66 L105.732 1630.03 L89.1352 1630.03 L89.1352 1626.1 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip380)" d="M120.478 1654.78 L125.362 1654.78 L125.362 1660.66 L120.478 1660.66 L120.478 1654.78 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip380)" d="M135.593 1626.1 L153.95 1626.1 L153.95 1630.03 L139.876 1630.03 L139.876 1638.5 Q140.894 1638.16 141.913 1637.99 Q142.931 1637.81 143.95 1637.81 Q149.737 1637.81 153.116 1640.98 Q156.496 1644.15 156.496 1649.57 Q156.496 1655.15 153.024 1658.25 Q149.552 1661.33 143.232 1661.33 Q141.056 1661.33 138.788 1660.96 Q136.542 1660.59 134.135 1659.84 L134.135 1655.15 Q136.218 1656.28 138.441 1656.84 Q140.663 1657.39 143.14 1657.39 Q147.144 1657.39 149.482 1655.28 Q151.82 1653.18 151.82 1649.57 Q151.82 1645.96 149.482 1643.85 Q147.144 1641.74 143.14 1641.74 Q141.265 1641.74 139.39 1642.16 Q137.538 1642.58 135.593 1643.46 L135.593 1626.1 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip380)" d="M49.5521 1400.71 L79.2279 1400.71 L79.2279 1404.65 L49.5521 1404.65 L49.5521 1400.71 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip380)" d="M89.3667 1382.98 L107.723 1382.98 L107.723 1386.92 L93.6491 1386.92 L93.6491 1395.39 Q94.6676 1395.04 95.6861 1394.88 Q96.7047 1394.7 97.7232 1394.7 Q103.51 1394.7 106.89 1397.87 Q110.269 1401.04 110.269 1406.46 Q110.269 1412.03 106.797 1415.14 Q103.325 1418.21 97.0056 1418.21 Q94.8297 1418.21 92.5612 1417.84 Q90.3158 1417.47 87.9084 1416.73 L87.9084 1412.03 Q89.9917 1413.17 92.2139 1413.72 Q94.4361 1414.28 96.913 1414.28 Q100.918 1414.28 103.256 1412.17 Q105.593 1410.07 105.593 1406.46 Q105.593 1402.84 103.256 1400.74 Q100.918 1398.63 96.913 1398.63 Q95.038 1398.63 93.163 1399.05 Q91.3112 1399.46 89.3667 1400.34 L89.3667 1382.98 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip380)" d="M119.482 1411.66 L124.367 1411.66 L124.367 1417.54 L119.482 1417.54 L119.482 1411.66 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip380)" d="M144.552 1386.06 Q140.941 1386.06 139.112 1389.63 Q137.306 1393.17 137.306 1400.3 Q137.306 1407.4 139.112 1410.97 Q140.941 1414.51 144.552 1414.51 Q148.186 1414.51 149.991 1410.97 Q151.82 1407.4 151.82 1400.3 Q151.82 1393.17 149.991 1389.63 Q148.186 1386.06 144.552 1386.06 M144.552 1382.36 Q150.362 1382.36 153.417 1386.96 Q156.496 1391.55 156.496 1400.3 Q156.496 1409.02 153.417 1413.63 Q150.362 1418.21 144.552 1418.21 Q138.741 1418.21 135.663 1413.63 Q132.607 1409.02 132.607 1400.3 Q132.607 1391.55 135.663 1386.96 Q138.741 1382.36 144.552 1382.36 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip380)" d="M50.5475 1157.6 L80.2233 1157.6 L80.2233 1161.54 L50.5475 1161.54 L50.5475 1157.6 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip380)" d="M94.3436 1170.5 L110.663 1170.5 L110.663 1174.43 L88.7186 1174.43 L88.7186 1170.5 Q91.3806 1167.74 95.9639 1163.11 Q100.57 1158.46 101.751 1157.12 Q103.996 1154.59 104.876 1152.86 Q105.779 1151.1 105.779 1149.41 Q105.779 1146.65 103.834 1144.92 Q101.913 1143.18 98.8111 1143.18 Q96.6121 1143.18 94.1584 1143.95 Q91.7278 1144.71 88.9501 1146.26 L88.9501 1141.54 Q91.7741 1140.4 94.2278 1139.82 Q96.6815 1139.25 98.7185 1139.25 Q104.089 1139.25 107.283 1141.93 Q110.478 1144.62 110.478 1149.11 Q110.478 1151.24 109.668 1153.16 Q108.881 1155.06 106.774 1157.65 Q106.195 1158.32 103.094 1161.54 Q99.9917 1164.73 94.3436 1170.5 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip380)" d="M120.478 1168.55 L125.362 1168.55 L125.362 1174.43 L120.478 1174.43 L120.478 1168.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip380)" d="M135.593 1139.87 L153.95 1139.87 L153.95 1143.81 L139.876 1143.81 L139.876 1152.28 Q140.894 1151.93 141.913 1151.77 Q142.931 1151.58 143.95 1151.58 Q149.737 1151.58 153.116 1154.76 Q156.496 1157.93 156.496 1163.34 Q156.496 1168.92 153.024 1172.02 Q149.552 1175.1 143.232 1175.1 Q141.056 1175.1 138.788 1174.73 Q136.542 1174.36 134.135 1173.62 L134.135 1168.92 Q136.218 1170.06 138.441 1170.61 Q140.663 1171.17 143.14 1171.17 Q147.144 1171.17 149.482 1169.06 Q151.82 1166.95 151.82 1163.34 Q151.82 1159.73 149.482 1157.63 Q147.144 1155.52 143.14 1155.52 Q141.265 1155.52 139.39 1155.94 Q137.538 1156.35 135.593 1157.23 L135.593 1139.87 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip380)" d="M99.3204 899.838 Q95.7093 899.838 93.8806 903.403 Q92.075 906.944 92.075 914.074 Q92.075 921.18 93.8806 924.745 Q95.7093 928.287 99.3204 928.287 Q102.955 928.287 104.76 924.745 Q106.589 921.18 106.589 914.074 Q106.589 906.944 104.76 903.403 Q102.955 899.838 99.3204 899.838 M99.3204 896.134 Q105.131 896.134 108.186 900.741 Q111.265 905.324 111.265 914.074 Q111.265 922.801 108.186 927.407 Q105.131 931.991 99.3204 931.991 Q93.5102 931.991 90.4315 927.407 Q87.376 922.801 87.376 914.074 Q87.376 905.324 90.4315 900.741 Q93.5102 896.134 99.3204 896.134 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip380)" d="M119.482 925.44 L124.367 925.44 L124.367 931.319 L119.482 931.319 L119.482 925.44 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip380)" d="M144.552 899.838 Q140.941 899.838 139.112 903.403 Q137.306 906.944 137.306 914.074 Q137.306 921.18 139.112 924.745 Q140.941 928.287 144.552 928.287 Q148.186 928.287 149.991 924.745 Q151.82 921.18 151.82 914.074 Q151.82 906.944 149.991 903.403 Q148.186 899.838 144.552 899.838 M144.552 896.134 Q150.362 896.134 153.417 900.741 Q156.496 905.324 156.496 914.074 Q156.496 922.801 153.417 927.407 Q150.362 931.991 144.552 931.991 Q138.741 931.991 135.663 927.407 Q132.607 922.801 132.607 914.074 Q132.607 905.324 135.663 900.741 Q138.741 896.134 144.552 896.134 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip380)" d="M94.3436 684.272 L110.663 684.272 L110.663 688.207 L88.7186 688.207 L88.7186 684.272 Q91.3806 681.518 95.9639 676.888 Q100.57 672.235 101.751 670.893 Q103.996 668.37 104.876 666.633 Q105.779 664.874 105.779 663.184 Q105.779 660.43 103.834 658.694 Q101.913 656.958 98.8111 656.958 Q96.6121 656.958 94.1584 657.721 Q91.7278 658.485 88.9501 660.036 L88.9501 655.314 Q91.7741 654.18 94.2278 653.601 Q96.6815 653.022 98.7185 653.022 Q104.089 653.022 107.283 655.708 Q110.478 658.393 110.478 662.883 Q110.478 665.013 109.668 666.934 Q108.881 668.833 106.774 671.425 Q106.195 672.096 103.094 675.314 Q99.9917 678.508 94.3436 684.272 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip380)" d="M120.478 682.328 L125.362 682.328 L125.362 688.207 L120.478 688.207 L120.478 682.328 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip380)" d="M135.593 653.647 L153.95 653.647 L153.95 657.583 L139.876 657.583 L139.876 666.055 Q140.894 665.708 141.913 665.545 Q142.931 665.36 143.95 665.36 Q149.737 665.36 153.116 668.532 Q156.496 671.703 156.496 677.119 Q156.496 682.698 153.024 685.8 Q149.552 688.879 143.232 688.879 Q141.056 688.879 138.788 688.508 Q136.542 688.138 134.135 687.397 L134.135 682.698 Q136.218 683.832 138.441 684.388 Q140.663 684.944 143.14 684.944 Q147.144 684.944 149.482 682.837 Q151.82 680.731 151.82 677.119 Q151.82 673.508 149.482 671.402 Q147.144 669.295 143.14 669.295 Q141.265 669.295 139.39 669.712 Q137.538 670.129 135.593 671.008 L135.593 653.647 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip380)" d="M89.3667 410.535 L107.723 410.535 L107.723 414.471 L93.6491 414.471 L93.6491 422.943 Q94.6676 422.596 95.6861 422.434 Q96.7047 422.248 97.7232 422.248 Q103.51 422.248 106.89 425.42 Q110.269 428.591 110.269 434.008 Q110.269 439.586 106.797 442.688 Q103.325 445.767 97.0056 445.767 Q94.8297 445.767 92.5612 445.396 Q90.3158 445.026 87.9084 444.285 L87.9084 439.586 Q89.9917 440.72 92.2139 441.276 Q94.4361 441.832 96.913 441.832 Q100.918 441.832 103.256 439.725 Q105.593 437.619 105.593 434.008 Q105.593 430.396 103.256 428.29 Q100.918 426.184 96.913 426.184 Q95.038 426.184 93.163 426.6 Q91.3112 427.017 89.3667 427.896 L89.3667 410.535 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip380)" d="M119.482 439.216 L124.367 439.216 L124.367 445.095 L119.482 445.095 L119.482 439.216 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip380)" d="M144.552 413.614 Q140.941 413.614 139.112 417.179 Q137.306 420.721 137.306 427.85 Q137.306 434.957 139.112 438.521 Q140.941 442.063 144.552 442.063 Q148.186 442.063 149.991 438.521 Q151.82 434.957 151.82 427.85 Q151.82 420.721 149.991 417.179 Q148.186 413.614 144.552 413.614 M144.552 409.91 Q150.362 409.91 153.417 414.517 Q156.496 419.1 156.496 427.85 Q156.496 436.577 153.417 441.183 Q150.362 445.767 144.552 445.767 Q138.741 445.767 135.663 441.183 Q132.607 436.577 132.607 427.85 Q132.607 419.1 135.663 414.517 Q138.741 409.91 144.552 409.91 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip380)" d="M89.1352 167.424 L111.357 167.424 L111.357 169.414 L98.8111 201.984 L93.9269 201.984 L105.732 171.359 L89.1352 171.359 L89.1352 167.424 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip380)" d="M120.478 196.104 L125.362 196.104 L125.362 201.984 L120.478 201.984 L120.478 196.104 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip380)" d="M135.593 167.424 L153.95 167.424 L153.95 171.359 L139.876 171.359 L139.876 179.831 Q140.894 179.484 141.913 179.322 Q142.931 179.136 143.95 179.136 Q149.737 179.136 153.116 182.308 Q156.496 185.479 156.496 190.896 Q156.496 196.474 153.024 199.576 Q149.552 202.655 143.232 202.655 Q141.056 202.655 138.788 202.284 Q136.542 201.914 134.135 201.173 L134.135 196.474 Q136.218 197.609 138.441 198.164 Q140.663 198.72 143.14 198.72 Q147.144 198.72 149.482 196.613 Q151.82 194.507 151.82 190.896 Q151.82 187.285 149.482 185.178 Q147.144 183.072 143.14 183.072 Q141.265 183.072 139.39 183.488 Q137.538 183.905 135.593 184.785 L135.593 167.424 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip382)" style="stroke:#009af9; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="265.984,1231.12 268.292,1428.66 270.6,1491.08 272.908,1481.52 275.216,1206.91 277.524,1441.39 279.832,1482.58 282.139,1335.92 284.447,1286.83 286.755,1429.72 289.063,1362.04 291.371,1447.47 293.679,1282.95 295.987,1336.52 298.295,1356 300.603,1488.89 302.911,1479.58 305.219,1347.93 307.527,1244.14 309.834,1306.92 312.142,1251.7 314.45,1442.85 316.758,1256.98 319.066,1522.85 321.374,1174.9 323.682,1507.04 325.99,1262.23 328.298,1384.23 330.606,1650.66 332.914,1466.28 335.221,1401.95 337.529,1306.94 339.837,1258.8 342.145,1311.3 344.453,1385.04 346.761,1290.5 349.069,1404.19 351.377,1351.39 353.685,1328.18 355.993,1606.42 358.301,1450.35 360.608,1409.7 362.916,1495.81 365.224,1346.12 367.532,1391.45 369.84,1444.68 372.148,1686.87 374.456,1402.33 376.764,1356.11 379.072,1364.36 381.38,1359.02 383.688,1192.27 385.996,1482.34 388.303,1544.99 390.611,1380.56 392.919,1226.24 395.227,1497.74 397.535,1223.68 399.843,1213.79 402.151,1419.49 404.459,1370.53 406.767,1248.29 409.075,1541.8 411.383,1438.84 413.69,1511.31 415.998,1392.02 418.306,1444.92 420.614,1268.06 422.922,1477.82 425.23,1300.05 427.538,1578.12 429.846,1549.87 432.154,1550.43 434.462,1326.86 436.77,1326.3 439.077,1341.14 441.385,1402.55 443.693,1455.05 446.001,1332.61 448.309,1334.27 450.617,1531.85 452.925,1441.36 455.233,1535.59 457.541,1389.73 459.849,1300.44 462.157,1523.49 464.465,1308.36 466.772,1388.36 469.08,1225.98 471.388,1616.63 473.696,1361.73 476.004,1451.7 478.312,1521.38 480.62,1364.5 482.928,1477.62 485.236,1413.75 487.544,1498.04 489.852,1467.97 492.159,1540.08 494.467,1380.2 496.775,1579.94 499.083,1480.29 501.391,1392.36 503.699,1509.36 506.007,1408.81 508.315,1467.5 510.623,1402.78 512.931,1242.63 515.239,1406.68 517.546,1201.16 519.854,1367.39 522.162,1380.95 524.47,1390.61 526.778,1417.14 529.086,1281.85 531.394,1483.64 533.702,1510.46 536.01,1399.52 538.318,1516.65 540.626,1330.81 542.933,1281.71 545.241,1337.55 547.549,1567.64 549.857,1546.58 552.165,1298.7 554.473,1319.88 556.781,1432.24 559.089,1465.2 561.397,1376.28 563.705,1410.8 566.013,1418.44 568.321,1327.18 570.628,1278.9 572.936,1478.81 575.244,1371.02 577.552,1260.02 579.86,1176.77 582.168,1486.43 584.476,1276.98 586.784,1309.72 589.092,1447.54 591.4,1263.42 593.708,1388.6 596.015,1350.83 598.323,1360.16 600.631,1345.43 602.939,1356.8 605.247,1541.89 607.555,1411.78 609.863,1510.33 612.171,1339.9 614.479,1474.08 616.787,1393.93 619.095,1571.26 621.402,1514.42 623.71,1443.97 626.018,1393.36 628.326,1351.55 630.634,1536.29 632.942,1312.3 635.25,1422.66 637.558,1336.23 639.866,1261.14 642.174,1550.69 644.482,1425 646.79,1419.82 649.097,1218.01 651.405,1285.76 653.713,1403.4 656.021,1474.55 658.329,1248.57 660.637,1349.39 662.945,1222.88 665.253,1531.96 667.561,1559.44 669.869,1354.48 672.177,1284.66 674.484,1419.53 676.792,1421.67 679.1,1391.87 681.408,1532.06 683.716,1449.49 686.024,1235.91 688.332,1307.76 690.64,1342.7 692.948,1554.18 695.256,1583.53 697.564,1484.75 699.871,1427.45 702.179,1312.38 704.487,1204.06 706.795,1256.8 709.103,1392.47 711.411,1279.33 713.719,1525.87 716.027,1379.58 718.335,1288.27 720.643,1295.98 722.951,1394.48 725.259,1539.91 727.566,1433 729.874,1250.33 732.182,1330.8 734.49,1364.39 736.798,1393.55 739.106,1380.06 741.414,1415.42 743.722,1362.88 746.03,1419.92 748.338,1342.09 750.646,1377.31 752.953,1321.96 755.261,1308.33 757.569,1492.49 759.877,1487.91 762.185,1471.35 764.493,1751.15 766.801,1480.59 769.109,1324.68 771.417,1389.34 773.725,1458.51 776.033,1380.47 778.34,1521.78 780.648,1398.62 782.956,1509.54 785.264,1490.39 787.572,1411.01 789.88,1483.09 792.188,1411.02 794.496,1269.09 796.804,1417.59 799.112,1534.19 801.42,1363.24 803.728,1349.5 806.035,1453.23 808.343,1303.31 810.651,1513.59 812.959,1368.65 815.267,1557.47 817.575,1416.51 819.883,1316.87 822.191,1427.95 824.499,1472.11 826.807,1516.12 829.115,1367.52 831.422,1269.6 833.73,1372.41 836.038,1398.44 838.346,1480.43 840.654,1388.17 842.962,1438.97 845.27,1405.84 847.578,1293.31 849.886,1257.16 852.194,1535.38 854.502,1320.49 856.809,1349.76 859.117,1278.81 861.425,1493.6 863.733,1424.18 866.041,1372.08 868.349,1365.86 870.657,1385.02 872.965,1550.51 875.273,1526.25 877.581,1440.82 879.889,1471.45 882.197,1449.91 884.504,1296.52 886.812,1487.32 889.12,1527.06 891.428,1305.77 893.736,1356.42 896.044,1405.83 898.352,1249.62 900.66,1429.46 902.968,1409.34 905.276,1498.35 907.584,1357.77 909.891,1564.71 912.199,1372.15 914.507,1251.54 916.815,1354.23 919.123,1303 921.431,1557.79 923.739,1385.23 926.047,1416.57 928.355,1376.73 930.663,1479.23 932.971,1372.31 935.278,1548.53 937.586,1274.17 939.894,1365.09 942.202,1231.62 944.51,1442.87 946.818,1467.5 949.126,1362.45 951.434,1448.43 953.742,1326.1 956.05,1433.82 958.358,1321.26 960.665,1422.57 962.973,1467.04 965.281,1488.58 967.589,1300.92 969.897,1417.62 972.205,1235.61 974.513,1485.54 976.821,1344.76 979.129,1444.76 981.437,1654.59 983.745,1311.74 986.053,1246.9 988.36,1257.63 990.668,1393.08 992.976,1319.25 995.284,1327.62 997.592,1475.7 999.9,1428.67 1002.21,1483.26 1004.52,1491.02 1006.82,1350.86 1009.13,1347.87 1011.44,1339.34 1013.75,1533.58 1016.06,1464.66 1018.36,1437.7 1020.67,1477.15 1022.98,1434.16 1025.29,1184.27 1027.59,1399.77 1029.9,1420.57 1032.21,1396.11 1034.52,1300.06 1036.83,1341.69 1039.13,1317.8 1041.44,1421.05 1043.75,1099.24 1046.06,1281.16 1048.37,1287.74 1050.67,1475.08 1052.98,1425.91 1055.29,1497.33 1057.6,1445.97 1059.91,1394.72 1062.21,1382.26 1064.52,1352.57 1066.83,1475.56 1069.14,1384.41 1071.45,1462.09 1073.75,1382.38 1076.06,1414.37 1078.37,1443.1 1080.68,1566.21 1082.98,1440.65 1085.29,1382.03 1087.6,1201.99 1089.91,1482.47 1092.22,1478.73 1094.52,1520.75 1096.83,1391.76 1099.14,1450.25 1101.45,1336.42 1103.76,1396.66 1106.06,1359.97 1108.37,1341.46 1110.68,1142.94 1112.99,1464.79 1115.3,1356.45 1117.6,1374.51 1119.91,1370.83 1122.22,1536.47 1124.53,1339.99 1126.84,1444.34 1129.14,1345.54 1131.45,1376.11 1133.76,1386.75 1136.07,1576.57 1138.37,1439.42 1140.68,1320.23 1142.99,1418.12 1145.3,1388.77 1147.61,1340.97 1149.91,1373.53 1152.22,1566.51 1154.53,1394.72 1156.84,1290.13 1159.15,1283.78 1161.45,1356.66 1163.76,1460.04 1166.07,1349.7 1168.38,1214.47 1170.69,1575.19 1172.99,1288.88 1175.3,1437.7 1177.61,1335.2 1179.92,1290.09 1182.23,1358.14 1184.53,1428.27 1186.84,1367.64 1189.15,1590.34 1191.46,1401.45 1193.76,1578.85 1196.07,1415.16 1198.38,1448.91 1200.69,1382.95 1203,1430.94 1205.3,1415.95 1207.61,1359.25 1209.92,1438.39 1212.23,1300.17 1214.54,1305.39 1216.84,1233.36 1219.15,1381.87 1221.46,1569.64 1223.77,1403.61 1226.08,1479.13 1228.38,1383.45 1230.69,1497.6 1233,1514.83 1235.31,1317.42 1237.61,1533.23 1239.92,1476.9 1242.23,1302.14 1244.54,1413.16 1246.85,1387.07 1249.15,1474.48 1251.46,1303.06 1253.77,1279.02 1256.08,1298.25 1258.39,1449.27 1260.69,1508.8 1263,1405.54 1265.31,1392.83 1267.62,1363.64 1269.93,1353.54 1272.23,1490.12 1274.54,1323.05 1276.85,1402.49 1279.16,1432.15 1281.47,1372.17 1283.77,1514.72 1286.08,1515.4 1288.39,1506.37 1290.7,1411.62 1293,1406.84 1295.31,1353.92 1297.62,1393.16 1299.93,1395.34 1302.24,1453.19 1304.54,1258.1 1306.85,1326.03 1309.16,1216.43 1311.47,1343.61 1313.78,1445.91 1316.08,1322.77 1318.39,1409.97 1320.7,1458.13 1323.01,1296.14 1325.32,1273.79 1327.62,1441.65 1329.93,1341.7 1332.24,1498.4 1334.55,1302.08 1336.86,1271.39 1339.16,1461.97 1341.47,1428.79 1343.78,1448.51 1346.09,1350.88 1348.39,1512.82 1350.7,1367.34 1353.01,1389.77 1355.32,1312.98 1357.63,1245.75 1359.93,1565.98 1362.24,1506.95 1364.55,1320.9 1366.86,1264.08 1369.17,1388.99 1371.47,1375.51 1373.78,1568.83 1376.09,1461.71 1378.4,1363.44 1380.71,1439.55 1383.01,1233.73 1385.32,1379.14 1387.63,1357.34 1389.94,1317.16 1392.24,1440.2 1394.55,1169.05 1396.86,1466.99 1399.17,1408.4 1401.48,1176.98 1403.78,1349.7 1406.09,1506.66 1408.4,1343.5 1410.71,1468.92 1413.02,1580.08 1415.32,1544.55 1417.63,1369.68 1419.94,1358.5 1422.25,1345.45 1424.56,1638.4 1426.86,1431.06 1429.17,1583.62 1431.48,1345.93 1433.79,1501.71 1436.1,1420.37 1438.4,1417.04 1440.71,1252.34 1443.02,1208.65 1445.33,1382.59 1447.63,1423.69 1449.94,1399.54 1452.25,1313.86 1454.56,1429.62 1456.87,1291.24 1459.17,1311.73 1461.48,1423.87 1463.79,1313.19 1466.1,1310.87 1468.41,1418.11 1470.71,1408.21 1473.02,1488.36 1475.33,1356.32 1477.64,1398.05 1479.95,1630.5 1482.25,1454.39 1484.56,1366.91 1486.87,1470.51 1489.18,1282.43 1491.49,1218.39 1493.79,1537.07 1496.1,1388.75 1498.41,1466.82 1500.72,1428.06 1503.02,1433.23 1505.33,1276.47 1507.64,1332.7 1509.95,1317.02 1512.26,1566.8 1514.56,1350.45 1516.87,1384.66 1519.18,1564.74 1521.49,1391.63 1523.8,1351.15 1526.1,1394.33 1528.41,1364.33 1530.72,1410.95 1533.03,1352.81 1535.34,1127.18 1537.64,1403.28 1539.95,1476.06 1542.26,1267.26 1544.57,1432.26 1546.88,1455.02 1549.18,1425.65 1551.49,1322.32 1553.8,1663.64 1556.11,1384.99 1558.41,1384.38 1560.72,1375.56 1563.03,1589.42 1565.34,1494.7 1567.65,1469.33 1569.95,1466.84 1572.26,1321.42 1574.57,1577.93 1576.88,1370.49 1579.19,1454.16 1581.49,1352.98 1583.8,1337.81 1586.11,1362.52 1588.42,1350.73 1590.73,1481.38 1593.03,1321.28 1595.34,1502.14 1597.65,1415.68 1599.96,1447.2 1602.26,1228.89 1604.57,1306.64 1606.88,1460.21 1609.19,1446.9 1611.5,1542.88 1613.8,1210.54 1616.11,1281.16 1618.42,1269.32 1620.73,1475.15 1623.04,1565.92 1625.34,1431.85 1627.65,1502.62 1629.96,1506.25 1632.27,1324.96 1634.58,1314.39 1636.88,1398.98 1639.19,1397.45 1641.5,1308.55 1643.81,1416 1646.12,1573.66 1648.42,1462.74 1650.73,1340.32 1653.04,1490.27 1655.35,1419.58 1657.65,1410.95 1659.96,1361.45 1662.27,1433.37 1664.58,1402.21 1666.89,1456.83 1669.19,1448.84 1671.5,1419.54 1673.81,1236.26 1676.12,1251.19 1678.43,1512.42 1680.73,1349.02 1683.04,1374.35 1685.35,1398.74 1687.66,1622.73 1689.97,1573.77 1692.27,1472.51 1694.58,1430.64 1696.89,1431.57 1699.2,1396.36 1701.51,1444.19 1703.81,1572.96 1706.12,1373.42 1708.43,1380.93 1710.74,1370.75 1713.04,1359.75 1715.35,1429.82 1717.66,1547.51 1719.97,1443.91 1722.28,1463.51 1724.58,1216.17 1726.89,1527.33 1729.2,1678.83 1731.51,1255.41 1733.82,1452.67 1736.12,1396 1738.43,1259.35 1740.74,1529.58 1743.05,1412.28 1745.36,1400.96 1747.66,1245.81 1749.97,1420.12 1752.28,1394.5 1754.59,1411.74 1756.9,1395.84 1759.2,1456.51 1761.51,1473.53 1763.82,1207.4 1766.13,1406.01 1768.43,1360.99 1770.74,1301.35 1773.05,1287.02 1775.36,1405.9 1777.67,1349.31 1779.97,1214.57 1782.28,1557.36 1784.59,1379.18 1786.9,1408.92 1789.21,1502.07 1791.51,1431.21 1793.82,1395.87 1796.13,1314.45 1798.44,1217.98 1800.75,1474.8 1803.05,1430.48 1805.36,1441.42 1807.67,1498.17 1809.98,1403.21 1812.28,1584.56 1814.59,1390.41 1816.9,1316.68 1819.21,1591.06 1821.52,1387.4 1823.82,1487.26 1826.13,1437.83 1828.44,1330.98 1830.75,1292.07 1833.06,1240.67 1835.36,1478.93 1837.67,1364.23 1839.98,1436.78 1842.29,1330.89 1844.6,1373.82 1846.9,1465.45 1849.21,1559.11 1851.52,1474.26 1853.83,1485.34 1856.14,1306.16 1858.44,1376.71 1860.75,1427.59 1863.06,1495.97 1865.37,1570.12 1867.67,1523.89 1869.98,1320.71 1872.29,1406.28 1874.6,1285.86 1876.91,1364.19 1879.21,1106.47 1881.52,1499.07 1883.83,1176.03 1886.14,1299.94 1888.45,1321.8 1890.75,1099.09 1893.06,1484.14 1895.37,1525.07 1897.68,1356.06 1899.99,1413.91 1902.29,1392.51 1904.6,1320.81 1906.91,1412.04 1909.22,1439.75 1911.53,1437.25 1913.83,1381.14 1916.14,1564.12 1918.45,1549.26 1920.76,1307.29 1923.06,1313.32 1925.37,1248.13 1927.68,1500.85 1929.99,1398.47 1932.3,1426.22 1934.6,1532.81 1936.91,1406.39 1939.22,1504.08 1941.53,1516.07 1943.84,1248.77 1946.14,1482.9 1948.45,1344.96 1950.76,1227.16 1953.07,1239.78 1955.38,1371.56 1957.68,1527.75 1959.99,1464.55 1962.3,1457.6 1964.61,1291.86 1966.91,1537.77 1969.22,1378.67 1971.53,1470.68 1973.84,1430.34 1976.15,1475.74 1978.45,1521.3 1980.76,1521.39 1983.07,1595.28 1985.38,1524.71 1987.69,1389.63 1989.99,1352.73 1992.3,1276.32 1994.61,1384.54 1996.92,1356.79 1999.23,1398.37 2001.53,1486.53 2003.84,1334.95 2006.15,1547.13 2008.46,1457.74 2010.77,1271.84 2013.07,1490.61 2015.38,1385.72 2017.69,1391.47 2020,1574.47 2022.3,1352.4 2024.61,1480.04 2026.92,1482.02 2029.23,1378.3 2031.54,1452.2 2033.84,1327.33 2036.15,1344.82 2038.46,1377.98 2040.77,1498.39 2043.08,1380.56 2045.38,1453.29 2047.69,1491.58 2050,1446.3 2052.31,1346.19 2054.62,1298.96 2056.92,1305.31 2059.23,1408.13 2061.54,1424.39 2063.85,1471.7 2066.16,1234.67 2068.46,1269.17 2070.77,1400.95 2073.08,1514.97 2075.39,1365.81 2077.69,1290.59 2080,1408.51 2082.31,1480.11 2084.62,1431.17 2086.93,1421.33 2089.23,1400.45 2091.54,1296.97 2093.85,1423.26 2096.16,1193.04 2098.47,1350.71 2100.77,1443.29 2103.08,1203.57 2105.39,1283.03 2107.7,1501.69 2110.01,1558.88 2112.31,1237.13 2114.62,1297.78 2116.93,1413.43 2119.24,1424.94 2121.55,1423.68 2123.85,1421.47 2126.16,1420.97 2128.47,1388.18 2130.78,1506.63 2133.08,1368.25 2135.39,1302.24 2137.7,1343.27 2140.01,1207.71 2142.32,1358.68 2144.62,1309.4 2146.93,1419.66 2149.24,1362.99 2151.55,1432.93 2153.86,1481.96 2156.16,1409.42 2158.47,1258.38 2160.78,1510.35 2163.09,1412.72 2165.4,1377.03 2167.7,1165.76 2170.01,1369.85 2172.32,1395.05 2174.63,1375.24 2176.93,1305.94 2179.24,1188.42 2181.55,1293.08 2183.86,1357.69 2186.17,1519.44 2188.47,1476.9 2190.78,1443.62 2193.09,1328.84 2195.4,1286.76 2197.71,1158 2200.01,1468.29 2202.32,1377.07 2204.63,1381.72 2206.94,1481.51 2209.25,1299.54 2211.55,1500.65 2213.86,1424.29 2216.17,1344.09 2218.48,1459.57 2220.79,1389.89 2223.09,1414.89 2225.4,1338.17 2227.71,1448.2 2230.02,1249.51 2232.32,1461.03 2234.63,1431.03 2236.94,1316.67 2239.25,1447.38 2241.56,1344.42 2243.86,1394.33 2246.17,1357.08 2248.48,1347.51 2250.79,1407.22 2253.1,1402.34 2255.4,1666.83 2257.71,1512.03 2260.02,1509.64 2262.33,1251.45 2264.64,1489 2266.94,1163.7 2269.25,1576.68 2271.56,1304.09 2273.87,1351.48 2276.18,1297.36 2278.48,1483.15 2280.79,1281.88 2283.1,1342.57 2285.41,1418.94 2287.71,1326.22 2290.02,1270.88 2292.33,1377.25 2294.64,1291.36 2296.95,1394.35 2299.25,1200.56 2301.56,1419.21 2303.87,1466.25 2306.18,1447.91 2308.49,1326.66 2310.79,1282.86 2313.1,1415.57 2315.41,1494.58 2317.72,1585.28 2320.03,1461.86 2322.33,1255.55 2324.64,1419.22 2326.95,1624.89 2329.26,1382.65 2331.56,1394.61 2333.87,1696.79 2336.18,1483.67 2338.49,1358.18 2340.8,1368.98 2343.1,1270.43 2345.41,1237.37 2347.72,1370.86 2350.03,1451.65 2352.34,1416.21 2354.64,1403.46 2356.95,1412.27 2359.26,1558.68 2361.57,1344.22 2363.88,1556.64 2366.18,1414.6 2368.49,1363.55 2370.8,1241.15 2373.11,1359.3 2375.42,1522.73 2377.72,1505.43 2380.03,1389.23 2382.34,1266.38 2384.65,1375.92 2386.95,1378.63 2389.26,1396.58 2391.57,1408.52 2393.88,1339.68 2396.19,1446.39 2398.49,1465.39 2400.8,1560.96 2403.11,1373.53 2405.42,1233.26 2407.73,1452.01 2410.03,1241.41 2412.34,1295.05 2414.65,1460.87 2416.96,1305.44 2419.27,1493.33 2421.57,1397.18 2423.88,1290.82 2426.19,1236.46 2428.5,1489.1 2430.81,1352.93 2433.11,1279.54 2435.42,1235.59 2437.73,1281.36 2440.04,1401.19 2442.34,1445.75 2444.65,1413 2446.96,1363.85 2449.27,1406.08 2451.58,1363.27 2453.88,1405.35 2456.19,1545.23 2458.5,1408.47 2460.81,1490.08 2463.12,1530.62 2465.42,1442.96 2467.73,1338.22 2470.04,1197.09 2472.35,1510.95 2474.66,1581.68 2476.96,1414.97 2479.27,1441.8 2481.58,1539.93 2483.89,1482.12 2486.2,1418.07 2488.5,1576.2 2490.81,1536.17 2493.12,1424.87 2495.43,1347.39 2497.73,1390.6 2500.04,1350.52 2502.35,1403.59 2504.66,1472.29 2506.97,1453.13 2509.27,1380.8 2511.58,1237.43 2513.89,1273.5 2516.2,1338.91 2518.51,1601.58 2520.81,1322.88 2523.12,1423.08 2525.43,1275.23 2527.74,1583.93 2530.05,1497.99 2532.35,1562.52 2534.66,1397.7 2536.97,1411.43 2539.28,1434.15 2541.58,1394.06 2543.89,1248.82 2546.2,1238.05 2548.51,1291.99 2550.82,1339.87 2553.12,1429.47 2555.43,1438.39 2557.74,1372.46 2560.05,1266.06 2562.36,1403.48 2564.66,1289.99 2566.97,1305.49 2569.28,1217.18 2571.59,1348.19 "></polyline>
<polyline clip-path="url(#clip382)" style="stroke:#e26f46; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="265.984,951.748 268.292,755.867 270.6,847.594 272.908,937.634 275.216,873.42 277.524,903.376 279.832,830.304 282.139,927.633 284.447,781.404 286.755,916.017 289.063,974.348 291.371,863.392 293.679,941.733 295.987,1025.18 298.295,891.769 300.603,953.878 302.911,933.783 305.219,961.818 307.527,924.324 309.834,929.973 312.142,910.537 314.45,954.842 316.758,822.754 319.066,919.54 321.374,924.187 323.682,853.343 325.99,859.339 328.298,1006.83 330.606,943.082 332.914,789.231 335.221,957.856 337.529,970.492 339.837,874.026 342.145,950.96 344.453,951.268 346.761,867.496 349.069,863.045 351.377,960.568 353.685,782.64 355.993,985.26 358.301,874.732 360.608,896.941 362.916,905.539 365.224,1090.64 367.532,1041.58 369.84,1067.39 372.148,774.176 374.456,791.963 376.764,977.851 379.072,1001.79 381.38,840.557 383.688,870.354 385.996,980.712 388.303,995.235 390.611,929.722 392.919,974.103 395.227,758.635 397.535,920.231 399.843,1045.81 402.151,992.631 404.459,787.978 406.767,920.475 409.075,966.236 411.383,857.29 413.69,787.829 415.998,910.161 418.306,985.507 420.614,963.208 422.922,846.472 425.23,976.177 427.538,1069.54 429.846,891.491 432.154,839.301 434.462,960.678 436.77,1052.03 439.077,761.314 441.385,863.872 443.693,951.728 446.001,796.301 448.309,891.782 450.617,1066.22 452.925,789.769 455.233,850.456 457.541,1074.36 459.849,725.991 462.157,774.935 464.465,797.067 466.772,660.457 469.08,888.662 471.388,993.962 473.696,889.674 476.004,776.225 478.312,808.136 480.62,1039.99 482.928,686.078 485.236,943.874 487.544,975.322 489.852,977.99 492.159,914.908 494.467,1050.38 496.775,730.868 499.083,995.261 501.391,1069.14 503.699,970.494 506.007,689.083 508.315,1054.36 510.623,833.158 512.931,921.266 515.239,810.889 517.546,907.753 519.854,829.29 522.162,1117.77 524.47,950.506 526.778,822.866 529.086,967.988 531.394,904.721 533.702,878.95 536.01,783.581 538.318,819.561 540.626,874.736 542.933,982.25 545.241,798.267 547.549,965.967 549.857,913.127 552.165,994.759 554.473,949.718 556.781,899.648 559.089,962.984 561.397,983.118 563.705,875.649 566.013,1163.96 568.321,796.483 570.628,873.477 572.936,900.175 575.244,1069.97 577.552,962.028 579.86,823.691 582.168,951.751 584.476,1064.77 586.784,832.236 589.092,946.552 591.4,1026.24 593.708,975.963 596.015,874.885 598.323,1013.02 600.631,779.884 602.939,916.913 605.247,929.533 607.555,984.499 609.863,964.51 612.171,926.135 614.479,994.629 616.787,919.07 619.095,858.604 621.402,954.065 623.71,806.921 626.018,868.024 628.326,1027.56 630.634,831.492 632.942,889.037 635.25,895.55 637.558,890.51 639.866,863.725 642.174,1161.52 644.482,988.445 646.79,854.982 649.097,929.622 651.405,874.993 653.713,904.773 656.021,784.152 658.329,921.997 660.637,1064.59 662.945,1030.08 665.253,1167.63 667.561,931.907 669.869,1050.78 672.177,1001.18 674.484,954.75 676.792,1005.47 679.1,1038.35 681.408,851.657 683.716,954.887 686.024,826.679 688.332,927.029 690.64,826.763 692.948,828.239 695.256,963.09 697.564,939.635 699.871,1018.85 702.179,835.415 704.487,989.736 706.795,923.81 709.103,961.276 711.411,869.873 713.719,950.256 716.027,831.519 718.335,880.988 720.643,706.481 722.951,883.836 725.259,1053.19 727.566,693.036 729.874,695.737 732.182,964.791 734.49,860.008 736.798,807.197 739.106,920.733 741.414,1071.06 743.722,808.237 746.03,933.999 748.338,1027.74 750.646,1014.99 752.953,990.957 755.261,1076.2 757.569,853.279 759.877,1063.3 762.185,938.669 764.493,862.921 766.801,917.416 769.109,888.777 771.417,852.995 773.725,893.154 776.033,1005.99 778.34,934.754 780.648,812.09 782.956,802.486 785.264,852.515 787.572,1090.69 789.88,825.684 792.188,862.332 794.496,808.683 796.804,938.576 799.112,953.502 801.42,867.807 803.728,994.235 806.035,1026.66 808.343,751.918 810.651,843.893 812.959,785.806 815.267,781.29 817.575,858.994 819.883,982.546 822.191,955.864 824.499,780.972 826.807,819.051 829.115,952.927 831.422,1015.87 833.73,977.391 836.038,921.922 838.346,1036.3 840.654,1005.53 842.962,918.453 845.27,928.569 847.578,1007.39 849.886,953.934 852.194,904.587 854.502,894.994 856.809,913.676 859.117,1026.01 861.425,972.345 863.733,966.766 866.041,849.03 868.349,833.121 870.657,776.179 872.965,879.391 875.273,1009.54 877.581,1017.59 879.889,882.64 882.197,872.51 884.504,1081.66 886.812,694.953 889.12,935.427 891.428,862.747 893.736,849.984 896.044,820.43 898.352,807.314 900.66,834.562 902.968,808.234 905.276,875.19 907.584,1047.76 909.891,995.506 912.199,945.083 914.507,991.148 916.815,1049.01 919.123,853.443 921.431,990.235 923.739,909.714 926.047,892.024 928.355,966.454 930.663,830.703 932.971,864.897 935.278,794.288 937.586,977.216 939.894,938.441 942.202,956.225 944.51,897.215 946.818,851.462 949.126,934.639 951.434,952.631 953.742,923.529 956.05,894.118 958.358,895.167 960.665,1063.73 962.973,891.547 965.281,918.311 967.589,821.689 969.897,923.666 972.205,840.387 974.513,928.366 976.821,1022.61 979.129,980.72 981.437,988.782 983.745,1025.53 986.053,857.796 988.36,839.785 990.668,1060.45 992.976,828.799 995.284,887.336 997.592,973.431 999.9,960.006 1002.21,1035.91 1004.52,983.272 1006.82,861.547 1009.13,890.324 1011.44,1049.41 1013.75,1098.54 1016.06,1081.52 1018.36,960.345 1020.67,1098.26 1022.98,922.722 1025.29,1103.41 1027.59,958.164 1029.9,940.478 1032.21,882.138 1034.52,944.13 1036.83,907.087 1039.13,872.047 1041.44,1004.5 1043.75,923.029 1046.06,897.834 1048.37,1015.52 1050.67,690.293 1052.98,972.162 1055.29,785.737 1057.6,855.738 1059.91,983.103 1062.21,964.716 1064.52,902.146 1066.83,911.986 1069.14,783.089 1071.45,819.513 1073.75,884.604 1076.06,877.723 1078.37,969.715 1080.68,916.481 1082.98,879.513 1085.29,1016.86 1087.6,978.08 1089.91,1190.84 1092.22,886.187 1094.52,785.686 1096.83,974.122 1099.14,863.869 1101.45,873.609 1103.76,984.9 1106.06,1033.64 1108.37,876.465 1110.68,905.803 1112.99,845.518 1115.3,851.646 1117.6,817.748 1119.91,1068.5 1122.22,913.582 1124.53,823.938 1126.84,731.721 1129.14,872.779 1131.45,754.243 1133.76,981.73 1136.07,712.07 1138.37,1004.21 1140.68,975.936 1142.99,864.04 1145.3,925.116 1147.61,860.112 1149.91,788.157 1152.22,800.389 1154.53,701.563 1156.84,955.221 1159.15,890.166 1161.45,873.703 1163.76,961.12 1166.07,972.092 1168.38,898.121 1170.69,845.253 1172.99,1058.29 1175.3,949.553 1177.61,933.576 1179.92,935.556 1182.23,910.526 1184.53,817.048 1186.84,911.55 1189.15,947.053 1191.46,985.437 1193.76,936.475 1196.07,719.653 1198.38,891.447 1200.69,875.821 1203,1103.5 1205.3,875.784 1207.61,819.275 1209.92,1113.87 1212.23,708.695 1214.54,647.047 1216.84,907.454 1219.15,807.934 1221.46,925.795 1223.77,957.339 1226.08,729.229 1228.38,830.291 1230.69,825.309 1233,813.381 1235.31,930.338 1237.61,1074.82 1239.92,795.63 1242.23,910.256 1244.54,882.91 1246.85,878.231 1249.15,842.562 1251.46,857.048 1253.77,695.517 1256.08,1015.2 1258.39,939.944 1260.69,897.662 1263,882.129 1265.31,914.679 1267.62,896.61 1269.93,905.637 1272.23,889.15 1274.54,867.716 1276.85,857.268 1279.16,825.275 1281.47,940.033 1283.77,708.742 1286.08,896.13 1288.39,1161.66 1290.7,938.878 1293,927.534 1295.31,906.976 1297.62,912.487 1299.93,839.981 1302.24,897.632 1304.54,703.1 1306.85,986.482 1309.16,915.582 1311.47,857.475 1313.78,1050.48 1316.08,863.473 1318.39,782.797 1320.7,1050.59 1323.01,840.787 1325.32,872.937 1327.62,1022.91 1329.93,933.198 1332.24,757.83 1334.55,897.982 1336.86,1020.66 1339.16,1021.67 1341.47,988.641 1343.78,954.916 1346.09,821.006 1348.39,837.458 1350.7,863.031 1353.01,979.652 1355.32,1091.7 1357.63,895.996 1359.93,949.053 1362.24,842.545 1364.55,833.606 1366.86,902.131 1369.17,840.269 1371.47,1002.07 1373.78,904.527 1376.09,840.5 1378.4,967.03 1380.71,1088.33 1383.01,947.945 1385.32,781.563 1387.63,840.85 1389.94,962.664 1392.24,814.381 1394.55,1029.98 1396.86,997.073 1399.17,969.378 1401.48,765.287 1403.78,827.738 1406.09,1013.95 1408.4,1101.96 1410.71,867 1413.02,796.153 1415.32,954.368 1417.63,781.848 1419.94,968.092 1422.25,824.655 1424.56,801.839 1426.86,946.685 1429.17,1009.95 1431.48,1115.48 1433.79,960.673 1436.1,731.481 1438.4,987.393 1440.71,885.964 1443.02,980.164 1445.33,922.62 1447.63,1003.35 1449.94,856.09 1452.25,875.059 1454.56,895.294 1456.87,908.301 1459.17,804.629 1461.48,958.528 1463.79,987.615 1466.1,1009.83 1468.41,949.019 1470.71,906.079 1473.02,974.997 1475.33,855.315 1477.64,966.245 1479.95,788.319 1482.25,864.451 1484.56,847.291 1486.87,971.426 1489.18,859.509 1491.49,933.8 1493.79,897.236 1496.1,811.819 1498.41,757.738 1500.72,1002.02 1503.02,932.898 1505.33,932.875 1507.64,949.68 1509.95,828.127 1512.26,883.428 1514.56,880.855 1516.87,816.784 1519.18,893.328 1521.49,879.168 1523.8,976.473 1526.1,914.861 1528.41,1048.3 1530.72,871.647 1533.03,1056.49 1535.34,826.689 1537.64,876.202 1539.95,1011.25 1542.26,811.915 1544.57,778.213 1546.88,900.357 1549.18,1000.63 1551.49,891.617 1553.8,1100.73 1556.11,1023.65 1558.41,906.142 1560.72,752.444 1563.03,671.337 1565.34,1014 1567.65,945.119 1569.95,926.058 1572.26,900.428 1574.57,1019.69 1576.88,983.178 1579.19,1041.17 1581.49,864.802 1583.8,1074.32 1586.11,909.485 1588.42,926.718 1590.73,758.183 1593.03,866.661 1595.34,1011.75 1597.65,843.19 1599.96,1065.66 1602.26,842.562 1604.57,1009.61 1606.88,690.903 1609.19,950.131 1611.5,824.352 1613.8,749.05 1616.11,900.811 1618.42,668.97 1620.73,942.453 1623.04,968.55 1625.34,1048.01 1627.65,880.562 1629.96,738.385 1632.27,1059.66 1634.58,942.36 1636.88,850.86 1639.19,982.31 1641.5,904.335 1643.81,886.259 1646.12,955.721 1648.42,780.214 1650.73,854.81 1653.04,1006.74 1655.35,795.749 1657.65,984.151 1659.96,1008.64 1662.27,938.181 1664.58,745.877 1666.89,997.519 1669.19,1016.23 1671.5,884.518 1673.81,958.823 1676.12,936.356 1678.43,876 1680.73,895.343 1683.04,944.13 1685.35,937.464 1687.66,891.515 1689.97,904.984 1692.27,926.065 1694.58,648.903 1696.89,962.724 1699.2,782.667 1701.51,955.994 1703.81,922.059 1706.12,1029.17 1708.43,769.543 1710.74,915.652 1713.04,1106.24 1715.35,911.2 1717.66,783.764 1719.97,884.009 1722.28,993.021 1724.58,906.323 1726.89,900.065 1729.2,898.038 1731.51,858.541 1733.82,700 1736.12,944.206 1738.43,914.209 1740.74,932.924 1743.05,918.001 1745.36,848.883 1747.66,828.742 1749.97,1037.4 1752.28,825.161 1754.59,699.098 1756.9,979.698 1759.2,859.14 1761.51,874.784 1763.82,760.684 1766.13,953.217 1768.43,1027.65 1770.74,869.826 1773.05,898.756 1775.36,1035.29 1777.67,803.654 1779.97,925.652 1782.28,847.291 1784.59,925.459 1786.9,966.33 1789.21,1056.99 1791.51,1085.75 1793.82,880.476 1796.13,991.814 1798.44,943.592 1800.75,1024.67 1803.05,827.75 1805.36,934.317 1807.67,945.061 1809.98,880.535 1812.28,1075.33 1814.59,952.044 1816.9,734.645 1819.21,1030.88 1821.52,979.895 1823.82,940.098 1826.13,933.367 1828.44,1003.38 1830.75,927.896 1833.06,1021.12 1835.36,991.775 1837.67,818.276 1839.98,930.323 1842.29,824.69 1844.6,1007.49 1846.9,978.733 1849.21,909.02 1851.52,1006.16 1853.83,744.795 1856.14,947.769 1858.44,1017.12 1860.75,954.983 1863.06,876.704 1865.37,931.605 1867.67,978.073 1869.98,1136.54 1872.29,876.425 1874.6,1000.01 1876.91,787.001 1879.21,825.726 1881.52,793.017 1883.83,859.379 1886.14,828.845 1888.45,752.324 1890.75,787.703 1893.06,1012.03 1895.37,825.491 1897.68,854.286 1899.99,873.827 1902.29,689.1 1904.6,1007.11 1906.91,841.055 1909.22,767.575 1911.53,966.845 1913.83,987.478 1916.14,901.91 1918.45,1215.02 1920.76,982.476 1923.06,962.284 1925.37,961.071 1927.68,808.213 1929.99,928.796 1932.3,985.591 1934.6,910.987 1936.91,870.868 1939.22,883.3 1941.53,969.96 1943.84,1099.98 1946.14,1057.07 1948.45,747.859 1950.76,882.588 1953.07,757.379 1955.38,839.507 1957.68,1014.3 1959.99,1117.77 1962.3,889.317 1964.61,762.596 1966.91,811.364 1969.22,948.424 1971.53,870.706 1973.84,822.654 1976.15,810.21 1978.45,671.702 1980.76,895.768 1983.07,891.126 1985.38,800.001 1987.69,877.972 1989.99,826.245 1992.3,829.144 1994.61,883.434 1996.92,864.881 1999.23,1072.7 2001.53,956.313 2003.84,906.262 2006.15,787.916 2008.46,970.59 2010.77,943.605 2013.07,928.888 2015.38,951.928 2017.69,842.987 2020,879.444 2022.3,887.02 2024.61,910.257 2026.92,789.078 2029.23,942.968 2031.54,962.08 2033.84,1073.54 2036.15,998.184 2038.46,940.166 2040.77,842.335 2043.08,893.418 2045.38,883.014 2047.69,1090.85 2050,968.058 2052.31,889.084 2054.62,850.194 2056.92,1042.47 2059.23,844.988 2061.54,914.514 2063.85,999.892 2066.16,756.645 2068.46,809.039 2070.77,1042.68 2073.08,1005.49 2075.39,792.571 2077.69,1034.33 2080,819.214 2082.31,783.406 2084.62,1006.76 2086.93,938.174 2089.23,988.285 2091.54,1004.92 2093.85,912.461 2096.16,851.192 2098.47,903.193 2100.77,870.816 2103.08,917.503 2105.39,922.844 2107.7,998.284 2110.01,801.005 2112.31,955.95 2114.62,823.523 2116.93,811.869 2119.24,1014.6 2121.55,835.846 2123.85,978.625 2126.16,977.466 2128.47,813.898 2130.78,867.092 2133.08,948.516 2135.39,835.365 2137.7,972.784 2140.01,986.736 2142.32,910.774 2144.62,981.2 2146.93,911.256 2149.24,739.74 2151.55,910.579 2153.86,937.717 2156.16,863.65 2158.47,913.024 2160.78,951.663 2163.09,1001.86 2165.4,824.899 2167.7,869.229 2170.01,911.277 2172.32,963.042 2174.63,1103.31 2176.93,1006.58 2179.24,909.281 2181.55,955.17 2183.86,795.567 2186.17,896.138 2188.47,860.78 2190.78,688.753 2193.09,994.991 2195.4,921.985 2197.71,771.781 2200.01,1087.24 2202.32,928.959 2204.63,1027.28 2206.94,970.31 2209.25,981.682 2211.55,1009.83 2213.86,871.642 2216.17,850.633 2218.48,984.289 2220.79,898.69 2223.09,933.089 2225.4,965.334 2227.71,1066.85 2230.02,928.901 2232.32,788.2 2234.63,926.343 2236.94,1001.54 2239.25,859.915 2241.56,1039.71 2243.86,997.968 2246.17,949.968 2248.48,770.376 2250.79,782.824 2253.1,837.63 2255.4,856.302 2257.71,1157.59 2260.02,909.87 2262.33,829.852 2264.64,1055.05 2266.94,1045.36 2269.25,957.487 2271.56,924.923 2273.87,1093.74 2276.18,640.785 2278.48,872.069 2280.79,838.991 2283.1,874.966 2285.41,1002.73 2287.71,965.786 2290.02,882.455 2292.33,916.994 2294.64,948.092 2296.95,997.123 2299.25,983.99 2301.56,1097.78 2303.87,761.727 2306.18,934.281 2308.49,740.788 2310.79,880.162 2313.1,975.062 2315.41,837.602 2317.72,1016.76 2320.03,1049.93 2322.33,789.126 2324.64,958.304 2326.95,973.574 2329.26,1077.27 2331.56,979.285 2333.87,1072.76 2336.18,849.978 2338.49,923.844 2340.8,879.755 2343.1,929.588 2345.41,871.826 2347.72,843.055 2350.03,993.501 2352.34,996.946 2354.64,907.824 2356.95,891.295 2359.26,852.867 2361.57,930.908 2363.88,1033.52 2366.18,835.873 2368.49,678.513 2370.8,880.257 2373.11,700.267 2375.42,754.237 2377.72,800.758 2380.03,754.359 2382.34,962.248 2384.65,924.942 2386.95,829.418 2389.26,861.53 2391.57,978.824 2393.88,1003 2396.19,968.664 2398.49,648.846 2400.8,979.988 2403.11,1011.37 2405.42,905.461 2407.73,827.474 2410.03,1015.66 2412.34,964.429 2414.65,738.644 2416.96,854.846 2419.27,861.934 2421.57,776.17 2423.88,997.775 2426.19,957.481 2428.5,847.375 2430.81,741.535 2433.11,1010.25 2435.42,925.203 2437.73,926.538 2440.04,758.703 2442.34,796.241 2444.65,1253.26 2446.96,982.748 2449.27,897.457 2451.58,860.214 2453.88,841.298 2456.19,950.116 2458.5,810.764 2460.81,797.531 2463.12,866.64 2465.42,930.85 2467.73,723.249 2470.04,1042.39 2472.35,1055.75 2474.66,844.244 2476.96,724.089 2479.27,822.946 2481.58,797.139 2483.89,750.073 2486.2,948.579 2488.5,981.495 2490.81,867.494 2493.12,877.074 2495.43,988.566 2497.73,937.145 2500.04,873.755 2502.35,964.411 2504.66,878.3 2506.97,878.225 2509.27,956.731 2511.58,965.183 2513.89,851.763 2516.2,933.45 2518.51,894.496 2520.81,1017.57 2523.12,865.054 2525.43,859.782 2527.74,742.792 2530.05,1070.45 2532.35,895.853 2534.66,1014.73 2536.97,963.062 2539.28,1067.23 2541.58,1019.36 2543.89,895.482 2546.2,991.103 2548.51,959.939 2550.82,852.563 2553.12,997.798 2555.43,810.343 2557.74,821.874 2560.05,950.862 2562.36,936.623 2564.66,767.877 2566.97,672.876 2569.28,910.021 2571.59,1049.03 "></polyline>
<polyline clip-path="url(#clip382)" style="stroke:#3da44d; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="265.984,668.588 268.292,340.985 270.6,437.924 272.908,502.889 275.216,186.976 277.524,473.276 279.832,279.107 282.139,516.491 284.447,476.435 286.755,515.716 289.063,434.77 291.371,464.907 293.679,468.106 295.987,483.706 298.295,442.112 300.603,300.302 302.911,479.677 305.219,501.518 307.527,373.316 309.834,533.815 312.142,510.361 314.45,265.218 316.758,567.584 319.066,365.696 321.374,385.169 323.682,431.528 325.99,449.382 328.298,318.72 330.606,640.236 332.914,594.105 335.221,357.13 337.529,534.86 339.837,462.516 342.145,492.189 344.453,353.002 346.761,253.839 349.069,308.59 351.377,366.974 353.685,429.598 355.993,507.699 358.301,380.044 360.608,538.096 362.916,332.822 365.224,326.426 367.532,328.383 369.84,466.322 372.148,474.203 374.456,605.166 376.764,296.617 379.072,485.958 381.38,564.624 383.688,438.973 385.996,396.415 388.303,535.435 390.611,587.998 392.919,271.279 395.227,540.102 397.535,329.969 399.843,351.62 402.151,304.009 404.459,364.689 406.767,492.72 409.075,378.277 411.383,276.267 413.69,503.657 415.998,583.493 418.306,377.428 420.614,345.799 422.922,477.825 425.23,460.235 427.538,509.605 429.846,467.53 432.154,395.671 434.462,581.998 436.77,564.979 439.077,504.799 441.385,386.024 443.693,541.692 446.001,475.68 448.309,393.361 450.617,549.453 452.925,503.176 455.233,454.688 457.541,574.935 459.849,357.973 462.157,485.121 464.465,400.274 466.772,546.113 469.08,628.856 471.388,231.902 473.696,445.929 476.004,513.312 478.312,553.049 480.62,351.08 482.928,339.064 485.236,406.08 487.544,288.657 489.852,449.537 492.159,524.53 494.467,629.386 496.775,483.282 499.083,305.05 501.391,469.027 503.699,535.245 506.007,463.458 508.315,445.61 510.623,472.677 512.931,336.406 515.239,456.23 517.546,599.596 519.854,350.789 522.162,423.709 524.47,225.835 526.778,495.485 529.086,380.018 531.394,400.353 533.702,482.173 536.01,221.074 538.318,302.383 540.626,487.895 542.933,180.001 545.241,392.142 547.549,506.102 549.857,390.384 552.165,427.414 554.473,339.757 556.781,395.47 559.089,499.126 561.397,456.103 563.705,431.555 566.013,494.106 568.321,193.654 570.628,419.26 572.936,389.262 575.244,363.183 577.552,289.606 579.86,96.8724 582.168,392.638 584.476,272.185 586.784,535.68 589.092,377.542 591.4,630.753 593.708,497.658 596.015,393.261 598.323,384.612 600.631,403.477 602.939,308.62 605.247,530.939 607.555,476.069 609.863,420.867 612.171,366.485 614.479,446.459 616.787,517.3 619.095,431.479 621.402,554.279 623.71,295.087 626.018,208.359 628.326,305.949 630.634,376.983 632.942,425.884 635.25,445.136 637.558,368.193 639.866,420.449 642.174,300.959 644.482,298.745 646.79,273.486 649.097,429.614 651.405,518.616 653.713,439.364 656.021,392.398 658.329,413.267 660.637,462.292 662.945,403.73 665.253,288.787 667.561,362.231 669.869,450.509 672.177,422.467 674.484,256.596 676.792,367.479 679.1,368.256 681.408,308.609 683.716,409.019 686.024,607.637 688.332,218.428 690.64,339.959 692.948,413.199 695.256,392.441 697.564,496.463 699.871,318.206 702.179,544.212 704.487,495.299 706.795,192.177 709.103,412.004 711.411,497.886 713.719,467.384 716.027,257.901 718.335,435.201 720.643,303.554 722.951,331.353 725.259,515.959 727.566,580.799 729.874,514.373 732.182,502.127 734.49,701.379 736.798,335.001 739.106,512.238 741.414,399.978 743.722,344.748 746.03,589.264 748.338,342.48 750.646,593.796 752.953,247.494 755.261,488.063 757.569,446.858 759.877,208.685 762.185,503.912 764.493,593.383 766.801,375.641 769.109,427.614 771.417,390.761 773.725,541.369 776.033,328.478 778.34,435.519 780.648,402.433 782.956,571.082 785.264,256.341 787.572,311.97 789.88,415.437 792.188,460.079 794.496,539.364 796.804,481.965 799.112,344.157 801.42,408.195 803.728,389.005 806.035,532.503 808.343,306.25 810.651,432.919 812.959,225.068 815.267,226.334 817.575,689.784 819.883,319.439 822.191,395.221 824.499,401.403 826.807,457.978 829.115,556.63 831.422,422.385 833.73,323.124 836.038,526.183 838.346,442.947 840.654,314.428 842.962,380.533 845.27,366.192 847.578,499.625 849.886,528.816 852.194,434.542 854.502,403.907 856.809,325.388 859.117,425.132 861.425,404.059 863.733,540.942 866.041,355.95 868.349,364.521 870.657,393.239 872.965,420.698 875.273,354.072 877.581,384.06 879.889,279.252 882.197,498.623 884.504,326.271 886.812,560.58 889.12,441.665 891.428,541.724 893.736,534.431 896.044,427.285 898.352,441.787 900.66,382.407 902.968,413.818 905.276,455.511 907.584,428.568 909.891,623.924 912.199,445.384 914.507,303.284 916.815,325.256 919.123,555.403 921.431,443.252 923.739,420.37 926.047,436.493 928.355,473.95 930.663,487.711 932.971,400.949 935.278,410.153 937.586,477.08 939.894,535.994 942.202,548.279 944.51,290.559 946.818,563.793 949.126,299.395 951.434,410.019 953.742,451.225 956.05,332.198 958.358,569.682 960.665,370.194 962.973,350.934 965.281,341.26 967.589,500.071 969.897,355.633 972.205,460.247 974.513,264.244 976.821,492.151 979.129,431.924 981.437,515.428 983.745,444.925 986.053,480.719 988.36,420.03 990.668,483.193 992.976,358.405 995.284,364.898 997.592,566.645 999.9,453.124 1002.21,348.43 1004.52,435.641 1006.82,271.503 1009.13,379.303 1011.44,420.175 1013.75,532.546 1016.06,575.061 1018.36,496.355 1020.67,542.612 1022.98,448.525 1025.29,416.876 1027.59,331.326 1029.9,482.875 1032.21,509.376 1034.52,373.948 1036.83,389.114 1039.13,676.869 1041.44,528.901 1043.75,539.182 1046.06,646.708 1048.37,518.666 1050.67,369.164 1052.98,310.508 1055.29,671.209 1057.6,336.748 1059.91,453.312 1062.21,354.327 1064.52,416.455 1066.83,410.444 1069.14,530.874 1071.45,353.65 1073.75,444.408 1076.06,333.041 1078.37,548.897 1080.68,510.997 1082.98,390.859 1085.29,393.049 1087.6,472.984 1089.91,383.979 1092.22,411.388 1094.52,560.327 1096.83,444.163 1099.14,552.961 1101.45,514.907 1103.76,607.342 1106.06,488.297 1108.37,445.866 1110.68,451.356 1112.99,418.247 1115.3,319.819 1117.6,291.678 1119.91,420.089 1122.22,328.011 1124.53,365.506 1126.84,330.046 1129.14,456.909 1131.45,518.666 1133.76,366.111 1136.07,279.7 1138.37,506.973 1140.68,426.318 1142.99,515.76 1145.3,454.431 1147.61,284.402 1149.91,444.207 1152.22,376.165 1154.53,363.574 1156.84,281.013 1159.15,296.173 1161.45,396.535 1163.76,420.76 1166.07,321.579 1168.38,462.188 1170.69,428.14 1172.99,530.93 1175.3,392.562 1177.61,472.887 1179.92,541.42 1182.23,450.391 1184.53,425.13 1186.84,359.391 1189.15,459.833 1191.46,487.934 1193.76,500.324 1196.07,384.016 1198.38,451.342 1200.69,452.989 1203,173.827 1205.3,286.336 1207.61,445.965 1209.92,341.199 1212.23,358.298 1214.54,196.082 1216.84,448.679 1219.15,451.105 1221.46,452.629 1223.77,370.866 1226.08,468.921 1228.38,489.873 1230.69,606.259 1233,559.458 1235.31,381.17 1237.61,484.819 1239.92,438.242 1242.23,305.607 1244.54,484.487 1246.85,471.164 1249.15,383.037 1251.46,503.004 1253.77,426.586 1256.08,558.855 1258.39,485.582 1260.69,316.232 1263,358.679 1265.31,358.812 1267.62,379.448 1269.93,280.148 1272.23,547.329 1274.54,424.092 1276.85,274.239 1279.16,451.918 1281.47,521.097 1283.77,396.519 1286.08,316.752 1288.39,625.053 1290.7,291.376 1293,457.059 1295.31,443.029 1297.62,356.32 1299.93,294.321 1302.24,490.302 1304.54,311.236 1306.85,389.78 1309.16,405.73 1311.47,465.135 1313.78,572.888 1316.08,559.254 1318.39,412.709 1320.7,462.378 1323.01,288.442 1325.32,565.385 1327.62,403.099 1329.93,397.545 1332.24,345.337 1334.55,470.096 1336.86,395.21 1339.16,365.329 1341.47,323.554 1343.78,143.303 1346.09,373.227 1348.39,486.578 1350.7,378.35 1353.01,273.607 1355.32,361.64 1357.63,420.94 1359.93,368.063 1362.24,508.98 1364.55,431.669 1366.86,451.732 1369.17,389.749 1371.47,460.109 1373.78,412.836 1376.09,458.426 1378.4,388.874 1380.71,454.417 1383.01,426.837 1385.32,419.839 1387.63,420.803 1389.94,338.199 1392.24,578.214 1394.55,624.168 1396.86,428.189 1399.17,551.933 1401.48,439.993 1403.78,331.254 1406.09,477.413 1408.4,375.457 1410.71,562.956 1413.02,391.691 1415.32,478.764 1417.63,187.299 1419.94,496.147 1422.25,400.254 1424.56,504.095 1426.86,290.799 1429.17,403.317 1431.48,415.272 1433.79,580.878 1436.1,389.982 1438.4,608.456 1440.71,511.952 1443.02,472.037 1445.33,530.4 1447.63,485.069 1449.94,499.739 1452.25,367.348 1454.56,527.577 1456.87,342.777 1459.17,379.409 1461.48,397.081 1463.79,494.347 1466.1,542.747 1468.41,544.205 1470.71,419.321 1473.02,384.511 1475.33,508.245 1477.64,498.232 1479.95,289.342 1482.25,521.759 1484.56,490.381 1486.87,595.149 1489.18,472.228 1491.49,635.562 1493.79,289.261 1496.1,403.61 1498.41,462.296 1500.72,464.264 1503.02,181.873 1505.33,346.321 1507.64,654.606 1509.95,360.902 1512.26,471.273 1514.56,262.449 1516.87,461.05 1519.18,553.339 1521.49,320.942 1523.8,438.032 1526.1,409.862 1528.41,346.752 1530.72,403.656 1533.03,479.612 1535.34,421.183 1537.64,566.149 1539.95,398.73 1542.26,345.18 1544.57,546.259 1546.88,494.292 1549.18,564.758 1551.49,521.399 1553.8,319.599 1556.11,372.975 1558.41,374.521 1560.72,527.95 1563.03,483.542 1565.34,484.533 1567.65,455.281 1569.95,599.477 1572.26,360.87 1574.57,407.779 1576.88,615.735 1579.19,403.685 1581.49,440.684 1583.8,400.228 1586.11,294.563 1588.42,517.448 1590.73,538.622 1593.03,387.184 1595.34,158.473 1597.65,636.267 1599.96,383.78 1602.26,457.653 1604.57,376.558 1606.88,447.374 1609.19,419.566 1611.5,277.199 1613.8,500.589 1616.11,504.981 1618.42,371.569 1620.73,401.738 1623.04,344.125 1625.34,454.621 1627.65,217.818 1629.96,547.977 1632.27,372.031 1634.58,477.273 1636.88,249.481 1639.19,475.485 1641.5,402.251 1643.81,515.146 1646.12,371.727 1648.42,438.181 1650.73,574.634 1653.04,397.037 1655.35,364.195 1657.65,560.371 1659.96,348.928 1662.27,449.519 1664.58,198.759 1666.89,405.356 1669.19,490.385 1671.5,284.15 1673.81,273.25 1676.12,478.566 1678.43,467.765 1680.73,398.362 1683.04,431.076 1685.35,541.16 1687.66,395.272 1689.97,462.771 1692.27,384.895 1694.58,416.809 1696.89,498.214 1699.2,541.246 1701.51,429.26 1703.81,454.927 1706.12,434.091 1708.43,473.087 1710.74,448.052 1713.04,437.287 1715.35,353.42 1717.66,423.844 1719.97,453.496 1722.28,502.97 1724.58,488.215 1726.89,503.339 1729.2,239.85 1731.51,445.414 1733.82,353.548 1736.12,479.355 1738.43,448.288 1740.74,575.513 1743.05,382.061 1745.36,385.715 1747.66,431.036 1749.97,333.507 1752.28,393.992 1754.59,406.046 1756.9,484.106 1759.2,417.752 1761.51,300.001 1763.82,405.653 1766.13,392.303 1768.43,498.419 1770.74,464.109 1773.05,381.451 1775.36,404.054 1777.67,281.555 1779.97,425.391 1782.28,358.385 1784.59,500.951 1786.9,460.95 1789.21,409.113 1791.51,543.693 1793.82,502.542 1796.13,199.429 1798.44,421.852 1800.75,396.03 1803.05,648.624 1805.36,479.014 1807.67,284.049 1809.98,397.704 1812.28,555.651 1814.59,378.626 1816.9,401.001 1819.21,338.438 1821.52,592.11 1823.82,308.729 1826.13,468.75 1828.44,622.532 1830.75,608.773 1833.06,441.385 1835.36,371.33 1837.67,395.225 1839.98,308.084 1842.29,477.784 1844.6,420.56 1846.9,437.862 1849.21,453.227 1851.52,538.671 1853.83,360.168 1856.14,248.73 1858.44,399.086 1860.75,506.302 1863.06,400.976 1865.37,693.817 1867.67,323.473 1869.98,297.828 1872.29,506.864 1874.6,221.562 1876.91,467.838 1879.21,407.835 1881.52,402.01 1883.83,267.334 1886.14,492.815 1888.45,415.233 1890.75,458.441 1893.06,355.289 1895.37,512.914 1897.68,436.234 1899.99,426.233 1902.29,345.086 1904.6,360.505 1906.91,468.437 1909.22,542.533 1911.53,563.366 1913.83,316.409 1916.14,331.94 1918.45,425.705 1920.76,358.513 1923.06,573.798 1925.37,323.746 1927.68,481.103 1929.99,546.848 1932.3,295.866 1934.6,367.742 1936.91,614.233 1939.22,412.479 1941.53,392.022 1943.84,292.762 1946.14,474.89 1948.45,428.314 1950.76,270.861 1953.07,368.355 1955.38,572.98 1957.68,243.866 1959.99,539.591 1962.3,386.304 1964.61,527.731 1966.91,302.27 1969.22,481.292 1971.53,275.191 1973.84,402.554 1976.15,386.091 1978.45,470.683 1980.76,343.187 1983.07,611.287 1985.38,222.488 1987.69,301.231 1989.99,474.541 1992.3,213.033 1994.61,464.942 1996.92,460.519 1999.23,303.032 2001.53,339.658 2003.84,413.032 2006.15,634.621 2008.46,511.738 2010.77,337.191 2013.07,487.412 2015.38,372.833 2017.69,413.136 2020,522.997 2022.3,436.186 2024.61,429.853 2026.92,369.165 2029.23,419.247 2031.54,530.091 2033.84,383.807 2036.15,458.861 2038.46,474.718 2040.77,430.894 2043.08,294.096 2045.38,458.604 2047.69,463.436 2050,400.016 2052.31,306.701 2054.62,441.576 2056.92,453.381 2059.23,560.241 2061.54,403.643 2063.85,410.375 2066.16,601.826 2068.46,485.797 2070.77,486.151 2073.08,446.545 2075.39,476.188 2077.69,535.405 2080,410.781 2082.31,377.112 2084.62,503.79 2086.93,467.878 2089.23,457.355 2091.54,351.853 2093.85,527.261 2096.16,415.384 2098.47,494.118 2100.77,451.095 2103.08,490.039 2105.39,385.631 2107.7,426.844 2110.01,398.115 2112.31,423.533 2114.62,471.714 2116.93,460.682 2119.24,409.672 2121.55,441.839 2123.85,520.199 2126.16,259.78 2128.47,379.276 2130.78,620.383 2133.08,369.682 2135.39,473.409 2137.7,515.129 2140.01,384.623 2142.32,521.462 2144.62,461.981 2146.93,588.282 2149.24,478.078 2151.55,394.576 2153.86,498.643 2156.16,358.413 2158.47,519.146 2160.78,472.5 2163.09,524.061 2165.4,379.307 2167.7,520.801 2170.01,456.722 2172.32,451.421 2174.63,456.31 2176.93,341.717 2179.24,492.414 2181.55,543.627 2183.86,310.942 2186.17,512.439 2188.47,530.205 2190.78,421.982 2193.09,358.24 2195.4,567.787 2197.71,451.484 2200.01,258.594 2202.32,295.6 2204.63,507.131 2206.94,480.174 2209.25,544.796 2211.55,370.452 2213.86,396.992 2216.17,436.91 2218.48,443.134 2220.79,466.594 2223.09,373.436 2225.4,395.226 2227.71,652.745 2230.02,632.27 2232.32,404.656 2234.63,436.523 2236.94,438.159 2239.25,350.338 2241.56,553.586 2243.86,512.639 2246.17,411.367 2248.48,359.41 2250.79,372.944 2253.1,234.043 2255.4,593.994 2257.71,644.285 2260.02,587.879 2262.33,459.93 2264.64,505.399 2266.94,575.532 2269.25,430.746 2271.56,290.092 2273.87,418.075 2276.18,403.458 2278.48,297.673 2280.79,591.403 2283.1,475.361 2285.41,401.233 2287.71,405.865 2290.02,481.214 2292.33,518.802 2294.64,460.25 2296.95,546.112 2299.25,431.078 2301.56,387.681 2303.87,650.11 2306.18,313.456 2308.49,534.334 2310.79,636.99 2313.1,429.727 2315.41,330.799 2317.72,379.352 2320.03,508.322 2322.33,439.248 2324.64,403.275 2326.95,423.438 2329.26,331.842 2331.56,358.365 2333.87,415.623 2336.18,387.286 2338.49,254.868 2340.8,442.11 2343.1,404.777 2345.41,333.585 2347.72,533.418 2350.03,388.663 2352.34,521.757 2354.64,431.737 2356.95,426.818 2359.26,261.1 2361.57,487.816 2363.88,243.526 2366.18,531.821 2368.49,470.546 2370.8,450.194 2373.11,441.842 2375.42,522.344 2377.72,372.934 2380.03,331.268 2382.34,366.826 2384.65,383.933 2386.95,373.445 2389.26,498.663 2391.57,441.136 2393.88,354.699 2396.19,183.274 2398.49,381.467 2400.8,458.286 2403.11,385.361 2405.42,359.789 2407.73,530.606 2410.03,527.877 2412.34,520.034 2414.65,337.79 2416.96,561.17 2419.27,435.885 2421.57,413.764 2423.88,582.645 2426.19,459.883 2428.5,638.557 2430.81,289.518 2433.11,499.65 2435.42,512.006 2437.73,469.058 2440.04,250.233 2442.34,582.237 2444.65,493.204 2446.96,489.522 2449.27,396.872 2451.58,475.158 2453.88,414.614 2456.19,430.418 2458.5,414.441 2460.81,417.238 2463.12,372.106 2465.42,317.215 2467.73,429.398 2470.04,422.312 2472.35,469.12 2474.66,433.235 2476.96,485.929 2479.27,541.427 2481.58,436.438 2483.89,439.147 2486.2,391.33 2488.5,318.115 2490.81,522.474 2493.12,272.039 2495.43,417.071 2497.73,586.788 2500.04,234.575 2502.35,566.153 2504.66,360.337 2506.97,538.995 2509.27,211.351 2511.58,577.463 2513.89,356.788 2516.2,390.852 2518.51,459.337 2520.81,342.733 2523.12,359.403 2525.43,444.731 2527.74,440.304 2530.05,482.333 2532.35,584.348 2534.66,482.738 2536.97,278.22 2539.28,413.13 2541.58,333.485 2543.89,481.701 2546.2,558.858 2548.51,481.259 2550.82,277.854 2553.12,489.165 2555.43,429.27 2557.74,325.102 2560.05,514.59 2562.36,415.562 2564.66,457.242 2566.97,451.321 2569.28,578.97 2571.59,381.993 "></polyline>
</svg>
</div>
</div>
<p>Look at that! Things are working; amazin’.</p>
<p>We can also exploit <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>’s parallel sampling capabilities:</p>
<div id="34" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run separate 4 chains for 10 000 iterations using threads to parallelize.</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>num_chains <span class="op">=</span> <span class="fl">4</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    model_with_grad,</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">MCMCThreads</span>(),</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>,</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    num_chains;</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Note we need to provide an initial state for every chain.</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>    initial_state<span class="op">=</span><span class="fu">fill</span>(state, num_chains),</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>samples_array <span class="op">=</span> <span class="fu">stack</span>(<span class="fu">map</span>(<span class="bu">Base</span>.<span class="fu">Fix1</span>(stack, sample <span class="op">-&gt;</span> sample.x), samples))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000×4 Array{Float64, 3}:
[:, :, 1] =
 -2.87607  -3.81942   -4.59978  -3.79109   …  -6.11086   -6.1979    -6.0566
  1.20798   0.718272   1.09083   0.517432     -0.615547  -0.979085   0.797257
  2.03181   2.94783    3.55754   4.78614       3.98621    3.84009    4.91102

[:, :, 2] =
 -2.65219    -3.13888   -3.13888   …  -6.44491  -6.46534   -6.46291
  0.0145501  -0.617579  -0.617579      2.00095  -0.609937   0.0360458
  4.20964     4.86748    4.86748       4.65709   5.46264    4.63234

[:, :, 3] =
 -2.66331  -2.87818   -3.17515  -4.4486   …  -3.98001  -5.33438   -4.33169
  1.04126  -0.345982   1.67188   1.70409      1.39308   0.812214  -0.510692
  2.40364   3.99645    4.24159   4.06143      5.43117   6.17104    7.16233

[:, :, 4] =
 -3.29932   -4.95703  -6.70088  -5.42301  …  -4.4661   -6.12283    -6.16174
 -0.505095  -2.11038  -1.05466  -1.41876      1.22736  -0.0492978   0.180212
  2.76266    4.47202   5.05765   5.38139      7.726     6.47666     6.54971</code></pre>
</div>
</div>
<p>But the fact that we have to provide the <code>AbstractMCMC.sample</code> call, etc. with an <code>initial_state</code> to get started is a bit annoying. We can avoid this by also defining a <code>AbstractMCMC.step</code> <em>without</em> the <code>state</code> argument:</p>
<div id="36" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">::</span><span class="dt">MALA</span>;</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># </span><span class="al">NOTE</span><span class="co">: No state provided!</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just create the initial state by sampling using  a Gaussian.</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="fu">randn</span>(rng, LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(x), <span class="fu">MALAState</span>(x)</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Equipped with this, we no longer need to provide the <code>initial_state</code> everywhere:</p>
<div id="38" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -4.99159    1.00747
 -0.0242803  1.00891
  5.0272     0.984141</code></pre>
</div>
</div>
</section>
<section id="using-our-sampler-with-turing.jl" class="level2">
<h2 class="anchored" data-anchor-id="using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</h2>
<p>As we promised, all of this hassle of implementing our <code>MALA</code> sampler in a way that uses <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> and <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> gets us something more than <em>just</em> an “automatic” implementation of <code>AbstractMCMC.sample</code>.</p>
<p>It also enables use with Turing.jl through the <code>externalsampler</code>, but we need to do one final thing first: we need to tell Turing.jl how to extract a vector of parameters from the “sample” returned in our implementation of <code>AbstractMCMC.step</code>. In our case, the “sample” is a <code>MALASample</code>, so we just need the following line:</p>
<div id="40" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Turing</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">DynamicPPL</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Overload the `getparams` method for our "sample" type, which is just a vector.</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>Turing.Inference.<span class="fu">getparams</span>(<span class="op">::</span><span class="dt">DynamicPPL.Model</span>, sample<span class="op">::</span><span class="dt">MALASample</span>) <span class="op">=</span> sample.x</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And with that, we’re good to go!</p>
<div id="42" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Our previous model defined as a Turing.jl model.</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">mvnormal_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">MvNormal</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.], I)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate our model.</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">mvnormal_model</span>()</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Call `sample` but now we're passing in a Turing.jl `model` and wrapping</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co"># our `MALA` sampler in the `externalsampler` to tell Turing.jl that the sampler</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co"># expects something that implements LogDensityProblems.jl.</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×4×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 3.22 seconds
Compute duration  = 3.22 seconds
parameters        = x[1], x[2], x[3]
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters  </span><span class="ansi-bold">    mean  </span><span class="ansi-bold">     std  </span><span class="ansi-bold">    mcse  </span><span class="ansi-bold">  ess_bulk  </span><span class="ansi-bold">  ess_tail  </span><span class="ansi-bold">    rhat  </span><span class="ansi-bold"> ⋯
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">   Float64  </span><span class="ansi-bright-black-fg ansi-bold">   Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> ⋯

        x[1]   -5.0143    0.9784    0.0160   3721.9834   5101.3593    1.0008   ⋯
        x[2]    0.0005    1.0067    0.0175   3312.1248   5156.8010    0.9999   ⋯
        x[3]    5.0090    0.9990    0.0171   3411.8068   5186.7930    1.0000   ⋯
</span><span class="ansi-cyan-fg ansi-bold">                                                                1 column omitted

Quantiles
 </span><span class="ansi-cyan-fg ansi-bold"> parameters  </span><span class="ansi-cyan-fg ansi-bold">    2.5%  </span><span class="ansi-cyan-fg ansi-bold">   25.0%  </span><span class="ansi-cyan-fg ansi-bold">   50.0%  </span><span class="ansi-cyan-fg ansi-bold">   75.0%  </span><span class="ansi-cyan-fg ansi-bold">   97.5%
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64

        x[1]   -6.9298   -5.6770   -4.9941   -4.3540   -3.1094
        x[2]   -1.9617   -0.6737   -0.0102    0.6786    1.9760
        x[3]    3.0402    4.3376    5.0191    5.6857    6.9445
</span></pre>
</div>
</div>
</div>
<p>Pretty neat, eh?</p>
<section id="models-with-constrained-parameters" class="level3">
<h3 class="anchored" data-anchor-id="models-with-constrained-parameters">Models with constrained parameters</h3>
<p>One thing we’ve sort of glossed over in all of the above is that MALA, at least how we’ve implemented it, requires <span class="math inline">\(x\)</span> to live in <span class="math inline">\(\mathbb{R}^d\)</span> for some <span class="math inline">\(d &gt; 0\)</span>. If some of the parameters were in fact constrained, e.g.&nbsp;we were working with a <code>Beta</code> distribution which has support on the interval <span class="math inline">\((0, 1)\)</span>, <em>not</em> on <span class="math inline">\(\mathbb{R}^d\)</span>, we could easily end up outside of the valid range <span class="math inline">\((0, 1)\)</span>.</p>
<div id="44" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">beta_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">beta_model</span>()</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 1.98 seconds
Compute duration  = 1.98 seconds
parameters        = x
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters  </span><span class="ansi-bold">    mean  </span><span class="ansi-bold">     std  </span><span class="ansi-bold">    mcse  </span><span class="ansi-bold">  ess_bulk  </span><span class="ansi-bold">  ess_tail  </span><span class="ansi-bold">    rhat  </span><span class="ansi-bold"> ⋯
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">   Float64  </span><span class="ansi-bright-black-fg ansi-bold">   Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> ⋯

           x    0.4950    0.1907    0.0029   4223.5482   5689.0403    1.0007   ⋯
</span><span class="ansi-cyan-fg ansi-bold">                                                                1 column omitted

Quantiles
 </span><span class="ansi-cyan-fg ansi-bold"> parameters  </span><span class="ansi-cyan-fg ansi-bold">    2.5%  </span><span class="ansi-cyan-fg ansi-bold">   25.0%  </span><span class="ansi-cyan-fg ansi-bold">   50.0%  </span><span class="ansi-cyan-fg ansi-bold">   75.0%  </span><span class="ansi-cyan-fg ansi-bold">   97.5%
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64

           x    0.1383    0.3533    0.4963    0.6338    0.8503
</span></pre>
</div>
</div>
</div>
<p>Yep, that still works, but only because Turing.jl actually <em>transforms</em> the <code>turing_model</code> from constrained to unconstrained, so that the <code>sampler</code> provided to <code>externalsampler</code> is actually always working in unconstrained space! This is not always desirable, so we can turn this off:</p>
<div id="46" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 0.2 seconds
Compute duration  = 0.2 seconds
parameters        = x
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters  </span><span class="ansi-bold">    mean  </span><span class="ansi-bold">     std  </span><span class="ansi-bold">    mcse  </span><span class="ansi-bold"> ess_bulk  </span><span class="ansi-bold"> ess_tail  </span><span class="ansi-bold">    rhat  </span><span class="ansi-bold"> e ⋯
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">  Float64  </span><span class="ansi-bright-black-fg ansi-bold">  Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">   ⋯

           x    0.4913    0.1741    0.0291    32.7189        NaN    1.2037     ⋯
</span><span class="ansi-cyan-fg ansi-bold">                                                                1 column omitted

Quantiles
 </span><span class="ansi-cyan-fg ansi-bold"> parameters  </span><span class="ansi-cyan-fg ansi-bold">    2.5%  </span><span class="ansi-cyan-fg ansi-bold">   25.0%  </span><span class="ansi-cyan-fg ansi-bold">   50.0%  </span><span class="ansi-cyan-fg ansi-bold">   75.0%  </span><span class="ansi-cyan-fg ansi-bold">   97.5%
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64

           x    0.2217    0.3494    0.4933    0.6236    0.7972
</span></pre>
</div>
</div>
</div>
<p>The fun thing is that this still sort of works because</p>
<div id="48" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">logpdf</span>(<span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>), <span class="fl">10.0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-Inf</code></pre>
</div>
</div>
<p>and so the samples that fall outside of the range are always rejected. But do notice how much worse all the diagnostics are, e.g.&nbsp;<code>ess_tail</code> is very poor compared to when we use <code>unconstrained=true</code>. Moreover, in more complex cases this won’t just result in a “nice” <code>-Inf</code> log-density value, but instead will error:</p>
<div id="50" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="kw">function</span> <span class="fu">demo</span>()</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>    σ² <span class="op">~</span> <span class="fu">truncated</span>(<span class="fu">Normal</span>(), lower<span class="op">=</span><span class="fl">0</span>)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If we end up with negative values for `σ²`, the `Normal` will error.</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>    x <span class="op">~</span> <span class="fu">Normal</span>(<span class="fl">0</span>, σ²)</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre>DomainError with Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}}(-1.40591062405262,1.0,0.0):
Normal: the condition σ &gt;= zero(σ) is not satisfied.
Stacktrace:
  [1] <span class="ansi-bold">#371</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/YQSrn/src/univariate/continuous/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">normal.jl:37</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [2] <span class="ansi-bold">check_args</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/YQSrn/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">utils.jl:89</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [3] <span class="ansi-bold">#Normal#370</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/YQSrn/src/univariate/continuous/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">normal.jl:37</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [4] <span class="ansi-bold">Normal</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/YQSrn/src/univariate/continuous/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">normal.jl:36</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [5] <span class="ansi-bold">Normal</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/YQSrn/src/univariate/continuous/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">normal.jl:42</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [6] <span class="ansi-bold">macro expansion</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/nxcz4/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">compiler.jl:558</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [7] <span class="ansi-bold">demo</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">__model__</span>::Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DefaultContext}</span>, <span class="ansi-bright-black-fg">__varinfo__</span>::DynamicPPL.ThreadSafeVarInfo<span class="ansi-bright-black-fg">{VarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{VarName{:σ², typeof(identity)}}, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}, x::DynamicPPL.Metadata{Dict{VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{VarName{:x, typeof(identity)}}, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}, ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}, Vector{Base.RefValue{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}</span>, <span class="ansi-bright-black-fg">__context__</span>::DefaultContext<span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-magenta-fg">Main.Notebook</span> <span class="ansi-bright-black-fg">~/work/docs/docs/developers/inference/implementing-samplers/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">index.qmd:457</span>
  [8] <span class="ansi-bold">_evaluate!!</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/nxcz4/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">model.jl:913</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [9] <span class="ansi-bold">evaluate_threadsafe!!</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">model</span>::Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DefaultContext}</span>, <span class="ansi-bright-black-fg">varinfo</span>::VarInfo<span class="ansi-bright-black-fg">{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{VarName{:σ², typeof(identity)}}, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}, x::DynamicPPL.Metadata{Dict{VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{VarName{:x, typeof(identity)}}, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}, ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}</span>, <span class="ansi-bright-black-fg">context</span>::DefaultContext<span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-cyan-fg">DynamicPPL</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/nxcz4/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">model.jl:902</span>
 [10] <span class="ansi-bold">evaluate!!</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/nxcz4/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">model.jl:832</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [11] <span class="ansi-bold">logdensity_at</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/nxcz4/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">logdensityfunction.jl:183</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [12] <span class="ansi-bold">FixTail</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DifferentiationInterface/sPszY/src/utils/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">context.jl:169</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [13] <span class="ansi-bold">vector_mode_dual_eval!</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">f</span>::DifferentiationInterface.FixTail<span class="ansi-bright-black-fg">{typeof(DynamicPPL.logdensity_at), Tuple{Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DefaultContext}, VarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}, DefaultContext}}</span>, <span class="ansi-bright-black-fg">cfg</span>::ForwardDiff.GradientConfig<span class="ansi-bright-black-fg">{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}</span>, <span class="ansi-bright-black-fg">x</span>::Vector<span class="ansi-bright-black-fg">{Float64}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-green-fg">ForwardDiff</span> <span class="ansi-bright-black-fg">~/.julia/packages/ForwardDiff/UBbGT/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">apiutils.jl:24</span>
 [14] <span class="ansi-bold">vector_mode_gradient!</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/ForwardDiff/UBbGT/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">gradient.jl:98</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [15] <span class="ansi-bold">gradient!</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">result</span>::DiffResults.MutableDiffResult<span class="ansi-bright-black-fg">{1, Float64, Tuple{Vector{Float64}}}</span>, <span class="ansi-bright-black-fg">f</span>::DifferentiationInterface.FixTail<span class="ansi-bright-black-fg">{typeof(DynamicPPL.logdensity_at), Tuple{Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DefaultContext}, VarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}, DefaultContext}}</span>, <span class="ansi-bright-black-fg">x</span>::Vector<span class="ansi-bright-black-fg">{Float64}</span>, <span class="ansi-bright-black-fg">cfg</span>::ForwardDiff.GradientConfig<span class="ansi-bright-black-fg">{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}</span>, ::Val<span class="ansi-bright-black-fg">{false}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-green-fg">ForwardDiff</span> <span class="ansi-bright-black-fg">~/.julia/packages/ForwardDiff/UBbGT/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">gradient.jl:39</span>
 [16] <span class="ansi-bold">value_and_gradient</span><span class="ansi-bold">(</span>::typeof(DynamicPPL.logdensity_at), ::DifferentiationInterfaceForwardDiffExt.ForwardDiffGradientPrep<span class="ansi-bright-black-fg">{Tuple{typeof(DynamicPPL.logdensity_at), AutoForwardDiff{2, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}}, Vector{Float64}, Tuple{DifferentiationInterface.Constant{Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DefaultContext}}, DifferentiationInterface.Constant{VarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}}, DifferentiationInterface.Constant{DefaultContext}}}, ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}, Tuple{Nothing, Nothing, Nothing}}</span>, ::AutoForwardDiff<span class="ansi-bright-black-fg">{2, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}}</span>, ::Vector<span class="ansi-bright-black-fg">{Float64}</span>, ::DifferentiationInterface.Constant<span class="ansi-bright-black-fg">{Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DefaultContext}}</span>, ::DifferentiationInterface.Constant<span class="ansi-bright-black-fg">{VarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}}</span>, ::DifferentiationInterface.Constant<span class="ansi-bright-black-fg">{DefaultContext}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-yellow-fg">DifferentiationInterfaceForwardDiffExt</span> <span class="ansi-bright-black-fg">~/.julia/packages/DifferentiationInterface/sPszY/ext/DifferentiationInterfaceForwardDiffExt/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">onearg.jl:417</span>
 [17] <span class="ansi-bold">logdensity_and_gradient</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">f</span>::LogDensityFunction<span class="ansi-bright-black-fg">{Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DefaultContext}, VarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}, DefaultContext, AutoForwardDiff{2, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}}}</span>, <span class="ansi-bright-black-fg">x</span>::Vector<span class="ansi-bright-black-fg">{Float64}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-cyan-fg">DynamicPPL</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/nxcz4/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">logdensityfunction.jl:234</span>
 [18] <span class="ansi-bold">leapfrog_step</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">model</span>::LogDensityFunction<span class="ansi-bright-black-fg">{Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DefaultContext}, VarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}, DefaultContext, AutoForwardDiff{2, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}}}</span>, <span class="ansi-bright-black-fg">x</span>::Vector<span class="ansi-bright-black-fg">{Float64}</span>, <span class="ansi-bright-black-fg">p</span>::Vector<span class="ansi-bright-black-fg">{Float64}</span>, <span class="ansi-bright-black-fg">ϵ</span>::Int64, <span class="ansi-bright-black-fg">M</span>::UniformScaling<span class="ansi-bright-black-fg">{Bool}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-magenta-fg">Main.Notebook</span> <span class="ansi-bright-black-fg">~/work/docs/docs/developers/inference/implementing-samplers/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">index.qmd:305</span>
 [19] <span class="ansi-bold">step</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">rng</span>::TaskLocalRNG, <span class="ansi-bright-black-fg">model_wrapper</span>::AbstractMCMC.LogDensityModel<span class="ansi-bright-black-fg">{LogDensityFunction{Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DefaultContext}, VarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}, DefaultContext, AutoForwardDiff{2, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}}}}</span>, <span class="ansi-bright-black-fg">sampler</span>::MALA<span class="ansi-bright-black-fg">{Int64, UniformScaling{Bool}}</span>, <span class="ansi-bright-black-fg">state</span>::MALAState<span class="ansi-bright-black-fg">{Vector{Float64}}</span>; <span class="ansi-bright-black-fg">kwargs</span>::@Kwargs<span class="ansi-bright-black-fg">{}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-magenta-fg">Main.Notebook</span> <span class="ansi-bright-black-fg">~/work/docs/docs/developers/inference/implementing-samplers/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">index.qmd:276</span>
 [20] <span class="ansi-bold">step</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">rng</span>::TaskLocalRNG, <span class="ansi-bright-black-fg">model_wrapper</span>::AbstractMCMC.LogDensityModel<span class="ansi-bright-black-fg">{LogDensityFunction{Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DefaultContext}, VarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}, DefaultContext, AutoForwardDiff{2, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}}}}</span>, <span class="ansi-bright-black-fg">sampler</span>::MALA<span class="ansi-bright-black-fg">{Int64, UniformScaling{Bool}}</span>, <span class="ansi-bright-black-fg">state</span>::MALAState<span class="ansi-bright-black-fg">{Vector{Float64}}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-magenta-fg">Main.Notebook</span> <span class="ansi-bright-black-fg">~/work/docs/docs/developers/inference/implementing-samplers/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">index.qmd:258</span>
 [21] <span class="ansi-bold">step</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">rng</span>::TaskLocalRNG, <span class="ansi-bright-black-fg">model</span>::Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DefaultContext}</span>, <span class="ansi-bright-black-fg">sampler_wrapper</span>::Sampler<span class="ansi-bright-black-fg">{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}</span>, <span class="ansi-bright-black-fg">state</span>::Turing.Inference.TuringState<span class="ansi-bright-black-fg">{MALAState{Vector{Float64}}, Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DefaultContext}, VarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}, DefaultContext}</span>; <span class="ansi-bright-black-fg">kwargs</span>::@Kwargs<span class="ansi-bright-black-fg">{}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-magenta-fg">Turing.Inference</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/1gxqi/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">external_sampler.jl:161</span>
 [22] <span class="ansi-bold">step</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">rng</span>::TaskLocalRNG, <span class="ansi-bright-black-fg">model</span>::Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DefaultContext}</span>, <span class="ansi-bright-black-fg">sampler_wrapper</span>::Sampler<span class="ansi-bright-black-fg">{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}</span>, <span class="ansi-bright-black-fg">state</span>::Turing.Inference.TuringState<span class="ansi-bright-black-fg">{MALAState{Vector{Float64}}, Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DefaultContext}, VarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}, DefaultContext}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-magenta-fg">Turing.Inference</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/1gxqi/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">external_sampler.jl:150</span>
 [23] <span class="ansi-bold">macro expansion</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/AbstractMCMC/F50rb/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">sample.jl:219</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [24] <span class="ansi-bold">macro expansion</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/AbstractMCMC/F50rb/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">logging.jl:16</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [25] <span class="ansi-bold">mcmcsample</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">rng</span>::TaskLocalRNG, <span class="ansi-bright-black-fg">model</span>::Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DefaultContext}</span>, <span class="ansi-bright-black-fg">sampler</span>::Sampler<span class="ansi-bright-black-fg">{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}</span>, <span class="ansi-bright-black-fg">N</span>::Int64; <span class="ansi-bright-black-fg">progress</span>::Bool, <span class="ansi-bright-black-fg">progressname</span>::String, <span class="ansi-bright-black-fg">callback</span>::Nothing, <span class="ansi-bright-black-fg">num_warmup</span>::Int64, <span class="ansi-bright-black-fg">discard_initial</span>::Int64, <span class="ansi-bright-black-fg">thinning</span>::Int64, <span class="ansi-bright-black-fg">chain_type</span>::Type, <span class="ansi-bright-black-fg">initial_state</span>::Nothing, <span class="ansi-bright-black-fg">kwargs</span>::@Kwargs<span class="ansi-bright-black-fg">{}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-cyan-fg">AbstractMCMC</span> <span class="ansi-bright-black-fg">~/.julia/packages/AbstractMCMC/F50rb/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">sample.jl:144</span>
 [26] <span class="ansi-bold">sample</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">rng</span>::TaskLocalRNG, <span class="ansi-bright-black-fg">model</span>::Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DefaultContext}</span>, <span class="ansi-bright-black-fg">sampler</span>::Sampler<span class="ansi-bright-black-fg">{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}</span>, <span class="ansi-bright-black-fg">N</span>::Int64; <span class="ansi-bright-black-fg">chain_type</span>::Type, <span class="ansi-bright-black-fg">resume_from</span>::Nothing, <span class="ansi-bright-black-fg">initial_state</span>::Nothing, <span class="ansi-bright-black-fg">kwargs</span>::@Kwargs<span class="ansi-bright-black-fg">{progress::Bool}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-cyan-fg">DynamicPPL</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/nxcz4/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">sampler.jl:102</span>
 [27] <span class="ansi-bold">sample</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/nxcz4/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">sampler.jl:92</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [28] <span class="ansi-bold">#sample#101</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/1gxqi/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">abstractmcmc.jl:29</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [29] <span class="ansi-bold">sample</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/1gxqi/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">abstractmcmc.jl:20</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [30] <span class="ansi-bold">#sample#100</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/1gxqi/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">abstractmcmc.jl:17</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [31] top-level scope
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/work/docs/docs/developers/inference/implementing-samplers/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">index.qmd:459</span></pre>
</div>
</div>
</div>
<p>As expected, we run into a <code>DomainError</code> at some point, while if we set <code>unconstrained=true</code>, letting Turing.jl transform the model to a unconstrained form behind the scenes, everything works as expected:</p>
<div id="52" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 0.66 seconds
Compute duration  = 0.66 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters  </span><span class="ansi-bold">    mean  </span><span class="ansi-bold">     std  </span><span class="ansi-bold">    mcse  </span><span class="ansi-bold"> ess_bulk  </span><span class="ansi-bold"> ess_tail  </span><span class="ansi-bold">    rhat  </span><span class="ansi-bold"> e ⋯
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">  Float64  </span><span class="ansi-bright-black-fg ansi-bold">  Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">   ⋯

          σ²    0.7798    0.5702    0.0495    72.1139    24.4949    1.0271     ⋯
           x   -0.0414    0.9052    0.0420   692.6404   464.5717    1.0348     ⋯
</span><span class="ansi-cyan-fg ansi-bold">                                                                1 column omitted

Quantiles
 </span><span class="ansi-cyan-fg ansi-bold"> parameters  </span><span class="ansi-cyan-fg ansi-bold">    2.5%  </span><span class="ansi-cyan-fg ansi-bold">   25.0%  </span><span class="ansi-cyan-fg ansi-bold">   50.0%  </span><span class="ansi-cyan-fg ansi-bold">   75.0%  </span><span class="ansi-cyan-fg ansi-bold">   97.5%
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64

          σ²    0.0264    0.3430    0.6702    1.1075    2.1142
           x   -2.0126   -0.3993   -0.0034    0.3573    1.8394
</span></pre>
</div>
</div>
</div>
<p>Neat!</p>
<p>Similarly, which automatic differentiation backend one should use can be specified through the <code>adtype</code> keyword argument too. For example, if we want to use <a href="https://github.com/JuliaDiff/ReverseDiff.jl">ReverseDiff.jl</a> instead of the default <a href="https://github.com/JuliaDiff/ForwardDiff.jl">ForwardDiff.jl</a>:</p>
<div id="54" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">ReverseDiff</span>: ReverseDiff</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify that we want to use `AutoReverseDiff`.</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">demo</span>(),</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>, adtype<span class="op">=</span><span class="fu">AutoReverseDiff</span>()),</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>;</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 3.07 seconds
Compute duration  = 3.07 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters  </span><span class="ansi-bold">    mean  </span><span class="ansi-bold">     std  </span><span class="ansi-bold">    mcse  </span><span class="ansi-bold"> ess_bulk  </span><span class="ansi-bold"> ess_tail  </span><span class="ansi-bold">    rhat  </span><span class="ansi-bold"> e ⋯
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">  Float64  </span><span class="ansi-bright-black-fg ansi-bold">  Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">   ⋯

          σ²    0.8074    0.5697    0.0309   242.1285    76.8268    1.0016     ⋯
           x    0.0700    0.9413    0.0604   314.8351   254.6222    1.0073     ⋯
</span><span class="ansi-cyan-fg ansi-bold">                                                                1 column omitted

Quantiles
 </span><span class="ansi-cyan-fg ansi-bold"> parameters  </span><span class="ansi-cyan-fg ansi-bold">    2.5%  </span><span class="ansi-cyan-fg ansi-bold">   25.0%  </span><span class="ansi-cyan-fg ansi-bold">   50.0%  </span><span class="ansi-cyan-fg ansi-bold">   75.0%  </span><span class="ansi-cyan-fg ansi-bold">   97.5%
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64

          σ²    0.1390    0.3544    0.6537    1.1681    2.1624
           x   -1.8696   -0.3829    0.0199    0.4869    2.1112
</span></pre>
</div>
</div>
</div>
<p>Double-neat.</p>
</section>
</section>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<p>At this point it’s worth maybe reminding ourselves what we did and also <em>why</em> we did it:</p>
<ol type="1">
<li>We define our models in the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface because it makes the sampler agnostic to how the underlying model is implemented.</li>
<li>We implement our sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> interface, which just means that our sampler is a subtype of <code>AbstractMCMC.AbstractSampler</code> and we implement the MCMC transition in <code>AbstractMCMC.step</code>.</li>
<li>Points 1 and 2 makes it so our sampler can be used with a wide range of model implementations, amongst them being models implemented in both Turing.jl and Stan. This gives you, the inference implementer, a large collection of models to test your inference method on, in addition to allowing users of Turing.jl and Stan to try out your inference method with minimal effort.</li>
</ol>


</section>


<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a><div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>We’re going with the leapfrog formulation because in a future version of this tutorial we’ll add a section extending this simple “baseline” MALA sampler to more complex versions. See <a href="https://github.com/TuringLang/docs/issues/479">issue #479</a> for progress on this.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>There is no such thing as a proper interface in Julia (at least not officially), and so we use the word “interface” here to mean a few minimal methods that needs to be implemented by any type that we treat as a target model.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    // Ensure there is a toggle, if there isn't float one in the top right
    if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
      const a = window.document.createElement('a');
      a.classList.add('top-right');
      a.classList.add('quarto-color-scheme-toggle');
      a.href = "";
      a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
      const i = window.document.createElement("i");
      i.classList.add('bi');
      a.appendChild(i);
      window.document.body.appendChild(a);
    }
    setColorSchemeToggle(hasAlternateSentinel())
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/turinglang\.org\/docs\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../../developers/inference/variational-inference/index.html" class="pagination-link" aria-label="Variational Inference">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Variational Inference</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Turing is created by <a href="http://mlg.eng.cam.ac.uk/hong/" target="_blank">Hong Ge</a>, and lovingly maintained by the <a href="https://github.com/TuringLang/Turing.jl/graphs/contributors" target="_blank">core team</a> of volunteers. <br> The contents of this website are © 2018–2025 under the terms of the <a href="https://github.com/TuringLang/docs/blob/main/LICENCE" target="_blank">MIT License</a>.</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/TuringLang/docs/edit/main/developers/inference/implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/docs/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://x.com/TuringLang">
      <i class="bi bi-twitter" role="img" aria-label="Turing Twitter">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/TuringLang/Turing.jl">
      <i class="bi bi-github" role="img" aria-label="Turing GitHub">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




<script src="../../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>