<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.5">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Implementing samplers – Turing.jl</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../tutorials/docs-07-for-developers-variational-inference/index.html" rel="prev">
<link href="../../assets/favicon.ico" rel="icon">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-ff4371ef257df69894857e99c6ad0d06.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark-dec4957386d03255e1655963b31d62d3.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-f80257e2a36ff81c57cea0ffaf822744.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark-3042bfe894fb86cfc239603025ade02d.min.css" rel="prefetch" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<style>
  a {
    text-decoration: none;
  }
  a:hover {
    text-decoration: underline;
  }
</style>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../theming/styles.css">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="https://turinglang.org/" class="navbar-brand navbar-brand-logo">
    <img src="../../assets/images/turing-logo.svg" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="https://turinglang.org/">
    <span class="navbar-title">Turing.jl</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../tutorials/docs-00-getting-started/"> 
<span class="menu-text">Get Started</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../tutorials/00-introduction/"> 
<span class="menu-text">Tutorials</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/library/"> 
<span class="menu-text">Libraries</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/news/"> 
<span class="menu-text">News</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/team/"> 
<span class="menu-text">Team</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-v0.35" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">v0.35</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-v0.35">    
        <li>
    <a class="dropdown-item" href="https://turinglang.org/docs/changelog.html">
 <span class="dropdown-text">Changelog</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://turinglang.org/docs/versions.html">
 <span class="dropdown-text">All Versions</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools tools-wide">
    <a href="https://x.com/TuringLang" title="Turing Twitter" class="quarto-navigation-tool px-1" aria-label="Turing Twitter"><i class="bi bi-twitter"></i></a>
    <a href="https://github.com/TuringLang/Turing.jl" title="Turing GitHub" class="quarto-navigation-tool px-1" aria-label="Turing GitHub"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Developers</li><li class="breadcrumb-item"><a href="../../tutorials/docs-06-for-developers-interface/index.html">Inference (note: outdated)</a></li><li class="breadcrumb-item"><a href="../../tutorials/docs-17-implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false">
 <span class="menu-text">Users</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-00-getting-started/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Getting Started</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-12-using-turing-guide/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Core Functionality</span></a>
  </div>
</li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false">
 <span class="menu-text">Usage Tips</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-10-using-turing-autodiff/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Automatic Differentiation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/usage-custom-distribution/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Custom Distributions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/usage-probability-interface/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Querying Model Probabilities</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/usage-modifying-logprob/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Modifying the Log Probability</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/usage-generated-quantities/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Generated Quantities</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-17-mode-estimation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Mode Estimation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-13-using-turing-performance-tips/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Performance Tips</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-15-using-turing-sampler-viz/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Sampler Visualization</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-11-using-turing-dynamichmc/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using DynamicHMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-16-using-turing-external-samplers/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using External Samplers</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false">
 <span class="menu-text">Tutorials</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/00-introduction/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction: Coin Flipping</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/01-gaussian-mixture-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Mixture Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/02-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/03-bayesian-neural-network/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Neural Networks</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/04-hidden-markov-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Hidden Markov Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/05-linear-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Linear Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/06-infinite-mixture-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Infinite Mixture Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/07-poisson-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Poisson Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/08-multinomial-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Multinomial Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/09-variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/10-bayesian-differential-equations/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Differential Equations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/11-probabilistic-pca/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Probabilistic PCA</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/13-seasonal-time-series/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Time Series Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/15-gaussian-processes/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction to Gaussian Processes</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/12-gplvm/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Process Latent Variable Models</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Developers</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false">
 <span class="menu-text">Contributing</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-01-contributing-guide/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">How to Contribute</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="false">
 <span class="menu-text">DynamicPPL in Depth</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/dev-model-manual/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Manually Defining a Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-05-for-developers-compiler/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Turing Compiler Design</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/14-minituring/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation I: Compiler</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/16-contexts/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation II: Contexts</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true">
 <span class="menu-text">Inference (note: outdated)</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-06-for-developers-interface/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Interface Guide</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-04-for-developers-abstractmcmc-turing/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">How Turing implements AbstractMCMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-07-for-developers-variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-17-implementing-samplers/index.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Implementing Samplers</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of Contents</h2>
   
  <ul>
  <li><a href="#quick-overview-of-mala" id="toc-quick-overview-of-mala" class="nav-link active" data-scroll-target="#quick-overview-of-mala">Quick overview of MALA</a></li>
  <li><a href="#what-we-need-from-a-model-logdensityproblems.jl" id="toc-what-we-need-from-a-model-logdensityproblems.jl" class="nav-link" data-scroll-target="#what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: LogDensityProblems.jl</a></li>
  <li><a href="#implementing-mala-in-abstractmcmc.jl" id="toc-implementing-mala-in-abstractmcmc.jl" class="nav-link" data-scroll-target="#implementing-mala-in-abstractmcmc.jl">Implementing MALA in AbstractMCMC.jl</a></li>
  <li><a href="#using-our-sampler-with-turing.jl" id="toc-using-our-sampler-with-turing.jl" class="nav-link" data-scroll-target="#using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</a>
  <ul class="collapse">
  <li><a href="#models-with-constrained-parameters" id="toc-models-with-constrained-parameters" class="nav-link" data-scroll-target="#models-with-constrained-parameters">Models with constrained parameters</a></li>
  </ul></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/TuringLang/docs/edit/master/tutorials/docs-17-implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/docs/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Developers</li><li class="breadcrumb-item"><a href="../../tutorials/docs-06-for-developers-interface/index.html">Inference (note: outdated)</a></li><li class="breadcrumb-item"><a href="../../tutorials/docs-17-implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Implementing samplers</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>In this tutorial, we’ll go through step-by-step how to implement a “simple” sampler in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> in such a way that it can be easily applied to Turing.jl models.</p>
<p>In particular, we’re going to implement a version of <strong>Metropolis-adjusted Langevin (MALA)</strong>.</p>
<p>Note that we will implement this sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> framework, completely “ignoring” Turing.jl until the very end of the tutorial, at which point we’ll use a single line of code to make the resulting sampler available to Turing.jl. This is to really drive home the point that one can implement samplers in a way that is accessible to all of Turing.jl’s users without having to use Turing.jl yourself.</p>
<section id="quick-overview-of-mala" class="level2">
<h2 class="anchored" data-anchor-id="quick-overview-of-mala">Quick overview of MALA</h2>
<p>We can view MALA as a single step of the leapfrog intergrator with resampling of momentum <span class="math inline">\(p\)</span> at every step.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> To make that statement a bit more concrete, we first define the <em>extended</em> target <span class="math inline">\(\bar{\gamma}(x, p)\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\log \bar{\gamma}(x, p) \propto \log \gamma(x) + \log \gamma_{\mathcal{N}(0, M)}(p)
\end{equation*}\]</span></p>
<p>where <span class="math inline">\(\gamma_{\mathcal{N}(0, M)}\)</span> denotes the density for a zero-centered Gaussian with covariance matrix <span class="math inline">\(M\)</span>. We then consider targeting this joint distribution over both <span class="math inline">\(x\)</span> and <span class="math inline">\(p\)</span> as follows. First we define the map</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  L_{\epsilon}: \quad &amp; \mathbb{R}^d \times \mathbb{R}^d \to \mathbb{R}^d \times \mathbb{R}^d \\
  &amp; (x, p) \mapsto (\tilde{x}, \tilde{p}) := L_{\epsilon}(x, p)
\end{split}
\end{equation*}\]</span></p>
<p>as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p_{1 / 2} &amp;:= p + \frac{\epsilon}{2} \nabla \log \gamma(x) \\
  \tilde{x} &amp;:= x + \epsilon M^{-1} p_{1 /2 } \\
  p_1 &amp;:= p_{1 / 2} + \frac{\epsilon}{2} \nabla \log \gamma(\tilde{x}) \\
  \tilde{p} &amp;:= - p_1
\end{split}
\end{equation*}\]</span></p>
<p>This might be familiar for some readers as a single step of the Leapfrog integrator. We then define the MALA kernel as follows: given the current iterate <span class="math inline">\(x_i\)</span>, we sample the next iterate <span class="math inline">\(x_{i + 1}\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p &amp;\sim \mathcal{N}(0, M) \\
  (\tilde{x}, \tilde{p}) &amp;:= L_{\epsilon}(x_i, p) \\
  \alpha &amp;:= \min \left\{ 1, \frac{\bar{\gamma}(\tilde{x}, \tilde{p})}{\bar{\gamma}(x_i, p)} \right\} \\
  x_{i + 1} &amp;:=
  \begin{cases}
    \tilde{x} \quad &amp; \text{ with prob. } \alpha \\
    x_i       \quad &amp; \text{ with prob. } 1 - \alpha
  \end{cases}
\end{split}
\end{equation*}\]</span></p>
<p>i.e.&nbsp;we accept the proposal <span class="math inline">\(\tilde{x}\)</span> with probability <span class="math inline">\(\alpha\)</span> and reject it, thus sticking with our current iterate, with probability <span class="math inline">\(1 - \alpha\)</span>.</p>
</section>
<section id="what-we-need-from-a-model-logdensityproblems.jl" class="level2">
<h2 class="anchored" data-anchor-id="what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a></h2>
<p>There are a few things we need from the “target” / “model” / density that we want to sample from:</p>
<ol type="1">
<li>We need access to log-density <em>evaluations</em> <span class="math inline">\(\log \gamma(x)\)</span> so we can compute the acceptance ratio involving <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>We need access to log-density <em>gradients</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span> so we can compute the Leapfrog steps <span class="math inline">\(L_{\epsilon}(x, p)\)</span>.</li>
<li>We also need access to the “size” of the model so we can determine the size of <span class="math inline">\(M\)</span>.</li>
</ol>
<p>Luckily for us, there is a package called <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> which provides an interface for <em>exactly</em> this!</p>
<p>To demonstrate how one can implement the “<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface”<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> we will use a simple Gaussian model as an example:</p>
<div id="4" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblems</span>: LogDensityProblems;</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's define some type that represents the model.</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> IsotropicNormalModel{M<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"mean of the isotropic Gaussian"</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    mean<span class="op">::</span><span class="dt">M</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Specifies what input length the model expects.</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">dimension</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> <span class="fu">length</span>(model.mean)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Implementation of the log-density evaluation of the model.</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x<span class="op">::</span><span class="dt">AbstractVector{&lt;:Real}</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">-</span> <span class="fu">sum</span>(abs2, x <span class="op">.-</span> model.mean) <span class="op">/</span> <span class="fl">2</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This gives us all of the properties we want for our MALA sampler with the exception of the computation of the <em>gradient</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span>. There is the method <code>LogDensityProblems.logdensity_and_gradient</code> which should return a 2-tuple where the first entry is the evaluation of the logdensity <span class="math inline">\(\log \gamma(x)\)</span> and the second entry is the gradient <span class="math inline">\(\nabla \log \gamma(x)\)</span>.</p>
<p>There are two ways to “implement” this method: 1) we implement it by hand, which is feasible in the case of our <code>IsotropicNormalModel</code>, or b) we defer the implementation of this to a automatic differentiation backend.</p>
<p>To implement it by hand we can simply do</p>
<div id="6" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl that first-order, i.e. gradient information, is available.</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{1}</span>()</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Implement `logdensity_and_gradient`.</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    logγ_x <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="op">-</span>x <span class="op">.*</span> (x <span class="op">-</span> model.mean)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> logγ_x, ∇logγ_x</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s just try it out:</p>
<div id="8" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate the problem.</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> <span class="fu">IsotropicNormalModel</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.])</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create some example input that we can test on.</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>x_example <span class="op">=</span> <span class="fu">randn</span>(LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate!</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-20.73837530442548</code></pre>
</div>
</div>
<p>To defer it to an automatic differentiation backend, we can do</p>
<div id="10" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl we only have access to 0-th order information.</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{0}</span>()</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Use `LogDensityProblemsAD`'s `ADgradient` in combination with some AD backend to implement `logdensity_and_gradient`.</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblemsAD</span>, <span class="bu">ADTypes</span>, <span class="bu">ForwardDiff</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>model_with_grad <span class="op">=</span> <span class="fu">ADgradient</span>(<span class="fu">AutoForwardDiff</span>(), model)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model_with_grad, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-20.73837530442548</code></pre>
</div>
</div>
<p>We’ll continue with the second approach in this tutorial since this is typically what one does in practice, because there are better hobbies to spend time on than deriving gradients by hand.</p>
<p>At this point, one might wonder how we’re going to tie this back to Turing.jl in the end. Effectively, when working with inference methods that only require log-density evaluations and / or higher-order information of the log-density, Turing.jl actually converts the user-provided <code>Model</code> into an object implementing the above methods for <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>. As a result, most samplers provided by Turing.jl are actually implemented to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, enabling their use both <em>within</em> Turing.jl and <em>outside</em> of Turing.jl! Morever, there exists similar conversions for Stan through BridgeStan and Stan<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, which means that a sampler supporting the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface can easily be used on both Turing.jl <em>and</em> Stan models (in addition to user-provided models, as our <code>IsotropicNormalModel</code> above)!</p>
<p>Anyways, let’s move on to actually implementing the sampler.</p>
</section>
<section id="implementing-mala-in-abstractmcmc.jl" class="level2">
<h2 class="anchored" data-anchor-id="implementing-mala-in-abstractmcmc.jl">Implementing MALA in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a></h2>
<p>Now that we’ve established that a model implementing the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface provides us with all the information we need from <span class="math inline">\(\log \gamma(x)\)</span>, we can address the question: given an object that implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, how can we define a sampler for it?</p>
<p>We’re going to do this by making our sampler a sub-type of <code>AbstractMCMC.AbstractSampler</code> in addition to implementing a few methods from <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>. Why? Because it gets us <em>a lot</em> of functionality for free, as we will see later.</p>
<p>Moreover, <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> provides a very natural interface for MCMC algorithms.</p>
<p>First, we’ll define our <code>MALA</code> type</p>
<div id="12" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">AbstractMCMC</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALA{T,A} <span class="op">&lt;:</span><span class="dt"> AbstractMCMC.AbstractSampler</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"stepsize used in the leapfrog step"</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    ϵ_init<span class="op">::</span><span class="dt">T</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"covariance matrix used for the momentum"</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    M_init<span class="op">::</span><span class="dt">A</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notice how we’ve added the suffix <code>_init</code> to both the stepsize and the covariance matrix. We’ve done this because a <code>AbstractMCMC.AbstractSampler</code> should be <em>immutable</em>. Of course there might be many scenarios where we want to allow something like the stepsize and / or the covariance matrix to vary between iterations, e.g.&nbsp;during the burn-in / adaptation phase of the sampling process we might want to adjust the parameters using statistics computed from these initial iterations. But information which can change between iterations <em>should not go in the sampler itself</em>! Instead, this information should go in the sampler <em>state</em>.</p>
<p>The sampler state should at the very least contain all the necessary information to perform the next MCMC iteration, but usually contains further information, e.g.&nbsp;quantities and statistics useful for evaluating whether the sampler has converged.</p>
<p>We will use the following sampler state for our <code>MALA</code> sampler:</p>
<div id="14" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALAState{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This might seem overly redundant: we’re defining a type <code>MALAState</code> and it only contains a simple vector of reals. In this particular case we indeed could have dropped this and simply used a <code>AbstractVector{&lt;:Real}</code> as our sampler state, but typically, as we will see later, one wants to include other quantities in the sampler state. For example, if we also wanted to adapt the parameters of our <code>MALA</code>, e.g.&nbsp;alter the stepsize depending on acceptance rates, in which case we should also put <code>ϵ</code> in the state, but for now we’ll keep things simple.</p>
<p>Moreover, we also want a <em>sample</em> type, which is a type meant for “public consumption”, i.e.&nbsp;the end-user. This is generally going to contain a subset of the information present in the state. But in such a simple scenario as this, we similarly only have a <code>AbstractVector{&lt;:Real}</code>:</p>
<div id="16" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALASample{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We currently have three things:</p>
<ol type="1">
<li>A <code>AbstractMCMC.AbstractSampler</code> implementation called <code>MALA</code>.</li>
<li>A state <code>MALAState</code> for our sampler <code>MALA</code>.</li>
<li>A sample <code>MALASample</code> for our sampler <code>MALA</code>.</li>
</ol>
<p>That means that we’re ready to implement the only thing that really matters: <code>AbstractMCMC.step</code>.</p>
<p><code>AbstractMCMC.step</code> defines the MCMC iteration of our <code>MALA</code> given the current <code>MALAState</code>. Specifically, the signature of the function is as follows:</p>
<div id="18" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The RNG to ensure reproducibility.</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The model that defines our target.</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.AbstractModel</span>,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The sampler for which we're taking a `step`.</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">AbstractMCMC.AbstractSampler</span>,</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The current sampler `state`.</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    state;</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Additional keyword arguments that we may or may not need.</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Moreover, there is a specific <code>AbstractMCMC.AbstractModel</code> which is used to indicate that the model that is provided implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface: <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Since, as we discussed earlier, in our case we’re indeed going to work with types that support the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, we’ll define <code>AbstractMCMC.step</code> for such a <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Note that <code>AbstractMCMC.LogDensityModel</code> has no other purpose; it has a single field called <code>logdensity</code>, and it does nothing else. But by wrapping the model in <code>AbstractMCMC.LogDensityModel</code>, it allows samplers that want to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> to define their <code>AbstractMCMC.step</code> on this type without running into method ambiguities.</p>
<p>All in all, that means that the signature for our <code>AbstractMCMC.step</code> is going to be the following:</p>
<div id="20" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># `LogDensityModel` so we know we're working with LogDensityProblems.jl model.</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler.</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler state.</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Great! Now let’s actually implement the full <code>AbstractMCMC.step</code> for our <code>MALA</code>.</p>
<p>Let’s remind ourselves what we’re going to do:</p>
<ol type="1">
<li>Sample a new momentum <span class="math inline">\(p\)</span>.</li>
<li>Compute the log-density of the extended target <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>Take a single leapfrog step <span class="math inline">\((\tilde{x}, \tilde{p}) = L_{\epsilon}(x, p)\)</span>.</li>
<li>Accept or reject the proposed <span class="math inline">\((\tilde{x}, \tilde{p})\)</span>.</li>
</ol>
<p>All in all, this results in the following:</p>
<div id="22" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>: Random</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Distributions</span>  <span class="co"># so we get the `MvNormal`</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the wrapped model which implements LogDensityProblems.jl.</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just extract the sampler parameters to make our lives easier.</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    ϵ <span class="op">=</span> sampler.ϵ_init</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    M <span class="op">=</span> sampler.M_init</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the current parameters.</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> state.x</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sample the momentum.</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>    p_dist <span class="op">=</span> <span class="fu">MvNormal</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)), M)</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> <span class="fu">rand</span>(rng, p_dist)</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Propose using a single leapfrog step.</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>    x̃, p̃ <span class="op">=</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Accept or reject proposal.</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>    logp <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p)</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>    logp̃ <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x̃) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p̃)</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>    logα <span class="op">=</span> logp̃ <span class="op">-</span> logp</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>    state_new <span class="op">=</span> <span class="cf">if</span> <span class="fu">log</span>(<span class="fu">rand</span>(rng)) <span class="op">&lt;</span> logα</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Accept.</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x̃)</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Reject.</span></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x)</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return the "sample" and the sampler state.</span></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(state_new.x), state_new</span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Fairly straight-forward.</p>
<p>Of course, we haven’t defined the <code>leapfrog_step</code> method yet, so let’s do that:</p>
<div id="24" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p` using "position" `x`.</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x))</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    p1 <span class="op">=</span> p <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update the "position" `x` using momentum `p1`.</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    x̃ <span class="op">=</span> x <span class="op">+</span> ϵ <span class="op">.*</span> (M <span class="op">\</span> p1)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p1` using position `x̃`</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x̃ <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x̃))</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    p2 <span class="op">=</span> p1 <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x̃</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Flip momentum `p2`.</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    p̃ <span class="op">=</span> <span class="op">-</span>p2</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x̃, p̃</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>leapfrog_step (generic function with 1 method)</code></pre>
</div>
</div>
<p>With all of this, we’re technically ready to sample!</p>
<div id="26" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>, <span class="bu">LinearAlgebra</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>rng <span class="op">=</span> <span class="bu">Random</span>.<span class="fu">default_rng</span>()</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>sampler <span class="op">=</span> <span class="fu">MALA</span>(<span class="fl">1</span>, I)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>state <span class="op">=</span> <span class="fu">MALAState</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)))</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>x_next, state_next <span class="op">=</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    rng,</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    AbstractMCMC.<span class="fu">LogDensityModel</span>(model),</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    state</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>(MALASample{Vector{Float64}}([0.0, 0.0, 0.0]), MALAState{Vector{Float64}}([0.0, 0.0, 0.0]))</code></pre>
</div>
</div>
<p>Great, it works!</p>
<p>And I promised we would get quite some functionality for free if we implemented <code>AbstractMCMC.step</code>, and so we can now simply call <code>sample</code> to perform standard MCMC sampling:</p>
<div id="28" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform 1000 iterations with our `MALA` sampler.</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; initial_state<span class="op">=</span>state, progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Concatenate into a matrix.</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000 Matrix{Float64}:
 -0.361403  -0.26619   -3.14745   -4.15808  …  -4.42819  -5.84688  -5.84688
  0.194681  -0.700079  -0.771989   1.82976      1.06693  -1.91796  -1.91796
  3.41647    3.77157    3.83651    5.18236      5.39759   4.1903    4.1903</code></pre>
</div>
</div>
<div id="30" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the marginal means and standard deviations.</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -5.00428      1.00079
  0.000627944  0.990793
  4.9802       0.991613</code></pre>
</div>
</div>
<p>Let’s visualize the samples</p>
<div id="32" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">StatsPlots</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">transpose</span>(samples_matrix[<span class="op">:</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">:</span><span class="kw">end</span>]), alpha<span class="op">=</span><span class="fl">0.5</span>, legend<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<!--?xml version="1.0" encoding="utf-8"?-->
<svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" width="672" height="480" viewbox="0 0 2688 1920">
<defs>
  <clippath id="clip800">
    <rect x="0" y="0" width="2688" height="1920"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip800)" d="M0 1920 L2688 1920 L2688 0 L0 0  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip801">
    <rect x="537" y="0" width="1883" height="1883"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip800)" d="M196.816 1800.78 L2640.76 1800.78 L2640.76 47.2441 L196.816 47.2441  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip802">
    <rect x="196" y="47" width="2445" height="1755"></rect>
  </clippath>
</defs>
<polyline clip-path="url(#clip802)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="263.676,1800.78 263.676,47.2441 "></polyline>
<polyline clip-path="url(#clip802)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="840.654,1800.78 840.654,47.2441 "></polyline>
<polyline clip-path="url(#clip802)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1417.63,1800.78 1417.63,47.2441 "></polyline>
<polyline clip-path="url(#clip802)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1994.61,1800.78 1994.61,47.2441 "></polyline>
<polyline clip-path="url(#clip802)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="2571.59,1800.78 2571.59,47.2441 "></polyline>
<polyline clip-path="url(#clip802)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,1643.9 2640.76,1643.9 "></polyline>
<polyline clip-path="url(#clip802)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,1394.06 2640.76,1394.06 "></polyline>
<polyline clip-path="url(#clip802)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,1144.22 2640.76,1144.22 "></polyline>
<polyline clip-path="url(#clip802)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,894.382 2640.76,894.382 "></polyline>
<polyline clip-path="url(#clip802)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,644.543 2640.76,644.543 "></polyline>
<polyline clip-path="url(#clip802)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,394.704 2640.76,394.704 "></polyline>
<polyline clip-path="url(#clip802)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,144.865 2640.76,144.865 "></polyline>
<polyline clip-path="url(#clip800)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1800.78 2640.76,1800.78 "></polyline>
<polyline clip-path="url(#clip800)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="263.676,1800.78 263.676,1781.88 "></polyline>
<polyline clip-path="url(#clip800)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="840.654,1800.78 840.654,1781.88 "></polyline>
<polyline clip-path="url(#clip800)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1417.63,1800.78 1417.63,1781.88 "></polyline>
<polyline clip-path="url(#clip800)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1994.61,1800.78 1994.61,1781.88 "></polyline>
<polyline clip-path="url(#clip800)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="2571.59,1800.78 2571.59,1781.88 "></polyline>
<path clip-path="url(#clip800)" d="M263.676 1834 Q260.065 1834 258.236 1837.57 Q256.431 1841.11 256.431 1848.24 Q256.431 1855.34 258.236 1858.91 Q260.065 1862.45 263.676 1862.45 Q267.31 1862.45 269.116 1858.91 Q270.945 1855.34 270.945 1848.24 Q270.945 1841.11 269.116 1837.57 Q267.31 1834 263.676 1834 M263.676 1830.3 Q269.486 1830.3 272.542 1834.9 Q275.621 1839.49 275.621 1848.24 Q275.621 1856.96 272.542 1861.57 Q269.486 1866.15 263.676 1866.15 Q257.866 1866.15 254.787 1861.57 Q251.732 1856.96 251.732 1848.24 Q251.732 1839.49 254.787 1834.9 Q257.866 1830.3 263.676 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip800)" d="M804.346 1861.55 L820.666 1861.55 L820.666 1865.48 L798.721 1865.48 L798.721 1861.55 Q801.383 1858.79 805.967 1854.16 Q810.573 1849.51 811.754 1848.17 Q813.999 1845.65 814.879 1843.91 Q815.782 1842.15 815.782 1840.46 Q815.782 1837.71 813.837 1835.97 Q811.916 1834.23 808.814 1834.23 Q806.615 1834.23 804.161 1835 Q801.731 1835.76 798.953 1837.31 L798.953 1832.59 Q801.777 1831.46 804.231 1830.88 Q806.684 1830.3 808.721 1830.3 Q814.092 1830.3 817.286 1832.98 Q820.481 1835.67 820.481 1840.16 Q820.481 1842.29 819.67 1844.21 Q818.883 1846.11 816.777 1848.7 Q816.198 1849.37 813.096 1852.59 Q809.995 1855.78 804.346 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip800)" d="M830.527 1830.92 L848.883 1830.92 L848.883 1834.86 L834.809 1834.86 L834.809 1843.33 Q835.828 1842.98 836.846 1842.82 Q837.865 1842.64 838.883 1842.64 Q844.67 1842.64 848.05 1845.81 Q851.43 1848.98 851.43 1854.4 Q851.43 1859.97 847.957 1863.08 Q844.485 1866.15 838.166 1866.15 Q835.99 1866.15 833.721 1865.78 Q831.476 1865.41 829.069 1864.67 L829.069 1859.97 Q831.152 1861.11 833.374 1861.66 Q835.596 1862.22 838.073 1862.22 Q842.078 1862.22 844.416 1860.11 Q846.754 1858.01 846.754 1854.4 Q846.754 1850.78 844.416 1848.68 Q842.078 1846.57 838.073 1846.57 Q836.198 1846.57 834.323 1846.99 Q832.471 1847.4 830.527 1848.28 L830.527 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip800)" d="M870.642 1834 Q867.031 1834 865.203 1837.57 Q863.397 1841.11 863.397 1848.24 Q863.397 1855.34 865.203 1858.91 Q867.031 1862.45 870.642 1862.45 Q874.277 1862.45 876.082 1858.91 Q877.911 1855.34 877.911 1848.24 Q877.911 1841.11 876.082 1837.57 Q874.277 1834 870.642 1834 M870.642 1830.3 Q876.453 1830.3 879.508 1834.9 Q882.587 1839.49 882.587 1848.24 Q882.587 1856.96 879.508 1861.57 Q876.453 1866.15 870.642 1866.15 Q864.832 1866.15 861.754 1861.57 Q858.698 1856.96 858.698 1848.24 Q858.698 1839.49 861.754 1834.9 Q864.832 1830.3 870.642 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip800)" d="M1377.25 1830.92 L1395.61 1830.92 L1395.61 1834.86 L1381.53 1834.86 L1381.53 1843.33 Q1382.55 1842.98 1383.57 1842.82 Q1384.59 1842.64 1385.61 1842.64 Q1391.39 1842.64 1394.77 1845.81 Q1398.15 1848.98 1398.15 1854.4 Q1398.15 1859.97 1394.68 1863.08 Q1391.21 1866.15 1384.89 1866.15 Q1382.71 1866.15 1380.44 1865.78 Q1378.2 1865.41 1375.79 1864.67 L1375.79 1859.97 Q1377.88 1861.11 1380.1 1861.66 Q1382.32 1862.22 1384.8 1862.22 Q1388.8 1862.22 1391.14 1860.11 Q1393.48 1858.01 1393.48 1854.4 Q1393.48 1850.78 1391.14 1848.68 Q1388.8 1846.57 1384.8 1846.57 Q1382.92 1846.57 1381.05 1846.99 Q1379.19 1847.4 1377.25 1848.28 L1377.25 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip800)" d="M1417.37 1834 Q1413.75 1834 1411.93 1837.57 Q1410.12 1841.11 1410.12 1848.24 Q1410.12 1855.34 1411.93 1858.91 Q1413.75 1862.45 1417.37 1862.45 Q1421 1862.45 1422.81 1858.91 Q1424.63 1855.34 1424.63 1848.24 Q1424.63 1841.11 1422.81 1837.57 Q1421 1834 1417.37 1834 M1417.37 1830.3 Q1423.18 1830.3 1426.23 1834.9 Q1429.31 1839.49 1429.31 1848.24 Q1429.31 1856.96 1426.23 1861.57 Q1423.18 1866.15 1417.37 1866.15 Q1411.56 1866.15 1408.48 1861.57 Q1405.42 1856.96 1405.42 1848.24 Q1405.42 1839.49 1408.48 1834.9 Q1411.56 1830.3 1417.37 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip800)" d="M1447.53 1834 Q1443.92 1834 1442.09 1837.57 Q1440.28 1841.11 1440.28 1848.24 Q1440.28 1855.34 1442.09 1858.91 Q1443.92 1862.45 1447.53 1862.45 Q1451.16 1862.45 1452.97 1858.91 Q1454.8 1855.34 1454.8 1848.24 Q1454.8 1841.11 1452.97 1837.57 Q1451.16 1834 1447.53 1834 M1447.53 1830.3 Q1453.34 1830.3 1456.39 1834.9 Q1459.47 1839.49 1459.47 1848.24 Q1459.47 1856.96 1456.39 1861.57 Q1453.34 1866.15 1447.53 1866.15 Q1441.72 1866.15 1438.64 1861.57 Q1435.58 1856.96 1435.58 1848.24 Q1435.58 1839.49 1438.64 1834.9 Q1441.72 1830.3 1447.53 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip800)" d="M1952.89 1830.92 L1975.11 1830.92 L1975.11 1832.91 L1962.56 1865.48 L1957.68 1865.48 L1969.48 1834.86 L1952.89 1834.86 L1952.89 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip800)" d="M1984.27 1830.92 L2002.63 1830.92 L2002.63 1834.86 L1988.56 1834.86 L1988.56 1843.33 Q1989.58 1842.98 1990.59 1842.82 Q1991.61 1842.64 1992.63 1842.64 Q1998.42 1842.64 2001.8 1845.81 Q2005.18 1848.98 2005.18 1854.4 Q2005.18 1859.97 2001.7 1863.08 Q1998.23 1866.15 1991.91 1866.15 Q1989.74 1866.15 1987.47 1865.78 Q1985.22 1865.41 1982.82 1864.67 L1982.82 1859.97 Q1984.9 1861.11 1987.12 1861.66 Q1989.34 1862.22 1991.82 1862.22 Q1995.83 1862.22 1998.16 1860.11 Q2000.5 1858.01 2000.5 1854.4 Q2000.5 1850.78 1998.16 1848.68 Q1995.83 1846.57 1991.82 1846.57 Q1989.95 1846.57 1988.07 1846.99 Q1986.22 1847.4 1984.27 1848.28 L1984.27 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip800)" d="M2024.39 1834 Q2020.78 1834 2018.95 1837.57 Q2017.14 1841.11 2017.14 1848.24 Q2017.14 1855.34 2018.95 1858.91 Q2020.78 1862.45 2024.39 1862.45 Q2028.02 1862.45 2029.83 1858.91 Q2031.66 1855.34 2031.66 1848.24 Q2031.66 1841.11 2029.83 1837.57 Q2028.02 1834 2024.39 1834 M2024.39 1830.3 Q2030.2 1830.3 2033.26 1834.9 Q2036.33 1839.49 2036.33 1848.24 Q2036.33 1856.96 2033.26 1861.57 Q2030.2 1866.15 2024.39 1866.15 Q2018.58 1866.15 2015.5 1861.57 Q2012.45 1856.96 2012.45 1848.24 Q2012.45 1839.49 2015.5 1834.9 Q2018.58 1830.3 2024.39 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip800)" d="M2516.11 1861.55 L2523.75 1861.55 L2523.75 1835.18 L2515.44 1836.85 L2515.44 1832.59 L2523.71 1830.92 L2528.38 1830.92 L2528.38 1861.55 L2536.02 1861.55 L2536.02 1865.48 L2516.11 1865.48 L2516.11 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip800)" d="M2555.47 1834 Q2551.85 1834 2550.03 1837.57 Q2548.22 1841.11 2548.22 1848.24 Q2548.22 1855.34 2550.03 1858.91 Q2551.85 1862.45 2555.47 1862.45 Q2559.1 1862.45 2560.9 1858.91 Q2562.73 1855.34 2562.73 1848.24 Q2562.73 1841.11 2560.9 1837.57 Q2559.1 1834 2555.47 1834 M2555.47 1830.3 Q2561.28 1830.3 2564.33 1834.9 Q2567.41 1839.49 2567.41 1848.24 Q2567.41 1856.96 2564.33 1861.57 Q2561.28 1866.15 2555.47 1866.15 Q2549.66 1866.15 2546.58 1861.57 Q2543.52 1856.96 2543.52 1848.24 Q2543.52 1839.49 2546.58 1834.9 Q2549.66 1830.3 2555.47 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip800)" d="M2585.63 1834 Q2582.02 1834 2580.19 1837.57 Q2578.38 1841.11 2578.38 1848.24 Q2578.38 1855.34 2580.19 1858.91 Q2582.02 1862.45 2585.63 1862.45 Q2589.26 1862.45 2591.07 1858.91 Q2592.9 1855.34 2592.9 1848.24 Q2592.9 1841.11 2591.07 1837.57 Q2589.26 1834 2585.63 1834 M2585.63 1830.3 Q2591.44 1830.3 2594.49 1834.9 Q2597.57 1839.49 2597.57 1848.24 Q2597.57 1856.96 2594.49 1861.57 Q2591.44 1866.15 2585.63 1866.15 Q2579.82 1866.15 2576.74 1861.57 Q2573.68 1856.96 2573.68 1848.24 Q2573.68 1839.49 2576.74 1834.9 Q2579.82 1830.3 2585.63 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip800)" d="M2615.79 1834 Q2612.18 1834 2610.35 1837.57 Q2608.54 1841.11 2608.54 1848.24 Q2608.54 1855.34 2610.35 1858.91 Q2612.18 1862.45 2615.79 1862.45 Q2619.42 1862.45 2621.23 1858.91 Q2623.06 1855.34 2623.06 1848.24 Q2623.06 1841.11 2621.23 1837.57 Q2619.42 1834 2615.79 1834 M2615.79 1830.3 Q2621.6 1830.3 2624.65 1834.9 Q2627.73 1839.49 2627.73 1848.24 Q2627.73 1856.96 2624.65 1861.57 Q2621.6 1866.15 2615.79 1866.15 Q2609.98 1866.15 2606.9 1861.57 Q2603.84 1856.96 2603.84 1848.24 Q2603.84 1839.49 2606.9 1834.9 Q2609.98 1830.3 2615.79 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip800)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1800.78 196.816,47.2441 "></polyline>
<polyline clip-path="url(#clip800)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1643.9 215.714,1643.9 "></polyline>
<polyline clip-path="url(#clip800)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1394.06 215.714,1394.06 "></polyline>
<polyline clip-path="url(#clip800)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1144.22 215.714,1144.22 "></polyline>
<polyline clip-path="url(#clip800)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,894.382 215.714,894.382 "></polyline>
<polyline clip-path="url(#clip800)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,644.543 215.714,644.543 "></polyline>
<polyline clip-path="url(#clip800)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,394.704 215.714,394.704 "></polyline>
<polyline clip-path="url(#clip800)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,144.865 215.714,144.865 "></polyline>
<path clip-path="url(#clip800)" d="M50.5475 1644.35 L80.2233 1644.35 L80.2233 1648.28 L50.5475 1648.28 L50.5475 1644.35 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip800)" d="M89.1352 1626.62 L111.357 1626.62 L111.357 1628.61 L98.8111 1661.18 L93.9269 1661.18 L105.732 1630.55 L89.1352 1630.55 L89.1352 1626.62 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip800)" d="M120.478 1655.3 L125.362 1655.3 L125.362 1661.18 L120.478 1661.18 L120.478 1655.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip800)" d="M135.593 1626.62 L153.95 1626.62 L153.95 1630.55 L139.876 1630.55 L139.876 1639.03 Q140.894 1638.68 141.913 1638.52 Q142.931 1638.33 143.95 1638.33 Q149.737 1638.33 153.116 1641.5 Q156.496 1644.67 156.496 1650.09 Q156.496 1655.67 153.024 1658.77 Q149.552 1661.85 143.232 1661.85 Q141.056 1661.85 138.788 1661.48 Q136.542 1661.11 134.135 1660.37 L134.135 1655.67 Q136.218 1656.8 138.441 1657.36 Q140.663 1657.91 143.14 1657.91 Q147.144 1657.91 149.482 1655.81 Q151.82 1653.7 151.82 1650.09 Q151.82 1646.48 149.482 1644.37 Q147.144 1642.27 143.14 1642.27 Q141.265 1642.27 139.39 1642.68 Q137.538 1643.1 135.593 1643.98 L135.593 1626.62 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip800)" d="M49.5521 1394.51 L79.2279 1394.51 L79.2279 1398.45 L49.5521 1398.45 L49.5521 1394.51 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip800)" d="M89.3667 1376.78 L107.723 1376.78 L107.723 1380.71 L93.6491 1380.71 L93.6491 1389.19 Q94.6676 1388.84 95.6861 1388.68 Q96.7047 1388.49 97.7232 1388.49 Q103.51 1388.49 106.89 1391.66 Q110.269 1394.83 110.269 1400.25 Q110.269 1405.83 106.797 1408.93 Q103.325 1412.01 97.0056 1412.01 Q94.8297 1412.01 92.5612 1411.64 Q90.3158 1411.27 87.9084 1410.53 L87.9084 1405.83 Q89.9917 1406.96 92.2139 1407.52 Q94.4361 1408.08 96.913 1408.08 Q100.918 1408.08 103.256 1405.97 Q105.593 1403.86 105.593 1400.25 Q105.593 1396.64 103.256 1394.53 Q100.918 1392.43 96.913 1392.43 Q95.038 1392.43 93.163 1392.84 Q91.3112 1393.26 89.3667 1394.14 L89.3667 1376.78 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip800)" d="M119.482 1405.46 L124.367 1405.46 L124.367 1411.34 L119.482 1411.34 L119.482 1405.46 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip800)" d="M144.552 1379.86 Q140.941 1379.86 139.112 1383.42 Q137.306 1386.96 137.306 1394.09 Q137.306 1401.2 139.112 1404.77 Q140.941 1408.31 144.552 1408.31 Q148.186 1408.31 149.991 1404.77 Q151.82 1401.2 151.82 1394.09 Q151.82 1386.96 149.991 1383.42 Q148.186 1379.86 144.552 1379.86 M144.552 1376.15 Q150.362 1376.15 153.417 1380.76 Q156.496 1385.34 156.496 1394.09 Q156.496 1402.82 153.417 1407.43 Q150.362 1412.01 144.552 1412.01 Q138.741 1412.01 135.663 1407.43 Q132.607 1402.82 132.607 1394.09 Q132.607 1385.34 135.663 1380.76 Q138.741 1376.15 144.552 1376.15 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip800)" d="M50.5475 1144.67 L80.2233 1144.67 L80.2233 1148.61 L50.5475 1148.61 L50.5475 1144.67 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip800)" d="M94.3436 1157.57 L110.663 1157.57 L110.663 1161.5 L88.7186 1161.5 L88.7186 1157.57 Q91.3806 1154.81 95.9639 1150.18 Q100.57 1145.53 101.751 1144.19 Q103.996 1141.66 104.876 1139.93 Q105.779 1138.17 105.779 1136.48 Q105.779 1133.72 103.834 1131.99 Q101.913 1130.25 98.8111 1130.25 Q96.6121 1130.25 94.1584 1131.01 Q91.7278 1131.78 88.9501 1133.33 L88.9501 1128.61 Q91.7741 1127.47 94.2278 1126.89 Q96.6815 1126.32 98.7185 1126.32 Q104.089 1126.32 107.283 1129 Q110.478 1131.69 110.478 1136.18 Q110.478 1138.31 109.668 1140.23 Q108.881 1142.13 106.774 1144.72 Q106.195 1145.39 103.094 1148.61 Q99.9917 1151.8 94.3436 1157.57 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip800)" d="M120.478 1155.62 L125.362 1155.62 L125.362 1161.5 L120.478 1161.5 L120.478 1155.62 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip800)" d="M135.593 1126.94 L153.95 1126.94 L153.95 1130.88 L139.876 1130.88 L139.876 1139.35 Q140.894 1139 141.913 1138.84 Q142.931 1138.65 143.95 1138.65 Q149.737 1138.65 153.116 1141.82 Q156.496 1145 156.496 1150.41 Q156.496 1155.99 153.024 1159.09 Q149.552 1162.17 143.232 1162.17 Q141.056 1162.17 138.788 1161.8 Q136.542 1161.43 134.135 1160.69 L134.135 1155.99 Q136.218 1157.13 138.441 1157.68 Q140.663 1158.24 143.14 1158.24 Q147.144 1158.24 149.482 1156.13 Q151.82 1154.02 151.82 1150.41 Q151.82 1146.8 149.482 1144.69 Q147.144 1142.59 143.14 1142.59 Q141.265 1142.59 139.39 1143.01 Q137.538 1143.42 135.593 1144.3 L135.593 1126.94 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip800)" d="M99.3204 880.18 Q95.7093 880.18 93.8806 883.745 Q92.075 887.287 92.075 894.416 Q92.075 901.523 93.8806 905.088 Q95.7093 908.629 99.3204 908.629 Q102.955 908.629 104.76 905.088 Q106.589 901.523 106.589 894.416 Q106.589 887.287 104.76 883.745 Q102.955 880.18 99.3204 880.18 M99.3204 876.477 Q105.131 876.477 108.186 881.083 Q111.265 885.666 111.265 894.416 Q111.265 903.143 108.186 907.75 Q105.131 912.333 99.3204 912.333 Q93.5102 912.333 90.4315 907.75 Q87.376 903.143 87.376 894.416 Q87.376 885.666 90.4315 881.083 Q93.5102 876.477 99.3204 876.477 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip800)" d="M119.482 905.782 L124.367 905.782 L124.367 911.662 L119.482 911.662 L119.482 905.782 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip800)" d="M144.552 880.18 Q140.941 880.18 139.112 883.745 Q137.306 887.287 137.306 894.416 Q137.306 901.523 139.112 905.088 Q140.941 908.629 144.552 908.629 Q148.186 908.629 149.991 905.088 Q151.82 901.523 151.82 894.416 Q151.82 887.287 149.991 883.745 Q148.186 880.18 144.552 880.18 M144.552 876.477 Q150.362 876.477 153.417 881.083 Q156.496 885.666 156.496 894.416 Q156.496 903.143 153.417 907.75 Q150.362 912.333 144.552 912.333 Q138.741 912.333 135.663 907.75 Q132.607 903.143 132.607 894.416 Q132.607 885.666 135.663 881.083 Q138.741 876.477 144.552 876.477 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip800)" d="M94.3436 657.888 L110.663 657.888 L110.663 661.823 L88.7186 661.823 L88.7186 657.888 Q91.3806 655.133 95.9639 650.503 Q100.57 645.851 101.751 644.508 Q103.996 641.985 104.876 640.249 Q105.779 638.49 105.779 636.8 Q105.779 634.045 103.834 632.309 Q101.913 630.573 98.8111 630.573 Q96.6121 630.573 94.1584 631.337 Q91.7278 632.101 88.9501 633.652 L88.9501 628.929 Q91.7741 627.795 94.2278 627.217 Q96.6815 626.638 98.7185 626.638 Q104.089 626.638 107.283 629.323 Q110.478 632.008 110.478 636.499 Q110.478 638.628 109.668 640.55 Q108.881 642.448 106.774 645.04 Q106.195 645.712 103.094 648.929 Q99.9917 652.124 94.3436 657.888 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip800)" d="M120.478 655.943 L125.362 655.943 L125.362 661.823 L120.478 661.823 L120.478 655.943 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip800)" d="M135.593 627.263 L153.95 627.263 L153.95 631.198 L139.876 631.198 L139.876 639.67 Q140.894 639.323 141.913 639.161 Q142.931 638.976 143.95 638.976 Q149.737 638.976 153.116 642.147 Q156.496 645.318 156.496 650.735 Q156.496 656.314 153.024 659.415 Q149.552 662.494 143.232 662.494 Q141.056 662.494 138.788 662.124 Q136.542 661.753 134.135 661.013 L134.135 656.314 Q136.218 657.448 138.441 658.003 Q140.663 658.559 143.14 658.559 Q147.144 658.559 149.482 656.452 Q151.82 654.346 151.82 650.735 Q151.82 647.124 149.482 645.017 Q147.144 642.911 143.14 642.911 Q141.265 642.911 139.39 643.328 Q137.538 643.744 135.593 644.624 L135.593 627.263 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip800)" d="M89.3667 377.424 L107.723 377.424 L107.723 381.359 L93.6491 381.359 L93.6491 389.831 Q94.6676 389.484 95.6861 389.322 Q96.7047 389.137 97.7232 389.137 Q103.51 389.137 106.89 392.308 Q110.269 395.48 110.269 400.896 Q110.269 406.475 106.797 409.577 Q103.325 412.655 97.0056 412.655 Q94.8297 412.655 92.5612 412.285 Q90.3158 411.915 87.9084 411.174 L87.9084 406.475 Q89.9917 407.609 92.2139 408.165 Q94.4361 408.72 96.913 408.72 Q100.918 408.72 103.256 406.614 Q105.593 404.507 105.593 400.896 Q105.593 397.285 103.256 395.179 Q100.918 393.072 96.913 393.072 Q95.038 393.072 93.163 393.489 Q91.3112 393.905 89.3667 394.785 L89.3667 377.424 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip800)" d="M119.482 406.104 L124.367 406.104 L124.367 411.984 L119.482 411.984 L119.482 406.104 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip800)" d="M144.552 380.503 Q140.941 380.503 139.112 384.068 Q137.306 387.609 137.306 394.739 Q137.306 401.845 139.112 405.41 Q140.941 408.952 144.552 408.952 Q148.186 408.952 149.991 405.41 Q151.82 401.845 151.82 394.739 Q151.82 387.609 149.991 384.068 Q148.186 380.503 144.552 380.503 M144.552 376.799 Q150.362 376.799 153.417 381.406 Q156.496 385.989 156.496 394.739 Q156.496 403.466 153.417 408.072 Q150.362 412.655 144.552 412.655 Q138.741 412.655 135.663 408.072 Q132.607 403.466 132.607 394.739 Q132.607 385.989 135.663 381.406 Q138.741 376.799 144.552 376.799 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip800)" d="M89.1352 127.585 L111.357 127.585 L111.357 129.576 L98.8111 162.145 L93.9269 162.145 L105.732 131.52 L89.1352 131.52 L89.1352 127.585 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip800)" d="M120.478 156.266 L125.362 156.266 L125.362 162.145 L120.478 162.145 L120.478 156.266 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip800)" d="M135.593 127.585 L153.95 127.585 L153.95 131.52 L139.876 131.52 L139.876 139.993 Q140.894 139.645 141.913 139.483 Q142.931 139.298 143.95 139.298 Q149.737 139.298 153.116 142.469 Q156.496 145.641 156.496 151.057 Q156.496 156.636 153.024 159.738 Q149.552 162.817 143.232 162.817 Q141.056 162.817 138.788 162.446 Q136.542 162.076 134.135 161.335 L134.135 156.636 Q136.218 157.77 138.441 158.326 Q140.663 158.881 143.14 158.881 Q147.144 158.881 149.482 156.775 Q151.82 154.668 151.82 151.057 Q151.82 147.446 149.482 145.34 Q147.144 143.233 143.14 143.233 Q141.265 143.233 139.39 143.65 Q137.538 144.067 135.593 144.946 L135.593 127.585 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip802)" style="stroke:#009af9; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="265.984,930.499 268.292,1347.63 270.6,1591.16 272.908,1395.69 275.216,1216.21 277.524,1375.6 279.832,1429.1 282.139,1402.42 284.447,1538.16 286.755,1352.2 289.063,1313.79 291.371,1339.29 293.679,1489 295.987,1504.02 298.295,1193.62 300.603,1479.27 302.911,1568.88 305.219,1550.74 307.527,1526.32 309.834,1312.26 312.142,1365.06 314.45,1458.44 316.758,1364.19 319.066,1383.55 321.374,1580.77 323.682,1174.78 325.99,1410.96 328.298,1319.47 330.606,1417.93 332.914,1242.94 335.221,1253.53 337.529,1217.99 339.837,1292.77 342.145,1331.72 344.453,1451.83 346.761,1286.81 349.069,1484.86 351.377,1309.95 353.685,1262.94 355.993,1347.79 358.301,1327.73 360.608,1111.46 362.916,1140.3 365.224,1475.17 367.532,1380.67 369.84,1404.29 372.148,1483.83 374.456,1277.17 376.764,1390.99 379.072,1580.47 381.38,1204.02 383.688,1563.38 385.996,1416.07 388.303,1543.02 390.611,1339.78 392.919,1275.31 395.227,1412.8 397.535,1470.69 399.843,1366.21 402.151,1426.37 404.459,1415.5 406.767,1370.77 409.075,1354 411.383,1378.4 413.69,1318.56 415.998,1445.63 418.306,1358.36 420.614,1319.3 422.922,1415.65 425.23,1489.6 427.538,1397.29 429.846,1265.35 432.154,1512.4 434.462,1291.57 436.77,1321.3 439.077,1279.38 441.385,1304.06 443.693,1413.5 446.001,1317.72 448.309,1461.58 450.617,1168.1 452.925,1453.06 455.233,1390.69 457.541,1504.59 459.849,1255.4 462.157,1315.99 464.465,1425 466.772,1333.09 469.08,1323.21 471.388,1377.46 473.696,1339.59 476.004,1492.01 478.312,1283.32 480.62,1487.26 482.928,1248.23 485.236,1526.25 487.544,1119.33 489.852,1348.05 492.159,1570.29 494.467,1310.8 496.775,1249.7 499.083,1433.38 501.391,1431.46 503.699,1428.13 506.007,1442.91 508.315,1369.59 510.623,1410.55 512.931,1238.77 515.239,1523.16 517.546,1445.52 519.854,1401.19 522.162,1427.81 524.47,1303.53 526.778,1442.83 529.086,1459.42 531.394,1515.3 533.702,1465.83 536.01,1247.89 538.318,1437.55 540.626,1445.29 542.933,1404.34 545.241,1411.2 547.549,1312.85 549.857,1307.6 552.165,1425.57 554.473,1355.7 556.781,1344.64 559.089,1404.87 561.397,1349.73 563.705,1477.48 566.013,1350.59 568.321,1344.61 570.628,1379.75 572.936,1378.64 575.244,1508.51 577.552,1392.52 579.86,1362.5 582.168,1476.1 584.476,1366.64 586.784,1439.69 589.092,1281.38 591.4,1190.27 593.708,1415.97 596.015,1414.89 598.323,1383.15 600.631,1544.15 602.939,1431.75 605.247,1460.69 607.555,1464.44 609.863,1443.58 612.171,1416.31 614.479,1457.45 616.787,1372.67 619.095,1459.65 621.402,1259.68 623.71,1429.94 626.018,1461.81 628.326,1467.61 630.634,1356.43 632.942,1203.41 635.25,1098.54 637.558,1442.92 639.866,1422.37 642.174,1195.53 644.482,1370.11 646.79,1367.27 649.097,1112.63 651.405,1485.93 653.713,1300.65 656.021,1368.52 658.329,1038.53 660.637,1294.03 662.945,1451.66 665.253,1474.35 667.561,1431.86 669.869,1404.75 672.177,1491.01 674.484,1368.36 676.792,1278.23 679.1,1370.84 681.408,1483 683.716,1314.91 686.024,1434 688.332,1292.93 690.64,1628.87 692.948,1501.01 695.256,1263.59 697.564,1385.38 699.871,1469.25 702.179,1405.88 704.487,1443.05 706.795,1360.68 709.103,1751.15 711.411,1531.16 713.719,1444.14 716.027,1331.48 718.335,1364.03 720.643,1409.97 722.951,1326.37 725.259,1257.84 727.566,1312.98 729.874,1274.71 732.182,1410.56 734.49,1467.99 736.798,1429.42 739.106,1383.25 741.414,1379.54 743.722,1343.61 746.03,1173.29 748.338,1306.38 750.646,1475.66 752.953,1393.73 755.261,1321.59 757.569,1426.45 759.877,1364.05 762.185,1314.83 764.493,1339.46 766.801,1497.94 769.109,1429.28 771.417,1445.15 773.725,1392.33 776.033,1291.21 778.34,1477.14 780.648,1194.6 782.956,1285.12 785.264,1440.07 787.572,1216.39 789.88,1420.24 792.188,1417.49 794.496,1387.73 796.804,1523.62 799.112,1345.42 801.42,1535.51 803.728,1339.16 806.035,1549.51 808.343,1358.16 810.651,1503.8 812.959,1439.93 815.267,1204.84 817.575,1325.52 819.883,1316.43 822.191,1286.06 824.499,1497.57 826.807,1393.07 829.115,1255.46 831.422,1444.61 833.73,1396.25 836.038,1422.88 838.346,1328.17 840.654,1446.75 842.962,1515.33 845.27,1347.6 847.578,1540.03 849.886,1347 852.194,1379.3 854.502,1439.37 856.809,1314.44 859.117,1569.39 861.425,1631.91 863.733,1335.94 866.041,1327.47 868.349,1448.92 870.657,1381.53 872.965,1548 875.273,1381.93 877.581,1350.89 879.889,1421.11 882.197,1400.34 884.504,1329.69 886.812,1340.09 889.12,1472.81 891.428,1401.91 893.736,1481.67 896.044,1533.89 898.352,1355.29 900.66,1394.98 902.968,1482.84 905.276,1512.75 907.584,1297.27 909.891,1543.17 912.199,1338.3 914.507,1436.31 916.815,1317.61 919.123,1516.46 921.431,1428.76 923.739,1483.2 926.047,1340.76 928.355,1358.13 930.663,1354.71 932.971,1288.83 935.278,1402.39 937.586,1385.9 939.894,1376.39 942.202,1244.44 944.51,1429.67 946.818,1354.41 949.126,1388 951.434,1309.83 953.742,1437.85 956.05,1448.51 958.358,1244.82 960.665,1330.57 962.973,1432.42 965.281,1422.83 967.589,1426.04 969.897,1449.79 972.205,1352.67 974.513,1486.66 976.821,1501.43 979.129,1488.44 981.437,1534.1 983.745,1488.4 986.053,1469.04 988.36,1392.83 990.668,1403.94 992.976,1450.54 995.284,1284.55 997.592,1299.41 999.9,1390.72 1002.21,1337.15 1004.52,1249.42 1006.82,1336.54 1009.13,1339.98 1011.44,1447.88 1013.75,1432.97 1016.06,1292.75 1018.36,1214.84 1020.67,1449.45 1022.98,1406.33 1025.29,1423.98 1027.59,1378.43 1029.9,1272.13 1032.21,1392.29 1034.52,1510.35 1036.83,1244.48 1039.13,1356.64 1041.44,1258.53 1043.75,1418.18 1046.06,1362.6 1048.37,1410.59 1050.67,1380.53 1052.98,1501.8 1055.29,1453.08 1057.6,1279.04 1059.91,1355.03 1062.21,1326.89 1064.52,1213.27 1066.83,1160.11 1069.14,1520.13 1071.45,1363.9 1073.75,1318.15 1076.06,1226.05 1078.37,1334.2 1080.68,1476.84 1082.98,1385.05 1085.29,1453.74 1087.6,1398.24 1089.91,1303.42 1092.22,1294.77 1094.52,1541.04 1096.83,1492.04 1099.14,1529.69 1101.45,1223.46 1103.76,1297.93 1106.06,1252.58 1108.37,1392.83 1110.68,1308.59 1112.99,1492.29 1115.3,1282.82 1117.6,1333.16 1119.91,1331.2 1122.22,1318.79 1124.53,1334.01 1126.84,1495.84 1129.14,1204.5 1131.45,1378.9 1133.76,1332.46 1136.07,1422.59 1138.37,1365.24 1140.68,1387.65 1142.99,1330.1 1145.3,1500.74 1147.61,1377.63 1149.91,1384.79 1152.22,1510.15 1154.53,1472.04 1156.84,1172.43 1159.15,1405.39 1161.45,1328.6 1163.76,1316.94 1166.07,1433.44 1168.38,1337.77 1170.69,1273.53 1172.99,1360.36 1175.3,1538.62 1177.61,1319.96 1179.92,1469.3 1182.23,1428.73 1184.53,1598.46 1186.84,1588.77 1189.15,1333.22 1191.46,1498.92 1193.76,1380.56 1196.07,1399.86 1198.38,1362.64 1200.69,1351.71 1203,1186.89 1205.3,1337.5 1207.61,1285.82 1209.92,1469.08 1212.23,1413.39 1214.54,1593.3 1216.84,1289.47 1219.15,1369.04 1221.46,1460.58 1223.77,1386.47 1226.08,1383.4 1228.38,1300.92 1230.69,1162.8 1233,1391.97 1235.31,1346.45 1237.61,1656.81 1239.92,1433.06 1242.23,1341.98 1244.54,1302.7 1246.85,1423.08 1249.15,1348.36 1251.46,1346.1 1253.77,1578.59 1256.08,1493.64 1258.39,1577.84 1260.69,1192.97 1263,1476.53 1265.31,1511.79 1267.62,1342.85 1269.93,1477.83 1272.23,1441.1 1274.54,1548.63 1276.85,1556.52 1279.16,1483.35 1281.47,1375.39 1283.77,1215.19 1286.08,1415.24 1288.39,1404.54 1290.7,1292.21 1293,1357.49 1295.31,1434.85 1297.62,1517.56 1299.93,1315.5 1302.24,1504.74 1304.54,1309.58 1306.85,1413.16 1309.16,1388.22 1311.47,1444.4 1313.78,1368.34 1316.08,1482.42 1318.39,1314.14 1320.7,1192.94 1323.01,1418.36 1325.32,1376.21 1327.62,1371.23 1329.93,1257.26 1332.24,1405.17 1334.55,1319.52 1336.86,1239.13 1339.16,1252.24 1341.47,1376.34 1343.78,1332.56 1346.09,1384.24 1348.39,1438.52 1350.7,1413.12 1353.01,1503 1355.32,1677.1 1357.63,1484.97 1359.93,1360.65 1362.24,1412.97 1364.55,1502.28 1366.86,1392.02 1369.17,1331.21 1371.47,1434.93 1373.78,1457.99 1376.09,1431.64 1378.4,1446.76 1380.71,1384.51 1383.01,1408.83 1385.32,1168.39 1387.63,1346.98 1389.94,1331.41 1392.24,1552.82 1394.55,1369.93 1396.86,1169.85 1399.17,1611.94 1401.48,1324.21 1403.78,1400.68 1406.09,1332.23 1408.4,1478.5 1410.71,1458.04 1413.02,1357.73 1415.32,1589.58 1417.63,1423.44 1419.94,1403.37 1422.25,1432.24 1424.56,1387.7 1426.86,1401.94 1429.17,1396.93 1431.48,1356.44 1433.79,1232.42 1436.1,1419.45 1438.4,1379.48 1440.71,1435.14 1443.02,1363.05 1445.33,1508 1447.63,1214.67 1449.94,1404.79 1452.25,1496.4 1454.56,1263.57 1456.87,1311.89 1459.17,1566.97 1461.48,1403.7 1463.79,1519.64 1466.1,1514.78 1468.41,1517.25 1470.71,1392.06 1473.02,1377.28 1475.33,1514.22 1477.64,1540.05 1479.95,1375.05 1482.25,1334.18 1484.56,1314.23 1486.87,1376.42 1489.18,1196.47 1491.49,1285.29 1493.79,1311.06 1496.1,1357.3 1498.41,1504.8 1500.72,1354.98 1503.02,1280.5 1505.33,1328.62 1507.64,1138.2 1509.95,1607.4 1512.26,1420.5 1514.56,1418.06 1516.87,1303.44 1519.18,1484.71 1521.49,1252.34 1523.8,1404.72 1526.1,1387.68 1528.41,1422.09 1530.72,1536.08 1533.03,1541.47 1535.34,1465.52 1537.64,1369.51 1539.95,1595.83 1542.26,1364.26 1544.57,1193.62 1546.88,1193.45 1549.18,1382.83 1551.49,1339.46 1553.8,1441.33 1556.11,1570.14 1558.41,1364.48 1560.72,1455 1563.03,1423.88 1565.34,1521.71 1567.65,1446.11 1569.95,1371.9 1572.26,1406.16 1574.57,1399.98 1576.88,1331.37 1579.19,1245.43 1581.49,1443.06 1583.8,1483.38 1586.11,1373.32 1588.42,1452.35 1590.73,1608.73 1593.03,1166.24 1595.34,1310.45 1597.65,1481.45 1599.96,1517.47 1602.26,1399.3 1604.57,1423.8 1606.88,1372.29 1609.19,1482.27 1611.5,1359.92 1613.8,1307.48 1616.11,1349.94 1618.42,1539.46 1620.73,1532.83 1623.04,1451.65 1625.34,1530.36 1627.65,1408 1629.96,1435.07 1632.27,1327.33 1634.58,1501.02 1636.88,1215.29 1639.19,1472.58 1641.5,1476.38 1643.81,1333.04 1646.12,1375.41 1648.42,1495.09 1650.73,1465.91 1653.04,1421.22 1655.35,1459.59 1657.65,1394.46 1659.96,1422.3 1662.27,1508.28 1664.58,1312.27 1666.89,1432.92 1669.19,1451.01 1671.5,1559.04 1673.81,1361.85 1676.12,1306.9 1678.43,1388.4 1680.73,1248 1683.04,1306.58 1685.35,1290.2 1687.66,1484.2 1689.97,1330.96 1692.27,1359.54 1694.58,1322.68 1696.89,1420.04 1699.2,1318.18 1701.51,1383.13 1703.81,1402.64 1706.12,1451.31 1708.43,1452.16 1710.74,1393.7 1713.04,1447.66 1715.35,1374.46 1717.66,1414.63 1719.97,1528.34 1722.28,1514.56 1724.58,1380.27 1726.89,1310.92 1729.2,1328.91 1731.51,1563.51 1733.82,1322.91 1736.12,1316.11 1738.43,1434.3 1740.74,1374.23 1743.05,1411.51 1745.36,1473.21 1747.66,1372.04 1749.97,1402 1752.28,1477.54 1754.59,1558.48 1756.9,1420.01 1759.2,1616.87 1761.51,1269.84 1763.82,1360.57 1766.13,1143.55 1768.43,1352.84 1770.74,1474.43 1773.05,1506.68 1775.36,1292.52 1777.67,1370.36 1779.97,1319.26 1782.28,1528.14 1784.59,1456.52 1786.9,1369.36 1789.21,1411.64 1791.51,1331.47 1793.82,1421.18 1796.13,1444.4 1798.44,1494.47 1800.75,1387 1803.05,1521.93 1805.36,1352.3 1807.67,1346.72 1809.98,1294.91 1812.28,1465.9 1814.59,1562.79 1816.9,1249.25 1819.21,1546.62 1821.52,1472.7 1823.82,1354.2 1826.13,1592.55 1828.44,1645.71 1830.75,1403.94 1833.06,1450.3 1835.36,1436.08 1837.67,1575.05 1839.98,1215.54 1842.29,1360.76 1844.6,1275.87 1846.9,1460.18 1849.21,1561.86 1851.52,1448.23 1853.83,1422.99 1856.14,1475.31 1858.44,1548.13 1860.75,1727.55 1863.06,1578.18 1865.37,1575.13 1867.67,1508.13 1869.98,1428.94 1872.29,1370.34 1874.6,1333.1 1876.91,1305.63 1879.21,1278.16 1881.52,1410.94 1883.83,1458.03 1886.14,1492.9 1888.45,1561.49 1890.75,1361.54 1893.06,1509.16 1895.37,1276.18 1897.68,1281.11 1899.99,1449.34 1902.29,1257.65 1904.6,1629.27 1906.91,1625.65 1909.22,1350.43 1911.53,1449.19 1913.83,1365.24 1916.14,1480.27 1918.45,1191.72 1920.76,1351.94 1923.06,1499.78 1925.37,1460.29 1927.68,1549.82 1929.99,1398.39 1932.3,1321.18 1934.6,1568.2 1936.91,1210.13 1939.22,1390.6 1941.53,1294.45 1943.84,1470.83 1946.14,1571.05 1948.45,1351.69 1950.76,1395.65 1953.07,1463.96 1955.38,1426.91 1957.68,1499.36 1959.99,1293.33 1962.3,1508.45 1964.61,1425.15 1966.91,1300.33 1969.22,1463.72 1971.53,1396.45 1973.84,1408.26 1976.15,1459.59 1978.45,1297.6 1980.76,1350.54 1983.07,1465.22 1985.38,1478.14 1987.69,1331.09 1989.99,1375.29 1992.3,1291.11 1994.61,1600.67 1996.92,1367.16 1999.23,1410.85 2001.53,1436.27 2003.84,1366.86 2006.15,1297.64 2008.46,1577.28 2010.77,1325.59 2013.07,1357.61 2015.38,1119.54 2017.69,1408.32 2020,1362.6 2022.3,1440.58 2024.61,1368.37 2026.92,1530.91 2029.23,1250.02 2031.54,1395.33 2033.84,1453 2036.15,1434.28 2038.46,1285.22 2040.77,1347.47 2043.08,1685.63 2045.38,1393.8 2047.69,1211.22 2050,1553.62 2052.31,1407.12 2054.62,1274.98 2056.92,1279.97 2059.23,1363.45 2061.54,1151.89 2063.85,1271.01 2066.16,1198.61 2068.46,1373.34 2070.77,1298.13 2073.08,1380.28 2075.39,1415.86 2077.69,1399.36 2080,1490.97 2082.31,1455.94 2084.62,1450.48 2086.93,1413.53 2089.23,1465.33 2091.54,1378.01 2093.85,1393 2096.16,1387.07 2098.47,1380.36 2100.77,1382.44 2103.08,1402.58 2105.39,1329.27 2107.7,1223.55 2110.01,1559.78 2112.31,1469.42 2114.62,1398.6 2116.93,1401.11 2119.24,1489.46 2121.55,1474.21 2123.85,1426.05 2126.16,1411.09 2128.47,1380.95 2130.78,1280.14 2133.08,1186.46 2135.39,1240.18 2137.7,1582.64 2140.01,1172.19 2142.32,1397.13 2144.62,1448.38 2146.93,1344.19 2149.24,1477.48 2151.55,1265.25 2153.86,1280.7 2156.16,1402.27 2158.47,1337.16 2160.78,1257.15 2163.09,1230.7 2165.4,1344.37 2167.7,1303.4 2170.01,1437.26 2172.32,1370.1 2174.63,1433.15 2176.93,1309.92 2179.24,1266.1 2181.55,1300.39 2183.86,1370.46 2186.17,1580.7 2188.47,1347.5 2190.78,1302.47 2193.09,1423.27 2195.4,1533.11 2197.71,1307.32 2200.01,1473.41 2202.32,1451.46 2204.63,1310.98 2206.94,1515.81 2209.25,1117.56 2211.55,1540.45 2213.86,1304.26 2216.17,1421.47 2218.48,1567.76 2220.79,1134.29 2223.09,1397.19 2225.4,1395.79 2227.71,1336.64 2230.02,1426.02 2232.32,1366.74 2234.63,1359.28 2236.94,1509.83 2239.25,1508.45 2241.56,1399.1 2243.86,1452.05 2246.17,1625 2248.48,1393.68 2250.79,1296.73 2253.1,1460.67 2255.4,1507.75 2257.71,1344.27 2260.02,1362.93 2262.33,1311.01 2264.64,1523.72 2266.94,1365.19 2269.25,1471.78 2271.56,1294.09 2273.87,1374.81 2276.18,1306.84 2278.48,1339.34 2280.79,1377.98 2283.1,1498.7 2285.41,1429.78 2287.71,1428.18 2290.02,1374.07 2292.33,1457.56 2294.64,1592.92 2296.95,1449.14 2299.25,1320.94 2301.56,1724.03 2303.87,1523.38 2306.18,1340.05 2308.49,1373.72 2310.79,1349.81 2313.1,1366.58 2315.41,1351.99 2317.72,1349.72 2320.03,1171.53 2322.33,1475.27 2324.64,1674.29 2326.95,1356.6 2329.26,1458.18 2331.56,1601.55 2333.87,1447.67 2336.18,1490.91 2338.49,1385.84 2340.8,1284.14 2343.1,1504.81 2345.41,1277.02 2347.72,1196.77 2350.03,1359.98 2352.34,1266.38 2354.64,1314.6 2356.95,1455.15 2359.26,1464.02 2361.57,1433.51 2363.88,1531.21 2366.18,1492.04 2368.49,1506.08 2370.8,1558.6 2373.11,1672.27 2375.42,1312.02 2377.72,1420.62 2380.03,1436.86 2382.34,1377.22 2384.65,1444.89 2386.95,1413.49 2389.26,1235.16 2391.57,1155.19 2393.88,1177 2396.19,1414.5 2398.49,1375.28 2400.8,1301.82 2403.11,1286.67 2405.42,1405.15 2407.73,1491.42 2410.03,1401.22 2412.34,1436.54 2414.65,1272.75 2416.96,1376.75 2419.27,1381.47 2421.57,1493.55 2423.88,1463.05 2426.19,1581.55 2428.5,1604.83 2430.81,1496.02 2433.11,1444.35 2435.42,1388.02 2437.73,1306.74 2440.04,1452.76 2442.34,1314.62 2444.65,1493.07 2446.96,1320.56 2449.27,1314.53 2451.58,1309.23 2453.88,1466.67 2456.19,1389.97 2458.5,1491.57 2460.81,1392.46 2463.12,1424.55 2465.42,1293.02 2467.73,1378.82 2470.04,1487.28 2472.35,1257.18 2474.66,1450.3 2476.96,1439.72 2479.27,1346.28 2481.58,1299.55 2483.89,1359.84 2486.2,1535.98 2488.5,1464.75 2490.81,1370.8 2493.12,1375.6 2495.43,1371.26 2497.73,1254.87 2500.04,1532.06 2502.35,1333.36 2504.66,1435.37 2506.97,1315.93 2509.27,1575.88 2511.58,1394.92 2513.89,1213.88 2516.2,1375.02 2518.51,1193.26 2520.81,1467.56 2523.12,1597.54 2525.43,1557.12 2527.74,1271.9 2530.05,1423.46 2532.35,1449.95 2534.66,1262.38 2536.97,1367.34 2539.28,1408.2 2541.58,1100.34 2543.89,1265.74 2546.2,1400.66 2548.51,1415.08 2550.82,1380.34 2553.12,1217.24 2555.43,1373.45 2557.74,1233.17 2560.05,1275.11 2562.36,1270.94 2564.66,1330.11 2566.97,1431.47 2569.28,1370.63 2571.59,1420.15 "></polyline>
<polyline clip-path="url(#clip802)" style="stroke:#e26f46; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="265.984,874.926 268.292,837.054 270.6,1032.58 272.908,972.785 275.216,825.11 277.524,925.385 279.832,947.994 282.139,775.752 284.447,825.406 286.755,971.112 289.063,821.014 291.371,1044.54 293.679,1170.34 295.987,932.352 298.295,897.093 300.603,954.911 302.911,1079.65 305.219,843.793 307.527,829.258 309.834,905.937 312.142,905.858 314.45,888.874 316.758,876.827 319.066,748.267 321.374,982.088 323.682,837.285 325.99,966.529 328.298,952.668 330.606,963.71 332.914,905.635 335.221,918.159 337.529,944.351 339.837,966.661 342.145,876.25 344.453,845.257 346.761,841.621 349.069,921.24 351.377,828.24 353.685,1051.55 355.993,893.148 358.301,973.01 360.608,842.931 362.916,1048.47 365.224,973.897 367.532,858.417 369.84,1071.77 372.148,1007.39 374.456,782.148 376.764,921.923 379.072,785.907 381.38,931.95 383.688,987.964 385.996,863.766 388.303,789.162 390.611,846.222 392.919,841.076 395.227,867.376 397.535,1013.47 399.843,975.286 402.151,873.033 404.459,833.868 406.767,971.332 409.075,977.469 411.383,902.903 413.69,813.402 415.998,904.572 418.306,803.831 420.614,1104.15 422.922,977.241 425.23,884.739 427.538,943.281 429.846,667.473 432.154,875.278 434.462,728.229 436.77,928.089 439.077,915.749 441.385,1010.41 443.693,968.005 446.001,849.189 448.309,1016.11 450.617,827.661 452.925,929.825 455.233,1220.19 457.541,806.457 459.849,702.621 462.157,858.519 464.465,913.821 466.772,1087.02 469.08,859.684 471.388,891.179 473.696,751.63 476.004,861.123 478.312,923.934 480.62,678.908 482.928,884.578 485.236,873.192 487.544,794.643 489.852,991.802 492.159,936.347 494.467,899.3 496.775,960.944 499.083,1083.41 501.391,908.262 503.699,806.351 506.007,775.723 508.315,724.46 510.623,964.7 512.931,790.257 515.239,967.942 517.546,829.861 519.854,950.797 522.162,974.657 524.47,994.717 526.778,928.042 529.086,764.466 531.394,977.307 533.702,1130.92 536.01,846.809 538.318,789.634 540.626,949.594 542.933,821.525 545.241,991.897 547.549,953.632 549.857,934.399 552.165,1070.73 554.473,865.429 556.781,1092.2 559.089,975.481 561.397,772.423 563.705,736.833 566.013,863.105 568.321,862.791 570.628,931.8 572.936,1031.77 575.244,1014.05 577.552,779.604 579.86,1034.34 582.168,970.662 584.476,717.541 586.784,837.481 589.092,951.695 591.4,957.152 593.708,1082.23 596.015,951.956 598.323,794.661 600.631,1014.71 602.939,814.115 605.247,1042.32 607.555,963.938 609.863,1071.73 612.171,901.706 614.479,837.815 616.787,954.338 619.095,908.134 621.402,828.111 623.71,757.605 626.018,843.508 628.326,786.948 630.634,929.762 632.942,928.861 635.25,815.724 637.558,1060.28 639.866,869.406 642.174,790.361 644.482,862.31 646.79,929.711 649.097,807.701 651.405,931.125 653.713,980.992 656.021,863.599 658.329,817.889 660.637,912.442 662.945,949.247 665.253,844.95 667.561,855.412 669.869,1150.5 672.177,785.666 674.484,888.499 676.792,762.371 679.1,1101.35 681.408,1038.4 683.716,948.311 686.024,1006.67 688.332,929.279 690.64,933.721 692.948,822.286 695.256,878.582 697.564,912.397 699.871,955.966 702.179,756.496 704.487,1113.91 706.795,1041.52 709.103,736.212 711.411,1013.58 713.719,731.035 716.027,961.565 718.335,881.465 720.643,906.079 722.951,852.204 725.259,817.433 727.566,928.479 729.874,972.101 732.182,808.318 734.49,990.176 736.798,1165.75 739.106,1000.8 741.414,889.978 743.722,927.578 746.03,967.826 748.338,931.102 750.646,1002.65 752.953,986.985 755.261,628.656 757.569,892.352 759.877,901.89 762.185,883.554 764.493,749.046 766.801,1078.57 769.109,907.129 771.417,1004.23 773.725,1057.35 776.033,1003.76 778.34,1187.62 780.648,876.502 782.956,986.003 785.264,1008.37 787.572,906.833 789.88,865.82 792.188,1046.2 794.496,1008.98 796.804,960.397 799.112,914.991 801.42,811.272 803.728,870.011 806.035,870.594 808.343,785.208 810.651,890.865 812.959,777.267 815.267,927.396 817.575,939.414 819.883,763.95 822.191,942.197 824.499,868.747 826.807,866.437 829.115,976.974 831.422,817.723 833.73,873.771 836.038,781.78 838.346,1000.23 840.654,774.783 842.962,788.657 845.27,871.306 847.578,971.027 849.886,866.937 852.194,770.805 854.502,859.932 856.809,779.511 859.117,836.447 861.425,1065.87 863.733,895.622 866.041,1055.98 868.349,797.998 870.657,1008.08 872.965,840.354 875.273,1032.08 877.581,927.885 879.889,871.706 882.197,950.721 884.504,715.884 886.812,1019.58 889.12,965.419 891.428,899.727 893.736,1035.27 896.044,834.016 898.352,792.978 900.66,982.92 902.968,908.328 905.276,744.841 907.584,1024.29 909.891,838.736 912.199,933.459 914.507,924.793 916.815,922.777 919.123,714.185 921.431,1048.69 923.739,929.218 926.047,931.274 928.355,832.973 930.663,869.432 932.971,938.301 935.278,1031.94 937.586,786.023 939.894,873.724 942.202,836.311 944.51,791.976 946.818,917.058 949.126,876.001 951.434,872.138 953.742,642.113 956.05,810.171 958.358,935.192 960.665,986.235 962.973,1085.16 965.281,923.977 967.589,983.913 969.897,872.648 972.205,964.963 974.513,975.051 976.821,997.419 979.129,961.401 981.437,822.937 983.745,885.143 986.053,702.764 988.36,824.242 990.668,954.602 992.976,961.801 995.284,808.407 997.592,803.713 999.9,889.88 1002.21,882.501 1004.52,973.779 1006.82,974.298 1009.13,926.269 1011.44,989.144 1013.75,934.808 1016.06,992.679 1018.36,865.513 1020.67,952.317 1022.98,811.739 1025.29,952.924 1027.59,937.793 1029.9,968.027 1032.21,894.291 1034.52,938.504 1036.83,961.963 1039.13,1071.96 1041.44,830.796 1043.75,813.832 1046.06,870.504 1048.37,906.518 1050.67,795.925 1052.98,753.075 1055.29,850.998 1057.6,946.332 1059.91,964.238 1062.21,890.615 1064.52,960.708 1066.83,738.121 1069.14,948.248 1071.45,775.859 1073.75,854.224 1076.06,786.674 1078.37,974.521 1080.68,1008.52 1082.98,756.596 1085.29,863.499 1087.6,858.133 1089.91,948.409 1092.22,851.238 1094.52,757.539 1096.83,951.286 1099.14,791.434 1101.45,846.144 1103.76,754.159 1106.06,837.006 1108.37,812.314 1110.68,841.413 1112.99,813.448 1115.3,976.985 1117.6,794.74 1119.91,846.879 1122.22,901.483 1124.53,705.937 1126.84,753.311 1129.14,828.377 1131.45,953.244 1133.76,974.296 1136.07,880.474 1138.37,914.741 1140.68,832.217 1142.99,942.83 1145.3,821.935 1147.61,998.488 1149.91,898.668 1152.22,913.564 1154.53,1210.56 1156.84,1039.5 1159.15,811.068 1161.45,1004.2 1163.76,777.709 1166.07,987.771 1168.38,741.171 1170.69,944.73 1172.99,790.941 1175.3,852.615 1177.61,982.892 1179.92,938.123 1182.23,868.262 1184.53,892.31 1186.84,839.771 1189.15,984.304 1191.46,762.306 1193.76,926.831 1196.07,741.439 1198.38,993.608 1200.69,1012.57 1203,965.899 1205.3,904.926 1207.61,735.035 1209.92,907.382 1212.23,737.321 1214.54,893.358 1216.84,879.959 1219.15,931.611 1221.46,948.408 1223.77,846.128 1226.08,995.066 1228.38,954.491 1230.69,1032.58 1233,929.533 1235.31,850.995 1237.61,959.622 1239.92,858.173 1242.23,966.85 1244.54,987.692 1246.85,816.783 1249.15,821.231 1251.46,840.055 1253.77,960.914 1256.08,993.346 1258.39,800.529 1260.69,963.337 1263,932.491 1265.31,807.798 1267.62,808.772 1269.93,941.928 1272.23,933.26 1274.54,826.818 1276.85,908.861 1279.16,984.65 1281.47,738.228 1283.77,901.658 1286.08,770.357 1288.39,900.771 1290.7,925.819 1293,1054.64 1295.31,918.923 1297.62,973.994 1299.93,944.007 1302.24,954.861 1304.54,885.541 1306.85,952.268 1309.16,901.185 1311.47,846.827 1313.78,826.192 1316.08,984.293 1318.39,923.588 1320.7,1076.39 1323.01,804.628 1325.32,1021.1 1327.62,814.75 1329.93,851.079 1332.24,968.09 1334.55,932.396 1336.86,919.672 1339.16,769.191 1341.47,851.601 1343.78,916.944 1346.09,931.73 1348.39,1028.92 1350.7,947.372 1353.01,874.882 1355.32,883.247 1357.63,899.632 1359.93,934.716 1362.24,940.117 1364.55,917.987 1366.86,799.534 1369.17,902.606 1371.47,989.037 1373.78,798.77 1376.09,1108.21 1378.4,888.658 1380.71,888.036 1383.01,961.11 1385.32,748.832 1387.63,839.976 1389.94,733.158 1392.24,1037.01 1394.55,868.199 1396.86,1053.71 1399.17,888.822 1401.48,866.997 1403.78,980.519 1406.09,887.218 1408.4,992.12 1410.71,748.608 1413.02,929.465 1415.32,1193.33 1417.63,933.491 1419.94,960.452 1422.25,797.551 1424.56,811.643 1426.86,921.319 1429.17,1001.39 1431.48,985.492 1433.79,966.821 1436.1,990.595 1438.4,898.387 1440.71,788.994 1443.02,801.788 1445.33,1034.82 1447.63,946.09 1449.94,865.681 1452.25,903.258 1454.56,932.772 1456.87,907.524 1459.17,1183.43 1461.48,808.613 1463.79,928.119 1466.1,867.438 1468.41,843.794 1470.71,918.012 1473.02,959.56 1475.33,871.124 1477.64,882.456 1479.95,972.287 1482.25,1014.25 1484.56,931.697 1486.87,885.555 1489.18,932.874 1491.49,920.355 1493.79,827.695 1496.1,1034.13 1498.41,916.688 1500.72,901.72 1503.02,920.147 1505.33,775.281 1507.64,927.888 1509.95,612.955 1512.26,915.811 1514.56,807.332 1516.87,858.42 1519.18,826.581 1521.49,1147.83 1523.8,1039.78 1526.1,867.276 1528.41,879.579 1530.72,988.921 1533.03,962.382 1535.34,889.402 1537.64,821.371 1539.95,803.647 1542.26,660.248 1544.57,998.983 1546.88,962.515 1549.18,926.595 1551.49,959.428 1553.8,723.42 1556.11,862.828 1558.41,803.828 1560.72,924.58 1563.03,907.21 1565.34,863.611 1567.65,801.892 1569.95,838.556 1572.26,864.541 1574.57,743.085 1576.88,769.819 1579.19,1031.62 1581.49,877.292 1583.8,945.842 1586.11,925.97 1588.42,835.084 1590.73,867.388 1593.03,894.643 1595.34,953.61 1597.65,892.772 1599.96,858.586 1602.26,756.733 1604.57,794.114 1606.88,688.045 1609.19,830.873 1611.5,843.014 1613.8,777.11 1616.11,939.087 1618.42,949.328 1620.73,877.162 1623.04,640.027 1625.34,849.562 1627.65,819.397 1629.96,828.181 1632.27,813.387 1634.58,975.613 1636.88,830.609 1639.19,953.604 1641.5,831.396 1643.81,1042.32 1646.12,770.912 1648.42,789.019 1650.73,963.169 1653.04,952.276 1655.35,978.104 1657.65,919.368 1659.96,835.157 1662.27,909.119 1664.58,908.324 1666.89,1009.13 1669.19,820.186 1671.5,1063.53 1673.81,1057.43 1676.12,909.559 1678.43,806.7 1680.73,937.499 1683.04,1003.81 1685.35,824.993 1687.66,871.036 1689.97,810.148 1692.27,1118.35 1694.58,690.392 1696.89,1149.5 1699.2,683.033 1701.51,841.035 1703.81,902.388 1706.12,742.32 1708.43,962.678 1710.74,917.313 1713.04,802.564 1715.35,954.262 1717.66,900.084 1719.97,901.423 1722.28,768.359 1724.58,950.361 1726.89,963.542 1729.2,973.648 1731.51,1045.02 1733.82,776.572 1736.12,863.445 1738.43,1176.71 1740.74,806.343 1743.05,877.674 1745.36,781.319 1747.66,910.418 1749.97,965.798 1752.28,840.756 1754.59,890.777 1756.9,796.774 1759.2,816.435 1761.51,842.199 1763.82,976.633 1766.13,762.795 1768.43,752.01 1770.74,878.22 1773.05,784.847 1775.36,773.779 1777.67,874.504 1779.97,733.724 1782.28,726.365 1784.59,1001.02 1786.9,657.569 1789.21,726.049 1791.51,979.032 1793.82,700.174 1796.13,855.748 1798.44,903.84 1800.75,982.353 1803.05,942.649 1805.36,825.569 1807.67,951.173 1809.98,964.234 1812.28,718.233 1814.59,789.177 1816.9,1008.76 1819.21,1030.52 1821.52,726.576 1823.82,840.273 1826.13,818.541 1828.44,970.701 1830.75,812.83 1833.06,974.644 1835.36,851.387 1837.67,818.813 1839.98,986.603 1842.29,893.404 1844.6,895.626 1846.9,987.721 1849.21,944.779 1851.52,936.297 1853.83,875.563 1856.14,756.088 1858.44,927.104 1860.75,1054.8 1863.06,894.32 1865.37,877.159 1867.67,922.887 1869.98,846.753 1872.29,1100.07 1874.6,878.472 1876.91,1025.71 1879.21,843.47 1881.52,860.964 1883.83,804.491 1886.14,988.133 1888.45,872.289 1890.75,900.657 1893.06,829.463 1895.37,926.748 1897.68,832.451 1899.99,902.167 1902.29,736.91 1904.6,852.218 1906.91,657.15 1909.22,892.525 1911.53,874.059 1913.83,955.282 1916.14,773.681 1918.45,976.219 1920.76,888.998 1923.06,967.544 1925.37,818.679 1927.68,729.293 1929.99,914.477 1932.3,751.4 1934.6,984.756 1936.91,692.862 1939.22,958.968 1941.53,848.44 1943.84,859.873 1946.14,802.251 1948.45,818.609 1950.76,933.986 1953.07,921.036 1955.38,1097.53 1957.68,908.103 1959.99,1011.24 1962.3,973.737 1964.61,834.22 1966.91,861.362 1969.22,891.254 1971.53,976.173 1973.84,976.784 1976.15,810.907 1978.45,866.425 1980.76,1016.92 1983.07,830.927 1985.38,943.939 1987.69,948.219 1989.99,845.515 1992.3,800.024 1994.61,829.111 1996.92,865.686 1999.23,898.131 2001.53,880.862 2003.84,996.793 2006.15,955.953 2008.46,897.907 2010.77,955.922 2013.07,1141.69 2015.38,919.793 2017.69,1013.76 2020,1047.56 2022.3,1034.85 2024.61,1054.73 2026.92,760.958 2029.23,889.409 2031.54,920.092 2033.84,847.884 2036.15,951.751 2038.46,959.801 2040.77,956.041 2043.08,663.61 2045.38,938.209 2047.69,947.322 2050,863.755 2052.31,876.668 2054.62,928.842 2056.92,823.162 2059.23,956.037 2061.54,721.785 2063.85,904.037 2066.16,892.625 2068.46,903.473 2070.77,825.72 2073.08,970.041 2075.39,1124.86 2077.69,933.258 2080,909.503 2082.31,960.395 2084.62,998.584 2086.93,874.678 2089.23,866.566 2091.54,868.897 2093.85,791.212 2096.16,958.457 2098.47,930.811 2100.77,1010.5 2103.08,928.941 2105.39,834.838 2107.7,897.877 2110.01,800.265 2112.31,969.023 2114.62,1095.62 2116.93,876.488 2119.24,963.064 2121.55,836.163 2123.85,759.836 2126.16,1012.99 2128.47,1014.85 2130.78,1058.25 2133.08,828.428 2135.39,710.469 2137.7,860.376 2140.01,926.797 2142.32,533.637 2144.62,892.569 2146.93,957.73 2149.24,831.302 2151.55,1038.35 2153.86,850.407 2156.16,788.024 2158.47,880.647 2160.78,866.337 2163.09,736.845 2165.4,966.552 2167.7,953.984 2170.01,832.636 2172.32,688.653 2174.63,862.34 2176.93,983.434 2179.24,1022.32 2181.55,872.995 2183.86,1082.42 2186.17,1051.28 2188.47,824.641 2190.78,1031.3 2193.09,839.713 2195.4,921.845 2197.71,956.049 2200.01,821.689 2202.32,971.673 2204.63,1006.18 2206.94,1038.64 2209.25,841.185 2211.55,746.047 2213.86,848.408 2216.17,772.637 2218.48,830.474 2220.79,891.105 2223.09,855.693 2225.4,777.117 2227.71,922.62 2230.02,914.686 2232.32,974.115 2234.63,823.992 2236.94,974.275 2239.25,867.22 2241.56,960.56 2243.86,750.73 2246.17,950.903 2248.48,886.798 2250.79,959.769 2253.1,965.244 2255.4,894.83 2257.71,760.944 2260.02,1012.11 2262.33,879.932 2264.64,1163.25 2266.94,1041.06 2269.25,816.242 2271.56,860.246 2273.87,896.295 2276.18,904.878 2278.48,934.846 2280.79,945.071 2283.1,1034.67 2285.41,1032.73 2287.71,1008 2290.02,1109.43 2292.33,1012.62 2294.64,1079.79 2296.95,871.633 2299.25,800.369 2301.56,1029.42 2303.87,766.771 2306.18,822.154 2308.49,966.547 2310.79,750.626 2313.1,617.801 2315.41,822.841 2317.72,907.166 2320.03,665.319 2322.33,717.157 2324.64,783.839 2326.95,870.816 2329.26,949.735 2331.56,898.976 2333.87,850.296 2336.18,715.767 2338.49,964.227 2340.8,954.706 2343.1,901.175 2345.41,1046.29 2347.72,878.333 2350.03,844.232 2352.34,920.533 2354.64,1007.11 2356.95,995.133 2359.26,964.603 2361.57,793.752 2363.88,855.9 2366.18,1020.51 2368.49,802.112 2370.8,806.173 2373.11,785.457 2375.42,956.12 2377.72,921.003 2380.03,713.845 2382.34,957.468 2384.65,986.453 2386.95,888.676 2389.26,917.775 2391.57,805.573 2393.88,909.875 2396.19,776.685 2398.49,898.117 2400.8,764.114 2403.11,878.787 2405.42,866.749 2407.73,971.931 2410.03,974.992 2412.34,845.741 2414.65,797.928 2416.96,1087.96 2419.27,940.161 2421.57,864.306 2423.88,895.848 2426.19,894.93 2428.5,907.132 2430.81,962.232 2433.11,806.81 2435.42,948.368 2437.73,909.638 2440.04,1102.32 2442.34,1013.6 2444.65,995.613 2446.96,805.317 2449.27,938.018 2451.58,1182.71 2453.88,981.038 2456.19,763.68 2458.5,806.694 2460.81,902.538 2463.12,889.227 2465.42,959.152 2467.73,984.274 2470.04,1082.88 2472.35,918.964 2474.66,887.139 2476.96,893.055 2479.27,879.099 2481.58,973.464 2483.89,922.906 2486.2,878.338 2488.5,855.092 2490.81,837.792 2493.12,935.282 2495.43,724.974 2497.73,1015.35 2500.04,866.492 2502.35,805.662 2504.66,773.298 2506.97,736.756 2509.27,925.022 2511.58,830.353 2513.89,850.085 2516.2,795.418 2518.51,1006.93 2520.81,867.531 2523.12,944.042 2525.43,981.973 2527.74,804.234 2530.05,763.967 2532.35,927.407 2534.66,900.26 2536.97,825.181 2539.28,693.464 2541.58,1018.36 2543.89,720.494 2546.2,1019.85 2548.51,914.055 2550.82,1069.63 2553.12,837.112 2555.43,978.573 2557.74,908.101 2560.05,813.356 2562.36,854.096 2564.66,987.028 2566.97,768.769 2569.28,897.617 2571.59,978.832 "></polyline>
<polyline clip-path="url(#clip802)" style="stroke:#3da44d; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="265.984,552.955 268.292,336.264 270.6,437.193 272.908,96.8724 275.216,330.809 277.524,385.847 279.832,290.385 282.139,514.595 284.447,340.362 286.755,370.131 289.063,564.359 291.371,407.107 293.679,528.211 295.987,460.494 298.295,425.496 300.603,344.072 302.911,344.568 305.219,410.154 307.527,349.516 309.834,532.702 312.142,533.509 314.45,368.968 316.758,311.324 319.066,462.367 321.374,357.583 323.682,292.05 325.99,446.306 328.298,472.93 330.606,337.634 332.914,474.871 335.221,380.042 337.529,465.558 339.837,160.33 342.145,438.375 344.453,552.416 346.761,354.215 349.069,450.296 351.377,322.143 353.685,466.646 355.993,313.47 358.301,351.477 360.608,251.552 362.916,352.578 365.224,540.127 367.532,433.163 369.84,520.145 372.148,342.05 374.456,476.264 376.764,385.033 379.072,398.395 381.38,400.706 383.688,340.98 385.996,339.139 388.303,346.169 390.611,286.989 392.919,380.094 395.227,306.228 397.535,504.619 399.843,411.601 402.151,233.039 404.459,374.065 406.767,417.305 409.075,616.981 411.383,545.252 413.69,567.24 415.998,324.445 418.306,368.993 420.614,393.884 422.922,412.54 425.23,486.289 427.538,323.425 429.846,492.197 432.154,256.34 434.462,317.271 436.77,341.401 439.077,430.317 441.385,487.984 443.693,434.904 446.001,434.905 448.309,568.218 450.617,488.923 452.925,411.515 455.233,204.979 457.541,167.12 459.849,486.196 462.157,493.125 464.465,518.406 466.772,434.14 469.08,379.089 471.388,343.579 473.696,467.061 476.004,359.414 478.312,492.72 480.62,384.874 482.928,331.066 485.236,419.161 487.544,359.451 489.852,440.683 492.159,305.757 494.467,402.649 496.775,445.896 499.083,485.734 501.391,379.604 503.699,395.174 506.007,183.98 508.315,322.481 510.623,315.686 512.931,360.707 515.239,451.219 517.546,200.854 519.854,420.142 522.162,445.319 524.47,364.096 526.778,537.171 529.086,475.913 531.394,217.55 533.702,326.704 536.01,379.672 538.318,435.626 540.626,250.552 542.933,445.474 545.241,475.524 547.549,344.417 549.857,288.05 552.165,287.771 554.473,574.797 556.781,397.141 559.089,404.807 561.397,348.347 563.705,395.452 566.013,339.434 568.321,364.341 570.628,443.491 572.936,154.098 575.244,551.385 577.552,475.251 579.86,357.97 582.168,354.995 584.476,197.083 586.784,295.151 589.092,347.622 591.4,280.594 593.708,481.097 596.015,545.409 598.323,331.201 600.631,377.014 602.939,482.387 605.247,505.301 607.555,569.58 609.863,335.451 612.171,384.925 614.479,364.609 616.787,645.875 619.095,411.8 621.402,534.033 623.71,375.35 626.018,454.591 628.326,514.208 630.634,323.304 632.942,392.528 635.25,354.125 637.558,659.384 639.866,242.981 642.174,367.297 644.482,514.215 646.79,279.232 649.097,476.827 651.405,349.239 653.713,460.014 656.021,491.761 658.329,323.262 660.637,248.012 662.945,263.4 665.253,513.504 667.561,508.478 669.869,409.929 672.177,380.322 674.484,303.567 676.792,334.254 679.1,471.981 681.408,486.001 683.716,518.95 686.024,429.988 688.332,393.159 690.64,408.906 692.948,308.905 695.256,320.307 697.564,392.362 699.871,499.764 702.179,417.746 704.487,493.801 706.795,326.54 709.103,327.284 711.411,438.384 713.719,439.814 716.027,242.267 718.335,470.737 720.643,326.242 722.951,502.26 725.259,388.65 727.566,452.699 729.874,316.113 732.182,430.431 734.49,416.428 736.798,505.5 739.106,528.609 741.414,561.18 743.722,600.753 746.03,484.234 748.338,387.883 750.646,428.385 752.953,534.33 755.261,463.212 757.569,442.832 759.877,398.94 762.185,167.438 764.493,489.101 766.801,499.626 769.109,481.95 771.417,329.26 773.725,376.189 776.033,515.988 778.34,550.505 780.648,470.78 782.956,344.935 785.264,556.717 787.572,451.25 789.88,529.431 792.188,508.867 794.496,552.227 796.804,373.935 799.112,254.315 801.42,355.709 803.728,533.718 806.035,451.75 808.343,370.543 810.651,323.039 812.959,282.991 815.267,301.09 817.575,352.254 819.883,393.533 822.191,377.111 824.499,232.005 826.807,578.656 829.115,425.558 831.422,382.867 833.73,478.469 836.038,419.382 838.346,337.174 840.654,271.337 842.962,374.186 845.27,340.217 847.578,463.132 849.886,489.305 852.194,507.58 854.502,418.921 856.809,300.049 859.117,402.416 861.425,440.47 863.733,474.809 866.041,457.376 868.349,309.375 870.657,368.701 872.965,440.838 875.273,430.781 877.581,390.333 879.889,401.513 882.197,469.886 884.504,382.261 886.812,396.292 889.12,345.819 891.428,394.172 893.736,248.466 896.044,502.565 898.352,333.259 900.66,576.923 902.968,393.653 905.276,357.226 907.584,357.124 909.891,437.637 912.199,520.286 914.507,504.145 916.815,291.769 919.123,485.651 921.431,568.53 923.739,368.464 926.047,500.763 928.355,315.934 930.663,398.587 932.971,271.964 935.278,399.88 937.586,404.335 939.894,272.55 942.202,521.669 944.51,578.641 946.818,463.16 949.126,437.998 951.434,371.349 953.742,334.621 956.05,375.777 958.358,332.961 960.665,362.585 962.973,242.782 965.281,451.577 967.589,432.327 969.897,507.575 972.205,333.07 974.513,741.242 976.821,477.311 979.129,520.844 981.437,312.134 983.745,337.431 986.053,367.249 988.36,267.814 990.668,494.791 992.976,363.519 995.284,353.294 997.592,346.854 999.9,287.956 1002.21,359.467 1004.52,431.578 1006.82,364.158 1009.13,402.256 1011.44,391.059 1013.75,312.663 1016.06,678.602 1018.36,349.722 1020.67,409.942 1022.98,387.659 1025.29,286.45 1027.59,450.123 1029.9,386.615 1032.21,508.483 1034.52,539.284 1036.83,450.489 1039.13,259.189 1041.44,524.976 1043.75,532.841 1046.06,178.485 1048.37,480.124 1050.67,507.509 1052.98,330.361 1055.29,372.354 1057.6,350.779 1059.91,342.855 1062.21,304.252 1064.52,331.998 1066.83,454.13 1069.14,411.14 1071.45,271.075 1073.75,258.741 1076.06,212.247 1078.37,256.199 1080.68,399.38 1082.98,441.464 1085.29,302.481 1087.6,498.253 1089.91,408.615 1092.22,445.686 1094.52,274.496 1096.83,431.834 1099.14,485.802 1101.45,410.09 1103.76,570.763 1106.06,610.061 1108.37,387.932 1110.68,381.56 1112.99,607.962 1115.3,321.133 1117.6,284.29 1119.91,393.23 1122.22,309.768 1124.53,407.523 1126.84,335.024 1129.14,450.083 1131.45,184.646 1133.76,410.489 1136.07,429.142 1138.37,258.155 1140.68,437.472 1142.99,513.649 1145.3,341.6 1147.61,457.838 1149.91,364.667 1152.22,451.266 1154.53,348.578 1156.84,380.793 1159.15,320.194 1161.45,385.249 1163.76,545.552 1166.07,352.155 1168.38,373.973 1170.69,467.561 1172.99,248.544 1175.3,358.271 1177.61,258.436 1179.92,377.017 1182.23,456.801 1184.53,363.941 1186.84,306.672 1189.15,532.319 1191.46,376.806 1193.76,468.593 1196.07,510.92 1198.38,328.786 1200.69,174.881 1203,414.934 1205.3,394.904 1207.61,306.26 1209.92,405.044 1212.23,405.206 1214.54,382.711 1216.84,516.737 1219.15,452.071 1221.46,316.163 1223.77,412.178 1226.08,533.601 1228.38,712.181 1230.69,372.538 1233,494.488 1235.31,334.174 1237.61,424.931 1239.92,285.731 1242.23,536.948 1244.54,367.108 1246.85,424.836 1249.15,387.336 1251.46,434.345 1253.77,337.072 1256.08,361.582 1258.39,430.356 1260.69,396.576 1263,401.157 1265.31,314.676 1267.62,458.71 1269.93,282.086 1272.23,299.473 1274.54,317.521 1276.85,389.732 1279.16,379.617 1281.47,507.424 1283.77,317.873 1286.08,410.952 1288.39,437.99 1290.7,285.059 1293,325.935 1295.31,450.119 1297.62,447.548 1299.93,475.394 1302.24,334.479 1304.54,378.546 1306.85,418.419 1309.16,187.04 1311.47,315.149 1313.78,426.532 1316.08,461.117 1318.39,470.224 1320.7,540.229 1323.01,439.809 1325.32,408.823 1327.62,538.246 1329.93,206.935 1332.24,355.337 1334.55,463.701 1336.86,532.376 1339.16,411.279 1341.47,360.978 1343.78,361.009 1346.09,480.296 1348.39,348.812 1350.7,352.683 1353.01,400.641 1355.32,301.711 1357.63,724.521 1359.93,513.758 1362.24,638.228 1364.55,257.648 1366.86,412.581 1369.17,200.977 1371.47,331.023 1373.78,408.698 1376.09,306.219 1378.4,349.822 1380.71,396.322 1383.01,250.329 1385.32,420.787 1387.63,316.338 1389.94,287.061 1392.24,305.595 1394.55,305.791 1396.86,363.706 1399.17,403.907 1401.48,494.417 1403.78,492.826 1406.09,493.573 1408.4,316.537 1410.71,547.096 1413.02,254.722 1415.32,471.104 1417.63,560.834 1419.94,478.079 1422.25,489.101 1424.56,332.54 1426.86,382.773 1429.17,485.571 1431.48,295.806 1433.79,386.948 1436.1,490.519 1438.4,397.096 1440.71,316.989 1443.02,508.256 1445.33,487.362 1447.63,426.028 1449.94,295.299 1452.25,215.166 1454.56,264.045 1456.87,652.383 1459.17,313.968 1461.48,400.434 1463.79,532.367 1466.1,460.133 1468.41,267.542 1470.71,521.649 1473.02,520.613 1475.33,282.568 1477.64,347.647 1479.95,312.732 1482.25,182.856 1484.56,366.612 1486.87,285.71 1489.18,391.558 1491.49,285.698 1493.79,367.285 1496.1,339.485 1498.41,402.289 1500.72,329.595 1503.02,358.402 1505.33,298.734 1507.64,338.135 1509.95,465.535 1512.26,378.875 1514.56,301.127 1516.87,357.449 1519.18,394.96 1521.49,404.216 1523.8,278.873 1526.1,310.25 1528.41,384.668 1530.72,325.89 1533.03,562.117 1535.34,370.414 1537.64,397.038 1539.95,391.773 1542.26,264.074 1544.57,498.206 1546.88,449.78 1549.18,460.103 1551.49,353.93 1553.8,392.166 1556.11,160.014 1558.41,369.272 1560.72,346.31 1563.03,312.218 1565.34,425.581 1567.65,346.201 1569.95,501.978 1572.26,603.702 1574.57,278.293 1576.88,407.467 1579.19,349.661 1581.49,356.867 1583.8,447.438 1586.11,317.392 1588.42,439.206 1590.73,526.474 1593.03,498.097 1595.34,289.93 1597.65,215.305 1599.96,367.042 1602.26,348.487 1604.57,403.592 1606.88,348.261 1609.19,287.401 1611.5,283.742 1613.8,413.78 1616.11,288.196 1618.42,499.116 1620.73,610.858 1623.04,395.706 1625.34,289.524 1627.65,444.864 1629.96,397.211 1632.27,375.831 1634.58,468.301 1636.88,441.452 1639.19,343.324 1641.5,304.39 1643.81,571.264 1646.12,480.534 1648.42,423.121 1650.73,529.44 1653.04,374.045 1655.35,574.767 1657.65,270.37 1659.96,529.753 1662.27,347.836 1664.58,258.505 1666.89,316.581 1669.19,437.478 1671.5,461.192 1673.81,378.602 1676.12,482.738 1678.43,297.92 1680.73,233.434 1683.04,624.248 1685.35,377.663 1687.66,418.808 1689.97,534.73 1692.27,493.718 1694.58,505.701 1696.89,303.217 1699.2,426.281 1701.51,388.406 1703.81,419.963 1706.12,340.655 1708.43,333.341 1710.74,300.166 1713.04,262.477 1715.35,321.053 1717.66,344.644 1719.97,514.434 1722.28,543.303 1724.58,431.471 1726.89,399.36 1729.2,527.254 1731.51,271.468 1733.82,412.687 1736.12,455.553 1738.43,319.039 1740.74,303.043 1743.05,434.851 1745.36,284.415 1747.66,281.578 1749.97,348.384 1752.28,266.88 1754.59,495.272 1756.9,506.64 1759.2,258.377 1761.51,297.294 1763.82,519.635 1766.13,319.917 1768.43,374.109 1770.74,312.65 1773.05,401.677 1775.36,457.057 1777.67,383.251 1779.97,295.233 1782.28,529.107 1784.59,330.337 1786.9,577.275 1789.21,363.948 1791.51,379.079 1793.82,443.687 1796.13,466.128 1798.44,319.998 1800.75,509.941 1803.05,447.259 1805.36,351.609 1807.67,538.315 1809.98,428.258 1812.28,419.216 1814.59,238.898 1816.9,524.085 1819.21,362.687 1821.52,379.542 1823.82,430.921 1826.13,309.744 1828.44,468.533 1830.75,341.739 1833.06,217.077 1835.36,308.016 1837.67,467.555 1839.98,279.826 1842.29,299.74 1844.6,403.191 1846.9,431.149 1849.21,271.485 1851.52,389.528 1853.83,438.323 1856.14,505.052 1858.44,552.718 1860.75,332.94 1863.06,318.442 1865.37,390.848 1867.67,350.455 1869.98,353.167 1872.29,339.384 1874.6,340.757 1876.91,366.366 1879.21,414.349 1881.52,236.268 1883.83,379.555 1886.14,332.118 1888.45,304.303 1890.75,301.247 1893.06,533.494 1895.37,416.228 1897.68,497.539 1899.99,319.045 1902.29,333.445 1904.6,497.336 1906.91,298.211 1909.22,359.414 1911.53,377.926 1913.83,481.992 1916.14,429.99 1918.45,308.649 1920.76,382.09 1923.06,373.752 1925.37,365.012 1927.68,479.231 1929.99,347.335 1932.3,549.234 1934.6,475.423 1936.91,337.979 1939.22,520.8 1941.53,589.206 1943.84,336.706 1946.14,369.057 1948.45,508.515 1950.76,357.912 1953.07,447.55 1955.38,333.1 1957.68,431.38 1959.99,379.292 1962.3,446.768 1964.61,391.068 1966.91,669.443 1969.22,351.557 1971.53,340.248 1973.84,491.243 1976.15,377.061 1978.45,276.928 1980.76,333.746 1983.07,478.194 1985.38,355.221 1987.69,343.936 1989.99,421.566 1992.3,382.224 1994.61,463.507 1996.92,243.905 1999.23,379.341 2001.53,391.012 2003.84,333.502 2006.15,354.602 2008.46,452.408 2010.77,458.158 2013.07,481.586 2015.38,379.277 2017.69,516.285 2020,522.854 2022.3,503.81 2024.61,463.314 2026.92,333.918 2029.23,578.492 2031.54,622.138 2033.84,337.731 2036.15,505.538 2038.46,464.303 2040.77,349.001 2043.08,370.55 2045.38,428.238 2047.69,402.974 2050,283.216 2052.31,260.377 2054.62,299.105 2056.92,283.637 2059.23,368.868 2061.54,498.642 2063.85,313.151 2066.16,347.476 2068.46,463.896 2070.77,357.209 2073.08,385.831 2075.39,339.392 2077.69,372.854 2080,482.229 2082.31,263.496 2084.62,380.874 2086.93,237.446 2089.23,512.01 2091.54,492.339 2093.85,244.41 2096.16,356.641 2098.47,457.221 2100.77,292.592 2103.08,341.89 2105.39,369.721 2107.7,458.341 2110.01,545.839 2112.31,400.24 2114.62,316.268 2116.93,330.747 2119.24,270.859 2121.55,463.269 2123.85,378.001 2126.16,291.909 2128.47,408.5 2130.78,367.279 2133.08,497.826 2135.39,222.875 2137.7,400.763 2140.01,415.071 2142.32,458.637 2144.62,289.983 2146.93,417.523 2149.24,412.833 2151.55,532.896 2153.86,380.972 2156.16,672.306 2158.47,207.307 2160.78,481.015 2163.09,226.729 2165.4,428.246 2167.7,271.147 2170.01,512.973 2172.32,424.911 2174.63,242.438 2176.93,404.995 2179.24,416.539 2181.55,502.312 2183.86,486.305 2186.17,469.484 2188.47,238.27 2190.78,446.549 2193.09,478.67 2195.4,460.691 2197.71,473.842 2200.01,285.595 2202.32,365.647 2204.63,223.244 2206.94,306.771 2209.25,317.962 2211.55,600.586 2213.86,443.767 2216.17,362.856 2218.48,506.903 2220.79,473.356 2223.09,539.602 2225.4,485.343 2227.71,389.856 2230.02,608.494 2232.32,388.893 2234.63,485.243 2236.94,347.721 2239.25,363.88 2241.56,499.367 2243.86,321.367 2246.17,456.885 2248.48,241.889 2250.79,453.904 2253.1,616.926 2255.4,324.337 2257.71,433.679 2260.02,413.587 2262.33,429.254 2264.64,458.366 2266.94,182.875 2269.25,538.309 2271.56,415.463 2273.87,426.929 2276.18,385.859 2278.48,235.1 2280.79,397.999 2283.1,436.281 2285.41,225.447 2287.71,378.832 2290.02,414.936 2292.33,547.286 2294.64,302.44 2296.95,465.476 2299.25,523.549 2301.56,480.639 2303.87,504.266 2306.18,467.304 2308.49,302.149 2310.79,412.235 2313.1,580.724 2315.41,300.389 2317.72,394.999 2320.03,360.774 2322.33,416.479 2324.64,451.909 2326.95,349.65 2329.26,452.62 2331.56,400.419 2333.87,355.533 2336.18,272.706 2338.49,267.143 2340.8,366.407 2343.1,346.012 2345.41,291.929 2347.72,497.452 2350.03,241.742 2352.34,362.873 2354.64,512.375 2356.95,370.865 2359.26,344.663 2361.57,397.735 2363.88,321.566 2366.18,449.246 2368.49,221.372 2370.8,408.395 2373.11,260.776 2375.42,229.565 2377.72,408.219 2380.03,475.602 2382.34,339.285 2384.65,295.403 2386.95,372.777 2389.26,479.889 2391.57,382.922 2393.88,297.066 2396.19,322.386 2398.49,292.396 2400.8,276.475 2403.11,303.708 2405.42,443.607 2407.73,416.04 2410.03,340.933 2412.34,517.578 2414.65,250.237 2416.96,231.626 2419.27,530.488 2421.57,252.357 2423.88,503.79 2426.19,424.886 2428.5,392.262 2430.81,616.061 2433.11,244.88 2435.42,286.001 2437.73,556.337 2440.04,323.881 2442.34,418.035 2444.65,246.328 2446.96,388.71 2449.27,549.612 2451.58,375.676 2453.88,178.522 2456.19,393.477 2458.5,585.868 2460.81,546.838 2463.12,335.892 2465.42,396.73 2467.73,415.147 2470.04,509.796 2472.35,254.211 2474.66,574.822 2476.96,372.495 2479.27,446.924 2481.58,471.179 2483.89,374.077 2486.2,464.773 2488.5,341.779 2490.81,430.237 2493.12,447.584 2495.43,408.256 2497.73,351.166 2500.04,261.314 2502.35,362.678 2504.66,426.068 2506.97,337.4 2509.27,479.433 2511.58,417.399 2513.89,318.615 2516.2,424.677 2518.51,156.931 2520.81,239.645 2523.12,391.913 2525.43,389.524 2527.74,395.577 2530.05,276.241 2532.35,332.352 2534.66,427.803 2536.97,430.364 2539.28,372.014 2541.58,407.587 2543.89,265.846 2546.2,306.225 2548.51,529.898 2550.82,156.265 2553.12,226.214 2555.43,328.081 2557.74,383.065 2560.05,428.077 2562.36,387.35 2564.66,445.275 2566.97,295.034 2569.28,527.477 2571.59,306.312 "></polyline>
</svg>
</div>
</div>
<p>Look at that! Things are working; amazin’.</p>
<p>We can also exploit <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>’s parallel sampling capabilities:</p>
<div id="34" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run separate 4 chains for 10 000 iterations using threads to parallelize.</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>num_chains <span class="op">=</span> <span class="fl">4</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    model_with_grad,</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">MCMCThreads</span>(),</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>,</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    num_chains;</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Note we need to provide an initial state for every chain.</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>    initial_state<span class="op">=</span><span class="fu">fill</span>(state, num_chains),</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>samples_array <span class="op">=</span> <span class="fu">stack</span>(<span class="fu">map</span>(<span class="bu">Base</span>.<span class="fu">Fix1</span>(stack, sample <span class="op">-&gt;</span> sample.x), samples))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000×4 Array{Float64, 3}:
[:, :, 1] =
 -1.2545   -4.10597    -5.37582  …  -6.68974    -6.83047   -6.79602
  0.8289    0.0260604   0.04529      0.0395649   0.666366   0.189431
  2.46398   4.13758     5.15476      5.62775     6.24628    4.16531

[:, :, 2] =
 -2.86061  -5.48095  -5.48095  -5.17086   …  -5.2735    -5.06754  -5.42438
 -0.49985   0.64835   0.64835  -0.195306     -0.200824  -0.19762  -0.137093
  2.80204   3.39575   3.39575   4.65611       4.36434    4.04946   5.42494

[:, :, 3] =
 -0.789831  -3.22664  -1.89425    -2.7684    …  -3.9394   -5.51653   -4.73394
  2.75714    1.91106   0.0463139  -0.823526      2.17523   0.583079  -0.19652
  1.97742    4.08349   4.26582     5.67374       4.43378   5.34994    4.22931

[:, :, 4] =
 -2.8142   -2.8142   -5.3223   -4.53458   …  -5.13642   -5.9089    -5.9089
  1.72388   1.72388   2.17138   0.691315     -0.552726  -0.792026  -0.792026
  2.08583   2.08583   2.56941   4.68515       4.96363    4.15147    4.15147</code></pre>
</div>
</div>
<p>But the fact that we have to provide the <code>AbstractMCMC.sample</code> call, etc. with an <code>initial_state</code> to get started is a bit annoying. We can avoid this by also defining a <code>AbstractMCMC.step</code> <em>without</em> the <code>state</code> argument:</p>
<div id="36" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">::</span><span class="dt">MALA</span>;</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># </span><span class="al">NOTE</span><span class="co">: No state provided!</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just create the initial state by sampling using  a Gaussian.</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="fu">randn</span>(rng, LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(x), <span class="fu">MALAState</span>(x)</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Equipped with this, we no longer need to provide the <code>initial_state</code> everywhere:</p>
<div id="38" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -4.98169    1.00286
 -0.0409431  1.00334
  4.99019    1.00864</code></pre>
</div>
</div>
</section>
<section id="using-our-sampler-with-turing.jl" class="level2">
<h2 class="anchored" data-anchor-id="using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</h2>
<p>As we promised, all of this hassle of implementing our <code>MALA</code> sampler in a way that uses <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> and <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> gets us something more than <em>just</em> an “automatic” implementation of <code>AbstractMCMC.sample</code>.</p>
<p>It also enables use with Turing.jl through the <code>externalsampler</code>, but we need to do one final thing first: we need to tell Turing.jl how to extract a vector of parameters from the “sample” returned in our implementation of <code>AbstractMCMC.step</code>. In our case, the “sample” is a <code>MALASample</code>, so we just need the following line:</p>
<div id="40" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load Turing.jl.</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Turing</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Overload the `getparams` method for our "sample" type, which is just a vector.</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>Turing.Inference.<span class="fu">getparams</span>(<span class="op">::</span><span class="dt">Turing.Model</span>, sample<span class="op">::</span><span class="dt">MALASample</span>) <span class="op">=</span> sample.x</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And with that, we’re good to go!</p>
<div id="42" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Our previous model defined as a Turing.jl model.</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">mvnormal_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">MvNormal</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.], I)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate our model.</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">mvnormal_model</span>()</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Call `sample` but now we're passing in a Turing.jl `model` and wrapping</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co"># our `MALA` sampler in the `externalsampler` to tell Turing.jl that the sampler</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co"># expects something that implements LogDensityProblems.jl.</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×4×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 2.71 seconds
Compute duration  = 2.71 seconds
parameters        = x[1], x[2], x[3]
internals         = lp

Summary Statistics
  parameters      mean       std      mcse    ess_bulk    ess_tail      rhat   ⋯
      Symbol   Float64   Float64   Float64     Float64     Float64   Float64   ⋯

        x[1]   -5.0325    1.0146    0.0176   3337.7539   5349.9443    1.0000   ⋯
        x[2]    0.0195    1.0056    0.0174   3348.8137   5000.6283    1.0001   ⋯
        x[3]    4.9746    0.9883    0.0169   3410.8105   5451.1715    1.0000   ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

        x[1]   -7.0305   -5.7121   -5.0448   -4.3515   -3.0511
        x[2]   -1.9193   -0.6757    0.0277    0.6934    2.0060
        x[3]    3.0667    4.3047    4.9790    5.6438    6.9280</code></pre>
</div>
</div>
<p>Pretty neat, eh?</p>
<section id="models-with-constrained-parameters" class="level3">
<h3 class="anchored" data-anchor-id="models-with-constrained-parameters">Models with constrained parameters</h3>
<p>One thing we’ve sort of glossed over in all of the above is that MALA, at least how we’ve implemented it, requires <span class="math inline">\(x\)</span> to live in <span class="math inline">\(\mathbb{R}^d\)</span> for some <span class="math inline">\(d &gt; 0\)</span>. If some of the parameters were in fact constrained, e.g.&nbsp;we were working with a <code>Beta</code> distribution which has support on the interval <span class="math inline">\((0, 1)\)</span>, <em>not</em> on <span class="math inline">\(\mathbb{R}^d\)</span>, we could easily end up outside of the valid range <span class="math inline">\((0, 1)\)</span>.</p>
<div id="44" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">beta_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">beta_model</span>()</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 1.86 seconds
Compute duration  = 1.86 seconds
parameters        = x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse    ess_bulk    ess_tail      rhat   ⋯
      Symbol   Float64   Float64   Float64     Float64     Float64   Float64   ⋯

           x    0.5042    0.1889    0.0028   4398.5846   5358.3568    1.0014   ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

           x    0.1455    0.3637    0.5075    0.6447    0.8546</code></pre>
</div>
</div>
<p>Yep, that still works, but only because Turing.jl actually <em>transforms</em> the <code>turing_model</code> from constrained to unconstrained, so that the <code>sampler</code> provided to <code>externalsampler</code> is actually always working in unconstrained space! This is not always desirable, so we can turn this off:</p>
<div id="46" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 0.16 seconds
Compute duration  = 0.16 seconds
parameters        = x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse   ess_bulk   ess_tail      rhat   e ⋯
      Symbol   Float64   Float64   Float64    Float64    Float64   Float64     ⋯

           x    0.5177    0.2138    0.0418    24.6355        NaN    1.4742     ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

           x    0.2224    0.3014    0.5217    0.7169    0.8063</code></pre>
</div>
</div>
<p>The fun thing is that this still sort of works because</p>
<div id="48" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">logpdf</span>(<span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>), <span class="fl">10.0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-Inf</code></pre>
</div>
</div>
<p>and so the samples that fall outside of the range are always rejected. But do notice how much worse all the diagnostics are, e.g.&nbsp;<code>ess_tail</code> is very poor compared to when we use <code>unconstrained=true</code>. Moreover, in more complex cases this won’t just result in a “nice” <code>-Inf</code> log-density value, but instead will error:</p>
<div id="50" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="kw">function</span> <span class="fu">demo</span>()</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>    σ² <span class="op">~</span> <span class="fu">truncated</span>(<span class="fu">Normal</span>(), lower<span class="op">=</span><span class="fl">0</span>)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If we end up with negative values for `σ²`, the `Normal` will error.</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>    x <span class="op">~</span> <span class="fu">Normal</span>(<span class="fl">0</span>, σ²)</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>DomainError: DomainError(-0.22297181779254946, "Normal: the condition σ &gt;= zero(σ) is not satisfied.")
DomainError with -0.22297181779254946:
Normal: the condition σ &gt;= zero(σ) is not satisfied.
Stacktrace:
  [1] #371
    @ ~/.julia/packages/Distributions/j0ZcJ/src/univariate/continuous/normal.jl:37 [inlined]
  [2] check_args
    @ ~/.julia/packages/Distributions/j0ZcJ/src/utils.jl:89 [inlined]
  [3] #Normal#370
    @ ~/.julia/packages/Distributions/j0ZcJ/src/univariate/continuous/normal.jl:37 [inlined]
  [4] Normal
    @ ~/.julia/packages/Distributions/j0ZcJ/src/univariate/continuous/normal.jl:36 [inlined]
  [5] Normal
    @ ~/.julia/packages/Distributions/j0ZcJ/src/univariate/continuous/normal.jl:42 [inlined]
  [6] macro expansion
    @ ~/.julia/packages/DynamicPPL/cvlfK/src/compiler.jl:584 [inlined]
  [7] demo
    @ ~/work/docs/docs/tutorials/docs-17-implementing-samplers/index.qmd:455 [inlined]
  [8] _evaluate!!
    @ ~/.julia/packages/DynamicPPL/cvlfK/src/model.jl:914 [inlined]
  [9] evaluate_threadsafe!!(model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, varinfo::DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, context::DynamicPPL.ValuesAsInModelContext{OrderedDict{Any, Any}, DynamicPPL.DefaultContext})
    @ DynamicPPL ~/.julia/packages/DynamicPPL/cvlfK/src/model.jl:903
 [10] evaluate!!
    @ ~/.julia/packages/DynamicPPL/cvlfK/src/model.jl:833 [inlined]
 [11] values_as_in_model
    @ ~/.julia/packages/DynamicPPL/cvlfK/src/values_as_in_model.jl:196 [inlined]
 [12] values_as_in_model
    @ ~/.julia/packages/DynamicPPL/cvlfK/src/values_as_in_model.jl:195 [inlined]
 [13] getparams(model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, vi::DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64})
    @ Turing.Inference ~/.julia/packages/Turing/NQDYt/src/mcmc/Inference.jl:381
 [14] Turing.Inference.Transition(model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, vi::DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, t::MALASample{Vector{Float64}})
    @ Turing.Inference ~/.julia/packages/Turing/NQDYt/src/mcmc/Inference.jl:256
 [15] transition_to_turing
    @ ~/.julia/packages/Turing/NQDYt/src/mcmc/abstractmcmc.jl:12 [inlined]
 [16] transition_to_turing(f::LogDensityProblemsADForwardDiffExt.ForwardDiffLogDensity{LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, Nothing}, ForwardDiff.Chunk{2}, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}, transition::MALASample{Vector{Float64}})
    @ Turing.Inference ~/.julia/packages/Turing/NQDYt/src/mcmc/abstractmcmc.jl:17
 [17] step(rng::TaskLocalRNG, model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, sampler_wrapper::DynamicPPL.Sampler{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}; initial_state::Nothing, initial_params::Nothing, kwargs::@Kwargs{})
    @ Turing.Inference ~/.julia/packages/Turing/NQDYt/src/mcmc/abstractmcmc.jl:147
 [18] macro expansion
    @ ~/.julia/packages/AbstractMCMC/FSyVk/src/sample.jl:0 [inlined]
 [19] macro expansion
    @ ~/.julia/packages/AbstractMCMC/FSyVk/src/logging.jl:16 [inlined]
 [20] mcmcsample(rng::TaskLocalRNG, model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, sampler::DynamicPPL.Sampler{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}, N::Int64; progress::Bool, progressname::String, callback::Nothing, num_warmup::Int64, discard_initial::Int64, thinning::Int64, chain_type::Type, initial_state::Nothing, kwargs::@Kwargs{})
    @ AbstractMCMC ~/.julia/packages/AbstractMCMC/FSyVk/src/sample.jl:142
 [21] sample(rng::TaskLocalRNG, model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, sampler::DynamicPPL.Sampler{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}, N::Int64; chain_type::Type, resume_from::Nothing, initial_state::Nothing, kwargs::@Kwargs{progress::Bool})
    @ DynamicPPL ~/.julia/packages/DynamicPPL/cvlfK/src/sampler.jl:107
 [22] sample
    @ ~/.julia/packages/DynamicPPL/cvlfK/src/sampler.jl:97 [inlined]
 [23] #sample#4
    @ ~/.julia/packages/Turing/NQDYt/src/mcmc/Inference.jl:303 [inlined]
 [24] sample
    @ ~/.julia/packages/Turing/NQDYt/src/mcmc/Inference.jl:294 [inlined]
 [25] #sample#3
    @ ~/.julia/packages/Turing/NQDYt/src/mcmc/Inference.jl:291 [inlined]
 [26] top-level scope
    @ ~/work/docs/docs/tutorials/docs-17-implementing-samplers/index.qmd:457</code></pre>
</div>
</div>
<p>As expected, we run into a <code>DomainError</code> at some point, while if we set <code>unconstrained=true</code>, letting Turing.jl transform the model to a unconstrained form behind the scenes, everything works as expected:</p>
<div id="52" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 1.94 seconds
Compute duration  = 1.94 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse   ess_bulk   ess_tail      rhat   e ⋯
      Symbol   Float64   Float64   Float64    Float64    Float64   Float64     ⋯

          σ²    0.8556    0.5432    0.0245   264.5999   103.7015    1.0006     ⋯
           x   -0.0391    0.9500    0.0418   697.6227   374.7321    1.0017     ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

          σ²    0.1076    0.4133    0.7629    1.1744    2.1733
           x   -2.2989   -0.4182    0.0071    0.4294    1.8242</code></pre>
</div>
</div>
<p>Neat!</p>
<p>Similarly, which automatic differentiation backend one should use can be specified through the <code>adtype</code> keyword argument too. For example, if we want to use <a href="https://github.com/JuliaDiff/ReverseDiff.jl">ReverseDiff.jl</a> instead of the default <a href="https://github.com/JuliaDiff/ForwardDiff.jl">ForwardDiff.jl</a>:</p>
<div id="54" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">ReverseDiff</span>: ReverseDiff</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify that we want to use `AutoReverseDiff`.</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">demo</span>(),</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>, adtype<span class="op">=</span><span class="fu">AutoReverseDiff</span>()),</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>;</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 3.6 seconds
Compute duration  = 3.6 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse   ess_bulk   ess_tail      rhat   e ⋯
      Symbol   Float64   Float64   Float64    Float64    Float64   Float64     ⋯

          σ²    0.8492    0.5515    0.0278   291.2391   133.6587    1.0002     ⋯
           x   -0.0037    0.9015    0.0391   683.5650   420.7296    1.0027     ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

          σ²    0.0901    0.4138    0.7396    1.1916    2.1585
           x   -1.8808   -0.4046   -0.0088    0.3875    2.1598</code></pre>
</div>
</div>
<p>Double-neat.</p>
</section>
</section>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<p>At this point it’s worth maybe reminding ourselves what we did and also <em>why</em> we did it:</p>
<ol type="1">
<li>We define our models in the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface because it makes the sampler agnostic to how the underlying model is implemented.</li>
<li>We implement our sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> interface, which just means that our sampler is a subtype of <code>AbstractMCMC.AbstractSampler</code> and we implement the MCMC transition in <code>AbstractMCMC.step</code>.</li>
<li>Points 1 and 2 makes it so our sampler can be used with a wide range of model implementations, amongst them being models implemented in both Turing.jl and Stan. This gives you, the inference implementer, a large collection of models to test your inference method on, in addition to allowing users of Turing.jl and Stan to try out your inference method with minimal effort.</li>
</ol>


</section>


<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a><div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>We’re going with the leapfrog formulation because in a future version of this tutorial we’ll add a section extending this simple “baseline” MALA sampler to more complex versions. See <a href="https://github.com/TuringLang/docs/issues/479">issue #479</a> for progress on this.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>There is no such thing as a proper interface in Julia (at least not officially), and so we use the word “interface” here to mean a few minimal methods that needs to be implemented by any type that we treat as a target model.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/turinglang\.org\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../tutorials/docs-07-for-developers-variational-inference/index.html" class="pagination-link" aria-label="Variational Inference">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Variational Inference</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Turing is created by <a href="http://mlg.eng.cam.ac.uk/hong/" target="_blank">Hong Ge</a>, and lovingly maintained by the <a href="https://github.com/TuringLang/Turing.jl/graphs/contributors" target="_blank">core team</a> of volunteers. <br> The contents of this website are © 2024 under the terms of the <a href="https://github.com/TuringLang/Turing.jl/blob/master/LICENCE" target="_blank">MIT License</a>.</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/TuringLang/docs/edit/master/tutorials/docs-17-implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/docs/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://x.com/TuringLang">
      <i class="bi bi-twitter" role="img" aria-label="Turing Twitter">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/TuringLang/Turing.jl">
      <i class="bi bi-github" role="img" aria-label="Turing GitHub">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




<script src="../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>