<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.10">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Implementing samplers – Turing.jl</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../tutorials/docs-07-for-developers-variational-inference/index.html" rel="prev">
<link href="../../assets/favicon.ico" rel="icon">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-0f20262f3ac6b624a8f572cb0795ac9a.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark-ab571cb649e658061f5e385b10ec0c93.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-f80257e2a36ff81c57cea0ffaf822744.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark-3042bfe894fb86cfc239603025ade02d.min.css" rel="prefetch" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<style>
  a {
    text-decoration: none;
  }
  a:hover {
    text-decoration: underline;
  }
</style>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../theming/styles.css">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="https://turinglang.org/" class="navbar-brand navbar-brand-logo">
    <img src="../../assets/images/turing-logo.svg" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="https://turinglang.org/">
    <span class="navbar-title">Turing.jl</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../tutorials/docs-00-getting-started/"> 
<span class="menu-text">Get Started</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../tutorials/00-introduction/"> 
<span class="menu-text">Tutorials</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/library/"> 
<span class="menu-text">Libraries</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/news/"> 
<span class="menu-text">News</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/team/"> 
<span class="menu-text">Team</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-v0.35" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">v0.35</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-v0.35">    
        <li>
    <a class="dropdown-item" href="https://turinglang.org/docs/changelog.html">
 <span class="dropdown-text">Changelog</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://turinglang.org/docs/versions.html">
 <span class="dropdown-text">All Versions</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools tools-wide">
    <a href="https://x.com/TuringLang" title="Turing Twitter" class="quarto-navigation-tool px-1" aria-label="Turing Twitter"><i class="bi bi-twitter"></i></a>
    <a href="https://github.com/TuringLang/Turing.jl" title="Turing GitHub" class="quarto-navigation-tool px-1" aria-label="Turing GitHub"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Developers</li><li class="breadcrumb-item"><a href="../../tutorials/docs-06-for-developers-interface/index.html">Inference (note: outdated)</a></li><li class="breadcrumb-item"><a href="../../tutorials/docs-17-implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false">
 <span class="menu-text">Users</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-00-getting-started/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Getting Started</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-12-using-turing-guide/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Core Functionality</span></a>
  </div>
</li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false">
 <span class="menu-text">Usage Tips</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-10-using-turing-autodiff/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Automatic Differentiation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/usage-custom-distribution/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Custom Distributions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/usage-probability-interface/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Querying Model Probabilities</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/usage-modifying-logprob/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Modifying the Log Probability</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/usage-generated-quantities/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Generated Quantities</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-17-mode-estimation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Mode Estimation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-13-using-turing-performance-tips/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Performance Tips</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-15-using-turing-sampler-viz/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Sampler Visualization</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-11-using-turing-dynamichmc/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using DynamicHMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-16-using-turing-external-samplers/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using External Samplers</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false">
 <span class="menu-text">Tutorials</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/00-introduction/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction: Coin Flipping</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/01-gaussian-mixture-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Mixture Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/02-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/03-bayesian-neural-network/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Neural Networks</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/04-hidden-markov-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Hidden Markov Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/05-linear-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Linear Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/06-infinite-mixture-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Infinite Mixture Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/07-poisson-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Poisson Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/08-multinomial-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Multinomial Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/09-variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/10-bayesian-differential-equations/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Differential Equations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/11-probabilistic-pca/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Probabilistic PCA</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/13-seasonal-time-series/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Time Series Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/15-gaussian-processes/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction to Gaussian Processes</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/12-gplvm/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Process Latent Variable Models</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Developers</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false">
 <span class="menu-text">Contributing</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-01-contributing-guide/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">How to Contribute</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="false">
 <span class="menu-text">DynamicPPL in Depth</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
 <span class="menu-text">developers/model-manual.qmd</span>
  </li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-05-for-developers-compiler/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Turing Compiler Design</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/14-minituring/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation I: Compiler</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/16-contexts/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation II: Contexts</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true">
 <span class="menu-text">Inference (note: outdated)</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-06-for-developers-interface/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Interface Guide</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-04-for-developers-abstractmcmc-turing/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">How Turing implements AbstractMCMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-07-for-developers-variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-17-implementing-samplers/index.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Implementing Samplers</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of Contents</h2>
   
  <ul>
  <li><a href="#quick-overview-of-mala" id="toc-quick-overview-of-mala" class="nav-link active" data-scroll-target="#quick-overview-of-mala">Quick overview of MALA</a></li>
  <li><a href="#what-we-need-from-a-model-logdensityproblems.jl" id="toc-what-we-need-from-a-model-logdensityproblems.jl" class="nav-link" data-scroll-target="#what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: LogDensityProblems.jl</a></li>
  <li><a href="#implementing-mala-in-abstractmcmc.jl" id="toc-implementing-mala-in-abstractmcmc.jl" class="nav-link" data-scroll-target="#implementing-mala-in-abstractmcmc.jl">Implementing MALA in AbstractMCMC.jl</a></li>
  <li><a href="#using-our-sampler-with-turing.jl" id="toc-using-our-sampler-with-turing.jl" class="nav-link" data-scroll-target="#using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</a>
  <ul class="collapse">
  <li><a href="#models-with-constrained-parameters" id="toc-models-with-constrained-parameters" class="nav-link" data-scroll-target="#models-with-constrained-parameters">Models with constrained parameters</a></li>
  </ul></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/TuringLang/docs/edit/master/tutorials/docs-17-implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/docs/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Developers</li><li class="breadcrumb-item"><a href="../../tutorials/docs-06-for-developers-interface/index.html">Inference (note: outdated)</a></li><li class="breadcrumb-item"><a href="../../tutorials/docs-17-implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Implementing samplers</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>In this tutorial, we’ll go through step-by-step how to implement a “simple” sampler in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> in such a way that it can be easily applied to Turing.jl models.</p>
<p>In particular, we’re going to implement a version of <strong>Metropolis-adjusted Langevin (MALA)</strong>.</p>
<p>Note that we will implement this sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> framework, completely “ignoring” Turing.jl until the very end of the tutorial, at which point we’ll use a single line of code to make the resulting sampler available to Turing.jl. This is to really drive home the point that one can implement samplers in a way that is accessible to all of Turing.jl’s users without having to use Turing.jl yourself.</p>
<section id="quick-overview-of-mala" class="level2">
<h2 class="anchored" data-anchor-id="quick-overview-of-mala">Quick overview of MALA</h2>
<p>We can view MALA as a single step of the leapfrog intergrator with resampling of momentum <span class="math inline">\(p\)</span> at every step.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> To make that statement a bit more concrete, we first define the <em>extended</em> target <span class="math inline">\(\bar{\gamma}(x, p)\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\log \bar{\gamma}(x, p) \propto \log \gamma(x) + \log \gamma_{\mathcal{N}(0, M)}(p)
\end{equation*}\]</span></p>
<p>where <span class="math inline">\(\gamma_{\mathcal{N}(0, M)}\)</span> denotes the density for a zero-centered Gaussian with covariance matrix <span class="math inline">\(M\)</span>. We then consider targeting this joint distribution over both <span class="math inline">\(x\)</span> and <span class="math inline">\(p\)</span> as follows. First we define the map</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  L_{\epsilon}: \quad &amp; \mathbb{R}^d \times \mathbb{R}^d \to \mathbb{R}^d \times \mathbb{R}^d \\
  &amp; (x, p) \mapsto (\tilde{x}, \tilde{p}) := L_{\epsilon}(x, p)
\end{split}
\end{equation*}\]</span></p>
<p>as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p_{1 / 2} &amp;:= p + \frac{\epsilon}{2} \nabla \log \gamma(x) \\
  \tilde{x} &amp;:= x + \epsilon M^{-1} p_{1 /2 } \\
  p_1 &amp;:= p_{1 / 2} + \frac{\epsilon}{2} \nabla \log \gamma(\tilde{x}) \\
  \tilde{p} &amp;:= - p_1
\end{split}
\end{equation*}\]</span></p>
<p>This might be familiar for some readers as a single step of the Leapfrog integrator. We then define the MALA kernel as follows: given the current iterate <span class="math inline">\(x_i\)</span>, we sample the next iterate <span class="math inline">\(x_{i + 1}\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p &amp;\sim \mathcal{N}(0, M) \\
  (\tilde{x}, \tilde{p}) &amp;:= L_{\epsilon}(x_i, p) \\
  \alpha &amp;:= \min \left\{ 1, \frac{\bar{\gamma}(\tilde{x}, \tilde{p})}{\bar{\gamma}(x_i, p)} \right\} \\
  x_{i + 1} &amp;:=
  \begin{cases}
    \tilde{x} \quad &amp; \text{ with prob. } \alpha \\
    x_i       \quad &amp; \text{ with prob. } 1 - \alpha
  \end{cases}
\end{split}
\end{equation*}\]</span></p>
<p>i.e.&nbsp;we accept the proposal <span class="math inline">\(\tilde{x}\)</span> with probability <span class="math inline">\(\alpha\)</span> and reject it, thus sticking with our current iterate, with probability <span class="math inline">\(1 - \alpha\)</span>.</p>
</section>
<section id="what-we-need-from-a-model-logdensityproblems.jl" class="level2">
<h2 class="anchored" data-anchor-id="what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a></h2>
<p>There are a few things we need from the “target” / “model” / density that we want to sample from:</p>
<ol type="1">
<li>We need access to log-density <em>evaluations</em> <span class="math inline">\(\log \gamma(x)\)</span> so we can compute the acceptance ratio involving <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>We need access to log-density <em>gradients</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span> so we can compute the Leapfrog steps <span class="math inline">\(L_{\epsilon}(x, p)\)</span>.</li>
<li>We also need access to the “size” of the model so we can determine the size of <span class="math inline">\(M\)</span>.</li>
</ol>
<p>Luckily for us, there is a package called <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> which provides an interface for <em>exactly</em> this!</p>
<p>To demonstrate how one can implement the “<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface”<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> we will use a simple Gaussian model as an example:</p>
<div id="4" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblems</span>: LogDensityProblems;</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's define some type that represents the model.</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> IsotropicNormalModel{M<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"mean of the isotropic Gaussian"</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    mean<span class="op">::</span><span class="dt">M</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Specifies what input length the model expects.</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">dimension</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> <span class="fu">length</span>(model.mean)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Implementation of the log-density evaluation of the model.</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x<span class="op">::</span><span class="dt">AbstractVector{&lt;:Real}</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">-</span> <span class="fu">sum</span>(abs2, x <span class="op">.-</span> model.mean) <span class="op">/</span> <span class="fl">2</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This gives us all of the properties we want for our MALA sampler with the exception of the computation of the <em>gradient</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span>. There is the method <code>LogDensityProblems.logdensity_and_gradient</code> which should return a 2-tuple where the first entry is the evaluation of the logdensity <span class="math inline">\(\log \gamma(x)\)</span> and the second entry is the gradient <span class="math inline">\(\nabla \log \gamma(x)\)</span>.</p>
<p>There are two ways to “implement” this method: 1) we implement it by hand, which is feasible in the case of our <code>IsotropicNormalModel</code>, or b) we defer the implementation of this to a automatic differentiation backend.</p>
<p>To implement it by hand we can simply do</p>
<div id="6" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl that first-order, i.e. gradient information, is available.</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{1}</span>()</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Implement `logdensity_and_gradient`.</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    logγ_x <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="op">-</span>x <span class="op">.*</span> (x <span class="op">-</span> model.mean)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> logγ_x, ∇logγ_x</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s just try it out:</p>
<div id="8" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate the problem.</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> <span class="fu">IsotropicNormalModel</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.])</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create some example input that we can test on.</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>x_example <span class="op">=</span> <span class="fu">randn</span>(LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate!</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-29.05256113975947</code></pre>
</div>
</div>
<p>To defer it to an automatic differentiation backend, we can do</p>
<div id="10" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl we only have access to 0-th order information.</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{0}</span>()</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Use `LogDensityProblemsAD`'s `ADgradient` in combination with some AD backend to implement `logdensity_and_gradient`.</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblemsAD</span>, <span class="bu">ADTypes</span>, <span class="bu">ForwardDiff</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>model_with_grad <span class="op">=</span> <span class="fu">ADgradient</span>(<span class="fu">AutoForwardDiff</span>(), model)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model_with_grad, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-29.05256113975947</code></pre>
</div>
</div>
<p>We’ll continue with the second approach in this tutorial since this is typically what one does in practice, because there are better hobbies to spend time on than deriving gradients by hand.</p>
<p>At this point, one might wonder how we’re going to tie this back to Turing.jl in the end. Effectively, when working with inference methods that only require log-density evaluations and / or higher-order information of the log-density, Turing.jl actually converts the user-provided <code>Model</code> into an object implementing the above methods for <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>. As a result, most samplers provided by Turing.jl are actually implemented to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, enabling their use both <em>within</em> Turing.jl and <em>outside</em> of Turing.jl! Morever, there exists similar conversions for Stan through BridgeStan and Stan<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, which means that a sampler supporting the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface can easily be used on both Turing.jl <em>and</em> Stan models (in addition to user-provided models, as our <code>IsotropicNormalModel</code> above)!</p>
<p>Anyways, let’s move on to actually implementing the sampler.</p>
</section>
<section id="implementing-mala-in-abstractmcmc.jl" class="level2">
<h2 class="anchored" data-anchor-id="implementing-mala-in-abstractmcmc.jl">Implementing MALA in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a></h2>
<p>Now that we’ve established that a model implementing the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface provides us with all the information we need from <span class="math inline">\(\log \gamma(x)\)</span>, we can address the question: given an object that implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, how can we define a sampler for it?</p>
<p>We’re going to do this by making our sampler a sub-type of <code>AbstractMCMC.AbstractSampler</code> in addition to implementing a few methods from <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>. Why? Because it gets us <em>a lot</em> of functionality for free, as we will see later.</p>
<p>Moreover, <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> provides a very natural interface for MCMC algorithms.</p>
<p>First, we’ll define our <code>MALA</code> type</p>
<div id="12" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">AbstractMCMC</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALA{T,A} <span class="op">&lt;:</span><span class="dt"> AbstractMCMC.AbstractSampler</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"stepsize used in the leapfrog step"</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    ϵ_init<span class="op">::</span><span class="dt">T</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"covariance matrix used for the momentum"</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    M_init<span class="op">::</span><span class="dt">A</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notice how we’ve added the suffix <code>_init</code> to both the stepsize and the covariance matrix. We’ve done this because a <code>AbstractMCMC.AbstractSampler</code> should be <em>immutable</em>. Of course there might be many scenarios where we want to allow something like the stepsize and / or the covariance matrix to vary between iterations, e.g.&nbsp;during the burn-in / adaptation phase of the sampling process we might want to adjust the parameters using statistics computed from these initial iterations. But information which can change between iterations <em>should not go in the sampler itself</em>! Instead, this information should go in the sampler <em>state</em>.</p>
<p>The sampler state should at the very least contain all the necessary information to perform the next MCMC iteration, but usually contains further information, e.g.&nbsp;quantities and statistics useful for evaluating whether the sampler has converged.</p>
<p>We will use the following sampler state for our <code>MALA</code> sampler:</p>
<div id="14" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALAState{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This might seem overly redundant: we’re defining a type <code>MALAState</code> and it only contains a simple vector of reals. In this particular case we indeed could have dropped this and simply used a <code>AbstractVector{&lt;:Real}</code> as our sampler state, but typically, as we will see later, one wants to include other quantities in the sampler state. For example, if we also wanted to adapt the parameters of our <code>MALA</code>, e.g.&nbsp;alter the stepsize depending on acceptance rates, in which case we should also put <code>ϵ</code> in the state, but for now we’ll keep things simple.</p>
<p>Moreover, we also want a <em>sample</em> type, which is a type meant for “public consumption”, i.e.&nbsp;the end-user. This is generally going to contain a subset of the information present in the state. But in such a simple scenario as this, we similarly only have a <code>AbstractVector{&lt;:Real}</code>:</p>
<div id="16" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALASample{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We currently have three things:</p>
<ol type="1">
<li>A <code>AbstractMCMC.AbstractSampler</code> implementation called <code>MALA</code>.</li>
<li>A state <code>MALAState</code> for our sampler <code>MALA</code>.</li>
<li>A sample <code>MALASample</code> for our sampler <code>MALA</code>.</li>
</ol>
<p>That means that we’re ready to implement the only thing that really matters: <code>AbstractMCMC.step</code>.</p>
<p><code>AbstractMCMC.step</code> defines the MCMC iteration of our <code>MALA</code> given the current <code>MALAState</code>. Specifically, the signature of the function is as follows:</p>
<div id="18" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The RNG to ensure reproducibility.</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The model that defines our target.</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.AbstractModel</span>,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The sampler for which we're taking a `step`.</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">AbstractMCMC.AbstractSampler</span>,</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The current sampler `state`.</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    state;</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Additional keyword arguments that we may or may not need.</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Moreover, there is a specific <code>AbstractMCMC.AbstractModel</code> which is used to indicate that the model that is provided implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface: <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Since, as we discussed earlier, in our case we’re indeed going to work with types that support the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, we’ll define <code>AbstractMCMC.step</code> for such a <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Note that <code>AbstractMCMC.LogDensityModel</code> has no other purpose; it has a single field called <code>logdensity</code>, and it does nothing else. But by wrapping the model in <code>AbstractMCMC.LogDensityModel</code>, it allows samplers that want to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> to define their <code>AbstractMCMC.step</code> on this type without running into method ambiguities.</p>
<p>All in all, that means that the signature for our <code>AbstractMCMC.step</code> is going to be the following:</p>
<div id="20" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># `LogDensityModel` so we know we're working with LogDensityProblems.jl model.</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler.</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler state.</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Great! Now let’s actually implement the full <code>AbstractMCMC.step</code> for our <code>MALA</code>.</p>
<p>Let’s remind ourselves what we’re going to do:</p>
<ol type="1">
<li>Sample a new momentum <span class="math inline">\(p\)</span>.</li>
<li>Compute the log-density of the extended target <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>Take a single leapfrog step <span class="math inline">\((\tilde{x}, \tilde{p}) = L_{\epsilon}(x, p)\)</span>.</li>
<li>Accept or reject the proposed <span class="math inline">\((\tilde{x}, \tilde{p})\)</span>.</li>
</ol>
<p>All in all, this results in the following:</p>
<div id="22" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>: Random</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Distributions</span>  <span class="co"># so we get the `MvNormal`</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the wrapped model which implements LogDensityProblems.jl.</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just extract the sampler parameters to make our lives easier.</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    ϵ <span class="op">=</span> sampler.ϵ_init</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    M <span class="op">=</span> sampler.M_init</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the current parameters.</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> state.x</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sample the momentum.</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>    p_dist <span class="op">=</span> <span class="fu">MvNormal</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)), M)</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> <span class="fu">rand</span>(rng, p_dist)</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Propose using a single leapfrog step.</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>    x̃, p̃ <span class="op">=</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Accept or reject proposal.</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>    logp <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p)</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>    logp̃ <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x̃) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p̃)</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>    logα <span class="op">=</span> logp̃ <span class="op">-</span> logp</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>    state_new <span class="op">=</span> <span class="cf">if</span> <span class="fu">log</span>(<span class="fu">rand</span>(rng)) <span class="op">&lt;</span> logα</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Accept.</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x̃)</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Reject.</span></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x)</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return the "sample" and the sampler state.</span></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(state_new.x), state_new</span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Fairly straight-forward.</p>
<p>Of course, we haven’t defined the <code>leapfrog_step</code> method yet, so let’s do that:</p>
<div id="24" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p` using "position" `x`.</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x))</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    p1 <span class="op">=</span> p <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update the "position" `x` using momentum `p1`.</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    x̃ <span class="op">=</span> x <span class="op">+</span> ϵ <span class="op">.*</span> (M <span class="op">\</span> p1)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p1` using position `x̃`</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x̃ <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x̃))</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    p2 <span class="op">=</span> p1 <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x̃</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Flip momentum `p2`.</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    p̃ <span class="op">=</span> <span class="op">-</span>p2</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x̃, p̃</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>leapfrog_step (generic function with 1 method)</code></pre>
</div>
</div>
<p>With all of this, we’re technically ready to sample!</p>
<div id="26" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>, <span class="bu">LinearAlgebra</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>rng <span class="op">=</span> <span class="bu">Random</span>.<span class="fu">default_rng</span>()</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>sampler <span class="op">=</span> <span class="fu">MALA</span>(<span class="fl">1</span>, I)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>state <span class="op">=</span> <span class="fu">MALAState</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)))</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>x_next, state_next <span class="op">=</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    rng,</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    AbstractMCMC.<span class="fu">LogDensityModel</span>(model),</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    state</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>(MALASample{Vector{Float64}}([0.0, 0.0, 0.0]), MALAState{Vector{Float64}}([0.0, 0.0, 0.0]))</code></pre>
</div>
</div>
<p>Great, it works!</p>
<p>And I promised we would get quite some functionality for free if we implemented <code>AbstractMCMC.step</code>, and so we can now simply call <code>sample</code> to perform standard MCMC sampling:</p>
<div id="28" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform 1000 iterations with our `MALA` sampler.</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; initial_state<span class="op">=</span>state, progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Concatenate into a matrix.</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000 Matrix{Float64}:
 -2.64248  -3.04393   -3.56973   -4.65824   …  -4.83137   -3.16443   -3.65714
  1.81485   0.302498   0.624755  -0.250885      0.811605   0.289849  -1.00972
  2.64418   3.39097    3.24595    3.84305       5.8487     6.61832    5.61886</code></pre>
</div>
</div>
<div id="30" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the marginal means and standard deviations.</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -5.01776    1.00359
 -0.0113761  0.979945
  4.9752     1.01427</code></pre>
</div>
</div>
<p>Let’s visualize the samples</p>
<div id="32" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">StatsPlots</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">transpose</span>(samples_matrix[<span class="op">:</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">:</span><span class="kw">end</span>]), alpha<span class="op">=</span><span class="fl">0.5</span>, legend<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<!--?xml version="1.0" encoding="utf-8"?-->
<svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" width="672" height="480" viewbox="0 0 2688 1920">
<defs>
  <clippath id="clip580">
    <rect x="0" y="0" width="2688" height="1920"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip580)" d="M0 1920 L2688 1920 L2688 0 L0 0  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip581">
    <rect x="537" y="0" width="1883" height="1883"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip580)" d="M196.816 1800.78 L2640.76 1800.78 L2640.76 47.2441 L196.816 47.2441  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip582">
    <rect x="196" y="47" width="2445" height="1755"></rect>
  </clippath>
</defs>
<polyline clip-path="url(#clip582)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="263.676,1800.78 263.676,47.2441 "></polyline>
<polyline clip-path="url(#clip582)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="840.654,1800.78 840.654,47.2441 "></polyline>
<polyline clip-path="url(#clip582)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1417.63,1800.78 1417.63,47.2441 "></polyline>
<polyline clip-path="url(#clip582)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1994.61,1800.78 1994.61,47.2441 "></polyline>
<polyline clip-path="url(#clip582)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="2571.59,1800.78 2571.59,47.2441 "></polyline>
<polyline clip-path="url(#clip582)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,1639.94 2640.76,1639.94 "></polyline>
<polyline clip-path="url(#clip582)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,1388.31 2640.76,1388.31 "></polyline>
<polyline clip-path="url(#clip582)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,1136.68 2640.76,1136.68 "></polyline>
<polyline clip-path="url(#clip582)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,885.042 2640.76,885.042 "></polyline>
<polyline clip-path="url(#clip582)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,633.409 2640.76,633.409 "></polyline>
<polyline clip-path="url(#clip582)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,381.777 2640.76,381.777 "></polyline>
<polyline clip-path="url(#clip582)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,130.144 2640.76,130.144 "></polyline>
<polyline clip-path="url(#clip580)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1800.78 2640.76,1800.78 "></polyline>
<polyline clip-path="url(#clip580)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="263.676,1800.78 263.676,1781.88 "></polyline>
<polyline clip-path="url(#clip580)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="840.654,1800.78 840.654,1781.88 "></polyline>
<polyline clip-path="url(#clip580)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1417.63,1800.78 1417.63,1781.88 "></polyline>
<polyline clip-path="url(#clip580)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1994.61,1800.78 1994.61,1781.88 "></polyline>
<polyline clip-path="url(#clip580)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="2571.59,1800.78 2571.59,1781.88 "></polyline>
<path clip-path="url(#clip580)" d="M263.676 1834 Q260.065 1834 258.236 1837.57 Q256.431 1841.11 256.431 1848.24 Q256.431 1855.34 258.236 1858.91 Q260.065 1862.45 263.676 1862.45 Q267.31 1862.45 269.116 1858.91 Q270.945 1855.34 270.945 1848.24 Q270.945 1841.11 269.116 1837.57 Q267.31 1834 263.676 1834 M263.676 1830.3 Q269.486 1830.3 272.542 1834.9 Q275.621 1839.49 275.621 1848.24 Q275.621 1856.96 272.542 1861.57 Q269.486 1866.15 263.676 1866.15 Q257.866 1866.15 254.787 1861.57 Q251.732 1856.96 251.732 1848.24 Q251.732 1839.49 254.787 1834.9 Q257.866 1830.3 263.676 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip580)" d="M804.346 1861.55 L820.666 1861.55 L820.666 1865.48 L798.721 1865.48 L798.721 1861.55 Q801.383 1858.79 805.967 1854.16 Q810.573 1849.51 811.754 1848.17 Q813.999 1845.65 814.879 1843.91 Q815.782 1842.15 815.782 1840.46 Q815.782 1837.71 813.837 1835.97 Q811.916 1834.23 808.814 1834.23 Q806.615 1834.23 804.161 1835 Q801.731 1835.76 798.953 1837.31 L798.953 1832.59 Q801.777 1831.46 804.231 1830.88 Q806.684 1830.3 808.721 1830.3 Q814.092 1830.3 817.286 1832.98 Q820.481 1835.67 820.481 1840.16 Q820.481 1842.29 819.67 1844.21 Q818.883 1846.11 816.777 1848.7 Q816.198 1849.37 813.096 1852.59 Q809.995 1855.78 804.346 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip580)" d="M830.527 1830.92 L848.883 1830.92 L848.883 1834.86 L834.809 1834.86 L834.809 1843.33 Q835.828 1842.98 836.846 1842.82 Q837.865 1842.64 838.883 1842.64 Q844.67 1842.64 848.05 1845.81 Q851.43 1848.98 851.43 1854.4 Q851.43 1859.97 847.957 1863.08 Q844.485 1866.15 838.166 1866.15 Q835.99 1866.15 833.721 1865.78 Q831.476 1865.41 829.069 1864.67 L829.069 1859.97 Q831.152 1861.11 833.374 1861.66 Q835.596 1862.22 838.073 1862.22 Q842.078 1862.22 844.416 1860.11 Q846.754 1858.01 846.754 1854.4 Q846.754 1850.78 844.416 1848.68 Q842.078 1846.57 838.073 1846.57 Q836.198 1846.57 834.323 1846.99 Q832.471 1847.4 830.527 1848.28 L830.527 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip580)" d="M870.642 1834 Q867.031 1834 865.203 1837.57 Q863.397 1841.11 863.397 1848.24 Q863.397 1855.34 865.203 1858.91 Q867.031 1862.45 870.642 1862.45 Q874.277 1862.45 876.082 1858.91 Q877.911 1855.34 877.911 1848.24 Q877.911 1841.11 876.082 1837.57 Q874.277 1834 870.642 1834 M870.642 1830.3 Q876.453 1830.3 879.508 1834.9 Q882.587 1839.49 882.587 1848.24 Q882.587 1856.96 879.508 1861.57 Q876.453 1866.15 870.642 1866.15 Q864.832 1866.15 861.754 1861.57 Q858.698 1856.96 858.698 1848.24 Q858.698 1839.49 861.754 1834.9 Q864.832 1830.3 870.642 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip580)" d="M1377.25 1830.92 L1395.61 1830.92 L1395.61 1834.86 L1381.53 1834.86 L1381.53 1843.33 Q1382.55 1842.98 1383.57 1842.82 Q1384.59 1842.64 1385.61 1842.64 Q1391.39 1842.64 1394.77 1845.81 Q1398.15 1848.98 1398.15 1854.4 Q1398.15 1859.97 1394.68 1863.08 Q1391.21 1866.15 1384.89 1866.15 Q1382.71 1866.15 1380.44 1865.78 Q1378.2 1865.41 1375.79 1864.67 L1375.79 1859.97 Q1377.88 1861.11 1380.1 1861.66 Q1382.32 1862.22 1384.8 1862.22 Q1388.8 1862.22 1391.14 1860.11 Q1393.48 1858.01 1393.48 1854.4 Q1393.48 1850.78 1391.14 1848.68 Q1388.8 1846.57 1384.8 1846.57 Q1382.92 1846.57 1381.05 1846.99 Q1379.19 1847.4 1377.25 1848.28 L1377.25 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip580)" d="M1417.37 1834 Q1413.75 1834 1411.93 1837.57 Q1410.12 1841.11 1410.12 1848.24 Q1410.12 1855.34 1411.93 1858.91 Q1413.75 1862.45 1417.37 1862.45 Q1421 1862.45 1422.81 1858.91 Q1424.63 1855.34 1424.63 1848.24 Q1424.63 1841.11 1422.81 1837.57 Q1421 1834 1417.37 1834 M1417.37 1830.3 Q1423.18 1830.3 1426.23 1834.9 Q1429.31 1839.49 1429.31 1848.24 Q1429.31 1856.96 1426.23 1861.57 Q1423.18 1866.15 1417.37 1866.15 Q1411.56 1866.15 1408.48 1861.57 Q1405.42 1856.96 1405.42 1848.24 Q1405.42 1839.49 1408.48 1834.9 Q1411.56 1830.3 1417.37 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip580)" d="M1447.53 1834 Q1443.92 1834 1442.09 1837.57 Q1440.28 1841.11 1440.28 1848.24 Q1440.28 1855.34 1442.09 1858.91 Q1443.92 1862.45 1447.53 1862.45 Q1451.16 1862.45 1452.97 1858.91 Q1454.8 1855.34 1454.8 1848.24 Q1454.8 1841.11 1452.97 1837.57 Q1451.16 1834 1447.53 1834 M1447.53 1830.3 Q1453.34 1830.3 1456.39 1834.9 Q1459.47 1839.49 1459.47 1848.24 Q1459.47 1856.96 1456.39 1861.57 Q1453.34 1866.15 1447.53 1866.15 Q1441.72 1866.15 1438.64 1861.57 Q1435.58 1856.96 1435.58 1848.24 Q1435.58 1839.49 1438.64 1834.9 Q1441.72 1830.3 1447.53 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip580)" d="M1952.89 1830.92 L1975.11 1830.92 L1975.11 1832.91 L1962.56 1865.48 L1957.68 1865.48 L1969.48 1834.86 L1952.89 1834.86 L1952.89 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip580)" d="M1984.27 1830.92 L2002.63 1830.92 L2002.63 1834.86 L1988.56 1834.86 L1988.56 1843.33 Q1989.58 1842.98 1990.59 1842.82 Q1991.61 1842.64 1992.63 1842.64 Q1998.42 1842.64 2001.8 1845.81 Q2005.18 1848.98 2005.18 1854.4 Q2005.18 1859.97 2001.7 1863.08 Q1998.23 1866.15 1991.91 1866.15 Q1989.74 1866.15 1987.47 1865.78 Q1985.22 1865.41 1982.82 1864.67 L1982.82 1859.97 Q1984.9 1861.11 1987.12 1861.66 Q1989.34 1862.22 1991.82 1862.22 Q1995.83 1862.22 1998.16 1860.11 Q2000.5 1858.01 2000.5 1854.4 Q2000.5 1850.78 1998.16 1848.68 Q1995.83 1846.57 1991.82 1846.57 Q1989.95 1846.57 1988.07 1846.99 Q1986.22 1847.4 1984.27 1848.28 L1984.27 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip580)" d="M2024.39 1834 Q2020.78 1834 2018.95 1837.57 Q2017.14 1841.11 2017.14 1848.24 Q2017.14 1855.34 2018.95 1858.91 Q2020.78 1862.45 2024.39 1862.45 Q2028.02 1862.45 2029.83 1858.91 Q2031.66 1855.34 2031.66 1848.24 Q2031.66 1841.11 2029.83 1837.57 Q2028.02 1834 2024.39 1834 M2024.39 1830.3 Q2030.2 1830.3 2033.26 1834.9 Q2036.33 1839.49 2036.33 1848.24 Q2036.33 1856.96 2033.26 1861.57 Q2030.2 1866.15 2024.39 1866.15 Q2018.58 1866.15 2015.5 1861.57 Q2012.45 1856.96 2012.45 1848.24 Q2012.45 1839.49 2015.5 1834.9 Q2018.58 1830.3 2024.39 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip580)" d="M2516.11 1861.55 L2523.75 1861.55 L2523.75 1835.18 L2515.44 1836.85 L2515.44 1832.59 L2523.71 1830.92 L2528.38 1830.92 L2528.38 1861.55 L2536.02 1861.55 L2536.02 1865.48 L2516.11 1865.48 L2516.11 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip580)" d="M2555.47 1834 Q2551.85 1834 2550.03 1837.57 Q2548.22 1841.11 2548.22 1848.24 Q2548.22 1855.34 2550.03 1858.91 Q2551.85 1862.45 2555.47 1862.45 Q2559.1 1862.45 2560.9 1858.91 Q2562.73 1855.34 2562.73 1848.24 Q2562.73 1841.11 2560.9 1837.57 Q2559.1 1834 2555.47 1834 M2555.47 1830.3 Q2561.28 1830.3 2564.33 1834.9 Q2567.41 1839.49 2567.41 1848.24 Q2567.41 1856.96 2564.33 1861.57 Q2561.28 1866.15 2555.47 1866.15 Q2549.66 1866.15 2546.58 1861.57 Q2543.52 1856.96 2543.52 1848.24 Q2543.52 1839.49 2546.58 1834.9 Q2549.66 1830.3 2555.47 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip580)" d="M2585.63 1834 Q2582.02 1834 2580.19 1837.57 Q2578.38 1841.11 2578.38 1848.24 Q2578.38 1855.34 2580.19 1858.91 Q2582.02 1862.45 2585.63 1862.45 Q2589.26 1862.45 2591.07 1858.91 Q2592.9 1855.34 2592.9 1848.24 Q2592.9 1841.11 2591.07 1837.57 Q2589.26 1834 2585.63 1834 M2585.63 1830.3 Q2591.44 1830.3 2594.49 1834.9 Q2597.57 1839.49 2597.57 1848.24 Q2597.57 1856.96 2594.49 1861.57 Q2591.44 1866.15 2585.63 1866.15 Q2579.82 1866.15 2576.74 1861.57 Q2573.68 1856.96 2573.68 1848.24 Q2573.68 1839.49 2576.74 1834.9 Q2579.82 1830.3 2585.63 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip580)" d="M2615.79 1834 Q2612.18 1834 2610.35 1837.57 Q2608.54 1841.11 2608.54 1848.24 Q2608.54 1855.34 2610.35 1858.91 Q2612.18 1862.45 2615.79 1862.45 Q2619.42 1862.45 2621.23 1858.91 Q2623.06 1855.34 2623.06 1848.24 Q2623.06 1841.11 2621.23 1837.57 Q2619.42 1834 2615.79 1834 M2615.79 1830.3 Q2621.6 1830.3 2624.65 1834.9 Q2627.73 1839.49 2627.73 1848.24 Q2627.73 1856.96 2624.65 1861.57 Q2621.6 1866.15 2615.79 1866.15 Q2609.98 1866.15 2606.9 1861.57 Q2603.84 1856.96 2603.84 1848.24 Q2603.84 1839.49 2606.9 1834.9 Q2609.98 1830.3 2615.79 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip580)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1800.78 196.816,47.2441 "></polyline>
<polyline clip-path="url(#clip580)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1639.94 215.714,1639.94 "></polyline>
<polyline clip-path="url(#clip580)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1388.31 215.714,1388.31 "></polyline>
<polyline clip-path="url(#clip580)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1136.68 215.714,1136.68 "></polyline>
<polyline clip-path="url(#clip580)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,885.042 215.714,885.042 "></polyline>
<polyline clip-path="url(#clip580)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,633.409 215.714,633.409 "></polyline>
<polyline clip-path="url(#clip580)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,381.777 215.714,381.777 "></polyline>
<polyline clip-path="url(#clip580)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,130.144 215.714,130.144 "></polyline>
<path clip-path="url(#clip580)" d="M50.5475 1640.39 L80.2233 1640.39 L80.2233 1644.33 L50.5475 1644.33 L50.5475 1640.39 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip580)" d="M89.1352 1622.66 L111.357 1622.66 L111.357 1624.65 L98.8111 1657.22 L93.9269 1657.22 L105.732 1626.6 L89.1352 1626.6 L89.1352 1622.66 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip580)" d="M120.478 1651.34 L125.362 1651.34 L125.362 1657.22 L120.478 1657.22 L120.478 1651.34 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip580)" d="M135.593 1622.66 L153.95 1622.66 L153.95 1626.6 L139.876 1626.6 L139.876 1635.07 Q140.894 1634.72 141.913 1634.56 Q142.931 1634.37 143.95 1634.37 Q149.737 1634.37 153.116 1637.55 Q156.496 1640.72 156.496 1646.13 Q156.496 1651.71 153.024 1654.81 Q149.552 1657.89 143.232 1657.89 Q141.056 1657.89 138.788 1657.52 Q136.542 1657.15 134.135 1656.41 L134.135 1651.71 Q136.218 1652.85 138.441 1653.4 Q140.663 1653.96 143.14 1653.96 Q147.144 1653.96 149.482 1651.85 Q151.82 1649.74 151.82 1646.13 Q151.82 1642.52 149.482 1640.42 Q147.144 1638.31 143.14 1638.31 Q141.265 1638.31 139.39 1638.73 Q137.538 1639.14 135.593 1640.02 L135.593 1622.66 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip580)" d="M49.5521 1388.76 L79.2279 1388.76 L79.2279 1392.69 L49.5521 1392.69 L49.5521 1388.76 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip580)" d="M89.3667 1371.03 L107.723 1371.03 L107.723 1374.96 L93.6491 1374.96 L93.6491 1383.44 Q94.6676 1383.09 95.6861 1382.93 Q96.7047 1382.74 97.7232 1382.74 Q103.51 1382.74 106.89 1385.91 Q110.269 1389.08 110.269 1394.5 Q110.269 1400.08 106.797 1403.18 Q103.325 1406.26 97.0056 1406.26 Q94.8297 1406.26 92.5612 1405.89 Q90.3158 1405.52 87.9084 1404.78 L87.9084 1400.08 Q89.9917 1401.21 92.2139 1401.77 Q94.4361 1402.32 96.913 1402.32 Q100.918 1402.32 103.256 1400.22 Q105.593 1398.11 105.593 1394.5 Q105.593 1390.89 103.256 1388.78 Q100.918 1386.68 96.913 1386.68 Q95.038 1386.68 93.163 1387.09 Q91.3112 1387.51 89.3667 1388.39 L89.3667 1371.03 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip580)" d="M119.482 1399.71 L124.367 1399.71 L124.367 1405.59 L119.482 1405.59 L119.482 1399.71 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip580)" d="M144.552 1374.11 Q140.941 1374.11 139.112 1377.67 Q137.306 1381.21 137.306 1388.34 Q137.306 1395.45 139.112 1399.01 Q140.941 1402.56 144.552 1402.56 Q148.186 1402.56 149.991 1399.01 Q151.82 1395.45 151.82 1388.34 Q151.82 1381.21 149.991 1377.67 Q148.186 1374.11 144.552 1374.11 M144.552 1370.4 Q150.362 1370.4 153.417 1375.01 Q156.496 1379.59 156.496 1388.34 Q156.496 1397.07 153.417 1401.68 Q150.362 1406.26 144.552 1406.26 Q138.741 1406.26 135.663 1401.68 Q132.607 1397.07 132.607 1388.34 Q132.607 1379.59 135.663 1375.01 Q138.741 1370.4 144.552 1370.4 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip580)" d="M50.5475 1137.13 L80.2233 1137.13 L80.2233 1141.06 L50.5475 1141.06 L50.5475 1137.13 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip580)" d="M94.3436 1150.02 L110.663 1150.02 L110.663 1153.96 L88.7186 1153.96 L88.7186 1150.02 Q91.3806 1147.27 95.9639 1142.64 Q100.57 1137.98 101.751 1136.64 Q103.996 1134.12 104.876 1132.38 Q105.779 1130.62 105.779 1128.93 Q105.779 1126.18 103.834 1124.44 Q101.913 1122.71 98.8111 1122.71 Q96.6121 1122.71 94.1584 1123.47 Q91.7278 1124.23 88.9501 1125.78 L88.9501 1121.06 Q91.7741 1119.93 94.2278 1119.35 Q96.6815 1118.77 98.7185 1118.77 Q104.089 1118.77 107.283 1121.46 Q110.478 1124.14 110.478 1128.63 Q110.478 1130.76 109.668 1132.68 Q108.881 1134.58 106.774 1137.17 Q106.195 1137.84 103.094 1141.06 Q99.9917 1144.26 94.3436 1150.02 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip580)" d="M120.478 1148.08 L125.362 1148.08 L125.362 1153.96 L120.478 1153.96 L120.478 1148.08 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip580)" d="M135.593 1119.4 L153.95 1119.4 L153.95 1123.33 L139.876 1123.33 L139.876 1131.8 Q140.894 1131.46 141.913 1131.29 Q142.931 1131.11 143.95 1131.11 Q149.737 1131.11 153.116 1134.28 Q156.496 1137.45 156.496 1142.87 Q156.496 1148.45 153.024 1151.55 Q149.552 1154.63 143.232 1154.63 Q141.056 1154.63 138.788 1154.26 Q136.542 1153.89 134.135 1153.15 L134.135 1148.45 Q136.218 1149.58 138.441 1150.14 Q140.663 1150.69 143.14 1150.69 Q147.144 1150.69 149.482 1148.58 Q151.82 1146.48 151.82 1142.87 Q151.82 1139.26 149.482 1137.15 Q147.144 1135.04 143.14 1135.04 Q141.265 1135.04 139.39 1135.46 Q137.538 1135.88 135.593 1136.76 L135.593 1119.4 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip580)" d="M99.3204 870.841 Q95.7093 870.841 93.8806 874.406 Q92.075 877.948 92.075 885.077 Q92.075 892.184 93.8806 895.748 Q95.7093 899.29 99.3204 899.29 Q102.955 899.29 104.76 895.748 Q106.589 892.184 106.589 885.077 Q106.589 877.948 104.76 874.406 Q102.955 870.841 99.3204 870.841 M99.3204 867.137 Q105.131 867.137 108.186 871.744 Q111.265 876.327 111.265 885.077 Q111.265 893.804 108.186 898.41 Q105.131 902.994 99.3204 902.994 Q93.5102 902.994 90.4315 898.41 Q87.376 893.804 87.376 885.077 Q87.376 876.327 90.4315 871.744 Q93.5102 867.137 99.3204 867.137 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip580)" d="M119.482 896.443 L124.367 896.443 L124.367 902.322 L119.482 902.322 L119.482 896.443 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip580)" d="M144.552 870.841 Q140.941 870.841 139.112 874.406 Q137.306 877.948 137.306 885.077 Q137.306 892.184 139.112 895.748 Q140.941 899.29 144.552 899.29 Q148.186 899.29 149.991 895.748 Q151.82 892.184 151.82 885.077 Q151.82 877.948 149.991 874.406 Q148.186 870.841 144.552 870.841 M144.552 867.137 Q150.362 867.137 153.417 871.744 Q156.496 876.327 156.496 885.077 Q156.496 893.804 153.417 898.41 Q150.362 902.994 144.552 902.994 Q138.741 902.994 135.663 898.41 Q132.607 893.804 132.607 885.077 Q132.607 876.327 135.663 871.744 Q138.741 867.137 144.552 867.137 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip580)" d="M94.3436 646.754 L110.663 646.754 L110.663 650.689 L88.7186 650.689 L88.7186 646.754 Q91.3806 644 95.9639 639.37 Q100.57 634.717 101.751 633.375 Q103.996 630.852 104.876 629.116 Q105.779 627.356 105.779 625.666 Q105.779 622.912 103.834 621.176 Q101.913 619.44 98.8111 619.44 Q96.6121 619.44 94.1584 620.204 Q91.7278 620.967 88.9501 622.518 L88.9501 617.796 Q91.7741 616.662 94.2278 616.083 Q96.6815 615.504 98.7185 615.504 Q104.089 615.504 107.283 618.19 Q110.478 620.875 110.478 625.366 Q110.478 627.495 109.668 629.416 Q108.881 631.315 106.774 633.907 Q106.195 634.578 103.094 637.796 Q99.9917 640.99 94.3436 646.754 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip580)" d="M120.478 644.81 L125.362 644.81 L125.362 650.689 L120.478 650.689 L120.478 644.81 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip580)" d="M135.593 616.129 L153.95 616.129 L153.95 620.065 L139.876 620.065 L139.876 628.537 Q140.894 628.19 141.913 628.028 Q142.931 627.842 143.95 627.842 Q149.737 627.842 153.116 631.014 Q156.496 634.185 156.496 639.602 Q156.496 645.18 153.024 648.282 Q149.552 651.361 143.232 651.361 Q141.056 651.361 138.788 650.99 Q136.542 650.62 134.135 649.879 L134.135 645.18 Q136.218 646.315 138.441 646.87 Q140.663 647.426 143.14 647.426 Q147.144 647.426 149.482 645.319 Q151.82 643.213 151.82 639.602 Q151.82 635.99 149.482 633.884 Q147.144 631.778 143.14 631.778 Q141.265 631.778 139.39 632.194 Q137.538 632.611 135.593 633.491 L135.593 616.129 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip580)" d="M89.3667 364.497 L107.723 364.497 L107.723 368.432 L93.6491 368.432 L93.6491 376.904 Q94.6676 376.557 95.6861 376.395 Q96.7047 376.209 97.7232 376.209 Q103.51 376.209 106.89 379.381 Q110.269 382.552 110.269 387.969 Q110.269 393.547 106.797 396.649 Q103.325 399.728 97.0056 399.728 Q94.8297 399.728 92.5612 399.357 Q90.3158 398.987 87.9084 398.246 L87.9084 393.547 Q89.9917 394.682 92.2139 395.237 Q94.4361 395.793 96.913 395.793 Q100.918 395.793 103.256 393.686 Q105.593 391.58 105.593 387.969 Q105.593 384.358 103.256 382.251 Q100.918 380.145 96.913 380.145 Q95.038 380.145 93.163 380.561 Q91.3112 380.978 89.3667 381.858 L89.3667 364.497 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip580)" d="M119.482 393.177 L124.367 393.177 L124.367 399.057 L119.482 399.057 L119.482 393.177 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip580)" d="M144.552 367.575 Q140.941 367.575 139.112 371.14 Q137.306 374.682 137.306 381.811 Q137.306 388.918 139.112 392.483 Q140.941 396.024 144.552 396.024 Q148.186 396.024 149.991 392.483 Q151.82 388.918 151.82 381.811 Q151.82 374.682 149.991 371.14 Q148.186 367.575 144.552 367.575 M144.552 363.872 Q150.362 363.872 153.417 368.478 Q156.496 373.061 156.496 381.811 Q156.496 390.538 153.417 395.145 Q150.362 399.728 144.552 399.728 Q138.741 399.728 135.663 395.145 Q132.607 390.538 132.607 381.811 Q132.607 373.061 135.663 368.478 Q138.741 363.872 144.552 363.872 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip580)" d="M89.1352 112.864 L111.357 112.864 L111.357 114.854 L98.8111 147.424 L93.9269 147.424 L105.732 116.799 L89.1352 116.799 L89.1352 112.864 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip580)" d="M120.478 141.544 L125.362 141.544 L125.362 147.424 L120.478 147.424 L120.478 141.544 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip580)" d="M135.593 112.864 L153.95 112.864 L153.95 116.799 L139.876 116.799 L139.876 125.271 Q140.894 124.924 141.913 124.762 Q142.931 124.577 143.95 124.577 Q149.737 124.577 153.116 127.748 Q156.496 130.919 156.496 136.336 Q156.496 141.914 153.024 145.016 Q149.552 148.095 143.232 148.095 Q141.056 148.095 138.788 147.725 Q136.542 147.354 134.135 146.613 L134.135 141.914 Q136.218 143.049 138.441 143.604 Q140.663 144.16 143.14 144.16 Q147.144 144.16 149.482 142.053 Q151.82 139.947 151.82 136.336 Q151.82 132.725 149.482 130.618 Q147.144 128.512 143.14 128.512 Q141.265 128.512 139.39 128.928 Q137.538 129.345 135.593 130.225 L135.593 112.864 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip582)" style="stroke:#009af9; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="265.984,1151.02 268.292,1407.36 270.6,1410.68 272.908,1405.02 275.216,1497.37 277.524,1366.83 279.832,1494.4 282.139,1353.74 284.447,1338.8 286.755,1363.19 289.063,1484.97 291.371,1259.22 293.679,1574.25 295.987,1502.66 298.295,1598.81 300.603,1395.72 302.911,1469.13 305.219,1524.3 307.527,1284.59 309.834,1342.55 312.142,1486.38 314.45,1489.2 316.758,1465.75 319.066,1257.53 321.374,1150.76 323.682,1243.76 325.99,1482.99 328.298,1389.43 330.606,1280.99 332.914,1420.49 335.221,1313.03 337.529,1486.4 339.837,1486.37 342.145,1304.9 344.453,1432.41 346.761,1523.91 349.069,1533.14 351.377,1386.02 353.685,1323.78 355.993,1635.22 358.301,1373.59 360.608,1322.53 362.916,1671.03 365.224,1416.8 367.532,1486.39 369.84,1145.53 372.148,1376.72 374.456,1571.69 376.764,1263.16 379.072,1285.25 381.38,1369.53 383.688,1405.33 385.996,1249.52 388.303,1342.89 390.611,1495.31 392.919,1498.01 395.227,1302.99 397.535,1286.55 399.843,1391.42 402.151,1481.32 404.459,1380.53 406.767,1300.13 409.075,1335.35 411.383,1235.12 413.69,1329.68 415.998,1379.55 418.306,1325.69 420.614,1390.06 422.922,1333.01 425.23,1312.14 427.538,1427.66 429.846,1539.22 432.154,1336.34 434.462,1271.94 436.77,1334.05 439.077,1621.23 441.385,1751.15 443.693,1465.58 446.001,1409.9 448.309,1359.49 450.617,1481.91 452.925,1488.04 455.233,1342.42 457.541,1436.02 459.849,1404.57 462.157,1323.16 464.465,1440.2 466.772,1292.5 469.08,1619.04 471.388,1607.13 473.696,1521.88 476.004,1510.87 478.312,1426.59 480.62,1491.84 482.928,1517.51 485.236,1380.49 487.544,1417.92 489.852,1316.65 492.159,1341.96 494.467,1355.95 496.775,1329.99 499.083,1633.74 501.391,1412.22 503.699,1343.77 506.007,1458.72 508.315,1377.16 510.623,1350.44 512.931,1356.18 515.239,1141.48 517.546,1409.37 519.854,1491.56 522.162,1263.78 524.47,1329.52 526.778,1338.32 529.086,1454.38 531.394,1497.91 533.702,1244.54 536.01,1486.52 538.318,1358.88 540.626,1559.14 542.933,1462.82 545.241,1461.85 547.549,1318.08 549.857,1309.98 552.165,1394.53 554.473,1436.18 556.781,1437.26 559.089,1359.51 561.397,1501.28 563.705,1355.34 566.013,1407.26 568.321,1260.69 570.628,1443.14 572.936,1386.08 575.244,1204.78 577.552,1387.6 579.86,1314.75 582.168,1384.94 584.476,1367.58 586.784,1745.28 589.092,1288.22 591.4,1321.44 593.708,1192.62 596.015,1288.37 598.323,1445.19 600.631,1327.57 602.939,1385.89 605.247,1268.84 607.555,1374.53 609.863,1488.64 612.171,1352.36 614.479,1335.35 616.787,1308.13 619.095,1380.41 621.402,1336.88 623.71,1592.51 626.018,1346.66 628.326,1346.97 630.634,1505.65 632.942,1323.25 635.25,1458.49 637.558,1346.12 639.866,1229.79 642.174,1447.41 644.482,1543.83 646.79,1283.67 649.097,1334.86 651.405,1373.99 653.713,1313.26 656.021,1321.69 658.329,1404.15 660.637,1454.77 662.945,1333.92 665.253,1249.84 667.561,1405.01 669.869,1540.3 672.177,1382.89 674.484,1379.08 676.792,1483.84 679.1,1285.6 681.408,1391.95 683.716,1531.62 686.024,1528.92 688.332,1463.11 690.64,1351.17 692.948,1339.75 695.256,1439.88 697.564,1513.82 699.871,1360.37 702.179,1413.68 704.487,1360.91 706.795,1330.89 709.103,1340.71 711.411,1346.29 713.719,1344.19 716.027,1328.21 718.335,1387.21 720.643,1334.03 722.951,1197.57 725.259,1334.35 727.566,1410.53 729.874,1176.62 732.182,1465.16 734.49,1366.52 736.798,1498.92 739.106,1426.69 741.414,1191.58 743.722,1667.81 746.03,1428.95 748.338,1402.12 750.646,1500.64 752.953,1398.76 755.261,1113.84 757.569,1484.04 759.877,1430.76 762.185,1322.68 764.493,1372.63 766.801,1309.42 769.109,1343.02 771.417,1341.49 773.725,1215.91 776.033,1419.1 778.34,1405.73 780.648,1361.01 782.956,1365.98 785.264,1397.1 787.572,1342.78 789.88,1388.37 792.188,1424.15 794.496,1526.73 796.804,1290.21 799.112,1367.5 801.42,1470.12 803.728,1422.01 806.035,1439.39 808.343,1602.09 810.651,1341.02 812.959,1464.3 815.267,1509.48 817.575,1351.9 819.883,1286.32 822.191,1408.45 824.499,1413.11 826.807,1455.58 829.115,1460.3 831.422,1435.29 833.73,1488.97 836.038,1475.23 838.346,1439.72 840.654,1510.53 842.962,1409.96 845.27,1550.17 847.578,1266.3 849.886,1409.66 852.194,1478.82 854.502,1410.4 856.809,1578.5 859.117,1407.41 861.425,1455.14 863.733,1325.67 866.041,1593.47 868.349,1538.04 870.657,1412.14 872.965,1369.31 875.273,1359.01 877.581,1411.18 879.889,1544.33 882.197,1307.4 884.504,1308.26 886.812,1332.14 889.12,1282.39 891.428,1239.72 893.736,1382.65 896.044,1438.35 898.352,1421.98 900.66,1536.25 902.968,1429.27 905.276,1512.24 907.584,1433.31 909.891,1476.09 912.199,1343.77 914.507,1185.61 916.815,1428.56 919.123,1484.76 921.431,1486.19 923.739,1450.9 926.047,1488.13 928.355,1430.01 930.663,1411.51 932.971,1354.69 935.278,1515.93 937.586,1382.7 939.894,1444.44 942.202,1360.59 944.51,1470.96 946.818,1250.47 949.126,1514.27 951.434,1469.46 953.742,1295.07 956.05,1310.92 958.358,1480.65 960.665,1179.13 962.973,1351.89 965.281,1297.6 967.589,1255.99 969.897,1417.68 972.205,1424.65 974.513,1448.02 976.821,1609.97 979.129,1741.69 981.437,1352.48 983.745,1473.97 986.053,1441.62 988.36,1389.98 990.668,1239.15 992.976,1188.32 995.284,1527.87 997.592,1319.83 999.9,1444.05 1002.21,1323.88 1004.52,1395.48 1006.82,1512.07 1009.13,1394.88 1011.44,1336.01 1013.75,1220.67 1016.06,1442.56 1018.36,1599.31 1020.67,1349.84 1022.98,1453.66 1025.29,1489.6 1027.59,1436.13 1029.9,1295.44 1032.21,1299.6 1034.52,1569.86 1036.83,1530.1 1039.13,1518.1 1041.44,1329.85 1043.75,1242.26 1046.06,1250.52 1048.37,1255.57 1050.67,1203.03 1052.98,1458.55 1055.29,1368.54 1057.6,1441.59 1059.91,1332.86 1062.21,1495.54 1064.52,1301.84 1066.83,1517.71 1069.14,1339.41 1071.45,1582.77 1073.75,1441.02 1076.06,1250.86 1078.37,1366 1080.68,1386.45 1082.98,1547.84 1085.29,1509.27 1087.6,1269.55 1089.91,1420.48 1092.22,1302.88 1094.52,1557.92 1096.83,1437.41 1099.14,1328.86 1101.45,1498.8 1103.76,1185.17 1106.06,1296.5 1108.37,1357.92 1110.68,1499.66 1112.99,1365.07 1115.3,1383.3 1117.6,1232.31 1119.91,1253.84 1122.22,1400.67 1124.53,1345.86 1126.84,1495.1 1129.14,1482.85 1131.45,1727.95 1133.76,1629.15 1136.07,1293.44 1138.37,1290.07 1140.68,1329.83 1142.99,1554.46 1145.3,1267.85 1147.61,1330.41 1149.91,1499.34 1152.22,1424.43 1154.53,1463.52 1156.84,1366.3 1159.15,1298.87 1161.45,1242.15 1163.76,1363.44 1166.07,1472.91 1168.38,1347.25 1170.69,1415.88 1172.99,1365.1 1175.3,1570.09 1177.61,1561.52 1179.92,1491.77 1182.23,1427.05 1184.53,1322.94 1186.84,1473.4 1189.15,1202.93 1191.46,1395.7 1193.76,1317.85 1196.07,1302.15 1198.38,1372.56 1200.69,1321.05 1203,1372.7 1205.3,1411.79 1207.61,1277.71 1209.92,1470.59 1212.23,1473.01 1214.54,1339.64 1216.84,1375.97 1219.15,1509.4 1221.46,1530.89 1223.77,1309.79 1226.08,1288.23 1228.38,1457.04 1230.69,1426.42 1233,1566.73 1235.31,1429.45 1237.61,1388 1239.92,1300.94 1242.23,1372.91 1244.54,1336.64 1246.85,1352.04 1249.15,1562.98 1251.46,1556.69 1253.77,1350.17 1256.08,1314.86 1258.39,1426.56 1260.69,1330.55 1263,1338.57 1265.31,1216.98 1267.62,1483.09 1269.93,1225.03 1272.23,1472.08 1274.54,1329.69 1276.85,1525.59 1279.16,1411.69 1281.47,1511.15 1283.77,1405.08 1286.08,1376.63 1288.39,1319.94 1290.7,1553.61 1293,1614.22 1295.31,1420.73 1297.62,1323.08 1299.93,1513.53 1302.24,1503.17 1304.54,1494.49 1306.85,1204.79 1309.16,1339.36 1311.47,1273.84 1313.78,1527.13 1316.08,1325.22 1318.39,1473.33 1320.7,1401.11 1323.01,1275.47 1325.32,1575.85 1327.62,1627.66 1329.93,1298.16 1332.24,1274.08 1334.55,1450.34 1336.86,1509.09 1339.16,1447.01 1341.47,1399.06 1343.78,1577.05 1346.09,1421.24 1348.39,1580.43 1350.7,1303.85 1353.01,1451.33 1355.32,1323.47 1357.63,1356.1 1359.93,1384.73 1362.24,1499.48 1364.55,1489.74 1366.86,1557.81 1369.17,1321.52 1371.47,1418.67 1373.78,1278.53 1376.09,1312.02 1378.4,1361.7 1380.71,1528.56 1383.01,1466.2 1385.32,1254.34 1387.63,1228.04 1389.94,1397.31 1392.24,1422.62 1394.55,1489.3 1396.86,1348.23 1399.17,1343.12 1401.48,1378.5 1403.78,1398.68 1406.09,1339.3 1408.4,1385.15 1410.71,1414.63 1413.02,1248.48 1415.32,1385.65 1417.63,1540.55 1419.94,1488.16 1422.25,1331.07 1424.56,1334.47 1426.86,1328.44 1429.17,1437.18 1431.48,1571.43 1433.79,1235.07 1436.1,1313.34 1438.4,1262.63 1440.71,1319.82 1443.02,1356.76 1445.33,1457.22 1447.63,1425.65 1449.94,1202.95 1452.25,1545.35 1454.56,1431.49 1456.87,1466.34 1459.17,1216.62 1461.48,1534.2 1463.79,1472.5 1466.1,1417.72 1468.41,1546.52 1470.71,1512.12 1473.02,1380.55 1475.33,1276.01 1477.64,1466 1479.95,1281.23 1482.25,1568.72 1484.56,1314.54 1486.87,1529.56 1489.18,1282.34 1491.49,1340.19 1493.79,1380.66 1496.1,1478.64 1498.41,1414.38 1500.72,1549.06 1503.02,1449.78 1505.33,1490.78 1507.64,1431.09 1509.95,1448.5 1512.26,1460.62 1514.56,1157.3 1516.87,1306.36 1519.18,1558 1521.49,1317.5 1523.8,1465.86 1526.1,1423.75 1528.41,1325.64 1530.72,1463.88 1533.03,1534.82 1535.34,1429.66 1537.64,1365.05 1539.95,1386.88 1542.26,1476.85 1544.57,1418.88 1546.88,1485.25 1549.18,1422.86 1551.49,1273.95 1553.8,1369.85 1556.11,1322.63 1558.41,1451.78 1560.72,1544.8 1563.03,1488.29 1565.34,1236.7 1567.65,1362.89 1569.95,1262.53 1572.26,1321.74 1574.57,1245.19 1576.88,1460.9 1579.19,1517.18 1581.49,1208.3 1583.8,1374.55 1586.11,1373.42 1588.42,1218.56 1590.73,1488.73 1593.03,1421.36 1595.34,1293.29 1597.65,1383.83 1599.96,1356.05 1602.26,1216.63 1604.57,1508.02 1606.88,1387.76 1609.19,1308.99 1611.5,1192.62 1613.8,1371.29 1616.11,1265.07 1618.42,1143.08 1620.73,1298.31 1623.04,1419.37 1625.34,1348.98 1627.65,1338.84 1629.96,1462.2 1632.27,1535.35 1634.58,1364.47 1636.88,1408.18 1639.19,1380.53 1641.5,1379.68 1643.81,1276.01 1646.12,1395.81 1648.42,1364.42 1650.73,1319.13 1653.04,1221.99 1655.35,1282.84 1657.65,1443.74 1659.96,1478.1 1662.27,1373.01 1664.58,1538.7 1666.89,1428.92 1669.19,1463.28 1671.5,1335.11 1673.81,1418.66 1676.12,1411.75 1678.43,1409.98 1680.73,1345.15 1683.04,1261.5 1685.35,1466.52 1687.66,1365.43 1689.97,1343.05 1692.27,1406.81 1694.58,1323.27 1696.89,1491.53 1699.2,1497.02 1701.51,1421.64 1703.81,1303.82 1706.12,1217.89 1708.43,1560.53 1710.74,1274.28 1713.04,1309.87 1715.35,1198.6 1717.66,1331.19 1719.97,1329.99 1722.28,1401.1 1724.58,1348.24 1726.89,1258.87 1729.2,1396.96 1731.51,1453.76 1733.82,1407.41 1736.12,1536.57 1738.43,1391.68 1740.74,1448.14 1743.05,1356.8 1745.36,1328.94 1747.66,1379.69 1749.97,1399.38 1752.28,1462.2 1754.59,1412.8 1756.9,1431.87 1759.2,1333.25 1761.51,1517.79 1763.82,1379.77 1766.13,1267.86 1768.43,1281.44 1770.74,1270.13 1773.05,1469.72 1775.36,1308.56 1777.67,1503.48 1779.97,1208.63 1782.28,1295.53 1784.59,1460.88 1786.9,1296.91 1789.21,1397.89 1791.51,1247.97 1793.82,1405.36 1796.13,1234.82 1798.44,1451.34 1800.75,1420.34 1803.05,1609.63 1805.36,1326.21 1807.67,1490.74 1809.98,1689.2 1812.28,1254.92 1814.59,1268.69 1816.9,1487.4 1819.21,1543.49 1821.52,1465.14 1823.82,1428.46 1826.13,1406.32 1828.44,1354.21 1830.75,1384.55 1833.06,1424.75 1835.36,1298.27 1837.67,1442.04 1839.98,1242.55 1842.29,1451.28 1844.6,1319.11 1846.9,1275.99 1849.21,1383.53 1851.52,1268.98 1853.83,1311.63 1856.14,1421.41 1858.44,1425.66 1860.75,1443.21 1863.06,1289.93 1865.37,1335.42 1867.67,1428.2 1869.98,1499.38 1872.29,1144.8 1874.6,1278.54 1876.91,1467.1 1879.21,1394.35 1881.52,1350.15 1883.83,1556.82 1886.14,1336.13 1888.45,1215.82 1890.75,1436.12 1893.06,1410.43 1895.37,1298.55 1897.68,1456.24 1899.99,1324.33 1902.29,1358.13 1904.6,1468.1 1906.91,1407.36 1909.22,1386.13 1911.53,1360.21 1913.83,1458.94 1916.14,1551.19 1918.45,1434.41 1920.76,1181.86 1923.06,1275.21 1925.37,1354.9 1927.68,1252.82 1929.99,1584.13 1932.3,1476.73 1934.6,1298.55 1936.91,1236.79 1939.22,1319.82 1941.53,1368.13 1943.84,1536.31 1946.14,1399.61 1948.45,1414.58 1950.76,1328.79 1953.07,1597.22 1955.38,1292.1 1957.68,1203.85 1959.99,1392.31 1962.3,1513.65 1964.61,1423.6 1966.91,1387.72 1969.22,1209.45 1971.53,1452.68 1973.84,1509.79 1976.15,1288.28 1978.45,1317.54 1980.76,1292.28 1983.07,1484.62 1985.38,1414.05 1987.69,1395.71 1989.99,1285.78 1992.3,1437.02 1994.61,1408.6 1996.92,1410.43 1999.23,1270.29 2001.53,1530.72 2003.84,1334.51 2006.15,1470.86 2008.46,1276.41 2010.77,1566.82 2013.07,1286.73 2015.38,1350.43 2017.69,1393.43 2020,1233.24 2022.3,1226.28 2024.61,1379.07 2026.92,1513.5 2029.23,1218.24 2031.54,1353.22 2033.84,1419.17 2036.15,1488.48 2038.46,1402.96 2040.77,1416.48 2043.08,1327.01 2045.38,1518.25 2047.69,1465.57 2050,1424.35 2052.31,1311.23 2054.62,1406.77 2056.92,1301.63 2059.23,1174.15 2061.54,1427.53 2063.85,1269.16 2066.16,1434.9 2068.46,1465.16 2070.77,1401.19 2073.08,1419.79 2075.39,1326.12 2077.69,1376.32 2080,1282.06 2082.31,1378.59 2084.62,1380.54 2086.93,1507.18 2089.23,1575.99 2091.54,1612.06 2093.85,1314.83 2096.16,1340.18 2098.47,1267.18 2100.77,1477.54 2103.08,1412.11 2105.39,1433.2 2107.7,1339.7 2110.01,1273.63 2112.31,1479.06 2114.62,1407.21 2116.93,1277.96 2119.24,1280.02 2121.55,1343.89 2123.85,1482.32 2126.16,1289.4 2128.47,1453.7 2130.78,1530.15 2133.08,1333.69 2135.39,1427.39 2137.7,1450.76 2140.01,1455.11 2142.32,1302.13 2144.62,1407.89 2146.93,1494.71 2149.24,1382.99 2151.55,1479.08 2153.86,1376.28 2156.16,1374.82 2158.47,1393.38 2160.78,1402.61 2163.09,1350.08 2165.4,1433.15 2167.7,1304.76 2170.01,1307.12 2172.32,1427.49 2174.63,1382.49 2176.93,1418.96 2179.24,1410.89 2181.55,1380.45 2183.86,1485.53 2186.17,1470.27 2188.47,1347.09 2190.78,1288.9 2193.09,1484.44 2195.4,1520.07 2197.71,1413.03 2200.01,1505.74 2202.32,1286.67 2204.63,1417.63 2206.94,1414.78 2209.25,1186.69 2211.55,1301.39 2213.86,1360.49 2216.17,1160.77 2218.48,1342.81 2220.79,1435.24 2223.09,1542.5 2225.4,1457.01 2227.71,1185.99 2230.02,1400.39 2232.32,1418.25 2234.63,1435.41 2236.94,1307.39 2239.25,1557.87 2241.56,1331.7 2243.86,1490.77 2246.17,1652.28 2248.48,1497.14 2250.79,1360.1 2253.1,1331.59 2255.4,1243.37 2257.71,1428.04 2260.02,1445.94 2262.33,1430.55 2264.64,1498.87 2266.94,1292.41 2269.25,1384.74 2271.56,1466.94 2273.87,1243.22 2276.18,1259.92 2278.48,1459.92 2280.79,1376.46 2283.1,1393.65 2285.41,1356.05 2287.71,1270.15 2290.02,1377.04 2292.33,1477.08 2294.64,1368.46 2296.95,1410.09 2299.25,1322.18 2301.56,1464.96 2303.87,1374.78 2306.18,1294.8 2308.49,1224.62 2310.79,1340.24 2313.1,1364.45 2315.41,1554.28 2317.72,1366 2320.03,1418.64 2322.33,1275.85 2324.64,1387.03 2326.95,1468.45 2329.26,1345.54 2331.56,1498.61 2333.87,1224.81 2336.18,1379.71 2338.49,1395.79 2340.8,1421.41 2343.1,1437.08 2345.41,1354.1 2347.72,1500.27 2350.03,1400.77 2352.34,1383.67 2354.64,1408.81 2356.95,1236.52 2359.26,1670.42 2361.57,1456.76 2363.88,1210.87 2366.18,1508.69 2368.49,1414.46 2370.8,1370.09 2373.11,1489.96 2375.42,1613.39 2377.72,1497.65 2380.03,1422.31 2382.34,1602.94 2384.65,1460.57 2386.95,1389.12 2389.26,1242.27 2391.57,1401.97 2393.88,1376.47 2396.19,1314.4 2398.49,1476.01 2400.8,1319.71 2403.11,1427.52 2405.42,1394.83 2407.73,1367.6 2410.03,1525.64 2412.34,1499.01 2414.65,1462.52 2416.96,1399.05 2419.27,1345.17 2421.57,1607.51 2423.88,1419.14 2426.19,1140.85 2428.5,1346.21 2430.81,1522.83 2433.11,1361.04 2435.42,1467.96 2437.73,1402.98 2440.04,1356.36 2442.34,1487.95 2444.65,1310.05 2446.96,1396.78 2449.27,1424.73 2451.58,1440 2453.88,1363.89 2456.19,1285.55 2458.5,1627.07 2460.81,1434.8 2463.12,1396.78 2465.42,1248.87 2467.73,1305.79 2470.04,1501.84 2472.35,1205.35 2474.66,1456.61 2476.96,1435.23 2479.27,1316.29 2481.58,1594.93 2483.89,1330.89 2486.2,1422.68 2488.5,1312.9 2490.81,1294.99 2493.12,1388.8 2495.43,1408.98 2497.73,1303.02 2500.04,1449.08 2502.35,1363.79 2504.66,1335.05 2506.97,1409.61 2509.27,1142.39 2511.58,1341.72 2513.89,1450.45 2516.2,1494.86 2518.51,1508.32 2520.81,1205.66 2523.12,1221.37 2525.43,1396.35 2527.74,1388.18 2530.05,1228.65 2532.35,1236.61 2534.66,1402.07 2536.97,1416.61 2539.28,1354.6 2541.58,1349.63 2543.89,1318.3 2546.2,1398.28 2548.51,1299.95 2550.82,1470.2 2553.12,1337.24 2555.43,1371.33 2557.74,1361.89 2560.05,1395.61 2562.36,1239.11 2564.66,1196.06 2566.97,1520.5 2569.28,1168.05 2571.59,1498.14 "></polyline>
<polyline clip-path="url(#clip582)" style="stroke:#e26f46; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="265.984,702.372 268.292,922.806 270.6,784.955 272.908,849.167 275.216,802.726 277.524,799.607 279.832,980.492 282.139,768.155 284.447,927.644 286.755,757.983 289.063,752.754 291.371,959.386 293.679,835.608 295.987,928.2 298.295,871.285 300.603,902.661 302.911,795.268 305.219,904.618 307.527,706.555 309.834,956.073 312.142,890.157 314.45,923.879 316.758,891.853 319.066,869.825 321.374,986.244 323.682,894.262 325.99,755.985 328.298,776.481 330.606,803.777 332.914,981.908 335.221,1033.15 337.529,832.473 339.837,885.277 342.145,866.924 344.453,964.421 346.761,911.334 349.069,884.398 351.377,920.194 353.685,1000.7 355.993,956.933 358.301,908.414 360.608,885.003 362.916,960.477 365.224,861.573 367.532,756.547 369.84,818.901 372.148,812.419 374.456,703.748 376.764,732.208 379.072,960.367 381.38,1012.25 383.688,912.02 385.996,808.911 388.303,905.6 390.611,932.876 392.919,779.612 395.227,832.428 397.535,976.234 399.843,1033.39 402.151,1025.85 404.459,969.006 406.767,869.254 409.075,983.398 411.383,699.096 413.69,889.386 415.998,1007.17 418.306,869.775 420.614,920.847 422.922,1049.58 425.23,811.26 427.538,873.24 429.846,1027.97 432.154,651.96 434.462,971.06 436.77,889.535 439.077,763.001 441.385,784.47 443.693,963.609 446.001,885.091 448.309,904.036 450.617,946.562 452.925,866.711 455.233,829.045 457.541,714.471 459.849,757.03 462.157,891.39 464.465,868.071 466.772,933.519 469.08,830.92 471.388,926.664 473.696,971.164 476.004,861.814 478.312,875.801 480.62,889 482.928,800.787 485.236,939.926 487.544,830.234 489.852,708.367 492.159,616.893 494.467,729.794 496.775,929.588 499.083,777.66 501.391,927.532 503.699,959.804 506.007,773.328 508.315,911.438 510.623,861.363 512.931,908.296 515.239,1024.67 517.546,808.721 519.854,968.229 522.162,808.588 524.47,738.901 526.778,854.639 529.086,835.068 531.394,924.994 533.702,843.719 536.01,946.236 538.318,801.525 540.626,875.126 542.933,711.315 545.241,1012.7 547.549,957.606 549.857,963.956 552.165,804.417 554.473,996.154 556.781,982.293 559.089,936.03 561.397,911.353 563.705,810.28 566.013,1042.09 568.321,870.663 570.628,1139.55 572.936,872.812 575.244,954.328 577.552,779.214 579.86,855.549 582.168,759.51 584.476,951.291 586.784,973.06 589.092,855.978 591.4,906.309 593.708,897.058 596.015,739.085 598.323,860.098 600.631,921.244 602.939,932.48 605.247,953.186 607.555,802.456 609.863,1009.12 612.171,923.061 614.479,692.429 616.787,981.511 619.095,970.724 621.402,811.292 623.71,964.769 626.018,888.048 628.326,845.699 630.634,822.117 632.942,844.186 635.25,949.404 637.558,910.836 639.866,740.495 642.174,973.799 644.482,731.556 646.79,904.264 649.097,805.736 651.405,930.359 653.713,1016.36 656.021,896.54 658.329,709.202 660.637,1017.1 662.945,866.501 665.253,981.892 667.561,865.991 669.869,976.131 672.177,997.625 674.484,1045.44 676.792,815.974 679.1,938.446 681.408,976.206 683.716,792.49 686.024,617.383 688.332,1133.96 690.64,973.808 692.948,818.187 695.256,931.219 697.564,1081.47 699.871,922.42 702.179,785.378 704.487,922.893 706.795,892.974 709.103,895.187 711.411,939.167 713.719,1019.56 716.027,923.591 718.335,891.599 720.643,777.816 722.951,924.918 725.259,769.325 727.566,1001.12 729.874,774.633 732.182,862.709 734.49,858.189 736.798,1036.52 739.106,895.925 741.414,862.348 743.722,826.768 746.03,785.297 748.338,854.649 750.646,905.034 752.953,846.609 755.261,972.999 757.569,895.279 759.877,865.453 762.185,967.517 764.493,946.204 766.801,846.405 769.109,927.635 771.417,878.18 773.725,980.366 776.033,969.147 778.34,789.93 780.648,946.337 782.956,681.367 785.264,809.548 787.572,683.478 789.88,936.528 792.188,1036.84 794.496,936.984 796.804,879.511 799.112,904.135 801.42,878.299 803.728,823.916 806.035,967.141 808.343,1024.47 810.651,1142.63 812.959,940.881 815.267,851.379 817.575,884.639 819.883,915.889 822.191,822.565 824.499,925.981 826.807,959.293 829.115,1023.57 831.422,932.452 833.73,1028.35 836.038,716.01 838.346,942.533 840.654,753.512 842.962,920.891 845.27,636.499 847.578,931.544 849.886,1007.97 852.194,1026.78 854.502,871.902 856.809,793.152 859.117,864.066 861.425,782.763 863.733,823.936 866.041,934.045 868.349,935.278 870.657,928.572 872.965,831.835 875.273,1006.58 877.581,826.88 879.889,1023.49 882.197,822.937 884.504,884.474 886.812,859.63 889.12,947.446 891.428,966.382 893.736,791.992 896.044,817.099 898.352,992.373 900.66,1074.6 902.968,818.158 905.276,864.225 907.584,963.905 909.891,846.759 912.199,886.532 914.507,899.84 916.815,720.019 919.123,951.587 921.431,774.369 923.739,944.936 926.047,932.653 928.355,875.595 930.663,1111.55 932.971,919.864 935.278,959.008 937.586,835.251 939.894,990.196 942.202,1025.72 944.51,871.569 946.818,912.461 949.126,855.932 951.434,1019.42 953.742,737.802 956.05,845.848 958.358,881.723 960.665,726.172 962.973,949.882 965.281,986.078 967.589,968.988 969.897,982.261 972.205,848.021 974.513,1043.3 976.821,928.072 979.129,992.999 981.437,689.054 983.745,638.222 986.053,772.324 988.36,791.613 990.668,971.626 992.976,972.087 995.284,1003.03 997.592,1014.44 999.9,793.661 1002.21,954.167 1004.52,1006.21 1006.82,1067.39 1009.13,944.973 1011.44,1038.4 1013.75,839.699 1016.06,692.752 1018.36,796.867 1020.67,955.239 1022.98,805.474 1025.29,817.881 1027.59,1016.97 1029.9,812.695 1032.21,877.227 1034.52,993.666 1036.83,821.928 1039.13,863.485 1041.44,771.944 1043.75,1018.5 1046.06,948.256 1048.37,844.125 1050.67,932.864 1052.98,771.797 1055.29,830.888 1057.6,909.366 1059.91,1019.03 1062.21,874.478 1064.52,934.122 1066.83,825.66 1069.14,888.189 1071.45,986.459 1073.75,877.46 1076.06,892.93 1078.37,991.329 1080.68,945.91 1082.98,704.176 1085.29,890.082 1087.6,963.348 1089.91,948.819 1092.22,885.27 1094.52,803.353 1096.83,992.195 1099.14,879.89 1101.45,1003.21 1103.76,1027.55 1106.06,796.787 1108.37,953.184 1110.68,976.844 1112.99,905.288 1115.3,966.876 1117.6,866.803 1119.91,1011.49 1122.22,955.609 1124.53,919.103 1126.84,748.513 1129.14,903.769 1131.45,833.619 1133.76,910.523 1136.07,1016.61 1138.37,880.425 1140.68,889.32 1142.99,795.66 1145.3,818.491 1147.61,615.718 1149.91,1000.64 1152.22,935.825 1154.53,922.012 1156.84,732.769 1159.15,891.651 1161.45,820.867 1163.76,769.904 1166.07,796.577 1168.38,792.182 1170.69,921.431 1172.99,997.081 1175.3,932.456 1177.61,901.887 1179.92,825.389 1182.23,869.033 1184.53,827.394 1186.84,914.771 1189.15,913.488 1191.46,970.425 1193.76,1174.71 1196.07,885.308 1198.38,1022.85 1200.69,808.312 1203,848.2 1205.3,1017.82 1207.61,745.775 1209.92,955.755 1212.23,721.411 1214.54,1130.5 1216.84,744.01 1219.15,912.686 1221.46,791.277 1223.77,826.164 1226.08,910.662 1228.38,956.837 1230.69,678.783 1233,883.676 1235.31,987.653 1237.61,1008.14 1239.92,1037.19 1242.23,788.893 1244.54,906.622 1246.85,988.693 1249.15,981.574 1251.46,942.271 1253.77,827.226 1256.08,898.735 1258.39,690.032 1260.69,888.108 1263,964.244 1265.31,934.404 1267.62,782.707 1269.93,742.058 1272.23,1103.93 1274.54,922.515 1276.85,935.405 1279.16,858.647 1281.47,1029.94 1283.77,942.648 1286.08,753.37 1288.39,968.597 1290.7,1040.62 1293,993.453 1295.31,960.561 1297.62,931.79 1299.93,821.722 1302.24,878.29 1304.54,1012.65 1306.85,898.74 1309.16,856.938 1311.47,788.116 1313.78,997.618 1316.08,966.38 1318.39,828.342 1320.7,944.088 1323.01,820.917 1325.32,976.249 1327.62,925.594 1329.93,776.469 1332.24,858.941 1334.55,938.097 1336.86,834.875 1339.16,811.233 1341.47,938.042 1343.78,831.773 1346.09,803.024 1348.39,782.213 1350.7,778.965 1353.01,902.33 1355.32,874.809 1357.63,799.606 1359.93,851.91 1362.24,1004.81 1364.55,793.221 1366.86,1062.29 1369.17,779.772 1371.47,843.929 1373.78,848.447 1376.09,880.823 1378.4,802.857 1380.71,1008.95 1383.01,808.192 1385.32,1007.47 1387.63,846.623 1389.94,1035.82 1392.24,883.05 1394.55,712.493 1396.86,799.133 1399.17,896.384 1401.48,982.732 1403.78,719.328 1406.09,961.99 1408.4,942.061 1410.71,1023.74 1413.02,965.287 1415.32,865.186 1417.63,867.36 1419.94,1011.85 1422.25,833.882 1424.56,875.91 1426.86,848.301 1429.17,741.192 1431.48,776.498 1433.79,784.409 1436.1,989.778 1438.4,904.325 1440.71,975.572 1443.02,999.89 1445.33,755.243 1447.63,894.806 1449.94,584.162 1452.25,913.6 1454.56,983.214 1456.87,881.497 1459.17,917.705 1461.48,991.242 1463.79,991.658 1466.1,987.943 1468.41,885.97 1470.71,866.219 1473.02,977.821 1475.33,1034.82 1477.64,738.414 1479.95,821.891 1482.25,914.899 1484.56,979.511 1486.87,778.397 1489.18,901.755 1491.49,920.931 1493.79,694.94 1496.1,925.707 1498.41,975.926 1500.72,883.504 1503.02,969.552 1505.33,882.247 1507.64,790.035 1509.95,742.252 1512.26,944.467 1514.56,893.11 1516.87,717.542 1519.18,924.079 1521.49,705.457 1523.8,1006.45 1526.1,912.687 1528.41,888.254 1530.72,932.453 1533.03,974.188 1535.34,994.168 1537.64,656.273 1539.95,862.916 1542.26,847.552 1544.57,878.08 1546.88,906.954 1549.18,847.792 1551.49,906.373 1553.8,850.177 1556.11,902.808 1558.41,1027.16 1560.72,925.188 1563.03,762.614 1565.34,878.857 1567.65,969.217 1569.95,834.959 1572.26,1050.09 1574.57,999.391 1576.88,925.828 1579.19,925.994 1581.49,904.949 1583.8,893.052 1586.11,1052.27 1588.42,875.544 1590.73,801.249 1593.03,865.091 1595.34,877.402 1597.65,812.359 1599.96,940.734 1602.26,746.365 1604.57,802.2 1606.88,933.737 1609.19,1037.67 1611.5,827.306 1613.8,911.112 1616.11,774.611 1618.42,763.173 1620.73,847.697 1623.04,815.115 1625.34,965.417 1627.65,1038.89 1629.96,1106.8 1632.27,834.282 1634.58,928.281 1636.88,838.089 1639.19,942.854 1641.5,790.971 1643.81,924.427 1646.12,1011.48 1648.42,970.71 1650.73,1081.07 1653.04,889.833 1655.35,861.833 1657.65,949.555 1659.96,916.014 1662.27,962.75 1664.58,920.157 1666.89,770.204 1669.19,862.705 1671.5,735.716 1673.81,981.348 1676.12,909.22 1678.43,1065.69 1680.73,773.582 1683.04,794.037 1685.35,900.132 1687.66,851.092 1689.97,764.458 1692.27,941.76 1694.58,1092.36 1696.89,849.073 1699.2,755.319 1701.51,890.17 1703.81,874.116 1706.12,973.479 1708.43,896.342 1710.74,927.309 1713.04,1030.15 1715.35,791.665 1717.66,962.89 1719.97,921.482 1722.28,867.781 1724.58,865.428 1726.89,887.628 1729.2,905.006 1731.51,871.89 1733.82,959.734 1736.12,771.782 1738.43,776.987 1740.74,998.449 1743.05,1064.99 1745.36,856.18 1747.66,755.553 1749.97,839.042 1752.28,900.679 1754.59,840.423 1756.9,992.98 1759.2,970.378 1761.51,841.424 1763.82,598.376 1766.13,742.798 1768.43,833.809 1770.74,1092.85 1773.05,786.911 1775.36,737.327 1777.67,790.976 1779.97,1104.88 1782.28,728.714 1784.59,832.068 1786.9,927.109 1789.21,887.8 1791.51,932.381 1793.82,951.828 1796.13,821.348 1798.44,780.928 1800.75,901.938 1803.05,765.704 1805.36,760.538 1807.67,780.213 1809.98,897.025 1812.28,820.569 1814.59,1003.19 1816.9,931.083 1819.21,939.025 1821.52,658.373 1823.82,690.391 1826.13,984.873 1828.44,948.336 1830.75,903.059 1833.06,919.172 1835.36,969.682 1837.67,906.995 1839.98,758.841 1842.29,959.173 1844.6,940.432 1846.9,857.574 1849.21,1003.55 1851.52,776.87 1853.83,796.39 1856.14,948.266 1858.44,1022.24 1860.75,748.01 1863.06,1003.96 1865.37,774.164 1867.67,898.392 1869.98,879.235 1872.29,955.028 1874.6,961.892 1876.91,919.161 1879.21,839.796 1881.52,894.25 1883.83,867.397 1886.14,904.921 1888.45,831.919 1890.75,1049.1 1893.06,810.174 1895.37,712.979 1897.68,917.47 1899.99,679.814 1902.29,907.807 1904.6,829.768 1906.91,863.125 1909.22,812.449 1911.53,827.09 1913.83,866.061 1916.14,956.394 1918.45,738.287 1920.76,1048.59 1923.06,898.845 1925.37,1009.16 1927.68,713.846 1929.99,737.527 1932.3,772.506 1934.6,863.284 1936.91,825.97 1939.22,967.573 1941.53,1024.21 1943.84,888.202 1946.14,813.73 1948.45,893.915 1950.76,684.333 1953.07,879.586 1955.38,864.33 1957.68,820.574 1959.99,894.058 1962.3,810.246 1964.61,1005.52 1966.91,885.011 1969.22,910.559 1971.53,979.619 1973.84,806.616 1976.15,727.637 1978.45,885.496 1980.76,1077.94 1983.07,816.388 1985.38,861.748 1987.69,832.349 1989.99,819.751 1992.3,938.148 1994.61,969.753 1996.92,816.062 1999.23,1060.5 2001.53,934.707 2003.84,804.429 2006.15,863.263 2008.46,666.814 2010.77,921.988 2013.07,834.322 2015.38,803.505 2017.69,874.561 2020,1009.07 2022.3,921.135 2024.61,907.54 2026.92,905.462 2029.23,935.07 2031.54,1112.86 2033.84,887.287 2036.15,975.761 2038.46,841.636 2040.77,1040.22 2043.08,813.952 2045.38,785.024 2047.69,1046.34 2050,936.465 2052.31,983.369 2054.62,915.961 2056.92,916.024 2059.23,975.625 2061.54,814.462 2063.85,897.98 2066.16,599.681 2068.46,817.044 2070.77,853.384 2073.08,936.028 2075.39,926.141 2077.69,867.964 2080,825.022 2082.31,841.678 2084.62,779.521 2086.93,728.208 2089.23,971.74 2091.54,749.505 2093.85,794.467 2096.16,945.591 2098.47,875.456 2100.77,896.745 2103.08,794.265 2105.39,944.311 2107.7,806.232 2110.01,1122 2112.31,916.766 2114.62,988.66 2116.93,778.694 2119.24,900.572 2121.55,941.614 2123.85,854.024 2126.16,821.228 2128.47,859.14 2130.78,945.2 2133.08,1076.91 2135.39,940.713 2137.7,963.52 2140.01,819.141 2142.32,905.491 2144.62,880.394 2146.93,926.42 2149.24,912.569 2151.55,729.591 2153.86,773.571 2156.16,693.255 2158.47,946.369 2160.78,998.975 2163.09,681.7 2165.4,958.221 2167.7,716.41 2170.01,975.274 2172.32,745.716 2174.63,901.502 2176.93,971.451 2179.24,903.084 2181.55,961.28 2183.86,881.499 2186.17,858.368 2188.47,767.728 2190.78,983.774 2193.09,940.767 2195.4,918.286 2197.71,851.441 2200.01,715.69 2202.32,918.986 2204.63,784.202 2206.94,818.124 2209.25,833.155 2211.55,922.137 2213.86,942.183 2216.17,813.637 2218.48,824.971 2220.79,884.35 2223.09,845.103 2225.4,837.175 2227.71,788.292 2230.02,672.43 2232.32,934.252 2234.63,931.763 2236.94,873.416 2239.25,1008.84 2241.56,904.633 2243.86,694.825 2246.17,967.539 2248.48,959.421 2250.79,919.655 2253.1,953.096 2255.4,861.114 2257.71,902.578 2260.02,911.133 2262.33,960.638 2264.64,956.021 2266.94,943.126 2269.25,881.154 2271.56,935.954 2273.87,661.255 2276.18,905.506 2278.48,751.118 2280.79,921.24 2283.1,816.05 2285.41,884.973 2287.71,854.241 2290.02,1024.9 2292.33,920.681 2294.64,711.283 2296.95,970.066 2299.25,813.579 2301.56,972.155 2303.87,915.765 2306.18,943.92 2308.49,934.493 2310.79,965.333 2313.1,1014.53 2315.41,923.23 2317.72,990.358 2320.03,867.107 2322.33,827.979 2324.64,963.258 2326.95,806.762 2329.26,827.158 2331.56,1053.67 2333.87,915.465 2336.18,751.796 2338.49,797.239 2340.8,1051.84 2343.1,813.228 2345.41,961.055 2347.72,912.605 2350.03,830.985 2352.34,918.677 2354.64,885.888 2356.95,1023.12 2359.26,1015.29 2361.57,775.7 2363.88,734.597 2366.18,923.738 2368.49,784.382 2370.8,692.078 2373.11,885.021 2375.42,899.66 2377.72,769.51 2380.03,962.765 2382.34,1089.15 2384.65,889.897 2386.95,794.839 2389.26,959.93 2391.57,870.118 2393.88,1044.33 2396.19,768.381 2398.49,815.635 2400.8,863.146 2403.11,962.217 2405.42,801.103 2407.73,962.737 2410.03,876.762 2412.34,832.786 2414.65,836.826 2416.96,948.887 2419.27,993.699 2421.57,847.609 2423.88,894.297 2426.19,902.248 2428.5,750.983 2430.81,745.996 2433.11,625.999 2435.42,882.193 2437.73,936.373 2440.04,755.308 2442.34,947.93 2444.65,905.482 2446.96,793.817 2449.27,928.503 2451.58,988.278 2453.88,931.985 2456.19,1028.83 2458.5,825.875 2460.81,1024.07 2463.12,726.06 2465.42,719.109 2467.73,680.582 2470.04,911.292 2472.35,1005.06 2474.66,883.813 2476.96,819.724 2479.27,1000.39 2481.58,933.532 2483.89,800.166 2486.2,852.484 2488.5,804.291 2490.81,981.409 2493.12,957.982 2495.43,766.445 2497.73,1042.17 2500.04,907.262 2502.35,903.186 2504.66,950.916 2506.97,768.544 2509.27,867.577 2511.58,794.696 2513.89,895.058 2516.2,840.586 2518.51,803.074 2520.81,823.191 2523.12,984.783 2525.43,844.843 2527.74,779.71 2530.05,899.875 2532.35,1101.69 2534.66,955.392 2536.97,967.351 2539.28,925.924 2541.58,847.616 2543.89,667.283 2546.2,888.9 2548.51,966.326 2550.82,1007.09 2553.12,962.724 2555.43,921.669 2557.74,837.29 2560.05,726.636 2562.36,854.214 2564.66,994.916 2566.97,1105.03 2569.28,834.682 2571.59,818.038 "></polyline>
<polyline clip-path="url(#clip582)" style="stroke:#3da44d; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="265.984,618.898 268.292,552.359 270.6,311.015 272.908,286.202 275.216,455.293 277.524,538.003 279.832,504.81 282.139,544.648 284.447,220.815 286.755,434.038 289.063,372.568 291.371,242.482 293.679,429.749 295.987,450.373 298.295,373.329 300.603,303.581 302.911,434.94 305.219,658.67 307.527,468.794 309.834,334.929 312.142,417.025 314.45,223.715 316.758,362.878 319.066,327.515 321.374,409.883 323.682,261.628 325.99,335.506 328.298,257.158 330.606,452.157 332.914,222.265 335.221,339.483 337.529,199.163 339.837,440.839 342.145,394.575 344.453,463.146 346.761,465.61 349.069,417.188 351.377,641.051 353.685,502.196 355.993,496.91 358.301,237.614 360.608,410.503 362.916,401.869 365.224,437.528 367.532,343.658 369.84,488.539 372.148,425.346 374.456,262.691 376.764,295.627 379.072,317.441 381.38,531.657 383.688,398.404 385.996,530.508 388.303,339.541 390.611,204.77 392.919,543.125 395.227,489.961 397.535,324.97 399.843,593.658 402.151,261.529 404.459,376.931 406.767,412.698 409.075,492.525 411.383,517.326 413.69,320.554 415.998,207.37 418.306,402.522 420.614,516.537 422.922,384.483 425.23,518.572 427.538,444.588 429.846,418.887 432.154,272.621 434.462,364.547 436.77,318.111 439.077,372.415 441.385,456.091 443.693,420.172 446.001,374.283 448.309,386.572 450.617,552.051 452.925,595.292 455.233,371.451 457.541,433.285 459.849,360.816 462.157,477.166 464.465,378.571 466.772,367.497 469.08,465.954 471.388,444.663 473.696,338.823 476.004,364.945 478.312,398.822 480.62,404.379 482.928,390.548 485.236,232.211 487.544,515.06 489.852,436.276 492.159,421.499 494.467,196.94 496.775,288.421 499.083,316.897 501.391,343.184 503.699,492.463 506.007,365.235 508.315,454.089 510.623,296.126 512.931,498.786 515.239,256.882 517.546,428.759 519.854,209.586 522.162,317.315 524.47,398.233 526.778,625.059 529.086,387.578 531.394,429.352 533.702,502.108 536.01,386.197 538.318,461.526 540.626,391.11 542.933,379.975 545.241,572.643 547.549,367.236 549.857,336.523 552.165,404.3 554.473,369.963 556.781,287.802 559.089,354.343 561.397,387.048 563.705,564.524 566.013,405.088 568.321,415.297 570.628,265.111 572.936,414.568 575.244,544.011 577.552,351.271 579.86,313.265 582.168,514.218 584.476,336.218 586.784,389.65 589.092,521.998 591.4,425.564 593.708,395.293 596.015,206.001 598.323,517.135 600.631,414.174 602.939,409.049 605.247,390.889 607.555,461.936 609.863,551.502 612.171,408.714 614.479,435.066 616.787,462.816 619.095,314.68 621.402,173.81 623.71,437.984 626.018,356.479 628.326,362.84 630.634,328.092 632.942,497.769 635.25,378.609 637.558,281.064 639.866,338.887 642.174,383.76 644.482,466.719 646.79,315.037 649.097,301.593 651.405,294.243 653.713,330.375 656.021,462.293 658.329,382.971 660.637,380.954 662.945,272.174 665.253,366.717 667.561,458.743 669.869,438.956 672.177,352.441 674.484,235.102 676.792,392.108 679.1,203.909 681.408,540.729 683.716,394.708 686.024,383.923 688.332,380.818 690.64,404.098 692.948,359.478 695.256,457.956 697.564,440.219 699.871,448.806 702.179,412.553 704.487,303.551 706.795,485.646 709.103,269.547 711.411,545.722 713.719,357.335 716.027,409.077 718.335,255.117 720.643,458.944 722.951,290.2 725.259,410.702 727.566,414.089 729.874,379.789 732.182,517.296 734.49,206.204 736.798,313.424 739.106,435.374 741.414,350.881 743.722,491.505 746.03,469.557 748.338,293.007 750.646,354.066 752.953,216.318 755.261,211.832 757.569,353.844 759.877,462.041 762.185,514.887 764.493,421.593 766.801,355.669 769.109,353.071 771.417,422.306 773.725,287.732 776.033,473.865 778.34,359.921 780.648,311.991 782.956,238.879 785.264,318.297 787.572,354.046 789.88,250.679 792.188,117.728 794.496,378.871 796.804,375.89 799.112,604.123 801.42,394.514 803.728,244.48 806.035,406.187 808.343,301.452 810.651,399.621 812.959,355.494 815.267,392.138 817.575,480.631 819.883,444.748 822.191,296.073 824.499,305.27 826.807,167.487 829.115,432.23 831.422,427.822 833.73,292.501 836.038,386.794 838.346,346.368 840.654,273.9 842.962,524.214 845.27,460.196 847.578,339.499 849.886,384.708 852.194,502.083 854.502,487.147 856.809,539.189 859.117,523.837 861.425,360.736 863.733,352.891 866.041,491.567 868.349,328.942 870.657,455.24 872.965,491.938 875.273,340.771 877.581,461.389 879.889,300.533 882.197,322.981 884.504,336.742 886.812,471.062 889.12,345.515 891.428,491.87 893.736,472.737 896.044,340.851 898.352,449.999 900.66,411.776 902.968,282.599 905.276,443.815 907.584,380.461 909.891,531.37 912.199,373.723 914.507,397.406 916.815,427.188 919.123,417.818 921.431,328.085 923.739,373.936 926.047,371.809 928.355,512.094 930.663,352.687 932.971,458.078 935.278,427.043 937.586,487.635 939.894,478.006 942.202,485.926 944.51,569.026 946.818,397.341 949.126,319.131 951.434,334.695 953.742,414.402 956.05,312.883 958.358,397.891 960.665,351.493 962.973,326.373 965.281,555.068 967.589,534.211 969.897,434.209 972.205,328.761 974.513,504.655 976.821,368.209 979.129,328.419 981.437,416.893 983.745,327.069 986.053,301.036 988.36,339.9 990.668,433.322 992.976,329.893 995.284,255.721 997.592,232.079 999.9,290.275 1002.21,332.541 1004.52,415.271 1006.82,324.4 1009.13,351.442 1011.44,268.901 1013.75,384.9 1016.06,290.008 1018.36,351.578 1020.67,230.095 1022.98,387.928 1025.29,528.793 1027.59,410.419 1029.9,467.065 1032.21,440.356 1034.52,376.357 1036.83,347.988 1039.13,304.418 1041.44,339.579 1043.75,475.802 1046.06,311.905 1048.37,507.434 1050.67,394.301 1052.98,431.673 1055.29,470.567 1057.6,328.056 1059.91,190.897 1062.21,357.739 1064.52,347.419 1066.83,500.611 1069.14,499.969 1071.45,317.438 1073.75,399.409 1076.06,498.381 1078.37,286.776 1080.68,573.106 1082.98,118.513 1085.29,438.863 1087.6,368.299 1089.91,274.903 1092.22,268.048 1094.52,451.89 1096.83,344.509 1099.14,487.426 1101.45,322.7 1103.76,177.283 1106.06,425.911 1108.37,455.349 1110.68,509.906 1112.99,380.979 1115.3,171.204 1117.6,420.498 1119.91,322.299 1122.22,280.901 1124.53,432.554 1126.84,450.316 1129.14,461.088 1131.45,450.425 1133.76,488.502 1136.07,422.156 1138.37,385.769 1140.68,332.532 1142.99,464.313 1145.3,208.28 1147.61,351.327 1149.91,541.112 1152.22,326.609 1154.53,186.08 1156.84,350.237 1159.15,439.085 1161.45,229.442 1163.76,224.086 1166.07,432.997 1168.38,374.914 1170.69,375.009 1172.99,460.686 1175.3,337.666 1177.61,427.267 1179.92,365.686 1182.23,464.698 1184.53,453.188 1186.84,404.278 1189.15,450.652 1191.46,462.476 1193.76,295.151 1196.07,298.707 1198.38,565.299 1200.69,271.253 1203,382.462 1205.3,424.84 1207.61,473.497 1209.92,211.589 1212.23,537.024 1214.54,419.022 1216.84,410.91 1219.15,414.309 1221.46,479.1 1223.77,225.965 1226.08,398.781 1228.38,330.638 1230.69,499.985 1233,381.805 1235.31,508.393 1237.61,349.428 1239.92,308.493 1242.23,325.708 1244.54,366.208 1246.85,350.836 1249.15,422.549 1251.46,257.262 1253.77,361.674 1256.08,379.072 1258.39,328.448 1260.69,386.465 1263,384.279 1265.31,527.642 1267.62,334.849 1269.93,500.902 1272.23,403.676 1274.54,440.187 1276.85,414.919 1279.16,310.615 1281.47,388.251 1283.77,120.595 1286.08,290.884 1288.39,440.645 1290.7,524.258 1293,291.524 1295.31,353.555 1297.62,328.013 1299.93,315.859 1302.24,270.935 1304.54,476.363 1306.85,277.382 1309.16,467.044 1311.47,477.801 1313.78,337.185 1316.08,404.887 1318.39,288.511 1320.7,203.632 1323.01,467.206 1325.32,336.668 1327.62,232.42 1329.93,271.104 1332.24,313.367 1334.55,543.225 1336.86,429.344 1339.16,318.22 1341.47,296.802 1343.78,290.33 1346.09,403.315 1348.39,346.48 1350.7,278.592 1353.01,366.472 1355.32,332.02 1357.63,458.616 1359.93,386.97 1362.24,149.567 1364.55,620.721 1366.86,426.801 1369.17,356.756 1371.47,331.855 1373.78,435.127 1376.09,383.281 1378.4,306.968 1380.71,412.868 1383.01,357.216 1385.32,370.607 1387.63,466.041 1389.94,365.782 1392.24,464.898 1394.55,450.464 1396.86,403.048 1399.17,515.922 1401.48,242.832 1403.78,550.818 1406.09,494.626 1408.4,583.088 1410.71,388.6 1413.02,420.455 1415.32,362.081 1417.63,487.111 1419.94,305.449 1422.25,332.519 1424.56,340.785 1426.86,451.57 1429.17,263.969 1431.48,538.16 1433.79,330.308 1436.1,417.396 1438.4,283.161 1440.71,478.836 1443.02,303.332 1445.33,425.182 1447.63,381.367 1449.94,413.174 1452.25,479.817 1454.56,415.646 1456.87,396.893 1459.17,446.465 1461.48,191.74 1463.79,504.774 1466.1,254.782 1468.41,275.14 1470.71,616.229 1473.02,281.506 1475.33,347.623 1477.64,527.168 1479.95,424.799 1482.25,467.546 1484.56,269.816 1486.87,427.507 1489.18,394.826 1491.49,526.11 1493.79,257.157 1496.1,290.091 1498.41,283.227 1500.72,260.006 1503.02,391.411 1505.33,345.497 1507.64,313.729 1509.95,245.511 1512.26,198.252 1514.56,280.615 1516.87,461.165 1519.18,293.518 1521.49,348.558 1523.8,378.259 1526.1,354.747 1528.41,378.414 1530.72,544.186 1533.03,517.851 1535.34,408.276 1537.64,445.82 1539.95,604.359 1542.26,457.334 1544.57,188.871 1546.88,385.118 1549.18,389.653 1551.49,316.633 1553.8,413.409 1556.11,258.609 1558.41,235.039 1560.72,415.495 1563.03,319.974 1565.34,419.884 1567.65,370.629 1569.95,300.654 1572.26,311.858 1574.57,354.106 1576.88,278.48 1579.19,520.681 1581.49,329.593 1583.8,485.482 1586.11,340.986 1588.42,256.457 1590.73,271.983 1593.03,237.258 1595.34,313.353 1597.65,293.612 1599.96,184.87 1602.26,447.059 1604.57,365.957 1606.88,561.653 1609.19,239.072 1611.5,453.537 1613.8,385.927 1616.11,387.117 1618.42,195.323 1620.73,416.539 1623.04,316.05 1625.34,391.146 1627.65,437.535 1629.96,538.542 1632.27,315.215 1634.58,465.67 1636.88,198.866 1639.19,417.68 1641.5,299.113 1643.81,307.315 1646.12,367.396 1648.42,305.598 1650.73,478.973 1653.04,280.298 1655.35,322.63 1657.65,460.695 1659.96,545.376 1662.27,380.908 1664.58,371.345 1666.89,288.229 1669.19,351.902 1671.5,276.978 1673.81,243.313 1676.12,310.944 1678.43,369.33 1680.73,450.386 1683.04,294.354 1685.35,383.214 1687.66,316.285 1689.97,123.883 1692.27,443.408 1694.58,396.95 1696.89,345.6 1699.2,312.735 1701.51,316.92 1703.81,387.516 1706.12,281.624 1708.43,418.788 1710.74,551.408 1713.04,198.214 1715.35,407.865 1717.66,438.352 1719.97,508.973 1722.28,364.323 1724.58,383.347 1726.89,520.631 1729.2,274.576 1731.51,354.817 1733.82,358.967 1736.12,379.261 1738.43,406.793 1740.74,402.402 1743.05,380.391 1745.36,516.575 1747.66,273.999 1749.97,369.105 1752.28,476.106 1754.59,345.354 1756.9,395.29 1759.2,318.391 1761.51,241.549 1763.82,359.861 1766.13,496.456 1768.43,200.235 1770.74,391.728 1773.05,433.191 1775.36,346.649 1777.67,610.956 1779.97,260.884 1782.28,436.985 1784.59,378.379 1786.9,517.945 1789.21,429.506 1791.51,503.824 1793.82,289.047 1796.13,259.178 1798.44,336.119 1800.75,452.532 1803.05,502.866 1805.36,298.553 1807.67,383.832 1809.98,437.498 1812.28,635.293 1814.59,615.961 1816.9,282.396 1819.21,527.98 1821.52,253.117 1823.82,459.521 1826.13,544.068 1828.44,181.987 1830.75,327.342 1833.06,121.164 1835.36,234.35 1837.67,348.67 1839.98,500.087 1842.29,370.698 1844.6,571.046 1846.9,393.713 1849.21,274.865 1851.52,415.07 1853.83,380.39 1856.14,239.388 1858.44,393.118 1860.75,246.028 1863.06,426.016 1865.37,245.713 1867.67,190.77 1869.98,348.453 1872.29,353.176 1874.6,284.088 1876.91,661.182 1879.21,544.408 1881.52,96.8724 1883.83,465.555 1886.14,327.039 1888.45,367.742 1890.75,304.248 1893.06,369.32 1895.37,384.495 1897.68,326.481 1899.99,343.859 1902.29,155.135 1904.6,568.017 1906.91,437.165 1909.22,359.442 1911.53,534.043 1913.83,448.158 1916.14,479.767 1918.45,270.275 1920.76,400.681 1923.06,271.066 1925.37,307.294 1927.68,508.397 1929.99,462.61 1932.3,357.22 1934.6,272.633 1936.91,325.557 1939.22,246.107 1941.53,429.914 1943.84,525.405 1946.14,383.209 1948.45,436.104 1950.76,170.048 1953.07,352.715 1955.38,435.453 1957.68,250.391 1959.99,457.142 1962.3,457.364 1964.61,226.676 1966.91,510.504 1969.22,459.825 1971.53,346.462 1973.84,253.275 1976.15,357.963 1978.45,571.225 1980.76,392.141 1983.07,349.883 1985.38,500.243 1987.69,343.742 1989.99,278.571 1992.3,353.392 1994.61,240.316 1996.92,372.46 1999.23,338.311 2001.53,334.698 2003.84,309.918 2006.15,540.465 2008.46,258.878 2010.77,365.379 2013.07,371.463 2015.38,345.043 2017.69,325.787 2020,294.33 2022.3,265.687 2024.61,268.792 2026.92,304.222 2029.23,398.253 2031.54,296.361 2033.84,463.705 2036.15,488.038 2038.46,362.277 2040.77,213.813 2043.08,314.483 2045.38,264.576 2047.69,272.805 2050,595.788 2052.31,326.742 2054.62,360.723 2056.92,321.26 2059.23,283.349 2061.54,527.765 2063.85,429.123 2066.16,278.867 2068.46,290.519 2070.77,299.23 2073.08,494.37 2075.39,447.093 2077.69,380.95 2080,484.811 2082.31,472.133 2084.62,241.431 2086.93,449.834 2089.23,344.291 2091.54,383.579 2093.85,423.313 2096.16,237.912 2098.47,471.345 2100.77,507.59 2103.08,377.431 2105.39,506.065 2107.7,341.182 2110.01,305.473 2112.31,309.117 2114.62,282.407 2116.93,390.79 2119.24,464.837 2121.55,455.658 2123.85,238.127 2126.16,378.023 2128.47,412.181 2130.78,419.474 2133.08,308.266 2135.39,346.255 2137.7,290.838 2140.01,375.267 2142.32,178.384 2144.62,550.962 2146.93,440.587 2149.24,403.655 2151.55,533.787 2153.86,316.02 2156.16,583.971 2158.47,326.427 2160.78,245.409 2163.09,470.171 2165.4,361.135 2167.7,299.97 2170.01,456.103 2172.32,438.388 2174.63,461.322 2176.93,436.777 2179.24,501.22 2181.55,378.458 2183.86,334.41 2186.17,295.051 2188.47,322.086 2190.78,386.167 2193.09,271.922 2195.4,331.494 2197.71,414.665 2200.01,326.546 2202.32,492.851 2204.63,457.668 2206.94,393.969 2209.25,543.036 2211.55,362.818 2213.86,420.945 2216.17,399.907 2218.48,445.753 2220.79,503.765 2223.09,458.173 2225.4,519.081 2227.71,396.778 2230.02,420.94 2232.32,380.429 2234.63,364.968 2236.94,163.787 2239.25,176.475 2241.56,386.041 2243.86,511.574 2246.17,472.963 2248.48,492.807 2250.79,503.526 2253.1,577.02 2255.4,357.312 2257.71,495.037 2260.02,344.269 2262.33,486.621 2264.64,526.586 2266.94,462.231 2269.25,408.013 2271.56,361.061 2273.87,375.547 2276.18,272.212 2278.48,255.365 2280.79,490.407 2283.1,348.388 2285.41,564.016 2287.71,335.674 2290.02,419.725 2292.33,298.69 2294.64,347.505 2296.95,379.183 2299.25,370.577 2301.56,300.902 2303.87,428.001 2306.18,239.749 2308.49,459.812 2310.79,283.06 2313.1,448.119 2315.41,133.678 2317.72,423.127 2320.03,236.315 2322.33,357.862 2324.64,293.786 2326.95,526.741 2329.26,408.543 2331.56,451.066 2333.87,419.075 2336.18,528.903 2338.49,340.408 2340.8,225.927 2343.1,269.778 2345.41,442.765 2347.72,503.012 2350.03,381.757 2352.34,313.539 2354.64,408.783 2356.95,348.01 2359.26,366.601 2361.57,289.447 2363.88,422.557 2366.18,558.925 2368.49,300.502 2370.8,224.047 2373.11,330.734 2375.42,448.167 2377.72,567.313 2380.03,225.059 2382.34,462.588 2384.65,316.682 2386.95,430.461 2389.26,284.492 2391.57,452.709 2393.88,399.101 2396.19,489.008 2398.49,147.829 2400.8,331.966 2403.11,352.976 2405.42,374.369 2407.73,347.188 2410.03,330.082 2412.34,297.207 2414.65,336.361 2416.96,534.738 2419.27,425.096 2421.57,289.471 2423.88,331.695 2426.19,263.644 2428.5,365.227 2430.81,228.909 2433.11,442.636 2435.42,303.967 2437.73,120.889 2440.04,332.317 2442.34,422.852 2444.65,419.46 2446.96,323.444 2449.27,443.561 2451.58,321.514 2453.88,355.027 2456.19,577.965 2458.5,395.673 2460.81,442.657 2463.12,432.732 2465.42,454.915 2467.73,373.166 2470.04,465.41 2472.35,287.485 2474.66,402.51 2476.96,542.031 2479.27,365.302 2481.58,313.046 2483.89,472.093 2486.2,393.319 2488.5,298.39 2490.81,309.102 2493.12,413.369 2495.43,328.598 2497.73,537.919 2500.04,385.976 2502.35,393.56 2504.66,398.075 2506.97,381.206 2509.27,385.257 2511.58,338.509 2513.89,400.268 2516.2,464.881 2518.51,327.21 2520.81,304.473 2523.12,543.352 2525.43,295.752 2527.74,544.454 2530.05,299.305 2532.35,537.099 2534.66,480.07 2536.97,436.554 2539.28,391.806 2541.58,403.104 2543.89,424.809 2546.2,366.908 2548.51,362.005 2550.82,298.302 2553.12,461.108 2555.43,262.57 2557.74,399.725 2560.05,223.759 2562.36,354.973 2564.66,499.03 2566.97,597.461 2569.28,377.013 2571.59,289.481 "></polyline>
</svg>
</div>
</div>
<p>Look at that! Things are working; amazin’.</p>
<p>We can also exploit <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>’s parallel sampling capabilities:</p>
<div id="34" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run separate 4 chains for 10 000 iterations using threads to parallelize.</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>num_chains <span class="op">=</span> <span class="fl">4</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    model_with_grad,</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">MCMCThreads</span>(),</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>,</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    num_chains;</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Note we need to provide an initial state for every chain.</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>    initial_state<span class="op">=</span><span class="fu">fill</span>(state, num_chains),</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>samples_array <span class="op">=</span> <span class="fu">stack</span>(<span class="fu">map</span>(<span class="bu">Base</span>.<span class="fu">Fix1</span>(stack, sample <span class="op">-&gt;</span> sample.x), samples))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000×4 Array{Float64, 3}:
[:, :, 1] =
 -1.37885  -1.6198    -1.93171   …  -3.8038    -4.43273   -3.9326
 -0.98606  -0.802185  -0.205984      0.637871   0.895173  -0.670832
  4.28952   4.90482    3.53627       4.19504    4.59739    5.5772

[:, :, 2] =
 -1.48784    -4.31143  -4.91005  …  -5.49818   -5.25849   -5.10022
  0.0721938   1.14998   1.88512     -0.896828   0.703656   0.0528166
  4.06249     3.27801   5.19184      4.73891    6.12323    6.0844

[:, :, 3] =
 -1.29038  -3.60923   -3.78236  -3.29247  …  -5.398    -4.80867  -4.58581
 -1.2303   -0.675801  -1.52624  -1.43614      1.28094   1.8963   -0.743738
  3.79442   4.71017    5.27452   5.85863      3.98026   5.08573   4.30864

[:, :, 4] =
 -2.49572  -4.02636  -7.29738  -5.72689   …  -6.73435   -5.81211  -4.03209
  0.57122   1.46574   1.68475  -0.477794      0.521322  -1.29797  -1.11835
  4.76845   5.14732   4.07641   4.6634        4.64977    4.34146   3.3154</code></pre>
</div>
</div>
<p>But the fact that we have to provide the <code>AbstractMCMC.sample</code> call, etc. with an <code>initial_state</code> to get started is a bit annoying. We can avoid this by also defining a <code>AbstractMCMC.step</code> <em>without</em> the <code>state</code> argument:</p>
<div id="36" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">::</span><span class="dt">MALA</span>;</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># </span><span class="al">NOTE</span><span class="co">: No state provided!</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just create the initial state by sampling using  a Gaussian.</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="fu">randn</span>(rng, LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(x), <span class="fu">MALAState</span>(x)</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Equipped with this, we no longer need to provide the <code>initial_state</code> everywhere:</p>
<div id="38" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -4.98784    1.00048
  0.0378046  0.980308
  4.97128    0.998</code></pre>
</div>
</div>
</section>
<section id="using-our-sampler-with-turing.jl" class="level2">
<h2 class="anchored" data-anchor-id="using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</h2>
<p>As we promised, all of this hassle of implementing our <code>MALA</code> sampler in a way that uses <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> and <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> gets us something more than <em>just</em> an “automatic” implementation of <code>AbstractMCMC.sample</code>.</p>
<p>It also enables use with Turing.jl through the <code>externalsampler</code>, but we need to do one final thing first: we need to tell Turing.jl how to extract a vector of parameters from the “sample” returned in our implementation of <code>AbstractMCMC.step</code>. In our case, the “sample” is a <code>MALASample</code>, so we just need the following line:</p>
<div id="40" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load Turing.jl.</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Turing</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Overload the `getparams` method for our "sample" type, which is just a vector.</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>Turing.Inference.<span class="fu">getparams</span>(<span class="op">::</span><span class="dt">Turing.Model</span>, sample<span class="op">::</span><span class="dt">MALASample</span>) <span class="op">=</span> sample.x</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And with that, we’re good to go!</p>
<div id="42" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Our previous model defined as a Turing.jl model.</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">mvnormal_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">MvNormal</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.], I)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate our model.</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">mvnormal_model</span>()</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Call `sample` but now we're passing in a Turing.jl `model` and wrapping</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co"># our `MALA` sampler in the `externalsampler` to tell Turing.jl that the sampler</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co"># expects something that implements LogDensityProblems.jl.</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×4×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 2.81 seconds
Compute duration  = 2.81 seconds
parameters        = x[1], x[2], x[3]
internals         = lp

Summary Statistics
  parameters      mean       std      mcse    ess_bulk    ess_tail      rhat   ⋯
      Symbol   Float64   Float64   Float64     Float64     Float64   Float64   ⋯

        x[1]   -4.9974    1.0071    0.0181   3106.5943   5132.8632    1.0005   ⋯
        x[2]   -0.0004    0.9993    0.0167   3572.1050   5515.2216    1.0002   ⋯
        x[3]    4.9980    1.0064    0.0176   3277.3465   5132.9275    1.0001   ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

        x[1]   -6.9751   -5.6765   -5.0079   -4.3294   -2.9980
        x[2]   -1.9572   -0.6903    0.0048    0.6733    1.9737
        x[3]    3.0143    4.3193    4.9948    5.6934    6.9674</code></pre>
</div>
</div>
<p>Pretty neat, eh?</p>
<section id="models-with-constrained-parameters" class="level3">
<h3 class="anchored" data-anchor-id="models-with-constrained-parameters">Models with constrained parameters</h3>
<p>One thing we’ve sort of glossed over in all of the above is that MALA, at least how we’ve implemented it, requires <span class="math inline">\(x\)</span> to live in <span class="math inline">\(\mathbb{R}^d\)</span> for some <span class="math inline">\(d &gt; 0\)</span>. If some of the parameters were in fact constrained, e.g.&nbsp;we were working with a <code>Beta</code> distribution which has support on the interval <span class="math inline">\((0, 1)\)</span>, <em>not</em> on <span class="math inline">\(\mathbb{R}^d\)</span>, we could easily end up outside of the valid range <span class="math inline">\((0, 1)\)</span>.</p>
<div id="44" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">beta_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">beta_model</span>()</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 1.87 seconds
Compute duration  = 1.87 seconds
parameters        = x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse    ess_bulk    ess_tail      rhat   ⋯
      Symbol   Float64   Float64   Float64     Float64     Float64   Float64   ⋯

           x    0.4957    0.1888    0.0027   4796.8710   6094.5119    0.9999   ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

           x    0.1447    0.3569    0.4941    0.6396    0.8479</code></pre>
</div>
</div>
<p>Yep, that still works, but only because Turing.jl actually <em>transforms</em> the <code>turing_model</code> from constrained to unconstrained, so that the <code>sampler</code> provided to <code>externalsampler</code> is actually always working in unconstrained space! This is not always desirable, so we can turn this off:</p>
<div id="46" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 0.14 seconds
Compute duration  = 0.14 seconds
parameters        = x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse   ess_bulk   ess_tail      rhat   e ⋯
      Symbol   Float64   Float64   Float64    Float64    Float64   Float64     ⋯

           x    0.5211    0.1620    0.0208    54.8311    56.7277    1.0960     ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

           x    0.2588    0.3990    0.5108    0.6345    0.8011</code></pre>
</div>
</div>
<p>The fun thing is that this still sort of works because</p>
<div id="48" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">logpdf</span>(<span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>), <span class="fl">10.0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-Inf</code></pre>
</div>
</div>
<p>and so the samples that fall outside of the range are always rejected. But do notice how much worse all the diagnostics are, e.g.&nbsp;<code>ess_tail</code> is very poor compared to when we use <code>unconstrained=true</code>. Moreover, in more complex cases this won’t just result in a “nice” <code>-Inf</code> log-density value, but instead will error:</p>
<div id="50" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="kw">function</span> <span class="fu">demo</span>()</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>    σ² <span class="op">~</span> <span class="fu">truncated</span>(<span class="fu">Normal</span>(), lower<span class="op">=</span><span class="fl">0</span>)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If we end up with negative values for `σ²`, the `Normal` will error.</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>    x <span class="op">~</span> <span class="fu">Normal</span>(<span class="fl">0</span>, σ²)</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>DomainError: DomainError(Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}}(-0.5114468310269524,1.0,0.0), "Normal: the condition σ &gt;= zero(σ) is not satisfied.")
DomainError with Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}}(-0.5114468310269524,1.0,0.0):
Normal: the condition σ &gt;= zero(σ) is not satisfied.
Stacktrace:
  [1] #371
    @ ~/.julia/packages/Distributions/j0ZcJ/src/univariate/continuous/normal.jl:37 [inlined]
  [2] check_args
    @ ~/.julia/packages/Distributions/j0ZcJ/src/utils.jl:89 [inlined]
  [3] #Normal#370
    @ ~/.julia/packages/Distributions/j0ZcJ/src/univariate/continuous/normal.jl:37 [inlined]
  [4] Normal
    @ ~/.julia/packages/Distributions/j0ZcJ/src/univariate/continuous/normal.jl:36 [inlined]
  [5] Normal
    @ ~/.julia/packages/Distributions/j0ZcJ/src/univariate/continuous/normal.jl:42 [inlined]
  [6] macro expansion
    @ ~/.julia/packages/DynamicPPL/cvlfK/src/compiler.jl:584 [inlined]
  [7] demo(__model__::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, __varinfo__::DynamicPPL.ThreadSafeVarInfo{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}, Vector{Set{DynamicPPL.Selector}}}}, ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}, Vector{Base.RefValue{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}, __context__::DynamicPPL.DefaultContext)
    @ Main.Notebook ~/work/docs/docs/tutorials/docs-17-implementing-samplers/index.qmd:455
  [8] _evaluate!!
    @ ~/.julia/packages/DynamicPPL/cvlfK/src/model.jl:914 [inlined]
  [9] evaluate_threadsafe!!(model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, varinfo::DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}, Vector{Set{DynamicPPL.Selector}}}}, ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}, context::DynamicPPL.DefaultContext)
    @ DynamicPPL ~/.julia/packages/DynamicPPL/cvlfK/src/model.jl:903
 [10] evaluate!!
    @ ~/.julia/packages/DynamicPPL/cvlfK/src/model.jl:833 [inlined]
 [11] logdensity
    @ ~/.julia/packages/DynamicPPL/cvlfK/src/logdensityfunction.jl:140 [inlined]
 [12] Fix1
    @ ./operators.jl:1127 [inlined]
 [13] vector_mode_dual_eval!(f::Base.Fix1{typeof(LogDensityProblems.logdensity), LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, Nothing}}, cfg::ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}, x::Vector{Float64})
    @ ForwardDiff ~/.julia/packages/ForwardDiff/UBbGT/src/apiutils.jl:24
 [14] vector_mode_gradient!
    @ ~/.julia/packages/ForwardDiff/UBbGT/src/gradient.jl:98 [inlined]
 [15] gradient!(result::DiffResults.MutableDiffResult{1, Float64, Tuple{Vector{Float64}}}, f::Base.Fix1{typeof(LogDensityProblems.logdensity), LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, Nothing}}, x::Vector{Float64}, cfg::ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}, ::Val{true})
    @ ForwardDiff ~/.julia/packages/ForwardDiff/UBbGT/src/gradient.jl:39
 [16] gradient!
    @ ~/.julia/packages/ForwardDiff/UBbGT/src/gradient.jl:36 [inlined]
 [17] logdensity_and_gradient
    @ ~/.julia/packages/LogDensityProblemsAD/9uEsH/ext/LogDensityProblemsADForwardDiffExt.jl:116 [inlined]
 [18] leapfrog_step(model::LogDensityProblemsADForwardDiffExt.ForwardDiffLogDensity{LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, Nothing}, ForwardDiff.Chunk{2}, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}, x::Vector{Float64}, p::Vector{Float64}, ϵ::Int64, M::UniformScaling{Bool})
    @ Main.Notebook ~/work/docs/docs/tutorials/docs-17-implementing-samplers/index.qmd:303
 [19] step(rng::TaskLocalRNG, model_wrapper::AbstractMCMC.LogDensityModel{LogDensityProblemsADForwardDiffExt.ForwardDiffLogDensity{LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, Nothing}, ForwardDiff.Chunk{2}, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}}, sampler::MALA{Int64, UniformScaling{Bool}}, state::MALAState{Vector{Float64}}; kwargs::@Kwargs{})
    @ Main.Notebook ~/work/docs/docs/tutorials/docs-17-implementing-samplers/index.qmd:274
 [20] step
    @ ~/work/docs/docs/tutorials/docs-17-implementing-samplers/index.qmd:256 [inlined]
 [21] #step#103
    @ ~/.julia/packages/Turing/NQDYt/src/mcmc/abstractmcmc.jl:161 [inlined]
 [22] step(rng::TaskLocalRNG, model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, sampler_wrapper::DynamicPPL.Sampler{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}, state::Turing.Inference.TuringState{MALAState{Vector{Float64}}, LogDensityProblemsADForwardDiffExt.ForwardDiffLogDensity{LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, Nothing}, ForwardDiff.Chunk{2}, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}})
    @ Turing.Inference ~/.julia/packages/Turing/NQDYt/src/mcmc/abstractmcmc.jl:150
 [23] macro expansion
    @ ~/.julia/packages/AbstractMCMC/FSyVk/src/sample.jl:217 [inlined]
 [24] macro expansion
    @ ~/.julia/packages/AbstractMCMC/FSyVk/src/logging.jl:16 [inlined]
 [25] mcmcsample(rng::TaskLocalRNG, model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, sampler::DynamicPPL.Sampler{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}, N::Int64; progress::Bool, progressname::String, callback::Nothing, num_warmup::Int64, discard_initial::Int64, thinning::Int64, chain_type::Type, initial_state::Nothing, kwargs::@Kwargs{})
    @ AbstractMCMC ~/.julia/packages/AbstractMCMC/FSyVk/src/sample.jl:142
 [26] sample(rng::TaskLocalRNG, model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, sampler::DynamicPPL.Sampler{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}, N::Int64; chain_type::Type, resume_from::Nothing, initial_state::Nothing, kwargs::@Kwargs{progress::Bool})
    @ DynamicPPL ~/.julia/packages/DynamicPPL/cvlfK/src/sampler.jl:107
 [27] sample
    @ ~/.julia/packages/DynamicPPL/cvlfK/src/sampler.jl:97 [inlined]
 [28] #sample#4
    @ ~/.julia/packages/Turing/NQDYt/src/mcmc/Inference.jl:303 [inlined]
 [29] sample
    @ ~/.julia/packages/Turing/NQDYt/src/mcmc/Inference.jl:294 [inlined]
 [30] #sample#3
    @ ~/.julia/packages/Turing/NQDYt/src/mcmc/Inference.jl:291 [inlined]
 [31] top-level scope
    @ ~/work/docs/docs/tutorials/docs-17-implementing-samplers/index.qmd:457</code></pre>
</div>
</div>
<p>As expected, we run into a <code>DomainError</code> at some point, while if we set <code>unconstrained=true</code>, letting Turing.jl transform the model to a unconstrained form behind the scenes, everything works as expected:</p>
<div id="52" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 0.58 seconds
Compute duration  = 0.58 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse   ess_bulk   ess_tail      rhat   e ⋯
      Symbol   Float64   Float64   Float64    Float64    Float64   Float64     ⋯

          σ²    0.1384    0.0000       NaN        NaN        NaN       NaN     ⋯
           x    0.8244    0.0000    0.0000        NaN        NaN       NaN     ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

          σ²    0.1384    0.1384    0.1384    0.1384    0.1384
           x    0.8244    0.8244    0.8244    0.8244    0.8244</code></pre>
</div>
</div>
<p>Neat!</p>
<p>Similarly, which automatic differentiation backend one should use can be specified through the <code>adtype</code> keyword argument too. For example, if we want to use <a href="https://github.com/JuliaDiff/ReverseDiff.jl">ReverseDiff.jl</a> instead of the default <a href="https://github.com/JuliaDiff/ForwardDiff.jl">ForwardDiff.jl</a>:</p>
<div id="54" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">ReverseDiff</span>: ReverseDiff</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify that we want to use `AutoReverseDiff`.</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">demo</span>(),</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>, adtype<span class="op">=</span><span class="fu">AutoReverseDiff</span>()),</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>;</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 3.73 seconds
Compute duration  = 3.73 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse   ess_bulk   ess_tail      rhat   e ⋯
      Symbol   Float64   Float64   Float64    Float64    Float64   Float64     ⋯

          σ²    0.8755    0.5351    0.0224   386.2037   332.6654    1.0131     ⋯
           x    0.0496    0.9498    0.0400   655.4297   437.0098    1.0075     ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

          σ²    0.1403    0.4495    0.7852    1.2045    2.1332
           x   -1.9648   -0.4291    0.0252    0.5117    2.1238</code></pre>
</div>
</div>
<p>Double-neat.</p>
</section>
</section>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<p>At this point it’s worth maybe reminding ourselves what we did and also <em>why</em> we did it:</p>
<ol type="1">
<li>We define our models in the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface because it makes the sampler agnostic to how the underlying model is implemented.</li>
<li>We implement our sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> interface, which just means that our sampler is a subtype of <code>AbstractMCMC.AbstractSampler</code> and we implement the MCMC transition in <code>AbstractMCMC.step</code>.</li>
<li>Points 1 and 2 makes it so our sampler can be used with a wide range of model implementations, amongst them being models implemented in both Turing.jl and Stan. This gives you, the inference implementer, a large collection of models to test your inference method on, in addition to allowing users of Turing.jl and Stan to try out your inference method with minimal effort.</li>
</ol>


</section>


<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a><div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>We’re going with the leapfrog formulation because in a future version of this tutorial we’ll add a section extending this simple “baseline” MALA sampler to more complex versions. See <a href="https://github.com/TuringLang/docs/issues/479">issue #479</a> for progress on this.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>There is no such thing as a proper interface in Julia (at least not officially), and so we use the word “interface” here to mean a few minimal methods that needs to be implemented by any type that we treat as a target model.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/turinglang\.org\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../tutorials/docs-07-for-developers-variational-inference/index.html" class="pagination-link" aria-label="Variational Inference">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Variational Inference</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Turing is created by <a href="http://mlg.eng.cam.ac.uk/hong/" target="_blank">Hong Ge</a>, and lovingly maintained by the <a href="https://github.com/TuringLang/Turing.jl/graphs/contributors" target="_blank">core team</a> of volunteers. <br> The contents of this website are © 2024 under the terms of the <a href="https://github.com/TuringLang/Turing.jl/blob/master/LICENCE" target="_blank">MIT License</a>.</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/TuringLang/docs/edit/master/tutorials/docs-17-implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/docs/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://x.com/TuringLang">
      <i class="bi bi-twitter" role="img" aria-label="Turing Twitter">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/TuringLang/Turing.jl">
      <i class="bi bi-github" role="img" aria-label="Turing GitHub">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




<script src="../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>