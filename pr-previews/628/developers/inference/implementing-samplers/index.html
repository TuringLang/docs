<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Implementing Samplers – Turing.jl</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<link href="../../../developers/inference/variational-inference/index.html" rel="prev">
<link href="../../../assets/favicon.ico" rel="icon">
<script src="../../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-dark-2fef5ea3f8957b3e4ecc936fc74692ca.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap-8ca65573be89ab5a614a0758d6e79fa7.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../../site_libs/bootstrap/bootstrap-dark-e4bf857d3af38d284e31ad2f58e22145.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="../../../site_libs/bootstrap/bootstrap-8ca65573be89ab5a614a0758d6e79fa7.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<style>
  a {
    text-decoration: none;
  }
  a:hover {
    text-decoration: underline;
  }
</style>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../../theming/styles.css">
</head>

<body class="nav-sidebar floating nav-fixed quarto-light"><script id="quarto-html-before-body" type="application/javascript">
    const toggleBodyColorMode = (bsSheetEl) => {
      const mode = bsSheetEl.getAttribute("data-mode");
      const bodyEl = window.document.querySelector("body");
      if (mode === "dark") {
        bodyEl.classList.add("quarto-dark");
        bodyEl.classList.remove("quarto-light");
      } else {
        bodyEl.classList.add("quarto-light");
        bodyEl.classList.remove("quarto-dark");
      }
    }
    const toggleBodyColorPrimary = () => {
      const bsSheetEl = window.document.querySelector("link#quarto-bootstrap:not([rel=disabled-stylesheet])");
      if (bsSheetEl) {
        toggleBodyColorMode(bsSheetEl);
      }
    }
    const setColorSchemeToggle = (alternate) => {
      const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
      for (let i=0; i < toggles.length; i++) {
        const toggle = toggles[i];
        if (toggle) {
          if (alternate) {
            toggle.classList.add("alternate");
          } else {
            toggle.classList.remove("alternate");
          }
        }
      }
    };
    const toggleColorMode = (alternate) => {
      // Switch the stylesheets
      const primaryStylesheets = window.document.querySelectorAll('link.quarto-color-scheme:not(.quarto-color-alternate)');
      const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
      manageTransitions('#quarto-margin-sidebar .nav-link', false);
      if (alternate) {
        // note: dark is layered on light, we don't disable primary!
        enableStylesheet(alternateStylesheets);
        for (const sheetNode of alternateStylesheets) {
          if (sheetNode.id === "quarto-bootstrap") {
            toggleBodyColorMode(sheetNode);
          }
        }
      } else {
        disableStylesheet(alternateStylesheets);
        enableStylesheet(primaryStylesheets)
        toggleBodyColorPrimary();
      }
      manageTransitions('#quarto-margin-sidebar .nav-link', true);
      // Switch the toggles
      setColorSchemeToggle(alternate)
      // Hack to workaround the fact that safari doesn't
      // properly recolor the scrollbar when toggling (#1455)
      if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
        manageTransitions("body", false);
        window.scrollTo(0, 1);
        setTimeout(() => {
          window.scrollTo(0, 0);
          manageTransitions("body", true);
        }, 40);
      }
    }
    const disableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        stylesheet.rel = 'disabled-stylesheet';
      }
    }
    const enableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        if(stylesheet.rel !== 'stylesheet') { // for Chrome, which will still FOUC without this check
          stylesheet.rel = 'stylesheet';
        }
      }
    }
    const manageTransitions = (selector, allowTransitions) => {
      const els = window.document.querySelectorAll(selector);
      for (let i=0; i < els.length; i++) {
        const el = els[i];
        if (allowTransitions) {
          el.classList.remove('notransition');
        } else {
          el.classList.add('notransition');
        }
      }
    }
    const isFileUrl = () => {
      return window.location.protocol === 'file:';
    }
    const hasAlternateSentinel = () => {
      let styleSentinel = getColorSchemeSentinel();
      if (styleSentinel !== null) {
        return styleSentinel === "alternate";
      } else {
        return false;
      }
    }
    const setStyleSentinel = (alternate) => {
      const value = alternate ? "alternate" : "default";
      if (!isFileUrl()) {
        window.localStorage.setItem("quarto-color-scheme", value);
      } else {
        localAlternateSentinel = value;
      }
    }
    const getColorSchemeSentinel = () => {
      if (!isFileUrl()) {
        const storageValue = window.localStorage.getItem("quarto-color-scheme");
        return storageValue != null ? storageValue : localAlternateSentinel;
      } else {
        return localAlternateSentinel;
      }
    }
    const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
      const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
      const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
      let newTheme = '';
      if(authorPrefersDark) {
        newTheme = isAlternate ? baseTheme : alternateTheme;
      } else {
        newTheme = isAlternate ? alternateTheme : baseTheme;
      }
      const changeGiscusTheme = () => {
        // From: https://github.com/giscus/giscus/issues/336
        const sendMessage = (message) => {
          const iframe = document.querySelector('iframe.giscus-frame');
          if (!iframe) return;
          iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
        }
        sendMessage({
          setConfig: {
            theme: newTheme
          }
        });
      }
      const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
      if (isGiscussLoaded) {
        changeGiscusTheme();
      }
    };
    const authorPrefersDark = false;
    const darkModeDefault = authorPrefersDark;
      document.querySelector('link#quarto-text-highlighting-styles.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
      document.querySelector('link#quarto-bootstrap.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
    let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
    // Dark / light mode switch
    window.quartoToggleColorScheme = () => {
      // Read the current dark / light value
      let toAlternate = !hasAlternateSentinel();
      toggleColorMode(toAlternate);
      setStyleSentinel(toAlternate);
      toggleGiscusIfUsed(toAlternate, darkModeDefault);
      window.dispatchEvent(new Event('resize'));
    };
    // Switch to dark mode if need be
    if (hasAlternateSentinel()) {
      toggleColorMode(true);
    } else {
      toggleColorMode(false);
    }
  </script>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="https://turinglang.org/" class="navbar-brand navbar-brand-logo">
    <img src="../../../assets/images/turing-logo.svg" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="https://turinglang.org/">
    <span class="navbar-title">Turing.jl</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../getting-started/"> 
<span class="menu-text">Get Started</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../tutorials/coin-flipping/"> 
<span class="menu-text">Tutorials</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/library/"> 
<span class="menu-text">Libraries</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/news/"> 
<span class="menu-text">News</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/team/"> 
<span class="menu-text">Team</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-v0.39" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">v0.39</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-v0.39">    
        <li>
    <a class="dropdown-item" href="https://turinglang.org/docs/changelog.html">
 <span class="dropdown-text">Changelog</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://turinglang.org/docs/versions.html">
 <span class="dropdown-text">All Versions</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools tools-wide">
    <a href="https://x.com/TuringLang" title="Turing Twitter" class="quarto-navigation-tool px-1" aria-label="Turing Twitter"><i class="bi bi-twitter"></i></a>
    <a href="https://github.com/TuringLang/Turing.jl" title="Turing GitHub" class="quarto-navigation-tool px-1" aria-label="Turing GitHub"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../../developers/contributing/index.html">Developers</a></li><li class="breadcrumb-item"><a href="../../../developers/inference/variational-inference/index.html">Inference in Detail</a></li><li class="breadcrumb-item"><a href="../../../developers/inference/implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../getting-started/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Getting Started</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../core-functionality/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Core Functionality</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false">
 <span class="menu-text">User Guide</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/automatic-differentiation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Automatic Differentiation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/submodels/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Submodels</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/custom-distribution/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Custom Distributions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/probability-interface/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Querying Model Probabilities</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/modifying-logprob/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Modifying the Log Probability</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/tracking-extra-quantities/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Tracking Extra Quantities</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/mode-estimation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Mode Estimation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/performance-tips/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Performance Tips</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/sampler-visualisation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Sampler Visualization</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/dynamichmc/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using DynamicHMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/external-samplers/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using External Samplers</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/troubleshooting/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Troubleshooting</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false">
 <span class="menu-text">Tutorials</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/coin-flipping/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction: Coin Flipping</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/gaussian-mixture-models/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Mixture Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-neural-networks/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Neural Networks</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/hidden-markov-models/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Hidden Markov Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-linear-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Linear Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/infinite-mixture-models/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Infinite Mixture Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-poisson-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Poisson Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/multinomial-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Multinomial Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-differential-equations/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Differential Equations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/probabilistic-pca/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Probabilistic PCA</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-time-series-analysis/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Time Series Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/gaussian-processes-introduction/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Processes: Introduction</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/gaussian-process-latent-variable-models/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Process Latent Variable Models</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Developers</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/contributing/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Contributing</span></a>
  </div>
</li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false">
 <span class="menu-text">DynamicPPL’s Compiler</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/compiler/model-manual/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Manually Defining a Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/compiler/minituring-compiler/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation I: Compiler</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/compiler/minituring-contexts/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation II: Contexts</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/compiler/design-overview/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Turing Compiler Design (Outdated)</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false">
 <span class="menu-text">DynamicPPL Contexts</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/contexts/submodel-condition/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Conditioning and fixing in submodels</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="false">
 <span class="menu-text">Variable Transformations</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/transforms/distributions/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Distributions and the Jacobian</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/transforms/bijectors/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bijectors in MCMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/transforms/dynamicppl/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variable transformations in DynamicPPL</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true">
 <span class="menu-text">Inference in Detail</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/inference/variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/inference/implementing-samplers/index.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Implementing Samplers</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of Contents</h2>
   
  <ul>
  <li><a href="#quick-overview-of-mala" id="toc-quick-overview-of-mala" class="nav-link active" data-scroll-target="#quick-overview-of-mala">Quick overview of MALA</a></li>
  <li><a href="#what-we-need-from-a-model-logdensityproblems.jl" id="toc-what-we-need-from-a-model-logdensityproblems.jl" class="nav-link" data-scroll-target="#what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: LogDensityProblems.jl</a></li>
  <li><a href="#implementing-mala-in-abstractmcmc.jl" id="toc-implementing-mala-in-abstractmcmc.jl" class="nav-link" data-scroll-target="#implementing-mala-in-abstractmcmc.jl">Implementing MALA in AbstractMCMC.jl</a></li>
  <li><a href="#using-our-sampler-with-turing.jl" id="toc-using-our-sampler-with-turing.jl" class="nav-link" data-scroll-target="#using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</a>
  <ul class="collapse">
  <li><a href="#models-with-constrained-parameters" id="toc-models-with-constrained-parameters" class="nav-link" data-scroll-target="#models-with-constrained-parameters">Models with constrained parameters</a></li>
  </ul></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/TuringLang/docs/edit/main/developers/inference/implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/docs/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">


<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../../developers/contributing/index.html">Developers</a></li><li class="breadcrumb-item"><a href="../../../developers/inference/variational-inference/index.html">Inference in Detail</a></li><li class="breadcrumb-item"><a href="../../../developers/inference/implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Implementing Samplers</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>In this tutorial, we’ll go through step-by-step how to implement a “simple” sampler in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> in such a way that it can be easily applied to Turing.jl models.</p>
<p>In particular, we’re going to implement a version of <strong>Metropolis-adjusted Langevin (MALA)</strong>.</p>
<p>Note that we will implement this sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> framework, completely “ignoring” Turing.jl until the very end of the tutorial, at which point we’ll use a single line of code to make the resulting sampler available to Turing.jl. This is to really drive home the point that one can implement samplers in a way that is accessible to all of Turing.jl’s users without having to use Turing.jl yourself.</p>
<section id="quick-overview-of-mala" class="level2">
<h2 class="anchored" data-anchor-id="quick-overview-of-mala">Quick overview of MALA</h2>
<p>We can view MALA as a single step of the leapfrog intergrator with resampling of momentum <span class="math inline">\(p\)</span> at every step.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> To make that statement a bit more concrete, we first define the <em>extended</em> target <span class="math inline">\(\bar{\gamma}(x, p)\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\log \bar{\gamma}(x, p) \propto \log \gamma(x) + \log \gamma_{\mathcal{N}(0, M)}(p)
\end{equation*}\]</span></p>
<p>where <span class="math inline">\(\gamma_{\mathcal{N}(0, M)}\)</span> denotes the density for a zero-centered Gaussian with covariance matrix <span class="math inline">\(M\)</span>. We then consider targeting this joint distribution over both <span class="math inline">\(x\)</span> and <span class="math inline">\(p\)</span> as follows. First we define the map</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  L_{\epsilon}: \quad &amp; \mathbb{R}^d \times \mathbb{R}^d \to \mathbb{R}^d \times \mathbb{R}^d \\
  &amp; (x, p) \mapsto (\tilde{x}, \tilde{p}) := L_{\epsilon}(x, p)
\end{split}
\end{equation*}\]</span></p>
<p>as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p_{1 / 2} &amp;:= p + \frac{\epsilon}{2} \nabla \log \gamma(x) \\
  \tilde{x} &amp;:= x + \epsilon M^{-1} p_{1 /2 } \\
  p_1 &amp;:= p_{1 / 2} + \frac{\epsilon}{2} \nabla \log \gamma(\tilde{x}) \\
  \tilde{p} &amp;:= - p_1
\end{split}
\end{equation*}\]</span></p>
<p>This might be familiar for some readers as a single step of the Leapfrog integrator. We then define the MALA kernel as follows: given the current iterate <span class="math inline">\(x_i\)</span>, we sample the next iterate <span class="math inline">\(x_{i + 1}\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p &amp;\sim \mathcal{N}(0, M) \\
  (\tilde{x}, \tilde{p}) &amp;:= L_{\epsilon}(x_i, p) \\
  \alpha &amp;:= \min \left\{ 1, \frac{\bar{\gamma}(\tilde{x}, \tilde{p})}{\bar{\gamma}(x_i, p)} \right\} \\
  x_{i + 1} &amp;:=
  \begin{cases}
    \tilde{x} \quad &amp; \text{ with prob. } \alpha \\
    x_i       \quad &amp; \text{ with prob. } 1 - \alpha
  \end{cases}
\end{split}
\end{equation*}\]</span></p>
<p>i.e.&nbsp;we accept the proposal <span class="math inline">\(\tilde{x}\)</span> with probability <span class="math inline">\(\alpha\)</span> and reject it, thus sticking with our current iterate, with probability <span class="math inline">\(1 - \alpha\)</span>.</p>
</section>
<section id="what-we-need-from-a-model-logdensityproblems.jl" class="level2">
<h2 class="anchored" data-anchor-id="what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a></h2>
<p>There are a few things we need from the “target” / “model” / density that we want to sample from:</p>
<ol type="1">
<li>We need access to log-density <em>evaluations</em> <span class="math inline">\(\log \gamma(x)\)</span> so we can compute the acceptance ratio involving <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>We need access to log-density <em>gradients</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span> so we can compute the Leapfrog steps <span class="math inline">\(L_{\epsilon}(x, p)\)</span>.</li>
<li>We also need access to the “size” of the model so we can determine the size of <span class="math inline">\(M\)</span>.</li>
</ol>
<p>Luckily for us, there is a package called <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> which provides an interface for <em>exactly</em> this!</p>
<p>To demonstrate how one can implement the “<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface”<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> we will use a simple Gaussian model as an example:</p>
<div id="4" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblems</span>: LogDensityProblems;</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's define some type that represents the model.</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> IsotropicNormalModel{M<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"mean of the isotropic Gaussian"</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    mean<span class="op">::</span><span class="dt">M</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Specifies what input length the model expects.</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">dimension</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> <span class="fu">length</span>(model.mean)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Implementation of the log-density evaluation of the model.</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x<span class="op">::</span><span class="dt">AbstractVector{&lt;:Real}</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">-</span> <span class="fu">sum</span>(abs2, x <span class="op">.-</span> model.mean) <span class="op">/</span> <span class="fl">2</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This gives us all of the properties we want for our MALA sampler with the exception of the computation of the <em>gradient</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span>. There is the method <code>LogDensityProblems.logdensity_and_gradient</code> which should return a 2-tuple where the first entry is the evaluation of the logdensity <span class="math inline">\(\log \gamma(x)\)</span> and the second entry is the gradient <span class="math inline">\(\nabla \log \gamma(x)\)</span>.</p>
<p>There are two ways to “implement” this method: 1) we implement it by hand, which is feasible in the case of our <code>IsotropicNormalModel</code>, or b) we defer the implementation of this to a automatic differentiation backend.</p>
<p>To implement it by hand we can simply do</p>
<div id="6" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl that first-order, i.e. gradient information, is available.</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{1}</span>()</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Implement `logdensity_and_gradient`.</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    logγ_x <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="op">-</span>x <span class="op">.*</span> (x <span class="op">-</span> model.mean)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> logγ_x, ∇logγ_x</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s just try it out:</p>
<div id="8" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate the problem.</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> <span class="fu">IsotropicNormalModel</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.])</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create some example input that we can test on.</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>x_example <span class="op">=</span> <span class="fu">randn</span>(LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate!</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-27.3908518657217</code></pre>
</div>
</div>
<p>To defer it to an automatic differentiation backend, we can do</p>
<div id="10" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl we only have access to 0-th order information.</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{0}</span>()</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Use `LogDensityProblemsAD`'s `ADgradient` in combination with some AD backend to implement `logdensity_and_gradient`.</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblemsAD</span>, <span class="bu">ADTypes</span>, <span class="bu">ForwardDiff</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>model_with_grad <span class="op">=</span> <span class="fu">ADgradient</span>(<span class="fu">AutoForwardDiff</span>(), model)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model_with_grad, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-27.3908518657217</code></pre>
</div>
</div>
<p>We’ll continue with the second approach in this tutorial since this is typically what one does in practice, because there are better hobbies to spend time on than deriving gradients by hand.</p>
<p>At this point, one might wonder how we’re going to tie this back to Turing.jl in the end. Effectively, when working with inference methods that only require log-density evaluations and / or higher-order information of the log-density, Turing.jl actually converts the user-provided <code>Model</code> into an object implementing the above methods for <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>. As a result, most samplers provided by Turing.jl are actually implemented to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, enabling their use both <em>within</em> Turing.jl and <em>outside</em> of Turing.jl! Morever, there exists similar conversions for Stan through BridgeStan and Stan<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, which means that a sampler supporting the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface can easily be used on both Turing.jl <em>and</em> Stan models (in addition to user-provided models, as our <code>IsotropicNormalModel</code> above)!</p>
<p>Anyways, let’s move on to actually implementing the sampler.</p>
</section>
<section id="implementing-mala-in-abstractmcmc.jl" class="level2">
<h2 class="anchored" data-anchor-id="implementing-mala-in-abstractmcmc.jl">Implementing MALA in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a></h2>
<p>Now that we’ve established that a model implementing the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface provides us with all the information we need from <span class="math inline">\(\log \gamma(x)\)</span>, we can address the question: given an object that implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, how can we define a sampler for it?</p>
<p>We’re going to do this by making our sampler a sub-type of <code>AbstractMCMC.AbstractSampler</code> in addition to implementing a few methods from <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>. Why? Because it gets us <em>a lot</em> of functionality for free, as we will see later.</p>
<p>Moreover, <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> provides a very natural interface for MCMC algorithms.</p>
<p>First, we’ll define our <code>MALA</code> type</p>
<div id="12" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">AbstractMCMC</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALA{T,A} <span class="op">&lt;:</span><span class="dt"> AbstractMCMC.AbstractSampler</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"stepsize used in the leapfrog step"</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    ϵ_init<span class="op">::</span><span class="dt">T</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"covariance matrix used for the momentum"</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    M_init<span class="op">::</span><span class="dt">A</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notice how we’ve added the suffix <code>_init</code> to both the stepsize and the covariance matrix. We’ve done this because a <code>AbstractMCMC.AbstractSampler</code> should be <em>immutable</em>. Of course there might be many scenarios where we want to allow something like the stepsize and / or the covariance matrix to vary between iterations, e.g.&nbsp;during the burn-in / adaptation phase of the sampling process we might want to adjust the parameters using statistics computed from these initial iterations. But information which can change between iterations <em>should not go in the sampler itself</em>! Instead, this information should go in the sampler <em>state</em>.</p>
<p>The sampler state should at the very least contain all the necessary information to perform the next MCMC iteration, but usually contains further information, e.g.&nbsp;quantities and statistics useful for evaluating whether the sampler has converged.</p>
<p>We will use the following sampler state for our <code>MALA</code> sampler:</p>
<div id="14" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALAState{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This might seem overly redundant: we’re defining a type <code>MALAState</code> and it only contains a simple vector of reals. In this particular case we indeed could have dropped this and simply used a <code>AbstractVector{&lt;:Real}</code> as our sampler state, but typically, as we will see later, one wants to include other quantities in the sampler state. For example, if we also wanted to adapt the parameters of our <code>MALA</code>, e.g.&nbsp;alter the stepsize depending on acceptance rates, in which case we should also put <code>ϵ</code> in the state, but for now we’ll keep things simple.</p>
<p>Moreover, we also want a <em>sample</em> type, which is a type meant for “public consumption”, i.e.&nbsp;the end-user. This is generally going to contain a subset of the information present in the state. But in such a simple scenario as this, we similarly only have a <code>AbstractVector{&lt;:Real}</code>:</p>
<div id="16" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALASample{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We currently have three things:</p>
<ol type="1">
<li>A <code>AbstractMCMC.AbstractSampler</code> implementation called <code>MALA</code>.</li>
<li>A state <code>MALAState</code> for our sampler <code>MALA</code>.</li>
<li>A sample <code>MALASample</code> for our sampler <code>MALA</code>.</li>
</ol>
<p>That means that we’re ready to implement the only thing that really matters: <code>AbstractMCMC.step</code>.</p>
<p><code>AbstractMCMC.step</code> defines the MCMC iteration of our <code>MALA</code> given the current <code>MALAState</code>. Specifically, the signature of the function is as follows:</p>
<div id="18" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The RNG to ensure reproducibility.</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The model that defines our target.</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.AbstractModel</span>,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The sampler for which we're taking a `step`.</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">AbstractMCMC.AbstractSampler</span>,</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The current sampler `state`.</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    state;</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Additional keyword arguments that we may or may not need.</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Moreover, there is a specific <code>AbstractMCMC.AbstractModel</code> which is used to indicate that the model that is provided implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface: <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Since, as we discussed earlier, in our case we’re indeed going to work with types that support the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, we’ll define <code>AbstractMCMC.step</code> for such a <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Note that <code>AbstractMCMC.LogDensityModel</code> has no other purpose; it has a single field called <code>logdensity</code>, and it does nothing else. But by wrapping the model in <code>AbstractMCMC.LogDensityModel</code>, it allows samplers that want to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> to define their <code>AbstractMCMC.step</code> on this type without running into method ambiguities.</p>
<p>All in all, that means that the signature for our <code>AbstractMCMC.step</code> is going to be the following:</p>
<div id="20" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># `LogDensityModel` so we know we're working with LogDensityProblems.jl model.</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler.</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler state.</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Great! Now let’s actually implement the full <code>AbstractMCMC.step</code> for our <code>MALA</code>.</p>
<p>Let’s remind ourselves what we’re going to do:</p>
<ol type="1">
<li>Sample a new momentum <span class="math inline">\(p\)</span>.</li>
<li>Compute the log-density of the extended target <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>Take a single leapfrog step <span class="math inline">\((\tilde{x}, \tilde{p}) = L_{\epsilon}(x, p)\)</span>.</li>
<li>Accept or reject the proposed <span class="math inline">\((\tilde{x}, \tilde{p})\)</span>.</li>
</ol>
<p>All in all, this results in the following:</p>
<div id="22" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>: Random</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Distributions</span>  <span class="co"># so we get the `MvNormal`</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the wrapped model which implements LogDensityProblems.jl.</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just extract the sampler parameters to make our lives easier.</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    ϵ <span class="op">=</span> sampler.ϵ_init</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    M <span class="op">=</span> sampler.M_init</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the current parameters.</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> state.x</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sample the momentum.</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>    p_dist <span class="op">=</span> <span class="fu">MvNormal</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)), M)</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> <span class="fu">rand</span>(rng, p_dist)</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Propose using a single leapfrog step.</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>    x̃, p̃ <span class="op">=</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Accept or reject proposal.</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>    logp <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p)</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>    logp̃ <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x̃) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p̃)</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>    logα <span class="op">=</span> logp̃ <span class="op">-</span> logp</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>    state_new <span class="op">=</span> <span class="cf">if</span> <span class="fu">log</span>(<span class="fu">rand</span>(rng)) <span class="op">&lt;</span> logα</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Accept.</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x̃)</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Reject.</span></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x)</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return the "sample" and the sampler state.</span></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(state_new.x), state_new</span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Fairly straight-forward.</p>
<p>Of course, we haven’t defined the <code>leapfrog_step</code> method yet, so let’s do that:</p>
<div id="24" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p` using "position" `x`.</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x))</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    p1 <span class="op">=</span> p <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update the "position" `x` using momentum `p1`.</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    x̃ <span class="op">=</span> x <span class="op">+</span> ϵ <span class="op">.*</span> (M <span class="op">\</span> p1)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p1` using position `x̃`</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x̃ <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x̃))</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    p2 <span class="op">=</span> p1 <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x̃</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Flip momentum `p2`.</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    p̃ <span class="op">=</span> <span class="op">-</span>p2</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x̃, p̃</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>leapfrog_step (generic function with 1 method)</code></pre>
</div>
</div>
<p>With all of this, we’re technically ready to sample!</p>
<div id="26" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>, <span class="bu">LinearAlgebra</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>rng <span class="op">=</span> <span class="bu">Random</span>.<span class="fu">default_rng</span>()</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>sampler <span class="op">=</span> <span class="fu">MALA</span>(<span class="fl">1</span>, I)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>state <span class="op">=</span> <span class="fu">MALAState</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)))</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>x_next, state_next <span class="op">=</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    rng,</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    AbstractMCMC.<span class="fu">LogDensityModel</span>(model),</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    state</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>(MALASample{Vector{Float64}}([0.0, 0.0, 0.0]), MALAState{Vector{Float64}}([0.0, 0.0, 0.0]))</code></pre>
</div>
</div>
<p>Great, it works!</p>
<p>And I promised we would get quite some functionality for free if we implemented <code>AbstractMCMC.step</code>, and so we can now simply call <code>sample</code> to perform standard MCMC sampling:</p>
<div id="28" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform 1000 iterations with our `MALA` sampler.</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; initial_state<span class="op">=</span>state, progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Concatenate into a matrix.</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000 Matrix{Float64}:
 -3.11508   -4.85606   -4.59001   -4.79664  …  -4.48295  -5.56959   -4.27907
  0.238019  -0.553859  -0.778029  -1.09424     -1.01413  -0.285844   1.09786
  1.79024    2.61008    4.66659    5.49248      6.39525   7.28375    4.55145</code></pre>
</div>
</div>
<div id="30" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the marginal means and standard deviations.</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -4.98143    1.01191
  0.0187839  0.99466
  5.0324     1.00452</code></pre>
</div>
</div>
<p>Let’s visualize the samples</p>
<div id="32" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">StatsPlots</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">transpose</span>(samples_matrix[<span class="op">:</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">:</span><span class="kw">end</span>]), alpha<span class="op">=</span><span class="fl">0.5</span>, legend<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<!--?xml version="1.0" encoding="utf-8"?-->
<svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" width="672" height="480" viewbox="0 0 2688 1920">
<defs>
  <clippath id="clip690">
    <rect x="0" y="0" width="2688" height="1920"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip690)" d="M0 1920 L2688 1920 L2688 0 L0 0  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip691">
    <rect x="537" y="0" width="1883" height="1883"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip690)" d="M196.816 1800.78 L2640.76 1800.78 L2640.76 47.2441 L196.816 47.2441  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip692">
    <rect x="196" y="47" width="2445" height="1755"></rect>
  </clippath>
</defs>
<polyline clip-path="url(#clip692)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="263.676,1800.78 263.676,47.2441 "></polyline>
<polyline clip-path="url(#clip692)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="840.654,1800.78 840.654,47.2441 "></polyline>
<polyline clip-path="url(#clip692)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1417.63,1800.78 1417.63,47.2441 "></polyline>
<polyline clip-path="url(#clip692)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1994.61,1800.78 1994.61,47.2441 "></polyline>
<polyline clip-path="url(#clip692)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="2571.59,1800.78 2571.59,47.2441 "></polyline>
<polyline clip-path="url(#clip692)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,1680.81 2640.76,1680.81 "></polyline>
<polyline clip-path="url(#clip692)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,1437.84 2640.76,1437.84 "></polyline>
<polyline clip-path="url(#clip692)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,1194.86 2640.76,1194.86 "></polyline>
<polyline clip-path="url(#clip692)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,951.89 2640.76,951.89 "></polyline>
<polyline clip-path="url(#clip692)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,708.917 2640.76,708.917 "></polyline>
<polyline clip-path="url(#clip692)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,465.944 2640.76,465.944 "></polyline>
<polyline clip-path="url(#clip692)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,222.971 2640.76,222.971 "></polyline>
<polyline clip-path="url(#clip690)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1800.78 2640.76,1800.78 "></polyline>
<polyline clip-path="url(#clip690)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="263.676,1800.78 263.676,1781.88 "></polyline>
<polyline clip-path="url(#clip690)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="840.654,1800.78 840.654,1781.88 "></polyline>
<polyline clip-path="url(#clip690)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1417.63,1800.78 1417.63,1781.88 "></polyline>
<polyline clip-path="url(#clip690)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1994.61,1800.78 1994.61,1781.88 "></polyline>
<polyline clip-path="url(#clip690)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="2571.59,1800.78 2571.59,1781.88 "></polyline>
<path clip-path="url(#clip690)" d="M263.676 1834 Q260.065 1834 258.236 1837.57 Q256.431 1841.11 256.431 1848.24 Q256.431 1855.34 258.236 1858.91 Q260.065 1862.45 263.676 1862.45 Q267.31 1862.45 269.116 1858.91 Q270.945 1855.34 270.945 1848.24 Q270.945 1841.11 269.116 1837.57 Q267.31 1834 263.676 1834 M263.676 1830.3 Q269.486 1830.3 272.542 1834.9 Q275.621 1839.49 275.621 1848.24 Q275.621 1856.96 272.542 1861.57 Q269.486 1866.15 263.676 1866.15 Q257.866 1866.15 254.787 1861.57 Q251.732 1856.96 251.732 1848.24 Q251.732 1839.49 254.787 1834.9 Q257.866 1830.3 263.676 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip690)" d="M804.346 1861.55 L820.666 1861.55 L820.666 1865.48 L798.721 1865.48 L798.721 1861.55 Q801.383 1858.79 805.967 1854.16 Q810.573 1849.51 811.754 1848.17 Q813.999 1845.65 814.879 1843.91 Q815.782 1842.15 815.782 1840.46 Q815.782 1837.71 813.837 1835.97 Q811.916 1834.23 808.814 1834.23 Q806.615 1834.23 804.161 1835 Q801.731 1835.76 798.953 1837.31 L798.953 1832.59 Q801.777 1831.46 804.231 1830.88 Q806.684 1830.3 808.721 1830.3 Q814.092 1830.3 817.286 1832.98 Q820.481 1835.67 820.481 1840.16 Q820.481 1842.29 819.67 1844.21 Q818.883 1846.11 816.777 1848.7 Q816.198 1849.37 813.096 1852.59 Q809.995 1855.78 804.346 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip690)" d="M830.527 1830.92 L848.883 1830.92 L848.883 1834.86 L834.809 1834.86 L834.809 1843.33 Q835.828 1842.98 836.846 1842.82 Q837.865 1842.64 838.883 1842.64 Q844.67 1842.64 848.05 1845.81 Q851.43 1848.98 851.43 1854.4 Q851.43 1859.97 847.957 1863.08 Q844.485 1866.15 838.166 1866.15 Q835.99 1866.15 833.721 1865.78 Q831.476 1865.41 829.069 1864.67 L829.069 1859.97 Q831.152 1861.11 833.374 1861.66 Q835.596 1862.22 838.073 1862.22 Q842.078 1862.22 844.416 1860.11 Q846.754 1858.01 846.754 1854.4 Q846.754 1850.78 844.416 1848.68 Q842.078 1846.57 838.073 1846.57 Q836.198 1846.57 834.323 1846.99 Q832.471 1847.4 830.527 1848.28 L830.527 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip690)" d="M870.642 1834 Q867.031 1834 865.203 1837.57 Q863.397 1841.11 863.397 1848.24 Q863.397 1855.34 865.203 1858.91 Q867.031 1862.45 870.642 1862.45 Q874.277 1862.45 876.082 1858.91 Q877.911 1855.34 877.911 1848.24 Q877.911 1841.11 876.082 1837.57 Q874.277 1834 870.642 1834 M870.642 1830.3 Q876.453 1830.3 879.508 1834.9 Q882.587 1839.49 882.587 1848.24 Q882.587 1856.96 879.508 1861.57 Q876.453 1866.15 870.642 1866.15 Q864.832 1866.15 861.754 1861.57 Q858.698 1856.96 858.698 1848.24 Q858.698 1839.49 861.754 1834.9 Q864.832 1830.3 870.642 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip690)" d="M1377.25 1830.92 L1395.61 1830.92 L1395.61 1834.86 L1381.53 1834.86 L1381.53 1843.33 Q1382.55 1842.98 1383.57 1842.82 Q1384.59 1842.64 1385.61 1842.64 Q1391.39 1842.64 1394.77 1845.81 Q1398.15 1848.98 1398.15 1854.4 Q1398.15 1859.97 1394.68 1863.08 Q1391.21 1866.15 1384.89 1866.15 Q1382.71 1866.15 1380.44 1865.78 Q1378.2 1865.41 1375.79 1864.67 L1375.79 1859.97 Q1377.88 1861.11 1380.1 1861.66 Q1382.32 1862.22 1384.8 1862.22 Q1388.8 1862.22 1391.14 1860.11 Q1393.48 1858.01 1393.48 1854.4 Q1393.48 1850.78 1391.14 1848.68 Q1388.8 1846.57 1384.8 1846.57 Q1382.92 1846.57 1381.05 1846.99 Q1379.19 1847.4 1377.25 1848.28 L1377.25 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip690)" d="M1417.37 1834 Q1413.75 1834 1411.93 1837.57 Q1410.12 1841.11 1410.12 1848.24 Q1410.12 1855.34 1411.93 1858.91 Q1413.75 1862.45 1417.37 1862.45 Q1421 1862.45 1422.81 1858.91 Q1424.63 1855.34 1424.63 1848.24 Q1424.63 1841.11 1422.81 1837.57 Q1421 1834 1417.37 1834 M1417.37 1830.3 Q1423.18 1830.3 1426.23 1834.9 Q1429.31 1839.49 1429.31 1848.24 Q1429.31 1856.96 1426.23 1861.57 Q1423.18 1866.15 1417.37 1866.15 Q1411.56 1866.15 1408.48 1861.57 Q1405.42 1856.96 1405.42 1848.24 Q1405.42 1839.49 1408.48 1834.9 Q1411.56 1830.3 1417.37 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip690)" d="M1447.53 1834 Q1443.92 1834 1442.09 1837.57 Q1440.28 1841.11 1440.28 1848.24 Q1440.28 1855.34 1442.09 1858.91 Q1443.92 1862.45 1447.53 1862.45 Q1451.16 1862.45 1452.97 1858.91 Q1454.8 1855.34 1454.8 1848.24 Q1454.8 1841.11 1452.97 1837.57 Q1451.16 1834 1447.53 1834 M1447.53 1830.3 Q1453.34 1830.3 1456.39 1834.9 Q1459.47 1839.49 1459.47 1848.24 Q1459.47 1856.96 1456.39 1861.57 Q1453.34 1866.15 1447.53 1866.15 Q1441.72 1866.15 1438.64 1861.57 Q1435.58 1856.96 1435.58 1848.24 Q1435.58 1839.49 1438.64 1834.9 Q1441.72 1830.3 1447.53 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip690)" d="M1952.89 1830.92 L1975.11 1830.92 L1975.11 1832.91 L1962.56 1865.48 L1957.68 1865.48 L1969.48 1834.86 L1952.89 1834.86 L1952.89 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip690)" d="M1984.27 1830.92 L2002.63 1830.92 L2002.63 1834.86 L1988.56 1834.86 L1988.56 1843.33 Q1989.58 1842.98 1990.59 1842.82 Q1991.61 1842.64 1992.63 1842.64 Q1998.42 1842.64 2001.8 1845.81 Q2005.18 1848.98 2005.18 1854.4 Q2005.18 1859.97 2001.7 1863.08 Q1998.23 1866.15 1991.91 1866.15 Q1989.74 1866.15 1987.47 1865.78 Q1985.22 1865.41 1982.82 1864.67 L1982.82 1859.97 Q1984.9 1861.11 1987.12 1861.66 Q1989.34 1862.22 1991.82 1862.22 Q1995.83 1862.22 1998.16 1860.11 Q2000.5 1858.01 2000.5 1854.4 Q2000.5 1850.78 1998.16 1848.68 Q1995.83 1846.57 1991.82 1846.57 Q1989.95 1846.57 1988.07 1846.99 Q1986.22 1847.4 1984.27 1848.28 L1984.27 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip690)" d="M2024.39 1834 Q2020.78 1834 2018.95 1837.57 Q2017.14 1841.11 2017.14 1848.24 Q2017.14 1855.34 2018.95 1858.91 Q2020.78 1862.45 2024.39 1862.45 Q2028.02 1862.45 2029.83 1858.91 Q2031.66 1855.34 2031.66 1848.24 Q2031.66 1841.11 2029.83 1837.57 Q2028.02 1834 2024.39 1834 M2024.39 1830.3 Q2030.2 1830.3 2033.26 1834.9 Q2036.33 1839.49 2036.33 1848.24 Q2036.33 1856.96 2033.26 1861.57 Q2030.2 1866.15 2024.39 1866.15 Q2018.58 1866.15 2015.5 1861.57 Q2012.45 1856.96 2012.45 1848.24 Q2012.45 1839.49 2015.5 1834.9 Q2018.58 1830.3 2024.39 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip690)" d="M2516.11 1861.55 L2523.75 1861.55 L2523.75 1835.18 L2515.44 1836.85 L2515.44 1832.59 L2523.71 1830.92 L2528.38 1830.92 L2528.38 1861.55 L2536.02 1861.55 L2536.02 1865.48 L2516.11 1865.48 L2516.11 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip690)" d="M2555.47 1834 Q2551.85 1834 2550.03 1837.57 Q2548.22 1841.11 2548.22 1848.24 Q2548.22 1855.34 2550.03 1858.91 Q2551.85 1862.45 2555.47 1862.45 Q2559.1 1862.45 2560.9 1858.91 Q2562.73 1855.34 2562.73 1848.24 Q2562.73 1841.11 2560.9 1837.57 Q2559.1 1834 2555.47 1834 M2555.47 1830.3 Q2561.28 1830.3 2564.33 1834.9 Q2567.41 1839.49 2567.41 1848.24 Q2567.41 1856.96 2564.33 1861.57 Q2561.28 1866.15 2555.47 1866.15 Q2549.66 1866.15 2546.58 1861.57 Q2543.52 1856.96 2543.52 1848.24 Q2543.52 1839.49 2546.58 1834.9 Q2549.66 1830.3 2555.47 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip690)" d="M2585.63 1834 Q2582.02 1834 2580.19 1837.57 Q2578.38 1841.11 2578.38 1848.24 Q2578.38 1855.34 2580.19 1858.91 Q2582.02 1862.45 2585.63 1862.45 Q2589.26 1862.45 2591.07 1858.91 Q2592.9 1855.34 2592.9 1848.24 Q2592.9 1841.11 2591.07 1837.57 Q2589.26 1834 2585.63 1834 M2585.63 1830.3 Q2591.44 1830.3 2594.49 1834.9 Q2597.57 1839.49 2597.57 1848.24 Q2597.57 1856.96 2594.49 1861.57 Q2591.44 1866.15 2585.63 1866.15 Q2579.82 1866.15 2576.74 1861.57 Q2573.68 1856.96 2573.68 1848.24 Q2573.68 1839.49 2576.74 1834.9 Q2579.82 1830.3 2585.63 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip690)" d="M2615.79 1834 Q2612.18 1834 2610.35 1837.57 Q2608.54 1841.11 2608.54 1848.24 Q2608.54 1855.34 2610.35 1858.91 Q2612.18 1862.45 2615.79 1862.45 Q2619.42 1862.45 2621.23 1858.91 Q2623.06 1855.34 2623.06 1848.24 Q2623.06 1841.11 2621.23 1837.57 Q2619.42 1834 2615.79 1834 M2615.79 1830.3 Q2621.6 1830.3 2624.65 1834.9 Q2627.73 1839.49 2627.73 1848.24 Q2627.73 1856.96 2624.65 1861.57 Q2621.6 1866.15 2615.79 1866.15 Q2609.98 1866.15 2606.9 1861.57 Q2603.84 1856.96 2603.84 1848.24 Q2603.84 1839.49 2606.9 1834.9 Q2609.98 1830.3 2615.79 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip690)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1800.78 196.816,47.2441 "></polyline>
<polyline clip-path="url(#clip690)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1680.81 215.714,1680.81 "></polyline>
<polyline clip-path="url(#clip690)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1437.84 215.714,1437.84 "></polyline>
<polyline clip-path="url(#clip690)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1194.86 215.714,1194.86 "></polyline>
<polyline clip-path="url(#clip690)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,951.89 215.714,951.89 "></polyline>
<polyline clip-path="url(#clip690)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,708.917 215.714,708.917 "></polyline>
<polyline clip-path="url(#clip690)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,465.944 215.714,465.944 "></polyline>
<polyline clip-path="url(#clip690)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,222.971 215.714,222.971 "></polyline>
<path clip-path="url(#clip690)" d="M50.5475 1681.26 L80.2233 1681.26 L80.2233 1685.2 L50.5475 1685.2 L50.5475 1681.26 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip690)" d="M89.1352 1663.53 L111.357 1663.53 L111.357 1665.52 L98.8111 1698.09 L93.9269 1698.09 L105.732 1667.46 L89.1352 1667.46 L89.1352 1663.53 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip690)" d="M120.478 1692.21 L125.362 1692.21 L125.362 1698.09 L120.478 1698.09 L120.478 1692.21 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip690)" d="M135.593 1663.53 L153.95 1663.53 L153.95 1667.46 L139.876 1667.46 L139.876 1675.94 Q140.894 1675.59 141.913 1675.43 Q142.931 1675.24 143.95 1675.24 Q149.737 1675.24 153.116 1678.41 Q156.496 1681.58 156.496 1687 Q156.496 1692.58 153.024 1695.68 Q149.552 1698.76 143.232 1698.76 Q141.056 1698.76 138.788 1698.39 Q136.542 1698.02 134.135 1697.28 L134.135 1692.58 Q136.218 1693.71 138.441 1694.27 Q140.663 1694.82 143.14 1694.82 Q147.144 1694.82 149.482 1692.72 Q151.82 1690.61 151.82 1687 Q151.82 1683.39 149.482 1681.28 Q147.144 1679.18 143.14 1679.18 Q141.265 1679.18 139.39 1679.59 Q137.538 1680.01 135.593 1680.89 L135.593 1663.53 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip690)" d="M49.5521 1438.29 L79.2279 1438.29 L79.2279 1442.22 L49.5521 1442.22 L49.5521 1438.29 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip690)" d="M89.3667 1420.56 L107.723 1420.56 L107.723 1424.49 L93.6491 1424.49 L93.6491 1432.96 Q94.6676 1432.62 95.6861 1432.45 Q96.7047 1432.27 97.7232 1432.27 Q103.51 1432.27 106.89 1435.44 Q110.269 1438.61 110.269 1444.03 Q110.269 1449.61 106.797 1452.71 Q103.325 1455.79 97.0056 1455.79 Q94.8297 1455.79 92.5612 1455.42 Q90.3158 1455.05 87.9084 1454.31 L87.9084 1449.61 Q89.9917 1450.74 92.2139 1451.3 Q94.4361 1451.85 96.913 1451.85 Q100.918 1451.85 103.256 1449.75 Q105.593 1447.64 105.593 1444.03 Q105.593 1440.42 103.256 1438.31 Q100.918 1436.2 96.913 1436.2 Q95.038 1436.2 93.163 1436.62 Q91.3112 1437.04 89.3667 1437.92 L89.3667 1420.56 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip690)" d="M119.482 1449.24 L124.367 1449.24 L124.367 1455.12 L119.482 1455.12 L119.482 1449.24 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip690)" d="M144.552 1423.63 Q140.941 1423.63 139.112 1427.2 Q137.306 1430.74 137.306 1437.87 Q137.306 1444.98 139.112 1448.54 Q140.941 1452.08 144.552 1452.08 Q148.186 1452.08 149.991 1448.54 Q151.82 1444.98 151.82 1437.87 Q151.82 1430.74 149.991 1427.2 Q148.186 1423.63 144.552 1423.63 M144.552 1419.93 Q150.362 1419.93 153.417 1424.54 Q156.496 1429.12 156.496 1437.87 Q156.496 1446.6 153.417 1451.2 Q150.362 1455.79 144.552 1455.79 Q138.741 1455.79 135.663 1451.2 Q132.607 1446.6 132.607 1437.87 Q132.607 1429.12 135.663 1424.54 Q138.741 1419.93 144.552 1419.93 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip690)" d="M50.5475 1195.31 L80.2233 1195.31 L80.2233 1199.25 L50.5475 1199.25 L50.5475 1195.31 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip690)" d="M94.3436 1208.21 L110.663 1208.21 L110.663 1212.14 L88.7186 1212.14 L88.7186 1208.21 Q91.3806 1205.45 95.9639 1200.82 Q100.57 1196.17 101.751 1194.83 Q103.996 1192.31 104.876 1190.57 Q105.779 1188.81 105.779 1187.12 Q105.779 1184.37 103.834 1182.63 Q101.913 1180.89 98.8111 1180.89 Q96.6121 1180.89 94.1584 1181.66 Q91.7278 1182.42 88.9501 1183.97 L88.9501 1179.25 Q91.7741 1178.12 94.2278 1177.54 Q96.6815 1176.96 98.7185 1176.96 Q104.089 1176.96 107.283 1179.64 Q110.478 1182.33 110.478 1186.82 Q110.478 1188.95 109.668 1190.87 Q108.881 1192.77 106.774 1195.36 Q106.195 1196.03 103.094 1199.25 Q99.9917 1202.44 94.3436 1208.21 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip690)" d="M120.478 1206.26 L125.362 1206.26 L125.362 1212.14 L120.478 1212.14 L120.478 1206.26 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip690)" d="M135.593 1177.58 L153.95 1177.58 L153.95 1181.52 L139.876 1181.52 L139.876 1189.99 Q140.894 1189.64 141.913 1189.48 Q142.931 1189.3 143.95 1189.3 Q149.737 1189.3 153.116 1192.47 Q156.496 1195.64 156.496 1201.06 Q156.496 1206.63 153.024 1209.74 Q149.552 1212.81 143.232 1212.81 Q141.056 1212.81 138.788 1212.44 Q136.542 1212.07 134.135 1211.33 L134.135 1206.63 Q136.218 1207.77 138.441 1208.32 Q140.663 1208.88 143.14 1208.88 Q147.144 1208.88 149.482 1206.77 Q151.82 1204.67 151.82 1201.06 Q151.82 1197.44 149.482 1195.34 Q147.144 1193.23 143.14 1193.23 Q141.265 1193.23 139.39 1193.65 Q137.538 1194.06 135.593 1194.94 L135.593 1177.58 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip690)" d="M99.3204 937.689 Q95.7093 937.689 93.8806 941.254 Q92.075 944.795 92.075 951.925 Q92.075 959.031 93.8806 962.596 Q95.7093 966.138 99.3204 966.138 Q102.955 966.138 104.76 962.596 Q106.589 959.031 106.589 951.925 Q106.589 944.795 104.76 941.254 Q102.955 937.689 99.3204 937.689 M99.3204 933.985 Q105.131 933.985 108.186 938.592 Q111.265 943.175 111.265 951.925 Q111.265 960.652 108.186 965.258 Q105.131 969.841 99.3204 969.841 Q93.5102 969.841 90.4315 965.258 Q87.376 960.652 87.376 951.925 Q87.376 943.175 90.4315 938.592 Q93.5102 933.985 99.3204 933.985 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip690)" d="M119.482 963.29 L124.367 963.29 L124.367 969.17 L119.482 969.17 L119.482 963.29 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip690)" d="M144.552 937.689 Q140.941 937.689 139.112 941.254 Q137.306 944.795 137.306 951.925 Q137.306 959.031 139.112 962.596 Q140.941 966.138 144.552 966.138 Q148.186 966.138 149.991 962.596 Q151.82 959.031 151.82 951.925 Q151.82 944.795 149.991 941.254 Q148.186 937.689 144.552 937.689 M144.552 933.985 Q150.362 933.985 153.417 938.592 Q156.496 943.175 156.496 951.925 Q156.496 960.652 153.417 965.258 Q150.362 969.841 144.552 969.841 Q138.741 969.841 135.663 965.258 Q132.607 960.652 132.607 951.925 Q132.607 943.175 135.663 938.592 Q138.741 933.985 144.552 933.985 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip690)" d="M94.3436 722.262 L110.663 722.262 L110.663 726.197 L88.7186 726.197 L88.7186 722.262 Q91.3806 719.507 95.9639 714.878 Q100.57 710.225 101.751 708.882 Q103.996 706.359 104.876 704.623 Q105.779 702.864 105.779 701.174 Q105.779 698.42 103.834 696.683 Q101.913 694.947 98.8111 694.947 Q96.6121 694.947 94.1584 695.711 Q91.7278 696.475 88.9501 698.026 L88.9501 693.304 Q91.7741 692.17 94.2278 691.591 Q96.6815 691.012 98.7185 691.012 Q104.089 691.012 107.283 693.697 Q110.478 696.383 110.478 700.873 Q110.478 703.003 109.668 704.924 Q108.881 706.822 106.774 709.415 Q106.195 710.086 103.094 713.304 Q99.9917 716.498 94.3436 722.262 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip690)" d="M120.478 720.318 L125.362 720.318 L125.362 726.197 L120.478 726.197 L120.478 720.318 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip690)" d="M135.593 691.637 L153.95 691.637 L153.95 695.572 L139.876 695.572 L139.876 704.045 Q140.894 703.697 141.913 703.535 Q142.931 703.35 143.95 703.35 Q149.737 703.35 153.116 706.521 Q156.496 709.693 156.496 715.109 Q156.496 720.688 153.024 723.79 Q149.552 726.868 143.232 726.868 Q141.056 726.868 138.788 726.498 Q136.542 726.128 134.135 725.387 L134.135 720.688 Q136.218 721.822 138.441 722.378 Q140.663 722.933 143.14 722.933 Q147.144 722.933 149.482 720.827 Q151.82 718.72 151.82 715.109 Q151.82 711.498 149.482 709.392 Q147.144 707.285 143.14 707.285 Q141.265 707.285 139.39 707.702 Q137.538 708.119 135.593 708.998 L135.593 691.637 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip690)" d="M89.3667 448.664 L107.723 448.664 L107.723 452.599 L93.6491 452.599 L93.6491 461.072 Q94.6676 460.724 95.6861 460.562 Q96.7047 460.377 97.7232 460.377 Q103.51 460.377 106.89 463.548 Q110.269 466.72 110.269 472.136 Q110.269 477.715 106.797 480.817 Q103.325 483.896 97.0056 483.896 Q94.8297 483.896 92.5612 483.525 Q90.3158 483.155 87.9084 482.414 L87.9084 477.715 Q89.9917 478.849 92.2139 479.405 Q94.4361 479.96 96.913 479.96 Q100.918 479.96 103.256 477.854 Q105.593 475.747 105.593 472.136 Q105.593 468.525 103.256 466.419 Q100.918 464.312 96.913 464.312 Q95.038 464.312 93.163 464.729 Q91.3112 465.146 89.3667 466.025 L89.3667 448.664 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip690)" d="M119.482 477.345 L124.367 477.345 L124.367 483.224 L119.482 483.224 L119.482 477.345 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip690)" d="M144.552 451.743 Q140.941 451.743 139.112 455.308 Q137.306 458.849 137.306 465.979 Q137.306 473.085 139.112 476.65 Q140.941 480.192 144.552 480.192 Q148.186 480.192 149.991 476.65 Q151.82 473.085 151.82 465.979 Q151.82 458.849 149.991 455.308 Q148.186 451.743 144.552 451.743 M144.552 448.039 Q150.362 448.039 153.417 452.646 Q156.496 457.229 156.496 465.979 Q156.496 474.706 153.417 479.312 Q150.362 483.896 144.552 483.896 Q138.741 483.896 135.663 479.312 Q132.607 474.706 132.607 465.979 Q132.607 457.229 135.663 452.646 Q138.741 448.039 144.552 448.039 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip690)" d="M89.1352 205.691 L111.357 205.691 L111.357 207.682 L98.8111 240.251 L93.9269 240.251 L105.732 209.627 L89.1352 209.627 L89.1352 205.691 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip690)" d="M120.478 234.372 L125.362 234.372 L125.362 240.251 L120.478 240.251 L120.478 234.372 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip690)" d="M135.593 205.691 L153.95 205.691 L153.95 209.627 L139.876 209.627 L139.876 218.099 Q140.894 217.752 141.913 217.589 Q142.931 217.404 143.95 217.404 Q149.737 217.404 153.116 220.576 Q156.496 223.747 156.496 229.163 Q156.496 234.742 153.024 237.844 Q149.552 240.923 143.232 240.923 Q141.056 240.923 138.788 240.552 Q136.542 240.182 134.135 239.441 L134.135 234.742 Q136.218 235.876 138.441 236.432 Q140.663 236.988 143.14 236.988 Q147.144 236.988 149.482 234.881 Q151.82 232.775 151.82 229.163 Q151.82 225.552 149.482 223.446 Q147.144 221.339 143.14 221.339 Q141.265 221.339 139.39 221.756 Q137.538 222.173 135.593 223.052 L135.593 205.691 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip692)" style="stroke:#009af9; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="265.984,1254.64 268.292,1232.56 270.6,1423.81 272.908,1361.34 275.216,1513.43 277.524,1285.76 279.832,1496.13 282.139,1487.57 284.447,1467.97 286.755,1639.49 289.063,1439.48 291.371,1393.29 293.679,1330.22 295.987,1406.31 298.295,1607.8 300.603,1514.57 302.911,1427.63 305.219,1352.15 307.527,1402.3 309.834,1528.15 312.142,1456.26 314.45,1532.11 316.758,1619.39 319.066,1452.46 321.374,1515.01 323.682,1569.88 325.99,1585.6 328.298,1503.07 330.606,1452.85 332.914,1388.37 335.221,1406.92 337.529,1485.56 339.837,1424.38 342.145,1446.4 344.453,1351.34 346.761,1511.36 349.069,1372.06 351.377,1526.72 353.685,1295.04 355.993,1466.12 358.301,1309.05 360.608,1345.35 362.916,1620.92 365.224,1489.84 367.532,1589.12 369.84,1689.99 372.148,1388.05 374.456,1488.35 376.764,1415 379.072,1355.21 381.38,1554.3 383.688,1544.3 385.996,1499.81 388.303,1280.27 390.611,1386.67 392.919,1531.36 395.227,1372.74 397.535,1327.91 399.843,1241.8 402.151,1245.92 404.459,1485.25 406.767,1499 409.075,1464.78 411.383,1473.84 413.69,1574.62 415.998,1328.71 418.306,1287.45 420.614,1381.33 422.922,1464.41 425.23,1409.52 427.538,1539.14 429.846,1383.5 432.154,1463.61 434.462,1407.08 436.77,1373.51 439.077,1379.39 441.385,1570.88 443.693,1381.44 446.001,1404.56 448.309,1472.08 450.617,1408.24 452.925,1545.43 455.233,1525.55 457.541,1167.32 459.849,1418.89 462.157,1603.29 464.465,1578.45 466.772,1475.49 469.08,1455.56 471.388,1340.98 473.696,1557.04 476.004,1302.05 478.312,1497.66 480.62,1559.35 482.928,1489.46 485.236,1408.08 487.544,1317.31 489.852,1477.38 492.159,1405.19 494.467,1363.58 496.775,1566.24 499.083,1334.81 501.391,1492.43 503.699,1320.49 506.007,1233.93 508.315,1373.35 510.623,1357.48 512.931,1374.55 515.239,1491.43 517.546,1308.53 519.854,1456.66 522.162,1402.28 524.47,1445.02 526.778,1498.92 529.086,1570.45 531.394,1523.4 533.702,1436.12 536.01,1504.99 538.318,1610.44 540.626,1458.78 542.933,1520.8 545.241,1543.01 547.549,1375.89 549.857,1574.98 552.165,1362.21 554.473,1241.36 556.781,1472.63 559.089,1516.91 561.397,1440.25 563.705,1543.44 566.013,1356.16 568.321,1626.78 570.628,1385.31 572.936,1536.77 575.244,1433.63 577.552,1540.75 579.86,1587.18 582.168,1481.48 584.476,1414.6 586.784,1365.67 589.092,1620.78 591.4,1548.21 593.708,1476.09 596.015,1352.5 598.323,1497.6 600.631,1493.64 602.939,1573.54 605.247,1539.11 607.555,1525.06 609.863,1352.67 612.171,1284.33 614.479,1603.2 616.787,1345.83 619.095,1436.85 621.402,1351.68 623.71,1472.62 626.018,1400.07 628.326,1465.29 630.634,1517.38 632.942,1458.87 635.25,1432.52 637.558,1370.15 639.866,1463.57 642.174,1369.99 644.482,1320.4 646.79,1504.77 649.097,1456.75 651.405,1628.3 653.713,1486.57 656.021,1528.24 658.329,1458.14 660.637,1455.4 662.945,1323.16 665.253,1398.45 667.561,1444.74 669.869,1504.77 672.177,1488.33 674.484,1352.33 676.792,1340.47 679.1,1445.57 681.408,1390.97 683.716,1417.26 686.024,1452.31 688.332,1579.37 690.64,1400.73 692.948,1332.29 695.256,1493.68 697.564,1347.96 699.871,1510.91 702.179,1441.47 704.487,1212.08 706.795,1252.36 709.103,1446.2 711.411,1556.59 713.719,1362.46 716.027,1497.14 718.335,1418.59 720.643,1421.22 722.951,1491.96 725.259,1319.34 727.566,1460.98 729.874,1453.2 732.182,1555.78 734.49,1530.12 736.798,1363.08 739.106,1470.52 741.414,1415.28 743.722,1512.44 746.03,1496.01 748.338,1514.74 750.646,1413.69 752.953,1346.69 755.261,1557.75 757.569,1258.46 759.877,1475.76 762.185,1468.05 764.493,1429.79 766.801,1294.86 769.109,1428.24 771.417,1441.38 773.725,1468.78 776.033,1490.84 778.34,1356.06 780.648,1392.45 782.956,1359.49 785.264,1590.77 787.572,1342.29 789.88,1424.09 792.188,1454.67 794.496,1454.95 796.804,1371.93 799.112,1384.76 801.42,1453.34 803.728,1463.87 806.035,1232.89 808.343,1412.71 810.651,1345.06 812.959,1438.33 815.267,1504.57 817.575,1424.7 819.883,1475.41 822.191,1442.13 824.499,1283.94 826.807,1248.86 829.115,1340.29 831.422,1336.87 833.73,1250.96 836.038,1399.04 838.346,1277.62 840.654,1598.51 842.962,1464.92 845.27,1440.16 847.578,1381.38 849.886,1346.49 852.194,1371.47 854.502,1478.11 856.809,1557.99 859.117,1405.08 861.425,1535.82 863.733,1279.29 866.041,1463.61 868.349,1430.93 870.657,1342.25 872.965,1343.63 875.273,1513.77 877.581,1443.25 879.889,1460.52 882.197,1377.86 884.504,1591.6 886.812,1288.52 889.12,1477.44 891.428,1486.54 893.736,1493.56 896.044,1536.53 898.352,1584.7 900.66,1562.9 902.968,1578.65 905.276,1283.39 907.584,1476.78 909.891,1400.51 912.199,1438.55 914.507,1449.65 916.815,1181 919.123,1397.69 921.431,1586.65 923.739,1311.08 926.047,1391.46 928.355,1409.79 930.663,1598.76 932.971,1403.51 935.278,1435.89 937.586,1384.33 939.894,1454.01 942.202,1419.6 944.51,1531.44 946.818,1466.84 949.126,1385.79 951.434,1405.63 953.742,1426.19 956.05,1420.32 958.358,1462.64 960.665,1504.52 962.973,1530.81 965.281,1437.66 967.589,1450.47 969.897,1624.86 972.205,1393.76 974.513,1691.08 976.821,1479.76 979.129,1356.77 981.437,1468.29 983.745,1457.8 986.053,1633.96 988.36,1329.84 990.668,1544.4 992.976,1581.28 995.284,1426.51 997.592,1383.13 999.9,1609.39 1002.21,1281.39 1004.52,1547.75 1006.82,1541.37 1009.13,1590.05 1011.44,1532.73 1013.75,1473.19 1016.06,1533.03 1018.36,1299.35 1020.67,1413.94 1022.98,1416.35 1025.29,1401.13 1027.59,1476.39 1029.9,1429.18 1032.21,1473.75 1034.52,1483.95 1036.83,1364.61 1039.13,1526.72 1041.44,1390.23 1043.75,1358.86 1046.06,1284.02 1048.37,1421.52 1050.67,1456.84 1052.98,1557.14 1055.29,1461.72 1057.6,1461.52 1059.91,1472.21 1062.21,1288.99 1064.52,1387.37 1066.83,1209.58 1069.14,1390.01 1071.45,1404.18 1073.75,1527.68 1076.06,1599.23 1078.37,1284.08 1080.68,1475.92 1082.98,1442.15 1085.29,1481.11 1087.6,1568.04 1089.91,1575.68 1092.22,1439.9 1094.52,1530.01 1096.83,1357.64 1099.14,1526.44 1101.45,1322.49 1103.76,1480.36 1106.06,1317.73 1108.37,1518.89 1110.68,1515.57 1112.99,1477.24 1115.3,1545.53 1117.6,1572.69 1119.91,1303.54 1122.22,1581.71 1124.53,1461.58 1126.84,1412.36 1129.14,1514.51 1131.45,1376.42 1133.76,1350.57 1136.07,1320.14 1138.37,1372.46 1140.68,1497.14 1142.99,1389.88 1145.3,1326.05 1147.61,1592.21 1149.91,1653.04 1152.22,1356.85 1154.53,1570.31 1156.84,1421.37 1159.15,1162.4 1161.45,1533.91 1163.76,1403.92 1166.07,1483.69 1168.38,1347.29 1170.69,1541.19 1172.99,1402.51 1175.3,1432.28 1177.61,1512.78 1179.92,1331.72 1182.23,1355.11 1184.53,1309.14 1186.84,1390.95 1189.15,1273.36 1191.46,1293.01 1193.76,1379.38 1196.07,1373.48 1198.38,1446.17 1200.69,1490.45 1203,1441.71 1205.3,1452.89 1207.61,1539.73 1209.92,1577.18 1212.23,1520.5 1214.54,1554.81 1216.84,1492.14 1219.15,1385.03 1221.46,1562.63 1223.77,1383.26 1226.08,1470.32 1228.38,1499.8 1230.69,1489.69 1233,1515.29 1235.31,1176.76 1237.61,1392.52 1239.92,1375.52 1242.23,1438.24 1244.54,1359.8 1246.85,1465.6 1249.15,1423.68 1251.46,1365.8 1253.77,1363.48 1256.08,1344.26 1258.39,1356.73 1260.69,1256.92 1263,1441.89 1265.31,1417.2 1267.62,1439.59 1269.93,1385.6 1272.23,1545.29 1274.54,1224.5 1276.85,1454.67 1279.16,1440.49 1281.47,1353.02 1283.77,1399.47 1286.08,1575.43 1288.39,1534.76 1290.7,1376.81 1293,1429.09 1295.31,1360.97 1297.62,1359.89 1299.93,1380.65 1302.24,1498.75 1304.54,1257.67 1306.85,1511.57 1309.16,1370.86 1311.47,1382.66 1313.78,1559.4 1316.08,1481.78 1318.39,1453.21 1320.7,1411 1323.01,1263.86 1325.32,1390.8 1327.62,1391.26 1329.93,1518.96 1332.24,1539.49 1334.55,1430.91 1336.86,1334.01 1339.16,1321.94 1341.47,1632.07 1343.78,1552.89 1346.09,1428.31 1348.39,1517.26 1350.7,1453.44 1353.01,1450 1355.32,1456.32 1357.63,1569.08 1359.93,1339.57 1362.24,1256.35 1364.55,1398.4 1366.86,1503.77 1369.17,1498.22 1371.47,1317.93 1373.78,1232.24 1376.09,1396.93 1378.4,1401.09 1380.71,1471.7 1383.01,1440.74 1385.32,1544.49 1387.63,1523.73 1389.94,1419 1392.24,1400.34 1394.55,1370.11 1396.86,1316.58 1399.17,1301.5 1401.48,1560.05 1403.78,1485.13 1406.09,1698.02 1408.4,1271.16 1410.71,1340.22 1413.02,1366.86 1415.32,1499.25 1417.63,1537.95 1419.94,1459.05 1422.25,1240.91 1424.56,1474.7 1426.86,1384.53 1429.17,1344.21 1431.48,1481.06 1433.79,1514.85 1436.1,1553.23 1438.4,1390.21 1440.71,1409.13 1443.02,1558.17 1445.33,1343.34 1447.63,1444.79 1449.94,1452.27 1452.25,1309.83 1454.56,1578.82 1456.87,1421.21 1459.17,1527.26 1461.48,1518.15 1463.79,1420.79 1466.1,1469.22 1468.41,1408.28 1470.71,1485.35 1473.02,1602.18 1475.33,1338.14 1477.64,1543.95 1479.95,1509.57 1482.25,1409.43 1484.56,1535.85 1486.87,1395.22 1489.18,1450.41 1491.49,1390.65 1493.79,1197.2 1496.1,1332.38 1498.41,1442.96 1500.72,1450.6 1503.02,1538.57 1505.33,1376.86 1507.64,1497.39 1509.95,1527.79 1512.26,1395.34 1514.56,1363.09 1516.87,1356.07 1519.18,1476.75 1521.49,1460.01 1523.8,1224.35 1526.1,1560.58 1528.41,1564.73 1530.72,1398.7 1533.03,1370.46 1535.34,1449.24 1537.64,1329.58 1539.95,1540.01 1542.26,1365.73 1544.57,1522.98 1546.88,1294.22 1549.18,1469.15 1551.49,1250.23 1553.8,1438.09 1556.11,1644.02 1558.41,1409.04 1560.72,1672.02 1563.03,1287.53 1565.34,1452.52 1567.65,1364.97 1569.95,1452.11 1572.26,1439.03 1574.57,1523.8 1576.88,1352.54 1579.19,1337.89 1581.49,1362.75 1583.8,1511.86 1586.11,1159.42 1588.42,1290.46 1590.73,1439.12 1593.03,1547.88 1595.34,1358.54 1597.65,1417.86 1599.96,1554.36 1602.26,1277.92 1604.57,1479.74 1606.88,1352.6 1609.19,1473.93 1611.5,1325.8 1613.8,1453.97 1616.11,1628.65 1618.42,1405.19 1620.73,1460.76 1623.04,1406.37 1625.34,1529.4 1627.65,1415.63 1629.96,1571.81 1632.27,1520.98 1634.58,1470.96 1636.88,1522.5 1639.19,1428.45 1641.5,1530.52 1643.81,1473.57 1646.12,1316.59 1648.42,1441.25 1650.73,1534.25 1653.04,1440.46 1655.35,1531.47 1657.65,1354.57 1659.96,1474.1 1662.27,1312.56 1664.58,1602.15 1666.89,1559.36 1669.19,1481.67 1671.5,1406.97 1673.81,1605.64 1676.12,1152.11 1678.43,1317.19 1680.73,1388.41 1683.04,1342.71 1685.35,1351.29 1687.66,1600.2 1689.97,1446.4 1692.27,1387.5 1694.58,1431.8 1696.89,1421.52 1699.2,1407.68 1701.51,1536.13 1703.81,1473.48 1706.12,1391.22 1708.43,1549.48 1710.74,1415.9 1713.04,1489.52 1715.35,1452.73 1717.66,1426.25 1719.97,1326.08 1722.28,1185.67 1724.58,1542.67 1726.89,1521.79 1729.2,1451.81 1731.51,1351.68 1733.82,1545.49 1736.12,1397.1 1738.43,1510.39 1740.74,1388.37 1743.05,1367.99 1745.36,1422.49 1747.66,1399.72 1749.97,1390.5 1752.28,1402.42 1754.59,1447.57 1756.9,1384.18 1759.2,1315.56 1761.51,1490.76 1763.82,1606.27 1766.13,1503.45 1768.43,1461.66 1770.74,1505.57 1773.05,1494.96 1775.36,1430.7 1777.67,1253.7 1779.97,1357.31 1782.28,1603.02 1784.59,1375.38 1786.9,1358.44 1789.21,1638.26 1791.51,1347.32 1793.82,1421.38 1796.13,1348.5 1798.44,1463.69 1800.75,1400.04 1803.05,1444.94 1805.36,1511.45 1807.67,1426.67 1809.98,1481.91 1812.28,1398.02 1814.59,1465.12 1816.9,1167.94 1819.21,1472.2 1821.52,1503.78 1823.82,1382.71 1826.13,1468.48 1828.44,1356.5 1830.75,1363.46 1833.06,1486.32 1835.36,1285.69 1837.67,1360.44 1839.98,1334.88 1842.29,1322.08 1844.6,1406.17 1846.9,1370.45 1849.21,1384.93 1851.52,1475.78 1853.83,1308.65 1856.14,1412.17 1858.44,1524.21 1860.75,1402.87 1863.06,1361.66 1865.37,1466.34 1867.67,1451.64 1869.98,1408.99 1872.29,1584.6 1874.6,1524.21 1876.91,1540.02 1879.21,1559.82 1881.52,1545.7 1883.83,1374.81 1886.14,1448.9 1888.45,1455.73 1890.75,1400.28 1893.06,1522.06 1895.37,1494.39 1897.68,1378.78 1899.99,1396.19 1902.29,1412.21 1904.6,1325 1906.91,1588.8 1909.22,1519.91 1911.53,1508.88 1913.83,1464.9 1916.14,1304.23 1918.45,1328.69 1920.76,1379.43 1923.06,1255.98 1925.37,1463.48 1927.68,1369.25 1929.99,1409.06 1932.3,1467.59 1934.6,1530.28 1936.91,1270.67 1939.22,1332.83 1941.53,1295.48 1943.84,1546 1946.14,1602.87 1948.45,1362.48 1950.76,1576.42 1953.07,1410.06 1955.38,1308.37 1957.68,1334.79 1959.99,1365.08 1962.3,1358.27 1964.61,1511.41 1966.91,1418.81 1969.22,1536.27 1971.53,1545.85 1973.84,1421.14 1976.15,1374.57 1978.45,1545.11 1980.76,1425.57 1983.07,1466.05 1985.38,1507.92 1987.69,1461.94 1989.99,1538.3 1992.3,1394.94 1994.61,1439.89 1996.92,1378.94 1999.23,1353.14 2001.53,1476.97 2003.84,1420.65 2006.15,1630.59 2008.46,1281.16 2010.77,1305.08 2013.07,1642.81 2015.38,1341.05 2017.69,1393.23 2020,1423.42 2022.3,1469.15 2024.61,1572.19 2026.92,1321.12 2029.23,1305.3 2031.54,1315.95 2033.84,1647.47 2036.15,1317.64 2038.46,1264.72 2040.77,1494.15 2043.08,1525.62 2045.38,1452.82 2047.69,1520.23 2050,1446.15 2052.31,1498.4 2054.62,1492.55 2056.92,1502.37 2059.23,1327.26 2061.54,1233.83 2063.85,1289.78 2066.16,1425.5 2068.46,1377.09 2070.77,1419.76 2073.08,1457.75 2075.39,1436.57 2077.69,1261 2080,1412.41 2082.31,1314.18 2084.62,1351.81 2086.93,1273.55 2089.23,1499.54 2091.54,1420.92 2093.85,1444.99 2096.16,1414.61 2098.47,1227.58 2100.77,1376.91 2103.08,1450.68 2105.39,1625.21 2107.7,1568.08 2110.01,1562.51 2112.31,1308.43 2114.62,1348.15 2116.93,1366.74 2119.24,1434.98 2121.55,1471.58 2123.85,1361.52 2126.16,1558.33 2128.47,1336.03 2130.78,1276.58 2133.08,1299.31 2135.39,1452.37 2137.7,1583.08 2140.01,1428.09 2142.32,1412.36 2144.62,1465.73 2146.93,1515.95 2149.24,1395.47 2151.55,1397.13 2153.86,1307.19 2156.16,1319.89 2158.47,1470.52 2160.78,1402.34 2163.09,1335.05 2165.4,1420.06 2167.7,1550.88 2170.01,1264.25 2172.32,1443.32 2174.63,1485.66 2176.93,1289.9 2179.24,1551.26 2181.55,1495.5 2183.86,1537.09 2186.17,1440.3 2188.47,1237.39 2190.78,1500.29 2193.09,1465.1 2195.4,1466.43 2197.71,1476.55 2200.01,1331.23 2202.32,1475.46 2204.63,1399.74 2206.94,1426.2 2209.25,1298.76 2211.55,1469.96 2213.86,1325.52 2216.17,1582.4 2218.48,1443.67 2220.79,1587.33 2223.09,1417.11 2225.4,1523.48 2227.71,1553.78 2230.02,1403.01 2232.32,1551 2234.63,1291.45 2236.94,1526.72 2239.25,1374.21 2241.56,1529.48 2243.86,1399.92 2246.17,1531.29 2248.48,1510.58 2250.79,1528.28 2253.1,1370.93 2255.4,1367.94 2257.71,1487.13 2260.02,1316.22 2262.33,1627.98 2264.64,1538 2266.94,1403.01 2269.25,1544.74 2271.56,1484.37 2273.87,1221.94 2276.18,1485.05 2278.48,1365.29 2280.79,1581.09 2283.1,1353.13 2285.41,1505.99 2287.71,1418.35 2290.02,1490.37 2292.33,1371.19 2294.64,1419.05 2296.95,1545.94 2299.25,1477.5 2301.56,1469.01 2303.87,1450.36 2306.18,1518.43 2308.49,1315.19 2310.79,1623.1 2313.1,1460.9 2315.41,1342.08 2317.72,1489.81 2320.03,1414.22 2322.33,1442.68 2324.64,1486.36 2326.95,1325.87 2329.26,1533.57 2331.56,1422.03 2333.87,1543.95 2336.18,1674.78 2338.49,1522.65 2340.8,1508.21 2343.1,1323.73 2345.41,1431.65 2347.72,1442.25 2350.03,1451.53 2352.34,1269.41 2354.64,1366.45 2356.95,1396.17 2359.26,1411.65 2361.57,1629.15 2363.88,1601.58 2366.18,1510.72 2368.49,1532.11 2370.8,1430.27 2373.11,1516.61 2375.42,1459.92 2377.72,1468.44 2380.03,1418.74 2382.34,1456.19 2384.65,1453.05 2386.95,1544.53 2389.26,1583.63 2391.57,1353.84 2393.88,1541.68 2396.19,1243.56 2398.49,1595.21 2400.8,1262.03 2403.11,1562.16 2405.42,1298.05 2407.73,1471.39 2410.03,1469.67 2412.34,1497.25 2414.65,1387.56 2416.96,1607.81 2419.27,1299.1 2421.57,1618.55 2423.88,1575.86 2426.19,1532.44 2428.5,1398.23 2430.81,1519.27 2433.11,1435.32 2435.42,1519.87 2437.73,1437.71 2440.04,1203.9 2442.34,1423.23 2444.65,1154.84 2446.96,1451.33 2449.27,1433.32 2451.58,1462.94 2453.88,1526.96 2456.19,1336.82 2458.5,1420.16 2460.81,1349.43 2463.12,1350.74 2465.42,1387.44 2467.73,1408.74 2470.04,1454.02 2472.35,1504.46 2474.66,1534.42 2476.96,1352.8 2479.27,1429.32 2481.58,1483.22 2483.89,1404.59 2486.2,1335.58 2488.5,1491.52 2490.81,1402.66 2493.12,1218.99 2495.43,1258.94 2497.73,1364.93 2500.04,1302.92 2502.35,1514 2504.66,1539.19 2506.97,1315.01 2509.27,1387.13 2511.58,1402.72 2513.89,1391.75 2516.2,1354.44 2518.51,1578.06 2520.81,1543.79 2523.12,1363.42 2525.43,1334.76 2527.74,1487.35 2530.05,1381.83 2532.35,1465.16 2534.66,1380.6 2536.97,1495.57 2539.28,1383 2541.58,1449.42 2543.89,1396.95 2546.2,1321.16 2548.51,1609.38 2550.82,1302.7 2553.12,1432.17 2555.43,1469.74 2557.74,1578.36 2560.05,1523.26 2562.36,1385.81 2564.66,1373.51 2566.97,1394.91 2569.28,1751.15 2571.59,1260.79 "></polyline>
<polyline clip-path="url(#clip692)" style="stroke:#e26f46; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="265.984,928.757 268.292,981.947 270.6,1003.41 272.908,992.412 275.216,1195.13 277.524,959.018 279.832,1041.88 282.139,1146.24 284.447,962.308 286.755,855.666 289.063,1133.82 291.371,1010.08 293.679,935.91 295.987,966.917 298.295,1009.09 300.603,992.283 302.911,1120.11 305.219,777.696 307.527,777.878 309.834,841.02 312.142,843.226 314.45,832.361 316.758,938.677 319.066,950.356 321.374,1022.68 323.682,987.537 325.99,973.156 328.298,1051.02 330.606,985.569 332.914,1068.72 335.221,882.324 337.529,1180.31 339.837,907.015 342.145,1001.13 344.453,834.995 346.761,1084.74 349.069,952.911 351.377,965.344 353.685,970.644 355.993,747.977 358.301,848.918 360.608,963.718 362.916,1014 365.224,788.063 367.532,931.163 369.84,997.79 372.148,935.179 374.456,976.265 376.764,906.519 379.072,1066.39 381.38,851.192 383.688,914.238 385.996,989.47 388.303,946.382 390.611,921.765 392.919,1062.55 395.227,848.331 397.535,1003.63 399.843,1062.45 402.151,1136 404.459,1036.74 406.767,1078.55 409.075,890.109 411.383,999.656 413.69,899.791 415.998,920.285 418.306,801.737 420.614,870.005 422.922,1099.07 425.23,1022.18 427.538,1060.6 429.846,954.754 432.154,1158.14 434.462,1082.68 436.77,938.985 439.077,914.905 441.385,1080.48 443.693,942.221 446.001,995 448.309,945.759 450.617,906.698 452.925,927.149 455.233,964.375 457.541,962.896 459.849,831.042 462.157,955.198 464.465,886.415 466.772,940.921 469.08,1038.29 471.388,1006.45 473.696,1025.69 476.004,1017.04 478.312,1216.38 480.62,1146.55 482.928,934.147 485.236,1123.91 487.544,1002.67 489.852,949.935 492.159,912.835 494.467,1009.41 496.775,956.595 499.083,895.693 501.391,907.371 503.699,951.477 506.007,799.595 508.315,971.609 510.623,1037.26 512.931,1024.1 515.239,836.008 517.546,1008.49 519.854,848.918 522.162,1049.29 524.47,873.927 526.778,1026.93 529.086,869.276 531.394,1001.16 533.702,812.748 536.01,1038.99 538.318,1040.77 540.626,995.249 542.933,913.57 545.241,922.598 547.549,1048.86 549.857,702.107 552.165,931.15 554.473,952.918 556.781,850.256 559.089,904.563 561.397,933.772 563.705,837.522 566.013,923.142 568.321,941.415 570.628,1170.26 572.936,802.371 575.244,873.86 577.552,875.486 579.86,1009.16 582.168,1082.18 584.476,852.43 586.784,853.249 589.092,899.388 591.4,882.837 593.708,1014.91 596.015,763.011 598.323,824.565 600.631,1023.3 602.939,859.394 605.247,826.711 607.555,1103.98 609.863,1046.92 612.171,1096.58 614.479,959.743 616.787,960.352 619.095,977.353 621.402,938.14 623.71,1018.49 626.018,1074.02 628.326,925.842 630.634,924.481 632.942,924.126 635.25,949.952 637.558,1121.49 639.866,1018.18 642.174,1109 644.482,1035.3 646.79,975.352 649.097,986.105 651.405,809.137 653.713,1039.85 656.021,885.969 658.329,983.196 660.637,913.198 662.945,910.662 665.253,1027.73 667.561,1154.56 669.869,996.048 672.177,972.515 674.484,881.658 676.792,836.953 679.1,738.146 681.408,813.04 683.716,939.028 686.024,1009.67 688.332,816.533 690.64,1011.57 692.948,805.6 695.256,1159 697.564,941.338 699.871,952.183 702.179,1050.79 704.487,1076.32 706.795,1064.35 709.103,1000.46 711.411,1013.76 713.719,890.914 716.027,1120.34 718.335,836.518 720.643,940.575 722.951,915.405 725.259,1025.37 727.566,948.553 729.874,821.837 732.182,872.909 734.49,939.098 736.798,953.407 739.106,896.194 741.414,827.015 743.722,876.105 746.03,1059.9 748.338,530.655 750.646,991.543 752.953,990.949 755.261,938.224 757.569,920.235 759.877,880.866 762.185,941.84 764.493,1025.79 766.801,932.057 769.109,986.184 771.417,1082.57 773.725,846.818 776.033,943.314 778.34,921.631 780.648,1033.37 782.956,832.82 785.264,859.943 787.572,736.047 789.88,1012.81 792.188,999.823 794.496,998.126 796.804,979.78 799.112,879.898 801.42,1011.18 803.728,1039.9 806.035,1057.3 808.343,895.971 810.651,1034.12 812.959,1128.2 815.267,1098.15 817.575,872.428 819.883,1066.7 822.191,1066.11 824.499,874.081 826.807,896.833 829.115,724.13 831.422,927.425 833.73,960.787 836.038,999.875 838.346,986.916 840.654,1098.04 842.962,925.281 845.27,1082.15 847.578,793.523 849.886,786.849 852.194,853.228 854.502,1073.06 856.809,1007.55 859.117,793.172 861.425,1077.32 863.733,1012.67 866.041,1011.09 868.349,939.499 870.657,791.226 872.965,916.047 875.273,1091.32 877.581,1004.32 879.889,934.727 882.197,904.502 884.504,932.553 886.812,831.659 889.12,991.384 891.428,966.415 893.736,1061.09 896.044,1051.26 898.352,977.97 900.66,994.346 902.968,786.15 905.276,945.876 907.584,826.86 909.891,871.737 912.199,958.474 914.507,830.888 916.815,1051.34 919.123,745.334 921.431,813.937 923.739,715.925 926.047,897.419 928.355,1028.01 930.663,1078.8 932.971,1084.75 935.278,958.753 937.586,936.414 939.894,1001.93 942.202,1001.9 944.51,862.73 946.818,953.255 949.126,869.964 951.434,854.277 953.742,867.43 956.05,1099.02 958.358,1012.54 960.665,970.584 962.973,990.421 965.281,984.772 967.589,973.043 969.897,991.869 972.205,1058.92 974.513,959.539 976.821,949.75 979.129,934.503 981.437,887.271 983.745,903.675 986.053,1085.06 988.36,904.43 990.668,1014.28 992.976,982.09 995.284,864.769 997.592,949.982 999.9,897.197 1002.21,927.393 1004.52,1216.17 1006.82,1039.66 1009.13,778.447 1011.44,928.261 1013.75,993.91 1016.06,1070.65 1018.36,797.986 1020.67,964.631 1022.98,972.475 1025.29,1041.62 1027.59,961.991 1029.9,848.819 1032.21,862.302 1034.52,887.414 1036.83,1075.67 1039.13,717.538 1041.44,814.832 1043.75,871.938 1046.06,843.484 1048.37,985.736 1050.67,987.207 1052.98,807.139 1055.29,948.149 1057.6,1112.53 1059.91,1153.25 1062.21,908.79 1064.52,961.176 1066.83,1087.14 1069.14,900.254 1071.45,788.699 1073.75,944.12 1076.06,1065.09 1078.37,852.931 1080.68,939.372 1082.98,847.734 1085.29,1008.98 1087.6,927.178 1089.91,898.14 1092.22,1093.23 1094.52,1028.96 1096.83,927.021 1099.14,996.608 1101.45,875.544 1103.76,864.767 1106.06,974.201 1108.37,993.693 1110.68,941.613 1112.99,836.535 1115.3,1005.24 1117.6,1121.65 1119.91,1091.39 1122.22,1083.34 1124.53,951.42 1126.84,855.853 1129.14,1047.84 1131.45,1108.53 1133.76,901.901 1136.07,951.885 1138.37,920.865 1140.68,963.086 1142.99,876.819 1145.3,900.609 1147.61,877.817 1149.91,1010.63 1152.22,1108.44 1154.53,992.189 1156.84,1043.05 1159.15,1004.77 1161.45,1047.91 1163.76,978.118 1166.07,1077.03 1168.38,1074.06 1170.69,890.453 1172.99,1049.74 1175.3,911.389 1177.61,898.325 1179.92,991.296 1182.23,1099.65 1184.53,1031.52 1186.84,1020.83 1189.15,929.194 1191.46,1017.11 1193.76,1010.66 1196.07,971.054 1198.38,878.136 1200.69,968.613 1203,1056.56 1205.3,981.687 1207.61,893.219 1209.92,946.436 1212.23,740.295 1214.54,931.515 1216.84,926.875 1219.15,935.856 1221.46,1055.71 1223.77,911.178 1226.08,1028.6 1228.38,817.78 1230.69,1065.33 1233,949.45 1235.31,965.726 1237.61,1017.43 1239.92,1061 1242.23,992.601 1244.54,934.739 1246.85,1075.23 1249.15,937.757 1251.46,877.572 1253.77,1046.06 1256.08,823.298 1258.39,856.773 1260.69,861.69 1263,1050.72 1265.31,925.959 1267.62,1118.63 1269.93,1139.35 1272.23,986.054 1274.54,965.836 1276.85,1033.51 1279.16,1109.56 1281.47,842.479 1283.77,755.174 1286.08,904.29 1288.39,903.466 1290.7,1018.88 1293,1025.8 1295.31,783.497 1297.62,798.861 1299.93,961.957 1302.24,1012.19 1304.54,1095.56 1306.85,838.391 1309.16,923.359 1311.47,931.16 1313.78,901.281 1316.08,1032.59 1318.39,1010.26 1320.7,950.218 1323.01,1033.47 1325.32,904.459 1327.62,978.55 1329.93,1012.15 1332.24,798.728 1334.55,871.749 1336.86,842.023 1339.16,1012.26 1341.47,1215.21 1343.78,1126.42 1346.09,984.149 1348.39,673.274 1350.7,1124.04 1353.01,882.939 1355.32,756.086 1357.63,1033.94 1359.93,826.067 1362.24,956.831 1364.55,986.768 1366.86,872.981 1369.17,982.169 1371.47,982.154 1373.78,847.28 1376.09,866.33 1378.4,934.892 1380.71,955.028 1383.01,984.908 1385.32,915.379 1387.63,1110.85 1389.94,1064.17 1392.24,975.921 1394.55,1061.69 1396.86,958.576 1399.17,894.248 1401.48,783.164 1403.78,1079.18 1406.09,884.233 1408.4,1135.65 1410.71,978.843 1413.02,951.509 1415.32,905.154 1417.63,1061.95 1419.94,928.018 1422.25,954.414 1424.56,1109.78 1426.86,977.87 1429.17,987.171 1431.48,984.343 1433.79,929.595 1436.1,702.347 1438.4,862.924 1440.71,990.42 1443.02,1127.72 1445.33,801.631 1447.63,1106.61 1449.94,867.514 1452.25,815.892 1454.56,1003.05 1456.87,1057.97 1459.17,911.515 1461.48,972.541 1463.79,912.019 1466.1,1002.15 1468.41,943.505 1470.71,956.433 1473.02,1021.39 1475.33,830.755 1477.64,998.897 1479.95,904.09 1482.25,1120.47 1484.56,817.113 1486.87,926.889 1489.18,945.651 1491.49,769.984 1493.79,902.047 1496.1,906.36 1498.41,1155.84 1500.72,788.387 1503.02,838.305 1505.33,1069.99 1507.64,750.533 1509.95,845.033 1512.26,1026.54 1514.56,714.567 1516.87,936.5 1519.18,1060.17 1521.49,980.312 1523.8,742.601 1526.1,856.234 1528.41,924.253 1530.72,837.23 1533.03,980.252 1535.34,846.683 1537.64,974.746 1539.95,1051.96 1542.26,870.176 1544.57,951.883 1546.88,925.372 1549.18,790.013 1551.49,992.774 1553.8,941.849 1556.11,999.472 1558.41,913.739 1560.72,917.054 1563.03,952.788 1565.34,940.335 1567.65,858.453 1569.95,1044.51 1572.26,825.352 1574.57,1048.18 1576.88,962.271 1579.19,884.067 1581.49,1056.42 1583.8,983.737 1586.11,832.608 1588.42,1035.82 1590.73,811.901 1593.03,974.587 1595.34,850.891 1597.65,1033.55 1599.96,934.722 1602.26,883.479 1604.57,976.399 1606.88,958.701 1609.19,1016.18 1611.5,967.155 1613.8,720.534 1616.11,962.093 1618.42,686.06 1620.73,911.697 1623.04,874.237 1625.34,1077.05 1627.65,924.588 1629.96,969.91 1632.27,1016.54 1634.58,997.948 1636.88,842.517 1639.19,1077.74 1641.5,1005.45 1643.81,899.314 1646.12,1057.75 1648.42,969.603 1650.73,1030.32 1653.04,1058.99 1655.35,1013.2 1657.65,898.496 1659.96,1010.09 1662.27,900.054 1664.58,957.093 1666.89,1179 1669.19,1013.33 1671.5,973.845 1673.81,1105.78 1676.12,1032.56 1678.43,907.167 1680.73,985.527 1683.04,721.153 1685.35,987.386 1687.66,905.071 1689.97,954.331 1692.27,782.003 1694.58,1166.06 1696.89,1011.93 1699.2,856.523 1701.51,934.978 1703.81,1060.38 1706.12,1030.49 1708.43,789.501 1710.74,1225.2 1713.04,995.795 1715.35,829.297 1717.66,894.899 1719.97,951.423 1722.28,1099.74 1724.58,1006.39 1726.89,951.541 1729.2,939.202 1731.51,1025.36 1733.82,1073.33 1736.12,933.612 1738.43,1060.57 1740.74,778.235 1743.05,982.128 1745.36,866.081 1747.66,1062.56 1749.97,1065.03 1752.28,1082.48 1754.59,952.108 1756.9,1060.88 1759.2,998.264 1761.51,846.69 1763.82,932.264 1766.13,1101.12 1768.43,937.828 1770.74,982.524 1773.05,986.614 1775.36,1044.05 1777.67,813.939 1779.97,1000.18 1782.28,971.966 1784.59,883.123 1786.9,999.688 1789.21,955.127 1791.51,887.941 1793.82,825.41 1796.13,856.522 1798.44,907.533 1800.75,949.133 1803.05,928.561 1805.36,994.597 1807.67,1154.16 1809.98,972.306 1812.28,915.205 1814.59,1062.16 1816.9,881.737 1819.21,935.148 1821.52,941.664 1823.82,846.754 1826.13,719.094 1828.44,996.923 1830.75,812.432 1833.06,790.435 1835.36,991.329 1837.67,980.994 1839.98,1238.94 1842.29,927.543 1844.6,990.294 1846.9,851.322 1849.21,916.495 1851.52,839.038 1853.83,878.945 1856.14,1055.9 1858.44,894.272 1860.75,924.096 1863.06,998.07 1865.37,1055.92 1867.67,1067.77 1869.98,1004.81 1872.29,879.647 1874.6,935.37 1876.91,753.122 1879.21,1090.89 1881.52,975.312 1883.83,840.108 1886.14,909.942 1888.45,921.527 1890.75,1164.41 1893.06,1146.94 1895.37,893.379 1897.68,946.684 1899.99,860.024 1902.29,829.819 1904.6,1000.14 1906.91,850.665 1909.22,819.947 1911.53,915.329 1913.83,910.597 1916.14,926.95 1918.45,922.735 1920.76,761.079 1923.06,891.447 1925.37,847.443 1927.68,936.035 1929.99,896.953 1932.3,933.448 1934.6,1033.76 1936.91,1123.73 1939.22,1020.16 1941.53,961.979 1943.84,1008.56 1946.14,946.927 1948.45,809.439 1950.76,1089.04 1953.07,1018.82 1955.38,951.35 1957.68,921.549 1959.99,900.414 1962.3,802.047 1964.61,936.805 1966.91,966.122 1969.22,911.977 1971.53,867.277 1973.84,906.441 1976.15,835.652 1978.45,832.311 1980.76,898.42 1983.07,1077.72 1985.38,930.949 1987.69,1022.15 1989.99,1013.8 1992.3,1055.04 1994.61,913.579 1996.92,856.022 1999.23,1051.31 2001.53,924.926 2003.84,930.102 2006.15,1087.97 2008.46,805.707 2010.77,879.332 2013.07,1014.21 2015.38,915.29 2017.69,924.688 2020,964.317 2022.3,812.755 2024.61,1091.29 2026.92,1036.06 2029.23,1149.27 2031.54,937.28 2033.84,846.55 2036.15,945.325 2038.46,981.176 2040.77,971.973 2043.08,941.166 2045.38,991.853 2047.69,1012.81 2050,1003.75 2052.31,985.145 2054.62,808.204 2056.92,840.738 2059.23,921.671 2061.54,1071.17 2063.85,1008.08 2066.16,921.52 2068.46,908.306 2070.77,948.833 2073.08,838.569 2075.39,1018.33 2077.69,969.958 2080,1003.69 2082.31,869.02 2084.62,1043.44 2086.93,899.093 2089.23,815.263 2091.54,1043.99 2093.85,801.968 2096.16,859.956 2098.47,937.588 2100.77,869.934 2103.08,930.579 2105.39,838.159 2107.7,1261.41 2110.01,1000.5 2112.31,1050.28 2114.62,929.311 2116.93,900.175 2119.24,802.913 2121.55,999.967 2123.85,929.582 2126.16,1005.44 2128.47,906.381 2130.78,887.959 2133.08,762.342 2135.39,888.224 2137.7,864.193 2140.01,999.396 2142.32,948.147 2144.62,941.445 2146.93,754.965 2149.24,1032.67 2151.55,902.599 2153.86,1031.05 2156.16,1106.74 2158.47,879.329 2160.78,877.689 2163.09,976.75 2165.4,931.972 2167.7,1035.17 2170.01,1013.39 2172.32,824.589 2174.63,1008.56 2176.93,1020.37 2179.24,939.725 2181.55,1040.69 2183.86,975.997 2186.17,967.484 2188.47,825.552 2190.78,1189.76 2193.09,1016.97 2195.4,967.585 2197.71,951.581 2200.01,1025.51 2202.32,811.543 2204.63,960.215 2206.94,987.498 2209.25,1006.35 2211.55,958.036 2213.86,959.553 2216.17,958.23 2218.48,911.263 2220.79,948.525 2223.09,742.33 2225.4,956.192 2227.71,770.561 2230.02,1009.91 2232.32,987.699 2234.63,998.995 2236.94,1003.01 2239.25,871.591 2241.56,865.349 2243.86,1097.65 2246.17,803.819 2248.48,880.255 2250.79,1021.12 2253.1,998.912 2255.4,997.621 2257.71,920.455 2260.02,928.71 2262.33,879.949 2264.64,886.044 2266.94,1099.61 2269.25,962.905 2271.56,1025.05 2273.87,1067.95 2276.18,754.708 2278.48,1006.24 2280.79,927.767 2283.1,992.264 2285.41,1017.06 2287.71,847.131 2290.02,864.196 2292.33,994.647 2294.64,812.317 2296.95,938.675 2299.25,766.103 2301.56,1034.18 2303.87,918.517 2306.18,1021.57 2308.49,969.683 2310.79,998.772 2313.1,1117.18 2315.41,901.461 2317.72,994.688 2320.03,910.909 2322.33,835.214 2324.64,860.639 2326.95,860.147 2329.26,976.608 2331.56,974.221 2333.87,925.921 2336.18,878.827 2338.49,977.579 2340.8,883.321 2343.1,916.687 2345.41,1008.22 2347.72,862.55 2350.03,912.55 2352.34,970.074 2354.64,902.387 2356.95,1050.08 2359.26,861.814 2361.57,980.213 2363.88,789.354 2366.18,830.336 2368.49,978.369 2370.8,894.186 2373.11,901.104 2375.42,767.116 2377.72,988.45 2380.03,1087.8 2382.34,1116.28 2384.65,852.932 2386.95,1148.85 2389.26,1025.36 2391.57,1035.69 2393.88,923.429 2396.19,1088.35 2398.49,991.446 2400.8,931.883 2403.11,786.299 2405.42,917.24 2407.73,1032.63 2410.03,963.601 2412.34,1041.02 2414.65,861.262 2416.96,1084.99 2419.27,866.992 2421.57,955.376 2423.88,960.562 2426.19,867.954 2428.5,782.309 2430.81,892.166 2433.11,894.41 2435.42,954.38 2437.73,964.053 2440.04,880.762 2442.34,1005.33 2444.65,782.861 2446.96,853.729 2449.27,954.408 2451.58,951.391 2453.88,1016.51 2456.19,977.279 2458.5,995.062 2460.81,1137.74 2463.12,1081.49 2465.42,996.534 2467.73,1003.78 2470.04,988.997 2472.35,879.124 2474.66,962.719 2476.96,955.768 2479.27,933.657 2481.58,1000.54 2483.89,920.185 2486.2,840.399 2488.5,819.851 2490.81,1059.46 2493.12,983.626 2495.43,914.25 2497.73,1102.14 2500.04,906.113 2502.35,969.069 2504.66,1066.95 2506.97,920.167 2509.27,1046.11 2511.58,877.837 2513.89,1086.06 2516.2,746.549 2518.51,992.173 2520.81,859.411 2523.12,896.64 2525.43,1152.01 2527.74,869.885 2530.05,982.03 2532.35,939.291 2534.66,956.264 2536.97,974.98 2539.28,1018.29 2541.58,1062.54 2543.89,943.89 2546.2,892.696 2548.51,781.997 2550.82,1053.39 2553.12,891.725 2555.43,984.056 2557.74,922.103 2560.05,893.585 2562.36,1038.1 2564.66,795.886 2566.97,1123.35 2569.28,918.808 2571.59,1065.44 "></polyline>
<polyline clip-path="url(#clip692)" style="stroke:#3da44d; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="265.984,777.898 268.292,475.846 270.6,476.45 272.908,403.607 275.216,480.68 277.524,320.076 279.832,322.012 282.139,529.825 284.447,321.864 286.755,337.428 289.063,210.307 291.371,410.552 293.679,454.41 295.987,320.029 298.295,374.673 300.603,572.352 302.911,490.895 305.219,322.057 307.527,381.887 309.834,484.056 312.142,474.828 314.45,578.178 316.758,360.792 319.066,338.821 321.374,463.83 323.682,243.881 325.99,410.75 328.298,448.767 330.606,516.353 332.914,507.308 335.221,540.92 337.529,322.402 339.837,542.195 342.145,472.922 344.453,494.149 346.761,481.149 349.069,435.045 351.377,632.218 353.685,360.654 355.993,478.334 358.301,484.063 360.608,502.833 362.916,379.498 365.224,356.676 367.532,415.099 369.84,529.018 372.148,529.007 374.456,482.393 376.764,506.435 379.072,457.626 381.38,538.24 383.688,402.399 385.996,426.057 388.303,542.239 390.611,435.693 392.919,536.855 395.227,456.65 397.535,462.298 399.843,639.734 402.151,425.637 404.459,684.198 406.767,414.255 409.075,463.478 411.383,464.153 413.69,398.146 415.998,493.121 418.306,363.528 420.614,539.678 422.922,589.189 425.23,460.365 427.538,466.093 429.846,359.645 432.154,508.616 434.462,469.074 436.77,491.343 439.077,487.315 441.385,416.426 443.693,532.306 446.001,315.488 448.309,377.877 450.617,443.497 452.925,466.055 455.233,506.035 457.541,417.596 459.849,485.887 462.157,543.158 464.465,336.998 466.772,415.252 469.08,390.419 471.388,475.932 473.696,323.017 476.004,414.705 478.312,473.198 480.62,374.061 482.928,598.11 485.236,367.824 487.544,513.408 489.852,442.321 492.159,336.543 494.467,331.624 496.775,303.224 499.083,506.652 501.391,456.394 503.699,445.64 506.007,478.002 508.315,526.094 510.623,419.346 512.931,519.083 515.239,311.205 517.546,510.716 519.854,398.162 522.162,387.753 524.47,638.83 526.778,423.245 529.086,429.715 531.394,691.67 533.702,637.802 536.01,654.625 538.318,523.911 540.626,510.843 542.933,497.143 545.241,381.008 547.549,628.335 549.857,371.957 552.165,485.863 554.473,603.348 556.781,515.039 559.089,604.104 561.397,429.485 563.705,520.837 566.013,412.248 568.321,541.187 570.628,439.343 572.936,572.03 575.244,530.277 577.552,408.088 579.86,765.026 582.168,385.803 584.476,342.635 586.784,545.436 589.092,595.41 591.4,532.895 593.708,335.695 596.015,631.532 598.323,441.615 600.631,460.941 602.939,497.074 605.247,455.983 607.555,360.441 609.863,503.755 612.171,359.053 614.479,635.547 616.787,370.518 619.095,631.332 621.402,402.375 623.71,637.466 626.018,445.885 628.326,524.413 630.634,504.817 632.942,457.714 635.25,421.736 637.558,497.38 639.866,295.207 642.174,485.692 644.482,555.219 646.79,377.737 649.097,407.205 651.405,387.707 653.713,440.304 656.021,385.499 658.329,289.026 660.637,567.485 662.945,408.075 665.253,476.3 667.561,536.952 669.869,496.208 672.177,455.033 674.484,602.626 676.792,598.718 679.1,377.421 681.408,410.169 683.716,571.108 686.024,517.031 688.332,558.251 690.64,480.616 692.948,285.097 695.256,428.833 697.564,251.722 699.871,467.691 702.179,508.88 704.487,508.688 706.795,573.78 709.103,412.424 711.411,462.251 713.719,507.132 716.027,505.327 718.335,466.973 720.643,636.722 722.951,404.097 725.259,572.471 727.566,559.944 729.874,551.795 732.182,526.62 734.49,449.714 736.798,537.23 739.106,373.909 741.414,634.886 743.722,532.939 746.03,559.81 748.338,561.939 750.646,483.281 752.953,486.648 755.261,410.638 757.569,638.989 759.877,280.844 762.185,479.467 764.493,336.435 766.801,455.359 769.109,305.64 771.417,412.211 773.725,349.271 776.033,582.314 778.34,425.973 780.648,412.18 782.956,404.253 785.264,452.267 787.572,486.366 789.88,549.787 792.188,345.457 794.496,518.68 796.804,391.23 799.112,404.745 801.42,511.505 803.728,369.481 806.035,410.317 808.343,531.538 810.651,544.554 812.959,425.503 815.267,383.649 817.575,580.688 819.883,557.141 822.191,472.188 824.499,373.852 826.807,314.073 829.115,446.774 831.422,522.609 833.73,372.376 836.038,355.377 838.346,527.294 840.654,343.386 842.962,314 845.27,454.556 847.578,396.663 849.886,643.916 852.194,402.849 854.502,542.769 856.809,305.595 859.117,647.056 861.425,274.954 863.733,367.593 866.041,478.24 868.349,293.32 870.657,626.384 872.965,561.44 875.273,649.411 877.581,449.984 879.889,483.167 882.197,369.719 884.504,586.573 886.812,390.379 889.12,415.88 891.428,566.868 893.736,469.886 896.044,506.908 898.352,547.713 900.66,350.069 902.968,396.86 905.276,386.889 907.584,276.699 909.891,428.587 912.199,415.054 914.507,485.521 916.815,466.226 919.123,392.47 921.431,502.67 923.739,641.432 926.047,532.374 928.355,613.485 930.663,527.492 932.971,433.513 935.278,443.952 937.586,510.858 939.894,349.621 942.202,520.632 944.51,366.815 946.818,420.136 949.126,614.126 951.434,383.122 953.742,300.236 956.05,384.592 958.358,422.118 960.665,630.196 962.973,236.925 965.281,405.115 967.589,430.788 969.897,297.002 972.205,645.551 974.513,492.051 976.821,385.52 979.129,521.384 981.437,357.357 983.745,471.493 986.053,197.174 988.36,758.283 990.668,293.392 992.976,504.179 995.284,311.033 997.592,504.686 999.9,373.671 1002.21,576.33 1004.52,292.12 1006.82,531.922 1009.13,305.456 1011.44,473.506 1013.75,432.447 1016.06,558.29 1018.36,607.253 1020.67,487.362 1022.98,420.287 1025.29,578.412 1027.59,591.87 1029.9,427.025 1032.21,263.986 1034.52,590.321 1036.83,411.089 1039.13,424.989 1041.44,460.747 1043.75,420.164 1046.06,485.394 1048.37,381.193 1050.67,428.463 1052.98,457.825 1055.29,432.762 1057.6,517.05 1059.91,277.603 1062.21,503.532 1064.52,485.332 1066.83,516.347 1069.14,582.324 1071.45,517.512 1073.75,530.415 1076.06,548.614 1078.37,563.085 1080.68,428.426 1082.98,457.486 1085.29,502.597 1087.6,548.128 1089.91,490.883 1092.22,448.484 1094.52,510.863 1096.83,354.248 1099.14,354.514 1101.45,528.445 1103.76,446.831 1106.06,511.042 1108.37,572.601 1110.68,522.738 1112.99,544.419 1115.3,462.995 1117.6,517.138 1119.91,363.719 1122.22,394.342 1124.53,422.028 1126.84,440.977 1129.14,304.691 1131.45,449.454 1133.76,641.216 1136.07,354.849 1138.37,452.734 1140.68,496.113 1142.99,371.046 1145.3,375.886 1147.61,520.117 1149.91,577.047 1152.22,518.242 1154.53,481.546 1156.84,369.743 1159.15,551.293 1161.45,361.375 1163.76,566.799 1166.07,370.744 1168.38,607.98 1170.69,543.982 1172.99,498.581 1175.3,591.678 1177.61,514.286 1179.92,496.857 1182.23,636.375 1184.53,579.737 1186.84,424.303 1189.15,490.834 1191.46,557.572 1193.76,506.787 1196.07,591.941 1198.38,499.629 1200.69,512.976 1203,635.293 1205.3,447.599 1207.61,508.99 1209.92,575.745 1212.23,402.51 1214.54,496.837 1216.84,561.1 1219.15,369.916 1221.46,534.539 1223.77,446.524 1226.08,766.664 1228.38,539.828 1230.69,325.086 1233,347.705 1235.31,521.178 1237.61,403.546 1239.92,278.304 1242.23,302.399 1244.54,382.887 1246.85,380.749 1249.15,545.81 1251.46,568.038 1253.77,523.484 1256.08,364.28 1258.39,449.025 1260.69,431.365 1263,397.21 1265.31,481.122 1267.62,608.77 1269.93,560.027 1272.23,463.834 1274.54,449.385 1276.85,509.305 1279.16,637.929 1281.47,507.08 1283.77,443.488 1286.08,512.824 1288.39,519.786 1290.7,495.312 1293,505.737 1295.31,360.114 1297.62,420.258 1299.93,648.222 1302.24,636.44 1304.54,439.566 1306.85,498.619 1309.16,471.887 1311.47,445.43 1313.78,442.33 1316.08,464.217 1318.39,409.883 1320.7,591.667 1323.01,612.999 1325.32,539.982 1327.62,627.594 1329.93,519.35 1332.24,446.259 1334.55,394.983 1336.86,291.413 1339.16,441.878 1341.47,451.233 1343.78,439.274 1346.09,266.537 1348.39,436.751 1350.7,394.158 1353.01,416.357 1355.32,490.521 1357.63,370.989 1359.93,341.64 1362.24,457.964 1364.55,516.253 1366.86,602.122 1369.17,632.621 1371.47,633.529 1373.78,582.996 1376.09,624.613 1378.4,324.998 1380.71,506.503 1383.01,441.631 1385.32,277.166 1387.63,396.791 1389.94,524.547 1392.24,540.316 1394.55,352.677 1396.86,532.395 1399.17,590.978 1401.48,398.23 1403.78,534.646 1406.09,695.153 1408.4,514.394 1410.71,462.365 1413.02,500.81 1415.32,358.546 1417.63,498.839 1419.94,556.48 1422.25,297.845 1424.56,402.059 1426.86,572.232 1429.17,580.161 1431.48,642.572 1433.79,394.452 1436.1,498.699 1438.4,540.525 1440.71,349.045 1443.02,392.371 1445.33,336.353 1447.63,529.463 1449.94,400.251 1452.25,498.768 1454.56,528.036 1456.87,530.531 1459.17,438.961 1461.48,382.043 1463.79,521.475 1466.1,644.239 1468.41,637.318 1470.71,490.132 1473.02,418.877 1475.33,529.694 1477.64,484.469 1479.95,415.469 1482.25,539.043 1484.56,423.106 1486.87,342.992 1489.18,346.683 1491.49,336.169 1493.79,341.104 1496.1,580.618 1498.41,560.396 1500.72,605.807 1503.02,224.283 1505.33,574.35 1507.64,454.611 1509.95,416.735 1512.26,332.918 1514.56,538.251 1516.87,660.987 1519.18,505.942 1521.49,461.699 1523.8,484.831 1526.1,477.795 1528.41,444.615 1530.72,396.91 1533.03,454.636 1535.34,428.237 1537.64,354.915 1539.95,276.983 1542.26,317.382 1544.57,519.75 1546.88,286.447 1549.18,446.908 1551.49,361.598 1553.8,575.607 1556.11,513.834 1558.41,368.862 1560.72,421.16 1563.03,282.783 1565.34,424.825 1567.65,418.133 1569.95,488.996 1572.26,415.84 1574.57,387.95 1576.88,501.017 1579.19,464.627 1581.49,453.912 1583.8,417.473 1586.11,410.944 1588.42,438.187 1590.73,414.576 1593.03,581.562 1595.34,641.411 1597.65,488.748 1599.96,291.64 1602.26,518.354 1604.57,638.956 1606.88,633.221 1609.19,601.978 1611.5,693.485 1613.8,491.75 1616.11,508.996 1618.42,422.67 1620.73,535.371 1623.04,382.283 1625.34,512.184 1627.65,438.439 1629.96,282.961 1632.27,536.764 1634.58,531.244 1636.88,623.271 1639.19,562.893 1641.5,570.307 1643.81,590.768 1646.12,476.293 1648.42,431.119 1650.73,363.797 1653.04,408.117 1655.35,474.86 1657.65,363.294 1659.96,350.069 1662.27,428.926 1664.58,547.071 1666.89,470.283 1669.19,608.434 1671.5,495.249 1673.81,507.505 1676.12,411.959 1678.43,554.849 1680.73,441.692 1683.04,296.567 1685.35,360.003 1687.66,546.461 1689.97,274.805 1692.27,566.938 1694.58,326.347 1696.89,540.142 1699.2,506.213 1701.51,535.631 1703.81,427.686 1706.12,381.229 1708.43,324.758 1710.74,513.193 1713.04,349.37 1715.35,488.829 1717.66,492.619 1719.97,425.852 1722.28,433.418 1724.58,567.879 1726.89,444.554 1729.2,352.306 1731.51,437.823 1733.82,415.736 1736.12,447.83 1738.43,375.704 1740.74,410.36 1743.05,408.459 1745.36,516.959 1747.66,453.381 1749.97,432.561 1752.28,462.961 1754.59,503.907 1756.9,427.619 1759.2,537.358 1761.51,525.885 1763.82,428.551 1766.13,483.271 1768.43,438.641 1770.74,201.546 1773.05,352.614 1775.36,340.746 1777.67,602.522 1779.97,563.651 1782.28,488.119 1784.59,431.483 1786.9,267.429 1789.21,245.061 1791.51,365.963 1793.82,475.597 1796.13,537.291 1798.44,455.554 1800.75,509.771 1803.05,523.142 1805.36,437.81 1807.67,459.488 1809.98,441.265 1812.28,414.154 1814.59,536.039 1816.9,589.027 1819.21,541.181 1821.52,429.663 1823.82,520.404 1826.13,607.909 1828.44,632.758 1830.75,318.698 1833.06,466.953 1835.36,325.369 1837.67,425.013 1839.98,387.097 1842.29,458.99 1844.6,424.193 1846.9,229.54 1849.21,526.052 1851.52,273.041 1853.83,355.492 1856.14,521.561 1858.44,373.708 1860.75,527.159 1863.06,556.834 1865.37,272.691 1867.67,400.991 1869.98,635.28 1872.29,668.214 1874.6,615.295 1876.91,300.235 1879.21,456.732 1881.52,480.142 1883.83,374.35 1886.14,333.202 1888.45,463.121 1890.75,437.395 1893.06,298.341 1895.37,410.169 1897.68,486.772 1899.99,444.523 1902.29,374.708 1904.6,494.439 1906.91,557.446 1909.22,479.611 1911.53,494.421 1913.83,451.687 1916.14,463.857 1918.45,440.141 1920.76,447.074 1923.06,540.986 1925.37,443.664 1927.68,465.342 1929.99,464.913 1932.3,343.602 1934.6,608.47 1936.91,364.447 1939.22,580.367 1941.53,499.556 1943.84,391.322 1946.14,607.178 1948.45,459.818 1950.76,452.791 1953.07,512.693 1955.38,555.145 1957.68,476.568 1959.99,495.699 1962.3,416.228 1964.61,410.219 1966.91,510.902 1969.22,293.026 1971.53,367.998 1973.84,546.679 1976.15,560.364 1978.45,435.733 1980.76,521.31 1983.07,324.878 1985.38,430.962 1987.69,400.571 1989.99,553.553 1992.3,507.965 1994.61,382.918 1996.92,260.745 1999.23,282.039 2001.53,452.978 2003.84,332.843 2006.15,515.751 2008.46,388.374 2010.77,402.608 2013.07,541.427 2015.38,333.881 2017.69,396.621 2020,532.226 2022.3,393.301 2024.61,375.64 2026.92,576.943 2029.23,518.1 2031.54,393.798 2033.84,521.388 2036.15,571.451 2038.46,423.455 2040.77,441.574 2043.08,341.426 2045.38,442.717 2047.69,632.191 2050,481.25 2052.31,514.795 2054.62,431.012 2056.92,399.111 2059.23,517.343 2061.54,445.286 2063.85,289.872 2066.16,365.679 2068.46,324.099 2070.77,445.867 2073.08,471.268 2075.39,523.03 2077.69,410.714 2080,495.916 2082.31,96.8724 2084.62,530.805 2086.93,490.954 2089.23,413.283 2091.54,433.771 2093.85,585.129 2096.16,324.091 2098.47,580.411 2100.77,549.113 2103.08,571.502 2105.39,264.023 2107.7,372.407 2110.01,527.497 2112.31,512.306 2114.62,418.728 2116.93,578.13 2119.24,536.72 2121.55,412.761 2123.85,361.393 2126.16,291.682 2128.47,397.422 2130.78,552.98 2133.08,511.557 2135.39,302.07 2137.7,559.824 2140.01,410.884 2142.32,498.451 2144.62,519.809 2146.93,506.54 2149.24,640.493 2151.55,644.682 2153.86,469.11 2156.16,516.294 2158.47,301.922 2160.78,544.704 2163.09,484.569 2165.4,523.141 2167.7,502.864 2170.01,337.389 2172.32,330.018 2174.63,752.564 2176.93,486.717 2179.24,573.749 2181.55,450.161 2183.86,579.156 2186.17,273.382 2188.47,393.476 2190.78,471.403 2193.09,437.311 2195.4,536.976 2197.71,317.738 2200.01,392.483 2202.32,420.731 2204.63,386.398 2206.94,443.549 2209.25,502.913 2211.55,691.279 2213.86,510.236 2216.17,545.087 2218.48,570.903 2220.79,492.417 2223.09,428.786 2225.4,565.202 2227.71,338.08 2230.02,519.872 2232.32,357.24 2234.63,580.908 2236.94,287.682 2239.25,542.512 2241.56,587.216 2243.86,544.993 2246.17,543.646 2248.48,311.339 2250.79,458.845 2253.1,474.018 2255.4,548.215 2257.71,450.277 2260.02,515.501 2262.33,625.645 2264.64,435.082 2266.94,445.278 2269.25,624.559 2271.56,412.679 2273.87,261.768 2276.18,529.024 2278.48,233.363 2280.79,522.844 2283.1,320.946 2285.41,436.227 2287.71,440.054 2290.02,419.866 2292.33,369.698 2294.64,493.54 2296.95,559.867 2299.25,436.096 2301.56,643.214 2303.87,351.6 2306.18,495.066 2308.49,443.181 2310.79,600.716 2313.1,521.378 2315.41,278.979 2317.72,453.895 2320.03,508.406 2322.33,398.564 2324.64,388.167 2326.95,324.684 2329.26,401.757 2331.56,592.13 2333.87,428.938 2336.18,339.321 2338.49,489.77 2340.8,389.798 2343.1,556.795 2345.41,287.729 2347.72,381.827 2350.03,550.986 2352.34,325.528 2354.64,464.736 2356.95,385.421 2359.26,511.71 2361.57,578.091 2363.88,497.851 2366.18,467.856 2368.49,566.507 2370.8,621.701 2373.11,520.792 2375.42,431.29 2377.72,616.335 2380.03,449.331 2382.34,413.974 2384.65,450.018 2386.95,473.311 2389.26,364.089 2391.57,515.121 2393.88,435.385 2396.19,510.992 2398.49,319.819 2400.8,516.279 2403.11,475.681 2405.42,452.565 2407.73,522.878 2410.03,503.667 2412.34,524.351 2414.65,609.737 2416.96,485.471 2419.27,515.671 2421.57,650 2423.88,764.546 2426.19,626.328 2428.5,485.785 2430.81,369.732 2433.11,488.769 2435.42,513.344 2437.73,286.743 2440.04,355.638 2442.34,433.422 2444.65,427.941 2446.96,552.821 2449.27,567.555 2451.58,437.189 2453.88,444.652 2456.19,387.713 2458.5,475.156 2460.81,274.873 2463.12,577.798 2465.42,536.222 2467.73,494.98 2470.04,444.402 2472.35,656.303 2474.66,475.052 2476.96,627.595 2479.27,457.526 2481.58,376.424 2483.89,530.312 2486.2,607.105 2488.5,207.833 2490.81,420.637 2493.12,499.717 2495.43,694.601 2497.73,515.781 2500.04,493.39 2502.35,417.87 2504.66,577.146 2506.97,489.586 2509.27,441.099 2511.58,466.361 2513.89,547.555 2516.2,508.46 2518.51,459.264 2520.81,534.59 2523.12,544.557 2525.43,513.258 2527.74,553.11 2530.05,553.943 2532.35,272.864 2534.66,620.802 2536.97,343.552 2539.28,602.932 2541.58,390.403 2543.89,477.224 2546.2,551.901 2548.51,628.388 2550.82,490.704 2553.12,542.854 2555.43,412.511 2557.74,503.924 2560.05,455.717 2562.36,657.736 2564.66,313.032 2566.97,465.678 2569.28,521.815 2571.59,558.45 "></polyline>
</svg>
</div>
</div>
<p>Look at that! Things are working; amazin’.</p>
<p>We can also exploit <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>’s parallel sampling capabilities:</p>
<div id="34" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run separate 4 chains for 10 000 iterations using threads to parallelize.</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>num_chains <span class="op">=</span> <span class="fl">4</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    model_with_grad,</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">MCMCThreads</span>(),</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>,</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    num_chains;</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Note we need to provide an initial state for every chain.</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>    initial_state<span class="op">=</span><span class="fu">fill</span>(state, num_chains),</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>samples_array <span class="op">=</span> <span class="fu">stack</span>(<span class="fu">map</span>(<span class="bu">Base</span>.<span class="fu">Fix1</span>(stack, sample <span class="op">-&gt;</span> sample.x), samples))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000×4 Array{Float64, 3}:
[:, :, 1] =
 -3.22424   -2.76582   -4.25527  -4.25527  …  -4.30793  -4.25632  -5.75242
  0.507478   0.429871   1.06355   1.06355     -1.94767  -1.40052  -1.26832
  1.98733    6.07304    5.97191   5.97191      2.8642    4.69239   5.02885

[:, :, 2] =
 -3.05007   -4.9916   -5.24008   -5.23809   …  -2.62717   -3.59861   -4.04361
  0.133829  -1.31382  -0.330184   0.504551      0.551363   0.478145  -1.06536
  2.1561     3.84464   3.81701    4.73803       6.57784    5.40449    5.0105

[:, :, 3] =
 -2.15199    -3.68786   -3.33058  -3.69353  …  -4.38308   -6.63476  -6.63476
 -0.0785319  -0.608275  -2.06602  -1.40722     -0.870542  -0.43808  -0.43808
  0.241388    4.04101    5.49274   3.98432      4.70123    4.51011   4.51011

[:, :, 4] =
 -0.737764  -2.89391  -2.49941  -3.26507   …  -5.21197   -4.3897    -4.39806
  2.46244    3.7       1.05094  -0.571763      0.434477   0.346667   0.1844
  3.4996     3.65639   4.87036   6.61134       4.07828    4.74965    5.86027</code></pre>
</div>
</div>
<p>But the fact that we have to provide the <code>AbstractMCMC.sample</code> call, etc. with an <code>initial_state</code> to get started is a bit annoying. We can avoid this by also defining a <code>AbstractMCMC.step</code> <em>without</em> the <code>state</code> argument:</p>
<div id="36" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">::</span><span class="dt">MALA</span>;</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># </span><span class="al">NOTE</span><span class="co">: No state provided!</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just create the initial state by sampling using  a Gaussian.</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="fu">randn</span>(rng, LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(x), <span class="fu">MALAState</span>(x)</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Equipped with this, we no longer need to provide the <code>initial_state</code> everywhere:</p>
<div id="38" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -4.99654    0.991009
 -0.0600099  0.985128
  4.99739    1.00025</code></pre>
</div>
</div>
</section>
<section id="using-our-sampler-with-turing.jl" class="level2">
<h2 class="anchored" data-anchor-id="using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</h2>
<p>As we promised, all of this hassle of implementing our <code>MALA</code> sampler in a way that uses <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> and <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> gets us something more than <em>just</em> an “automatic” implementation of <code>AbstractMCMC.sample</code>.</p>
<p>It also enables use with Turing.jl through the <code>externalsampler</code>, but we need to do one final thing first: we need to tell Turing.jl how to extract a vector of parameters from the “sample” returned in our implementation of <code>AbstractMCMC.step</code>. In our case, the “sample” is a <code>MALASample</code>, so we just need the following line:</p>
<div id="40" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Turing</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">DynamicPPL</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Overload the `getparams` method for our "sample" type, which is just a vector.</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>Turing.Inference.<span class="fu">getparams</span>(<span class="op">::</span><span class="dt">DynamicPPL.Model</span>, sample<span class="op">::</span><span class="dt">MALASample</span>) <span class="op">=</span> sample.x</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And with that, we’re good to go!</p>
<div id="42" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Our previous model defined as a Turing.jl model.</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">mvnormal_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">MvNormal</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.], I)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate our model.</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">mvnormal_model</span>()</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Call `sample` but now we're passing in a Turing.jl `model` and wrapping</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co"># our `MALA` sampler in the `externalsampler` to tell Turing.jl that the sampler</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co"># expects something that implements LogDensityProblems.jl.</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×4×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 2.95 seconds
Compute duration  = 2.95 seconds
parameters        = x[1], x[2], x[3]
internals         = lp

Use `describe(chains)` for summary statistics and quantiles.</code></pre>
</div>
</div>
<p>Pretty neat, eh?</p>
<section id="models-with-constrained-parameters" class="level3">
<h3 class="anchored" data-anchor-id="models-with-constrained-parameters">Models with constrained parameters</h3>
<p>One thing we’ve sort of glossed over in all of the above is that MALA, at least how we’ve implemented it, requires <span class="math inline">\(x\)</span> to live in <span class="math inline">\(\mathbb{R}^d\)</span> for some <span class="math inline">\(d &gt; 0\)</span>. If some of the parameters were in fact constrained, e.g.&nbsp;we were working with a <code>Beta</code> distribution which has support on the interval <span class="math inline">\((0, 1)\)</span>, <em>not</em> on <span class="math inline">\(\mathbb{R}^d\)</span>, we could easily end up outside of the valid range <span class="math inline">\((0, 1)\)</span>.</p>
<div id="44" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">beta_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">beta_model</span>()</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 1.63 seconds
Compute duration  = 1.63 seconds
parameters        = x
internals         = lp

Use `describe(chains)` for summary statistics and quantiles.</code></pre>
</div>
</div>
<p>Yep, that still works, but only because Turing.jl actually <em>transforms</em> the <code>turing_model</code> from constrained to unconstrained, so that the <code>sampler</code> provided to <code>externalsampler</code> is actually always working in unconstrained space! This is not always desirable, so we can turn this off:</p>
<div id="46" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 0.28 seconds
Compute duration  = 0.28 seconds
parameters        = x
internals         = lp

Use `describe(chains)` for summary statistics and quantiles.</code></pre>
</div>
</div>
<p>The fun thing is that this still sort of works because</p>
<div id="48" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">logpdf</span>(<span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>), <span class="fl">10.0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-Inf</code></pre>
</div>
</div>
<p>and so the samples that fall outside of the range are always rejected. But do notice how much worse all the diagnostics are, e.g.&nbsp;<code>ess_tail</code> is very poor compared to when we use <code>unconstrained=true</code>. Moreover, in more complex cases this won’t just result in a “nice” <code>-Inf</code> log-density value, but instead will error:</p>
<div id="50" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="kw">function</span> <span class="fu">demo</span>()</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>    σ² <span class="op">~</span> <span class="fu">truncated</span>(<span class="fu">Normal</span>(), lower<span class="op">=</span><span class="fl">0</span>)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If we end up with negative values for `σ²`, the `Normal` will error.</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>    x <span class="op">~</span> <span class="fu">Normal</span>(<span class="fl">0</span>, σ²)</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre>DomainError with -1.036875319260432:
Normal: the condition σ &gt;= zero(σ) is not satisfied.
Stacktrace:
  [1] <span class="ansi-bold">#371</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/YQSrn/src/univariate/continuous/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">normal.jl:37</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [2] <span class="ansi-bold">check_args</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/YQSrn/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">utils.jl:89</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [3] <span class="ansi-bold">#Normal#370</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/YQSrn/src/univariate/continuous/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">normal.jl:37</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [4] <span class="ansi-bold">Normal</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/YQSrn/src/univariate/continuous/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">normal.jl:36</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [5] <span class="ansi-bold">Normal</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/YQSrn/src/univariate/continuous/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">normal.jl:42</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [6] <span class="ansi-bold">macro expansion</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/nxcz4/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">compiler.jl:558</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [7] <span class="ansi-bold">demo</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">__model__</span>::Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DefaultContext}</span>, <span class="ansi-bright-black-fg">__varinfo__</span>::DynamicPPL.ThreadSafeVarInfo<span class="ansi-bright-black-fg">{VarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}, Vector{Base.RefValue{Float64}}}</span>, <span class="ansi-bright-black-fg">__context__</span>::DefaultContext<span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-magenta-fg">Main.Notebook</span> <span class="ansi-bright-black-fg">~/work/docs/docs/developers/inference/implementing-samplers/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">index.qmd:457</span>
  [8] <span class="ansi-bold">_evaluate!!</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/nxcz4/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">model.jl:913</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [9] <span class="ansi-bold">evaluate_threadsafe!!</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">model</span>::Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DefaultContext}</span>, <span class="ansi-bright-black-fg">varinfo</span>::VarInfo<span class="ansi-bright-black-fg">{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}</span>, <span class="ansi-bright-black-fg">context</span>::DefaultContext<span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-cyan-fg">DynamicPPL</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/nxcz4/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">model.jl:902</span>
 [10] <span class="ansi-bold">evaluate!!</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/nxcz4/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">model.jl:832</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [11] <span class="ansi-bold">make_updated_varinfo</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">f</span>::LogDensityFunction<span class="ansi-bright-black-fg">{Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DefaultContext}, VarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}, DefaultContext, AutoForwardDiff{2, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}}}</span>, <span class="ansi-bright-black-fg">external_transition</span>::MALASample<span class="ansi-bright-black-fg">{Vector{Float64}}</span>, <span class="ansi-bright-black-fg">external_state</span>::MALAState<span class="ansi-bright-black-fg">{Vector{Float64}}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-green-fg">Turing.Inference</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/V6zn0/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">external_sampler.jl:134</span>
 [12] <span class="ansi-bold">step</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">rng</span>::TaskLocalRNG, <span class="ansi-bright-black-fg">model</span>::Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DefaultContext}</span>, <span class="ansi-bright-black-fg">sampler_wrapper</span>::Sampler<span class="ansi-bright-black-fg">{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}</span>; <span class="ansi-bright-black-fg">initial_state</span>::Nothing, <span class="ansi-bright-black-fg">initial_params</span>::Nothing, <span class="ansi-bright-black-fg">kwargs</span>::@Kwargs<span class="ansi-bright-black-fg">{}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-green-fg">Turing.Inference</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/V6zn0/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">external_sampler.jl:185</span>
 [13] <span class="ansi-bold">macro expansion</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/AbstractMCMC/7f1oY/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">sample.jl:0</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [14] <span class="ansi-bold">(::AbstractMCMC.var"#25#26"{Nothing, Int64, Int64, Int64, UnionAll, Nothing, @Kwargs{}, TaskLocalRNG, Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DefaultContext}, Sampler{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}, Int64, Float64, Int64, Int64})</span><span class="ansi-bold">(</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-yellow-fg">AbstractMCMC</span> <span class="ansi-bright-black-fg">~/.julia/packages/AbstractMCMC/7f1oY/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">logging.jl:134</span>
 [15] <span class="ansi-bold">with_logstate</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">f</span>::AbstractMCMC.var"#25#26"<span class="ansi-bright-black-fg">{Nothing, Int64, Int64, Int64, UnionAll, Nothing, @Kwargs{}, TaskLocalRNG, Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DefaultContext}, Sampler{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}, Int64, Float64, Int64, Int64}</span>, <span class="ansi-bright-black-fg">logstate</span>::Base.CoreLogging.LogState<span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">Base.CoreLogging</span> <span class="ansi-bright-black-fg">./logging/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">logging.jl:524</span>
 [16] <span class="ansi-bold">with_logger</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">f</span>::Function, <span class="ansi-bright-black-fg">logger</span>::LoggingExtras.TeeLogger<span class="ansi-bright-black-fg">{Tuple{LoggingExtras.EarlyFilteredLogger{TerminalLoggers.TerminalLogger, AbstractMCMC.var"#1#3"{Module}}, LoggingExtras.EarlyFilteredLogger{Base.CoreLogging.ConsoleLogger, AbstractMCMC.var"#2#4"{Module}}}}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">Base.CoreLogging</span> <span class="ansi-bright-black-fg">./logging/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">logging.jl:635</span>
 [17] <span class="ansi-bold">with_progresslogger</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">f</span>::Function, <span class="ansi-bright-black-fg">_module</span>::Module, <span class="ansi-bright-black-fg">logger</span>::Base.CoreLogging.ConsoleLogger<span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-yellow-fg">AbstractMCMC</span> <span class="ansi-bright-black-fg">~/.julia/packages/AbstractMCMC/7f1oY/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">logging.jl:157</span>
 [18] <span class="ansi-bold">macro expansion</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/AbstractMCMC/7f1oY/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">logging.jl:133</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [19] <span class="ansi-bold">mcmcsample</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">rng</span>::TaskLocalRNG, <span class="ansi-bright-black-fg">model</span>::Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DefaultContext}</span>, <span class="ansi-bright-black-fg">sampler</span>::Sampler<span class="ansi-bright-black-fg">{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}</span>, <span class="ansi-bright-black-fg">N</span>::Int64; <span class="ansi-bright-black-fg">progress</span>::Bool, <span class="ansi-bright-black-fg">progressname</span>::String, <span class="ansi-bright-black-fg">callback</span>::Nothing, <span class="ansi-bright-black-fg">num_warmup</span>::Int64, <span class="ansi-bright-black-fg">discard_initial</span>::Int64, <span class="ansi-bright-black-fg">thinning</span>::Int64, <span class="ansi-bright-black-fg">chain_type</span>::Type, <span class="ansi-bright-black-fg">initial_state</span>::Nothing, <span class="ansi-bright-black-fg">kwargs</span>::@Kwargs<span class="ansi-bright-black-fg">{}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-yellow-fg">AbstractMCMC</span> <span class="ansi-bright-black-fg">~/.julia/packages/AbstractMCMC/7f1oY/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">sample.jl:151</span>
 [20] <span class="ansi-bold">sample</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">rng</span>::TaskLocalRNG, <span class="ansi-bright-black-fg">model</span>::Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DefaultContext}</span>, <span class="ansi-bright-black-fg">sampler</span>::Sampler<span class="ansi-bright-black-fg">{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}</span>, <span class="ansi-bright-black-fg">N</span>::Int64; <span class="ansi-bright-black-fg">chain_type</span>::Type, <span class="ansi-bright-black-fg">resume_from</span>::Nothing, <span class="ansi-bright-black-fg">initial_state</span>::Nothing, <span class="ansi-bright-black-fg">kwargs</span>::@Kwargs<span class="ansi-bright-black-fg">{progress::Bool}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-cyan-fg">DynamicPPL</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/nxcz4/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">sampler.jl:102</span>
 [21] <span class="ansi-bold">sample</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/nxcz4/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">sampler.jl:92</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [22] <span class="ansi-bold">#sample#101</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/V6zn0/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">abstractmcmc.jl:29</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [23] <span class="ansi-bold">sample</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/V6zn0/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">abstractmcmc.jl:20</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [24] <span class="ansi-bold">#sample#100</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/V6zn0/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">abstractmcmc.jl:17</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [25] top-level scope
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/work/docs/docs/developers/inference/implementing-samplers/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">index.qmd:459</span></pre>
</div>
</div>
</div>
<p>As expected, we run into a <code>DomainError</code> at some point, while if we set <code>unconstrained=true</code>, letting Turing.jl transform the model to a unconstrained form behind the scenes, everything works as expected:</p>
<div id="52" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 2.05 seconds
Compute duration  = 2.05 seconds
parameters        = σ², x
internals         = lp

Use `describe(chains)` for summary statistics and quantiles.</code></pre>
</div>
</div>
<p>Neat!</p>
<p>Similarly, which automatic differentiation backend one should use can be specified through the <code>adtype</code> keyword argument too. For example, if we want to use <a href="https://github.com/JuliaDiff/ReverseDiff.jl">ReverseDiff.jl</a> instead of the default <a href="https://github.com/JuliaDiff/ForwardDiff.jl">ForwardDiff.jl</a>:</p>
<div id="54" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">ReverseDiff</span>: ReverseDiff</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify that we want to use `AutoReverseDiff`.</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">demo</span>(),</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>, adtype<span class="op">=</span><span class="fu">AutoReverseDiff</span>()),</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>;</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 3.33 seconds
Compute duration  = 3.33 seconds
parameters        = σ², x
internals         = lp

Use `describe(chains)` for summary statistics and quantiles.</code></pre>
</div>
</div>
<p>Double-neat.</p>
</section>
</section>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<p>At this point it’s worth maybe reminding ourselves what we did and also <em>why</em> we did it:</p>
<ol type="1">
<li>We define our models in the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface because it makes the sampler agnostic to how the underlying model is implemented.</li>
<li>We implement our sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> interface, which just means that our sampler is a subtype of <code>AbstractMCMC.AbstractSampler</code> and we implement the MCMC transition in <code>AbstractMCMC.step</code>.</li>
<li>Points 1 and 2 makes it so our sampler can be used with a wide range of model implementations, amongst them being models implemented in both Turing.jl and Stan. This gives you, the inference implementer, a large collection of models to test your inference method on, in addition to allowing users of Turing.jl and Stan to try out your inference method with minimal effort.</li>
</ol>


</section>


<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a><div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>We’re going with the leapfrog formulation because in a future version of this tutorial we’ll add a section extending this simple “baseline” MALA sampler to more complex versions. See <a href="https://github.com/TuringLang/docs/issues/479">issue #479</a> for progress on this.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>There is no such thing as a proper interface in Julia (at least not officially), and so we use the word “interface” here to mean a few minimal methods that needs to be implemented by any type that we treat as a target model.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    // Ensure there is a toggle, if there isn't float one in the top right
    if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
      const a = window.document.createElement('a');
      a.classList.add('top-right');
      a.classList.add('quarto-color-scheme-toggle');
      a.href = "";
      a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
      const i = window.document.createElement("i");
      i.classList.add('bi');
      a.appendChild(i);
      window.document.body.appendChild(a);
    }
    setColorSchemeToggle(hasAlternateSentinel())
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/turinglang\.org\/docs\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../../developers/inference/variational-inference/index.html" class="pagination-link" aria-label="Variational Inference">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Variational Inference</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Turing is created by <a href="http://mlg.eng.cam.ac.uk/hong/" target="_blank">Hong Ge</a>, and lovingly maintained by the <a href="https://github.com/TuringLang/Turing.jl/graphs/contributors" target="_blank">core team</a> of volunteers. <br> The contents of this website are © 2018–2025 under the terms of the <a href="https://github.com/TuringLang/docs/blob/main/LICENCE" target="_blank">MIT License</a>.</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/TuringLang/docs/edit/main/developers/inference/implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/docs/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://x.com/TuringLang">
      <i class="bi bi-twitter" role="img" aria-label="Turing Twitter">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/TuringLang/Turing.jl">
      <i class="bi bi-github" role="img" aria-label="Turing GitHub">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




<script src="../../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>