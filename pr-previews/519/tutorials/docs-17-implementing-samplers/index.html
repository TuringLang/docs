<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Implementing samplers – Turing.jl</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../tutorials/docs-07-for-developers-variational-inference/index.html" rel="prev">
<link href="../../assets/favicon.ico" rel="icon">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<style>
  a {
    text-decoration: none;
  }
  a:hover {
    text-decoration: underline;
  }
</style>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../theming/styles.css">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="https://turinglang.org/" class="navbar-brand navbar-brand-logo">
    <img src="../../assets/images/turing-logo.svg" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="https://turinglang.org/">
    <span class="navbar-title">Turing.jl</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../tutorials/docs-00-getting-started/"> 
<span class="menu-text">Get Started</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../tutorials/00-introduction/"> 
<span class="menu-text">Tutorials</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/library/"> 
<span class="menu-text">Libraries</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/news/"> 
<span class="menu-text">News</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/team/"> 
<span class="menu-text">Team</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-v0.34" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">v0.34</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-v0.34">    
        <li>
    <a class="dropdown-item" href="https://turinglang.org/docs/changelog.html">
 <span class="dropdown-text">Changelog</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://turinglang.org/docs/versions.html">
 <span class="dropdown-text">All Versions</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
    <a href="https://x.com/TuringLang" title="Turing Twitter" class="quarto-navigation-tool px-1" aria-label="Turing Twitter"><i class="bi bi-twitter"></i></a>
    <a href="https://github.com/TuringLang/Turing.jl" title="Turing GitHub" class="quarto-navigation-tool px-1" aria-label="Turing GitHub"><i class="bi bi-github"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Documentation</li><li class="breadcrumb-item"><a href="../../tutorials/docs-04-for-developers-abstractmcmc-turing/index.html">Developers: Inference</a></li><li class="breadcrumb-item"><a href="../../tutorials/docs-17-implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Documentation</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false">
 <span class="menu-text">Using Turing - Modelling Syntax and Interface</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-00-getting-started/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Getting Started</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-14-using-turing-quick-start/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Quick Start</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-12-using-turing-guide/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Guide</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-17-mode-estimation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Mode Estimation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-09-using-turing-advanced/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Advanced Usage</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-10-using-turing-autodiff/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Automatic Differentiation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-13-using-turing-performance-tips/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Performance Tips</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-11-using-turing-dynamichmc/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using DynamicHMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-15-using-turing-sampler-viz/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Sampler Visualization</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-16-using-turing-external-samplers/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">External Samplers</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false">
 <span class="menu-text">Using Turing - Tutorials</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/00-introduction/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction to Turing</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/01-gaussian-mixture-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Mixture Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/02-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/03-bayesian-neural-network/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Neural Networks</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/04-hidden-markov-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Hidden Markov Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/05-linear-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Linear Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/06-infinite-mixture-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Infinite Mixture Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/07-poisson-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Poisson Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/08-multinomial-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Multinomial Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/09-variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/10-bayesian-differential-equations/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Differential Equations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/11-probabilistic-pca/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Probabilistic PCA</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/13-seasonal-time-series/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Time Series Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/15-gaussian-processes/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction to Gaussian Processes</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/12-gplvm/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Process Latent Variable Models</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false">
 <span class="menu-text">Developers: Contributing</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-01-contributing-guide/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">How to Contribute</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false">
 <span class="menu-text">Developers: PPL</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-05-for-developers-compiler/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Turing Compiler Design</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/14-minituring/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation I: Compiler</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/16-contexts/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation II: Contexts</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-06-for-developers-interface/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Interface Guide</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true">
 <span class="menu-text">Developers: Inference</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-04-for-developers-abstractmcmc-turing/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">How Turing implements AbstractMCMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-07-for-developers-variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-17-implementing-samplers/index.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Implementing Samplers</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of Contents</h2>
   
  <ul>
  <li><a href="#quick-overview-of-mala" id="toc-quick-overview-of-mala" class="nav-link active" data-scroll-target="#quick-overview-of-mala">Quick overview of MALA</a></li>
  <li><a href="#what-we-need-from-a-model-logdensityproblems.jl" id="toc-what-we-need-from-a-model-logdensityproblems.jl" class="nav-link" data-scroll-target="#what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: LogDensityProblems.jl</a></li>
  <li><a href="#implementing-mala-in-abstractmcmc.jl" id="toc-implementing-mala-in-abstractmcmc.jl" class="nav-link" data-scroll-target="#implementing-mala-in-abstractmcmc.jl">Implementing MALA in AbstractMCMC.jl</a></li>
  <li><a href="#using-our-sampler-with-turing.jl" id="toc-using-our-sampler-with-turing.jl" class="nav-link" data-scroll-target="#using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</a>
  <ul class="collapse">
  <li><a href="#models-with-constrained-parameters" id="toc-models-with-constrained-parameters" class="nav-link" data-scroll-target="#models-with-constrained-parameters">Models with constrained parameters</a></li>
  </ul></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/TuringLang/docs/edit/master/tutorials/docs-17-implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/docs/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Documentation</li><li class="breadcrumb-item"><a href="../../tutorials/docs-04-for-developers-abstractmcmc-turing/index.html">Developers: Inference</a></li><li class="breadcrumb-item"><a href="../../tutorials/docs-17-implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Implementing samplers</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>In this tutorial, we’ll go through step-by-step how to implement a “simple” sampler in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> in such a way that it can be easily applied to Turing.jl models.</p>
<p>In particular, we’re going to implement a version of <strong>Metropolis-adjusted Langevin (MALA)</strong>.</p>
<p>Note that we will implement this sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> framework, completely “ignoring” Turing.jl until the very end of the tutorial, at which point we’ll use a single line of code to make the resulting sampler available to Turing.jl. This is to really drive home the point that one can implement samplers in a way that is accessible to all of Turing.jl’s users without having to use Turing.jl yourself.</p>
<section id="quick-overview-of-mala" class="level2">
<h2 class="anchored" data-anchor-id="quick-overview-of-mala">Quick overview of MALA</h2>
<p>We can view MALA as a single step of the leapfrog intergrator with resampling of momentum <span class="math inline">\(p\)</span> at every step.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> To make that statement a bit more concrete, we first define the <em>extended</em> target <span class="math inline">\(\bar{\gamma}(x, p)\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\log \bar{\gamma}(x, p) \propto \log \gamma(x) + \log \gamma_{\mathcal{N}(0, M)}(p)
\end{equation*}\]</span></p>
<p>where <span class="math inline">\(\gamma_{\mathcal{N}(0, M)}\)</span> denotes the density for a zero-centered Gaussian with covariance matrix <span class="math inline">\(M\)</span>. We then consider targeting this joint distribution over both <span class="math inline">\(x\)</span> and <span class="math inline">\(p\)</span> as follows. First we define the map</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  L_{\epsilon}: \quad &amp; \mathbb{R}^d \times \mathbb{R}^d \to \mathbb{R}^d \times \mathbb{R}^d \\
  &amp; (x, p) \mapsto (\tilde{x}, \tilde{p}) := L_{\epsilon}(x, p)
\end{split}
\end{equation*}\]</span></p>
<p>as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p_{1 / 2} &amp;:= p + \frac{\epsilon}{2} \nabla \log \gamma(x) \\
  \tilde{x} &amp;:= x + \epsilon M^{-1} p_{1 /2 } \\
  p_1 &amp;:= p_{1 / 2} + \frac{\epsilon}{2} \nabla \log \gamma(\tilde{x}) \\
  \tilde{p} &amp;:= - p_1
\end{split}
\end{equation*}\]</span></p>
<p>This might be familiar for some readers as a single step of the Leapfrog integrator. We then define the MALA kernel as follows: given the current iterate <span class="math inline">\(x_i\)</span>, we sample the next iterate <span class="math inline">\(x_{i + 1}\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p &amp;\sim \mathcal{N}(0, M) \\
  (\tilde{x}, \tilde{p}) &amp;:= L_{\epsilon}(x_i, p) \\
  \alpha &amp;:= \min \left\{ 1, \frac{\bar{\gamma}(\tilde{x}, \tilde{p})}{\bar{\gamma}(x_i, p)} \right\} \\
  x_{i + 1} &amp;:=
  \begin{cases}
    \tilde{x} \quad &amp; \text{ with prob. } \alpha \\
    x_i       \quad &amp; \text{ with prob. } 1 - \alpha
  \end{cases}
\end{split}
\end{equation*}\]</span></p>
<p>i.e.&nbsp;we accept the proposal <span class="math inline">\(\tilde{x}\)</span> with probability <span class="math inline">\(\alpha\)</span> and reject it, thus sticking with our current iterate, with probability <span class="math inline">\(1 - \alpha\)</span>.</p>
</section>
<section id="what-we-need-from-a-model-logdensityproblems.jl" class="level2">
<h2 class="anchored" data-anchor-id="what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a></h2>
<p>There are a few things we need from the “target” / “model” / density that we want to sample from:</p>
<ol type="1">
<li>We need access to log-density <em>evaluations</em> <span class="math inline">\(\log \gamma(x)\)</span> so we can compute the acceptance ratio involving <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>We need access to log-density <em>gradients</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span> so we can compute the Leapfrog steps <span class="math inline">\(L_{\epsilon}(x, p)\)</span>.</li>
<li>We also need access to the “size” of the model so we can determine the size of <span class="math inline">\(M\)</span>.</li>
</ol>
<p>Luckily for us, there is a package called <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> which provides an interface for <em>exactly</em> this!</p>
<p>To demonstrate how one can implement the “<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface”<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> we will use a simple Gaussian model as an example:</p>
<div id="4" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblems</span>: LogDensityProblems;</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's define some type that represents the model.</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> IsotropicNormalModel{M<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"mean of the isotropic Gaussian"</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    mean<span class="op">::</span><span class="dt">M</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Specifies what input length the model expects.</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">dimension</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> <span class="fu">length</span>(model.mean)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Implementation of the log-density evaluation of the model.</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x<span class="op">::</span><span class="dt">AbstractVector{&lt;:Real}</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">-</span> <span class="fu">sum</span>(abs2, x <span class="op">.-</span> model.mean) <span class="op">/</span> <span class="fl">2</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This gives us all of the properties we want for our MALA sampler with the exception of the computation of the <em>gradient</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span>. There is the method <code>LogDensityProblems.logdensity_and_gradient</code> which should return a 2-tuple where the first entry is the evaluation of the logdensity <span class="math inline">\(\log \gamma(x)\)</span> and the second entry is the gradient <span class="math inline">\(\nabla \log \gamma(x)\)</span>.</p>
<p>There are two ways to “implement” this method: 1) we implement it by hand, which is feasible in the case of our <code>IsotropicNormalModel</code>, or b) we defer the implementation of this to a automatic differentiation backend.</p>
<p>To implement it by hand we can simply do</p>
<div id="6" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl that first-order, i.e. gradient information, is available.</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{1}</span>()</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Implement `logdensity_and_gradient`.</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    logγ_x <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="op">-</span>x <span class="op">.*</span> (x <span class="op">-</span> model.mean)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> logγ_x, ∇logγ_x</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s just try it out:</p>
<div id="8" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate the problem.</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> <span class="fu">IsotropicNormalModel</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.])</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create some example input that we can test on.</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>x_example <span class="op">=</span> <span class="fu">randn</span>(LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate!</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-24.91677396873884</code></pre>
</div>
</div>
<p>To defer it to an automatic differentiation backend, we can do</p>
<div id="10" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl we only have access to 0-th order information.</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{0}</span>()</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Use `LogDensityProblemsAD`'s `ADgradient` in combination with some AD backend to implement `logdensity_and_gradient`.</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblemsAD</span>, <span class="bu">ADTypes</span>, <span class="bu">ForwardDiff</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>model_with_grad <span class="op">=</span> <span class="fu">ADgradient</span>(<span class="fu">AutoForwardDiff</span>(), model)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model_with_grad, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-24.91677396873884</code></pre>
</div>
</div>
<p>We’ll continue with the second approach in this tutorial since this is typically what one does in practice, because there are better hobbies to spend time on than deriving gradients by hand.</p>
<p>At this point, one might wonder how we’re going to tie this back to Turing.jl in the end. Effectively, when working with inference methods that only require log-density evaluations and / or higher-order information of the log-density, Turing.jl actually converts the user-provided <code>Model</code> into an object implementing the above methods for <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>. As a result, most samplers provided by Turing.jl are actually implemented to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, enabling their use both <em>within</em> Turing.jl and <em>outside</em> of Turing.jl! Morever, there exists similar conversions for Stan through BridgeStan and Stan<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, which means that a sampler supporting the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface can easily be used on both Turing.jl <em>and</em> Stan models (in addition to user-provided models, as our <code>IsotropicNormalModel</code> above)!</p>
<p>Anyways, let’s move on to actually implementing the sampler.</p>
</section>
<section id="implementing-mala-in-abstractmcmc.jl" class="level2">
<h2 class="anchored" data-anchor-id="implementing-mala-in-abstractmcmc.jl">Implementing MALA in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a></h2>
<p>Now that we’ve established that a model implementing the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface provides us with all the information we need from <span class="math inline">\(\log \gamma(x)\)</span>, we can address the question: given an object that implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, how can we define a sampler for it?</p>
<p>We’re going to do this by making our sampler a sub-type of <code>AbstractMCMC.AbstractSampler</code> in addition to implementing a few methods from <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>. Why? Because it gets us <em>a lot</em> of functionality for free, as we will see later.</p>
<p>Moreover, <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> provides a very natural interface for MCMC algorithms.</p>
<p>First, we’ll define our <code>MALA</code> type</p>
<div id="12" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">AbstractMCMC</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALA{T,A} <span class="op">&lt;:</span><span class="dt"> AbstractMCMC.AbstractSampler</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"stepsize used in the leapfrog step"</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    ϵ_init<span class="op">::</span><span class="dt">T</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"covariance matrix used for the momentum"</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    M_init<span class="op">::</span><span class="dt">A</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notice how we’ve added the suffix <code>_init</code> to both the stepsize and the covariance matrix. We’ve done this because a <code>AbstractMCMC.AbstractSampler</code> should be <em>immutable</em>. Of course there might be many scenarios where we want to allow something like the stepsize and / or the covariance matrix to vary between iterations, e.g.&nbsp;during the burn-in / adaptation phase of the sampling process we might want to adjust the parameters using statistics computed from these initial iterations. But information which can change between iterations <em>should not go in the sampler itself</em>! Instead, this information should go in the sampler <em>state</em>.</p>
<p>The sampler state should at the very least contain all the necessary information to perform the next MCMC iteration, but usually contains further information, e.g.&nbsp;quantities and statistics useful for evaluating whether the sampler has converged.</p>
<p>We will use the following sampler state for our <code>MALA</code> sampler:</p>
<div id="14" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALAState{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This might seem overly redundant: we’re defining a type <code>MALAState</code> and it only contains a simple vector of reals. In this particular case we indeed could have dropped this and simply used a <code>AbstractVector{&lt;:Real}</code> as our sampler state, but typically, as we will see later, one wants to include other quantities in the sampler state. For example, if we also wanted to adapt the parameters of our <code>MALA</code>, e.g.&nbsp;alter the stepsize depending on acceptance rates, in which case we should also put <code>ϵ</code> in the state, but for now we’ll keep things simple.</p>
<p>Moreover, we also want a <em>sample</em> type, which is a type meant for “public consumption”, i.e.&nbsp;the end-user. This is generally going to contain a subset of the information present in the state. But in such a simple scenario as this, we similarly only have a <code>AbstractVector{&lt;:Real}</code>:</p>
<div id="16" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALASample{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We currently have three things:</p>
<ol type="1">
<li>A <code>AbstractMCMC.AbstractSampler</code> implementation called <code>MALA</code>.</li>
<li>A state <code>MALAState</code> for our sampler <code>MALA</code>.</li>
<li>A sample <code>MALASample</code> for our sampler <code>MALA</code>.</li>
</ol>
<p>That means that we’re ready to implement the only thing that really matters: <code>AbstractMCMC.step</code>.</p>
<p><code>AbstractMCMC.step</code> defines the MCMC iteration of our <code>MALA</code> given the current <code>MALAState</code>. Specifically, the signature of the function is as follows:</p>
<div id="18" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The RNG to ensure reproducibility.</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The model that defines our target.</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.AbstractModel</span>,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The sampler for which we're taking a `step`.</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">AbstractMCMC.AbstractSampler</span>,</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The current sampler `state`.</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    state;</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Additional keyword arguments that we may or may not need.</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Moreover, there is a specific <code>AbstractMCMC.AbstractModel</code> which is used to indicate that the model that is provided implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface: <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Since, as we discussed earlier, in our case we’re indeed going to work with types that support the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, we’ll define <code>AbstractMCMC.step</code> for such a <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Note that <code>AbstractMCMC.LogDensityModel</code> has no other purpose; it has a single field called <code>logdensity</code>, and it does nothing else. But by wrapping the model in <code>AbstractMCMC.LogDensityModel</code>, it allows samplers that want to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> to define their <code>AbstractMCMC.step</code> on this type without running into method ambiguities.</p>
<p>All in all, that means that the signature for our <code>AbstractMCMC.step</code> is going to be the following:</p>
<div id="20" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># `LogDensityModel` so we know we're working with LogDensityProblems.jl model.</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler.</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler state.</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Great! Now let’s actually implement the full <code>AbstractMCMC.step</code> for our <code>MALA</code>.</p>
<p>Let’s remind ourselves what we’re going to do:</p>
<ol type="1">
<li>Sample a new momentum <span class="math inline">\(p\)</span>.</li>
<li>Compute the log-density of the extended target <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>Take a single leapfrog step <span class="math inline">\((\tilde{x}, \tilde{p}) = L_{\epsilon}(x, p)\)</span>.</li>
<li>Accept or reject the proposed <span class="math inline">\((\tilde{x}, \tilde{p})\)</span>.</li>
</ol>
<p>All in all, this results in the following:</p>
<div id="22" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>: Random</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Distributions</span>  <span class="co"># so we get the `MvNormal`</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the wrapped model which implements LogDensityProblems.jl.</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just extract the sampler parameters to make our lives easier.</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    ϵ <span class="op">=</span> sampler.ϵ_init</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    M <span class="op">=</span> sampler.M_init</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the current parameters.</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> state.x</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sample the momentum.</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>    p_dist <span class="op">=</span> <span class="fu">MvNormal</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)), M)</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> <span class="fu">rand</span>(rng, p_dist)</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Propose using a single leapfrog step.</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>    x̃, p̃ <span class="op">=</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Accept or reject proposal.</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>    logp <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p)</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>    logp̃ <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x̃) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p̃)</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>    logα <span class="op">=</span> logp̃ <span class="op">-</span> logp</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>    state_new <span class="op">=</span> <span class="cf">if</span> <span class="fu">log</span>(<span class="fu">rand</span>(rng)) <span class="op">&lt;</span> logα</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Accept.</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x̃)</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Reject.</span></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x)</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return the "sample" and the sampler state.</span></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(state_new.x), state_new</span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Fairly straight-forward.</p>
<p>Of course, we haven’t defined the <code>leapfrog_step</code> method yet, so let’s do that:</p>
<div id="24" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p` using "position" `x`.</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x))</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    p1 <span class="op">=</span> p <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update the "position" `x` using momentum `p1`.</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    x̃ <span class="op">=</span> x <span class="op">+</span> ϵ <span class="op">.*</span> (M <span class="op">\</span> p1)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p1` using position `x̃`</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x̃ <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x̃))</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    p2 <span class="op">=</span> p1 <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x̃</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Flip momentum `p2`.</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    p̃ <span class="op">=</span> <span class="op">-</span>p2</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x̃, p̃</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>leapfrog_step (generic function with 1 method)</code></pre>
</div>
</div>
<p>With all of this, we’re technically ready to sample!</p>
<div id="26" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>, <span class="bu">LinearAlgebra</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>rng <span class="op">=</span> <span class="bu">Random</span>.<span class="fu">default_rng</span>()</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>sampler <span class="op">=</span> <span class="fu">MALA</span>(<span class="fl">1</span>, I)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>state <span class="op">=</span> <span class="fu">MALAState</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)))</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>x_next, state_next <span class="op">=</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    rng,</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    AbstractMCMC.<span class="fu">LogDensityModel</span>(model),</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    state</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>(MALASample{Vector{Float64}}([0.0, 0.0, 0.0]), MALAState{Vector{Float64}}([0.0, 0.0, 0.0]))</code></pre>
</div>
</div>
<p>Great, it works!</p>
<p>And I promised we would get quite some functionality for free if we implemented <code>AbstractMCMC.step</code>, and so we can now simply call <code>sample</code> to perform standard MCMC sampling:</p>
<div id="28" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform 1000 iterations with our `MALA` sampler.</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; initial_state<span class="op">=</span>state, progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Concatenate into a matrix.</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000 Matrix{Float64}:
 -1.90448   -2.52876  -4.02732   -3.18238   …  -6.15022   -5.34405  -5.79184
 -0.272813  -0.31244   0.497373   0.963451     -0.438806  -1.88153  -1.79085
  2.75926    5.47982   6.09614    6.41727       6.62632    5.88143   5.58418</code></pre>
</div>
</div>
<div id="30" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the marginal means and standard deviations.</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -4.989      0.996298
 -0.0241535  1.00131
  4.98619    1.00431</code></pre>
</div>
</div>
<p>Let’s visualize the samples</p>
<div id="32" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">StatsPlots</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">transpose</span>(samples_matrix[<span class="op">:</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">:</span><span class="kw">end</span>]), alpha<span class="op">=</span><span class="fl">0.5</span>, legend<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<!--?xml version="1.0" encoding="utf-8"?-->
<svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" width="672" height="480" viewbox="0 0 2688 1920">
<defs>
  <clippath id="clip970">
    <rect x="0" y="0" width="2688" height="1920"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip970)" d="M0 1920 L2688 1920 L2688 0 L0 0  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip971">
    <rect x="537" y="0" width="1883" height="1883"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip970)" d="M151.747 1800.78 L2640.76 1800.78 L2640.76 47.2441 L151.747 47.2441  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip972">
    <rect x="151" y="47" width="2490" height="1755"></rect>
  </clippath>
</defs>
<polyline clip-path="url(#clip972)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="219.84,1800.78 219.84,47.2441 "></polyline>
<polyline clip-path="url(#clip972)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="807.458,1800.78 807.458,47.2441 "></polyline>
<polyline clip-path="url(#clip972)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1395.08,1800.78 1395.08,47.2441 "></polyline>
<polyline clip-path="url(#clip972)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1982.69,1800.78 1982.69,47.2441 "></polyline>
<polyline clip-path="url(#clip972)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="2570.31,1800.78 2570.31,47.2441 "></polyline>
<polyline clip-path="url(#clip972)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,1533.94 2640.76,1533.94 "></polyline>
<polyline clip-path="url(#clip972)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,1225.74 2640.76,1225.74 "></polyline>
<polyline clip-path="url(#clip972)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,917.54 2640.76,917.54 "></polyline>
<polyline clip-path="url(#clip972)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,609.342 2640.76,609.342 "></polyline>
<polyline clip-path="url(#clip972)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,301.145 2640.76,301.145 "></polyline>
<polyline clip-path="url(#clip970)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1800.78 2640.76,1800.78 "></polyline>
<polyline clip-path="url(#clip970)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="219.84,1800.78 219.84,1781.88 "></polyline>
<polyline clip-path="url(#clip970)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="807.458,1800.78 807.458,1781.88 "></polyline>
<polyline clip-path="url(#clip970)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1395.08,1800.78 1395.08,1781.88 "></polyline>
<polyline clip-path="url(#clip970)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1982.69,1800.78 1982.69,1781.88 "></polyline>
<polyline clip-path="url(#clip970)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="2570.31,1800.78 2570.31,1781.88 "></polyline>
<path clip-path="url(#clip970)" d="M219.84 1834 Q216.229 1834 214.4 1837.57 Q212.595 1841.11 212.595 1848.24 Q212.595 1855.34 214.4 1858.91 Q216.229 1862.45 219.84 1862.45 Q223.474 1862.45 225.28 1858.91 Q227.108 1855.34 227.108 1848.24 Q227.108 1841.11 225.28 1837.57 Q223.474 1834 219.84 1834 M219.84 1830.3 Q225.65 1830.3 228.706 1834.9 Q231.784 1839.49 231.784 1848.24 Q231.784 1856.96 228.706 1861.57 Q225.65 1866.15 219.84 1866.15 Q214.03 1866.15 210.951 1861.57 Q207.896 1856.96 207.896 1848.24 Q207.896 1839.49 210.951 1834.9 Q214.03 1830.3 219.84 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip970)" d="M771.15 1861.55 L787.47 1861.55 L787.47 1865.48 L765.525 1865.48 L765.525 1861.55 Q768.187 1858.79 772.771 1854.16 Q777.377 1849.51 778.558 1848.17 Q780.803 1845.65 781.683 1843.91 Q782.585 1842.15 782.585 1840.46 Q782.585 1837.71 780.641 1835.97 Q778.72 1834.23 775.618 1834.23 Q773.419 1834.23 770.965 1835 Q768.535 1835.76 765.757 1837.31 L765.757 1832.59 Q768.581 1831.46 771.035 1830.88 Q773.488 1830.3 775.525 1830.3 Q780.896 1830.3 784.09 1832.98 Q787.285 1835.67 787.285 1840.16 Q787.285 1842.29 786.474 1844.21 Q785.687 1846.11 783.581 1848.7 Q783.002 1849.37 779.9 1852.59 Q776.798 1855.78 771.15 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip970)" d="M797.331 1830.92 L815.687 1830.92 L815.687 1834.86 L801.613 1834.86 L801.613 1843.33 Q802.632 1842.98 803.65 1842.82 Q804.669 1842.64 805.687 1842.64 Q811.474 1842.64 814.854 1845.81 Q818.233 1848.98 818.233 1854.4 Q818.233 1859.97 814.761 1863.08 Q811.289 1866.15 804.97 1866.15 Q802.794 1866.15 800.525 1865.78 Q798.28 1865.41 795.872 1864.67 L795.872 1859.97 Q797.956 1861.11 800.178 1861.66 Q802.4 1862.22 804.877 1862.22 Q808.882 1862.22 811.22 1860.11 Q813.558 1858.01 813.558 1854.4 Q813.558 1850.78 811.22 1848.68 Q808.882 1846.57 804.877 1846.57 Q803.002 1846.57 801.127 1846.99 Q799.275 1847.4 797.331 1848.28 L797.331 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip970)" d="M837.446 1834 Q833.835 1834 832.007 1837.57 Q830.201 1841.11 830.201 1848.24 Q830.201 1855.34 832.007 1858.91 Q833.835 1862.45 837.446 1862.45 Q841.081 1862.45 842.886 1858.91 Q844.715 1855.34 844.715 1848.24 Q844.715 1841.11 842.886 1837.57 Q841.081 1834 837.446 1834 M837.446 1830.3 Q843.256 1830.3 846.312 1834.9 Q849.391 1839.49 849.391 1848.24 Q849.391 1856.96 846.312 1861.57 Q843.256 1866.15 837.446 1866.15 Q831.636 1866.15 828.557 1861.57 Q825.502 1856.96 825.502 1848.24 Q825.502 1839.49 828.557 1834.9 Q831.636 1830.3 837.446 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip970)" d="M1354.69 1830.92 L1373.05 1830.92 L1373.05 1834.86 L1358.98 1834.86 L1358.98 1843.33 Q1360 1842.98 1361.01 1842.82 Q1362.03 1842.64 1363.05 1842.64 Q1368.84 1842.64 1372.22 1845.81 Q1375.6 1848.98 1375.6 1854.4 Q1375.6 1859.97 1372.12 1863.08 Q1368.65 1866.15 1362.33 1866.15 Q1360.16 1866.15 1357.89 1865.78 Q1355.64 1865.41 1353.24 1864.67 L1353.24 1859.97 Q1355.32 1861.11 1357.54 1861.66 Q1359.76 1862.22 1362.24 1862.22 Q1366.25 1862.22 1368.58 1860.11 Q1370.92 1858.01 1370.92 1854.4 Q1370.92 1850.78 1368.58 1848.68 Q1366.25 1846.57 1362.24 1846.57 Q1360.37 1846.57 1358.49 1846.99 Q1356.64 1847.4 1354.69 1848.28 L1354.69 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip970)" d="M1394.81 1834 Q1391.2 1834 1389.37 1837.57 Q1387.56 1841.11 1387.56 1848.24 Q1387.56 1855.34 1389.37 1858.91 Q1391.2 1862.45 1394.81 1862.45 Q1398.44 1862.45 1400.25 1858.91 Q1402.08 1855.34 1402.08 1848.24 Q1402.08 1841.11 1400.25 1837.57 Q1398.44 1834 1394.81 1834 M1394.81 1830.3 Q1400.62 1830.3 1403.68 1834.9 Q1406.75 1839.49 1406.75 1848.24 Q1406.75 1856.96 1403.68 1861.57 Q1400.62 1866.15 1394.81 1866.15 Q1389 1866.15 1385.92 1861.57 Q1382.87 1856.96 1382.87 1848.24 Q1382.87 1839.49 1385.92 1834.9 Q1389 1830.3 1394.81 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip970)" d="M1424.97 1834 Q1421.36 1834 1419.53 1837.57 Q1417.73 1841.11 1417.73 1848.24 Q1417.73 1855.34 1419.53 1858.91 Q1421.36 1862.45 1424.97 1862.45 Q1428.61 1862.45 1430.41 1858.91 Q1432.24 1855.34 1432.24 1848.24 Q1432.24 1841.11 1430.41 1837.57 Q1428.61 1834 1424.97 1834 M1424.97 1830.3 Q1430.78 1830.3 1433.84 1834.9 Q1436.92 1839.49 1436.92 1848.24 Q1436.92 1856.96 1433.84 1861.57 Q1430.78 1866.15 1424.97 1866.15 Q1419.16 1866.15 1416.08 1861.57 Q1413.03 1856.96 1413.03 1848.24 Q1413.03 1839.49 1416.08 1834.9 Q1419.16 1830.3 1424.97 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip970)" d="M1940.97 1830.92 L1963.19 1830.92 L1963.19 1832.91 L1950.65 1865.48 L1945.76 1865.48 L1957.57 1834.86 L1940.97 1834.86 L1940.97 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip970)" d="M1972.36 1830.92 L1990.71 1830.92 L1990.71 1834.86 L1976.64 1834.86 L1976.64 1843.33 Q1977.66 1842.98 1978.68 1842.82 Q1979.7 1842.64 1980.72 1842.64 Q1986.5 1842.64 1989.88 1845.81 Q1993.26 1848.98 1993.26 1854.4 Q1993.26 1859.97 1989.79 1863.08 Q1986.32 1866.15 1980 1866.15 Q1977.82 1866.15 1975.55 1865.78 Q1973.31 1865.41 1970.9 1864.67 L1970.9 1859.97 Q1972.98 1861.11 1975.21 1861.66 Q1977.43 1862.22 1979.9 1862.22 Q1983.91 1862.22 1986.25 1860.11 Q1988.59 1858.01 1988.59 1854.4 Q1988.59 1850.78 1986.25 1848.68 Q1983.91 1846.57 1979.9 1846.57 Q1978.03 1846.57 1976.15 1846.99 Q1974.3 1847.4 1972.36 1848.28 L1972.36 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip970)" d="M2012.47 1834 Q2008.86 1834 2007.03 1837.57 Q2005.23 1841.11 2005.23 1848.24 Q2005.23 1855.34 2007.03 1858.91 Q2008.86 1862.45 2012.47 1862.45 Q2016.11 1862.45 2017.91 1858.91 Q2019.74 1855.34 2019.74 1848.24 Q2019.74 1841.11 2017.91 1837.57 Q2016.11 1834 2012.47 1834 M2012.47 1830.3 Q2018.28 1830.3 2021.34 1834.9 Q2024.42 1839.49 2024.42 1848.24 Q2024.42 1856.96 2021.34 1861.57 Q2018.28 1866.15 2012.47 1866.15 Q2006.66 1866.15 2003.59 1861.57 Q2000.53 1856.96 2000.53 1848.24 Q2000.53 1839.49 2003.59 1834.9 Q2006.66 1830.3 2012.47 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip970)" d="M2514.84 1861.55 L2522.48 1861.55 L2522.48 1835.18 L2514.17 1836.85 L2514.17 1832.59 L2522.43 1830.92 L2527.11 1830.92 L2527.11 1861.55 L2534.75 1861.55 L2534.75 1865.48 L2514.84 1865.48 L2514.84 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip970)" d="M2554.19 1834 Q2550.58 1834 2548.75 1837.57 Q2546.94 1841.11 2546.94 1848.24 Q2546.94 1855.34 2548.75 1858.91 Q2550.58 1862.45 2554.19 1862.45 Q2557.82 1862.45 2559.63 1858.91 Q2561.46 1855.34 2561.46 1848.24 Q2561.46 1841.11 2559.63 1837.57 Q2557.82 1834 2554.19 1834 M2554.19 1830.3 Q2560 1830.3 2563.06 1834.9 Q2566.13 1839.49 2566.13 1848.24 Q2566.13 1856.96 2563.06 1861.57 Q2560 1866.15 2554.19 1866.15 Q2548.38 1866.15 2545.3 1861.57 Q2542.25 1856.96 2542.25 1848.24 Q2542.25 1839.49 2545.3 1834.9 Q2548.38 1830.3 2554.19 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip970)" d="M2584.35 1834 Q2580.74 1834 2578.91 1837.57 Q2577.11 1841.11 2577.11 1848.24 Q2577.11 1855.34 2578.91 1858.91 Q2580.74 1862.45 2584.35 1862.45 Q2587.99 1862.45 2589.79 1858.91 Q2591.62 1855.34 2591.62 1848.24 Q2591.62 1841.11 2589.79 1837.57 Q2587.99 1834 2584.35 1834 M2584.35 1830.3 Q2590.16 1830.3 2593.22 1834.9 Q2596.3 1839.49 2596.3 1848.24 Q2596.3 1856.96 2593.22 1861.57 Q2590.16 1866.15 2584.35 1866.15 Q2578.54 1866.15 2575.46 1861.57 Q2572.41 1856.96 2572.41 1848.24 Q2572.41 1839.49 2575.46 1834.9 Q2578.54 1830.3 2584.35 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip970)" d="M2614.51 1834 Q2610.9 1834 2609.07 1837.57 Q2607.27 1841.11 2607.27 1848.24 Q2607.27 1855.34 2609.07 1858.91 Q2610.9 1862.45 2614.51 1862.45 Q2618.15 1862.45 2619.95 1858.91 Q2621.78 1855.34 2621.78 1848.24 Q2621.78 1841.11 2619.95 1837.57 Q2618.15 1834 2614.51 1834 M2614.51 1830.3 Q2620.32 1830.3 2623.38 1834.9 Q2626.46 1839.49 2626.46 1848.24 Q2626.46 1856.96 2623.38 1861.57 Q2620.32 1866.15 2614.51 1866.15 Q2608.7 1866.15 2605.62 1861.57 Q2602.57 1856.96 2602.57 1848.24 Q2602.57 1839.49 2605.62 1834.9 Q2608.7 1830.3 2614.51 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip970)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1800.78 151.747,47.2441 "></polyline>
<polyline clip-path="url(#clip970)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1533.94 170.644,1533.94 "></polyline>
<polyline clip-path="url(#clip970)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1225.74 170.644,1225.74 "></polyline>
<polyline clip-path="url(#clip970)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,917.54 170.644,917.54 "></polyline>
<polyline clip-path="url(#clip970)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,609.342 170.644,609.342 "></polyline>
<polyline clip-path="url(#clip970)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,301.145 170.644,301.145 "></polyline>
<path clip-path="url(#clip970)" d="M49.5521 1534.39 L79.2279 1534.39 L79.2279 1538.32 L49.5521 1538.32 L49.5521 1534.39 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip970)" d="M99.8991 1532.07 Q96.7509 1532.07 94.8991 1534.22 Q93.0704 1536.38 93.0704 1540.13 Q93.0704 1543.85 94.8991 1546.03 Q96.7509 1548.18 99.8991 1548.18 Q103.047 1548.18 104.876 1546.03 Q106.728 1543.85 106.728 1540.13 Q106.728 1536.38 104.876 1534.22 Q103.047 1532.07 99.8991 1532.07 M109.181 1517.42 L109.181 1521.68 Q107.422 1520.85 105.617 1520.41 Q103.834 1519.97 102.075 1519.97 Q97.4454 1519.97 94.9917 1523.09 Q92.5612 1526.22 92.2139 1532.53 Q93.5797 1530.52 95.6398 1529.46 Q97.7 1528.37 100.177 1528.37 Q105.385 1528.37 108.394 1531.54 Q111.427 1534.69 111.427 1540.13 Q111.427 1545.45 108.279 1548.67 Q105.131 1551.89 99.8991 1551.89 Q93.9037 1551.89 90.7325 1547.3 Q87.5612 1542.7 87.5612 1533.97 Q87.5612 1525.78 91.45 1520.91 Q95.3389 1516.03 101.89 1516.03 Q103.649 1516.03 105.431 1516.38 Q107.237 1516.72 109.181 1517.42 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip970)" d="M50.3623 1226.19 L80.0381 1226.19 L80.0381 1230.12 L50.3623 1230.12 L50.3623 1226.19 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip970)" d="M104.297 1224.38 Q107.654 1225.1 109.529 1227.37 Q111.427 1229.64 111.427 1232.97 Q111.427 1238.09 107.908 1240.89 Q104.39 1243.69 97.9083 1243.69 Q95.7324 1243.69 93.4176 1243.25 Q91.126 1242.83 88.6723 1241.98 L88.6723 1237.46 Q90.6167 1238.6 92.9315 1239.18 Q95.2463 1239.75 97.7695 1239.75 Q102.168 1239.75 104.459 1238.02 Q106.774 1236.28 106.774 1232.97 Q106.774 1229.92 104.621 1228.2 Q102.492 1226.47 98.6722 1226.47 L94.6445 1226.47 L94.6445 1222.62 L98.8574 1222.62 Q102.306 1222.62 104.135 1221.26 Q105.964 1219.87 105.964 1217.28 Q105.964 1214.62 104.066 1213.2 Q102.191 1211.77 98.6722 1211.77 Q96.7509 1211.77 94.5519 1212.18 Q92.3528 1212.6 89.7139 1213.48 L89.7139 1209.31 Q92.376 1208.57 94.6908 1208.2 Q97.0287 1207.83 99.0889 1207.83 Q104.413 1207.83 107.515 1210.26 Q110.617 1212.67 110.617 1216.79 Q110.617 1219.66 108.973 1221.65 Q107.33 1223.62 104.297 1224.38 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip970)" d="M99.4824 903.339 Q95.8713 903.339 94.0426 906.903 Q92.2371 910.445 92.2371 917.575 Q92.2371 924.681 94.0426 928.246 Q95.8713 931.788 99.4824 931.788 Q103.117 931.788 104.922 928.246 Q106.751 924.681 106.751 917.575 Q106.751 910.445 104.922 906.903 Q103.117 903.339 99.4824 903.339 M99.4824 899.635 Q105.293 899.635 108.348 904.241 Q111.427 908.825 111.427 917.575 Q111.427 926.301 108.348 930.908 Q105.293 935.491 99.4824 935.491 Q93.6723 935.491 90.5936 930.908 Q87.538 926.301 87.538 917.575 Q87.538 908.825 90.5936 904.241 Q93.6723 899.635 99.4824 899.635 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip970)" d="M104.297 607.988 Q107.654 608.706 109.529 610.974 Q111.427 613.243 111.427 616.576 Q111.427 621.692 107.908 624.493 Q104.39 627.294 97.9083 627.294 Q95.7324 627.294 93.4176 626.854 Q91.126 626.437 88.6723 625.581 L88.6723 621.067 Q90.6167 622.201 92.9315 622.78 Q95.2463 623.358 97.7695 623.358 Q102.168 623.358 104.459 621.622 Q106.774 619.886 106.774 616.576 Q106.774 613.521 104.621 611.808 Q102.492 610.071 98.6722 610.071 L94.6445 610.071 L94.6445 606.229 L98.8574 606.229 Q102.306 606.229 104.135 604.863 Q105.964 603.474 105.964 600.882 Q105.964 598.22 104.066 596.808 Q102.191 595.372 98.6722 595.372 Q96.7509 595.372 94.5519 595.789 Q92.3528 596.206 89.7139 597.085 L89.7139 592.919 Q92.376 592.178 94.6908 591.808 Q97.0287 591.437 99.0889 591.437 Q104.413 591.437 107.515 593.868 Q110.617 596.275 110.617 600.396 Q110.617 603.266 108.973 605.257 Q107.33 607.224 104.297 607.988 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip970)" d="M99.8991 299.281 Q96.7509 299.281 94.8991 301.434 Q93.0704 303.587 93.0704 307.337 Q93.0704 311.064 94.8991 313.239 Q96.7509 315.392 99.8991 315.392 Q103.047 315.392 104.876 313.239 Q106.728 311.064 106.728 307.337 Q106.728 303.587 104.876 301.434 Q103.047 299.281 99.8991 299.281 M109.181 284.629 L109.181 288.888 Q107.422 288.054 105.617 287.615 Q103.834 287.175 102.075 287.175 Q97.4454 287.175 94.9917 290.3 Q92.5612 293.425 92.2139 299.744 Q93.5797 297.73 95.6398 296.665 Q97.7 295.578 100.177 295.578 Q105.385 295.578 108.394 298.749 Q111.427 301.897 111.427 307.337 Q111.427 312.661 108.279 315.878 Q105.131 319.096 99.8991 319.096 Q93.9037 319.096 90.7325 314.513 Q87.5612 309.906 87.5612 301.179 Q87.5612 292.985 91.45 288.124 Q95.3389 283.24 101.89 283.24 Q103.649 283.24 105.431 283.587 Q107.237 283.934 109.181 284.629 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip972)" style="stroke:#009af9; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,1113.19 224.541,1380.54 226.891,1346.76 229.242,1238.49 231.592,1402.29 233.943,1474.98 236.293,1402.64 238.644,1456.24 240.994,1348.52 243.345,1418.85 245.695,1461.63 248.046,1366.85 250.396,1399.24 252.747,1232.14 255.097,1371.53 257.448,1294.84 259.798,1519.6 262.148,1312.89 264.499,1370.35 266.849,1410.99 269.2,1458.18 271.55,1523.63 273.901,1587.56 276.251,1388.32 278.602,1450.35 280.952,1520.18 283.303,1222.26 285.653,1441.13 288.004,1484.35 290.354,1489.92 292.705,1559.03 295.055,1367.53 297.406,1593.4 299.756,1363.34 302.107,1289.28 304.457,1536.64 306.807,1527.58 309.158,1417.26 311.508,1328.03 313.859,1433.87 316.209,1376.77 318.56,1534.99 320.91,1332.66 323.261,1390.25 325.611,1508.28 327.962,1551.63 330.312,1576.46 332.663,1434.29 335.013,1642.36 337.364,1418.35 339.714,1397.37 342.065,1405.94 344.415,1239.81 346.765,1520.41 349.116,1312.75 351.466,1292.44 353.817,1255.7 356.167,1380.37 358.518,1605.87 360.868,1429.42 363.219,1168.34 365.569,1295.29 367.92,1513.18 370.27,1571.56 372.621,1430.02 374.971,1406.17 377.322,1451.4 379.672,1463.72 382.023,1394.59 384.373,1389.3 386.724,1529.71 389.074,1393.41 391.424,1446.47 393.775,1568.38 396.125,1376.16 398.476,1275.89 400.826,1307.48 403.177,1308.22 405.527,1527.6 407.878,1564.02 410.228,1366.8 412.579,1451.11 414.929,1353.43 417.28,1529.04 419.63,1365.04 421.981,1602.85 424.331,1291.22 426.682,1500.16 429.032,1439.44 431.382,1553.64 433.733,1522.58 436.083,1503.99 438.434,1325.83 440.784,1408.91 443.135,1503.23 445.485,1457.53 447.836,1271.33 450.186,1414.73 452.537,1392.71 454.887,1378.56 457.238,1517.56 459.588,1526.61 461.939,1446.36 464.289,1429.07 466.64,1510.04 468.99,1265.13 471.341,1206.24 473.691,1287.91 476.041,1430.33 478.392,1542.83 480.742,1360.39 483.093,1643.34 485.443,1436.98 487.794,1410.89 490.144,1668.06 492.495,1521.99 494.845,1430.18 497.196,1310.72 499.546,1503.6 501.897,1289.06 504.247,1618.04 506.598,1276.54 508.948,1541.15 511.299,1441.16 513.649,1498.63 515.999,1453.83 518.35,1526.68 520.7,1467.08 523.051,1526.24 525.401,1306.49 527.752,1345.98 530.102,1477.78 532.453,1369.83 534.803,1507.62 537.154,1367.84 539.504,1280.26 541.855,1391.23 544.205,1446.69 546.556,1484.12 548.906,1183.68 551.257,1565.8 553.607,1612.79 555.958,1460.84 558.308,1428.23 560.658,1435.89 563.009,1413.49 565.359,1420.76 567.71,1383.61 570.06,1444.7 572.411,1525.7 574.761,1517.57 577.112,1423.65 579.462,1570.5 581.813,1670.8 584.163,1556.72 586.514,1372.94 588.864,1595.3 591.215,1420.76 593.565,1297.52 595.916,1435.17 598.266,1484 600.616,1540.05 602.967,1535 605.317,1403.61 607.668,1507.9 610.018,1168.18 612.369,1317.28 614.719,1362.48 617.07,1615.18 619.42,1423.57 621.771,1440.37 624.121,1390.15 626.472,1184.69 628.822,1373.95 631.173,1498.54 633.523,1457.19 635.874,1455.56 638.224,1367.41 640.575,1238.51 642.925,1436.02 645.275,1533 647.626,1511.31 649.976,1620.41 652.327,1422.48 654.677,1335.5 657.028,1333.39 659.378,1505.53 661.729,1257.18 664.079,1335.73 666.43,1497.63 668.78,1544.75 671.131,1390.58 673.481,1519.43 675.832,1260.62 678.182,1387.71 680.533,1335.34 682.883,1535.76 685.233,1296.51 687.584,1342.41 689.934,1581.71 692.285,1445.17 694.635,1359.94 696.986,1265.01 699.336,1302.1 701.687,1412.81 704.037,1443.73 706.388,1512.58 708.738,1590.6 711.089,1424.4 713.439,1418.54 715.79,1451.04 718.14,1212.15 720.491,1435.95 722.841,1256.89 725.192,1298.42 727.542,1364.56 729.892,1428.16 732.243,1282.3 734.593,1399.95 736.944,1254.77 739.294,1365.16 741.645,1482.08 743.995,1438.58 746.346,1543.06 748.696,1302.45 751.047,1486.37 753.397,1457.54 755.748,1568.15 758.098,1613.8 760.449,1364.02 762.799,1511.81 765.15,1428.84 767.5,1334.07 769.85,1432.97 772.201,1423.08 774.551,1301.76 776.902,1419.54 779.252,1239.29 781.603,1368.15 783.953,1587.75 786.304,1468.84 788.654,1240.16 791.005,1390.76 793.355,1296.65 795.706,1490.07 798.056,1323.98 800.407,1262.88 802.757,1298.24 805.108,1453.74 807.458,1498.1 809.809,1268.48 812.159,1597.24 814.509,1590.53 816.86,1472 819.21,1418.51 821.561,1378.8 823.911,1509.27 826.262,1392.53 828.612,1434.87 830.963,1463.28 833.313,1319.86 835.664,1480.58 838.014,1362.97 840.365,1660.29 842.715,1427.25 845.066,1203.15 847.416,1397.04 849.767,1358.68 852.117,1385.31 854.467,1462.7 856.818,1314.54 859.168,1479.49 861.519,1378.4 863.869,1463.65 866.22,1488.72 868.57,1358.36 870.921,1584.11 873.271,1354.9 875.622,1346.9 877.972,1532.12 880.323,1494.34 882.673,1349.38 885.024,1252 887.374,1313.19 889.725,1494.15 892.075,1447.31 894.426,1311.85 896.776,1463.13 899.126,1357.21 901.477,1414.92 903.827,1221.3 906.178,1554.13 908.528,1646.87 910.879,1502.03 913.229,1447.95 915.58,1545.84 917.93,1340.38 920.281,1586.36 922.631,1407.87 924.982,1357.73 927.332,1280.84 929.683,1405.34 932.033,1251 934.384,1478.18 936.734,1654.43 939.084,1717.78 941.435,1453.58 943.785,1172.16 946.136,1395.72 948.486,1504.78 950.837,1565.89 953.187,1436.2 955.538,1448.57 957.888,1472.34 960.239,1368.73 962.589,1385.69 964.94,1442.66 967.29,1314.32 969.641,1459.66 971.991,1362.04 974.342,1462.05 976.692,1454.45 979.043,1596.25 981.393,1636.03 983.743,1313.71 986.094,1321.09 988.444,1367.27 990.795,1423.54 993.145,1557.24 995.496,1380.41 997.846,1223.18 1000.2,1512.35 1002.55,1346.43 1004.9,1363.03 1007.25,1530.33 1009.6,1324.65 1011.95,1464.15 1014.3,1654.41 1016.65,1443.12 1019,1456.01 1021.35,1407.71 1023.7,1293.56 1026.05,1350.66 1028.4,1469.66 1030.75,1517.48 1033.1,1324.14 1035.45,1409.47 1037.8,1248.48 1040.15,1223.42 1042.51,1335.12 1044.86,1423.55 1047.21,1360.66 1049.56,1442.55 1051.91,1385.66 1054.26,1447.14 1056.61,1319.8 1058.96,1294.36 1061.31,1322.15 1063.66,1465.86 1066.01,1457.4 1068.36,1451.09 1070.71,1427.28 1073.06,1438.04 1075.41,1413.38 1077.76,1528.44 1080.11,1463.16 1082.46,1340.93 1084.81,1344.46 1087.16,1414.34 1089.51,1521.78 1091.87,1233.26 1094.22,1411.16 1096.57,1157.44 1098.92,1481.27 1101.27,1507.81 1103.62,1393.35 1105.97,1715.61 1108.32,1369.55 1110.67,1452.58 1113.02,1553.57 1115.37,1403.45 1117.72,1253.1 1120.07,1522.51 1122.42,1343.12 1124.77,1461.35 1127.12,1621.98 1129.47,1616.83 1131.82,1616.2 1134.17,1444.8 1136.52,1375.68 1138.87,1399.22 1141.23,1463.07 1143.58,1426.48 1145.93,1431.64 1148.28,1544.31 1150.63,1549.49 1152.98,1400.02 1155.33,1501.86 1157.68,1298.76 1160.03,1386.74 1162.38,1341.32 1164.73,1448.63 1167.08,1338.05 1169.43,1491.66 1171.78,1443.88 1174.13,1267.35 1176.48,1435.83 1178.83,1318.01 1181.18,1354.22 1183.53,1345.75 1185.88,1463.3 1188.23,1295.63 1190.59,1437.44 1192.94,1341.86 1195.29,1442.49 1197.64,1360.22 1199.99,1511.42 1202.34,1408.9 1204.69,1431.98 1207.04,1249.03 1209.39,1347.85 1211.74,1416.19 1214.09,1559 1216.44,1498.79 1218.79,1422.53 1221.14,1462.39 1223.49,1566.32 1225.84,1393.7 1228.19,1347.93 1230.54,1364.73 1232.89,1444.2 1235.24,1532.82 1237.59,1288.9 1239.94,1407.88 1242.3,1469.24 1244.65,1416.26 1247,1461.85 1249.35,1324.5 1251.7,1509.62 1254.05,1312.38 1256.4,1432.03 1258.75,1433.49 1261.1,1421.48 1263.45,1466.67 1265.8,1500.19 1268.15,1360.95 1270.5,1580.12 1272.85,1250.56 1275.2,1352.71 1277.55,1474.27 1279.9,1507.84 1282.25,1477.41 1284.6,1472.68 1286.95,1421.73 1289.3,1178.37 1291.66,1388.89 1294.01,1555 1296.36,1517.51 1298.71,1577 1301.06,1540.54 1303.41,1468.07 1305.76,1670.15 1308.11,1419.41 1310.46,1481.57 1312.81,1494.03 1315.16,1280.89 1317.51,1599.85 1319.86,1593.72 1322.21,1223.45 1324.56,1524.9 1326.91,1320.56 1329.26,1479.47 1331.61,1365.19 1333.96,1706.61 1336.31,1322.39 1338.66,1558.37 1341.02,1602.63 1343.37,1352.95 1345.72,1406.87 1348.07,1377.7 1350.42,1548.15 1352.77,1289.68 1355.12,1409.84 1357.47,1359.58 1359.82,1333.68 1362.17,1241.93 1364.52,1367.56 1366.87,1429.31 1369.22,1599.45 1371.57,1296.78 1373.92,1408.46 1376.27,1538.32 1378.62,1507.06 1380.97,1466.2 1383.32,1350.12 1385.67,1456.4 1388.02,1369.64 1390.38,1500.93 1392.73,1452.62 1395.08,1389.88 1397.43,1505.87 1399.78,1337.23 1402.13,1251.77 1404.48,1252.16 1406.83,1453.2 1409.18,1523.44 1411.53,1505.02 1413.88,1397.59 1416.23,1446.12 1418.58,1465.35 1420.93,1428.74 1423.28,1553.83 1425.63,1396.36 1427.98,1335.06 1430.33,1405.22 1432.68,1321.79 1435.03,1287.32 1437.38,1280.69 1439.74,1558.55 1442.09,1326.65 1444.44,1716.17 1446.79,1442.59 1449.14,1404.17 1451.49,1533.55 1453.84,1365.27 1456.19,1495.97 1458.54,1584.25 1460.89,1484.08 1463.24,1516.25 1465.59,1216.66 1467.94,1451.6 1470.29,1557.76 1472.64,1359.18 1474.99,1469.61 1477.34,1588.66 1479.69,1450.2 1482.04,1369.29 1484.39,1329.09 1486.74,1593.43 1489.1,1426.74 1491.45,1345.36 1493.8,1461.17 1496.15,1379.79 1498.5,1650.32 1500.85,1417.77 1503.2,1442.26 1505.55,1719.14 1507.9,1617.33 1510.25,1621.52 1512.6,1468.33 1514.95,1302.9 1517.3,1442.32 1519.65,1416.78 1522,1440.81 1524.35,1416.83 1526.7,1223.53 1529.05,1441.57 1531.4,1660.1 1533.75,1541.54 1536.1,1417.99 1538.45,1730.8 1540.81,1612.85 1543.16,1287.04 1545.51,1166.5 1547.86,1496.11 1550.21,1383.22 1552.56,1346.1 1554.91,1559.76 1557.26,1366.72 1559.61,1468.62 1561.96,1536.79 1564.31,1405.18 1566.66,1501.72 1569.01,1314.05 1571.36,1350.3 1573.71,1678.18 1576.06,1463.25 1578.41,1355.11 1580.76,1517.41 1583.11,1377.31 1585.46,1514.55 1587.81,1530.32 1590.17,1363.75 1592.52,1445.19 1594.87,1495.28 1597.22,1452.05 1599.57,1277.73 1601.92,1403.32 1604.27,1492.59 1606.62,1408.42 1608.97,1267.18 1611.32,1438.78 1613.67,1493.21 1616.02,1448.02 1618.37,1317.44 1620.72,1328.14 1623.07,1352.33 1625.42,1427.13 1627.77,1543.42 1630.12,1381.13 1632.47,1376.12 1634.82,1318.51 1637.17,1537 1639.53,1267.76 1641.88,1474.74 1644.23,1354.96 1646.58,1466.12 1648.93,1461.19 1651.28,1377.99 1653.63,1330.93 1655.98,1438.83 1658.33,1455.19 1660.68,1374.94 1663.03,1241.1 1665.38,1336.72 1667.73,1518.15 1670.08,1479.21 1672.43,1303.1 1674.78,1258.2 1677.13,1435.34 1679.48,1359.12 1681.83,1357.68 1684.18,1363.72 1686.53,1592.65 1688.89,1540.17 1691.24,1508.57 1693.59,1466.62 1695.94,1313.16 1698.29,1301.45 1700.64,1421.36 1702.99,1376.49 1705.34,1266.18 1707.69,1427.2 1710.04,1121.97 1712.39,1517.08 1714.74,1343.93 1717.09,1369.71 1719.44,1568.76 1721.79,1437.28 1724.14,1376.68 1726.49,1430.52 1728.84,1409.84 1731.19,1323.9 1733.54,1238.29 1735.89,1521.94 1738.25,1422.13 1740.6,1629.9 1742.95,1377.25 1745.3,1375.15 1747.65,1448.55 1750,1416.82 1752.35,1493.8 1754.7,1398.07 1757.05,1556.29 1759.4,1549.38 1761.75,1488.52 1764.1,1264.98 1766.45,1572.37 1768.8,1433.03 1771.15,1203.11 1773.5,1405.22 1775.85,1453.33 1778.2,1382.89 1780.55,1453.56 1782.9,1394.69 1785.25,1522.41 1787.6,1381.22 1789.96,1647.59 1792.31,1403.64 1794.66,1457.39 1797.01,1411.71 1799.36,1465.77 1801.71,1497.89 1804.06,1511.88 1806.41,1484.56 1808.76,1372.62 1811.11,1550.57 1813.46,1385.34 1815.81,1532.29 1818.16,1420.27 1820.51,1287.4 1822.86,1494.05 1825.21,1469.44 1827.56,1335.44 1829.91,1588.93 1832.26,1314.35 1834.61,1612.62 1836.96,1441.45 1839.32,1328.32 1841.67,1463.28 1844.02,1312.69 1846.37,1596.01 1848.72,1311.43 1851.07,1454.07 1853.42,1423.01 1855.77,1334.35 1858.12,1316.44 1860.47,1563.73 1862.82,1551.19 1865.17,1217.99 1867.52,1359.27 1869.87,1328.91 1872.22,1336.44 1874.57,1361.62 1876.92,1176.37 1879.27,1254.41 1881.62,1299.68 1883.97,1404.64 1886.32,1301.66 1888.68,1522.43 1891.03,1602.4 1893.38,1565.32 1895.73,1287.29 1898.08,1398 1900.43,1596.65 1902.78,1362.69 1905.13,1433.22 1907.48,1531.79 1909.83,1506.59 1912.18,1511.22 1914.53,1278.4 1916.88,1435.24 1919.23,1325.55 1921.58,1343.85 1923.93,1196.62 1926.28,1472.12 1928.63,1519.24 1930.98,1465.79 1933.33,1467.79 1935.68,1437.02 1938.04,1354.86 1940.39,1399.68 1942.74,1466.02 1945.09,1560.11 1947.44,1318.89 1949.79,1336.19 1952.14,1316.55 1954.49,1454.41 1956.84,1432.22 1959.19,1482.41 1961.54,1555.45 1963.89,1340.6 1966.24,1493.92 1968.59,1608.33 1970.94,1533.11 1973.29,1381.68 1975.64,1436 1977.99,1467.35 1980.34,1350.3 1982.69,1361.73 1985.04,1276.04 1987.4,1361.75 1989.75,1442.23 1992.1,1263.59 1994.45,1437.25 1996.8,1344.87 1999.15,1349.38 2001.5,1372.52 2003.85,1751.15 2006.2,1470.84 2008.55,1323 2010.9,1530.47 2013.25,1243.24 2015.6,1386.51 2017.95,1397.86 2020.3,1378.12 2022.65,1409.42 2025,1283.75 2027.35,1362.42 2029.7,1324.42 2032.05,1499.13 2034.4,1448.6 2036.76,1604.82 2039.11,1482.37 2041.46,1447.71 2043.81,1219.14 2046.16,1290.12 2048.51,1497.66 2050.86,1535.98 2053.21,1482.84 2055.56,1489.09 2057.91,1515.64 2060.26,1425.1 2062.61,1393.91 2064.96,1321.7 2067.31,1356.97 2069.66,1519.78 2072.01,1449.32 2074.36,1466.5 2076.71,1503.34 2079.06,1401.33 2081.41,1428.89 2083.76,1384.8 2086.11,1485.95 2088.47,1377.3 2090.82,1406.4 2093.17,1312.86 2095.52,1471.39 2097.87,1308.52 2100.22,1455.2 2102.57,1548.57 2104.92,1344.63 2107.27,1185.05 2109.62,1448.99 2111.97,1485.37 2114.32,1498.19 2116.67,1417.74 2119.02,1519.16 2121.37,1556.72 2123.72,1350.07 2126.07,1328.22 2128.42,1365.61 2130.77,1526.55 2133.12,1601.53 2135.47,1371.35 2137.83,1353.85 2140.18,1485.38 2142.53,1478.7 2144.88,1506.75 2147.23,1479.32 2149.58,1540.65 2151.93,1381.58 2154.28,1443.44 2156.63,1539.09 2158.98,1479.66 2161.33,1405.62 2163.68,1514.16 2166.03,1493.78 2168.38,1538.03 2170.73,1566.49 2173.08,1469.25 2175.43,1422.97 2177.78,1525.62 2180.13,1426.71 2182.48,1405.16 2184.83,1395.46 2187.19,1418.15 2189.54,1266 2191.89,1370.08 2194.24,1503.12 2196.59,1435.64 2198.94,1346.44 2201.29,1478.52 2203.64,1476.62 2205.99,1333.98 2208.34,1546.01 2210.69,1525.71 2213.04,1332.4 2215.39,1427.85 2217.74,1651.45 2220.09,1507.21 2222.44,1563.93 2224.79,1420.77 2227.14,1532.03 2229.49,1430.81 2231.84,1486.51 2234.19,1495.01 2236.55,1461.79 2238.9,1651.76 2241.25,1328.63 2243.6,1450.4 2245.95,1342.93 2248.3,1286.18 2250.65,1484.13 2253,1380.8 2255.35,1330.39 2257.7,1352.74 2260.05,1570.03 2262.4,1599.98 2264.75,1380.73 2267.1,1251.96 2269.45,1378.98 2271.8,1440.03 2274.15,1524.13 2276.5,1563.73 2278.85,1507.78 2281.2,1532.58 2283.55,1257.44 2285.91,1345.87 2288.26,1518.74 2290.61,1419.36 2292.96,1393.66 2295.31,1507.97 2297.66,1573.04 2300.01,1547.91 2302.36,1399 2304.71,1416.51 2307.06,1473.59 2309.41,1377.38 2311.76,1522.17 2314.11,1711.45 2316.46,1710.34 2318.81,1600.06 2321.16,1489.79 2323.51,1396.29 2325.86,1586.99 2328.21,1441.44 2330.56,1454.19 2332.91,1296.29 2335.27,1527.46 2337.62,1382.54 2339.97,1467.79 2342.32,1335.23 2344.67,1324.18 2347.02,1606.18 2349.37,1428.45 2351.72,1470.82 2354.07,1503.76 2356.42,1565.35 2358.77,1352.82 2361.12,1307.36 2363.47,1417.14 2365.82,1468.08 2368.17,1588.59 2370.52,1518.05 2372.87,1407.44 2375.22,1554.2 2377.57,1467.07 2379.92,1436.06 2382.27,1490.26 2384.62,1348.13 2386.98,1273.68 2389.33,1506.69 2391.68,1469.4 2394.03,1465.62 2396.38,1412.57 2398.73,1401.38 2401.08,1134.37 2403.43,1418.55 2405.78,1461.2 2408.13,1479.39 2410.48,1378.97 2412.83,1430.88 2415.18,1426.31 2417.53,1302.9 2419.88,1574.42 2422.23,1550.25 2424.58,1571.18 2426.93,1545.7 2429.28,1502.19 2431.63,1454.97 2433.98,1514.15 2436.34,1358.03 2438.69,1505.38 2441.04,1289.17 2443.39,1395.4 2445.74,1490.06 2448.09,1381.46 2450.44,1584.68 2452.79,1287.67 2455.14,1295.65 2457.49,1474.44 2459.84,1346.85 2462.19,1495.73 2464.54,1390.38 2466.89,1338.8 2469.24,1454.57 2471.59,1315.37 2473.94,1454.72 2476.29,1399.36 2478.64,1363.02 2480.99,1551.25 2483.34,1522.54 2485.7,1463.96 2488.05,1163.22 2490.4,1368.47 2492.75,1215.64 2495.1,1270.57 2497.45,1436.67 2499.8,1400.74 2502.15,1447.98 2504.5,1336.57 2506.85,1474.93 2509.2,1383.78 2511.55,1406.81 2513.9,1220.25 2516.25,1387.26 2518.6,1386.58 2520.95,1387.33 2523.3,1474.53 2525.65,1376.07 2528,1234.03 2530.35,1402.94 2532.7,1514.3 2535.06,1362.94 2537.41,1366.5 2539.76,1309.03 2542.11,1244.92 2544.46,1528.69 2546.81,1604.89 2549.16,1437.46 2551.51,1518.48 2553.86,1486.71 2556.21,1504.18 2558.56,1463.8 2560.91,1288.36 2563.26,1548.02 2565.61,1296.29 2567.96,1321.16 2570.31,1606.54 "></polyline>
<polyline clip-path="url(#clip972)" style="stroke:#e26f46; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,945.567 224.541,962.633 226.891,1023.54 229.242,1009.8 231.592,1060.71 233.943,990.457 236.293,810.269 238.644,856.685 240.994,894.511 243.345,709.221 245.695,1081.59 248.046,1005.74 250.396,976.444 252.747,946.727 255.097,886.252 257.448,1057.63 259.798,940.843 262.148,874.382 264.499,942.909 266.849,767.757 269.2,920.586 271.55,892.304 273.901,923.982 276.251,817.063 278.602,880.693 280.952,847.235 283.303,665.619 285.653,916.097 288.004,938.377 290.354,1091.26 292.705,940.733 295.055,997.564 297.406,964.629 299.756,1060.21 302.107,918.006 304.457,961.783 306.807,863.766 309.158,860.544 311.508,771.392 313.859,880.293 316.209,874.094 318.56,1007 320.91,931.202 323.261,917.747 325.611,943.14 327.962,984.461 330.312,912.635 332.663,805.899 335.013,976.101 337.364,911.221 339.714,993.516 342.065,917.301 344.415,785.435 346.765,950.027 349.116,864.055 351.466,1003.89 353.817,990.183 356.167,818.73 358.518,965.168 360.868,870.842 363.219,956.959 365.569,1000.81 367.92,1001.99 370.27,900.746 372.621,990.045 374.971,1027.77 377.322,900.572 379.672,1058.88 382.023,911.079 384.373,786.755 386.724,1034.3 389.074,986.565 391.424,1046.11 393.775,850.222 396.125,860.747 398.476,692.636 400.826,822.967 403.177,1006.74 405.527,793.012 407.878,886.983 410.228,854.615 412.579,912.75 414.929,1197.32 417.28,928.053 419.63,938.765 421.981,978.317 424.331,999.38 426.682,746.367 429.032,967.284 431.382,760.671 433.733,1041.47 436.083,821.408 438.434,734.019 440.784,916.044 443.135,1050.2 445.485,796.304 447.836,1014.34 450.186,913.687 452.537,849.245 454.887,902.519 457.238,882.597 459.588,731.045 461.939,1086.1 464.289,943.351 466.64,1032.96 468.99,897.038 471.341,749.797 473.691,1037.18 476.041,995.747 478.392,890.881 480.742,919.267 483.093,1050.97 485.443,1071.43 487.794,874.017 490.144,908.562 492.495,892.848 494.845,953.94 497.196,967.808 499.546,998.518 501.897,891.377 504.247,662.896 506.598,926.3 508.948,830.701 511.299,847.934 513.649,847.829 515.999,941.864 518.35,718.507 520.7,912.365 523.051,1075.01 525.401,830.731 527.752,826.074 530.102,909.138 532.453,930.911 534.803,1001.29 537.154,919.365 539.504,834.371 541.855,1022.69 544.205,1092.02 546.556,994.279 548.906,906.7 551.257,810.448 553.607,884.644 555.958,1035.07 558.308,955.132 560.658,994.182 563.009,986.344 565.359,963.027 567.71,985.156 570.06,940.619 572.411,814.314 574.761,979.611 577.112,914.188 579.462,897.429 581.813,1018.65 584.163,915.22 586.514,914.078 588.864,931.531 591.215,899.696 593.565,877.307 595.916,931.155 598.266,987.168 600.616,1000.87 602.967,889.599 605.317,707.184 607.668,873.132 610.018,867.122 612.369,915.879 614.719,884.736 617.07,896.45 619.42,866.394 621.771,1072.59 624.121,932.7 626.472,782.684 628.822,874.945 631.173,1056.66 633.523,821.908 635.874,903.186 638.224,915.865 640.575,976.459 642.925,901.759 645.275,1089.18 647.626,943.46 649.976,1037.61 652.327,822.596 654.677,1026.82 657.028,641.282 659.378,1006.56 661.729,866.618 664.079,983.297 666.43,977.467 668.78,950.159 671.131,948.102 673.481,754.656 675.832,1010.91 678.182,863.3 680.533,740.651 682.883,820.34 685.233,891.096 687.584,812.368 689.934,868.872 692.285,979.165 694.635,783.363 696.986,1043.3 699.336,977.774 701.687,1063.83 704.037,908.764 706.388,768.358 708.738,1009.3 711.089,779.659 713.439,935.043 715.79,878.416 718.14,1041.05 720.491,906.528 722.841,930.141 725.192,979.444 727.542,739.144 729.892,905.957 732.243,873.833 734.593,944.831 736.944,1017.63 739.294,874.009 741.645,905.869 743.995,883.332 746.346,781.95 748.696,1047.61 751.047,971.665 753.397,999.473 755.748,929.689 758.098,936.492 760.449,1010.32 762.799,941.718 765.15,1028.82 767.5,940.082 769.85,809.582 772.201,861.783 774.551,927.142 776.902,991.575 779.252,916.53 781.603,897.291 783.953,767.358 786.304,880.236 788.654,881.703 791.005,974.603 793.355,1009.03 795.706,902.992 798.056,1111.93 800.407,1064.79 802.757,1053.86 805.108,1006.3 807.458,866.933 809.809,944.527 812.159,977.108 814.509,854.963 816.86,846.509 819.21,766.671 821.561,956.172 823.911,854.819 826.262,959.22 828.612,1197.03 830.963,954.365 833.313,899.46 835.664,894.364 838.014,1039.99 840.365,1039.07 842.715,1061.42 845.066,897.525 847.416,947.283 849.767,1107.93 852.117,655.444 854.467,1109.94 856.818,789.995 859.168,741.15 861.519,792.667 863.869,880.518 866.22,842.101 868.57,992.086 870.921,829.906 873.271,951.98 875.622,958.143 877.972,997.83 880.323,917.155 882.673,1031.88 885.024,935.186 887.374,788.16 889.725,829.613 892.075,949.336 894.426,924.093 896.776,899.125 899.126,1010.76 901.477,1121.32 903.827,762.814 906.178,921.968 908.528,994.148 910.879,833.735 913.229,1043.98 915.58,971.705 917.93,880.098 920.281,1014.17 922.631,886.124 924.982,935.568 927.332,905.719 929.683,782.123 932.033,1031.87 934.384,930.439 936.734,899.139 939.084,837.583 941.435,952.11 943.785,924.394 946.136,925.133 948.486,937.264 950.837,881.85 953.187,1048.37 955.538,987.475 957.888,879.227 960.239,754.342 962.589,921.509 964.94,846.243 967.29,959.449 969.641,1054.73 971.991,861.469 974.342,780.193 976.692,963.944 979.043,804.268 981.393,929.19 983.743,960.834 986.094,797.347 988.444,816.969 990.795,954.773 993.145,948.492 995.496,918.094 997.846,913.546 1000.2,980.57 1002.55,861.768 1004.9,1101.14 1007.25,749.879 1009.6,892.964 1011.95,885.622 1014.3,991.126 1016.65,870.127 1019,965.572 1021.35,1100.08 1023.7,759.837 1026.05,1037.36 1028.4,855.974 1030.75,929.996 1033.1,1121.94 1035.45,979.571 1037.8,960.687 1040.15,1000.41 1042.51,1066.15 1044.86,898.845 1047.21,997.166 1049.56,1105.34 1051.91,911.275 1054.26,870.095 1056.61,806.125 1058.96,946.3 1061.31,853.073 1063.66,764.737 1066.01,908.425 1068.36,658.698 1070.71,913.859 1073.06,785.703 1075.41,850.459 1077.76,976.236 1080.11,1034.9 1082.46,1118.1 1084.81,906.985 1087.16,839.215 1089.51,1024.14 1091.87,758.086 1094.22,1044.1 1096.57,921.692 1098.92,825.425 1101.27,1080.21 1103.62,977.013 1105.97,810.394 1108.32,942.215 1110.67,830.228 1113.02,836.744 1115.37,1111.24 1117.72,1065.71 1120.07,1052.58 1122.42,832.558 1124.77,786.787 1127.12,879.627 1129.47,1016.35 1131.82,759.266 1134.17,968.241 1136.52,965.221 1138.87,823.52 1141.23,1012.29 1143.58,886.46 1145.93,782.689 1148.28,793.406 1150.63,877.505 1152.98,865.016 1155.33,801.971 1157.68,966.678 1160.03,1113.83 1162.38,1051.22 1164.73,993.788 1167.08,845.71 1169.43,869.672 1171.78,1108.25 1174.13,919.169 1176.48,995.974 1178.83,859.707 1181.18,943.099 1183.53,1066.18 1185.88,1087.31 1188.23,928.642 1190.59,941.663 1192.94,728.904 1195.29,953.743 1197.64,875.216 1199.99,1080.98 1202.34,1005.76 1204.69,850.686 1207.04,890.895 1209.39,944.674 1211.74,1009.05 1214.09,928.107 1216.44,958.486 1218.79,829.35 1221.14,931.225 1223.49,1062.48 1225.84,924.783 1228.19,970.92 1230.54,1010.91 1232.89,1050.62 1235.24,937.53 1237.59,832.618 1239.94,813.703 1242.3,794.021 1244.65,775.888 1247,1011.96 1249.35,906.019 1251.7,943.341 1254.05,907.269 1256.4,1009.35 1258.75,1109.25 1261.1,844.701 1263.45,786.551 1265.8,796.882 1268.15,776.175 1270.5,933.265 1272.85,818.015 1275.2,920.882 1277.55,995.772 1279.9,668.434 1282.25,1032.38 1284.6,901.855 1286.95,1001.95 1289.3,917.043 1291.66,1028.71 1294.01,1000.43 1296.36,1084.03 1298.71,879.932 1301.06,955.378 1303.41,1054.72 1305.76,1012.8 1308.11,1007.73 1310.46,990.916 1312.81,1115.57 1315.16,959.292 1317.51,902.592 1319.86,944.413 1322.21,949.628 1324.56,922.096 1326.91,987.276 1329.26,944.184 1331.61,1127.66 1333.96,824.877 1336.31,665.099 1338.66,811.995 1341.02,889.079 1343.37,903.305 1345.72,993.207 1348.07,901.898 1350.42,965.783 1352.77,1085.5 1355.12,921.38 1357.47,776.07 1359.82,1049.77 1362.17,791.89 1364.52,918.756 1366.87,857.012 1369.22,988.499 1371.57,675.556 1373.92,1044.34 1376.27,942.588 1378.62,872.923 1380.97,789.377 1383.32,876.176 1385.67,779.018 1388.02,898.973 1390.38,814.428 1392.73,981.564 1395.08,922.535 1397.43,859.411 1399.78,899.329 1402.13,990.201 1404.48,916.253 1406.83,728.959 1409.18,907.112 1411.53,869.936 1413.88,787.172 1416.23,936.213 1418.58,857.111 1420.93,924.877 1423.28,923.468 1425.63,869.614 1427.98,813.566 1430.33,897.32 1432.68,834.181 1435.03,1015.53 1437.38,782.339 1439.74,820.302 1442.09,991.534 1444.44,804.247 1446.79,908.861 1449.14,1089.91 1451.49,768.151 1453.84,1076.18 1456.19,977.578 1458.54,649.153 1460.89,945.704 1463.24,1037.59 1465.59,880.219 1467.94,931.553 1470.29,911.979 1472.64,1038.02 1474.99,998.758 1477.34,1032.77 1479.69,744.015 1482.04,990.247 1484.39,871.767 1486.74,819.499 1489.1,750.41 1491.45,873.087 1493.8,1118.47 1496.15,956.93 1498.5,884.766 1500.85,922.18 1503.2,904.383 1505.55,773.196 1507.9,883.435 1510.25,870.664 1512.6,1040.43 1514.95,883.712 1517.3,839.706 1519.65,943.281 1522,784.486 1524.35,1002.42 1526.7,952.457 1529.05,1013.58 1531.4,961.118 1533.75,819.538 1536.1,1019.96 1538.45,971 1540.81,882.942 1543.16,1063.19 1545.51,962.272 1547.86,720.099 1550.21,888.403 1552.56,953.054 1554.91,890.648 1557.26,825.694 1559.61,866.71 1561.96,1007.43 1564.31,889.624 1566.66,856.222 1569.01,828.602 1571.36,867.212 1573.71,975.496 1576.06,824.044 1578.41,915.705 1580.76,886.126 1583.11,822.066 1585.46,870.848 1587.81,1122.28 1590.17,924.137 1592.52,942.878 1594.87,1007.65 1597.22,818.841 1599.57,960.187 1601.92,990.655 1604.27,890.084 1606.62,883.758 1608.97,900.349 1611.32,801.765 1613.67,928.22 1616.02,1136.51 1618.37,849.788 1620.72,1051.78 1623.07,946.145 1625.42,991.095 1627.77,1001.85 1630.12,892.722 1632.47,928.328 1634.82,1097.56 1637.17,905.915 1639.53,913.961 1641.88,836.217 1644.23,858.178 1646.58,1097.94 1648.93,1066.54 1651.28,1010.64 1653.63,910.074 1655.98,1054.62 1658.33,860.3 1660.68,929.868 1663.03,830.906 1665.38,783.366 1667.73,710.33 1670.08,978.007 1672.43,1080.3 1674.78,893.025 1677.13,795.434 1679.48,863.611 1681.83,873.59 1684.18,935.033 1686.53,942.067 1688.89,938.646 1691.24,740.861 1693.59,830.062 1695.94,716.107 1698.29,891.16 1700.64,958.287 1702.99,921.013 1705.34,1031.97 1707.69,731.385 1710.04,898.448 1712.39,931.012 1714.74,1037.05 1717.09,931.334 1719.44,996.308 1721.79,980.511 1724.14,981.227 1726.49,988.331 1728.84,733.614 1731.19,772.088 1733.54,821.235 1735.89,846.989 1738.25,923.273 1740.6,942.315 1742.95,889.051 1745.3,859.684 1747.65,804.011 1750,1113.76 1752.35,889.597 1754.7,713.396 1757.05,1004.41 1759.4,770.125 1761.75,921.313 1764.1,913.408 1766.45,782.458 1768.8,793.771 1771.15,1029.61 1773.5,889.018 1775.85,1003.3 1778.2,883.278 1780.55,816.687 1782.9,814.737 1785.25,961.4 1787.6,819.664 1789.96,827.118 1792.31,908.641 1794.66,823.768 1797.01,986.285 1799.36,1244.06 1801.71,930.174 1804.06,957.985 1806.41,1001.79 1808.76,796.22 1811.11,897.98 1813.46,722.303 1815.81,754.544 1818.16,1011.36 1820.51,1005.3 1822.86,924.461 1825.21,991.053 1827.56,971.1 1829.91,789.983 1832.26,1299.36 1834.61,858.396 1836.96,833.237 1839.32,879.489 1841.67,1095.07 1844.02,1018.03 1846.37,1031.86 1848.72,851.429 1851.07,865.572 1853.42,1061.51 1855.77,1099.63 1858.12,1022.77 1860.47,952.87 1862.82,865.725 1865.17,820.118 1867.52,773.718 1869.87,937.569 1872.22,973.039 1874.57,1086.49 1876.92,1103.98 1879.27,850.511 1881.62,820.074 1883.97,944.059 1886.32,788.39 1888.68,985.67 1891.03,768.394 1893.38,1044.09 1895.73,941.962 1898.08,822.771 1900.43,1067.45 1902.78,1021.4 1905.13,1037.53 1907.48,833.743 1909.83,927.302 1912.18,779.013 1914.53,887.401 1916.88,907.615 1919.23,991.121 1921.58,909.31 1923.93,1015.68 1926.28,857.728 1928.63,849.081 1930.98,964.404 1933.33,953.524 1935.68,842.999 1938.04,1017.83 1940.39,1069.09 1942.74,971.248 1945.09,739.433 1947.44,770.819 1949.79,1033.79 1952.14,922.828 1954.49,941.009 1956.84,988.418 1959.19,824.965 1961.54,1086.38 1963.89,872.575 1966.24,1129.92 1968.59,654.778 1970.94,912.998 1973.29,742.237 1975.64,1006.39 1977.99,883.509 1980.34,962.948 1982.69,913.78 1985.04,907.177 1987.4,893.9 1989.75,827.518 1992.1,861.982 1994.45,708.528 1996.8,959.809 1999.15,923.023 2001.5,958.241 2003.85,951.983 2006.2,1086.62 2008.55,998.181 2010.9,1085.66 2013.25,858.2 2015.6,858.676 2017.95,801.277 2020.3,919.382 2022.65,880.437 2025,880.007 2027.35,753.573 2029.7,905.073 2032.05,1110.54 2034.4,925.991 2036.76,934.241 2039.11,862.942 2041.46,810.278 2043.81,905.98 2046.16,1059.69 2048.51,1010.04 2050.86,980.721 2053.21,835.158 2055.56,895.535 2057.91,936.473 2060.26,749.37 2062.61,939.559 2064.96,907.958 2067.31,1044.39 2069.66,919.038 2072.01,1057.08 2074.36,807.267 2076.71,928.438 2079.06,1100.34 2081.41,1103.17 2083.76,822.221 2086.11,975.004 2088.47,968.869 2090.82,869.253 2093.17,1050.61 2095.52,904.867 2097.87,1135.54 2100.22,922.302 2102.57,888.812 2104.92,947.129 2107.27,947.488 2109.62,823.392 2111.97,738.199 2114.32,790.26 2116.67,1204.75 2119.02,732.845 2121.37,683.377 2123.72,843.803 2126.07,1038.26 2128.42,852.228 2130.77,956.497 2133.12,696.808 2135.47,930.931 2137.83,775.334 2140.18,1052.32 2142.53,1085.02 2144.88,981.899 2147.23,857.453 2149.58,957.261 2151.93,830.792 2154.28,887.825 2156.63,1069.92 2158.98,969.441 2161.33,883.8 2163.68,1104.68 2166.03,740.083 2168.38,850.441 2170.73,919.48 2173.08,914.686 2175.43,768.778 2177.78,947.682 2180.13,827.354 2182.48,1153.18 2184.83,1017.9 2187.19,984.771 2189.54,1106.07 2191.89,968.911 2194.24,1094.46 2196.59,907.912 2198.94,1012.07 2201.29,883.958 2203.64,793.342 2205.99,750.57 2208.34,817.209 2210.69,686.306 2213.04,1037.19 2215.39,827.726 2217.74,1068.5 2220.09,912.225 2222.44,1044.42 2224.79,1056.72 2227.14,1087.5 2229.49,1226.67 2231.84,1066.84 2234.19,954.075 2236.55,913.706 2238.9,1019.05 2241.25,954.707 2243.6,982.578 2245.95,930.155 2248.3,957.931 2250.65,900.029 2253,782.023 2255.35,897.041 2257.7,807.419 2260.05,944.716 2262.4,776.849 2264.75,961.514 2267.1,981.529 2269.45,972.135 2271.8,864.881 2274.15,953.712 2276.5,955.584 2278.85,977.943 2281.2,920.111 2283.55,811.632 2285.91,872.529 2288.26,799.959 2290.61,929.755 2292.96,1063.09 2295.31,993.728 2297.66,761.933 2300.01,965.864 2302.36,1052.05 2304.71,863.261 2307.06,872.824 2309.41,904.557 2311.76,973.92 2314.11,894.092 2316.46,892.921 2318.81,957.209 2321.16,896.827 2323.51,997.451 2325.86,765.74 2328.21,898.273 2330.56,783.822 2332.91,831.231 2335.27,948.533 2337.62,777.191 2339.97,962.56 2342.32,996.038 2344.67,795.052 2347.02,701.85 2349.37,932.594 2351.72,783.185 2354.07,886.941 2356.42,719.159 2358.77,724.707 2361.12,1009.64 2363.47,1013.73 2365.82,954.26 2368.17,810.149 2370.52,963.836 2372.87,868.684 2375.22,880.583 2377.57,863.344 2379.92,1118.91 2382.27,820.637 2384.62,656.916 2386.98,1006.8 2389.33,957.925 2391.68,938.485 2394.03,999.603 2396.38,786.62 2398.73,1062.18 2401.08,913.72 2403.43,874.702 2405.78,900.076 2408.13,896.756 2410.48,1043.19 2412.83,910.516 2415.18,777.064 2417.53,1057.09 2419.88,997.703 2422.23,856.562 2424.58,802.308 2426.93,1023.53 2429.28,982.514 2431.63,970.841 2433.98,965.371 2436.34,1129.47 2438.69,955.976 2441.04,996.673 2443.39,833.152 2445.74,864.709 2448.09,867.439 2450.44,898.559 2452.79,882.525 2455.14,892.442 2457.49,999.689 2459.84,1071.78 2462.19,1035.63 2464.54,1176.02 2466.89,781.472 2469.24,893.789 2471.59,810.068 2473.94,903.702 2476.29,868.611 2478.64,1018.09 2480.99,928.028 2483.34,976.526 2485.7,1046.79 2488.05,869.235 2490.4,792.463 2492.75,833.998 2495.1,940.221 2497.45,876.541 2499.8,829.484 2502.15,941.989 2504.5,811.896 2506.85,924.669 2509.2,878.413 2511.55,973.4 2513.9,877.64 2516.25,983.074 2518.6,830.308 2520.95,978.105 2523.3,863.924 2525.65,968.325 2528,841.282 2530.35,1032.9 2532.7,940.237 2535.06,1225.26 2537.41,1011.15 2539.76,965.186 2542.11,915.945 2544.46,751.578 2546.81,1028.63 2549.16,959.177 2551.51,693.262 2553.86,928.986 2556.21,798.004 2558.56,967.255 2560.91,917.781 2563.26,899.788 2565.61,846.533 2567.96,811.716 2570.31,1033.63 "></polyline>
<polyline clip-path="url(#clip972)" style="stroke:#3da44d; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,634.074 224.541,499.932 226.891,498.544 229.242,358.128 231.592,487.055 233.943,439.143 236.293,477.453 238.644,307.864 240.994,331.992 243.345,362.631 245.695,260.001 248.046,283.707 250.396,420.559 252.747,199.007 255.097,458.282 257.448,422.841 259.798,346.261 262.148,257.783 264.499,413.975 266.849,490.835 269.2,338.417 271.55,308.267 273.901,450.034 276.251,345.513 278.602,393.803 280.952,470.998 283.303,303.948 285.653,446.037 288.004,433.278 290.354,378.314 292.705,453.838 295.055,435.176 297.406,248.554 299.756,224.272 302.107,346.452 304.457,222.254 306.807,299.868 309.158,459.359 311.508,364.252 313.859,550.613 316.209,650.096 318.56,270.531 320.91,588.863 323.261,286.073 325.611,292.702 327.962,404.791 330.312,485.118 332.663,354.363 335.013,392.818 337.364,400.254 339.714,516.536 342.065,318.441 344.415,416.36 346.765,475.28 349.116,559.723 351.466,251.633 353.817,517.26 356.167,451.622 358.518,266.275 360.868,586.782 363.219,260.519 365.569,556.1 367.92,325.098 370.27,390 372.621,534.836 374.971,456.163 377.322,442.9 379.672,356.763 382.023,376.896 384.373,432.225 386.724,416.737 389.074,457.509 391.424,353.408 393.775,442.953 396.125,303.651 398.476,524.194 400.826,363.786 403.177,479.238 405.527,566.608 407.878,408.443 410.228,384.631 412.579,313.193 414.929,542.689 417.28,496.447 419.63,483.547 421.981,556.53 424.331,422.448 426.682,360.462 429.032,541.363 431.382,414.723 433.733,465.908 436.083,331.827 438.434,371.254 440.784,558.105 443.135,312.153 445.485,352.832 447.836,351.079 450.186,394.628 452.537,557.376 454.887,339.381 457.238,410.415 459.588,370.049 461.939,532.232 464.289,589.776 466.64,508.354 468.99,334.959 471.341,221.402 473.691,615.967 476.041,326.607 478.392,511.489 480.742,431.358 483.093,420.635 485.443,414.345 487.794,383.791 490.144,425.253 492.495,448.394 494.845,440.999 497.196,304.973 499.546,404.295 501.897,473.562 504.247,457.598 506.598,177.785 508.948,430.635 511.299,377.704 513.649,444.6 515.999,329.954 518.35,237.194 520.7,298.376 523.051,440.722 525.401,346.642 527.752,207.438 530.102,306.519 532.453,291.454 534.803,318.432 537.154,276.522 539.504,387.38 541.855,339.142 544.205,307.329 546.556,547.952 548.906,315.835 551.257,353.463 553.607,346.362 555.958,485.615 558.308,453.514 560.658,390.986 563.009,462.39 565.359,478.785 567.71,333.907 570.06,443.625 572.411,374.013 574.761,547.075 577.112,238.035 579.462,389.087 581.813,297.894 584.163,405.669 586.514,341.107 588.864,361.39 591.215,262.65 593.565,369.117 595.916,466.96 598.266,546.08 600.616,250.844 602.967,240.226 605.317,351.281 607.668,387.198 610.018,318.528 612.369,328.403 614.719,198.828 617.07,511.411 619.42,180.295 621.771,416.751 624.121,318.818 626.472,423.817 628.822,224.911 631.173,526.756 633.523,449.813 635.874,332.733 638.224,404.433 640.575,467.234 642.925,424.727 645.275,331.644 647.626,512.426 649.976,615.914 652.327,388.706 654.677,498.414 657.028,340.386 659.378,600.502 661.729,320.403 664.079,540.335 666.43,276.409 668.78,378.951 671.131,500.571 673.481,407.302 675.832,287.966 678.182,255.773 680.533,379.594 682.883,381.987 685.233,365.106 687.584,299.16 689.934,492.198 692.285,487.158 694.635,346.396 696.986,534.102 699.336,606.666 701.687,552.941 704.037,488.747 706.388,440.717 708.738,291.476 711.089,589.121 713.439,270.07 715.79,311.069 718.14,452.18 720.491,342.752 722.841,440.177 725.192,456.378 727.542,403.32 729.892,277.265 732.243,329.966 734.593,390.351 736.944,258.9 739.294,400.784 741.645,522.358 743.995,411.435 746.346,423.351 748.696,550.934 751.047,571.82 753.397,309.971 755.748,297.425 758.098,278.239 760.449,277.028 762.799,420.334 765.15,432.46 767.5,366.971 769.85,515.967 772.201,262.948 774.551,427.011 776.902,207.564 779.252,362.18 781.603,217.637 783.953,440.927 786.304,438.105 788.654,405.341 791.005,334.292 793.355,376.986 795.706,323.098 798.056,425.933 800.407,517.456 802.757,482.535 805.108,461.969 807.458,328.38 809.809,385.311 812.159,329.103 814.509,452.763 816.86,580.893 819.21,421.973 821.561,506.532 823.911,409.504 826.262,388.048 828.612,427.287 830.963,391.925 833.313,429.787 835.664,586.437 838.014,312.686 840.365,392.457 842.715,375.988 845.066,181.536 847.416,500.684 849.767,344.054 852.117,260.129 854.467,354.215 856.818,520.041 859.168,426.709 861.519,574.929 863.869,373.671 866.22,393.503 868.57,400.73 870.921,424.023 873.271,270.06 875.622,389.167 877.972,349.245 880.323,401.489 882.673,364.717 885.024,417.857 887.374,512.957 889.725,288.31 892.075,385.117 894.426,346.694 896.776,464.512 899.126,448.117 901.477,404.001 903.827,369.514 906.178,466.833 908.528,404.853 910.879,397.386 913.229,279.917 915.58,401.447 917.93,603.002 920.281,442.79 922.631,410.132 924.982,156.456 927.332,487.308 929.683,297.891 932.033,427.276 934.384,126.782 936.734,544.526 939.084,449.247 941.435,571.84 943.785,460.4 946.136,411.271 948.486,547.739 950.837,383.985 953.187,330.545 955.538,623.691 957.888,343.456 960.239,414.351 962.589,329.258 964.94,494.677 967.29,443.654 969.641,303.333 971.991,425.63 974.342,462.196 976.692,436.07 979.043,336.813 981.393,534.198 983.743,493.62 986.094,455.559 988.444,630.871 990.795,373.121 993.145,384.964 995.496,383.098 997.846,496.474 1000.2,501.428 1002.55,480.861 1004.9,125.885 1007.25,506.95 1009.6,573.623 1011.95,394.436 1014.3,250.548 1016.65,422.664 1019,303.253 1021.35,360.349 1023.7,279.293 1026.05,349.582 1028.4,600.949 1030.75,304.328 1033.1,322.766 1035.45,496.357 1037.8,468.541 1040.15,234.647 1042.51,343.473 1044.86,262.314 1047.21,429.6 1049.56,400.601 1051.91,473.109 1054.26,410.783 1056.61,460.356 1058.96,327.653 1061.31,432.025 1063.66,579.48 1066.01,331.846 1068.36,492.751 1070.71,390.371 1073.06,341.357 1075.41,392.995 1077.76,554.25 1080.11,627.743 1082.46,467.03 1084.81,415.737 1087.16,272.264 1089.51,383.79 1091.87,353.424 1094.22,287.544 1096.57,541.399 1098.92,467.681 1101.27,420.609 1103.62,401.302 1105.97,387.237 1108.32,506.853 1110.67,514.155 1113.02,273.75 1115.37,296.997 1117.72,300.626 1120.07,526.211 1122.42,327.089 1124.77,499.484 1127.12,553.344 1129.47,316.468 1131.82,342.918 1134.17,288.856 1136.52,367.732 1138.87,477.309 1141.23,602.959 1143.58,527.888 1145.93,259.619 1148.28,425.968 1150.63,336.083 1152.98,519.847 1155.33,245.183 1157.68,249.121 1160.03,635.213 1162.38,235.946 1164.73,323.388 1167.08,649.631 1169.43,411.457 1171.78,380.558 1174.13,571.608 1176.48,632.189 1178.83,428.933 1181.18,443.155 1183.53,552.22 1185.88,160.284 1188.23,445.671 1190.59,566.377 1192.94,480.57 1195.29,437.982 1197.64,445.935 1199.99,509.062 1202.34,286.46 1204.69,433.868 1207.04,432.125 1209.39,337.505 1211.74,328.661 1214.09,476.545 1216.44,538.219 1218.79,366.328 1221.14,542.804 1223.49,493.272 1225.84,364.603 1228.19,459.119 1230.54,351.838 1232.89,318.304 1235.24,360.03 1237.59,269.484 1239.94,96.8724 1242.3,470.787 1244.65,260.19 1247,502.626 1249.35,662.587 1251.7,353.06 1254.05,594.827 1256.4,443.919 1258.75,361.585 1261.1,347.262 1263.45,448.264 1265.8,416.673 1268.15,539.477 1270.5,276.156 1272.85,327.672 1275.2,333.2 1277.55,477.375 1279.9,508.093 1282.25,396.323 1284.6,418.126 1286.95,255.765 1289.3,397.863 1291.66,565.576 1294.01,467.896 1296.36,494.124 1298.71,433.642 1301.06,367.28 1303.41,635.231 1305.76,421.655 1308.11,422.356 1310.46,581.224 1312.81,241.812 1315.16,591.264 1317.51,531.987 1319.86,207.132 1322.21,454.101 1324.56,358.599 1326.91,316.145 1329.26,484.725 1331.61,411.69 1333.96,453.028 1336.31,441.983 1338.66,378.328 1341.02,362.958 1343.37,207.738 1345.72,440.566 1348.07,220.54 1350.42,479.537 1352.77,532.486 1355.12,547.425 1357.47,408.337 1359.82,427.346 1362.17,513.836 1364.52,336.486 1366.87,447.392 1369.22,447.888 1371.57,701.48 1373.92,277.853 1376.27,355.534 1378.62,530.693 1380.97,254.59 1383.32,477.972 1385.67,377.926 1388.02,312.103 1390.38,409.4 1392.73,345.899 1395.08,303.301 1397.43,582.824 1399.78,409.353 1402.13,466.319 1404.48,261.03 1406.83,363.902 1409.18,360.232 1411.53,379.521 1413.88,550.904 1416.23,409.395 1418.58,463.933 1420.93,461.251 1423.28,612.972 1425.63,240.823 1427.98,486.442 1430.33,315.869 1432.68,340.026 1435.03,620.779 1437.38,616.8 1439.74,228.593 1442.09,533.656 1444.44,399.477 1446.79,439.837 1449.14,350.16 1451.49,391.615 1453.84,319.094 1456.19,348.019 1458.54,524.549 1460.89,320.391 1463.24,276.368 1465.59,287.825 1467.94,392.655 1470.29,318.204 1472.64,530.562 1474.99,177.552 1477.34,444.526 1479.69,207.853 1482.04,390.836 1484.39,433.937 1486.74,303.457 1489.1,223 1491.45,303.253 1493.8,350.284 1496.15,390.809 1498.5,513.031 1500.85,479.421 1503.2,517.526 1505.55,369.19 1507.9,473.146 1510.25,426.49 1512.6,441.003 1514.95,247.605 1517.3,257.456 1519.65,341.496 1522,311.537 1524.35,387.759 1526.7,542.046 1529.05,269.622 1531.4,415.967 1533.75,178.387 1536.1,420.667 1538.45,316.122 1540.81,517.873 1543.16,495.465 1545.51,489.264 1547.86,332.428 1550.21,536.879 1552.56,352.765 1554.91,374.114 1557.26,602.493 1559.61,268.25 1561.96,391.777 1564.31,408.506 1566.66,508.748 1569.01,441.25 1571.36,657.155 1573.71,499.197 1576.06,355.807 1578.41,494.113 1580.76,449.461 1583.11,475.348 1585.46,152.099 1587.81,417.585 1590.17,569.873 1592.52,604.504 1594.87,449.534 1597.22,295.912 1599.57,348.997 1601.92,361.384 1604.27,385.197 1606.62,472.129 1608.97,359.026 1611.32,426.061 1613.67,326.941 1616.02,581.866 1618.37,376.941 1620.72,335.682 1623.07,313.779 1625.42,546.44 1627.77,341.064 1630.12,149.534 1632.47,206.013 1634.82,526.669 1637.17,460.015 1639.53,469.017 1641.88,475.178 1644.23,433.945 1646.58,362.205 1648.93,508.824 1651.28,394.752 1653.63,358.325 1655.98,559.521 1658.33,463.851 1660.68,189.657 1663.03,320.395 1665.38,392.953 1667.73,571.848 1670.08,326.018 1672.43,360.753 1674.78,517.812 1677.13,376.622 1679.48,248.397 1681.83,263.487 1684.18,273.552 1686.53,311.14 1688.89,414.757 1691.24,380.905 1693.59,447.385 1695.94,332.291 1698.29,455.393 1700.64,414.2 1702.99,662.616 1705.34,358.249 1707.69,385.898 1710.04,438.939 1712.39,367.864 1714.74,349.093 1717.09,373.544 1719.44,482.789 1721.79,154.964 1724.14,153.524 1726.49,476.424 1728.84,507.428 1731.19,353.115 1733.54,505.25 1735.89,531.346 1738.25,446.057 1740.6,329.371 1742.95,623.992 1745.3,310.248 1747.65,318.566 1750,372.461 1752.35,417.652 1754.7,240.881 1757.05,293.479 1759.4,260.801 1761.75,588.849 1764.1,418.949 1766.45,303.959 1768.8,171.992 1771.15,495.018 1773.5,418.148 1775.85,370.724 1778.2,404.813 1780.55,313.752 1782.9,228.968 1785.25,524.95 1787.6,423.286 1789.96,422.937 1792.31,374.707 1794.66,378.443 1797.01,440.504 1799.36,477.086 1801.71,517.832 1804.06,475.704 1806.41,372.839 1808.76,317.79 1811.11,284.368 1813.46,495.81 1815.81,530.142 1818.16,291.752 1820.51,382.934 1822.86,314.604 1825.21,302.727 1827.56,491.836 1829.91,441.352 1832.26,332.424 1834.61,547.736 1836.96,465.43 1839.32,420.18 1841.67,575.919 1844.02,457.333 1846.37,527.292 1848.72,483.169 1851.07,383.619 1853.42,585.661 1855.77,436.292 1858.12,467.397 1860.47,395.899 1862.82,425.979 1865.17,438.48 1867.52,470.185 1869.87,440.553 1872.22,398.978 1874.57,332.996 1876.92,483.976 1879.27,278.712 1881.62,387.489 1883.97,406.118 1886.32,520.074 1888.68,557.882 1891.03,443.226 1893.38,334.167 1895.73,176.213 1898.08,341.333 1900.43,467.335 1902.78,307.941 1905.13,290.469 1907.48,618.168 1909.83,444.339 1912.18,335.419 1914.53,383.807 1916.88,479.177 1919.23,382.195 1921.58,347.46 1923.93,293.538 1926.28,543.776 1928.63,422.266 1930.98,216.077 1933.33,360.43 1935.68,600.738 1938.04,552.252 1940.39,340.013 1942.74,351.539 1945.09,646.152 1947.44,412.835 1949.79,468.268 1952.14,576.647 1954.49,418.353 1956.84,299.686 1959.19,461.054 1961.54,551.647 1963.89,156.113 1966.24,358.813 1968.59,307.394 1970.94,311.317 1973.29,371.246 1975.64,331.727 1977.99,578.159 1980.34,489.823 1982.69,367.441 1985.04,511.178 1987.4,509.31 1989.75,381.056 1992.1,439.527 1994.45,556.604 1996.8,387.675 1999.15,324.635 2001.5,609.483 2003.85,542.625 2006.2,282.865 2008.55,255.371 2010.9,323.576 2013.25,444.908 2015.6,406.247 2017.95,389.812 2020.3,429.476 2022.65,332.905 2025,435.525 2027.35,387.094 2029.7,325.804 2032.05,517.388 2034.4,415.285 2036.76,426.537 2039.11,350.96 2041.46,409.809 2043.81,272.121 2046.16,552.832 2048.51,458.642 2050.86,598.43 2053.21,564.558 2055.56,422.837 2057.91,495.087 2060.26,326.507 2062.61,359.864 2064.96,247.902 2067.31,528.369 2069.66,445.906 2072.01,329.431 2074.36,517.132 2076.71,474.846 2079.06,385.451 2081.41,442.646 2083.76,503.983 2086.11,348.651 2088.47,456.489 2090.82,537.796 2093.17,281.123 2095.52,468.973 2097.87,524.611 2100.22,288.938 2102.57,617.036 2104.92,555.342 2107.27,347.051 2109.62,476.124 2111.97,572.031 2114.32,463.197 2116.67,435.536 2119.02,366.13 2121.37,448.471 2123.72,247.426 2126.07,281.893 2128.42,455.947 2130.77,477.374 2133.12,340.456 2135.47,192.175 2137.83,344.528 2140.18,406.516 2142.53,376.573 2144.88,332.984 2147.23,475.216 2149.58,347.807 2151.93,343.922 2154.28,635.513 2156.63,229.103 2158.98,607.502 2161.33,504.455 2163.68,411.973 2166.03,358.454 2168.38,278.442 2170.73,454.842 2173.08,471.21 2175.43,265.603 2177.78,367.052 2180.13,541.754 2182.48,471.469 2184.83,323.229 2187.19,485.717 2189.54,453.88 2191.89,556.929 2194.24,195.529 2196.59,319.346 2198.94,618.346 2201.29,497.644 2203.64,561.919 2205.99,263.734 2208.34,311.265 2210.69,358.885 2213.04,455.857 2215.39,521.571 2217.74,332.779 2220.09,316.182 2222.44,572.703 2224.79,240.541 2227.14,387.183 2229.49,406.653 2231.84,228.134 2234.19,536.672 2236.55,592.278 2238.9,538.256 2241.25,506.293 2243.6,346.473 2245.95,508.4 2248.3,392.352 2250.65,338.737 2253,480.907 2255.35,353.249 2257.7,393.145 2260.05,306.906 2262.4,519.108 2264.75,392.427 2267.1,130.631 2269.45,436.566 2271.8,414.975 2274.15,506.183 2276.5,405.976 2278.85,495.093 2281.2,396.027 2283.55,454.518 2285.91,455.662 2288.26,505.621 2290.61,370.238 2292.96,252.082 2295.31,380.788 2297.66,452.454 2300.01,515.113 2302.36,368.868 2304.71,386.688 2307.06,620.617 2309.41,384.46 2311.76,556.913 2314.11,482.543 2316.46,538.863 2318.81,288.366 2321.16,398.349 2323.51,487.951 2325.86,533.98 2328.21,518.428 2330.56,459.571 2332.91,304.052 2335.27,361.075 2337.62,283.17 2339.97,578.618 2342.32,582.899 2344.67,420.561 2347.02,439.461 2349.37,464.085 2351.72,400.477 2354.07,422.054 2356.42,257.732 2358.77,413.198 2361.12,464.682 2363.47,400.904 2365.82,390.377 2368.17,362.578 2370.52,428.962 2372.87,453.581 2375.22,331.318 2377.57,603.995 2379.92,387.732 2382.27,249.839 2384.62,311.74 2386.98,514.488 2389.33,273.338 2391.68,389.66 2394.03,430.532 2396.38,331.549 2398.73,408.735 2401.08,385.304 2403.43,502.151 2405.78,446.329 2408.13,293.215 2410.48,476.48 2412.83,560.686 2415.18,351.59 2417.53,417.616 2419.88,467.287 2422.23,423.896 2424.58,328.408 2426.93,343.603 2429.28,528.5 2431.63,328.159 2433.98,232.373 2436.34,302.643 2438.69,621.1 2441.04,409.011 2443.39,504.413 2445.74,432.669 2448.09,490.75 2450.44,399.896 2452.79,355.328 2455.14,334.522 2457.49,309.888 2459.84,224.077 2462.19,464.078 2464.54,297.503 2466.89,427.753 2469.24,469.128 2471.59,407.201 2473.94,468.864 2476.29,516.671 2478.64,627.717 2480.99,453.383 2483.34,369.891 2485.7,392.069 2488.05,494.939 2490.4,373.7 2492.75,362.492 2495.1,480.347 2497.45,269.45 2499.8,307.407 2502.15,346.952 2504.5,245.419 2506.85,344.936 2509.2,410.393 2511.55,373.235 2513.9,375.34 2516.25,483.59 2518.6,365.472 2520.95,409.071 2523.3,624.253 2525.65,424.512 2528,448.89 2530.35,397.966 2532.7,375.1 2535.06,531.76 2537.41,517.464 2539.76,335.205 2542.11,384.192 2544.46,592.427 2546.81,416.329 2549.16,386.33 2551.51,392.792 2553.86,475.32 2556.21,294.236 2558.56,387.849 2560.91,580.218 2563.26,323.794 2565.61,532.502 2567.96,431.273 2570.31,487.922 "></polyline>
</svg>
</div>
</div>
<p>Look at that! Things are working; amazin’.</p>
<p>We can also exploit <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>’s parallel sampling capabilities:</p>
<div id="34" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run separate 4 chains for 10 000 iterations using threads to parallelize.</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>num_chains <span class="op">=</span> <span class="fl">4</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    model_with_grad,</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">MCMCThreads</span>(),</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>,</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    num_chains;</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Note we need to provide an initial state for every chain.</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>    initial_state<span class="op">=</span><span class="fu">fill</span>(state, num_chains),</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>samples_array <span class="op">=</span> <span class="fu">stack</span>(<span class="fu">map</span>(<span class="bu">Base</span>.<span class="fu">Fix1</span>(stack, sample <span class="op">-&gt;</span> sample.x), samples))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000×4 Array{Float64, 3}:
[:, :, 1] =
 -1.63978   -2.88276   -4.75065   …  -4.64197   -6.19822   -5.82508
 -0.638554  -0.891509   0.191262      0.182621   0.412297  -0.884144
  0.576405   3.53442    4.56378       4.68692    4.23283    4.2724

[:, :, 2] =
 -2.32065  -2.2629   -2.39613  -2.84998   …  -4.62983   -4.73134   -4.75199
  1.99517   2.31832   1.06519   0.519004      0.345654   0.287625  -1.0005
  2.72182   3.81915   4.2429    3.36277       6.25117    6.07131    4.83702

[:, :, 3] =
 -3.40194   -6.2579    -5.54976   -5.59464   …  -5.45536  -5.60306   -6.15772
  0.203844   0.160406   0.562044   0.236036      1.35543  -0.726276   1.1613
  2.72573    4.38475    3.33885    6.13615       4.40578   4.22279    3.85576

[:, :, 4] =
 -2.74312  -4.51138    -3.94081  -5.41409  …  -4.77003  -4.34238  -5.01242
  0.32229  -0.0275184   1.56949   0.46747     -1.87313  -0.82357   0.526416
  2.85967   3.51207     4.70437   2.62617      5.9557    5.52047   5.88954</code></pre>
</div>
</div>
<p>But the fact that we have to provide the <code>AbstractMCMC.sample</code> call, etc. with an <code>initial_state</code> to get started is a bit annoying. We can avoid this by also defining a <code>AbstractMCMC.step</code> <em>without</em> the <code>state</code> argument:</p>
<div id="36" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">::</span><span class="dt">MALA</span>;</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># </span><span class="al">NOTE</span><span class="co">: No state provided!</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just create the initial state by sampling using  a Gaussian.</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="fu">randn</span>(rng, LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(x), <span class="fu">MALAState</span>(x)</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Equipped with this, we no longer need to provide the <code>initial_state</code> everywhere:</p>
<div id="38" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -4.9777      0.987177
  0.00542088  0.991205
  5.00134     1.01133</code></pre>
</div>
</div>
</section>
<section id="using-our-sampler-with-turing.jl" class="level2">
<h2 class="anchored" data-anchor-id="using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</h2>
<p>As we promised, all of this hassle of implementing our <code>MALA</code> sampler in a way that uses <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> and <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> gets us something more than <em>just</em> an “automatic” implementation of <code>AbstractMCMC.sample</code>.</p>
<p>It also enables use with Turing.jl through the <code>externalsampler</code>, but we need to do one final thing first: we need to tell Turing.jl how to extract a vector of parameters from the “sample” returned in our implementation of <code>AbstractMCMC.step</code>. In our case, the “sample” is a <code>MALASample</code>, so we just need the following line:</p>
<div id="40" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load Turing.jl.</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Turing</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Overload the `getparams` method for our "sample" type, which is just a vector.</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>Turing.Inference.<span class="fu">getparams</span>(<span class="op">::</span><span class="dt">Turing.Model</span>, sample<span class="op">::</span><span class="dt">MALASample</span>) <span class="op">=</span> sample.x</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And with that, we’re good to go!</p>
<div id="42" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Our previous model defined as a Turing.jl model.</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">mvnormal_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">MvNormal</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.], I)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate our model.</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">mvnormal_model</span>()</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Call `sample` but now we're passing in a Turing.jl `model` and wrapping</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co"># our `MALA` sampler in the `externalsampler` to tell Turing.jl that the sampler</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co"># expects something that implements LogDensityProblems.jl.</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×4×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 2.48 seconds
Compute duration  = 2.48 seconds
parameters        = x[1], x[2], x[3]
internals         = lp

Summary Statistics
  parameters      mean       std      mcse    ess_bulk    ess_tail      rhat   ⋯
      Symbol   Float64   Float64   Float64     Float64     Float64   Float64   ⋯

        x[1]   -5.0117    1.0067    0.0176   3271.7315   5323.7042    1.0000   ⋯
        x[2]   -0.0015    0.9802    0.0169   3358.6536   5353.5125    1.0004   ⋯
        x[3]    5.0021    0.9997    0.0175   3277.1496   5171.9624    1.0016   ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

        x[1]   -6.9799   -5.6984   -5.0053   -4.3245   -3.0700
        x[2]   -1.9317   -0.6564    0.0084    0.6536    1.9287
        x[3]    2.9720    4.3387    4.9993    5.6913    6.9361</code></pre>
</div>
</div>
<p>Pretty neat, eh?</p>
<section id="models-with-constrained-parameters" class="level3">
<h3 class="anchored" data-anchor-id="models-with-constrained-parameters">Models with constrained parameters</h3>
<p>One thing we’ve sort of glossed over in all of the above is that MALA, at least how we’ve implemented it, requires <span class="math inline">\(x\)</span> to live in <span class="math inline">\(\mathbb{R}^d\)</span> for some <span class="math inline">\(d &gt; 0\)</span>. If some of the parameters were in fact constrained, e.g.&nbsp;we were working with a <code>Beta</code> distribution which has support on the interval <span class="math inline">\((0, 1)\)</span>, <em>not</em> on <span class="math inline">\(\mathbb{R}^d\)</span>, we could easily end up outside of the valid range <span class="math inline">\((0, 1)\)</span>.</p>
<div id="44" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">beta_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">beta_model</span>()</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 1.48 seconds
Compute duration  = 1.48 seconds
parameters        = x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse    ess_bulk    ess_tail      rhat   ⋯
      Symbol   Float64   Float64   Float64     Float64     Float64   Float64   ⋯

           x    0.5008    0.1888    0.0028   4275.7758   5352.9686    1.0000   ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

           x    0.1418    0.3639    0.4985    0.6386    0.8562</code></pre>
</div>
</div>
<p>Yep, that still works, but only because Turing.jl actually <em>transforms</em> the <code>turing_model</code> from constrained to unconstrained, so that the <code>sampler</code> provided to <code>externalsampler</code> is actually always working in unconstrained space! This is not always desirable, so we can turn this off:</p>
<div id="46" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 0.24 seconds
Compute duration  = 0.24 seconds
parameters        = x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse     ess_bulk   ess_tail      rhat   ⋯
      Symbol   Float64   Float64   Float64      Float64    Float64   Float64   ⋯

           x    0.9840    0.0149    0.0001   10000.0008        NaN    1.0000   ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

           x    0.9841    0.9841    0.9841    0.9841    0.9841</code></pre>
</div>
</div>
<p>The fun thing is that this still sort of works because</p>
<div id="48" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">logpdf</span>(<span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>), <span class="fl">10.0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-Inf</code></pre>
</div>
</div>
<p>and so the samples that fall outside of the range are always rejected. But do notice how much worse all the diagnostics are, e.g.&nbsp;<code>ess_tail</code> is very poor compared to when we use <code>unconstrained=true</code>. Moreover, in more complex cases this won’t just result in a “nice” <code>-Inf</code> log-density value, but instead will error:</p>
<div id="50" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="kw">function</span> <span class="fu">demo</span>()</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>    σ² <span class="op">~</span> <span class="fu">truncated</span>(<span class="fu">Normal</span>(), lower<span class="op">=</span><span class="fl">0</span>)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If we end up with negative values for `σ²`, the `Normal` will error.</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>    x <span class="op">~</span> <span class="fu">Normal</span>(<span class="fl">0</span>, σ²)</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 2.3 seconds
Compute duration  = 2.3 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse   ess_bulk   ess_tail      rhat   e ⋯
      Symbol   Float64   Float64   Float64    Float64    Float64   Float64     ⋯

          σ²    0.3439    0.0000    0.0000        NaN        NaN       NaN     ⋯
           x    2.1833    0.0000    0.0000        NaN        NaN       NaN     ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

          σ²    0.3439    0.3439    0.3439    0.3439    0.3439
           x    2.1833    2.1833    2.1833    2.1833    2.1833</code></pre>
</div>
</div>
<p>As expected, we run into a <code>DomainError</code> at some point, while if we set <code>unconstrained=true</code>, letting Turing.jl transform the model to a unconstrained form behind the scenes, everything works as expected:</p>
<div id="52" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 0.54 seconds
Compute duration  = 0.54 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse   ess_bulk   ess_tail      rhat   e ⋯
      Symbol   Float64   Float64   Float64    Float64    Float64   Float64     ⋯

          σ²    0.8550    0.5448    0.0193   517.4081   258.1686    1.0043     ⋯
           x    0.0390    0.9104    0.0417   660.3591   377.4651    1.0068     ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

          σ²    0.1365    0.4004    0.7508    1.1911    2.1447
           x   -1.8476   -0.4303   -0.0034    0.4253    2.1922</code></pre>
</div>
</div>
<p>Neat!</p>
<p>Similarly, which automatic differentiation backend one should use can be specified through the <code>adtype</code> keyword argument too. For example, if we want to use <a href="https://github.com/JuliaDiff/ReverseDiff.jl">ReverseDiff.jl</a> instead of the default <a href="https://github.com/JuliaDiff/ForwardDiff.jl">ForwardDiff.jl</a>:</p>
<div id="54" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">ReverseDiff</span>: ReverseDiff</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify that we want to use `AutoReverseDiff`.</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">demo</span>(),</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>, adtype<span class="op">=</span><span class="fu">AutoReverseDiff</span>()),</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>;</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 2.95 seconds
Compute duration  = 2.95 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse   ess_bulk   ess_tail      rhat   e ⋯
      Symbol   Float64   Float64   Float64    Float64    Float64   Float64     ⋯

          σ²    0.7715    0.5861    0.0551    62.1528    23.2344    1.0157     ⋯
           x    0.0712    0.9787    0.0830   238.8807   103.6754    1.0038     ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

          σ²    0.0968    0.2817    0.6379    1.1127    2.1910
           x   -1.9458   -0.3383   -0.0433    0.4326    2.4114</code></pre>
</div>
</div>
<p>Double-neat.</p>
</section>
</section>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<p>At this point it’s worth maybe reminding ourselves what we did and also <em>why</em> we did it:</p>
<ol type="1">
<li>We define our models in the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface because it makes the sampler agnostic to how the underlying model is implemented.</li>
<li>We implement our sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> interface, which just means that our sampler is a subtype of <code>AbstractMCMC.AbstractSampler</code> and we implement the MCMC transition in <code>AbstractMCMC.step</code>.</li>
<li>Points 1 and 2 makes it so our sampler can be used with a wide range of model implementations, amongst them being models implemented in both Turing.jl and Stan. This gives you, the inference implementer, a large collection of models to test your inference method on, in addition to allowing users of Turing.jl and Stan to try out your inference method with minimal effort.</li>
</ol>


</section>


<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a><div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>We’re going with the leapfrog formulation because in a future version of this tutorial we’ll add a section extending this simple “baseline” MALA sampler to more complex versions. See <a href="https://github.com/TuringLang/docs/issues/479">issue #479</a> for progress on this.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>There is no such thing as a proper interface in Julia (at least not officially), and so we use the word “interface” here to mean a few minimal methods that needs to be implemented by any type that we treat as a target model.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/turinglang\.org\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../tutorials/docs-07-for-developers-variational-inference/index.html" class="pagination-link" aria-label="Variational Inference">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Variational Inference</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Turing is created by <a href="http://mlg.eng.cam.ac.uk/hong/" target="_blank">Hong Ge</a>, and lovingly maintained by the <a href="https://github.com/TuringLang/Turing.jl/graphs/contributors" target="_blank">core team</a> of volunteers. <br> The contents of this website are © 2024 under the terms of the <a href="https://github.com/TuringLang/Turing.jl/blob/master/LICENCE" target="_blank">MIT License</a>.</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/TuringLang/docs/edit/master/tutorials/docs-17-implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/docs/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://x.com/TuringLang">
      <i class="bi bi-twitter" role="img" aria-label="Turing Twitter">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/TuringLang/Turing.jl">
      <i class="bi bi-github" role="img" aria-label="Turing GitHub">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




<script src="../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>