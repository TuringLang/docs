<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.31">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Implementing Samplers – Turing.jl</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<link href="../../../developers/inference/variational-inference/index.html" rel="prev">
<link href="../../../assets/favicon.ico" rel="icon">
<script src="../../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-e1a5c8363afafaef2c763b6775fbf3ca.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-dark-8ef56b68f8fa1e9d2ba328e99e439f80.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-e1a5c8363afafaef2c763b6775fbf3ca.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap-adfd425b459c6192e2aaf302ef6f29d8.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../../site_libs/bootstrap/bootstrap-dark-0c340ff1686979d72b89a501eb484056.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="../../../site_libs/bootstrap/bootstrap-adfd425b459c6192e2aaf302ef6f29d8.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<style>
  a {
    text-decoration: none;
  }
  a:hover {
    text-decoration: underline;
  }
</style>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../../theming/styles.css">
</head>

<body class="nav-sidebar floating nav-fixed quarto-light"><script id="quarto-html-before-body" type="application/javascript">
    const toggleBodyColorMode = (bsSheetEl) => {
      const mode = bsSheetEl.getAttribute("data-mode");
      const bodyEl = window.document.querySelector("body");
      if (mode === "dark") {
        bodyEl.classList.add("quarto-dark");
        bodyEl.classList.remove("quarto-light");
      } else {
        bodyEl.classList.add("quarto-light");
        bodyEl.classList.remove("quarto-dark");
      }
    }
    const toggleBodyColorPrimary = () => {
      const bsSheetEl = window.document.querySelector("link#quarto-bootstrap:not([rel=disabled-stylesheet])");
      if (bsSheetEl) {
        toggleBodyColorMode(bsSheetEl);
      }
    }
    const setColorSchemeToggle = (alternate) => {
      const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
      for (let i=0; i < toggles.length; i++) {
        const toggle = toggles[i];
        if (toggle) {
          if (alternate) {
            toggle.classList.add("alternate");
          } else {
            toggle.classList.remove("alternate");
          }
        }
      }
    };
    const toggleColorMode = (alternate) => {
      // Switch the stylesheets
      const primaryStylesheets = window.document.querySelectorAll('link.quarto-color-scheme:not(.quarto-color-alternate)');
      const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
      manageTransitions('#quarto-margin-sidebar .nav-link', false);
      if (alternate) {
        // note: dark is layered on light, we don't disable primary!
        enableStylesheet(alternateStylesheets);
        for (const sheetNode of alternateStylesheets) {
          if (sheetNode.id === "quarto-bootstrap") {
            toggleBodyColorMode(sheetNode);
          }
        }
      } else {
        disableStylesheet(alternateStylesheets);
        enableStylesheet(primaryStylesheets)
        toggleBodyColorPrimary();
      }
      manageTransitions('#quarto-margin-sidebar .nav-link', true);
      // Switch the toggles
      setColorSchemeToggle(alternate)
      // Hack to workaround the fact that safari doesn't
      // properly recolor the scrollbar when toggling (#1455)
      if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
        manageTransitions("body", false);
        window.scrollTo(0, 1);
        setTimeout(() => {
          window.scrollTo(0, 0);
          manageTransitions("body", true);
        }, 40);
      }
    }
    const disableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        stylesheet.rel = 'disabled-stylesheet';
      }
    }
    const enableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        if(stylesheet.rel !== 'stylesheet') { // for Chrome, which will still FOUC without this check
          stylesheet.rel = 'stylesheet';
        }
      }
    }
    const manageTransitions = (selector, allowTransitions) => {
      const els = window.document.querySelectorAll(selector);
      for (let i=0; i < els.length; i++) {
        const el = els[i];
        if (allowTransitions) {
          el.classList.remove('notransition');
        } else {
          el.classList.add('notransition');
        }
      }
    }
    const isFileUrl = () => {
      return window.location.protocol === 'file:';
    }
    const hasAlternateSentinel = () => {
      let styleSentinel = getColorSchemeSentinel();
      if (styleSentinel !== null) {
        return styleSentinel === "alternate";
      } else {
        return false;
      }
    }
    const setStyleSentinel = (alternate) => {
      const value = alternate ? "alternate" : "default";
      if (!isFileUrl()) {
        window.localStorage.setItem("quarto-color-scheme", value);
      } else {
        localAlternateSentinel = value;
      }
    }
    const getColorSchemeSentinel = () => {
      if (!isFileUrl()) {
        const storageValue = window.localStorage.getItem("quarto-color-scheme");
        return storageValue != null ? storageValue : localAlternateSentinel;
      } else {
        return localAlternateSentinel;
      }
    }
    const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
      const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
      const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
      let newTheme = '';
      if(authorPrefersDark) {
        newTheme = isAlternate ? baseTheme : alternateTheme;
      } else {
        newTheme = isAlternate ? alternateTheme : baseTheme;
      }
      const changeGiscusTheme = () => {
        // From: https://github.com/giscus/giscus/issues/336
        const sendMessage = (message) => {
          const iframe = document.querySelector('iframe.giscus-frame');
          if (!iframe) return;
          iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
        }
        sendMessage({
          setConfig: {
            theme: newTheme
          }
        });
      }
      const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
      if (isGiscussLoaded) {
        changeGiscusTheme();
      }
    };
    const authorPrefersDark = false;
    const darkModeDefault = authorPrefersDark;
      document.querySelector('link#quarto-text-highlighting-styles.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
      document.querySelector('link#quarto-bootstrap.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
    let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
    // Dark / light mode switch
    window.quartoToggleColorScheme = () => {
      // Read the current dark / light value
      let toAlternate = !hasAlternateSentinel();
      toggleColorMode(toAlternate);
      setStyleSentinel(toAlternate);
      toggleGiscusIfUsed(toAlternate, darkModeDefault);
      window.dispatchEvent(new Event('resize'));
    };
    // Switch to dark mode if need be
    if (hasAlternateSentinel()) {
      toggleColorMode(true);
    } else {
      toggleColorMode(false);
    }
  </script>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="https://turinglang.org/" class="navbar-brand navbar-brand-logo">
    <img src="../../../assets/images/turing-logo.svg" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="https://turinglang.org/">
    <span class="navbar-title">Turing.jl</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../getting-started/"> 
<span class="menu-text">Get Started</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../tutorials/coin-flipping/"> 
<span class="menu-text">Tutorials</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../faq/"> 
<span class="menu-text">FAQ</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/library/"> 
<span class="menu-text">Libraries</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/news/"> 
<span class="menu-text">News</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/team/"> 
<span class="menu-text">Team</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-v0.38" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">v0.38</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-v0.38">    
        <li>
    <a class="dropdown-item" href="https://turinglang.org/docs/changelog.html">
 <span class="dropdown-text">Changelog</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://turinglang.org/docs/versions.html">
 <span class="dropdown-text">All Versions</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools tools-wide">
    <a href="https://x.com/TuringLang" title="Turing Twitter" class="quarto-navigation-tool px-1" aria-label="Turing Twitter"><i class="bi bi-twitter"></i></a>
    <a href="https://github.com/TuringLang/Turing.jl" title="Turing GitHub" class="quarto-navigation-tool px-1" aria-label="Turing GitHub"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../../developers/contributing/index.html">Developers</a></li><li class="breadcrumb-item"><a href="../../../developers/inference/variational-inference/index.html">Inference in Detail</a></li><li class="breadcrumb-item"><a href="../../../developers/inference/implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../getting-started/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Getting Started</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../core-functionality/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Core Functionality</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false">
 <span class="menu-text">User Guide</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/automatic-differentiation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Automatic Differentiation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/custom-distribution/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Custom Distributions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/probability-interface/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Querying Model Probabilities</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/modifying-logprob/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Modifying the Log Probability</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/tracking-extra-quantities/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Tracking Extra Quantities</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/mode-estimation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Mode Estimation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/performance-tips/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Performance Tips</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/sampler-visualisation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Sampler Visualization</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/dynamichmc/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using DynamicHMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/external-samplers/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using External Samplers</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/troubleshooting/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Troubleshooting</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false">
 <span class="menu-text">Tutorials</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/coin-flipping/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction: Coin Flipping</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/gaussian-mixture-models/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Mixture Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-neural-networks/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Neural Networks</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/hidden-markov-models/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Hidden Markov Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-linear-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Linear Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/infinite-mixture-models/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Infinite Mixture Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-poisson-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Poisson Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/multinomial-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Multinomial Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-differential-equations/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Differential Equations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/probabilistic-pca/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Probabilistic PCA</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-time-series-analysis/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Time Series Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/gaussian-processes-introduction/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Processes: Introduction</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/gaussian-process-latent-variable-models/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Process Latent Variable Models</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Developers</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/contributing/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Contributing</span></a>
  </div>
</li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false">
 <span class="menu-text">DynamicPPL’s Compiler</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/compiler/model-manual/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Manually Defining a Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/compiler/minituring-compiler/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation I: Compiler</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/compiler/minituring-contexts/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation II: Contexts</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/compiler/design-overview/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Turing Compiler Design (Outdated)</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false">
 <span class="menu-text">Variable Transformations</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/transforms/distributions/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Distributions and the Jacobian</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/transforms/bijectors/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bijectors in MCMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/transforms/dynamicppl/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variable transformations in DynamicPPL</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true">
 <span class="menu-text">Inference in Detail</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/inference/variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/inference/implementing-samplers/index.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Implementing Samplers</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of Contents</h2>
   
  <ul>
  <li><a href="#quick-overview-of-mala" id="toc-quick-overview-of-mala" class="nav-link active" data-scroll-target="#quick-overview-of-mala">Quick overview of MALA</a></li>
  <li><a href="#what-we-need-from-a-model-logdensityproblems.jl" id="toc-what-we-need-from-a-model-logdensityproblems.jl" class="nav-link" data-scroll-target="#what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: LogDensityProblems.jl</a></li>
  <li><a href="#implementing-mala-in-abstractmcmc.jl" id="toc-implementing-mala-in-abstractmcmc.jl" class="nav-link" data-scroll-target="#implementing-mala-in-abstractmcmc.jl">Implementing MALA in AbstractMCMC.jl</a></li>
  <li><a href="#using-our-sampler-with-turing.jl" id="toc-using-our-sampler-with-turing.jl" class="nav-link" data-scroll-target="#using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</a>
  <ul class="collapse">
  <li><a href="#models-with-constrained-parameters" id="toc-models-with-constrained-parameters" class="nav-link" data-scroll-target="#models-with-constrained-parameters">Models with constrained parameters</a></li>
  </ul></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/TuringLang/docs/edit/main/developers/inference/implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/docs/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">


<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../../developers/contributing/index.html">Developers</a></li><li class="breadcrumb-item"><a href="../../../developers/inference/variational-inference/index.html">Inference in Detail</a></li><li class="breadcrumb-item"><a href="../../../developers/inference/implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Implementing Samplers</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>In this tutorial, we’ll go through step-by-step how to implement a “simple” sampler in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> in such a way that it can be easily applied to Turing.jl models.</p>
<p>In particular, we’re going to implement a version of <strong>Metropolis-adjusted Langevin (MALA)</strong>.</p>
<p>Note that we will implement this sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> framework, completely “ignoring” Turing.jl until the very end of the tutorial, at which point we’ll use a single line of code to make the resulting sampler available to Turing.jl. This is to really drive home the point that one can implement samplers in a way that is accessible to all of Turing.jl’s users without having to use Turing.jl yourself.</p>
<section id="quick-overview-of-mala" class="level2">
<h2 class="anchored" data-anchor-id="quick-overview-of-mala">Quick overview of MALA</h2>
<p>We can view MALA as a single step of the leapfrog intergrator with resampling of momentum <span class="math inline">\(p\)</span> at every step.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> To make that statement a bit more concrete, we first define the <em>extended</em> target <span class="math inline">\(\bar{\gamma}(x, p)\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\log \bar{\gamma}(x, p) \propto \log \gamma(x) + \log \gamma_{\mathcal{N}(0, M)}(p)
\end{equation*}\]</span></p>
<p>where <span class="math inline">\(\gamma_{\mathcal{N}(0, M)}\)</span> denotes the density for a zero-centered Gaussian with covariance matrix <span class="math inline">\(M\)</span>. We then consider targeting this joint distribution over both <span class="math inline">\(x\)</span> and <span class="math inline">\(p\)</span> as follows. First we define the map</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  L_{\epsilon}: \quad &amp; \mathbb{R}^d \times \mathbb{R}^d \to \mathbb{R}^d \times \mathbb{R}^d \\
  &amp; (x, p) \mapsto (\tilde{x}, \tilde{p}) := L_{\epsilon}(x, p)
\end{split}
\end{equation*}\]</span></p>
<p>as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p_{1 / 2} &amp;:= p + \frac{\epsilon}{2} \nabla \log \gamma(x) \\
  \tilde{x} &amp;:= x + \epsilon M^{-1} p_{1 /2 } \\
  p_1 &amp;:= p_{1 / 2} + \frac{\epsilon}{2} \nabla \log \gamma(\tilde{x}) \\
  \tilde{p} &amp;:= - p_1
\end{split}
\end{equation*}\]</span></p>
<p>This might be familiar for some readers as a single step of the Leapfrog integrator. We then define the MALA kernel as follows: given the current iterate <span class="math inline">\(x_i\)</span>, we sample the next iterate <span class="math inline">\(x_{i + 1}\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p &amp;\sim \mathcal{N}(0, M) \\
  (\tilde{x}, \tilde{p}) &amp;:= L_{\epsilon}(x_i, p) \\
  \alpha &amp;:= \min \left\{ 1, \frac{\bar{\gamma}(\tilde{x}, \tilde{p})}{\bar{\gamma}(x_i, p)} \right\} \\
  x_{i + 1} &amp;:=
  \begin{cases}
    \tilde{x} \quad &amp; \text{ with prob. } \alpha \\
    x_i       \quad &amp; \text{ with prob. } 1 - \alpha
  \end{cases}
\end{split}
\end{equation*}\]</span></p>
<p>i.e.&nbsp;we accept the proposal <span class="math inline">\(\tilde{x}\)</span> with probability <span class="math inline">\(\alpha\)</span> and reject it, thus sticking with our current iterate, with probability <span class="math inline">\(1 - \alpha\)</span>.</p>
</section>
<section id="what-we-need-from-a-model-logdensityproblems.jl" class="level2">
<h2 class="anchored" data-anchor-id="what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a></h2>
<p>There are a few things we need from the “target” / “model” / density that we want to sample from:</p>
<ol type="1">
<li>We need access to log-density <em>evaluations</em> <span class="math inline">\(\log \gamma(x)\)</span> so we can compute the acceptance ratio involving <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>We need access to log-density <em>gradients</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span> so we can compute the Leapfrog steps <span class="math inline">\(L_{\epsilon}(x, p)\)</span>.</li>
<li>We also need access to the “size” of the model so we can determine the size of <span class="math inline">\(M\)</span>.</li>
</ol>
<p>Luckily for us, there is a package called <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> which provides an interface for <em>exactly</em> this!</p>
<p>To demonstrate how one can implement the “<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface”<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> we will use a simple Gaussian model as an example:</p>
<div id="4" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblems</span>: LogDensityProblems;</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's define some type that represents the model.</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> IsotropicNormalModel{M<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"mean of the isotropic Gaussian"</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    mean<span class="op">::</span><span class="dt">M</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Specifies what input length the model expects.</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">dimension</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> <span class="fu">length</span>(model.mean)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Implementation of the log-density evaluation of the model.</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x<span class="op">::</span><span class="dt">AbstractVector{&lt;:Real}</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">-</span> <span class="fu">sum</span>(abs2, x <span class="op">.-</span> model.mean) <span class="op">/</span> <span class="fl">2</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This gives us all of the properties we want for our MALA sampler with the exception of the computation of the <em>gradient</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span>. There is the method <code>LogDensityProblems.logdensity_and_gradient</code> which should return a 2-tuple where the first entry is the evaluation of the logdensity <span class="math inline">\(\log \gamma(x)\)</span> and the second entry is the gradient <span class="math inline">\(\nabla \log \gamma(x)\)</span>.</p>
<p>There are two ways to “implement” this method: 1) we implement it by hand, which is feasible in the case of our <code>IsotropicNormalModel</code>, or b) we defer the implementation of this to a automatic differentiation backend.</p>
<p>To implement it by hand we can simply do</p>
<div id="6" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl that first-order, i.e. gradient information, is available.</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{1}</span>()</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Implement `logdensity_and_gradient`.</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    logγ_x <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="op">-</span>x <span class="op">.*</span> (x <span class="op">-</span> model.mean)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> logγ_x, ∇logγ_x</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s just try it out:</p>
<div id="8" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate the problem.</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> <span class="fu">IsotropicNormalModel</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.])</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create some example input that we can test on.</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>x_example <span class="op">=</span> <span class="fu">randn</span>(LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate!</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-32.64920122106047</code></pre>
</div>
</div>
<p>To defer it to an automatic differentiation backend, we can do</p>
<div id="10" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl we only have access to 0-th order information.</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{0}</span>()</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Use `LogDensityProblemsAD`'s `ADgradient` in combination with some AD backend to implement `logdensity_and_gradient`.</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblemsAD</span>, <span class="bu">ADTypes</span>, <span class="bu">ForwardDiff</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>model_with_grad <span class="op">=</span> <span class="fu">ADgradient</span>(<span class="fu">AutoForwardDiff</span>(), model)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model_with_grad, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-32.64920122106047</code></pre>
</div>
</div>
<p>We’ll continue with the second approach in this tutorial since this is typically what one does in practice, because there are better hobbies to spend time on than deriving gradients by hand.</p>
<p>At this point, one might wonder how we’re going to tie this back to Turing.jl in the end. Effectively, when working with inference methods that only require log-density evaluations and / or higher-order information of the log-density, Turing.jl actually converts the user-provided <code>Model</code> into an object implementing the above methods for <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>. As a result, most samplers provided by Turing.jl are actually implemented to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, enabling their use both <em>within</em> Turing.jl and <em>outside</em> of Turing.jl! Morever, there exists similar conversions for Stan through BridgeStan and Stan<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, which means that a sampler supporting the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface can easily be used on both Turing.jl <em>and</em> Stan models (in addition to user-provided models, as our <code>IsotropicNormalModel</code> above)!</p>
<p>Anyways, let’s move on to actually implementing the sampler.</p>
</section>
<section id="implementing-mala-in-abstractmcmc.jl" class="level2">
<h2 class="anchored" data-anchor-id="implementing-mala-in-abstractmcmc.jl">Implementing MALA in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a></h2>
<p>Now that we’ve established that a model implementing the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface provides us with all the information we need from <span class="math inline">\(\log \gamma(x)\)</span>, we can address the question: given an object that implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, how can we define a sampler for it?</p>
<p>We’re going to do this by making our sampler a sub-type of <code>AbstractMCMC.AbstractSampler</code> in addition to implementing a few methods from <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>. Why? Because it gets us <em>a lot</em> of functionality for free, as we will see later.</p>
<p>Moreover, <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> provides a very natural interface for MCMC algorithms.</p>
<p>First, we’ll define our <code>MALA</code> type</p>
<div id="12" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">AbstractMCMC</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALA{T,A} <span class="op">&lt;:</span><span class="dt"> AbstractMCMC.AbstractSampler</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"stepsize used in the leapfrog step"</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    ϵ_init<span class="op">::</span><span class="dt">T</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"covariance matrix used for the momentum"</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    M_init<span class="op">::</span><span class="dt">A</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notice how we’ve added the suffix <code>_init</code> to both the stepsize and the covariance matrix. We’ve done this because a <code>AbstractMCMC.AbstractSampler</code> should be <em>immutable</em>. Of course there might be many scenarios where we want to allow something like the stepsize and / or the covariance matrix to vary between iterations, e.g.&nbsp;during the burn-in / adaptation phase of the sampling process we might want to adjust the parameters using statistics computed from these initial iterations. But information which can change between iterations <em>should not go in the sampler itself</em>! Instead, this information should go in the sampler <em>state</em>.</p>
<p>The sampler state should at the very least contain all the necessary information to perform the next MCMC iteration, but usually contains further information, e.g.&nbsp;quantities and statistics useful for evaluating whether the sampler has converged.</p>
<p>We will use the following sampler state for our <code>MALA</code> sampler:</p>
<div id="14" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALAState{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This might seem overly redundant: we’re defining a type <code>MALAState</code> and it only contains a simple vector of reals. In this particular case we indeed could have dropped this and simply used a <code>AbstractVector{&lt;:Real}</code> as our sampler state, but typically, as we will see later, one wants to include other quantities in the sampler state. For example, if we also wanted to adapt the parameters of our <code>MALA</code>, e.g.&nbsp;alter the stepsize depending on acceptance rates, in which case we should also put <code>ϵ</code> in the state, but for now we’ll keep things simple.</p>
<p>Moreover, we also want a <em>sample</em> type, which is a type meant for “public consumption”, i.e.&nbsp;the end-user. This is generally going to contain a subset of the information present in the state. But in such a simple scenario as this, we similarly only have a <code>AbstractVector{&lt;:Real}</code>:</p>
<div id="16" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALASample{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We currently have three things:</p>
<ol type="1">
<li>A <code>AbstractMCMC.AbstractSampler</code> implementation called <code>MALA</code>.</li>
<li>A state <code>MALAState</code> for our sampler <code>MALA</code>.</li>
<li>A sample <code>MALASample</code> for our sampler <code>MALA</code>.</li>
</ol>
<p>That means that we’re ready to implement the only thing that really matters: <code>AbstractMCMC.step</code>.</p>
<p><code>AbstractMCMC.step</code> defines the MCMC iteration of our <code>MALA</code> given the current <code>MALAState</code>. Specifically, the signature of the function is as follows:</p>
<div id="18" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The RNG to ensure reproducibility.</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The model that defines our target.</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.AbstractModel</span>,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The sampler for which we're taking a `step`.</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">AbstractMCMC.AbstractSampler</span>,</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The current sampler `state`.</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    state;</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Additional keyword arguments that we may or may not need.</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Moreover, there is a specific <code>AbstractMCMC.AbstractModel</code> which is used to indicate that the model that is provided implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface: <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Since, as we discussed earlier, in our case we’re indeed going to work with types that support the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, we’ll define <code>AbstractMCMC.step</code> for such a <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Note that <code>AbstractMCMC.LogDensityModel</code> has no other purpose; it has a single field called <code>logdensity</code>, and it does nothing else. But by wrapping the model in <code>AbstractMCMC.LogDensityModel</code>, it allows samplers that want to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> to define their <code>AbstractMCMC.step</code> on this type without running into method ambiguities.</p>
<p>All in all, that means that the signature for our <code>AbstractMCMC.step</code> is going to be the following:</p>
<div id="20" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># `LogDensityModel` so we know we're working with LogDensityProblems.jl model.</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler.</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler state.</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Great! Now let’s actually implement the full <code>AbstractMCMC.step</code> for our <code>MALA</code>.</p>
<p>Let’s remind ourselves what we’re going to do:</p>
<ol type="1">
<li>Sample a new momentum <span class="math inline">\(p\)</span>.</li>
<li>Compute the log-density of the extended target <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>Take a single leapfrog step <span class="math inline">\((\tilde{x}, \tilde{p}) = L_{\epsilon}(x, p)\)</span>.</li>
<li>Accept or reject the proposed <span class="math inline">\((\tilde{x}, \tilde{p})\)</span>.</li>
</ol>
<p>All in all, this results in the following:</p>
<div id="22" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>: Random</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Distributions</span>  <span class="co"># so we get the `MvNormal`</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the wrapped model which implements LogDensityProblems.jl.</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just extract the sampler parameters to make our lives easier.</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    ϵ <span class="op">=</span> sampler.ϵ_init</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    M <span class="op">=</span> sampler.M_init</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the current parameters.</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> state.x</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sample the momentum.</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>    p_dist <span class="op">=</span> <span class="fu">MvNormal</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)), M)</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> <span class="fu">rand</span>(rng, p_dist)</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Propose using a single leapfrog step.</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>    x̃, p̃ <span class="op">=</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Accept or reject proposal.</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>    logp <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p)</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>    logp̃ <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x̃) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p̃)</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>    logα <span class="op">=</span> logp̃ <span class="op">-</span> logp</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>    state_new <span class="op">=</span> <span class="cf">if</span> <span class="fu">log</span>(<span class="fu">rand</span>(rng)) <span class="op">&lt;</span> logα</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Accept.</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x̃)</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Reject.</span></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x)</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return the "sample" and the sampler state.</span></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(state_new.x), state_new</span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Fairly straight-forward.</p>
<p>Of course, we haven’t defined the <code>leapfrog_step</code> method yet, so let’s do that:</p>
<div id="24" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p` using "position" `x`.</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x))</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    p1 <span class="op">=</span> p <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update the "position" `x` using momentum `p1`.</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    x̃ <span class="op">=</span> x <span class="op">+</span> ϵ <span class="op">.*</span> (M <span class="op">\</span> p1)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p1` using position `x̃`</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x̃ <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x̃))</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    p2 <span class="op">=</span> p1 <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x̃</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Flip momentum `p2`.</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    p̃ <span class="op">=</span> <span class="op">-</span>p2</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x̃, p̃</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>leapfrog_step (generic function with 1 method)</code></pre>
</div>
</div>
<p>With all of this, we’re technically ready to sample!</p>
<div id="26" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>, <span class="bu">LinearAlgebra</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>rng <span class="op">=</span> <span class="bu">Random</span>.<span class="fu">default_rng</span>()</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>sampler <span class="op">=</span> <span class="fu">MALA</span>(<span class="fl">1</span>, I)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>state <span class="op">=</span> <span class="fu">MALAState</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)))</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>x_next, state_next <span class="op">=</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    rng,</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    AbstractMCMC.<span class="fu">LogDensityModel</span>(model),</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    state</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>(MALASample{Vector{Float64}}([0.0, 0.0, 0.0]), MALAState{Vector{Float64}}([0.0, 0.0, 0.0]))</code></pre>
</div>
</div>
<p>Great, it works!</p>
<p>And I promised we would get quite some functionality for free if we implemented <code>AbstractMCMC.step</code>, and so we can now simply call <code>sample</code> to perform standard MCMC sampling:</p>
<div id="28" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform 1000 iterations with our `MALA` sampler.</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; initial_state<span class="op">=</span>state, progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Concatenate into a matrix.</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000 Matrix{Float64}:
 -3.79242     -4.56284    -4.71393  …  -4.77026   -5.36592  -5.36592
  0.00395005   0.0951893  -1.25741      0.429633  -1.05784  -1.05784
  1.64188      3.51733     4.55926      5.8737     5.54945   5.54945</code></pre>
</div>
</div>
<div id="30" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the marginal means and standard deviations.</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -4.98127    1.00345
 -0.0068824  0.988008
  4.98166    1.00533</code></pre>
</div>
</div>
<p>Let’s visualize the samples</p>
<div id="32" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">StatsPlots</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">transpose</span>(samples_matrix[<span class="op">:</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">:</span><span class="kw">end</span>]), alpha<span class="op">=</span><span class="fl">0.5</span>, legend<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<!--?xml version="1.0" encoding="utf-8"?-->
<svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" width="672" height="480" viewbox="0 0 2688 1920">
<defs>
  <clippath id="clip790">
    <rect x="0" y="0" width="2688" height="1920"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip790)" d="M0 1920 L2688 1920 L2688 0 L0 0  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip791">
    <rect x="537" y="0" width="1883" height="1883"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip790)" d="M196.816 1800.78 L2640.76 1800.78 L2640.76 47.2441 L196.816 47.2441  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip792">
    <rect x="196" y="47" width="2445" height="1755"></rect>
  </clippath>
</defs>
<polyline clip-path="url(#clip792)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="263.676,1800.78 263.676,47.2441 "></polyline>
<polyline clip-path="url(#clip792)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="840.654,1800.78 840.654,47.2441 "></polyline>
<polyline clip-path="url(#clip792)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1417.63,1800.78 1417.63,47.2441 "></polyline>
<polyline clip-path="url(#clip792)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1994.61,1800.78 1994.61,47.2441 "></polyline>
<polyline clip-path="url(#clip792)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="2571.59,1800.78 2571.59,47.2441 "></polyline>
<polyline clip-path="url(#clip792)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,1652.08 2640.76,1652.08 "></polyline>
<polyline clip-path="url(#clip792)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,1408.3 2640.76,1408.3 "></polyline>
<polyline clip-path="url(#clip792)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,1164.53 2640.76,1164.53 "></polyline>
<polyline clip-path="url(#clip792)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,920.76 2640.76,920.76 "></polyline>
<polyline clip-path="url(#clip792)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,676.988 2640.76,676.988 "></polyline>
<polyline clip-path="url(#clip792)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,433.216 2640.76,433.216 "></polyline>
<polyline clip-path="url(#clip792)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,189.444 2640.76,189.444 "></polyline>
<polyline clip-path="url(#clip790)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1800.78 2640.76,1800.78 "></polyline>
<polyline clip-path="url(#clip790)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="263.676,1800.78 263.676,1781.88 "></polyline>
<polyline clip-path="url(#clip790)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="840.654,1800.78 840.654,1781.88 "></polyline>
<polyline clip-path="url(#clip790)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1417.63,1800.78 1417.63,1781.88 "></polyline>
<polyline clip-path="url(#clip790)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1994.61,1800.78 1994.61,1781.88 "></polyline>
<polyline clip-path="url(#clip790)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="2571.59,1800.78 2571.59,1781.88 "></polyline>
<path clip-path="url(#clip790)" d="M263.676 1834 Q260.065 1834 258.236 1837.57 Q256.431 1841.11 256.431 1848.24 Q256.431 1855.34 258.236 1858.91 Q260.065 1862.45 263.676 1862.45 Q267.31 1862.45 269.116 1858.91 Q270.945 1855.34 270.945 1848.24 Q270.945 1841.11 269.116 1837.57 Q267.31 1834 263.676 1834 M263.676 1830.3 Q269.486 1830.3 272.542 1834.9 Q275.621 1839.49 275.621 1848.24 Q275.621 1856.96 272.542 1861.57 Q269.486 1866.15 263.676 1866.15 Q257.866 1866.15 254.787 1861.57 Q251.732 1856.96 251.732 1848.24 Q251.732 1839.49 254.787 1834.9 Q257.866 1830.3 263.676 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip790)" d="M804.346 1861.55 L820.666 1861.55 L820.666 1865.48 L798.721 1865.48 L798.721 1861.55 Q801.383 1858.79 805.967 1854.16 Q810.573 1849.51 811.754 1848.17 Q813.999 1845.65 814.879 1843.91 Q815.782 1842.15 815.782 1840.46 Q815.782 1837.71 813.837 1835.97 Q811.916 1834.23 808.814 1834.23 Q806.615 1834.23 804.161 1835 Q801.731 1835.76 798.953 1837.31 L798.953 1832.59 Q801.777 1831.46 804.231 1830.88 Q806.684 1830.3 808.721 1830.3 Q814.092 1830.3 817.286 1832.98 Q820.481 1835.67 820.481 1840.16 Q820.481 1842.29 819.67 1844.21 Q818.883 1846.11 816.777 1848.7 Q816.198 1849.37 813.096 1852.59 Q809.995 1855.78 804.346 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip790)" d="M830.527 1830.92 L848.883 1830.92 L848.883 1834.86 L834.809 1834.86 L834.809 1843.33 Q835.828 1842.98 836.846 1842.82 Q837.865 1842.64 838.883 1842.64 Q844.67 1842.64 848.05 1845.81 Q851.43 1848.98 851.43 1854.4 Q851.43 1859.97 847.957 1863.08 Q844.485 1866.15 838.166 1866.15 Q835.99 1866.15 833.721 1865.78 Q831.476 1865.41 829.069 1864.67 L829.069 1859.97 Q831.152 1861.11 833.374 1861.66 Q835.596 1862.22 838.073 1862.22 Q842.078 1862.22 844.416 1860.11 Q846.754 1858.01 846.754 1854.4 Q846.754 1850.78 844.416 1848.68 Q842.078 1846.57 838.073 1846.57 Q836.198 1846.57 834.323 1846.99 Q832.471 1847.4 830.527 1848.28 L830.527 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip790)" d="M870.642 1834 Q867.031 1834 865.203 1837.57 Q863.397 1841.11 863.397 1848.24 Q863.397 1855.34 865.203 1858.91 Q867.031 1862.45 870.642 1862.45 Q874.277 1862.45 876.082 1858.91 Q877.911 1855.34 877.911 1848.24 Q877.911 1841.11 876.082 1837.57 Q874.277 1834 870.642 1834 M870.642 1830.3 Q876.453 1830.3 879.508 1834.9 Q882.587 1839.49 882.587 1848.24 Q882.587 1856.96 879.508 1861.57 Q876.453 1866.15 870.642 1866.15 Q864.832 1866.15 861.754 1861.57 Q858.698 1856.96 858.698 1848.24 Q858.698 1839.49 861.754 1834.9 Q864.832 1830.3 870.642 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip790)" d="M1377.25 1830.92 L1395.61 1830.92 L1395.61 1834.86 L1381.53 1834.86 L1381.53 1843.33 Q1382.55 1842.98 1383.57 1842.82 Q1384.59 1842.64 1385.61 1842.64 Q1391.39 1842.64 1394.77 1845.81 Q1398.15 1848.98 1398.15 1854.4 Q1398.15 1859.97 1394.68 1863.08 Q1391.21 1866.15 1384.89 1866.15 Q1382.71 1866.15 1380.44 1865.78 Q1378.2 1865.41 1375.79 1864.67 L1375.79 1859.97 Q1377.88 1861.11 1380.1 1861.66 Q1382.32 1862.22 1384.8 1862.22 Q1388.8 1862.22 1391.14 1860.11 Q1393.48 1858.01 1393.48 1854.4 Q1393.48 1850.78 1391.14 1848.68 Q1388.8 1846.57 1384.8 1846.57 Q1382.92 1846.57 1381.05 1846.99 Q1379.19 1847.4 1377.25 1848.28 L1377.25 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip790)" d="M1417.37 1834 Q1413.75 1834 1411.93 1837.57 Q1410.12 1841.11 1410.12 1848.24 Q1410.12 1855.34 1411.93 1858.91 Q1413.75 1862.45 1417.37 1862.45 Q1421 1862.45 1422.81 1858.91 Q1424.63 1855.34 1424.63 1848.24 Q1424.63 1841.11 1422.81 1837.57 Q1421 1834 1417.37 1834 M1417.37 1830.3 Q1423.18 1830.3 1426.23 1834.9 Q1429.31 1839.49 1429.31 1848.24 Q1429.31 1856.96 1426.23 1861.57 Q1423.18 1866.15 1417.37 1866.15 Q1411.56 1866.15 1408.48 1861.57 Q1405.42 1856.96 1405.42 1848.24 Q1405.42 1839.49 1408.48 1834.9 Q1411.56 1830.3 1417.37 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip790)" d="M1447.53 1834 Q1443.92 1834 1442.09 1837.57 Q1440.28 1841.11 1440.28 1848.24 Q1440.28 1855.34 1442.09 1858.91 Q1443.92 1862.45 1447.53 1862.45 Q1451.16 1862.45 1452.97 1858.91 Q1454.8 1855.34 1454.8 1848.24 Q1454.8 1841.11 1452.97 1837.57 Q1451.16 1834 1447.53 1834 M1447.53 1830.3 Q1453.34 1830.3 1456.39 1834.9 Q1459.47 1839.49 1459.47 1848.24 Q1459.47 1856.96 1456.39 1861.57 Q1453.34 1866.15 1447.53 1866.15 Q1441.72 1866.15 1438.64 1861.57 Q1435.58 1856.96 1435.58 1848.24 Q1435.58 1839.49 1438.64 1834.9 Q1441.72 1830.3 1447.53 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip790)" d="M1952.89 1830.92 L1975.11 1830.92 L1975.11 1832.91 L1962.56 1865.48 L1957.68 1865.48 L1969.48 1834.86 L1952.89 1834.86 L1952.89 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip790)" d="M1984.27 1830.92 L2002.63 1830.92 L2002.63 1834.86 L1988.56 1834.86 L1988.56 1843.33 Q1989.58 1842.98 1990.59 1842.82 Q1991.61 1842.64 1992.63 1842.64 Q1998.42 1842.64 2001.8 1845.81 Q2005.18 1848.98 2005.18 1854.4 Q2005.18 1859.97 2001.7 1863.08 Q1998.23 1866.15 1991.91 1866.15 Q1989.74 1866.15 1987.47 1865.78 Q1985.22 1865.41 1982.82 1864.67 L1982.82 1859.97 Q1984.9 1861.11 1987.12 1861.66 Q1989.34 1862.22 1991.82 1862.22 Q1995.83 1862.22 1998.16 1860.11 Q2000.5 1858.01 2000.5 1854.4 Q2000.5 1850.78 1998.16 1848.68 Q1995.83 1846.57 1991.82 1846.57 Q1989.95 1846.57 1988.07 1846.99 Q1986.22 1847.4 1984.27 1848.28 L1984.27 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip790)" d="M2024.39 1834 Q2020.78 1834 2018.95 1837.57 Q2017.14 1841.11 2017.14 1848.24 Q2017.14 1855.34 2018.95 1858.91 Q2020.78 1862.45 2024.39 1862.45 Q2028.02 1862.45 2029.83 1858.91 Q2031.66 1855.34 2031.66 1848.24 Q2031.66 1841.11 2029.83 1837.57 Q2028.02 1834 2024.39 1834 M2024.39 1830.3 Q2030.2 1830.3 2033.26 1834.9 Q2036.33 1839.49 2036.33 1848.24 Q2036.33 1856.96 2033.26 1861.57 Q2030.2 1866.15 2024.39 1866.15 Q2018.58 1866.15 2015.5 1861.57 Q2012.45 1856.96 2012.45 1848.24 Q2012.45 1839.49 2015.5 1834.9 Q2018.58 1830.3 2024.39 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip790)" d="M2516.11 1861.55 L2523.75 1861.55 L2523.75 1835.18 L2515.44 1836.85 L2515.44 1832.59 L2523.71 1830.92 L2528.38 1830.92 L2528.38 1861.55 L2536.02 1861.55 L2536.02 1865.48 L2516.11 1865.48 L2516.11 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip790)" d="M2555.47 1834 Q2551.85 1834 2550.03 1837.57 Q2548.22 1841.11 2548.22 1848.24 Q2548.22 1855.34 2550.03 1858.91 Q2551.85 1862.45 2555.47 1862.45 Q2559.1 1862.45 2560.9 1858.91 Q2562.73 1855.34 2562.73 1848.24 Q2562.73 1841.11 2560.9 1837.57 Q2559.1 1834 2555.47 1834 M2555.47 1830.3 Q2561.28 1830.3 2564.33 1834.9 Q2567.41 1839.49 2567.41 1848.24 Q2567.41 1856.96 2564.33 1861.57 Q2561.28 1866.15 2555.47 1866.15 Q2549.66 1866.15 2546.58 1861.57 Q2543.52 1856.96 2543.52 1848.24 Q2543.52 1839.49 2546.58 1834.9 Q2549.66 1830.3 2555.47 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip790)" d="M2585.63 1834 Q2582.02 1834 2580.19 1837.57 Q2578.38 1841.11 2578.38 1848.24 Q2578.38 1855.34 2580.19 1858.91 Q2582.02 1862.45 2585.63 1862.45 Q2589.26 1862.45 2591.07 1858.91 Q2592.9 1855.34 2592.9 1848.24 Q2592.9 1841.11 2591.07 1837.57 Q2589.26 1834 2585.63 1834 M2585.63 1830.3 Q2591.44 1830.3 2594.49 1834.9 Q2597.57 1839.49 2597.57 1848.24 Q2597.57 1856.96 2594.49 1861.57 Q2591.44 1866.15 2585.63 1866.15 Q2579.82 1866.15 2576.74 1861.57 Q2573.68 1856.96 2573.68 1848.24 Q2573.68 1839.49 2576.74 1834.9 Q2579.82 1830.3 2585.63 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip790)" d="M2615.79 1834 Q2612.18 1834 2610.35 1837.57 Q2608.54 1841.11 2608.54 1848.24 Q2608.54 1855.34 2610.35 1858.91 Q2612.18 1862.45 2615.79 1862.45 Q2619.42 1862.45 2621.23 1858.91 Q2623.06 1855.34 2623.06 1848.24 Q2623.06 1841.11 2621.23 1837.57 Q2619.42 1834 2615.79 1834 M2615.79 1830.3 Q2621.6 1830.3 2624.65 1834.9 Q2627.73 1839.49 2627.73 1848.24 Q2627.73 1856.96 2624.65 1861.57 Q2621.6 1866.15 2615.79 1866.15 Q2609.98 1866.15 2606.9 1861.57 Q2603.84 1856.96 2603.84 1848.24 Q2603.84 1839.49 2606.9 1834.9 Q2609.98 1830.3 2615.79 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip790)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1800.78 196.816,47.2441 "></polyline>
<polyline clip-path="url(#clip790)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1652.08 215.714,1652.08 "></polyline>
<polyline clip-path="url(#clip790)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1408.3 215.714,1408.3 "></polyline>
<polyline clip-path="url(#clip790)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1164.53 215.714,1164.53 "></polyline>
<polyline clip-path="url(#clip790)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,920.76 215.714,920.76 "></polyline>
<polyline clip-path="url(#clip790)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,676.988 215.714,676.988 "></polyline>
<polyline clip-path="url(#clip790)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,433.216 215.714,433.216 "></polyline>
<polyline clip-path="url(#clip790)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,189.444 215.714,189.444 "></polyline>
<path clip-path="url(#clip790)" d="M50.5475 1652.53 L80.2233 1652.53 L80.2233 1656.46 L50.5475 1656.46 L50.5475 1652.53 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip790)" d="M89.1352 1634.8 L111.357 1634.8 L111.357 1636.79 L98.8111 1669.36 L93.9269 1669.36 L105.732 1638.73 L89.1352 1638.73 L89.1352 1634.8 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip790)" d="M120.478 1663.48 L125.362 1663.48 L125.362 1669.36 L120.478 1669.36 L120.478 1663.48 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip790)" d="M135.593 1634.8 L153.95 1634.8 L153.95 1638.73 L139.876 1638.73 L139.876 1647.2 Q140.894 1646.86 141.913 1646.69 Q142.931 1646.51 143.95 1646.51 Q149.737 1646.51 153.116 1649.68 Q156.496 1652.85 156.496 1658.27 Q156.496 1663.85 153.024 1666.95 Q149.552 1670.03 143.232 1670.03 Q141.056 1670.03 138.788 1669.66 Q136.542 1669.29 134.135 1668.55 L134.135 1663.85 Q136.218 1664.98 138.441 1665.54 Q140.663 1666.09 143.14 1666.09 Q147.144 1666.09 149.482 1663.99 Q151.82 1661.88 151.82 1658.27 Q151.82 1654.66 149.482 1652.55 Q147.144 1650.44 143.14 1650.44 Q141.265 1650.44 139.39 1650.86 Q137.538 1651.28 135.593 1652.16 L135.593 1634.8 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip790)" d="M49.5521 1408.76 L79.2279 1408.76 L79.2279 1412.69 L49.5521 1412.69 L49.5521 1408.76 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip790)" d="M89.3667 1391.02 L107.723 1391.02 L107.723 1394.96 L93.6491 1394.96 L93.6491 1403.43 Q94.6676 1403.08 95.6861 1402.92 Q96.7047 1402.74 97.7232 1402.74 Q103.51 1402.74 106.89 1405.91 Q110.269 1409.08 110.269 1414.5 Q110.269 1420.08 106.797 1423.18 Q103.325 1426.26 97.0056 1426.26 Q94.8297 1426.26 92.5612 1425.89 Q90.3158 1425.52 87.9084 1424.77 L87.9084 1420.08 Q89.9917 1421.21 92.2139 1421.77 Q94.4361 1422.32 96.913 1422.32 Q100.918 1422.32 103.256 1420.21 Q105.593 1418.11 105.593 1414.5 Q105.593 1410.89 103.256 1408.78 Q100.918 1406.67 96.913 1406.67 Q95.038 1406.67 93.163 1407.09 Q91.3112 1407.51 89.3667 1408.39 L89.3667 1391.02 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip790)" d="M119.482 1419.7 L124.367 1419.7 L124.367 1425.58 L119.482 1425.58 L119.482 1419.7 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip790)" d="M144.552 1394.1 Q140.941 1394.1 139.112 1397.67 Q137.306 1401.21 137.306 1408.34 Q137.306 1415.45 139.112 1419.01 Q140.941 1422.55 144.552 1422.55 Q148.186 1422.55 149.991 1419.01 Q151.82 1415.45 151.82 1408.34 Q151.82 1401.21 149.991 1397.67 Q148.186 1394.1 144.552 1394.1 M144.552 1390.4 Q150.362 1390.4 153.417 1395.01 Q156.496 1399.59 156.496 1408.34 Q156.496 1417.07 153.417 1421.67 Q150.362 1426.26 144.552 1426.26 Q138.741 1426.26 135.663 1421.67 Q132.607 1417.07 132.607 1408.34 Q132.607 1399.59 135.663 1395.01 Q138.741 1390.4 144.552 1390.4 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip790)" d="M50.5475 1164.98 L80.2233 1164.98 L80.2233 1168.92 L50.5475 1168.92 L50.5475 1164.98 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip790)" d="M94.3436 1177.88 L110.663 1177.88 L110.663 1181.81 L88.7186 1181.81 L88.7186 1177.88 Q91.3806 1175.12 95.9639 1170.49 Q100.57 1165.84 101.751 1164.5 Q103.996 1161.97 104.876 1160.24 Q105.779 1158.48 105.779 1156.79 Q105.779 1154.03 103.834 1152.3 Q101.913 1150.56 98.8111 1150.56 Q96.6121 1150.56 94.1584 1151.33 Q91.7278 1152.09 88.9501 1153.64 L88.9501 1148.92 Q91.7741 1147.78 94.2278 1147.21 Q96.6815 1146.63 98.7185 1146.63 Q104.089 1146.63 107.283 1149.31 Q110.478 1152 110.478 1156.49 Q110.478 1158.62 109.668 1160.54 Q108.881 1162.44 106.774 1165.03 Q106.195 1165.7 103.094 1168.92 Q99.9917 1172.11 94.3436 1177.88 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip790)" d="M120.478 1175.93 L125.362 1175.93 L125.362 1181.81 L120.478 1181.81 L120.478 1175.93 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip790)" d="M135.593 1147.25 L153.95 1147.25 L153.95 1151.19 L139.876 1151.19 L139.876 1159.66 Q140.894 1159.31 141.913 1159.15 Q142.931 1158.97 143.95 1158.97 Q149.737 1158.97 153.116 1162.14 Q156.496 1165.31 156.496 1170.72 Q156.496 1176.3 153.024 1179.41 Q149.552 1182.48 143.232 1182.48 Q141.056 1182.48 138.788 1182.11 Q136.542 1181.74 134.135 1181 L134.135 1176.3 Q136.218 1177.44 138.441 1177.99 Q140.663 1178.55 143.14 1178.55 Q147.144 1178.55 149.482 1176.44 Q151.82 1174.34 151.82 1170.72 Q151.82 1167.11 149.482 1165.01 Q147.144 1162.9 143.14 1162.9 Q141.265 1162.9 139.39 1163.32 Q137.538 1163.73 135.593 1164.61 L135.593 1147.25 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip790)" d="M99.3204 906.559 Q95.7093 906.559 93.8806 910.124 Q92.075 913.665 92.075 920.795 Q92.075 927.902 93.8806 931.466 Q95.7093 935.008 99.3204 935.008 Q102.955 935.008 104.76 931.466 Q106.589 927.902 106.589 920.795 Q106.589 913.665 104.76 910.124 Q102.955 906.559 99.3204 906.559 M99.3204 902.855 Q105.131 902.855 108.186 907.462 Q111.265 912.045 111.265 920.795 Q111.265 929.522 108.186 934.128 Q105.131 938.712 99.3204 938.712 Q93.5102 938.712 90.4315 934.128 Q87.376 929.522 87.376 920.795 Q87.376 912.045 90.4315 907.462 Q93.5102 902.855 99.3204 902.855 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip790)" d="M119.482 932.161 L124.367 932.161 L124.367 938.04 L119.482 938.04 L119.482 932.161 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip790)" d="M144.552 906.559 Q140.941 906.559 139.112 910.124 Q137.306 913.665 137.306 920.795 Q137.306 927.902 139.112 931.466 Q140.941 935.008 144.552 935.008 Q148.186 935.008 149.991 931.466 Q151.82 927.902 151.82 920.795 Q151.82 913.665 149.991 910.124 Q148.186 906.559 144.552 906.559 M144.552 902.855 Q150.362 902.855 153.417 907.462 Q156.496 912.045 156.496 920.795 Q156.496 929.522 153.417 934.128 Q150.362 938.712 144.552 938.712 Q138.741 938.712 135.663 934.128 Q132.607 929.522 132.607 920.795 Q132.607 912.045 135.663 907.462 Q138.741 902.855 144.552 902.855 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip790)" d="M94.3436 690.333 L110.663 690.333 L110.663 694.268 L88.7186 694.268 L88.7186 690.333 Q91.3806 687.578 95.9639 682.949 Q100.57 678.296 101.751 676.954 Q103.996 674.43 104.876 672.694 Q105.779 670.935 105.779 669.245 Q105.779 666.491 103.834 664.755 Q101.913 663.018 98.8111 663.018 Q96.6121 663.018 94.1584 663.782 Q91.7278 664.546 88.9501 666.097 L88.9501 661.375 Q91.7741 660.241 94.2278 659.662 Q96.6815 659.083 98.7185 659.083 Q104.089 659.083 107.283 661.768 Q110.478 664.454 110.478 668.944 Q110.478 671.074 109.668 672.995 Q108.881 674.893 106.774 677.486 Q106.195 678.157 103.094 681.375 Q99.9917 684.569 94.3436 690.333 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip790)" d="M120.478 688.389 L125.362 688.389 L125.362 694.268 L120.478 694.268 L120.478 688.389 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip790)" d="M135.593 659.708 L153.95 659.708 L153.95 663.643 L139.876 663.643 L139.876 672.116 Q140.894 671.768 141.913 671.606 Q142.931 671.421 143.95 671.421 Q149.737 671.421 153.116 674.592 Q156.496 677.764 156.496 683.18 Q156.496 688.759 153.024 691.861 Q149.552 694.94 143.232 694.94 Q141.056 694.94 138.788 694.569 Q136.542 694.199 134.135 693.458 L134.135 688.759 Q136.218 689.893 138.441 690.449 Q140.663 691.004 143.14 691.004 Q147.144 691.004 149.482 688.898 Q151.82 686.791 151.82 683.18 Q151.82 679.569 149.482 677.463 Q147.144 675.356 143.14 675.356 Q141.265 675.356 139.39 675.773 Q137.538 676.19 135.593 677.069 L135.593 659.708 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip790)" d="M89.3667 415.936 L107.723 415.936 L107.723 419.871 L93.6491 419.871 L93.6491 428.343 Q94.6676 427.996 95.6861 427.834 Q96.7047 427.649 97.7232 427.649 Q103.51 427.649 106.89 430.82 Q110.269 433.992 110.269 439.408 Q110.269 444.987 106.797 448.089 Q103.325 451.167 97.0056 451.167 Q94.8297 451.167 92.5612 450.797 Q90.3158 450.427 87.9084 449.686 L87.9084 444.987 Q89.9917 446.121 92.2139 446.677 Q94.4361 447.232 96.913 447.232 Q100.918 447.232 103.256 445.126 Q105.593 443.019 105.593 439.408 Q105.593 435.797 103.256 433.691 Q100.918 431.584 96.913 431.584 Q95.038 431.584 93.163 432.001 Q91.3112 432.418 89.3667 433.297 L89.3667 415.936 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip790)" d="M119.482 444.617 L124.367 444.617 L124.367 450.496 L119.482 450.496 L119.482 444.617 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip790)" d="M144.552 419.015 Q140.941 419.015 139.112 422.58 Q137.306 426.121 137.306 433.251 Q137.306 440.357 139.112 443.922 Q140.941 447.464 144.552 447.464 Q148.186 447.464 149.991 443.922 Q151.82 440.357 151.82 433.251 Q151.82 426.121 149.991 422.58 Q148.186 419.015 144.552 419.015 M144.552 415.311 Q150.362 415.311 153.417 419.918 Q156.496 424.501 156.496 433.251 Q156.496 441.978 153.417 446.584 Q150.362 451.167 144.552 451.167 Q138.741 451.167 135.663 446.584 Q132.607 441.978 132.607 433.251 Q132.607 424.501 135.663 419.918 Q138.741 415.311 144.552 415.311 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip790)" d="M89.1352 172.164 L111.357 172.164 L111.357 174.155 L98.8111 206.724 L93.9269 206.724 L105.732 176.099 L89.1352 176.099 L89.1352 172.164 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip790)" d="M120.478 200.844 L125.362 200.844 L125.362 206.724 L120.478 206.724 L120.478 200.844 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip790)" d="M135.593 172.164 L153.95 172.164 L153.95 176.099 L139.876 176.099 L139.876 184.571 Q140.894 184.224 141.913 184.062 Q142.931 183.877 143.95 183.877 Q149.737 183.877 153.116 187.048 Q156.496 190.219 156.496 195.636 Q156.496 201.215 153.024 204.317 Q149.552 207.395 143.232 207.395 Q141.056 207.395 138.788 207.025 Q136.542 206.655 134.135 205.914 L134.135 201.215 Q136.218 202.349 138.441 202.905 Q140.663 203.46 143.14 203.46 Q147.144 203.46 149.482 201.354 Q151.82 199.247 151.82 195.636 Q151.82 192.025 149.482 189.919 Q147.144 187.812 143.14 187.812 Q141.265 187.812 139.39 188.229 Q137.538 188.645 135.593 189.525 L135.593 172.164 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip792)" style="stroke:#009af9; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="265.984,1290.55 268.292,1304.43 270.6,1372.82 272.908,1392.95 275.216,1340.43 277.524,1494.79 279.832,1523.89 282.139,1507.11 284.447,1551.39 286.755,1334.41 289.063,1399.98 291.371,1364.34 293.679,1429.65 295.987,1243.97 298.295,1466.13 300.603,1497.53 302.911,1440.34 305.219,1404.34 307.527,1476.7 309.834,1245.57 312.142,1310.37 314.45,1446.65 316.758,1421.04 319.066,1189.16 321.374,1299.28 323.682,1319.78 325.99,1395.42 328.298,1491.29 330.606,1489.2 332.914,1411.54 335.221,1390.72 337.529,1505.01 339.837,1427.05 342.145,1428.75 344.453,1528.33 346.761,1380.03 349.069,1443.72 351.377,1363.83 353.685,1326.09 355.993,1483.03 358.301,1342.67 360.608,1323.08 362.916,1248.4 365.224,1319.93 367.532,1481.12 369.84,1398.03 372.148,1188.43 374.456,1311.15 376.764,1459.68 379.072,1416.06 381.38,1400.65 383.688,1335.73 385.996,1335.23 388.303,1307.23 390.611,1526.1 392.919,1426.68 395.227,1476.07 397.535,1421.09 399.843,1394.9 402.151,1424.29 404.459,1550.46 406.767,1422.87 409.075,1280.17 411.383,1317.09 413.69,1402.57 415.998,1482.39 418.306,1293.52 420.614,1303.75 422.922,1354.34 425.23,1490.59 427.538,1485.65 429.846,1564.1 432.154,1434.84 434.462,1354.63 436.77,1486.28 439.077,1309.73 441.385,1174.61 443.693,1486.32 446.001,1293.84 448.309,1320.17 450.617,1411.26 452.925,1473.02 455.233,1429.77 457.541,1339.71 459.849,1475.76 462.157,1446.88 464.465,1215.25 466.772,1442.22 469.08,1374.67 471.388,1192.78 473.696,1480.45 476.004,1536.04 478.312,1470.13 480.62,1466.65 482.928,1494.93 485.236,1267.25 487.544,1478.32 489.852,1372.25 492.159,1385.43 494.467,1484.89 496.775,1297.26 499.083,1341.91 501.391,1349.67 503.699,1360.01 506.007,1453.75 508.315,1186.97 510.623,1357.45 512.931,1468.35 515.239,1391.65 517.546,1321.12 519.854,1520.55 522.162,1396.49 524.47,1479.27 526.778,1375.13 529.086,1337.28 531.394,1465.69 533.702,1527.17 536.01,1392.59 538.318,1251.38 540.626,1493.3 542.933,1337.33 545.241,1500.25 547.549,1413.4 549.857,1511.43 552.165,1282.91 554.473,1346.87 556.781,1321.99 559.089,1494.86 561.397,1371.03 563.705,1575.65 566.013,1291.75 568.321,1299.75 570.628,1286.3 572.936,1391.36 575.244,1460.85 577.552,1520.75 579.86,1257.7 582.168,1347.96 584.476,1230.59 586.784,1438.57 589.092,1501.01 591.4,1494.53 593.708,1242.42 596.015,1320.89 598.323,1424.27 600.631,1528.43 602.939,1475.96 605.247,1453.41 607.555,1520.21 609.863,1324.12 612.171,1472.01 614.479,1513.56 616.787,1503.74 619.095,1300.74 621.402,1558.39 623.71,1382.41 626.018,1536.18 628.326,1368.67 630.634,1287.32 632.942,1475.48 635.25,1382.54 637.558,1412.07 639.866,1394 642.174,1461.73 644.482,1551.9 646.79,1340.48 649.097,1225.39 651.405,1482.3 653.713,1455.08 656.021,1399.97 658.329,1352.12 660.637,1417.93 662.945,1560.04 665.253,1343.78 667.561,1331.11 669.869,1411.72 672.177,1182.95 674.484,1169.91 676.792,1302.88 679.1,1397.68 681.408,1326.82 683.716,1591.51 686.024,1392.14 688.332,1480.72 690.64,1415.22 692.948,1310.67 695.256,1449.98 697.564,1359.95 699.871,1377.6 702.179,1336.05 704.487,1364.73 706.795,1532.79 709.103,1462.2 711.411,1373.81 713.719,1247.36 716.027,1373.4 718.335,1169.71 720.643,1243.93 722.951,1515.53 725.259,1436.44 727.566,1176.68 729.874,1398.05 732.182,1465.78 734.49,1469.34 736.798,1460.66 739.106,1430.33 741.414,1433.12 743.722,1405.41 746.03,1385.83 748.338,1516.03 750.646,1240.1 752.953,1298.13 755.261,1312.81 757.569,1531.49 759.877,1593.12 762.185,1450.35 764.493,1337.61 766.801,1300.27 769.109,1293.77 771.417,1543.75 773.725,1473.89 776.033,1278.94 778.34,1292.62 780.648,1392.22 782.956,1401.96 785.264,1409.24 787.572,1537.21 789.88,1431.88 792.188,1294.89 794.496,1438.86 796.804,1625.52 799.112,1305.23 801.42,1327.48 803.728,1339.43 806.035,1470.01 808.343,1546.21 810.651,1264.68 812.959,1495.87 815.267,1482.91 817.575,1347.33 819.883,1273.25 822.191,1533.5 824.499,1427.87 826.807,1320.73 829.115,1436.4 831.422,1430.79 833.73,1398.36 836.038,1293.53 838.346,1431.2 840.654,1400.08 842.962,1533.7 845.27,1408.01 847.578,1167.77 849.886,1321.53 852.194,1267.29 854.502,1296.29 856.809,1366.92 859.117,1551.72 861.425,1363.19 863.733,1491.08 866.041,1381.63 868.349,1467.58 870.657,1488.5 872.965,1301.9 875.273,1421.64 877.581,1445.46 879.889,1367.33 882.197,1401.21 884.504,1425.96 886.812,1327.16 889.12,1447.78 891.428,1217.58 893.736,1349.77 896.044,1558.11 898.352,1311.89 900.66,1581.77 902.968,1307.15 905.276,1350.65 907.584,1345.75 909.891,1351.42 912.199,1358.31 914.507,1352.89 916.815,1315.35 919.123,1466.9 921.431,1273.68 923.739,1437.11 926.047,1252.16 928.355,1345.27 930.663,1408.79 932.971,1446.18 935.278,1182.26 937.586,1428.32 939.894,1364.43 942.202,1613.49 944.51,1444.91 946.818,1314.24 949.126,1517.16 951.434,1585.85 953.742,1416.01 956.05,1528.14 958.358,1384.59 960.665,1418.78 962.973,1342.86 965.281,1424.15 967.589,1283.85 969.897,1549.01 972.205,1376.43 974.513,1396.01 976.821,1312.69 979.129,1499.59 981.437,1381.45 983.745,1483.08 986.053,1295.52 988.36,1318.75 990.668,1404.77 992.976,1405.86 995.284,1699.28 997.592,1552.47 999.9,1484.21 1002.21,1209.23 1004.52,1392.23 1006.82,1442.55 1009.13,1381.33 1011.44,1382.33 1013.75,1334.99 1016.06,1445.81 1018.36,1570.95 1020.67,1470.14 1022.98,1330.35 1025.29,1357.92 1027.59,1391.84 1029.9,1406.39 1032.21,1418.61 1034.52,1392.22 1036.83,1235.02 1039.13,1362.87 1041.44,1315.16 1043.75,1339.31 1046.06,1379.22 1048.37,1286.62 1050.67,1543.69 1052.98,1435.9 1055.29,1432.8 1057.6,1456.65 1059.91,1431.02 1062.21,1164.77 1064.52,1220.59 1066.83,1341.84 1069.14,1459.04 1071.45,1288.75 1073.75,1243.29 1076.06,1368.21 1078.37,1331.31 1080.68,1255.3 1082.98,1265.6 1085.29,1288.11 1087.6,1590.22 1089.91,1306.95 1092.22,1651.75 1094.52,1286.99 1096.83,1550.07 1099.14,1426.05 1101.45,1395.81 1103.76,1436.09 1106.06,1394.54 1108.37,1352.34 1110.68,1391.25 1112.99,1380.91 1115.3,1364.33 1117.6,1261.69 1119.91,1439.58 1122.22,1238.23 1124.53,1546.07 1126.84,1372.4 1129.14,1334.18 1131.45,1406.06 1133.76,1429.33 1136.07,1431.8 1138.37,1441.15 1140.68,1236.48 1142.99,1446.23 1145.3,1311.93 1147.61,1373.78 1149.91,1460.21 1152.22,1500.09 1154.53,1368.86 1156.84,1429.48 1159.15,1380.35 1161.45,1436.86 1163.76,1394.39 1166.07,1395.96 1168.38,1389.19 1170.69,1507.64 1172.99,1323.31 1175.3,1475.19 1177.61,1476.66 1179.92,1300.53 1182.23,1344.24 1184.53,1318.77 1186.84,1446 1189.15,1530.14 1191.46,1425.83 1193.76,1506.39 1196.07,1422.45 1198.38,1357.01 1200.69,1403.91 1203,1571.17 1205.3,1326.47 1207.61,1555.36 1209.92,1326.95 1212.23,1407.4 1214.54,1416.66 1216.84,1506.02 1219.15,1441.71 1221.46,1453.11 1223.77,1252.59 1226.08,1329.82 1228.38,1443.48 1230.69,1497.75 1233,1465.11 1235.31,1486.77 1237.61,1480.92 1239.92,1427.15 1242.23,1462.88 1244.54,1468.66 1246.85,1503.71 1249.15,1411.15 1251.46,1480.03 1253.77,1328.92 1256.08,1433.9 1258.39,1509.89 1260.69,1333.38 1263,1493.65 1265.31,1480.22 1267.62,1449.07 1269.93,1466.19 1272.23,1289.17 1274.54,1329.14 1276.85,1356.8 1279.16,1377.42 1281.47,1333.21 1283.77,1428.94 1286.08,1375.45 1288.39,1510.73 1290.7,1338.58 1293,1284.3 1295.31,1518.64 1297.62,1445.55 1299.93,1301.75 1302.24,1367.21 1304.54,1564.46 1306.85,1366.46 1309.16,1437.62 1311.47,1464.9 1313.78,1443.67 1316.08,1401.17 1318.39,1289.45 1320.7,1342.55 1323.01,1302.19 1325.32,1416.49 1327.62,1375.38 1329.93,1488.89 1332.24,1333.5 1334.55,1306.9 1336.86,1409.11 1339.16,1254.77 1341.47,1439.99 1343.78,1379.66 1346.09,1307 1348.39,1342.19 1350.7,1421.15 1353.01,1436.4 1355.32,1447.28 1357.63,1280.2 1359.93,1312.85 1362.24,1489.21 1364.55,1378.62 1366.86,1414.33 1369.17,1537.44 1371.47,1441.34 1373.78,1542.45 1376.09,1378.1 1378.4,1528 1380.71,1356.23 1383.01,1504.65 1385.32,1383.63 1387.63,1466.39 1389.94,1242.29 1392.24,1359.8 1394.55,1382.03 1396.86,1530.31 1399.17,1258.36 1401.48,1307.39 1403.78,1458.6 1406.09,1438.26 1408.4,1319.46 1410.71,1376.13 1413.02,1581.99 1415.32,1426.11 1417.63,1457.27 1419.94,1303 1422.25,1598.31 1424.56,1398.08 1426.86,1278.25 1429.17,1210.99 1431.48,1430.75 1433.79,1528.72 1436.1,1415.65 1438.4,1338.6 1440.71,1487.62 1443.02,1448.45 1445.33,1515.66 1447.63,1296.01 1449.94,1439.94 1452.25,1332.81 1454.56,1458.39 1456.87,1528.8 1459.17,1394.1 1461.48,1517.47 1463.79,1276.18 1466.1,1493.76 1468.41,1402.67 1470.71,1480.09 1473.02,1389.37 1475.33,1504.16 1477.64,1349.04 1479.95,1572.35 1482.25,1263.57 1484.56,1496.46 1486.87,1561.98 1489.18,1380.98 1491.49,1202.38 1493.79,1696.2 1496.1,1521.35 1498.41,1362.63 1500.72,1397.37 1503.02,1389.56 1505.33,1322.64 1507.64,1416.34 1509.95,1383.42 1512.26,1392.31 1514.56,1467.71 1516.87,1413.15 1519.18,1376.62 1521.49,1552.94 1523.8,1206.74 1526.1,1443.61 1528.41,1338.37 1530.72,1429.39 1533.03,1365.77 1535.34,1426.02 1537.64,1178.53 1539.95,1413.4 1542.26,1473.18 1544.57,1504.69 1546.88,1541.75 1549.18,1427.46 1551.49,1381.73 1553.8,1266 1556.11,1431.44 1558.41,1290.91 1560.72,1419.15 1563.03,1486.69 1565.34,1394.25 1567.65,1212.58 1569.95,1436.47 1572.26,1565.53 1574.57,1599.44 1576.88,1423.46 1579.19,1538.59 1581.49,1385.63 1583.8,1429.81 1586.11,1298.92 1588.42,1363.73 1590.73,1425.82 1593.03,1485.21 1595.34,1306.66 1597.65,1228.84 1599.96,1543.43 1602.26,1354.09 1604.57,1325.2 1606.88,1365.7 1609.19,1315.44 1611.5,1471.54 1613.8,1520.63 1616.11,1456.81 1618.42,1490.56 1620.73,1367.66 1623.04,1345.13 1625.34,1451.1 1627.65,1388.54 1629.96,1514.31 1632.27,1442.74 1634.58,1222.25 1636.88,1375.42 1639.19,1416.63 1641.5,1268.57 1643.81,1510.92 1646.12,1471.5 1648.42,1423.86 1650.73,1467.63 1653.04,1314.09 1655.35,1380.16 1657.65,1404.18 1659.96,1483.61 1662.27,1372.71 1664.58,1237.67 1666.89,1311.35 1669.19,1435.65 1671.5,1507.52 1673.81,1641.34 1676.12,1218.15 1678.43,1396.37 1680.73,1472.35 1683.04,1245.54 1685.35,1434.07 1687.66,1400.45 1689.97,1378.2 1692.27,1438.93 1694.58,1400.36 1696.89,1447.11 1699.2,1400.94 1701.51,1294.28 1703.81,1349.84 1706.12,1362.54 1708.43,1533.88 1710.74,1167.73 1713.04,1490.26 1715.35,1343.39 1717.66,1467.54 1719.97,1381.49 1722.28,1435.62 1724.58,1520.85 1726.89,1467.62 1729.2,1431.97 1731.51,1337.64 1733.82,1425.37 1736.12,1497.28 1738.43,1317.76 1740.74,1514.75 1743.05,1318.99 1745.36,1439.84 1747.66,1328.85 1749.97,1435.62 1752.28,1368.05 1754.59,1355.68 1756.9,1435.68 1759.2,1431.39 1761.51,1380.4 1763.82,1468.75 1766.13,1226.25 1768.43,1370.69 1770.74,1253.94 1773.05,1619.06 1775.36,1470.68 1777.67,1306.22 1779.97,1428.54 1782.28,1540.76 1784.59,1301.19 1786.9,1343.12 1789.21,1439.23 1791.51,1468.86 1793.82,1190.34 1796.13,1591.05 1798.44,1371.52 1800.75,1387.42 1803.05,1549.62 1805.36,1470.85 1807.67,1441.03 1809.98,1617.09 1812.28,1379.8 1814.59,1364.4 1816.9,1528.18 1819.21,1360.84 1821.52,1283.14 1823.82,1414.76 1826.13,1383.22 1828.44,1582.79 1830.75,1399.19 1833.06,1293.52 1835.36,1198.31 1837.67,1322.55 1839.98,1373.48 1842.29,1294.71 1844.6,1421.75 1846.9,1359.84 1849.21,1302.55 1851.52,1426 1853.83,1227.36 1856.14,1610.35 1858.44,1328.4 1860.75,1195.41 1863.06,1400.59 1865.37,1421.35 1867.67,1346.83 1869.98,1339.34 1872.29,1423.94 1874.6,1399.98 1876.91,1477.75 1879.21,1303.24 1881.52,1615.04 1883.83,1443.1 1886.14,1412.81 1888.45,1493.79 1890.75,1545.43 1893.06,1360.85 1895.37,1379.28 1897.68,1374.27 1899.99,1410.55 1902.29,1495.67 1904.6,1705.9 1906.91,1364.67 1909.22,1382.24 1911.53,1436.6 1913.83,1433.09 1916.14,1331.56 1918.45,1427.26 1920.76,1258.81 1923.06,1432.15 1925.37,1445.27 1927.68,1537.31 1929.99,1478.44 1932.3,1463.19 1934.6,1416.15 1936.91,1260.05 1939.22,1572.62 1941.53,1423.62 1943.84,1312.91 1946.14,1342.87 1948.45,1427.91 1950.76,1315.16 1953.07,1337.04 1955.38,1411.43 1957.68,1186.87 1959.99,1359.04 1962.3,1379.49 1964.61,1420.88 1966.91,1573.18 1969.22,1272.46 1971.53,1264.32 1973.84,1380.17 1976.15,1465.15 1978.45,1469.03 1980.76,1522.91 1983.07,1428.42 1985.38,1250.77 1987.69,1286.25 1989.99,1390.98 1992.3,1481.91 1994.61,1374.66 1996.92,1556.39 1999.23,1362.77 2001.53,1438.54 2003.84,1546.47 2006.15,1579.59 2008.46,1499.99 2010.77,1491.18 2013.07,1354.31 2015.38,1353.31 2017.69,1406.49 2020,1454.27 2022.3,1296.39 2024.61,1468.36 2026.92,1287.19 2029.23,1461.29 2031.54,1584.87 2033.84,1405.51 2036.15,1478.31 2038.46,1441.59 2040.77,1574.24 2043.08,1434.32 2045.38,1520.83 2047.69,1363.17 2050,1455.85 2052.31,1392.84 2054.62,1560.02 2056.92,1503.45 2059.23,1355.45 2061.54,1445.52 2063.85,1333.02 2066.16,1366.41 2068.46,1460.36 2070.77,1402.93 2073.08,1274.76 2075.39,1450.97 2077.69,1273.01 2080,1410.74 2082.31,1396.02 2084.62,1343.42 2086.93,1280.68 2089.23,1558.99 2091.54,1608.74 2093.85,1486.84 2096.16,1430.72 2098.47,1291.59 2100.77,1433.13 2103.08,1523.54 2105.39,1470.94 2107.7,1411.75 2110.01,1419.91 2112.31,1530.88 2114.62,1301.82 2116.93,1442.7 2119.24,1477.8 2121.55,1307.81 2123.85,1431.87 2126.16,1325.16 2128.47,1435.68 2130.78,1393.69 2133.08,1273.91 2135.39,1596.21 2137.7,1429.31 2140.01,1371.31 2142.32,1474.79 2144.62,1751.15 2146.93,1355.31 2149.24,1296.25 2151.55,1461.92 2153.86,1265.65 2156.16,1391.46 2158.47,1591.03 2160.78,1286.68 2163.09,1554.55 2165.4,1373.79 2167.7,1311.83 2170.01,1530.68 2172.32,1389.8 2174.63,1469.6 2176.93,1379.23 2179.24,1316.61 2181.55,1395.55 2183.86,1437.81 2186.17,1321.1 2188.47,1093.93 2190.78,1594.77 2193.09,1526.18 2195.4,1356.96 2197.71,1311.12 2200.01,1363.49 2202.32,1273.74 2204.63,1227.28 2206.94,1304.94 2209.25,1476.68 2211.55,1594.94 2213.86,1454.68 2216.17,1344.88 2218.48,1621.34 2220.79,1294.54 2223.09,1286.11 2225.4,1314.01 2227.71,1338.67 2230.02,1383.59 2232.32,1491.53 2234.63,1198.3 2236.94,1416.54 2239.25,1187.92 2241.56,1503.78 2243.86,1356.99 2246.17,1392.26 2248.48,1524.39 2250.79,1362.8 2253.1,1170.43 2255.4,1502.03 2257.71,1453.02 2260.02,1341.22 2262.33,1470.75 2264.64,1448.87 2266.94,1466.18 2269.25,1429.92 2271.56,1409.12 2273.87,1383.02 2276.18,1439.77 2278.48,1438.75 2280.79,1326.49 2283.1,1404.65 2285.41,1544.22 2287.71,1467.44 2290.02,1402.4 2292.33,1470.37 2294.64,1480.16 2296.95,1372.96 2299.25,1419.67 2301.56,1284.6 2303.87,1358.37 2306.18,1371.53 2308.49,1361.75 2310.79,1344.75 2313.1,1354.93 2315.41,1292.79 2317.72,1335.75 2320.03,1512.46 2322.33,1398.23 2324.64,1490.78 2326.95,1412.16 2329.26,1422.93 2331.56,1286.63 2333.87,1346.27 2336.18,1128.02 2338.49,1597.19 2340.8,1644.33 2343.1,1160.71 2345.41,1320.34 2347.72,1263.58 2350.03,1513.23 2352.34,1413.96 2354.64,1399.15 2356.95,1525.11 2359.26,1416.57 2361.57,1457.1 2363.88,1393.33 2366.18,1419.92 2368.49,1478.63 2370.8,1287.63 2373.11,1431.5 2375.42,1526.42 2377.72,1277.56 2380.03,1232.01 2382.34,1438.6 2384.65,1322.03 2386.95,1440.45 2389.26,1485.34 2391.57,1355.01 2393.88,1428.69 2396.19,1503.19 2398.49,1492.22 2400.8,1320.67 2403.11,1500.08 2405.42,1338.01 2407.73,1477.91 2410.03,1455.24 2412.34,1336.41 2414.65,1432.71 2416.96,1528.11 2419.27,1393.58 2421.57,1437.34 2423.88,1393.04 2426.19,1376.68 2428.5,1425.82 2430.81,1448.02 2433.11,1297.84 2435.42,1446.47 2437.73,1510.59 2440.04,1285.45 2442.34,1455.47 2444.65,1349.76 2446.96,1416.34 2449.27,1534.42 2451.58,1425.65 2453.88,1356.82 2456.19,1307.37 2458.5,1435.61 2460.81,1527.2 2463.12,1458.6 2465.42,1419.5 2467.73,1384.51 2470.04,1452.89 2472.35,1390.13 2474.66,1472.35 2476.96,1491.26 2479.27,1335.69 2481.58,1447.52 2483.89,1422.64 2486.2,1547.66 2488.5,1368.58 2490.81,1302.42 2493.12,1509.42 2495.43,1355.33 2497.73,1438.39 2500.04,1313.86 2502.35,1547.63 2504.66,1395.83 2506.97,1525.52 2509.27,1441.07 2511.58,1310.21 2513.89,1466.39 2516.2,1469.53 2518.51,1275.73 2520.81,1299.42 2523.12,1424.97 2525.43,1457.04 2527.74,1371.04 2530.05,1399.04 2532.35,1215.62 2534.66,1282.95 2536.97,1573.45 2539.28,1474.25 2541.58,1645.79 2543.89,1451.32 2546.2,1354.76 2548.51,1337.35 2550.82,1291.27 2553.12,1456.96 2555.43,1509.09 2557.74,1381.72 2560.05,1324.13 2562.36,1471.36 2564.66,1333.76 2566.97,1468.2 2569.28,1407.26 2571.59,1430.85 "></polyline>
<polyline clip-path="url(#clip792)" style="stroke:#e26f46; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="265.984,920.375 268.292,1051.09 270.6,985.492 272.908,869.744 275.216,829.126 277.524,946.558 279.832,813.885 282.139,970.604 284.447,1113.62 286.755,996.998 289.063,926.333 291.371,998.747 293.679,948.773 295.987,741.255 298.295,875.289 300.603,869.25 302.911,875.352 305.219,825.545 307.527,682.647 309.834,957.243 312.142,733.654 314.45,994.95 316.758,982.656 319.066,986.742 321.374,992.902 323.682,835.123 325.99,910.604 328.298,943.03 330.606,1009.53 332.914,826.583 335.221,955.968 337.529,816.264 339.837,870.053 342.145,967.807 344.453,957.261 346.761,982.583 349.069,1039.59 351.377,957.144 353.685,887.938 355.993,950.726 358.301,732.74 360.608,1064.75 362.916,976.578 365.224,963.426 367.532,868.468 369.84,961.442 372.148,859.929 374.456,835.295 376.764,868.487 379.072,1033.26 381.38,952.118 383.688,902.176 385.996,869.175 388.303,987.884 390.611,869.361 392.919,793.829 395.227,878.836 397.535,785.446 399.843,991.036 402.151,956.521 404.459,996.22 406.767,804.941 409.075,1017.55 411.383,1227.99 413.69,990.082 415.998,1292.56 418.306,1063.95 420.614,748.413 422.922,863.466 425.23,1059.64 427.538,1018.83 429.846,913.286 432.154,896.826 434.462,1017.09 436.77,931.705 439.077,1027.89 441.385,925.397 443.693,922.493 446.001,973.677 448.309,1051.18 450.617,923.966 452.925,1018 455.233,1030.32 457.541,976.855 459.849,786.18 462.157,836.749 464.465,976.672 466.772,865.561 469.08,1008.37 471.388,934.128 473.696,1072.23 476.004,954.979 478.312,896.582 480.62,1076.24 482.928,985.479 485.236,928.394 487.544,936.704 489.852,801.299 492.159,766.689 494.467,817.645 496.775,788.32 499.083,823.57 501.391,1079.66 503.699,989.217 506.007,989.882 508.315,885.056 510.623,853.351 512.931,884.205 515.239,986.821 517.546,963.409 519.854,998.642 522.162,929.665 524.47,1022.49 526.778,949.086 529.086,981.228 531.394,1004.23 533.702,854.895 536.01,954.34 538.318,884.881 540.626,878.933 542.933,896.474 545.241,872.608 547.549,824.589 549.857,970.026 552.165,962.289 554.473,798.699 556.781,984.396 559.089,965.188 561.397,905.092 563.705,936.788 566.013,950.725 568.321,813.821 570.628,995.952 572.936,825.373 575.244,797.873 577.552,798.645 579.86,840.441 582.168,895.628 584.476,864.478 586.784,777.429 589.092,851.625 591.4,955.416 593.708,907.691 596.015,1025.23 598.323,817.038 600.631,1031.26 602.939,774.977 605.247,929.404 607.555,1079.18 609.863,903.931 612.171,1005.87 614.479,954.106 616.787,1079.76 619.095,896.193 621.402,809.785 623.71,871.789 626.018,1201.77 628.326,1010.55 630.634,767.9 632.942,871.637 635.25,891.794 637.558,974.334 639.866,934.756 642.174,890.199 644.482,1027.53 646.79,919.38 649.097,759.605 651.405,878.972 653.713,1055.47 656.021,1041.9 658.329,960.883 660.637,983.188 662.945,1156.63 665.253,951.709 667.561,927.874 669.869,942.773 672.177,833.115 674.484,838.1 676.792,901.991 679.1,922.348 681.408,905.878 683.716,851.797 686.024,973.792 688.332,892.838 690.64,824.667 692.948,959.822 695.256,783.299 697.564,846.597 699.871,1025.53 702.179,960.453 704.487,925.351 706.795,897.675 709.103,887.37 711.411,914.403 713.719,888.415 716.027,1122.2 718.335,1076.64 720.643,1013.71 722.951,1097.77 725.259,974.345 727.566,1032.1 729.874,934.361 732.182,771.841 734.49,1017.46 736.798,901.664 739.106,942.993 741.414,949.545 743.722,790.073 746.03,987.464 748.338,1038.93 750.646,761.547 752.953,618.253 755.261,857.544 757.569,1059.74 759.877,1163.34 762.185,894.351 764.493,843.983 766.801,1042.3 769.109,856.165 771.417,1014.07 773.725,1064.58 776.033,760.84 778.34,759.867 780.648,819.844 782.956,814.36 785.264,938.083 787.572,915.22 789.88,831.467 792.188,850.122 794.496,963.505 796.804,981.852 799.112,1033.44 801.42,947.298 803.728,890.24 806.035,913.474 808.343,1081.54 810.651,823.621 812.959,898.535 815.267,812.601 817.575,972.196 819.883,905.398 822.191,892.964 824.499,924.424 826.807,871.975 829.115,782.974 831.422,915.655 833.73,837.272 836.038,1011.05 838.346,948.118 840.654,996.086 842.962,949.45 845.27,969.761 847.578,856.837 849.886,843.94 852.194,870.561 854.502,943.423 856.809,971.068 859.117,1081.85 861.425,852.032 863.733,920.758 866.041,856.526 868.349,819.046 870.657,944.04 872.965,939.75 875.273,930.2 877.581,850.879 879.889,838.905 882.197,1038.35 884.504,1081.78 886.812,839.173 889.12,913.637 891.428,845.74 893.736,955.323 896.044,917.788 898.352,892.444 900.66,912.471 902.968,825.456 905.276,1015.03 907.584,829.233 909.891,890.668 912.199,841.764 914.507,994.722 916.815,1016.01 919.123,1076.33 921.431,927.864 923.739,1016.22 926.047,1030.1 928.355,915.943 930.663,846.56 932.971,972.565 935.278,963.768 937.586,883.582 939.894,989.75 942.202,841.747 944.51,1100.32 946.818,851.327 949.126,779.88 951.434,677.341 953.742,934.108 956.05,859.472 958.358,807.385 960.665,978.054 962.973,913.961 965.281,1113.62 967.589,793.141 969.897,1013.02 972.205,773.714 974.513,966.724 976.821,1010.56 979.129,855.798 981.437,920.535 983.745,972.273 986.053,846.192 988.36,949.182 990.668,1077.62 992.976,954.141 995.284,964.327 997.592,927.291 999.9,869.501 1002.21,942.966 1004.52,865.797 1006.82,882.198 1009.13,944.796 1011.44,912.979 1013.75,822.268 1016.06,894.486 1018.36,929.324 1020.67,756.046 1022.98,964.978 1025.29,1065.36 1027.59,709.593 1029.9,992.332 1032.21,820.179 1034.52,985.841 1036.83,957.642 1039.13,782.822 1041.44,912.973 1043.75,897.769 1046.06,877.966 1048.37,938.275 1050.67,930.207 1052.98,1012.16 1055.29,979.429 1057.6,937.708 1059.91,856.241 1062.21,790.747 1064.52,1024.6 1066.83,838.368 1069.14,795.802 1071.45,970.801 1073.75,957.481 1076.06,1001.27 1078.37,838.429 1080.68,939.936 1082.98,945.075 1085.29,887.214 1087.6,868.08 1089.91,1151.37 1092.22,824.076 1094.52,1101.38 1096.83,983.54 1099.14,969.262 1101.45,1002.24 1103.76,1015.14 1106.06,1066.81 1108.37,1005.61 1110.68,963.649 1112.99,797.008 1115.3,960.824 1117.6,682.159 1119.91,893.479 1122.22,997.073 1124.53,1142.76 1126.84,971.809 1129.14,806.591 1131.45,941.942 1133.76,954.623 1136.07,842.5 1138.37,948.583 1140.68,1102.31 1142.99,984.524 1145.3,868.425 1147.61,897.45 1149.91,958.414 1152.22,769.734 1154.53,998.334 1156.84,937.599 1159.15,913.023 1161.45,1121.9 1163.76,904.087 1166.07,1033.49 1168.38,916.973 1170.69,750.209 1172.99,916.603 1175.3,794.814 1177.61,836.206 1179.92,909.691 1182.23,1016.48 1184.53,864.962 1186.84,827.227 1189.15,819.387 1191.46,935.18 1193.76,866.678 1196.07,970.85 1198.38,925.39 1200.69,997.006 1203,827.845 1205.3,914.333 1207.61,892.979 1209.92,1022.32 1212.23,977.647 1214.54,994.054 1216.84,790.202 1219.15,1044.86 1221.46,816.749 1223.77,780.074 1226.08,793.938 1228.38,891.434 1230.69,1110.73 1233,895.812 1235.31,711.707 1237.61,943.681 1239.92,820.746 1242.23,938.003 1244.54,1004.25 1246.85,802.739 1249.15,791.84 1251.46,921.875 1253.77,769.247 1256.08,858.807 1258.39,976.189 1260.69,1021.16 1263,810.571 1265.31,1102.44 1267.62,995.849 1269.93,876.271 1272.23,758.089 1274.54,902.32 1276.85,822.602 1279.16,812.467 1281.47,1037.44 1283.77,896.039 1286.08,945.548 1288.39,1093.44 1290.7,968.041 1293,955.738 1295.31,943.666 1297.62,841.012 1299.93,956.287 1302.24,859.362 1304.54,921.877 1306.85,858.822 1309.16,854.162 1311.47,781.1 1313.78,918.174 1316.08,942.472 1318.39,823.539 1320.7,711.161 1323.01,919.581 1325.32,720.014 1327.62,797.812 1329.93,894.973 1332.24,1017.2 1334.55,994.248 1336.86,754.35 1339.16,897.588 1341.47,767.237 1343.78,986.94 1346.09,959.764 1348.39,865.655 1350.7,1006.98 1353.01,923.661 1355.32,968.567 1357.63,917.496 1359.93,988.632 1362.24,926.147 1364.55,827.639 1366.86,807.095 1369.17,844.028 1371.47,1080.34 1373.78,938.414 1376.09,958.125 1378.4,809.014 1380.71,1054.73 1383.01,1004.92 1385.32,813.732 1387.63,959.176 1389.94,991.185 1392.24,851.598 1394.55,853.993 1396.86,880.5 1399.17,811.257 1401.48,916.493 1403.78,847.305 1406.09,904.095 1408.4,882.692 1410.71,783.574 1413.02,804.794 1415.32,962.423 1417.63,1008.62 1419.94,1001.29 1422.25,1059.96 1424.56,948.917 1426.86,762.828 1429.17,916.812 1431.48,1027.15 1433.79,791.003 1436.1,876.508 1438.4,987.734 1440.71,991.027 1443.02,802.732 1445.33,916.078 1447.63,880.654 1449.94,1075.93 1452.25,893.008 1454.56,929.919 1456.87,908.296 1459.17,920.513 1461.48,1008.35 1463.79,794.056 1466.1,1000.16 1468.41,1003.04 1470.71,851.563 1473.02,784.224 1475.33,890.019 1477.64,841.22 1479.95,919.97 1482.25,975.647 1484.56,938.499 1486.87,1021.64 1489.18,843.094 1491.49,1009.1 1493.79,995.708 1496.1,811.984 1498.41,943.179 1500.72,997.189 1503.02,1038 1505.33,900.823 1507.64,865.948 1509.95,890.642 1512.26,962.16 1514.56,682.93 1516.87,1079.42 1519.18,983.87 1521.49,1042.59 1523.8,882.17 1526.1,1104.61 1528.41,902.768 1530.72,827.091 1533.03,794.7 1535.34,777.469 1537.64,1114.14 1539.95,1026.24 1542.26,995.249 1544.57,804.948 1546.88,820.819 1549.18,912.02 1551.49,726.547 1553.8,854.66 1556.11,970.309 1558.41,792.428 1560.72,1004.22 1563.03,1117.34 1565.34,873.191 1567.65,942.387 1569.95,864.534 1572.26,1056.4 1574.57,864.327 1576.88,841.656 1579.19,917.176 1581.49,1000.43 1583.8,948.032 1586.11,795.695 1588.42,857.196 1590.73,829.704 1593.03,811.947 1595.34,849.4 1597.65,842.116 1599.96,972.382 1602.26,993.948 1604.57,985.964 1606.88,925.945 1609.19,825.632 1611.5,926.75 1613.8,958.845 1616.11,1083.37 1618.42,851.142 1620.73,837.914 1623.04,914.957 1625.34,877.208 1627.65,1045.59 1629.96,883.924 1632.27,909.853 1634.58,932.35 1636.88,909.882 1639.19,744.034 1641.5,1041.78 1643.81,1000.14 1646.12,917.486 1648.42,1096.86 1650.73,833.453 1653.04,941.386 1655.35,1150.58 1657.65,848.573 1659.96,746.262 1662.27,879.827 1664.58,858.156 1666.89,829.536 1669.19,923.124 1671.5,1127.61 1673.81,900.757 1676.12,886.163 1678.43,726.695 1680.73,1069.15 1683.04,808.899 1685.35,960.063 1687.66,836.052 1689.97,793.016 1692.27,1037.01 1694.58,1036 1696.89,891.375 1699.2,900.625 1701.51,1073.27 1703.81,881.948 1706.12,997.833 1708.43,835.266 1710.74,911.538 1713.04,981.348 1715.35,1022.8 1717.66,1011.5 1719.97,1022.9 1722.28,819.812 1724.58,814.772 1726.89,1007.89 1729.2,933.77 1731.51,985.639 1733.82,861.086 1736.12,1037.51 1738.43,880.698 1740.74,655.908 1743.05,1041.6 1745.36,936.367 1747.66,834.376 1749.97,691.935 1752.28,894.167 1754.59,812.404 1756.9,929.55 1759.2,1086.99 1761.51,891.961 1763.82,958.693 1766.13,1088.49 1768.43,833.973 1770.74,949.21 1773.05,914.591 1775.36,995.981 1777.67,875.543 1779.97,865.95 1782.28,923.271 1784.59,911.122 1786.9,918.82 1789.21,1013.42 1791.51,886.023 1793.82,1016.72 1796.13,874.215 1798.44,1063.1 1800.75,918.294 1803.05,852.44 1805.36,967.762 1807.67,951.425 1809.98,1062.17 1812.28,1051.17 1814.59,816.274 1816.9,911.377 1819.21,1095.69 1821.52,937.73 1823.82,962.575 1826.13,785.017 1828.44,936.479 1830.75,954.08 1833.06,964.013 1835.36,673.211 1837.67,948.525 1839.98,916.864 1842.29,1055.26 1844.6,988.721 1846.9,1164.5 1849.21,923.947 1851.52,1016.64 1853.83,885.664 1856.14,763.902 1858.44,934.329 1860.75,975.102 1863.06,1129.46 1865.37,1003.11 1867.67,761.753 1869.98,708.746 1872.29,892.666 1874.6,1078.49 1876.91,725.351 1879.21,894.879 1881.52,819.934 1883.83,928.182 1886.14,1061.12 1888.45,982.48 1890.75,920.059 1893.06,1007.93 1895.37,771.755 1897.68,1033.05 1899.99,829.922 1902.29,919.462 1904.6,1087.85 1906.91,878.985 1909.22,838.22 1911.53,825.162 1913.83,869.535 1916.14,883.902 1918.45,819.818 1920.76,849.019 1923.06,948.202 1925.37,903.306 1927.68,1017.16 1929.99,982.174 1932.3,855.132 1934.6,915.658 1936.91,834.327 1939.22,1017.34 1941.53,868.537 1943.84,931.414 1946.14,929.809 1948.45,1028.79 1950.76,763.075 1953.07,807.023 1955.38,958.638 1957.68,819.257 1959.99,939.489 1962.3,1019.25 1964.61,990.208 1966.91,733.26 1969.22,926.292 1971.53,954.626 1973.84,868.868 1976.15,868.6 1978.45,1184.01 1980.76,973.121 1983.07,874.507 1985.38,933.512 1987.69,820.139 1989.99,1089.54 1992.3,855.675 1994.61,875.16 1996.92,866.903 1999.23,955.638 2001.53,778.413 2003.84,704.29 2006.15,1047.13 2008.46,969.209 2010.77,780.161 2013.07,820.394 2015.38,977.057 2017.69,885.236 2020,973.241 2022.3,899.666 2024.61,970.58 2026.92,1003.62 2029.23,926.608 2031.54,976.285 2033.84,1093.38 2036.15,852.732 2038.46,881.175 2040.77,704.781 2043.08,1000.85 2045.38,869.133 2047.69,883.738 2050,1004.85 2052.31,975.904 2054.62,780.109 2056.92,976.111 2059.23,910.993 2061.54,974.294 2063.85,884.075 2066.16,930.081 2068.46,887.994 2070.77,826.158 2073.08,1213.49 2075.39,795.801 2077.69,1074.28 2080,984.617 2082.31,833.268 2084.62,898.468 2086.93,827.288 2089.23,1205.59 2091.54,814.649 2093.85,862.121 2096.16,855.88 2098.47,1033.24 2100.77,947.042 2103.08,963.991 2105.39,798.26 2107.7,802.159 2110.01,768.227 2112.31,968.784 2114.62,949.771 2116.93,917.595 2119.24,928.71 2121.55,877.054 2123.85,893.019 2126.16,859.061 2128.47,778.137 2130.78,984.234 2133.08,875.071 2135.39,912.925 2137.7,1154.34 2140.01,1000.51 2142.32,1022.02 2144.62,844.689 2146.93,804.433 2149.24,968.806 2151.55,935.964 2153.86,805.991 2156.16,1045.85 2158.47,757.647 2160.78,975.236 2163.09,949.93 2165.4,957.723 2167.7,979.429 2170.01,845.472 2172.32,871.088 2174.63,963.099 2176.93,897.694 2179.24,858.457 2181.55,1106.96 2183.86,915.087 2186.17,758.492 2188.47,1052.34 2190.78,1021.33 2193.09,847.564 2195.4,849.047 2197.71,1002.02 2200.01,903.293 2202.32,786.675 2204.63,988.928 2206.94,933.002 2209.25,809.347 2211.55,886.9 2213.86,1096.47 2216.17,969.209 2218.48,890.691 2220.79,831.132 2223.09,906.226 2225.4,1001.93 2227.71,923.068 2230.02,917.448 2232.32,880.194 2234.63,925.026 2236.94,783.455 2239.25,828.089 2241.56,961.487 2243.86,833.621 2246.17,957.046 2248.48,907.704 2250.79,870.623 2253.1,1047.45 2255.4,1067.64 2257.71,991.679 2260.02,874.281 2262.33,816.019 2264.64,934.732 2266.94,994.151 2269.25,871.387 2271.56,842.062 2273.87,959.945 2276.18,944.239 2278.48,804.605 2280.79,899.933 2283.1,846.867 2285.41,749.086 2287.71,968.435 2290.02,834.091 2292.33,1096.19 2294.64,900.783 2296.95,998.645 2299.25,934.686 2301.56,823.953 2303.87,812.872 2306.18,979.541 2308.49,956.157 2310.79,1020.15 2313.1,873.115 2315.41,1021.11 2317.72,987.131 2320.03,826.269 2322.33,1066.99 2324.64,851.355 2326.95,933.938 2329.26,818.767 2331.56,819.986 2333.87,888.545 2336.18,932.236 2338.49,878.842 2340.8,958.582 2343.1,984.324 2345.41,1000.08 2347.72,979.615 2350.03,1079.34 2352.34,927.078 2354.64,915.914 2356.95,924.398 2359.26,765.515 2361.57,939.061 2363.88,906.455 2366.18,726.621 2368.49,872.109 2370.8,936.485 2373.11,1065.93 2375.42,858.454 2377.72,1000.8 2380.03,936.125 2382.34,890.771 2384.65,914.147 2386.95,741.588 2389.26,1071.89 2391.57,898.051 2393.88,774.89 2396.19,911.619 2398.49,1063.72 2400.8,900.779 2403.11,1020.06 2405.42,1061.6 2407.73,770.588 2410.03,956.767 2412.34,945.773 2414.65,938.729 2416.96,879.252 2419.27,1043.42 2421.57,911.657 2423.88,967.346 2426.19,733.358 2428.5,935.08 2430.81,1032.1 2433.11,968.575 2435.42,820.508 2437.73,811.161 2440.04,902.846 2442.34,935.52 2444.65,1027.54 2446.96,973.873 2449.27,1076.69 2451.58,1112.53 2453.88,920.14 2456.19,1009.38 2458.5,1058.95 2460.81,915.416 2463.12,900.581 2465.42,932.714 2467.73,861.385 2470.04,874.811 2472.35,882.171 2474.66,972.596 2476.96,1035.39 2479.27,973.568 2481.58,1065.74 2483.89,969.331 2486.2,1041.75 2488.5,1013.9 2490.81,978.952 2493.12,980.662 2495.43,790.701 2497.73,953.158 2500.04,1044.15 2502.35,1007.83 2504.66,1027.98 2506.97,1010.32 2509.27,804.315 2511.58,972.032 2513.89,929.609 2516.2,942.024 2518.51,1038.75 2520.81,813.469 2523.12,1036.52 2525.43,813.072 2527.74,853.248 2530.05,854.726 2532.35,1030.52 2534.66,1055.29 2536.97,852.157 2539.28,988.054 2541.58,888.734 2543.89,989.149 2546.2,877.186 2548.51,843.513 2550.82,912.128 2553.12,893.131 2555.43,901.138 2557.74,933.028 2560.05,884.95 2562.36,890.209 2564.66,894.534 2566.97,1067.2 2569.28,937.557 2571.59,877.775 "></polyline>
<polyline clip-path="url(#clip792)" style="stroke:#3da44d; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="265.984,760.662 268.292,405.51 270.6,359.099 272.908,383.524 275.216,624.34 277.524,468.394 279.832,589.228 282.139,455.877 284.447,419.363 286.755,394.748 289.063,399.82 291.371,468.028 293.679,569.332 295.987,493.189 298.295,452.527 300.603,557.733 302.911,600.229 305.219,583.785 307.527,527.336 309.834,538.588 312.142,597.157 314.45,394.947 316.758,368.577 319.066,678.984 321.374,317.949 323.682,284.628 325.99,275.298 328.298,441.116 330.606,431.76 332.914,486.43 335.221,480.693 337.529,330.407 339.837,503.245 342.145,409.939 344.453,404.082 346.761,405.733 349.069,619.264 351.377,453.816 353.685,410.289 355.993,242.791 358.301,314.516 360.608,533.518 362.916,486.942 365.224,444.477 367.532,502.752 369.84,336.727 372.148,349.229 374.456,434.565 376.764,572.752 379.072,216.838 381.38,484.61 383.688,422.86 385.996,369.628 388.303,415.055 390.611,398.638 392.919,542.178 395.227,335.603 397.535,524.375 399.843,400.948 402.151,543.827 404.459,437.595 406.767,378.077 409.075,590.371 411.383,447.964 413.69,408.426 415.998,342.867 418.306,408.348 420.614,550.456 422.922,414.901 425.23,387.826 427.538,612.682 429.846,455.303 432.154,238.999 434.462,274.851 436.77,469.066 439.077,441.65 441.385,288.519 443.693,456.292 446.001,408.135 448.309,429.734 450.617,492.014 452.925,485.538 455.233,526.041 457.541,333.485 459.849,582.803 462.157,498.278 464.465,441.231 466.772,501.595 469.08,457.296 471.388,412.179 473.696,528.179 476.004,437.329 478.312,298.086 480.62,425.554 482.928,386.298 485.236,467.325 487.544,453.063 489.852,487.955 492.159,605.766 494.467,519.161 496.775,533.498 499.083,423.766 501.391,408.852 503.699,311.915 506.007,465.79 508.315,201.409 510.623,578.162 512.931,431.654 515.239,395.237 517.546,354.429 519.854,365.833 522.162,298.305 524.47,539.279 526.778,450.32 529.086,351.36 531.394,293 533.702,227.42 536.01,423.017 538.318,373.469 540.626,454.426 542.933,354.662 545.241,382.167 547.549,412.897 549.857,511.458 552.165,566.153 554.473,355.618 556.781,379.849 559.089,532.634 561.397,329.83 563.705,373.098 566.013,514.477 568.321,580.16 570.628,363.803 572.936,541.967 575.244,368.742 577.552,533.917 579.86,454.08 582.168,459.916 584.476,336.65 586.784,362.41 589.092,431.835 591.4,365.926 593.708,111.335 596.015,206.043 598.323,491.763 600.631,420.859 602.939,274.138 605.247,479.756 607.555,340.701 609.863,506.03 612.171,341.709 614.479,185.074 616.787,477.156 619.095,452.255 621.402,455.675 623.71,378.285 626.018,386.504 628.326,408.523 630.634,405.814 632.942,640.342 635.25,573.334 637.558,315.085 639.866,377.448 642.174,523.649 644.482,511.058 646.79,403.582 649.097,580.875 651.405,606.829 653.713,464.098 656.021,473.15 658.329,449.943 660.637,316.015 662.945,274.465 665.253,459.64 667.561,396.368 669.869,518.49 672.177,374.796 674.484,290.531 676.792,352.918 679.1,582.49 681.408,394.791 683.716,430.453 686.024,416.68 688.332,547.57 690.64,475.897 692.948,289.378 695.256,484.644 697.564,610.985 699.871,355.221 702.179,424.041 704.487,497.374 706.795,635.296 709.103,475.782 711.411,611.047 713.719,337.528 716.027,436.364 718.335,560.939 720.643,438.545 722.951,525.357 725.259,398.329 727.566,578.627 729.874,484.538 732.182,446.925 734.49,474.547 736.798,533.793 739.106,422.664 741.414,447.008 743.722,309.302 746.03,555.96 748.338,417.786 750.646,406.747 752.953,438.845 755.261,387.981 757.569,305.344 759.877,477.138 762.185,466.023 764.493,594.823 766.801,391.213 769.109,526.199 771.417,457.999 773.725,503.155 776.033,367.048 778.34,461.151 780.648,473.608 782.956,458.41 785.264,525.525 787.572,444.482 789.88,320.285 792.188,543.18 794.496,453.323 796.804,361.938 799.112,287.669 801.42,292.415 803.728,376.219 806.035,251.74 808.343,592.1 810.651,411.98 812.959,442.555 815.267,448.588 817.575,514.133 819.883,419.391 822.191,357.477 824.499,480.367 826.807,316.095 829.115,425.598 831.422,426.008 833.73,380.265 836.038,440.432 838.346,705.12 840.654,342.018 842.962,283.871 845.27,462.846 847.578,470.321 849.886,533.64 852.194,446.256 854.502,554.841 856.809,320.265 859.117,266.311 861.425,524.361 863.733,445.705 866.041,526.939 868.349,474.06 870.657,345.742 872.965,347.227 875.273,418.769 877.581,397.559 879.889,516.668 882.197,348.827 884.504,701.866 886.812,421.566 889.12,396.724 891.428,444.953 893.736,420.651 896.044,441.676 898.352,521.22 900.66,384.388 902.968,323.983 905.276,365.299 907.584,361.992 909.891,285.626 912.199,328.985 914.507,506.88 916.815,454.86 919.123,424.119 921.431,408.413 923.739,471.696 926.047,324.486 928.355,299.169 930.663,384.726 932.971,503.426 935.278,401.413 937.586,431.402 939.894,535.216 942.202,247.841 944.51,277.293 946.818,414.481 949.126,369.656 951.434,496.222 953.742,293.307 956.05,456.705 958.358,334.312 960.665,397.582 962.973,552.454 965.281,342.852 967.589,465.381 969.897,230.219 972.205,370.62 974.513,321.708 976.821,443.247 979.129,284.623 981.437,544.213 983.745,518.515 986.053,404.011 988.36,268.49 990.668,259.082 992.976,393.004 995.284,469.423 997.592,468.983 999.9,345.235 1002.21,459.07 1004.52,507.995 1006.82,133.077 1009.13,310.269 1011.44,621.144 1013.75,576.237 1016.06,574.219 1018.36,410.161 1020.67,485.605 1022.98,537.936 1025.29,443.524 1027.59,490.795 1029.9,334.211 1032.21,311.86 1034.52,276.2 1036.83,474.895 1039.13,546.45 1041.44,344.768 1043.75,435.379 1046.06,203.331 1048.37,433.058 1050.67,737.683 1052.98,402.837 1055.29,581.321 1057.6,459.325 1059.91,437.659 1062.21,400.858 1064.52,346.207 1066.83,592.42 1069.14,481.133 1071.45,317.531 1073.75,597.966 1076.06,290.398 1078.37,404.413 1080.68,484.96 1082.98,494.651 1085.29,348.488 1087.6,564.322 1089.91,520.678 1092.22,244.806 1094.52,337.556 1096.83,408.358 1099.14,445.973 1101.45,370.656 1103.76,541.657 1106.06,504.786 1108.37,293.606 1110.68,548.441 1112.99,550.458 1115.3,287.954 1117.6,305.635 1119.91,431.611 1122.22,319.73 1124.53,356.4 1126.84,378.684 1129.14,363.429 1131.45,396.754 1133.76,476.539 1136.07,426.115 1138.37,327.168 1140.68,379.93 1142.99,495.48 1145.3,411.953 1147.61,466.699 1149.91,407.958 1152.22,574.826 1154.53,629.025 1156.84,500.721 1159.15,368.765 1161.45,518.362 1163.76,443.449 1166.07,354.506 1168.38,512.775 1170.69,595.101 1172.99,363.502 1175.3,395.01 1177.61,364.787 1179.92,418.779 1182.23,389.321 1184.53,548.158 1186.84,363.529 1189.15,343.857 1191.46,498.257 1193.76,450.754 1196.07,630.219 1198.38,278.517 1200.69,495.465 1203,527.838 1205.3,522.594 1207.61,447.62 1209.92,402.919 1212.23,580.994 1214.54,451.439 1216.84,387.455 1219.15,479.452 1221.46,555.447 1223.77,426.458 1226.08,326.004 1228.38,494.189 1230.69,313.257 1233,572.957 1235.31,328.154 1237.61,494.521 1239.92,612.071 1242.23,612.268 1244.54,401.71 1246.85,568.153 1249.15,277.468 1251.46,622.769 1253.77,307.633 1256.08,472.837 1258.39,355.157 1260.69,525.331 1263,363.753 1265.31,441.97 1267.62,495.163 1269.93,540.726 1272.23,398.518 1274.54,545.402 1276.85,401.78 1279.16,399.16 1281.47,515.407 1283.77,397.714 1286.08,445.363 1288.39,486.67 1290.7,538.191 1293,589.38 1295.31,337.84 1297.62,440.388 1299.93,439.793 1302.24,508.743 1304.54,367.194 1306.85,359.065 1309.16,512.307 1311.47,272.884 1313.78,429.985 1316.08,591.401 1318.39,475.151 1320.7,487.155 1323.01,398.972 1325.32,351.498 1327.62,467.77 1329.93,515.103 1332.24,391.491 1334.55,626.325 1336.86,609.221 1339.16,570.208 1341.47,429.937 1343.78,412.691 1346.09,289.466 1348.39,504.757 1350.7,464.343 1353.01,525.22 1355.32,384.004 1357.63,559.643 1359.93,428.228 1362.24,292.33 1364.55,584.983 1366.86,519.681 1369.17,449.991 1371.47,380.63 1373.78,357.549 1376.09,378.673 1378.4,409.543 1380.71,614.01 1383.01,368.639 1385.32,407.835 1387.63,479.861 1389.94,310.929 1392.24,352.465 1394.55,309.849 1396.86,291.054 1399.17,470.424 1401.48,539.299 1403.78,468.041 1406.09,254.551 1408.4,467.771 1410.71,327.449 1413.02,470.586 1415.32,614.894 1417.63,436.891 1419.94,349.037 1422.25,338.294 1424.56,138.624 1426.86,408.508 1429.17,452.446 1431.48,478.92 1433.79,566.788 1436.1,331.083 1438.4,244.812 1440.71,284.278 1443.02,358.029 1445.33,422.786 1447.63,545.574 1449.94,259.358 1452.25,432.478 1454.56,286.396 1456.87,157.227 1459.17,419.086 1461.48,405.588 1463.79,310.949 1466.1,428.264 1468.41,300.203 1470.71,381.675 1473.02,558.166 1475.33,502.976 1477.64,479.152 1479.95,367.171 1482.25,552.431 1484.56,558.102 1486.87,383.433 1489.18,326.961 1491.49,373.348 1493.79,468.685 1496.1,482.338 1498.41,465.689 1500.72,602.768 1503.02,177.601 1505.33,563.668 1507.64,458.202 1509.95,429.873 1512.26,392.587 1514.56,541.633 1516.87,567.174 1519.18,500.709 1521.49,308.879 1523.8,551.058 1526.1,481.31 1528.41,390.549 1530.72,620.242 1533.03,451.002 1535.34,366.567 1537.64,563.817 1539.95,464.237 1542.26,172.37 1544.57,407.774 1546.88,380.151 1549.18,437.848 1551.49,362.744 1553.8,374.519 1556.11,96.8724 1558.41,229.61 1560.72,570.843 1563.03,450.209 1565.34,442.722 1567.65,382.819 1569.95,302.48 1572.26,454.171 1574.57,494.906 1576.88,363.01 1579.19,245.155 1581.49,449.657 1583.8,590.632 1586.11,407.992 1588.42,432.822 1590.73,301.91 1593.03,456.616 1595.34,535.523 1597.65,323.195 1599.96,398.952 1602.26,219.691 1604.57,453.524 1606.88,441.832 1609.19,297.743 1611.5,466.892 1613.8,545.745 1616.11,426.017 1618.42,363.714 1620.73,406.984 1623.04,271.253 1625.34,296.854 1627.65,411.177 1629.96,386.323 1632.27,357.415 1634.58,530.121 1636.88,404.746 1639.19,308.594 1641.5,433.303 1643.81,459.41 1646.12,386.403 1648.42,267.502 1650.73,538.823 1653.04,344.005 1655.35,478.017 1657.65,272.525 1659.96,285.599 1662.27,413.662 1664.58,316.731 1666.89,427.972 1669.19,466.084 1671.5,526.005 1673.81,304.258 1676.12,361.672 1678.43,349.104 1680.73,345.368 1683.04,377.828 1685.35,331.781 1687.66,478.812 1689.97,307.814 1692.27,309.326 1694.58,382.7 1696.89,400.134 1699.2,337.303 1701.51,410.597 1703.81,390.997 1706.12,470.023 1708.43,579.732 1710.74,417.884 1713.04,709.604 1715.35,342.848 1717.66,333.996 1719.97,304.797 1722.28,402.554 1724.58,455.254 1726.89,360.386 1729.2,578.157 1731.51,345.028 1733.82,371.238 1736.12,478.293 1738.43,435.081 1740.74,294.578 1743.05,479.908 1745.36,624.202 1747.66,389.204 1749.97,333.959 1752.28,392.582 1754.59,533.276 1756.9,320.076 1759.2,455.91 1761.51,507.801 1763.82,414.198 1766.13,466.242 1768.43,413.267 1770.74,607.661 1773.05,633.943 1775.36,324.708 1777.67,265.953 1779.97,416.864 1782.28,336.459 1784.59,353.06 1786.9,299.985 1789.21,417.807 1791.51,411.395 1793.82,525.238 1796.13,321.549 1798.44,336.576 1800.75,510.048 1803.05,309.632 1805.36,448.21 1807.67,472.022 1809.98,554.857 1812.28,414.238 1814.59,435.362 1816.9,446.365 1819.21,419.124 1821.52,325.782 1823.82,428.718 1826.13,441.945 1828.44,549.088 1830.75,301 1833.06,421.088 1835.36,421.617 1837.67,383.406 1839.98,533.853 1842.29,324.722 1844.6,362.256 1846.9,316.686 1849.21,421.767 1851.52,384.976 1853.83,421.829 1856.14,366.363 1858.44,389.429 1860.75,456.18 1863.06,441.473 1865.37,472.636 1867.67,412.863 1869.98,551.472 1872.29,453.608 1874.6,411.426 1876.91,413.398 1879.21,553.696 1881.52,306.714 1883.83,336.857 1886.14,584.574 1888.45,307.563 1890.75,306.313 1893.06,425.278 1895.37,543.417 1897.68,323.654 1899.99,188.721 1902.29,425.237 1904.6,483.074 1906.91,363.443 1909.22,408.975 1911.53,378.384 1913.83,356.457 1916.14,325.686 1918.45,420.001 1920.76,474.423 1923.06,328.297 1925.37,363.063 1927.68,387.958 1929.99,508.394 1932.3,492.684 1934.6,492.731 1936.91,379.653 1939.22,454.374 1941.53,438.165 1943.84,353.192 1946.14,416.795 1948.45,497.589 1950.76,511.458 1953.07,451.272 1955.38,378.184 1957.68,562.249 1959.99,519.19 1962.3,551.769 1964.61,339.759 1966.91,490.703 1969.22,427.195 1971.53,371.204 1973.84,377.884 1976.15,461.266 1978.45,531.065 1980.76,481.139 1983.07,335.51 1985.38,199.641 1987.69,503.007 1989.99,356.185 1992.3,463.729 1994.61,532.893 1996.92,411.856 1999.23,340.086 2001.53,475.063 2003.84,463.699 2006.15,420.76 2008.46,415.689 2010.77,489.311 2013.07,415.747 2015.38,576.84 2017.69,455.466 2020,367.046 2022.3,501.438 2024.61,566.526 2026.92,277.758 2029.23,424.502 2031.54,565.07 2033.84,492.835 2036.15,363.288 2038.46,358.631 2040.77,504.037 2043.08,473.445 2045.38,625.259 2047.69,501.682 2050,506.276 2052.31,366.697 2054.62,531.105 2056.92,457.626 2059.23,550.835 2061.54,353.507 2063.85,514.907 2066.16,465.593 2068.46,438.517 2070.77,529.957 2073.08,451.393 2075.39,455.851 2077.69,306.28 2080,437.896 2082.31,327.751 2084.62,385.346 2086.93,576.512 2089.23,427.621 2091.54,384.86 2093.85,445.679 2096.16,395.386 2098.47,483.422 2100.77,349.764 2103.08,526.688 2105.39,375.901 2107.7,530.776 2110.01,284.844 2112.31,473.105 2114.62,567.322 2116.93,390.381 2119.24,414.927 2121.55,359.637 2123.85,448.27 2126.16,583.642 2128.47,281.114 2130.78,514.4 2133.08,462.923 2135.39,563.427 2137.7,453.398 2140.01,371.32 2142.32,552.285 2144.62,285.957 2146.93,466.137 2149.24,231.438 2151.55,492.276 2153.86,485.978 2156.16,525.502 2158.47,507.372 2160.78,325.238 2163.09,477.248 2165.4,379.789 2167.7,397.187 2170.01,303.467 2172.32,582.693 2174.63,264.303 2176.93,425.213 2179.24,266.711 2181.55,433.882 2183.86,500.782 2186.17,451.934 2188.47,382.81 2190.78,413.621 2193.09,437.073 2195.4,339.352 2197.71,265.07 2200.01,419.922 2202.32,581.304 2204.63,336.973 2206.94,348.423 2209.25,400.004 2211.55,443.648 2213.86,308.149 2216.17,295.867 2218.48,444.225 2220.79,592.558 2223.09,610.792 2225.4,364.815 2227.71,341.898 2230.02,488.938 2232.32,316.619 2234.63,476.319 2236.94,273.951 2239.25,294.01 2241.56,324.257 2243.86,426.788 2246.17,288.289 2248.48,578.292 2250.79,484.938 2253.1,641.209 2255.4,334.743 2257.71,360.1 2260.02,311.027 2262.33,487.057 2264.64,561.246 2266.94,472.656 2269.25,567.526 2271.56,458.772 2273.87,423.302 2276.18,399.973 2278.48,253.378 2280.79,567.964 2283.1,436.257 2285.41,653.802 2287.71,434.394 2290.02,371.679 2292.33,587.409 2294.64,372.276 2296.95,552.514 2299.25,410.727 2301.56,448.616 2303.87,556.985 2306.18,311.272 2308.49,462.821 2310.79,211.126 2313.1,468.381 2315.41,516.638 2317.72,297.585 2320.03,528.238 2322.33,558.373 2324.64,366.599 2326.95,321.304 2329.26,387.006 2331.56,459.311 2333.87,533.182 2336.18,496.925 2338.49,596.793 2340.8,266.823 2343.1,218.583 2345.41,313.494 2347.72,428.45 2350.03,432.175 2352.34,527.809 2354.64,476 2356.95,414.994 2359.26,416.648 2361.57,550.653 2363.88,340.726 2366.18,354.324 2368.49,516.798 2370.8,408.702 2373.11,555.85 2375.42,299.164 2377.72,398.322 2380.03,378.692 2382.34,382.5 2384.65,412.231 2386.95,351.902 2389.26,435.22 2391.57,511.72 2393.88,401.522 2396.19,469.2 2398.49,463.645 2400.8,378.255 2403.11,367.096 2405.42,301.606 2407.73,561.44 2410.03,285.029 2412.34,304.737 2414.65,296.088 2416.96,437.671 2419.27,340.878 2421.57,527.772 2423.88,468.17 2426.19,396.397 2428.5,276.058 2430.81,286.427 2433.11,477.721 2435.42,383.833 2437.73,261.66 2440.04,507.357 2442.34,471.77 2444.65,458.967 2446.96,411.925 2449.27,382.26 2451.58,416.732 2453.88,436.96 2456.19,307.157 2458.5,357.739 2460.81,308.44 2463.12,530.197 2465.42,561.592 2467.73,458.913 2470.04,402.709 2472.35,545.758 2474.66,431.428 2476.96,514.736 2479.27,610.231 2481.58,373.457 2483.89,222.92 2486.2,368.245 2488.5,349.209 2490.81,526.788 2493.12,539.515 2495.43,267.931 2497.73,365.484 2500.04,404.25 2502.35,488.052 2504.66,394.298 2506.97,432.406 2509.27,219.889 2511.58,486.844 2513.89,428.324 2516.2,417.821 2518.51,522.329 2520.81,477.023 2523.12,651.438 2525.43,568.477 2527.74,643.428 2530.05,356.874 2532.35,464.163 2534.66,460.939 2536.97,421.865 2539.28,592.893 2541.58,344.14 2543.89,329.861 2546.2,457.566 2548.51,399.578 2550.82,340.409 2553.12,341.145 2555.43,617.013 2557.74,374.755 2560.05,417.276 2562.36,426.685 2564.66,477.78 2566.97,122.54 2569.28,485.635 2571.59,437.739 "></polyline>
</svg>
</div>
</div>
<p>Look at that! Things are working; amazin’.</p>
<p>We can also exploit <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>’s parallel sampling capabilities:</p>
<div id="34" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run separate 4 chains for 10 000 iterations using threads to parallelize.</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>num_chains <span class="op">=</span> <span class="fl">4</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    model_with_grad,</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">MCMCThreads</span>(),</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>,</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    num_chains;</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Note we need to provide an initial state for every chain.</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>    initial_state<span class="op">=</span><span class="fu">fill</span>(state, num_chains),</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>samples_array <span class="op">=</span> <span class="fu">stack</span>(<span class="fu">map</span>(<span class="bu">Base</span>.<span class="fu">Fix1</span>(stack, sample <span class="op">-&gt;</span> sample.x), samples))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000×4 Array{Float64, 3}:
[:, :, 1] =
 -1.84427   -3.48534   -6.69808    -5.50199  …  -3.85519  -5.24721  -6.90461
  0.102179   0.137017  -0.0734085  -3.11763      1.21074   1.18354   0.697138
  1.32673    2.52899    3.84553     3.97957      7.13591   4.55625   5.17774

[:, :, 2] =
 -2.60852   -2.74627   -4.67021   …  -6.00944   -6.00944   -4.99464
  0.730771  -0.532744  -0.198755      0.414754   0.414754   0.484418
  1.38225    2.14402    4.15733       5.42115    5.42115    5.92132

[:, :, 3] =
 -2.51984   -3.76235   -4.1838     -4.40465  …  -4.81902  -5.42433  -6.37073
 -0.934099   0.222446   0.0617963   1.6849       1.35096   1.65586   1.34472
  2.76126    5.00424    4.39884     5.0867       3.87488   5.8769    4.98262

[:, :, 4] =
 -2.41298   -4.39692  -4.39692  -5.08258  …  -5.95327   -4.45768   -4.04847
 -0.619497  -0.19096  -0.19096   1.12685      0.273915  -0.556506  -0.797696
  3.23707    3.82415   3.82415   3.01813      4.21787    4.40204    3.38414</code></pre>
</div>
</div>
<p>But the fact that we have to provide the <code>AbstractMCMC.sample</code> call, etc. with an <code>initial_state</code> to get started is a bit annoying. We can avoid this by also defining a <code>AbstractMCMC.step</code> <em>without</em> the <code>state</code> argument:</p>
<div id="36" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">::</span><span class="dt">MALA</span>;</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># </span><span class="al">NOTE</span><span class="co">: No state provided!</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just create the initial state by sampling using  a Gaussian.</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="fu">randn</span>(rng, LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(x), <span class="fu">MALAState</span>(x)</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Equipped with this, we no longer need to provide the <code>initial_state</code> everywhere:</p>
<div id="38" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -4.97078    1.00193
  0.0277682  1.0023
  5.01526    1.0169</code></pre>
</div>
</div>
</section>
<section id="using-our-sampler-with-turing.jl" class="level2">
<h2 class="anchored" data-anchor-id="using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</h2>
<p>As we promised, all of this hassle of implementing our <code>MALA</code> sampler in a way that uses <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> and <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> gets us something more than <em>just</em> an “automatic” implementation of <code>AbstractMCMC.sample</code>.</p>
<p>It also enables use with Turing.jl through the <code>externalsampler</code>, but we need to do one final thing first: we need to tell Turing.jl how to extract a vector of parameters from the “sample” returned in our implementation of <code>AbstractMCMC.step</code>. In our case, the “sample” is a <code>MALASample</code>, so we just need the following line:</p>
<div id="40" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load Turing.jl.</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Turing</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Overload the `getparams` method for our "sample" type, which is just a vector.</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>Turing.Inference.<span class="fu">getparams</span>(<span class="op">::</span><span class="dt">Turing.Model</span>, sample<span class="op">::</span><span class="dt">MALASample</span>) <span class="op">=</span> sample.x</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And with that, we’re good to go!</p>
<div id="42" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Our previous model defined as a Turing.jl model.</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">mvnormal_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">MvNormal</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.], I)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate our model.</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">mvnormal_model</span>()</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Call `sample` but now we're passing in a Turing.jl `model` and wrapping</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co"># our `MALA` sampler in the `externalsampler` to tell Turing.jl that the sampler</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co"># expects something that implements LogDensityProblems.jl.</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×4×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 3.03 seconds
Compute duration  = 3.03 seconds
parameters        = x[1], x[2], x[3]
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters  </span><span class="ansi-bold">    mean  </span><span class="ansi-bold">     std  </span><span class="ansi-bold">    mcse  </span><span class="ansi-bold">  ess_bulk  </span><span class="ansi-bold">  ess_tail  </span><span class="ansi-bold">    rhat  </span><span class="ansi-bold"> ⋯
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">   Float64  </span><span class="ansi-bright-black-fg ansi-bold">   Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> ⋯

        x[1]   -5.0079    1.0079    0.0174   3338.2387   5501.0784    1.0005   ⋯
        x[2]    0.0168    1.0034    0.0176   3256.4770   5306.5709    1.0006   ⋯
        x[3]    4.9850    1.0012    0.0184   2958.8384   5373.5215    1.0016   ⋯
</span><span class="ansi-cyan-fg ansi-bold">                                                                1 column omitted

Quantiles
 </span><span class="ansi-cyan-fg ansi-bold"> parameters  </span><span class="ansi-cyan-fg ansi-bold">    2.5%  </span><span class="ansi-cyan-fg ansi-bold">   25.0%  </span><span class="ansi-cyan-fg ansi-bold">   50.0%  </span><span class="ansi-cyan-fg ansi-bold">   75.0%  </span><span class="ansi-cyan-fg ansi-bold">   97.5%
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64

        x[1]   -7.0061   -5.6837   -4.9859   -4.3507   -3.0297
        x[2]   -1.9213   -0.6706    0.0189    0.6999    1.9688
        x[3]    3.0039    4.3106    4.9681    5.6478    6.9460
</span></pre>
</div>
</div>
</div>
<p>Pretty neat, eh?</p>
<section id="models-with-constrained-parameters" class="level3">
<h3 class="anchored" data-anchor-id="models-with-constrained-parameters">Models with constrained parameters</h3>
<p>One thing we’ve sort of glossed over in all of the above is that MALA, at least how we’ve implemented it, requires <span class="math inline">\(x\)</span> to live in <span class="math inline">\(\mathbb{R}^d\)</span> for some <span class="math inline">\(d &gt; 0\)</span>. If some of the parameters were in fact constrained, e.g.&nbsp;we were working with a <code>Beta</code> distribution which has support on the interval <span class="math inline">\((0, 1)\)</span>, <em>not</em> on <span class="math inline">\(\mathbb{R}^d\)</span>, we could easily end up outside of the valid range <span class="math inline">\((0, 1)\)</span>.</p>
<div id="44" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">beta_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">beta_model</span>()</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 2.0 seconds
Compute duration  = 2.0 seconds
parameters        = x
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters  </span><span class="ansi-bold">    mean  </span><span class="ansi-bold">     std  </span><span class="ansi-bold">    mcse  </span><span class="ansi-bold">  ess_bulk  </span><span class="ansi-bold">  ess_tail  </span><span class="ansi-bold">    rhat  </span><span class="ansi-bold"> ⋯
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">   Float64  </span><span class="ansi-bright-black-fg ansi-bold">   Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> ⋯

           x    0.4996    0.1902    0.0030   3992.8706   5470.0037    1.0003   ⋯
</span><span class="ansi-cyan-fg ansi-bold">                                                                1 column omitted

Quantiles
 </span><span class="ansi-cyan-fg ansi-bold"> parameters  </span><span class="ansi-cyan-fg ansi-bold">    2.5%  </span><span class="ansi-cyan-fg ansi-bold">   25.0%  </span><span class="ansi-cyan-fg ansi-bold">   50.0%  </span><span class="ansi-cyan-fg ansi-bold">   75.0%  </span><span class="ansi-cyan-fg ansi-bold">   97.5%
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64

           x    0.1457    0.3575    0.4993    0.6419    0.8555
</span></pre>
</div>
</div>
</div>
<p>Yep, that still works, but only because Turing.jl actually <em>transforms</em> the <code>turing_model</code> from constrained to unconstrained, so that the <code>sampler</code> provided to <code>externalsampler</code> is actually always working in unconstrained space! This is not always desirable, so we can turn this off:</p>
<div id="46" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 0.19 seconds
Compute duration  = 0.19 seconds
parameters        = x
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters  </span><span class="ansi-bold">    mean  </span><span class="ansi-bold">     std  </span><span class="ansi-bold">    mcse  </span><span class="ansi-bold"> ess_bulk  </span><span class="ansi-bold"> ess_tail  </span><span class="ansi-bold">    rhat  </span><span class="ansi-bold"> e ⋯
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">  Float64  </span><span class="ansi-bright-black-fg ansi-bold">  Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">   ⋯

           x    0.8448    0.0000    0.0000        NaN        NaN       NaN     ⋯
</span><span class="ansi-cyan-fg ansi-bold">                                                                1 column omitted

Quantiles
 </span><span class="ansi-cyan-fg ansi-bold"> parameters  </span><span class="ansi-cyan-fg ansi-bold">    2.5%  </span><span class="ansi-cyan-fg ansi-bold">   25.0%  </span><span class="ansi-cyan-fg ansi-bold">   50.0%  </span><span class="ansi-cyan-fg ansi-bold">   75.0%  </span><span class="ansi-cyan-fg ansi-bold">   97.5%
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64

           x    0.8448    0.8448    0.8448    0.8448    0.8448
</span></pre>
</div>
</div>
</div>
<p>The fun thing is that this still sort of works because</p>
<div id="48" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">logpdf</span>(<span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>), <span class="fl">10.0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-Inf</code></pre>
</div>
</div>
<p>and so the samples that fall outside of the range are always rejected. But do notice how much worse all the diagnostics are, e.g.&nbsp;<code>ess_tail</code> is very poor compared to when we use <code>unconstrained=true</code>. Moreover, in more complex cases this won’t just result in a “nice” <code>-Inf</code> log-density value, but instead will error:</p>
<div id="50" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="kw">function</span> <span class="fu">demo</span>()</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>    σ² <span class="op">~</span> <span class="fu">truncated</span>(<span class="fu">Normal</span>(), lower<span class="op">=</span><span class="fl">0</span>)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If we end up with negative values for `σ²`, the `Normal` will error.</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>    x <span class="op">~</span> <span class="fu">Normal</span>(<span class="fl">0</span>, σ²)</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre>DomainError with Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}}(-0.16295579012975625,1.0,0.0):
Normal: the condition σ &gt;= zero(σ) is not satisfied.
Stacktrace:
  [1] <span class="ansi-bold">#371</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/YQSrn/src/univariate/continuous/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">normal.jl:37</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [2] <span class="ansi-bold">check_args</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/YQSrn/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">utils.jl:89</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [3] <span class="ansi-bold">#Normal#370</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/YQSrn/src/univariate/continuous/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">normal.jl:37</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [4] <span class="ansi-bold">Normal</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/YQSrn/src/univariate/continuous/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">normal.jl:36</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [5] <span class="ansi-bold">Normal</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/YQSrn/src/univariate/continuous/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">normal.jl:42</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [6] <span class="ansi-bold">macro expansion</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/I9lST/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">compiler.jl:558</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [7] <span class="ansi-bold">demo</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">__model__</span>::DynamicPPL.Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}</span>, <span class="ansi-bright-black-fg">__varinfo__</span>::DynamicPPL.ThreadSafeVarInfo<span class="ansi-bright-black-fg">{DynamicPPL.VarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}, ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}, Vector{Base.RefValue{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}</span>, <span class="ansi-bright-black-fg">__context__</span>::DynamicPPL.DefaultContext<span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-magenta-fg">Main.Notebook</span> <span class="ansi-bright-black-fg">~/work/docs/docs/developers/inference/implementing-samplers/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">index.qmd:457</span>
  [8] <span class="ansi-bold">_evaluate!!</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/I9lST/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">model.jl:913</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [9] <span class="ansi-bold">evaluate_threadsafe!!</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">model</span>::DynamicPPL.Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}</span>, <span class="ansi-bright-black-fg">varinfo</span>::DynamicPPL.VarInfo<span class="ansi-bright-black-fg">{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}, ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}</span>, <span class="ansi-bright-black-fg">context</span>::DynamicPPL.DefaultContext<span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-cyan-fg">DynamicPPL</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/I9lST/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">model.jl:902</span>
 [10] <span class="ansi-bold">evaluate!!</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/I9lST/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">model.jl:832</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [11] <span class="ansi-bold">logdensity_at</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/I9lST/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">logdensityfunction.jl:183</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [12] <span class="ansi-bold">FixTail</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DifferentiationInterface/zJHX8/src/utils/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">context.jl:169</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [13] <span class="ansi-bold">vector_mode_dual_eval!</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">f</span>::DifferentiationInterface.FixTail<span class="ansi-bright-black-fg">{typeof(DynamicPPL.logdensity_at), Tuple{DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, DynamicPPL.VarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}, DynamicPPL.DefaultContext}}</span>, <span class="ansi-bright-black-fg">cfg</span>::ForwardDiff.GradientConfig<span class="ansi-bright-black-fg">{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}</span>, <span class="ansi-bright-black-fg">x</span>::Vector<span class="ansi-bright-black-fg">{Float64}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-green-fg">ForwardDiff</span> <span class="ansi-bright-black-fg">~/.julia/packages/ForwardDiff/UBbGT/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">apiutils.jl:24</span>
 [14] <span class="ansi-bold">vector_mode_gradient!</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/ForwardDiff/UBbGT/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">gradient.jl:98</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [15] <span class="ansi-bold">gradient!</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">result</span>::DiffResults.MutableDiffResult<span class="ansi-bright-black-fg">{1, Float64, Tuple{Vector{Float64}}}</span>, <span class="ansi-bright-black-fg">f</span>::DifferentiationInterface.FixTail<span class="ansi-bright-black-fg">{typeof(DynamicPPL.logdensity_at), Tuple{DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, DynamicPPL.VarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}, DynamicPPL.DefaultContext}}</span>, <span class="ansi-bright-black-fg">x</span>::Vector<span class="ansi-bright-black-fg">{Float64}</span>, <span class="ansi-bright-black-fg">cfg</span>::ForwardDiff.GradientConfig<span class="ansi-bright-black-fg">{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}</span>, ::Val<span class="ansi-bright-black-fg">{false}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-green-fg">ForwardDiff</span> <span class="ansi-bright-black-fg">~/.julia/packages/ForwardDiff/UBbGT/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">gradient.jl:39</span>
 [16] <span class="ansi-bold">value_and_gradient</span><span class="ansi-bold">(</span>::typeof(DynamicPPL.logdensity_at), ::DifferentiationInterfaceForwardDiffExt.ForwardDiffGradientPrep<span class="ansi-bright-black-fg">{Nothing, ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}, Tuple{Nothing, Nothing, Nothing}}</span>, ::AutoForwardDiff<span class="ansi-bright-black-fg">{2, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}}</span>, ::Vector<span class="ansi-bright-black-fg">{Float64}</span>, ::DifferentiationInterface.Constant<span class="ansi-bright-black-fg">{DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}}</span>, ::DifferentiationInterface.Constant<span class="ansi-bright-black-fg">{DynamicPPL.VarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}}</span>, ::DifferentiationInterface.Constant<span class="ansi-bright-black-fg">{DynamicPPL.DefaultContext}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-yellow-fg">DifferentiationInterfaceForwardDiffExt</span> <span class="ansi-bright-black-fg">~/.julia/packages/DifferentiationInterface/zJHX8/ext/DifferentiationInterfaceForwardDiffExt/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">onearg.jl:417</span>
 [17] <span class="ansi-bold">logdensity_and_gradient</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">f</span>::LogDensityFunction<span class="ansi-bright-black-fg">{DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, DynamicPPL.VarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}, DynamicPPL.DefaultContext, AutoForwardDiff{2, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}}}</span>, <span class="ansi-bright-black-fg">x</span>::Vector<span class="ansi-bright-black-fg">{Float64}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-cyan-fg">DynamicPPL</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/I9lST/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">logdensityfunction.jl:234</span>
 [18] <span class="ansi-bold">leapfrog_step</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">model</span>::LogDensityFunction<span class="ansi-bright-black-fg">{DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, DynamicPPL.VarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}, DynamicPPL.DefaultContext, AutoForwardDiff{2, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}}}</span>, <span class="ansi-bright-black-fg">x</span>::Vector<span class="ansi-bright-black-fg">{Float64}</span>, <span class="ansi-bright-black-fg">p</span>::Vector<span class="ansi-bright-black-fg">{Float64}</span>, <span class="ansi-bright-black-fg">ϵ</span>::Int64, <span class="ansi-bright-black-fg">M</span>::UniformScaling<span class="ansi-bright-black-fg">{Bool}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-magenta-fg">Main.Notebook</span> <span class="ansi-bright-black-fg">~/work/docs/docs/developers/inference/implementing-samplers/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">index.qmd:305</span>
 [19] <span class="ansi-bold">step</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">rng</span>::TaskLocalRNG, <span class="ansi-bright-black-fg">model_wrapper</span>::AbstractMCMC.LogDensityModel<span class="ansi-bright-black-fg">{LogDensityFunction{DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, DynamicPPL.VarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}, DynamicPPL.DefaultContext, AutoForwardDiff{2, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}}}}</span>, <span class="ansi-bright-black-fg">sampler</span>::MALA<span class="ansi-bright-black-fg">{Int64, UniformScaling{Bool}}</span>, <span class="ansi-bright-black-fg">state</span>::MALAState<span class="ansi-bright-black-fg">{Vector{Float64}}</span>; <span class="ansi-bright-black-fg">kwargs</span>::@Kwargs<span class="ansi-bright-black-fg">{}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-magenta-fg">Main.Notebook</span> <span class="ansi-bright-black-fg">~/work/docs/docs/developers/inference/implementing-samplers/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">index.qmd:276</span>
 [20] <span class="ansi-bold">step</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">rng</span>::TaskLocalRNG, <span class="ansi-bright-black-fg">model_wrapper</span>::AbstractMCMC.LogDensityModel<span class="ansi-bright-black-fg">{LogDensityFunction{DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, DynamicPPL.VarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}, DynamicPPL.DefaultContext, AutoForwardDiff{2, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}}}}</span>, <span class="ansi-bright-black-fg">sampler</span>::MALA<span class="ansi-bright-black-fg">{Int64, UniformScaling{Bool}}</span>, <span class="ansi-bright-black-fg">state</span>::MALAState<span class="ansi-bright-black-fg">{Vector{Float64}}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-magenta-fg">Main.Notebook</span> <span class="ansi-bright-black-fg">~/work/docs/docs/developers/inference/implementing-samplers/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">index.qmd:258</span>
 [21] <span class="ansi-bold">step</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">rng</span>::TaskLocalRNG, <span class="ansi-bright-black-fg">model</span>::DynamicPPL.Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}</span>, <span class="ansi-bright-black-fg">sampler_wrapper</span>::DynamicPPL.Sampler<span class="ansi-bright-black-fg">{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}</span>, <span class="ansi-bright-black-fg">state</span>::Turing.Inference.TuringState<span class="ansi-bright-black-fg">{MALAState{Vector{Float64}}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, DynamicPPL.VarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}, DynamicPPL.DefaultContext}</span>; <span class="ansi-bright-black-fg">kwargs</span>::@Kwargs<span class="ansi-bright-black-fg">{}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-magenta-fg">Turing.Inference</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/MwOAl/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">abstractmcmc.jl:91</span>
 [22] <span class="ansi-bold">step</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">rng</span>::TaskLocalRNG, <span class="ansi-bright-black-fg">model</span>::DynamicPPL.Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}</span>, <span class="ansi-bright-black-fg">sampler_wrapper</span>::DynamicPPL.Sampler<span class="ansi-bright-black-fg">{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}</span>, <span class="ansi-bright-black-fg">state</span>::Turing.Inference.TuringState<span class="ansi-bright-black-fg">{MALAState{Vector{Float64}}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, DynamicPPL.VarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}, DynamicPPL.DefaultContext}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-magenta-fg">Turing.Inference</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/MwOAl/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">abstractmcmc.jl:80</span>
 [23] <span class="ansi-bold">macro expansion</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/AbstractMCMC/kwj9g/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">sample.jl:219</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [24] <span class="ansi-bold">macro expansion</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/AbstractMCMC/kwj9g/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">logging.jl:16</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [25] <span class="ansi-bold">mcmcsample</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">rng</span>::TaskLocalRNG, <span class="ansi-bright-black-fg">model</span>::DynamicPPL.Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}</span>, <span class="ansi-bright-black-fg">sampler</span>::DynamicPPL.Sampler<span class="ansi-bright-black-fg">{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}</span>, <span class="ansi-bright-black-fg">N</span>::Int64; <span class="ansi-bright-black-fg">progress</span>::Bool, <span class="ansi-bright-black-fg">progressname</span>::String, <span class="ansi-bright-black-fg">callback</span>::Nothing, <span class="ansi-bright-black-fg">num_warmup</span>::Int64, <span class="ansi-bright-black-fg">discard_initial</span>::Int64, <span class="ansi-bright-black-fg">thinning</span>::Int64, <span class="ansi-bright-black-fg">chain_type</span>::Type, <span class="ansi-bright-black-fg">initial_state</span>::Nothing, <span class="ansi-bright-black-fg">kwargs</span>::@Kwargs<span class="ansi-bright-black-fg">{}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-cyan-fg">AbstractMCMC</span> <span class="ansi-bright-black-fg">~/.julia/packages/AbstractMCMC/kwj9g/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">sample.jl:144</span>
 [26] <span class="ansi-bold">sample</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">rng</span>::TaskLocalRNG, <span class="ansi-bright-black-fg">model</span>::DynamicPPL.Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}</span>, <span class="ansi-bright-black-fg">sampler</span>::DynamicPPL.Sampler<span class="ansi-bright-black-fg">{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}</span>, <span class="ansi-bright-black-fg">N</span>::Int64; <span class="ansi-bright-black-fg">chain_type</span>::Type, <span class="ansi-bright-black-fg">resume_from</span>::Nothing, <span class="ansi-bright-black-fg">initial_state</span>::Nothing, <span class="ansi-bright-black-fg">kwargs</span>::@Kwargs<span class="ansi-bright-black-fg">{progress::Bool}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-cyan-fg">DynamicPPL</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/I9lST/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">sampler.jl:102</span>
 [27] <span class="ansi-bold">sample</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/I9lST/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">sampler.jl:92</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [28] <span class="ansi-bold">#sample#8</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/MwOAl/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">Inference.jl:277</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [29] <span class="ansi-bold">sample</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/MwOAl/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">Inference.jl:268</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [30] <span class="ansi-bold">#sample#7</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/MwOAl/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">Inference.jl:265</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [31] top-level scope
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/work/docs/docs/developers/inference/implementing-samplers/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">index.qmd:459</span></pre>
</div>
</div>
</div>
<p>As expected, we run into a <code>DomainError</code> at some point, while if we set <code>unconstrained=true</code>, letting Turing.jl transform the model to a unconstrained form behind the scenes, everything works as expected:</p>
<div id="52" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 0.61 seconds
Compute duration  = 0.61 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters  </span><span class="ansi-bold">    mean  </span><span class="ansi-bold">     std  </span><span class="ansi-bold">    mcse  </span><span class="ansi-bold"> ess_bulk  </span><span class="ansi-bold"> ess_tail  </span><span class="ansi-bold">    rhat  </span><span class="ansi-bold"> e ⋯
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">  Float64  </span><span class="ansi-bright-black-fg ansi-bold">  Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">   ⋯

          σ²    1.3674    1.2031    0.2377    47.8826        NaN    1.0970     ⋯
           x   -0.0423    1.0655    0.1082    86.8534   314.6115    1.0349     ⋯
</span><span class="ansi-cyan-fg ansi-bold">                                                                1 column omitted

Quantiles
 </span><span class="ansi-cyan-fg ansi-bold"> parameters  </span><span class="ansi-cyan-fg ansi-bold">    2.5%  </span><span class="ansi-cyan-fg ansi-bold">   25.0%  </span><span class="ansi-cyan-fg ansi-bold">   50.0%  </span><span class="ansi-cyan-fg ansi-bold">   75.0%  </span><span class="ansi-cyan-fg ansi-bold">   97.5%
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64

          σ²    0.1395    0.4947    0.9405    1.6618    3.8626
           x   -1.7236   -0.9097   -0.0616    0.3802    2.7337
</span></pre>
</div>
</div>
</div>
<p>Neat!</p>
<p>Similarly, which automatic differentiation backend one should use can be specified through the <code>adtype</code> keyword argument too. For example, if we want to use <a href="https://github.com/JuliaDiff/ReverseDiff.jl">ReverseDiff.jl</a> instead of the default <a href="https://github.com/JuliaDiff/ForwardDiff.jl">ForwardDiff.jl</a>:</p>
<div id="54" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">ReverseDiff</span>: ReverseDiff</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify that we want to use `AutoReverseDiff`.</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">demo</span>(),</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>, adtype<span class="op">=</span><span class="fu">AutoReverseDiff</span>()),</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>;</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 3.02 seconds
Compute duration  = 3.02 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters  </span><span class="ansi-bold">    mean  </span><span class="ansi-bold">     std  </span><span class="ansi-bold">    mcse  </span><span class="ansi-bold"> ess_bulk  </span><span class="ansi-bold"> ess_tail  </span><span class="ansi-bold">    rhat  </span><span class="ansi-bold"> e ⋯
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">  Float64  </span><span class="ansi-bright-black-fg ansi-bold">  Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">   ⋯

          σ²    0.1529    0.0000    0.0000        NaN        NaN       NaN     ⋯
           x   -0.5887    0.0000    0.0000        NaN        NaN       NaN     ⋯
</span><span class="ansi-cyan-fg ansi-bold">                                                                1 column omitted

Quantiles
 </span><span class="ansi-cyan-fg ansi-bold"> parameters  </span><span class="ansi-cyan-fg ansi-bold">    2.5%  </span><span class="ansi-cyan-fg ansi-bold">   25.0%  </span><span class="ansi-cyan-fg ansi-bold">   50.0%  </span><span class="ansi-cyan-fg ansi-bold">   75.0%  </span><span class="ansi-cyan-fg ansi-bold">   97.5%
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64

          σ²    0.1529    0.1529    0.1529    0.1529    0.1529
           x   -0.5887   -0.5887   -0.5887   -0.5887   -0.5887
</span></pre>
</div>
</div>
</div>
<p>Double-neat.</p>
</section>
</section>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<p>At this point it’s worth maybe reminding ourselves what we did and also <em>why</em> we did it:</p>
<ol type="1">
<li>We define our models in the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface because it makes the sampler agnostic to how the underlying model is implemented.</li>
<li>We implement our sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> interface, which just means that our sampler is a subtype of <code>AbstractMCMC.AbstractSampler</code> and we implement the MCMC transition in <code>AbstractMCMC.step</code>.</li>
<li>Points 1 and 2 makes it so our sampler can be used with a wide range of model implementations, amongst them being models implemented in both Turing.jl and Stan. This gives you, the inference implementer, a large collection of models to test your inference method on, in addition to allowing users of Turing.jl and Stan to try out your inference method with minimal effort.</li>
</ol>


</section>


<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a><div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>We’re going with the leapfrog formulation because in a future version of this tutorial we’ll add a section extending this simple “baseline” MALA sampler to more complex versions. See <a href="https://github.com/TuringLang/docs/issues/479">issue #479</a> for progress on this.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>There is no such thing as a proper interface in Julia (at least not officially), and so we use the word “interface” here to mean a few minimal methods that needs to be implemented by any type that we treat as a target model.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    // Ensure there is a toggle, if there isn't float one in the top right
    if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
      const a = window.document.createElement('a');
      a.classList.add('top-right');
      a.classList.add('quarto-color-scheme-toggle');
      a.href = "";
      a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
      const i = window.document.createElement("i");
      i.classList.add('bi');
      a.appendChild(i);
      window.document.body.appendChild(a);
    }
    setColorSchemeToggle(hasAlternateSentinel())
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/turinglang\.org\/docs\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../../developers/inference/variational-inference/index.html" class="pagination-link" aria-label="Variational Inference">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Variational Inference</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Turing is created by <a href="http://mlg.eng.cam.ac.uk/hong/" target="_blank">Hong Ge</a>, and lovingly maintained by the <a href="https://github.com/TuringLang/Turing.jl/graphs/contributors" target="_blank">core team</a> of volunteers. <br> The contents of this website are © 2024 under the terms of the <a href="https://github.com/TuringLang/Turing.jl/blob/main/LICENCE" target="_blank">MIT License</a>.</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/TuringLang/docs/edit/main/developers/inference/implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/docs/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://x.com/TuringLang">
      <i class="bi bi-twitter" role="img" aria-label="Turing Twitter">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/TuringLang/Turing.jl">
      <i class="bi bi-github" role="img" aria-label="Turing GitHub">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




<script src="../../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>