<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.40">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Implementing Samplers – Turing.jl</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<link href="../../../developers/inference/variational-inference/index.html" rel="prev">
<link href="../../../assets/favicon.ico" rel="icon">
<script src="../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-549806ee2085284f45b00abea8c6df48.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-dark-8ea72dc5fed832574809a9c94082fbbb.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap-a904fe798f451b888977173a242a08b2.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../../site_libs/bootstrap/bootstrap-dark-6446c4a78ab5e6e6a879d0c742ae2904.min.css" rel="prefetch" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<style>
  a {
    text-decoration: none;
  }
  a:hover {
    text-decoration: underline;
  }
</style>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../../theming/styles.css">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="https://turinglang.org/" class="navbar-brand navbar-brand-logo">
    <img src="../../../assets/images/turing-logo.svg" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="https://turinglang.org/">
    <span class="navbar-title">Turing.jl</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../getting-started/"> 
<span class="menu-text">Get Started</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../tutorials/coin-flipping/"> 
<span class="menu-text">Tutorials</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/library/"> 
<span class="menu-text">Libraries</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/news/"> 
<span class="menu-text">News</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/team/"> 
<span class="menu-text">Team</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-v0.36" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">v0.36</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-v0.36">    
        <li>
    <a class="dropdown-item" href="https://turinglang.org/docs/changelog.html">
 <span class="dropdown-text">Changelog</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://turinglang.org/docs/versions.html">
 <span class="dropdown-text">All Versions</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools tools-wide">
    <a href="https://x.com/TuringLang" title="Turing Twitter" class="quarto-navigation-tool px-1" aria-label="Turing Twitter"><i class="bi bi-twitter"></i></a>
    <a href="https://github.com/TuringLang/Turing.jl" title="Turing GitHub" class="quarto-navigation-tool px-1" aria-label="Turing GitHub"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../../developers/contributing/index.html">Developers</a></li><li class="breadcrumb-item"><a href="../../../developers/inference/abstractmcmc-interface/index.html">Inference (note: outdated)</a></li><li class="breadcrumb-item"><a href="../../../developers/inference/implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../getting-started/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Getting Started</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../core-functionality/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Core Functionality</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false">
 <span class="menu-text">User Guide</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/automatic-differentiation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Automatic Differentiation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/custom-distribution/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Custom Distributions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/probability-interface/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Querying Model Probabilities</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/modifying-logprob/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Modifying the Log Probability</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/generated-quantities/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Generated Quantities</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/mode-estimation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Mode Estimation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/performance-tips/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Performance Tips</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/sampler-visualisation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Sampler Visualization</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/dynamichmc/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using DynamicHMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/external-samplers/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using External Samplers</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false">
 <span class="menu-text">Tutorials</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/coin-flipping/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction: Coin Flipping</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/gaussian-mixture-models/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Mixture Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-neural-networks/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Neural Networks</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/hidden-markov-models/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Hidden Markov Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-linear-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Linear Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/infinite-mixture-models/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Infinite Mixture Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-poisson-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Poisson Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/multinomial-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Multinomial Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-differential-equations/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Differential Equations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/probabilistic-pca/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Probabilistic PCA</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-time-series-analysis/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Time Series Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/gaussian-processes-introduction/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Processes: Introduction</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/gaussian-process-latent-variable-models/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Process Latent Variable Models</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Developers</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/contributing/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Contributing</span></a>
  </div>
</li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false">
 <span class="menu-text">DynamicPPL’s Compiler</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/compiler/model-manual/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Manually Defining a Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/compiler/minituring-compiler/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation I: Compiler</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/compiler/minituring-contexts/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation II: Contexts</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/compiler/design-overview/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Turing Compiler Design (Outdated)</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false">
 <span class="menu-text">Variable Transformations</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/transforms/distributions/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Distributions and the Jacobian</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/transforms/bijectors/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bijectors in MCMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/transforms/dynamicppl/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variable transformations in DynamicPPL</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true">
 <span class="menu-text">Inference (note: outdated)</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/inference/abstractmcmc-interface/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Interface Guide</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/inference/abstractmcmc-turing/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">How Turing Implements AbstractMCMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/inference/variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/inference/implementing-samplers/index.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Implementing Samplers</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of Contents</h2>
   
  <ul>
  <li><a href="#quick-overview-of-mala" id="toc-quick-overview-of-mala" class="nav-link active" data-scroll-target="#quick-overview-of-mala">Quick overview of MALA</a></li>
  <li><a href="#what-we-need-from-a-model-logdensityproblems.jl" id="toc-what-we-need-from-a-model-logdensityproblems.jl" class="nav-link" data-scroll-target="#what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: LogDensityProblems.jl</a></li>
  <li><a href="#implementing-mala-in-abstractmcmc.jl" id="toc-implementing-mala-in-abstractmcmc.jl" class="nav-link" data-scroll-target="#implementing-mala-in-abstractmcmc.jl">Implementing MALA in AbstractMCMC.jl</a></li>
  <li><a href="#using-our-sampler-with-turing.jl" id="toc-using-our-sampler-with-turing.jl" class="nav-link" data-scroll-target="#using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</a>
  <ul class="collapse">
  <li><a href="#models-with-constrained-parameters" id="toc-models-with-constrained-parameters" class="nav-link" data-scroll-target="#models-with-constrained-parameters">Models with constrained parameters</a></li>
  </ul></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/TuringLang/docs/edit/master/developers/inference/implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/docs/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../../developers/contributing/index.html">Developers</a></li><li class="breadcrumb-item"><a href="../../../developers/inference/abstractmcmc-interface/index.html">Inference (note: outdated)</a></li><li class="breadcrumb-item"><a href="../../../developers/inference/implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Implementing Samplers</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>In this tutorial, we’ll go through step-by-step how to implement a “simple” sampler in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> in such a way that it can be easily applied to Turing.jl models.</p>
<p>In particular, we’re going to implement a version of <strong>Metropolis-adjusted Langevin (MALA)</strong>.</p>
<p>Note that we will implement this sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> framework, completely “ignoring” Turing.jl until the very end of the tutorial, at which point we’ll use a single line of code to make the resulting sampler available to Turing.jl. This is to really drive home the point that one can implement samplers in a way that is accessible to all of Turing.jl’s users without having to use Turing.jl yourself.</p>
<section id="quick-overview-of-mala" class="level2">
<h2 class="anchored" data-anchor-id="quick-overview-of-mala">Quick overview of MALA</h2>
<p>We can view MALA as a single step of the leapfrog intergrator with resampling of momentum <span class="math inline">\(p\)</span> at every step.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> To make that statement a bit more concrete, we first define the <em>extended</em> target <span class="math inline">\(\bar{\gamma}(x, p)\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\log \bar{\gamma}(x, p) \propto \log \gamma(x) + \log \gamma_{\mathcal{N}(0, M)}(p)
\end{equation*}\]</span></p>
<p>where <span class="math inline">\(\gamma_{\mathcal{N}(0, M)}\)</span> denotes the density for a zero-centered Gaussian with covariance matrix <span class="math inline">\(M\)</span>. We then consider targeting this joint distribution over both <span class="math inline">\(x\)</span> and <span class="math inline">\(p\)</span> as follows. First we define the map</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  L_{\epsilon}: \quad &amp; \mathbb{R}^d \times \mathbb{R}^d \to \mathbb{R}^d \times \mathbb{R}^d \\
  &amp; (x, p) \mapsto (\tilde{x}, \tilde{p}) := L_{\epsilon}(x, p)
\end{split}
\end{equation*}\]</span></p>
<p>as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p_{1 / 2} &amp;:= p + \frac{\epsilon}{2} \nabla \log \gamma(x) \\
  \tilde{x} &amp;:= x + \epsilon M^{-1} p_{1 /2 } \\
  p_1 &amp;:= p_{1 / 2} + \frac{\epsilon}{2} \nabla \log \gamma(\tilde{x}) \\
  \tilde{p} &amp;:= - p_1
\end{split}
\end{equation*}\]</span></p>
<p>This might be familiar for some readers as a single step of the Leapfrog integrator. We then define the MALA kernel as follows: given the current iterate <span class="math inline">\(x_i\)</span>, we sample the next iterate <span class="math inline">\(x_{i + 1}\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p &amp;\sim \mathcal{N}(0, M) \\
  (\tilde{x}, \tilde{p}) &amp;:= L_{\epsilon}(x_i, p) \\
  \alpha &amp;:= \min \left\{ 1, \frac{\bar{\gamma}(\tilde{x}, \tilde{p})}{\bar{\gamma}(x_i, p)} \right\} \\
  x_{i + 1} &amp;:=
  \begin{cases}
    \tilde{x} \quad &amp; \text{ with prob. } \alpha \\
    x_i       \quad &amp; \text{ with prob. } 1 - \alpha
  \end{cases}
\end{split}
\end{equation*}\]</span></p>
<p>i.e.&nbsp;we accept the proposal <span class="math inline">\(\tilde{x}\)</span> with probability <span class="math inline">\(\alpha\)</span> and reject it, thus sticking with our current iterate, with probability <span class="math inline">\(1 - \alpha\)</span>.</p>
</section>
<section id="what-we-need-from-a-model-logdensityproblems.jl" class="level2">
<h2 class="anchored" data-anchor-id="what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a></h2>
<p>There are a few things we need from the “target” / “model” / density that we want to sample from:</p>
<ol type="1">
<li>We need access to log-density <em>evaluations</em> <span class="math inline">\(\log \gamma(x)\)</span> so we can compute the acceptance ratio involving <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>We need access to log-density <em>gradients</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span> so we can compute the Leapfrog steps <span class="math inline">\(L_{\epsilon}(x, p)\)</span>.</li>
<li>We also need access to the “size” of the model so we can determine the size of <span class="math inline">\(M\)</span>.</li>
</ol>
<p>Luckily for us, there is a package called <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> which provides an interface for <em>exactly</em> this!</p>
<p>To demonstrate how one can implement the “<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface”<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> we will use a simple Gaussian model as an example:</p>
<div id="4" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblems</span>: LogDensityProblems;</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's define some type that represents the model.</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> IsotropicNormalModel{M<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"mean of the isotropic Gaussian"</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    mean<span class="op">::</span><span class="dt">M</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Specifies what input length the model expects.</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">dimension</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> <span class="fu">length</span>(model.mean)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Implementation of the log-density evaluation of the model.</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x<span class="op">::</span><span class="dt">AbstractVector{&lt;:Real}</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">-</span> <span class="fu">sum</span>(abs2, x <span class="op">.-</span> model.mean) <span class="op">/</span> <span class="fl">2</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This gives us all of the properties we want for our MALA sampler with the exception of the computation of the <em>gradient</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span>. There is the method <code>LogDensityProblems.logdensity_and_gradient</code> which should return a 2-tuple where the first entry is the evaluation of the logdensity <span class="math inline">\(\log \gamma(x)\)</span> and the second entry is the gradient <span class="math inline">\(\nabla \log \gamma(x)\)</span>.</p>
<p>There are two ways to “implement” this method: 1) we implement it by hand, which is feasible in the case of our <code>IsotropicNormalModel</code>, or b) we defer the implementation of this to a automatic differentiation backend.</p>
<p>To implement it by hand we can simply do</p>
<div id="6" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl that first-order, i.e. gradient information, is available.</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{1}</span>()</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Implement `logdensity_and_gradient`.</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    logγ_x <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="op">-</span>x <span class="op">.*</span> (x <span class="op">-</span> model.mean)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> logγ_x, ∇logγ_x</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s just try it out:</p>
<div id="8" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate the problem.</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> <span class="fu">IsotropicNormalModel</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.])</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create some example input that we can test on.</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>x_example <span class="op">=</span> <span class="fu">randn</span>(LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate!</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-41.38558472175727</code></pre>
</div>
</div>
<p>To defer it to an automatic differentiation backend, we can do</p>
<div id="10" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl we only have access to 0-th order information.</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{0}</span>()</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Use `LogDensityProblemsAD`'s `ADgradient` in combination with some AD backend to implement `logdensity_and_gradient`.</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblemsAD</span>, <span class="bu">ADTypes</span>, <span class="bu">ForwardDiff</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>model_with_grad <span class="op">=</span> <span class="fu">ADgradient</span>(<span class="fu">AutoForwardDiff</span>(), model)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model_with_grad, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-41.38558472175727</code></pre>
</div>
</div>
<p>We’ll continue with the second approach in this tutorial since this is typically what one does in practice, because there are better hobbies to spend time on than deriving gradients by hand.</p>
<p>At this point, one might wonder how we’re going to tie this back to Turing.jl in the end. Effectively, when working with inference methods that only require log-density evaluations and / or higher-order information of the log-density, Turing.jl actually converts the user-provided <code>Model</code> into an object implementing the above methods for <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>. As a result, most samplers provided by Turing.jl are actually implemented to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, enabling their use both <em>within</em> Turing.jl and <em>outside</em> of Turing.jl! Morever, there exists similar conversions for Stan through BridgeStan and Stan<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, which means that a sampler supporting the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface can easily be used on both Turing.jl <em>and</em> Stan models (in addition to user-provided models, as our <code>IsotropicNormalModel</code> above)!</p>
<p>Anyways, let’s move on to actually implementing the sampler.</p>
</section>
<section id="implementing-mala-in-abstractmcmc.jl" class="level2">
<h2 class="anchored" data-anchor-id="implementing-mala-in-abstractmcmc.jl">Implementing MALA in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a></h2>
<p>Now that we’ve established that a model implementing the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface provides us with all the information we need from <span class="math inline">\(\log \gamma(x)\)</span>, we can address the question: given an object that implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, how can we define a sampler for it?</p>
<p>We’re going to do this by making our sampler a sub-type of <code>AbstractMCMC.AbstractSampler</code> in addition to implementing a few methods from <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>. Why? Because it gets us <em>a lot</em> of functionality for free, as we will see later.</p>
<p>Moreover, <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> provides a very natural interface for MCMC algorithms.</p>
<p>First, we’ll define our <code>MALA</code> type</p>
<div id="12" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">AbstractMCMC</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALA{T,A} <span class="op">&lt;:</span><span class="dt"> AbstractMCMC.AbstractSampler</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"stepsize used in the leapfrog step"</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    ϵ_init<span class="op">::</span><span class="dt">T</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"covariance matrix used for the momentum"</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    M_init<span class="op">::</span><span class="dt">A</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notice how we’ve added the suffix <code>_init</code> to both the stepsize and the covariance matrix. We’ve done this because a <code>AbstractMCMC.AbstractSampler</code> should be <em>immutable</em>. Of course there might be many scenarios where we want to allow something like the stepsize and / or the covariance matrix to vary between iterations, e.g.&nbsp;during the burn-in / adaptation phase of the sampling process we might want to adjust the parameters using statistics computed from these initial iterations. But information which can change between iterations <em>should not go in the sampler itself</em>! Instead, this information should go in the sampler <em>state</em>.</p>
<p>The sampler state should at the very least contain all the necessary information to perform the next MCMC iteration, but usually contains further information, e.g.&nbsp;quantities and statistics useful for evaluating whether the sampler has converged.</p>
<p>We will use the following sampler state for our <code>MALA</code> sampler:</p>
<div id="14" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALAState{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This might seem overly redundant: we’re defining a type <code>MALAState</code> and it only contains a simple vector of reals. In this particular case we indeed could have dropped this and simply used a <code>AbstractVector{&lt;:Real}</code> as our sampler state, but typically, as we will see later, one wants to include other quantities in the sampler state. For example, if we also wanted to adapt the parameters of our <code>MALA</code>, e.g.&nbsp;alter the stepsize depending on acceptance rates, in which case we should also put <code>ϵ</code> in the state, but for now we’ll keep things simple.</p>
<p>Moreover, we also want a <em>sample</em> type, which is a type meant for “public consumption”, i.e.&nbsp;the end-user. This is generally going to contain a subset of the information present in the state. But in such a simple scenario as this, we similarly only have a <code>AbstractVector{&lt;:Real}</code>:</p>
<div id="16" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALASample{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We currently have three things:</p>
<ol type="1">
<li>A <code>AbstractMCMC.AbstractSampler</code> implementation called <code>MALA</code>.</li>
<li>A state <code>MALAState</code> for our sampler <code>MALA</code>.</li>
<li>A sample <code>MALASample</code> for our sampler <code>MALA</code>.</li>
</ol>
<p>That means that we’re ready to implement the only thing that really matters: <code>AbstractMCMC.step</code>.</p>
<p><code>AbstractMCMC.step</code> defines the MCMC iteration of our <code>MALA</code> given the current <code>MALAState</code>. Specifically, the signature of the function is as follows:</p>
<div id="18" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The RNG to ensure reproducibility.</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The model that defines our target.</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.AbstractModel</span>,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The sampler for which we're taking a `step`.</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">AbstractMCMC.AbstractSampler</span>,</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The current sampler `state`.</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    state;</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Additional keyword arguments that we may or may not need.</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Moreover, there is a specific <code>AbstractMCMC.AbstractModel</code> which is used to indicate that the model that is provided implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface: <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Since, as we discussed earlier, in our case we’re indeed going to work with types that support the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, we’ll define <code>AbstractMCMC.step</code> for such a <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Note that <code>AbstractMCMC.LogDensityModel</code> has no other purpose; it has a single field called <code>logdensity</code>, and it does nothing else. But by wrapping the model in <code>AbstractMCMC.LogDensityModel</code>, it allows samplers that want to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> to define their <code>AbstractMCMC.step</code> on this type without running into method ambiguities.</p>
<p>All in all, that means that the signature for our <code>AbstractMCMC.step</code> is going to be the following:</p>
<div id="20" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># `LogDensityModel` so we know we're working with LogDensityProblems.jl model.</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler.</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler state.</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Great! Now let’s actually implement the full <code>AbstractMCMC.step</code> for our <code>MALA</code>.</p>
<p>Let’s remind ourselves what we’re going to do:</p>
<ol type="1">
<li>Sample a new momentum <span class="math inline">\(p\)</span>.</li>
<li>Compute the log-density of the extended target <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>Take a single leapfrog step <span class="math inline">\((\tilde{x}, \tilde{p}) = L_{\epsilon}(x, p)\)</span>.</li>
<li>Accept or reject the proposed <span class="math inline">\((\tilde{x}, \tilde{p})\)</span>.</li>
</ol>
<p>All in all, this results in the following:</p>
<div id="22" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>: Random</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Distributions</span>  <span class="co"># so we get the `MvNormal`</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the wrapped model which implements LogDensityProblems.jl.</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just extract the sampler parameters to make our lives easier.</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    ϵ <span class="op">=</span> sampler.ϵ_init</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    M <span class="op">=</span> sampler.M_init</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the current parameters.</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> state.x</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sample the momentum.</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>    p_dist <span class="op">=</span> <span class="fu">MvNormal</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)), M)</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> <span class="fu">rand</span>(rng, p_dist)</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Propose using a single leapfrog step.</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>    x̃, p̃ <span class="op">=</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Accept or reject proposal.</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>    logp <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p)</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>    logp̃ <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x̃) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p̃)</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>    logα <span class="op">=</span> logp̃ <span class="op">-</span> logp</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>    state_new <span class="op">=</span> <span class="cf">if</span> <span class="fu">log</span>(<span class="fu">rand</span>(rng)) <span class="op">&lt;</span> logα</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Accept.</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x̃)</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Reject.</span></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x)</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return the "sample" and the sampler state.</span></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(state_new.x), state_new</span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Fairly straight-forward.</p>
<p>Of course, we haven’t defined the <code>leapfrog_step</code> method yet, so let’s do that:</p>
<div id="24" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p` using "position" `x`.</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x))</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    p1 <span class="op">=</span> p <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update the "position" `x` using momentum `p1`.</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    x̃ <span class="op">=</span> x <span class="op">+</span> ϵ <span class="op">.*</span> (M <span class="op">\</span> p1)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p1` using position `x̃`</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x̃ <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x̃))</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    p2 <span class="op">=</span> p1 <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x̃</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Flip momentum `p2`.</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    p̃ <span class="op">=</span> <span class="op">-</span>p2</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x̃, p̃</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>leapfrog_step (generic function with 1 method)</code></pre>
</div>
</div>
<p>With all of this, we’re technically ready to sample!</p>
<div id="26" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>, <span class="bu">LinearAlgebra</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>rng <span class="op">=</span> <span class="bu">Random</span>.<span class="fu">default_rng</span>()</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>sampler <span class="op">=</span> <span class="fu">MALA</span>(<span class="fl">1</span>, I)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>state <span class="op">=</span> <span class="fu">MALAState</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)))</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>x_next, state_next <span class="op">=</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    rng,</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    AbstractMCMC.<span class="fu">LogDensityModel</span>(model),</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    state</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>(MALASample{Vector{Float64}}([0.0, 0.0, 0.0]), MALAState{Vector{Float64}}([0.0, 0.0, 0.0]))</code></pre>
</div>
</div>
<p>Great, it works!</p>
<p>And I promised we would get quite some functionality for free if we implemented <code>AbstractMCMC.step</code>, and so we can now simply call <code>sample</code> to perform standard MCMC sampling:</p>
<div id="28" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform 1000 iterations with our `MALA` sampler.</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; initial_state<span class="op">=</span>state, progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Concatenate into a matrix.</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000 Matrix{Float64}:
 -2.63506   -4.50009  -4.43617   …  -5.8142    -5.12837   -5.05468
  0.315609  -2.38043  -0.554991      0.789546  -0.411099  -0.348127
  1.99643    4.85942   5.5971        7.93989    6.7898     3.96069</code></pre>
</div>
</div>
<div id="30" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the marginal means and standard deviations.</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -4.98106    1.00673
 -0.0133515  0.98394
  5.0067     0.987909</code></pre>
</div>
</div>
<p>Let’s visualize the samples</p>
<div id="32" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">StatsPlots</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">transpose</span>(samples_matrix[<span class="op">:</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">:</span><span class="kw">end</span>]), alpha<span class="op">=</span><span class="fl">0.5</span>, legend<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<!--?xml version="1.0" encoding="utf-8"?-->
<svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" width="672" height="480" viewbox="0 0 2688 1920">
<defs>
  <clippath id="clip190">
    <rect x="0" y="0" width="2688" height="1920"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip190)" d="M0 1920 L2688 1920 L2688 0 L0 0  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip191">
    <rect x="537" y="0" width="1883" height="1883"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip190)" d="M151.747 1800.78 L2640.76 1800.78 L2640.76 47.2441 L151.747 47.2441  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip192">
    <rect x="151" y="47" width="2490" height="1755"></rect>
  </clippath>
</defs>
<polyline clip-path="url(#clip192)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="219.84,1800.78 219.84,47.2441 "></polyline>
<polyline clip-path="url(#clip192)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="807.458,1800.78 807.458,47.2441 "></polyline>
<polyline clip-path="url(#clip192)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1395.08,1800.78 1395.08,47.2441 "></polyline>
<polyline clip-path="url(#clip192)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1982.69,1800.78 1982.69,47.2441 "></polyline>
<polyline clip-path="url(#clip192)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="2570.31,1800.78 2570.31,47.2441 "></polyline>
<polyline clip-path="url(#clip192)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,1536.97 2640.76,1536.97 "></polyline>
<polyline clip-path="url(#clip192)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,1236.27 2640.76,1236.27 "></polyline>
<polyline clip-path="url(#clip192)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,935.572 2640.76,935.572 "></polyline>
<polyline clip-path="url(#clip192)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,634.872 2640.76,634.872 "></polyline>
<polyline clip-path="url(#clip192)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,334.173 2640.76,334.173 "></polyline>
<polyline clip-path="url(#clip190)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1800.78 2640.76,1800.78 "></polyline>
<polyline clip-path="url(#clip190)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="219.84,1800.78 219.84,1781.88 "></polyline>
<polyline clip-path="url(#clip190)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="807.458,1800.78 807.458,1781.88 "></polyline>
<polyline clip-path="url(#clip190)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1395.08,1800.78 1395.08,1781.88 "></polyline>
<polyline clip-path="url(#clip190)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1982.69,1800.78 1982.69,1781.88 "></polyline>
<polyline clip-path="url(#clip190)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="2570.31,1800.78 2570.31,1781.88 "></polyline>
<path clip-path="url(#clip190)" d="M219.84 1834 Q216.229 1834 214.4 1837.57 Q212.595 1841.11 212.595 1848.24 Q212.595 1855.34 214.4 1858.91 Q216.229 1862.45 219.84 1862.45 Q223.474 1862.45 225.28 1858.91 Q227.108 1855.34 227.108 1848.24 Q227.108 1841.11 225.28 1837.57 Q223.474 1834 219.84 1834 M219.84 1830.3 Q225.65 1830.3 228.706 1834.9 Q231.784 1839.49 231.784 1848.24 Q231.784 1856.96 228.706 1861.57 Q225.65 1866.15 219.84 1866.15 Q214.03 1866.15 210.951 1861.57 Q207.896 1856.96 207.896 1848.24 Q207.896 1839.49 210.951 1834.9 Q214.03 1830.3 219.84 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip190)" d="M771.15 1861.55 L787.47 1861.55 L787.47 1865.48 L765.525 1865.48 L765.525 1861.55 Q768.187 1858.79 772.771 1854.16 Q777.377 1849.51 778.558 1848.17 Q780.803 1845.65 781.683 1843.91 Q782.585 1842.15 782.585 1840.46 Q782.585 1837.71 780.641 1835.97 Q778.72 1834.23 775.618 1834.23 Q773.419 1834.23 770.965 1835 Q768.535 1835.76 765.757 1837.31 L765.757 1832.59 Q768.581 1831.46 771.035 1830.88 Q773.488 1830.3 775.525 1830.3 Q780.896 1830.3 784.09 1832.98 Q787.285 1835.67 787.285 1840.16 Q787.285 1842.29 786.474 1844.21 Q785.687 1846.11 783.581 1848.7 Q783.002 1849.37 779.9 1852.59 Q776.798 1855.78 771.15 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip190)" d="M797.331 1830.92 L815.687 1830.92 L815.687 1834.86 L801.613 1834.86 L801.613 1843.33 Q802.632 1842.98 803.65 1842.82 Q804.669 1842.64 805.687 1842.64 Q811.474 1842.64 814.854 1845.81 Q818.233 1848.98 818.233 1854.4 Q818.233 1859.97 814.761 1863.08 Q811.289 1866.15 804.97 1866.15 Q802.794 1866.15 800.525 1865.78 Q798.28 1865.41 795.872 1864.67 L795.872 1859.97 Q797.956 1861.11 800.178 1861.66 Q802.4 1862.22 804.877 1862.22 Q808.882 1862.22 811.22 1860.11 Q813.558 1858.01 813.558 1854.4 Q813.558 1850.78 811.22 1848.68 Q808.882 1846.57 804.877 1846.57 Q803.002 1846.57 801.127 1846.99 Q799.275 1847.4 797.331 1848.28 L797.331 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip190)" d="M837.446 1834 Q833.835 1834 832.007 1837.57 Q830.201 1841.11 830.201 1848.24 Q830.201 1855.34 832.007 1858.91 Q833.835 1862.45 837.446 1862.45 Q841.081 1862.45 842.886 1858.91 Q844.715 1855.34 844.715 1848.24 Q844.715 1841.11 842.886 1837.57 Q841.081 1834 837.446 1834 M837.446 1830.3 Q843.256 1830.3 846.312 1834.9 Q849.391 1839.49 849.391 1848.24 Q849.391 1856.96 846.312 1861.57 Q843.256 1866.15 837.446 1866.15 Q831.636 1866.15 828.557 1861.57 Q825.502 1856.96 825.502 1848.24 Q825.502 1839.49 828.557 1834.9 Q831.636 1830.3 837.446 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip190)" d="M1354.69 1830.92 L1373.05 1830.92 L1373.05 1834.86 L1358.98 1834.86 L1358.98 1843.33 Q1360 1842.98 1361.01 1842.82 Q1362.03 1842.64 1363.05 1842.64 Q1368.84 1842.64 1372.22 1845.81 Q1375.6 1848.98 1375.6 1854.4 Q1375.6 1859.97 1372.12 1863.08 Q1368.65 1866.15 1362.33 1866.15 Q1360.16 1866.15 1357.89 1865.78 Q1355.64 1865.41 1353.24 1864.67 L1353.24 1859.97 Q1355.32 1861.11 1357.54 1861.66 Q1359.76 1862.22 1362.24 1862.22 Q1366.25 1862.22 1368.58 1860.11 Q1370.92 1858.01 1370.92 1854.4 Q1370.92 1850.78 1368.58 1848.68 Q1366.25 1846.57 1362.24 1846.57 Q1360.37 1846.57 1358.49 1846.99 Q1356.64 1847.4 1354.69 1848.28 L1354.69 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip190)" d="M1394.81 1834 Q1391.2 1834 1389.37 1837.57 Q1387.56 1841.11 1387.56 1848.24 Q1387.56 1855.34 1389.37 1858.91 Q1391.2 1862.45 1394.81 1862.45 Q1398.44 1862.45 1400.25 1858.91 Q1402.08 1855.34 1402.08 1848.24 Q1402.08 1841.11 1400.25 1837.57 Q1398.44 1834 1394.81 1834 M1394.81 1830.3 Q1400.62 1830.3 1403.68 1834.9 Q1406.75 1839.49 1406.75 1848.24 Q1406.75 1856.96 1403.68 1861.57 Q1400.62 1866.15 1394.81 1866.15 Q1389 1866.15 1385.92 1861.57 Q1382.87 1856.96 1382.87 1848.24 Q1382.87 1839.49 1385.92 1834.9 Q1389 1830.3 1394.81 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip190)" d="M1424.97 1834 Q1421.36 1834 1419.53 1837.57 Q1417.73 1841.11 1417.73 1848.24 Q1417.73 1855.34 1419.53 1858.91 Q1421.36 1862.45 1424.97 1862.45 Q1428.61 1862.45 1430.41 1858.91 Q1432.24 1855.34 1432.24 1848.24 Q1432.24 1841.11 1430.41 1837.57 Q1428.61 1834 1424.97 1834 M1424.97 1830.3 Q1430.78 1830.3 1433.84 1834.9 Q1436.92 1839.49 1436.92 1848.24 Q1436.92 1856.96 1433.84 1861.57 Q1430.78 1866.15 1424.97 1866.15 Q1419.16 1866.15 1416.08 1861.57 Q1413.03 1856.96 1413.03 1848.24 Q1413.03 1839.49 1416.08 1834.9 Q1419.16 1830.3 1424.97 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip190)" d="M1940.97 1830.92 L1963.19 1830.92 L1963.19 1832.91 L1950.65 1865.48 L1945.76 1865.48 L1957.57 1834.86 L1940.97 1834.86 L1940.97 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip190)" d="M1972.36 1830.92 L1990.71 1830.92 L1990.71 1834.86 L1976.64 1834.86 L1976.64 1843.33 Q1977.66 1842.98 1978.68 1842.82 Q1979.7 1842.64 1980.72 1842.64 Q1986.5 1842.64 1989.88 1845.81 Q1993.26 1848.98 1993.26 1854.4 Q1993.26 1859.97 1989.79 1863.08 Q1986.32 1866.15 1980 1866.15 Q1977.82 1866.15 1975.55 1865.78 Q1973.31 1865.41 1970.9 1864.67 L1970.9 1859.97 Q1972.98 1861.11 1975.21 1861.66 Q1977.43 1862.22 1979.9 1862.22 Q1983.91 1862.22 1986.25 1860.11 Q1988.59 1858.01 1988.59 1854.4 Q1988.59 1850.78 1986.25 1848.68 Q1983.91 1846.57 1979.9 1846.57 Q1978.03 1846.57 1976.15 1846.99 Q1974.3 1847.4 1972.36 1848.28 L1972.36 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip190)" d="M2012.47 1834 Q2008.86 1834 2007.03 1837.57 Q2005.23 1841.11 2005.23 1848.24 Q2005.23 1855.34 2007.03 1858.91 Q2008.86 1862.45 2012.47 1862.45 Q2016.11 1862.45 2017.91 1858.91 Q2019.74 1855.34 2019.74 1848.24 Q2019.74 1841.11 2017.91 1837.57 Q2016.11 1834 2012.47 1834 M2012.47 1830.3 Q2018.28 1830.3 2021.34 1834.9 Q2024.42 1839.49 2024.42 1848.24 Q2024.42 1856.96 2021.34 1861.57 Q2018.28 1866.15 2012.47 1866.15 Q2006.66 1866.15 2003.59 1861.57 Q2000.53 1856.96 2000.53 1848.24 Q2000.53 1839.49 2003.59 1834.9 Q2006.66 1830.3 2012.47 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip190)" d="M2514.84 1861.55 L2522.48 1861.55 L2522.48 1835.18 L2514.17 1836.85 L2514.17 1832.59 L2522.43 1830.92 L2527.11 1830.92 L2527.11 1861.55 L2534.75 1861.55 L2534.75 1865.48 L2514.84 1865.48 L2514.84 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip190)" d="M2554.19 1834 Q2550.58 1834 2548.75 1837.57 Q2546.94 1841.11 2546.94 1848.24 Q2546.94 1855.34 2548.75 1858.91 Q2550.58 1862.45 2554.19 1862.45 Q2557.82 1862.45 2559.63 1858.91 Q2561.46 1855.34 2561.46 1848.24 Q2561.46 1841.11 2559.63 1837.57 Q2557.82 1834 2554.19 1834 M2554.19 1830.3 Q2560 1830.3 2563.06 1834.9 Q2566.13 1839.49 2566.13 1848.24 Q2566.13 1856.96 2563.06 1861.57 Q2560 1866.15 2554.19 1866.15 Q2548.38 1866.15 2545.3 1861.57 Q2542.25 1856.96 2542.25 1848.24 Q2542.25 1839.49 2545.3 1834.9 Q2548.38 1830.3 2554.19 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip190)" d="M2584.35 1834 Q2580.74 1834 2578.91 1837.57 Q2577.11 1841.11 2577.11 1848.24 Q2577.11 1855.34 2578.91 1858.91 Q2580.74 1862.45 2584.35 1862.45 Q2587.99 1862.45 2589.79 1858.91 Q2591.62 1855.34 2591.62 1848.24 Q2591.62 1841.11 2589.79 1837.57 Q2587.99 1834 2584.35 1834 M2584.35 1830.3 Q2590.16 1830.3 2593.22 1834.9 Q2596.3 1839.49 2596.3 1848.24 Q2596.3 1856.96 2593.22 1861.57 Q2590.16 1866.15 2584.35 1866.15 Q2578.54 1866.15 2575.46 1861.57 Q2572.41 1856.96 2572.41 1848.24 Q2572.41 1839.49 2575.46 1834.9 Q2578.54 1830.3 2584.35 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip190)" d="M2614.51 1834 Q2610.9 1834 2609.07 1837.57 Q2607.27 1841.11 2607.27 1848.24 Q2607.27 1855.34 2609.07 1858.91 Q2610.9 1862.45 2614.51 1862.45 Q2618.15 1862.45 2619.95 1858.91 Q2621.78 1855.34 2621.78 1848.24 Q2621.78 1841.11 2619.95 1837.57 Q2618.15 1834 2614.51 1834 M2614.51 1830.3 Q2620.32 1830.3 2623.38 1834.9 Q2626.46 1839.49 2626.46 1848.24 Q2626.46 1856.96 2623.38 1861.57 Q2620.32 1866.15 2614.51 1866.15 Q2608.7 1866.15 2605.62 1861.57 Q2602.57 1856.96 2602.57 1848.24 Q2602.57 1839.49 2605.62 1834.9 Q2608.7 1830.3 2614.51 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip190)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1800.78 151.747,47.2441 "></polyline>
<polyline clip-path="url(#clip190)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1536.97 170.644,1536.97 "></polyline>
<polyline clip-path="url(#clip190)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1236.27 170.644,1236.27 "></polyline>
<polyline clip-path="url(#clip190)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,935.572 170.644,935.572 "></polyline>
<polyline clip-path="url(#clip190)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,634.872 170.644,634.872 "></polyline>
<polyline clip-path="url(#clip190)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,334.173 170.644,334.173 "></polyline>
<path clip-path="url(#clip190)" d="M49.5521 1537.42 L79.2279 1537.42 L79.2279 1541.36 L49.5521 1541.36 L49.5521 1537.42 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip190)" d="M99.8991 1535.11 Q96.7509 1535.11 94.8991 1537.26 Q93.0704 1539.41 93.0704 1543.16 Q93.0704 1546.89 94.8991 1549.06 Q96.7509 1551.22 99.8991 1551.22 Q103.047 1551.22 104.876 1549.06 Q106.728 1546.89 106.728 1543.16 Q106.728 1539.41 104.876 1537.26 Q103.047 1535.11 99.8991 1535.11 M109.181 1520.45 L109.181 1524.71 Q107.422 1523.88 105.617 1523.44 Q103.834 1523 102.075 1523 Q97.4454 1523 94.9917 1526.12 Q92.5612 1529.25 92.2139 1535.57 Q93.5797 1533.56 95.6398 1532.49 Q97.7 1531.4 100.177 1531.4 Q105.385 1531.4 108.394 1534.57 Q111.427 1537.72 111.427 1543.16 Q111.427 1548.49 108.279 1551.7 Q105.131 1554.92 99.8991 1554.92 Q93.9037 1554.92 90.7325 1550.34 Q87.5612 1545.73 87.5612 1537 Q87.5612 1528.81 91.45 1523.95 Q95.3389 1519.06 101.89 1519.06 Q103.649 1519.06 105.431 1519.41 Q107.237 1519.76 109.181 1520.45 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip190)" d="M50.3623 1236.72 L80.0381 1236.72 L80.0381 1240.66 L50.3623 1240.66 L50.3623 1236.72 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip190)" d="M104.297 1234.92 Q107.654 1235.63 109.529 1237.9 Q111.427 1240.17 111.427 1243.5 Q111.427 1248.62 107.908 1251.42 Q104.39 1254.22 97.9083 1254.22 Q95.7324 1254.22 93.4176 1253.78 Q91.126 1253.37 88.6723 1252.51 L88.6723 1248 Q90.6167 1249.13 92.9315 1249.71 Q95.2463 1250.29 97.7695 1250.29 Q102.168 1250.29 104.459 1248.55 Q106.774 1246.81 106.774 1243.5 Q106.774 1240.45 104.621 1238.74 Q102.492 1237 98.6722 1237 L94.6445 1237 L94.6445 1233.16 L98.8574 1233.16 Q102.306 1233.16 104.135 1231.79 Q105.964 1230.4 105.964 1227.81 Q105.964 1225.15 104.066 1223.74 Q102.191 1222.3 98.6722 1222.3 Q96.7509 1222.3 94.5519 1222.72 Q92.3528 1223.13 89.7139 1224.01 L89.7139 1219.85 Q92.376 1219.11 94.6908 1218.74 Q97.0287 1218.37 99.0889 1218.37 Q104.413 1218.37 107.515 1220.8 Q110.617 1223.2 110.617 1227.32 Q110.617 1230.19 108.973 1232.19 Q107.33 1234.15 104.297 1234.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip190)" d="M99.4824 921.37 Q95.8713 921.37 94.0426 924.935 Q92.2371 928.477 92.2371 935.606 Q92.2371 942.713 94.0426 946.278 Q95.8713 949.819 99.4824 949.819 Q103.117 949.819 104.922 946.278 Q106.751 942.713 106.751 935.606 Q106.751 928.477 104.922 924.935 Q103.117 921.37 99.4824 921.37 M99.4824 917.667 Q105.293 917.667 108.348 922.273 Q111.427 926.856 111.427 935.606 Q111.427 944.333 108.348 948.94 Q105.293 953.523 99.4824 953.523 Q93.6723 953.523 90.5936 948.94 Q87.538 944.333 87.538 935.606 Q87.538 926.856 90.5936 922.273 Q93.6723 917.667 99.4824 917.667 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip190)" d="M104.297 633.518 Q107.654 634.236 109.529 636.504 Q111.427 638.773 111.427 642.106 Q111.427 647.222 107.908 650.023 Q104.39 652.824 97.9083 652.824 Q95.7324 652.824 93.4176 652.384 Q91.126 651.967 88.6723 651.111 L88.6723 646.597 Q90.6167 647.731 92.9315 648.31 Q95.2463 648.889 97.7695 648.889 Q102.168 648.889 104.459 647.152 Q106.774 645.416 106.774 642.106 Q106.774 639.051 104.621 637.338 Q102.492 635.602 98.6722 635.602 L94.6445 635.602 L94.6445 631.759 L98.8574 631.759 Q102.306 631.759 104.135 630.393 Q105.964 629.004 105.964 626.412 Q105.964 623.75 104.066 622.338 Q102.191 620.903 98.6722 620.903 Q96.7509 620.903 94.5519 621.319 Q92.3528 621.736 89.7139 622.616 L89.7139 618.449 Q92.376 617.708 94.6908 617.338 Q97.0287 616.967 99.0889 616.967 Q104.413 616.967 107.515 619.398 Q110.617 621.805 110.617 625.926 Q110.617 628.796 108.973 630.787 Q107.33 632.754 104.297 633.518 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip190)" d="M99.8991 332.31 Q96.7509 332.31 94.8991 334.463 Q93.0704 336.615 93.0704 340.365 Q93.0704 344.092 94.8991 346.268 Q96.7509 348.421 99.8991 348.421 Q103.047 348.421 104.876 346.268 Q106.728 344.092 106.728 340.365 Q106.728 336.615 104.876 334.463 Q103.047 332.31 99.8991 332.31 M109.181 317.657 L109.181 321.916 Q107.422 321.083 105.617 320.643 Q103.834 320.203 102.075 320.203 Q97.4454 320.203 94.9917 323.328 Q92.5612 326.453 92.2139 332.773 Q93.5797 330.759 95.6398 329.694 Q97.7 328.606 100.177 328.606 Q105.385 328.606 108.394 331.777 Q111.427 334.926 111.427 340.365 Q111.427 345.689 108.279 348.907 Q105.131 352.125 99.8991 352.125 Q93.9037 352.125 90.7325 347.541 Q87.5612 342.935 87.5612 334.208 Q87.5612 326.014 91.45 321.152 Q95.3389 316.268 101.89 316.268 Q103.649 316.268 105.431 316.615 Q107.237 316.963 109.181 317.657 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip192)" style="stroke:#009af9; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,1199.69 224.541,1168.14 226.891,1472.34 229.242,1345.95 231.592,1484.13 233.943,1271.1 236.293,1277.45 238.644,1477.94 240.994,1539.93 243.345,1279.24 245.695,1480.26 248.046,1461.9 250.396,1492.75 252.747,1419.42 255.097,1475.28 257.448,1425.03 259.798,1404.75 262.148,1447.78 264.499,1279.36 266.849,1290 269.2,1352.93 271.55,1451.58 273.901,1301.94 276.251,1574.96 278.602,1366.84 280.952,1359.47 283.303,1271.88 285.653,1393.35 288.004,1646.59 290.354,1571.55 292.705,1367.79 295.055,1362.98 297.406,1455.41 299.756,1399.15 302.107,1416.84 304.457,1567.76 306.807,1552.15 309.158,1332.99 311.508,1457.17 313.859,1496.02 316.209,1445.71 318.56,1425.61 320.91,1437.57 323.261,1468.7 325.611,1201.19 327.962,1421.91 330.312,1355.71 332.663,1265.87 335.013,1316.2 337.364,1497.91 339.714,1431.01 342.065,1348.88 344.415,1463.59 346.765,1388.49 349.116,1474.86 351.466,1484.33 353.817,1547.91 356.167,1415.83 358.518,1238.6 360.868,1342.27 363.219,1305.37 365.569,1327.22 367.92,1456.14 370.27,1282.7 372.621,1415.89 374.971,1295.42 377.322,1282.63 379.672,1469.05 382.023,1422.71 384.373,1470.05 386.724,1405.58 389.074,1592.7 391.424,1429.37 393.775,1509.74 396.125,1362 398.476,1563.72 400.826,1336.76 403.177,1222.1 405.527,1447.41 407.878,1473.25 410.228,1303.66 412.579,1513.73 414.929,1373.96 417.28,1301.49 419.63,1278.32 421.981,1381.64 424.331,1475.39 426.682,1345.82 429.032,1450.75 431.382,1470.26 433.733,1467.99 436.083,1406.59 438.434,1395.19 440.784,1650.06 443.135,1554.01 445.485,1524.55 447.836,1651.02 450.186,1327.34 452.537,1389.17 454.887,1363.67 457.238,1443.74 459.588,1376.29 461.939,1323.7 464.289,1482.31 466.64,1367.36 468.99,1645.97 471.341,1337.36 473.691,1338.6 476.041,1513.51 478.392,1277.34 480.742,1388.07 483.093,1498.74 485.443,1547.03 487.794,1382.02 490.144,1490.57 492.495,1566.81 494.845,1459.06 497.196,1422.97 499.546,1471.76 501.897,1532.33 504.247,1409.28 506.598,1393.36 508.948,1377.85 511.299,1333.01 513.649,1521.06 515.999,1562.9 518.35,1480.13 520.7,1389.49 523.051,1464.89 525.401,1471.62 527.752,1510.88 530.102,1429.41 532.453,1515.88 534.803,1140.33 537.154,1433 539.504,1452.92 541.855,1372.99 544.205,1486.74 546.556,1279.48 548.906,1612.26 551.257,1557.29 553.607,1472.68 555.958,1534.42 558.308,1511.11 560.658,1305.66 563.009,1539.33 565.359,1377.76 567.71,1436.99 570.06,1649.33 572.411,1381.6 574.761,1463.46 577.112,1509.48 579.462,1302.33 581.813,1586.75 584.163,1446.63 586.514,1396.02 588.864,1228.44 591.215,1501.01 593.565,1400.05 595.916,1370.96 598.266,1664.74 600.616,1349.17 602.967,1432.35 605.317,1263 607.668,1360.42 610.018,1514.31 612.369,1601.37 614.719,1483.91 617.07,1401.67 619.42,1477.17 621.771,1556.98 624.121,1394.82 626.472,1519.3 628.822,1515.95 631.173,1351.69 633.523,1385.41 635.874,1415.02 638.224,1330.84 640.575,1506.58 642.925,1428.12 645.275,1436.66 647.626,1503.93 649.976,1313.17 652.327,1359.12 654.677,1308.39 657.028,1383.27 659.378,1404.86 661.729,1276.77 664.079,1557.8 666.43,1481.86 668.78,1254.64 671.131,1561.37 673.481,1310.71 675.832,1586.81 678.182,1486.04 680.533,1214.55 682.883,1434.76 685.233,1430.3 687.584,1442.19 689.934,1497.11 692.285,1608.82 694.635,1461.43 696.986,1367.45 699.336,1594.69 701.687,1441.82 704.037,1402.19 706.388,1427.2 708.738,1556.84 711.089,1540.11 713.439,1497.46 715.79,1432.03 718.14,1665.39 720.491,1375.57 722.841,1370.17 725.192,1574 727.542,1284.5 729.892,1440.9 732.243,1322.35 734.593,1477.88 736.944,1394.16 739.294,1543.68 741.645,1465.09 743.995,1462.17 746.346,1400.55 748.696,1427.09 751.047,1403.53 753.397,1549.94 755.748,1364.33 758.098,1407.31 760.449,1278.02 762.799,1267.31 765.15,1504.58 767.5,1351.03 769.85,1475.95 772.201,1478.64 774.551,1402.99 776.902,1335.86 779.252,1268.45 781.603,1476.79 783.953,1412.35 786.304,1278.33 788.654,1363.04 791.005,1477 793.355,1519.93 795.706,1526.83 798.056,1494.38 800.407,1373.38 802.757,1452.85 805.108,1615.76 807.458,1395.79 809.809,1357.34 812.159,1284.21 814.509,1453.14 816.86,1192.68 819.21,1505.75 821.561,1537.7 823.911,1445.35 826.262,1493.3 828.612,1445.86 830.963,1348.09 833.313,1337.75 835.664,1306.21 838.014,1585.68 840.365,1374.88 842.715,1491.84 845.066,1517.42 847.416,1383.63 849.767,1467.78 852.117,1483.5 854.467,1414.28 856.818,1461.47 859.168,1335.01 861.519,1366.52 863.869,1483.92 866.22,1390.81 868.57,1258.89 870.921,1396.79 873.271,1502.34 875.622,1462.62 877.972,1531.38 880.323,1476.74 882.673,1392.74 885.024,1548.11 887.374,1374.52 889.725,1366.87 892.075,1542.02 894.426,1386.48 896.776,1373.2 899.126,1436.8 901.477,1286.87 903.827,1489.72 906.178,1673.07 908.528,1332.07 910.879,1437.36 913.229,1345.54 915.58,1280.14 917.93,1427.61 920.281,1598.16 922.631,1441.61 924.982,1325.07 927.332,1657.29 929.683,1479.9 932.033,1657.46 934.384,1480.4 936.734,1397.23 939.084,1478.95 941.435,1266.63 943.785,1589.89 946.136,1538.37 948.486,1356.95 950.837,1338.67 953.187,1326.67 955.538,1433.96 957.888,1439.82 960.239,1453.59 962.589,1182.03 964.94,1441.31 967.29,1380.05 969.641,1737.59 971.991,1504.2 974.342,1621.96 976.692,1156.32 979.043,1327.01 981.393,1454.51 983.743,1273.25 986.094,1440.24 988.444,1414.92 990.795,1267.47 993.145,1523.55 995.496,1463.73 997.846,1446.31 1000.2,1529.48 1002.55,1413.02 1004.9,1536.71 1007.25,1456.56 1009.6,1376.95 1011.95,1504.66 1014.3,1332.65 1016.65,1328.18 1019,1484.07 1021.35,1291.23 1023.7,1719.09 1026.05,1477.36 1028.4,1394.58 1030.75,1466.17 1033.1,1653.8 1035.45,1602.92 1037.8,1467.59 1040.15,1443.89 1042.51,1606.18 1044.86,1335.88 1047.21,1528.83 1049.56,1450.61 1051.91,1438.66 1054.26,1524.42 1056.61,1565.93 1058.96,1579.77 1061.31,1450.4 1063.66,1393.49 1066.01,1454.78 1068.36,1347.34 1070.71,1433.22 1073.06,1349.11 1075.41,1669.7 1077.76,1502.48 1080.11,1501.72 1082.46,1335.76 1084.81,1435.05 1087.16,1581.59 1089.51,1382.76 1091.87,1531.76 1094.22,1315.66 1096.57,1288.54 1098.92,1456.57 1101.27,1334.77 1103.62,1540.4 1105.97,1365.17 1108.32,1418.17 1110.67,1513.2 1113.02,1344.6 1115.37,1152.2 1117.72,1271.82 1120.07,1476 1122.42,1322.17 1124.77,1284.13 1127.12,1453.39 1129.47,1298.96 1131.82,1437.98 1134.17,1359.22 1136.52,1450.66 1138.87,1376.4 1141.23,1331.13 1143.58,1457.85 1145.93,1521.05 1148.28,1296.12 1150.63,1664.95 1152.98,1518.21 1155.33,1359.3 1157.68,1389.22 1160.03,1590.17 1162.38,1282.22 1164.73,1414.96 1167.08,1299.2 1169.43,1399.72 1171.78,1469.1 1174.13,1324.51 1176.48,1356.08 1178.83,1642.34 1181.18,1447.9 1183.53,1420.99 1185.88,1476.06 1188.23,1409 1190.59,1496.5 1192.94,1495.06 1195.29,1474.42 1197.64,1523.8 1199.99,1452.51 1202.34,1367.2 1204.69,1454.12 1207.04,1547.72 1209.39,1371.72 1211.74,1396.73 1214.09,1493.06 1216.44,1512.17 1218.79,1446.26 1221.14,1570.97 1223.49,1426.8 1225.84,1223.83 1228.19,1436.36 1230.54,1564.73 1232.89,1391.58 1235.24,1480.66 1237.59,1445.63 1239.94,1362.21 1242.3,1476.64 1244.65,1414.56 1247,1342.06 1249.35,1568.61 1251.7,1400.8 1254.05,1448.63 1256.4,1545.61 1258.75,1430.21 1261.1,1329.48 1263.45,1412.46 1265.8,1375.01 1268.15,1407.44 1270.5,1445.51 1272.85,1310.7 1275.2,1372.16 1277.55,1408.67 1279.9,1486.73 1282.25,1541.68 1284.6,1383.82 1286.95,1445.91 1289.3,1394.48 1291.66,1445.42 1294.01,1458.61 1296.36,1428.85 1298.71,1343.17 1301.06,1369.61 1303.41,1476.6 1305.76,1329.05 1308.11,1572.61 1310.46,1383.33 1312.81,1451.65 1315.16,1545.26 1317.51,1606.49 1319.86,1423.43 1322.21,1355.2 1324.56,1381.39 1326.91,1468.9 1329.26,1534.53 1331.61,1559.62 1333.96,1414.06 1336.31,1502.96 1338.66,1459.19 1341.02,1374.92 1343.37,1410.38 1345.72,1513.6 1348.07,1414.11 1350.42,1475.73 1352.77,1455.58 1355.12,1600.49 1357.47,1372.43 1359.82,1371.71 1362.17,1405.56 1364.52,1572.35 1366.87,1433.49 1369.22,1464.55 1371.57,1377.89 1373.92,1535.2 1376.27,1463.73 1378.62,1371.25 1380.97,1441.41 1383.32,1437.81 1385.67,1588.12 1388.02,1395.45 1390.38,1447.09 1392.73,1496.96 1395.08,1377.54 1397.43,1266.71 1399.78,1275.66 1402.13,1358.72 1404.48,1436.79 1406.83,1634.32 1409.18,1417.63 1411.53,1392.79 1413.88,1306.85 1416.23,1397.71 1418.58,1394.44 1420.93,1354.34 1423.28,1420.08 1425.63,1308.34 1427.98,1392.26 1430.33,1485.47 1432.68,1517.87 1435.03,1324.81 1437.38,1394.38 1439.74,1439.37 1442.09,1479.52 1444.44,1407.41 1446.79,1532.27 1449.14,1350.31 1451.49,1386.78 1453.84,1218.76 1456.19,1223.02 1458.54,1619.91 1460.89,1331.47 1463.24,1322.76 1465.59,1626.27 1467.94,1540.57 1470.29,1444.62 1472.64,1346.21 1474.99,1485.54 1477.34,1425.67 1479.69,1461.67 1482.04,1315.86 1484.39,1334.18 1486.74,1516.64 1489.1,1428.49 1491.45,1377.63 1493.8,1449.71 1496.15,1275.79 1498.5,1453.69 1500.85,1442.99 1503.2,1337.39 1505.55,1321.44 1507.9,1508.88 1510.25,1391.09 1512.6,1370.98 1514.95,1393.36 1517.3,1211.73 1519.65,1386.42 1522,1301.87 1524.35,1431.32 1526.7,1491.99 1529.05,1428.33 1531.4,1614.72 1533.75,1653.33 1536.1,1540.06 1538.45,1394.7 1540.81,1464.78 1543.16,1225.47 1545.51,1314.14 1547.86,1405.51 1550.21,1478.15 1552.56,1429.94 1554.91,1445.38 1557.26,1387.63 1559.61,1541.5 1561.96,1511.33 1564.31,1448.85 1566.66,1537.96 1569.01,1516.81 1571.36,1420.4 1573.71,1371.51 1576.06,1476.31 1578.41,1426.87 1580.76,1457.69 1583.11,1413.53 1585.46,1406.36 1587.81,1307.85 1590.17,1449.28 1592.52,1662.18 1594.87,1508.64 1597.22,1751.15 1599.57,1378.35 1601.92,1155.99 1604.27,1542.34 1606.62,1351.01 1608.97,1396.9 1611.32,1276.1 1613.67,1568 1616.02,1558.29 1618.37,1406.62 1620.72,1561.42 1623.07,1416.35 1625.42,1495.99 1627.77,1459.27 1630.12,1212.96 1632.47,1313.02 1634.82,1477.03 1637.17,1427.75 1639.53,1474.47 1641.88,1544.85 1644.23,1612.39 1646.58,1461.06 1648.93,1423.03 1651.28,1373.9 1653.63,1342.5 1655.98,1406.06 1658.33,1392.93 1660.68,1233.63 1663.03,1389.62 1665.38,1558.26 1667.73,1583.74 1670.08,1351.25 1672.43,1533.55 1674.78,1387.45 1677.13,1419.59 1679.48,1456.19 1681.83,1502.32 1684.18,1356.26 1686.53,1517.1 1688.89,1493.27 1691.24,1347.62 1693.59,1547.13 1695.94,1589.15 1698.29,1429.12 1700.64,1490.07 1702.99,1521.57 1705.34,1613.4 1707.69,1539.08 1710.04,1306.76 1712.39,1500.07 1714.74,1539.09 1717.09,1357.5 1719.44,1384.48 1721.79,1424.21 1724.14,1182.92 1726.49,1443.3 1728.84,1553.92 1731.19,1403.42 1733.54,1469.06 1735.89,1524.89 1738.25,1497.25 1740.6,1443.25 1742.95,1629.14 1745.3,1564.02 1747.65,1532.37 1750,1659.53 1752.35,1417.51 1754.7,1586.69 1757.05,1543.04 1759.4,1534.8 1761.75,1443.1 1764.1,1413.1 1766.45,1652.95 1768.8,1473.53 1771.15,1560.49 1773.5,1455.53 1775.85,1372.61 1778.2,1312.64 1780.55,1383.1 1782.9,1630.36 1785.25,1430.36 1787.6,1415.16 1789.96,1401.83 1792.31,1501.66 1794.66,1567.69 1797.01,1279.01 1799.36,1309.69 1801.71,1400.05 1804.06,1581.01 1806.41,1470.87 1808.76,1595.06 1811.11,1482.96 1813.46,1345.31 1815.81,1369.92 1818.16,1259 1820.51,1338.03 1822.86,1556.76 1825.21,1332.47 1827.56,1423.08 1829.91,1415.11 1832.26,1317.41 1834.61,1263.41 1836.96,1465.88 1839.32,1453.69 1841.67,1587.34 1844.02,1555.87 1846.37,1267.46 1848.72,1279.23 1851.07,1660.79 1853.42,1339.54 1855.77,1431.88 1858.12,1462.98 1860.47,1592.94 1862.82,1466.92 1865.17,1343.92 1867.52,1293.7 1869.87,1561.59 1872.22,1564.13 1874.57,1424.86 1876.92,1286.81 1879.27,1537.21 1881.62,1340.34 1883.97,1567.79 1886.32,1458.69 1888.68,1451.59 1891.03,1374.81 1893.38,1325.29 1895.73,1569.24 1898.08,1366.67 1900.43,1278.56 1902.78,1494.24 1905.13,1479.28 1907.48,1730.17 1909.83,1086.38 1912.18,1315.58 1914.53,1596.54 1916.88,1351.72 1919.23,1406.8 1921.58,1395.7 1923.93,1460.22 1926.28,1326.82 1928.63,1380.47 1930.98,1533.9 1933.33,1317.49 1935.68,1320 1938.04,1390.49 1940.39,1388.48 1942.74,1623.08 1945.09,1436.67 1947.44,1397.27 1949.79,1372.87 1952.14,1403.72 1954.49,1491.61 1956.84,1446.58 1959.19,1520.99 1961.54,1403.6 1963.89,1463.56 1966.24,1335.82 1968.59,1276.63 1970.94,1435.2 1973.29,1423.69 1975.64,1459.71 1977.99,1480.77 1980.34,1594.45 1982.69,1371.34 1985.04,1447.07 1987.4,1641.4 1989.75,1302.87 1992.1,1439.7 1994.45,1578.09 1996.8,1365.86 1999.15,1500.45 2001.5,1403.05 2003.85,1642.75 2006.2,1513.29 2008.55,1418.64 2010.9,1419.81 2013.25,1455.11 2015.6,1486.6 2017.95,1506.24 2020.3,1356.29 2022.65,1512.91 2025,1381.35 2027.35,1295.5 2029.7,1443.31 2032.05,1432.14 2034.4,1560.24 2036.76,1445.88 2039.11,1482.9 2041.46,1261.22 2043.81,1446.51 2046.16,1365.38 2048.51,1371.38 2050.86,1349.59 2053.21,1529.52 2055.56,1352.19 2057.91,1504.09 2060.26,1573.73 2062.61,1518.62 2064.96,1396.84 2067.31,1294.52 2069.66,1310.29 2072.01,1418.04 2074.36,1501.91 2076.71,1366.07 2079.06,1330.47 2081.41,1518.39 2083.76,1535.77 2086.11,1551.48 2088.47,1403.9 2090.82,1453.81 2093.17,1450.81 2095.52,1450.9 2097.87,1434.81 2100.22,1363.75 2102.57,1459.16 2104.92,1437.59 2107.27,1451.05 2109.62,1625.49 2111.97,1458.32 2114.32,1502.89 2116.67,1360.69 2119.02,1452.15 2121.37,1507.34 2123.72,1516.74 2126.07,1453.76 2128.42,1593.94 2130.77,1389.8 2133.12,1417.74 2135.47,1464.92 2137.83,1608.09 2140.18,1554.4 2142.53,1344.71 2144.88,1313.13 2147.23,1456.86 2149.58,1399.38 2151.93,1478.78 2154.28,1476.04 2156.63,1412.37 2158.98,1442.94 2161.33,1395.06 2163.68,1458.16 2166.03,1341.73 2168.38,1580.68 2170.73,1472.06 2173.08,1407.67 2175.43,1320.35 2177.78,1553.38 2180.13,1429.8 2182.48,1557.51 2184.83,1456.46 2187.19,1393.15 2189.54,1500.12 2191.89,1541.29 2194.24,1362.95 2196.59,1396.11 2198.94,1323.91 2201.29,1397.77 2203.64,1482.17 2205.99,1459.8 2208.34,1488.58 2210.69,1453.71 2213.04,1514.5 2215.39,1458.41 2217.74,1471.5 2220.09,1475.61 2222.44,1437.71 2224.79,1419.64 2227.14,1387.96 2229.49,1440.46 2231.84,1537.8 2234.19,1335.2 2236.55,1334.7 2238.9,1458.7 2241.25,1488.94 2243.6,1340.67 2245.95,1440.47 2248.3,1480.57 2250.65,1390.25 2253,1429.27 2255.35,1510.05 2257.7,1397.61 2260.05,1644.9 2262.4,1461.41 2264.75,1477.5 2267.1,1533.81 2269.45,1408.05 2271.8,1402.38 2274.15,1478.51 2276.5,1405.25 2278.85,1298.35 2281.2,1483.99 2283.55,1251.82 2285.91,1536.5 2288.26,1251.55 2290.61,1403.02 2292.96,1400.85 2295.31,1487.36 2297.66,1338.61 2300.01,1389.05 2302.36,1481.92 2304.71,1485.13 2307.06,1540.89 2309.41,1408.38 2311.76,1466.36 2314.11,1465.9 2316.46,1534.44 2318.81,1507.74 2321.16,1542.88 2323.51,1524.5 2325.86,1363.54 2328.21,1518.18 2330.56,1522.75 2332.91,1296.29 2335.27,1302.44 2337.62,1364.2 2339.97,1517.56 2342.32,1475.22 2344.67,1275.66 2347.02,1483.66 2349.37,1223.95 2351.72,1412.7 2354.07,1560.03 2356.42,1688.45 2358.77,1491.51 2361.12,1456.14 2363.47,1473.64 2365.82,1311.36 2368.17,1174.67 2370.52,1460.94 2372.87,1504.22 2375.22,1409.43 2377.57,1430.38 2379.92,1491.45 2382.27,1453.2 2384.62,1412.33 2386.98,1355.49 2389.33,1426.8 2391.68,1601 2394.03,1570 2396.38,1347.69 2398.73,1315.24 2401.08,1393.72 2403.43,1460.48 2405.78,1521.7 2408.13,1383.1 2410.48,1475.22 2412.83,1391.42 2415.18,1521.63 2417.53,1483.7 2419.88,1597.13 2422.23,1315.03 2424.58,1590.59 2426.93,1252.49 2429.28,1412.15 2431.63,1550.32 2433.98,1558.41 2436.34,1279.62 2438.69,1348.81 2441.04,1486.23 2443.39,1483.33 2445.74,1451.23 2448.09,1627.09 2450.44,1556.78 2452.79,1169.6 2455.14,1566.8 2457.49,1498.71 2459.84,1567.38 2462.19,1651.43 2464.54,1525.48 2466.89,1333.13 2469.24,1391.57 2471.59,1471.46 2473.94,1271.89 2476.29,1453.89 2478.64,1400.57 2480.99,1566.21 2483.34,1540.28 2485.7,1405.04 2488.05,1602.7 2490.4,1432.47 2492.75,1363.63 2495.1,1215.17 2497.45,1355.59 2499.8,1265.96 2502.15,1484.66 2504.5,1475.21 2506.85,1455.32 2509.2,1459.73 2511.55,1611.49 2513.9,1246.71 2516.25,1313.12 2518.6,1523.86 2520.95,1488.9 2523.3,1428.54 2525.65,1458.25 2528,1606.68 2530.35,1538.18 2532.7,1330.79 2535.06,1496.09 2537.41,1463.36 2539.76,1436.11 2542.11,1612.07 2544.46,1457.63 2546.81,1202.81 2549.16,1447.57 2551.51,1454.34 2553.86,1354.74 2556.21,1266.55 2558.56,1366.09 2560.91,1472.5 2563.26,1487.38 2565.61,1452.56 2567.96,1335.8 2570.31,1548.27 "></polyline>
<polyline clip-path="url(#clip192)" style="stroke:#e26f46; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,903.937 224.541,892.616 226.891,879.854 229.242,962.067 231.592,1026.1 233.943,1019.18 236.293,986.047 238.644,943.882 240.994,1021.99 243.345,883.422 245.695,884.884 248.046,834.421 250.396,1007.23 252.747,882.512 255.097,755.333 257.448,899.289 259.798,820.956 262.148,733.25 264.499,1010.18 266.849,956.602 269.2,921.554 271.55,746.438 273.901,993.792 276.251,1172.69 278.602,818.427 280.952,820.332 283.303,932.804 285.653,1012.35 288.004,1044.57 290.354,967.518 292.705,911.432 295.055,794.381 297.406,886.139 299.756,925.671 302.107,1025.91 304.457,841.698 306.807,1120.66 309.158,910.201 311.508,709.176 313.859,908.525 316.209,855.181 318.56,1136.41 320.91,1021.63 323.261,874.717 325.611,825.468 327.962,1007.71 330.312,935.925 332.663,929.962 335.013,925.782 337.364,893.494 339.714,1110.62 342.065,885.354 344.415,1042 346.765,996.378 349.116,1024.03 351.466,827.927 353.817,948.432 356.167,899.242 358.518,891.579 360.868,1017.31 363.219,858.706 365.569,972.337 367.92,919.486 370.27,847.783 372.621,1086.92 374.971,904.591 377.322,911.564 379.672,951.931 382.023,867.222 384.373,941.762 386.724,1077.87 389.074,819.286 391.424,843.403 393.775,939.511 396.125,877.835 398.476,1014.38 400.826,872.319 403.177,935.159 405.527,1037.77 407.878,902.949 410.228,780.53 412.579,949.31 414.929,795.99 417.28,792.619 419.63,1077.42 421.981,887.795 424.331,1104.33 426.682,1004.67 429.032,906.758 431.382,950.618 433.733,968.087 436.083,1065.21 438.434,759.287 440.784,1032.71 443.135,886.244 445.485,964.879 447.836,1043.83 450.186,942.873 452.537,796.578 454.887,915.959 457.238,964.503 459.588,851.486 461.939,847.567 464.289,823.202 466.64,897.849 468.99,731.49 471.341,961.082 473.691,762.672 476.041,1043.38 478.392,963.644 480.742,1019.24 483.093,819.15 485.443,1126.12 487.794,1109.77 490.144,902.516 492.495,919.04 494.845,806.824 497.196,991.154 499.546,1051.47 501.897,845.611 504.247,1054.32 506.598,922.178 508.948,900.237 511.299,818.2 513.649,735.749 515.999,771.741 518.35,844.023 520.7,765.304 523.051,1144.12 525.401,744.391 527.752,865.314 530.102,876.827 532.453,908.489 534.803,813.316 537.154,1042.53 539.504,942.453 541.855,903.621 544.205,1003.73 546.556,908.842 548.906,983.861 551.257,941.955 553.607,887.13 555.958,1113.42 558.308,1124.98 560.658,933.319 563.009,659.137 565.359,956.008 567.71,949.472 570.06,848.165 572.411,975.555 574.761,802.965 577.112,803.104 579.462,1022.44 581.813,1027.55 584.163,1201.13 586.514,874.164 588.864,767.298 591.215,953.643 593.565,872.583 595.916,1021.49 598.266,988.065 600.616,1086.22 602.967,1175.1 605.317,946.004 607.668,868.086 610.018,952.48 612.369,809.19 614.719,834.192 617.07,960.165 619.42,1005.44 621.771,972.998 624.121,937.321 626.472,797.297 628.822,767.015 631.173,844.575 633.523,1033.26 635.874,990.276 638.224,896.907 640.575,931.424 642.925,925.911 645.275,869.323 647.626,907.665 649.976,985.743 652.327,1079 654.677,886.103 657.028,834.908 659.378,967.785 661.729,793.309 664.079,922.834 666.43,783.221 668.78,773.001 671.131,879.102 673.481,1024.26 675.832,927.718 678.182,950.399 680.533,932.409 682.883,978.994 685.233,797.802 687.584,896.724 689.934,901.649 692.285,1045.92 694.635,830.939 696.986,778.92 699.336,978.81 701.687,916.286 704.037,1040.32 706.388,899.425 708.738,831.997 711.089,1062.97 713.439,859.662 715.79,1003.34 718.14,877.968 720.491,831.216 722.841,1046.97 725.192,958.233 727.542,918.845 729.892,982.229 732.243,933.154 734.593,1040.85 736.944,887.037 739.294,857.066 741.645,655.211 743.995,809.16 746.346,1075.11 748.696,993.22 751.047,955.55 753.397,993.295 755.748,1132.49 758.098,914.894 760.449,849.24 762.799,877.924 765.15,986.02 767.5,926.185 769.85,1041.94 772.201,928.027 774.551,771.742 776.902,949.285 779.252,861.732 781.603,919.053 783.953,1061.34 786.304,836.857 788.654,926.145 791.005,892.586 793.355,944.829 795.706,1112.56 798.056,905.075 800.407,951.747 802.757,952.922 805.108,914.733 807.458,928.03 809.809,937.141 812.159,782.34 814.509,867.935 816.86,901.66 819.21,1003.17 821.561,960.12 823.911,1140.69 826.262,1048.82 828.612,804.317 830.963,808.604 833.313,795.925 835.664,1085.89 838.014,851.769 840.365,872.186 842.715,860.327 845.066,960.545 847.416,776.033 849.767,933.832 852.117,797.472 854.467,937.724 856.818,1000.93 859.168,1035.26 861.519,932.2 863.869,927.843 866.22,1094.94 868.57,754.417 870.921,813.029 873.271,879.644 875.622,1096.42 877.972,1090.18 880.323,838.813 882.673,934.428 885.024,809.582 887.374,865.209 889.725,851.169 892.075,942.487 894.426,902.182 896.776,919.462 899.126,939.507 901.477,1020.77 903.827,897.908 906.178,898.635 908.528,912.058 910.879,944.928 913.229,652.878 915.58,984.499 917.93,919.11 920.281,812.537 922.631,959.016 924.982,833.009 927.332,879.053 929.683,981.842 932.033,1000.06 934.384,997.872 936.734,993.904 939.084,842.779 941.435,921.25 943.785,907.173 946.136,932.808 948.486,1025.68 950.837,769.158 953.187,966.981 955.538,1034.29 957.888,999.758 960.239,944.851 962.589,1021.15 964.94,1000.12 967.29,932.083 969.641,997.605 971.991,907.18 974.342,910.601 976.692,808.309 979.043,899.239 981.393,1045.37 983.743,911.112 986.094,943.942 988.444,778.248 990.795,873.904 993.145,894.891 995.496,1002.81 997.846,990.833 1000.2,799.823 1002.55,970.707 1004.9,813.918 1007.25,808.886 1009.6,976.089 1011.95,903.233 1014.3,901.896 1016.65,1028.59 1019,1047.4 1021.35,895.782 1023.7,1022.84 1026.05,926.619 1028.4,980.47 1030.75,846.406 1033.1,906.233 1035.45,987.114 1037.8,916.594 1040.15,949.241 1042.51,1031.97 1044.86,929.522 1047.21,941.941 1049.56,914.264 1051.91,1051.7 1054.26,1117.45 1056.61,793.836 1058.96,766.247 1061.31,720.323 1063.66,896.03 1066.01,815.256 1068.36,1000.04 1070.71,994.645 1073.06,963.128 1075.41,1032.29 1077.76,933.85 1080.11,1029.07 1082.46,881.861 1084.81,936.633 1087.16,943.087 1089.51,1038 1091.87,1016.23 1094.22,1028.46 1096.57,780.557 1098.92,995.5 1101.27,1041.62 1103.62,1039.87 1105.97,1134.47 1108.32,957.427 1110.67,1140.76 1113.02,1078.38 1115.37,1048.18 1117.72,733.129 1120.07,956.058 1122.42,989.517 1124.77,981.267 1127.12,871.992 1129.47,1266.02 1131.82,908.966 1134.17,970.09 1136.52,1080.84 1138.87,772.076 1141.23,953.18 1143.58,1002.73 1145.93,785.417 1148.28,861.436 1150.63,891.405 1152.98,743.217 1155.33,1057.18 1157.68,807.972 1160.03,1006.06 1162.38,1002.8 1164.73,929.785 1167.08,992.396 1169.43,1044.22 1171.78,971.72 1174.13,860.677 1176.48,908.884 1178.83,964.702 1181.18,969.01 1183.53,760.843 1185.88,881.029 1188.23,861.553 1190.59,924.784 1192.94,916.296 1195.29,955.495 1197.64,973.462 1199.99,980.679 1202.34,868.574 1204.69,948.539 1207.04,818.432 1209.39,1063.66 1211.74,713.775 1214.09,902.691 1216.44,931.886 1218.79,1101.12 1221.14,1041.64 1223.49,891.979 1225.84,1020.61 1228.19,949.607 1230.54,1058.38 1232.89,1009.87 1235.24,1153.35 1237.59,1018.38 1239.94,774.401 1242.3,1010.11 1244.65,873.282 1247,1052.23 1249.35,963.502 1251.7,865.222 1254.05,1044.23 1256.4,894.727 1258.75,899.922 1261.1,1063.49 1263.45,827.855 1265.8,897.752 1268.15,1001.98 1270.5,828.584 1272.85,942.199 1275.2,950.714 1277.55,1010.49 1279.9,865.198 1282.25,939.539 1284.6,975.778 1286.95,1018.82 1289.3,828.618 1291.66,1005.59 1294.01,868.802 1296.36,813.605 1298.71,790.347 1301.06,927.446 1303.41,990.85 1305.76,1120.24 1308.11,890.127 1310.46,670.88 1312.81,878.408 1315.16,940.004 1317.51,858.943 1319.86,1078.86 1322.21,1020.31 1324.56,866.47 1326.91,877.858 1329.26,927.609 1331.61,846.188 1333.96,1136 1336.31,848.742 1338.66,800.508 1341.02,1063.77 1343.37,1054.7 1345.72,1017.25 1348.07,942.487 1350.42,1027.83 1352.77,1052.48 1355.12,976.22 1357.47,901.09 1359.82,1024.15 1362.17,881.585 1364.52,797.509 1366.87,982.38 1369.22,827.074 1371.57,865.91 1373.92,967.294 1376.27,958.953 1378.62,1038.69 1380.97,819.138 1383.32,902.143 1385.67,979.838 1388.02,986.336 1390.38,996.933 1392.73,985.565 1395.08,1065.97 1397.43,863.837 1399.78,975.347 1402.13,828.113 1404.48,840.974 1406.83,796.276 1409.18,1009.57 1411.53,893.23 1413.88,874.042 1416.23,1063.79 1418.58,825.608 1420.93,983.375 1423.28,976.722 1425.63,791.052 1427.98,955.383 1430.33,864.936 1432.68,869.824 1435.03,1056.37 1437.38,1058.98 1439.74,832.257 1442.09,1044.1 1444.44,1027.67 1446.79,911.166 1449.14,804.037 1451.49,965.429 1453.84,1012.44 1456.19,1097.78 1458.54,1036.37 1460.89,964.867 1463.24,885.08 1465.59,982.927 1467.94,757.782 1470.29,932.658 1472.64,1004.34 1474.99,977.121 1477.34,854.354 1479.69,841.087 1482.04,1003.04 1484.39,882.348 1486.74,941.908 1489.1,891.77 1491.45,860.401 1493.8,872.844 1496.15,946.308 1498.5,859.348 1500.85,1027.88 1503.2,1028.85 1505.55,937.283 1507.9,1004.16 1510.25,1014.39 1512.6,1133.76 1514.95,822.671 1517.3,1051.71 1519.65,810.566 1522,943.761 1524.35,927.607 1526.7,1007.78 1529.05,1046.45 1531.4,927.109 1533.75,904.727 1536.1,918.384 1538.45,1041.39 1540.81,935.118 1543.16,921.241 1545.51,949.733 1547.86,872.779 1550.21,845.552 1552.56,914.271 1554.91,853.247 1557.26,1130.09 1559.61,896.642 1561.96,890.241 1564.31,1073.36 1566.66,870.856 1569.01,1009.65 1571.36,916.373 1573.71,1078.47 1576.06,766.82 1578.41,958.449 1580.76,872.027 1583.11,887.424 1585.46,946.27 1587.81,901.328 1590.17,860.255 1592.52,913.954 1594.87,838.715 1597.22,958.527 1599.57,1139.61 1601.92,927.721 1604.27,959.892 1606.62,960.702 1608.97,989.333 1611.32,765.111 1613.67,954.078 1616.02,978.404 1618.37,986.354 1620.72,838.218 1623.07,781.626 1625.42,939.553 1627.77,983.133 1630.12,798.159 1632.47,1051.8 1634.82,958.289 1637.17,885.504 1639.53,955.513 1641.88,914.174 1644.23,871.672 1646.58,1021.74 1648.93,1003.85 1651.28,1134.9 1653.63,809.181 1655.98,1062.35 1658.33,1126.74 1660.68,941.458 1663.03,829.847 1665.38,847.877 1667.73,1002.14 1670.08,783.79 1672.43,893.343 1674.78,984.346 1677.13,997.428 1679.48,890.697 1681.83,763.276 1684.18,777.72 1686.53,1039.14 1688.89,888.635 1691.24,940.873 1693.59,943.934 1695.94,1037.08 1698.29,1020.24 1700.64,891.31 1702.99,823.505 1705.34,870.051 1707.69,891.553 1710.04,1073.26 1712.39,1108.8 1714.74,1050.25 1717.09,913.285 1719.44,998.891 1721.79,964.826 1724.14,943.763 1726.49,904.793 1728.84,918.096 1731.19,992.139 1733.54,737.818 1735.89,974.128 1738.25,949.956 1740.6,1138.9 1742.95,1005.65 1745.3,950.933 1747.65,801.249 1750,1082.98 1752.35,758.371 1754.7,951.19 1757.05,1013.97 1759.4,976.49 1761.75,869.194 1764.1,862.079 1766.45,997.517 1768.8,963.539 1771.15,884.322 1773.5,917.178 1775.85,771.134 1778.2,1046.83 1780.55,1059.45 1782.9,787.901 1785.25,890.537 1787.6,998.519 1789.96,980.254 1792.31,854.525 1794.66,1063.19 1797.01,996.525 1799.36,913.389 1801.71,1073.72 1804.06,935.875 1806.41,912.561 1808.76,966.182 1811.11,995.491 1813.46,947.102 1815.81,1070.97 1818.16,978.537 1820.51,955.753 1822.86,806.136 1825.21,1063.31 1827.56,969.566 1829.91,1021.11 1832.26,1081.81 1834.61,876.178 1836.96,783.042 1839.32,802.122 1841.67,1005.2 1844.02,974.835 1846.37,1048.63 1848.72,982.808 1851.07,893.972 1853.42,1001.79 1855.77,973.624 1858.12,801.668 1860.47,1013.47 1862.82,1006.22 1865.17,753.075 1867.52,940.722 1869.87,1179.64 1872.22,938.035 1874.57,800.876 1876.92,828.304 1879.27,1198.3 1881.62,674.255 1883.97,1121.21 1886.32,988.774 1888.68,973.361 1891.03,1029.12 1893.38,837.822 1895.73,863.968 1898.08,1087.09 1900.43,838.145 1902.78,1034.88 1905.13,822.678 1907.48,1011.2 1909.83,793.784 1912.18,932.25 1914.53,866.067 1916.88,1017.07 1919.23,896.552 1921.58,902.911 1923.93,866.178 1926.28,1019.15 1928.63,1013.45 1930.98,1046.87 1933.33,908.995 1935.68,939.89 1938.04,1048.36 1940.39,966.137 1942.74,793.008 1945.09,758.043 1947.44,895.292 1949.79,984.695 1952.14,1117.1 1954.49,850.187 1956.84,798.101 1959.19,820.673 1961.54,849.324 1963.89,858.068 1966.24,941.381 1968.59,1084.7 1970.94,935.667 1973.29,824.877 1975.64,836.817 1977.99,924.697 1980.34,1026.69 1982.69,1129.32 1985.04,1067.02 1987.4,849.293 1989.75,977.753 1992.1,1063.37 1994.45,883.277 1996.8,775.593 1999.15,850.251 2001.5,919.545 2003.85,1135.08 2006.2,794.31 2008.55,1068.19 2010.9,894.78 2013.25,1040.96 2015.6,1045.68 2017.95,945.688 2020.3,1058.59 2022.65,994.446 2025,1127.05 2027.35,1020.03 2029.7,1069.79 2032.05,1097.83 2034.4,812.164 2036.76,1046.18 2039.11,827.623 2041.46,796.5 2043.81,970.526 2046.16,957.045 2048.51,1014.59 2050.86,884.022 2053.21,887.969 2055.56,1067.01 2057.91,969.922 2060.26,873.034 2062.61,1081.88 2064.96,1003.28 2067.31,953.825 2069.66,891.226 2072.01,940.571 2074.36,735.885 2076.71,841.95 2079.06,984.264 2081.41,891.709 2083.76,821.998 2086.11,895.23 2088.47,864.77 2090.82,1045.71 2093.17,1007.55 2095.52,945.468 2097.87,935.592 2100.22,868.088 2102.57,943.93 2104.92,1090.64 2107.27,872.915 2109.62,869.89 2111.97,983.004 2114.32,841.756 2116.67,892.37 2119.02,1049.25 2121.37,836.221 2123.72,808.97 2126.07,931.389 2128.42,990.427 2130.77,913.419 2133.12,860.847 2135.47,902.656 2137.83,756.758 2140.18,889.054 2142.53,830.691 2144.88,1050.8 2147.23,1120.7 2149.58,890.189 2151.93,1035.66 2154.28,919.036 2156.63,905.578 2158.98,1020.94 2161.33,1028.29 2163.68,950.21 2166.03,850.657 2168.38,827.794 2170.73,942.976 2173.08,926.685 2175.43,849.502 2177.78,816.074 2180.13,935.827 2182.48,965.429 2184.83,904.077 2187.19,1051.05 2189.54,958.774 2191.89,791.401 2194.24,865.048 2196.59,857.195 2198.94,880.61 2201.29,818.926 2203.64,942.118 2205.99,1035.77 2208.34,1111.04 2210.69,747.109 2213.04,1061.91 2215.39,836.346 2217.74,855.743 2220.09,1002.21 2222.44,951.791 2224.79,991.566 2227.14,883.512 2229.49,1008.11 2231.84,818.237 2234.19,1015.71 2236.55,1021.53 2238.9,1023.17 2241.25,1075.13 2243.6,1008.18 2245.95,931.026 2248.3,899.172 2250.65,1066.94 2253,918.424 2255.35,886.755 2257.7,989.556 2260.05,928.65 2262.4,761.415 2264.75,1030.95 2267.1,928.185 2269.45,1010.14 2271.8,1041.74 2274.15,1003.6 2276.5,1158.95 2278.85,880.893 2281.2,1022.02 2283.55,891.258 2285.91,960.591 2288.26,1054.94 2290.61,1181.15 2292.96,904.163 2295.31,931.655 2297.66,938.834 2300.01,1066.83 2302.36,925.162 2304.71,1088.44 2307.06,889.917 2309.41,933.938 2311.76,908.637 2314.11,1030.78 2316.46,1065.4 2318.81,968.303 2321.16,1027.2 2323.51,840.759 2325.86,845.796 2328.21,866.777 2330.56,1145.3 2332.91,1082.45 2335.27,924.509 2337.62,1109.66 2339.97,885.517 2342.32,927.184 2344.67,837.147 2347.02,888.884 2349.37,920.153 2351.72,845.048 2354.07,923.008 2356.42,1027.42 2358.77,925.084 2361.12,964.088 2363.47,954.014 2365.82,1151.26 2368.17,990.307 2370.52,982.039 2372.87,1050.87 2375.22,1022.53 2377.57,781.507 2379.92,826.635 2382.27,1005.21 2384.62,808.411 2386.98,1013.64 2389.33,927.865 2391.68,896.274 2394.03,1004.58 2396.38,951.158 2398.73,921.737 2401.08,917.181 2403.43,936.837 2405.78,1081.02 2408.13,772.985 2410.48,1049.66 2412.83,981.25 2415.18,909.796 2417.53,821.482 2419.88,851.03 2422.23,785.258 2424.58,1032.9 2426.93,967.278 2429.28,864.379 2431.63,1008.79 2433.98,795.736 2436.34,981.914 2438.69,963.454 2441.04,883.716 2443.39,934.455 2445.74,817.567 2448.09,1010.13 2450.44,1008.26 2452.79,886.149 2455.14,893.502 2457.49,715.222 2459.84,883.618 2462.19,938.115 2464.54,781.452 2466.89,889.057 2469.24,936.199 2471.59,1006.83 2473.94,877.671 2476.29,1107.24 2478.64,960.861 2480.99,1007.56 2483.34,899.46 2485.7,992.301 2488.05,801.485 2490.4,955.269 2492.75,840.847 2495.1,807.316 2497.45,921.749 2499.8,1030.35 2502.15,974.412 2504.5,776.143 2506.85,931.608 2509.2,909.424 2511.55,1000.69 2513.9,1005.58 2516.25,994.129 2518.6,826.16 2520.95,1013.76 2523.3,785.453 2525.65,867.639 2528,992.279 2530.35,895.164 2532.7,849.632 2535.06,956.052 2537.41,982.221 2539.76,939.617 2542.11,741.97 2544.46,913.526 2546.81,972.836 2549.16,1147.52 2551.51,1029.15 2553.86,787.914 2556.21,988.552 2558.56,1172.57 2560.91,814.74 2563.26,900.868 2565.61,990.269 2567.96,871.19 2570.31,868.169 "></polyline>
<polyline clip-path="url(#clip192)" style="stroke:#3da44d; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,735.463 224.541,222.115 226.891,458.524 229.242,574.373 231.592,584.143 233.943,447.683 236.293,563.308 238.644,551.606 240.994,396.562 243.345,587.267 245.695,415.767 248.046,485.512 250.396,453.207 252.747,425.91 255.097,386.246 257.448,406.344 259.798,441.617 262.148,580.57 264.499,451.772 266.849,168.214 269.2,478.288 271.55,338.677 273.901,347.041 276.251,648.989 278.602,341.571 280.952,646.849 283.303,439.424 285.653,627.321 288.004,357.434 290.354,471.211 292.705,421.631 295.055,476.37 297.406,487.995 299.756,470.916 302.107,288.732 304.457,555.251 306.807,256.361 309.158,308.629 311.508,311.319 313.859,410.333 316.209,520.365 318.56,96.8724 320.91,337.363 323.261,413.97 325.611,454.573 327.962,486.254 330.312,275.419 332.663,406.845 335.013,359.789 337.364,538.457 339.714,283.26 342.065,418.479 344.415,433.896 346.765,370.402 349.116,628.769 351.466,439.307 353.817,414.589 356.167,511.045 358.518,373.046 360.868,344.981 363.219,407.521 365.569,416.411 367.92,520.769 370.27,528.217 372.621,566.422 374.971,618.241 377.322,524.711 379.672,532.097 382.023,583.5 384.373,336.81 386.724,589.364 389.074,526.389 391.424,581.213 393.775,373.137 396.125,498.897 398.476,435.917 400.826,425.81 403.177,422.682 405.527,510.438 407.878,481.122 410.228,488.363 412.579,369.061 414.929,413.422 417.28,385.152 419.63,326.857 421.981,537.389 424.331,450.064 426.682,450.497 429.032,551.073 431.382,517.94 433.733,348.759 436.083,268.01 438.434,385.139 440.784,554.486 443.135,766.139 445.485,300.025 447.836,262.167 450.186,424.085 452.537,155.459 454.887,390.096 457.238,487.723 459.588,445.442 461.939,393.516 464.289,435.853 466.64,378.541 468.99,544.178 471.341,470.972 473.691,616.817 476.041,222.505 478.392,259.156 480.742,540.528 483.093,453.829 485.443,358.162 487.794,483.289 490.144,534.681 492.495,471.065 494.845,374.233 497.196,570.508 499.546,479.858 501.897,387.113 504.247,232.824 506.598,508.996 508.948,343.556 511.299,281.503 513.649,538.482 515.999,383.03 518.35,457.812 520.7,286.103 523.051,424.82 525.401,377.885 527.752,545.678 530.102,355.847 532.453,504.028 534.803,417.232 537.154,430.384 539.504,385.163 541.855,415.472 544.205,347.966 546.556,310.384 548.906,464.576 551.257,560.754 553.607,434.209 555.958,428.179 558.308,298.713 560.658,438.085 563.009,496.501 565.359,319.963 567.71,503.299 570.06,394.888 572.411,436.578 574.761,270.422 577.112,241.683 579.462,563.507 581.813,418.78 584.163,522.532 586.514,512.711 588.864,328.69 591.215,99.5205 593.565,593.257 595.916,550.58 598.266,501.345 600.616,432.455 602.967,397.122 605.317,422.622 607.668,347.068 610.018,317.24 612.369,480.737 614.719,467.583 617.07,360.482 619.42,458.606 621.771,481.899 624.121,537.091 626.472,492.03 628.822,340.522 631.173,505.299 633.523,324.056 635.874,461.672 638.224,465.154 640.575,348.269 642.925,371.319 645.275,460.885 647.626,588.543 649.976,392.316 652.327,409.043 654.677,599.527 657.028,524.536 659.378,535.742 661.729,544.054 664.079,354.454 666.43,348.66 668.78,288.219 671.131,368.613 673.481,453.317 675.832,356.566 678.182,443.063 680.533,497.353 682.883,430.792 685.233,306.588 687.584,307.282 689.934,550.833 692.285,468.935 694.635,564.536 696.986,475.841 699.336,489.124 701.687,460.537 704.037,308.033 706.388,319.212 708.738,422.34 711.089,529.548 713.439,606.794 715.79,591.369 718.14,549.661 720.491,459.943 722.841,460.675 725.192,353.287 727.542,348.736 729.892,442.707 732.243,412.59 734.593,280.709 736.944,378.94 739.294,330.857 741.645,448.083 743.995,410.723 746.346,406.613 748.696,403.766 751.047,412.261 753.397,577.792 755.748,336.254 758.098,548.588 760.449,354.853 762.799,453.561 765.15,304.963 767.5,552.66 769.85,459.662 772.201,381.003 774.551,412.428 776.902,527.333 779.252,398.861 781.603,357.593 783.953,262.852 786.304,425.985 788.654,554.037 791.005,333.535 793.355,300.422 795.706,580.223 798.056,313.284 800.407,431.091 802.757,573.683 805.108,552.742 807.458,504.006 809.809,346.934 812.159,515.682 814.509,296.35 816.86,390.725 819.21,636.089 821.561,506.584 823.911,284.294 826.262,423.614 828.612,676.058 830.963,451.918 833.313,500.9 835.664,410.416 838.014,449.453 840.365,366.976 842.715,294.528 845.066,376.101 847.416,463.665 849.767,452.904 852.117,504.961 854.467,443.515 856.818,103.902 859.168,406.798 861.519,546.13 863.869,565.633 866.22,342.392 868.57,432.475 870.921,268.243 873.271,479.508 875.622,292.306 877.972,531.906 880.323,375.301 882.673,273.381 885.024,483.234 887.374,497.768 889.725,434.3 892.075,393.862 894.426,306.496 896.776,406.916 899.126,297.182 901.477,480.442 903.827,265.978 906.178,251.81 908.528,550.523 910.879,387.786 913.229,351.289 915.58,405.674 917.93,395.689 920.281,287.676 922.631,403.268 924.982,509.843 927.332,610.941 929.683,498.422 932.033,454.24 934.384,437.909 936.734,371.619 939.084,396.241 941.435,386.173 943.785,450.326 946.136,692.637 948.486,424.413 950.837,481.513 953.187,371.516 955.538,443.493 957.888,443.034 960.239,512.783 962.589,533.022 964.94,345.083 967.29,552.66 969.641,409.368 971.991,346.906 974.342,437.407 976.692,320.825 979.043,338.794 981.393,396.867 983.743,307.663 986.094,440.367 988.444,459.658 990.795,321.62 993.145,500.594 995.496,497.588 997.846,458.739 1000.2,425.019 1002.55,553.187 1004.9,626.445 1007.25,328.062 1009.6,373.603 1011.95,353.771 1014.3,381.652 1016.65,379.995 1019,409.883 1021.35,273.764 1023.7,357.421 1026.05,480.81 1028.4,491.345 1030.75,333.396 1033.1,374.152 1035.45,376.504 1037.8,442.952 1040.15,384.333 1042.51,384.404 1044.86,598.334 1047.21,591.579 1049.56,504.029 1051.91,354.193 1054.26,342.378 1056.61,393.686 1058.96,496.478 1061.31,567.322 1063.66,439.956 1066.01,330.229 1068.36,609.315 1070.71,441.52 1073.06,367.257 1075.41,491.008 1077.76,482.778 1080.11,274.759 1082.46,316.499 1084.81,363.136 1087.16,476.132 1089.51,471.349 1091.87,456.317 1094.22,332.612 1096.57,386.966 1098.92,482.571 1101.27,310.419 1103.62,380.765 1105.97,500.45 1108.32,399.369 1110.67,472.512 1113.02,392.157 1115.37,396.23 1117.72,336.739 1120.07,351.4 1122.42,492.398 1124.77,354.602 1127.12,476.071 1129.47,461.74 1131.82,476.988 1134.17,397.445 1136.52,644.267 1138.87,223.805 1141.23,351.077 1143.58,546.089 1145.93,455.353 1148.28,325.845 1150.63,466.225 1152.98,565.881 1155.33,516.152 1157.68,325.286 1160.03,315.739 1162.38,496.866 1164.73,608.411 1167.08,239.862 1169.43,342.693 1171.78,384.006 1174.13,367.354 1176.48,431.589 1178.83,533.636 1181.18,402.321 1183.53,351.8 1185.88,307.466 1188.23,562.064 1190.59,494.014 1192.94,441.441 1195.29,467.417 1197.64,368.737 1199.99,306.472 1202.34,521.836 1204.69,320.251 1207.04,389.85 1209.39,450.485 1211.74,327.245 1214.09,366.856 1216.44,647.069 1218.79,550.626 1221.14,493.598 1223.49,517.816 1225.84,332.429 1228.19,524.342 1230.54,391.297 1232.89,397.904 1235.24,547.854 1237.59,436.172 1239.94,291.107 1242.3,583.165 1244.65,283.155 1247,592.905 1249.35,357.968 1251.7,366.525 1254.05,401.293 1256.4,329.18 1258.75,618.84 1261.1,492.595 1263.45,280.746 1265.8,610.631 1268.15,518.61 1270.5,392.723 1272.85,482.055 1275.2,496.026 1277.55,427.515 1279.9,384.573 1282.25,479.221 1284.6,422.948 1286.95,287.265 1289.3,542.5 1291.66,410.144 1294.01,375.698 1296.36,496.918 1298.71,491.894 1301.06,329.897 1303.41,458.657 1305.76,366.89 1308.11,554.321 1310.46,567.024 1312.81,387.456 1315.16,449.688 1317.51,431.25 1319.86,443.487 1322.21,683.286 1324.56,398.54 1326.91,332.026 1329.26,483.489 1331.61,402.624 1333.96,328.571 1336.31,513.92 1338.66,434.699 1341.02,505.247 1343.37,649.297 1345.72,410.607 1348.07,423.098 1350.42,465.283 1352.77,499.24 1355.12,415.109 1357.47,462.723 1359.82,421.362 1362.17,509.914 1364.52,560.279 1366.87,535.681 1369.22,449.146 1371.57,387.175 1373.92,402.124 1376.27,364.179 1378.62,551.03 1380.97,408.15 1383.32,250.245 1385.67,380.862 1388.02,482.338 1390.38,541.321 1392.73,348.304 1395.08,630.668 1397.43,505.179 1399.78,418.177 1402.13,350.362 1404.48,315.097 1406.83,447.519 1409.18,657.002 1411.53,474.086 1413.88,319.787 1416.23,478.152 1418.58,422.82 1420.93,504.379 1423.28,533.716 1425.63,399.281 1427.98,481.813 1430.33,305.353 1432.68,459.54 1435.03,453.236 1437.38,564.384 1439.74,454.83 1442.09,431.059 1444.44,462.812 1446.79,340.75 1449.14,485.332 1451.49,577.757 1453.84,568.967 1456.19,488.601 1458.54,367.895 1460.89,336.162 1463.24,426.691 1465.59,379.085 1467.94,430.833 1470.29,443.524 1472.64,464.896 1474.99,498.817 1477.34,477.361 1479.69,463.209 1482.04,382.355 1484.39,420.51 1486.74,265.798 1489.1,366.927 1491.45,353.83 1493.8,485.895 1496.15,130.289 1498.5,557.064 1500.85,501.037 1503.2,393.453 1505.55,499.161 1507.9,381.722 1510.25,516.508 1512.6,521.325 1514.95,434.99 1517.3,526.474 1519.65,510.733 1522,418.296 1524.35,583.797 1526.7,250.609 1529.05,312.138 1531.4,523.654 1533.75,444.334 1536.1,436.832 1538.45,450.755 1540.81,354.113 1543.16,411.911 1545.51,459.139 1547.86,361.986 1550.21,193.66 1552.56,361.366 1554.91,509.87 1557.26,448.601 1559.61,496.978 1561.96,437.218 1564.31,441.559 1566.66,365.747 1569.01,537.147 1571.36,375.925 1573.71,563.636 1576.06,443.838 1578.41,375.432 1580.76,374.4 1583.11,444.662 1585.46,394.431 1587.81,505.623 1590.17,460.588 1592.52,427.665 1594.87,403.666 1597.22,496.637 1599.57,380.64 1601.92,334.348 1604.27,564.208 1606.62,506.524 1608.97,518.828 1611.32,501.043 1613.67,509.446 1616.02,321.505 1618.37,358.915 1620.72,484.306 1623.07,488.306 1625.42,472.486 1627.77,491.208 1630.12,337.887 1632.47,463.01 1634.82,467.416 1637.17,462.159 1639.53,571.86 1641.88,663.773 1644.23,455.755 1646.58,464.229 1648.93,625.536 1651.28,398.012 1653.63,406.172 1655.98,474.908 1658.33,491.313 1660.68,548.664 1663.03,534.131 1665.38,628.722 1667.73,492.043 1670.08,395.711 1672.43,363.493 1674.78,423.062 1677.13,384.73 1679.48,333.962 1681.83,450.715 1684.18,566.605 1686.53,289.006 1688.89,452.95 1691.24,278.888 1693.59,544.59 1695.94,401.702 1698.29,511.234 1700.64,432.106 1702.99,300.535 1705.34,429.241 1707.69,372.326 1710.04,393.271 1712.39,548.703 1714.74,489.746 1717.09,525.268 1719.44,608.042 1721.79,303.666 1724.14,406.916 1726.49,535.165 1728.84,490.493 1731.19,300.269 1733.54,347.092 1735.89,452.889 1738.25,425.398 1740.6,307.07 1742.95,362.926 1745.3,249.017 1747.65,478.67 1750,422.302 1752.35,313.262 1754.7,541.683 1757.05,284.815 1759.4,447.172 1761.75,389.673 1764.1,560.394 1766.45,384.276 1768.8,442.982 1771.15,226.145 1773.5,413.495 1775.85,186.509 1778.2,400.647 1780.55,450.736 1782.9,484.85 1785.25,618.56 1787.6,420.896 1789.96,594.935 1792.31,416.347 1794.66,591.542 1797.01,509.498 1799.36,643.16 1801.71,342.737 1804.06,511.981 1806.41,571.842 1808.76,438.702 1811.11,251.465 1813.46,601.155 1815.81,352.074 1818.16,463.123 1820.51,380.82 1822.86,478.974 1825.21,270.95 1827.56,164.063 1829.91,277.122 1832.26,463.491 1834.61,649.843 1836.96,357.814 1839.32,418.399 1841.67,296.135 1844.02,489.8 1846.37,357.398 1848.72,304.901 1851.07,511.07 1853.42,485.875 1855.77,563.048 1858.12,454.636 1860.47,484.01 1862.82,278.952 1865.17,394.266 1867.52,395.178 1869.87,232.566 1872.22,556.868 1874.57,419.732 1876.92,514.599 1879.27,444.916 1881.62,441.428 1883.97,443.692 1886.32,370.154 1888.68,506.547 1891.03,387.415 1893.38,494.708 1895.73,539.21 1898.08,393.832 1900.43,317.435 1902.78,247.667 1905.13,531.001 1907.48,514.456 1909.83,466.313 1912.18,401.958 1914.53,314.575 1916.88,339.805 1919.23,309.334 1921.58,463.117 1923.93,468.164 1926.28,360.319 1928.63,480.23 1930.98,412.513 1933.33,330.767 1935.68,596.87 1938.04,309.001 1940.39,493.335 1942.74,337.276 1945.09,537.668 1947.44,516.589 1949.79,503.556 1952.14,393.321 1954.49,364.466 1956.84,281.784 1959.19,368.456 1961.54,416.908 1963.89,557.818 1966.24,586.775 1968.59,503.127 1970.94,485.266 1973.29,524.009 1975.64,429.322 1977.99,508.63 1980.34,494.672 1982.69,427.889 1985.04,402.311 1987.4,301.798 1989.75,472.484 1992.1,455.149 1994.45,516.928 1996.8,378.75 1999.15,479.931 2001.5,443.468 2003.85,591.22 2006.2,551.604 2008.55,296.4 2010.9,589.175 2013.25,361.147 2015.6,438.57 2017.95,506.896 2020.3,458.837 2022.65,434.434 2025,524.253 2027.35,279.534 2029.7,464.999 2032.05,408.258 2034.4,457.682 2036.76,487.75 2039.11,434.762 2041.46,313.345 2043.81,544.785 2046.16,392.028 2048.51,360.128 2050.86,507.977 2053.21,384.799 2055.56,459.591 2057.91,334.513 2060.26,425.939 2062.61,506.838 2064.96,463.844 2067.31,328.615 2069.66,350.678 2072.01,285.751 2074.36,447.911 2076.71,490.972 2079.06,423.694 2081.41,462.668 2083.76,460.836 2086.11,382.592 2088.47,309.143 2090.82,438.338 2093.17,381.945 2095.52,272.713 2097.87,455.811 2100.22,678.168 2102.57,457.929 2104.92,461.786 2107.27,481.339 2109.62,335.619 2111.97,461.475 2114.32,366.561 2116.67,465.409 2119.02,560.009 2121.37,372.545 2123.72,210.799 2126.07,308.372 2128.42,408.787 2130.77,435.03 2133.12,366.732 2135.47,427.048 2137.83,383.701 2140.18,535.649 2142.53,257.348 2144.88,328.75 2147.23,586.63 2149.58,409.463 2151.93,507.618 2154.28,511.424 2156.63,588.396 2158.98,339.194 2161.33,326.273 2163.68,403.257 2166.03,329.229 2168.38,442.284 2170.73,496.429 2173.08,387.456 2175.43,412.057 2177.78,541.679 2180.13,130.191 2182.48,177.304 2184.83,408.922 2187.19,512.303 2189.54,533.564 2191.89,301.853 2194.24,403.381 2196.59,332.238 2198.94,392.304 2201.29,499.959 2203.64,361.649 2205.99,460.766 2208.34,379.433 2210.69,344.887 2213.04,462.597 2215.39,476.861 2217.74,495.959 2220.09,411.965 2222.44,345.795 2224.79,526.111 2227.14,416.009 2229.49,344.598 2231.84,411.028 2234.19,482.107 2236.55,492.67 2238.9,458.529 2241.25,437.083 2243.6,487.573 2245.95,368.183 2248.3,324.085 2250.65,428.702 2253,438.145 2255.35,475.676 2257.7,274.571 2260.05,507.149 2262.4,310.294 2264.75,483.964 2267.1,395.144 2269.45,393.749 2271.8,419.171 2274.15,326.69 2276.5,296.233 2278.85,412.253 2281.2,325.275 2283.55,432.515 2285.91,459.091 2288.26,563.658 2290.61,466.527 2292.96,295.477 2295.31,405.54 2297.66,376.961 2300.01,359.937 2302.36,467.832 2304.71,356.45 2307.06,293.83 2309.41,390.461 2311.76,462.222 2314.11,489.824 2316.46,570.832 2318.81,432.492 2321.16,351.913 2323.51,318.029 2325.86,457.727 2328.21,403.691 2330.56,277.082 2332.91,317.01 2335.27,511.315 2337.62,344.84 2339.97,442.131 2342.32,430.934 2344.67,453.924 2347.02,439.679 2349.37,196.175 2351.72,404.725 2354.07,426.967 2356.42,426.787 2358.77,444.279 2361.12,545.841 2363.47,518.316 2365.82,363.198 2368.17,477.952 2370.52,472.143 2372.87,307.944 2375.22,342.095 2377.57,486.862 2379.92,344.534 2382.27,198.392 2384.62,380.825 2386.98,476.138 2389.33,499.68 2391.68,457.509 2394.03,392.914 2396.38,753.264 2398.73,431.502 2401.08,445.31 2403.43,466.621 2405.78,534.592 2408.13,428.74 2410.48,413.304 2412.83,475.402 2415.18,564.629 2417.53,464.046 2419.88,498.013 2422.23,430.922 2424.58,647.401 2426.93,165.515 2429.28,451.729 2431.63,398.407 2433.98,401.913 2436.34,413.187 2438.69,530.327 2441.04,381.235 2443.39,451.418 2445.74,480.544 2448.09,407.185 2450.44,579.35 2452.79,306.137 2455.14,580.16 2457.49,622.47 2459.84,398.132 2462.19,317.684 2464.54,567.114 2466.89,371.613 2469.24,333.864 2471.59,474.104 2473.94,460.241 2476.29,210.652 2478.64,405.209 2480.99,432.43 2483.34,435.834 2485.7,514.266 2488.05,442.481 2490.4,328.749 2492.75,559.26 2495.1,479.325 2497.45,549.564 2499.8,374.558 2502.15,602.336 2504.5,366.466 2506.85,410.613 2509.2,350.57 2511.55,476.605 2513.9,356.882 2516.25,513.109 2518.6,364.072 2520.95,536.558 2523.3,563.088 2525.65,751.883 2528,420.966 2530.35,448.346 2532.7,284.191 2535.06,562.347 2537.41,476.141 2539.76,471.914 2542.11,575.939 2544.46,489.71 2546.81,372.869 2549.16,405.274 2551.51,322.262 2553.86,532.392 2556.21,516.057 2558.56,372.908 2560.91,496.546 2563.26,514.333 2565.61,451.313 2567.96,534.944 2570.31,473.22 "></polyline>
</svg>
</div>
</div>
<p>Look at that! Things are working; amazin’.</p>
<p>We can also exploit <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>’s parallel sampling capabilities:</p>
<div id="34" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run separate 4 chains for 10 000 iterations using threads to parallelize.</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>num_chains <span class="op">=</span> <span class="fl">4</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    model_with_grad,</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">MCMCThreads</span>(),</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>,</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    num_chains;</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Note we need to provide an initial state for every chain.</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>    initial_state<span class="op">=</span><span class="fu">fill</span>(state, num_chains),</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>samples_array <span class="op">=</span> <span class="fu">stack</span>(<span class="fu">map</span>(<span class="bu">Base</span>.<span class="fu">Fix1</span>(stack, sample <span class="op">-&gt;</span> sample.x), samples))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000×4 Array{Float64, 3}:
[:, :, 1] =
 -0.964739  -2.16611   -2.63372   …  -2.83092  -4.8201    -5.30659
  1.15875    0.759344  -0.595932      1.45762  -0.948911   0.013811
 -0.345947   3.54702    3.76116       3.66666   3.25914    2.67113

[:, :, 2] =
 -3.64992  -2.88259   -4.249     …  -5.86678  -4.77287   -3.81763
  1.84474   0.300388  -0.735738     -1.12048  -0.781535   0.0263329
  2.65692   3.68596    5.54667       3.91538   7.59803    5.98428

[:, :, 3] =
 -2.14405  -5.31675   -4.07001  -5.24901  …  -5.45651   -4.9909    -4.9909
  1.24364  -0.860981  -1.29189  -0.43259     -0.345954   0.614515   0.614515
  2.2003    1.68084    3.23471   2.26994      4.74299    4.52605    4.52605

[:, :, 4] =
 -3.07116     -2.42813   -4.86793   …  -4.50906  -4.27718  -5.63712
 -0.00798631   0.764502  -0.441548      1.36165  -0.15941  -0.542395
  1.80613      5.00488    5.12714       4.76734   4.99521   4.65933</code></pre>
</div>
</div>
<p>But the fact that we have to provide the <code>AbstractMCMC.sample</code> call, etc. with an <code>initial_state</code> to get started is a bit annoying. We can avoid this by also defining a <code>AbstractMCMC.step</code> <em>without</em> the <code>state</code> argument:</p>
<div id="36" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">::</span><span class="dt">MALA</span>;</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># </span><span class="al">NOTE</span><span class="co">: No state provided!</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just create the initial state by sampling using  a Gaussian.</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="fu">randn</span>(rng, LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(x), <span class="fu">MALAState</span>(x)</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Equipped with this, we no longer need to provide the <code>initial_state</code> everywhere:</p>
<div id="38" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -4.99297    0.999849
 -0.0397035  0.991303
  4.99265    1.01306</code></pre>
</div>
</div>
</section>
<section id="using-our-sampler-with-turing.jl" class="level2">
<h2 class="anchored" data-anchor-id="using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</h2>
<p>As we promised, all of this hassle of implementing our <code>MALA</code> sampler in a way that uses <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> and <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> gets us something more than <em>just</em> an “automatic” implementation of <code>AbstractMCMC.sample</code>.</p>
<p>It also enables use with Turing.jl through the <code>externalsampler</code>, but we need to do one final thing first: we need to tell Turing.jl how to extract a vector of parameters from the “sample” returned in our implementation of <code>AbstractMCMC.step</code>. In our case, the “sample” is a <code>MALASample</code>, so we just need the following line:</p>
<div id="40" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load Turing.jl.</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Turing</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Overload the `getparams` method for our "sample" type, which is just a vector.</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>Turing.Inference.<span class="fu">getparams</span>(<span class="op">::</span><span class="dt">Turing.Model</span>, sample<span class="op">::</span><span class="dt">MALASample</span>) <span class="op">=</span> sample.x</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And with that, we’re good to go!</p>
<div id="42" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Our previous model defined as a Turing.jl model.</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">mvnormal_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">MvNormal</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.], I)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate our model.</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">mvnormal_model</span>()</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Call `sample` but now we're passing in a Turing.jl `model` and wrapping</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co"># our `MALA` sampler in the `externalsampler` to tell Turing.jl that the sampler</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co"># expects something that implements LogDensityProblems.jl.</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×4×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 2.78 seconds
Compute duration  = 2.78 seconds
parameters        = x[1], x[2], x[3]
internals         = lp

Summary Statistics
  parameters      mean       std      mcse    ess_bulk    ess_tail      rhat   ⋯
      Symbol   Float64   Float64   Float64     Float64     Float64   Float64   ⋯

        x[1]   -5.0001    0.9926    0.0183   2936.1118   4639.2476    1.0001   ⋯
        x[2]   -0.0106    0.9883    0.0185   2837.5458   5098.9107    1.0003   ⋯
        x[3]    5.0355    1.0003    0.0179   3120.9901   4992.6690    1.0002   ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

        x[1]   -6.9115   -5.6794   -4.9910   -4.3401   -3.0316
        x[2]   -1.9893   -0.6807    0.0054    0.6650    1.9009
        x[3]    3.0683    4.3463    5.0338    5.7034    6.9877</code></pre>
</div>
</div>
<p>Pretty neat, eh?</p>
<section id="models-with-constrained-parameters" class="level3">
<h3 class="anchored" data-anchor-id="models-with-constrained-parameters">Models with constrained parameters</h3>
<p>One thing we’ve sort of glossed over in all of the above is that MALA, at least how we’ve implemented it, requires <span class="math inline">\(x\)</span> to live in <span class="math inline">\(\mathbb{R}^d\)</span> for some <span class="math inline">\(d &gt; 0\)</span>. If some of the parameters were in fact constrained, e.g.&nbsp;we were working with a <code>Beta</code> distribution which has support on the interval <span class="math inline">\((0, 1)\)</span>, <em>not</em> on <span class="math inline">\(\mathbb{R}^d\)</span>, we could easily end up outside of the valid range <span class="math inline">\((0, 1)\)</span>.</p>
<div id="44" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">beta_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">beta_model</span>()</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 1.87 seconds
Compute duration  = 1.87 seconds
parameters        = x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse    ess_bulk    ess_tail      rhat   ⋯
      Symbol   Float64   Float64   Float64     Float64     Float64   Float64   ⋯

           x    0.5001    0.1916    0.0031   3738.4963   5490.3114    1.0006   ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

           x    0.1458    0.3559    0.4999    0.6446    0.8528</code></pre>
</div>
</div>
<p>Yep, that still works, but only because Turing.jl actually <em>transforms</em> the <code>turing_model</code> from constrained to unconstrained, so that the <code>sampler</code> provided to <code>externalsampler</code> is actually always working in unconstrained space! This is not always desirable, so we can turn this off:</p>
<div id="46" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 0.14 seconds
Compute duration  = 0.14 seconds
parameters        = x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse   ess_bulk   ess_tail      rhat   e ⋯
      Symbol   Float64   Float64   Float64    Float64    Float64   Float64     ⋯

           x    0.4820    0.1444    0.0107   143.8395    50.5426    1.0061     ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

           x    0.2207    0.3575    0.4795    0.6072    0.7251</code></pre>
</div>
</div>
<p>The fun thing is that this still sort of works because</p>
<div id="48" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">logpdf</span>(<span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>), <span class="fl">10.0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-Inf</code></pre>
</div>
</div>
<p>and so the samples that fall outside of the range are always rejected. But do notice how much worse all the diagnostics are, e.g.&nbsp;<code>ess_tail</code> is very poor compared to when we use <code>unconstrained=true</code>. Moreover, in more complex cases this won’t just result in a “nice” <code>-Inf</code> log-density value, but instead will error:</p>
<div id="50" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="kw">function</span> <span class="fu">demo</span>()</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>    σ² <span class="op">~</span> <span class="fu">truncated</span>(<span class="fu">Normal</span>(), lower<span class="op">=</span><span class="fl">0</span>)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If we end up with negative values for `σ²`, the `Normal` will error.</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>    x <span class="op">~</span> <span class="fu">Normal</span>(<span class="fl">0</span>, σ²)</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>DomainError: DomainError(Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}}(-0.2685925839628882,1.0,0.0), "Normal: the condition σ &gt;= zero(σ) is not satisfied.")
DomainError with Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}}(-0.2685925839628882,1.0,0.0):
Normal: the condition σ &gt;= zero(σ) is not satisfied.
Stacktrace:
  [1] #371
    @ ~/.julia/packages/Distributions/tQhJE/src/univariate/continuous/normal.jl:37 [inlined]
  [2] check_args
    @ ~/.julia/packages/Distributions/tQhJE/src/utils.jl:89 [inlined]
  [3] #Normal#370
    @ ~/.julia/packages/Distributions/tQhJE/src/univariate/continuous/normal.jl:37 [inlined]
  [4] Normal
    @ ~/.julia/packages/Distributions/tQhJE/src/univariate/continuous/normal.jl:36 [inlined]
  [5] Normal
    @ ~/.julia/packages/Distributions/tQhJE/src/univariate/continuous/normal.jl:42 [inlined]
  [6] macro expansion
    @ ~/.julia/packages/DynamicPPL/senfM/src/compiler.jl:584 [inlined]
  [7] demo(__model__::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, __varinfo__::DynamicPPL.ThreadSafeVarInfo{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}, Vector{Set{DynamicPPL.Selector}}}}, ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}, Vector{Base.RefValue{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}, __context__::DynamicPPL.DefaultContext)
    @ Main.Notebook ~/work/docs/docs/developers/inference/implementing-samplers/index.qmd:595
  [8] _evaluate!!
    @ ~/.julia/packages/DynamicPPL/senfM/src/model.jl:936 [inlined]
  [9] evaluate_threadsafe!!(model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, varinfo::DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}, Vector{Set{DynamicPPL.Selector}}}}, ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}, context::DynamicPPL.DefaultContext)
    @ DynamicPPL ~/.julia/packages/DynamicPPL/senfM/src/model.jl:925
 [10] evaluate!!
    @ ~/.julia/packages/DynamicPPL/senfM/src/model.jl:855 [inlined]
 [11] logdensity
    @ ~/.julia/packages/DynamicPPL/senfM/src/logdensityfunction.jl:140 [inlined]
 [12] Fix1
    @ ./operators.jl:1127 [inlined]
 [13] vector_mode_dual_eval!(f::Base.Fix1{typeof(LogDensityProblems.logdensity), LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, Nothing}}, cfg::ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}, x::Vector{Float64})
    @ ForwardDiff ~/.julia/packages/ForwardDiff/UBbGT/src/apiutils.jl:24
 [14] vector_mode_gradient!
    @ ~/.julia/packages/ForwardDiff/UBbGT/src/gradient.jl:98 [inlined]
 [15] gradient!(result::DiffResults.MutableDiffResult{1, Float64, Tuple{Vector{Float64}}}, f::Base.Fix1{typeof(LogDensityProblems.logdensity), LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, Nothing}}, x::Vector{Float64}, cfg::ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}, ::Val{true})
    @ ForwardDiff ~/.julia/packages/ForwardDiff/UBbGT/src/gradient.jl:39
 [16] gradient!
    @ ~/.julia/packages/ForwardDiff/UBbGT/src/gradient.jl:36 [inlined]
 [17] logdensity_and_gradient
    @ ~/.julia/packages/LogDensityProblemsAD/9uEsH/ext/LogDensityProblemsADForwardDiffExt.jl:116 [inlined]
 [18] leapfrog_step(model::LogDensityProblemsADForwardDiffExt.ForwardDiffLogDensity{LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, Nothing}, ForwardDiff.Chunk{2}, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}, x::Vector{Float64}, p::Vector{Float64}, ϵ::Int64, M::UniformScaling{Bool})
    @ Main.Notebook ~/work/docs/docs/developers/inference/implementing-samplers/index.qmd:371
 [19] step(rng::TaskLocalRNG, model_wrapper::AbstractMCMC.LogDensityModel{LogDensityProblemsADForwardDiffExt.ForwardDiffLogDensity{LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, Nothing}, ForwardDiff.Chunk{2}, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}}, sampler::MALA{Int64, UniformScaling{Bool}}, state::MALAState{Vector{Float64}}; kwargs::@Kwargs{})
    @ Main.Notebook ~/work/docs/docs/developers/inference/implementing-samplers/index.qmd:336
 [20] step
    @ ~/work/docs/docs/developers/inference/implementing-samplers/index.qmd:318 [inlined]
 [21] #step#27
    @ ~/.julia/packages/Turing/oFGEb/src/mcmc/abstractmcmc.jl:117 [inlined]
 [22] step(rng::TaskLocalRNG, model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, sampler_wrapper::DynamicPPL.Sampler{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}, state::Turing.Inference.TuringState{MALAState{Vector{Float64}}, LogDensityProblemsADForwardDiffExt.ForwardDiffLogDensity{LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, Nothing}, ForwardDiff.Chunk{2}, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}})
    @ Turing.Inference ~/.julia/packages/Turing/oFGEb/src/mcmc/abstractmcmc.jl:106
 [23] macro expansion
    @ ~/.julia/packages/AbstractMCMC/FSyVk/src/sample.jl:217 [inlined]
 [24] macro expansion
    @ ~/.julia/packages/AbstractMCMC/FSyVk/src/logging.jl:16 [inlined]
 [25] mcmcsample(rng::TaskLocalRNG, model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, sampler::DynamicPPL.Sampler{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}, N::Int64; progress::Bool, progressname::String, callback::Nothing, num_warmup::Int64, discard_initial::Int64, thinning::Int64, chain_type::Type, initial_state::Nothing, kwargs::@Kwargs{})
    @ AbstractMCMC ~/.julia/packages/AbstractMCMC/FSyVk/src/sample.jl:142
 [26] sample(rng::TaskLocalRNG, model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, sampler::DynamicPPL.Sampler{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}, N::Int64; chain_type::Type, resume_from::Nothing, initial_state::Nothing, kwargs::@Kwargs{progress::Bool})
    @ DynamicPPL ~/.julia/packages/DynamicPPL/senfM/src/sampler.jl:107
 [27] sample
    @ ~/.julia/packages/DynamicPPL/senfM/src/sampler.jl:97 [inlined]
 [28] #sample#6
    @ ~/.julia/packages/Turing/oFGEb/src/mcmc/Inference.jl:321 [inlined]
 [29] sample
    @ ~/.julia/packages/Turing/oFGEb/src/mcmc/Inference.jl:312 [inlined]
 [30] #sample#5
    @ ~/.julia/packages/Turing/oFGEb/src/mcmc/Inference.jl:309 [inlined]
 [31] top-level scope
    @ ~/work/docs/docs/developers/inference/implementing-samplers/index.qmd:597</code></pre>
</div>
</div>
<p>As expected, we run into a <code>DomainError</code> at some point, while if we set <code>unconstrained=true</code>, letting Turing.jl transform the model to a unconstrained form behind the scenes, everything works as expected:</p>
<div id="52" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 0.58 seconds
Compute duration  = 0.58 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse   ess_bulk   ess_tail      rhat   e ⋯
      Symbol   Float64   Float64   Float64    Float64    Float64   Float64     ⋯

          σ²    0.8503    0.5667    0.0261   371.9997   262.7222    1.0014     ⋯
           x    0.0623    1.0304    0.0540   512.8773   285.0333    1.0002     ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

          σ²    0.1503    0.3910    0.7237    1.1745    2.2937
           x   -2.0788   -0.3863   -0.0112    0.4847    2.5638</code></pre>
</div>
</div>
<p>Neat!</p>
<p>Similarly, which automatic differentiation backend one should use can be specified through the <code>adtype</code> keyword argument too. For example, if we want to use <a href="https://github.com/JuliaDiff/ReverseDiff.jl">ReverseDiff.jl</a> instead of the default <a href="https://github.com/JuliaDiff/ForwardDiff.jl">ForwardDiff.jl</a>:</p>
<div id="54" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">ReverseDiff</span>: ReverseDiff</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify that we want to use `AutoReverseDiff`.</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">demo</span>(),</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>, adtype<span class="op">=</span><span class="fu">AutoReverseDiff</span>()),</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>;</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 3.62 seconds
Compute duration  = 3.62 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse   ess_bulk   ess_tail      rhat   e ⋯
      Symbol   Float64   Float64   Float64    Float64    Float64   Float64     ⋯

          σ²    0.7851    0.6123    0.0589    58.6602    23.2037    1.0666     ⋯
           x   -0.0251    0.9068    0.0401   643.7073   489.9828    1.0641     ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

          σ²    0.0935    0.2836    0.6457    1.1420    2.2832
           x   -2.1544   -0.3269    0.0392    0.2846    2.0593</code></pre>
</div>
</div>
<p>Double-neat.</p>
</section>
</section>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<p>At this point it’s worth maybe reminding ourselves what we did and also <em>why</em> we did it:</p>
<ol type="1">
<li>We define our models in the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface because it makes the sampler agnostic to how the underlying model is implemented.</li>
<li>We implement our sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> interface, which just means that our sampler is a subtype of <code>AbstractMCMC.AbstractSampler</code> and we implement the MCMC transition in <code>AbstractMCMC.step</code>.</li>
<li>Points 1 and 2 makes it so our sampler can be used with a wide range of model implementations, amongst them being models implemented in both Turing.jl and Stan. This gives you, the inference implementer, a large collection of models to test your inference method on, in addition to allowing users of Turing.jl and Stan to try out your inference method with minimal effort.</li>
</ol>


</section>


<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a><div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>We’re going with the leapfrog formulation because in a future version of this tutorial we’ll add a section extending this simple “baseline” MALA sampler to more complex versions. See <a href="https://github.com/TuringLang/docs/issues/479">issue #479</a> for progress on this.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>There is no such thing as a proper interface in Julia (at least not officially), and so we use the word “interface” here to mean a few minimal methods that needs to be implemented by any type that we treat as a target model.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/turinglang\.org\/docs\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../../developers/inference/variational-inference/index.html" class="pagination-link" aria-label="Variational Inference">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Variational Inference</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Turing is created by <a href="http://mlg.eng.cam.ac.uk/hong/" target="_blank">Hong Ge</a>, and lovingly maintained by the <a href="https://github.com/TuringLang/Turing.jl/graphs/contributors" target="_blank">core team</a> of volunteers. <br> The contents of this website are © 2024 under the terms of the <a href="https://github.com/TuringLang/Turing.jl/blob/master/LICENCE" target="_blank">MIT License</a>.</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/TuringLang/docs/edit/master/developers/inference/implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/docs/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://x.com/TuringLang">
      <i class="bi bi-twitter" role="img" aria-label="Turing Twitter">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/TuringLang/Turing.jl">
      <i class="bi bi-github" role="img" aria-label="Turing GitHub">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




<script src="../../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>