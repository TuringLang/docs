<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.31">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Implementing Samplers – Turing.jl</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<link href="../../../developers/inference/variational-inference/index.html" rel="prev">
<link href="../../../assets/favicon.ico" rel="icon">
<script src="../../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-e1a5c8363afafaef2c763b6775fbf3ca.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-dark-8ef56b68f8fa1e9d2ba328e99e439f80.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-e1a5c8363afafaef2c763b6775fbf3ca.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap-adfd425b459c6192e2aaf302ef6f29d8.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../../site_libs/bootstrap/bootstrap-dark-0c340ff1686979d72b89a501eb484056.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="../../../site_libs/bootstrap/bootstrap-adfd425b459c6192e2aaf302ef6f29d8.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<style>
  a {
    text-decoration: none;
  }
  a:hover {
    text-decoration: underline;
  }
</style>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../../theming/styles.css">
</head>

<body class="nav-sidebar floating nav-fixed quarto-light"><script id="quarto-html-before-body" type="application/javascript">
    const toggleBodyColorMode = (bsSheetEl) => {
      const mode = bsSheetEl.getAttribute("data-mode");
      const bodyEl = window.document.querySelector("body");
      if (mode === "dark") {
        bodyEl.classList.add("quarto-dark");
        bodyEl.classList.remove("quarto-light");
      } else {
        bodyEl.classList.add("quarto-light");
        bodyEl.classList.remove("quarto-dark");
      }
    }
    const toggleBodyColorPrimary = () => {
      const bsSheetEl = window.document.querySelector("link#quarto-bootstrap:not([rel=disabled-stylesheet])");
      if (bsSheetEl) {
        toggleBodyColorMode(bsSheetEl);
      }
    }
    const setColorSchemeToggle = (alternate) => {
      const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
      for (let i=0; i < toggles.length; i++) {
        const toggle = toggles[i];
        if (toggle) {
          if (alternate) {
            toggle.classList.add("alternate");
          } else {
            toggle.classList.remove("alternate");
          }
        }
      }
    };
    const toggleColorMode = (alternate) => {
      // Switch the stylesheets
      const primaryStylesheets = window.document.querySelectorAll('link.quarto-color-scheme:not(.quarto-color-alternate)');
      const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
      manageTransitions('#quarto-margin-sidebar .nav-link', false);
      if (alternate) {
        // note: dark is layered on light, we don't disable primary!
        enableStylesheet(alternateStylesheets);
        for (const sheetNode of alternateStylesheets) {
          if (sheetNode.id === "quarto-bootstrap") {
            toggleBodyColorMode(sheetNode);
          }
        }
      } else {
        disableStylesheet(alternateStylesheets);
        enableStylesheet(primaryStylesheets)
        toggleBodyColorPrimary();
      }
      manageTransitions('#quarto-margin-sidebar .nav-link', true);
      // Switch the toggles
      setColorSchemeToggle(alternate)
      // Hack to workaround the fact that safari doesn't
      // properly recolor the scrollbar when toggling (#1455)
      if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
        manageTransitions("body", false);
        window.scrollTo(0, 1);
        setTimeout(() => {
          window.scrollTo(0, 0);
          manageTransitions("body", true);
        }, 40);
      }
    }
    const disableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        stylesheet.rel = 'disabled-stylesheet';
      }
    }
    const enableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        if(stylesheet.rel !== 'stylesheet') { // for Chrome, which will still FOUC without this check
          stylesheet.rel = 'stylesheet';
        }
      }
    }
    const manageTransitions = (selector, allowTransitions) => {
      const els = window.document.querySelectorAll(selector);
      for (let i=0; i < els.length; i++) {
        const el = els[i];
        if (allowTransitions) {
          el.classList.remove('notransition');
        } else {
          el.classList.add('notransition');
        }
      }
    }
    const isFileUrl = () => {
      return window.location.protocol === 'file:';
    }
    const hasAlternateSentinel = () => {
      let styleSentinel = getColorSchemeSentinel();
      if (styleSentinel !== null) {
        return styleSentinel === "alternate";
      } else {
        return false;
      }
    }
    const setStyleSentinel = (alternate) => {
      const value = alternate ? "alternate" : "default";
      if (!isFileUrl()) {
        window.localStorage.setItem("quarto-color-scheme", value);
      } else {
        localAlternateSentinel = value;
      }
    }
    const getColorSchemeSentinel = () => {
      if (!isFileUrl()) {
        const storageValue = window.localStorage.getItem("quarto-color-scheme");
        return storageValue != null ? storageValue : localAlternateSentinel;
      } else {
        return localAlternateSentinel;
      }
    }
    const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
      const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
      const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
      let newTheme = '';
      if(authorPrefersDark) {
        newTheme = isAlternate ? baseTheme : alternateTheme;
      } else {
        newTheme = isAlternate ? alternateTheme : baseTheme;
      }
      const changeGiscusTheme = () => {
        // From: https://github.com/giscus/giscus/issues/336
        const sendMessage = (message) => {
          const iframe = document.querySelector('iframe.giscus-frame');
          if (!iframe) return;
          iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
        }
        sendMessage({
          setConfig: {
            theme: newTheme
          }
        });
      }
      const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
      if (isGiscussLoaded) {
        changeGiscusTheme();
      }
    };
    const authorPrefersDark = false;
    const darkModeDefault = authorPrefersDark;
      document.querySelector('link#quarto-text-highlighting-styles.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
      document.querySelector('link#quarto-bootstrap.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
    let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
    // Dark / light mode switch
    window.quartoToggleColorScheme = () => {
      // Read the current dark / light value
      let toAlternate = !hasAlternateSentinel();
      toggleColorMode(toAlternate);
      setStyleSentinel(toAlternate);
      toggleGiscusIfUsed(toAlternate, darkModeDefault);
      window.dispatchEvent(new Event('resize'));
    };
    // Switch to dark mode if need be
    if (hasAlternateSentinel()) {
      toggleColorMode(true);
    } else {
      toggleColorMode(false);
    }
  </script>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="https://turinglang.org/" class="navbar-brand navbar-brand-logo">
    <img src="../../../assets/images/turing-logo.svg" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="https://turinglang.org/">
    <span class="navbar-title">Turing.jl</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../getting-started/"> 
<span class="menu-text">Get Started</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../tutorials/coin-flipping/"> 
<span class="menu-text">Tutorials</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/library/"> 
<span class="menu-text">Libraries</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/news/"> 
<span class="menu-text">News</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/team/"> 
<span class="menu-text">Team</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-v0.38" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">v0.38</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-v0.38">    
        <li>
    <a class="dropdown-item" href="https://turinglang.org/docs/changelog.html">
 <span class="dropdown-text">Changelog</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://turinglang.org/docs/versions.html">
 <span class="dropdown-text">All Versions</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools tools-wide">
    <a href="https://x.com/TuringLang" title="Turing Twitter" class="quarto-navigation-tool px-1" aria-label="Turing Twitter"><i class="bi bi-twitter"></i></a>
    <a href="https://github.com/TuringLang/Turing.jl" title="Turing GitHub" class="quarto-navigation-tool px-1" aria-label="Turing GitHub"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../../developers/contributing/index.html">Developers</a></li><li class="breadcrumb-item"><a href="../../../developers/inference/abstractmcmc-interface/index.html">Inference (note: outdated)</a></li><li class="breadcrumb-item"><a href="../../../developers/inference/implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../getting-started/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Getting Started</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../core-functionality/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Core Functionality</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false">
 <span class="menu-text">User Guide</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/automatic-differentiation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Automatic Differentiation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/custom-distribution/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Custom Distributions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/probability-interface/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Querying Model Probabilities</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/modifying-logprob/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Modifying the Log Probability</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/tracking-extra-quantities/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Tracking Extra Quantities</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/mode-estimation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Mode Estimation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/performance-tips/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Performance Tips</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/sampler-visualisation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Sampler Visualization</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/dynamichmc/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using DynamicHMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/external-samplers/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using External Samplers</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false">
 <span class="menu-text">Tutorials</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/coin-flipping/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction: Coin Flipping</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/gaussian-mixture-models/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Mixture Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-neural-networks/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Neural Networks</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/hidden-markov-models/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Hidden Markov Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-linear-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Linear Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/infinite-mixture-models/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Infinite Mixture Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-poisson-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Poisson Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/multinomial-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Multinomial Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-differential-equations/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Differential Equations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/probabilistic-pca/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Probabilistic PCA</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-time-series-analysis/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Time Series Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/gaussian-processes-introduction/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Processes: Introduction</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/gaussian-process-latent-variable-models/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Process Latent Variable Models</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Developers</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/contributing/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Contributing</span></a>
  </div>
</li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false">
 <span class="menu-text">DynamicPPL’s Compiler</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/compiler/model-manual/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Manually Defining a Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/compiler/minituring-compiler/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation I: Compiler</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/compiler/minituring-contexts/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation II: Contexts</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/compiler/design-overview/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Turing Compiler Design (Outdated)</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false">
 <span class="menu-text">Variable Transformations</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/transforms/distributions/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Distributions and the Jacobian</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/transforms/bijectors/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bijectors in MCMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/transforms/dynamicppl/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variable transformations in DynamicPPL</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true">
 <span class="menu-text">Inference (note: outdated)</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/inference/abstractmcmc-interface/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Interface Guide</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/inference/abstractmcmc-turing/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">How Turing Implements AbstractMCMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/inference/variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/inference/implementing-samplers/index.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Implementing Samplers</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of Contents</h2>
   
  <ul>
  <li><a href="#quick-overview-of-mala" id="toc-quick-overview-of-mala" class="nav-link active" data-scroll-target="#quick-overview-of-mala">Quick overview of MALA</a></li>
  <li><a href="#what-we-need-from-a-model-logdensityproblems.jl" id="toc-what-we-need-from-a-model-logdensityproblems.jl" class="nav-link" data-scroll-target="#what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: LogDensityProblems.jl</a></li>
  <li><a href="#implementing-mala-in-abstractmcmc.jl" id="toc-implementing-mala-in-abstractmcmc.jl" class="nav-link" data-scroll-target="#implementing-mala-in-abstractmcmc.jl">Implementing MALA in AbstractMCMC.jl</a></li>
  <li><a href="#using-our-sampler-with-turing.jl" id="toc-using-our-sampler-with-turing.jl" class="nav-link" data-scroll-target="#using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</a>
  <ul class="collapse">
  <li><a href="#models-with-constrained-parameters" id="toc-models-with-constrained-parameters" class="nav-link" data-scroll-target="#models-with-constrained-parameters">Models with constrained parameters</a></li>
  </ul></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/TuringLang/docs/edit/main/developers/inference/implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/docs/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">


<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../../developers/contributing/index.html">Developers</a></li><li class="breadcrumb-item"><a href="../../../developers/inference/abstractmcmc-interface/index.html">Inference (note: outdated)</a></li><li class="breadcrumb-item"><a href="../../../developers/inference/implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Implementing Samplers</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>In this tutorial, we’ll go through step-by-step how to implement a “simple” sampler in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> in such a way that it can be easily applied to Turing.jl models.</p>
<p>In particular, we’re going to implement a version of <strong>Metropolis-adjusted Langevin (MALA)</strong>.</p>
<p>Note that we will implement this sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> framework, completely “ignoring” Turing.jl until the very end of the tutorial, at which point we’ll use a single line of code to make the resulting sampler available to Turing.jl. This is to really drive home the point that one can implement samplers in a way that is accessible to all of Turing.jl’s users without having to use Turing.jl yourself.</p>
<section id="quick-overview-of-mala" class="level2">
<h2 class="anchored" data-anchor-id="quick-overview-of-mala">Quick overview of MALA</h2>
<p>We can view MALA as a single step of the leapfrog intergrator with resampling of momentum <span class="math inline">\(p\)</span> at every step.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> To make that statement a bit more concrete, we first define the <em>extended</em> target <span class="math inline">\(\bar{\gamma}(x, p)\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\log \bar{\gamma}(x, p) \propto \log \gamma(x) + \log \gamma_{\mathcal{N}(0, M)}(p)
\end{equation*}\]</span></p>
<p>where <span class="math inline">\(\gamma_{\mathcal{N}(0, M)}\)</span> denotes the density for a zero-centered Gaussian with covariance matrix <span class="math inline">\(M\)</span>. We then consider targeting this joint distribution over both <span class="math inline">\(x\)</span> and <span class="math inline">\(p\)</span> as follows. First we define the map</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  L_{\epsilon}: \quad &amp; \mathbb{R}^d \times \mathbb{R}^d \to \mathbb{R}^d \times \mathbb{R}^d \\
  &amp; (x, p) \mapsto (\tilde{x}, \tilde{p}) := L_{\epsilon}(x, p)
\end{split}
\end{equation*}\]</span></p>
<p>as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p_{1 / 2} &amp;:= p + \frac{\epsilon}{2} \nabla \log \gamma(x) \\
  \tilde{x} &amp;:= x + \epsilon M^{-1} p_{1 /2 } \\
  p_1 &amp;:= p_{1 / 2} + \frac{\epsilon}{2} \nabla \log \gamma(\tilde{x}) \\
  \tilde{p} &amp;:= - p_1
\end{split}
\end{equation*}\]</span></p>
<p>This might be familiar for some readers as a single step of the Leapfrog integrator. We then define the MALA kernel as follows: given the current iterate <span class="math inline">\(x_i\)</span>, we sample the next iterate <span class="math inline">\(x_{i + 1}\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p &amp;\sim \mathcal{N}(0, M) \\
  (\tilde{x}, \tilde{p}) &amp;:= L_{\epsilon}(x_i, p) \\
  \alpha &amp;:= \min \left\{ 1, \frac{\bar{\gamma}(\tilde{x}, \tilde{p})}{\bar{\gamma}(x_i, p)} \right\} \\
  x_{i + 1} &amp;:=
  \begin{cases}
    \tilde{x} \quad &amp; \text{ with prob. } \alpha \\
    x_i       \quad &amp; \text{ with prob. } 1 - \alpha
  \end{cases}
\end{split}
\end{equation*}\]</span></p>
<p>i.e.&nbsp;we accept the proposal <span class="math inline">\(\tilde{x}\)</span> with probability <span class="math inline">\(\alpha\)</span> and reject it, thus sticking with our current iterate, with probability <span class="math inline">\(1 - \alpha\)</span>.</p>
</section>
<section id="what-we-need-from-a-model-logdensityproblems.jl" class="level2">
<h2 class="anchored" data-anchor-id="what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a></h2>
<p>There are a few things we need from the “target” / “model” / density that we want to sample from:</p>
<ol type="1">
<li>We need access to log-density <em>evaluations</em> <span class="math inline">\(\log \gamma(x)\)</span> so we can compute the acceptance ratio involving <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>We need access to log-density <em>gradients</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span> so we can compute the Leapfrog steps <span class="math inline">\(L_{\epsilon}(x, p)\)</span>.</li>
<li>We also need access to the “size” of the model so we can determine the size of <span class="math inline">\(M\)</span>.</li>
</ol>
<p>Luckily for us, there is a package called <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> which provides an interface for <em>exactly</em> this!</p>
<p>To demonstrate how one can implement the “<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface”<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> we will use a simple Gaussian model as an example:</p>
<div id="4" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblems</span>: LogDensityProblems;</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's define some type that represents the model.</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> IsotropicNormalModel{M<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"mean of the isotropic Gaussian"</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    mean<span class="op">::</span><span class="dt">M</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Specifies what input length the model expects.</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">dimension</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> <span class="fu">length</span>(model.mean)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Implementation of the log-density evaluation of the model.</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x<span class="op">::</span><span class="dt">AbstractVector{&lt;:Real}</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">-</span> <span class="fu">sum</span>(abs2, x <span class="op">.-</span> model.mean) <span class="op">/</span> <span class="fl">2</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This gives us all of the properties we want for our MALA sampler with the exception of the computation of the <em>gradient</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span>. There is the method <code>LogDensityProblems.logdensity_and_gradient</code> which should return a 2-tuple where the first entry is the evaluation of the logdensity <span class="math inline">\(\log \gamma(x)\)</span> and the second entry is the gradient <span class="math inline">\(\nabla \log \gamma(x)\)</span>.</p>
<p>There are two ways to “implement” this method: 1) we implement it by hand, which is feasible in the case of our <code>IsotropicNormalModel</code>, or b) we defer the implementation of this to a automatic differentiation backend.</p>
<p>To implement it by hand we can simply do</p>
<div id="6" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl that first-order, i.e. gradient information, is available.</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{1}</span>()</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Implement `logdensity_and_gradient`.</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    logγ_x <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="op">-</span>x <span class="op">.*</span> (x <span class="op">-</span> model.mean)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> logγ_x, ∇logγ_x</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s just try it out:</p>
<div id="8" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate the problem.</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> <span class="fu">IsotropicNormalModel</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.])</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create some example input that we can test on.</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>x_example <span class="op">=</span> <span class="fu">randn</span>(LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate!</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-18.14398160653811</code></pre>
</div>
</div>
<p>To defer it to an automatic differentiation backend, we can do</p>
<div id="10" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl we only have access to 0-th order information.</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{0}</span>()</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Use `LogDensityProblemsAD`'s `ADgradient` in combination with some AD backend to implement `logdensity_and_gradient`.</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblemsAD</span>, <span class="bu">ADTypes</span>, <span class="bu">ForwardDiff</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>model_with_grad <span class="op">=</span> <span class="fu">ADgradient</span>(<span class="fu">AutoForwardDiff</span>(), model)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model_with_grad, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-18.14398160653811</code></pre>
</div>
</div>
<p>We’ll continue with the second approach in this tutorial since this is typically what one does in practice, because there are better hobbies to spend time on than deriving gradients by hand.</p>
<p>At this point, one might wonder how we’re going to tie this back to Turing.jl in the end. Effectively, when working with inference methods that only require log-density evaluations and / or higher-order information of the log-density, Turing.jl actually converts the user-provided <code>Model</code> into an object implementing the above methods for <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>. As a result, most samplers provided by Turing.jl are actually implemented to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, enabling their use both <em>within</em> Turing.jl and <em>outside</em> of Turing.jl! Morever, there exists similar conversions for Stan through BridgeStan and Stan<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, which means that a sampler supporting the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface can easily be used on both Turing.jl <em>and</em> Stan models (in addition to user-provided models, as our <code>IsotropicNormalModel</code> above)!</p>
<p>Anyways, let’s move on to actually implementing the sampler.</p>
</section>
<section id="implementing-mala-in-abstractmcmc.jl" class="level2">
<h2 class="anchored" data-anchor-id="implementing-mala-in-abstractmcmc.jl">Implementing MALA in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a></h2>
<p>Now that we’ve established that a model implementing the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface provides us with all the information we need from <span class="math inline">\(\log \gamma(x)\)</span>, we can address the question: given an object that implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, how can we define a sampler for it?</p>
<p>We’re going to do this by making our sampler a sub-type of <code>AbstractMCMC.AbstractSampler</code> in addition to implementing a few methods from <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>. Why? Because it gets us <em>a lot</em> of functionality for free, as we will see later.</p>
<p>Moreover, <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> provides a very natural interface for MCMC algorithms.</p>
<p>First, we’ll define our <code>MALA</code> type</p>
<div id="12" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">AbstractMCMC</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALA{T,A} <span class="op">&lt;:</span><span class="dt"> AbstractMCMC.AbstractSampler</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"stepsize used in the leapfrog step"</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    ϵ_init<span class="op">::</span><span class="dt">T</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"covariance matrix used for the momentum"</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    M_init<span class="op">::</span><span class="dt">A</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notice how we’ve added the suffix <code>_init</code> to both the stepsize and the covariance matrix. We’ve done this because a <code>AbstractMCMC.AbstractSampler</code> should be <em>immutable</em>. Of course there might be many scenarios where we want to allow something like the stepsize and / or the covariance matrix to vary between iterations, e.g.&nbsp;during the burn-in / adaptation phase of the sampling process we might want to adjust the parameters using statistics computed from these initial iterations. But information which can change between iterations <em>should not go in the sampler itself</em>! Instead, this information should go in the sampler <em>state</em>.</p>
<p>The sampler state should at the very least contain all the necessary information to perform the next MCMC iteration, but usually contains further information, e.g.&nbsp;quantities and statistics useful for evaluating whether the sampler has converged.</p>
<p>We will use the following sampler state for our <code>MALA</code> sampler:</p>
<div id="14" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALAState{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This might seem overly redundant: we’re defining a type <code>MALAState</code> and it only contains a simple vector of reals. In this particular case we indeed could have dropped this and simply used a <code>AbstractVector{&lt;:Real}</code> as our sampler state, but typically, as we will see later, one wants to include other quantities in the sampler state. For example, if we also wanted to adapt the parameters of our <code>MALA</code>, e.g.&nbsp;alter the stepsize depending on acceptance rates, in which case we should also put <code>ϵ</code> in the state, but for now we’ll keep things simple.</p>
<p>Moreover, we also want a <em>sample</em> type, which is a type meant for “public consumption”, i.e.&nbsp;the end-user. This is generally going to contain a subset of the information present in the state. But in such a simple scenario as this, we similarly only have a <code>AbstractVector{&lt;:Real}</code>:</p>
<div id="16" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALASample{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We currently have three things:</p>
<ol type="1">
<li>A <code>AbstractMCMC.AbstractSampler</code> implementation called <code>MALA</code>.</li>
<li>A state <code>MALAState</code> for our sampler <code>MALA</code>.</li>
<li>A sample <code>MALASample</code> for our sampler <code>MALA</code>.</li>
</ol>
<p>That means that we’re ready to implement the only thing that really matters: <code>AbstractMCMC.step</code>.</p>
<p><code>AbstractMCMC.step</code> defines the MCMC iteration of our <code>MALA</code> given the current <code>MALAState</code>. Specifically, the signature of the function is as follows:</p>
<div id="18" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The RNG to ensure reproducibility.</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The model that defines our target.</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.AbstractModel</span>,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The sampler for which we're taking a `step`.</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">AbstractMCMC.AbstractSampler</span>,</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The current sampler `state`.</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    state;</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Additional keyword arguments that we may or may not need.</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Moreover, there is a specific <code>AbstractMCMC.AbstractModel</code> which is used to indicate that the model that is provided implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface: <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Since, as we discussed earlier, in our case we’re indeed going to work with types that support the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, we’ll define <code>AbstractMCMC.step</code> for such a <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Note that <code>AbstractMCMC.LogDensityModel</code> has no other purpose; it has a single field called <code>logdensity</code>, and it does nothing else. But by wrapping the model in <code>AbstractMCMC.LogDensityModel</code>, it allows samplers that want to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> to define their <code>AbstractMCMC.step</code> on this type without running into method ambiguities.</p>
<p>All in all, that means that the signature for our <code>AbstractMCMC.step</code> is going to be the following:</p>
<div id="20" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># `LogDensityModel` so we know we're working with LogDensityProblems.jl model.</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler.</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler state.</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Great! Now let’s actually implement the full <code>AbstractMCMC.step</code> for our <code>MALA</code>.</p>
<p>Let’s remind ourselves what we’re going to do:</p>
<ol type="1">
<li>Sample a new momentum <span class="math inline">\(p\)</span>.</li>
<li>Compute the log-density of the extended target <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>Take a single leapfrog step <span class="math inline">\((\tilde{x}, \tilde{p}) = L_{\epsilon}(x, p)\)</span>.</li>
<li>Accept or reject the proposed <span class="math inline">\((\tilde{x}, \tilde{p})\)</span>.</li>
</ol>
<p>All in all, this results in the following:</p>
<div id="22" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>: Random</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Distributions</span>  <span class="co"># so we get the `MvNormal`</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the wrapped model which implements LogDensityProblems.jl.</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just extract the sampler parameters to make our lives easier.</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    ϵ <span class="op">=</span> sampler.ϵ_init</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    M <span class="op">=</span> sampler.M_init</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the current parameters.</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> state.x</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sample the momentum.</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>    p_dist <span class="op">=</span> <span class="fu">MvNormal</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)), M)</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> <span class="fu">rand</span>(rng, p_dist)</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Propose using a single leapfrog step.</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>    x̃, p̃ <span class="op">=</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Accept or reject proposal.</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>    logp <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p)</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>    logp̃ <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x̃) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p̃)</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>    logα <span class="op">=</span> logp̃ <span class="op">-</span> logp</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>    state_new <span class="op">=</span> <span class="cf">if</span> <span class="fu">log</span>(<span class="fu">rand</span>(rng)) <span class="op">&lt;</span> logα</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Accept.</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x̃)</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Reject.</span></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x)</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return the "sample" and the sampler state.</span></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(state_new.x), state_new</span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Fairly straight-forward.</p>
<p>Of course, we haven’t defined the <code>leapfrog_step</code> method yet, so let’s do that:</p>
<div id="24" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p` using "position" `x`.</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x))</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    p1 <span class="op">=</span> p <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update the "position" `x` using momentum `p1`.</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    x̃ <span class="op">=</span> x <span class="op">+</span> ϵ <span class="op">.*</span> (M <span class="op">\</span> p1)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p1` using position `x̃`</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x̃ <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x̃))</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    p2 <span class="op">=</span> p1 <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x̃</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Flip momentum `p2`.</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    p̃ <span class="op">=</span> <span class="op">-</span>p2</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x̃, p̃</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>leapfrog_step (generic function with 1 method)</code></pre>
</div>
</div>
<p>With all of this, we’re technically ready to sample!</p>
<div id="26" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>, <span class="bu">LinearAlgebra</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>rng <span class="op">=</span> <span class="bu">Random</span>.<span class="fu">default_rng</span>()</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>sampler <span class="op">=</span> <span class="fu">MALA</span>(<span class="fl">1</span>, I)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>state <span class="op">=</span> <span class="fu">MALAState</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)))</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>x_next, state_next <span class="op">=</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    rng,</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    AbstractMCMC.<span class="fu">LogDensityModel</span>(model),</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    state</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>(MALASample{Vector{Float64}}([0.0, 0.0, 0.0]), MALAState{Vector{Float64}}([0.0, 0.0, 0.0]))</code></pre>
</div>
</div>
<p>Great, it works!</p>
<p>And I promised we would get quite some functionality for free if we implemented <code>AbstractMCMC.step</code>, and so we can now simply call <code>sample</code> to perform standard MCMC sampling:</p>
<div id="28" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform 1000 iterations with our `MALA` sampler.</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; initial_state<span class="op">=</span>state, progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Concatenate into a matrix.</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000 Matrix{Float64}:
 -1.90077   -4.64146  -1.84206  -1.70583  …  -4.56724   -3.24622   -4.10756
  0.571956   1.30957   2.11737   2.41505      0.664785  -0.354907   0.252719
  1.1749     1.37406   2.54128   4.77464      5.24326    4.82186    4.2747</code></pre>
</div>
</div>
<div id="30" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the marginal means and standard deviations.</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -5.00585    1.01156
  0.0222945  0.996136
  5.00223    1.00058</code></pre>
</div>
</div>
<p>Let’s visualize the samples</p>
<div id="32" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">StatsPlots</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">transpose</span>(samples_matrix[<span class="op">:</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">:</span><span class="kw">end</span>]), alpha<span class="op">=</span><span class="fl">0.5</span>, legend<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<!--?xml version="1.0" encoding="utf-8"?-->
<svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" width="672" height="480" viewbox="0 0 2688 1920">
<defs>
  <clippath id="clip360">
    <rect x="0" y="0" width="2688" height="1920"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip360)" d="M0 1920 L2688 1920 L2688 0 L0 0  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip361">
    <rect x="537" y="0" width="1883" height="1883"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip360)" d="M196.816 1800.78 L2640.76 1800.78 L2640.76 47.2441 L196.816 47.2441  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip362">
    <rect x="196" y="47" width="2445" height="1755"></rect>
  </clippath>
</defs>
<polyline clip-path="url(#clip362)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="263.676,1800.78 263.676,47.2441 "></polyline>
<polyline clip-path="url(#clip362)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="840.654,1800.78 840.654,47.2441 "></polyline>
<polyline clip-path="url(#clip362)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1417.63,1800.78 1417.63,47.2441 "></polyline>
<polyline clip-path="url(#clip362)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1994.61,1800.78 1994.61,47.2441 "></polyline>
<polyline clip-path="url(#clip362)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="2571.59,1800.78 2571.59,47.2441 "></polyline>
<polyline clip-path="url(#clip362)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,1612.92 2640.76,1612.92 "></polyline>
<polyline clip-path="url(#clip362)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,1369.82 2640.76,1369.82 "></polyline>
<polyline clip-path="url(#clip362)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,1126.72 2640.76,1126.72 "></polyline>
<polyline clip-path="url(#clip362)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,883.612 2640.76,883.612 "></polyline>
<polyline clip-path="url(#clip362)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,640.508 2640.76,640.508 "></polyline>
<polyline clip-path="url(#clip362)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,397.404 2640.76,397.404 "></polyline>
<polyline clip-path="url(#clip362)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,154.3 2640.76,154.3 "></polyline>
<polyline clip-path="url(#clip360)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1800.78 2640.76,1800.78 "></polyline>
<polyline clip-path="url(#clip360)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="263.676,1800.78 263.676,1781.88 "></polyline>
<polyline clip-path="url(#clip360)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="840.654,1800.78 840.654,1781.88 "></polyline>
<polyline clip-path="url(#clip360)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1417.63,1800.78 1417.63,1781.88 "></polyline>
<polyline clip-path="url(#clip360)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1994.61,1800.78 1994.61,1781.88 "></polyline>
<polyline clip-path="url(#clip360)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="2571.59,1800.78 2571.59,1781.88 "></polyline>
<path clip-path="url(#clip360)" d="M263.676 1834 Q260.065 1834 258.236 1837.57 Q256.431 1841.11 256.431 1848.24 Q256.431 1855.34 258.236 1858.91 Q260.065 1862.45 263.676 1862.45 Q267.31 1862.45 269.116 1858.91 Q270.945 1855.34 270.945 1848.24 Q270.945 1841.11 269.116 1837.57 Q267.31 1834 263.676 1834 M263.676 1830.3 Q269.486 1830.3 272.542 1834.9 Q275.621 1839.49 275.621 1848.24 Q275.621 1856.96 272.542 1861.57 Q269.486 1866.15 263.676 1866.15 Q257.866 1866.15 254.787 1861.57 Q251.732 1856.96 251.732 1848.24 Q251.732 1839.49 254.787 1834.9 Q257.866 1830.3 263.676 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip360)" d="M804.346 1861.55 L820.666 1861.55 L820.666 1865.48 L798.721 1865.48 L798.721 1861.55 Q801.383 1858.79 805.967 1854.16 Q810.573 1849.51 811.754 1848.17 Q813.999 1845.65 814.879 1843.91 Q815.782 1842.15 815.782 1840.46 Q815.782 1837.71 813.837 1835.97 Q811.916 1834.23 808.814 1834.23 Q806.615 1834.23 804.161 1835 Q801.731 1835.76 798.953 1837.31 L798.953 1832.59 Q801.777 1831.46 804.231 1830.88 Q806.684 1830.3 808.721 1830.3 Q814.092 1830.3 817.286 1832.98 Q820.481 1835.67 820.481 1840.16 Q820.481 1842.29 819.67 1844.21 Q818.883 1846.11 816.777 1848.7 Q816.198 1849.37 813.096 1852.59 Q809.995 1855.78 804.346 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip360)" d="M830.527 1830.92 L848.883 1830.92 L848.883 1834.86 L834.809 1834.86 L834.809 1843.33 Q835.828 1842.98 836.846 1842.82 Q837.865 1842.64 838.883 1842.64 Q844.67 1842.64 848.05 1845.81 Q851.43 1848.98 851.43 1854.4 Q851.43 1859.97 847.957 1863.08 Q844.485 1866.15 838.166 1866.15 Q835.99 1866.15 833.721 1865.78 Q831.476 1865.41 829.069 1864.67 L829.069 1859.97 Q831.152 1861.11 833.374 1861.66 Q835.596 1862.22 838.073 1862.22 Q842.078 1862.22 844.416 1860.11 Q846.754 1858.01 846.754 1854.4 Q846.754 1850.78 844.416 1848.68 Q842.078 1846.57 838.073 1846.57 Q836.198 1846.57 834.323 1846.99 Q832.471 1847.4 830.527 1848.28 L830.527 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip360)" d="M870.642 1834 Q867.031 1834 865.203 1837.57 Q863.397 1841.11 863.397 1848.24 Q863.397 1855.34 865.203 1858.91 Q867.031 1862.45 870.642 1862.45 Q874.277 1862.45 876.082 1858.91 Q877.911 1855.34 877.911 1848.24 Q877.911 1841.11 876.082 1837.57 Q874.277 1834 870.642 1834 M870.642 1830.3 Q876.453 1830.3 879.508 1834.9 Q882.587 1839.49 882.587 1848.24 Q882.587 1856.96 879.508 1861.57 Q876.453 1866.15 870.642 1866.15 Q864.832 1866.15 861.754 1861.57 Q858.698 1856.96 858.698 1848.24 Q858.698 1839.49 861.754 1834.9 Q864.832 1830.3 870.642 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip360)" d="M1377.25 1830.92 L1395.61 1830.92 L1395.61 1834.86 L1381.53 1834.86 L1381.53 1843.33 Q1382.55 1842.98 1383.57 1842.82 Q1384.59 1842.64 1385.61 1842.64 Q1391.39 1842.64 1394.77 1845.81 Q1398.15 1848.98 1398.15 1854.4 Q1398.15 1859.97 1394.68 1863.08 Q1391.21 1866.15 1384.89 1866.15 Q1382.71 1866.15 1380.44 1865.78 Q1378.2 1865.41 1375.79 1864.67 L1375.79 1859.97 Q1377.88 1861.11 1380.1 1861.66 Q1382.32 1862.22 1384.8 1862.22 Q1388.8 1862.22 1391.14 1860.11 Q1393.48 1858.01 1393.48 1854.4 Q1393.48 1850.78 1391.14 1848.68 Q1388.8 1846.57 1384.8 1846.57 Q1382.92 1846.57 1381.05 1846.99 Q1379.19 1847.4 1377.25 1848.28 L1377.25 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip360)" d="M1417.37 1834 Q1413.75 1834 1411.93 1837.57 Q1410.12 1841.11 1410.12 1848.24 Q1410.12 1855.34 1411.93 1858.91 Q1413.75 1862.45 1417.37 1862.45 Q1421 1862.45 1422.81 1858.91 Q1424.63 1855.34 1424.63 1848.24 Q1424.63 1841.11 1422.81 1837.57 Q1421 1834 1417.37 1834 M1417.37 1830.3 Q1423.18 1830.3 1426.23 1834.9 Q1429.31 1839.49 1429.31 1848.24 Q1429.31 1856.96 1426.23 1861.57 Q1423.18 1866.15 1417.37 1866.15 Q1411.56 1866.15 1408.48 1861.57 Q1405.42 1856.96 1405.42 1848.24 Q1405.42 1839.49 1408.48 1834.9 Q1411.56 1830.3 1417.37 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip360)" d="M1447.53 1834 Q1443.92 1834 1442.09 1837.57 Q1440.28 1841.11 1440.28 1848.24 Q1440.28 1855.34 1442.09 1858.91 Q1443.92 1862.45 1447.53 1862.45 Q1451.16 1862.45 1452.97 1858.91 Q1454.8 1855.34 1454.8 1848.24 Q1454.8 1841.11 1452.97 1837.57 Q1451.16 1834 1447.53 1834 M1447.53 1830.3 Q1453.34 1830.3 1456.39 1834.9 Q1459.47 1839.49 1459.47 1848.24 Q1459.47 1856.96 1456.39 1861.57 Q1453.34 1866.15 1447.53 1866.15 Q1441.72 1866.15 1438.64 1861.57 Q1435.58 1856.96 1435.58 1848.24 Q1435.58 1839.49 1438.64 1834.9 Q1441.72 1830.3 1447.53 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip360)" d="M1952.89 1830.92 L1975.11 1830.92 L1975.11 1832.91 L1962.56 1865.48 L1957.68 1865.48 L1969.48 1834.86 L1952.89 1834.86 L1952.89 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip360)" d="M1984.27 1830.92 L2002.63 1830.92 L2002.63 1834.86 L1988.56 1834.86 L1988.56 1843.33 Q1989.58 1842.98 1990.59 1842.82 Q1991.61 1842.64 1992.63 1842.64 Q1998.42 1842.64 2001.8 1845.81 Q2005.18 1848.98 2005.18 1854.4 Q2005.18 1859.97 2001.7 1863.08 Q1998.23 1866.15 1991.91 1866.15 Q1989.74 1866.15 1987.47 1865.78 Q1985.22 1865.41 1982.82 1864.67 L1982.82 1859.97 Q1984.9 1861.11 1987.12 1861.66 Q1989.34 1862.22 1991.82 1862.22 Q1995.83 1862.22 1998.16 1860.11 Q2000.5 1858.01 2000.5 1854.4 Q2000.5 1850.78 1998.16 1848.68 Q1995.83 1846.57 1991.82 1846.57 Q1989.95 1846.57 1988.07 1846.99 Q1986.22 1847.4 1984.27 1848.28 L1984.27 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip360)" d="M2024.39 1834 Q2020.78 1834 2018.95 1837.57 Q2017.14 1841.11 2017.14 1848.24 Q2017.14 1855.34 2018.95 1858.91 Q2020.78 1862.45 2024.39 1862.45 Q2028.02 1862.45 2029.83 1858.91 Q2031.66 1855.34 2031.66 1848.24 Q2031.66 1841.11 2029.83 1837.57 Q2028.02 1834 2024.39 1834 M2024.39 1830.3 Q2030.2 1830.3 2033.26 1834.9 Q2036.33 1839.49 2036.33 1848.24 Q2036.33 1856.96 2033.26 1861.57 Q2030.2 1866.15 2024.39 1866.15 Q2018.58 1866.15 2015.5 1861.57 Q2012.45 1856.96 2012.45 1848.24 Q2012.45 1839.49 2015.5 1834.9 Q2018.58 1830.3 2024.39 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip360)" d="M2516.11 1861.55 L2523.75 1861.55 L2523.75 1835.18 L2515.44 1836.85 L2515.44 1832.59 L2523.71 1830.92 L2528.38 1830.92 L2528.38 1861.55 L2536.02 1861.55 L2536.02 1865.48 L2516.11 1865.48 L2516.11 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip360)" d="M2555.47 1834 Q2551.85 1834 2550.03 1837.57 Q2548.22 1841.11 2548.22 1848.24 Q2548.22 1855.34 2550.03 1858.91 Q2551.85 1862.45 2555.47 1862.45 Q2559.1 1862.45 2560.9 1858.91 Q2562.73 1855.34 2562.73 1848.24 Q2562.73 1841.11 2560.9 1837.57 Q2559.1 1834 2555.47 1834 M2555.47 1830.3 Q2561.28 1830.3 2564.33 1834.9 Q2567.41 1839.49 2567.41 1848.24 Q2567.41 1856.96 2564.33 1861.57 Q2561.28 1866.15 2555.47 1866.15 Q2549.66 1866.15 2546.58 1861.57 Q2543.52 1856.96 2543.52 1848.24 Q2543.52 1839.49 2546.58 1834.9 Q2549.66 1830.3 2555.47 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip360)" d="M2585.63 1834 Q2582.02 1834 2580.19 1837.57 Q2578.38 1841.11 2578.38 1848.24 Q2578.38 1855.34 2580.19 1858.91 Q2582.02 1862.45 2585.63 1862.45 Q2589.26 1862.45 2591.07 1858.91 Q2592.9 1855.34 2592.9 1848.24 Q2592.9 1841.11 2591.07 1837.57 Q2589.26 1834 2585.63 1834 M2585.63 1830.3 Q2591.44 1830.3 2594.49 1834.9 Q2597.57 1839.49 2597.57 1848.24 Q2597.57 1856.96 2594.49 1861.57 Q2591.44 1866.15 2585.63 1866.15 Q2579.82 1866.15 2576.74 1861.57 Q2573.68 1856.96 2573.68 1848.24 Q2573.68 1839.49 2576.74 1834.9 Q2579.82 1830.3 2585.63 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip360)" d="M2615.79 1834 Q2612.18 1834 2610.35 1837.57 Q2608.54 1841.11 2608.54 1848.24 Q2608.54 1855.34 2610.35 1858.91 Q2612.18 1862.45 2615.79 1862.45 Q2619.42 1862.45 2621.23 1858.91 Q2623.06 1855.34 2623.06 1848.24 Q2623.06 1841.11 2621.23 1837.57 Q2619.42 1834 2615.79 1834 M2615.79 1830.3 Q2621.6 1830.3 2624.65 1834.9 Q2627.73 1839.49 2627.73 1848.24 Q2627.73 1856.96 2624.65 1861.57 Q2621.6 1866.15 2615.79 1866.15 Q2609.98 1866.15 2606.9 1861.57 Q2603.84 1856.96 2603.84 1848.24 Q2603.84 1839.49 2606.9 1834.9 Q2609.98 1830.3 2615.79 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip360)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1800.78 196.816,47.2441 "></polyline>
<polyline clip-path="url(#clip360)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1612.92 215.714,1612.92 "></polyline>
<polyline clip-path="url(#clip360)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1369.82 215.714,1369.82 "></polyline>
<polyline clip-path="url(#clip360)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1126.72 215.714,1126.72 "></polyline>
<polyline clip-path="url(#clip360)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,883.612 215.714,883.612 "></polyline>
<polyline clip-path="url(#clip360)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,640.508 215.714,640.508 "></polyline>
<polyline clip-path="url(#clip360)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,397.404 215.714,397.404 "></polyline>
<polyline clip-path="url(#clip360)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,154.3 215.714,154.3 "></polyline>
<path clip-path="url(#clip360)" d="M50.5475 1613.38 L80.2233 1613.38 L80.2233 1617.31 L50.5475 1617.31 L50.5475 1613.38 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip360)" d="M89.1352 1595.64 L111.357 1595.64 L111.357 1597.64 L98.8111 1630.2 L93.9269 1630.2 L105.732 1599.58 L89.1352 1599.58 L89.1352 1595.64 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip360)" d="M120.478 1624.33 L125.362 1624.33 L125.362 1630.2 L120.478 1630.2 L120.478 1624.33 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip360)" d="M135.593 1595.64 L153.95 1595.64 L153.95 1599.58 L139.876 1599.58 L139.876 1608.05 Q140.894 1607.7 141.913 1607.54 Q142.931 1607.36 143.95 1607.36 Q149.737 1607.36 153.116 1610.53 Q156.496 1613.7 156.496 1619.12 Q156.496 1624.7 153.024 1627.8 Q149.552 1630.88 143.232 1630.88 Q141.056 1630.88 138.788 1630.51 Q136.542 1630.14 134.135 1629.39 L134.135 1624.7 Q136.218 1625.83 138.441 1626.39 Q140.663 1626.94 143.14 1626.94 Q147.144 1626.94 149.482 1624.83 Q151.82 1622.73 151.82 1619.12 Q151.82 1615.51 149.482 1613.4 Q147.144 1611.29 143.14 1611.29 Q141.265 1611.29 139.39 1611.71 Q137.538 1612.13 135.593 1613.01 L135.593 1595.64 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip360)" d="M49.5521 1370.27 L79.2279 1370.27 L79.2279 1374.21 L49.5521 1374.21 L49.5521 1370.27 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip360)" d="M89.3667 1352.54 L107.723 1352.54 L107.723 1356.48 L93.6491 1356.48 L93.6491 1364.95 Q94.6676 1364.6 95.6861 1364.44 Q96.7047 1364.25 97.7232 1364.25 Q103.51 1364.25 106.89 1367.42 Q110.269 1370.6 110.269 1376.01 Q110.269 1381.59 106.797 1384.69 Q103.325 1387.77 97.0056 1387.77 Q94.8297 1387.77 92.5612 1387.4 Q90.3158 1387.03 87.9084 1386.29 L87.9084 1381.59 Q89.9917 1382.73 92.2139 1383.28 Q94.4361 1383.84 96.913 1383.84 Q100.918 1383.84 103.256 1381.73 Q105.593 1379.62 105.593 1376.01 Q105.593 1372.4 103.256 1370.3 Q100.918 1368.19 96.913 1368.19 Q95.038 1368.19 93.163 1368.61 Q91.3112 1369.02 89.3667 1369.9 L89.3667 1352.54 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip360)" d="M119.482 1381.22 L124.367 1381.22 L124.367 1387.1 L119.482 1387.1 L119.482 1381.22 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip360)" d="M144.552 1355.62 Q140.941 1355.62 139.112 1359.18 Q137.306 1362.73 137.306 1369.86 Q137.306 1376.96 139.112 1380.53 Q140.941 1384.07 144.552 1384.07 Q148.186 1384.07 149.991 1380.53 Q151.82 1376.96 151.82 1369.86 Q151.82 1362.73 149.991 1359.18 Q148.186 1355.62 144.552 1355.62 M144.552 1351.92 Q150.362 1351.92 153.417 1356.52 Q156.496 1361.11 156.496 1369.86 Q156.496 1378.58 153.417 1383.19 Q150.362 1387.77 144.552 1387.77 Q138.741 1387.77 135.663 1383.19 Q132.607 1378.58 132.607 1369.86 Q132.607 1361.11 135.663 1356.52 Q138.741 1351.92 144.552 1351.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip360)" d="M50.5475 1127.17 L80.2233 1127.17 L80.2233 1131.1 L50.5475 1131.1 L50.5475 1127.17 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip360)" d="M94.3436 1140.06 L110.663 1140.06 L110.663 1144 L88.7186 1144 L88.7186 1140.06 Q91.3806 1137.31 95.9639 1132.68 Q100.57 1128.02 101.751 1126.68 Q103.996 1124.16 104.876 1122.42 Q105.779 1120.66 105.779 1118.97 Q105.779 1116.22 103.834 1114.48 Q101.913 1112.75 98.8111 1112.75 Q96.6121 1112.75 94.1584 1113.51 Q91.7278 1114.27 88.9501 1115.83 L88.9501 1111.1 Q91.7741 1109.97 94.2278 1109.39 Q96.6815 1108.81 98.7185 1108.81 Q104.089 1108.81 107.283 1111.5 Q110.478 1114.18 110.478 1118.67 Q110.478 1120.8 109.668 1122.72 Q108.881 1124.62 106.774 1127.21 Q106.195 1127.89 103.094 1131.1 Q99.9917 1134.3 94.3436 1140.06 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip360)" d="M120.478 1138.12 L125.362 1138.12 L125.362 1144 L120.478 1144 L120.478 1138.12 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip360)" d="M135.593 1109.44 L153.95 1109.44 L153.95 1113.37 L139.876 1113.37 L139.876 1121.84 Q140.894 1121.5 141.913 1121.33 Q142.931 1121.15 143.95 1121.15 Q149.737 1121.15 153.116 1124.32 Q156.496 1127.49 156.496 1132.91 Q156.496 1138.49 153.024 1141.59 Q149.552 1144.67 143.232 1144.67 Q141.056 1144.67 138.788 1144.3 Q136.542 1143.93 134.135 1143.19 L134.135 1138.49 Q136.218 1139.62 138.441 1140.18 Q140.663 1140.73 143.14 1140.73 Q147.144 1140.73 149.482 1138.63 Q151.82 1136.52 151.82 1132.91 Q151.82 1129.3 149.482 1127.19 Q147.144 1125.08 143.14 1125.08 Q141.265 1125.08 139.39 1125.5 Q137.538 1125.92 135.593 1126.8 L135.593 1109.44 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip360)" d="M99.3204 869.411 Q95.7093 869.411 93.8806 872.976 Q92.075 876.517 92.075 883.647 Q92.075 890.753 93.8806 894.318 Q95.7093 897.86 99.3204 897.86 Q102.955 897.86 104.76 894.318 Q106.589 890.753 106.589 883.647 Q106.589 876.517 104.76 872.976 Q102.955 869.411 99.3204 869.411 M99.3204 865.707 Q105.131 865.707 108.186 870.314 Q111.265 874.897 111.265 883.647 Q111.265 892.374 108.186 896.98 Q105.131 901.564 99.3204 901.564 Q93.5102 901.564 90.4315 896.98 Q87.376 892.374 87.376 883.647 Q87.376 874.897 90.4315 870.314 Q93.5102 865.707 99.3204 865.707 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip360)" d="M119.482 895.013 L124.367 895.013 L124.367 900.892 L119.482 900.892 L119.482 895.013 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip360)" d="M144.552 869.411 Q140.941 869.411 139.112 872.976 Q137.306 876.517 137.306 883.647 Q137.306 890.753 139.112 894.318 Q140.941 897.86 144.552 897.86 Q148.186 897.86 149.991 894.318 Q151.82 890.753 151.82 883.647 Q151.82 876.517 149.991 872.976 Q148.186 869.411 144.552 869.411 M144.552 865.707 Q150.362 865.707 153.417 870.314 Q156.496 874.897 156.496 883.647 Q156.496 892.374 153.417 896.98 Q150.362 901.564 144.552 901.564 Q138.741 901.564 135.663 896.98 Q132.607 892.374 132.607 883.647 Q132.607 874.897 135.663 870.314 Q138.741 865.707 144.552 865.707 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip360)" d="M94.3436 653.853 L110.663 653.853 L110.663 657.788 L88.7186 657.788 L88.7186 653.853 Q91.3806 651.098 95.9639 646.469 Q100.57 641.816 101.751 640.473 Q103.996 637.95 104.876 636.214 Q105.779 634.455 105.779 632.765 Q105.779 630.011 103.834 628.274 Q101.913 626.538 98.8111 626.538 Q96.6121 626.538 94.1584 627.302 Q91.7278 628.066 88.9501 629.617 L88.9501 624.895 Q91.7741 623.761 94.2278 623.182 Q96.6815 622.603 98.7185 622.603 Q104.089 622.603 107.283 625.288 Q110.478 627.973 110.478 632.464 Q110.478 634.594 109.668 636.515 Q108.881 638.413 106.774 641.006 Q106.195 641.677 103.094 644.895 Q99.9917 648.089 94.3436 653.853 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip360)" d="M120.478 651.909 L125.362 651.909 L125.362 657.788 L120.478 657.788 L120.478 651.909 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip360)" d="M135.593 623.228 L153.95 623.228 L153.95 627.163 L139.876 627.163 L139.876 635.635 Q140.894 635.288 141.913 635.126 Q142.931 634.941 143.95 634.941 Q149.737 634.941 153.116 638.112 Q156.496 641.284 156.496 646.7 Q156.496 652.279 153.024 655.381 Q149.552 658.459 143.232 658.459 Q141.056 658.459 138.788 658.089 Q136.542 657.719 134.135 656.978 L134.135 652.279 Q136.218 653.413 138.441 653.969 Q140.663 654.524 143.14 654.524 Q147.144 654.524 149.482 652.418 Q151.82 650.311 151.82 646.7 Q151.82 643.089 149.482 640.983 Q147.144 638.876 143.14 638.876 Q141.265 638.876 139.39 639.293 Q137.538 639.71 135.593 640.589 L135.593 623.228 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip360)" d="M89.3667 380.124 L107.723 380.124 L107.723 384.059 L93.6491 384.059 L93.6491 392.531 Q94.6676 392.184 95.6861 392.022 Q96.7047 391.837 97.7232 391.837 Q103.51 391.837 106.89 395.008 Q110.269 398.179 110.269 403.596 Q110.269 409.175 106.797 412.277 Q103.325 415.355 97.0056 415.355 Q94.8297 415.355 92.5612 414.985 Q90.3158 414.615 87.9084 413.874 L87.9084 409.175 Q89.9917 410.309 92.2139 410.865 Q94.4361 411.42 96.913 411.42 Q100.918 411.42 103.256 409.314 Q105.593 407.207 105.593 403.596 Q105.593 399.985 103.256 397.879 Q100.918 395.772 96.913 395.772 Q95.038 395.772 93.163 396.189 Q91.3112 396.605 89.3667 397.485 L89.3667 380.124 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip360)" d="M119.482 408.804 L124.367 408.804 L124.367 414.684 L119.482 414.684 L119.482 408.804 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip360)" d="M144.552 383.203 Q140.941 383.203 139.112 386.767 Q137.306 390.309 137.306 397.439 Q137.306 404.545 139.112 408.11 Q140.941 411.652 144.552 411.652 Q148.186 411.652 149.991 408.11 Q151.82 404.545 151.82 397.439 Q151.82 390.309 149.991 386.767 Q148.186 383.203 144.552 383.203 M144.552 379.499 Q150.362 379.499 153.417 384.105 Q156.496 388.689 156.496 397.439 Q156.496 406.166 153.417 410.772 Q150.362 415.355 144.552 415.355 Q138.741 415.355 135.663 410.772 Q132.607 406.166 132.607 397.439 Q132.607 388.689 135.663 384.105 Q138.741 379.499 144.552 379.499 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip360)" d="M89.1352 137.02 L111.357 137.02 L111.357 139.011 L98.8111 171.58 L93.9269 171.58 L105.732 140.955 L89.1352 140.955 L89.1352 137.02 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip360)" d="M120.478 165.7 L125.362 165.7 L125.362 171.58 L120.478 171.58 L120.478 165.7 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip360)" d="M135.593 137.02 L153.95 137.02 L153.95 140.955 L139.876 140.955 L139.876 149.427 Q140.894 149.08 141.913 148.918 Q142.931 148.733 143.95 148.733 Q149.737 148.733 153.116 151.904 Q156.496 155.075 156.496 160.492 Q156.496 166.071 153.024 169.172 Q149.552 172.251 143.232 172.251 Q141.056 172.251 138.788 171.881 Q136.542 171.51 134.135 170.77 L134.135 166.071 Q136.218 167.205 138.441 167.76 Q140.663 168.316 143.14 168.316 Q147.144 168.316 149.482 166.21 Q151.82 164.103 151.82 160.492 Q151.82 156.881 149.482 154.774 Q147.144 152.668 143.14 152.668 Q141.265 152.668 139.39 153.085 Q137.538 153.501 135.593 154.381 L135.593 137.02 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip362)" style="stroke:#009af9; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="265.984,1068.45 268.292,1366.23 270.6,1472.98 272.908,1359.36 275.216,1405.79 277.524,1401.16 279.832,1517.42 282.139,1286.39 284.447,1341.86 286.755,1303.97 289.063,1400.65 291.371,1423.08 293.679,1242.18 295.987,1177.36 298.295,1316.92 300.603,1311.98 302.911,1414.75 305.219,1351.23 307.527,1575.39 309.834,1398.64 312.142,1359.42 314.45,1213.44 316.758,1444.56 319.066,1337.3 321.374,1308.06 323.682,1446.72 325.99,1507.8 328.298,1342.55 330.606,1610.83 332.914,1447.66 335.221,1276.23 337.529,1238.7 339.837,1422.86 342.145,1417.76 344.453,1146.56 346.761,1502.75 349.069,1415.78 351.377,1392.22 353.685,1443.44 355.993,1487.94 358.301,1320.52 360.608,1463.22 362.916,1340.38 365.224,1280.03 367.532,1258.93 369.84,1212.55 372.148,1357.71 374.456,1358.96 376.764,1287.57 379.072,1271.66 381.38,1430.8 383.688,1374.6 385.996,1241.31 388.303,1325.38 390.611,1431.07 392.919,1308.12 395.227,1288.86 397.535,1363.48 399.843,1359.71 402.151,1569.15 404.459,1188.26 406.767,1392.78 409.075,1431.63 411.383,1289.64 413.69,1508.46 415.998,1377.45 418.306,1314.12 420.614,1341.94 422.922,1349.46 425.23,1551.92 427.538,1351.9 429.846,1441.14 432.154,1379.66 434.462,1451.79 436.77,1249.64 439.077,1225.65 441.385,1307.66 443.693,1346.2 446.001,1381.61 448.309,1296.25 450.617,1396.06 452.925,1395.8 455.233,1388.89 457.541,1401.14 459.849,1268.02 462.157,1393.95 464.465,1431.55 466.772,1324 469.08,1459.06 471.388,1368.91 473.696,1389.77 476.004,1268.65 478.312,1414.88 480.62,1326.87 482.928,1190.86 485.236,1305.22 487.544,1493.37 489.852,1286.27 492.159,1069.19 494.467,1442.15 496.775,1337.57 499.083,1301.22 501.391,1443.16 503.699,1259.8 506.007,1297.28 508.315,1317.88 510.623,1256.29 512.931,1533.57 515.239,1442.98 517.546,1254.49 519.854,1387.1 522.162,1276.31 524.47,1356.57 526.778,1462.73 529.086,1327.67 531.394,1354.37 533.702,1476.27 536.01,1377.88 538.318,1457.45 540.626,1411.26 542.933,1282.28 545.241,1484.53 547.549,1350.95 549.857,1377.54 552.165,1252.55 554.473,1504.34 556.781,1242.67 559.089,1549.96 561.397,1393.1 563.705,1569.38 566.013,1261.48 568.321,1398.2 570.628,1254.85 572.936,1553.19 575.244,1376.09 577.552,1373.84 579.86,1281.72 582.168,1489.36 584.476,1549.66 586.784,1230.86 589.092,1218.42 591.4,1587.16 593.708,1420.3 596.015,1317.23 598.323,1219.31 600.631,1359.24 602.939,1292.31 605.247,1320.28 607.555,1364.38 609.863,1475.19 612.171,1268.41 614.479,1437.47 616.787,1394.13 619.095,1247.87 621.402,1359.67 623.71,1311.79 626.018,1489.36 628.326,1540.5 630.634,1244.98 632.942,1282.51 635.25,1284.3 637.558,1523.17 639.866,1495.05 642.174,1341.45 644.482,1397.03 646.79,1409.46 649.097,1229.87 651.405,1363.88 653.713,1388.79 656.021,1499.38 658.329,1323.94 660.637,1342.17 662.945,1431.38 665.253,1356.32 667.561,1297.88 669.869,1477.83 672.177,1467.86 674.484,1321.06 676.792,1435.87 679.1,1391.62 681.408,1325.94 683.716,1624.34 686.024,1396.57 688.332,1333 690.64,1492.47 692.948,1285.81 695.256,1486.21 697.564,1525.06 699.871,1429.48 702.179,1346.11 704.487,1456.58 706.795,1328.99 709.103,1368.26 711.411,1340.54 713.719,1345.08 716.027,1361.19 718.335,1445.84 720.643,1349.36 722.951,1751.15 725.259,1379.32 727.566,1474.83 729.874,1401.31 732.182,1385.52 734.49,1149.35 736.798,1324.78 739.106,1379.19 741.414,1550.23 743.722,1391.34 746.03,1431.61 748.338,1273.77 750.646,1344.09 752.953,1247.43 755.261,1298.51 757.569,1417.88 759.877,1401.2 762.185,1267.78 764.493,1390.2 766.801,1543.7 769.109,1375.74 771.417,1386.02 773.725,1452.61 776.033,1274.03 778.34,1354.44 780.648,1388.58 782.956,1299.99 785.264,1371.61 787.572,1291.63 789.88,1291.75 792.188,1518.81 794.496,1450.27 796.804,1482.91 799.112,1314.18 801.42,1409.38 803.728,1383.71 806.035,1393.38 808.343,1523.92 810.651,1389.9 812.959,1528.22 815.267,1390.85 817.575,1395.13 819.883,1350.2 822.191,1359.02 824.499,1454.53 826.807,1453.65 829.115,1387.9 831.422,1447.91 833.73,1319.12 836.038,1426.1 838.346,1444.65 840.654,1552.51 842.962,1352.54 845.27,1389.49 847.578,1295.28 849.886,1286.06 852.194,1473.96 854.502,1229.66 856.809,1244.44 859.117,1499 861.425,1405.13 863.733,1386.59 866.041,1440.88 868.349,1275.52 870.657,1400.71 872.965,1304.73 875.273,1403.45 877.581,1283.39 879.889,1165.85 882.197,1370.51 884.504,1518.54 886.812,1341.22 889.12,1475.42 891.428,1624.41 893.736,1550.45 896.044,1408.91 898.352,1190.78 900.66,1443.69 902.968,1269.59 905.276,1284.23 907.584,1332.32 909.891,1390.93 912.199,1250.84 914.507,1325.97 916.815,1544.51 919.123,1361.15 921.431,1365.91 923.739,1307.36 926.047,1240.65 928.355,1283.87 930.663,1326.71 932.971,1401.2 935.278,1292.52 937.586,1345.73 939.894,1228.4 942.202,1232.01 944.51,1216.64 946.818,1354.07 949.126,1400.23 951.434,1418.43 953.742,1608.5 956.05,1295.17 958.358,1415.55 960.665,1311.81 962.973,1274.84 965.281,1196.34 967.589,1533.73 969.897,1414.78 972.205,1493.73 974.513,1407.09 976.821,1445.18 979.129,1361.66 981.437,1406.33 983.745,1390.34 986.053,1493.38 988.36,1572.26 990.668,1483.41 992.976,1475.88 995.284,1425.58 997.592,1392.22 999.9,1474.31 1002.21,1361.87 1004.52,1283.64 1006.82,1448.74 1009.13,1481.77 1011.44,1385.29 1013.75,1315.07 1016.06,1535.04 1018.36,1413.57 1020.67,1497.69 1022.98,1482.69 1025.29,1353.98 1027.59,1213.07 1029.9,1346.7 1032.21,1276.33 1034.52,1357.23 1036.83,1346.38 1039.13,1321.15 1041.44,1393.41 1043.75,1242.18 1046.06,1183.01 1048.37,1230.64 1050.67,1408.57 1052.98,1107.09 1055.29,1206.93 1057.6,1112.11 1059.91,1535.31 1062.21,1385.27 1064.52,1266.03 1066.83,1427.15 1069.14,1371.27 1071.45,1388.55 1073.75,1378.76 1076.06,1319.57 1078.37,1403.97 1080.68,1339.71 1082.98,1384.65 1085.29,1293.44 1087.6,1420.3 1089.91,1525.6 1092.22,1311.83 1094.52,1507.08 1096.83,1342.6 1099.14,1403.59 1101.45,1566.75 1103.76,1309.74 1106.06,1342.91 1108.37,1361.48 1110.68,1575.04 1112.99,1297.71 1115.3,1393.73 1117.6,1194.72 1119.91,1455.74 1122.22,1342.75 1124.53,1401.43 1126.84,1306.39 1129.14,1370.77 1131.45,1362.56 1133.76,1260.97 1136.07,1302.73 1138.37,1334.31 1140.68,1396.79 1142.99,1147.03 1145.3,1504.52 1147.61,1428.59 1149.91,1277.28 1152.22,1278.13 1154.53,1343.5 1156.84,1363.39 1159.15,1457.28 1161.45,1420.18 1163.76,1237.09 1166.07,1367.05 1168.38,1337.94 1170.69,1427.61 1172.99,1328.83 1175.3,1436.94 1177.61,1517.1 1179.92,1263 1182.23,1412.57 1184.53,1487.71 1186.84,1547.71 1189.15,1455.46 1191.46,1347.81 1193.76,1374.84 1196.07,1370.66 1198.38,1349.51 1200.69,1216.9 1203,1408.74 1205.3,1335.91 1207.61,1397.83 1209.92,1413.29 1212.23,1401.92 1214.54,1387.33 1216.84,1364.23 1219.15,1359.66 1221.46,1168.69 1223.77,1348.19 1226.08,1399.29 1228.38,1431.49 1230.69,1523.14 1233,1442.61 1235.31,1292.29 1237.61,1401.1 1239.92,1202.09 1242.23,1377.61 1244.54,1434.47 1246.85,1463.65 1249.15,1579.63 1251.46,1357.63 1253.77,1387.71 1256.08,1338.15 1258.39,1392.81 1260.69,1429.14 1263,1352.83 1265.31,1382.05 1267.62,1312.64 1269.93,1367.71 1272.23,1239.65 1274.54,1649.84 1276.85,1467.87 1279.16,1229.35 1281.47,1285.14 1283.77,1370.51 1286.08,1410.21 1288.39,1462.89 1290.7,1278.54 1293,1451.72 1295.31,1349.21 1297.62,1447.6 1299.93,1331.63 1302.24,1457.83 1304.54,1404 1306.85,1383.92 1309.16,1474.43 1311.47,1275.4 1313.78,1319.88 1316.08,1408.89 1318.39,1278.11 1320.7,1247.94 1323.01,1633.02 1325.32,1100.14 1327.62,1421.1 1329.93,1363.59 1332.24,1431.58 1334.55,1325.64 1336.86,1349.17 1339.16,1395.6 1341.47,1441.62 1343.78,1361.96 1346.09,1282.44 1348.39,1412.48 1350.7,1267.87 1353.01,1386.72 1355.32,1313.18 1357.63,1305.25 1359.93,1408.85 1362.24,1297.71 1364.55,1350.97 1366.86,1463.68 1369.17,1333.74 1371.47,1315.75 1373.78,1265.56 1376.09,1281.66 1378.4,1383.76 1380.71,1286.33 1383.01,1366.76 1385.32,1459.7 1387.63,1521.47 1389.94,1333.9 1392.24,1327.84 1394.55,1391.2 1396.86,1331.08 1399.17,1374.79 1401.48,1287.98 1403.78,1271.09 1406.09,1436.83 1408.4,1408.93 1410.71,1335.71 1413.02,1322.06 1415.32,1370.36 1417.63,1455.57 1419.94,1469 1422.25,1463.84 1424.56,1453.21 1426.86,1476.71 1429.17,1404.39 1431.48,1302.3 1433.79,1513.46 1436.1,1458.41 1438.4,1530.66 1440.71,1231.24 1443.02,1387.6 1445.33,1212.26 1447.63,1277.05 1449.94,1428.92 1452.25,1444.36 1454.56,1370.66 1456.87,1537.42 1459.17,1394.89 1461.48,1488.12 1463.79,1358.75 1466.1,1428.36 1468.41,1561.69 1470.71,1337.66 1473.02,1290.85 1475.33,1450.58 1477.64,1311.97 1479.95,1344.69 1482.25,1419.18 1484.56,1350.98 1486.87,1350.01 1489.18,1549.51 1491.49,1499.19 1493.79,1544.4 1496.1,1281.01 1498.41,1496.51 1500.72,1315.38 1503.02,1396.53 1505.33,1418.44 1507.64,1298.06 1509.95,1340.25 1512.26,1384.63 1514.56,1402.64 1516.87,1348.93 1519.18,1557.32 1521.49,1325.99 1523.8,1532.9 1526.1,1385.29 1528.41,1505.56 1530.72,1501.89 1533.03,1415.58 1535.34,1403.17 1537.64,1454.49 1539.95,1310.47 1542.26,1157.6 1544.57,1287.15 1546.88,1354.63 1549.18,1352.1 1551.49,1409.17 1553.8,1378.68 1556.11,1337.64 1558.41,1547.25 1560.72,1273.68 1563.03,1330.51 1565.34,1315.58 1567.65,1166.57 1569.95,1462.49 1572.26,1519.23 1574.57,1279.41 1576.88,1397.03 1579.19,1554.24 1581.49,1460.98 1583.8,1235.73 1586.11,1288.34 1588.42,1417.53 1590.73,1222.23 1593.03,1330.89 1595.34,1404.92 1597.65,1458.24 1599.96,1305.86 1602.26,1414.39 1604.57,1347.03 1606.88,1604.03 1609.19,1369.44 1611.5,1352.85 1613.8,1527.03 1616.11,1245.39 1618.42,1485.18 1620.73,1415.76 1623.04,1328.09 1625.34,1331.07 1627.65,1210.52 1629.96,1196.71 1632.27,1348.34 1634.58,1530.21 1636.88,1173.35 1639.19,1485.65 1641.5,1474.78 1643.81,1471.89 1646.12,1356.29 1648.42,1476.96 1650.73,1369.03 1653.04,1324.02 1655.35,1285.16 1657.65,1291.38 1659.96,1334.92 1662.27,1287.07 1664.58,1371.43 1666.89,1439.4 1669.19,1369.21 1671.5,1293.41 1673.81,1386.11 1676.12,1290.44 1678.43,1326.83 1680.73,1179.39 1683.04,1437.81 1685.35,1418.49 1687.66,1203.66 1689.97,1467.42 1692.27,1338.57 1694.58,1298.68 1696.89,1504.21 1699.2,1184.26 1701.51,1447.63 1703.81,1365.16 1706.12,1344.62 1708.43,1455.96 1710.74,1488.26 1713.04,1466.41 1715.35,1268.01 1717.66,1485.65 1719.97,1344.34 1722.28,1257.28 1724.58,1349.65 1726.89,1221.55 1729.2,1308 1731.51,1426.79 1733.82,1278.6 1736.12,1504.2 1738.43,1165.38 1740.74,1516.83 1743.05,1344.43 1745.36,1414.49 1747.66,1468.25 1749.97,1121.06 1752.28,1411.77 1754.59,1345.03 1756.9,1431.37 1759.2,1325.44 1761.51,1347.02 1763.82,1400.48 1766.13,1357.71 1768.43,1308.71 1770.74,1356.23 1773.05,1372.79 1775.36,1245.38 1777.67,1283.48 1779.97,1334.49 1782.28,1251.4 1784.59,1429.51 1786.9,1328.58 1789.21,1365.15 1791.51,1395.62 1793.82,1384.26 1796.13,1212.11 1798.44,1437.14 1800.75,1331.9 1803.05,1325.84 1805.36,1395.66 1807.67,1461.36 1809.98,1356.7 1812.28,1487.76 1814.59,1288.27 1816.9,1416.47 1819.21,1326.07 1821.52,1484.62 1823.82,1370.07 1826.13,1301.2 1828.44,1629.35 1830.75,1453.65 1833.06,1343.86 1835.36,1455.77 1837.67,1356.77 1839.98,1339.54 1842.29,1318.21 1844.6,1498.22 1846.9,1304.15 1849.21,1373.01 1851.52,1483.58 1853.83,1396.97 1856.14,1433.14 1858.44,1390.01 1860.75,1452.42 1863.06,1285.69 1865.37,1427.37 1867.67,1246.37 1869.98,1354.76 1872.29,1330.79 1874.6,1241.41 1876.91,1380.94 1879.21,1330.54 1881.52,1288.27 1883.83,1406.4 1886.14,1270.5 1888.45,1461.21 1890.75,1498.69 1893.06,1196.3 1895.37,1277.46 1897.68,1436.19 1899.99,1381.91 1902.29,1363.99 1904.6,1340.47 1906.91,1402.86 1909.22,1186.4 1911.53,1455.32 1913.83,1358.81 1916.14,1304.54 1918.45,1341.76 1920.76,1372.05 1923.06,1295.38 1925.37,1586.34 1927.68,1303.18 1929.99,1477.99 1932.3,1451 1934.6,1329.22 1936.91,1419.54 1939.22,1345.93 1941.53,1352.74 1943.84,1383.93 1946.14,1320.9 1948.45,1316.63 1950.76,1248.09 1953.07,1260.71 1955.38,1179.84 1957.68,1303.32 1959.99,1275.21 1962.3,1255.55 1964.61,1321.32 1966.91,1319.14 1969.22,1342.43 1971.53,1323.56 1973.84,1344.47 1976.15,1399.93 1978.45,1387.73 1980.76,1469.41 1983.07,1375.42 1985.38,1574.12 1987.69,1342.45 1989.99,1427.06 1992.3,1413.22 1994.61,1395.78 1996.92,1524.47 1999.23,1385.55 2001.53,1289.09 2003.84,1253.15 2006.15,1534.99 2008.46,1351.86 2010.77,1234.01 2013.07,1322.77 2015.38,1411.65 2017.69,1382.34 2020,1439.08 2022.3,1278.19 2024.61,1117.59 2026.92,1260.19 2029.23,1467.08 2031.54,1352.06 2033.84,1162.43 2036.15,1317.25 2038.46,1386.13 2040.77,1494.94 2043.08,1508.87 2045.38,1265.19 2047.69,1283.23 2050,1360.01 2052.31,1429.52 2054.62,1354.51 2056.92,1395.98 2059.23,1411.92 2061.54,1411.71 2063.85,1266.73 2066.16,1486.88 2068.46,1479.89 2070.77,1219.05 2073.08,1342.18 2075.39,1301.82 2077.69,1477.18 2080,1445.75 2082.31,1509.94 2084.62,1319.35 2086.93,1365.32 2089.23,1375.33 2091.54,1405.26 2093.85,1370.91 2096.16,1547.72 2098.47,1338.58 2100.77,1091.82 2103.08,1519.46 2105.39,1357.04 2107.7,1263.59 2110.01,1380.13 2112.31,1384.22 2114.62,1346.3 2116.93,1332.21 2119.24,1334.53 2121.55,1252.57 2123.85,1472.28 2126.16,1366.63 2128.47,1301.87 2130.78,1418.6 2133.08,1354.17 2135.39,1397.73 2137.7,1241.59 2140.01,1380.49 2142.32,1557.77 2144.62,1373.33 2146.93,1245.72 2149.24,1323.12 2151.55,1382.33 2153.86,1272.29 2156.16,1483.7 2158.47,1442.12 2160.78,1284.66 2163.09,1430.11 2165.4,1368.57 2167.7,1389.8 2170.01,1480.83 2172.32,1414.52 2174.63,1425.25 2176.93,1326.6 2179.24,1466.17 2181.55,1260.14 2183.86,1439.74 2186.17,1344.13 2188.47,1253.35 2190.78,1465.54 2193.09,1373.2 2195.4,1437.58 2197.71,1304.24 2200.01,1385.84 2202.32,1257.03 2204.63,1204.5 2206.94,1569.74 2209.25,1317.09 2211.55,1223.46 2213.86,1231.55 2216.17,1355.83 2218.48,1522.95 2220.79,1372.5 2223.09,1460 2225.4,1371.38 2227.71,1368.88 2230.02,1272.57 2232.32,1521.93 2234.63,1378.39 2236.94,1274.06 2239.25,1452.05 2241.56,1272.7 2243.86,1383.07 2246.17,1478.99 2248.48,1410.01 2250.79,1413.58 2253.1,1242.69 2255.4,1168.68 2257.71,1232.44 2260.02,1326.15 2262.33,1272.63 2264.64,1615.44 2266.94,1394.55 2269.25,1413.42 2271.56,1224.37 2273.87,1336.56 2276.18,1371.05 2278.48,1425.95 2280.79,1276.48 2283.1,1343.33 2285.41,1296.21 2287.71,1289.27 2290.02,1317.02 2292.33,1306.71 2294.64,1578.7 2296.95,1233.76 2299.25,1432.46 2301.56,1256.44 2303.87,1329.36 2306.18,1414.54 2308.49,1187.4 2310.79,1380.34 2313.1,1403.23 2315.41,1480.04 2317.72,1264.98 2320.03,1265.65 2322.33,1479.54 2324.64,1285.58 2326.95,1407.82 2329.26,1269.09 2331.56,1540.4 2333.87,1360.56 2336.18,1485.72 2338.49,1433.34 2340.8,1460.64 2343.1,1332.46 2345.41,1501.57 2347.72,1323.62 2350.03,1513.75 2352.34,1395.72 2354.64,1347.19 2356.95,1333.35 2359.26,1259.16 2361.57,1373.57 2363.88,1354.59 2366.18,1456.83 2368.49,1528.27 2370.8,1419.6 2373.11,1376.69 2375.42,1404.72 2377.72,1377.67 2380.03,1253.35 2382.34,1427.37 2384.65,1249.32 2386.95,1266.26 2389.26,1577.7 2391.57,1323.99 2393.88,1239.17 2396.19,1321.78 2398.49,1569.35 2400.8,1355.93 2403.11,1277.54 2405.42,1146.01 2407.73,1491.36 2410.03,1352.1 2412.34,1299.43 2414.65,1428.29 2416.96,1389.91 2419.27,1335.28 2421.57,1501.59 2423.88,1362.31 2426.19,1328.76 2428.5,1394.57 2430.81,1333.08 2433.11,1486.56 2435.42,1255.03 2437.73,1299.52 2440.04,1516.88 2442.34,1367.24 2444.65,1177.93 2446.96,1371.73 2449.27,1591.9 2451.58,1321.17 2453.88,1322.61 2456.19,1159.38 2458.5,1419.09 2460.81,1392.67 2463.12,1256.97 2465.42,1316.6 2467.73,1180.63 2470.04,1449.21 2472.35,1362.13 2474.66,1532.9 2476.96,1391.64 2479.27,1331.44 2481.58,1281.81 2483.89,1370.41 2486.2,1389.76 2488.5,1312.95 2490.81,1272.03 2493.12,1301.24 2495.43,1311.9 2497.73,1292.35 2500.04,1360.38 2502.35,1404.56 2504.66,1353.92 2506.97,1372.56 2509.27,1373.11 2511.58,1339.23 2513.89,1262.69 2516.2,1401.44 2518.51,1430.37 2520.81,1276.41 2523.12,1355.55 2525.43,1408.49 2527.74,1328.09 2530.05,1532.09 2532.35,1231.48 2534.66,1445.32 2536.97,1641.1 2539.28,1263.56 2541.58,1473.3 2543.89,1392.93 2546.2,1486.92 2548.51,1419.66 2550.82,1408.01 2553.12,1340.84 2555.43,1486.03 2557.74,1459.46 2560.05,1421.36 2562.36,1168.02 2564.66,1450.36 2566.97,1529.75 2569.28,1387.15 2571.59,1554.21 "></polyline>
<polyline clip-path="url(#clip362)" style="stroke:#e26f46; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="265.984,827.994 268.292,905.511 270.6,1027.81 272.908,965.884 275.216,766.183 277.524,921.133 279.832,911.128 282.139,756.328 284.447,1049.34 286.755,982.007 289.063,962.375 291.371,835.205 293.679,734.589 295.987,851.786 298.295,844.774 300.603,884.92 302.911,881.55 305.219,952.809 307.527,951.236 309.834,1002.28 312.142,855.827 314.45,845.017 316.758,955.061 319.066,986.509 321.374,914.106 323.682,666.787 325.99,828.065 328.298,785.333 330.606,962.048 332.914,819.358 335.221,824.854 337.529,821.928 339.837,1039.08 342.145,850.604 344.453,743.242 346.761,1004.49 349.069,788.988 351.377,983.274 353.685,767.794 355.993,756.832 358.301,909.89 360.608,949.426 362.916,866.398 365.224,778.343 367.532,895.645 369.84,924.251 372.148,867.456 374.456,920.095 376.764,1021.87 379.072,921.433 381.38,909.395 383.688,953.762 385.996,983.472 388.303,990.495 390.611,1029.82 392.919,889.999 395.227,1038.89 397.535,929.694 399.843,771.589 402.151,913.474 404.459,781.976 406.767,760.9 409.075,937.512 411.383,1073.3 413.69,996.481 415.998,896.01 418.306,800.015 420.614,713.059 422.922,913.038 425.23,848.681 427.538,941.97 429.846,687.699 432.154,847.807 434.462,750.076 436.77,864.381 439.077,846.811 441.385,826.628 443.693,932.79 446.001,847.697 448.309,851.916 450.617,913.508 452.925,738.941 455.233,970.978 457.541,762.342 459.849,798.909 462.157,731.53 464.465,1005.2 466.772,1005.39 469.08,755.611 471.388,743.27 473.696,863.244 476.004,911.933 478.312,962.552 480.62,917.427 482.928,882.702 485.236,934.925 487.544,942.713 489.852,969.758 492.159,997.648 494.467,1058.44 496.775,993.534 499.083,783.811 501.391,981.836 503.699,684.116 506.007,776.164 508.315,988.745 510.623,918.955 512.931,776.465 515.239,946.996 517.546,962.84 519.854,986.884 522.162,755.231 524.47,958.972 526.778,731.888 529.086,762.078 531.394,667.059 533.702,793.189 536.01,790.499 538.318,969.703 540.626,997.051 542.933,788.247 545.241,1044.31 547.549,884.586 549.857,949.468 552.165,874.161 554.473,996.34 556.781,963.881 559.089,908.6 561.397,943.741 563.705,744.073 566.013,719.363 568.321,911.275 570.628,1004.44 572.936,968.237 575.244,961.462 577.552,924.209 579.86,741.08 582.168,885.129 584.476,890.821 586.784,883.545 589.092,900.534 591.4,941.746 593.708,810.78 596.015,875.376 598.323,924.815 600.631,954.048 602.939,932.962 605.247,781.991 607.555,671.21 609.863,708.942 612.171,894.099 614.479,900.865 616.787,958.854 619.095,942.052 621.402,833.864 623.71,818.525 626.018,827.506 628.326,785.335 630.634,888.521 632.942,921.13 635.25,756.116 637.558,987.557 639.866,835.088 642.174,800.228 644.482,881.173 646.79,758.228 649.097,796.871 651.405,752.058 653.713,869.057 656.021,972.297 658.329,916.658 660.637,852.705 662.945,997.686 665.253,916.333 667.561,948.598 669.869,845.505 672.177,935.098 674.484,881.29 676.792,982.04 679.1,776.867 681.408,874.312 683.716,858.029 686.024,909.258 688.332,901.476 690.64,766.583 692.948,1055.14 695.256,773.98 697.564,922.125 699.871,924.787 702.179,894.149 704.487,687.233 706.795,773.127 709.103,1047.94 711.411,826.013 713.719,957.772 716.027,1035.37 718.335,1135.56 720.643,1046.19 722.951,728.026 725.259,839.182 727.566,870.341 729.874,785.655 732.182,943.607 734.49,1012.64 736.798,885.428 739.106,948.879 741.414,840.994 743.722,923.676 746.03,855.232 748.338,759.827 750.646,889.106 752.953,890.855 755.261,951.521 757.569,1025.11 759.877,931.932 762.185,825.278 764.493,961.733 766.801,924.093 769.109,980.464 771.417,819.025 773.725,811.651 776.033,889.648 778.34,826.896 780.648,784.811 782.956,878.03 785.264,935.016 787.572,1028.69 789.88,908.076 792.188,860.065 794.496,910.893 796.804,914.895 799.112,857.626 801.42,896.464 803.728,981.946 806.035,811.859 808.343,1015.19 810.651,894.57 812.959,840.359 815.267,1117.55 817.575,890.628 819.883,1031.15 822.191,981.589 824.499,906.458 826.807,1009.76 829.115,767.141 831.422,694.273 833.73,694.663 836.038,811.181 838.346,753.663 840.654,919.218 842.962,1084.09 845.27,833.374 847.578,842.605 849.886,822.928 852.194,921.885 854.502,788.562 856.809,1030.17 859.117,865.096 861.425,848.957 863.733,784.697 866.041,899.654 868.349,917.374 870.657,783.574 872.965,859.886 875.273,880.153 877.581,868.954 879.889,794.31 882.197,786.285 884.504,888.373 886.812,709.769 889.12,823.71 891.428,992.534 893.736,731.625 896.044,873.346 898.352,705.864 900.66,1048.37 902.968,906.579 905.276,936.046 907.584,930.866 909.891,825.288 912.199,898.012 914.507,953.395 916.815,789.911 919.123,760.46 921.431,971.114 923.739,859.12 926.047,914.888 928.355,974.954 930.663,678.867 932.971,916.867 935.278,882.27 937.586,710.608 939.894,1041.28 942.202,884.445 944.51,833.299 946.818,940.183 949.126,970.459 951.434,957.154 953.742,870.207 956.05,984.171 958.358,770.046 960.665,867.445 962.973,877.997 965.281,850.327 967.589,976.218 969.897,837.725 972.205,903.829 974.513,726.31 976.821,823.445 979.129,929.945 981.437,982.047 983.745,1041.7 986.053,1008.05 988.36,922.107 990.668,773.639 992.976,1138.26 995.284,988.081 997.592,878.104 999.9,844.359 1002.21,1043.4 1004.52,941.791 1006.82,745.816 1009.13,885.123 1011.44,746.82 1013.75,670.43 1016.06,746.584 1018.36,1097.78 1020.67,747.531 1022.98,902.949 1025.29,1008.38 1027.59,798.225 1029.9,936.855 1032.21,1065.77 1034.52,902.922 1036.83,881.18 1039.13,785.635 1041.44,922.669 1043.75,818.311 1046.06,814.907 1048.37,833.147 1050.67,773.953 1052.98,994.137 1055.29,869.926 1057.6,697.999 1059.91,750.767 1062.21,762.545 1064.52,780.728 1066.83,843.513 1069.14,871.554 1071.45,1046.92 1073.75,820.158 1076.06,802.62 1078.37,833.641 1080.68,1016.75 1082.98,990.804 1085.29,673.063 1087.6,1043.16 1089.91,858.997 1092.22,819.9 1094.52,831.509 1096.83,1037.04 1099.14,815.715 1101.45,867.364 1103.76,861.631 1106.06,730.641 1108.37,917.605 1110.68,1023.18 1112.99,889.863 1115.3,726.435 1117.6,872.923 1119.91,853.961 1122.22,850.23 1124.53,980.385 1126.84,851.965 1129.14,921.2 1131.45,749.504 1133.76,895.86 1136.07,763.567 1138.37,928.699 1140.68,870.759 1142.99,876.11 1145.3,847.68 1147.61,931.918 1149.91,1005.44 1152.22,710.067 1154.53,658.338 1156.84,849.107 1159.15,690.192 1161.45,880.414 1163.76,869.318 1166.07,1026.79 1168.38,781.534 1170.69,905.283 1172.99,908.474 1175.3,768.967 1177.61,892.13 1179.92,830.364 1182.23,886.626 1184.53,994.115 1186.84,719.41 1189.15,1050 1191.46,819.534 1193.76,877.519 1196.07,882.727 1198.38,933.851 1200.69,937.042 1203,997.167 1205.3,910.48 1207.61,975.349 1209.92,808.335 1212.23,844.08 1214.54,963.767 1216.84,880.191 1219.15,873.409 1221.46,899.193 1223.77,753.206 1226.08,769.279 1228.38,943.873 1230.69,1070.51 1233,882.422 1235.31,935.182 1237.61,825.608 1239.92,956.455 1242.23,789.039 1244.54,1002.43 1246.85,931.515 1249.15,796.941 1251.46,766.497 1253.77,918.317 1256.08,795.407 1258.39,814.008 1260.69,905.819 1263,982.152 1265.31,852.937 1267.62,785.642 1269.93,936.543 1272.23,978.547 1274.54,869.467 1276.85,993.47 1279.16,844.534 1281.47,771.377 1283.77,809.604 1286.08,733.629 1288.39,911.155 1290.7,891.327 1293,825.655 1295.31,913.757 1297.62,760.096 1299.93,957.672 1302.24,846.563 1304.54,1066.1 1306.85,1024.85 1309.16,874.697 1311.47,720.029 1313.78,822.236 1316.08,834.108 1318.39,670.493 1320.7,1093.99 1323.01,787.416 1325.32,758.835 1327.62,888.984 1329.93,743.99 1332.24,844.469 1334.55,897.291 1336.86,756.815 1339.16,837.693 1341.47,805.038 1343.78,961.263 1346.09,908.286 1348.39,914.369 1350.7,768.178 1353.01,868.543 1355.32,887.74 1357.63,1052.87 1359.93,742.2 1362.24,879.269 1364.55,836.313 1366.86,875.374 1369.17,853.357 1371.47,847.928 1373.78,743.948 1376.09,801.001 1378.4,734.92 1380.71,891.175 1383.01,968.276 1385.32,1083.48 1387.63,1148.62 1389.94,955.961 1392.24,704.022 1394.55,813.078 1396.86,823.108 1399.17,1107.8 1401.48,786.284 1403.78,709.708 1406.09,914.421 1408.4,848.597 1410.71,1027.93 1413.02,957.539 1415.32,849.718 1417.63,909.895 1419.94,755.495 1422.25,922.663 1424.56,889.391 1426.86,897.311 1429.17,948.754 1431.48,1002.44 1433.79,872.54 1436.1,893.369 1438.4,938.748 1440.71,838.125 1443.02,880.839 1445.33,1055.55 1447.63,778.91 1449.94,740.589 1452.25,864.073 1454.56,672.525 1456.87,831.917 1459.17,761.929 1461.48,922.821 1463.79,1038.76 1466.1,1053.65 1468.41,987.336 1470.71,950.058 1473.02,875.102 1475.33,871.443 1477.64,951.68 1479.95,779.389 1482.25,847.026 1484.56,996.702 1486.87,1017.14 1489.18,1006.41 1491.49,755.617 1493.79,876.18 1496.1,926.741 1498.41,787.935 1500.72,871.868 1503.02,1095.47 1505.33,854.23 1507.64,964.136 1509.95,1019.04 1512.26,862.726 1514.56,858.07 1516.87,762.34 1519.18,996.161 1521.49,997.795 1523.8,790.286 1526.1,878.245 1528.41,943.552 1530.72,961.232 1533.03,1015.93 1535.34,801.012 1537.64,1009.58 1539.95,923.987 1542.26,915.329 1544.57,846.168 1546.88,1070.83 1549.18,928.607 1551.49,888.625 1553.8,1003.44 1556.11,718.596 1558.41,1003.01 1560.72,792.687 1563.03,914.565 1565.34,840.314 1567.65,815.796 1569.95,828.821 1572.26,815.033 1574.57,1080.52 1576.88,899.33 1579.19,745.196 1581.49,805.447 1583.8,868.717 1586.11,909.362 1588.42,835.568 1590.73,933.812 1593.03,914.15 1595.34,817.129 1597.65,829.452 1599.96,867.183 1602.26,928.331 1604.57,675.646 1606.88,958.634 1609.19,776.4 1611.5,726.097 1613.8,974.48 1616.11,851.993 1618.42,954.595 1620.73,967.924 1623.04,1082.36 1625.34,1036.21 1627.65,1042.09 1629.96,1140.44 1632.27,867.87 1634.58,871.868 1636.88,947.064 1639.19,956.704 1641.5,809.997 1643.81,1024.65 1646.12,909.481 1648.42,729.748 1650.73,988.461 1653.04,765.888 1655.35,960.994 1657.65,839.861 1659.96,892.574 1662.27,793.228 1664.58,1031.62 1666.89,708.381 1669.19,794.298 1671.5,921.37 1673.81,1001.71 1676.12,815.61 1678.43,879.479 1680.73,912.302 1683.04,690.446 1685.35,730.644 1687.66,929.999 1689.97,1030.09 1692.27,618.485 1694.58,811.834 1696.89,777.536 1699.2,861.268 1701.51,1035.34 1703.81,856.426 1706.12,896.922 1708.43,876.161 1710.74,809.969 1713.04,770.748 1715.35,846.891 1717.66,932.772 1719.97,792.714 1722.28,1038.63 1724.58,955.529 1726.89,878.071 1729.2,793.342 1731.51,778.86 1733.82,881.417 1736.12,947.483 1738.43,905.949 1740.74,884.278 1743.05,1062.29 1745.36,930.545 1747.66,861.541 1749.97,1017.12 1752.28,1111.02 1754.59,767.002 1756.9,775.387 1759.2,810.657 1761.51,987.641 1763.82,788.811 1766.13,861.003 1768.43,837.293 1770.74,933.081 1773.05,886.826 1775.36,869.695 1777.67,803.4 1779.97,864.908 1782.28,954.344 1784.59,993.701 1786.9,820.141 1789.21,897.457 1791.51,1046.55 1793.82,911.383 1796.13,1075.08 1798.44,1096.74 1800.75,1018.43 1803.05,769.582 1805.36,1057.87 1807.67,892.848 1809.98,957.465 1812.28,882.444 1814.59,943.147 1816.9,782.829 1819.21,990.413 1821.52,946.193 1823.82,958.355 1826.13,939.785 1828.44,924.901 1830.75,885.254 1833.06,967.721 1835.36,994.809 1837.67,951.318 1839.98,908.173 1842.29,824.732 1844.6,742.637 1846.9,791.031 1849.21,877.905 1851.52,863.043 1853.83,868.775 1856.14,721.818 1858.44,980.502 1860.75,845.555 1863.06,862.679 1865.37,967.216 1867.67,896.444 1869.98,1018.88 1872.29,731.664 1874.6,859.415 1876.91,1006.69 1879.21,948.022 1881.52,923.376 1883.83,881.033 1886.14,766.657 1888.45,950.56 1890.75,845.03 1893.06,944.134 1895.37,822.39 1897.68,896.961 1899.99,901.874 1902.29,918.317 1904.6,843.802 1906.91,756.413 1909.22,1080.84 1911.53,949.255 1913.83,811.715 1916.14,837.653 1918.45,906.877 1920.76,819.327 1923.06,905.672 1925.37,765.156 1927.68,855.357 1929.99,970.087 1932.3,817.399 1934.6,771.994 1936.91,940.996 1939.22,876.604 1941.53,1021.97 1943.84,788.875 1946.14,978.464 1948.45,793.016 1950.76,843.293 1953.07,817.262 1955.38,807.252 1957.68,905.631 1959.99,998.009 1962.3,831.382 1964.61,1087.76 1966.91,971.208 1969.22,892.742 1971.53,770.916 1973.84,771.333 1976.15,794.083 1978.45,1027.47 1980.76,848.198 1983.07,815.347 1985.38,829.485 1987.69,907.962 1989.99,1017.84 1992.3,900.972 1994.61,884.754 1996.92,795.404 1999.23,941.816 2001.53,970.824 2003.84,712.415 2006.15,941.674 2008.46,829.061 2010.77,985.082 2013.07,773.684 2015.38,968.088 2017.69,871.541 2020,921.885 2022.3,1118.2 2024.61,751.957 2026.92,805.947 2029.23,973.367 2031.54,833.557 2033.84,935.175 2036.15,958.349 2038.46,701.104 2040.77,858.375 2043.08,923.172 2045.38,911.594 2047.69,855.669 2050,825.165 2052.31,780.963 2054.62,1001.57 2056.92,1051.39 2059.23,1065.5 2061.54,847.587 2063.85,857.602 2066.16,813.864 2068.46,862.614 2070.77,1066.83 2073.08,942.59 2075.39,949.355 2077.69,654.158 2080,1048.63 2082.31,834.129 2084.62,1013.27 2086.93,696.075 2089.23,1002.17 2091.54,763.621 2093.85,873.671 2096.16,985.485 2098.47,938.535 2100.77,832.457 2103.08,1030.68 2105.39,925 2107.7,1056.49 2110.01,898.85 2112.31,950.928 2114.62,787.361 2116.93,839.242 2119.24,1025.59 2121.55,921.065 2123.85,859.656 2126.16,925.24 2128.47,663.581 2130.78,982.92 2133.08,1064.81 2135.39,796.329 2137.7,848.036 2140.01,985.425 2142.32,764.281 2144.62,829.149 2146.93,967.642 2149.24,893.308 2151.55,1007.8 2153.86,876.693 2156.16,933.19 2158.47,950.852 2160.78,731.198 2163.09,884.39 2165.4,912.26 2167.7,858.711 2170.01,808.758 2172.32,859.168 2174.63,920.168 2176.93,1056.35 2179.24,940.914 2181.55,898.064 2183.86,897.272 2186.17,909.206 2188.47,862.393 2190.78,1061.18 2193.09,824.802 2195.4,810.644 2197.71,899.949 2200.01,827.934 2202.32,778.357 2204.63,987.241 2206.94,880.787 2209.25,887.886 2211.55,883.484 2213.86,981.917 2216.17,1001.29 2218.48,1027.67 2220.79,929.093 2223.09,1118.33 2225.4,861.235 2227.71,790.47 2230.02,954.083 2232.32,776.393 2234.63,864.485 2236.94,857.302 2239.25,1060.43 2241.56,746.487 2243.86,872.073 2246.17,711.139 2248.48,817.073 2250.79,881.67 2253.1,778.077 2255.4,977.923 2257.71,856.286 2260.02,958.311 2262.33,1020.62 2264.64,906.461 2266.94,944.324 2269.25,738.342 2271.56,915.816 2273.87,750.082 2276.18,837.567 2278.48,678.344 2280.79,861.386 2283.1,819.878 2285.41,1090 2287.71,860.641 2290.02,817.076 2292.33,837.959 2294.64,883.772 2296.95,605.77 2299.25,740.6 2301.56,1105.2 2303.87,927.231 2306.18,971.895 2308.49,739.992 2310.79,872.122 2313.1,999.095 2315.41,901.767 2317.72,903.364 2320.03,791.273 2322.33,785.878 2324.64,894.599 2326.95,814.363 2329.26,831.609 2331.56,891.138 2333.87,767.606 2336.18,802.988 2338.49,1096.92 2340.8,1062.72 2343.1,913.912 2345.41,887.553 2347.72,739.776 2350.03,904.951 2352.34,780.311 2354.64,1006.2 2356.95,884.614 2359.26,1039.19 2361.57,957.67 2363.88,760.285 2366.18,892.8 2368.49,894.889 2370.8,985.007 2373.11,966.747 2375.42,857.232 2377.72,703.489 2380.03,790.222 2382.34,886.895 2384.65,968.333 2386.95,979.313 2389.26,912.134 2391.57,682.35 2393.88,661.851 2396.19,910.349 2398.49,837.375 2400.8,952.403 2403.11,928.878 2405.42,893.828 2407.73,947.182 2410.03,898.671 2412.34,876.215 2414.65,873.628 2416.96,820.714 2419.27,893.873 2421.57,754.201 2423.88,949.42 2426.19,848.898 2428.5,818.149 2430.81,867.168 2433.11,874.22 2435.42,785.549 2437.73,1011.12 2440.04,752.815 2442.34,722.23 2444.65,828.076 2446.96,664.988 2449.27,746.982 2451.58,907.032 2453.88,861.528 2456.19,967.7 2458.5,926.384 2460.81,852.737 2463.12,748.318 2465.42,958.529 2467.73,1041.73 2470.04,822.105 2472.35,1016.48 2474.66,856.198 2476.96,849.689 2479.27,897.283 2481.58,986.113 2483.89,668.477 2486.2,892.446 2488.5,846.761 2490.81,712.996 2493.12,776.661 2495.43,950.41 2497.73,666.071 2500.04,1005.98 2502.35,908.437 2504.66,952.465 2506.97,815.751 2509.27,743.258 2511.58,788.221 2513.89,828.87 2516.2,870.684 2518.51,898.829 2520.81,769.054 2523.12,603.09 2525.43,906.032 2527.74,823.827 2530.05,829.037 2532.35,931.239 2534.66,927.817 2536.97,972.343 2539.28,960.528 2541.58,749.494 2543.89,682.602 2546.2,820.431 2548.51,1046.03 2550.82,952.78 2553.12,946.447 2555.43,880.664 2557.74,990.188 2560.05,958.797 2562.36,855 2564.66,859.528 2566.97,895.261 2569.28,940.674 2571.59,875.364 "></polyline>
<polyline clip-path="url(#clip362)" style="stroke:#3da44d; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="265.984,769.364 268.292,309.026 270.6,535.549 272.908,510.162 275.216,556.022 277.524,345.62 279.832,307.844 282.139,345.194 284.447,349.712 286.755,380.561 289.063,481.159 291.371,306.328 293.679,314.683 295.987,351.349 298.295,457.355 300.603,522.621 302.911,504.308 305.219,293.839 307.527,307.014 309.834,430.979 312.142,375.694 314.45,422.974 316.758,307.683 319.066,535.77 321.374,316.24 323.682,408.691 325.99,395.386 328.298,392.522 330.606,382.97 332.914,213.904 335.221,437.737 337.529,519.747 339.837,416.276 342.145,400.849 344.453,427.393 346.761,565.472 349.069,183.591 351.377,487.276 353.685,528.96 355.993,342.214 358.301,540.127 360.608,569.425 362.916,481.865 365.224,288.705 367.532,353.065 369.84,411.905 372.148,480.348 374.456,502.606 376.764,402.156 379.072,501.924 381.38,453.194 383.688,611.148 385.996,314.913 388.303,425.629 390.611,359.085 392.919,419.211 395.227,485.548 397.535,421.528 399.843,295.909 402.151,456.504 404.459,559.588 406.767,349.381 409.075,334.029 411.383,282.741 413.69,417.42 415.998,562.929 418.306,398.07 420.614,333.897 422.922,510.195 425.23,334.304 427.538,321.417 429.846,485.998 432.154,370.735 434.462,431.427 436.77,441.705 439.077,363.938 441.385,503.288 443.693,476.397 446.001,307.768 448.309,264.715 450.617,421.471 452.925,463.278 455.233,557.659 457.541,444.586 459.849,502.586 462.157,514.237 464.465,466.585 466.772,426.937 469.08,370.486 471.388,355.894 473.696,401.348 476.004,428.319 478.312,272.881 480.62,451.376 482.928,382.792 485.236,214.338 487.544,440.347 489.852,413.585 492.159,517.024 494.467,296.734 496.775,353.095 499.083,361.755 501.391,288.171 503.699,309.602 506.007,379.224 508.315,361.55 510.623,594.28 512.931,322.755 515.239,313.697 517.546,348.562 519.854,317.102 522.162,381.341 524.47,304.014 526.778,421.793 529.086,415.93 531.394,351.178 533.702,494.548 536.01,395.861 538.318,357.588 540.626,274.964 542.933,319.824 545.241,558.626 547.549,300.229 549.857,446.499 552.165,561.595 554.473,435.196 556.781,508.854 559.089,524.022 561.397,430.303 563.705,330.692 566.013,383.931 568.321,326.101 570.628,467.616 572.936,483.069 575.244,421.025 577.552,434.257 579.86,515.455 582.168,410.906 584.476,393.713 586.784,296.02 589.092,495.949 591.4,361.141 593.708,328.798 596.015,491.513 598.323,344.771 600.631,366.034 602.939,302.776 605.247,623.381 607.555,268.293 609.863,359.344 612.171,300.029 614.479,359.998 616.787,524.337 619.095,396.907 621.402,379.872 623.71,258.133 626.018,442.519 628.326,307.151 630.634,380.871 632.942,439.712 635.25,410.969 637.558,466.905 639.866,344.675 642.174,308.177 644.482,444.928 646.79,402.033 649.097,235.577 651.405,421.608 653.713,558.438 656.021,334.656 658.329,438.276 660.637,597.633 662.945,474.16 665.253,378.076 667.561,488.991 669.869,351.329 672.177,520.864 674.484,353.349 676.792,392.734 679.1,416.286 681.408,442.562 683.716,531.428 686.024,485.426 688.332,542.323 690.64,364.119 692.948,265.437 695.256,421.867 697.564,549.398 699.871,266.878 702.179,478.635 704.487,371.918 706.795,429.722 709.103,480.018 711.411,555.745 713.719,450.381 716.027,515.319 718.335,534.123 720.643,184.502 722.951,384.419 725.259,554.204 727.566,271.701 729.874,278.143 732.182,345.705 734.49,477.12 736.798,446.294 739.106,490.522 741.414,427.758 743.722,437.133 746.03,237.061 748.338,494.769 750.646,384.598 752.953,390.126 755.261,483.866 757.569,322.431 759.877,270.573 762.185,178.577 764.493,472.229 766.801,275.744 769.109,303.798 771.417,276.602 773.725,403.073 776.033,425.358 778.34,318.443 780.648,516.249 782.956,418.651 785.264,326.977 787.572,494.195 789.88,483.409 792.188,449.263 794.496,338.631 796.804,360.616 799.112,451.551 801.42,552.033 803.728,354.94 806.035,434.972 808.343,585.731 810.651,362.449 812.959,442.495 815.267,323.094 817.575,389.706 819.883,194.548 822.191,559.302 824.499,392.107 826.807,482.403 829.115,385.719 831.422,398.986 833.73,214.753 836.038,399.269 838.346,414.442 840.654,286.066 842.962,395.504 845.27,424.509 847.578,308.202 849.886,502.321 852.194,472.841 854.502,476.503 856.809,254.064 859.117,279.433 861.425,340.523 863.733,565.061 866.041,429.213 868.349,426.164 870.657,390.759 872.965,397.533 875.273,438.14 877.581,475.38 879.889,181.026 882.197,342.326 884.504,593.54 886.812,304.03 889.12,319.862 891.428,475.259 893.736,355.871 896.044,360.324 898.352,336.203 900.66,366.405 902.968,406.726 905.276,343.767 907.584,363.924 909.891,299.828 912.199,532.245 914.507,202.687 916.815,428.983 919.123,574.622 921.431,378.046 923.739,406.776 926.047,407.375 928.355,285.245 930.663,403.094 932.971,459.771 935.278,251.863 937.586,454.879 939.894,402.148 942.202,536.867 944.51,653.749 946.818,375.876 949.126,434.063 951.434,426.368 953.742,438.261 956.05,274.755 958.358,437.935 960.665,379.25 962.973,436.12 965.281,351.587 967.589,403.588 969.897,282.949 972.205,363.964 974.513,254.046 976.821,339.61 979.129,329.958 981.437,351.782 983.745,260.345 986.053,447.719 988.36,212.655 990.668,473.681 992.976,322.225 995.284,233.372 997.592,175.548 999.9,364.276 1002.21,342.825 1004.52,547.368 1006.82,399.038 1009.13,420.542 1011.44,165.805 1013.75,400.564 1016.06,441.685 1018.36,480.248 1020.67,310.295 1022.98,410.657 1025.29,584.225 1027.59,406.616 1029.9,350.149 1032.21,433.158 1034.52,291.917 1036.83,430.108 1039.13,489.185 1041.44,427.57 1043.75,223.141 1046.06,423.274 1048.37,411.103 1050.67,357.134 1052.98,258.722 1055.29,378.151 1057.6,377.324 1059.91,572.935 1062.21,414.315 1064.52,514.723 1066.83,502.458 1069.14,500.175 1071.45,479.868 1073.75,508.626 1076.06,436.721 1078.37,510.218 1080.68,447.546 1082.98,145.148 1085.29,456.149 1087.6,266.524 1089.91,592.443 1092.22,451.066 1094.52,307.153 1096.83,409.052 1099.14,343.885 1101.45,386.392 1103.76,436.889 1106.06,317.34 1108.37,530.852 1110.68,338.828 1112.99,535.852 1115.3,547.189 1117.6,647.361 1119.91,489.691 1122.22,370.683 1124.53,585.667 1126.84,362.205 1129.14,500.696 1131.45,379.81 1133.76,404.64 1136.07,531.295 1138.37,461.316 1140.68,253.336 1142.99,361.125 1145.3,216.056 1147.61,165.78 1149.91,484.476 1152.22,414.254 1154.53,482.862 1156.84,414.597 1159.15,307.073 1161.45,406.16 1163.76,213.689 1166.07,333.934 1168.38,394.071 1170.69,446.358 1172.99,299.985 1175.3,418.486 1177.61,333.653 1179.92,319.83 1182.23,521.827 1184.53,537.754 1186.84,422.496 1189.15,430.298 1191.46,476.964 1193.76,164.618 1196.07,311.427 1198.38,293.358 1200.69,515.051 1203,229.164 1205.3,546.394 1207.61,498.155 1209.92,433.954 1212.23,418.025 1214.54,323.941 1216.84,384.065 1219.15,504.116 1221.46,453.256 1223.77,311.934 1226.08,409.742 1228.38,268.169 1230.69,508.308 1233,545.556 1235.31,229.247 1237.61,421.779 1239.92,386.863 1242.23,434.622 1244.54,371.273 1246.85,566.43 1249.15,372.915 1251.46,359.3 1253.77,293.115 1256.08,442.345 1258.39,393.697 1260.69,536.769 1263,292.053 1265.31,393.546 1267.62,317.314 1269.93,479.478 1272.23,542.014 1274.54,304.508 1276.85,445.992 1279.16,282.533 1281.47,328.035 1283.77,425.255 1286.08,403.874 1288.39,226.49 1290.7,419.144 1293,459.656 1295.31,292.928 1297.62,399.866 1299.93,332.032 1302.24,529.155 1304.54,299.766 1306.85,436.705 1309.16,457.547 1311.47,206.429 1313.78,296.088 1316.08,227.495 1318.39,400.036 1320.7,374.898 1323.01,408.734 1325.32,330.891 1327.62,429.875 1329.93,505.348 1332.24,339.51 1334.55,376.324 1336.86,448.478 1339.16,441.143 1341.47,358.943 1343.78,359.865 1346.09,595.43 1348.39,446.058 1350.7,425.01 1353.01,551.377 1355.32,652.952 1357.63,338.192 1359.93,342.31 1362.24,490.557 1364.55,450.148 1366.86,473.594 1369.17,486.242 1371.47,524.731 1373.78,581.655 1376.09,498.565 1378.4,402.887 1380.71,386.332 1383.01,340.818 1385.32,338.464 1387.63,96.8724 1389.94,291.504 1392.24,424.213 1394.55,152.652 1396.86,343.86 1399.17,535.22 1401.48,394.556 1403.78,374.36 1406.09,279.166 1408.4,606.629 1410.71,464.144 1413.02,314.512 1415.32,580.778 1417.63,352.948 1419.94,506.784 1422.25,354.215 1424.56,302.406 1426.86,254.533 1429.17,476.261 1431.48,325.635 1433.79,453.977 1436.1,406.295 1438.4,500.798 1440.71,305.506 1443.02,335.617 1445.33,344.008 1447.63,554.241 1449.94,424.092 1452.25,456.615 1454.56,309.555 1456.87,415.8 1459.17,468.782 1461.48,237.857 1463.79,426.023 1466.1,265.965 1468.41,411.156 1470.71,466.613 1473.02,365.915 1475.33,269.652 1477.64,386.379 1479.95,495.997 1482.25,417.296 1484.56,290.572 1486.87,223.283 1489.18,518.123 1491.49,573.007 1493.79,480.7 1496.1,505.074 1498.41,435.682 1500.72,431.837 1503.02,440.559 1505.33,504.951 1507.64,362.086 1509.95,168.794 1512.26,507.055 1514.56,398.885 1516.87,430.059 1519.18,308.233 1521.49,486.241 1523.8,292.54 1526.1,446.703 1528.41,374.396 1530.72,459.955 1533.03,408.514 1535.34,394.044 1537.64,430.478 1539.95,404.164 1542.26,359.317 1544.57,531.998 1546.88,285.324 1549.18,481.423 1551.49,499.402 1553.8,432.885 1556.11,515.259 1558.41,387.349 1560.72,393.805 1563.03,490.378 1565.34,340.416 1567.65,392.373 1569.95,467.83 1572.26,406.396 1574.57,267.559 1576.88,322.836 1579.19,531.155 1581.49,544.161 1583.8,481.818 1586.11,371.163 1588.42,318.207 1590.73,558.096 1593.03,366.162 1595.34,444.014 1597.65,509.575 1599.96,260.401 1602.26,478.32 1604.57,606.808 1606.88,448.83 1609.19,425.036 1611.5,309.023 1613.8,391.704 1616.11,482.661 1618.42,533.622 1620.73,339.469 1623.04,322.622 1625.34,306.728 1627.65,345.005 1629.96,476.866 1632.27,331.447 1634.58,453.172 1636.88,585.182 1639.19,492.557 1641.5,420.566 1643.81,435.37 1646.12,485.862 1648.42,490.955 1650.73,441.787 1653.04,456.362 1655.35,349.808 1657.65,276.449 1659.96,448.709 1662.27,410.499 1664.58,259.003 1666.89,508.922 1669.19,283.648 1671.5,322.291 1673.81,453.067 1676.12,478.71 1678.43,322.947 1680.73,458.718 1683.04,368.416 1685.35,292.475 1687.66,363.134 1689.97,507.465 1692.27,295.73 1694.58,198.443 1696.89,437.09 1699.2,378.122 1701.51,453.472 1703.81,245.392 1706.12,397.671 1708.43,346.869 1710.74,351.428 1713.04,384.872 1715.35,370.352 1717.66,243.701 1719.97,319.619 1722.28,548.382 1724.58,488.077 1726.89,281.11 1729.2,378.352 1731.51,398.414 1733.82,374.098 1736.12,575.547 1738.43,539.092 1740.74,280.144 1743.05,258.009 1745.36,407.777 1747.66,287.818 1749.97,272.127 1752.28,354.248 1754.59,372.791 1756.9,510.486 1759.2,176.727 1761.51,368.999 1763.82,463.803 1766.13,396.222 1768.43,423.305 1770.74,386.11 1773.05,228.278 1775.36,558.691 1777.67,405.185 1779.97,395.443 1782.28,243.022 1784.59,540.596 1786.9,396.953 1789.21,227.378 1791.51,316.524 1793.82,406.281 1796.13,351.924 1798.44,340.939 1800.75,502.956 1803.05,245.329 1805.36,610.807 1807.67,325.833 1809.98,390.616 1812.28,297.626 1814.59,524.181 1816.9,341.576 1819.21,626.22 1821.52,265.612 1823.82,224.836 1826.13,328.865 1828.44,523.619 1830.75,483.363 1833.06,363.152 1835.36,181.221 1837.67,301.254 1839.98,317.016 1842.29,444.304 1844.6,211.96 1846.9,204.836 1849.21,495.918 1851.52,459.021 1853.83,454.318 1856.14,473.656 1858.44,506.681 1860.75,472.486 1863.06,601.3 1865.37,610.99 1867.67,466.443 1869.98,402.948 1872.29,452.378 1874.6,337.758 1876.91,328.991 1879.21,395.871 1881.52,358.094 1883.83,440.948 1886.14,388.345 1888.45,534.285 1890.75,421.511 1893.06,543.312 1895.37,501.864 1897.68,306.808 1899.99,279.634 1902.29,523.579 1904.6,437.178 1906.91,372.252 1909.22,444.605 1911.53,344.731 1913.83,351.465 1916.14,451.503 1918.45,329.593 1920.76,365.551 1923.06,528.263 1925.37,443.779 1927.68,279.847 1929.99,464.925 1932.3,299.268 1934.6,289.383 1936.91,343.08 1939.22,507.823 1941.53,340.095 1943.84,409.212 1946.14,439.541 1948.45,434.98 1950.76,380.191 1953.07,394.364 1955.38,483.805 1957.68,406.091 1959.99,508.874 1962.3,468.769 1964.61,574.363 1966.91,426.814 1969.22,488.49 1971.53,422.928 1973.84,367.899 1976.15,428.761 1978.45,380.531 1980.76,419.75 1983.07,399.09 1985.38,551.166 1987.69,227.68 1989.99,386.671 1992.3,349.876 1994.61,472.857 1996.92,499.32 1999.23,274.165 2001.53,249.914 2003.84,342.399 2006.15,394.546 2008.46,366.302 2010.77,301.74 2013.07,380.495 2015.38,394.008 2017.69,332.188 2020,246.478 2022.3,345.504 2024.61,512.377 2026.92,403.316 2029.23,471.794 2031.54,334.082 2033.84,270.75 2036.15,345.193 2038.46,400.675 2040.77,190.267 2043.08,236.407 2045.38,506.073 2047.69,305.279 2050,541.048 2052.31,368.825 2054.62,319.246 2056.92,344.283 2059.23,511.739 2061.54,651.936 2063.85,542.984 2066.16,253.538 2068.46,572.739 2070.77,324.099 2073.08,417.799 2075.39,526.097 2077.69,426.598 2080,445.755 2082.31,439.329 2084.62,268.3 2086.93,371.229 2089.23,302.462 2091.54,446.211 2093.85,308.483 2096.16,546.926 2098.47,586.302 2100.77,220.069 2103.08,193.975 2105.39,418.024 2107.7,314.224 2110.01,417.46 2112.31,488.523 2114.62,261.085 2116.93,437.869 2119.24,358.231 2121.55,380.962 2123.85,258.954 2126.16,493.52 2128.47,412.433 2130.78,551.681 2133.08,560.335 2135.39,495.344 2137.7,305.315 2140.01,637.947 2142.32,428.214 2144.62,366.717 2146.93,345.682 2149.24,356.096 2151.55,411.31 2153.86,442.911 2156.16,398.507 2158.47,445.098 2160.78,374.607 2163.09,163.133 2165.4,439.973 2167.7,193.6 2170.01,497.611 2172.32,382.524 2174.63,315.812 2176.93,227.72 2179.24,290.901 2181.55,379.578 2183.86,459.696 2186.17,282.132 2188.47,409.238 2190.78,406.426 2193.09,497.877 2195.4,220.631 2197.71,379.286 2200.01,339.99 2202.32,456.091 2204.63,304.863 2206.94,362.984 2209.25,399.722 2211.55,377.453 2213.86,420.225 2216.17,388.389 2218.48,321.277 2220.79,314.855 2223.09,530.615 2225.4,404.67 2227.71,532.436 2230.02,565.664 2232.32,356.316 2234.63,323.666 2236.94,157.776 2239.25,359.857 2241.56,422.574 2243.86,476.813 2246.17,464.553 2248.48,426.45 2250.79,377.242 2253.1,251.379 2255.4,526.246 2257.71,304.429 2260.02,434.656 2262.33,389.004 2264.64,350.876 2266.94,269.203 2269.25,178.646 2271.56,584.892 2273.87,421.299 2276.18,502.888 2278.48,452.804 2280.79,402.077 2283.1,409.557 2285.41,448.566 2287.71,412.904 2290.02,243.436 2292.33,347.691 2294.64,287.371 2296.95,440.904 2299.25,477.897 2301.56,364.44 2303.87,359.176 2306.18,255.454 2308.49,445.154 2310.79,448.987 2313.1,470.09 2315.41,447.123 2317.72,483.576 2320.03,505.884 2322.33,343.155 2324.64,462.165 2326.95,429.211 2329.26,338.536 2331.56,332.47 2333.87,405.042 2336.18,456.334 2338.49,387.458 2340.8,430.602 2343.1,333.245 2345.41,336.837 2347.72,275.69 2350.03,320.015 2352.34,271.483 2354.64,650.4 2356.95,599.102 2359.26,479.255 2361.57,434.083 2363.88,349.418 2366.18,442.175 2368.49,433.857 2370.8,301.325 2373.11,455.653 2375.42,387.068 2377.72,529.119 2380.03,335.608 2382.34,305.502 2384.65,429.427 2386.95,512.511 2389.26,325.787 2391.57,292.611 2393.88,328.473 2396.19,363.886 2398.49,377.905 2400.8,411.524 2403.11,440.156 2405.42,173.428 2407.73,292.498 2410.03,430.891 2412.34,415.649 2414.65,280.667 2416.96,442.289 2419.27,364.438 2421.57,388.567 2423.88,552.119 2426.19,608.952 2428.5,414.144 2430.81,400.702 2433.11,368.015 2435.42,531.703 2437.73,418.089 2440.04,561.858 2442.34,349.048 2444.65,428.394 2446.96,246.396 2449.27,340.912 2451.58,566.395 2453.88,371.487 2456.19,330.06 2458.5,484.899 2460.81,509.366 2463.12,459.391 2465.42,605.749 2467.73,409 2470.04,538.515 2472.35,438.03 2474.66,261.678 2476.96,438.899 2479.27,408.66 2481.58,374.142 2483.89,394.345 2486.2,631.647 2488.5,445.181 2490.81,497.22 2493.12,462.134 2495.43,524.304 2497.73,380.653 2500.04,382.837 2502.35,315.875 2504.66,394.935 2506.97,270.967 2509.27,373.002 2511.58,407.09 2513.89,345.153 2516.2,455.781 2518.51,492.271 2520.81,453.597 2523.12,366.198 2525.43,322.041 2527.74,532.651 2530.05,405.373 2532.35,322.081 2534.66,339.192 2536.97,471.711 2539.28,445.437 2541.58,393.264 2543.89,291.538 2546.2,550.432 2548.51,305.965 2550.82,360.393 2553.12,365.468 2555.43,390.129 2557.74,542.018 2560.05,244.054 2562.36,538.791 2564.66,425.013 2566.97,249.63 2569.28,526.13 2571.59,424.832 "></polyline>
</svg>
</div>
</div>
<p>Look at that! Things are working; amazin’.</p>
<p>We can also exploit <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>’s parallel sampling capabilities:</p>
<div id="34" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run separate 4 chains for 10 000 iterations using threads to parallelize.</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>num_chains <span class="op">=</span> <span class="fl">4</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    model_with_grad,</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">MCMCThreads</span>(),</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>,</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    num_chains;</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Note we need to provide an initial state for every chain.</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>    initial_state<span class="op">=</span><span class="fu">fill</span>(state, num_chains),</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>samples_array <span class="op">=</span> <span class="fu">stack</span>(<span class="fu">map</span>(<span class="bu">Base</span>.<span class="fu">Fix1</span>(stack, sample <span class="op">-&gt;</span> sample.x), samples))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000×4 Array{Float64, 3}:
[:, :, 1] =
 -2.81284   -4.55812  -5.8463   -4.85236  …  -5.25061   -5.30855   -3.8454
  0.552179  -1.5528   -2.35256  -1.71004     -0.453577  -0.551483  -1.26364
  0.216751   2.34326   2.96607   4.599        4.95652    5.36548    3.81572

[:, :, 2] =
 -2.98224  -5.19799  -3.40944   …  -3.86253    -5.46947   -5.46947
  1.69748   1.42258   0.858192     -0.0276717  -0.864653  -0.864653
  2.97454   4.07944   5.35467       5.14546     4.70463    4.70463

[:, :, 3] =
 -1.87737  -4.44874   -4.00339   -3.87161  …  -4.92517  -4.46877  -4.46877
  1.20283   0.178959   0.656243   1.23219     -1.18581  -0.99995  -0.99995
  3.51554   3.80117    3.70678    5.03471      5.2272    4.19875   4.19875

[:, :, 4] =
 -1.67499    -3.58862   -3.58408   …  -4.09076   -3.89631   -3.92872
  0.0892813  -0.791037  -0.435374     -0.774734  -0.405744   0.256427
  1.39159     3.20094    5.1763        2.52265    3.00679    4.08815</code></pre>
</div>
</div>
<p>But the fact that we have to provide the <code>AbstractMCMC.sample</code> call, etc. with an <code>initial_state</code> to get started is a bit annoying. We can avoid this by also defining a <code>AbstractMCMC.step</code> <em>without</em> the <code>state</code> argument:</p>
<div id="36" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">::</span><span class="dt">MALA</span>;</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># </span><span class="al">NOTE</span><span class="co">: No state provided!</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just create the initial state by sampling using  a Gaussian.</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="fu">randn</span>(rng, LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(x), <span class="fu">MALAState</span>(x)</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Equipped with this, we no longer need to provide the <code>initial_state</code> everywhere:</p>
<div id="38" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -5.0252      1.03155
 -0.00953361  0.991277
  4.97937     1.02112</code></pre>
</div>
</div>
</section>
<section id="using-our-sampler-with-turing.jl" class="level2">
<h2 class="anchored" data-anchor-id="using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</h2>
<p>As we promised, all of this hassle of implementing our <code>MALA</code> sampler in a way that uses <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> and <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> gets us something more than <em>just</em> an “automatic” implementation of <code>AbstractMCMC.sample</code>.</p>
<p>It also enables use with Turing.jl through the <code>externalsampler</code>, but we need to do one final thing first: we need to tell Turing.jl how to extract a vector of parameters from the “sample” returned in our implementation of <code>AbstractMCMC.step</code>. In our case, the “sample” is a <code>MALASample</code>, so we just need the following line:</p>
<div id="40" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load Turing.jl.</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Turing</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Overload the `getparams` method for our "sample" type, which is just a vector.</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>Turing.Inference.<span class="fu">getparams</span>(<span class="op">::</span><span class="dt">Turing.Model</span>, sample<span class="op">::</span><span class="dt">MALASample</span>) <span class="op">=</span> sample.x</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And with that, we’re good to go!</p>
<div id="42" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Our previous model defined as a Turing.jl model.</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">mvnormal_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">MvNormal</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.], I)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate our model.</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">mvnormal_model</span>()</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Call `sample` but now we're passing in a Turing.jl `model` and wrapping</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co"># our `MALA` sampler in the `externalsampler` to tell Turing.jl that the sampler</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co"># expects something that implements LogDensityProblems.jl.</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×4×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 2.92 seconds
Compute duration  = 2.92 seconds
parameters        = x[1], x[2], x[3]
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters  </span><span class="ansi-bold">    mean  </span><span class="ansi-bold">     std  </span><span class="ansi-bold">    mcse  </span><span class="ansi-bold">  ess_bulk  </span><span class="ansi-bold">  ess_tail  </span><span class="ansi-bold">    rhat  </span><span class="ansi-bold"> ⋯
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">   Float64  </span><span class="ansi-bright-black-fg ansi-bold">   Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> ⋯

        x[1]   -4.9915    0.9966    0.0179   3086.8662   5018.2789    1.0002   ⋯
        x[2]    0.0394    1.0090    0.0180   3140.3849   4853.1880    1.0005   ⋯
        x[3]    5.0012    1.0104    0.0181   3125.8049   5424.5254    1.0000   ⋯
</span><span class="ansi-cyan-fg ansi-bold">                                                                1 column omitted

Quantiles
 </span><span class="ansi-cyan-fg ansi-bold"> parameters  </span><span class="ansi-cyan-fg ansi-bold">    2.5%  </span><span class="ansi-cyan-fg ansi-bold">   25.0%  </span><span class="ansi-cyan-fg ansi-bold">   50.0%  </span><span class="ansi-cyan-fg ansi-bold">   75.0%  </span><span class="ansi-cyan-fg ansi-bold">   97.5%
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64

        x[1]   -6.9447   -5.6578   -4.9878   -4.3385   -3.0390
        x[2]   -1.9693   -0.6301    0.0521    0.7246    2.0016
        x[3]    3.0009    4.3270    5.0052    5.6704    7.0022
</span></pre>
</div>
</div>
</div>
<p>Pretty neat, eh?</p>
<section id="models-with-constrained-parameters" class="level3">
<h3 class="anchored" data-anchor-id="models-with-constrained-parameters">Models with constrained parameters</h3>
<p>One thing we’ve sort of glossed over in all of the above is that MALA, at least how we’ve implemented it, requires <span class="math inline">\(x\)</span> to live in <span class="math inline">\(\mathbb{R}^d\)</span> for some <span class="math inline">\(d &gt; 0\)</span>. If some of the parameters were in fact constrained, e.g.&nbsp;we were working with a <code>Beta</code> distribution which has support on the interval <span class="math inline">\((0, 1)\)</span>, <em>not</em> on <span class="math inline">\(\mathbb{R}^d\)</span>, we could easily end up outside of the valid range <span class="math inline">\((0, 1)\)</span>.</p>
<div id="44" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">beta_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">beta_model</span>()</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 1.88 seconds
Compute duration  = 1.88 seconds
parameters        = x
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters  </span><span class="ansi-bold">    mean  </span><span class="ansi-bold">     std  </span><span class="ansi-bold">    mcse  </span><span class="ansi-bold">  ess_bulk  </span><span class="ansi-bold">  ess_tail  </span><span class="ansi-bold">    rhat  </span><span class="ansi-bold"> ⋯
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">   Float64  </span><span class="ansi-bright-black-fg ansi-bold">   Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> ⋯

           x    0.5036    0.1888    0.0028   4486.0520   5917.1464    1.0001   ⋯
</span><span class="ansi-cyan-fg ansi-bold">                                                                1 column omitted

Quantiles
 </span><span class="ansi-cyan-fg ansi-bold"> parameters  </span><span class="ansi-cyan-fg ansi-bold">    2.5%  </span><span class="ansi-cyan-fg ansi-bold">   25.0%  </span><span class="ansi-cyan-fg ansi-bold">   50.0%  </span><span class="ansi-cyan-fg ansi-bold">   75.0%  </span><span class="ansi-cyan-fg ansi-bold">   97.5%
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64

           x    0.1472    0.3613    0.5029    0.6454    0.8582
</span></pre>
</div>
</div>
</div>
<p>Yep, that still works, but only because Turing.jl actually <em>transforms</em> the <code>turing_model</code> from constrained to unconstrained, so that the <code>sampler</code> provided to <code>externalsampler</code> is actually always working in unconstrained space! This is not always desirable, so we can turn this off:</p>
<div id="46" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 0.17 seconds
Compute duration  = 0.17 seconds
parameters        = x
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters  </span><span class="ansi-bold">    mean  </span><span class="ansi-bold">     std  </span><span class="ansi-bold">    mcse  </span><span class="ansi-bold"> ess_bulk  </span><span class="ansi-bold"> ess_tail  </span><span class="ansi-bold">    rhat  </span><span class="ansi-bold"> e ⋯
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">  Float64  </span><span class="ansi-bright-black-fg ansi-bold">  Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">   ⋯

           x    0.0808    0.0000    0.0000        NaN        NaN       NaN     ⋯
</span><span class="ansi-cyan-fg ansi-bold">                                                                1 column omitted

Quantiles
 </span><span class="ansi-cyan-fg ansi-bold"> parameters  </span><span class="ansi-cyan-fg ansi-bold">    2.5%  </span><span class="ansi-cyan-fg ansi-bold">   25.0%  </span><span class="ansi-cyan-fg ansi-bold">   50.0%  </span><span class="ansi-cyan-fg ansi-bold">   75.0%  </span><span class="ansi-cyan-fg ansi-bold">   97.5%
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64

           x    0.0808    0.0808    0.0808    0.0808    0.0808
</span></pre>
</div>
</div>
</div>
<p>The fun thing is that this still sort of works because</p>
<div id="48" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">logpdf</span>(<span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>), <span class="fl">10.0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-Inf</code></pre>
</div>
</div>
<p>and so the samples that fall outside of the range are always rejected. But do notice how much worse all the diagnostics are, e.g.&nbsp;<code>ess_tail</code> is very poor compared to when we use <code>unconstrained=true</code>. Moreover, in more complex cases this won’t just result in a “nice” <code>-Inf</code> log-density value, but instead will error:</p>
<div id="50" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="kw">function</span> <span class="fu">demo</span>()</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>    σ² <span class="op">~</span> <span class="fu">truncated</span>(<span class="fu">Normal</span>(), lower<span class="op">=</span><span class="fl">0</span>)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If we end up with negative values for `σ²`, the `Normal` will error.</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>    x <span class="op">~</span> <span class="fu">Normal</span>(<span class="fl">0</span>, σ²)</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre>DomainError with Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}}(-0.9238768265979422,1.0,0.0):
Normal: the condition σ &gt;= zero(σ) is not satisfied.
Stacktrace:
  [1] <span class="ansi-bold">#371</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/YQSrn/src/univariate/continuous/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">normal.jl:37</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [2] <span class="ansi-bold">check_args</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/YQSrn/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">utils.jl:89</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [3] <span class="ansi-bold">#Normal#370</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/YQSrn/src/univariate/continuous/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">normal.jl:37</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [4] <span class="ansi-bold">Normal</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/YQSrn/src/univariate/continuous/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">normal.jl:36</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [5] <span class="ansi-bold">Normal</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/YQSrn/src/univariate/continuous/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">normal.jl:42</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [6] <span class="ansi-bold">macro expansion</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/tXLAI/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">compiler.jl:558</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [7] <span class="ansi-bold">demo</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">__model__</span>::DynamicPPL.Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}</span>, <span class="ansi-bright-black-fg">__varinfo__</span>::DynamicPPL.ThreadSafeVarInfo<span class="ansi-bright-black-fg">{DynamicPPL.VarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}, ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}, Vector{Base.RefValue{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}</span>, <span class="ansi-bright-black-fg">__context__</span>::DynamicPPL.DefaultContext<span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-magenta-fg">Main.Notebook</span> <span class="ansi-bright-black-fg">~/work/docs/docs/developers/inference/implementing-samplers/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">index.qmd:457</span>
  [8] <span class="ansi-bold">_evaluate!!</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/tXLAI/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">model.jl:913</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [9] <span class="ansi-bold">evaluate_threadsafe!!</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">model</span>::DynamicPPL.Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}</span>, <span class="ansi-bright-black-fg">varinfo</span>::DynamicPPL.VarInfo<span class="ansi-bright-black-fg">{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}, ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}</span>, <span class="ansi-bright-black-fg">context</span>::DynamicPPL.DefaultContext<span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-cyan-fg">DynamicPPL</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/tXLAI/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">model.jl:902</span>
 [10] <span class="ansi-bold">evaluate!!</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/tXLAI/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">model.jl:832</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [11] <span class="ansi-bold">logdensity_at</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/tXLAI/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">logdensityfunction.jl:183</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [12] <span class="ansi-bold">FixTail</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DifferentiationInterface/zJHX8/src/utils/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">context.jl:169</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [13] <span class="ansi-bold">vector_mode_dual_eval!</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">f</span>::DifferentiationInterface.FixTail<span class="ansi-bright-black-fg">{typeof(DynamicPPL.logdensity_at), Tuple{DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, DynamicPPL.VarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}, DynamicPPL.DefaultContext}}</span>, <span class="ansi-bright-black-fg">cfg</span>::ForwardDiff.GradientConfig<span class="ansi-bright-black-fg">{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}</span>, <span class="ansi-bright-black-fg">x</span>::Vector<span class="ansi-bright-black-fg">{Float64}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-green-fg">ForwardDiff</span> <span class="ansi-bright-black-fg">~/.julia/packages/ForwardDiff/UBbGT/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">apiutils.jl:24</span>
 [14] <span class="ansi-bold">vector_mode_gradient!</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/ForwardDiff/UBbGT/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">gradient.jl:98</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [15] <span class="ansi-bold">gradient!</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">result</span>::DiffResults.MutableDiffResult<span class="ansi-bright-black-fg">{1, Float64, Tuple{Vector{Float64}}}</span>, <span class="ansi-bright-black-fg">f</span>::DifferentiationInterface.FixTail<span class="ansi-bright-black-fg">{typeof(DynamicPPL.logdensity_at), Tuple{DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, DynamicPPL.VarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}, DynamicPPL.DefaultContext}}</span>, <span class="ansi-bright-black-fg">x</span>::Vector<span class="ansi-bright-black-fg">{Float64}</span>, <span class="ansi-bright-black-fg">cfg</span>::ForwardDiff.GradientConfig<span class="ansi-bright-black-fg">{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}</span>, ::Val<span class="ansi-bright-black-fg">{false}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-green-fg">ForwardDiff</span> <span class="ansi-bright-black-fg">~/.julia/packages/ForwardDiff/UBbGT/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">gradient.jl:39</span>
 [16] <span class="ansi-bold">value_and_gradient</span><span class="ansi-bold">(</span>::typeof(DynamicPPL.logdensity_at), ::DifferentiationInterfaceForwardDiffExt.ForwardDiffGradientPrep<span class="ansi-bright-black-fg">{Nothing, ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}, Tuple{Nothing, Nothing, Nothing}}</span>, ::AutoForwardDiff<span class="ansi-bright-black-fg">{2, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}}</span>, ::Vector<span class="ansi-bright-black-fg">{Float64}</span>, ::DifferentiationInterface.Constant<span class="ansi-bright-black-fg">{DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}}</span>, ::DifferentiationInterface.Constant<span class="ansi-bright-black-fg">{DynamicPPL.VarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}}</span>, ::DifferentiationInterface.Constant<span class="ansi-bright-black-fg">{DynamicPPL.DefaultContext}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-yellow-fg">DifferentiationInterfaceForwardDiffExt</span> <span class="ansi-bright-black-fg">~/.julia/packages/DifferentiationInterface/zJHX8/ext/DifferentiationInterfaceForwardDiffExt/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">onearg.jl:417</span>
 [17] <span class="ansi-bold">logdensity_and_gradient</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">f</span>::LogDensityFunction<span class="ansi-bright-black-fg">{DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, DynamicPPL.VarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}, DynamicPPL.DefaultContext, AutoForwardDiff{2, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}}}</span>, <span class="ansi-bright-black-fg">x</span>::Vector<span class="ansi-bright-black-fg">{Float64}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-cyan-fg">DynamicPPL</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/tXLAI/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">logdensityfunction.jl:234</span>
 [18] <span class="ansi-bold">leapfrog_step</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">model</span>::LogDensityFunction<span class="ansi-bright-black-fg">{DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, DynamicPPL.VarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}, DynamicPPL.DefaultContext, AutoForwardDiff{2, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}}}</span>, <span class="ansi-bright-black-fg">x</span>::Vector<span class="ansi-bright-black-fg">{Float64}</span>, <span class="ansi-bright-black-fg">p</span>::Vector<span class="ansi-bright-black-fg">{Float64}</span>, <span class="ansi-bright-black-fg">ϵ</span>::Int64, <span class="ansi-bright-black-fg">M</span>::UniformScaling<span class="ansi-bright-black-fg">{Bool}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-magenta-fg">Main.Notebook</span> <span class="ansi-bright-black-fg">~/work/docs/docs/developers/inference/implementing-samplers/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">index.qmd:305</span>
 [19] <span class="ansi-bold">step</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">rng</span>::TaskLocalRNG, <span class="ansi-bright-black-fg">model_wrapper</span>::AbstractMCMC.LogDensityModel<span class="ansi-bright-black-fg">{LogDensityFunction{DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, DynamicPPL.VarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}, DynamicPPL.DefaultContext, AutoForwardDiff{2, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}}}}</span>, <span class="ansi-bright-black-fg">sampler</span>::MALA<span class="ansi-bright-black-fg">{Int64, UniformScaling{Bool}}</span>, <span class="ansi-bright-black-fg">state</span>::MALAState<span class="ansi-bright-black-fg">{Vector{Float64}}</span>; <span class="ansi-bright-black-fg">kwargs</span>::@Kwargs<span class="ansi-bright-black-fg">{}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-magenta-fg">Main.Notebook</span> <span class="ansi-bright-black-fg">~/work/docs/docs/developers/inference/implementing-samplers/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">index.qmd:276</span>
 [20] <span class="ansi-bold">step</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">rng</span>::TaskLocalRNG, <span class="ansi-bright-black-fg">model_wrapper</span>::AbstractMCMC.LogDensityModel<span class="ansi-bright-black-fg">{LogDensityFunction{DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, DynamicPPL.VarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}, DynamicPPL.DefaultContext, AutoForwardDiff{2, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}}}}</span>, <span class="ansi-bright-black-fg">sampler</span>::MALA<span class="ansi-bright-black-fg">{Int64, UniformScaling{Bool}}</span>, <span class="ansi-bright-black-fg">state</span>::MALAState<span class="ansi-bright-black-fg">{Vector{Float64}}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-magenta-fg">Main.Notebook</span> <span class="ansi-bright-black-fg">~/work/docs/docs/developers/inference/implementing-samplers/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">index.qmd:258</span>
 [21] <span class="ansi-bold">step</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">rng</span>::TaskLocalRNG, <span class="ansi-bright-black-fg">model</span>::DynamicPPL.Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}</span>, <span class="ansi-bright-black-fg">sampler_wrapper</span>::DynamicPPL.Sampler<span class="ansi-bright-black-fg">{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}</span>, <span class="ansi-bright-black-fg">state</span>::Turing.Inference.TuringState<span class="ansi-bright-black-fg">{MALAState{Vector{Float64}}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, DynamicPPL.VarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}, DynamicPPL.DefaultContext}</span>; <span class="ansi-bright-black-fg">kwargs</span>::@Kwargs<span class="ansi-bright-black-fg">{}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-magenta-fg">Turing.Inference</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/9ylz5/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">abstractmcmc.jl:91</span>
 [22] <span class="ansi-bold">step</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">rng</span>::TaskLocalRNG, <span class="ansi-bright-black-fg">model</span>::DynamicPPL.Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}</span>, <span class="ansi-bright-black-fg">sampler_wrapper</span>::DynamicPPL.Sampler<span class="ansi-bright-black-fg">{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}</span>, <span class="ansi-bright-black-fg">state</span>::Turing.Inference.TuringState<span class="ansi-bright-black-fg">{MALAState{Vector{Float64}}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, DynamicPPL.VarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}, DynamicPPL.DefaultContext}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-magenta-fg">Turing.Inference</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/9ylz5/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">abstractmcmc.jl:80</span>
 [23] <span class="ansi-bold">macro expansion</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/AbstractMCMC/kwj9g/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">sample.jl:219</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [24] <span class="ansi-bold">macro expansion</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/AbstractMCMC/kwj9g/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">logging.jl:16</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [25] <span class="ansi-bold">mcmcsample</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">rng</span>::TaskLocalRNG, <span class="ansi-bright-black-fg">model</span>::DynamicPPL.Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}</span>, <span class="ansi-bright-black-fg">sampler</span>::DynamicPPL.Sampler<span class="ansi-bright-black-fg">{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}</span>, <span class="ansi-bright-black-fg">N</span>::Int64; <span class="ansi-bright-black-fg">progress</span>::Bool, <span class="ansi-bright-black-fg">progressname</span>::String, <span class="ansi-bright-black-fg">callback</span>::Nothing, <span class="ansi-bright-black-fg">num_warmup</span>::Int64, <span class="ansi-bright-black-fg">discard_initial</span>::Int64, <span class="ansi-bright-black-fg">thinning</span>::Int64, <span class="ansi-bright-black-fg">chain_type</span>::Type, <span class="ansi-bright-black-fg">initial_state</span>::Nothing, <span class="ansi-bright-black-fg">kwargs</span>::@Kwargs<span class="ansi-bright-black-fg">{}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-cyan-fg">AbstractMCMC</span> <span class="ansi-bright-black-fg">~/.julia/packages/AbstractMCMC/kwj9g/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">sample.jl:144</span>
 [26] <span class="ansi-bold">sample</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">rng</span>::TaskLocalRNG, <span class="ansi-bright-black-fg">model</span>::DynamicPPL.Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}</span>, <span class="ansi-bright-black-fg">sampler</span>::DynamicPPL.Sampler<span class="ansi-bright-black-fg">{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}</span>, <span class="ansi-bright-black-fg">N</span>::Int64; <span class="ansi-bright-black-fg">chain_type</span>::Type, <span class="ansi-bright-black-fg">resume_from</span>::Nothing, <span class="ansi-bright-black-fg">initial_state</span>::Nothing, <span class="ansi-bright-black-fg">kwargs</span>::@Kwargs<span class="ansi-bright-black-fg">{progress::Bool}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-cyan-fg">DynamicPPL</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/tXLAI/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">sampler.jl:102</span>
 [27] <span class="ansi-bold">sample</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/tXLAI/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">sampler.jl:92</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [28] <span class="ansi-bold">#sample#8</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/9ylz5/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">Inference.jl:277</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [29] <span class="ansi-bold">sample</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/9ylz5/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">Inference.jl:268</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [30] <span class="ansi-bold">#sample#7</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/9ylz5/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">Inference.jl:265</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [31] top-level scope
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/work/docs/docs/developers/inference/implementing-samplers/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">index.qmd:459</span></pre>
</div>
</div>
</div>
<p>As expected, we run into a <code>DomainError</code> at some point, while if we set <code>unconstrained=true</code>, letting Turing.jl transform the model to a unconstrained form behind the scenes, everything works as expected:</p>
<div id="52" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 0.6 seconds
Compute duration  = 0.6 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters  </span><span class="ansi-bold">    mean  </span><span class="ansi-bold">     std  </span><span class="ansi-bold">    mcse  </span><span class="ansi-bold"> ess_bulk  </span><span class="ansi-bold"> ess_tail  </span><span class="ansi-bold">    rhat  </span><span class="ansi-bold"> e ⋯
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">  Float64  </span><span class="ansi-bright-black-fg ansi-bold">  Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">   ⋯

          σ²    0.9091    0.5937    0.0302   408.7265   213.0883    1.0032     ⋯
           x    0.0991    1.2062    0.1035   221.7386   119.5326    1.0190     ⋯
</span><span class="ansi-cyan-fg ansi-bold">                                                                1 column omitted

Quantiles
 </span><span class="ansi-cyan-fg ansi-bold"> parameters  </span><span class="ansi-cyan-fg ansi-bold">    2.5%  </span><span class="ansi-cyan-fg ansi-bold">   25.0%  </span><span class="ansi-cyan-fg ansi-bold">   50.0%  </span><span class="ansi-cyan-fg ansi-bold">   75.0%  </span><span class="ansi-cyan-fg ansi-bold">   97.5%
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64

          σ²    0.1398    0.4396    0.7841    1.2809    2.3279
           x   -2.2263   -0.4038    0.0284    0.5050    3.0710
</span></pre>
</div>
</div>
</div>
<p>Neat!</p>
<p>Similarly, which automatic differentiation backend one should use can be specified through the <code>adtype</code> keyword argument too. For example, if we want to use <a href="https://github.com/JuliaDiff/ReverseDiff.jl">ReverseDiff.jl</a> instead of the default <a href="https://github.com/JuliaDiff/ForwardDiff.jl">ForwardDiff.jl</a>:</p>
<div id="54" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">ReverseDiff</span>: ReverseDiff</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify that we want to use `AutoReverseDiff`.</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">demo</span>(),</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>, adtype<span class="op">=</span><span class="fu">AutoReverseDiff</span>()),</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>;</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 2.75 seconds
Compute duration  = 2.75 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters  </span><span class="ansi-bold">    mean  </span><span class="ansi-bold">     std  </span><span class="ansi-bold">    mcse  </span><span class="ansi-bold"> ess_bulk  </span><span class="ansi-bold"> ess_tail  </span><span class="ansi-bold">    rhat  </span><span class="ansi-bold"> e ⋯
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">  Float64  </span><span class="ansi-bright-black-fg ansi-bold">  Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">   ⋯

          σ²    0.8789    0.5549    0.0210   565.1966   262.1841    1.0029     ⋯
           x   -0.0923    1.0000    0.0838   209.1411    63.1821    1.0053     ⋯
</span><span class="ansi-cyan-fg ansi-bold">                                                                1 column omitted

Quantiles
 </span><span class="ansi-cyan-fg ansi-bold"> parameters  </span><span class="ansi-cyan-fg ansi-bold">    2.5%  </span><span class="ansi-cyan-fg ansi-bold">   25.0%  </span><span class="ansi-cyan-fg ansi-bold">   50.0%  </span><span class="ansi-cyan-fg ansi-bold">   75.0%  </span><span class="ansi-cyan-fg ansi-bold">   97.5%
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64

          σ²    0.1570    0.4240    0.7845    1.2158    2.2091
           x   -2.4793   -0.4976   -0.0370    0.3830    2.0394
</span></pre>
</div>
</div>
</div>
<p>Double-neat.</p>
</section>
</section>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<p>At this point it’s worth maybe reminding ourselves what we did and also <em>why</em> we did it:</p>
<ol type="1">
<li>We define our models in the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface because it makes the sampler agnostic to how the underlying model is implemented.</li>
<li>We implement our sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> interface, which just means that our sampler is a subtype of <code>AbstractMCMC.AbstractSampler</code> and we implement the MCMC transition in <code>AbstractMCMC.step</code>.</li>
<li>Points 1 and 2 makes it so our sampler can be used with a wide range of model implementations, amongst them being models implemented in both Turing.jl and Stan. This gives you, the inference implementer, a large collection of models to test your inference method on, in addition to allowing users of Turing.jl and Stan to try out your inference method with minimal effort.</li>
</ol>


</section>


<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a><div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>We’re going with the leapfrog formulation because in a future version of this tutorial we’ll add a section extending this simple “baseline” MALA sampler to more complex versions. See <a href="https://github.com/TuringLang/docs/issues/479">issue #479</a> for progress on this.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>There is no such thing as a proper interface in Julia (at least not officially), and so we use the word “interface” here to mean a few minimal methods that needs to be implemented by any type that we treat as a target model.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    // Ensure there is a toggle, if there isn't float one in the top right
    if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
      const a = window.document.createElement('a');
      a.classList.add('top-right');
      a.classList.add('quarto-color-scheme-toggle');
      a.href = "";
      a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
      const i = window.document.createElement("i");
      i.classList.add('bi');
      a.appendChild(i);
      window.document.body.appendChild(a);
    }
    setColorSchemeToggle(hasAlternateSentinel())
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/turinglang\.org\/docs\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../../developers/inference/variational-inference/index.html" class="pagination-link" aria-label="Variational Inference">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Variational Inference</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Turing is created by <a href="http://mlg.eng.cam.ac.uk/hong/" target="_blank">Hong Ge</a>, and lovingly maintained by the <a href="https://github.com/TuringLang/Turing.jl/graphs/contributors" target="_blank">core team</a> of volunteers. <br> The contents of this website are © 2024 under the terms of the <a href="https://github.com/TuringLang/Turing.jl/blob/main/LICENCE" target="_blank">MIT License</a>.</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/TuringLang/docs/edit/main/developers/inference/implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/docs/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://x.com/TuringLang">
      <i class="bi bi-twitter" role="img" aria-label="Turing Twitter">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/TuringLang/Turing.jl">
      <i class="bi bi-github" role="img" aria-label="Turing GitHub">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




<script src="../../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>