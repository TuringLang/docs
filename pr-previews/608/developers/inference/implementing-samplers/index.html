<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Implementing Samplers – Turing.jl</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<link href="../../../developers/inference/variational-inference/index.html" rel="prev">
<link href="../../../assets/favicon.ico" rel="icon">
<script src="../../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-dark-2fef5ea3f8957b3e4ecc936fc74692ca.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap-8ca65573be89ab5a614a0758d6e79fa7.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../../site_libs/bootstrap/bootstrap-dark-e4bf857d3af38d284e31ad2f58e22145.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="../../../site_libs/bootstrap/bootstrap-8ca65573be89ab5a614a0758d6e79fa7.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<style>
  a {
    text-decoration: none;
  }
  a:hover {
    text-decoration: underline;
  }
</style>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../../theming/styles.css">
</head>

<body class="nav-sidebar floating nav-fixed quarto-light"><script id="quarto-html-before-body" type="application/javascript">
    const toggleBodyColorMode = (bsSheetEl) => {
      const mode = bsSheetEl.getAttribute("data-mode");
      const bodyEl = window.document.querySelector("body");
      if (mode === "dark") {
        bodyEl.classList.add("quarto-dark");
        bodyEl.classList.remove("quarto-light");
      } else {
        bodyEl.classList.add("quarto-light");
        bodyEl.classList.remove("quarto-dark");
      }
    }
    const toggleBodyColorPrimary = () => {
      const bsSheetEl = window.document.querySelector("link#quarto-bootstrap:not([rel=disabled-stylesheet])");
      if (bsSheetEl) {
        toggleBodyColorMode(bsSheetEl);
      }
    }
    const setColorSchemeToggle = (alternate) => {
      const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
      for (let i=0; i < toggles.length; i++) {
        const toggle = toggles[i];
        if (toggle) {
          if (alternate) {
            toggle.classList.add("alternate");
          } else {
            toggle.classList.remove("alternate");
          }
        }
      }
    };
    const toggleColorMode = (alternate) => {
      // Switch the stylesheets
      const primaryStylesheets = window.document.querySelectorAll('link.quarto-color-scheme:not(.quarto-color-alternate)');
      const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
      manageTransitions('#quarto-margin-sidebar .nav-link', false);
      if (alternate) {
        // note: dark is layered on light, we don't disable primary!
        enableStylesheet(alternateStylesheets);
        for (const sheetNode of alternateStylesheets) {
          if (sheetNode.id === "quarto-bootstrap") {
            toggleBodyColorMode(sheetNode);
          }
        }
      } else {
        disableStylesheet(alternateStylesheets);
        enableStylesheet(primaryStylesheets)
        toggleBodyColorPrimary();
      }
      manageTransitions('#quarto-margin-sidebar .nav-link', true);
      // Switch the toggles
      setColorSchemeToggle(alternate)
      // Hack to workaround the fact that safari doesn't
      // properly recolor the scrollbar when toggling (#1455)
      if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
        manageTransitions("body", false);
        window.scrollTo(0, 1);
        setTimeout(() => {
          window.scrollTo(0, 0);
          manageTransitions("body", true);
        }, 40);
      }
    }
    const disableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        stylesheet.rel = 'disabled-stylesheet';
      }
    }
    const enableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        if(stylesheet.rel !== 'stylesheet') { // for Chrome, which will still FOUC without this check
          stylesheet.rel = 'stylesheet';
        }
      }
    }
    const manageTransitions = (selector, allowTransitions) => {
      const els = window.document.querySelectorAll(selector);
      for (let i=0; i < els.length; i++) {
        const el = els[i];
        if (allowTransitions) {
          el.classList.remove('notransition');
        } else {
          el.classList.add('notransition');
        }
      }
    }
    const isFileUrl = () => {
      return window.location.protocol === 'file:';
    }
    const hasAlternateSentinel = () => {
      let styleSentinel = getColorSchemeSentinel();
      if (styleSentinel !== null) {
        return styleSentinel === "alternate";
      } else {
        return false;
      }
    }
    const setStyleSentinel = (alternate) => {
      const value = alternate ? "alternate" : "default";
      if (!isFileUrl()) {
        window.localStorage.setItem("quarto-color-scheme", value);
      } else {
        localAlternateSentinel = value;
      }
    }
    const getColorSchemeSentinel = () => {
      if (!isFileUrl()) {
        const storageValue = window.localStorage.getItem("quarto-color-scheme");
        return storageValue != null ? storageValue : localAlternateSentinel;
      } else {
        return localAlternateSentinel;
      }
    }
    const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
      const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
      const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
      let newTheme = '';
      if(authorPrefersDark) {
        newTheme = isAlternate ? baseTheme : alternateTheme;
      } else {
        newTheme = isAlternate ? alternateTheme : baseTheme;
      }
      const changeGiscusTheme = () => {
        // From: https://github.com/giscus/giscus/issues/336
        const sendMessage = (message) => {
          const iframe = document.querySelector('iframe.giscus-frame');
          if (!iframe) return;
          iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
        }
        sendMessage({
          setConfig: {
            theme: newTheme
          }
        });
      }
      const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
      if (isGiscussLoaded) {
        changeGiscusTheme();
      }
    };
    const authorPrefersDark = false;
    const darkModeDefault = authorPrefersDark;
      document.querySelector('link#quarto-text-highlighting-styles.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
      document.querySelector('link#quarto-bootstrap.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
    let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
    // Dark / light mode switch
    window.quartoToggleColorScheme = () => {
      // Read the current dark / light value
      let toAlternate = !hasAlternateSentinel();
      toggleColorMode(toAlternate);
      setStyleSentinel(toAlternate);
      toggleGiscusIfUsed(toAlternate, darkModeDefault);
      window.dispatchEvent(new Event('resize'));
    };
    // Switch to dark mode if need be
    if (hasAlternateSentinel()) {
      toggleColorMode(true);
    } else {
      toggleColorMode(false);
    }
  </script>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="https://turinglang.org/" class="navbar-brand navbar-brand-logo">
    <img src="../../../assets/images/turing-logo.svg" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="https://turinglang.org/">
    <span class="navbar-title">Turing.jl</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../getting-started/"> 
<span class="menu-text">Get Started</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../tutorials/coin-flipping/"> 
<span class="menu-text">Tutorials</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../faq/"> 
<span class="menu-text">FAQ</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/library/"> 
<span class="menu-text">Libraries</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/news/"> 
<span class="menu-text">News</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/team/"> 
<span class="menu-text">Team</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-v0.39" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">v0.39</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-v0.39">    
        <li>
    <a class="dropdown-item" href="https://turinglang.org/docs/changelog.html">
 <span class="dropdown-text">Changelog</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://turinglang.org/docs/versions.html">
 <span class="dropdown-text">All Versions</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools tools-wide">
    <a href="https://x.com/TuringLang" title="Turing Twitter" class="quarto-navigation-tool px-1" aria-label="Turing Twitter"><i class="bi bi-twitter"></i></a>
    <a href="https://github.com/TuringLang/Turing.jl" title="Turing GitHub" class="quarto-navigation-tool px-1" aria-label="Turing GitHub"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../../developers/contributing/index.html">Developers</a></li><li class="breadcrumb-item"><a href="../../../developers/inference/variational-inference/index.html">Inference in Detail</a></li><li class="breadcrumb-item"><a href="../../../developers/inference/implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../getting-started/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Getting Started</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../core-functionality/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Core Functionality</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false">
 <span class="menu-text">User Guide</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/automatic-differentiation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Automatic Differentiation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/submodels/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Submodels</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/custom-distribution/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Custom Distributions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/probability-interface/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Querying Model Probabilities</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/modifying-logprob/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Modifying the Log Probability</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/tracking-extra-quantities/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Tracking Extra Quantities</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/mode-estimation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Mode Estimation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/performance-tips/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Performance Tips</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/sampler-visualisation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Sampler Visualization</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/dynamichmc/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using DynamicHMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/external-samplers/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using External Samplers</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/troubleshooting/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Troubleshooting</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false">
 <span class="menu-text">Tutorials</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/coin-flipping/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction: Coin Flipping</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/gaussian-mixture-models/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Mixture Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-neural-networks/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Neural Networks</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/hidden-markov-models/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Hidden Markov Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-linear-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Linear Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/infinite-mixture-models/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Infinite Mixture Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-poisson-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Poisson Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/multinomial-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Multinomial Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-differential-equations/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Differential Equations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/probabilistic-pca/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Probabilistic PCA</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-time-series-analysis/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Time Series Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/gaussian-processes-introduction/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Processes: Introduction</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/gaussian-process-latent-variable-models/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Process Latent Variable Models</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Developers</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/contributing/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Contributing</span></a>
  </div>
</li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false">
 <span class="menu-text">DynamicPPL’s Compiler</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/compiler/model-manual/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Manually Defining a Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/compiler/minituring-compiler/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation I: Compiler</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/compiler/minituring-contexts/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation II: Contexts</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/compiler/design-overview/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Turing Compiler Design (Outdated)</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false">
 <span class="menu-text">DynamicPPL Contexts</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/contexts/submodel-condition/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Conditioning and fixing in submodels</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="false">
 <span class="menu-text">Variable Transformations</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/transforms/distributions/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Distributions and the Jacobian</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/transforms/bijectors/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bijectors in MCMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/transforms/dynamicppl/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variable transformations in DynamicPPL</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true">
 <span class="menu-text">Inference in Detail</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/inference/variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/inference/implementing-samplers/index.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Implementing Samplers</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of Contents</h2>
   
  <ul>
  <li><a href="#quick-overview-of-mala" id="toc-quick-overview-of-mala" class="nav-link active" data-scroll-target="#quick-overview-of-mala">Quick overview of MALA</a></li>
  <li><a href="#what-we-need-from-a-model-logdensityproblems.jl" id="toc-what-we-need-from-a-model-logdensityproblems.jl" class="nav-link" data-scroll-target="#what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: LogDensityProblems.jl</a></li>
  <li><a href="#implementing-mala-in-abstractmcmc.jl" id="toc-implementing-mala-in-abstractmcmc.jl" class="nav-link" data-scroll-target="#implementing-mala-in-abstractmcmc.jl">Implementing MALA in AbstractMCMC.jl</a></li>
  <li><a href="#using-our-sampler-with-turing.jl" id="toc-using-our-sampler-with-turing.jl" class="nav-link" data-scroll-target="#using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</a>
  <ul class="collapse">
  <li><a href="#models-with-constrained-parameters" id="toc-models-with-constrained-parameters" class="nav-link" data-scroll-target="#models-with-constrained-parameters">Models with constrained parameters</a></li>
  </ul></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/TuringLang/docs/edit/main/developers/inference/implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/docs/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">


<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../../developers/contributing/index.html">Developers</a></li><li class="breadcrumb-item"><a href="../../../developers/inference/variational-inference/index.html">Inference in Detail</a></li><li class="breadcrumb-item"><a href="../../../developers/inference/implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Implementing Samplers</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>In this tutorial, we’ll go through step-by-step how to implement a “simple” sampler in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> in such a way that it can be easily applied to Turing.jl models.</p>
<p>In particular, we’re going to implement a version of <strong>Metropolis-adjusted Langevin (MALA)</strong>.</p>
<p>Note that we will implement this sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> framework, completely “ignoring” Turing.jl until the very end of the tutorial, at which point we’ll use a single line of code to make the resulting sampler available to Turing.jl. This is to really drive home the point that one can implement samplers in a way that is accessible to all of Turing.jl’s users without having to use Turing.jl yourself.</p>
<section id="quick-overview-of-mala" class="level2">
<h2 class="anchored" data-anchor-id="quick-overview-of-mala">Quick overview of MALA</h2>
<p>We can view MALA as a single step of the leapfrog intergrator with resampling of momentum <span class="math inline">\(p\)</span> at every step.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> To make that statement a bit more concrete, we first define the <em>extended</em> target <span class="math inline">\(\bar{\gamma}(x, p)\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\log \bar{\gamma}(x, p) \propto \log \gamma(x) + \log \gamma_{\mathcal{N}(0, M)}(p)
\end{equation*}\]</span></p>
<p>where <span class="math inline">\(\gamma_{\mathcal{N}(0, M)}\)</span> denotes the density for a zero-centered Gaussian with covariance matrix <span class="math inline">\(M\)</span>. We then consider targeting this joint distribution over both <span class="math inline">\(x\)</span> and <span class="math inline">\(p\)</span> as follows. First we define the map</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  L_{\epsilon}: \quad &amp; \mathbb{R}^d \times \mathbb{R}^d \to \mathbb{R}^d \times \mathbb{R}^d \\
  &amp; (x, p) \mapsto (\tilde{x}, \tilde{p}) := L_{\epsilon}(x, p)
\end{split}
\end{equation*}\]</span></p>
<p>as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p_{1 / 2} &amp;:= p + \frac{\epsilon}{2} \nabla \log \gamma(x) \\
  \tilde{x} &amp;:= x + \epsilon M^{-1} p_{1 /2 } \\
  p_1 &amp;:= p_{1 / 2} + \frac{\epsilon}{2} \nabla \log \gamma(\tilde{x}) \\
  \tilde{p} &amp;:= - p_1
\end{split}
\end{equation*}\]</span></p>
<p>This might be familiar for some readers as a single step of the Leapfrog integrator. We then define the MALA kernel as follows: given the current iterate <span class="math inline">\(x_i\)</span>, we sample the next iterate <span class="math inline">\(x_{i + 1}\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p &amp;\sim \mathcal{N}(0, M) \\
  (\tilde{x}, \tilde{p}) &amp;:= L_{\epsilon}(x_i, p) \\
  \alpha &amp;:= \min \left\{ 1, \frac{\bar{\gamma}(\tilde{x}, \tilde{p})}{\bar{\gamma}(x_i, p)} \right\} \\
  x_{i + 1} &amp;:=
  \begin{cases}
    \tilde{x} \quad &amp; \text{ with prob. } \alpha \\
    x_i       \quad &amp; \text{ with prob. } 1 - \alpha
  \end{cases}
\end{split}
\end{equation*}\]</span></p>
<p>i.e.&nbsp;we accept the proposal <span class="math inline">\(\tilde{x}\)</span> with probability <span class="math inline">\(\alpha\)</span> and reject it, thus sticking with our current iterate, with probability <span class="math inline">\(1 - \alpha\)</span>.</p>
</section>
<section id="what-we-need-from-a-model-logdensityproblems.jl" class="level2">
<h2 class="anchored" data-anchor-id="what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a></h2>
<p>There are a few things we need from the “target” / “model” / density that we want to sample from:</p>
<ol type="1">
<li>We need access to log-density <em>evaluations</em> <span class="math inline">\(\log \gamma(x)\)</span> so we can compute the acceptance ratio involving <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>We need access to log-density <em>gradients</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span> so we can compute the Leapfrog steps <span class="math inline">\(L_{\epsilon}(x, p)\)</span>.</li>
<li>We also need access to the “size” of the model so we can determine the size of <span class="math inline">\(M\)</span>.</li>
</ol>
<p>Luckily for us, there is a package called <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> which provides an interface for <em>exactly</em> this!</p>
<p>To demonstrate how one can implement the “<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface”<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> we will use a simple Gaussian model as an example:</p>
<div id="4" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblems</span>: LogDensityProblems;</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's define some type that represents the model.</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> IsotropicNormalModel{M<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"mean of the isotropic Gaussian"</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    mean<span class="op">::</span><span class="dt">M</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Specifies what input length the model expects.</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">dimension</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> <span class="fu">length</span>(model.mean)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Implementation of the log-density evaluation of the model.</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x<span class="op">::</span><span class="dt">AbstractVector{&lt;:Real}</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">-</span> <span class="fu">sum</span>(abs2, x <span class="op">.-</span> model.mean) <span class="op">/</span> <span class="fl">2</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This gives us all of the properties we want for our MALA sampler with the exception of the computation of the <em>gradient</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span>. There is the method <code>LogDensityProblems.logdensity_and_gradient</code> which should return a 2-tuple where the first entry is the evaluation of the logdensity <span class="math inline">\(\log \gamma(x)\)</span> and the second entry is the gradient <span class="math inline">\(\nabla \log \gamma(x)\)</span>.</p>
<p>There are two ways to “implement” this method: 1) we implement it by hand, which is feasible in the case of our <code>IsotropicNormalModel</code>, or b) we defer the implementation of this to a automatic differentiation backend.</p>
<p>To implement it by hand we can simply do</p>
<div id="6" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl that first-order, i.e. gradient information, is available.</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{1}</span>()</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Implement `logdensity_and_gradient`.</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    logγ_x <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="op">-</span>x <span class="op">.*</span> (x <span class="op">-</span> model.mean)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> logγ_x, ∇logγ_x</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s just try it out:</p>
<div id="8" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate the problem.</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> <span class="fu">IsotropicNormalModel</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.])</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create some example input that we can test on.</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>x_example <span class="op">=</span> <span class="fu">randn</span>(LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate!</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-26.90072524224489</code></pre>
</div>
</div>
<p>To defer it to an automatic differentiation backend, we can do</p>
<div id="10" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl we only have access to 0-th order information.</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{0}</span>()</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Use `LogDensityProblemsAD`'s `ADgradient` in combination with some AD backend to implement `logdensity_and_gradient`.</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblemsAD</span>, <span class="bu">ADTypes</span>, <span class="bu">ForwardDiff</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>model_with_grad <span class="op">=</span> <span class="fu">ADgradient</span>(<span class="fu">AutoForwardDiff</span>(), model)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model_with_grad, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-26.90072524224489</code></pre>
</div>
</div>
<p>We’ll continue with the second approach in this tutorial since this is typically what one does in practice, because there are better hobbies to spend time on than deriving gradients by hand.</p>
<p>At this point, one might wonder how we’re going to tie this back to Turing.jl in the end. Effectively, when working with inference methods that only require log-density evaluations and / or higher-order information of the log-density, Turing.jl actually converts the user-provided <code>Model</code> into an object implementing the above methods for <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>. As a result, most samplers provided by Turing.jl are actually implemented to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, enabling their use both <em>within</em> Turing.jl and <em>outside</em> of Turing.jl! Morever, there exists similar conversions for Stan through BridgeStan and Stan<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, which means that a sampler supporting the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface can easily be used on both Turing.jl <em>and</em> Stan models (in addition to user-provided models, as our <code>IsotropicNormalModel</code> above)!</p>
<p>Anyways, let’s move on to actually implementing the sampler.</p>
</section>
<section id="implementing-mala-in-abstractmcmc.jl" class="level2">
<h2 class="anchored" data-anchor-id="implementing-mala-in-abstractmcmc.jl">Implementing MALA in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a></h2>
<p>Now that we’ve established that a model implementing the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface provides us with all the information we need from <span class="math inline">\(\log \gamma(x)\)</span>, we can address the question: given an object that implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, how can we define a sampler for it?</p>
<p>We’re going to do this by making our sampler a sub-type of <code>AbstractMCMC.AbstractSampler</code> in addition to implementing a few methods from <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>. Why? Because it gets us <em>a lot</em> of functionality for free, as we will see later.</p>
<p>Moreover, <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> provides a very natural interface for MCMC algorithms.</p>
<p>First, we’ll define our <code>MALA</code> type</p>
<div id="12" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">AbstractMCMC</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALA{T,A} <span class="op">&lt;:</span><span class="dt"> AbstractMCMC.AbstractSampler</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"stepsize used in the leapfrog step"</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    ϵ_init<span class="op">::</span><span class="dt">T</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"covariance matrix used for the momentum"</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    M_init<span class="op">::</span><span class="dt">A</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notice how we’ve added the suffix <code>_init</code> to both the stepsize and the covariance matrix. We’ve done this because a <code>AbstractMCMC.AbstractSampler</code> should be <em>immutable</em>. Of course there might be many scenarios where we want to allow something like the stepsize and / or the covariance matrix to vary between iterations, e.g.&nbsp;during the burn-in / adaptation phase of the sampling process we might want to adjust the parameters using statistics computed from these initial iterations. But information which can change between iterations <em>should not go in the sampler itself</em>! Instead, this information should go in the sampler <em>state</em>.</p>
<p>The sampler state should at the very least contain all the necessary information to perform the next MCMC iteration, but usually contains further information, e.g.&nbsp;quantities and statistics useful for evaluating whether the sampler has converged.</p>
<p>We will use the following sampler state for our <code>MALA</code> sampler:</p>
<div id="14" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALAState{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This might seem overly redundant: we’re defining a type <code>MALAState</code> and it only contains a simple vector of reals. In this particular case we indeed could have dropped this and simply used a <code>AbstractVector{&lt;:Real}</code> as our sampler state, but typically, as we will see later, one wants to include other quantities in the sampler state. For example, if we also wanted to adapt the parameters of our <code>MALA</code>, e.g.&nbsp;alter the stepsize depending on acceptance rates, in which case we should also put <code>ϵ</code> in the state, but for now we’ll keep things simple.</p>
<p>Moreover, we also want a <em>sample</em> type, which is a type meant for “public consumption”, i.e.&nbsp;the end-user. This is generally going to contain a subset of the information present in the state. But in such a simple scenario as this, we similarly only have a <code>AbstractVector{&lt;:Real}</code>:</p>
<div id="16" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALASample{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We currently have three things:</p>
<ol type="1">
<li>A <code>AbstractMCMC.AbstractSampler</code> implementation called <code>MALA</code>.</li>
<li>A state <code>MALAState</code> for our sampler <code>MALA</code>.</li>
<li>A sample <code>MALASample</code> for our sampler <code>MALA</code>.</li>
</ol>
<p>That means that we’re ready to implement the only thing that really matters: <code>AbstractMCMC.step</code>.</p>
<p><code>AbstractMCMC.step</code> defines the MCMC iteration of our <code>MALA</code> given the current <code>MALAState</code>. Specifically, the signature of the function is as follows:</p>
<div id="18" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The RNG to ensure reproducibility.</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The model that defines our target.</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.AbstractModel</span>,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The sampler for which we're taking a `step`.</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">AbstractMCMC.AbstractSampler</span>,</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The current sampler `state`.</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    state;</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Additional keyword arguments that we may or may not need.</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Moreover, there is a specific <code>AbstractMCMC.AbstractModel</code> which is used to indicate that the model that is provided implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface: <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Since, as we discussed earlier, in our case we’re indeed going to work with types that support the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, we’ll define <code>AbstractMCMC.step</code> for such a <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Note that <code>AbstractMCMC.LogDensityModel</code> has no other purpose; it has a single field called <code>logdensity</code>, and it does nothing else. But by wrapping the model in <code>AbstractMCMC.LogDensityModel</code>, it allows samplers that want to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> to define their <code>AbstractMCMC.step</code> on this type without running into method ambiguities.</p>
<p>All in all, that means that the signature for our <code>AbstractMCMC.step</code> is going to be the following:</p>
<div id="20" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># `LogDensityModel` so we know we're working with LogDensityProblems.jl model.</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler.</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler state.</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Great! Now let’s actually implement the full <code>AbstractMCMC.step</code> for our <code>MALA</code>.</p>
<p>Let’s remind ourselves what we’re going to do:</p>
<ol type="1">
<li>Sample a new momentum <span class="math inline">\(p\)</span>.</li>
<li>Compute the log-density of the extended target <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>Take a single leapfrog step <span class="math inline">\((\tilde{x}, \tilde{p}) = L_{\epsilon}(x, p)\)</span>.</li>
<li>Accept or reject the proposed <span class="math inline">\((\tilde{x}, \tilde{p})\)</span>.</li>
</ol>
<p>All in all, this results in the following:</p>
<div id="22" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>: Random</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Distributions</span>  <span class="co"># so we get the `MvNormal`</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the wrapped model which implements LogDensityProblems.jl.</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just extract the sampler parameters to make our lives easier.</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    ϵ <span class="op">=</span> sampler.ϵ_init</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    M <span class="op">=</span> sampler.M_init</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the current parameters.</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> state.x</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sample the momentum.</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>    p_dist <span class="op">=</span> <span class="fu">MvNormal</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)), M)</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> <span class="fu">rand</span>(rng, p_dist)</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Propose using a single leapfrog step.</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>    x̃, p̃ <span class="op">=</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Accept or reject proposal.</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>    logp <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p)</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>    logp̃ <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x̃) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p̃)</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>    logα <span class="op">=</span> logp̃ <span class="op">-</span> logp</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>    state_new <span class="op">=</span> <span class="cf">if</span> <span class="fu">log</span>(<span class="fu">rand</span>(rng)) <span class="op">&lt;</span> logα</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Accept.</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x̃)</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Reject.</span></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x)</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return the "sample" and the sampler state.</span></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(state_new.x), state_new</span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Fairly straight-forward.</p>
<p>Of course, we haven’t defined the <code>leapfrog_step</code> method yet, so let’s do that:</p>
<div id="24" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p` using "position" `x`.</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x))</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    p1 <span class="op">=</span> p <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update the "position" `x` using momentum `p1`.</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    x̃ <span class="op">=</span> x <span class="op">+</span> ϵ <span class="op">.*</span> (M <span class="op">\</span> p1)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p1` using position `x̃`</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x̃ <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x̃))</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    p2 <span class="op">=</span> p1 <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x̃</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Flip momentum `p2`.</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    p̃ <span class="op">=</span> <span class="op">-</span>p2</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x̃, p̃</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>leapfrog_step (generic function with 1 method)</code></pre>
</div>
</div>
<p>With all of this, we’re technically ready to sample!</p>
<div id="26" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>, <span class="bu">LinearAlgebra</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>rng <span class="op">=</span> <span class="bu">Random</span>.<span class="fu">default_rng</span>()</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>sampler <span class="op">=</span> <span class="fu">MALA</span>(<span class="fl">1</span>, I)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>state <span class="op">=</span> <span class="fu">MALAState</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)))</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>x_next, state_next <span class="op">=</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    rng,</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    AbstractMCMC.<span class="fu">LogDensityModel</span>(model),</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    state</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>(MALASample{Vector{Float64}}([0.0, 0.0, 0.0]), MALAState{Vector{Float64}}([0.0, 0.0, 0.0]))</code></pre>
</div>
</div>
<p>Great, it works!</p>
<p>And I promised we would get quite some functionality for free if we implemented <code>AbstractMCMC.step</code>, and so we can now simply call <code>sample</code> to perform standard MCMC sampling:</p>
<div id="28" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform 1000 iterations with our `MALA` sampler.</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; initial_state<span class="op">=</span>state, progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Concatenate into a matrix.</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000 Matrix{Float64}:
 -3.19153  -3.94101   -3.94101   -5.51742   …  -5.25034  -5.00889   -5.91073
  1.2873   -0.194106  -0.194106   0.560768     -1.33622  -0.846314   0.863883
  3.53051   4.9413     4.9413     4.95106       4.62549   4.55105    3.8783</code></pre>
</div>
</div>
<div id="30" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the marginal means and standard deviations.</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -5.01116    1.00388
  0.0268472  1.00864
  4.97885    1.00046</code></pre>
</div>
</div>
<p>Let’s visualize the samples</p>
<div id="32" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">StatsPlots</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">transpose</span>(samples_matrix[<span class="op">:</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">:</span><span class="kw">end</span>]), alpha<span class="op">=</span><span class="fl">0.5</span>, legend<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<!--?xml version="1.0" encoding="utf-8"?-->
<svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" width="672" height="480" viewbox="0 0 2688 1920">
<defs>
  <clippath id="clip630">
    <rect x="0" y="0" width="2688" height="1920"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip630)" d="M0 1920 L2688 1920 L2688 0 L0 0  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip631">
    <rect x="537" y="0" width="1883" height="1883"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip630)" d="M151.747 1800.78 L2640.76 1800.78 L2640.76 47.2441 L151.747 47.2441  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip632">
    <rect x="151" y="47" width="2490" height="1755"></rect>
  </clippath>
</defs>
<polyline clip-path="url(#clip632)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="219.84,1800.78 219.84,47.2441 "></polyline>
<polyline clip-path="url(#clip632)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="807.458,1800.78 807.458,47.2441 "></polyline>
<polyline clip-path="url(#clip632)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1395.08,1800.78 1395.08,47.2441 "></polyline>
<polyline clip-path="url(#clip632)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1982.69,1800.78 1982.69,47.2441 "></polyline>
<polyline clip-path="url(#clip632)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="2570.31,1800.78 2570.31,47.2441 "></polyline>
<polyline clip-path="url(#clip632)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,1549.82 2640.76,1549.82 "></polyline>
<polyline clip-path="url(#clip632)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,1240.72 2640.76,1240.72 "></polyline>
<polyline clip-path="url(#clip632)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,931.62 2640.76,931.62 "></polyline>
<polyline clip-path="url(#clip632)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,622.52 2640.76,622.52 "></polyline>
<polyline clip-path="url(#clip632)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,313.421 2640.76,313.421 "></polyline>
<polyline clip-path="url(#clip630)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1800.78 2640.76,1800.78 "></polyline>
<polyline clip-path="url(#clip630)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="219.84,1800.78 219.84,1781.88 "></polyline>
<polyline clip-path="url(#clip630)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="807.458,1800.78 807.458,1781.88 "></polyline>
<polyline clip-path="url(#clip630)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1395.08,1800.78 1395.08,1781.88 "></polyline>
<polyline clip-path="url(#clip630)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1982.69,1800.78 1982.69,1781.88 "></polyline>
<polyline clip-path="url(#clip630)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="2570.31,1800.78 2570.31,1781.88 "></polyline>
<path clip-path="url(#clip630)" d="M219.84 1834 Q216.229 1834 214.4 1837.57 Q212.595 1841.11 212.595 1848.24 Q212.595 1855.34 214.4 1858.91 Q216.229 1862.45 219.84 1862.45 Q223.474 1862.45 225.28 1858.91 Q227.108 1855.34 227.108 1848.24 Q227.108 1841.11 225.28 1837.57 Q223.474 1834 219.84 1834 M219.84 1830.3 Q225.65 1830.3 228.706 1834.9 Q231.784 1839.49 231.784 1848.24 Q231.784 1856.96 228.706 1861.57 Q225.65 1866.15 219.84 1866.15 Q214.03 1866.15 210.951 1861.57 Q207.896 1856.96 207.896 1848.24 Q207.896 1839.49 210.951 1834.9 Q214.03 1830.3 219.84 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip630)" d="M771.15 1861.55 L787.47 1861.55 L787.47 1865.48 L765.525 1865.48 L765.525 1861.55 Q768.187 1858.79 772.771 1854.16 Q777.377 1849.51 778.558 1848.17 Q780.803 1845.65 781.683 1843.91 Q782.585 1842.15 782.585 1840.46 Q782.585 1837.71 780.641 1835.97 Q778.72 1834.23 775.618 1834.23 Q773.419 1834.23 770.965 1835 Q768.535 1835.76 765.757 1837.31 L765.757 1832.59 Q768.581 1831.46 771.035 1830.88 Q773.488 1830.3 775.525 1830.3 Q780.896 1830.3 784.09 1832.98 Q787.285 1835.67 787.285 1840.16 Q787.285 1842.29 786.474 1844.21 Q785.687 1846.11 783.581 1848.7 Q783.002 1849.37 779.9 1852.59 Q776.798 1855.78 771.15 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip630)" d="M797.331 1830.92 L815.687 1830.92 L815.687 1834.86 L801.613 1834.86 L801.613 1843.33 Q802.632 1842.98 803.65 1842.82 Q804.669 1842.64 805.687 1842.64 Q811.474 1842.64 814.854 1845.81 Q818.233 1848.98 818.233 1854.4 Q818.233 1859.97 814.761 1863.08 Q811.289 1866.15 804.97 1866.15 Q802.794 1866.15 800.525 1865.78 Q798.28 1865.41 795.872 1864.67 L795.872 1859.97 Q797.956 1861.11 800.178 1861.66 Q802.4 1862.22 804.877 1862.22 Q808.882 1862.22 811.22 1860.11 Q813.558 1858.01 813.558 1854.4 Q813.558 1850.78 811.22 1848.68 Q808.882 1846.57 804.877 1846.57 Q803.002 1846.57 801.127 1846.99 Q799.275 1847.4 797.331 1848.28 L797.331 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip630)" d="M837.446 1834 Q833.835 1834 832.007 1837.57 Q830.201 1841.11 830.201 1848.24 Q830.201 1855.34 832.007 1858.91 Q833.835 1862.45 837.446 1862.45 Q841.081 1862.45 842.886 1858.91 Q844.715 1855.34 844.715 1848.24 Q844.715 1841.11 842.886 1837.57 Q841.081 1834 837.446 1834 M837.446 1830.3 Q843.256 1830.3 846.312 1834.9 Q849.391 1839.49 849.391 1848.24 Q849.391 1856.96 846.312 1861.57 Q843.256 1866.15 837.446 1866.15 Q831.636 1866.15 828.557 1861.57 Q825.502 1856.96 825.502 1848.24 Q825.502 1839.49 828.557 1834.9 Q831.636 1830.3 837.446 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip630)" d="M1354.69 1830.92 L1373.05 1830.92 L1373.05 1834.86 L1358.98 1834.86 L1358.98 1843.33 Q1360 1842.98 1361.01 1842.82 Q1362.03 1842.64 1363.05 1842.64 Q1368.84 1842.64 1372.22 1845.81 Q1375.6 1848.98 1375.6 1854.4 Q1375.6 1859.97 1372.12 1863.08 Q1368.65 1866.15 1362.33 1866.15 Q1360.16 1866.15 1357.89 1865.78 Q1355.64 1865.41 1353.24 1864.67 L1353.24 1859.97 Q1355.32 1861.11 1357.54 1861.66 Q1359.76 1862.22 1362.24 1862.22 Q1366.25 1862.22 1368.58 1860.11 Q1370.92 1858.01 1370.92 1854.4 Q1370.92 1850.78 1368.58 1848.68 Q1366.25 1846.57 1362.24 1846.57 Q1360.37 1846.57 1358.49 1846.99 Q1356.64 1847.4 1354.69 1848.28 L1354.69 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip630)" d="M1394.81 1834 Q1391.2 1834 1389.37 1837.57 Q1387.56 1841.11 1387.56 1848.24 Q1387.56 1855.34 1389.37 1858.91 Q1391.2 1862.45 1394.81 1862.45 Q1398.44 1862.45 1400.25 1858.91 Q1402.08 1855.34 1402.08 1848.24 Q1402.08 1841.11 1400.25 1837.57 Q1398.44 1834 1394.81 1834 M1394.81 1830.3 Q1400.62 1830.3 1403.68 1834.9 Q1406.75 1839.49 1406.75 1848.24 Q1406.75 1856.96 1403.68 1861.57 Q1400.62 1866.15 1394.81 1866.15 Q1389 1866.15 1385.92 1861.57 Q1382.87 1856.96 1382.87 1848.24 Q1382.87 1839.49 1385.92 1834.9 Q1389 1830.3 1394.81 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip630)" d="M1424.97 1834 Q1421.36 1834 1419.53 1837.57 Q1417.73 1841.11 1417.73 1848.24 Q1417.73 1855.34 1419.53 1858.91 Q1421.36 1862.45 1424.97 1862.45 Q1428.61 1862.45 1430.41 1858.91 Q1432.24 1855.34 1432.24 1848.24 Q1432.24 1841.11 1430.41 1837.57 Q1428.61 1834 1424.97 1834 M1424.97 1830.3 Q1430.78 1830.3 1433.84 1834.9 Q1436.92 1839.49 1436.92 1848.24 Q1436.92 1856.96 1433.84 1861.57 Q1430.78 1866.15 1424.97 1866.15 Q1419.16 1866.15 1416.08 1861.57 Q1413.03 1856.96 1413.03 1848.24 Q1413.03 1839.49 1416.08 1834.9 Q1419.16 1830.3 1424.97 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip630)" d="M1940.97 1830.92 L1963.19 1830.92 L1963.19 1832.91 L1950.65 1865.48 L1945.76 1865.48 L1957.57 1834.86 L1940.97 1834.86 L1940.97 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip630)" d="M1972.36 1830.92 L1990.71 1830.92 L1990.71 1834.86 L1976.64 1834.86 L1976.64 1843.33 Q1977.66 1842.98 1978.68 1842.82 Q1979.7 1842.64 1980.72 1842.64 Q1986.5 1842.64 1989.88 1845.81 Q1993.26 1848.98 1993.26 1854.4 Q1993.26 1859.97 1989.79 1863.08 Q1986.32 1866.15 1980 1866.15 Q1977.82 1866.15 1975.55 1865.78 Q1973.31 1865.41 1970.9 1864.67 L1970.9 1859.97 Q1972.98 1861.11 1975.21 1861.66 Q1977.43 1862.22 1979.9 1862.22 Q1983.91 1862.22 1986.25 1860.11 Q1988.59 1858.01 1988.59 1854.4 Q1988.59 1850.78 1986.25 1848.68 Q1983.91 1846.57 1979.9 1846.57 Q1978.03 1846.57 1976.15 1846.99 Q1974.3 1847.4 1972.36 1848.28 L1972.36 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip630)" d="M2012.47 1834 Q2008.86 1834 2007.03 1837.57 Q2005.23 1841.11 2005.23 1848.24 Q2005.23 1855.34 2007.03 1858.91 Q2008.86 1862.45 2012.47 1862.45 Q2016.11 1862.45 2017.91 1858.91 Q2019.74 1855.34 2019.74 1848.24 Q2019.74 1841.11 2017.91 1837.57 Q2016.11 1834 2012.47 1834 M2012.47 1830.3 Q2018.28 1830.3 2021.34 1834.9 Q2024.42 1839.49 2024.42 1848.24 Q2024.42 1856.96 2021.34 1861.57 Q2018.28 1866.15 2012.47 1866.15 Q2006.66 1866.15 2003.59 1861.57 Q2000.53 1856.96 2000.53 1848.24 Q2000.53 1839.49 2003.59 1834.9 Q2006.66 1830.3 2012.47 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip630)" d="M2514.84 1861.55 L2522.48 1861.55 L2522.48 1835.18 L2514.17 1836.85 L2514.17 1832.59 L2522.43 1830.92 L2527.11 1830.92 L2527.11 1861.55 L2534.75 1861.55 L2534.75 1865.48 L2514.84 1865.48 L2514.84 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip630)" d="M2554.19 1834 Q2550.58 1834 2548.75 1837.57 Q2546.94 1841.11 2546.94 1848.24 Q2546.94 1855.34 2548.75 1858.91 Q2550.58 1862.45 2554.19 1862.45 Q2557.82 1862.45 2559.63 1858.91 Q2561.46 1855.34 2561.46 1848.24 Q2561.46 1841.11 2559.63 1837.57 Q2557.82 1834 2554.19 1834 M2554.19 1830.3 Q2560 1830.3 2563.06 1834.9 Q2566.13 1839.49 2566.13 1848.24 Q2566.13 1856.96 2563.06 1861.57 Q2560 1866.15 2554.19 1866.15 Q2548.38 1866.15 2545.3 1861.57 Q2542.25 1856.96 2542.25 1848.24 Q2542.25 1839.49 2545.3 1834.9 Q2548.38 1830.3 2554.19 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip630)" d="M2584.35 1834 Q2580.74 1834 2578.91 1837.57 Q2577.11 1841.11 2577.11 1848.24 Q2577.11 1855.34 2578.91 1858.91 Q2580.74 1862.45 2584.35 1862.45 Q2587.99 1862.45 2589.79 1858.91 Q2591.62 1855.34 2591.62 1848.24 Q2591.62 1841.11 2589.79 1837.57 Q2587.99 1834 2584.35 1834 M2584.35 1830.3 Q2590.16 1830.3 2593.22 1834.9 Q2596.3 1839.49 2596.3 1848.24 Q2596.3 1856.96 2593.22 1861.57 Q2590.16 1866.15 2584.35 1866.15 Q2578.54 1866.15 2575.46 1861.57 Q2572.41 1856.96 2572.41 1848.24 Q2572.41 1839.49 2575.46 1834.9 Q2578.54 1830.3 2584.35 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip630)" d="M2614.51 1834 Q2610.9 1834 2609.07 1837.57 Q2607.27 1841.11 2607.27 1848.24 Q2607.27 1855.34 2609.07 1858.91 Q2610.9 1862.45 2614.51 1862.45 Q2618.15 1862.45 2619.95 1858.91 Q2621.78 1855.34 2621.78 1848.24 Q2621.78 1841.11 2619.95 1837.57 Q2618.15 1834 2614.51 1834 M2614.51 1830.3 Q2620.32 1830.3 2623.38 1834.9 Q2626.46 1839.49 2626.46 1848.24 Q2626.46 1856.96 2623.38 1861.57 Q2620.32 1866.15 2614.51 1866.15 Q2608.7 1866.15 2605.62 1861.57 Q2602.57 1856.96 2602.57 1848.24 Q2602.57 1839.49 2605.62 1834.9 Q2608.7 1830.3 2614.51 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip630)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1800.78 151.747,47.2441 "></polyline>
<polyline clip-path="url(#clip630)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1549.82 170.644,1549.82 "></polyline>
<polyline clip-path="url(#clip630)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1240.72 170.644,1240.72 "></polyline>
<polyline clip-path="url(#clip630)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,931.62 170.644,931.62 "></polyline>
<polyline clip-path="url(#clip630)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,622.52 170.644,622.52 "></polyline>
<polyline clip-path="url(#clip630)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,313.421 170.644,313.421 "></polyline>
<path clip-path="url(#clip630)" d="M49.5521 1550.27 L79.2279 1550.27 L79.2279 1554.21 L49.5521 1554.21 L49.5521 1550.27 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip630)" d="M99.8991 1547.96 Q96.7509 1547.96 94.8991 1550.11 Q93.0704 1552.26 93.0704 1556.01 Q93.0704 1559.74 94.8991 1561.91 Q96.7509 1564.07 99.8991 1564.07 Q103.047 1564.07 104.876 1561.91 Q106.728 1559.74 106.728 1556.01 Q106.728 1552.26 104.876 1550.11 Q103.047 1547.96 99.8991 1547.96 M109.181 1533.3 L109.181 1537.56 Q107.422 1536.73 105.617 1536.29 Q103.834 1535.85 102.075 1535.85 Q97.4454 1535.85 94.9917 1538.97 Q92.5612 1542.1 92.2139 1548.42 Q93.5797 1546.4 95.6398 1545.34 Q97.7 1544.25 100.177 1544.25 Q105.385 1544.25 108.394 1547.42 Q111.427 1550.57 111.427 1556.01 Q111.427 1561.33 108.279 1564.55 Q105.131 1567.77 99.8991 1567.77 Q93.9037 1567.77 90.7325 1563.19 Q87.5612 1558.58 87.5612 1549.85 Q87.5612 1541.66 91.45 1536.8 Q95.3389 1531.91 101.89 1531.91 Q103.649 1531.91 105.431 1532.26 Q107.237 1532.61 109.181 1533.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip630)" d="M50.3623 1241.17 L80.0381 1241.17 L80.0381 1245.11 L50.3623 1245.11 L50.3623 1241.17 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip630)" d="M104.297 1239.36 Q107.654 1240.08 109.529 1242.35 Q111.427 1244.62 111.427 1247.95 Q111.427 1253.07 107.908 1255.87 Q104.39 1258.67 97.9083 1258.67 Q95.7324 1258.67 93.4176 1258.23 Q91.126 1257.81 88.6723 1256.96 L88.6723 1252.44 Q90.6167 1253.58 92.9315 1254.16 Q95.2463 1254.74 97.7695 1254.74 Q102.168 1254.74 104.459 1253 Q106.774 1251.26 106.774 1247.95 Q106.774 1244.9 104.621 1243.18 Q102.492 1241.45 98.6722 1241.45 L94.6445 1241.45 L94.6445 1237.61 L98.8574 1237.61 Q102.306 1237.61 104.135 1236.24 Q105.964 1234.85 105.964 1232.26 Q105.964 1229.6 104.066 1228.18 Q102.191 1226.75 98.6722 1226.75 Q96.7509 1226.75 94.5519 1227.17 Q92.3528 1227.58 89.7139 1228.46 L89.7139 1224.3 Q92.376 1223.55 94.6908 1223.18 Q97.0287 1222.81 99.0889 1222.81 Q104.413 1222.81 107.515 1225.24 Q110.617 1227.65 110.617 1231.77 Q110.617 1234.64 108.973 1236.63 Q107.33 1238.6 104.297 1239.36 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip630)" d="M99.4824 917.418 Q95.8713 917.418 94.0426 920.983 Q92.2371 924.525 92.2371 931.654 Q92.2371 938.761 94.0426 942.326 Q95.8713 945.867 99.4824 945.867 Q103.117 945.867 104.922 942.326 Q106.751 938.761 106.751 931.654 Q106.751 924.525 104.922 920.983 Q103.117 917.418 99.4824 917.418 M99.4824 913.715 Q105.293 913.715 108.348 918.321 Q111.427 922.904 111.427 931.654 Q111.427 940.381 108.348 944.988 Q105.293 949.571 99.4824 949.571 Q93.6723 949.571 90.5936 944.988 Q87.538 940.381 87.538 931.654 Q87.538 922.904 90.5936 918.321 Q93.6723 913.715 99.4824 913.715 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip630)" d="M104.297 621.166 Q107.654 621.884 109.529 624.152 Q111.427 626.421 111.427 629.754 Q111.427 634.87 107.908 637.671 Q104.39 640.471 97.9083 640.471 Q95.7324 640.471 93.4176 640.032 Q91.126 639.615 88.6723 638.758 L88.6723 634.245 Q90.6167 635.379 92.9315 635.958 Q95.2463 636.536 97.7695 636.536 Q102.168 636.536 104.459 634.8 Q106.774 633.064 106.774 629.754 Q106.774 626.698 104.621 624.985 Q102.492 623.249 98.6722 623.249 L94.6445 623.249 L94.6445 619.407 L98.8574 619.407 Q102.306 619.407 104.135 618.041 Q105.964 616.652 105.964 614.06 Q105.964 611.398 104.066 609.985 Q102.191 608.55 98.6722 608.55 Q96.7509 608.55 94.5519 608.967 Q92.3528 609.384 89.7139 610.263 L89.7139 606.097 Q92.376 605.356 94.6908 604.986 Q97.0287 604.615 99.0889 604.615 Q104.413 604.615 107.515 607.046 Q110.617 609.453 110.617 613.573 Q110.617 616.444 108.973 618.435 Q107.33 620.402 104.297 621.166 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip630)" d="M99.8991 311.557 Q96.7509 311.557 94.8991 313.71 Q93.0704 315.863 93.0704 319.613 Q93.0704 323.34 94.8991 325.516 Q96.7509 327.668 99.8991 327.668 Q103.047 327.668 104.876 325.516 Q106.728 323.34 106.728 319.613 Q106.728 315.863 104.876 313.71 Q103.047 311.557 99.8991 311.557 M109.181 296.905 L109.181 301.164 Q107.422 300.33 105.617 299.891 Q103.834 299.451 102.075 299.451 Q97.4454 299.451 94.9917 302.576 Q92.5612 305.701 92.2139 312.02 Q93.5797 310.006 95.6398 308.942 Q97.7 307.854 100.177 307.854 Q105.385 307.854 108.394 311.025 Q111.427 314.173 111.427 319.613 Q111.427 324.937 108.279 328.154 Q105.131 331.372 99.8991 331.372 Q93.9037 331.372 90.7325 326.789 Q87.5612 322.182 87.5612 313.455 Q87.5612 305.261 91.45 300.4 Q95.3389 295.516 101.89 295.516 Q103.649 295.516 105.431 295.863 Q107.237 296.21 109.181 296.905 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip632)" style="stroke:#009af9; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,1260.45 224.541,1552.53 226.891,1370.08 229.242,1469.18 231.592,1413.99 233.943,1556.28 236.293,1296.15 238.644,1424.62 240.994,1493.63 243.345,1285.5 245.695,1532.3 248.046,1466.21 250.396,1460.13 252.747,1498.09 255.097,1494.57 257.448,1373.68 259.798,1585.02 262.148,1609.96 264.499,1512.01 266.849,1596.03 269.2,1493.03 271.55,1524.42 273.901,1432.94 276.251,1337.51 278.602,1416 280.952,1516.19 283.303,1499.6 285.653,1604.18 288.004,1304.82 290.354,1258.91 292.705,1309.54 295.055,1590.71 297.406,1318.93 299.756,1269.85 302.107,1433.22 304.457,1366.06 306.807,1364.65 309.158,1445.17 311.508,1514.87 313.859,1265.51 316.209,1570.34 318.56,1415.41 320.91,1408.55 323.261,1563.17 325.611,1453.8 327.962,1305.8 330.312,1334.5 332.663,1609.28 335.013,1357.68 337.364,1366.07 339.714,1335.59 342.065,1561.96 344.415,1316.22 346.765,1489.64 349.116,1421.88 351.466,1528.62 353.817,1523.01 356.167,1461.62 358.518,1407.91 360.868,1355.4 363.219,1277.6 365.569,1544.72 367.92,1333.54 370.27,1467.38 372.621,1387.82 374.971,1279.09 377.322,1582.7 379.672,1542.14 382.023,1339.19 384.373,1329.69 386.724,1319.85 389.074,1421.1 391.424,1459.17 393.775,1315.74 396.125,1690.61 398.476,1414.84 400.826,1530.75 403.177,1398.28 405.527,1473.46 407.878,1497.03 410.228,1509.42 412.579,1500.69 414.929,1566.88 417.28,1608.19 419.63,1370.55 421.981,1609.75 424.331,1513.04 426.682,1572.56 429.032,1394.4 431.382,1652.34 433.733,1421.51 436.083,1429.22 438.434,1459.12 440.784,1522.37 443.135,1189.39 445.485,1542.78 447.836,1366.24 450.186,1454.25 452.537,1320.51 454.887,1567.37 457.238,1544.8 459.588,1356.79 461.939,1649.79 464.289,1562.94 466.64,1354.86 468.99,1669.62 471.341,1564.66 473.691,1336.09 476.041,1338.33 478.392,1454.76 480.742,1511.45 483.093,1639.12 485.443,1661.38 487.794,1484.8 490.144,1468.12 492.495,1514.55 494.845,1440.09 497.196,1265.8 499.546,1430.65 501.897,1451.04 504.247,1301.85 506.598,1425.73 508.948,1419.1 511.299,1405.99 513.649,1565.63 515.999,1556.35 518.35,1441.18 520.7,1601.24 523.051,1425.54 525.401,1431.4 527.752,1535.58 530.102,1399.18 532.453,1522.22 534.803,1527.13 537.154,1597.84 539.504,1347.35 541.855,1418.15 544.205,1616.2 546.556,1298.06 548.906,1564.46 551.257,1496.5 553.607,1382.03 555.958,1411.46 558.308,1243.56 560.658,1422.07 563.009,1437.73 565.359,1461.99 567.71,1452.99 570.06,1495.32 572.411,1410.91 574.761,1442.19 577.112,1590.93 579.462,1399.04 581.813,1640.88 584.163,1316.65 586.514,1392.72 588.864,1456.07 591.215,1518.39 593.565,1605.01 595.916,1307.76 598.266,1466.11 600.616,1361.09 602.967,1466.99 605.317,1529.62 607.668,1312.66 610.018,1274.59 612.369,1291.1 614.719,1541.54 617.07,1399.14 619.42,1363.29 621.771,1523.63 624.121,1446.07 626.472,1461.09 628.822,1554.82 631.173,1518.52 633.523,1549.13 635.874,1537.23 638.224,1313.33 640.575,1445.27 642.925,1248.36 645.275,1545.88 647.626,1540.26 649.976,1554.66 652.327,1403.86 654.677,1441.36 657.028,1528.17 659.378,1438.74 661.729,1327.83 664.079,1494.14 666.43,1523.99 668.78,1265.43 671.131,1451.05 673.481,1411.42 675.832,1493.2 678.182,1447.22 680.533,1479.94 682.883,1426.45 685.233,1459.13 687.584,1483.58 689.934,1475.01 692.285,1533.72 694.635,1461.95 696.986,1287.93 699.336,1479.63 701.687,1534.68 704.037,1314.98 706.388,1315.44 708.738,1423.73 711.089,1404.2 713.439,1645.1 715.79,1470.05 718.14,1465.05 720.491,1343.66 722.841,1337.01 725.192,1511.91 727.542,1480.74 729.892,1397.73 732.243,1528.66 734.593,1305.09 736.944,1535.36 739.294,1261.96 741.645,1669.8 743.995,1234.21 746.346,1400.79 748.696,1436.9 751.047,1507.17 753.397,1589.08 755.748,1445.85 758.098,1283.75 760.449,1518.13 762.799,1562.23 765.15,1423.86 767.5,1331.07 769.85,1506.05 772.201,1608.39 774.551,1514.73 776.902,1437.58 779.252,1454.36 781.603,1449.6 783.953,1319.96 786.304,1435.31 788.654,1411.58 791.005,1497.82 793.355,1377.04 795.706,1465.47 798.056,1474.1 800.407,1336.08 802.757,1383.1 805.108,1584.11 807.458,1497.68 809.809,1503.01 812.159,1388.47 814.509,1583.66 816.86,1558.85 819.21,1542.27 821.561,1396.11 823.911,1370.37 826.262,1397.19 828.612,1479.22 830.963,1331.55 833.313,1437.8 835.664,1687.11 838.014,1473.61 840.365,1373.58 842.715,1388.63 845.066,1282.62 847.416,1474.04 849.767,1496.15 852.117,1554.09 854.467,1389.86 856.818,1412.18 859.168,1380.09 861.519,1371.8 863.869,1505.47 866.22,1548.24 868.57,1349.67 870.921,1473.69 873.271,1532.13 875.622,1514.09 877.972,1545.25 880.323,1537.45 882.673,1496.12 885.024,1500.8 887.374,1544.61 889.725,1499.95 892.075,1442.41 894.426,1446.81 896.776,1395.43 899.126,1139.54 901.477,1495.64 903.827,1336.65 906.178,1600.76 908.528,1425.26 910.879,1440.93 913.229,1322.01 915.58,1448.45 917.93,1515.2 920.281,1674.35 922.631,1524.14 924.982,1503.2 927.332,1725.68 929.683,1407.38 932.033,1488.76 934.384,1342.05 936.734,1578.69 939.084,1469.05 941.435,1477.83 943.785,1402.86 946.136,1238.07 948.486,1394.57 950.837,1394.58 953.187,1354.2 955.538,1542.26 957.888,1538.6 960.239,1439.86 962.589,1425.51 964.94,1342.79 967.29,1425.09 969.641,1500.66 971.991,1468.35 974.342,1417.54 976.692,1418.96 979.043,1322.32 981.393,1446.93 983.743,1366.66 986.094,1463.54 988.444,1364.65 990.795,1516.23 993.145,1523.89 995.496,1338.68 997.846,1222.92 1000.2,1498.56 1002.55,1537.04 1004.9,1521.17 1007.25,1460.79 1009.6,1628.14 1011.95,1274.86 1014.3,1566.58 1016.65,1504.9 1019,1577.04 1021.35,1396.05 1023.7,1292.9 1026.05,1364.13 1028.4,1511.14 1030.75,1472.87 1033.1,1495.53 1035.45,1145.36 1037.8,1465.99 1040.15,1480.24 1042.51,1428.19 1044.86,1424.18 1047.21,1375.51 1049.56,1487.44 1051.91,1342.06 1054.26,1447.82 1056.61,1235.75 1058.96,1508.62 1061.31,1325.02 1063.66,1401.95 1066.01,1433.1 1068.36,1435.64 1070.71,1391.62 1073.06,1404.7 1075.41,1303.96 1077.76,1495.24 1080.11,1364.27 1082.46,1556.49 1084.81,1413.26 1087.16,1415.39 1089.51,1445.82 1091.87,1451.22 1094.22,1475.8 1096.57,1385.73 1098.92,1382.69 1101.27,1494.45 1103.62,1431.52 1105.97,1389.72 1108.32,1333.46 1110.67,1494.89 1113.02,1488.9 1115.37,1595.24 1117.72,1430.75 1120.07,1578.12 1122.42,1469.94 1124.77,1565.07 1127.12,1413.74 1129.47,1305.07 1131.82,1474.23 1134.17,1283.14 1136.52,1352.18 1138.87,1419.34 1141.23,1536.08 1143.58,1359.7 1145.93,1534.36 1148.28,1478.05 1150.63,1518.11 1152.98,1367.71 1155.33,1325.54 1157.68,1480.04 1160.03,1489.55 1162.38,1443.95 1164.73,1375.76 1167.08,1388.6 1169.43,1607.04 1171.78,1523.07 1174.13,1550.44 1176.48,1422.51 1178.83,1397.11 1181.18,1540.99 1183.53,1512.26 1185.88,1470.45 1188.23,1380.68 1190.59,1407.97 1192.94,1408.29 1195.29,1583.96 1197.64,1483.88 1199.99,1393.77 1202.34,1267.94 1204.69,1599.54 1207.04,1431.93 1209.39,1427.39 1211.74,1604.13 1214.09,1560.55 1216.44,1645.31 1218.79,1475.96 1221.14,1358.77 1223.49,1554.88 1225.84,1500.64 1228.19,1353.07 1230.54,1306.31 1232.89,1356.09 1235.24,1443.91 1237.59,1654.08 1239.94,1631.75 1242.3,1509.16 1244.65,1312.65 1247,1517.21 1249.35,1281.71 1251.7,1462.5 1254.05,1467.16 1256.4,1548.61 1258.75,1465.23 1261.1,1503.45 1263.45,1430.54 1265.8,1443.27 1268.15,1487.41 1270.5,1481.04 1272.85,1282.9 1275.2,1598.6 1277.55,1453.07 1279.9,1409.78 1282.25,1551.01 1284.6,1521.19 1286.95,1412.23 1289.3,1648.16 1291.66,1420.39 1294.01,1532.41 1296.36,1672.04 1298.71,1465.06 1301.06,1288.98 1303.41,1457.3 1305.76,1507.3 1308.11,1288.68 1310.46,1401.28 1312.81,1522.38 1315.16,1548.04 1317.51,1292.45 1319.86,1552.67 1322.21,1229.49 1324.56,1529.44 1326.91,1526.52 1329.26,1371.11 1331.61,1321.31 1333.96,1509.08 1336.31,1628.41 1338.66,1391.69 1341.02,1315.68 1343.37,1425.7 1345.72,1563.53 1348.07,1671.28 1350.42,1475.1 1352.77,1431.43 1355.12,1519.2 1357.47,1491.13 1359.82,1603.81 1362.17,1417.08 1364.52,1277.54 1366.87,1454.75 1369.22,1302.91 1371.57,1452.4 1373.92,1478.16 1376.27,1168.49 1378.62,1521.49 1380.97,1448.85 1383.32,1480.29 1385.67,1519.03 1388.02,1434.52 1390.38,1379.96 1392.73,1343.8 1395.08,1606.41 1397.43,1529.17 1399.78,1561.4 1402.13,1355.49 1404.48,1359.51 1406.83,1538.73 1409.18,1240.51 1411.53,1553.75 1413.88,1540.46 1416.23,1284.81 1418.58,1665.06 1420.93,1440.28 1423.28,1518.11 1425.63,1399.83 1427.98,1465.73 1430.33,1360.42 1432.68,1405.83 1435.03,1649.8 1437.38,1473.03 1439.74,1397.22 1442.09,1372.58 1444.44,1571.66 1446.79,1476.35 1449.14,1350.5 1451.49,1437.66 1453.84,1339.67 1456.19,1337.38 1458.54,1363.05 1460.89,1308.89 1463.24,1329.29 1465.59,1610.5 1467.94,1176.05 1470.29,1470.79 1472.64,1447.45 1474.99,1396.57 1477.34,1329.57 1479.69,1542.37 1482.04,1435.16 1484.39,1522.81 1486.74,1499.18 1489.1,1342.22 1491.45,1309.75 1493.8,1549.39 1496.15,1216.55 1498.5,1503.69 1500.85,1581.93 1503.2,1300.68 1505.55,1487.32 1507.9,1428.45 1510.25,1460.67 1512.6,1415.35 1514.95,1414.14 1517.3,1617.73 1519.65,1588.25 1522,1545.15 1524.35,1354.4 1526.7,1249.19 1529.05,1542.16 1531.4,1392.53 1533.75,1389.28 1536.1,1459.24 1538.45,1452.71 1540.81,1533.14 1543.16,1496.06 1545.51,1564.59 1547.86,1389.78 1550.21,1602.8 1552.56,1497.78 1554.91,1427.45 1557.26,1574.93 1559.61,1646.05 1561.96,1462.64 1564.31,1334.05 1566.66,1507.37 1569.01,1588.85 1571.36,1451.49 1573.71,1376.49 1576.06,1337.43 1578.41,1387.24 1580.76,1387.08 1583.11,1349 1585.46,1499.89 1587.81,1535.5 1590.17,1594.77 1592.52,1435.75 1594.87,1503.75 1597.22,1224.82 1599.57,1392.42 1601.92,1469.85 1604.27,1527.55 1606.62,1376.49 1608.97,1405.82 1611.32,1414.09 1613.67,1507.74 1616.02,1436.34 1618.37,1483.41 1620.72,1475.14 1623.07,1331.49 1625.42,1413.33 1627.77,1505 1630.12,1403.03 1632.47,1570.84 1634.82,1491.09 1637.17,1604.12 1639.53,1448.14 1641.88,1505.95 1644.23,1557.89 1646.58,1490.78 1648.93,1502.42 1651.28,1386.77 1653.63,1467.35 1655.98,1432.33 1658.33,1383.92 1660.68,1428.61 1663.03,1318.15 1665.38,1494.34 1667.73,1348.46 1670.08,1337.49 1672.43,1510.98 1674.78,1384.19 1677.13,1537.26 1679.48,1123.08 1681.83,1405.82 1684.18,1600.25 1686.53,1355.19 1688.89,1342.72 1691.24,1412.78 1693.59,1520.49 1695.94,1519.61 1698.29,1337.25 1700.64,1266.05 1702.99,1444.69 1705.34,1557.02 1707.69,1345.31 1710.04,1318.41 1712.39,1492.85 1714.74,1277.02 1717.09,1441.78 1719.44,1576.17 1721.79,1325.8 1724.14,1652.07 1726.49,1555.38 1728.84,1386.86 1731.19,1326.99 1733.54,1464.3 1735.89,1461.58 1738.25,1423.78 1740.6,1475.16 1742.95,1486.22 1745.3,1635.45 1747.65,1424.56 1750,1321.22 1752.35,1483.51 1754.7,1365.96 1757.05,1358.26 1759.4,1444.91 1761.75,1287.31 1764.1,1313.88 1766.45,1434.81 1768.8,1475.91 1771.15,1226.51 1773.5,1300.25 1775.85,1565.5 1778.2,1528.01 1780.55,1398.24 1782.9,1236.37 1785.25,1521 1787.6,1418.77 1789.96,1250.02 1792.31,1512.51 1794.66,1309.05 1797.01,1556.31 1799.36,1361.03 1801.71,1380.26 1804.06,1488.79 1806.41,1535.01 1808.76,1510.73 1811.11,1563.96 1813.46,1675.75 1815.81,1299.85 1818.16,1484.66 1820.51,1522.59 1822.86,1500.13 1825.21,1487.28 1827.56,1580.09 1829.91,1431.92 1832.26,1510.1 1834.61,1530.03 1836.96,1631.37 1839.32,1554.16 1841.67,1556.1 1844.02,1433.17 1846.37,1605.6 1848.72,1334.89 1851.07,1377.39 1853.42,1476.88 1855.77,1435.21 1858.12,1533.65 1860.47,1393.7 1862.82,1448.75 1865.17,1592.22 1867.52,1751.15 1869.87,1359.59 1872.22,1426.43 1874.57,1397.19 1876.92,1544.38 1879.27,1474.46 1881.62,1430.82 1883.97,1438.38 1886.32,1195.41 1888.68,1356.57 1891.03,1573.62 1893.38,1620.08 1895.73,1554.71 1898.08,1485.69 1900.43,1486.36 1902.78,1442.08 1905.13,1641.26 1907.48,1529.11 1909.83,1303.91 1912.18,1377.12 1914.53,1539.96 1916.88,1212.31 1919.23,1400.27 1921.58,1400.14 1923.93,1556.69 1926.28,1686.67 1928.63,1676.62 1930.98,1538.65 1933.33,1350.37 1935.68,1532.66 1938.04,1117.85 1940.39,1366.21 1942.74,1387.09 1945.09,1619.58 1947.44,1276.13 1949.79,1463.43 1952.14,1362.94 1954.49,1585.89 1956.84,1435.93 1959.19,1489.39 1961.54,1431.56 1963.89,1381.46 1966.24,1269.92 1968.59,1449.19 1970.94,1609.22 1973.29,1561.97 1975.64,1444.6 1977.99,1520.58 1980.34,1608.6 1982.69,1421.14 1985.04,1352.09 1987.4,1402.53 1989.75,1547.67 1992.1,1346.07 1994.45,1315.63 1996.8,1395.15 1999.15,1472.35 2001.5,1349.55 2003.85,1488.09 2006.2,1479.95 2008.55,1544.7 2010.9,1252.9 2013.25,1320.97 2015.6,1334.81 2017.95,1509.57 2020.3,1436.8 2022.65,1394.83 2025,1438.47 2027.35,1433.16 2029.7,1558.66 2032.05,1364.08 2034.4,1490.47 2036.76,1498.64 2039.11,1220.42 2041.46,1395.58 2043.81,1300.46 2046.16,1251.27 2048.51,1593.53 2050.86,1401.54 2053.21,1620.09 2055.56,1534.58 2057.91,1349.56 2060.26,1303.46 2062.61,1377.46 2064.96,1439.03 2067.31,1596.37 2069.66,1471.61 2072.01,1596.44 2074.36,1177.99 2076.71,1496.3 2079.06,1319.3 2081.41,1454.19 2083.76,1427.11 2086.11,1547.36 2088.47,1660.95 2090.82,1480.31 2093.17,1455.84 2095.52,1389.48 2097.87,1487.78 2100.22,1445.63 2102.57,1432.72 2104.92,1512.42 2107.27,1289.78 2109.62,1514.23 2111.97,1429.51 2114.32,1293.04 2116.67,1401.76 2119.02,1398.82 2121.37,1306.04 2123.72,1542.94 2126.07,1451.8 2128.42,1403.06 2130.77,1344.28 2133.12,1566.76 2135.47,1550.27 2137.83,1311.89 2140.18,1376.06 2142.53,1458.02 2144.88,1418.34 2147.23,1428.99 2149.58,1393.17 2151.93,1379.03 2154.28,1513.96 2156.63,1456.43 2158.98,1469.42 2161.33,1487.4 2163.68,1558.42 2166.03,1570.65 2168.38,1588.2 2170.73,1345.79 2173.08,1410.55 2175.43,1654.66 2177.78,1482.13 2180.13,1476.49 2182.48,1510.19 2184.83,1517.43 2187.19,1428.89 2189.54,1231.77 2191.89,1323.95 2194.24,1395.7 2196.59,1520.06 2198.94,1595.42 2201.29,1536.14 2203.64,1420.26 2205.99,1290.03 2208.34,1383.29 2210.69,1483.05 2213.04,1392.58 2215.39,1438.07 2217.74,1392.81 2220.09,1626.18 2222.44,1331.68 2224.79,1503.34 2227.14,1455.94 2229.49,1314.75 2231.84,1503.14 2234.19,1464.05 2236.55,1596.35 2238.9,1583.31 2241.25,1465.12 2243.6,1448.03 2245.95,1347.47 2248.3,1398.79 2250.65,1611.48 2253,1378.47 2255.35,1440.25 2257.7,1396.3 2260.05,1468.94 2262.4,1429.55 2264.75,1393.68 2267.1,1452.32 2269.45,1498.09 2271.8,1432.45 2274.15,1376.21 2276.5,1303.99 2278.85,1391.22 2281.2,1329.9 2283.55,1259.84 2285.91,1629.66 2288.26,1485.25 2290.61,1354.91 2292.96,1459.87 2295.31,1482.58 2297.66,1496.42 2300.01,1579.72 2302.36,1287.47 2304.71,1580.06 2307.06,1426.2 2309.41,1519.14 2311.76,1323.07 2314.11,1457.7 2316.46,1286.24 2318.81,1507.93 2321.16,1617.9 2323.51,1408.33 2325.86,1634.71 2328.21,1480 2330.56,1416.41 2332.91,1495.74 2335.27,1364.06 2337.62,1502.36 2339.97,1395.61 2342.32,1563.4 2344.67,1566.3 2347.02,1471.11 2349.37,1468.76 2351.72,1478.49 2354.07,1456.79 2356.42,1476.06 2358.77,1300.43 2361.12,1545.04 2363.47,1354.79 2365.82,1556 2368.17,1588.38 2370.52,1471.39 2372.87,1265.05 2375.22,1587.48 2377.57,1364.69 2379.92,1292.53 2382.27,1391.28 2384.62,1507.59 2386.98,1397.2 2389.33,1439.13 2391.68,1424.37 2394.03,1357.21 2396.38,1415.57 2398.73,1451.09 2401.08,1416.03 2403.43,1523.15 2405.78,1359.61 2408.13,1408.69 2410.48,1606.47 2412.83,1433.97 2415.18,1369.26 2417.53,1507.11 2419.88,1456.49 2422.23,1385.09 2424.58,1250.51 2426.93,1459.72 2429.28,1404.95 2431.63,1263.18 2433.98,1559.51 2436.34,1363.4 2438.69,1549.55 2441.04,1406.92 2443.39,1480.78 2445.74,1594.78 2448.09,1290.81 2450.44,1421.97 2452.79,1525.05 2455.14,1333.64 2457.49,1316.79 2459.84,1500.64 2462.19,1294.01 2464.54,1393.06 2466.89,1326.99 2469.24,1480.98 2471.59,1344.87 2473.94,1489.4 2476.29,1557.76 2478.64,1498.69 2480.99,1404.87 2483.34,1573.86 2485.7,1475.37 2488.05,1314.57 2490.4,1478.06 2492.75,1287.63 2495.1,1552.13 2497.45,1405.01 2499.8,1536.34 2502.15,1446.69 2504.5,1436.41 2506.85,1423.44 2509.2,1341.2 2511.55,1298.72 2513.9,1592.01 2516.25,1482.96 2518.6,1489.99 2520.95,1450.05 2523.3,1513.12 2525.65,1425.18 2528,1437.15 2530.35,1500.13 2532.7,1405.56 2535.06,1478.64 2537.41,1329.26 2539.76,1471.97 2542.11,1275.37 2544.46,1582.23 2546.81,1233.19 2549.16,1481.23 2551.51,1395 2553.86,1685.84 2556.21,1405.54 2558.56,1445.75 2560.91,1543.37 2563.26,1417.43 2565.61,1379.19 2567.96,1451.92 2570.31,1474.84 "></polyline>
<polyline clip-path="url(#clip632)" style="stroke:#e26f46; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,798.985 224.541,1000.79 226.891,1023.73 229.242,1187.15 231.592,912.536 233.943,1015.85 236.293,766.523 238.644,935.835 240.994,885.857 243.345,707.47 245.695,968.12 248.046,887.041 250.396,820.085 252.747,955.215 255.097,920.228 257.448,901.272 259.798,997.901 262.148,900.218 264.499,909.229 266.849,923.212 269.2,960.15 271.55,905.233 273.901,964.975 276.251,967.825 278.602,782.397 280.952,973.234 283.303,873.904 285.653,966.494 288.004,973.939 290.354,917.61 292.705,844.931 295.055,1009.23 297.406,1006.26 299.756,1111.27 302.107,967.882 304.457,770.501 306.807,993.315 309.158,1002.03 311.508,1078.15 313.859,834.471 316.209,767.022 318.56,928.253 320.91,703.347 323.261,941.254 325.611,1069.38 327.962,1085.42 330.312,1040.51 332.663,926.509 335.013,909.95 337.364,1022.21 339.714,877.264 342.065,843.13 344.415,832.992 346.765,960.012 349.116,1070.15 351.466,1010.38 353.817,998.614 356.167,959.733 358.518,1119.67 360.868,933.259 363.219,801.377 365.569,967.903 367.92,754.555 370.27,909.767 372.621,1009.94 374.971,835.045 377.322,847.684 379.672,999.083 382.023,841.39 384.373,1066.98 386.724,987.432 389.074,967.496 391.424,777.538 393.775,1207.36 396.125,979.362 398.476,970.656 400.826,936.883 403.177,818.688 405.527,860.901 407.878,995.298 410.228,1007.33 412.579,1079.78 414.929,846.909 417.28,941.19 419.63,975.257 421.981,1137.82 424.331,1019.63 426.682,912.525 429.032,841.94 431.382,966.253 433.733,893.293 436.083,842.511 438.434,1004.4 440.784,1013.91 443.135,1060.08 445.485,891.858 447.836,936.311 450.186,999.101 452.537,821.113 454.887,858.454 457.238,992.307 459.588,1002.51 461.939,1051.61 464.289,946.071 466.64,1039.66 468.99,1021.4 471.341,879.271 473.691,966.382 476.041,962.621 478.392,1072.81 480.742,1019.94 483.093,680.189 485.443,1062.18 487.794,927.766 490.144,879.355 492.495,985.264 494.845,985.989 497.196,1009.07 499.546,852.63 501.897,825.543 504.247,801.94 506.598,759.771 508.948,788.115 511.299,1069.51 513.649,644.061 515.999,793.532 518.35,994.6 520.7,1001.89 523.051,777.678 525.401,993.929 527.752,902.888 530.102,617.797 532.453,742.043 534.803,951.949 537.154,896.349 539.504,853.463 541.855,1052.24 544.205,816.411 546.556,802.857 548.906,991.533 551.257,1033.76 553.607,966.352 555.958,1068.15 558.308,1014.31 560.658,852.236 563.009,894.361 565.359,989.074 567.71,858.497 570.06,905.262 572.411,876.082 574.761,946.876 577.112,905.668 579.462,1073.47 581.813,875.187 584.163,871.18 586.514,913.701 588.864,960.323 591.215,996.7 593.565,830.928 595.916,1032.56 598.266,878.188 600.616,912.84 602.967,842.76 605.317,1053.9 607.668,771.683 610.018,957.636 612.369,965.446 614.719,938.542 617.07,812.912 619.42,702.552 621.771,822.495 624.121,1023.97 626.472,967.48 628.822,874.937 631.173,961.415 633.523,706.851 635.874,831.593 638.224,922.49 640.575,660.594 642.925,891.812 645.275,1124.73 647.626,848.038 649.976,901.022 652.327,909.463 654.677,958.709 657.028,863.218 659.378,938.901 661.729,949.429 664.079,1045.27 666.43,986.895 668.78,839.555 671.131,844.735 673.481,939.725 675.832,1011.6 678.182,1119.69 680.533,908.386 682.883,816.3 685.233,950.976 687.584,1039.42 689.934,1108.68 692.285,932.366 694.635,1087.67 696.986,1028.44 699.336,905.012 701.687,929.79 704.037,1032.04 706.388,777.496 708.738,1026.53 711.089,939.677 713.439,1075.63 715.79,988.444 718.14,956.444 720.491,1010.85 722.841,864.508 725.192,799.182 727.542,867.109 729.892,848.601 732.243,1005.88 734.593,843.516 736.944,934.076 739.294,729.914 741.645,920.4 743.995,974.178 746.346,1000.13 748.696,805.762 751.047,1090.1 753.397,940.718 755.748,827.406 758.098,836.936 760.449,912.084 762.799,978.754 765.15,935.878 767.5,912.294 769.85,930.547 772.201,945.041 774.551,984.923 776.902,974.142 779.252,757.599 781.603,934.157 783.953,995.367 786.304,924.921 788.654,922.486 791.005,1036.86 793.355,981.304 795.706,994.415 798.056,928.565 800.407,980.06 802.757,914.759 805.108,1087.26 807.458,795.951 809.809,937.445 812.159,849.716 814.509,963.237 816.86,931.069 819.21,1007.9 821.561,1146.98 823.911,951.818 826.262,977.924 828.612,894.912 830.963,990.478 833.313,1123.1 835.664,979.838 838.014,992.167 840.365,863.003 842.715,857.884 845.066,865.501 847.416,899.31 849.767,948.204 852.117,972.769 854.467,940.609 856.818,984.952 859.168,771.311 861.519,953.268 863.869,927.017 866.22,1018.74 868.57,1092.73 870.921,1006.7 873.271,813.701 875.622,977.954 877.972,1046.02 880.323,936.392 882.673,827.679 885.024,747.317 887.374,930.544 889.725,1032.11 892.075,1021.21 894.426,837.021 896.776,1075.67 899.126,896.52 901.477,911.587 903.827,959.343 906.178,934.119 908.528,904.321 910.879,1063.76 913.229,830.497 915.58,896.86 917.93,684.488 920.281,956.485 922.631,863.573 924.982,950.925 927.332,1100.62 929.683,987.643 932.033,906.702 934.384,878.288 936.734,951.995 939.084,832.791 941.435,1045.1 943.785,1161.08 946.136,1004.17 948.486,921.592 950.837,1022.07 953.187,968.194 955.538,896.878 957.888,855.874 960.239,946.655 962.589,990.746 964.94,924.126 967.29,998.012 969.641,841.761 971.991,937.401 974.342,871.311 976.692,822.679 979.043,856.269 981.393,832.957 983.743,748.716 986.094,690.298 988.444,841.584 990.795,994.136 993.145,975.01 995.496,926.918 997.846,983.442 1000.2,1050.12 1002.55,871.067 1004.9,822.789 1007.25,965.294 1009.6,913.675 1011.95,1006.14 1014.3,840.525 1016.65,1088.33 1019,865.383 1021.35,806.648 1023.7,869.795 1026.05,899.109 1028.4,870.923 1030.75,1027.31 1033.1,1075.38 1035.45,856.212 1037.8,1179.24 1040.15,845.476 1042.51,1053.32 1044.86,917.069 1047.21,1050.62 1049.56,1002.42 1051.91,731.109 1054.26,817.077 1056.61,1126.01 1058.96,923.538 1061.31,927.84 1063.66,883.32 1066.01,1197.32 1068.36,948.116 1070.71,980.174 1073.06,899.382 1075.41,812.063 1077.76,842.358 1080.11,849.462 1082.46,1027.72 1084.81,1009.32 1087.16,857.934 1089.51,780.594 1091.87,957.029 1094.22,999.611 1096.57,672.323 1098.92,829.053 1101.27,732.723 1103.62,872.082 1105.97,881.244 1108.32,915.6 1110.67,1099.5 1113.02,695.128 1115.37,733.2 1117.72,829.873 1120.07,956.3 1122.42,759.708 1124.77,719.293 1127.12,845.306 1129.47,817.498 1131.82,943.744 1134.17,1059.36 1136.52,820.29 1138.87,990.862 1141.23,836.749 1143.58,904.984 1145.93,921.834 1148.28,710.954 1150.63,822.988 1152.98,806.663 1155.33,936.208 1157.68,830.71 1160.03,1000.91 1162.38,1001.24 1164.73,907.813 1167.08,858.829 1169.43,777.349 1171.78,1009.04 1174.13,1140.64 1176.48,1185.99 1178.83,931.003 1181.18,874.478 1183.53,991.766 1185.88,930.201 1188.23,895.904 1190.59,1025.43 1192.94,892.408 1195.29,904.148 1197.64,926.177 1199.99,930.535 1202.34,893.056 1204.69,768.535 1207.04,1018.88 1209.39,806.542 1211.74,809.48 1214.09,971.241 1216.44,900.016 1218.79,864.562 1221.14,799.39 1223.49,874.249 1225.84,1171.18 1228.19,686.409 1230.54,954.185 1232.89,949.127 1235.24,936.969 1237.59,981.686 1239.94,1046.12 1242.3,1005.91 1244.65,874.694 1247,1065.31 1249.35,866.749 1251.7,997.371 1254.05,975.251 1256.4,877.416 1258.75,910.911 1261.1,964.202 1263.45,997.547 1265.8,794.605 1268.15,921.517 1270.5,744.439 1272.85,846.162 1275.2,1023.97 1277.55,822.215 1279.9,912.633 1282.25,960.632 1284.6,773.449 1286.95,967.214 1289.3,1026.67 1291.66,909.015 1294.01,937.836 1296.36,678.193 1298.71,962.075 1301.06,728.98 1303.41,965.045 1305.76,993.641 1308.11,982.598 1310.46,918.633 1312.81,1059.69 1315.16,884.036 1317.51,804.335 1319.86,956.014 1322.21,879.998 1324.56,1155.69 1326.91,867.791 1329.26,901.351 1331.61,911.449 1333.96,956.667 1336.31,968.714 1338.66,1031.5 1341.02,993.614 1343.37,956.024 1345.72,973.22 1348.07,848.127 1350.42,868.621 1352.77,1036.91 1355.12,844.642 1357.47,971.914 1359.82,979.201 1362.17,956.975 1364.52,814.117 1366.87,934.035 1369.22,1039.73 1371.57,1014.19 1373.92,897.003 1376.27,1082.46 1378.62,922.932 1380.97,896.063 1383.32,898.827 1385.67,1097.68 1388.02,955.258 1390.38,850.515 1392.73,840.676 1395.08,1068.43 1397.43,743.534 1399.78,756.295 1402.13,1032.83 1404.48,900.38 1406.83,857.264 1409.18,831.564 1411.53,850.703 1413.88,997.411 1416.23,918.752 1418.58,1071.61 1420.93,904.17 1423.28,1024.71 1425.63,810.774 1427.98,779.796 1430.33,834.282 1432.68,955.808 1435.03,922.367 1437.38,1160.8 1439.74,990.03 1442.09,809.417 1444.44,914.195 1446.79,1044.33 1449.14,1002.07 1451.49,972.592 1453.84,769.417 1456.19,991.914 1458.54,1017.58 1460.89,1004.76 1463.24,816.983 1465.59,982.017 1467.94,1167.77 1470.29,837.012 1472.64,1064.61 1474.99,1159.82 1477.34,1110.77 1479.69,875.758 1482.04,923.529 1484.39,946.54 1486.74,957.429 1489.1,1019.78 1491.45,940.98 1493.8,983.917 1496.15,896.18 1498.5,739.506 1500.85,939.424 1503.2,938.124 1505.55,885.874 1507.9,803.647 1510.25,1045.7 1512.6,1012.44 1514.95,836.877 1517.3,888.789 1519.65,933.419 1522,1112.05 1524.35,934.389 1526.7,971.586 1529.05,1025.47 1531.4,832.742 1533.75,734.007 1536.1,959.714 1538.45,841.974 1540.81,1119.31 1543.16,1057.7 1545.51,743.474 1547.86,1010.1 1550.21,880.876 1552.56,1101.94 1554.91,709.567 1557.26,923.93 1559.61,1071.16 1561.96,916.121 1564.31,1071.92 1566.66,919.616 1569.01,1156.91 1571.36,894.613 1573.71,880.077 1576.06,962.068 1578.41,719.98 1580.76,852.9 1583.11,1072.44 1585.46,1129.93 1587.81,1095.42 1590.17,921.658 1592.52,751.789 1594.87,959.122 1597.22,1073.3 1599.57,1052.53 1601.92,961.417 1604.27,813.557 1606.62,761.969 1608.97,1029.75 1611.32,989.799 1613.67,974.055 1616.02,1018.01 1618.37,860.245 1620.72,911.039 1623.07,835.185 1625.42,1044.49 1627.77,967.513 1630.12,1026.09 1632.47,830.891 1634.82,1012.11 1637.17,888.172 1639.53,1005.37 1641.88,955.137 1644.23,887.924 1646.58,797.164 1648.93,796.796 1651.28,863.752 1653.63,762.73 1655.98,899.791 1658.33,957.129 1660.68,862.99 1663.03,841.947 1665.38,959.279 1667.73,922.578 1670.08,869.923 1672.43,928.613 1674.78,923.66 1677.13,790.87 1679.48,1071.02 1681.83,1002.94 1684.18,1053.22 1686.53,1040.29 1688.89,919.045 1691.24,990.623 1693.59,1017.07 1695.94,801.42 1698.29,1017.56 1700.64,1018.6 1702.99,906.97 1705.34,895.426 1707.69,1006.27 1710.04,994.214 1712.39,849.109 1714.74,852.397 1717.09,813.984 1719.44,987.713 1721.79,1075.84 1724.14,1016.61 1726.49,930.936 1728.84,912.141 1731.19,837.007 1733.54,914.877 1735.89,987.444 1738.25,660.172 1740.6,861.654 1742.95,958.093 1745.3,922.099 1747.65,748.532 1750,927.715 1752.35,977.416 1754.7,842.414 1757.05,993.276 1759.4,864.209 1761.75,975.411 1764.1,965.42 1766.45,1070.82 1768.8,959.782 1771.15,890.057 1773.5,1045.7 1775.85,899.385 1778.2,1005.61 1780.55,930.509 1782.9,878.23 1785.25,779.826 1787.6,1009.36 1789.96,866.962 1792.31,869.405 1794.66,908.438 1797.01,962.612 1799.36,1051.99 1801.71,899.224 1804.06,990.276 1806.41,829.352 1808.76,765.68 1811.11,913.786 1813.46,756.979 1815.81,727.609 1818.16,792.371 1820.51,874.893 1822.86,915.451 1825.21,969.455 1827.56,823.604 1829.91,726.114 1832.26,1019.19 1834.61,854.563 1836.96,824.239 1839.32,1013.59 1841.67,1033.37 1844.02,897.756 1846.37,728.799 1848.72,1029.05 1851.07,915.589 1853.42,871.015 1855.77,834.599 1858.12,1101.97 1860.47,902.736 1862.82,1069.57 1865.17,897.453 1867.52,995.248 1869.87,895.76 1872.22,943.667 1874.57,790.513 1876.92,840.895 1879.27,991.923 1881.62,753.154 1883.97,1025.14 1886.32,919.979 1888.68,1112.04 1891.03,891.24 1893.38,766.773 1895.73,1080.02 1898.08,1030.55 1900.43,934.721 1902.78,953.341 1905.13,1050.14 1907.48,712.438 1909.83,897.662 1912.18,987.484 1914.53,992.45 1916.88,861.678 1919.23,964.173 1921.58,1034.86 1923.93,857.823 1926.28,775.344 1928.63,851.858 1930.98,819.894 1933.33,711.703 1935.68,950.741 1938.04,914.591 1940.39,994.612 1942.74,1073.67 1945.09,735.68 1947.44,1035.88 1949.79,1140.02 1952.14,1071.42 1954.49,867.159 1956.84,1008.39 1959.19,760.425 1961.54,836.504 1963.89,838.704 1966.24,977.571 1968.59,862.039 1970.94,917.139 1973.29,847.798 1975.64,920.413 1977.99,937.169 1980.34,993.608 1982.69,931.746 1985.04,970.81 1987.4,907.08 1989.75,931.782 1992.1,974.324 1994.45,785.208 1996.8,944.245 1999.15,895.978 2001.5,928.274 2003.85,761.754 2006.2,873.903 2008.55,786.452 2010.9,1009.8 2013.25,960.383 2015.6,945.198 2017.95,966.747 2020.3,1049.5 2022.65,889.985 2025,952.984 2027.35,1015.14 2029.7,888.225 2032.05,949.751 2034.4,810.955 2036.76,818.96 2039.11,854.042 2041.46,772.571 2043.81,800.606 2046.16,936.618 2048.51,884.382 2050.86,880.617 2053.21,893.078 2055.56,957.772 2057.91,907.299 2060.26,906.848 2062.61,875.642 2064.96,947.656 2067.31,987.318 2069.66,860.586 2072.01,1024.46 2074.36,977.407 2076.71,810.894 2079.06,853.703 2081.41,966.045 2083.76,980.671 2086.11,993.556 2088.47,1027.33 2090.82,871.272 2093.17,957.22 2095.52,851.088 2097.87,575.276 2100.22,902.855 2102.57,1043.36 2104.92,895.608 2107.27,856.109 2109.62,875.481 2111.97,1055.1 2114.32,985.24 2116.67,983.291 2119.02,988.289 2121.37,783.37 2123.72,886.944 2126.07,887.217 2128.42,868.062 2130.77,948.65 2133.12,868.904 2135.47,926.195 2137.83,710.915 2140.18,767.001 2142.53,1061.66 2144.88,705.326 2147.23,978.698 2149.58,894.309 2151.93,1001.15 2154.28,930.46 2156.63,893.5 2158.98,889.343 2161.33,974.472 2163.68,872.9 2166.03,1065.49 2168.38,1114.37 2170.73,902.263 2173.08,903.954 2175.43,1064.3 2177.78,930.21 2180.13,1143.36 2182.48,749.65 2184.83,796.288 2187.19,794.57 2189.54,715.091 2191.89,696.692 2194.24,884.6 2196.59,947.526 2198.94,771.362 2201.29,1046.16 2203.64,799.614 2205.99,1094.68 2208.34,861.509 2210.69,769.598 2213.04,1018.16 2215.39,1023.55 2217.74,892.327 2220.09,980.778 2222.44,949.641 2224.79,987.431 2227.14,768.999 2229.49,839.975 2231.84,1072.23 2234.19,1021.47 2236.55,920.348 2238.9,718.055 2241.25,1033.9 2243.6,938.683 2245.95,1062.48 2248.3,780.859 2250.65,980.4 2253,986.949 2255.35,930.809 2257.7,739.558 2260.05,1039.48 2262.4,843.616 2264.75,1071.62 2267.1,944.912 2269.45,833.343 2271.8,984.575 2274.15,938.155 2276.5,922.295 2278.85,856.448 2281.2,1294.52 2283.55,995.067 2285.91,762.695 2288.26,831.239 2290.61,911.826 2292.96,860.134 2295.31,943.19 2297.66,1054.55 2300.01,887.503 2302.36,928.785 2304.71,849.99 2307.06,995.618 2309.41,903.633 2311.76,899.492 2314.11,1052.31 2316.46,965.12 2318.81,757.996 2321.16,945.665 2323.51,865.68 2325.86,970.758 2328.21,851.96 2330.56,877.705 2332.91,895.429 2335.27,859.426 2337.62,1085.98 2339.97,968.561 2342.32,886.535 2344.67,931.296 2347.02,788.842 2349.37,1126.9 2351.72,1010.28 2354.07,928.085 2356.42,897.881 2358.77,948.409 2361.12,926.466 2363.47,826.654 2365.82,966.171 2368.17,868.749 2370.52,862.981 2372.87,1095.9 2375.22,967.982 2377.57,831.158 2379.92,880.535 2382.27,1062.15 2384.62,894.104 2386.98,882.541 2389.33,891.375 2391.68,810.672 2394.03,769.814 2396.38,942.14 2398.73,1024.74 2401.08,965.109 2403.43,708.116 2405.78,1013.15 2408.13,883.693 2410.48,910.992 2412.83,747.278 2415.18,995.797 2417.53,1018.84 2419.88,913.667 2422.23,932.354 2424.58,1174.21 2426.93,1026.77 2429.28,989.424 2431.63,896.268 2433.98,995.908 2436.34,937.865 2438.69,932.173 2441.04,1005.5 2443.39,1024.96 2445.74,833.391 2448.09,922.873 2450.44,1056.96 2452.79,983.822 2455.14,969.47 2457.49,848.367 2459.84,886.931 2462.19,958.641 2464.54,894.373 2466.89,781.329 2469.24,982.721 2471.59,815.012 2473.94,935.934 2476.29,971.407 2478.64,1057.78 2480.99,996.352 2483.34,926.662 2485.7,935.46 2488.05,892.948 2490.4,1128.48 2492.75,752.341 2495.1,945.766 2497.45,1062.8 2499.8,762.938 2502.15,1000.96 2504.5,1115.2 2506.85,1011.26 2509.2,936.03 2511.55,962.365 2513.9,847.959 2516.25,869.493 2518.6,760.311 2520.95,1006.54 2523.3,921.072 2525.65,834.217 2528,915.264 2530.35,862.001 2532.7,870.207 2535.06,1060.74 2537.41,975.744 2539.76,952.326 2542.11,783.188 2544.46,969.958 2546.81,1068.34 2549.16,893.309 2551.51,897.447 2553.86,996.511 2556.21,776.658 2558.56,944.853 2560.91,1033.72 2563.26,753.456 2565.61,967.882 2567.96,947.762 2570.31,836.033 "></polyline>
<polyline clip-path="url(#clip632)" style="stroke:#3da44d; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,567.86 224.541,327.587 226.891,554.473 229.242,448.597 231.592,383.687 233.943,279.243 236.293,505.911 238.644,340.364 240.994,425.149 243.345,293.227 245.695,500.104 248.046,323.981 250.396,259.81 252.747,610.162 255.097,547.127 257.448,548.562 259.798,354.857 262.148,321.922 264.499,241.048 266.849,446.802 269.2,465.008 271.55,353.418 273.901,270.749 276.251,250.895 278.602,587.501 280.952,350.269 283.303,605.88 285.653,504.805 288.004,530.2 290.354,584.27 292.705,354.892 295.055,411.39 297.406,483.283 299.756,474.908 302.107,517.463 304.457,442.767 306.807,560.846 309.158,465.136 311.508,398.859 313.859,380.323 316.209,256.229 318.56,507.39 320.91,328.676 323.261,362.085 325.611,373.496 327.962,444.378 330.312,343.796 332.663,392.4 335.013,332.457 337.364,308.736 339.714,433.124 342.065,522.412 344.415,445.291 346.765,291.746 349.116,638.476 351.466,452.725 353.817,605.921 356.167,422.363 358.518,650.604 360.868,389.459 363.219,132.542 365.569,499.585 367.92,612.059 370.27,611.37 372.621,608.372 374.971,464.585 377.322,502.251 379.672,395.097 382.023,624.971 384.373,388.512 386.724,412.892 389.074,480.641 391.424,308.591 393.775,451.482 396.125,714.348 398.476,572.683 400.826,373.78 403.177,527.486 405.527,567.803 407.878,301.489 410.228,649.792 412.579,577.038 414.929,480.824 417.28,387.168 419.63,324.828 421.981,637.455 424.331,394.824 426.682,537.185 429.032,318.682 431.382,438.22 433.733,418.877 436.083,549.808 438.434,438.452 440.784,510.341 443.135,349.534 445.485,517.594 447.836,298.779 450.186,349.075 452.537,465.717 454.887,513.086 457.238,429.759 459.588,465.919 461.939,514.076 464.289,468.33 466.64,374.249 468.99,487.761 471.341,272.846 473.691,336.732 476.041,299.532 478.392,504.616 480.742,414.4 483.093,659.436 485.443,560.216 487.794,399.635 490.144,427.671 492.495,517.618 494.845,299.262 497.196,358.215 499.546,473.325 501.897,552.102 504.247,245.287 506.598,319.877 508.948,388.058 511.299,362.073 513.649,419.435 515.999,599.052 518.35,341.301 520.7,574.948 523.051,509.789 525.401,447.987 527.752,455.756 530.102,190.491 532.453,222.754 534.803,436.943 537.154,562.91 539.504,448.958 541.855,357.669 544.205,348.133 546.556,364.875 548.906,400.366 551.257,316.571 553.607,386.648 555.958,391.2 558.308,445.243 560.658,307.783 563.009,404.436 565.359,564.724 567.71,346.163 570.06,383.881 572.411,387.507 574.761,459.076 577.112,427.51 579.462,455.867 581.813,445.446 584.163,412.083 586.514,510.915 588.864,308.682 591.215,466.107 593.565,295.536 595.916,421.606 598.266,421.796 600.616,350.088 602.967,498.365 605.317,331.004 607.668,504.258 610.018,478.605 612.369,221.589 614.719,372.894 617.07,368.635 619.42,269.694 621.771,480.104 624.121,357.615 626.472,513.791 628.822,364.491 631.173,552.98 633.523,416.128 635.874,435.511 638.224,338.248 640.575,426.44 642.925,204.394 645.275,419.13 647.626,355.727 649.976,444.18 652.327,431.457 654.677,556.835 657.028,577.519 659.378,427.81 661.729,458.437 664.079,96.8724 666.43,368.534 668.78,434.84 671.131,245.485 673.481,333.913 675.832,506.037 678.182,417.083 680.533,404.993 682.883,473.011 685.233,604.461 687.584,195.984 689.934,507.669 692.285,390.22 694.635,485.472 696.986,292.323 699.336,422.289 701.687,452.315 704.037,422.582 706.388,249.977 708.738,475.393 711.089,457.822 713.439,326.775 715.79,416.59 718.14,341.16 720.491,382.622 722.841,405.295 725.192,333.518 727.542,569.996 729.892,564.148 732.243,369.516 734.593,425.261 736.944,511.402 739.294,417.146 741.645,326.231 743.995,438.406 746.346,430.395 748.696,243.143 751.047,445.969 753.397,335.947 755.748,353.378 758.098,416.29 760.449,381.022 762.799,354.179 765.15,337.028 767.5,385.518 769.85,354.45 772.201,526.42 774.551,383.545 776.902,523.673 779.252,326.754 781.603,432.938 783.953,293.194 786.304,409.298 788.654,307.039 791.005,499.274 793.355,365.726 795.706,446.242 798.056,411.714 800.407,360.365 802.757,404.275 805.108,310.283 807.458,556.588 809.809,549.168 812.159,367.128 814.509,352.8 816.86,605.661 819.21,471.518 821.561,393.268 823.911,495.635 826.262,378.258 828.612,283.215 830.963,435.465 833.313,449.099 835.664,316.201 838.014,528.453 840.365,220.879 842.715,387.199 845.066,436.832 847.416,486.341 849.767,381.691 852.117,370.264 854.467,382.143 856.818,296.072 859.168,368.291 861.519,482.964 863.869,314.023 866.22,577.08 868.57,345.525 870.921,474.555 873.271,355.836 875.622,422.6 877.972,413.39 880.323,284.489 882.673,329.449 885.024,433.348 887.374,417.141 889.725,333.551 892.075,490.61 894.426,509.21 896.776,426.317 899.126,546.046 901.477,455.193 903.827,334.08 906.178,377.753 908.528,315.716 910.879,446.901 913.229,408.301 915.58,493.567 917.93,394.479 920.281,390.557 922.631,428.127 924.982,339.549 927.332,558.263 929.683,421.333 932.033,432.393 934.384,543.488 936.734,339.398 939.084,360.384 941.435,328.074 943.785,428.157 946.136,400.413 948.486,654.843 950.837,560.435 953.187,498.152 955.538,407.665 957.888,558.213 960.239,374.083 962.589,545.556 964.94,458.977 967.29,447.191 969.641,515.176 971.991,551.59 974.342,542.587 976.692,450.209 979.043,368.403 981.393,396.67 983.743,525.06 986.094,299.668 988.444,531.351 990.795,396.942 993.145,491.368 995.496,400.143 997.846,465.798 1000.2,380.334 1002.55,402.572 1004.9,195.508 1007.25,780.144 1009.6,374.367 1011.95,503.478 1014.3,436.247 1016.65,378.864 1019,486.025 1021.35,440.274 1023.7,500.668 1026.05,283.847 1028.4,274.303 1030.75,374.893 1033.1,469.883 1035.45,325.122 1037.8,399.942 1040.15,445.514 1042.51,436.43 1044.86,420.67 1047.21,392.293 1049.56,454.667 1051.91,272.049 1054.26,537.194 1056.61,626.012 1058.96,441.594 1061.31,201.276 1063.66,314.863 1066.01,306.85 1068.36,442.251 1070.71,318.684 1073.06,526.827 1075.41,394.898 1077.76,327.493 1080.11,567.547 1082.46,388.586 1084.81,400.14 1087.16,497.644 1089.51,621.896 1091.87,342.236 1094.22,254.481 1096.57,390.006 1098.92,443.581 1101.27,401.747 1103.62,452.673 1105.97,461.944 1108.32,389.692 1110.67,295.577 1113.02,270.333 1115.37,445.194 1117.72,394.171 1120.07,459.641 1122.42,450.695 1124.77,432.629 1127.12,476.537 1129.47,703.084 1131.82,337.557 1134.17,462.567 1136.52,315.4 1138.87,465.718 1141.23,341.329 1143.58,622.506 1145.93,537.19 1148.28,237.723 1150.63,501.924 1152.98,356.304 1155.33,378.868 1157.68,202.378 1160.03,443.338 1162.38,466.544 1164.73,448.064 1167.08,399.815 1169.43,394.457 1171.78,222.853 1174.13,500.711 1176.48,533.152 1178.83,232.322 1181.18,570.329 1183.53,443.992 1185.88,291.023 1188.23,444.299 1190.59,614.604 1192.94,514.662 1195.29,387.933 1197.64,305.778 1199.99,393.732 1202.34,453.756 1204.69,475.081 1207.04,387.156 1209.39,508.975 1211.74,569.742 1214.09,540 1216.44,420.347 1218.79,305.788 1221.14,571.314 1223.49,434.667 1225.84,452.092 1228.19,395.34 1230.54,358.459 1232.89,528.366 1235.24,407.697 1237.59,324.256 1239.94,492.051 1242.3,330.435 1244.65,363.267 1247,386.126 1249.35,540.568 1251.7,364.754 1254.05,533.75 1256.4,403.391 1258.75,454.041 1261.1,449.823 1263.45,389.229 1265.8,329.847 1268.15,419.312 1270.5,344.133 1272.85,283.361 1275.2,511.834 1277.55,359.664 1279.9,515.337 1282.25,368.519 1284.6,324.788 1286.95,403.122 1289.3,619.559 1291.66,264.651 1294.01,526.208 1296.36,388.682 1298.71,476.789 1301.06,312.69 1303.41,452.522 1305.76,270.86 1308.11,404.769 1310.46,477.622 1312.81,452.557 1315.16,479.876 1317.51,348.96 1319.86,428.876 1322.21,178.531 1324.56,223.935 1326.91,416.533 1329.26,577.317 1331.61,553.239 1333.96,430.54 1336.31,419.003 1338.66,449.3 1341.02,352.71 1343.37,330.474 1345.72,561.766 1348.07,493.387 1350.42,483.514 1352.77,393.285 1355.12,309.821 1357.47,468.94 1359.82,512.784 1362.17,480.263 1364.52,384.502 1366.87,474.976 1369.22,534.063 1371.57,500.424 1373.92,339.663 1376.27,423.673 1378.62,450.833 1380.97,433.803 1383.32,329.35 1385.67,511.819 1388.02,250.748 1390.38,510.934 1392.73,658.689 1395.08,341.734 1397.43,455.342 1399.78,530.415 1402.13,428.484 1404.48,327.759 1406.83,463.206 1409.18,501.539 1411.53,467.982 1413.88,406.793 1416.23,404.873 1418.58,486.04 1420.93,260.466 1423.28,440.786 1425.63,487.962 1427.98,345.805 1430.33,372.03 1432.68,229.646 1435.03,386.432 1437.38,265.848 1439.74,292.947 1442.09,420.884 1444.44,468.572 1446.79,594.2 1449.14,449.333 1451.49,210.111 1453.84,378.886 1456.19,485.461 1458.54,515.362 1460.89,331.69 1463.24,345.485 1465.59,266.881 1467.94,294.258 1470.29,454.617 1472.64,345.072 1474.99,496.494 1477.34,244.95 1479.69,301.072 1482.04,523.464 1484.39,453.72 1486.74,323.299 1489.1,513.565 1491.45,322.299 1493.8,390.195 1496.15,283.088 1498.5,295.435 1500.85,446.786 1503.2,313.165 1505.55,399.182 1507.9,412.787 1510.25,540.351 1512.6,429.214 1514.95,620.892 1517.3,462.261 1519.65,323.362 1522,531.162 1524.35,493.962 1526.7,510.077 1529.05,427.832 1531.4,304.601 1533.75,226.264 1536.1,435.328 1538.45,477.43 1540.81,424.891 1543.16,364.72 1545.51,486.935 1547.86,447.043 1550.21,462.112 1552.56,379.021 1554.91,354.988 1557.26,246.877 1559.61,490.543 1561.96,355.397 1564.31,321.074 1566.66,337.133 1569.01,577.031 1571.36,192.523 1573.71,508.773 1576.06,331.379 1578.41,438.27 1580.76,341.675 1583.11,420.117 1585.46,379.659 1587.81,279.078 1590.17,386.41 1592.52,505.483 1594.87,496.581 1597.22,473.014 1599.57,501.808 1601.92,438.61 1604.27,518.583 1606.62,534.153 1608.97,391.145 1611.32,415.594 1613.67,507.958 1616.02,371.412 1618.37,448.014 1620.72,302.058 1623.07,335.689 1625.42,445.862 1627.77,474.432 1630.12,469.915 1632.47,271.923 1634.82,397.968 1637.17,326.488 1639.53,522.373 1641.88,234.136 1644.23,427.024 1646.58,592.465 1648.93,330.915 1651.28,377.099 1653.63,621.05 1655.98,572.893 1658.33,365.579 1660.68,431.954 1663.03,607.406 1665.38,447.751 1667.73,399.697 1670.08,420.382 1672.43,525.271 1674.78,380.554 1677.13,500.126 1679.48,403.732 1681.83,405.284 1684.18,299.779 1686.53,430.01 1688.89,360.821 1691.24,348.566 1693.59,399.444 1695.94,343.39 1698.29,514.335 1700.64,363.315 1702.99,328.462 1705.34,723.789 1707.69,413.356 1710.04,451.453 1712.39,391.185 1714.74,294.219 1717.09,406.25 1719.44,358.128 1721.79,444.039 1724.14,460.223 1726.49,426.676 1728.84,501.175 1731.19,343.019 1733.54,322.212 1735.89,435.637 1738.25,296.501 1740.6,631.202 1742.95,477.675 1745.3,297.725 1747.65,434.391 1750,451.527 1752.35,392.396 1754.7,436.697 1757.05,422.2 1759.4,264.327 1761.75,482.089 1764.1,642.255 1766.45,317.904 1768.8,436.202 1771.15,535.502 1773.5,430.463 1775.85,335.015 1778.2,330.024 1780.55,379.104 1782.9,517.311 1785.25,330.922 1787.6,350.031 1789.96,253.81 1792.31,367.427 1794.66,416.839 1797.01,461.391 1799.36,311.993 1801.71,490.193 1804.06,383.894 1806.41,288.965 1808.76,271.615 1811.11,376.705 1813.46,366.164 1815.81,407.11 1818.16,392.873 1820.51,527.848 1822.86,199.253 1825.21,445.187 1827.56,515.508 1829.91,525.991 1832.26,354.463 1834.61,444.766 1836.96,382.352 1839.32,560.174 1841.67,499.54 1844.02,402.882 1846.37,470.059 1848.72,277.841 1851.07,168.764 1853.42,165.595 1855.77,315.113 1858.12,446.076 1860.47,518.685 1862.82,369.359 1865.17,376.112 1867.52,426.424 1869.87,472.812 1872.22,445.483 1874.57,245.719 1876.92,557.951 1879.27,372.265 1881.62,458.395 1883.97,374.858 1886.32,387.04 1888.68,417.838 1891.03,479.829 1893.38,431.345 1895.73,352.167 1898.08,465.803 1900.43,359.492 1902.78,304.505 1905.13,464.958 1907.48,464.782 1909.83,321.011 1912.18,506.552 1914.53,435.517 1916.88,396.306 1919.23,340.551 1921.58,232.169 1923.93,403.059 1926.28,556.87 1928.63,407.116 1930.98,538.753 1933.33,371.046 1935.68,415.194 1938.04,272.755 1940.39,559.717 1942.74,400.703 1945.09,266.761 1947.44,349.439 1949.79,525.582 1952.14,329.453 1954.49,321.123 1956.84,326.175 1959.19,400.656 1961.54,336.714 1963.89,184.775 1966.24,524.59 1968.59,309.73 1970.94,489.481 1973.29,400.679 1975.64,522.691 1977.99,417.402 1980.34,275.42 1982.69,326.494 1985.04,291.155 1987.4,328.155 1989.75,480.746 1992.1,297.92 1994.45,412.425 1996.8,445.18 1999.15,318.371 2001.5,275.387 2003.85,443.664 2006.2,388.521 2008.55,469.994 2010.9,423.089 2013.25,386.71 2015.6,314.52 2017.95,439.953 2020.3,501.417 2022.65,644.89 2025,440.604 2027.35,526.764 2029.7,355.104 2032.05,615.205 2034.4,492.273 2036.76,404.839 2039.11,462.746 2041.46,472.9 2043.81,528.248 2046.16,374.225 2048.51,402.392 2050.86,234.598 2053.21,541.705 2055.56,536.118 2057.91,478.618 2060.26,374.695 2062.61,377.612 2064.96,353.367 2067.31,343.688 2069.66,294.972 2072.01,333.859 2074.36,489.732 2076.71,485.059 2079.06,453.479 2081.41,462.054 2083.76,361.842 2086.11,567.192 2088.47,330.829 2090.82,375.181 2093.17,465.872 2095.52,416.539 2097.87,470.817 2100.22,389.405 2102.57,602.822 2104.92,332.819 2107.27,404.448 2109.62,308.007 2111.97,622.921 2114.32,493.056 2116.67,370.978 2119.02,359.069 2121.37,343.107 2123.72,294.176 2126.07,623.338 2128.42,392.797 2130.77,267.007 2133.12,367.705 2135.47,491.971 2137.83,540.316 2140.18,538.296 2142.53,334.183 2144.88,301.821 2147.23,516.93 2149.58,271.563 2151.93,431.395 2154.28,441.633 2156.63,380.859 2158.98,384.857 2161.33,515.752 2163.68,455.259 2166.03,463.022 2168.38,239.35 2170.73,453.536 2173.08,399.469 2175.43,373.645 2177.78,412.734 2180.13,325.083 2182.48,446.206 2184.83,528.732 2187.19,444.095 2189.54,391.166 2191.89,477.264 2194.24,299.643 2196.59,445.772 2198.94,354.366 2201.29,473.247 2203.64,353.262 2205.99,442.159 2208.34,419.843 2210.69,421.547 2213.04,489.846 2215.39,466.849 2217.74,244.795 2220.09,274.589 2222.44,313.248 2224.79,415.285 2227.14,199.045 2229.49,364.475 2231.84,589.742 2234.19,328.221 2236.55,528.036 2238.9,172.741 2241.25,201.014 2243.6,248.734 2245.95,487.685 2248.3,365.294 2250.65,495.668 2253,625.299 2255.35,454.419 2257.7,441.861 2260.05,587.829 2262.4,508.104 2264.75,169.406 2267.1,434.859 2269.45,504.059 2271.8,505.266 2274.15,310.673 2276.5,457.086 2278.85,373.993 2281.2,410.779 2283.55,320.447 2285.91,342.91 2288.26,356.73 2290.61,491.032 2292.96,394.54 2295.31,521.676 2297.66,524.594 2300.01,489.346 2302.36,525.731 2304.71,294.456 2307.06,303.118 2309.41,513.057 2311.76,646.275 2314.11,242.866 2316.46,341.991 2318.81,272.203 2321.16,288.823 2323.51,416.994 2325.86,507.089 2328.21,573.585 2330.56,482.097 2332.91,527.247 2335.27,448.655 2337.62,410.786 2339.97,627.187 2342.32,422.431 2344.67,334.958 2347.02,258.389 2349.37,532.402 2351.72,466.175 2354.07,440.867 2356.42,374.186 2358.77,310.684 2361.12,438.851 2363.47,288.545 2365.82,470.905 2368.17,510.406 2370.52,501.58 2372.87,350.157 2375.22,461.512 2377.57,370.441 2379.92,431.389 2382.27,353.935 2384.62,322.641 2386.98,369.541 2389.33,323.147 2391.68,480.093 2394.03,533.955 2396.38,381.331 2398.73,481.413 2401.08,257.99 2403.43,400.25 2405.78,263.922 2408.13,576.731 2410.48,377.231 2412.83,602.386 2415.18,298.907 2417.53,562.762 2419.88,625.314 2422.23,488.471 2424.58,346.451 2426.93,390.72 2429.28,356.666 2431.63,548.732 2433.98,546.418 2436.34,558.131 2438.69,383.703 2441.04,472.4 2443.39,258.503 2445.74,307.175 2448.09,208.386 2450.44,432.33 2452.79,543.159 2455.14,585.583 2457.49,649.931 2459.84,431.733 2462.19,332.073 2464.54,402.256 2466.89,347.894 2469.24,178.693 2471.59,404.015 2473.94,227.733 2476.29,449.45 2478.64,280.546 2480.99,516.386 2483.34,515.294 2485.7,200.976 2488.05,423.654 2490.4,285.228 2492.75,664.502 2495.1,558.029 2497.45,372.815 2499.8,355.537 2502.15,492.678 2504.5,456.826 2506.85,498.684 2509.2,481.093 2511.55,385.491 2513.9,291.691 2516.25,450.253 2518.6,374.193 2520.95,533.354 2523.3,433.831 2525.65,501.877 2528,526.243 2530.35,447.336 2532.7,352.502 2535.06,389.221 2537.41,535.328 2539.76,423.758 2542.11,367.755 2544.46,448.048 2546.81,469.943 2549.16,434.074 2551.51,402.222 2553.86,498.58 2556.21,457.988 2558.56,615.171 2560.91,488.518 2563.26,405.373 2565.61,388.065 2567.96,665.427 2570.31,307.794 "></polyline>
</svg>
</div>
</div>
<p>Look at that! Things are working; amazin’.</p>
<p>We can also exploit <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>’s parallel sampling capabilities:</p>
<div id="34" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run separate 4 chains for 10 000 iterations using threads to parallelize.</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>num_chains <span class="op">=</span> <span class="fl">4</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    model_with_grad,</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">MCMCThreads</span>(),</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>,</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    num_chains;</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Note we need to provide an initial state for every chain.</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>    initial_state<span class="op">=</span><span class="fu">fill</span>(state, num_chains),</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>samples_array <span class="op">=</span> <span class="fu">stack</span>(<span class="fu">map</span>(<span class="bu">Base</span>.<span class="fu">Fix1</span>(stack, sample <span class="op">-&gt;</span> sample.x), samples))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000×4 Array{Float64, 3}:
[:, :, 1] =
 -2.57494  -5.32123  -5.32123  -6.38979   …  -3.52048   -2.894     -2.83206
  2.28202   2.36168   2.36168   0.523649      0.197329  -0.209372  -0.180002
  2.19565   3.98426   3.98426   6.87771       5.44395    3.53872    4.49218

[:, :, 2] =
 -1.78651  -2.81181   -3.48898   -4.93342   …  -4.21626   -3.84691  -5.56938
  1.23822  -0.373973   0.316445   0.157178      0.265339   1.5605    0.706869
  1.39883   2.11288    7.56491    4.75847       5.28625    5.38042   3.68952

[:, :, 3] =
 -2.58644   -3.77583  -3.16462  -3.25596  …  -5.13188  -5.86914  -5.83763
 -0.247976   1.84889   1.04936  -1.22955     -1.39919  -0.8453   -0.856566
  2.24297    3.83635   4.90853   3.47796      4.19059   3.75581   4.20481

[:, :, 4] =
 -2.83548   -4.21059   -3.30318  -4.83882   …  -4.26357   -4.33169  -4.29581
 -0.660794  -0.458501   1.36999   0.196934     -0.835623  -1.33694  -0.269923
  1.70601    3.10426    4.5491    4.72542       3.59639    4.61994   6.26703</code></pre>
</div>
</div>
<p>But the fact that we have to provide the <code>AbstractMCMC.sample</code> call, etc. with an <code>initial_state</code> to get started is a bit annoying. We can avoid this by also defining a <code>AbstractMCMC.step</code> <em>without</em> the <code>state</code> argument:</p>
<div id="36" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">::</span><span class="dt">MALA</span>;</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># </span><span class="al">NOTE</span><span class="co">: No state provided!</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just create the initial state by sampling using  a Gaussian.</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="fu">randn</span>(rng, LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(x), <span class="fu">MALAState</span>(x)</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Equipped with this, we no longer need to provide the <code>initial_state</code> everywhere:</p>
<div id="38" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -4.98067    1.00708
 -0.0123109  1.01248
  4.99208    0.998571</code></pre>
</div>
</div>
</section>
<section id="using-our-sampler-with-turing.jl" class="level2">
<h2 class="anchored" data-anchor-id="using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</h2>
<p>As we promised, all of this hassle of implementing our <code>MALA</code> sampler in a way that uses <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> and <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> gets us something more than <em>just</em> an “automatic” implementation of <code>AbstractMCMC.sample</code>.</p>
<p>It also enables use with Turing.jl through the <code>externalsampler</code>, but we need to do one final thing first: we need to tell Turing.jl how to extract a vector of parameters from the “sample” returned in our implementation of <code>AbstractMCMC.step</code>. In our case, the “sample” is a <code>MALASample</code>, so we just need the following line:</p>
<div id="40" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Turing</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">DynamicPPL</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Overload the `getparams` method for our "sample" type, which is just a vector.</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>Turing.Inference.<span class="fu">getparams</span>(<span class="op">::</span><span class="dt">DynamicPPL.Model</span>, sample<span class="op">::</span><span class="dt">MALASample</span>) <span class="op">=</span> sample.x</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And with that, we’re good to go!</p>
<div id="42" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Our previous model defined as a Turing.jl model.</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">mvnormal_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">MvNormal</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.], I)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate our model.</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">mvnormal_model</span>()</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Call `sample` but now we're passing in a Turing.jl `model` and wrapping</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co"># our `MALA` sampler in the `externalsampler` to tell Turing.jl that the sampler</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co"># expects something that implements LogDensityProblems.jl.</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×4×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 2.92 seconds
Compute duration  = 2.92 seconds
parameters        = x[1], x[2], x[3]
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters  </span><span class="ansi-bold">    mean  </span><span class="ansi-bold">     std  </span><span class="ansi-bold">    mcse  </span><span class="ansi-bold">  ess_bulk  </span><span class="ansi-bold">  ess_tail  </span><span class="ansi-bold">    rhat  </span><span class="ansi-bold"> ⋯
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">   Float64  </span><span class="ansi-bright-black-fg ansi-bold">   Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> ⋯

        x[1]   -5.0055    1.0022    0.0180   3095.5820   4999.1184    1.0001   ⋯
        x[2]    0.0318    0.9958    0.0168   3493.7661   5108.0573    1.0002   ⋯
        x[3]    4.9908    0.9984    0.0171   3414.9580   4802.5288    1.0005   ⋯
</span><span class="ansi-cyan-fg ansi-bold">                                                                1 column omitted

Quantiles
 </span><span class="ansi-cyan-fg ansi-bold"> parameters  </span><span class="ansi-cyan-fg ansi-bold">    2.5%  </span><span class="ansi-cyan-fg ansi-bold">   25.0%  </span><span class="ansi-cyan-fg ansi-bold">   50.0%  </span><span class="ansi-cyan-fg ansi-bold">   75.0%  </span><span class="ansi-cyan-fg ansi-bold">   97.5%
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64

        x[1]   -6.9763   -5.6749   -4.9974   -4.3440   -3.0349
        x[2]   -1.9194   -0.6443    0.0313    0.7236    1.9892
        x[3]    3.0801    4.3035    5.0030    5.6730    6.9484
</span></pre>
</div>
</div>
</div>
<p>Pretty neat, eh?</p>
<section id="models-with-constrained-parameters" class="level3">
<h3 class="anchored" data-anchor-id="models-with-constrained-parameters">Models with constrained parameters</h3>
<p>One thing we’ve sort of glossed over in all of the above is that MALA, at least how we’ve implemented it, requires <span class="math inline">\(x\)</span> to live in <span class="math inline">\(\mathbb{R}^d\)</span> for some <span class="math inline">\(d &gt; 0\)</span>. If some of the parameters were in fact constrained, e.g.&nbsp;we were working with a <code>Beta</code> distribution which has support on the interval <span class="math inline">\((0, 1)\)</span>, <em>not</em> on <span class="math inline">\(\mathbb{R}^d\)</span>, we could easily end up outside of the valid range <span class="math inline">\((0, 1)\)</span>.</p>
<div id="44" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">beta_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">beta_model</span>()</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 1.62 seconds
Compute duration  = 1.62 seconds
parameters        = x
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters  </span><span class="ansi-bold">    mean  </span><span class="ansi-bold">     std  </span><span class="ansi-bold">    mcse  </span><span class="ansi-bold">  ess_bulk  </span><span class="ansi-bold">  ess_tail  </span><span class="ansi-bold">    rhat  </span><span class="ansi-bold"> ⋯
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">   Float64  </span><span class="ansi-bright-black-fg ansi-bold">   Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> ⋯

           x    0.5023    0.1915    0.0028   4392.2515   5081.4337    1.0004   ⋯
</span><span class="ansi-cyan-fg ansi-bold">                                                                1 column omitted

Quantiles
 </span><span class="ansi-cyan-fg ansi-bold"> parameters  </span><span class="ansi-cyan-fg ansi-bold">    2.5%  </span><span class="ansi-cyan-fg ansi-bold">   25.0%  </span><span class="ansi-cyan-fg ansi-bold">   50.0%  </span><span class="ansi-cyan-fg ansi-bold">   75.0%  </span><span class="ansi-cyan-fg ansi-bold">   97.5%
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64

           x    0.1418    0.3614    0.5041    0.6439    0.8566
</span></pre>
</div>
</div>
</div>
<p>Yep, that still works, but only because Turing.jl actually <em>transforms</em> the <code>turing_model</code> from constrained to unconstrained, so that the <code>sampler</code> provided to <code>externalsampler</code> is actually always working in unconstrained space! This is not always desirable, so we can turn this off:</p>
<div id="46" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 0.25 seconds
Compute duration  = 0.25 seconds
parameters        = x
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters  </span><span class="ansi-bold">    mean  </span><span class="ansi-bold">     std  </span><span class="ansi-bold">    mcse  </span><span class="ansi-bold"> ess_bulk  </span><span class="ansi-bold"> ess_tail  </span><span class="ansi-bold">    rhat  </span><span class="ansi-bold"> e ⋯
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">  Float64  </span><span class="ansi-bright-black-fg ansi-bold">  Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">   ⋯

           x    0.4424    0.1754    0.0221    51.7815    22.9010    1.0506     ⋯
</span><span class="ansi-cyan-fg ansi-bold">                                                                1 column omitted

Quantiles
 </span><span class="ansi-cyan-fg ansi-bold"> parameters  </span><span class="ansi-cyan-fg ansi-bold">    2.5%  </span><span class="ansi-cyan-fg ansi-bold">   25.0%  </span><span class="ansi-cyan-fg ansi-bold">   50.0%  </span><span class="ansi-cyan-fg ansi-bold">   75.0%  </span><span class="ansi-cyan-fg ansi-bold">   97.5%
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64

           x    0.1914    0.2711    0.4392    0.5792    0.7666
</span></pre>
</div>
</div>
</div>
<p>The fun thing is that this still sort of works because</p>
<div id="48" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">logpdf</span>(<span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>), <span class="fl">10.0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-Inf</code></pre>
</div>
</div>
<p>and so the samples that fall outside of the range are always rejected. But do notice how much worse all the diagnostics are, e.g.&nbsp;<code>ess_tail</code> is very poor compared to when we use <code>unconstrained=true</code>. Moreover, in more complex cases this won’t just result in a “nice” <code>-Inf</code> log-density value, but instead will error:</p>
<div id="50" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="kw">function</span> <span class="fu">demo</span>()</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>    σ² <span class="op">~</span> <span class="fu">truncated</span>(<span class="fu">Normal</span>(), lower<span class="op">=</span><span class="fl">0</span>)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If we end up with negative values for `σ²`, the `Normal` will error.</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>    x <span class="op">~</span> <span class="fu">Normal</span>(<span class="fl">0</span>, σ²)</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre>DomainError with -1.3109583904711535:
Normal: the condition σ &gt;= zero(σ) is not satisfied.
Stacktrace:
  [1] <span class="ansi-bold">#371</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/YQSrn/src/univariate/continuous/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">normal.jl:37</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [2] <span class="ansi-bold">check_args</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/YQSrn/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">utils.jl:89</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [3] <span class="ansi-bold">#Normal#370</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/YQSrn/src/univariate/continuous/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">normal.jl:37</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [4] <span class="ansi-bold">Normal</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/YQSrn/src/univariate/continuous/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">normal.jl:36</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [5] <span class="ansi-bold">Normal</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/YQSrn/src/univariate/continuous/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">normal.jl:42</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [6] <span class="ansi-bold">macro expansion</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/nxcz4/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">compiler.jl:558</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [7] <span class="ansi-bold">demo</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">__model__</span>::Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DefaultContext}</span>, <span class="ansi-bright-black-fg">__varinfo__</span>::DynamicPPL.ThreadSafeVarInfo<span class="ansi-bright-black-fg">{VarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}, Vector{Base.RefValue{Float64}}}</span>, <span class="ansi-bright-black-fg">__context__</span>::DefaultContext<span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-magenta-fg">Main.Notebook</span> <span class="ansi-bright-black-fg">~/work/docs/docs/developers/inference/implementing-samplers/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">index.qmd:457</span>
  [8] <span class="ansi-bold">_evaluate!!</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/nxcz4/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">model.jl:913</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [9] <span class="ansi-bold">evaluate_threadsafe!!</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">model</span>::Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DefaultContext}</span>, <span class="ansi-bright-black-fg">varinfo</span>::VarInfo<span class="ansi-bright-black-fg">{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}</span>, <span class="ansi-bright-black-fg">context</span>::DefaultContext<span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-cyan-fg">DynamicPPL</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/nxcz4/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">model.jl:902</span>
 [10] <span class="ansi-bold">evaluate!!</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/nxcz4/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">model.jl:832</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [11] <span class="ansi-bold">make_updated_varinfo</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">f</span>::LogDensityFunction<span class="ansi-bright-black-fg">{Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DefaultContext}, VarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}, DefaultContext, AutoForwardDiff{2, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}}}</span>, <span class="ansi-bright-black-fg">external_transition</span>::MALASample<span class="ansi-bright-black-fg">{Vector{Float64}}</span>, <span class="ansi-bright-black-fg">external_state</span>::MALAState<span class="ansi-bright-black-fg">{Vector{Float64}}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-green-fg">Turing.Inference</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/V6zn0/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">external_sampler.jl:134</span>
 [12] <span class="ansi-bold">step</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">rng</span>::TaskLocalRNG, <span class="ansi-bright-black-fg">model</span>::Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DefaultContext}</span>, <span class="ansi-bright-black-fg">sampler_wrapper</span>::Sampler<span class="ansi-bright-black-fg">{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}</span>; <span class="ansi-bright-black-fg">initial_state</span>::Nothing, <span class="ansi-bright-black-fg">initial_params</span>::Nothing, <span class="ansi-bright-black-fg">kwargs</span>::@Kwargs<span class="ansi-bright-black-fg">{}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-green-fg">Turing.Inference</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/V6zn0/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">external_sampler.jl:185</span>
 [13] <span class="ansi-bold">macro expansion</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/AbstractMCMC/7f1oY/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">sample.jl:0</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [14] <span class="ansi-bold">(::AbstractMCMC.var"#25#26"{Nothing, Int64, Int64, Int64, UnionAll, Nothing, @Kwargs{}, TaskLocalRNG, Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DefaultContext}, Sampler{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}, Int64, Float64, Int64, Int64})</span><span class="ansi-bold">(</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-yellow-fg">AbstractMCMC</span> <span class="ansi-bright-black-fg">~/.julia/packages/AbstractMCMC/7f1oY/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">logging.jl:134</span>
 [15] <span class="ansi-bold">with_logstate</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">f</span>::AbstractMCMC.var"#25#26"<span class="ansi-bright-black-fg">{Nothing, Int64, Int64, Int64, UnionAll, Nothing, @Kwargs{}, TaskLocalRNG, Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DefaultContext}, Sampler{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}, Int64, Float64, Int64, Int64}</span>, <span class="ansi-bright-black-fg">logstate</span>::Base.CoreLogging.LogState<span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">Base.CoreLogging</span> <span class="ansi-bright-black-fg">./logging/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">logging.jl:524</span>
 [16] <span class="ansi-bold">with_logger</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">f</span>::Function, <span class="ansi-bright-black-fg">logger</span>::LoggingExtras.TeeLogger<span class="ansi-bright-black-fg">{Tuple{LoggingExtras.EarlyFilteredLogger{TerminalLoggers.TerminalLogger, AbstractMCMC.var"#1#3"{Module}}, LoggingExtras.EarlyFilteredLogger{Base.CoreLogging.ConsoleLogger, AbstractMCMC.var"#2#4"{Module}}}}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">Base.CoreLogging</span> <span class="ansi-bright-black-fg">./logging/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">logging.jl:635</span>
 [17] <span class="ansi-bold">with_progresslogger</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">f</span>::Function, <span class="ansi-bright-black-fg">_module</span>::Module, <span class="ansi-bright-black-fg">logger</span>::Base.CoreLogging.ConsoleLogger<span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-yellow-fg">AbstractMCMC</span> <span class="ansi-bright-black-fg">~/.julia/packages/AbstractMCMC/7f1oY/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">logging.jl:157</span>
 [18] <span class="ansi-bold">macro expansion</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/AbstractMCMC/7f1oY/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">logging.jl:133</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [19] <span class="ansi-bold">mcmcsample</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">rng</span>::TaskLocalRNG, <span class="ansi-bright-black-fg">model</span>::Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DefaultContext}</span>, <span class="ansi-bright-black-fg">sampler</span>::Sampler<span class="ansi-bright-black-fg">{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}</span>, <span class="ansi-bright-black-fg">N</span>::Int64; <span class="ansi-bright-black-fg">progress</span>::Bool, <span class="ansi-bright-black-fg">progressname</span>::String, <span class="ansi-bright-black-fg">callback</span>::Nothing, <span class="ansi-bright-black-fg">num_warmup</span>::Int64, <span class="ansi-bright-black-fg">discard_initial</span>::Int64, <span class="ansi-bright-black-fg">thinning</span>::Int64, <span class="ansi-bright-black-fg">chain_type</span>::Type, <span class="ansi-bright-black-fg">initial_state</span>::Nothing, <span class="ansi-bright-black-fg">kwargs</span>::@Kwargs<span class="ansi-bright-black-fg">{}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-yellow-fg">AbstractMCMC</span> <span class="ansi-bright-black-fg">~/.julia/packages/AbstractMCMC/7f1oY/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">sample.jl:151</span>
 [20] <span class="ansi-bold">sample</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">rng</span>::TaskLocalRNG, <span class="ansi-bright-black-fg">model</span>::Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DefaultContext}</span>, <span class="ansi-bright-black-fg">sampler</span>::Sampler<span class="ansi-bright-black-fg">{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}</span>, <span class="ansi-bright-black-fg">N</span>::Int64; <span class="ansi-bright-black-fg">chain_type</span>::Type, <span class="ansi-bright-black-fg">resume_from</span>::Nothing, <span class="ansi-bright-black-fg">initial_state</span>::Nothing, <span class="ansi-bright-black-fg">kwargs</span>::@Kwargs<span class="ansi-bright-black-fg">{progress::Bool}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-cyan-fg">DynamicPPL</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/nxcz4/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">sampler.jl:102</span>
 [21] <span class="ansi-bold">sample</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/nxcz4/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">sampler.jl:92</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [22] <span class="ansi-bold">#sample#101</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/V6zn0/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">abstractmcmc.jl:29</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [23] <span class="ansi-bold">sample</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/V6zn0/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">abstractmcmc.jl:20</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [24] <span class="ansi-bold">#sample#100</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/V6zn0/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">abstractmcmc.jl:17</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [25] top-level scope
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/work/docs/docs/developers/inference/implementing-samplers/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">index.qmd:459</span></pre>
</div>
</div>
</div>
<p>As expected, we run into a <code>DomainError</code> at some point, while if we set <code>unconstrained=true</code>, letting Turing.jl transform the model to a unconstrained form behind the scenes, everything works as expected:</p>
<div id="52" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 1.87 seconds
Compute duration  = 1.87 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters  </span><span class="ansi-bold">    mean  </span><span class="ansi-bold">     std  </span><span class="ansi-bold">    mcse  </span><span class="ansi-bold"> ess_bulk  </span><span class="ansi-bold"> ess_tail  </span><span class="ansi-bold">    rhat  </span><span class="ansi-bold"> e ⋯
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">  Float64  </span><span class="ansi-bright-black-fg ansi-bold">  Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">   ⋯

          σ²    0.3972    0.0000    0.0000        NaN        NaN       NaN     ⋯
           x    1.7717    0.0000    0.0000        NaN        NaN       NaN     ⋯
</span><span class="ansi-cyan-fg ansi-bold">                                                                1 column omitted

Quantiles
 </span><span class="ansi-cyan-fg ansi-bold"> parameters  </span><span class="ansi-cyan-fg ansi-bold">    2.5%  </span><span class="ansi-cyan-fg ansi-bold">   25.0%  </span><span class="ansi-cyan-fg ansi-bold">   50.0%  </span><span class="ansi-cyan-fg ansi-bold">   75.0%  </span><span class="ansi-cyan-fg ansi-bold">   97.5%
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64

          σ²    0.3972    0.3972    0.3972    0.3972    0.3972
           x    1.7717    1.7717    1.7717    1.7717    1.7717
</span></pre>
</div>
</div>
</div>
<p>Neat!</p>
<p>Similarly, which automatic differentiation backend one should use can be specified through the <code>adtype</code> keyword argument too. For example, if we want to use <a href="https://github.com/JuliaDiff/ReverseDiff.jl">ReverseDiff.jl</a> instead of the default <a href="https://github.com/JuliaDiff/ForwardDiff.jl">ForwardDiff.jl</a>:</p>
<div id="54" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">ReverseDiff</span>: ReverseDiff</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify that we want to use `AutoReverseDiff`.</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">demo</span>(),</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>, adtype<span class="op">=</span><span class="fu">AutoReverseDiff</span>()),</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>;</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 3.0 seconds
Compute duration  = 3.0 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters  </span><span class="ansi-bold">    mean  </span><span class="ansi-bold">     std  </span><span class="ansi-bold">    mcse  </span><span class="ansi-bold"> ess_bulk  </span><span class="ansi-bold"> ess_tail  </span><span class="ansi-bold">    rhat  </span><span class="ansi-bold"> e ⋯
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">  Float64  </span><span class="ansi-bright-black-fg ansi-bold">  Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">   ⋯

          σ²    0.8150    0.5736    0.0266   364.8802   120.6666    1.0024     ⋯
           x    0.0064    0.9237    0.0439   601.3329   496.4281    1.0016     ⋯
</span><span class="ansi-cyan-fg ansi-bold">                                                                1 column omitted

Quantiles
 </span><span class="ansi-cyan-fg ansi-bold"> parameters  </span><span class="ansi-cyan-fg ansi-bold">    2.5%  </span><span class="ansi-cyan-fg ansi-bold">   25.0%  </span><span class="ansi-cyan-fg ansi-bold">   50.0%  </span><span class="ansi-cyan-fg ansi-bold">   75.0%  </span><span class="ansi-cyan-fg ansi-bold">   97.5%
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64

          σ²    0.1271    0.3655    0.6793    1.1487    2.2110
           x   -1.9887   -0.3681   -0.0063    0.3636    2.1345
</span></pre>
</div>
</div>
</div>
<p>Double-neat.</p>
</section>
</section>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<p>At this point it’s worth maybe reminding ourselves what we did and also <em>why</em> we did it:</p>
<ol type="1">
<li>We define our models in the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface because it makes the sampler agnostic to how the underlying model is implemented.</li>
<li>We implement our sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> interface, which just means that our sampler is a subtype of <code>AbstractMCMC.AbstractSampler</code> and we implement the MCMC transition in <code>AbstractMCMC.step</code>.</li>
<li>Points 1 and 2 makes it so our sampler can be used with a wide range of model implementations, amongst them being models implemented in both Turing.jl and Stan. This gives you, the inference implementer, a large collection of models to test your inference method on, in addition to allowing users of Turing.jl and Stan to try out your inference method with minimal effort.</li>
</ol>


</section>


<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a><div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>We’re going with the leapfrog formulation because in a future version of this tutorial we’ll add a section extending this simple “baseline” MALA sampler to more complex versions. See <a href="https://github.com/TuringLang/docs/issues/479">issue #479</a> for progress on this.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>There is no such thing as a proper interface in Julia (at least not officially), and so we use the word “interface” here to mean a few minimal methods that needs to be implemented by any type that we treat as a target model.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    // Ensure there is a toggle, if there isn't float one in the top right
    if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
      const a = window.document.createElement('a');
      a.classList.add('top-right');
      a.classList.add('quarto-color-scheme-toggle');
      a.href = "";
      a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
      const i = window.document.createElement("i");
      i.classList.add('bi');
      a.appendChild(i);
      window.document.body.appendChild(a);
    }
    setColorSchemeToggle(hasAlternateSentinel())
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/turinglang\.org\/docs\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../../developers/inference/variational-inference/index.html" class="pagination-link" aria-label="Variational Inference">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Variational Inference</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Turing is created by <a href="http://mlg.eng.cam.ac.uk/hong/" target="_blank">Hong Ge</a>, and lovingly maintained by the <a href="https://github.com/TuringLang/Turing.jl/graphs/contributors" target="_blank">core team</a> of volunteers. <br> The contents of this website are © 2018–2025 under the terms of the <a href="https://github.com/TuringLang/docs/blob/main/LICENCE" target="_blank">MIT License</a>.</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/TuringLang/docs/edit/main/developers/inference/implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/docs/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://x.com/TuringLang">
      <i class="bi bi-twitter" role="img" aria-label="Turing Twitter">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/TuringLang/Turing.jl">
      <i class="bi bi-github" role="img" aria-label="Turing GitHub">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




<script src="../../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>