<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Implementing samplers – Turing.jl</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../tutorials/docs-07-for-developers-variational-inference/index.html" rel="prev">
<link href="../../assets/favicon.ico" rel="icon">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<style>
  a {
    text-decoration: none;
  }
  a:hover {
    text-decoration: underline;
  }
</style>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../theming/styles.css">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="https://turinglang.org/" class="navbar-brand navbar-brand-logo">
    <img src="../../assets/images/turing-logo.svg" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="https://turinglang.org/">
    <span class="navbar-title">Turing.jl</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../tutorials/docs-00-getting-started/"> 
<span class="menu-text">Get Started</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../tutorials/00-introduction/"> 
<span class="menu-text">Tutorials</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/library/"> 
<span class="menu-text">Libraries</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/news/"> 
<span class="menu-text">News</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/team/"> 
<span class="menu-text">Team</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-v0.34" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">v0.34</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-v0.34">    
        <li>
    <a class="dropdown-item" href="https://turinglang.org/docs/changelog.html">
 <span class="dropdown-text">Changelog</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://turinglang.org/docs/versions.html">
 <span class="dropdown-text">All Versions</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
    <a href="https://x.com/TuringLang" title="Turing Twitter" class="quarto-navigation-tool px-1" aria-label="Turing Twitter"><i class="bi bi-twitter"></i></a>
    <a href="https://github.com/TuringLang/Turing.jl" title="Turing GitHub" class="quarto-navigation-tool px-1" aria-label="Turing GitHub"><i class="bi bi-github"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Documentation</li><li class="breadcrumb-item"><a href="../../tutorials/docs-04-for-developers-abstractmcmc-turing/index.html">Developers: Inference</a></li><li class="breadcrumb-item"><a href="../../tutorials/docs-17-implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Documentation</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false">
 <span class="menu-text">Using Turing - Modelling Syntax and Interface</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-00-getting-started/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Getting Started</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-14-using-turing-quick-start/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Quick Start</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-12-using-turing-guide/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Guide</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-17-mode-estimation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Mode Estimation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-09-using-turing-advanced/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Advanced Usage</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-10-using-turing-autodiff/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Automatic Differentiation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-13-using-turing-performance-tips/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Performance Tips</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-11-using-turing-dynamichmc/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using DynamicHMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-15-using-turing-sampler-viz/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Sampler Visualization</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-16-using-turing-external-samplers/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">External Samplers</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false">
 <span class="menu-text">Using Turing - Tutorials</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/00-introduction/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction to Turing</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/01-gaussian-mixture-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Mixture Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/02-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/03-bayesian-neural-network/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Neural Networks</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/04-hidden-markov-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Hidden Markov Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/05-linear-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Linear Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/06-infinite-mixture-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Infinite Mixture Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/07-poisson-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Poisson Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/08-multinomial-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Multinomial Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/09-variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/10-bayesian-differential-equations/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Differential Equations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/11-probabilistic-pca/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Probabilistic PCA</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/13-seasonal-time-series/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Time Series Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/15-gaussian-processes/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction to Gaussian Processes</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/12-gplvm/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Process Latent Variable Models</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false">
 <span class="menu-text">Developers: Contributing</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-01-contributing-guide/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">How to Contribute</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false">
 <span class="menu-text">Developers: PPL</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-05-for-developers-compiler/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Turing Compiler Design</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/14-minituring/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation I: Compiler</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/16-contexts/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation II: Contexts</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-06-for-developers-interface/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Interface Guide</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true">
 <span class="menu-text">Developers: Inference</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-04-for-developers-abstractmcmc-turing/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">How Turing implements AbstractMCMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-07-for-developers-variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-17-implementing-samplers/index.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Implementing Samplers</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of Contents</h2>
   
  <ul>
  <li><a href="#quick-overview-of-mala" id="toc-quick-overview-of-mala" class="nav-link active" data-scroll-target="#quick-overview-of-mala">Quick overview of MALA</a></li>
  <li><a href="#what-we-need-from-a-model-logdensityproblems.jl" id="toc-what-we-need-from-a-model-logdensityproblems.jl" class="nav-link" data-scroll-target="#what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: LogDensityProblems.jl</a></li>
  <li><a href="#implementing-mala-in-abstractmcmc.jl" id="toc-implementing-mala-in-abstractmcmc.jl" class="nav-link" data-scroll-target="#implementing-mala-in-abstractmcmc.jl">Implementing MALA in AbstractMCMC.jl</a></li>
  <li><a href="#using-our-sampler-with-turing.jl" id="toc-using-our-sampler-with-turing.jl" class="nav-link" data-scroll-target="#using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</a>
  <ul class="collapse">
  <li><a href="#models-with-constrained-parameters" id="toc-models-with-constrained-parameters" class="nav-link" data-scroll-target="#models-with-constrained-parameters">Models with constrained parameters</a></li>
  </ul></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/TuringLang/docs/edit/master/tutorials/docs-17-implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/docs/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Documentation</li><li class="breadcrumb-item"><a href="../../tutorials/docs-04-for-developers-abstractmcmc-turing/index.html">Developers: Inference</a></li><li class="breadcrumb-item"><a href="../../tutorials/docs-17-implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Implementing samplers</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>In this tutorial, we’ll go through step-by-step how to implement a “simple” sampler in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> in such a way that it can be easily applied to Turing.jl models.</p>
<p>In particular, we’re going to implement a version of <strong>Metropolis-adjusted Langevin (MALA)</strong>.</p>
<p>Note that we will implement this sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> framework, completely “ignoring” Turing.jl until the very end of the tutorial, at which point we’ll use a single line of code to make the resulting sampler available to Turing.jl. This is to really drive home the point that one can implement samplers in a way that is accessible to all of Turing.jl’s users without having to use Turing.jl yourself.</p>
<section id="quick-overview-of-mala" class="level2">
<h2 class="anchored" data-anchor-id="quick-overview-of-mala">Quick overview of MALA</h2>
<p>We can view MALA as a single step of the leapfrog intergrator with resampling of momentum <span class="math inline">\(p\)</span> at every step.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> To make that statement a bit more concrete, we first define the <em>extended</em> target <span class="math inline">\(\bar{\gamma}(x, p)\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\log \bar{\gamma}(x, p) \propto \log \gamma(x) + \log \gamma_{\mathcal{N}(0, M)}(p)
\end{equation*}\]</span></p>
<p>where <span class="math inline">\(\gamma_{\mathcal{N}(0, M)}\)</span> denotes the density for a zero-centered Gaussian with covariance matrix <span class="math inline">\(M\)</span>. We then consider targeting this joint distribution over both <span class="math inline">\(x\)</span> and <span class="math inline">\(p\)</span> as follows. First we define the map</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  L_{\epsilon}: \quad &amp; \mathbb{R}^d \times \mathbb{R}^d \to \mathbb{R}^d \times \mathbb{R}^d \\
  &amp; (x, p) \mapsto (\tilde{x}, \tilde{p}) := L_{\epsilon}(x, p)
\end{split}
\end{equation*}\]</span></p>
<p>as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p_{1 / 2} &amp;:= p + \frac{\epsilon}{2} \nabla \log \gamma(x) \\
  \tilde{x} &amp;:= x + \epsilon M^{-1} p_{1 /2 } \\
  p_1 &amp;:= p_{1 / 2} + \frac{\epsilon}{2} \nabla \log \gamma(\tilde{x}) \\
  \tilde{p} &amp;:= - p_1
\end{split}
\end{equation*}\]</span></p>
<p>This might be familiar for some readers as a single step of the Leapfrog integrator. We then define the MALA kernel as follows: given the current iterate <span class="math inline">\(x_i\)</span>, we sample the next iterate <span class="math inline">\(x_{i + 1}\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p &amp;\sim \mathcal{N}(0, M) \\
  (\tilde{x}, \tilde{p}) &amp;:= L_{\epsilon}(x_i, p) \\
  \alpha &amp;:= \min \left\{ 1, \frac{\bar{\gamma}(\tilde{x}, \tilde{p})}{\bar{\gamma}(x_i, p)} \right\} \\
  x_{i + 1} &amp;:=
  \begin{cases}
    \tilde{x} \quad &amp; \text{ with prob. } \alpha \\
    x_i       \quad &amp; \text{ with prob. } 1 - \alpha
  \end{cases}
\end{split}
\end{equation*}\]</span></p>
<p>i.e.&nbsp;we accept the proposal <span class="math inline">\(\tilde{x}\)</span> with probability <span class="math inline">\(\alpha\)</span> and reject it, thus sticking with our current iterate, with probability <span class="math inline">\(1 - \alpha\)</span>.</p>
</section>
<section id="what-we-need-from-a-model-logdensityproblems.jl" class="level2">
<h2 class="anchored" data-anchor-id="what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a></h2>
<p>There are a few things we need from the “target” / “model” / density that we want to sample from:</p>
<ol type="1">
<li>We need access to log-density <em>evaluations</em> <span class="math inline">\(\log \gamma(x)\)</span> so we can compute the acceptance ratio involving <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>We need access to log-density <em>gradients</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span> so we can compute the Leapfrog steps <span class="math inline">\(L_{\epsilon}(x, p)\)</span>.</li>
<li>We also need access to the “size” of the model so we can determine the size of <span class="math inline">\(M\)</span>.</li>
</ol>
<p>Luckily for us, there is a package called <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> which provides an interface for <em>exactly</em> this!</p>
<p>To demonstrate how one can implement the “<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface”<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> we will use a simple Gaussian model as an example:</p>
<div id="4" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblems</span>: LogDensityProblems;</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's define some type that represents the model.</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> IsotropicNormalModel{M<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"mean of the isotropic Gaussian"</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    mean<span class="op">::</span><span class="dt">M</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Specifies what input length the model expects.</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">dimension</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> <span class="fu">length</span>(model.mean)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Implementation of the log-density evaluation of the model.</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x<span class="op">::</span><span class="dt">AbstractVector{&lt;:Real}</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">-</span> <span class="fu">sum</span>(abs2, x <span class="op">.-</span> model.mean) <span class="op">/</span> <span class="fl">2</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This gives us all of the properties we want for our MALA sampler with the exception of the computation of the <em>gradient</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span>. There is the method <code>LogDensityProblems.logdensity_and_gradient</code> which should return a 2-tuple where the first entry is the evaluation of the logdensity <span class="math inline">\(\log \gamma(x)\)</span> and the second entry is the gradient <span class="math inline">\(\nabla \log \gamma(x)\)</span>.</p>
<p>There are two ways to “implement” this method: 1) we implement it by hand, which is feasible in the case of our <code>IsotropicNormalModel</code>, or b) we defer the implementation of this to a automatic differentiation backend.</p>
<p>To implement it by hand we can simply do</p>
<div id="6" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl that first-order, i.e. gradient information, is available.</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{1}</span>()</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Implement `logdensity_and_gradient`.</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    logγ_x <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="op">-</span>x <span class="op">.*</span> (x <span class="op">-</span> model.mean)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> logγ_x, ∇logγ_x</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s just try it out:</p>
<div id="8" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate the problem.</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> <span class="fu">IsotropicNormalModel</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.])</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create some example input that we can test on.</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>x_example <span class="op">=</span> <span class="fu">randn</span>(LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate!</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-30.85748992766459</code></pre>
</div>
</div>
<p>To defer it to an automatic differentiation backend, we can do</p>
<div id="10" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl we only have access to 0-th order information.</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{0}</span>()</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Use `LogDensityProblemsAD`'s `ADgradient` in combination with some AD backend to implement `logdensity_and_gradient`.</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblemsAD</span>, <span class="bu">ADTypes</span>, <span class="bu">ForwardDiff</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>model_with_grad <span class="op">=</span> <span class="fu">ADgradient</span>(<span class="fu">AutoForwardDiff</span>(), model)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model_with_grad, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-30.85748992766459</code></pre>
</div>
</div>
<p>We’ll continue with the second approach in this tutorial since this is typically what one does in practice, because there are better hobbies to spend time on than deriving gradients by hand.</p>
<p>At this point, one might wonder how we’re going to tie this back to Turing.jl in the end. Effectively, when working with inference methods that only require log-density evaluations and / or higher-order information of the log-density, Turing.jl actually converts the user-provided <code>Model</code> into an object implementing the above methods for <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>. As a result, most samplers provided by Turing.jl are actually implemented to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, enabling their use both <em>within</em> Turing.jl and <em>outside</em> of Turing.jl! Morever, there exists similar conversions for Stan through BridgeStan and Stan<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, which means that a sampler supporting the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface can easily be used on both Turing.jl <em>and</em> Stan models (in addition to user-provided models, as our <code>IsotropicNormalModel</code> above)!</p>
<p>Anyways, let’s move on to actually implementing the sampler.</p>
</section>
<section id="implementing-mala-in-abstractmcmc.jl" class="level2">
<h2 class="anchored" data-anchor-id="implementing-mala-in-abstractmcmc.jl">Implementing MALA in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a></h2>
<p>Now that we’ve established that a model implementing the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface provides us with all the information we need from <span class="math inline">\(\log \gamma(x)\)</span>, we can address the question: given an object that implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, how can we define a sampler for it?</p>
<p>We’re going to do this by making our sampler a sub-type of <code>AbstractMCMC.AbstractSampler</code> in addition to implementing a few methods from <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>. Why? Because it gets us <em>a lot</em> of functionality for free, as we will see later.</p>
<p>Moreover, <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> provides a very natural interface for MCMC algorithms.</p>
<p>First, we’ll define our <code>MALA</code> type</p>
<div id="12" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">AbstractMCMC</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALA{T,A} <span class="op">&lt;:</span><span class="dt"> AbstractMCMC.AbstractSampler</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"stepsize used in the leapfrog step"</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    ϵ_init<span class="op">::</span><span class="dt">T</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"covariance matrix used for the momentum"</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    M_init<span class="op">::</span><span class="dt">A</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notice how we’ve added the suffix <code>_init</code> to both the stepsize and the covariance matrix. We’ve done this because a <code>AbstractMCMC.AbstractSampler</code> should be <em>immutable</em>. Of course there might be many scenarios where we want to allow something like the stepsize and / or the covariance matrix to vary between iterations, e.g.&nbsp;during the burn-in / adaptation phase of the sampling process we might want to adjust the parameters using statistics computed from these initial iterations. But information which can change between iterations <em>should not go in the sampler itself</em>! Instead, this information should go in the sampler <em>state</em>.</p>
<p>The sampler state should at the very least contain all the necessary information to perform the next MCMC iteration, but usually contains further information, e.g.&nbsp;quantities and statistics useful for evaluating whether the sampler has converged.</p>
<p>We will use the following sampler state for our <code>MALA</code> sampler:</p>
<div id="14" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALAState{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This might seem overly redundant: we’re defining a type <code>MALAState</code> and it only contains a simple vector of reals. In this particular case we indeed could have dropped this and simply used a <code>AbstractVector{&lt;:Real}</code> as our sampler state, but typically, as we will see later, one wants to include other quantities in the sampler state. For example, if we also wanted to adapt the parameters of our <code>MALA</code>, e.g.&nbsp;alter the stepsize depending on acceptance rates, in which case we should also put <code>ϵ</code> in the state, but for now we’ll keep things simple.</p>
<p>Moreover, we also want a <em>sample</em> type, which is a type meant for “public consumption”, i.e.&nbsp;the end-user. This is generally going to contain a subset of the information present in the state. But in such a simple scenario as this, we similarly only have a <code>AbstractVector{&lt;:Real}</code>:</p>
<div id="16" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALASample{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We currently have three things:</p>
<ol type="1">
<li>A <code>AbstractMCMC.AbstractSampler</code> implementation called <code>MALA</code>.</li>
<li>A state <code>MALAState</code> for our sampler <code>MALA</code>.</li>
<li>A sample <code>MALASample</code> for our sampler <code>MALA</code>.</li>
</ol>
<p>That means that we’re ready to implement the only thing that really matters: <code>AbstractMCMC.step</code>.</p>
<p><code>AbstractMCMC.step</code> defines the MCMC iteration of our <code>MALA</code> given the current <code>MALAState</code>. Specifically, the signature of the function is as follows:</p>
<div id="18" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The RNG to ensure reproducibility.</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The model that defines our target.</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.AbstractModel</span>,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The sampler for which we're taking a `step`.</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">AbstractMCMC.AbstractSampler</span>,</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The current sampler `state`.</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    state;</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Additional keyword arguments that we may or may not need.</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Moreover, there is a specific <code>AbstractMCMC.AbstractModel</code> which is used to indicate that the model that is provided implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface: <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Since, as we discussed earlier, in our case we’re indeed going to work with types that support the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, we’ll define <code>AbstractMCMC.step</code> for such a <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Note that <code>AbstractMCMC.LogDensityModel</code> has no other purpose; it has a single field called <code>logdensity</code>, and it does nothing else. But by wrapping the model in <code>AbstractMCMC.LogDensityModel</code>, it allows samplers that want to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> to define their <code>AbstractMCMC.step</code> on this type without running into method ambiguities.</p>
<p>All in all, that means that the signature for our <code>AbstractMCMC.step</code> is going to be the following:</p>
<div id="20" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># `LogDensityModel` so we know we're working with LogDensityProblems.jl model.</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler.</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler state.</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Great! Now let’s actually implement the full <code>AbstractMCMC.step</code> for our <code>MALA</code>.</p>
<p>Let’s remind ourselves what we’re going to do:</p>
<ol type="1">
<li>Sample a new momentum <span class="math inline">\(p\)</span>.</li>
<li>Compute the log-density of the extended target <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>Take a single leapfrog step <span class="math inline">\((\tilde{x}, \tilde{p}) = L_{\epsilon}(x, p)\)</span>.</li>
<li>Accept or reject the proposed <span class="math inline">\((\tilde{x}, \tilde{p})\)</span>.</li>
</ol>
<p>All in all, this results in the following:</p>
<div id="22" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>: Random</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Distributions</span>  <span class="co"># so we get the `MvNormal`</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the wrapped model which implements LogDensityProblems.jl.</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just extract the sampler parameters to make our lives easier.</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    ϵ <span class="op">=</span> sampler.ϵ_init</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    M <span class="op">=</span> sampler.M_init</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the current parameters.</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> state.x</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sample the momentum.</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>    p_dist <span class="op">=</span> <span class="fu">MvNormal</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)), M)</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> <span class="fu">rand</span>(rng, p_dist)</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Propose using a single leapfrog step.</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>    x̃, p̃ <span class="op">=</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Accept or reject proposal.</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>    logp <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p)</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>    logp̃ <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x̃) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p̃)</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>    logα <span class="op">=</span> logp̃ <span class="op">-</span> logp</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>    state_new <span class="op">=</span> <span class="cf">if</span> <span class="fu">log</span>(<span class="fu">rand</span>(rng)) <span class="op">&lt;</span> logα</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Accept.</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x̃)</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Reject.</span></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x)</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return the "sample" and the sampler state.</span></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(state_new.x), state_new</span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Fairly straight-forward.</p>
<p>Of course, we haven’t defined the <code>leapfrog_step</code> method yet, so let’s do that:</p>
<div id="24" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p` using "position" `x`.</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x))</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    p1 <span class="op">=</span> p <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update the "position" `x` using momentum `p1`.</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    x̃ <span class="op">=</span> x <span class="op">+</span> ϵ <span class="op">.*</span> (M <span class="op">\</span> p1)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p1` using position `x̃`</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x̃ <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x̃))</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    p2 <span class="op">=</span> p1 <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x̃</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Flip momentum `p2`.</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    p̃ <span class="op">=</span> <span class="op">-</span>p2</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x̃, p̃</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>leapfrog_step (generic function with 1 method)</code></pre>
</div>
</div>
<p>With all of this, we’re technically ready to sample!</p>
<div id="26" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>, <span class="bu">LinearAlgebra</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>rng <span class="op">=</span> <span class="bu">Random</span>.<span class="fu">default_rng</span>()</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>sampler <span class="op">=</span> <span class="fu">MALA</span>(<span class="fl">1</span>, I)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>state <span class="op">=</span> <span class="fu">MALAState</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)))</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>x_next, state_next <span class="op">=</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    rng,</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    AbstractMCMC.<span class="fu">LogDensityModel</span>(model),</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    state</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>(MALASample{Vector{Float64}}([0.0, 0.0, 0.0]), MALAState{Vector{Float64}}([0.0, 0.0, 0.0]))</code></pre>
</div>
</div>
<p>Great, it works!</p>
<p>And I promised we would get quite some functionality for free if we implemented <code>AbstractMCMC.step</code>, and so we can now simply call <code>sample</code> to perform standard MCMC sampling:</p>
<div id="28" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform 1000 iterations with our `MALA` sampler.</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; initial_state<span class="op">=</span>state, progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Concatenate into a matrix.</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000 Matrix{Float64}:
 -1.15972   -6.13432   -5.70929   …  -5.41206   -4.43814   -4.02451
 -0.985016  -0.930966  -0.939834     -0.704447   0.268243   0.0116127
  2.36532    5.30205    5.49484       5.60113    6.1182     5.85871</code></pre>
</div>
</div>
<div id="30" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the marginal means and standard deviations.</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -4.96972    1.00605
 -0.0100478  0.981818
  4.98807    0.993659</code></pre>
</div>
</div>
<p>Let’s visualize the samples</p>
<div id="32" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">StatsPlots</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">transpose</span>(samples_matrix[<span class="op">:</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">:</span><span class="kw">end</span>]), alpha<span class="op">=</span><span class="fl">0.5</span>, legend<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<!--?xml version="1.0" encoding="utf-8"?-->
<svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" width="672" height="480" viewbox="0 0 2688 1920">
<defs>
  <clippath id="clip460">
    <rect x="0" y="0" width="2688" height="1920"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip460)" d="M0 1920 L2688 1920 L2688 0 L0 0  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip461">
    <rect x="537" y="0" width="1883" height="1883"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip460)" d="M151.747 1800.78 L2640.76 1800.78 L2640.76 47.2441 L151.747 47.2441  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip462">
    <rect x="151" y="47" width="2490" height="1755"></rect>
  </clippath>
</defs>
<polyline clip-path="url(#clip462)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="219.84,1800.78 219.84,47.2441 "></polyline>
<polyline clip-path="url(#clip462)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="807.458,1800.78 807.458,47.2441 "></polyline>
<polyline clip-path="url(#clip462)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1395.08,1800.78 1395.08,47.2441 "></polyline>
<polyline clip-path="url(#clip462)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1982.69,1800.78 1982.69,47.2441 "></polyline>
<polyline clip-path="url(#clip462)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="2570.31,1800.78 2570.31,47.2441 "></polyline>
<polyline clip-path="url(#clip462)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,1545.88 2640.76,1545.88 "></polyline>
<polyline clip-path="url(#clip462)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,1237.91 2640.76,1237.91 "></polyline>
<polyline clip-path="url(#clip462)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,929.937 2640.76,929.937 "></polyline>
<polyline clip-path="url(#clip462)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,621.968 2640.76,621.968 "></polyline>
<polyline clip-path="url(#clip462)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,313.999 2640.76,313.999 "></polyline>
<polyline clip-path="url(#clip460)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1800.78 2640.76,1800.78 "></polyline>
<polyline clip-path="url(#clip460)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="219.84,1800.78 219.84,1781.88 "></polyline>
<polyline clip-path="url(#clip460)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="807.458,1800.78 807.458,1781.88 "></polyline>
<polyline clip-path="url(#clip460)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1395.08,1800.78 1395.08,1781.88 "></polyline>
<polyline clip-path="url(#clip460)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1982.69,1800.78 1982.69,1781.88 "></polyline>
<polyline clip-path="url(#clip460)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="2570.31,1800.78 2570.31,1781.88 "></polyline>
<path clip-path="url(#clip460)" d="M219.84 1834 Q216.229 1834 214.4 1837.57 Q212.595 1841.11 212.595 1848.24 Q212.595 1855.34 214.4 1858.91 Q216.229 1862.45 219.84 1862.45 Q223.474 1862.45 225.28 1858.91 Q227.108 1855.34 227.108 1848.24 Q227.108 1841.11 225.28 1837.57 Q223.474 1834 219.84 1834 M219.84 1830.3 Q225.65 1830.3 228.706 1834.9 Q231.784 1839.49 231.784 1848.24 Q231.784 1856.96 228.706 1861.57 Q225.65 1866.15 219.84 1866.15 Q214.03 1866.15 210.951 1861.57 Q207.896 1856.96 207.896 1848.24 Q207.896 1839.49 210.951 1834.9 Q214.03 1830.3 219.84 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip460)" d="M771.15 1861.55 L787.47 1861.55 L787.47 1865.48 L765.525 1865.48 L765.525 1861.55 Q768.187 1858.79 772.771 1854.16 Q777.377 1849.51 778.558 1848.17 Q780.803 1845.65 781.683 1843.91 Q782.585 1842.15 782.585 1840.46 Q782.585 1837.71 780.641 1835.97 Q778.72 1834.23 775.618 1834.23 Q773.419 1834.23 770.965 1835 Q768.535 1835.76 765.757 1837.31 L765.757 1832.59 Q768.581 1831.46 771.035 1830.88 Q773.488 1830.3 775.525 1830.3 Q780.896 1830.3 784.09 1832.98 Q787.285 1835.67 787.285 1840.16 Q787.285 1842.29 786.474 1844.21 Q785.687 1846.11 783.581 1848.7 Q783.002 1849.37 779.9 1852.59 Q776.798 1855.78 771.15 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip460)" d="M797.331 1830.92 L815.687 1830.92 L815.687 1834.86 L801.613 1834.86 L801.613 1843.33 Q802.632 1842.98 803.65 1842.82 Q804.669 1842.64 805.687 1842.64 Q811.474 1842.64 814.854 1845.81 Q818.233 1848.98 818.233 1854.4 Q818.233 1859.97 814.761 1863.08 Q811.289 1866.15 804.97 1866.15 Q802.794 1866.15 800.525 1865.78 Q798.28 1865.41 795.872 1864.67 L795.872 1859.97 Q797.956 1861.11 800.178 1861.66 Q802.4 1862.22 804.877 1862.22 Q808.882 1862.22 811.22 1860.11 Q813.558 1858.01 813.558 1854.4 Q813.558 1850.78 811.22 1848.68 Q808.882 1846.57 804.877 1846.57 Q803.002 1846.57 801.127 1846.99 Q799.275 1847.4 797.331 1848.28 L797.331 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip460)" d="M837.446 1834 Q833.835 1834 832.007 1837.57 Q830.201 1841.11 830.201 1848.24 Q830.201 1855.34 832.007 1858.91 Q833.835 1862.45 837.446 1862.45 Q841.081 1862.45 842.886 1858.91 Q844.715 1855.34 844.715 1848.24 Q844.715 1841.11 842.886 1837.57 Q841.081 1834 837.446 1834 M837.446 1830.3 Q843.256 1830.3 846.312 1834.9 Q849.391 1839.49 849.391 1848.24 Q849.391 1856.96 846.312 1861.57 Q843.256 1866.15 837.446 1866.15 Q831.636 1866.15 828.557 1861.57 Q825.502 1856.96 825.502 1848.24 Q825.502 1839.49 828.557 1834.9 Q831.636 1830.3 837.446 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip460)" d="M1354.69 1830.92 L1373.05 1830.92 L1373.05 1834.86 L1358.98 1834.86 L1358.98 1843.33 Q1360 1842.98 1361.01 1842.82 Q1362.03 1842.64 1363.05 1842.64 Q1368.84 1842.64 1372.22 1845.81 Q1375.6 1848.98 1375.6 1854.4 Q1375.6 1859.97 1372.12 1863.08 Q1368.65 1866.15 1362.33 1866.15 Q1360.16 1866.15 1357.89 1865.78 Q1355.64 1865.41 1353.24 1864.67 L1353.24 1859.97 Q1355.32 1861.11 1357.54 1861.66 Q1359.76 1862.22 1362.24 1862.22 Q1366.25 1862.22 1368.58 1860.11 Q1370.92 1858.01 1370.92 1854.4 Q1370.92 1850.78 1368.58 1848.68 Q1366.25 1846.57 1362.24 1846.57 Q1360.37 1846.57 1358.49 1846.99 Q1356.64 1847.4 1354.69 1848.28 L1354.69 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip460)" d="M1394.81 1834 Q1391.2 1834 1389.37 1837.57 Q1387.56 1841.11 1387.56 1848.24 Q1387.56 1855.34 1389.37 1858.91 Q1391.2 1862.45 1394.81 1862.45 Q1398.44 1862.45 1400.25 1858.91 Q1402.08 1855.34 1402.08 1848.24 Q1402.08 1841.11 1400.25 1837.57 Q1398.44 1834 1394.81 1834 M1394.81 1830.3 Q1400.62 1830.3 1403.68 1834.9 Q1406.75 1839.49 1406.75 1848.24 Q1406.75 1856.96 1403.68 1861.57 Q1400.62 1866.15 1394.81 1866.15 Q1389 1866.15 1385.92 1861.57 Q1382.87 1856.96 1382.87 1848.24 Q1382.87 1839.49 1385.92 1834.9 Q1389 1830.3 1394.81 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip460)" d="M1424.97 1834 Q1421.36 1834 1419.53 1837.57 Q1417.73 1841.11 1417.73 1848.24 Q1417.73 1855.34 1419.53 1858.91 Q1421.36 1862.45 1424.97 1862.45 Q1428.61 1862.45 1430.41 1858.91 Q1432.24 1855.34 1432.24 1848.24 Q1432.24 1841.11 1430.41 1837.57 Q1428.61 1834 1424.97 1834 M1424.97 1830.3 Q1430.78 1830.3 1433.84 1834.9 Q1436.92 1839.49 1436.92 1848.24 Q1436.92 1856.96 1433.84 1861.57 Q1430.78 1866.15 1424.97 1866.15 Q1419.16 1866.15 1416.08 1861.57 Q1413.03 1856.96 1413.03 1848.24 Q1413.03 1839.49 1416.08 1834.9 Q1419.16 1830.3 1424.97 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip460)" d="M1940.97 1830.92 L1963.19 1830.92 L1963.19 1832.91 L1950.65 1865.48 L1945.76 1865.48 L1957.57 1834.86 L1940.97 1834.86 L1940.97 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip460)" d="M1972.36 1830.92 L1990.71 1830.92 L1990.71 1834.86 L1976.64 1834.86 L1976.64 1843.33 Q1977.66 1842.98 1978.68 1842.82 Q1979.7 1842.64 1980.72 1842.64 Q1986.5 1842.64 1989.88 1845.81 Q1993.26 1848.98 1993.26 1854.4 Q1993.26 1859.97 1989.79 1863.08 Q1986.32 1866.15 1980 1866.15 Q1977.82 1866.15 1975.55 1865.78 Q1973.31 1865.41 1970.9 1864.67 L1970.9 1859.97 Q1972.98 1861.11 1975.21 1861.66 Q1977.43 1862.22 1979.9 1862.22 Q1983.91 1862.22 1986.25 1860.11 Q1988.59 1858.01 1988.59 1854.4 Q1988.59 1850.78 1986.25 1848.68 Q1983.91 1846.57 1979.9 1846.57 Q1978.03 1846.57 1976.15 1846.99 Q1974.3 1847.4 1972.36 1848.28 L1972.36 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip460)" d="M2012.47 1834 Q2008.86 1834 2007.03 1837.57 Q2005.23 1841.11 2005.23 1848.24 Q2005.23 1855.34 2007.03 1858.91 Q2008.86 1862.45 2012.47 1862.45 Q2016.11 1862.45 2017.91 1858.91 Q2019.74 1855.34 2019.74 1848.24 Q2019.74 1841.11 2017.91 1837.57 Q2016.11 1834 2012.47 1834 M2012.47 1830.3 Q2018.28 1830.3 2021.34 1834.9 Q2024.42 1839.49 2024.42 1848.24 Q2024.42 1856.96 2021.34 1861.57 Q2018.28 1866.15 2012.47 1866.15 Q2006.66 1866.15 2003.59 1861.57 Q2000.53 1856.96 2000.53 1848.24 Q2000.53 1839.49 2003.59 1834.9 Q2006.66 1830.3 2012.47 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip460)" d="M2514.84 1861.55 L2522.48 1861.55 L2522.48 1835.18 L2514.17 1836.85 L2514.17 1832.59 L2522.43 1830.92 L2527.11 1830.92 L2527.11 1861.55 L2534.75 1861.55 L2534.75 1865.48 L2514.84 1865.48 L2514.84 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip460)" d="M2554.19 1834 Q2550.58 1834 2548.75 1837.57 Q2546.94 1841.11 2546.94 1848.24 Q2546.94 1855.34 2548.75 1858.91 Q2550.58 1862.45 2554.19 1862.45 Q2557.82 1862.45 2559.63 1858.91 Q2561.46 1855.34 2561.46 1848.24 Q2561.46 1841.11 2559.63 1837.57 Q2557.82 1834 2554.19 1834 M2554.19 1830.3 Q2560 1830.3 2563.06 1834.9 Q2566.13 1839.49 2566.13 1848.24 Q2566.13 1856.96 2563.06 1861.57 Q2560 1866.15 2554.19 1866.15 Q2548.38 1866.15 2545.3 1861.57 Q2542.25 1856.96 2542.25 1848.24 Q2542.25 1839.49 2545.3 1834.9 Q2548.38 1830.3 2554.19 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip460)" d="M2584.35 1834 Q2580.74 1834 2578.91 1837.57 Q2577.11 1841.11 2577.11 1848.24 Q2577.11 1855.34 2578.91 1858.91 Q2580.74 1862.45 2584.35 1862.45 Q2587.99 1862.45 2589.79 1858.91 Q2591.62 1855.34 2591.62 1848.24 Q2591.62 1841.11 2589.79 1837.57 Q2587.99 1834 2584.35 1834 M2584.35 1830.3 Q2590.16 1830.3 2593.22 1834.9 Q2596.3 1839.49 2596.3 1848.24 Q2596.3 1856.96 2593.22 1861.57 Q2590.16 1866.15 2584.35 1866.15 Q2578.54 1866.15 2575.46 1861.57 Q2572.41 1856.96 2572.41 1848.24 Q2572.41 1839.49 2575.46 1834.9 Q2578.54 1830.3 2584.35 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip460)" d="M2614.51 1834 Q2610.9 1834 2609.07 1837.57 Q2607.27 1841.11 2607.27 1848.24 Q2607.27 1855.34 2609.07 1858.91 Q2610.9 1862.45 2614.51 1862.45 Q2618.15 1862.45 2619.95 1858.91 Q2621.78 1855.34 2621.78 1848.24 Q2621.78 1841.11 2619.95 1837.57 Q2618.15 1834 2614.51 1834 M2614.51 1830.3 Q2620.32 1830.3 2623.38 1834.9 Q2626.46 1839.49 2626.46 1848.24 Q2626.46 1856.96 2623.38 1861.57 Q2620.32 1866.15 2614.51 1866.15 Q2608.7 1866.15 2605.62 1861.57 Q2602.57 1856.96 2602.57 1848.24 Q2602.57 1839.49 2605.62 1834.9 Q2608.7 1830.3 2614.51 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip460)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1800.78 151.747,47.2441 "></polyline>
<polyline clip-path="url(#clip460)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1545.88 170.644,1545.88 "></polyline>
<polyline clip-path="url(#clip460)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1237.91 170.644,1237.91 "></polyline>
<polyline clip-path="url(#clip460)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,929.937 170.644,929.937 "></polyline>
<polyline clip-path="url(#clip460)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,621.968 170.644,621.968 "></polyline>
<polyline clip-path="url(#clip460)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,313.999 170.644,313.999 "></polyline>
<path clip-path="url(#clip460)" d="M49.5521 1546.33 L79.2279 1546.33 L79.2279 1550.26 L49.5521 1550.26 L49.5521 1546.33 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip460)" d="M99.8991 1544.01 Q96.7509 1544.01 94.8991 1546.16 Q93.0704 1548.32 93.0704 1552.07 Q93.0704 1555.79 94.8991 1557.97 Q96.7509 1560.12 99.8991 1560.12 Q103.047 1560.12 104.876 1557.97 Q106.728 1555.79 106.728 1552.07 Q106.728 1548.32 104.876 1546.16 Q103.047 1544.01 99.8991 1544.01 M109.181 1529.36 L109.181 1533.62 Q107.422 1532.79 105.617 1532.35 Q103.834 1531.91 102.075 1531.91 Q97.4454 1531.91 94.9917 1535.03 Q92.5612 1538.16 92.2139 1544.47 Q93.5797 1542.46 95.6398 1541.4 Q97.7 1540.31 100.177 1540.31 Q105.385 1540.31 108.394 1543.48 Q111.427 1546.63 111.427 1552.07 Q111.427 1557.39 108.279 1560.61 Q105.131 1563.83 99.8991 1563.83 Q93.9037 1563.83 90.7325 1559.24 Q87.5612 1554.64 87.5612 1545.91 Q87.5612 1537.72 91.45 1532.85 Q95.3389 1527.97 101.89 1527.97 Q103.649 1527.97 105.431 1528.32 Q107.237 1528.66 109.181 1529.36 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip460)" d="M50.3623 1238.36 L80.0381 1238.36 L80.0381 1242.29 L50.3623 1242.29 L50.3623 1238.36 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip460)" d="M104.297 1236.55 Q107.654 1237.27 109.529 1239.54 Q111.427 1241.81 111.427 1245.14 Q111.427 1250.26 107.908 1253.06 Q104.39 1255.86 97.9083 1255.86 Q95.7324 1255.86 93.4176 1255.42 Q91.126 1255 88.6723 1254.14 L88.6723 1249.63 Q90.6167 1250.76 92.9315 1251.34 Q95.2463 1251.92 97.7695 1251.92 Q102.168 1251.92 104.459 1250.19 Q106.774 1248.45 106.774 1245.14 Q106.774 1242.08 104.621 1240.37 Q102.492 1238.64 98.6722 1238.64 L94.6445 1238.64 L94.6445 1234.79 L98.8574 1234.79 Q102.306 1234.79 104.135 1233.43 Q105.964 1232.04 105.964 1229.45 Q105.964 1226.78 104.066 1225.37 Q102.191 1223.94 98.6722 1223.94 Q96.7509 1223.94 94.5519 1224.35 Q92.3528 1224.77 89.7139 1225.65 L89.7139 1221.48 Q92.376 1220.74 94.6908 1220.37 Q97.0287 1220 99.0889 1220 Q104.413 1220 107.515 1222.43 Q110.617 1224.84 110.617 1228.96 Q110.617 1231.83 108.973 1233.82 Q107.33 1235.79 104.297 1236.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip460)" d="M99.4824 915.736 Q95.8713 915.736 94.0426 919.3 Q92.2371 922.842 92.2371 929.972 Q92.2371 937.078 94.0426 940.643 Q95.8713 944.185 99.4824 944.185 Q103.117 944.185 104.922 940.643 Q106.751 937.078 106.751 929.972 Q106.751 922.842 104.922 919.3 Q103.117 915.736 99.4824 915.736 M99.4824 912.032 Q105.293 912.032 108.348 916.638 Q111.427 921.222 111.427 929.972 Q111.427 938.698 108.348 943.305 Q105.293 947.888 99.4824 947.888 Q93.6723 947.888 90.5936 943.305 Q87.538 938.698 87.538 929.972 Q87.538 921.222 90.5936 916.638 Q93.6723 912.032 99.4824 912.032 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip460)" d="M104.297 620.614 Q107.654 621.331 109.529 623.6 Q111.427 625.868 111.427 629.201 Q111.427 634.317 107.908 637.118 Q104.39 639.919 97.9083 639.919 Q95.7324 639.919 93.4176 639.479 Q91.126 639.063 88.6723 638.206 L88.6723 633.692 Q90.6167 634.826 92.9315 635.405 Q95.2463 635.984 97.7695 635.984 Q102.168 635.984 104.459 634.248 Q106.774 632.512 106.774 629.201 Q106.774 626.146 104.621 624.433 Q102.492 622.697 98.6722 622.697 L94.6445 622.697 L94.6445 618.854 L98.8574 618.854 Q102.306 618.854 104.135 617.489 Q105.964 616.1 105.964 613.507 Q105.964 610.845 104.066 609.433 Q102.191 607.998 98.6722 607.998 Q96.7509 607.998 94.5519 608.415 Q92.3528 608.831 89.7139 609.711 L89.7139 605.544 Q92.376 604.803 94.6908 604.433 Q97.0287 604.063 99.0889 604.063 Q104.413 604.063 107.515 606.493 Q110.617 608.901 110.617 613.021 Q110.617 615.891 108.973 617.882 Q107.33 619.85 104.297 620.614 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip460)" d="M99.8991 312.135 Q96.7509 312.135 94.8991 314.288 Q93.0704 316.441 93.0704 320.191 Q93.0704 323.917 94.8991 326.093 Q96.7509 328.246 99.8991 328.246 Q103.047 328.246 104.876 326.093 Q106.728 323.917 106.728 320.191 Q106.728 316.441 104.876 314.288 Q103.047 312.135 99.8991 312.135 M109.181 297.482 L109.181 301.742 Q107.422 300.908 105.617 300.468 Q103.834 300.029 102.075 300.029 Q97.4454 300.029 94.9917 303.154 Q92.5612 306.279 92.2139 312.598 Q93.5797 310.584 95.6398 309.519 Q97.7 308.431 100.177 308.431 Q105.385 308.431 108.394 311.603 Q111.427 314.751 111.427 320.191 Q111.427 325.515 108.279 328.732 Q105.131 331.95 99.8991 331.95 Q93.9037 331.95 90.7325 327.366 Q87.5612 322.76 87.5612 314.033 Q87.5612 305.839 91.45 300.978 Q95.3389 296.094 101.89 296.094 Q103.649 296.094 105.431 296.441 Q107.237 296.788 109.181 297.482 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip462)" style="stroke:#009af9; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,1048.99 224.541,1377.23 226.891,1486.07 229.242,1502.51 231.592,1687.1 233.943,1633.29 236.293,1554.36 238.644,1549.91 240.994,1511.14 243.345,1514.08 245.695,1455.19 248.046,1342.24 250.396,1617.83 252.747,1294.38 255.097,1384.12 257.448,1423.15 259.798,1480.6 262.148,1382.74 264.499,1271.95 266.849,1363.01 269.2,1277.21 271.55,1308.39 273.901,1559.66 276.251,1507.74 278.602,1688.09 280.952,1364.01 283.303,1258.53 285.653,1347.24 288.004,1402.09 290.354,1518.08 292.705,1492.12 295.055,1473.99 297.406,1471.67 299.756,1745.22 302.107,1512.63 304.457,1374.7 306.807,1663.78 309.158,1236.41 311.508,1494.65 313.859,1414.84 316.209,1436.96 318.56,1547.04 320.91,1366.05 323.261,1427.91 325.611,1342.91 327.962,1389.64 330.312,1665.57 332.663,1548.83 335.013,1468.72 337.364,1516.14 339.714,1419.73 342.065,1280.2 344.415,1507.38 346.765,1591.12 349.116,1418.19 351.466,1420.84 353.817,1661.14 356.167,1549.91 358.518,1486.62 360.868,1368.27 363.219,1457.75 365.569,1386.42 367.92,1466.03 370.27,1437.14 372.621,1504.85 374.971,1481.54 377.322,1366.43 379.672,1266.41 382.023,1497.18 384.373,1434.71 386.724,1611.45 389.074,1385.82 391.424,1408.89 393.775,1331.43 396.125,1542.36 398.476,1419.29 400.826,1298.68 403.177,1328.41 405.527,1480.96 407.878,1552.92 410.228,1379.37 412.579,1351.33 414.929,1247.61 417.28,1297.87 419.63,1516.46 421.981,1421.52 424.331,1351.35 426.682,1377.72 429.032,1458.97 431.382,1375.62 433.733,1456.29 436.083,1468.83 438.434,1322.38 440.784,1437.97 443.135,1443.12 445.485,1486.3 447.836,1400.42 450.186,1294.58 452.537,1208.69 454.887,1423.02 457.238,1247.43 459.588,1289.31 461.939,1307.21 464.289,1483.15 466.64,1297.89 468.99,1549.58 471.341,1308.78 473.691,1512.78 476.041,1517.96 478.392,1237.27 480.742,1201.73 483.093,1456.2 485.443,1263.92 487.794,1352.27 490.144,1313.22 492.495,1503.06 494.845,1590.95 497.196,1399.45 499.546,1395.88 501.897,1430.63 504.247,1207.41 506.598,1581.71 508.948,1492.25 511.299,1340.68 513.649,1722.05 515.999,1480.35 518.35,1533.5 520.7,1520.14 523.051,1404.13 525.401,1544.39 527.752,1407.96 530.102,1282.7 532.453,1362.15 534.803,1291.62 537.154,1299.17 539.504,1484.36 541.855,1342.97 544.205,1520.44 546.556,1566.64 548.906,1402.77 551.257,1556.98 553.607,1561.88 555.958,1441.6 558.308,1665.04 560.658,1205.41 563.009,1354.06 565.359,1340.25 567.71,1406.41 570.06,1527.76 572.411,1578.6 574.761,1456.84 577.112,1479.48 579.462,1555.08 581.813,1441.42 584.163,1565.03 586.514,1442.66 588.864,1287.8 591.215,1451.91 593.565,1462.31 595.916,1358.33 598.266,1549.35 600.616,1386.79 602.967,1320.38 605.317,1368.77 607.668,1397.09 610.018,1555.83 612.369,1627.4 614.719,1362.14 617.07,1468.98 619.42,1464.33 621.771,1345.55 624.121,1478.3 626.472,1343.3 628.822,1313.39 631.173,1589.78 633.523,1576.16 635.874,1501.67 638.224,1372.92 640.575,1671.17 642.925,1598.42 645.275,1475.54 647.626,1303.48 649.976,1648.95 652.327,1420.49 654.677,1368.25 657.028,1283.95 659.378,1407.64 661.729,1541.43 664.079,1319.65 666.43,1460.07 668.78,1418.92 671.131,1349.58 673.481,1363.03 675.832,1508.12 678.182,1271.8 680.533,1538.66 682.883,1582.53 685.233,1332.39 687.584,1403.83 689.934,1663.24 692.285,1197.28 694.635,1381.5 696.986,1538.23 699.336,1567.88 701.687,1498.66 704.037,1374.48 706.388,1308.13 708.738,1443.31 711.089,1369.95 713.439,1333.48 715.79,1608.68 718.14,1505.37 720.491,1584.94 722.841,1428.14 725.192,1380.3 727.542,1444.65 729.892,1411.19 732.243,1326.15 734.593,1452.27 736.944,1261.93 739.294,1383.56 741.645,1607.49 743.995,1561.48 746.346,1440.52 748.696,1405.05 751.047,1606.08 753.397,1403.19 755.748,1503.9 758.098,1403.32 760.449,1350.05 762.799,1455.67 765.15,1496.98 767.5,1472.06 769.85,1595.55 772.201,1476.23 774.551,1245.67 776.902,1442.82 779.252,1395.11 781.603,1415.02 783.953,1374.39 786.304,1397.85 788.654,1470.9 791.005,1551.66 793.355,1349.22 795.706,1328.85 798.056,1453.43 800.407,1386.95 802.757,1630.16 805.108,1622.4 807.458,1388.36 809.809,1382.73 812.159,1298.02 814.509,1509.38 816.86,1485.03 819.21,1361.66 821.561,1586.12 823.911,1497.31 826.262,1496.68 828.612,1537.07 830.963,1458.89 833.313,1430.1 835.664,1457.73 838.014,1437.1 840.365,1533.99 842.715,1305.42 845.066,1461.6 847.416,1518.57 849.767,1460.81 852.117,1397.6 854.467,1402.19 856.818,1463.2 859.168,1618.48 861.519,1407.55 863.869,1500.93 866.22,1227.51 868.57,1400.2 870.921,1483.92 873.271,1511.55 875.622,1525.71 877.972,1575.26 880.323,1395.63 882.673,1431.08 885.024,1281.29 887.374,1450.93 889.725,1297.75 892.075,1507.74 894.426,1398.3 896.776,1510.53 899.126,1494.91 901.477,1593.38 903.827,1451.99 906.178,1582.07 908.528,1604.42 910.879,1268.16 913.229,1456.46 915.58,1499.87 917.93,1412.52 920.281,1498.85 922.631,1439.04 924.982,1418.84 927.332,1494.58 929.683,1276.82 932.033,1330.22 934.384,1500.19 936.734,1401.18 939.084,1439.85 941.435,1573.74 943.785,1277.26 946.136,1457.31 948.486,1329.35 950.837,1603.51 953.187,1528.93 955.538,1390.95 957.888,1500 960.239,1416.86 962.589,1646.48 964.94,1442.73 967.29,1533.3 969.641,1622.67 971.991,1341.34 974.342,1462.97 976.692,1440.67 979.043,1610.74 981.393,1470.18 983.743,1511.83 986.094,1362.41 988.444,1608.11 990.795,1356.2 993.145,1391 995.496,1555.06 997.846,1432.99 1000.2,1475.53 1002.55,1455.41 1004.9,1317.41 1007.25,1351.01 1009.6,1625.3 1011.95,1381.75 1014.3,1376.65 1016.65,1364.1 1019,1512.43 1021.35,1554.25 1023.7,1476.35 1026.05,1429.65 1028.4,1373.59 1030.75,1519.05 1033.1,1548.64 1035.45,1386.43 1037.8,1457.59 1040.15,1593.9 1042.51,1481.58 1044.86,1476.16 1047.21,1491.96 1049.56,1399.19 1051.91,1503.2 1054.26,1442.77 1056.61,1544.08 1058.96,1280.88 1061.31,1392.79 1063.66,1411.55 1066.01,1479.81 1068.36,1328.92 1070.71,1324.9 1073.06,1517.92 1075.41,1555.03 1077.76,1377.26 1080.11,1512.21 1082.46,1427.38 1084.81,1397.51 1087.16,1529.24 1089.51,1483.97 1091.87,1585.84 1094.22,1375.17 1096.57,1494.72 1098.92,1559.15 1101.27,1532.5 1103.62,1466.23 1105.97,1644.09 1108.32,1430.83 1110.67,1517.41 1113.02,1446.72 1115.37,1485.98 1117.72,1462.34 1120.07,1148.07 1122.42,1310.22 1124.77,1554.48 1127.12,1389.98 1129.47,1340.07 1131.82,1573.75 1134.17,1432.95 1136.52,1453.93 1138.87,1390.68 1141.23,1433.49 1143.58,1324.25 1145.93,1457.76 1148.28,1422.23 1150.63,1611.21 1152.98,1427.55 1155.33,1661.1 1157.68,1298.5 1160.03,1236.37 1162.38,1455.37 1164.73,1435.73 1167.08,1396.47 1169.43,1352.46 1171.78,1478.83 1174.13,1468.75 1176.48,1297.03 1178.83,1459.86 1181.18,1425.34 1183.53,1549.65 1185.88,1293.94 1188.23,1438.49 1190.59,1519.64 1192.94,1506.81 1195.29,1440.13 1197.64,1424.68 1199.99,1469.67 1202.34,1414.11 1204.69,1447.83 1207.04,1537.99 1209.39,1392.14 1211.74,1385.82 1214.09,1511.32 1216.44,1605.51 1218.79,1487.51 1221.14,1341.26 1223.49,1547.69 1225.84,1551.15 1228.19,1340.58 1230.54,1373.81 1232.89,1327.28 1235.24,1435.87 1237.59,1638.96 1239.94,1487.94 1242.3,1421.82 1244.65,1515.58 1247,1314.74 1249.35,1581.78 1251.7,1554.44 1254.05,1600.5 1256.4,1221.83 1258.75,1354.84 1261.1,1450.33 1263.45,1412.67 1265.8,1563.06 1268.15,1421.28 1270.5,1524.26 1272.85,1399.89 1275.2,1333.59 1277.55,1377.68 1279.9,1260.8 1282.25,1218.19 1284.6,1458.71 1286.95,1517.65 1289.3,1650.17 1291.66,1366.01 1294.01,1397.2 1296.36,1347.38 1298.71,1380.82 1301.06,1212.19 1303.41,1549.73 1305.76,1288.93 1308.11,1516.64 1310.46,1423.12 1312.81,1403.93 1315.16,1446.48 1317.51,1518.36 1319.86,1530.65 1322.21,1447.67 1324.56,1411.66 1326.91,1519.09 1329.26,1507.25 1331.61,1498.55 1333.96,1426.1 1336.31,1379.84 1338.66,1634.24 1341.02,1512.66 1343.37,1284.02 1345.72,1413.22 1348.07,1417.18 1350.42,1444.6 1352.77,1383.73 1355.12,1367.09 1357.47,1475.08 1359.82,1428.96 1362.17,1325.05 1364.52,1456.3 1366.87,1311.79 1369.22,1467.34 1371.57,1526.78 1373.92,1404.1 1376.27,1429.87 1378.62,1271.91 1380.97,1454.1 1383.32,1333.22 1385.67,1242.52 1388.02,1503.03 1390.38,1475.65 1392.73,1514.38 1395.08,1387.97 1397.43,1390.35 1399.78,1294.35 1402.13,1256.65 1404.48,1473.69 1406.83,1451.11 1409.18,1349.02 1411.53,1393.44 1413.88,1501.2 1416.23,1499.59 1418.58,1428.35 1420.93,1339.16 1423.28,1341.4 1425.63,1411.81 1427.98,1535.69 1430.33,1511.51 1432.68,1153.33 1435.03,1311.14 1437.38,1627.11 1439.74,1562.69 1442.09,1467.81 1444.44,1503.65 1446.79,1521.6 1449.14,1377.65 1451.49,1397 1453.84,1597.76 1456.19,1621.88 1458.54,1585.92 1460.89,1475.31 1463.24,1377.46 1465.59,1597.86 1467.94,1490.69 1470.29,1453.37 1472.64,1505.25 1474.99,1287.48 1477.34,1542.26 1479.69,1501.67 1482.04,1384.42 1484.39,1402.95 1486.74,1443.1 1489.1,1508.03 1491.45,1454.44 1493.8,1322.69 1496.15,1401.9 1498.5,1338.55 1500.85,1252.9 1503.2,1495.84 1505.55,1218.73 1507.9,1528.3 1510.25,1471.13 1512.6,1455.62 1514.95,1441.48 1517.3,1550 1519.65,1494.98 1522,1551.4 1524.35,1309.1 1526.7,1630.56 1529.05,1375.87 1531.4,1526.33 1533.75,1414.33 1536.1,1390.6 1538.45,1419.64 1540.81,1520.83 1543.16,1559.18 1545.51,1456.64 1547.86,1513.84 1550.21,1691.02 1552.56,1520.37 1554.91,1444.82 1557.26,1552.27 1559.61,1492.42 1561.96,1353 1564.31,1441.73 1566.66,1516.29 1569.01,1459.52 1571.36,1510.46 1573.71,1304.16 1576.06,1635.5 1578.41,1570.19 1580.76,1514.89 1583.11,1618.94 1585.46,1266.65 1587.81,1534.66 1590.17,1314.48 1592.52,1309.2 1594.87,1413.65 1597.22,1491.8 1599.57,1640.91 1601.92,1485.42 1604.27,1505.01 1606.62,1223.42 1608.97,1446.87 1611.32,1378.34 1613.67,1561.79 1616.02,1368.5 1618.37,1482.66 1620.72,1172.27 1623.07,1588.07 1625.42,1448.8 1627.77,1531.23 1630.12,1269.93 1632.47,1479.64 1634.82,1420.78 1637.17,1536.82 1639.53,1405.24 1641.88,1302.61 1644.23,1421.38 1646.58,1589.11 1648.93,1546.96 1651.28,1398.28 1653.63,1292.62 1655.98,1463.96 1658.33,1383.95 1660.68,1281.41 1663.03,1623.12 1665.38,1389.69 1667.73,1424.98 1670.08,1473.84 1672.43,1317.83 1674.78,1544.56 1677.13,1578.79 1679.48,1323.27 1681.83,1546.42 1684.18,1589.17 1686.53,1571.13 1688.89,1529.56 1691.24,1580.97 1693.59,1368 1695.94,1391.66 1698.29,1503.05 1700.64,1446.64 1702.99,1449.9 1705.34,1405.95 1707.69,1321.88 1710.04,1398.2 1712.39,1528.16 1714.74,1395.29 1717.09,1503.62 1719.44,1475.52 1721.79,1156.16 1724.14,1710.16 1726.49,1512.49 1728.84,1613.26 1731.19,1571.8 1733.54,1489.9 1735.89,1502.93 1738.25,1406.09 1740.6,1385.67 1742.95,1365.95 1745.3,1380.52 1747.65,1626.97 1750,1493.27 1752.35,1425.91 1754.7,1478.57 1757.05,1350.88 1759.4,1422.46 1761.75,1370.88 1764.1,1601.18 1766.45,1371.34 1768.8,1435.8 1771.15,1371.39 1773.5,1289.73 1775.85,1268.06 1778.2,1473.48 1780.55,1575.85 1782.9,1398.88 1785.25,1416.24 1787.6,1313.7 1789.96,1656.29 1792.31,1381.44 1794.66,1334.44 1797.01,1425.46 1799.36,1520.11 1801.71,1488.4 1804.06,1309.16 1806.41,1560.85 1808.76,1451.73 1811.11,1452.36 1813.46,1351.94 1815.81,1546.99 1818.16,1522.2 1820.51,1311.91 1822.86,1263.37 1825.21,1460.86 1827.56,1547.99 1829.91,1430.07 1832.26,1380.13 1834.61,1377.27 1836.96,1692.3 1839.32,1354.31 1841.67,1427.47 1844.02,1465.89 1846.37,1451.37 1848.72,1587.79 1851.07,1502.03 1853.42,1300.79 1855.77,1636.03 1858.12,1425.05 1860.47,1320.08 1862.82,1394.44 1865.17,1543.21 1867.52,1491.43 1869.87,1498.73 1872.22,1484.64 1874.57,1276.01 1876.92,1400.46 1879.27,1393.3 1881.62,1480.26 1883.97,1271.84 1886.32,1561.03 1888.68,1669.28 1891.03,1405.44 1893.38,1605.31 1895.73,1459.48 1898.08,1412.01 1900.43,1470.63 1902.78,1565.52 1905.13,1324.69 1907.48,1358.8 1909.83,1469.56 1912.18,1470.13 1914.53,1518.24 1916.88,1403.44 1919.23,1421.28 1921.58,1462.29 1923.93,1572.75 1926.28,1472.99 1928.63,1209.32 1930.98,1355.97 1933.33,1510 1935.68,1336.72 1938.04,1227.49 1940.39,1303.14 1942.74,1415.52 1945.09,1384.77 1947.44,1353.12 1949.79,1283.46 1952.14,1428.39 1954.49,1326.2 1956.84,1504.28 1959.19,1245.18 1961.54,1358.27 1963.89,1283.29 1966.24,1576.04 1968.59,1272.53 1970.94,1282.25 1973.29,1450.28 1975.64,1478.93 1977.99,1374.21 1980.34,1464.76 1982.69,1443.83 1985.04,1457.4 1987.4,1373.45 1989.75,1629.85 1992.1,1558.34 1994.45,1292.84 1996.8,1502.1 1999.15,1388.31 2001.5,1431.5 2003.85,1249.22 2006.2,1485.89 2008.55,1466.32 2010.9,1347.37 2013.25,1410.49 2015.6,1509.16 2017.95,1542.96 2020.3,1520.72 2022.65,1316.89 2025,1751.15 2027.35,1429.24 2029.7,1353.92 2032.05,1416.06 2034.4,1496.93 2036.76,1396.69 2039.11,1320.61 2041.46,1310.07 2043.81,1352.56 2046.16,1282.41 2048.51,1381.79 2050.86,1420.99 2053.21,1499 2055.56,1438.84 2057.91,1441.9 2060.26,1483.23 2062.61,1427.17 2064.96,1271.93 2067.31,1431.19 2069.66,1493.12 2072.01,1308.65 2074.36,1415.89 2076.71,1455.78 2079.06,1417.32 2081.41,1655.95 2083.76,1446.41 2086.11,1601.85 2088.47,1583.78 2090.82,1488.41 2093.17,1498.8 2095.52,1411.67 2097.87,1473.25 2100.22,1425.2 2102.57,1361.4 2104.92,1498.85 2107.27,1412.56 2109.62,1388.73 2111.97,1354.26 2114.32,1412.46 2116.67,1411.86 2119.02,1522.7 2121.37,1494.16 2123.72,1496.64 2126.07,1371.35 2128.42,1300.54 2130.77,1385.58 2133.12,1478.2 2135.47,1497.67 2137.83,1258.05 2140.18,1400.38 2142.53,1377.66 2144.88,1371.01 2147.23,1595.14 2149.58,1571.35 2151.93,1378.35 2154.28,1353.55 2156.63,1401.93 2158.98,1429.01 2161.33,1549.54 2163.68,1506.51 2166.03,1437.55 2168.38,1385.33 2170.73,1388.72 2173.08,1523.56 2175.43,1344.9 2177.78,1348.98 2180.13,1425.08 2182.48,1307.78 2184.83,1495.28 2187.19,1418.32 2189.54,1460.49 2191.89,1494.96 2194.24,1440.17 2196.59,1322.77 2198.94,1280.21 2201.29,1520.49 2203.64,1416.05 2205.99,1496.08 2208.34,1329.1 2210.69,1507.88 2213.04,1365.07 2215.39,1480.47 2217.74,1288.68 2220.09,1560.01 2222.44,1486.94 2224.79,1396.75 2227.14,1555.29 2229.49,1469.64 2231.84,1354.86 2234.19,1476.2 2236.55,1364.25 2238.9,1343.92 2241.25,1331.19 2243.6,1428.04 2245.95,1304.9 2248.3,1555.09 2250.65,1556.9 2253,1338.86 2255.35,1289.49 2257.7,1298.53 2260.05,1441.55 2262.4,1251.15 2264.75,1344.37 2267.1,1456.79 2269.45,1408.88 2271.8,1714.78 2274.15,1337.77 2276.5,1478.99 2278.85,1438.17 2281.2,1451.76 2283.55,1483.61 2285.91,1584.22 2288.26,1434.19 2290.61,1660.86 2292.96,1563.51 2295.31,1499.82 2297.66,1441.86 2300.01,1526.3 2302.36,1394.98 2304.71,1383.2 2307.06,1451.79 2309.41,1467.68 2311.76,1524.88 2314.11,1377.91 2316.46,1548.09 2318.81,1378.04 2321.16,1324.49 2323.51,1516.39 2325.86,1272.15 2328.21,1460.9 2330.56,1490.79 2332.91,1447.49 2335.27,1447.47 2337.62,1319.58 2339.97,1504.99 2342.32,1397.35 2344.67,1463.37 2347.02,1297.81 2349.37,1219.24 2351.72,1538.15 2354.07,1356.52 2356.42,1488.53 2358.77,1533.24 2361.12,1333.13 2363.47,1547.9 2365.82,1446.54 2368.17,1457.54 2370.52,1407.89 2372.87,1371.25 2375.22,1326.05 2377.57,1461.49 2379.92,1502.96 2382.27,1468.78 2384.62,1637.14 2386.98,1415.61 2389.33,1350.89 2391.68,1324.64 2394.03,1316.25 2396.38,1480.29 2398.73,1693.32 2401.08,1567.11 2403.43,1518.31 2405.78,1385.9 2408.13,1320.16 2410.48,1623.37 2412.83,1271.05 2415.18,1666.31 2417.53,1474.07 2419.88,1423.36 2422.23,1470.35 2424.58,1324.3 2426.93,1544.47 2429.28,1429.24 2431.63,1487.52 2433.98,1405.27 2436.34,1606.92 2438.69,1371.04 2441.04,1548.84 2443.39,1333.24 2445.74,1435.92 2448.09,1239.68 2450.44,1476.78 2452.79,1346.75 2455.14,1420.17 2457.49,1474.65 2459.84,1451.75 2462.19,1510.9 2464.54,1434.68 2466.89,1382.39 2469.24,1629.61 2471.59,1531.87 2473.94,1550.38 2476.29,1629.15 2478.64,1397.64 2480.99,1383.71 2483.34,1338.24 2485.7,1505.77 2488.05,1334.58 2490.4,1380.75 2492.75,1466.72 2495.1,1610.71 2497.45,1366.22 2499.8,1378.76 2502.15,1473.21 2504.5,1409.96 2506.85,1448.72 2509.2,1147.73 2511.55,1478.79 2513.9,1554.76 2516.25,1463.36 2518.6,1519.1 2520.95,1376.64 2523.3,1328.89 2525.65,1478.2 2528,1485.51 2530.35,1477.61 2532.7,1405.79 2535.06,1469.77 2537.41,1505.9 2539.76,1447.33 2542.11,1399.42 2544.46,1508.75 2546.81,1410.51 2549.16,1263.43 2551.51,1387.3 2553.86,1296.54 2556.21,1419.16 2558.56,1502.73 2560.91,1515.42 2563.26,1462.32 2565.61,1471.73 2567.96,1349.94 2570.31,1421.99 "></polyline>
<polyline clip-path="url(#clip462)" style="stroke:#e26f46; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,1031.06 224.541,1055.4 226.891,865.652 229.242,1162.14 231.592,908.18 233.943,1032.2 236.293,966.179 238.644,1103.03 240.994,889.308 243.345,905.998 245.695,987.342 248.046,927.633 250.396,894.683 252.747,1050.71 255.097,987.627 257.448,1149.03 259.798,826.812 262.148,943.633 264.499,892.295 266.849,1013.17 269.2,918.637 271.55,981.46 273.901,932.214 276.251,928.25 278.602,844.294 280.952,857.347 283.303,754.266 285.653,812.761 288.004,807.816 290.354,981.635 292.705,781.24 295.055,973.638 297.406,825.136 299.756,958.123 302.107,1029.16 304.457,836.048 306.807,1014.67 309.158,1006.54 311.508,874.269 313.859,983.593 316.209,1036.64 318.56,769.636 320.91,886.659 323.261,879.353 325.611,957.75 327.962,1099.76 330.312,999.232 332.663,814.758 335.013,1001.04 337.364,1018.18 339.714,754.544 342.065,976.884 344.415,899.251 346.765,932.034 349.116,791.897 351.466,1107.4 353.817,975.422 356.167,946.888 358.518,995.593 360.868,950.775 363.219,1057.94 365.569,968.011 367.92,1000.96 370.27,988.351 372.621,912.93 374.971,892.191 377.322,1040.85 379.672,991.884 382.023,948.83 384.373,819.031 386.724,1111.14 389.074,870.607 391.424,847.064 393.775,691.476 396.125,1019.09 398.476,788.844 400.826,943.26 403.177,874.931 405.527,845.559 407.878,897.406 410.228,1050.96 412.579,817.616 414.929,1008.37 417.28,754.135 419.63,1140.05 421.981,752.275 424.331,911.768 426.682,857.665 429.032,835.651 431.382,801.663 433.733,929.116 436.083,769.208 438.434,905.824 440.784,1125.32 443.135,1176.96 445.485,910.297 447.836,889.602 450.186,797.187 452.537,948.958 454.887,907.935 457.238,853.039 459.588,944.766 461.939,940.221 464.289,793.657 466.64,880.117 468.99,984.56 471.341,1085.51 473.691,761.152 476.041,819.407 478.392,946.614 480.742,787.825 483.093,813.818 485.443,714.474 487.794,818.668 490.144,829.746 492.495,866.981 494.845,1110.2 497.196,987.235 499.546,974.902 501.897,856.219 504.247,948.408 506.598,971.43 508.948,1042.02 511.299,954.509 513.649,1186.64 515.999,901.968 518.35,891.084 520.7,1040.42 523.051,896.472 525.401,787.04 527.752,870.83 530.102,1041.69 532.453,885.46 534.803,959.309 537.154,710.701 539.504,999.771 541.855,874.39 544.205,1067.44 546.556,995.844 548.906,1133.07 551.257,969.82 553.607,970.379 555.958,955.914 558.308,847.462 560.658,889.724 563.009,1001.58 565.359,1056.52 567.71,1156.18 570.06,1020.4 572.411,984.552 574.761,1107.49 577.112,885.791 579.462,953.132 581.813,667.955 584.163,939.726 586.514,817.079 588.864,986.156 591.215,1019.85 593.565,1007.22 595.916,1013.25 598.266,1131.78 600.616,1021.19 602.967,811.562 605.317,972.4 607.668,993.731 610.018,1070.06 612.369,948.876 614.719,898.341 617.07,938.479 619.42,913.381 621.771,849.728 624.121,808.61 626.472,976.85 628.822,856.645 631.173,795.527 633.523,952.941 635.874,1047.5 638.224,862.162 640.575,1049.77 642.925,942.03 645.275,858.278 647.626,868.861 649.976,926.055 652.327,678.924 654.677,1006.71 657.028,1151.54 659.378,894.661 661.729,861.031 664.079,922.24 666.43,920.312 668.78,975.995 671.131,823.922 673.481,999.024 675.832,968.179 678.182,863.895 680.533,788.536 682.883,752.903 685.233,1037.86 687.584,1170.61 689.934,905.139 692.285,881.831 694.635,877.14 696.986,1147.46 699.336,820.833 701.687,1009.23 704.037,837.156 706.388,1076.5 708.738,870.032 711.089,955.564 713.439,1069.99 715.79,859.083 718.14,976.716 720.491,840.991 722.841,897.285 725.192,817.803 727.542,1057.31 729.892,900.906 732.243,1019.78 734.593,738.816 736.944,708.172 739.294,828.433 741.645,843.621 743.995,965.247 746.346,928.922 748.696,726.695 751.047,839.543 753.397,854.381 755.748,848.377 758.098,1047.49 760.449,996.528 762.799,981.237 765.15,881.351 767.5,953.356 769.85,761.427 772.201,1084.83 774.551,973.753 776.902,997.108 779.252,975.498 781.603,997.647 783.953,965.838 786.304,949.591 788.654,1110.21 791.005,954.451 793.355,1005.74 795.706,863.182 798.056,971.79 800.407,841.817 802.757,871.627 805.108,916.887 807.458,991.723 809.809,1053.75 812.159,899.25 814.509,893.847 816.86,1031.06 819.21,919.526 821.561,808.741 823.911,944.312 826.262,971.981 828.612,1025.11 830.963,881.352 833.313,844.059 835.664,818.205 838.014,830.487 840.365,889.083 842.715,936.959 845.066,907.728 847.416,848.463 849.767,895.925 852.117,810.398 854.467,982.536 856.818,1116.96 859.168,1163.79 861.519,976.839 863.869,936.918 866.22,945.696 868.57,872.278 870.921,955.832 873.271,1085.92 875.622,951.223 877.972,870.253 880.323,949.382 882.673,844.528 885.024,956.538 887.374,958.674 889.725,1054.6 892.075,930.948 894.426,992.362 896.776,922.752 899.126,786.898 901.477,889.119 903.827,939.689 906.178,771.031 908.528,961.919 910.879,1028.01 913.229,999.755 915.58,877.117 917.93,873.361 920.281,865.108 922.631,1063.36 924.982,810.033 927.332,1116.59 929.683,872.862 932.033,897.325 934.384,978.169 936.734,1057.97 939.084,934.828 941.435,741.99 943.785,900.484 946.136,1047.92 948.486,889.914 950.837,839.212 953.187,1079.26 955.538,745.496 957.888,917.922 960.239,1011.78 962.589,1094.9 964.94,1097.32 967.29,920.048 969.641,870.516 971.991,1014.66 974.342,1100.79 976.692,751.289 979.043,958.755 981.393,966.163 983.743,974.339 986.094,613.662 988.444,912.827 990.795,947.769 993.145,1086.29 995.496,1088.31 997.846,813.262 1000.2,842.115 1002.55,1124.61 1004.9,786.061 1007.25,937.136 1009.6,732.879 1011.95,1076.09 1014.3,850.448 1016.65,958.466 1019,996.445 1021.35,767.425 1023.7,718.429 1026.05,951.167 1028.4,980.417 1030.75,870.235 1033.1,986.592 1035.45,907.176 1037.8,972.307 1040.15,891.58 1042.51,1022.7 1044.86,738.714 1047.21,898.537 1049.56,1056.24 1051.91,964.192 1054.26,835.477 1056.61,948.654 1058.96,926.944 1061.31,778.989 1063.66,1117.92 1066.01,722.411 1068.36,986.607 1070.71,1113.86 1073.06,865.331 1075.41,1097.04 1077.76,823.807 1080.11,902.288 1082.46,739.536 1084.81,876.544 1087.16,1049.48 1089.51,1029.2 1091.87,822.085 1094.22,982.821 1096.57,749.133 1098.92,982.772 1101.27,857.686 1103.62,858.845 1105.97,990.713 1108.32,915.673 1110.67,911.263 1113.02,838.862 1115.37,849.355 1117.72,979.002 1120.07,927.621 1122.42,956.028 1124.77,1026.88 1127.12,897.325 1129.47,1069.1 1131.82,914.06 1134.17,935.105 1136.52,745.36 1138.87,902.455 1141.23,797.762 1143.58,899.633 1145.93,751.068 1148.28,853.342 1150.63,923.822 1152.98,827.831 1155.33,1075.16 1157.68,941.599 1160.03,931.141 1162.38,961.683 1164.73,956.477 1167.08,1057.26 1169.43,967.914 1171.78,672.932 1174.13,909.713 1176.48,754.647 1178.83,1154.24 1181.18,859.921 1183.53,829.575 1185.88,812.678 1188.23,918.072 1190.59,1056.32 1192.94,789.752 1195.29,573.645 1197.64,1146.49 1199.99,962.025 1202.34,766.69 1204.69,972.622 1207.04,894.834 1209.39,988.798 1211.74,909.38 1214.09,877.748 1216.44,858.755 1218.79,885.879 1221.14,834.254 1223.49,848.947 1225.84,932.358 1228.19,932.054 1230.54,766.254 1232.89,1033.61 1235.24,1106.36 1237.59,964.001 1239.94,850.818 1242.3,619.466 1244.65,934.126 1247,1052.33 1249.35,736.511 1251.7,996.927 1254.05,1057.91 1256.4,847.356 1258.75,1021.24 1261.1,1072.51 1263.45,738.952 1265.8,796.804 1268.15,923.251 1270.5,1083.01 1272.85,828.955 1275.2,721.837 1277.55,1027.18 1279.9,988.746 1282.25,840.037 1284.6,849.587 1286.95,1127.34 1289.3,978.122 1291.66,972.949 1294.01,773.435 1296.36,1005.63 1298.71,1047.05 1301.06,1037.82 1303.41,1038.36 1305.76,839.241 1308.11,921.617 1310.46,766.863 1312.81,1063.32 1315.16,963.623 1317.51,964.87 1319.86,907.639 1322.21,856.497 1324.56,991.926 1326.91,857.637 1329.26,1036.27 1331.61,863.415 1333.96,945.221 1336.31,954.537 1338.66,722.181 1341.02,958.298 1343.37,927.244 1345.72,877.454 1348.07,969.546 1350.42,1145.91 1352.77,1052.29 1355.12,933.327 1357.47,916.784 1359.82,998.879 1362.17,792.317 1364.52,986.649 1366.87,864.922 1369.22,911.056 1371.57,907.931 1373.92,1044.58 1376.27,896.409 1378.62,757.597 1380.97,794.818 1383.32,966.156 1385.67,936.261 1388.02,931.514 1390.38,906.095 1392.73,938.219 1395.08,879.929 1397.43,879.341 1399.78,1092.17 1402.13,923.682 1404.48,922.631 1406.83,935.257 1409.18,979.656 1411.53,907.279 1413.88,1131.46 1416.23,1044.41 1418.58,911.426 1420.93,1144.75 1423.28,943.727 1425.63,1002.44 1427.98,1055.28 1430.33,942.918 1432.68,930.972 1435.03,957.48 1437.38,716.218 1439.74,865.152 1442.09,887.525 1444.44,838.9 1446.79,945.964 1449.14,948.027 1451.49,899.219 1453.84,1126.06 1456.19,823.917 1458.54,979.709 1460.89,880.661 1463.24,1053.6 1465.59,893.965 1467.94,922.031 1470.29,873.55 1472.64,830.92 1474.99,675.983 1477.34,949.997 1479.69,1056.93 1482.04,809.554 1484.39,1044.81 1486.74,896.999 1489.1,991.171 1491.45,866.694 1493.8,859.266 1496.15,1035.01 1498.5,1067.37 1500.85,963.387 1503.2,868.066 1505.55,1081.76 1507.9,1208.93 1510.25,915.689 1512.6,946.326 1514.95,802.202 1517.3,902.969 1519.65,674.227 1522,739.811 1524.35,894.484 1526.7,914.496 1529.05,1059.61 1531.4,898.968 1533.75,837.178 1536.1,1012.06 1538.45,818.368 1540.81,825.684 1543.16,902.09 1545.51,777.254 1547.86,881.831 1550.21,992.226 1552.56,933.004 1554.91,784.335 1557.26,936.221 1559.61,943.591 1561.96,782.675 1564.31,973.934 1566.66,917.31 1569.01,839.874 1571.36,1003.02 1573.71,888.025 1576.06,882.025 1578.41,917.102 1580.76,800.077 1583.11,976.181 1585.46,943.595 1587.81,1012.18 1590.17,988.74 1592.52,1172.94 1594.87,979.694 1597.22,958.226 1599.57,1008.18 1601.92,1005.47 1604.27,990.929 1606.62,821.76 1608.97,782.117 1611.32,967.757 1613.67,930.581 1616.02,936.855 1618.37,1012.47 1620.72,1016.9 1623.07,861.682 1625.42,870.159 1627.77,1006.87 1630.12,995.62 1632.47,954.637 1634.82,879.968 1637.17,979.09 1639.53,836.004 1641.88,752.203 1644.23,901.902 1646.58,988.148 1648.93,1144.06 1651.28,788.67 1653.63,882.134 1655.98,679.108 1658.33,981.415 1660.68,1061.72 1663.03,878.63 1665.38,1030.96 1667.73,907.697 1670.08,1100.82 1672.43,856.06 1674.78,1066.88 1677.13,902.526 1679.48,866.886 1681.83,974.073 1684.18,860.969 1686.53,1107.75 1688.89,961.379 1691.24,1160.58 1693.59,840.938 1695.94,1036.2 1698.29,1012.1 1700.64,822.959 1702.99,1186.3 1705.34,885.223 1707.69,911.633 1710.04,1018.67 1712.39,866.828 1714.74,811.866 1717.09,1050.33 1719.44,816.936 1721.79,866.579 1724.14,959.224 1726.49,816.449 1728.84,897.346 1731.19,824.383 1733.54,1030.92 1735.89,950.051 1738.25,842.233 1740.6,973.842 1742.95,826.303 1745.3,914.805 1747.65,1125.2 1750,989.682 1752.35,905.176 1754.7,816.579 1757.05,930.269 1759.4,1001.42 1761.75,890.315 1764.1,986.406 1766.45,868.323 1768.8,1027.46 1771.15,1006.64 1773.5,1111.16 1775.85,1071.82 1778.2,1029.21 1780.55,902.556 1782.9,877.125 1785.25,918.821 1787.6,894.17 1789.96,874.828 1792.31,944.269 1794.66,911.087 1797.01,983.018 1799.36,855.412 1801.71,897.168 1804.06,939.903 1806.41,886.432 1808.76,943.451 1811.11,921.09 1813.46,942.177 1815.81,919.124 1818.16,939.62 1820.51,821.133 1822.86,684.215 1825.21,1069.43 1827.56,950.137 1829.91,820.086 1832.26,949.773 1834.61,715.813 1836.96,921.954 1839.32,835.21 1841.67,833.427 1844.02,859.402 1846.37,857.722 1848.72,864.296 1851.07,736.362 1853.42,864.25 1855.77,878.229 1858.12,980.552 1860.47,842.269 1862.82,1085.67 1865.17,933.341 1867.52,730.548 1869.87,894.316 1872.22,812.478 1874.57,830.218 1876.92,1049.34 1879.27,958.762 1881.62,839.285 1883.97,936.147 1886.32,838.788 1888.68,907.762 1891.03,685.51 1893.38,929.972 1895.73,956.678 1898.08,903.009 1900.43,850.729 1902.78,910.346 1905.13,1165.38 1907.48,871.52 1909.83,1002.26 1912.18,922.386 1914.53,1033.92 1916.88,987.937 1919.23,861.172 1921.58,934.792 1923.93,723.263 1926.28,1000.21 1928.63,883.247 1930.98,1055.16 1933.33,851.479 1935.68,724.557 1938.04,921.89 1940.39,1024.06 1942.74,936.531 1945.09,1032.99 1947.44,852.946 1949.79,836.069 1952.14,941.03 1954.49,960.882 1956.84,757.01 1959.19,946.074 1961.54,860.059 1963.89,921.551 1966.24,1006.02 1968.59,910.658 1970.94,1038.5 1973.29,856.01 1975.64,965.429 1977.99,842.591 1980.34,785.419 1982.69,1025.01 1985.04,962.221 1987.4,848.462 1989.75,1082.17 1992.1,911.758 1994.45,975.043 1996.8,1116.64 1999.15,889.267 2001.5,835.117 2003.85,1019.75 2006.2,973.518 2008.55,1033.86 2010.9,830.682 2013.25,889.157 2015.6,862.63 2017.95,913.933 2020.3,935.9 2022.65,893.429 2025,1055.65 2027.35,892.274 2029.7,825.918 2032.05,1032.59 2034.4,958.627 2036.76,928.759 2039.11,920.924 2041.46,838.236 2043.81,962.637 2046.16,1000.2 2048.51,1005.58 2050.86,1111.43 2053.21,769.498 2055.56,822.235 2057.91,1062.33 2060.26,824.194 2062.61,824.698 2064.96,1041.79 2067.31,984.175 2069.66,1088.75 2072.01,900.994 2074.36,819.049 2076.71,1025.55 2079.06,827.876 2081.41,831.482 2083.76,954.699 2086.11,892.582 2088.47,990.738 2090.82,815.125 2093.17,792.653 2095.52,960.664 2097.87,704.673 2100.22,822.672 2102.57,934.974 2104.92,1111.68 2107.27,1018.33 2109.62,943.753 2111.97,804.132 2114.32,824.427 2116.67,867.705 2119.02,868.962 2121.37,848.946 2123.72,951.614 2126.07,941.518 2128.42,1139.11 2130.77,852.281 2133.12,949.127 2135.47,892.05 2137.83,1022.96 2140.18,941.217 2142.53,906.585 2144.88,832.962 2147.23,1030.68 2149.58,842.972 2151.93,859.852 2154.28,763.146 2156.63,945.611 2158.98,898.565 2161.33,1051.89 2163.68,955.43 2166.03,946.411 2168.38,990.612 2170.73,1083.73 2173.08,1029.18 2175.43,906.827 2177.78,1052.49 2180.13,918.635 2182.48,951.788 2184.83,955.826 2187.19,811.653 2189.54,998.25 2191.89,1017.16 2194.24,990.018 2196.59,1023.34 2198.94,975.654 2201.29,1062.24 2203.64,934.158 2205.99,983.521 2208.34,771.166 2210.69,950.911 2213.04,864.598 2215.39,864.658 2217.74,998.525 2220.09,964.238 2222.44,997.751 2224.79,881.495 2227.14,737.867 2229.49,866.55 2231.84,830.159 2234.19,941.54 2236.55,1024.12 2238.9,870.021 2241.25,888.99 2243.6,973.782 2245.95,1010.51 2248.3,849.743 2250.65,884.977 2253,1019.67 2255.35,1055.56 2257.7,832.766 2260.05,1029.89 2262.4,891.817 2264.75,842.713 2267.1,861.562 2269.45,734.287 2271.8,1041.71 2274.15,741.343 2276.5,983.647 2278.85,753.67 2281.2,1049.39 2283.55,932.806 2285.91,745.948 2288.26,955.622 2290.61,1039.84 2292.96,1080.88 2295.31,855.372 2297.66,859.871 2300.01,881.988 2302.36,821.802 2304.71,976.518 2307.06,1001.54 2309.41,764.686 2311.76,894.243 2314.11,800.613 2316.46,1067.59 2318.81,781.704 2321.16,1007.77 2323.51,862.196 2325.86,731.596 2328.21,878.563 2330.56,1043.16 2332.91,906.865 2335.27,835.939 2337.62,896.9 2339.97,922.837 2342.32,811.729 2344.67,885.232 2347.02,741.242 2349.37,871.746 2351.72,970.271 2354.07,1062.45 2356.42,964.68 2358.77,957.571 2361.12,975.011 2363.47,831.795 2365.82,886.894 2368.17,744.764 2370.52,947.388 2372.87,782.723 2375.22,985.192 2377.57,876.792 2379.92,899.337 2382.27,923.29 2384.62,892.371 2386.98,913.714 2389.33,966.661 2391.68,926.218 2394.03,872.919 2396.38,986.126 2398.73,993.54 2401.08,970.886 2403.43,990.357 2405.78,906.839 2408.13,873.004 2410.48,1049.66 2412.83,900.893 2415.18,1049.74 2417.53,850.951 2419.88,816.016 2422.23,999.941 2424.58,935.171 2426.93,836.128 2429.28,876.416 2431.63,1001.61 2433.98,955.578 2436.34,1139.42 2438.69,1004.03 2441.04,1175.23 2443.39,784.637 2445.74,1014.18 2448.09,906.656 2450.44,1046.74 2452.79,1114.46 2455.14,946.201 2457.49,1105.22 2459.84,954.366 2462.19,916.078 2464.54,957.004 2466.89,988.758 2469.24,958.531 2471.59,961.894 2473.94,1060.01 2476.29,928.08 2478.64,827.518 2480.99,988.498 2483.34,852.485 2485.7,910.264 2488.05,642.57 2490.4,998.938 2492.75,907.501 2495.1,1018.66 2497.45,1135.4 2499.8,844.11 2502.15,1087.27 2504.5,742.408 2506.85,849.217 2509.2,1007.94 2511.55,927.266 2513.9,791.297 2516.25,835.243 2518.6,1022.41 2520.95,836.977 2523.3,979.834 2525.65,925.662 2528,927.222 2530.35,920.566 2532.7,1083.44 2535.06,1009.78 2537.41,787.495 2539.76,812.64 2542.11,1045.77 2544.46,901.561 2546.81,990.711 2549.16,1184.42 2551.51,1117.67 2553.86,810.4 2556.21,677.004 2558.56,809.937 2560.91,936.761 2563.26,834.459 2565.61,1003.02 2567.96,1022.91 2570.31,947.499 "></polyline>
<polyline clip-path="url(#clip462)" style="stroke:#3da44d; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,687.121 224.541,311.753 226.891,508.242 229.242,433.518 231.592,260.116 233.943,477.728 236.293,444.429 238.644,342.655 240.994,513.703 243.345,409.843 245.695,451.984 248.046,455.434 250.396,224.177 252.747,385.17 255.097,394.196 257.448,414.114 259.798,194.844 262.148,411.238 264.499,224.651 266.849,487.858 269.2,422.428 271.55,399.008 273.901,326.107 276.251,478.583 278.602,468.119 280.952,467.507 283.303,298.441 285.653,369.703 288.004,199.864 290.354,302.063 292.705,271.459 295.055,381.413 297.406,313.265 299.756,339.214 302.107,509.608 304.457,513.516 306.807,466.385 309.158,135.466 311.508,488.191 313.859,254.957 316.209,410.323 318.56,444.878 320.91,459.663 323.261,468.877 325.611,449.636 327.962,227.9 330.312,606.053 332.663,295.275 335.013,456.684 337.364,392.463 339.714,454.725 342.065,305.315 344.415,289.694 346.765,219.667 349.116,317.904 351.466,464.969 353.817,498.295 356.167,467.338 358.518,344.68 360.868,287.52 363.219,411.586 365.569,596.256 367.92,576.081 370.27,631.35 372.621,350.626 374.971,450.779 377.322,309.136 379.672,576.994 382.023,388.412 384.373,450.586 386.724,459.341 389.074,453.696 391.424,535.005 393.775,432.529 396.125,440.197 398.476,566.143 400.826,332.438 403.177,226.729 405.527,332.051 407.878,622.312 410.228,342.533 412.579,562.546 414.929,454.304 417.28,646.523 419.63,533.575 421.981,433.263 424.331,450.843 426.682,422.322 429.032,473.135 431.382,470.374 433.733,327.691 436.083,338.978 438.434,381.455 440.784,348.331 443.135,308.869 445.485,460.314 447.836,526.556 450.186,324.814 452.537,371.545 454.887,510.59 457.238,455.182 459.588,572.603 461.939,461.795 464.289,414.858 466.64,316.623 468.99,575.467 471.341,408.022 473.691,414.044 476.041,324.583 478.392,427.903 480.742,611.342 483.093,501.927 485.443,456.735 487.794,382.943 490.144,566.581 492.495,543.351 494.845,325.098 497.196,425.576 499.546,377.192 501.897,320.33 504.247,308.201 506.598,497.216 508.948,224.458 511.299,392.69 513.649,354.094 515.999,330.73 518.35,465.402 520.7,569.733 523.051,571.786 525.401,406.517 527.752,571.155 530.102,431.643 532.453,486.757 534.803,380.327 537.154,306.931 539.504,393.601 541.855,305.109 544.205,370.463 546.556,440.462 548.906,462.625 551.257,499.076 553.607,475.69 555.958,457.14 558.308,537.155 560.658,462.174 563.009,577.697 565.359,462.681 567.71,264.65 570.06,384.707 572.411,424.808 574.761,320.221 577.112,526.881 579.462,396.18 581.813,441.347 584.163,411.9 586.514,536.607 588.864,276.184 591.215,373.806 593.565,479.513 595.916,670.644 598.266,292.325 600.616,491.526 602.967,417.454 605.317,352.358 607.668,418.816 610.018,489.491 612.369,710.821 614.719,465.135 617.07,403.92 619.42,439.221 621.771,408.868 624.121,483.639 626.472,415.264 628.822,548.148 631.173,156.595 633.523,422.859 635.874,472.741 638.224,405.055 640.575,296.054 642.925,483.637 645.275,456.714 647.626,524.337 649.976,577.582 652.327,355.843 654.677,321.951 657.028,416.471 659.378,440.937 661.729,375.513 664.079,537.764 666.43,336.879 668.78,498.738 671.131,442.314 673.481,412.596 675.832,273.949 678.182,230.867 680.533,627.886 682.883,372.659 685.233,371.019 687.584,405.683 689.934,530.958 692.285,356.026 694.635,373.929 696.986,316.716 699.336,380.717 701.687,469.124 704.037,331.96 706.388,223.137 708.738,572.539 711.089,299.498 713.439,343.139 715.79,351.036 718.14,424.018 720.491,447.293 722.841,526.563 725.192,331.065 727.542,443.187 729.892,355.199 732.243,281.214 734.593,336.844 736.944,473.133 739.294,566.081 741.645,217.952 743.995,543.59 746.346,225.618 748.696,602.659 751.047,564.471 753.397,389.189 755.748,488.861 758.098,380.252 760.449,205.97 762.799,451.041 765.15,378.33 767.5,482.591 769.85,516.299 772.201,480.804 774.551,323.033 776.902,422.576 779.252,469.717 781.603,501.546 783.953,386.543 786.304,381.137 788.654,403.462 791.005,531.175 793.355,549.511 795.706,389.46 798.056,620.751 800.407,427.244 802.757,500.917 805.108,412.211 807.458,336.12 809.809,428.346 812.159,494.505 814.509,471.85 816.86,479.872 819.21,422.616 821.561,401.754 823.911,490.671 826.262,330.878 828.612,416.373 830.963,624.255 833.313,395.278 835.664,563.469 838.014,440.085 840.365,316.041 842.715,561.922 845.066,337.391 847.416,459.076 849.767,402.289 852.117,662.213 854.467,371.203 856.818,444.475 859.168,454.339 861.519,354.357 863.869,464.862 866.22,458.966 868.57,488.796 870.921,328.494 873.271,379.83 875.622,514.137 877.972,535.348 880.323,576.182 882.673,505.351 885.024,581.009 887.374,391.242 889.725,378.709 892.075,261.457 894.426,340.16 896.776,424.015 899.126,379.889 901.477,489.969 903.827,603.993 906.178,327.043 908.528,484.872 910.879,381.058 913.229,248.407 915.58,463.637 917.93,417.889 920.281,431.448 922.631,555.641 924.982,199.884 927.332,315.864 929.683,399.587 932.033,220.089 934.384,289.5 936.734,286.627 939.084,583.807 941.435,469.27 943.785,285.852 946.136,338.777 948.486,375.827 950.837,401.496 953.187,447.762 955.538,470.331 957.888,405.581 960.239,438.269 962.589,408.678 964.94,309.23 967.29,438.826 969.641,198.818 971.991,536.051 974.342,417.921 976.692,435.656 979.043,303.837 981.393,508.671 983.743,415.778 986.094,318.079 988.444,443.361 990.795,396.324 993.145,290.859 995.496,409.106 997.846,286.444 1000.2,336.424 1002.55,495.089 1004.9,179.776 1007.25,472.544 1009.6,491.968 1011.95,442.173 1014.3,252.328 1016.65,407.31 1019,240.543 1021.35,343.099 1023.7,508.535 1026.05,218.463 1028.4,365.851 1030.75,381.719 1033.1,383.034 1035.45,374.485 1037.8,375.726 1040.15,353.903 1042.51,328.67 1044.86,447.734 1047.21,582.355 1049.56,361.901 1051.91,561.166 1054.26,574.907 1056.61,341.578 1058.96,343.966 1061.31,373.528 1063.66,513.847 1066.01,593.575 1068.36,424.043 1070.71,299.066 1073.06,298.332 1075.41,386.778 1077.76,472.083 1080.11,640.93 1082.46,325.194 1084.81,357.548 1087.16,163.38 1089.51,422.281 1091.87,499.296 1094.22,422.555 1096.57,322.191 1098.92,246.884 1101.27,340.186 1103.62,197.109 1105.97,409.571 1108.32,465.069 1110.67,325.902 1113.02,311.157 1115.37,297.943 1117.72,602.333 1120.07,457.081 1122.42,354.721 1124.77,494.28 1127.12,390.328 1129.47,230.826 1131.82,421.777 1134.17,352.286 1136.52,238.168 1138.87,531.626 1141.23,298.024 1143.58,371.66 1145.93,431.12 1148.28,323.931 1150.63,561.927 1152.98,423.828 1155.33,583.362 1157.68,223.702 1160.03,517.217 1162.38,572.234 1164.73,538.085 1167.08,482.232 1169.43,327.156 1171.78,224.662 1174.13,523.023 1176.48,406.821 1178.83,325.188 1181.18,428.737 1183.53,278.883 1185.88,339.792 1188.23,427.299 1190.59,488.016 1192.94,322.213 1195.29,374.351 1197.64,414.558 1199.99,622.884 1202.34,584.656 1204.69,574.685 1207.04,378.821 1209.39,388.846 1211.74,388.097 1214.09,509.422 1216.44,497.257 1218.79,230.2 1221.14,488.769 1223.49,353.315 1225.84,446.692 1228.19,429.347 1230.54,571.417 1232.89,332.495 1235.24,476.426 1237.59,596.552 1239.94,471.274 1242.3,319.589 1244.65,439.494 1247,545.278 1249.35,398.379 1251.7,491.466 1254.05,266.641 1256.4,348.538 1258.75,231.805 1261.1,460.366 1263.45,290.957 1265.8,449.343 1268.15,298.722 1270.5,427.742 1272.85,276.305 1275.2,254.65 1277.55,325.049 1279.9,314.472 1282.25,457.398 1284.6,338.896 1286.95,552.775 1289.3,450.591 1291.66,262.628 1294.01,459.316 1296.36,184.63 1298.71,515.487 1301.06,342.213 1303.41,96.8724 1305.76,311.936 1308.11,553.132 1310.46,223.027 1312.81,566.091 1315.16,440.996 1317.51,537.756 1319.86,662.899 1322.21,281.605 1324.56,535.143 1326.91,405.624 1329.26,367.644 1331.61,368.442 1333.96,349.907 1336.31,438.356 1338.66,343.824 1341.02,445.701 1343.37,525.43 1345.72,282.157 1348.07,415.796 1350.42,501.058 1352.77,359.2 1355.12,465.967 1357.47,403.397 1359.82,488.833 1362.17,392.185 1364.52,467.09 1366.87,459.789 1369.22,478.322 1371.57,270.916 1373.92,439.083 1376.27,516.854 1378.62,477.974 1380.97,486.838 1383.32,459.946 1385.67,328.314 1388.02,388.373 1390.38,246.529 1392.73,352.524 1395.08,289.542 1397.43,418.387 1399.78,365.762 1402.13,261.622 1404.48,603.969 1406.83,425.484 1409.18,220.324 1411.53,445.995 1413.88,157.989 1416.23,394.239 1418.58,401.219 1420.93,535.257 1423.28,443.833 1425.63,423.088 1427.98,447.219 1430.33,359.856 1432.68,501.049 1435.03,324.212 1437.38,316.026 1439.74,520.11 1442.09,556.509 1444.44,398.517 1446.79,452.198 1449.14,312.648 1451.49,432.181 1453.84,510.674 1456.19,386.244 1458.54,480.983 1460.89,272.727 1463.24,330.646 1465.59,495.385 1467.94,307.453 1470.29,413.997 1472.64,445.794 1474.99,303.225 1477.34,359.355 1479.69,460.974 1482.04,371.577 1484.39,545.747 1486.74,359.856 1489.1,361.114 1491.45,408.189 1493.8,521.499 1496.15,262.073 1498.5,319.748 1500.85,523.313 1503.2,267.214 1505.55,390.579 1507.9,551.678 1510.25,344.885 1512.6,358.901 1514.95,430.124 1517.3,187.46 1519.65,362.838 1522,315.886 1524.35,304.774 1526.7,325.963 1529.05,229.453 1531.4,588.659 1533.75,468.229 1536.1,411.061 1538.45,481.585 1540.81,476.206 1543.16,634.163 1545.51,174.967 1547.86,498.947 1550.21,370.66 1552.56,321.917 1554.91,517.918 1557.26,466.188 1559.61,353.793 1561.96,332.102 1564.31,449.607 1566.66,291.969 1569.01,431.586 1571.36,450.975 1573.71,434.08 1576.06,346.65 1578.41,377.361 1580.76,501.176 1583.11,307.262 1585.46,412.058 1587.81,725.281 1590.17,318.946 1592.52,264.506 1594.87,461.892 1597.22,418.359 1599.57,469.908 1601.92,254.339 1604.27,528.885 1606.62,588.25 1608.97,282.209 1611.32,494.728 1613.67,472.104 1616.02,374.859 1618.37,266.538 1620.72,365.076 1623.07,300.916 1625.42,451.162 1627.77,483.657 1630.12,361.876 1632.47,488.533 1634.82,526.499 1637.17,484.258 1639.53,262.632 1641.88,325.896 1644.23,482.211 1646.58,414.747 1648.93,329.026 1651.28,418.088 1653.63,265.431 1655.98,322.381 1658.33,266.448 1660.68,521.721 1663.03,346.004 1665.38,385.738 1667.73,559.891 1670.08,522.639 1672.43,367.678 1674.78,357.447 1677.13,371.92 1679.48,338.732 1681.83,390.316 1684.18,467.824 1686.53,524.731 1688.89,435.007 1691.24,390.591 1693.59,465.696 1695.94,355.754 1698.29,339.412 1700.64,306.862 1702.99,464.546 1705.34,544.605 1707.69,382.681 1710.04,345.697 1712.39,503.424 1714.74,360.51 1717.09,458.456 1719.44,530.815 1721.79,377.624 1724.14,341.239 1726.49,419.236 1728.84,438.216 1731.19,406.762 1733.54,496.929 1735.89,272.971 1738.25,507.357 1740.6,319.536 1742.95,644.601 1745.3,497.255 1747.65,288.595 1750,277.241 1752.35,279.358 1754.7,301.863 1757.05,330.295 1759.4,370.913 1761.75,512.549 1764.1,246.097 1766.45,272.367 1768.8,366.237 1771.15,488.187 1773.5,335.114 1775.85,300.525 1778.2,499.207 1780.55,362.358 1782.9,182.483 1785.25,557.252 1787.6,381.798 1789.96,418.692 1792.31,398.813 1794.66,490.081 1797.01,294.377 1799.36,444.853 1801.71,325.113 1804.06,250.238 1806.41,432.807 1808.76,254.14 1811.11,525.918 1813.46,452.442 1815.81,351.611 1818.16,428.771 1820.51,462.713 1822.86,298.13 1825.21,186.329 1827.56,578.314 1829.91,493.204 1832.26,147.36 1834.61,637.385 1836.96,587.485 1839.32,461.217 1841.67,302.828 1844.02,336.569 1846.37,408.96 1848.72,406.163 1851.07,539.074 1853.42,430.492 1855.77,232.373 1858.12,276.373 1860.47,445.393 1862.82,394.642 1865.17,534.595 1867.52,575.17 1869.87,363.665 1872.22,516.455 1874.57,436.372 1876.92,546.206 1879.27,440.294 1881.62,374.251 1883.97,305.466 1886.32,590.538 1888.68,341.136 1891.03,336.395 1893.38,511.774 1895.73,290.721 1898.08,590.76 1900.43,386.391 1902.78,402.529 1905.13,504.177 1907.48,619.044 1909.83,469.673 1912.18,422.262 1914.53,391.618 1916.88,384.523 1919.23,420.865 1921.58,534.135 1923.93,292.924 1926.28,339.886 1928.63,234.355 1930.98,588.093 1933.33,484.619 1935.68,380.069 1938.04,235.464 1940.39,402.874 1942.74,157.689 1945.09,626.044 1947.44,630.03 1949.79,644.819 1952.14,639.001 1954.49,400.593 1956.84,346.604 1959.19,400.837 1961.54,407.764 1963.89,501.915 1966.24,459.598 1968.59,551.607 1970.94,367.086 1973.29,585.81 1975.64,445.613 1977.99,335.013 1980.34,352.615 1982.69,409.477 1985.04,299.375 1987.4,420.63 1989.75,557.423 1992.1,341.604 1994.45,502.884 1996.8,328.875 1999.15,324.282 2001.5,202.678 2003.85,496.707 2006.2,310.053 2008.55,399.443 2010.9,291.201 2013.25,446.403 2015.6,363.667 2017.95,526.514 2020.3,466.751 2022.65,305.449 2025,512.902 2027.35,455.859 2029.7,500.897 2032.05,578.135 2034.4,311.684 2036.76,406.71 2039.11,427.861 2041.46,255.264 2043.81,580.386 2046.16,471.173 2048.51,405.718 2050.86,421.819 2053.21,435.929 2055.56,279.084 2057.91,466.346 2060.26,425.836 2062.61,102.437 2064.96,320.754 2067.31,406.111 2069.66,469.408 2072.01,521.951 2074.36,476.167 2076.71,654.357 2079.06,536.415 2081.41,298.138 2083.76,483.219 2086.11,449.349 2088.47,527.986 2090.82,468.354 2093.17,296.503 2095.52,577.84 2097.87,389.774 2100.22,502.927 2102.57,490.438 2104.92,356.511 2107.27,596.871 2109.62,493.68 2111.97,374.86 2114.32,460.208 2116.67,254.427 2119.02,478.771 2121.37,553.275 2123.72,319.121 2126.07,263.849 2128.42,713.242 2130.77,411.515 2133.12,657.161 2135.47,259.024 2137.83,409.392 2140.18,461.18 2142.53,571.273 2144.88,475.765 2147.23,403.461 2149.58,360.33 2151.93,538.281 2154.28,498.602 2156.63,495.77 2158.98,352.894 2161.33,534.81 2163.68,507.801 2166.03,343.646 2168.38,565.646 2170.73,269.138 2173.08,313.247 2175.43,511.009 2177.78,439.162 2180.13,395.753 2182.48,463.152 2184.83,421.728 2187.19,407.687 2189.54,378.132 2191.89,322.129 2194.24,295.556 2196.59,379.491 2198.94,584.866 2201.29,320.968 2203.64,469.397 2205.99,350.678 2208.34,467.188 2210.69,353.423 2213.04,306.892 2215.39,568.931 2217.74,363.367 2220.09,520.172 2222.44,390.658 2224.79,260.488 2227.14,532.459 2229.49,527.991 2231.84,206.854 2234.19,510.016 2236.55,297.175 2238.9,416.941 2241.25,386.714 2243.6,293.836 2245.95,376.377 2248.3,439.659 2250.65,532.638 2253,344.892 2255.35,468.782 2257.7,375.137 2260.05,552.153 2262.4,404.277 2264.75,472.636 2267.1,433.498 2269.45,397.213 2271.8,387.869 2274.15,173.008 2276.5,527.229 2278.85,552.003 2281.2,318.933 2283.55,418.833 2285.91,341.088 2288.26,516.834 2290.61,324.28 2292.96,487.51 2295.31,407.07 2297.66,462.789 2300.01,438.061 2302.36,291.455 2304.71,473.264 2307.06,425.081 2309.41,368.371 2311.76,376.18 2314.11,283.156 2316.46,453.733 2318.81,505.641 2321.16,385.578 2323.51,303.489 2325.86,461.195 2328.21,387.045 2330.56,504.044 2332.91,474.272 2335.27,656.212 2337.62,473.858 2339.97,487.481 2342.32,407.494 2344.67,332.157 2347.02,439.098 2349.37,355.241 2351.72,412.521 2354.07,352.11 2356.42,544.875 2358.77,460.848 2361.12,619.602 2363.47,431.136 2365.82,516.339 2368.17,422.087 2370.52,523.443 2372.87,437.962 2375.22,446.758 2377.57,496.064 2379.92,342.195 2382.27,295.416 2384.62,411.567 2386.98,552.906 2389.33,269.969 2391.68,505.054 2394.03,400.34 2396.38,675.234 2398.73,336.959 2401.08,306.761 2403.43,437.806 2405.78,450.692 2408.13,522.551 2410.48,410.774 2412.83,367.951 2415.18,446.424 2417.53,459.232 2419.88,323.259 2422.23,462.969 2424.58,245.724 2426.93,322.334 2429.28,304.969 2431.63,382.869 2433.98,327.43 2436.34,437.225 2438.69,475.837 2441.04,357.461 2443.39,268.951 2445.74,604.4 2448.09,316.358 2450.44,576.906 2452.79,446.663 2455.14,546.432 2457.49,493.957 2459.84,326.39 2462.19,480.553 2464.54,500.769 2466.89,545.634 2469.24,501.709 2471.59,439.362 2473.94,295.413 2476.29,476.162 2478.64,406.729 2480.99,256.896 2483.34,451.766 2485.7,522.534 2488.05,583.961 2490.4,217.944 2492.75,561.896 2495.1,331.692 2497.45,502.036 2499.8,458.298 2502.15,412.393 2504.5,321.711 2506.85,399.829 2509.2,369.703 2511.55,444.93 2513.9,331.333 2516.25,537.538 2518.6,358.58 2520.95,337.644 2523.3,389.248 2525.65,330.742 2528,382.067 2530.35,364.492 2532.7,458.618 2535.06,422.826 2537.41,487.479 2539.76,337.667 2542.11,425.787 2544.46,522.836 2546.81,511.372 2549.16,333.206 2551.51,383.555 2553.86,432.271 2556.21,391.71 2558.56,515.916 2560.91,258.57 2563.26,400.471 2565.61,479.562 2567.96,391.027 2570.31,552.359 "></polyline>
</svg>
</div>
</div>
<p>Look at that! Things are working; amazin’.</p>
<p>We can also exploit <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>’s parallel sampling capabilities:</p>
<div id="34" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run separate 4 chains for 10 000 iterations using threads to parallelize.</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>num_chains <span class="op">=</span> <span class="fl">4</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    model_with_grad,</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">MCMCThreads</span>(),</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>,</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    num_chains;</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Note we need to provide an initial state for every chain.</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>    initial_state<span class="op">=</span><span class="fu">fill</span>(state, num_chains),</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>samples_array <span class="op">=</span> <span class="fu">stack</span>(<span class="fu">map</span>(<span class="bu">Base</span>.<span class="fu">Fix1</span>(stack, sample <span class="op">-&gt;</span> sample.x), samples))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000×4 Array{Float64, 3}:
[:, :, 1] =
 -1.90241  -6.16198   -5.81824   -5.81824   …  -4.57076  -5.55067  -5.55067
 -0.6011   -0.511287  -0.717448  -0.717448      2.98574   1.11712   1.11712
  3.00557   3.577      3.2493     3.2493        4.80696   4.84567   4.84567

[:, :, 2] =
 -1.78685   -3.28678  -5.04638   -5.84567   …  -4.39678  -5.34568  -5.31358
 -0.348573  -1.03171   0.217711  -0.409112      2.58084   2.29909  -1.23286
  3.39224    4.9482    7.84879    7.78847       4.60991   4.15243   5.70228

[:, :, 3] =
 -4.10525  -3.77286     -5.00934   …  -4.22615  -5.48912  -4.45524
 -1.05972  -0.00791707   0.743294      0.4523   -1.16885  -0.724866
  2.73443   4.36784      3.68662       6.38858   5.76056   5.98309

[:, :, 4] =
 -3.55362    -3.6942    -5.29002  …  -4.4204     -5.12341     -4.95394
 -1.28912    -0.469561  -1.46359     -0.0169158  -0.00343223  -0.692717
 -0.0983537   2.83542    2.57758      5.42862     3.9929       2.52365</code></pre>
</div>
</div>
<p>But the fact that we have to provide the <code>AbstractMCMC.sample</code> call, etc. with an <code>initial_state</code> to get started is a bit annoying. We can avoid this by also defining a <code>AbstractMCMC.step</code> <em>without</em> the <code>state</code> argument:</p>
<div id="36" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">::</span><span class="dt">MALA</span>;</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># </span><span class="al">NOTE</span><span class="co">: No state provided!</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just create the initial state by sampling using  a Gaussian.</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="fu">randn</span>(rng, LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(x), <span class="fu">MALAState</span>(x)</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Equipped with this, we no longer need to provide the <code>initial_state</code> everywhere:</p>
<div id="38" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -5.04169    0.994136
  0.0235342  0.998296
  5.01605    1.02287</code></pre>
</div>
</div>
</section>
<section id="using-our-sampler-with-turing.jl" class="level2">
<h2 class="anchored" data-anchor-id="using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</h2>
<p>As we promised, all of this hassle of implementing our <code>MALA</code> sampler in a way that uses <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> and <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> gets us something more than <em>just</em> an “automatic” implementation of <code>AbstractMCMC.sample</code>.</p>
<p>It also enables use with Turing.jl through the <code>externalsampler</code>, but we need to do one final thing first: we need to tell Turing.jl how to extract a vector of parameters from the “sample” returned in our implementation of <code>AbstractMCMC.step</code>. In our case, the “sample” is a <code>MALASample</code>, so we just need the following line:</p>
<div id="40" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load Turing.jl.</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Turing</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Overload the `getparams` method for our "sample" type, which is just a vector.</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>Turing.Inference.<span class="fu">getparams</span>(<span class="op">::</span><span class="dt">Turing.Model</span>, sample<span class="op">::</span><span class="dt">MALASample</span>) <span class="op">=</span> sample.x</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And with that, we’re good to go!</p>
<div id="42" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Our previous model defined as a Turing.jl model.</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">mvnormal_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">MvNormal</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.], I)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate our model.</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">mvnormal_model</span>()</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Call `sample` but now we're passing in a Turing.jl `model` and wrapping</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co"># our `MALA` sampler in the `externalsampler` to tell Turing.jl that the sampler</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co"># expects something that implements LogDensityProblems.jl.</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×4×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 2.51 seconds
Compute duration  = 2.51 seconds
parameters        = x[1], x[2], x[3]
internals         = lp

Summary Statistics
  parameters      mean       std      mcse    ess_bulk    ess_tail      rhat   ⋯
      Symbol   Float64   Float64   Float64     Float64     Float64   Float64   ⋯

        x[1]   -4.9734    0.9797    0.0173   3194.6109   5019.0081    1.0004   ⋯
        x[2]    0.0099    0.9974    0.0172   3366.5322   5203.0589    1.0000   ⋯
        x[3]    4.9990    0.9913    0.0181   2995.8064   5272.6942    1.0005   ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

        x[1]   -6.8836   -5.6344   -4.9690   -4.3190   -3.0397
        x[2]   -1.9220   -0.6545    0.0032    0.6928    1.9649
        x[3]    3.0928    4.3340    5.0020    5.6728    6.9357</code></pre>
</div>
</div>
<p>Pretty neat, eh?</p>
<section id="models-with-constrained-parameters" class="level3">
<h3 class="anchored" data-anchor-id="models-with-constrained-parameters">Models with constrained parameters</h3>
<p>One thing we’ve sort of glossed over in all of the above is that MALA, at least how we’ve implemented it, requires <span class="math inline">\(x\)</span> to live in <span class="math inline">\(\mathbb{R}^d\)</span> for some <span class="math inline">\(d &gt; 0\)</span>. If some of the parameters were in fact constrained, e.g.&nbsp;we were working with a <code>Beta</code> distribution which has support on the interval <span class="math inline">\((0, 1)\)</span>, <em>not</em> on <span class="math inline">\(\mathbb{R}^d\)</span>, we could easily end up outside of the valid range <span class="math inline">\((0, 1)\)</span>.</p>
<div id="44" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">beta_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">beta_model</span>()</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 1.49 seconds
Compute duration  = 1.49 seconds
parameters        = x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse    ess_bulk    ess_tail      rhat   ⋯
      Symbol   Float64   Float64   Float64     Float64     Float64   Float64   ⋯

           x    0.4966    0.1880    0.0027   4707.3950   5801.6628    1.0002   ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

           x    0.1453    0.3580    0.4945    0.6325    0.8534</code></pre>
</div>
</div>
<p>Yep, that still works, but only because Turing.jl actually <em>transforms</em> the <code>turing_model</code> from constrained to unconstrained, so that the <code>sampler</code> provided to <code>externalsampler</code> is actually always working in unconstrained space! This is not always desirable, so we can turn this off:</p>
<div id="46" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 0.25 seconds
Compute duration  = 0.25 seconds
parameters        = x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse   ess_bulk   ess_tail      rhat   e ⋯
      Symbol   Float64   Float64   Float64    Float64    Float64   Float64     ⋯

           x    0.4747    0.1515    0.0168    75.3770    26.6939    1.0448     ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

           x    0.2098    0.3603    0.4760    0.6023    0.7324</code></pre>
</div>
</div>
<p>The fun thing is that this still sort of works because</p>
<div id="48" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">logpdf</span>(<span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>), <span class="fl">10.0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-Inf</code></pre>
</div>
</div>
<p>and so the samples that fall outside of the range are always rejected. But do notice how much worse all the diagnostics are, e.g.&nbsp;<code>ess_tail</code> is very poor compared to when we use <code>unconstrained=true</code>. Moreover, in more complex cases this won’t just result in a “nice” <code>-Inf</code> log-density value, but instead will error:</p>
<div id="50" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="kw">function</span> <span class="fu">demo</span>()</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>    σ² <span class="op">~</span> <span class="fu">truncated</span>(<span class="fu">Normal</span>(), lower<span class="op">=</span><span class="fl">0</span>)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If we end up with negative values for `σ²`, the `Normal` will error.</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>    x <span class="op">~</span> <span class="fu">Normal</span>(<span class="fl">0</span>, σ²)</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>DomainError: DomainError(Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}}(-0.35264326744843066,1.0,0.0), "Normal: the condition σ &gt;= zero(σ) is not satisfied.")
DomainError with Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}}(-0.35264326744843066,1.0,0.0):
Normal: the condition σ &gt;= zero(σ) is not satisfied.
Stacktrace:
  [1] #371
    @ ~/.julia/packages/Distributions/nmUhn/src/univariate/continuous/normal.jl:37 [inlined]
  [2] check_args
    @ ~/.julia/packages/Distributions/nmUhn/src/utils.jl:89 [inlined]
  [3] #Normal#370
    @ ~/.julia/packages/Distributions/nmUhn/src/univariate/continuous/normal.jl:37 [inlined]
  [4] Normal
    @ ~/.julia/packages/Distributions/nmUhn/src/univariate/continuous/normal.jl:36 [inlined]
  [5] Normal
    @ ~/.julia/packages/Distributions/nmUhn/src/univariate/continuous/normal.jl:42 [inlined]
  [6] macro expansion
    @ ~/.julia/packages/DynamicPPL/MjWTB/src/compiler.jl:579 [inlined]
  [7] demo(__model__::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, __varinfo__::DynamicPPL.ThreadSafeVarInfo{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}, Vector{Set{DynamicPPL.Selector}}}}, ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}, Vector{Base.RefValue{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}, __context__::DynamicPPL.DefaultContext)
    @ Main.Notebook ~/work/docs/docs/tutorials/docs-17-implementing-samplers/index.qmd:592
  [8] _evaluate!!
    @ ~/.julia/packages/DynamicPPL/MjWTB/src/model.jl:973 [inlined]
  [9] evaluate_threadsafe!!(model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, varinfo::DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}, Vector{Set{DynamicPPL.Selector}}}}, ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}, context::DynamicPPL.DefaultContext)
    @ DynamicPPL ~/.julia/packages/DynamicPPL/MjWTB/src/model.jl:962
 [10] evaluate!!
    @ ~/.julia/packages/DynamicPPL/MjWTB/src/model.jl:892 [inlined]
 [11] logdensity
    @ ~/.julia/packages/DynamicPPL/MjWTB/src/logdensityfunction.jl:140 [inlined]
 [12] Fix1
    @ ./operators.jl:1118 [inlined]
 [13] vector_mode_dual_eval!(f::Base.Fix1{typeof(LogDensityProblems.logdensity), LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, Nothing}}, cfg::ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}, x::Vector{Float64})
    @ ForwardDiff ~/.julia/packages/ForwardDiff/PcZ48/src/apiutils.jl:24
 [14] vector_mode_gradient!(result::DiffResults.MutableDiffResult{1, Float64, Tuple{Vector{Float64}}}, f::Base.Fix1{typeof(LogDensityProblems.logdensity), LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, Nothing}}, x::Vector{Float64}, cfg::ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}})
    @ ForwardDiff ~/.julia/packages/ForwardDiff/PcZ48/src/gradient.jl:96
 [15] gradient!
    @ ~/.julia/packages/ForwardDiff/PcZ48/src/gradient.jl:37 [inlined]
 [16] gradient!
    @ ~/.julia/packages/ForwardDiff/PcZ48/src/gradient.jl:35 [inlined]
 [17] logdensity_and_gradient
    @ ~/.julia/packages/LogDensityProblemsAD/rBlLq/ext/LogDensityProblemsADForwardDiffExt.jl:118 [inlined]
 [18] leapfrog_step(model::LogDensityProblemsADForwardDiffExt.ForwardDiffLogDensity{LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, Nothing}, ForwardDiff.Chunk{2}, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}, x::Vector{Float64}, p::Vector{Float64}, ϵ::Int64, M::UniformScaling{Bool})
    @ Main.Notebook ~/work/docs/docs/tutorials/docs-17-implementing-samplers/index.qmd:369
 [19] step(rng::TaskLocalRNG, model_wrapper::AbstractMCMC.LogDensityModel{LogDensityProblemsADForwardDiffExt.ForwardDiffLogDensity{LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, Nothing}, ForwardDiff.Chunk{2}, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}}, sampler::MALA{Int64, UniformScaling{Bool}}, state::MALAState{Vector{Float64}}; kwargs::@Kwargs{})
    @ Main.Notebook ~/work/docs/docs/tutorials/docs-17-implementing-samplers/index.qmd:334
 [20] step
    @ ~/work/docs/docs/tutorials/docs-17-implementing-samplers/index.qmd:316 [inlined]
 [21] #step#107
    @ ~/.julia/packages/Turing/Bv30p/src/mcmc/abstractmcmc.jl:155 [inlined]
 [22] step(rng::TaskLocalRNG, model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, sampler_wrapper::DynamicPPL.Sampler{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}, state::Turing.Inference.TuringState{MALAState{Vector{Float64}}, LogDensityProblemsADForwardDiffExt.ForwardDiffLogDensity{LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, Nothing}, ForwardDiff.Chunk{2}, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}})
    @ Turing.Inference ~/.julia/packages/Turing/Bv30p/src/mcmc/abstractmcmc.jl:144
 [23] macro expansion
    @ ~/.julia/packages/AbstractMCMC/YrmkI/src/sample.jl:176 [inlined]
 [24] macro expansion
    @ ~/.julia/packages/AbstractMCMC/YrmkI/src/logging.jl:16 [inlined]
 [25] mcmcsample(rng::TaskLocalRNG, model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, sampler::DynamicPPL.Sampler{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}, N::Int64; progress::Bool, progressname::String, callback::Nothing, discard_initial::Int64, thinning::Int64, chain_type::Type, initial_state::Nothing, kwargs::@Kwargs{})
    @ AbstractMCMC ~/.julia/packages/AbstractMCMC/YrmkI/src/sample.jl:120
 [26] sample(rng::TaskLocalRNG, model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, sampler::DynamicPPL.Sampler{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}, N::Int64; chain_type::Type, resume_from::Nothing, initial_state::Nothing, kwargs::@Kwargs{progress::Bool})
    @ DynamicPPL ~/.julia/packages/DynamicPPL/MjWTB/src/sampler.jl:93
 [27] sample
    @ ~/.julia/packages/DynamicPPL/MjWTB/src/sampler.jl:83 [inlined]
 [28] #sample#4
    @ ~/.julia/packages/Turing/Bv30p/src/mcmc/Inference.jl:276 [inlined]
 [29] sample
    @ ~/.julia/packages/Turing/Bv30p/src/mcmc/Inference.jl:267 [inlined]
 [30] #sample#3
    @ ~/.julia/packages/Turing/Bv30p/src/mcmc/Inference.jl:264 [inlined]
 [31] top-level scope
    @ ~/work/docs/docs/tutorials/docs-17-implementing-samplers/index.qmd:594</code></pre>
</div>
</div>
<p>As expected, we run into a <code>DomainError</code> at some point, while if we set <code>unconstrained=true</code>, letting Turing.jl transform the model to a unconstrained form behind the scenes, everything works as expected:</p>
<div id="52" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 0.57 seconds
Compute duration  = 0.57 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse   ess_bulk   ess_tail      rhat   e ⋯
      Symbol   Float64   Float64   Float64    Float64    Float64   Float64     ⋯

          σ²    0.2466    0.0000    0.0000        NaN        NaN       NaN     ⋯
           x    0.9085    0.0000    0.0000        NaN        NaN       NaN     ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

          σ²    0.2466    0.2466    0.2466    0.2466    0.2466
           x    0.9085    0.9085    0.9085    0.9085    0.9085</code></pre>
</div>
</div>
<p>Neat!</p>
<p>Similarly, which automatic differentiation backend one should use can be specified through the <code>adtype</code> keyword argument too. For example, if we want to use <a href="https://github.com/JuliaDiff/ReverseDiff.jl">ReverseDiff.jl</a> instead of the default <a href="https://github.com/JuliaDiff/ForwardDiff.jl">ForwardDiff.jl</a>:</p>
<div id="54" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">ReverseDiff</span>: ReverseDiff</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify that we want to use `AutoReverseDiff`.</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">demo</span>(),</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>, adtype<span class="op">=</span><span class="fu">AutoReverseDiff</span>()),</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>;</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 2.97 seconds
Compute duration  = 2.97 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse   ess_bulk   ess_tail      rhat   e ⋯
      Symbol   Float64   Float64   Float64    Float64    Float64   Float64     ⋯

          σ²    0.8541    0.5586    0.0195   632.3137   260.7401    1.0032     ⋯
           x   -0.0837    0.8910    0.0382   698.0517   473.1682    1.0003     ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

          σ²    0.1394    0.4096    0.7217    1.1867    2.2630
           x   -2.1229   -0.4975   -0.0301    0.3322    1.8197</code></pre>
</div>
</div>
<p>Double-neat.</p>
</section>
</section>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<p>At this point it’s worth maybe reminding ourselves what we did and also <em>why</em> we did it:</p>
<ol type="1">
<li>We define our models in the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface because it makes the sampler agnostic to how the underlying model is implemented.</li>
<li>We implement our sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> interface, which just means that our sampler is a subtype of <code>AbstractMCMC.AbstractSampler</code> and we implement the MCMC transition in <code>AbstractMCMC.step</code>.</li>
<li>Points 1 and 2 makes it so our sampler can be used with a wide range of model implementations, amongst them being models implemented in both Turing.jl and Stan. This gives you, the inference implementer, a large collection of models to test your inference method on, in addition to allowing users of Turing.jl and Stan to try out your inference method with minimal effort.</li>
</ol>


</section>


<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a><div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>We’re going with the leapfrog formulation because in a future version of this tutorial we’ll add a section extending this simple “baseline” MALA sampler to more complex versions. See <a href="https://github.com/TuringLang/docs/issues/479">issue #479</a> for progress on this.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>There is no such thing as a proper interface in Julia (at least not officially), and so we use the word “interface” here to mean a few minimal methods that needs to be implemented by any type that we treat as a target model.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/turinglang\.org\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../tutorials/docs-07-for-developers-variational-inference/index.html" class="pagination-link" aria-label="Variational Inference">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Variational Inference</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Turing is created by <a href="http://mlg.eng.cam.ac.uk/hong/" target="_blank">Hong Ge</a>, and lovingly maintained by the <a href="https://github.com/TuringLang/Turing.jl/graphs/contributors" target="_blank">core team</a> of volunteers. <br> The contents of this website are © 2024 under the terms of the <a href="https://github.com/TuringLang/Turing.jl/blob/master/LICENCE" target="_blank">MIT License</a>.</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/TuringLang/docs/edit/master/tutorials/docs-17-implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/docs/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://x.com/TuringLang">
      <i class="bi bi-twitter" role="img" aria-label="Turing Twitter">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/TuringLang/Turing.jl">
      <i class="bi bi-github" role="img" aria-label="Turing GitHub">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




<script src="../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>