<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Implementing Samplers – Turing.jl</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<link href="../../../developers/inference/variational-inference/index.html" rel="prev">
<link href="../../../assets/favicon.ico" rel="icon">
<script src="../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-dark-b53751a350365c71b6c909e95f209ed1.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap-34237cea2e2cc12c7515d5a9baa4807c.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../../site_libs/bootstrap/bootstrap-dark-2ce616a69abdabb5d8b1d1ad44f632cf.min.css" rel="prefetch" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<style>
  a {
    text-decoration: none;
  }
  a:hover {
    text-decoration: underline;
  }
</style>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../../theming/styles.css">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="https://turinglang.org/" class="navbar-brand navbar-brand-logo">
    <img src="../../../assets/images/turing-logo.svg" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="https://turinglang.org/">
    <span class="navbar-title">Turing.jl</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../getting-started/"> 
<span class="menu-text">Get Started</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../tutorials/coin-flipping/"> 
<span class="menu-text">Tutorials</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/library/"> 
<span class="menu-text">Libraries</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/news/"> 
<span class="menu-text">News</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/team/"> 
<span class="menu-text">Team</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-v0.36" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">v0.36</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-v0.36">    
        <li>
    <a class="dropdown-item" href="https://turinglang.org/docs/changelog.html">
 <span class="dropdown-text">Changelog</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://turinglang.org/docs/versions.html">
 <span class="dropdown-text">All Versions</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools tools-wide">
    <a href="https://x.com/TuringLang" title="Turing Twitter" class="quarto-navigation-tool px-1" aria-label="Turing Twitter"><i class="bi bi-twitter"></i></a>
    <a href="https://github.com/TuringLang/Turing.jl" title="Turing GitHub" class="quarto-navigation-tool px-1" aria-label="Turing GitHub"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../../developers/contributing/index.html">Developers</a></li><li class="breadcrumb-item"><a href="../../../developers/inference/abstractmcmc-interface/index.html">Inference (note: outdated)</a></li><li class="breadcrumb-item"><a href="../../../developers/inference/implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../getting-started/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Getting Started</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../core-functionality/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Core Functionality</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false">
 <span class="menu-text">User Guide</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/automatic-differentiation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Automatic Differentiation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/custom-distribution/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Custom Distributions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/probability-interface/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Querying Model Probabilities</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/modifying-logprob/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Modifying the Log Probability</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/generated-quantities/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Generated Quantities</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/mode-estimation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Mode Estimation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/performance-tips/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Performance Tips</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/sampler-visualisation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Sampler Visualization</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/dynamichmc/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using DynamicHMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/external-samplers/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using External Samplers</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false">
 <span class="menu-text">Tutorials</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/coin-flipping/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction: Coin Flipping</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/gaussian-mixture-models/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Mixture Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-neural-networks/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Neural Networks</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/hidden-markov-models/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Hidden Markov Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-linear-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Linear Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/infinite-mixture-models/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Infinite Mixture Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-poisson-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Poisson Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/multinomial-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Multinomial Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-differential-equations/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Differential Equations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/probabilistic-pca/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Probabilistic PCA</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-time-series-analysis/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Time Series Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/gaussian-processes-introduction/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Processes: Introduction</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/gaussian-process-latent-variable-models/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Process Latent Variable Models</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Developers</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/contributing/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Contributing</span></a>
  </div>
</li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false">
 <span class="menu-text">DynamicPPL’s Compiler</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/compiler/model-manual/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Manually Defining a Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/compiler/minituring-compiler/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation I: Compiler</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/compiler/minituring-contexts/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation II: Contexts</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/compiler/design-overview/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Turing Compiler Design (Outdated)</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false">
 <span class="menu-text">Variable Transformations</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/transforms/distributions/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Distributions and the Jacobian</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/transforms/bijectors/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bijectors in MCMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/transforms/dynamicppl/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variable transformations in DynamicPPL</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true">
 <span class="menu-text">Inference (note: outdated)</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/inference/abstractmcmc-interface/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Interface Guide</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/inference/abstractmcmc-turing/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">How Turing Implements AbstractMCMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/inference/variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/inference/implementing-samplers/index.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Implementing Samplers</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of Contents</h2>
   
  <ul>
  <li><a href="#quick-overview-of-mala" id="toc-quick-overview-of-mala" class="nav-link active" data-scroll-target="#quick-overview-of-mala">Quick overview of MALA</a></li>
  <li><a href="#what-we-need-from-a-model-logdensityproblems.jl" id="toc-what-we-need-from-a-model-logdensityproblems.jl" class="nav-link" data-scroll-target="#what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: LogDensityProblems.jl</a></li>
  <li><a href="#implementing-mala-in-abstractmcmc.jl" id="toc-implementing-mala-in-abstractmcmc.jl" class="nav-link" data-scroll-target="#implementing-mala-in-abstractmcmc.jl">Implementing MALA in AbstractMCMC.jl</a></li>
  <li><a href="#using-our-sampler-with-turing.jl" id="toc-using-our-sampler-with-turing.jl" class="nav-link" data-scroll-target="#using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</a>
  <ul class="collapse">
  <li><a href="#models-with-constrained-parameters" id="toc-models-with-constrained-parameters" class="nav-link" data-scroll-target="#models-with-constrained-parameters">Models with constrained parameters</a></li>
  </ul></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/TuringLang/docs/edit/main/developers/inference/implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/docs/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../../developers/contributing/index.html">Developers</a></li><li class="breadcrumb-item"><a href="../../../developers/inference/abstractmcmc-interface/index.html">Inference (note: outdated)</a></li><li class="breadcrumb-item"><a href="../../../developers/inference/implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Implementing Samplers</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>In this tutorial, we’ll go through step-by-step how to implement a “simple” sampler in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> in such a way that it can be easily applied to Turing.jl models.</p>
<p>In particular, we’re going to implement a version of <strong>Metropolis-adjusted Langevin (MALA)</strong>.</p>
<p>Note that we will implement this sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> framework, completely “ignoring” Turing.jl until the very end of the tutorial, at which point we’ll use a single line of code to make the resulting sampler available to Turing.jl. This is to really drive home the point that one can implement samplers in a way that is accessible to all of Turing.jl’s users without having to use Turing.jl yourself.</p>
<section id="quick-overview-of-mala" class="level2">
<h2 class="anchored" data-anchor-id="quick-overview-of-mala">Quick overview of MALA</h2>
<p>We can view MALA as a single step of the leapfrog intergrator with resampling of momentum <span class="math inline">\(p\)</span> at every step.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> To make that statement a bit more concrete, we first define the <em>extended</em> target <span class="math inline">\(\bar{\gamma}(x, p)\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\log \bar{\gamma}(x, p) \propto \log \gamma(x) + \log \gamma_{\mathcal{N}(0, M)}(p)
\end{equation*}\]</span></p>
<p>where <span class="math inline">\(\gamma_{\mathcal{N}(0, M)}\)</span> denotes the density for a zero-centered Gaussian with covariance matrix <span class="math inline">\(M\)</span>. We then consider targeting this joint distribution over both <span class="math inline">\(x\)</span> and <span class="math inline">\(p\)</span> as follows. First we define the map</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  L_{\epsilon}: \quad &amp; \mathbb{R}^d \times \mathbb{R}^d \to \mathbb{R}^d \times \mathbb{R}^d \\
  &amp; (x, p) \mapsto (\tilde{x}, \tilde{p}) := L_{\epsilon}(x, p)
\end{split}
\end{equation*}\]</span></p>
<p>as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p_{1 / 2} &amp;:= p + \frac{\epsilon}{2} \nabla \log \gamma(x) \\
  \tilde{x} &amp;:= x + \epsilon M^{-1} p_{1 /2 } \\
  p_1 &amp;:= p_{1 / 2} + \frac{\epsilon}{2} \nabla \log \gamma(\tilde{x}) \\
  \tilde{p} &amp;:= - p_1
\end{split}
\end{equation*}\]</span></p>
<p>This might be familiar for some readers as a single step of the Leapfrog integrator. We then define the MALA kernel as follows: given the current iterate <span class="math inline">\(x_i\)</span>, we sample the next iterate <span class="math inline">\(x_{i + 1}\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p &amp;\sim \mathcal{N}(0, M) \\
  (\tilde{x}, \tilde{p}) &amp;:= L_{\epsilon}(x_i, p) \\
  \alpha &amp;:= \min \left\{ 1, \frac{\bar{\gamma}(\tilde{x}, \tilde{p})}{\bar{\gamma}(x_i, p)} \right\} \\
  x_{i + 1} &amp;:=
  \begin{cases}
    \tilde{x} \quad &amp; \text{ with prob. } \alpha \\
    x_i       \quad &amp; \text{ with prob. } 1 - \alpha
  \end{cases}
\end{split}
\end{equation*}\]</span></p>
<p>i.e.&nbsp;we accept the proposal <span class="math inline">\(\tilde{x}\)</span> with probability <span class="math inline">\(\alpha\)</span> and reject it, thus sticking with our current iterate, with probability <span class="math inline">\(1 - \alpha\)</span>.</p>
</section>
<section id="what-we-need-from-a-model-logdensityproblems.jl" class="level2">
<h2 class="anchored" data-anchor-id="what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a></h2>
<p>There are a few things we need from the “target” / “model” / density that we want to sample from:</p>
<ol type="1">
<li>We need access to log-density <em>evaluations</em> <span class="math inline">\(\log \gamma(x)\)</span> so we can compute the acceptance ratio involving <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>We need access to log-density <em>gradients</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span> so we can compute the Leapfrog steps <span class="math inline">\(L_{\epsilon}(x, p)\)</span>.</li>
<li>We also need access to the “size” of the model so we can determine the size of <span class="math inline">\(M\)</span>.</li>
</ol>
<p>Luckily for us, there is a package called <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> which provides an interface for <em>exactly</em> this!</p>
<p>To demonstrate how one can implement the “<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface”<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> we will use a simple Gaussian model as an example:</p>
<div id="4" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblems</span>: LogDensityProblems;</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's define some type that represents the model.</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> IsotropicNormalModel{M<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"mean of the isotropic Gaussian"</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    mean<span class="op">::</span><span class="dt">M</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Specifies what input length the model expects.</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">dimension</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> <span class="fu">length</span>(model.mean)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Implementation of the log-density evaluation of the model.</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x<span class="op">::</span><span class="dt">AbstractVector{&lt;:Real}</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">-</span> <span class="fu">sum</span>(abs2, x <span class="op">.-</span> model.mean) <span class="op">/</span> <span class="fl">2</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This gives us all of the properties we want for our MALA sampler with the exception of the computation of the <em>gradient</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span>. There is the method <code>LogDensityProblems.logdensity_and_gradient</code> which should return a 2-tuple where the first entry is the evaluation of the logdensity <span class="math inline">\(\log \gamma(x)\)</span> and the second entry is the gradient <span class="math inline">\(\nabla \log \gamma(x)\)</span>.</p>
<p>There are two ways to “implement” this method: 1) we implement it by hand, which is feasible in the case of our <code>IsotropicNormalModel</code>, or b) we defer the implementation of this to a automatic differentiation backend.</p>
<p>To implement it by hand we can simply do</p>
<div id="6" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl that first-order, i.e. gradient information, is available.</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{1}</span>()</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Implement `logdensity_and_gradient`.</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    logγ_x <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="op">-</span>x <span class="op">.*</span> (x <span class="op">-</span> model.mean)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> logγ_x, ∇logγ_x</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s just try it out:</p>
<div id="8" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate the problem.</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> <span class="fu">IsotropicNormalModel</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.])</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create some example input that we can test on.</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>x_example <span class="op">=</span> <span class="fu">randn</span>(LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate!</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-18.888485520070187</code></pre>
</div>
</div>
<p>To defer it to an automatic differentiation backend, we can do</p>
<div id="10" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl we only have access to 0-th order information.</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{0}</span>()</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Use `LogDensityProblemsAD`'s `ADgradient` in combination with some AD backend to implement `logdensity_and_gradient`.</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblemsAD</span>, <span class="bu">ADTypes</span>, <span class="bu">ForwardDiff</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>model_with_grad <span class="op">=</span> <span class="fu">ADgradient</span>(<span class="fu">AutoForwardDiff</span>(), model)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model_with_grad, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-18.888485520070187</code></pre>
</div>
</div>
<p>We’ll continue with the second approach in this tutorial since this is typically what one does in practice, because there are better hobbies to spend time on than deriving gradients by hand.</p>
<p>At this point, one might wonder how we’re going to tie this back to Turing.jl in the end. Effectively, when working with inference methods that only require log-density evaluations and / or higher-order information of the log-density, Turing.jl actually converts the user-provided <code>Model</code> into an object implementing the above methods for <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>. As a result, most samplers provided by Turing.jl are actually implemented to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, enabling their use both <em>within</em> Turing.jl and <em>outside</em> of Turing.jl! Morever, there exists similar conversions for Stan through BridgeStan and Stan<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, which means that a sampler supporting the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface can easily be used on both Turing.jl <em>and</em> Stan models (in addition to user-provided models, as our <code>IsotropicNormalModel</code> above)!</p>
<p>Anyways, let’s move on to actually implementing the sampler.</p>
</section>
<section id="implementing-mala-in-abstractmcmc.jl" class="level2">
<h2 class="anchored" data-anchor-id="implementing-mala-in-abstractmcmc.jl">Implementing MALA in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a></h2>
<p>Now that we’ve established that a model implementing the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface provides us with all the information we need from <span class="math inline">\(\log \gamma(x)\)</span>, we can address the question: given an object that implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, how can we define a sampler for it?</p>
<p>We’re going to do this by making our sampler a sub-type of <code>AbstractMCMC.AbstractSampler</code> in addition to implementing a few methods from <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>. Why? Because it gets us <em>a lot</em> of functionality for free, as we will see later.</p>
<p>Moreover, <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> provides a very natural interface for MCMC algorithms.</p>
<p>First, we’ll define our <code>MALA</code> type</p>
<div id="12" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">AbstractMCMC</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALA{T,A} <span class="op">&lt;:</span><span class="dt"> AbstractMCMC.AbstractSampler</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"stepsize used in the leapfrog step"</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    ϵ_init<span class="op">::</span><span class="dt">T</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"covariance matrix used for the momentum"</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    M_init<span class="op">::</span><span class="dt">A</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notice how we’ve added the suffix <code>_init</code> to both the stepsize and the covariance matrix. We’ve done this because a <code>AbstractMCMC.AbstractSampler</code> should be <em>immutable</em>. Of course there might be many scenarios where we want to allow something like the stepsize and / or the covariance matrix to vary between iterations, e.g.&nbsp;during the burn-in / adaptation phase of the sampling process we might want to adjust the parameters using statistics computed from these initial iterations. But information which can change between iterations <em>should not go in the sampler itself</em>! Instead, this information should go in the sampler <em>state</em>.</p>
<p>The sampler state should at the very least contain all the necessary information to perform the next MCMC iteration, but usually contains further information, e.g.&nbsp;quantities and statistics useful for evaluating whether the sampler has converged.</p>
<p>We will use the following sampler state for our <code>MALA</code> sampler:</p>
<div id="14" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALAState{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This might seem overly redundant: we’re defining a type <code>MALAState</code> and it only contains a simple vector of reals. In this particular case we indeed could have dropped this and simply used a <code>AbstractVector{&lt;:Real}</code> as our sampler state, but typically, as we will see later, one wants to include other quantities in the sampler state. For example, if we also wanted to adapt the parameters of our <code>MALA</code>, e.g.&nbsp;alter the stepsize depending on acceptance rates, in which case we should also put <code>ϵ</code> in the state, but for now we’ll keep things simple.</p>
<p>Moreover, we also want a <em>sample</em> type, which is a type meant for “public consumption”, i.e.&nbsp;the end-user. This is generally going to contain a subset of the information present in the state. But in such a simple scenario as this, we similarly only have a <code>AbstractVector{&lt;:Real}</code>:</p>
<div id="16" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALASample{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We currently have three things:</p>
<ol type="1">
<li>A <code>AbstractMCMC.AbstractSampler</code> implementation called <code>MALA</code>.</li>
<li>A state <code>MALAState</code> for our sampler <code>MALA</code>.</li>
<li>A sample <code>MALASample</code> for our sampler <code>MALA</code>.</li>
</ol>
<p>That means that we’re ready to implement the only thing that really matters: <code>AbstractMCMC.step</code>.</p>
<p><code>AbstractMCMC.step</code> defines the MCMC iteration of our <code>MALA</code> given the current <code>MALAState</code>. Specifically, the signature of the function is as follows:</p>
<div id="18" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The RNG to ensure reproducibility.</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The model that defines our target.</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.AbstractModel</span>,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The sampler for which we're taking a `step`.</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">AbstractMCMC.AbstractSampler</span>,</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The current sampler `state`.</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    state;</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Additional keyword arguments that we may or may not need.</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Moreover, there is a specific <code>AbstractMCMC.AbstractModel</code> which is used to indicate that the model that is provided implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface: <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Since, as we discussed earlier, in our case we’re indeed going to work with types that support the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, we’ll define <code>AbstractMCMC.step</code> for such a <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Note that <code>AbstractMCMC.LogDensityModel</code> has no other purpose; it has a single field called <code>logdensity</code>, and it does nothing else. But by wrapping the model in <code>AbstractMCMC.LogDensityModel</code>, it allows samplers that want to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> to define their <code>AbstractMCMC.step</code> on this type without running into method ambiguities.</p>
<p>All in all, that means that the signature for our <code>AbstractMCMC.step</code> is going to be the following:</p>
<div id="20" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># `LogDensityModel` so we know we're working with LogDensityProblems.jl model.</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler.</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler state.</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Great! Now let’s actually implement the full <code>AbstractMCMC.step</code> for our <code>MALA</code>.</p>
<p>Let’s remind ourselves what we’re going to do:</p>
<ol type="1">
<li>Sample a new momentum <span class="math inline">\(p\)</span>.</li>
<li>Compute the log-density of the extended target <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>Take a single leapfrog step <span class="math inline">\((\tilde{x}, \tilde{p}) = L_{\epsilon}(x, p)\)</span>.</li>
<li>Accept or reject the proposed <span class="math inline">\((\tilde{x}, \tilde{p})\)</span>.</li>
</ol>
<p>All in all, this results in the following:</p>
<div id="22" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>: Random</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Distributions</span>  <span class="co"># so we get the `MvNormal`</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the wrapped model which implements LogDensityProblems.jl.</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just extract the sampler parameters to make our lives easier.</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    ϵ <span class="op">=</span> sampler.ϵ_init</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    M <span class="op">=</span> sampler.M_init</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the current parameters.</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> state.x</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sample the momentum.</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>    p_dist <span class="op">=</span> <span class="fu">MvNormal</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)), M)</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> <span class="fu">rand</span>(rng, p_dist)</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Propose using a single leapfrog step.</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>    x̃, p̃ <span class="op">=</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Accept or reject proposal.</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>    logp <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p)</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>    logp̃ <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x̃) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p̃)</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>    logα <span class="op">=</span> logp̃ <span class="op">-</span> logp</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>    state_new <span class="op">=</span> <span class="cf">if</span> <span class="fu">log</span>(<span class="fu">rand</span>(rng)) <span class="op">&lt;</span> logα</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Accept.</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x̃)</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Reject.</span></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x)</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return the "sample" and the sampler state.</span></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(state_new.x), state_new</span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Fairly straight-forward.</p>
<p>Of course, we haven’t defined the <code>leapfrog_step</code> method yet, so let’s do that:</p>
<div id="24" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p` using "position" `x`.</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x))</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    p1 <span class="op">=</span> p <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update the "position" `x` using momentum `p1`.</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    x̃ <span class="op">=</span> x <span class="op">+</span> ϵ <span class="op">.*</span> (M <span class="op">\</span> p1)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p1` using position `x̃`</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x̃ <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x̃))</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    p2 <span class="op">=</span> p1 <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x̃</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Flip momentum `p2`.</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    p̃ <span class="op">=</span> <span class="op">-</span>p2</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x̃, p̃</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>leapfrog_step (generic function with 1 method)</code></pre>
</div>
</div>
<p>With all of this, we’re technically ready to sample!</p>
<div id="26" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>, <span class="bu">LinearAlgebra</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>rng <span class="op">=</span> <span class="bu">Random</span>.<span class="fu">default_rng</span>()</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>sampler <span class="op">=</span> <span class="fu">MALA</span>(<span class="fl">1</span>, I)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>state <span class="op">=</span> <span class="fu">MALAState</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)))</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>x_next, state_next <span class="op">=</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    rng,</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    AbstractMCMC.<span class="fu">LogDensityModel</span>(model),</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    state</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>(MALASample{Vector{Float64}}([-2.1804400730317393, 0.026500181008033467, 0.18743586039494062]), MALAState{Vector{Float64}}([-2.1804400730317393, 0.026500181008033467, 0.18743586039494062]))</code></pre>
</div>
</div>
<p>Great, it works!</p>
<p>And I promised we would get quite some functionality for free if we implemented <code>AbstractMCMC.step</code>, and so we can now simply call <code>sample</code> to perform standard MCMC sampling:</p>
<div id="28" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform 1000 iterations with our `MALA` sampler.</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; initial_state<span class="op">=</span>state, progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Concatenate into a matrix.</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000 Matrix{Float64}:
 -2.5673    -4.63283   -5.77488   …  -4.42323   -4.42323   -4.72224
 -0.152821   0.632599  -0.175054     -0.562707  -0.562707   0.722788
  3.45104    6.51515    4.14292       4.35422    4.35422    3.00581</code></pre>
</div>
</div>
<div id="30" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the marginal means and standard deviations.</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -5.02578    0.999001
 -0.0186358  1.00896
  4.98644    1.00329</code></pre>
</div>
</div>
<p>Let’s visualize the samples</p>
<div id="32" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">StatsPlots</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">transpose</span>(samples_matrix[<span class="op">:</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">:</span><span class="kw">end</span>]), alpha<span class="op">=</span><span class="fl">0.5</span>, legend<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<!--?xml version="1.0" encoding="utf-8"?-->
<svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" width="672" height="480" viewbox="0 0 2688 1920">
<defs>
  <clippath id="clip230">
    <rect x="0" y="0" width="2688" height="1920"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip230)" d="M0 1920 L2688 1920 L2688 0 L0 0  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip231">
    <rect x="537" y="0" width="1883" height="1883"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip230)" d="M151.747 1800.78 L2640.76 1800.78 L2640.76 47.2441 L151.747 47.2441  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip232">
    <rect x="151" y="47" width="2490" height="1755"></rect>
  </clippath>
</defs>
<polyline clip-path="url(#clip232)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="219.84,1800.78 219.84,47.2441 "></polyline>
<polyline clip-path="url(#clip232)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="807.458,1800.78 807.458,47.2441 "></polyline>
<polyline clip-path="url(#clip232)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1395.08,1800.78 1395.08,47.2441 "></polyline>
<polyline clip-path="url(#clip232)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1982.69,1800.78 1982.69,47.2441 "></polyline>
<polyline clip-path="url(#clip232)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="2570.31,1800.78 2570.31,47.2441 "></polyline>
<polyline clip-path="url(#clip232)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,1542.24 2640.76,1542.24 "></polyline>
<polyline clip-path="url(#clip232)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,1234.27 2640.76,1234.27 "></polyline>
<polyline clip-path="url(#clip232)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,926.296 2640.76,926.296 "></polyline>
<polyline clip-path="url(#clip232)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,618.325 2640.76,618.325 "></polyline>
<polyline clip-path="url(#clip232)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,310.353 2640.76,310.353 "></polyline>
<polyline clip-path="url(#clip230)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1800.78 2640.76,1800.78 "></polyline>
<polyline clip-path="url(#clip230)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="219.84,1800.78 219.84,1781.88 "></polyline>
<polyline clip-path="url(#clip230)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="807.458,1800.78 807.458,1781.88 "></polyline>
<polyline clip-path="url(#clip230)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1395.08,1800.78 1395.08,1781.88 "></polyline>
<polyline clip-path="url(#clip230)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1982.69,1800.78 1982.69,1781.88 "></polyline>
<polyline clip-path="url(#clip230)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="2570.31,1800.78 2570.31,1781.88 "></polyline>
<path clip-path="url(#clip230)" d="M219.84 1834 Q216.229 1834 214.4 1837.57 Q212.595 1841.11 212.595 1848.24 Q212.595 1855.34 214.4 1858.91 Q216.229 1862.45 219.84 1862.45 Q223.474 1862.45 225.28 1858.91 Q227.108 1855.34 227.108 1848.24 Q227.108 1841.11 225.28 1837.57 Q223.474 1834 219.84 1834 M219.84 1830.3 Q225.65 1830.3 228.706 1834.9 Q231.784 1839.49 231.784 1848.24 Q231.784 1856.96 228.706 1861.57 Q225.65 1866.15 219.84 1866.15 Q214.03 1866.15 210.951 1861.57 Q207.896 1856.96 207.896 1848.24 Q207.896 1839.49 210.951 1834.9 Q214.03 1830.3 219.84 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip230)" d="M771.15 1861.55 L787.47 1861.55 L787.47 1865.48 L765.525 1865.48 L765.525 1861.55 Q768.187 1858.79 772.771 1854.16 Q777.377 1849.51 778.558 1848.17 Q780.803 1845.65 781.683 1843.91 Q782.585 1842.15 782.585 1840.46 Q782.585 1837.71 780.641 1835.97 Q778.72 1834.23 775.618 1834.23 Q773.419 1834.23 770.965 1835 Q768.535 1835.76 765.757 1837.31 L765.757 1832.59 Q768.581 1831.46 771.035 1830.88 Q773.488 1830.3 775.525 1830.3 Q780.896 1830.3 784.09 1832.98 Q787.285 1835.67 787.285 1840.16 Q787.285 1842.29 786.474 1844.21 Q785.687 1846.11 783.581 1848.7 Q783.002 1849.37 779.9 1852.59 Q776.798 1855.78 771.15 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip230)" d="M797.331 1830.92 L815.687 1830.92 L815.687 1834.86 L801.613 1834.86 L801.613 1843.33 Q802.632 1842.98 803.65 1842.82 Q804.669 1842.64 805.687 1842.64 Q811.474 1842.64 814.854 1845.81 Q818.233 1848.98 818.233 1854.4 Q818.233 1859.97 814.761 1863.08 Q811.289 1866.15 804.97 1866.15 Q802.794 1866.15 800.525 1865.78 Q798.28 1865.41 795.872 1864.67 L795.872 1859.97 Q797.956 1861.11 800.178 1861.66 Q802.4 1862.22 804.877 1862.22 Q808.882 1862.22 811.22 1860.11 Q813.558 1858.01 813.558 1854.4 Q813.558 1850.78 811.22 1848.68 Q808.882 1846.57 804.877 1846.57 Q803.002 1846.57 801.127 1846.99 Q799.275 1847.4 797.331 1848.28 L797.331 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip230)" d="M837.446 1834 Q833.835 1834 832.007 1837.57 Q830.201 1841.11 830.201 1848.24 Q830.201 1855.34 832.007 1858.91 Q833.835 1862.45 837.446 1862.45 Q841.081 1862.45 842.886 1858.91 Q844.715 1855.34 844.715 1848.24 Q844.715 1841.11 842.886 1837.57 Q841.081 1834 837.446 1834 M837.446 1830.3 Q843.256 1830.3 846.312 1834.9 Q849.391 1839.49 849.391 1848.24 Q849.391 1856.96 846.312 1861.57 Q843.256 1866.15 837.446 1866.15 Q831.636 1866.15 828.557 1861.57 Q825.502 1856.96 825.502 1848.24 Q825.502 1839.49 828.557 1834.9 Q831.636 1830.3 837.446 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip230)" d="M1354.69 1830.92 L1373.05 1830.92 L1373.05 1834.86 L1358.98 1834.86 L1358.98 1843.33 Q1360 1842.98 1361.01 1842.82 Q1362.03 1842.64 1363.05 1842.64 Q1368.84 1842.64 1372.22 1845.81 Q1375.6 1848.98 1375.6 1854.4 Q1375.6 1859.97 1372.12 1863.08 Q1368.65 1866.15 1362.33 1866.15 Q1360.16 1866.15 1357.89 1865.78 Q1355.64 1865.41 1353.24 1864.67 L1353.24 1859.97 Q1355.32 1861.11 1357.54 1861.66 Q1359.76 1862.22 1362.24 1862.22 Q1366.25 1862.22 1368.58 1860.11 Q1370.92 1858.01 1370.92 1854.4 Q1370.92 1850.78 1368.58 1848.68 Q1366.25 1846.57 1362.24 1846.57 Q1360.37 1846.57 1358.49 1846.99 Q1356.64 1847.4 1354.69 1848.28 L1354.69 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip230)" d="M1394.81 1834 Q1391.2 1834 1389.37 1837.57 Q1387.56 1841.11 1387.56 1848.24 Q1387.56 1855.34 1389.37 1858.91 Q1391.2 1862.45 1394.81 1862.45 Q1398.44 1862.45 1400.25 1858.91 Q1402.08 1855.34 1402.08 1848.24 Q1402.08 1841.11 1400.25 1837.57 Q1398.44 1834 1394.81 1834 M1394.81 1830.3 Q1400.62 1830.3 1403.68 1834.9 Q1406.75 1839.49 1406.75 1848.24 Q1406.75 1856.96 1403.68 1861.57 Q1400.62 1866.15 1394.81 1866.15 Q1389 1866.15 1385.92 1861.57 Q1382.87 1856.96 1382.87 1848.24 Q1382.87 1839.49 1385.92 1834.9 Q1389 1830.3 1394.81 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip230)" d="M1424.97 1834 Q1421.36 1834 1419.53 1837.57 Q1417.73 1841.11 1417.73 1848.24 Q1417.73 1855.34 1419.53 1858.91 Q1421.36 1862.45 1424.97 1862.45 Q1428.61 1862.45 1430.41 1858.91 Q1432.24 1855.34 1432.24 1848.24 Q1432.24 1841.11 1430.41 1837.57 Q1428.61 1834 1424.97 1834 M1424.97 1830.3 Q1430.78 1830.3 1433.84 1834.9 Q1436.92 1839.49 1436.92 1848.24 Q1436.92 1856.96 1433.84 1861.57 Q1430.78 1866.15 1424.97 1866.15 Q1419.16 1866.15 1416.08 1861.57 Q1413.03 1856.96 1413.03 1848.24 Q1413.03 1839.49 1416.08 1834.9 Q1419.16 1830.3 1424.97 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip230)" d="M1940.97 1830.92 L1963.19 1830.92 L1963.19 1832.91 L1950.65 1865.48 L1945.76 1865.48 L1957.57 1834.86 L1940.97 1834.86 L1940.97 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip230)" d="M1972.36 1830.92 L1990.71 1830.92 L1990.71 1834.86 L1976.64 1834.86 L1976.64 1843.33 Q1977.66 1842.98 1978.68 1842.82 Q1979.7 1842.64 1980.72 1842.64 Q1986.5 1842.64 1989.88 1845.81 Q1993.26 1848.98 1993.26 1854.4 Q1993.26 1859.97 1989.79 1863.08 Q1986.32 1866.15 1980 1866.15 Q1977.82 1866.15 1975.55 1865.78 Q1973.31 1865.41 1970.9 1864.67 L1970.9 1859.97 Q1972.98 1861.11 1975.21 1861.66 Q1977.43 1862.22 1979.9 1862.22 Q1983.91 1862.22 1986.25 1860.11 Q1988.59 1858.01 1988.59 1854.4 Q1988.59 1850.78 1986.25 1848.68 Q1983.91 1846.57 1979.9 1846.57 Q1978.03 1846.57 1976.15 1846.99 Q1974.3 1847.4 1972.36 1848.28 L1972.36 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip230)" d="M2012.47 1834 Q2008.86 1834 2007.03 1837.57 Q2005.23 1841.11 2005.23 1848.24 Q2005.23 1855.34 2007.03 1858.91 Q2008.86 1862.45 2012.47 1862.45 Q2016.11 1862.45 2017.91 1858.91 Q2019.74 1855.34 2019.74 1848.24 Q2019.74 1841.11 2017.91 1837.57 Q2016.11 1834 2012.47 1834 M2012.47 1830.3 Q2018.28 1830.3 2021.34 1834.9 Q2024.42 1839.49 2024.42 1848.24 Q2024.42 1856.96 2021.34 1861.57 Q2018.28 1866.15 2012.47 1866.15 Q2006.66 1866.15 2003.59 1861.57 Q2000.53 1856.96 2000.53 1848.24 Q2000.53 1839.49 2003.59 1834.9 Q2006.66 1830.3 2012.47 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip230)" d="M2514.84 1861.55 L2522.48 1861.55 L2522.48 1835.18 L2514.17 1836.85 L2514.17 1832.59 L2522.43 1830.92 L2527.11 1830.92 L2527.11 1861.55 L2534.75 1861.55 L2534.75 1865.48 L2514.84 1865.48 L2514.84 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip230)" d="M2554.19 1834 Q2550.58 1834 2548.75 1837.57 Q2546.94 1841.11 2546.94 1848.24 Q2546.94 1855.34 2548.75 1858.91 Q2550.58 1862.45 2554.19 1862.45 Q2557.82 1862.45 2559.63 1858.91 Q2561.46 1855.34 2561.46 1848.24 Q2561.46 1841.11 2559.63 1837.57 Q2557.82 1834 2554.19 1834 M2554.19 1830.3 Q2560 1830.3 2563.06 1834.9 Q2566.13 1839.49 2566.13 1848.24 Q2566.13 1856.96 2563.06 1861.57 Q2560 1866.15 2554.19 1866.15 Q2548.38 1866.15 2545.3 1861.57 Q2542.25 1856.96 2542.25 1848.24 Q2542.25 1839.49 2545.3 1834.9 Q2548.38 1830.3 2554.19 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip230)" d="M2584.35 1834 Q2580.74 1834 2578.91 1837.57 Q2577.11 1841.11 2577.11 1848.24 Q2577.11 1855.34 2578.91 1858.91 Q2580.74 1862.45 2584.35 1862.45 Q2587.99 1862.45 2589.79 1858.91 Q2591.62 1855.34 2591.62 1848.24 Q2591.62 1841.11 2589.79 1837.57 Q2587.99 1834 2584.35 1834 M2584.35 1830.3 Q2590.16 1830.3 2593.22 1834.9 Q2596.3 1839.49 2596.3 1848.24 Q2596.3 1856.96 2593.22 1861.57 Q2590.16 1866.15 2584.35 1866.15 Q2578.54 1866.15 2575.46 1861.57 Q2572.41 1856.96 2572.41 1848.24 Q2572.41 1839.49 2575.46 1834.9 Q2578.54 1830.3 2584.35 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip230)" d="M2614.51 1834 Q2610.9 1834 2609.07 1837.57 Q2607.27 1841.11 2607.27 1848.24 Q2607.27 1855.34 2609.07 1858.91 Q2610.9 1862.45 2614.51 1862.45 Q2618.15 1862.45 2619.95 1858.91 Q2621.78 1855.34 2621.78 1848.24 Q2621.78 1841.11 2619.95 1837.57 Q2618.15 1834 2614.51 1834 M2614.51 1830.3 Q2620.32 1830.3 2623.38 1834.9 Q2626.46 1839.49 2626.46 1848.24 Q2626.46 1856.96 2623.38 1861.57 Q2620.32 1866.15 2614.51 1866.15 Q2608.7 1866.15 2605.62 1861.57 Q2602.57 1856.96 2602.57 1848.24 Q2602.57 1839.49 2605.62 1834.9 Q2608.7 1830.3 2614.51 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip230)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1800.78 151.747,47.2441 "></polyline>
<polyline clip-path="url(#clip230)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1542.24 170.644,1542.24 "></polyline>
<polyline clip-path="url(#clip230)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1234.27 170.644,1234.27 "></polyline>
<polyline clip-path="url(#clip230)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,926.296 170.644,926.296 "></polyline>
<polyline clip-path="url(#clip230)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,618.325 170.644,618.325 "></polyline>
<polyline clip-path="url(#clip230)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,310.353 170.644,310.353 "></polyline>
<path clip-path="url(#clip230)" d="M49.5521 1542.69 L79.2279 1542.69 L79.2279 1546.63 L49.5521 1546.63 L49.5521 1542.69 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip230)" d="M99.8991 1540.38 Q96.7509 1540.38 94.8991 1542.53 Q93.0704 1544.68 93.0704 1548.43 Q93.0704 1552.16 94.8991 1554.33 Q96.7509 1556.49 99.8991 1556.49 Q103.047 1556.49 104.876 1554.33 Q106.728 1552.16 106.728 1548.43 Q106.728 1544.68 104.876 1542.53 Q103.047 1540.38 99.8991 1540.38 M109.181 1525.72 L109.181 1529.98 Q107.422 1529.15 105.617 1528.71 Q103.834 1528.27 102.075 1528.27 Q97.4454 1528.27 94.9917 1531.39 Q92.5612 1534.52 92.2139 1540.84 Q93.5797 1538.83 95.6398 1537.76 Q97.7 1536.67 100.177 1536.67 Q105.385 1536.67 108.394 1539.84 Q111.427 1542.99 111.427 1548.43 Q111.427 1553.76 108.279 1556.97 Q105.131 1560.19 99.8991 1560.19 Q93.9037 1560.19 90.7325 1555.61 Q87.5612 1551 87.5612 1542.27 Q87.5612 1534.08 91.45 1529.22 Q95.3389 1524.33 101.89 1524.33 Q103.649 1524.33 105.431 1524.68 Q107.237 1525.03 109.181 1525.72 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip230)" d="M50.3623 1234.72 L80.0381 1234.72 L80.0381 1238.65 L50.3623 1238.65 L50.3623 1234.72 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip230)" d="M104.297 1232.91 Q107.654 1233.63 109.529 1235.9 Q111.427 1238.17 111.427 1241.5 Q111.427 1246.62 107.908 1249.42 Q104.39 1252.22 97.9083 1252.22 Q95.7324 1252.22 93.4176 1251.78 Q91.126 1251.36 88.6723 1250.51 L88.6723 1245.99 Q90.6167 1247.13 92.9315 1247.71 Q95.2463 1248.28 97.7695 1248.28 Q102.168 1248.28 104.459 1246.55 Q106.774 1244.81 106.774 1241.5 Q106.774 1238.45 104.621 1236.73 Q102.492 1235 98.6722 1235 L94.6445 1235 L94.6445 1231.15 L98.8574 1231.15 Q102.306 1231.15 104.135 1229.79 Q105.964 1228.4 105.964 1225.81 Q105.964 1223.15 104.066 1221.73 Q102.191 1220.3 98.6722 1220.3 Q96.7509 1220.3 94.5519 1220.71 Q92.3528 1221.13 89.7139 1222.01 L89.7139 1217.84 Q92.376 1217.1 94.6908 1216.73 Q97.0287 1216.36 99.0889 1216.36 Q104.413 1216.36 107.515 1218.79 Q110.617 1221.2 110.617 1225.32 Q110.617 1228.19 108.973 1230.18 Q107.33 1232.15 104.297 1232.91 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip230)" d="M99.4824 912.095 Q95.8713 912.095 94.0426 915.66 Q92.2371 919.202 92.2371 926.331 Q92.2371 933.438 94.0426 937.002 Q95.8713 940.544 99.4824 940.544 Q103.117 940.544 104.922 937.002 Q106.751 933.438 106.751 926.331 Q106.751 919.202 104.922 915.66 Q103.117 912.095 99.4824 912.095 M99.4824 908.391 Q105.293 908.391 108.348 912.998 Q111.427 917.581 111.427 926.331 Q111.427 935.058 108.348 939.664 Q105.293 944.248 99.4824 944.248 Q93.6723 944.248 90.5936 939.664 Q87.538 935.058 87.538 926.331 Q87.538 917.581 90.5936 912.998 Q93.6723 908.391 99.4824 908.391 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip230)" d="M104.297 616.971 Q107.654 617.688 109.529 619.957 Q111.427 622.225 111.427 625.559 Q111.427 630.674 107.908 633.475 Q104.39 636.276 97.9083 636.276 Q95.7324 636.276 93.4176 635.836 Q91.126 635.42 88.6723 634.563 L88.6723 630.049 Q90.6167 631.184 92.9315 631.762 Q95.2463 632.341 97.7695 632.341 Q102.168 632.341 104.459 630.605 Q106.774 628.869 106.774 625.559 Q106.774 622.503 104.621 620.79 Q102.492 619.054 98.6722 619.054 L94.6445 619.054 L94.6445 615.211 L98.8574 615.211 Q102.306 615.211 104.135 613.846 Q105.964 612.457 105.964 609.864 Q105.964 607.202 104.066 605.79 Q102.191 604.355 98.6722 604.355 Q96.7509 604.355 94.5519 604.772 Q92.3528 605.188 89.7139 606.068 L89.7139 601.901 Q92.376 601.161 94.6908 600.79 Q97.0287 600.42 99.0889 600.42 Q104.413 600.42 107.515 602.85 Q110.617 605.258 110.617 609.378 Q110.617 612.248 108.973 614.239 Q107.33 616.207 104.297 616.971 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip230)" d="M99.8991 308.49 Q96.7509 308.49 94.8991 310.643 Q93.0704 312.795 93.0704 316.545 Q93.0704 320.272 94.8991 322.448 Q96.7509 324.601 99.8991 324.601 Q103.047 324.601 104.876 322.448 Q106.728 320.272 106.728 316.545 Q106.728 312.795 104.876 310.643 Q103.047 308.49 99.8991 308.49 M109.181 293.837 L109.181 298.096 Q107.422 297.263 105.617 296.823 Q103.834 296.383 102.075 296.383 Q97.4454 296.383 94.9917 299.508 Q92.5612 302.633 92.2139 308.953 Q93.5797 306.939 95.6398 305.874 Q97.7 304.786 100.177 304.786 Q105.385 304.786 108.394 307.957 Q111.427 311.106 111.427 316.545 Q111.427 321.869 108.279 325.087 Q105.131 328.304 99.8991 328.304 Q93.9037 328.304 90.7325 323.721 Q87.5612 319.115 87.5612 310.388 Q87.5612 302.194 91.45 297.332 Q95.3389 292.448 101.89 292.448 Q103.649 292.448 105.431 292.795 Q107.237 293.143 109.181 293.837 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip232)" style="stroke:#009af9; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,1189.85 224.541,1434.41 226.891,1489.2 229.242,1543.04 231.592,1423.67 233.943,1657.01 236.293,1430.2 238.644,1458.69 240.994,1396.15 243.345,1535.01 245.695,1310.28 248.046,1441.85 250.396,1260.06 252.747,1417.27 255.097,1438.59 257.448,1369.66 259.798,1604.86 262.148,1293.05 264.499,1674.46 266.849,1392.91 269.2,1340.67 271.55,1663.61 273.901,1488.37 276.251,1489.21 278.602,1369.95 280.952,1552.86 283.303,1541.85 285.653,1440.29 288.004,1415.59 290.354,1450.74 292.705,1431.33 295.055,1583.09 297.406,1605.38 299.756,1369.06 302.107,1586.71 304.457,1485.73 306.807,1272.66 309.158,1694.58 311.508,1468.28 313.859,1218.67 316.209,1240.23 318.56,1375.06 320.91,1459.59 323.261,1473.62 325.611,1409.43 327.962,1374.07 330.312,1572.89 332.663,1369.23 335.013,1526.38 337.364,1350.74 339.714,1586.91 342.065,1320.39 344.415,1541.99 346.765,1445.83 349.116,1462.05 351.466,1495.35 353.817,1498.51 356.167,1411.47 358.518,1635.33 360.868,1453.59 363.219,1550.25 365.569,1163.81 367.92,1367.67 370.27,1504.5 372.621,1480.8 374.971,1406.12 377.322,1453.36 379.672,1495.71 382.023,1414.08 384.373,1401.02 386.724,1472.84 389.074,1486.53 391.424,1599.38 393.775,1490.64 396.125,1377.94 398.476,1568.92 400.826,1431.94 403.177,1343.96 405.527,1384.92 407.878,1442.02 410.228,1515.74 412.579,1398.85 414.929,1615.17 417.28,1279.84 419.63,1447.33 421.981,1256.18 424.331,1398.85 426.682,1350.46 429.032,1395.01 431.382,1435.19 433.733,1539.54 436.083,1454.01 438.434,1506.95 440.784,1468.84 443.135,1656.05 445.485,1486.52 447.836,1436.44 450.186,1341.9 452.537,1254.23 454.887,1590.39 457.238,1356.51 459.588,1697.94 461.939,1647.2 464.289,1314.06 466.64,1444.72 468.99,1527.47 471.341,1647.05 473.691,1464.96 476.041,1568.01 478.392,1442.38 480.742,1367.78 483.093,1525.28 485.443,1486.35 487.794,1434.07 490.144,1314.07 492.495,1652.33 494.845,1446.04 497.196,1186.92 499.546,1344.94 501.897,1399.66 504.247,1303.65 506.598,1400.72 508.948,1544.9 511.299,1312.11 513.649,1497.78 515.999,1470.23 518.35,1548.75 520.7,1543.32 523.051,1468.48 525.401,1445.92 527.752,1475.59 530.102,1365.8 532.453,1439.54 534.803,1433.25 537.154,1484 539.504,1529.45 541.855,1464.54 544.205,1500.85 546.556,1380.04 548.906,1477.13 551.257,1444.59 553.607,1544.39 555.958,1234.81 558.308,1537.81 560.658,1413.37 563.009,1489.6 565.359,1345.26 567.71,1182.31 570.06,1390.41 572.411,1433.49 574.761,1573.18 577.112,1544.38 579.462,1416.92 581.813,1503.82 584.163,1496.41 586.514,1557.71 588.864,1555.29 591.215,1595.51 593.565,1247.2 595.916,1392.79 598.266,1400.5 600.616,1340.91 602.967,1475.89 605.317,1404.62 607.668,1491.48 610.018,1363.54 612.369,1463.12 614.719,1311.22 617.07,1597.26 619.42,1374.22 621.771,1499.7 624.121,1460.16 626.472,1701.93 628.822,1569.93 631.173,1550.85 633.523,1559.01 635.874,1686.12 638.224,1451.07 640.575,1419.71 642.925,1417.51 645.275,1415.33 647.626,1498.31 649.976,1335.97 652.327,1307.67 654.677,1530.32 657.028,1473.46 659.378,1355.96 661.729,1345.42 664.079,1431 666.43,1598.09 668.78,1501.83 671.131,1276.64 673.481,1255.75 675.832,1435.33 678.182,1458.26 680.533,1406.69 682.883,1233.87 685.233,1593.11 687.584,1472 689.934,1223.32 692.285,1528.82 694.635,1368.45 696.986,1342.31 699.336,1519.12 701.687,1391.36 704.037,1344.74 706.388,1470.56 708.738,1340.67 711.089,1369.84 713.439,1545.93 715.79,1415.41 718.14,1436.54 720.491,1542.43 722.841,1452.61 725.192,1496.35 727.542,1430.06 729.892,1409.99 732.243,1412.32 734.593,1543.29 736.944,1527.41 739.294,1583.49 741.645,1310.21 743.995,1466.15 746.346,1265.27 748.696,1367.66 751.047,1416.42 753.397,1538.45 755.748,1495.26 758.098,1482.35 760.449,1462.71 762.799,1554.47 765.15,1392.06 767.5,1419.94 769.85,1390.34 772.201,1576.86 774.551,1625.29 776.902,1331.63 779.252,1625.93 781.603,1380 783.953,1539.37 786.304,1489.45 788.654,1345.15 791.005,1562.61 793.355,1319.92 795.706,1232.76 798.056,1500.24 800.407,1478.95 802.757,1561.57 805.108,1518.01 807.458,1369.22 809.809,1313.46 812.159,1373.74 814.509,1453.2 816.86,1473.49 819.21,1508.03 821.561,1519.67 823.911,1377.6 826.262,1382.07 828.612,1507.97 830.963,1695.69 833.313,1451.94 835.664,1439.21 838.014,1461.38 840.365,1497.6 842.715,1575.48 845.066,1522.78 847.416,1410.82 849.767,1375.39 852.117,1385.28 854.467,1406.04 856.818,1261.38 859.168,1512.9 861.519,1311.44 863.869,1549.54 866.22,1415.94 868.57,1294.76 870.921,1591.84 873.271,1436.27 875.622,1312.45 877.972,1500.63 880.323,1363.39 882.673,1610.4 885.024,1583.94 887.374,1318.34 889.725,1401.27 892.075,1355.88 894.426,1450.74 896.776,1335.66 899.126,1361.74 901.477,1495.9 903.827,1424.37 906.178,1357 908.528,1130.71 910.879,1294.04 913.229,1383.01 915.58,1656.56 917.93,1383.74 920.281,1477.54 922.631,1493.68 924.982,1473.45 927.332,1398.66 929.683,1582.33 932.033,1563.56 934.384,1363.27 936.734,1468.78 939.084,1244.1 941.435,1579.99 943.785,1581.99 946.136,1335.15 948.486,1611.22 950.837,1312.67 953.187,1481.75 955.538,1377.04 957.888,1363.15 960.239,1440.44 962.589,1492.85 964.94,1189.35 967.29,1421.96 969.641,1484.03 971.991,1427.21 974.342,1345.86 976.692,1496.3 979.043,1477.26 981.393,1299.88 983.743,1575.84 986.094,1394.2 988.444,1605 990.795,1428.72 993.145,1481.53 995.496,1349.32 997.846,1291.43 1000.2,1306.61 1002.55,1353.96 1004.9,1665.6 1007.25,1442.35 1009.6,1564.8 1011.95,1182.26 1014.3,1536.63 1016.65,1458.02 1019,1546.85 1021.35,1452.11 1023.7,1298.63 1026.05,1495.18 1028.4,1323.16 1030.75,1498.61 1033.1,1409.49 1035.45,1575.59 1037.8,1363.64 1040.15,1266.06 1042.51,1441.36 1044.86,1450.09 1047.21,1301.71 1049.56,1309.26 1051.91,1301.58 1054.26,1516.17 1056.61,1390.47 1058.96,1377.36 1061.31,1428.1 1063.66,1347.24 1066.01,1390.8 1068.36,1289.98 1070.71,1487.85 1073.06,1486.96 1075.41,1285.29 1077.76,1608.48 1080.11,1469.36 1082.46,1544.42 1084.81,1499.2 1087.16,1575.46 1089.51,1344.11 1091.87,1285.1 1094.22,1449.18 1096.57,1266.44 1098.92,1456.26 1101.27,1639.47 1103.62,1299.84 1105.97,1180.93 1108.32,1532.41 1110.67,1516.86 1113.02,1512.76 1115.37,1440.27 1117.72,1394.04 1120.07,1434.06 1122.42,1431.37 1124.77,1337.72 1127.12,1627.19 1129.47,1408.67 1131.82,1506.62 1134.17,1309.65 1136.52,1473.11 1138.87,1568.01 1141.23,1533.43 1143.58,1484.36 1145.93,1335.69 1148.28,1331.65 1150.63,1467.24 1152.98,1434.23 1155.33,1479.15 1157.68,1430.08 1160.03,1365.49 1162.38,1247.89 1164.73,1520.48 1167.08,1613.93 1169.43,1295.62 1171.78,1450.23 1174.13,1482.21 1176.48,1398.54 1178.83,1406.66 1181.18,1407.94 1183.53,1432.03 1185.88,1294.15 1188.23,1421.09 1190.59,1538.22 1192.94,1431.54 1195.29,1380.91 1197.64,1482.31 1199.99,1520.62 1202.34,1297.76 1204.69,1413.2 1207.04,1472.24 1209.39,1471.92 1211.74,1467.31 1214.09,1464.39 1216.44,1389.21 1218.79,1547.33 1221.14,1561.84 1223.49,1348.39 1225.84,1381.82 1228.19,1400.71 1230.54,1323.4 1232.89,1001.09 1235.24,1336.7 1237.59,1485.89 1239.94,1450.08 1242.3,1710.66 1244.65,1338.9 1247,1416.5 1249.35,1560.55 1251.7,1325.91 1254.05,1493.61 1256.4,1459.39 1258.75,1297.51 1261.1,1432.08 1263.45,1321.18 1265.8,1368.6 1268.15,1447.66 1270.5,1418.81 1272.85,1499.71 1275.2,1455.03 1277.55,1402.24 1279.9,1538.52 1282.25,1418.56 1284.6,1477.37 1286.95,1523.47 1289.3,1329.32 1291.66,1464.48 1294.01,1460.74 1296.36,1341.48 1298.71,1504.93 1301.06,1364.84 1303.41,1453.78 1305.76,1273.09 1308.11,1418.8 1310.46,1486.96 1312.81,1506.02 1315.16,1663.27 1317.51,1512.57 1319.86,1375.84 1322.21,1506 1324.56,1465.67 1326.91,1346.2 1329.26,1477.07 1331.61,1340.06 1333.96,1436.84 1336.31,1338.86 1338.66,1325.46 1341.02,1298.04 1343.37,1531.8 1345.72,1375.96 1348.07,1329.24 1350.42,1436.18 1352.77,1309.57 1355.12,1391.43 1357.47,1432.03 1359.82,1587.26 1362.17,1438.3 1364.52,1598.99 1366.87,1357.89 1369.22,1619.64 1371.57,1457.04 1373.92,1533.21 1376.27,1436.67 1378.62,1451.55 1380.97,1370.27 1383.32,1607.15 1385.67,1477.79 1388.02,1355.05 1390.38,1501.91 1392.73,1472.39 1395.08,1521.74 1397.43,1476.88 1399.78,1619.06 1402.13,1456.81 1404.48,1711.87 1406.83,1476.7 1409.18,1489.65 1411.53,1489.81 1413.88,1203.58 1416.23,1558.55 1418.58,1459.44 1420.93,1458.14 1423.28,1575.93 1425.63,1565.35 1427.98,1381.61 1430.33,1393.09 1432.68,1522.73 1435.03,1340.09 1437.38,1307.95 1439.74,1498.07 1442.09,1445.26 1444.44,1534.95 1446.79,1453.8 1449.14,1601.63 1451.49,1243.03 1453.84,1328.03 1456.19,1365.72 1458.54,1222.73 1460.89,1408.35 1463.24,1434.13 1465.59,1574.69 1467.94,1326.6 1470.29,1462.67 1472.64,1559.12 1474.99,1402.41 1477.34,1569.68 1479.69,1357.23 1482.04,1598.23 1484.39,1273.48 1486.74,1420.13 1489.1,1361.6 1491.45,1393.44 1493.8,1714.37 1496.15,1604.04 1498.5,1522.73 1500.85,1427.09 1503.2,1441.27 1505.55,1422 1507.9,1493.24 1510.25,1554.97 1512.6,1565.16 1514.95,1404.94 1517.3,1283.17 1519.65,1309.34 1522,1342.21 1524.35,1389.01 1526.7,1459.38 1529.05,1520.77 1531.4,1618.16 1533.75,1637.37 1536.1,1428.29 1538.45,1446.93 1540.81,1285.9 1543.16,1555.68 1545.51,1461.58 1547.86,1550.33 1550.21,1425.2 1552.56,1388.97 1554.91,1485.77 1557.26,1332.24 1559.61,1320.41 1561.96,1431 1564.31,1617.92 1566.66,1438.77 1569.01,1365.38 1571.36,1525.58 1573.71,1544.02 1576.06,1262.96 1578.41,1457.56 1580.76,1463.3 1583.11,1425.37 1585.46,1370.39 1587.81,1530.82 1590.17,1474.31 1592.52,1521.61 1594.87,1466.88 1597.22,1553.78 1599.57,1537.15 1601.92,1405.27 1604.27,1367.41 1606.62,1613.44 1608.97,1603.41 1611.32,1489.14 1613.67,1469.69 1616.02,1523.53 1618.37,1458.06 1620.72,1467.87 1623.07,1369.95 1625.42,1593.04 1627.77,1467.37 1630.12,1454.7 1632.47,1534.04 1634.82,1445.97 1637.17,1385.57 1639.53,1417.9 1641.88,1637.77 1644.23,1427.54 1646.58,1444.33 1648.93,1265.63 1651.28,1512.67 1653.63,1256.85 1655.98,1346.49 1658.33,1533.21 1660.68,1374.34 1663.03,1220.76 1665.38,1514.33 1667.73,1442 1670.08,1511.73 1672.43,1414.31 1674.78,1340.16 1677.13,1579.41 1679.48,1433.15 1681.83,1510.9 1684.18,1314.45 1686.53,1346.72 1688.89,1531.59 1691.24,1377.91 1693.59,1507.97 1695.94,1660.12 1698.29,1553.13 1700.64,1501.64 1702.99,1504.77 1705.34,1314.95 1707.69,1448.42 1710.04,1397.28 1712.39,1300.08 1714.74,1445.38 1717.09,1386.73 1719.44,1564.37 1721.79,1533.35 1724.14,1448.99 1726.49,1442.64 1728.84,1641.56 1731.19,1462.48 1733.54,1553.04 1735.89,1469.82 1738.25,1282.2 1740.6,1528.48 1742.95,1544.74 1745.3,1321.13 1747.65,1498.48 1750,1472.9 1752.35,1431.32 1754.7,1591.3 1757.05,1456.2 1759.4,1491.64 1761.75,1571.03 1764.1,1504.18 1766.45,1490.67 1768.8,1604.26 1771.15,1447.67 1773.5,1610.52 1775.85,1508.64 1778.2,1443.68 1780.55,1528.76 1782.9,1438.9 1785.25,1419.9 1787.6,1400.33 1789.96,1536.05 1792.31,1383.89 1794.66,1442.83 1797.01,1602.74 1799.36,1353.12 1801.71,1401.92 1804.06,1327.06 1806.41,1460.46 1808.76,1337.71 1811.11,1395.35 1813.46,1257.05 1815.81,1333.06 1818.16,1527.06 1820.51,1378.32 1822.86,1613.33 1825.21,1270.38 1827.56,1415.2 1829.91,1477.48 1832.26,1522.5 1834.61,1342.03 1836.96,1576.68 1839.32,1376.67 1841.67,1521.37 1844.02,1625.13 1846.37,1422.29 1848.72,1347.49 1851.07,1427.56 1853.42,1402.63 1855.77,1355.13 1858.12,1630.25 1860.47,1467.02 1862.82,1258.3 1865.17,1472.25 1867.52,1390.42 1869.87,1435.51 1872.22,1370.12 1874.57,1399.88 1876.92,1486.46 1879.27,1484.44 1881.62,1488.24 1883.97,1327.78 1886.32,1270.18 1888.68,1324.87 1891.03,1517.44 1893.38,1473.81 1895.73,1667.13 1898.08,1457.24 1900.43,1480.39 1902.78,1367 1905.13,1469.2 1907.48,1505.93 1909.83,1522.99 1912.18,1401.17 1914.53,1515.19 1916.88,1434.69 1919.23,1314.71 1921.58,1440.9 1923.93,1482.31 1926.28,1587.5 1928.63,1598.45 1930.98,1609.26 1933.33,1449.25 1935.68,1353.98 1938.04,1345.31 1940.39,1524.5 1942.74,1598.88 1945.09,1593.41 1947.44,1454.04 1949.79,1428.06 1952.14,1487.69 1954.49,1508.29 1956.84,1282.83 1959.19,1445.1 1961.54,1442.42 1963.89,1543.66 1966.24,1245.11 1968.59,1242.93 1970.94,1518.49 1973.29,1408.4 1975.64,1556.64 1977.99,1470.67 1980.34,1465.21 1982.69,1471.01 1985.04,1412.86 1987.4,1537.56 1989.75,1245.11 1992.1,1456.27 1994.45,1383.32 1996.8,1378.58 1999.15,1484.52 2001.5,1516.56 2003.85,1554.25 2006.2,1487.35 2008.55,1433.79 2010.9,1246.16 2013.25,1354.5 2015.6,1401.28 2017.95,1361.89 2020.3,1514.57 2022.65,1327.54 2025,1452.93 2027.35,1426.26 2029.7,1491.83 2032.05,1453.66 2034.4,1285.68 2036.76,1401.58 2039.11,1516.53 2041.46,1447.7 2043.81,1628.36 2046.16,1442.81 2048.51,1533 2050.86,1391.49 2053.21,1523.91 2055.56,1570.36 2057.91,1434.78 2060.26,1397.57 2062.61,1492.84 2064.96,1562.66 2067.31,1372.36 2069.66,1545.93 2072.01,1484.19 2074.36,1486.52 2076.71,1529.99 2079.06,1466.86 2081.41,1463.44 2083.76,1545.87 2086.11,1489.24 2088.47,1270.7 2090.82,1458.23 2093.17,1648.91 2095.52,1357.67 2097.87,1532.93 2100.22,1498.36 2102.57,1258.35 2104.92,1534.43 2107.27,1331.79 2109.62,1370.45 2111.97,1448.56 2114.32,1503.47 2116.67,1490.11 2119.02,1471.52 2121.37,1470.5 2123.72,1566.1 2126.07,1496.02 2128.42,1438.63 2130.77,1395.85 2133.12,1422.48 2135.47,1493.68 2137.83,1391.62 2140.18,1469.76 2142.53,1261.8 2144.88,1606.24 2147.23,1442.02 2149.58,1317.95 2151.93,1402.62 2154.28,1425.07 2156.63,1426.33 2158.98,1427.82 2161.33,1323.32 2163.68,1430.6 2166.03,1414.68 2168.38,1316.73 2170.73,1337.85 2173.08,1594.25 2175.43,1587.29 2177.78,1541.35 2180.13,1459.54 2182.48,1427.81 2184.83,1357.09 2187.19,1447.72 2189.54,1501.24 2191.89,1431.94 2194.24,1452.59 2196.59,1346.58 2198.94,1268.7 2201.29,1612.18 2203.64,1344.09 2205.99,1496.9 2208.34,1424.81 2210.69,1530.78 2213.04,1473.56 2215.39,1461.74 2217.74,1313.8 2220.09,1485.75 2222.44,1509.84 2224.79,1425.45 2227.14,1422.34 2229.49,1393.1 2231.84,1403.22 2234.19,1313.81 2236.55,1501.03 2238.9,1376.85 2241.25,1587.11 2243.6,1540.65 2245.95,1494.37 2248.3,1567.22 2250.65,1449.8 2253,1582.09 2255.35,1311.82 2257.7,1659.29 2260.05,1394.7 2262.4,1542.66 2264.75,1502.84 2267.1,1379.82 2269.45,1460.18 2271.8,1637.35 2274.15,1543.86 2276.5,1447.18 2278.85,1423.11 2281.2,1322.19 2283.55,1348.03 2285.91,1214.68 2288.26,1471.02 2290.61,1344.5 2292.96,1371.58 2295.31,1751.15 2297.66,1538.58 2300.01,1384.28 2302.36,1483.33 2304.71,1322.06 2307.06,1400.36 2309.41,1402.85 2311.76,1553.2 2314.11,1463.19 2316.46,1273.57 2318.81,1510.9 2321.16,1508.36 2323.51,1370.63 2325.86,1487.38 2328.21,1490.57 2330.56,1506.53 2332.91,1445.27 2335.27,1407.94 2337.62,1540.83 2339.97,1300.12 2342.32,1676.35 2344.67,1343.11 2347.02,1519.19 2349.37,1617.95 2351.72,1394.07 2354.07,1306.1 2356.42,1367.46 2358.77,1377.16 2361.12,1329.05 2363.47,1577.71 2365.82,1695.34 2368.17,1546.56 2370.52,1478.73 2372.87,1405.52 2375.22,1473.67 2377.57,1392.37 2379.92,1296.52 2382.27,1413.65 2384.62,1510.55 2386.98,1693.83 2389.33,1468.73 2391.68,1480.18 2394.03,1541.36 2396.38,1444.48 2398.73,1429.09 2401.08,1380.64 2403.43,1250.15 2405.78,1627.36 2408.13,1426.78 2410.48,1446.33 2412.83,1521.71 2415.18,1340.22 2417.53,1390.52 2419.88,1424.54 2422.23,1497.49 2424.58,1310.73 2426.93,1429.02 2429.28,1507.17 2431.63,1346.19 2433.98,1272.41 2436.34,1296.05 2438.69,1410.28 2441.04,1540.8 2443.39,1467.79 2445.74,1322.64 2448.09,1464.94 2450.44,1596.71 2452.79,1356.81 2455.14,1430.32 2457.49,1310.9 2459.84,1256.42 2462.19,1282.78 2464.54,1280.75 2466.89,1503.75 2469.24,1523.83 2471.59,1586.05 2473.94,1495.57 2476.29,1368.53 2478.64,1374.29 2480.99,1512.81 2483.34,1450.88 2485.7,1532.93 2488.05,1548.61 2490.4,1613.24 2492.75,1533.03 2495.1,1459.74 2497.45,1540.53 2499.8,1525.16 2502.15,1407.88 2504.5,1599.24 2506.85,1322.18 2509.2,1324.39 2511.55,1447.91 2513.9,1476.1 2516.25,1515.36 2518.6,1437.47 2520.95,1429.04 2523.3,1521.57 2525.65,1468.22 2528,1576.76 2530.35,1504.43 2532.7,1498.51 2535.06,1265.51 2537.41,1449.22 2539.76,1421.74 2542.11,1449.07 2544.46,1303.69 2546.81,1360.21 2549.16,1420.97 2551.51,1523.82 2553.86,1424.81 2556.21,1469.37 2558.56,1441.9 2560.91,1393.11 2563.26,1532.23 2565.61,1538.6 2567.96,1332.27 2570.31,1508.23 "></polyline>
<polyline clip-path="url(#clip232)" style="stroke:#e26f46; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,941.985 224.541,939.79 226.891,1045.05 229.242,904.528 231.592,904.104 233.943,870.466 236.293,949.236 238.644,818.588 240.994,922.344 243.345,1068.46 245.695,1001.96 248.046,757.726 250.396,707.101 252.747,850.741 255.097,1189.61 257.448,898.623 259.798,781.734 262.148,778.863 264.499,977.347 266.849,951.364 269.2,737.698 271.55,830.908 273.901,822.191 276.251,963.733 278.602,901.977 280.952,1147.58 283.303,953.978 285.653,1056.1 288.004,803.538 290.354,846.223 292.705,1073.08 295.055,824.11 297.406,932.735 299.756,1095.94 302.107,953.194 304.457,706.449 306.807,957.051 309.158,1038.26 311.508,980.41 313.859,931.948 316.209,681.41 318.56,963.418 320.91,909.198 323.261,928.13 325.611,926.381 327.962,878.543 330.312,888.198 332.663,731.502 335.013,986.85 337.364,797.185 339.714,912.452 342.065,1042.01 344.415,918.547 346.765,1148.42 349.116,866.379 351.466,847.815 353.817,874.185 356.167,679.837 358.518,998.801 360.868,875.914 363.219,1114.69 365.569,864.939 367.92,956.723 370.27,820.655 372.621,783.561 374.971,866.436 377.322,996.792 379.672,1000.75 382.023,811.562 384.373,940.065 386.724,890.793 389.074,1031.82 391.424,861.656 393.775,972.055 396.125,942.911 398.476,867.393 400.826,802.896 403.177,941.063 405.527,954.009 407.878,1064.66 410.228,924.589 412.579,934.915 414.929,961.833 417.28,800.711 419.63,826.527 421.981,763.49 424.331,1049.15 426.682,829.566 429.032,985.015 431.382,871.272 433.733,786.271 436.083,882.841 438.434,1057.25 440.784,1020.55 443.135,758.035 445.485,812.129 447.836,1019.13 450.186,1021.49 452.537,944.023 454.887,909.565 457.238,784.391 459.588,936.293 461.939,792.192 464.289,795.34 466.64,928.258 468.99,886.349 471.341,1082.15 473.691,1077.43 476.041,879.077 478.392,831.055 480.742,927.509 483.093,1028.27 485.443,1138.8 487.794,671.931 490.144,845.711 492.495,1192.82 494.845,862.155 497.196,875.935 499.546,1089.79 501.897,922.08 504.247,953.121 506.598,1078.42 508.948,807.351 511.299,1029.13 513.649,894.527 515.999,808.603 518.35,1053.58 520.7,825.795 523.051,715.318 525.401,844.54 527.752,995.84 530.102,876.798 532.453,1111.41 534.803,735.315 537.154,1075.81 539.504,805.281 541.855,880.969 544.205,959.682 546.556,917.33 548.906,967.152 551.257,1022.65 553.607,1011.96 555.958,1010.29 558.308,1083.22 560.658,828.18 563.009,969.724 565.359,992.156 567.71,962.18 570.06,1002.25 572.411,917.91 574.761,947.857 577.112,1043.01 579.462,761.975 581.813,1100.15 584.163,1097.39 586.514,1035.7 588.864,911.594 591.215,864.246 593.565,933.487 595.916,697.753 598.266,757.261 600.616,1002.73 602.967,927.993 605.317,776.34 607.668,962.922 610.018,1006.96 612.369,1095.3 614.719,947.475 617.07,896.381 619.42,881.849 621.771,969.622 624.121,1020.95 626.472,762.133 628.822,995.126 631.173,1086.45 633.523,816.846 635.874,900.366 638.224,976.193 640.575,1006.87 642.925,809.04 645.275,749.173 647.626,896.837 649.976,1027.23 652.327,943.672 654.677,1040.34 657.028,946.5 659.378,910.939 661.729,930.823 664.079,892.538 666.43,713.043 668.78,919.764 671.131,905.736 673.481,1000.35 675.832,780.839 678.182,691.328 680.533,1035.67 682.883,1015.66 685.233,950.209 687.584,884.298 689.934,1035.47 692.285,947.702 694.635,1098.55 696.986,943.591 699.336,980.308 701.687,851.963 704.037,831.349 706.388,886.47 708.738,815.213 711.089,910.528 713.439,960.639 715.79,972.101 718.14,823.854 720.491,1052.08 722.841,790.338 725.192,913.685 727.542,1014.21 729.892,941.167 732.243,1059.12 734.593,1071.95 736.944,973.557 739.294,821.905 741.645,909.311 743.995,888.24 746.346,958.12 748.696,905.028 751.047,1107.55 753.397,951.188 755.748,966.865 758.098,954.077 760.449,1008.55 762.799,904.017 765.15,920.844 767.5,1048.43 769.85,1021.37 772.201,986.267 774.551,911.375 776.902,879.37 779.252,840.431 781.603,1031.3 783.953,943.897 786.304,919.609 788.654,1022.79 791.005,893.634 793.355,996.686 795.706,781.93 798.056,1118.14 800.407,1174.55 802.757,977.306 805.108,1025.92 807.458,692.886 809.809,1063.85 812.159,1052.13 814.509,1122.46 816.86,1100.63 819.21,939.976 821.561,1141.68 823.911,794.984 826.262,1133.47 828.612,998.536 830.963,899.792 833.313,889.011 835.664,1019.43 838.014,1007.73 840.365,1170.11 842.715,807.178 845.066,890.482 847.416,954.817 849.767,1092.77 852.117,1006.32 854.467,965.832 856.818,1019.12 859.168,930.013 861.519,947.891 863.869,974.854 866.22,917.208 868.57,876.925 870.921,1103.23 873.271,784.093 875.622,983.981 877.972,841.506 880.323,1080.75 882.673,1046.05 885.024,1259.11 887.374,1149.29 889.725,909.347 892.075,918.495 894.426,879.851 896.776,830.451 899.126,861.251 901.477,866.264 903.827,999.071 906.178,958.697 908.528,955.444 910.879,1113.53 913.229,912.107 915.58,1066.67 917.93,1031.86 920.281,911.586 922.631,915.049 924.982,906.499 927.332,901.994 929.683,903.487 932.033,1008.55 934.384,858.222 936.734,1020.41 939.084,965.971 941.435,698.66 943.785,932.592 946.136,897.275 948.486,793.177 950.837,934.762 953.187,1109.06 955.538,955.14 957.888,925.251 960.239,1108.37 962.589,1001.71 964.94,798.77 967.29,906.053 969.641,1060.05 971.991,1082.5 974.342,959.25 976.692,850.828 979.043,920.675 981.393,943.061 983.743,863.542 986.094,951.267 988.444,1083.25 990.795,727.526 993.145,953.528 995.496,828.3 997.846,1051.88 1000.2,1095.44 1002.55,915.162 1004.9,944.088 1007.25,917.375 1009.6,976.128 1011.95,1021.61 1014.3,935.029 1016.65,1000 1019,832.657 1021.35,1114.22 1023.7,883.211 1026.05,868.917 1028.4,963.708 1030.75,846.734 1033.1,836.837 1035.45,791.141 1037.8,686.764 1040.15,1064.22 1042.51,872.708 1044.86,879.245 1047.21,743.873 1049.56,963.451 1051.91,876.758 1054.26,879.257 1056.61,769.02 1058.96,964.969 1061.31,825.883 1063.66,792.238 1066.01,1072.97 1068.36,902.116 1070.71,921.654 1073.06,876.594 1075.41,747.536 1077.76,954.564 1080.11,1059.15 1082.46,751.632 1084.81,944.921 1087.16,912.857 1089.51,864.864 1091.87,1051.86 1094.22,964.48 1096.57,921.735 1098.92,1105.23 1101.27,918.771 1103.62,862.939 1105.97,915.003 1108.32,940.897 1110.67,843.504 1113.02,890.361 1115.37,965.364 1117.72,949.111 1120.07,858.991 1122.42,929.862 1124.77,887.05 1127.12,1145.71 1129.47,1026.6 1131.82,782.098 1134.17,782.731 1136.52,991.479 1138.87,902.745 1141.23,814.993 1143.58,936.042 1145.93,917.197 1148.28,736 1150.63,810.093 1152.98,1119.38 1155.33,816.853 1157.68,792.058 1160.03,721.499 1162.38,1044.65 1164.73,916.013 1167.08,765.791 1169.43,835.608 1171.78,965.9 1174.13,870.465 1176.48,832.504 1178.83,1082.93 1181.18,772.943 1183.53,1058.47 1185.88,888.347 1188.23,956.701 1190.59,700.429 1192.94,1166.59 1195.29,1042.71 1197.64,728.114 1199.99,1088.43 1202.34,939.721 1204.69,991.347 1207.04,751.12 1209.39,1162.64 1211.74,941.129 1214.09,800.352 1216.44,1007.78 1218.79,904.022 1221.14,936.507 1223.49,942.843 1225.84,718.857 1228.19,815.934 1230.54,843.782 1232.89,865.656 1235.24,950.618 1237.59,837.267 1239.94,1054.03 1242.3,715.138 1244.65,1124.42 1247,1140.1 1249.35,746.762 1251.7,986.748 1254.05,924.604 1256.4,885.188 1258.75,981.294 1261.1,1151.35 1263.45,997.155 1265.8,1209.67 1268.15,1049.07 1270.5,914.035 1272.85,913.821 1275.2,853.743 1277.55,960.835 1279.9,920.61 1282.25,872.272 1284.6,792.137 1286.95,988.448 1289.3,812.93 1291.66,1009.33 1294.01,851.061 1296.36,835.587 1298.71,1008.33 1301.06,941.329 1303.41,970.085 1305.76,1106.84 1308.11,1026.66 1310.46,899.182 1312.81,893.675 1315.16,1160.51 1317.51,1034.58 1319.86,1067.3 1322.21,689.634 1324.56,1083.98 1326.91,757.789 1329.26,983.232 1331.61,988.346 1333.96,895.72 1336.31,1002.52 1338.66,935.598 1341.02,974.702 1343.37,931.987 1345.72,802.671 1348.07,913.538 1350.42,930.765 1352.77,1102.41 1355.12,1038.54 1357.47,992.718 1359.82,929.144 1362.17,806.863 1364.52,769.092 1366.87,844.676 1369.22,775.605 1371.57,930.359 1373.92,834.85 1376.27,1045.31 1378.62,1020.75 1380.97,1016.4 1383.32,1032.42 1385.67,865.891 1388.02,1027.64 1390.38,909.364 1392.73,999.669 1395.08,1045.29 1397.43,951.527 1399.78,954.251 1402.13,807.782 1404.48,900.59 1406.83,992.097 1409.18,889.666 1411.53,813.578 1413.88,886.917 1416.23,900.344 1418.58,983.657 1420.93,706.654 1423.28,867.13 1425.63,987.017 1427.98,989.03 1430.33,946.45 1432.68,812.997 1435.03,955.412 1437.38,853.183 1439.74,959.632 1442.09,1038.73 1444.44,866.243 1446.79,700.794 1449.14,777.71 1451.49,774.853 1453.84,913.957 1456.19,889.923 1458.54,872.864 1460.89,866.176 1463.24,976.652 1465.59,875.041 1467.94,965.8 1470.29,954.443 1472.64,1013.49 1474.99,1063.11 1477.34,914.542 1479.69,742.915 1482.04,775.491 1484.39,917.812 1486.74,871.212 1489.1,944.191 1491.45,833.995 1493.8,909.689 1496.15,1043.47 1498.5,902.61 1500.85,825.493 1503.2,831.577 1505.55,891.219 1507.9,754.838 1510.25,853.464 1512.6,1006.45 1514.95,1098.04 1517.3,956.749 1519.65,825.866 1522,871.721 1524.35,773.421 1526.7,922.919 1529.05,1030.73 1531.4,1094.98 1533.75,878.351 1536.1,857.823 1538.45,802.628 1540.81,881.776 1543.16,960.261 1545.51,929.957 1547.86,884.597 1550.21,1069.84 1552.56,943.007 1554.91,1003.16 1557.26,953.076 1559.61,801.28 1561.96,892.851 1564.31,830.625 1566.66,870.446 1569.01,767.399 1571.36,1105.53 1573.71,859.229 1576.06,946.209 1578.41,1041.51 1580.76,1015.6 1583.11,982.709 1585.46,773.56 1587.81,1006.81 1590.17,891.187 1592.52,795.47 1594.87,1028.73 1597.22,803.985 1599.57,1031.96 1601.92,1159.42 1604.27,1089.05 1606.62,912.421 1608.97,1110.5 1611.32,928.147 1613.67,922.176 1616.02,991.325 1618.37,993.914 1620.72,906.157 1623.07,935.966 1625.42,840.912 1627.77,923.187 1630.12,803.051 1632.47,1234.28 1634.82,843.902 1637.17,929.711 1639.53,902.579 1641.88,906.198 1644.23,859.396 1646.58,874.547 1648.93,872.278 1651.28,1061.25 1653.63,1050.53 1655.98,1020.82 1658.33,983.907 1660.68,944.064 1663.03,944.32 1665.38,970.452 1667.73,980.36 1670.08,961.683 1672.43,1070.29 1674.78,849.447 1677.13,683.546 1679.48,1166.15 1681.83,921.127 1684.18,808.341 1686.53,894.067 1688.89,935.004 1691.24,885.682 1693.59,941.229 1695.94,818.641 1698.29,941.522 1700.64,833.646 1702.99,835.641 1705.34,951.418 1707.69,1133.36 1710.04,835.411 1712.39,909.861 1714.74,973.148 1717.09,1302.68 1719.44,1013.77 1721.79,770.313 1724.14,803.927 1726.49,846.278 1728.84,950.684 1731.19,855.061 1733.54,902.077 1735.89,1019.37 1738.25,922.061 1740.6,925.816 1742.95,791.967 1745.3,996.017 1747.65,1062.72 1750,749.61 1752.35,837.347 1754.7,784.775 1757.05,797.673 1759.4,998.243 1761.75,1030.91 1764.1,800.907 1766.45,1055.74 1768.8,871.067 1771.15,948.881 1773.5,1007.11 1775.85,843.094 1778.2,874.197 1780.55,1002.36 1782.9,1055.71 1785.25,810.651 1787.6,852.269 1789.96,1095.78 1792.31,871.925 1794.66,845.992 1797.01,1169.09 1799.36,955.872 1801.71,753.474 1804.06,944.678 1806.41,929.37 1808.76,955.877 1811.11,1066.56 1813.46,894.079 1815.81,986.205 1818.16,882.974 1820.51,931.051 1822.86,939.573 1825.21,1000.57 1827.56,931.109 1829.91,1033.69 1832.26,851.028 1834.61,1120.98 1836.96,985.107 1839.32,899.499 1841.67,1053.61 1844.02,1010.98 1846.37,827.964 1848.72,891.475 1851.07,869.159 1853.42,983.961 1855.77,874.6 1858.12,811.411 1860.47,925.08 1862.82,1021.5 1865.17,835.771 1867.52,1074.28 1869.87,1019.61 1872.22,940.311 1874.57,1041.41 1876.92,1081.77 1879.27,785.877 1881.62,835.249 1883.97,939.93 1886.32,888.789 1888.68,994.881 1891.03,986.182 1893.38,845.734 1895.73,1070.99 1898.08,1001.2 1900.43,922.765 1902.78,925.144 1905.13,1010.94 1907.48,928.511 1909.83,913.504 1912.18,831.768 1914.53,1110.35 1916.88,892.86 1919.23,1011.19 1921.58,836.184 1923.93,975.828 1926.28,1001.19 1928.63,901.939 1930.98,829.26 1933.33,956.897 1935.68,975.259 1938.04,854.702 1940.39,1026.17 1942.74,810.165 1945.09,847.271 1947.44,857.891 1949.79,930.029 1952.14,757.114 1954.49,885.203 1956.84,891.56 1959.19,913.102 1961.54,939.116 1963.89,759.972 1966.24,919.083 1968.59,1068.45 1970.94,967.596 1973.29,956.67 1975.64,957.618 1977.99,861.698 1980.34,910.257 1982.69,1104.41 1985.04,981.321 1987.4,1168.54 1989.75,1155.55 1992.1,776.142 1994.45,1263.52 1996.8,839.223 1999.15,799.765 2001.5,964.538 2003.85,935.195 2006.2,818.715 2008.55,875.057 2010.9,987.431 2013.25,1075.58 2015.6,802.216 2017.95,1160.94 2020.3,825.214 2022.65,1074.61 2025,1051.62 2027.35,911.543 2029.7,888.468 2032.05,970.706 2034.4,842.595 2036.76,842.789 2039.11,919.933 2041.46,947.679 2043.81,1112.56 2046.16,723.786 2048.51,931.789 2050.86,874.304 2053.21,1002.32 2055.56,776.978 2057.91,1016.82 2060.26,870.669 2062.61,1191.04 2064.96,1051.38 2067.31,842.897 2069.66,780.804 2072.01,940.529 2074.36,991.809 2076.71,786.833 2079.06,934.441 2081.41,943.176 2083.76,892.003 2086.11,807.613 2088.47,949.997 2090.82,879.585 2093.17,871.597 2095.52,1036.05 2097.87,988.09 2100.22,1058.6 2102.57,1017.16 2104.92,899.07 2107.27,1062.88 2109.62,1021.7 2111.97,896.245 2114.32,938.228 2116.67,1081.23 2119.02,854.187 2121.37,1045.46 2123.72,938.561 2126.07,1053.64 2128.42,874.656 2130.77,1105.88 2133.12,897.73 2135.47,1034.23 2137.83,1019.86 2140.18,661.397 2142.53,966.447 2144.88,958.848 2147.23,730.998 2149.58,1125.22 2151.93,1005.82 2154.28,975.89 2156.63,925.017 2158.98,950.373 2161.33,1003.53 2163.68,1074.91 2166.03,866.137 2168.38,864.569 2170.73,927.971 2173.08,980.417 2175.43,858.168 2177.78,877.726 2180.13,830.819 2182.48,836.01 2184.83,775.727 2187.19,976.899 2189.54,962.956 2191.89,1046.87 2194.24,920.296 2196.59,1119.61 2198.94,918.841 2201.29,925.676 2203.64,912.373 2205.99,676.82 2208.34,664.933 2210.69,1036.01 2213.04,847.302 2215.39,978.097 2217.74,988.124 2220.09,819.96 2222.44,887.456 2224.79,866.181 2227.14,873.59 2229.49,1142.25 2231.84,845.328 2234.19,998.434 2236.55,862.37 2238.9,785.451 2241.25,1090.21 2243.6,1050.23 2245.95,841.846 2248.3,942.179 2250.65,845.372 2253,962.567 2255.35,1018.34 2257.7,775.566 2260.05,875.44 2262.4,1003.51 2264.75,890.23 2267.1,1000.75 2269.45,984.765 2271.8,924.418 2274.15,914.504 2276.5,934.887 2278.85,965.461 2281.2,793.746 2283.55,888.523 2285.91,1119.11 2288.26,790.693 2290.61,821.789 2292.96,731.33 2295.31,882.369 2297.66,889.406 2300.01,1028.11 2302.36,797.567 2304.71,907.534 2307.06,901.096 2309.41,874.687 2311.76,706.669 2314.11,709.667 2316.46,880.55 2318.81,863.423 2321.16,1045.64 2323.51,941.79 2325.86,1069.18 2328.21,1040.69 2330.56,1151.6 2332.91,1114.17 2335.27,873.122 2337.62,890.04 2339.97,849.824 2342.32,975.407 2344.67,962.608 2347.02,1062.16 2349.37,781.28 2351.72,1002.42 2354.07,1096.22 2356.42,1044.91 2358.77,774.18 2361.12,944.98 2363.47,888.477 2365.82,973.984 2368.17,849.376 2370.52,856.791 2372.87,943.104 2375.22,1035.03 2377.57,724.218 2379.92,842.043 2382.27,952.091 2384.62,1006.9 2386.98,994.004 2389.33,919.272 2391.68,835.692 2394.03,894.726 2396.38,940.636 2398.73,970.509 2401.08,818.101 2403.43,867.252 2405.78,865.386 2408.13,823.18 2410.48,944.019 2412.83,962.94 2415.18,1022.35 2417.53,965.159 2419.88,969.654 2422.23,887.28 2424.58,1000.85 2426.93,974.163 2429.28,870.267 2431.63,1043.59 2433.98,967.397 2436.34,894.669 2438.69,1170.69 2441.04,965.76 2443.39,926.743 2445.74,965.961 2448.09,846.314 2450.44,857.196 2452.79,1039.56 2455.14,985.943 2457.49,785.914 2459.84,886.76 2462.19,947.255 2464.54,857.486 2466.89,959.434 2469.24,849.689 2471.59,1024.34 2473.94,842.698 2476.29,776.537 2478.64,886.449 2480.99,874.504 2483.34,940.014 2485.7,776.87 2488.05,868.301 2490.4,970.317 2492.75,1100.62 2495.1,984.94 2497.45,857.83 2499.8,845.929 2502.15,826.52 2504.5,1098.89 2506.85,895 2509.2,1022.56 2511.55,912.637 2513.9,1077.84 2516.25,993.398 2518.6,949.026 2520.95,874.807 2523.3,901.327 2525.65,1048.73 2528,922.332 2530.35,993.88 2532.7,980.847 2535.06,1008.96 2537.41,869.188 2539.76,897.951 2542.11,923.238 2544.46,827.379 2546.81,960.84 2549.16,891.517 2551.51,860.235 2553.86,872.052 2556.21,774.578 2558.56,979.305 2560.91,995.234 2563.26,917.002 2565.61,1126.29 2567.96,990.313 2570.31,792.765 "></polyline>
<polyline clip-path="url(#clip232)" style="stroke:#3da44d; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,572.022 224.541,408.643 226.891,431.037 229.242,236.835 231.592,558.602 233.943,510.393 236.293,287.724 238.644,448.914 240.994,552.823 243.345,500.488 245.695,408.091 248.046,345.256 250.396,290.677 252.747,269.615 255.097,273.383 257.448,418.723 259.798,479.365 262.148,447.768 264.499,453.68 266.849,394.382 269.2,678.034 271.55,277.405 273.901,507.058 276.251,352.214 278.602,470.227 280.952,443.05 283.303,295.264 285.653,500.294 288.004,441.477 290.354,389.972 292.705,295.792 295.055,464.362 297.406,488.513 299.756,635.895 302.107,302.871 304.457,245.33 306.807,613.217 309.158,393.957 311.508,487.259 313.859,369.204 316.209,373.139 318.56,503.977 320.91,459.089 323.261,475.266 325.611,432.829 327.962,540.624 330.312,352.484 332.663,537.652 335.013,394.328 337.364,452.351 339.714,491.07 342.065,355.628 344.415,481.161 346.765,500.467 349.116,464.064 351.466,350.316 353.817,610.279 356.167,539.077 358.518,257.548 360.868,456.953 363.219,507.334 365.569,332.772 367.92,287.972 370.27,348.985 372.621,533.558 374.971,371.608 377.322,556.103 379.672,314.27 382.023,393.698 384.373,401.226 386.724,306.24 389.074,510.675 391.424,496.476 393.775,560.156 396.125,159.378 398.476,456.571 400.826,519.166 403.177,425.841 405.527,423.081 407.878,461.931 410.228,365.557 412.579,476.59 414.929,431.147 417.28,456.918 419.63,380.063 421.981,358.312 424.331,334.662 426.682,231.168 429.032,356.924 431.382,508.55 433.733,478.613 436.083,391.217 438.434,577.795 440.784,572.784 443.135,234.017 445.485,315.022 447.836,303.742 450.186,377.086 452.537,417.485 454.887,402.215 457.238,197.925 459.588,326.133 461.939,170.615 464.289,440.254 466.64,647.864 468.99,352.707 471.341,320.489 473.691,424.12 476.041,525.531 478.392,425.75 480.742,406.546 483.093,523.911 485.443,232.724 487.794,269.257 490.144,272.259 492.495,156.768 494.845,304.732 497.196,495.164 499.546,314.541 501.897,486.93 504.247,405.402 506.598,386.898 508.948,397.24 511.299,237.469 513.649,420.23 515.999,488.803 518.35,289.535 520.7,516.366 523.051,392.463 525.401,525.534 527.752,426.842 530.102,288.371 532.453,343.574 534.803,287.018 537.154,586.878 539.504,410.714 541.855,364.157 544.205,436.943 546.556,424.926 548.906,394.698 551.257,364.273 553.607,254.015 555.958,414.526 558.308,583.716 560.658,329.386 563.009,534.194 565.359,304.888 567.71,460.054 570.06,428.652 572.411,464.159 574.761,408.817 577.112,480.496 579.462,455.676 581.813,417.843 584.163,253.983 586.514,184.769 588.864,563.533 591.215,555.668 593.565,479.791 595.916,630.161 598.266,326.344 600.616,260.054 602.967,269.935 605.317,489.719 607.668,503.807 610.018,614.571 612.369,419.957 614.719,451.382 617.07,269.318 619.42,238.598 621.771,405.57 624.121,359.934 626.472,574.013 628.822,369.724 631.173,525.823 633.523,327.679 635.874,473.588 638.224,356.682 640.575,444.283 642.925,322.253 645.275,397.609 647.626,392.208 649.976,372.326 652.327,278.098 654.677,391.232 657.028,385.944 659.378,203.725 661.729,433.985 664.079,354.753 666.43,376.678 668.78,662.982 671.131,493.457 673.481,341.879 675.832,274.957 678.182,441.422 680.533,604.807 682.883,339.58 685.233,335.774 687.584,269.027 689.934,326.064 692.285,277.85 694.635,394.303 696.986,579.341 699.336,313.032 701.687,346.533 704.037,803.005 706.388,313.053 708.738,332.333 711.089,436.649 713.439,533.421 715.79,416.904 718.14,600.176 720.491,361.494 722.841,426.768 725.192,432.641 727.542,361.254 729.892,269.857 732.243,558.126 734.593,558.773 736.944,436.452 739.294,503.615 741.645,268.569 743.995,393.312 746.346,357.983 748.696,156.555 751.047,348.219 753.397,314.553 755.748,492.272 758.098,412.9 760.449,451.981 762.799,359.896 765.15,325.019 767.5,462.069 769.85,419.855 772.201,321.728 774.551,613.13 776.902,237.352 779.252,519.774 781.603,369.941 783.953,446.337 786.304,364.245 788.654,593.109 791.005,439.261 793.355,417.851 795.706,387.306 798.056,444.542 800.407,449.172 802.757,306.416 805.108,498.808 807.458,525.556 809.809,379.188 812.159,689.154 814.509,326.629 816.86,320.043 819.21,363.824 821.561,412.878 823.911,230.778 826.262,470.73 828.612,463.987 830.963,304.185 833.313,551.468 835.664,309.037 838.014,459.524 840.365,261.61 842.715,471.917 845.066,639.459 847.416,233.529 849.767,317.359 852.117,582.927 854.467,258.521 856.818,519.215 859.168,523.208 861.519,496.016 863.869,266.341 866.22,371.013 868.57,353.085 870.921,386.053 873.271,483.411 875.622,552.488 877.972,445.263 880.323,537.15 882.673,266.986 885.024,432.529 887.374,346.763 889.725,296.919 892.075,635.989 894.426,387.903 896.776,627.562 899.126,515.828 901.477,368.362 903.827,371.93 906.178,408.136 908.528,233.431 910.879,385.353 913.229,525.418 915.58,374.691 917.93,283.015 920.281,431.827 922.631,453.962 924.982,298.51 927.332,275.461 929.683,477.528 932.033,476.888 934.384,464.467 936.734,426.007 939.084,372.42 941.435,303.488 943.785,404.869 946.136,271.571 948.486,417.625 950.837,254.892 953.187,382.231 955.538,408.841 957.888,413.481 960.239,519.546 962.589,266.616 964.94,412.511 967.29,462.573 969.641,546.69 971.991,686.908 974.342,385.811 976.692,371.797 979.043,270.627 981.393,462.737 983.743,605.117 986.094,404.558 988.444,322.581 990.795,573.673 993.145,405.977 995.496,424.187 997.846,534.14 1000.2,554.745 1002.55,601.072 1004.9,495.568 1007.25,338.612 1009.6,448.057 1011.95,417.928 1014.3,204.384 1016.65,502.029 1019,502.692 1021.35,398.264 1023.7,347.014 1026.05,569.933 1028.4,292.092 1030.75,308.453 1033.1,318.562 1035.45,539.292 1037.8,278.411 1040.15,315.818 1042.51,585.943 1044.86,493.549 1047.21,604.51 1049.56,267.255 1051.91,573.74 1054.26,312.831 1056.61,359.157 1058.96,349.755 1061.31,442.531 1063.66,517.695 1066.01,348.437 1068.36,353.67 1070.71,343.663 1073.06,364.899 1075.41,258.482 1077.76,409.29 1080.11,386.998 1082.46,247.475 1084.81,391.011 1087.16,279.554 1089.51,482.818 1091.87,439.111 1094.22,295.11 1096.57,408.282 1098.92,439.888 1101.27,553.218 1103.62,432.534 1105.97,416.902 1108.32,439.878 1110.67,497.117 1113.02,467.475 1115.37,404.932 1117.72,192.083 1120.07,268.807 1122.42,383.657 1124.77,333.603 1127.12,546.554 1129.47,456.66 1131.82,473.16 1134.17,414.32 1136.52,484.737 1138.87,423.001 1141.23,351.636 1143.58,278.714 1145.93,494.028 1148.28,496.357 1150.63,386.377 1152.98,488.615 1155.33,499.081 1157.68,470.307 1160.03,407.66 1162.38,457.624 1164.73,470.269 1167.08,241.171 1169.43,444.528 1171.78,344.99 1174.13,235.421 1176.48,419.148 1178.83,434.683 1181.18,547.515 1183.53,441.945 1185.88,478.113 1188.23,254.591 1190.59,280.954 1192.94,420.78 1195.29,392.166 1197.64,375.204 1199.99,306.035 1202.34,453.668 1204.69,384.827 1207.04,604.38 1209.39,391.069 1211.74,508.341 1214.09,258.592 1216.44,511.999 1218.79,444.743 1221.14,441.163 1223.49,501.454 1225.84,362.23 1228.19,474.725 1230.54,550.83 1232.89,342.495 1235.24,591.467 1237.59,643.967 1239.94,274.195 1242.3,398.409 1244.65,352.832 1247,620.345 1249.35,367.996 1251.7,350.625 1254.05,336.716 1256.4,281.632 1258.75,504.659 1261.1,287.57 1263.45,574.472 1265.8,608.161 1268.15,319.435 1270.5,433.504 1272.85,383.355 1275.2,316.665 1277.55,513.168 1279.9,332.548 1282.25,430.589 1284.6,320.127 1286.95,480.966 1289.3,310.642 1291.66,508.588 1294.01,323.939 1296.36,408.127 1298.71,492.167 1301.06,258.555 1303.41,486.684 1305.76,406.115 1308.11,438.09 1310.46,608.743 1312.81,368.163 1315.16,307.767 1317.51,393.855 1319.86,477.451 1322.21,575.858 1324.56,414.937 1326.91,403.682 1329.26,256.065 1331.61,430.562 1333.96,314.692 1336.31,370.05 1338.66,404.297 1341.02,387.461 1343.37,371.529 1345.72,491.729 1348.07,543.744 1350.42,468.378 1352.77,364.52 1355.12,429.845 1357.47,471.188 1359.82,299.059 1362.17,339.76 1364.52,337.429 1366.87,271.73 1369.22,425.074 1371.57,512.934 1373.92,261.907 1376.27,280.885 1378.62,425.424 1380.97,531.191 1383.32,447.002 1385.67,487.787 1388.02,421.307 1390.38,288.497 1392.73,424.857 1395.08,577.787 1397.43,413.379 1399.78,404.222 1402.13,516.911 1404.48,512.325 1406.83,377.244 1409.18,319.652 1411.53,378.268 1413.88,573.195 1416.23,230.61 1418.58,352.141 1420.93,260.243 1423.28,375.993 1425.63,451.614 1427.98,411.198 1430.33,201.666 1432.68,389.399 1435.03,439.309 1437.38,477.532 1439.74,335.263 1442.09,626.195 1444.44,369.119 1446.79,398.579 1449.14,470.072 1451.49,332.214 1453.84,571.484 1456.19,513.439 1458.54,329.063 1460.89,337.885 1463.24,476.495 1465.59,393.47 1467.94,510.085 1470.29,387.646 1472.64,475.147 1474.99,259.711 1477.34,228.486 1479.69,404.537 1482.04,573.807 1484.39,380.611 1486.74,416.587 1489.1,417.274 1491.45,404.622 1493.8,427.422 1496.15,325.378 1498.5,602.325 1500.85,281.477 1503.2,534.292 1505.55,406.957 1507.9,584.483 1510.25,354.624 1512.6,277.635 1514.95,434.519 1517.3,454.68 1519.65,342.087 1522,410.57 1524.35,185.085 1526.7,433.851 1529.05,412.125 1531.4,367.716 1533.75,516.948 1536.1,520.546 1538.45,341.548 1540.81,434.611 1543.16,400.178 1545.51,400.521 1547.86,499.028 1550.21,465.354 1552.56,343.333 1554.91,332.172 1557.26,349.649 1559.61,226.992 1561.96,401.28 1564.31,467.225 1566.66,392.762 1569.01,395.172 1571.36,373.008 1573.71,395.477 1576.06,349.802 1578.41,550.931 1580.76,568.782 1583.11,550.943 1585.46,207.98 1587.81,351.651 1590.17,419.891 1592.52,404.373 1594.87,432.837 1597.22,392.305 1599.57,405.549 1601.92,357.824 1604.27,344.396 1606.62,374.554 1608.97,517.137 1611.32,585.26 1613.67,419.366 1616.02,270.748 1618.37,495.889 1620.72,487.081 1623.07,510.596 1625.42,493.276 1627.77,455.553 1630.12,339.825 1632.47,469.869 1634.82,422.95 1637.17,494.015 1639.53,288.714 1641.88,258.974 1644.23,438.83 1646.58,347.459 1648.93,486.854 1651.28,611.601 1653.63,464.171 1655.98,609.029 1658.33,430.78 1660.68,371.52 1663.03,391.283 1665.38,391.938 1667.73,555.949 1670.08,391.156 1672.43,390.467 1674.78,286.245 1677.13,452.42 1679.48,415.757 1681.83,252.212 1684.18,413.659 1686.53,514.002 1688.89,485.342 1691.24,349.244 1693.59,299.725 1695.94,414.573 1698.29,310.043 1700.64,469.246 1702.99,474.446 1705.34,384.302 1707.69,661.249 1710.04,413.945 1712.39,499.332 1714.74,378.942 1717.09,500.226 1719.44,375.038 1721.79,385.958 1724.14,496.679 1726.49,464.489 1728.84,310.05 1731.19,533.991 1733.54,475.846 1735.89,518.063 1738.25,415.518 1740.6,494.796 1742.95,406.597 1745.3,411.95 1747.65,401.964 1750,321.317 1752.35,441.613 1754.7,415.297 1757.05,411.389 1759.4,492.855 1761.75,523.021 1764.1,574.194 1766.45,525.629 1768.8,519.834 1771.15,503.852 1773.5,449.36 1775.85,398.168 1778.2,395.298 1780.55,240.519 1782.9,401.381 1785.25,478.834 1787.6,485.392 1789.96,466.927 1792.31,468.811 1794.66,446.474 1797.01,426.631 1799.36,363.831 1801.71,336.462 1804.06,538.118 1806.41,399.557 1808.76,406.643 1811.11,437.971 1813.46,138.749 1815.81,309.235 1818.16,516.303 1820.51,276.618 1822.86,309.866 1825.21,437.267 1827.56,439.899 1829.91,410.524 1832.26,418.394 1834.61,403.471 1836.96,325.643 1839.32,417.736 1841.67,322.187 1844.02,389.41 1846.37,569.332 1848.72,501.287 1851.07,366.837 1853.42,348.168 1855.77,448.566 1858.12,458.816 1860.47,436.985 1862.82,511.325 1865.17,333.189 1867.52,443.287 1869.87,380.541 1872.22,340.47 1874.57,303.064 1876.92,517.298 1879.27,516.848 1881.62,376.383 1883.97,437.832 1886.32,347.481 1888.68,531.447 1891.03,448.987 1893.38,250.718 1895.73,410.249 1898.08,171.43 1900.43,223.589 1902.78,415.257 1905.13,407.779 1907.48,253.041 1909.83,322.073 1912.18,461.361 1914.53,263.474 1916.88,495.125 1919.23,550.77 1921.58,413.358 1923.93,434.442 1926.28,399.608 1928.63,517.863 1930.98,309.525 1933.33,444.771 1935.68,414.313 1938.04,280.431 1940.39,349.257 1942.74,338.833 1945.09,541.966 1947.44,376.318 1949.79,465.116 1952.14,315.316 1954.49,449.477 1956.84,186.964 1959.19,389.586 1961.54,400.472 1963.89,420.08 1966.24,374.504 1968.59,241.615 1970.94,554.263 1973.29,391.765 1975.64,417.03 1977.99,635.221 1980.34,543.027 1982.69,553.939 1985.04,335.2 1987.4,381.399 1989.75,350.025 1992.1,449.628 1994.45,636.016 1996.8,309.544 1999.15,486.569 2001.5,417.462 2003.85,555.945 2006.2,408.158 2008.55,107.702 2010.9,359.295 2013.25,347.347 2015.6,380.478 2017.95,442.208 2020.3,526.316 2022.65,423.274 2025,363.54 2027.35,453.643 2029.7,607.599 2032.05,615.555 2034.4,270.169 2036.76,450.25 2039.11,463.041 2041.46,389.386 2043.81,402.044 2046.16,287.893 2048.51,313.718 2050.86,224.536 2053.21,291.11 2055.56,452.649 2057.91,620.914 2060.26,406.063 2062.61,506.369 2064.96,323.291 2067.31,528.702 2069.66,459.553 2072.01,343.71 2074.36,345.303 2076.71,391.283 2079.06,504.604 2081.41,310.606 2083.76,542.617 2086.11,400.777 2088.47,280.672 2090.82,317.206 2093.17,491.274 2095.52,487.311 2097.87,535.286 2100.22,329.136 2102.57,252.974 2104.92,509.67 2107.27,291.882 2109.62,333.62 2111.97,273.923 2114.32,434.027 2116.67,413.14 2119.02,489.724 2121.37,272.28 2123.72,241.996 2126.07,383.338 2128.42,427.841 2130.77,373.318 2133.12,433.691 2135.47,382.952 2137.83,560.72 2140.18,96.8724 2142.53,364.512 2144.88,332.551 2147.23,685.787 2149.58,331.746 2151.93,517.667 2154.28,352.833 2156.63,200.287 2158.98,426.841 2161.33,160.365 2163.68,292.678 2166.03,412.987 2168.38,473.951 2170.73,511.914 2173.08,317.209 2175.43,493.798 2177.78,331.512 2180.13,440.646 2182.48,507.262 2184.83,436.395 2187.19,367.196 2189.54,641.096 2191.89,319.97 2194.24,683.63 2196.59,605.25 2198.94,465.155 2201.29,465.028 2203.64,232.246 2205.99,459.158 2208.34,451.914 2210.69,310.293 2213.04,443.405 2215.39,341.056 2217.74,423.043 2220.09,310.99 2222.44,269.979 2224.79,345.962 2227.14,430.338 2229.49,407.6 2231.84,398.447 2234.19,360.865 2236.55,409.641 2238.9,449.78 2241.25,513.379 2243.6,381.91 2245.95,396.247 2248.3,310.085 2250.65,275.445 2253,267.959 2255.35,382.781 2257.7,311.616 2260.05,489.146 2262.4,417.747 2264.75,250.526 2267.1,347.088 2269.45,304.257 2271.8,348.05 2274.15,246.228 2276.5,434.457 2278.85,589.898 2281.2,511.775 2283.55,409.84 2285.91,504.108 2288.26,306.41 2290.61,553.259 2292.96,352.468 2295.31,318.36 2297.66,527.469 2300.01,367.167 2302.36,536.895 2304.71,382.518 2307.06,487.659 2309.41,375.619 2311.76,492.094 2314.11,456.555 2316.46,323.725 2318.81,348.724 2321.16,422.879 2323.51,445.771 2325.86,331.475 2328.21,340.598 2330.56,469.894 2332.91,432.934 2335.27,394.029 2337.62,314.763 2339.97,487.207 2342.32,540.881 2344.67,388.027 2347.02,417.038 2349.37,387.985 2351.72,561.507 2354.07,323.307 2356.42,461.687 2358.77,304.893 2361.12,361.563 2363.47,414.737 2365.82,252.551 2368.17,363.63 2370.52,477.53 2372.87,378.795 2375.22,456.609 2377.57,414.059 2379.92,291.132 2382.27,501.484 2384.62,335.637 2386.98,516.849 2389.33,471.596 2391.68,514.859 2394.03,498.883 2396.38,354.153 2398.73,498.563 2401.08,373.402 2403.43,322.762 2405.78,433.787 2408.13,518.156 2410.48,433.918 2412.83,426.332 2415.18,448.858 2417.53,386.291 2419.88,372.731 2422.23,416.009 2424.58,511.178 2426.93,237.022 2429.28,530.339 2431.63,395.12 2433.98,479.478 2436.34,497.403 2438.69,505.223 2441.04,468.979 2443.39,317.765 2445.74,468.514 2448.09,167.425 2450.44,511.7 2452.79,304.797 2455.14,363.142 2457.49,563.855 2459.84,427.562 2462.19,389.056 2464.54,235.625 2466.89,388.07 2469.24,337.328 2471.59,364.719 2473.94,609.595 2476.29,336.734 2478.64,151.63 2480.99,346.414 2483.34,501.959 2485.7,331.565 2488.05,398.284 2490.4,380.218 2492.75,287.399 2495.1,428.597 2497.45,636.084 2499.8,669.3 2502.15,447.959 2504.5,517.289 2506.85,368.311 2509.2,526.922 2511.55,558.559 2513.9,299.954 2516.25,296.595 2518.6,403.286 2520.95,364.93 2523.3,487.892 2525.65,337.169 2528,520.68 2530.35,515.417 2532.7,414.035 2535.06,355.823 2537.41,366.826 2539.76,409.911 2542.11,369.39 2544.46,445.369 2546.81,350.794 2549.16,578.599 2551.51,338.851 2553.86,423.993 2556.21,367.152 2558.56,247.954 2560.91,412.981 2563.26,156.532 2565.61,207.504 2567.96,366.063 2570.31,516.652 "></polyline>
</svg>
</div>
</div>
<p>Look at that! Things are working; amazin’.</p>
<p>We can also exploit <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>’s parallel sampling capabilities:</p>
<div id="34" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run separate 4 chains for 10 000 iterations using threads to parallelize.</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>num_chains <span class="op">=</span> <span class="fl">4</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    model_with_grad,</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">MCMCThreads</span>(),</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>,</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    num_chains;</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Note we need to provide an initial state for every chain.</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>    initial_state<span class="op">=</span><span class="fu">fill</span>(state, num_chains),</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>samples_array <span class="op">=</span> <span class="fu">stack</span>(<span class="fu">map</span>(<span class="bu">Base</span>.<span class="fu">Fix1</span>(stack, sample <span class="op">-&gt;</span> sample.x), samples))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000×4 Array{Float64, 3}:
[:, :, 1] =
 -2.60401  -3.0086   -4.73788    …  -5.09279    -5.32775  -5.11799
  1.22394   2.04863   0.0579104     -0.0180294  -0.54912  -1.27683
  1.36997   1.94085   3.58902        6.66537     7.03853   6.23308

[:, :, 2] =
 -2.29259  -3.52025   -4.46191   -4.46191   …  -5.44455   -4.25774  -4.54501
  0.49461  -0.692124  -0.125477  -0.125477      0.958689   1.10967   0.143145
  2.86265   4.95616    5.05913    5.05913       5.09634    3.72713   3.12823

[:, :, 3] =
 -2.17713  -2.85706   -3.33623   …  -6.45869   -3.874     -4.96561
  1.37369   0.438894   0.272636      0.677495  -0.475974  -0.844511
  2.00307   3.17085    2.58503       4.8122     5.01984    5.15444

[:, :, 4] =
 -2.81231  -2.93521  -4.36791  -4.53402   …  -5.89793  -4.59974  -5.66344
  0.6562   -1.20902  -1.44216  -0.882195      1.1788    2.24642   0.918479
  3.24501   4.57483   5.78807   5.32971       4.63135   4.54913   5.96632</code></pre>
</div>
</div>
<p>But the fact that we have to provide the <code>AbstractMCMC.sample</code> call, etc. with an <code>initial_state</code> to get started is a bit annoying. We can avoid this by also defining a <code>AbstractMCMC.step</code> <em>without</em> the <code>state</code> argument:</p>
<div id="36" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">::</span><span class="dt">MALA</span>;</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># </span><span class="al">NOTE</span><span class="co">: No state provided!</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just create the initial state by sampling using  a Gaussian.</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="fu">randn</span>(rng, LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(x), <span class="fu">MALAState</span>(x)</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Equipped with this, we no longer need to provide the <code>initial_state</code> everywhere:</p>
<div id="38" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -5.00568     1.01982
 -0.00230179  1.01077
  4.98551     0.992834</code></pre>
</div>
</div>
</section>
<section id="using-our-sampler-with-turing.jl" class="level2">
<h2 class="anchored" data-anchor-id="using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</h2>
<p>As we promised, all of this hassle of implementing our <code>MALA</code> sampler in a way that uses <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> and <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> gets us something more than <em>just</em> an “automatic” implementation of <code>AbstractMCMC.sample</code>.</p>
<p>It also enables use with Turing.jl through the <code>externalsampler</code>, but we need to do one final thing first: we need to tell Turing.jl how to extract a vector of parameters from the “sample” returned in our implementation of <code>AbstractMCMC.step</code>. In our case, the “sample” is a <code>MALASample</code>, so we just need the following line:</p>
<div id="40" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load Turing.jl.</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Turing</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Overload the `getparams` method for our "sample" type, which is just a vector.</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>Turing.Inference.<span class="fu">getparams</span>(<span class="op">::</span><span class="dt">Turing.Model</span>, sample<span class="op">::</span><span class="dt">MALASample</span>) <span class="op">=</span> sample.x</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And with that, we’re good to go!</p>
<div id="42" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Our previous model defined as a Turing.jl model.</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">mvnormal_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">MvNormal</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.], I)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate our model.</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">mvnormal_model</span>()</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Call `sample` but now we're passing in a Turing.jl `model` and wrapping</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co"># our `MALA` sampler in the `externalsampler` to tell Turing.jl that the sampler</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co"># expects something that implements LogDensityProblems.jl.</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×4×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 2.79 seconds
Compute duration  = 2.79 seconds
parameters        = x[1], x[2], x[3]
internals         = lp

Summary Statistics
  parameters      mean       std      mcse    ess_bulk    ess_tail      rhat   ⋯
      Symbol   Float64   Float64   Float64     Float64     Float64   Float64   ⋯

        x[1]   -5.0143    0.9910    0.0175   3198.6789   5141.5218    1.0003   ⋯
        x[2]    0.0019    0.9981    0.0174   3283.0602   5718.7280    1.0002   ⋯
        x[3]    4.9849    0.9806    0.0172   3242.9770   4768.9616    0.9999   ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

        x[1]   -6.9514   -5.6936   -5.0202   -4.3312   -3.0967
        x[2]   -1.9592   -0.6797   -0.0011    0.6785    1.9677
        x[3]    3.0698    4.3187    5.0037    5.6339    6.9031</code></pre>
</div>
</div>
<p>Pretty neat, eh?</p>
<section id="models-with-constrained-parameters" class="level3">
<h3 class="anchored" data-anchor-id="models-with-constrained-parameters">Models with constrained parameters</h3>
<p>One thing we’ve sort of glossed over in all of the above is that MALA, at least how we’ve implemented it, requires <span class="math inline">\(x\)</span> to live in <span class="math inline">\(\mathbb{R}^d\)</span> for some <span class="math inline">\(d &gt; 0\)</span>. If some of the parameters were in fact constrained, e.g.&nbsp;we were working with a <code>Beta</code> distribution which has support on the interval <span class="math inline">\((0, 1)\)</span>, <em>not</em> on <span class="math inline">\(\mathbb{R}^d\)</span>, we could easily end up outside of the valid range <span class="math inline">\((0, 1)\)</span>.</p>
<div id="44" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">beta_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">beta_model</span>()</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 1.96 seconds
Compute duration  = 1.96 seconds
parameters        = x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse    ess_bulk    ess_tail      rhat   ⋯
      Symbol   Float64   Float64   Float64     Float64     Float64   Float64   ⋯

           x    0.5025    0.1866    0.0027   4651.8648   5931.1249    1.0001   ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

           x    0.1464    0.3640    0.5033    0.6389    0.8521</code></pre>
</div>
</div>
<p>Yep, that still works, but only because Turing.jl actually <em>transforms</em> the <code>turing_model</code> from constrained to unconstrained, so that the <code>sampler</code> provided to <code>externalsampler</code> is actually always working in unconstrained space! This is not always desirable, so we can turn this off:</p>
<div id="46" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 0.15 seconds
Compute duration  = 0.15 seconds
parameters        = x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse   ess_bulk   ess_tail      rhat   e ⋯
      Symbol   Float64   Float64   Float64    Float64    Float64   Float64     ⋯

           x    0.5017    0.1596    0.0156    94.5827    82.7668    1.0300     ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

           x    0.2410    0.3535    0.5006    0.6279    0.7730</code></pre>
</div>
</div>
<p>The fun thing is that this still sort of works because</p>
<div id="48" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">logpdf</span>(<span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>), <span class="fl">10.0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-Inf</code></pre>
</div>
</div>
<p>and so the samples that fall outside of the range are always rejected. But do notice how much worse all the diagnostics are, e.g.&nbsp;<code>ess_tail</code> is very poor compared to when we use <code>unconstrained=true</code>. Moreover, in more complex cases this won’t just result in a “nice” <code>-Inf</code> log-density value, but instead will error:</p>
<div id="50" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="kw">function</span> <span class="fu">demo</span>()</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>    σ² <span class="op">~</span> <span class="fu">truncated</span>(<span class="fu">Normal</span>(), lower<span class="op">=</span><span class="fl">0</span>)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If we end up with negative values for `σ²`, the `Normal` will error.</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>    x <span class="op">~</span> <span class="fu">Normal</span>(<span class="fl">0</span>, σ²)</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>DomainError: DomainError(-2.16333509763754, "Normal: the condition σ &gt;= zero(σ) is not satisfied.")
DomainError with -2.16333509763754:
Normal: the condition σ &gt;= zero(σ) is not satisfied.
Stacktrace:
  [1] #371
    @ ~/.julia/packages/Distributions/tQhJE/src/univariate/continuous/normal.jl:37 [inlined]
  [2] check_args
    @ ~/.julia/packages/Distributions/tQhJE/src/utils.jl:89 [inlined]
  [3] #Normal#370
    @ ~/.julia/packages/Distributions/tQhJE/src/univariate/continuous/normal.jl:37 [inlined]
  [4] Normal
    @ ~/.julia/packages/Distributions/tQhJE/src/univariate/continuous/normal.jl:36 [inlined]
  [5] Normal
    @ ~/.julia/packages/Distributions/tQhJE/src/univariate/continuous/normal.jl:42 [inlined]
  [6] macro expansion
    @ ~/.julia/packages/DynamicPPL/senfM/src/compiler.jl:584 [inlined]
  [7] demo(__model__::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, __varinfo__::DynamicPPL.ThreadSafeVarInfo{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, Vector{Base.RefValue{Float64}}}, __context__::DynamicPPL.ValuesAsInModelContext{DynamicPPL.DefaultContext})
    @ Main.Notebook ~/work/docs/docs/developers/inference/implementing-samplers/index.qmd:595
  [8] _evaluate!!
    @ ~/.julia/packages/DynamicPPL/senfM/src/model.jl:936 [inlined]
  [9] evaluate_threadsafe!!(model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, varinfo::DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, context::DynamicPPL.ValuesAsInModelContext{DynamicPPL.DefaultContext})
    @ DynamicPPL ~/.julia/packages/DynamicPPL/senfM/src/model.jl:925
 [10] evaluate!!
    @ ~/.julia/packages/DynamicPPL/senfM/src/model.jl:855 [inlined]
 [11] values_as_in_model
    @ ~/.julia/packages/DynamicPPL/senfM/src/values_as_in_model.jl:196 [inlined]
 [12] values_as_in_model
    @ ~/.julia/packages/DynamicPPL/senfM/src/values_as_in_model.jl:195 [inlined]
 [13] getparams(model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, vi::DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64})
    @ Turing.Inference ~/.julia/packages/Turing/oFGEb/src/mcmc/Inference.jl:399
 [14] Turing.Inference.Transition(model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, vi::DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, t::MALASample{Vector{Float64}})
    @ Turing.Inference ~/.julia/packages/Turing/oFGEb/src/mcmc/Inference.jl:274
 [15] transition_to_turing
    @ ~/.julia/packages/Turing/oFGEb/src/mcmc/abstractmcmc.jl:12 [inlined]
 [16] transition_to_turing(f::LogDensityProblemsADForwardDiffExt.ForwardDiffLogDensity{LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, Nothing}, ForwardDiff.Chunk{2}, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}, transition::MALASample{Vector{Float64}})
    @ Turing.Inference ~/.julia/packages/Turing/oFGEb/src/mcmc/abstractmcmc.jl:17
 [17] step(rng::TaskLocalRNG, model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, sampler_wrapper::DynamicPPL.Sampler{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}; initial_state::Nothing, initial_params::Nothing, kwargs::@Kwargs{})
    @ Turing.Inference ~/.julia/packages/Turing/oFGEb/src/mcmc/abstractmcmc.jl:103
 [18] macro expansion
    @ ~/.julia/packages/AbstractMCMC/FSyVk/src/sample.jl:0 [inlined]
 [19] macro expansion
    @ ~/.julia/packages/AbstractMCMC/FSyVk/src/logging.jl:16 [inlined]
 [20] mcmcsample(rng::TaskLocalRNG, model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, sampler::DynamicPPL.Sampler{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}, N::Int64; progress::Bool, progressname::String, callback::Nothing, num_warmup::Int64, discard_initial::Int64, thinning::Int64, chain_type::Type, initial_state::Nothing, kwargs::@Kwargs{})
    @ AbstractMCMC ~/.julia/packages/AbstractMCMC/FSyVk/src/sample.jl:142
 [21] sample(rng::TaskLocalRNG, model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, sampler::DynamicPPL.Sampler{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}, N::Int64; chain_type::Type, resume_from::Nothing, initial_state::Nothing, kwargs::@Kwargs{progress::Bool})
    @ DynamicPPL ~/.julia/packages/DynamicPPL/senfM/src/sampler.jl:107
 [22] sample
    @ ~/.julia/packages/DynamicPPL/senfM/src/sampler.jl:97 [inlined]
 [23] #sample#6
    @ ~/.julia/packages/Turing/oFGEb/src/mcmc/Inference.jl:321 [inlined]
 [24] sample
    @ ~/.julia/packages/Turing/oFGEb/src/mcmc/Inference.jl:312 [inlined]
 [25] #sample#5
    @ ~/.julia/packages/Turing/oFGEb/src/mcmc/Inference.jl:309 [inlined]
 [26] top-level scope
    @ ~/work/docs/docs/developers/inference/implementing-samplers/index.qmd:597</code></pre>
</div>
</div>
<p>As expected, we run into a <code>DomainError</code> at some point, while if we set <code>unconstrained=true</code>, letting Turing.jl transform the model to a unconstrained form behind the scenes, everything works as expected:</p>
<div id="52" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 1.95 seconds
Compute duration  = 1.95 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse   ess_bulk   ess_tail      rhat   e ⋯
      Symbol   Float64   Float64   Float64    Float64    Float64   Float64     ⋯

          σ²    0.9100    0.6378    0.0558   173.8940    75.4484    1.0099     ⋯
           x   -0.0258    0.9808    0.0631   340.6913    82.6016    1.0027     ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

          σ²    0.1537    0.4161    0.7550    1.2360    2.8261
           x   -2.3732   -0.4574   -0.0241    0.4181    2.1546</code></pre>
</div>
</div>
<p>Neat!</p>
<p>Similarly, which automatic differentiation backend one should use can be specified through the <code>adtype</code> keyword argument too. For example, if we want to use <a href="https://github.com/JuliaDiff/ReverseDiff.jl">ReverseDiff.jl</a> instead of the default <a href="https://github.com/JuliaDiff/ForwardDiff.jl">ForwardDiff.jl</a>:</p>
<div id="54" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">ReverseDiff</span>: ReverseDiff</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify that we want to use `AutoReverseDiff`.</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">demo</span>(),</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>, adtype<span class="op">=</span><span class="fu">AutoReverseDiff</span>()),</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>;</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 3.71 seconds
Compute duration  = 3.71 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse   ess_bulk   ess_tail      rhat   e ⋯
      Symbol   Float64   Float64   Float64    Float64    Float64   Float64     ⋯

          σ²    0.3629    0.0000    0.0000        NaN        NaN       NaN     ⋯
           x   -1.8440    0.0000    0.0000        NaN        NaN       NaN     ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

          σ²    0.3629    0.3629    0.3629    0.3629    0.3629
           x   -1.8440   -1.8440   -1.8440   -1.8440   -1.8440</code></pre>
</div>
</div>
<p>Double-neat.</p>
</section>
</section>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<p>At this point it’s worth maybe reminding ourselves what we did and also <em>why</em> we did it:</p>
<ol type="1">
<li>We define our models in the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface because it makes the sampler agnostic to how the underlying model is implemented.</li>
<li>We implement our sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> interface, which just means that our sampler is a subtype of <code>AbstractMCMC.AbstractSampler</code> and we implement the MCMC transition in <code>AbstractMCMC.step</code>.</li>
<li>Points 1 and 2 makes it so our sampler can be used with a wide range of model implementations, amongst them being models implemented in both Turing.jl and Stan. This gives you, the inference implementer, a large collection of models to test your inference method on, in addition to allowing users of Turing.jl and Stan to try out your inference method with minimal effort.</li>
</ol>


</section>


<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a><div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>We’re going with the leapfrog formulation because in a future version of this tutorial we’ll add a section extending this simple “baseline” MALA sampler to more complex versions. See <a href="https://github.com/TuringLang/docs/issues/479">issue #479</a> for progress on this.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>There is no such thing as a proper interface in Julia (at least not officially), and so we use the word “interface” here to mean a few minimal methods that needs to be implemented by any type that we treat as a target model.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/turinglang\.org\/docs\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../../developers/inference/variational-inference/index.html" class="pagination-link" aria-label="Variational Inference">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Variational Inference</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Turing is created by <a href="http://mlg.eng.cam.ac.uk/hong/" target="_blank">Hong Ge</a>, and lovingly maintained by the <a href="https://github.com/TuringLang/Turing.jl/graphs/contributors" target="_blank">core team</a> of volunteers. <br> The contents of this website are © 2024 under the terms of the <a href="https://github.com/TuringLang/Turing.jl/blob/main/LICENCE" target="_blank">MIT License</a>.</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/TuringLang/docs/edit/main/developers/inference/implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/docs/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://x.com/TuringLang">
      <i class="bi bi-twitter" role="img" aria-label="Turing Twitter">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/TuringLang/Turing.jl">
      <i class="bi bi-github" role="img" aria-label="Turing GitHub">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




<script src="../../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>