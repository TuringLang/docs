<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.31">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Implementing Samplers – Turing.jl</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<link href="../../../developers/inference/variational-inference/index.html" rel="prev">
<link href="../../../assets/favicon.ico" rel="icon">
<script src="../../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-e1a5c8363afafaef2c763b6775fbf3ca.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-dark-8ef56b68f8fa1e9d2ba328e99e439f80.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-e1a5c8363afafaef2c763b6775fbf3ca.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap-45df24dc1485a233dc76492db592b344.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../../site_libs/bootstrap/bootstrap-dark-3d2c2b059e745154d0d7919feeea7e11.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="../../../site_libs/bootstrap/bootstrap-45df24dc1485a233dc76492db592b344.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<style>
  a {
    text-decoration: none;
  }
  a:hover {
    text-decoration: underline;
  }
</style>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../../theming/styles.css">
</head>

<body class="nav-sidebar floating nav-fixed quarto-light"><script id="quarto-html-before-body" type="application/javascript">
    const toggleBodyColorMode = (bsSheetEl) => {
      const mode = bsSheetEl.getAttribute("data-mode");
      const bodyEl = window.document.querySelector("body");
      if (mode === "dark") {
        bodyEl.classList.add("quarto-dark");
        bodyEl.classList.remove("quarto-light");
      } else {
        bodyEl.classList.add("quarto-light");
        bodyEl.classList.remove("quarto-dark");
      }
    }
    const toggleBodyColorPrimary = () => {
      const bsSheetEl = window.document.querySelector("link#quarto-bootstrap:not([rel=disabled-stylesheet])");
      if (bsSheetEl) {
        toggleBodyColorMode(bsSheetEl);
      }
    }
    const setColorSchemeToggle = (alternate) => {
      const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
      for (let i=0; i < toggles.length; i++) {
        const toggle = toggles[i];
        if (toggle) {
          if (alternate) {
            toggle.classList.add("alternate");
          } else {
            toggle.classList.remove("alternate");
          }
        }
      }
    };
    const toggleColorMode = (alternate) => {
      // Switch the stylesheets
      const primaryStylesheets = window.document.querySelectorAll('link.quarto-color-scheme:not(.quarto-color-alternate)');
      const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
      manageTransitions('#quarto-margin-sidebar .nav-link', false);
      if (alternate) {
        // note: dark is layered on light, we don't disable primary!
        enableStylesheet(alternateStylesheets);
        for (const sheetNode of alternateStylesheets) {
          if (sheetNode.id === "quarto-bootstrap") {
            toggleBodyColorMode(sheetNode);
          }
        }
      } else {
        disableStylesheet(alternateStylesheets);
        enableStylesheet(primaryStylesheets)
        toggleBodyColorPrimary();
      }
      manageTransitions('#quarto-margin-sidebar .nav-link', true);
      // Switch the toggles
      setColorSchemeToggle(alternate)
      // Hack to workaround the fact that safari doesn't
      // properly recolor the scrollbar when toggling (#1455)
      if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
        manageTransitions("body", false);
        window.scrollTo(0, 1);
        setTimeout(() => {
          window.scrollTo(0, 0);
          manageTransitions("body", true);
        }, 40);
      }
    }
    const disableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        stylesheet.rel = 'disabled-stylesheet';
      }
    }
    const enableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        if(stylesheet.rel !== 'stylesheet') { // for Chrome, which will still FOUC without this check
          stylesheet.rel = 'stylesheet';
        }
      }
    }
    const manageTransitions = (selector, allowTransitions) => {
      const els = window.document.querySelectorAll(selector);
      for (let i=0; i < els.length; i++) {
        const el = els[i];
        if (allowTransitions) {
          el.classList.remove('notransition');
        } else {
          el.classList.add('notransition');
        }
      }
    }
    const isFileUrl = () => {
      return window.location.protocol === 'file:';
    }
    const hasAlternateSentinel = () => {
      let styleSentinel = getColorSchemeSentinel();
      if (styleSentinel !== null) {
        return styleSentinel === "alternate";
      } else {
        return false;
      }
    }
    const setStyleSentinel = (alternate) => {
      const value = alternate ? "alternate" : "default";
      if (!isFileUrl()) {
        window.localStorage.setItem("quarto-color-scheme", value);
      } else {
        localAlternateSentinel = value;
      }
    }
    const getColorSchemeSentinel = () => {
      if (!isFileUrl()) {
        const storageValue = window.localStorage.getItem("quarto-color-scheme");
        return storageValue != null ? storageValue : localAlternateSentinel;
      } else {
        return localAlternateSentinel;
      }
    }
    const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
      const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
      const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
      let newTheme = '';
      if(authorPrefersDark) {
        newTheme = isAlternate ? baseTheme : alternateTheme;
      } else {
        newTheme = isAlternate ? alternateTheme : baseTheme;
      }
      const changeGiscusTheme = () => {
        // From: https://github.com/giscus/giscus/issues/336
        const sendMessage = (message) => {
          const iframe = document.querySelector('iframe.giscus-frame');
          if (!iframe) return;
          iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
        }
        sendMessage({
          setConfig: {
            theme: newTheme
          }
        });
      }
      const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
      if (isGiscussLoaded) {
        changeGiscusTheme();
      }
    };
    const authorPrefersDark = false;
    const darkModeDefault = authorPrefersDark;
      document.querySelector('link#quarto-text-highlighting-styles.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
      document.querySelector('link#quarto-bootstrap.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
    let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
    // Dark / light mode switch
    window.quartoToggleColorScheme = () => {
      // Read the current dark / light value
      let toAlternate = !hasAlternateSentinel();
      toggleColorMode(toAlternate);
      setStyleSentinel(toAlternate);
      toggleGiscusIfUsed(toAlternate, darkModeDefault);
      window.dispatchEvent(new Event('resize'));
    };
    // Switch to dark mode if need be
    if (hasAlternateSentinel()) {
      toggleColorMode(true);
    } else {
      toggleColorMode(false);
    }
  </script>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="https://turinglang.org/" class="navbar-brand navbar-brand-logo">
    <img src="../../../assets/images/turing-logo.svg" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="https://turinglang.org/">
    <span class="navbar-title">Turing.jl</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../getting-started/"> 
<span class="menu-text">Get Started</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../tutorials/coin-flipping/"> 
<span class="menu-text">Tutorials</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/library/"> 
<span class="menu-text">Libraries</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/news/"> 
<span class="menu-text">News</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/team/"> 
<span class="menu-text">Team</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-v0.38" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">v0.38</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-v0.38">    
        <li>
    <a class="dropdown-item" href="https://turinglang.org/docs/changelog.html">
 <span class="dropdown-text">Changelog</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://turinglang.org/docs/versions.html">
 <span class="dropdown-text">All Versions</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools tools-wide">
    <a href="https://x.com/TuringLang" title="Turing Twitter" class="quarto-navigation-tool px-1" aria-label="Turing Twitter"><i class="bi bi-twitter"></i></a>
    <a href="https://github.com/TuringLang/Turing.jl" title="Turing GitHub" class="quarto-navigation-tool px-1" aria-label="Turing GitHub"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../../developers/contributing/index.html">Developers</a></li><li class="breadcrumb-item"><a href="../../../developers/inference/abstractmcmc-interface/index.html">Inference (note: outdated)</a></li><li class="breadcrumb-item"><a href="../../../developers/inference/implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../getting-started/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Getting Started</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../core-functionality/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Core Functionality</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false">
 <span class="menu-text">User Guide</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/automatic-differentiation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Automatic Differentiation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/custom-distribution/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Custom Distributions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/probability-interface/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Querying Model Probabilities</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/modifying-logprob/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Modifying the Log Probability</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/tracking-extra-quantities/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Tracking Extra Quantities</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/mode-estimation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Mode Estimation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/performance-tips/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Performance Tips</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/sampler-visualisation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Sampler Visualization</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/dynamichmc/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using DynamicHMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/external-samplers/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using External Samplers</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false">
 <span class="menu-text">Tutorials</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/coin-flipping/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction: Coin Flipping</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/gaussian-mixture-models/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Mixture Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-neural-networks/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Neural Networks</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/hidden-markov-models/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Hidden Markov Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-linear-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Linear Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/infinite-mixture-models/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Infinite Mixture Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-poisson-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Poisson Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/multinomial-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Multinomial Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-differential-equations/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Differential Equations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/probabilistic-pca/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Probabilistic PCA</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-time-series-analysis/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Time Series Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/gaussian-processes-introduction/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Processes: Introduction</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/gaussian-process-latent-variable-models/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Process Latent Variable Models</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Developers</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/contributing/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Contributing</span></a>
  </div>
</li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false">
 <span class="menu-text">DynamicPPL’s Compiler</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/compiler/model-manual/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Manually Defining a Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/compiler/minituring-compiler/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation I: Compiler</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/compiler/minituring-contexts/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation II: Contexts</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/compiler/design-overview/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Turing Compiler Design (Outdated)</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false">
 <span class="menu-text">Variable Transformations</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/transforms/distributions/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Distributions and the Jacobian</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/transforms/bijectors/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bijectors in MCMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/transforms/dynamicppl/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variable transformations in DynamicPPL</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true">
 <span class="menu-text">Inference (note: outdated)</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/inference/abstractmcmc-interface/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Interface Guide</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/inference/abstractmcmc-turing/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">How Turing Implements AbstractMCMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/inference/variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/inference/implementing-samplers/index.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Implementing Samplers</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of Contents</h2>
   
  <ul>
  <li><a href="#quick-overview-of-mala" id="toc-quick-overview-of-mala" class="nav-link active" data-scroll-target="#quick-overview-of-mala">Quick overview of MALA</a></li>
  <li><a href="#what-we-need-from-a-model-logdensityproblems.jl" id="toc-what-we-need-from-a-model-logdensityproblems.jl" class="nav-link" data-scroll-target="#what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: LogDensityProblems.jl</a></li>
  <li><a href="#implementing-mala-in-abstractmcmc.jl" id="toc-implementing-mala-in-abstractmcmc.jl" class="nav-link" data-scroll-target="#implementing-mala-in-abstractmcmc.jl">Implementing MALA in AbstractMCMC.jl</a></li>
  <li><a href="#using-our-sampler-with-turing.jl" id="toc-using-our-sampler-with-turing.jl" class="nav-link" data-scroll-target="#using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</a>
  <ul class="collapse">
  <li><a href="#models-with-constrained-parameters" id="toc-models-with-constrained-parameters" class="nav-link" data-scroll-target="#models-with-constrained-parameters">Models with constrained parameters</a></li>
  </ul></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/TuringLang/docs/edit/main/developers/inference/implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/docs/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">


<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../../developers/contributing/index.html">Developers</a></li><li class="breadcrumb-item"><a href="../../../developers/inference/abstractmcmc-interface/index.html">Inference (note: outdated)</a></li><li class="breadcrumb-item"><a href="../../../developers/inference/implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Implementing Samplers</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>In this tutorial, we’ll go through step-by-step how to implement a “simple” sampler in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> in such a way that it can be easily applied to Turing.jl models.</p>
<p>In particular, we’re going to implement a version of <strong>Metropolis-adjusted Langevin (MALA)</strong>.</p>
<p>Note that we will implement this sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> framework, completely “ignoring” Turing.jl until the very end of the tutorial, at which point we’ll use a single line of code to make the resulting sampler available to Turing.jl. This is to really drive home the point that one can implement samplers in a way that is accessible to all of Turing.jl’s users without having to use Turing.jl yourself.</p>
<section id="quick-overview-of-mala" class="level2">
<h2 class="anchored" data-anchor-id="quick-overview-of-mala">Quick overview of MALA</h2>
<p>We can view MALA as a single step of the leapfrog intergrator with resampling of momentum <span class="math inline">\(p\)</span> at every step.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> To make that statement a bit more concrete, we first define the <em>extended</em> target <span class="math inline">\(\bar{\gamma}(x, p)\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\log \bar{\gamma}(x, p) \propto \log \gamma(x) + \log \gamma_{\mathcal{N}(0, M)}(p)
\end{equation*}\]</span></p>
<p>where <span class="math inline">\(\gamma_{\mathcal{N}(0, M)}\)</span> denotes the density for a zero-centered Gaussian with covariance matrix <span class="math inline">\(M\)</span>. We then consider targeting this joint distribution over both <span class="math inline">\(x\)</span> and <span class="math inline">\(p\)</span> as follows. First we define the map</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  L_{\epsilon}: \quad &amp; \mathbb{R}^d \times \mathbb{R}^d \to \mathbb{R}^d \times \mathbb{R}^d \\
  &amp; (x, p) \mapsto (\tilde{x}, \tilde{p}) := L_{\epsilon}(x, p)
\end{split}
\end{equation*}\]</span></p>
<p>as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p_{1 / 2} &amp;:= p + \frac{\epsilon}{2} \nabla \log \gamma(x) \\
  \tilde{x} &amp;:= x + \epsilon M^{-1} p_{1 /2 } \\
  p_1 &amp;:= p_{1 / 2} + \frac{\epsilon}{2} \nabla \log \gamma(\tilde{x}) \\
  \tilde{p} &amp;:= - p_1
\end{split}
\end{equation*}\]</span></p>
<p>This might be familiar for some readers as a single step of the Leapfrog integrator. We then define the MALA kernel as follows: given the current iterate <span class="math inline">\(x_i\)</span>, we sample the next iterate <span class="math inline">\(x_{i + 1}\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p &amp;\sim \mathcal{N}(0, M) \\
  (\tilde{x}, \tilde{p}) &amp;:= L_{\epsilon}(x_i, p) \\
  \alpha &amp;:= \min \left\{ 1, \frac{\bar{\gamma}(\tilde{x}, \tilde{p})}{\bar{\gamma}(x_i, p)} \right\} \\
  x_{i + 1} &amp;:=
  \begin{cases}
    \tilde{x} \quad &amp; \text{ with prob. } \alpha \\
    x_i       \quad &amp; \text{ with prob. } 1 - \alpha
  \end{cases}
\end{split}
\end{equation*}\]</span></p>
<p>i.e.&nbsp;we accept the proposal <span class="math inline">\(\tilde{x}\)</span> with probability <span class="math inline">\(\alpha\)</span> and reject it, thus sticking with our current iterate, with probability <span class="math inline">\(1 - \alpha\)</span>.</p>
</section>
<section id="what-we-need-from-a-model-logdensityproblems.jl" class="level2">
<h2 class="anchored" data-anchor-id="what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a></h2>
<p>There are a few things we need from the “target” / “model” / density that we want to sample from:</p>
<ol type="1">
<li>We need access to log-density <em>evaluations</em> <span class="math inline">\(\log \gamma(x)\)</span> so we can compute the acceptance ratio involving <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>We need access to log-density <em>gradients</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span> so we can compute the Leapfrog steps <span class="math inline">\(L_{\epsilon}(x, p)\)</span>.</li>
<li>We also need access to the “size” of the model so we can determine the size of <span class="math inline">\(M\)</span>.</li>
</ol>
<p>Luckily for us, there is a package called <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> which provides an interface for <em>exactly</em> this!</p>
<p>To demonstrate how one can implement the “<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface”<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> we will use a simple Gaussian model as an example:</p>
<div id="4" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblems</span>: LogDensityProblems;</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's define some type that represents the model.</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> IsotropicNormalModel{M<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"mean of the isotropic Gaussian"</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    mean<span class="op">::</span><span class="dt">M</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Specifies what input length the model expects.</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">dimension</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> <span class="fu">length</span>(model.mean)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Implementation of the log-density evaluation of the model.</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x<span class="op">::</span><span class="dt">AbstractVector{&lt;:Real}</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">-</span> <span class="fu">sum</span>(abs2, x <span class="op">.-</span> model.mean) <span class="op">/</span> <span class="fl">2</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This gives us all of the properties we want for our MALA sampler with the exception of the computation of the <em>gradient</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span>. There is the method <code>LogDensityProblems.logdensity_and_gradient</code> which should return a 2-tuple where the first entry is the evaluation of the logdensity <span class="math inline">\(\log \gamma(x)\)</span> and the second entry is the gradient <span class="math inline">\(\nabla \log \gamma(x)\)</span>.</p>
<p>There are two ways to “implement” this method: 1) we implement it by hand, which is feasible in the case of our <code>IsotropicNormalModel</code>, or b) we defer the implementation of this to a automatic differentiation backend.</p>
<p>To implement it by hand we can simply do</p>
<div id="6" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl that first-order, i.e. gradient information, is available.</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{1}</span>()</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Implement `logdensity_and_gradient`.</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    logγ_x <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="op">-</span>x <span class="op">.*</span> (x <span class="op">-</span> model.mean)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> logγ_x, ∇logγ_x</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s just try it out:</p>
<div id="8" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate the problem.</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> <span class="fu">IsotropicNormalModel</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.])</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create some example input that we can test on.</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>x_example <span class="op">=</span> <span class="fu">randn</span>(LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate!</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-18.76443345916787</code></pre>
</div>
</div>
<p>To defer it to an automatic differentiation backend, we can do</p>
<div id="10" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl we only have access to 0-th order information.</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{0}</span>()</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Use `LogDensityProblemsAD`'s `ADgradient` in combination with some AD backend to implement `logdensity_and_gradient`.</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblemsAD</span>, <span class="bu">ADTypes</span>, <span class="bu">ForwardDiff</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>model_with_grad <span class="op">=</span> <span class="fu">ADgradient</span>(<span class="fu">AutoForwardDiff</span>(), model)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model_with_grad, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-18.76443345916787</code></pre>
</div>
</div>
<p>We’ll continue with the second approach in this tutorial since this is typically what one does in practice, because there are better hobbies to spend time on than deriving gradients by hand.</p>
<p>At this point, one might wonder how we’re going to tie this back to Turing.jl in the end. Effectively, when working with inference methods that only require log-density evaluations and / or higher-order information of the log-density, Turing.jl actually converts the user-provided <code>Model</code> into an object implementing the above methods for <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>. As a result, most samplers provided by Turing.jl are actually implemented to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, enabling their use both <em>within</em> Turing.jl and <em>outside</em> of Turing.jl! Morever, there exists similar conversions for Stan through BridgeStan and Stan<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, which means that a sampler supporting the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface can easily be used on both Turing.jl <em>and</em> Stan models (in addition to user-provided models, as our <code>IsotropicNormalModel</code> above)!</p>
<p>Anyways, let’s move on to actually implementing the sampler.</p>
</section>
<section id="implementing-mala-in-abstractmcmc.jl" class="level2">
<h2 class="anchored" data-anchor-id="implementing-mala-in-abstractmcmc.jl">Implementing MALA in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a></h2>
<p>Now that we’ve established that a model implementing the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface provides us with all the information we need from <span class="math inline">\(\log \gamma(x)\)</span>, we can address the question: given an object that implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, how can we define a sampler for it?</p>
<p>We’re going to do this by making our sampler a sub-type of <code>AbstractMCMC.AbstractSampler</code> in addition to implementing a few methods from <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>. Why? Because it gets us <em>a lot</em> of functionality for free, as we will see later.</p>
<p>Moreover, <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> provides a very natural interface for MCMC algorithms.</p>
<p>First, we’ll define our <code>MALA</code> type</p>
<div id="12" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">AbstractMCMC</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALA{T,A} <span class="op">&lt;:</span><span class="dt"> AbstractMCMC.AbstractSampler</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"stepsize used in the leapfrog step"</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    ϵ_init<span class="op">::</span><span class="dt">T</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"covariance matrix used for the momentum"</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    M_init<span class="op">::</span><span class="dt">A</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notice how we’ve added the suffix <code>_init</code> to both the stepsize and the covariance matrix. We’ve done this because a <code>AbstractMCMC.AbstractSampler</code> should be <em>immutable</em>. Of course there might be many scenarios where we want to allow something like the stepsize and / or the covariance matrix to vary between iterations, e.g.&nbsp;during the burn-in / adaptation phase of the sampling process we might want to adjust the parameters using statistics computed from these initial iterations. But information which can change between iterations <em>should not go in the sampler itself</em>! Instead, this information should go in the sampler <em>state</em>.</p>
<p>The sampler state should at the very least contain all the necessary information to perform the next MCMC iteration, but usually contains further information, e.g.&nbsp;quantities and statistics useful for evaluating whether the sampler has converged.</p>
<p>We will use the following sampler state for our <code>MALA</code> sampler:</p>
<div id="14" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALAState{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This might seem overly redundant: we’re defining a type <code>MALAState</code> and it only contains a simple vector of reals. In this particular case we indeed could have dropped this and simply used a <code>AbstractVector{&lt;:Real}</code> as our sampler state, but typically, as we will see later, one wants to include other quantities in the sampler state. For example, if we also wanted to adapt the parameters of our <code>MALA</code>, e.g.&nbsp;alter the stepsize depending on acceptance rates, in which case we should also put <code>ϵ</code> in the state, but for now we’ll keep things simple.</p>
<p>Moreover, we also want a <em>sample</em> type, which is a type meant for “public consumption”, i.e.&nbsp;the end-user. This is generally going to contain a subset of the information present in the state. But in such a simple scenario as this, we similarly only have a <code>AbstractVector{&lt;:Real}</code>:</p>
<div id="16" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALASample{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We currently have three things:</p>
<ol type="1">
<li>A <code>AbstractMCMC.AbstractSampler</code> implementation called <code>MALA</code>.</li>
<li>A state <code>MALAState</code> for our sampler <code>MALA</code>.</li>
<li>A sample <code>MALASample</code> for our sampler <code>MALA</code>.</li>
</ol>
<p>That means that we’re ready to implement the only thing that really matters: <code>AbstractMCMC.step</code>.</p>
<p><code>AbstractMCMC.step</code> defines the MCMC iteration of our <code>MALA</code> given the current <code>MALAState</code>. Specifically, the signature of the function is as follows:</p>
<div id="18" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The RNG to ensure reproducibility.</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The model that defines our target.</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.AbstractModel</span>,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The sampler for which we're taking a `step`.</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">AbstractMCMC.AbstractSampler</span>,</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The current sampler `state`.</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    state;</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Additional keyword arguments that we may or may not need.</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Moreover, there is a specific <code>AbstractMCMC.AbstractModel</code> which is used to indicate that the model that is provided implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface: <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Since, as we discussed earlier, in our case we’re indeed going to work with types that support the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, we’ll define <code>AbstractMCMC.step</code> for such a <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Note that <code>AbstractMCMC.LogDensityModel</code> has no other purpose; it has a single field called <code>logdensity</code>, and it does nothing else. But by wrapping the model in <code>AbstractMCMC.LogDensityModel</code>, it allows samplers that want to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> to define their <code>AbstractMCMC.step</code> on this type without running into method ambiguities.</p>
<p>All in all, that means that the signature for our <code>AbstractMCMC.step</code> is going to be the following:</p>
<div id="20" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># `LogDensityModel` so we know we're working with LogDensityProblems.jl model.</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler.</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler state.</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Great! Now let’s actually implement the full <code>AbstractMCMC.step</code> for our <code>MALA</code>.</p>
<p>Let’s remind ourselves what we’re going to do:</p>
<ol type="1">
<li>Sample a new momentum <span class="math inline">\(p\)</span>.</li>
<li>Compute the log-density of the extended target <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>Take a single leapfrog step <span class="math inline">\((\tilde{x}, \tilde{p}) = L_{\epsilon}(x, p)\)</span>.</li>
<li>Accept or reject the proposed <span class="math inline">\((\tilde{x}, \tilde{p})\)</span>.</li>
</ol>
<p>All in all, this results in the following:</p>
<div id="22" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>: Random</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Distributions</span>  <span class="co"># so we get the `MvNormal`</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the wrapped model which implements LogDensityProblems.jl.</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just extract the sampler parameters to make our lives easier.</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    ϵ <span class="op">=</span> sampler.ϵ_init</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    M <span class="op">=</span> sampler.M_init</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the current parameters.</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> state.x</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sample the momentum.</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>    p_dist <span class="op">=</span> <span class="fu">MvNormal</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)), M)</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> <span class="fu">rand</span>(rng, p_dist)</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Propose using a single leapfrog step.</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>    x̃, p̃ <span class="op">=</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Accept or reject proposal.</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>    logp <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p)</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>    logp̃ <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x̃) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p̃)</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>    logα <span class="op">=</span> logp̃ <span class="op">-</span> logp</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>    state_new <span class="op">=</span> <span class="cf">if</span> <span class="fu">log</span>(<span class="fu">rand</span>(rng)) <span class="op">&lt;</span> logα</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Accept.</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x̃)</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Reject.</span></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x)</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return the "sample" and the sampler state.</span></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(state_new.x), state_new</span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Fairly straight-forward.</p>
<p>Of course, we haven’t defined the <code>leapfrog_step</code> method yet, so let’s do that:</p>
<div id="24" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p` using "position" `x`.</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x))</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    p1 <span class="op">=</span> p <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update the "position" `x` using momentum `p1`.</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    x̃ <span class="op">=</span> x <span class="op">+</span> ϵ <span class="op">.*</span> (M <span class="op">\</span> p1)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p1` using position `x̃`</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x̃ <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x̃))</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    p2 <span class="op">=</span> p1 <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x̃</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Flip momentum `p2`.</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    p̃ <span class="op">=</span> <span class="op">-</span>p2</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x̃, p̃</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>leapfrog_step (generic function with 1 method)</code></pre>
</div>
</div>
<p>With all of this, we’re technically ready to sample!</p>
<div id="26" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>, <span class="bu">LinearAlgebra</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>rng <span class="op">=</span> <span class="bu">Random</span>.<span class="fu">default_rng</span>()</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>sampler <span class="op">=</span> <span class="fu">MALA</span>(<span class="fl">1</span>, I)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>state <span class="op">=</span> <span class="fu">MALAState</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)))</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>x_next, state_next <span class="op">=</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    rng,</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    AbstractMCMC.<span class="fu">LogDensityModel</span>(model),</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    state</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>(MALASample{Vector{Float64}}([0.46257005985332805, 0.8859939391714166, 0.3323330986767227]), MALAState{Vector{Float64}}([0.46257005985332805, 0.8859939391714166, 0.3323330986767227]))</code></pre>
</div>
</div>
<p>Great, it works!</p>
<p>And I promised we would get quite some functionality for free if we implemented <code>AbstractMCMC.step</code>, and so we can now simply call <code>sample</code> to perform standard MCMC sampling:</p>
<div id="28" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform 1000 iterations with our `MALA` sampler.</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; initial_state<span class="op">=</span>state, progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Concatenate into a matrix.</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000 Matrix{Float64}:
 -3.61346  -4.93211  -6.11498   -4.0803   …  -2.62352  -4.54273   -5.53881
 -2.15111  -1.90559  -0.963439  -1.0582       1.26338   0.233744   0.282556
  3.18355   3.4776    4.14177    4.52787      4.74657   4.43884    4.73905</code></pre>
</div>
</div>
<div id="30" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the marginal means and standard deviations.</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -5.01402    0.988707
  0.0227273  0.997804
  5.01459    1.0007</code></pre>
</div>
</div>
<p>Let’s visualize the samples</p>
<div id="32" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">StatsPlots</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">transpose</span>(samples_matrix[<span class="op">:</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">:</span><span class="kw">end</span>]), alpha<span class="op">=</span><span class="fl">0.5</span>, legend<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<!--?xml version="1.0" encoding="utf-8"?-->
<svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" width="672" height="480" viewbox="0 0 2688 1920">
<defs>
  <clippath id="clip270">
    <rect x="0" y="0" width="2688" height="1920"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip270)" d="M0 1920 L2688 1920 L2688 0 L0 0  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip271">
    <rect x="537" y="0" width="1883" height="1883"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip270)" d="M151.747 1800.78 L2640.76 1800.78 L2640.76 47.2441 L151.747 47.2441  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip272">
    <rect x="151" y="47" width="2490" height="1755"></rect>
  </clippath>
</defs>
<polyline clip-path="url(#clip272)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="219.84,1800.78 219.84,47.2441 "></polyline>
<polyline clip-path="url(#clip272)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="807.458,1800.78 807.458,47.2441 "></polyline>
<polyline clip-path="url(#clip272)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1395.08,1800.78 1395.08,47.2441 "></polyline>
<polyline clip-path="url(#clip272)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1982.69,1800.78 1982.69,47.2441 "></polyline>
<polyline clip-path="url(#clip272)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="2570.31,1800.78 2570.31,47.2441 "></polyline>
<polyline clip-path="url(#clip272)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,1518.95 2640.76,1518.95 "></polyline>
<polyline clip-path="url(#clip272)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,1215.33 2640.76,1215.33 "></polyline>
<polyline clip-path="url(#clip272)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,911.705 2640.76,911.705 "></polyline>
<polyline clip-path="url(#clip272)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,608.085 2640.76,608.085 "></polyline>
<polyline clip-path="url(#clip272)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,304.464 2640.76,304.464 "></polyline>
<polyline clip-path="url(#clip270)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1800.78 2640.76,1800.78 "></polyline>
<polyline clip-path="url(#clip270)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="219.84,1800.78 219.84,1781.88 "></polyline>
<polyline clip-path="url(#clip270)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="807.458,1800.78 807.458,1781.88 "></polyline>
<polyline clip-path="url(#clip270)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1395.08,1800.78 1395.08,1781.88 "></polyline>
<polyline clip-path="url(#clip270)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1982.69,1800.78 1982.69,1781.88 "></polyline>
<polyline clip-path="url(#clip270)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="2570.31,1800.78 2570.31,1781.88 "></polyline>
<path clip-path="url(#clip270)" d="M219.84 1834 Q216.229 1834 214.4 1837.57 Q212.595 1841.11 212.595 1848.24 Q212.595 1855.34 214.4 1858.91 Q216.229 1862.45 219.84 1862.45 Q223.474 1862.45 225.28 1858.91 Q227.108 1855.34 227.108 1848.24 Q227.108 1841.11 225.28 1837.57 Q223.474 1834 219.84 1834 M219.84 1830.3 Q225.65 1830.3 228.706 1834.9 Q231.784 1839.49 231.784 1848.24 Q231.784 1856.96 228.706 1861.57 Q225.65 1866.15 219.84 1866.15 Q214.03 1866.15 210.951 1861.57 Q207.896 1856.96 207.896 1848.24 Q207.896 1839.49 210.951 1834.9 Q214.03 1830.3 219.84 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip270)" d="M771.15 1861.55 L787.47 1861.55 L787.47 1865.48 L765.525 1865.48 L765.525 1861.55 Q768.187 1858.79 772.771 1854.16 Q777.377 1849.51 778.558 1848.17 Q780.803 1845.65 781.683 1843.91 Q782.585 1842.15 782.585 1840.46 Q782.585 1837.71 780.641 1835.97 Q778.72 1834.23 775.618 1834.23 Q773.419 1834.23 770.965 1835 Q768.535 1835.76 765.757 1837.31 L765.757 1832.59 Q768.581 1831.46 771.035 1830.88 Q773.488 1830.3 775.525 1830.3 Q780.896 1830.3 784.09 1832.98 Q787.285 1835.67 787.285 1840.16 Q787.285 1842.29 786.474 1844.21 Q785.687 1846.11 783.581 1848.7 Q783.002 1849.37 779.9 1852.59 Q776.798 1855.78 771.15 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip270)" d="M797.331 1830.92 L815.687 1830.92 L815.687 1834.86 L801.613 1834.86 L801.613 1843.33 Q802.632 1842.98 803.65 1842.82 Q804.669 1842.64 805.687 1842.64 Q811.474 1842.64 814.854 1845.81 Q818.233 1848.98 818.233 1854.4 Q818.233 1859.97 814.761 1863.08 Q811.289 1866.15 804.97 1866.15 Q802.794 1866.15 800.525 1865.78 Q798.28 1865.41 795.872 1864.67 L795.872 1859.97 Q797.956 1861.11 800.178 1861.66 Q802.4 1862.22 804.877 1862.22 Q808.882 1862.22 811.22 1860.11 Q813.558 1858.01 813.558 1854.4 Q813.558 1850.78 811.22 1848.68 Q808.882 1846.57 804.877 1846.57 Q803.002 1846.57 801.127 1846.99 Q799.275 1847.4 797.331 1848.28 L797.331 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip270)" d="M837.446 1834 Q833.835 1834 832.007 1837.57 Q830.201 1841.11 830.201 1848.24 Q830.201 1855.34 832.007 1858.91 Q833.835 1862.45 837.446 1862.45 Q841.081 1862.45 842.886 1858.91 Q844.715 1855.34 844.715 1848.24 Q844.715 1841.11 842.886 1837.57 Q841.081 1834 837.446 1834 M837.446 1830.3 Q843.256 1830.3 846.312 1834.9 Q849.391 1839.49 849.391 1848.24 Q849.391 1856.96 846.312 1861.57 Q843.256 1866.15 837.446 1866.15 Q831.636 1866.15 828.557 1861.57 Q825.502 1856.96 825.502 1848.24 Q825.502 1839.49 828.557 1834.9 Q831.636 1830.3 837.446 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip270)" d="M1354.69 1830.92 L1373.05 1830.92 L1373.05 1834.86 L1358.98 1834.86 L1358.98 1843.33 Q1360 1842.98 1361.01 1842.82 Q1362.03 1842.64 1363.05 1842.64 Q1368.84 1842.64 1372.22 1845.81 Q1375.6 1848.98 1375.6 1854.4 Q1375.6 1859.97 1372.12 1863.08 Q1368.65 1866.15 1362.33 1866.15 Q1360.16 1866.15 1357.89 1865.78 Q1355.64 1865.41 1353.24 1864.67 L1353.24 1859.97 Q1355.32 1861.11 1357.54 1861.66 Q1359.76 1862.22 1362.24 1862.22 Q1366.25 1862.22 1368.58 1860.11 Q1370.92 1858.01 1370.92 1854.4 Q1370.92 1850.78 1368.58 1848.68 Q1366.25 1846.57 1362.24 1846.57 Q1360.37 1846.57 1358.49 1846.99 Q1356.64 1847.4 1354.69 1848.28 L1354.69 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip270)" d="M1394.81 1834 Q1391.2 1834 1389.37 1837.57 Q1387.56 1841.11 1387.56 1848.24 Q1387.56 1855.34 1389.37 1858.91 Q1391.2 1862.45 1394.81 1862.45 Q1398.44 1862.45 1400.25 1858.91 Q1402.08 1855.34 1402.08 1848.24 Q1402.08 1841.11 1400.25 1837.57 Q1398.44 1834 1394.81 1834 M1394.81 1830.3 Q1400.62 1830.3 1403.68 1834.9 Q1406.75 1839.49 1406.75 1848.24 Q1406.75 1856.96 1403.68 1861.57 Q1400.62 1866.15 1394.81 1866.15 Q1389 1866.15 1385.92 1861.57 Q1382.87 1856.96 1382.87 1848.24 Q1382.87 1839.49 1385.92 1834.9 Q1389 1830.3 1394.81 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip270)" d="M1424.97 1834 Q1421.36 1834 1419.53 1837.57 Q1417.73 1841.11 1417.73 1848.24 Q1417.73 1855.34 1419.53 1858.91 Q1421.36 1862.45 1424.97 1862.45 Q1428.61 1862.45 1430.41 1858.91 Q1432.24 1855.34 1432.24 1848.24 Q1432.24 1841.11 1430.41 1837.57 Q1428.61 1834 1424.97 1834 M1424.97 1830.3 Q1430.78 1830.3 1433.84 1834.9 Q1436.92 1839.49 1436.92 1848.24 Q1436.92 1856.96 1433.84 1861.57 Q1430.78 1866.15 1424.97 1866.15 Q1419.16 1866.15 1416.08 1861.57 Q1413.03 1856.96 1413.03 1848.24 Q1413.03 1839.49 1416.08 1834.9 Q1419.16 1830.3 1424.97 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip270)" d="M1940.97 1830.92 L1963.19 1830.92 L1963.19 1832.91 L1950.65 1865.48 L1945.76 1865.48 L1957.57 1834.86 L1940.97 1834.86 L1940.97 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip270)" d="M1972.36 1830.92 L1990.71 1830.92 L1990.71 1834.86 L1976.64 1834.86 L1976.64 1843.33 Q1977.66 1842.98 1978.68 1842.82 Q1979.7 1842.64 1980.72 1842.64 Q1986.5 1842.64 1989.88 1845.81 Q1993.26 1848.98 1993.26 1854.4 Q1993.26 1859.97 1989.79 1863.08 Q1986.32 1866.15 1980 1866.15 Q1977.82 1866.15 1975.55 1865.78 Q1973.31 1865.41 1970.9 1864.67 L1970.9 1859.97 Q1972.98 1861.11 1975.21 1861.66 Q1977.43 1862.22 1979.9 1862.22 Q1983.91 1862.22 1986.25 1860.11 Q1988.59 1858.01 1988.59 1854.4 Q1988.59 1850.78 1986.25 1848.68 Q1983.91 1846.57 1979.9 1846.57 Q1978.03 1846.57 1976.15 1846.99 Q1974.3 1847.4 1972.36 1848.28 L1972.36 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip270)" d="M2012.47 1834 Q2008.86 1834 2007.03 1837.57 Q2005.23 1841.11 2005.23 1848.24 Q2005.23 1855.34 2007.03 1858.91 Q2008.86 1862.45 2012.47 1862.45 Q2016.11 1862.45 2017.91 1858.91 Q2019.74 1855.34 2019.74 1848.24 Q2019.74 1841.11 2017.91 1837.57 Q2016.11 1834 2012.47 1834 M2012.47 1830.3 Q2018.28 1830.3 2021.34 1834.9 Q2024.42 1839.49 2024.42 1848.24 Q2024.42 1856.96 2021.34 1861.57 Q2018.28 1866.15 2012.47 1866.15 Q2006.66 1866.15 2003.59 1861.57 Q2000.53 1856.96 2000.53 1848.24 Q2000.53 1839.49 2003.59 1834.9 Q2006.66 1830.3 2012.47 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip270)" d="M2514.84 1861.55 L2522.48 1861.55 L2522.48 1835.18 L2514.17 1836.85 L2514.17 1832.59 L2522.43 1830.92 L2527.11 1830.92 L2527.11 1861.55 L2534.75 1861.55 L2534.75 1865.48 L2514.84 1865.48 L2514.84 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip270)" d="M2554.19 1834 Q2550.58 1834 2548.75 1837.57 Q2546.94 1841.11 2546.94 1848.24 Q2546.94 1855.34 2548.75 1858.91 Q2550.58 1862.45 2554.19 1862.45 Q2557.82 1862.45 2559.63 1858.91 Q2561.46 1855.34 2561.46 1848.24 Q2561.46 1841.11 2559.63 1837.57 Q2557.82 1834 2554.19 1834 M2554.19 1830.3 Q2560 1830.3 2563.06 1834.9 Q2566.13 1839.49 2566.13 1848.24 Q2566.13 1856.96 2563.06 1861.57 Q2560 1866.15 2554.19 1866.15 Q2548.38 1866.15 2545.3 1861.57 Q2542.25 1856.96 2542.25 1848.24 Q2542.25 1839.49 2545.3 1834.9 Q2548.38 1830.3 2554.19 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip270)" d="M2584.35 1834 Q2580.74 1834 2578.91 1837.57 Q2577.11 1841.11 2577.11 1848.24 Q2577.11 1855.34 2578.91 1858.91 Q2580.74 1862.45 2584.35 1862.45 Q2587.99 1862.45 2589.79 1858.91 Q2591.62 1855.34 2591.62 1848.24 Q2591.62 1841.11 2589.79 1837.57 Q2587.99 1834 2584.35 1834 M2584.35 1830.3 Q2590.16 1830.3 2593.22 1834.9 Q2596.3 1839.49 2596.3 1848.24 Q2596.3 1856.96 2593.22 1861.57 Q2590.16 1866.15 2584.35 1866.15 Q2578.54 1866.15 2575.46 1861.57 Q2572.41 1856.96 2572.41 1848.24 Q2572.41 1839.49 2575.46 1834.9 Q2578.54 1830.3 2584.35 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip270)" d="M2614.51 1834 Q2610.9 1834 2609.07 1837.57 Q2607.27 1841.11 2607.27 1848.24 Q2607.27 1855.34 2609.07 1858.91 Q2610.9 1862.45 2614.51 1862.45 Q2618.15 1862.45 2619.95 1858.91 Q2621.78 1855.34 2621.78 1848.24 Q2621.78 1841.11 2619.95 1837.57 Q2618.15 1834 2614.51 1834 M2614.51 1830.3 Q2620.32 1830.3 2623.38 1834.9 Q2626.46 1839.49 2626.46 1848.24 Q2626.46 1856.96 2623.38 1861.57 Q2620.32 1866.15 2614.51 1866.15 Q2608.7 1866.15 2605.62 1861.57 Q2602.57 1856.96 2602.57 1848.24 Q2602.57 1839.49 2605.62 1834.9 Q2608.7 1830.3 2614.51 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip270)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1800.78 151.747,47.2441 "></polyline>
<polyline clip-path="url(#clip270)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1518.95 170.644,1518.95 "></polyline>
<polyline clip-path="url(#clip270)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1215.33 170.644,1215.33 "></polyline>
<polyline clip-path="url(#clip270)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,911.705 170.644,911.705 "></polyline>
<polyline clip-path="url(#clip270)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,608.085 170.644,608.085 "></polyline>
<polyline clip-path="url(#clip270)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,304.464 170.644,304.464 "></polyline>
<path clip-path="url(#clip270)" d="M49.5521 1519.4 L79.2279 1519.4 L79.2279 1523.33 L49.5521 1523.33 L49.5521 1519.4 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip270)" d="M99.8991 1517.08 Q96.7509 1517.08 94.8991 1519.24 Q93.0704 1521.39 93.0704 1525.14 Q93.0704 1528.87 94.8991 1531.04 Q96.7509 1533.19 99.8991 1533.19 Q103.047 1533.19 104.876 1531.04 Q106.728 1528.87 106.728 1525.14 Q106.728 1521.39 104.876 1519.24 Q103.047 1517.08 99.8991 1517.08 M109.181 1502.43 L109.181 1506.69 Q107.422 1505.86 105.617 1505.42 Q103.834 1504.98 102.075 1504.98 Q97.4454 1504.98 94.9917 1508.1 Q92.5612 1511.23 92.2139 1517.55 Q93.5797 1515.53 95.6398 1514.47 Q97.7 1513.38 100.177 1513.38 Q105.385 1513.38 108.394 1516.55 Q111.427 1519.7 111.427 1525.14 Q111.427 1530.46 108.279 1533.68 Q105.131 1536.9 99.8991 1536.9 Q93.9037 1536.9 90.7325 1532.31 Q87.5612 1527.71 87.5612 1518.98 Q87.5612 1510.79 91.45 1505.93 Q95.3389 1501.04 101.89 1501.04 Q103.649 1501.04 105.431 1501.39 Q107.237 1501.74 109.181 1502.43 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip270)" d="M50.3623 1215.78 L80.0381 1215.78 L80.0381 1219.71 L50.3623 1219.71 L50.3623 1215.78 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip270)" d="M104.297 1213.97 Q107.654 1214.69 109.529 1216.96 Q111.427 1219.23 111.427 1222.56 Q111.427 1227.68 107.908 1230.48 Q104.39 1233.28 97.9083 1233.28 Q95.7324 1233.28 93.4176 1232.84 Q91.126 1232.42 88.6723 1231.56 L88.6723 1227.05 Q90.6167 1228.18 92.9315 1228.76 Q95.2463 1229.34 97.7695 1229.34 Q102.168 1229.34 104.459 1227.61 Q106.774 1225.87 106.774 1222.56 Q106.774 1219.5 104.621 1217.79 Q102.492 1216.06 98.6722 1216.06 L94.6445 1216.06 L94.6445 1212.21 L98.8574 1212.21 Q102.306 1212.21 104.135 1210.85 Q105.964 1209.46 105.964 1206.87 Q105.964 1204.2 104.066 1202.79 Q102.191 1201.36 98.6722 1201.36 Q96.7509 1201.36 94.5519 1201.77 Q92.3528 1202.19 89.7139 1203.07 L89.7139 1198.9 Q92.376 1198.16 94.6908 1197.79 Q97.0287 1197.42 99.0889 1197.42 Q104.413 1197.42 107.515 1199.85 Q110.617 1202.26 110.617 1206.38 Q110.617 1209.25 108.973 1211.24 Q107.33 1213.21 104.297 1213.97 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip270)" d="M99.4824 897.504 Q95.8713 897.504 94.0426 901.069 Q92.2371 904.611 92.2371 911.74 Q92.2371 918.847 94.0426 922.411 Q95.8713 925.953 99.4824 925.953 Q103.117 925.953 104.922 922.411 Q106.751 918.847 106.751 911.74 Q106.751 904.611 104.922 901.069 Q103.117 897.504 99.4824 897.504 M99.4824 893.8 Q105.293 893.8 108.348 898.407 Q111.427 902.99 111.427 911.74 Q111.427 920.467 108.348 925.073 Q105.293 929.657 99.4824 929.657 Q93.6723 929.657 90.5936 925.073 Q87.538 920.467 87.538 911.74 Q87.538 902.99 90.5936 898.407 Q93.6723 893.8 99.4824 893.8 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip270)" d="M104.297 606.731 Q107.654 607.448 109.529 609.717 Q111.427 611.985 111.427 615.319 Q111.427 620.434 107.908 623.235 Q104.39 626.036 97.9083 626.036 Q95.7324 626.036 93.4176 625.596 Q91.126 625.18 88.6723 624.323 L88.6723 619.809 Q90.6167 620.944 92.9315 621.522 Q95.2463 622.101 97.7695 622.101 Q102.168 622.101 104.459 620.365 Q106.774 618.629 106.774 615.319 Q106.774 612.263 104.621 610.55 Q102.492 608.814 98.6722 608.814 L94.6445 608.814 L94.6445 604.971 L98.8574 604.971 Q102.306 604.971 104.135 603.606 Q105.964 602.217 105.964 599.624 Q105.964 596.962 104.066 595.55 Q102.191 594.115 98.6722 594.115 Q96.7509 594.115 94.5519 594.532 Q92.3528 594.948 89.7139 595.828 L89.7139 591.661 Q92.376 590.921 94.6908 590.55 Q97.0287 590.18 99.0889 590.18 Q104.413 590.18 107.515 592.61 Q110.617 595.018 110.617 599.138 Q110.617 602.009 108.973 603.999 Q107.33 605.967 104.297 606.731 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip270)" d="M99.8991 302.601 Q96.7509 302.601 94.8991 304.754 Q93.0704 306.907 93.0704 310.656 Q93.0704 314.383 94.8991 316.559 Q96.7509 318.712 99.8991 318.712 Q103.047 318.712 104.876 316.559 Q106.728 314.383 106.728 310.656 Q106.728 306.907 104.876 304.754 Q103.047 302.601 99.8991 302.601 M109.181 287.948 L109.181 292.208 Q107.422 291.374 105.617 290.934 Q103.834 290.495 102.075 290.495 Q97.4454 290.495 94.9917 293.62 Q92.5612 296.745 92.2139 303.064 Q93.5797 301.05 95.6398 299.985 Q97.7 298.897 100.177 298.897 Q105.385 298.897 108.394 302.069 Q111.427 305.217 111.427 310.656 Q111.427 315.981 108.279 319.198 Q105.131 322.416 99.8991 322.416 Q93.9037 322.416 90.7325 317.832 Q87.5612 313.226 87.5612 304.499 Q87.5612 296.305 91.45 291.444 Q95.3389 286.559 101.89 286.559 Q103.649 286.559 105.431 286.907 Q107.237 287.254 109.181 287.948 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip272)" style="stroke:#009af9; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,1277.41 224.541,1441.5 226.891,1545.76 229.242,1447.29 231.592,1406.74 233.943,1564.27 236.293,1475.56 238.644,1379.75 240.994,1401.93 243.345,1399.67 245.695,1307.53 248.046,1439.36 250.396,1438.97 252.747,1376.59 255.097,1419.69 257.448,1461.25 259.798,1438.88 262.148,1343.99 264.499,1345.84 266.849,1336.65 269.2,1559.19 271.55,1197.04 273.901,1465.89 276.251,1571.12 278.602,1395.45 280.952,1309.25 283.303,1442.12 285.653,1667.38 288.004,1536.38 290.354,1478.86 292.705,1510.15 295.055,1567.14 297.406,1350.61 299.756,1548.78 302.107,1568.24 304.457,1409.42 306.807,1517.51 309.158,1353.34 311.508,1229.62 313.859,1454.88 316.209,1496.15 318.56,1510.47 320.91,1474.93 323.261,1560.43 325.611,1453.84 327.962,1473.87 330.312,1494.09 332.663,1360.03 335.013,1500.02 337.364,1527.79 339.714,1324.66 342.065,1352.47 344.415,1463.76 346.765,1471.93 349.116,1251.8 351.466,1391.02 353.817,1535.91 356.167,1426.14 358.518,1309.52 360.868,1531.28 363.219,1467.35 365.569,1356.67 367.92,1258.85 370.27,1548.49 372.621,1395.26 374.971,1532.43 377.322,1469.07 379.672,1528.38 382.023,1290.52 384.373,1380.84 386.724,1601.82 389.074,1645.41 391.424,1455.24 393.775,1385 396.125,1242.22 398.476,1523.9 400.826,1311.97 403.177,1454.31 405.527,1246.77 407.878,1361.07 410.228,1331.79 412.579,1431.92 414.929,1426.7 417.28,1433.74 419.63,1397.43 421.981,1353.23 424.331,1505.77 426.682,1501.64 429.032,1226.32 431.382,1544.8 433.733,1662.85 436.083,1532.77 438.434,1377.36 440.784,1632.55 443.135,1534.68 445.485,1433.53 447.836,1481.63 450.186,1655.77 452.537,1397.99 454.887,1302.17 457.238,1438.16 459.588,1434.28 461.939,1405.02 464.289,1368.01 466.64,1368.31 468.99,1612.1 471.341,1464.83 473.691,1276.08 476.041,1370.04 478.392,1222.48 480.742,1347.66 483.093,1300.74 485.443,1258.53 487.794,1434.83 490.144,1321.41 492.495,1377.43 494.845,1442.28 497.196,1304.34 499.546,1505.37 501.897,1333.86 504.247,1568.63 506.598,1404.55 508.948,1575.84 511.299,1574.38 513.649,1339.96 515.999,1520.77 518.35,1360.92 520.7,1457.7 523.051,1383.89 525.401,1460.85 527.752,1206.48 530.102,1307.54 532.453,1244.44 534.803,1321.73 537.154,1337.61 539.504,1413.73 541.855,1334.31 544.205,1279.4 546.556,1363.72 548.906,1476.28 551.257,1441.06 553.607,1406.51 555.958,1450.63 558.308,1263.87 560.658,1493.69 563.009,1268.92 565.359,1440.6 567.71,1307.87 570.06,1413.65 572.411,1365.88 574.761,1424.49 577.112,1418.01 579.462,1590.74 581.813,1324.29 584.163,1492.21 586.514,1462.19 588.864,1432.64 591.215,1517.69 593.565,1404.25 595.916,1336.19 598.266,1385.19 600.616,1373.88 602.967,1273.56 605.317,1378.71 607.668,1505.61 610.018,1383.21 612.369,1560.63 614.719,1477.59 617.07,1455.77 619.42,1560.84 621.771,1521.02 624.121,1522.14 626.472,1414.02 628.822,1390.64 631.173,1372.04 633.523,1534.68 635.874,1479.83 638.224,1568.4 640.575,1432 642.925,1339.65 645.275,1401.68 647.626,1312.64 649.976,1471.8 652.327,1377.85 654.677,1378.75 657.028,1456.24 659.378,1329.14 661.729,1320.28 664.079,1407.11 666.43,1480.44 668.78,1478.03 671.131,1445.89 673.481,1446.71 675.832,1447.86 678.182,1357.2 680.533,1486.54 682.883,1304.38 685.233,1519.48 687.584,1636.22 689.934,1379.57 692.285,1399.73 694.635,1611.4 696.986,1471.87 699.336,1435.26 701.687,1340.43 704.037,1524.02 706.388,1491.4 708.738,1478.6 711.089,1351.84 713.439,1558.14 715.79,1543.38 718.14,1510.65 720.491,1451.08 722.841,1419.62 725.192,1425.64 727.542,1348.97 729.892,1373.81 732.243,1548.37 734.593,1641.68 736.944,1401.81 739.294,1369.04 741.645,1400.41 743.995,1359.4 746.346,1321.86 748.696,1444.9 751.047,1400.01 753.397,1186.33 755.748,1451.21 758.098,1286.29 760.449,1281.71 762.799,1376.87 765.15,1303.97 767.5,1361.28 769.85,1375.55 772.201,1292.32 774.551,1361.97 776.902,1331.78 779.252,1540.95 781.603,1432.1 783.953,1372.98 786.304,1367.13 788.654,1392.51 791.005,1481.78 793.355,1240.32 795.706,1458.33 798.056,1576.8 800.407,1506.7 802.757,1467.63 805.108,1381.89 807.458,1456.15 809.809,1279.08 812.159,1369.94 814.509,1393.48 816.86,1370.83 819.21,1369.48 821.561,1539.58 823.911,1304 826.262,1536.97 828.612,1328.54 830.963,1366.88 833.313,1232.04 835.664,1355.15 838.014,1172.29 840.365,1330.03 842.715,1408.29 845.066,1402.39 847.416,1360.75 849.767,1487.32 852.117,1286.04 854.467,1254.14 856.818,1432.59 859.168,1424.05 861.519,1334.64 863.869,1604.81 866.22,1326.21 868.57,1355.79 870.921,1477.09 873.271,1511.22 875.622,1384.3 877.972,1430.67 880.323,1446.59 882.673,1444.9 885.024,1459.3 887.374,1517.42 889.725,1528.27 892.075,1339.67 894.426,1474.37 896.776,1446.94 899.126,1364.47 901.477,1458.05 903.827,1330.84 906.178,1308.12 908.528,1580.95 910.879,1290.38 913.229,1258.48 915.58,1557.94 917.93,1457.6 920.281,1356.37 922.631,1595.09 924.982,1505.5 927.332,1541.95 929.683,1477.83 932.033,1396.47 934.384,1476.75 936.734,1268.83 939.084,1320.59 941.435,1365.86 943.785,1550.98 946.136,1466.75 948.486,1421.25 950.837,1431.42 953.187,1421.84 955.538,1320.1 957.888,1387.38 960.239,1470.2 962.589,1207.59 964.94,1349.07 967.29,1391.22 969.641,1493.2 971.991,1376.44 974.342,1355.27 976.692,1450.47 979.043,1255.68 981.393,1518.52 983.743,1291.32 986.094,1503.19 988.444,1428.06 990.795,1430.16 993.145,1328.7 995.496,1309.74 997.846,1389.31 1000.2,1417.97 1002.55,1388 1004.9,1372.91 1007.25,1475.9 1009.6,1578.05 1011.95,1455.59 1014.3,1481.06 1016.65,1428.05 1019,1533.97 1021.35,1293.27 1023.7,1634.99 1026.05,1286.68 1028.4,1380.49 1030.75,1499.27 1033.1,1476.29 1035.45,1373.45 1037.8,1433.86 1040.15,1540.08 1042.51,1746.09 1044.86,1275.46 1047.21,1183.74 1049.56,1410.2 1051.91,1585.87 1054.26,1370.65 1056.61,1380.34 1058.96,1302.37 1061.31,1455.38 1063.66,1364.17 1066.01,1467.24 1068.36,1287.18 1070.71,1510.55 1073.06,1332.84 1075.41,1417.51 1077.76,1396.23 1080.11,1306.75 1082.46,1539.09 1084.81,1496.23 1087.16,1422.64 1089.51,1441.96 1091.87,1489.29 1094.22,1471.79 1096.57,1519.94 1098.92,1399.3 1101.27,1422.7 1103.62,1447.81 1105.97,1336.76 1108.32,1342.94 1110.67,1328.72 1113.02,1400.7 1115.37,1365.98 1117.72,1217.57 1120.07,1325.7 1122.42,1517.8 1124.77,1461.68 1127.12,1506.23 1129.47,1470.68 1131.82,1476.91 1134.17,1305.85 1136.52,1596.5 1138.87,1283.02 1141.23,1535.64 1143.58,1265.22 1145.93,1391.55 1148.28,1384.34 1150.63,1586.69 1152.98,1382.41 1155.33,1339.51 1157.68,1539.68 1160.03,1443.75 1162.38,1683.16 1164.73,1379.56 1167.08,1343.7 1169.43,1488.02 1171.78,1587.21 1174.13,1419.98 1176.48,1349.59 1178.83,1560.47 1181.18,1365.8 1183.53,1446.43 1185.88,1382.78 1188.23,1427.93 1190.59,1653.65 1192.94,1433.18 1195.29,1500.32 1197.64,1440.76 1199.99,1277 1202.34,1454.02 1204.69,1392.04 1207.04,1458.47 1209.39,1400.53 1211.74,1297.18 1214.09,1335.51 1216.44,1268.08 1218.79,1330.49 1221.14,1406.21 1223.49,1316.73 1225.84,1446.65 1228.19,1480.83 1230.54,1388.69 1232.89,1357.61 1235.24,1576.24 1237.59,1501.48 1239.94,1294.54 1242.3,1405.95 1244.65,1387.7 1247,1385.89 1249.35,1387.34 1251.7,1446.68 1254.05,1625.05 1256.4,1529 1258.75,1433.3 1261.1,1346.66 1263.45,1272.65 1265.8,1569.07 1268.15,1408.89 1270.5,1447.05 1272.85,1476.71 1275.2,1382.88 1277.55,1310.14 1279.9,1585.23 1282.25,1255.14 1284.6,1530.72 1286.95,1367.89 1289.3,1496.94 1291.66,1479.26 1294.01,1406.22 1296.36,1550.73 1298.71,1436.18 1301.06,1349.35 1303.41,1621.2 1305.76,1419.27 1308.11,1536.16 1310.46,1531.91 1312.81,1328.95 1315.16,1481.08 1317.51,1387.73 1319.86,1493.14 1322.21,1310.7 1324.56,1448.72 1326.91,1459.62 1329.26,1309.1 1331.61,1434.05 1333.96,1534.74 1336.31,1598.87 1338.66,1569.82 1341.02,1322.29 1343.37,1712.71 1345.72,1603.6 1348.07,1550.6 1350.42,1484.22 1352.77,1446.83 1355.12,1443.6 1357.47,1372.09 1359.82,1504.97 1362.17,1548.42 1364.52,1400.44 1366.87,1509.34 1369.22,1491.45 1371.57,1384.58 1373.92,1508.5 1376.27,1247.18 1378.62,1405.19 1380.97,1442.95 1383.32,1449.45 1385.67,1314.14 1388.02,1480.8 1390.38,1273.01 1392.73,1398.95 1395.08,1479.89 1397.43,1435.07 1399.78,1489.45 1402.13,1460.59 1404.48,1340.78 1406.83,1520.07 1409.18,1476.69 1411.53,1374.04 1413.88,1271.8 1416.23,1438.36 1418.58,1504.09 1420.93,1467.26 1423.28,1317.57 1425.63,1439.59 1427.98,1447.36 1430.33,1377.28 1432.68,1399.62 1435.03,1506.28 1437.38,1357.85 1439.74,1527.54 1442.09,1372.37 1444.44,1578.92 1446.79,1489.79 1449.14,1396.77 1451.49,1354.36 1453.84,1427.51 1456.19,1419.64 1458.54,1354.07 1460.89,1415.85 1463.24,1231.4 1465.59,1531.02 1467.94,1322.03 1470.29,1557.58 1472.64,1273.68 1474.99,1313.61 1477.34,1460.44 1479.69,1258.66 1482.04,1534.02 1484.39,1408.89 1486.74,1359.9 1489.1,1430.01 1491.45,1304.28 1493.8,1336.22 1496.15,1566.49 1498.5,1543.15 1500.85,1287.59 1503.2,1511.26 1505.55,1360.27 1507.9,1543.35 1510.25,1267.93 1512.6,1468.91 1514.95,1411.83 1517.3,1503.71 1519.65,1446.82 1522,1459.5 1524.35,1507.65 1526.7,1396.94 1529.05,1454.85 1531.4,1302.58 1533.75,1603.21 1536.1,1461.82 1538.45,1375.98 1540.81,1307.96 1543.16,1346.92 1545.51,1395.8 1547.86,1508.63 1550.21,1079.73 1552.56,1390.15 1554.91,1336.84 1557.26,1316.9 1559.61,1444.26 1561.96,1553.1 1564.31,1459.67 1566.66,1311.33 1569.01,1289.97 1571.36,1240.26 1573.71,1411.71 1576.06,1417.67 1578.41,1449.46 1580.76,1305.86 1583.11,1313.14 1585.46,1384.59 1587.81,1271.25 1590.17,1320.18 1592.52,1455.65 1594.87,1474.3 1597.22,1315.37 1599.57,1324.98 1601.92,1082.61 1604.27,1347.48 1606.62,1265.91 1608.97,1311.7 1611.32,1482.52 1613.67,1523.39 1616.02,1379.88 1618.37,1409.67 1620.72,1472.68 1623.07,1498.31 1625.42,1384.63 1627.77,1322.8 1630.12,1350.11 1632.47,1396.15 1634.82,1590.05 1637.17,1486.95 1639.53,1418.79 1641.88,1386.76 1644.23,1373.89 1646.58,1477.58 1648.93,1390.92 1651.28,1376.18 1653.63,1351.38 1655.98,1205.79 1658.33,1580.14 1660.68,1348.92 1663.03,1475.38 1665.38,1332.41 1667.73,1381.39 1670.08,1421.53 1672.43,1501.07 1674.78,1477.43 1677.13,1421.41 1679.48,1508.03 1681.83,1186.04 1684.18,1348.59 1686.53,1498.88 1688.89,1376.36 1691.24,1499.54 1693.59,1422.4 1695.94,1477.67 1698.29,1366.8 1700.64,1389.14 1702.99,1544.99 1705.34,1274.25 1707.69,1338.85 1710.04,1396.83 1712.39,1161.92 1714.74,1387.41 1717.09,1496.96 1719.44,1461.32 1721.79,1501.95 1724.14,1439.15 1726.49,1417.44 1728.84,1356.28 1731.19,1492.56 1733.54,1417.15 1735.89,1406.67 1738.25,1435.38 1740.6,1369.47 1742.95,1508.47 1745.3,1371.43 1747.65,1505.22 1750,1499.51 1752.35,1331.12 1754.7,1383.21 1757.05,1499.13 1759.4,1301.78 1761.75,1384.33 1764.1,1515.09 1766.45,1518.02 1768.8,1479.11 1771.15,1375.59 1773.5,1499.02 1775.85,1322.84 1778.2,1374.45 1780.55,1571.52 1782.9,1443.14 1785.25,1376.97 1787.6,1275.99 1789.96,1412.37 1792.31,1399.43 1794.66,1532.48 1797.01,1477.06 1799.36,1400.02 1801.71,1370.98 1804.06,1483.11 1806.41,1565.8 1808.76,1238.05 1811.11,1073.03 1813.46,1281.69 1815.81,1207.29 1818.16,1501.82 1820.51,1412.9 1822.86,1378.6 1825.21,1223.81 1827.56,1365.04 1829.91,1384.86 1832.26,1474.58 1834.61,1448.73 1836.96,1465.23 1839.32,1336.37 1841.67,1482.26 1844.02,1381.92 1846.37,1630.92 1848.72,1406.07 1851.07,1481.07 1853.42,1549.14 1855.77,1318.88 1858.12,1343.76 1860.47,1606.05 1862.82,1506.87 1865.17,1468.04 1867.52,1520.39 1869.87,1406.38 1872.22,1571.74 1874.57,1499.67 1876.92,1592.14 1879.27,1280.39 1881.62,1341.81 1883.97,1289.45 1886.32,1142.45 1888.68,1379.35 1891.03,1505.4 1893.38,1437.23 1895.73,1454.04 1898.08,1274.78 1900.43,1353.33 1902.78,1347.63 1905.13,1503.11 1907.48,1303.38 1909.83,1356.3 1912.18,1388.86 1914.53,1626.96 1916.88,1427.35 1919.23,1529.48 1921.58,1401.36 1923.93,1406.55 1926.28,1471.03 1928.63,1433.92 1930.98,1415.83 1933.33,1403.98 1935.68,1410.04 1938.04,1439.1 1940.39,1441.24 1942.74,1751.15 1945.09,1396.59 1947.44,1414.46 1949.79,1583.95 1952.14,1449.68 1954.49,1428.23 1956.84,1003.52 1959.19,1527.46 1961.54,1430.22 1963.89,1402 1966.24,1456.1 1968.59,1595.81 1970.94,1529.11 1973.29,1547.24 1975.64,1440.26 1977.99,1336.55 1980.34,1551.18 1982.69,1315.21 1985.04,1687.54 1987.4,1388.53 1989.75,1552.69 1992.1,1503.03 1994.45,1286.6 1996.8,1335.82 1999.15,1426.47 2001.5,1300.56 2003.85,1341.31 2006.2,1389.28 2008.55,1327.81 2010.9,1198.8 2013.25,1479.4 2015.6,1517.69 2017.95,1559.52 2020.3,1396.89 2022.65,1368.7 2025,1461.95 2027.35,1231.82 2029.7,1440.91 2032.05,1308.32 2034.4,1358.03 2036.76,1557.39 2039.11,1419.48 2041.46,1461.22 2043.81,1313.4 2046.16,1367.44 2048.51,1315.04 2050.86,1372.77 2053.21,1356.51 2055.56,1365.92 2057.91,1314.06 2060.26,1493.46 2062.61,1574.36 2064.96,1301 2067.31,1595.42 2069.66,1439.76 2072.01,1464.37 2074.36,1466.58 2076.71,1484.95 2079.06,1421.39 2081.41,1511.75 2083.76,1377.15 2086.11,1577.98 2088.47,1283.77 2090.82,1488.69 2093.17,1414.11 2095.52,1346.49 2097.87,1248.81 2100.22,1286.42 2102.57,1182.44 2104.92,1404.69 2107.27,1481.59 2109.62,1517.87 2111.97,1305.04 2114.32,1536.88 2116.67,1393.47 2119.02,1554.83 2121.37,1441.51 2123.72,1464.8 2126.07,1543.01 2128.42,1542.14 2130.77,1535.92 2133.12,1508.3 2135.47,1550.54 2137.83,1384.69 2140.18,1324.52 2142.53,1380.23 2144.88,1311.24 2147.23,1355.72 2149.58,1327.25 2151.93,1437.13 2154.28,1449.04 2156.63,1435.21 2158.98,1337.06 2161.33,1344.47 2163.68,1329.41 2166.03,1424.02 2168.38,1429.63 2170.73,1339.38 2173.08,1244.2 2175.43,1354.31 2177.78,1382.33 2180.13,1453.89 2182.48,1438.29 2184.83,1261.33 2187.19,1310.93 2189.54,1367.7 2191.89,1428.86 2194.24,1392.86 2196.59,1182.49 2198.94,1449.48 2201.29,1553.97 2203.64,1364.31 2205.99,1536.57 2208.34,1392.22 2210.69,1319.59 2213.04,1352.26 2215.39,1454.68 2217.74,1479.02 2220.09,1381.92 2222.44,1424.5 2224.79,1460.28 2227.14,1461.62 2229.49,1502 2231.84,1510.29 2234.19,1524.42 2236.55,1227.02 2238.9,1264.99 2241.25,1370.92 2243.6,1354.26 2245.95,1287.11 2248.3,1341.47 2250.65,1412.92 2253,1308.59 2255.35,1546.63 2257.7,1375.13 2260.05,1453.79 2262.4,1256.95 2264.75,1361.83 2267.1,1573.24 2269.45,1340.38 2271.8,1334.98 2274.15,1264.09 2276.5,1423.87 2278.85,1554.58 2281.2,1400.1 2283.55,1403.77 2285.91,1302.51 2288.26,1443.5 2290.61,1569.58 2292.96,1434.13 2295.31,1314.95 2297.66,1482.71 2300.01,1374.15 2302.36,1479.48 2304.71,1568.05 2307.06,1425.79 2309.41,1490.71 2311.76,1371.96 2314.11,1359.2 2316.46,1379.44 2318.81,1397.38 2321.16,1281.56 2323.51,1343.38 2325.86,1338.77 2328.21,1345.94 2330.56,1552.04 2332.91,1488.43 2335.27,1365.05 2337.62,1316.1 2339.97,1464.5 2342.32,1258.91 2344.67,1367.94 2347.02,1422.84 2349.37,1506.99 2351.72,1299.38 2354.07,1402.91 2356.42,1287.66 2358.77,1504.98 2361.12,1422.33 2363.47,1387.12 2365.82,1355.92 2368.17,1510.99 2370.52,1510.59 2372.87,1329.02 2375.22,1461.4 2377.57,1489.57 2379.92,1422.56 2382.27,1417.57 2384.62,1349.57 2386.98,1424.75 2389.33,1271.15 2391.68,1478.62 2394.03,1423.23 2396.38,1552.77 2398.73,1353.69 2401.08,1297.99 2403.43,1356.73 2405.78,1424.57 2408.13,1395.52 2410.48,1276.32 2412.83,1405.5 2415.18,1503.03 2417.53,1535.26 2419.88,1402.07 2422.23,1447.21 2424.58,1309.66 2426.93,1385.95 2429.28,1496.02 2431.63,1413.4 2433.98,1290.99 2436.34,1331.33 2438.69,1477.65 2441.04,1269.54 2443.39,1417.37 2445.74,1556.17 2448.09,1437.57 2450.44,1489.73 2452.79,1462.65 2455.14,1484.38 2457.49,1366.95 2459.84,1306.63 2462.19,1380.96 2464.54,1581.14 2466.89,1573.16 2469.24,1327.15 2471.59,1438.35 2473.94,1248.73 2476.29,1515.83 2478.64,1441.55 2480.99,1581.94 2483.34,1376.22 2485.7,1420.4 2488.05,1296.16 2490.4,1282.09 2492.75,1310.34 2495.1,1471.24 2497.45,1466.6 2499.8,1402.3 2502.15,1513.71 2504.5,1376.75 2506.85,1430.41 2509.2,1525.5 2511.55,1274.21 2513.9,1337.21 2516.25,1548.95 2518.6,1470.44 2520.95,1289.88 2523.3,1429.53 2525.65,1406.01 2528,1524.09 2530.35,1421.81 2532.7,1456.08 2535.06,1357.25 2537.41,1389.77 2539.76,1489.79 2542.11,1393.68 2544.46,1436.69 2546.81,1359.62 2549.16,1364.57 2551.51,1281.19 2553.86,1275.1 2556.21,1396.63 2558.56,1364.83 2560.91,1619.96 2563.26,1379.18 2565.61,1431.36 2567.96,1353.59 2570.31,1598.41 "></polyline>
<polyline clip-path="url(#clip272)" style="stroke:#e26f46; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,1129.41 224.541,887.195 226.891,985.032 229.242,932.076 231.592,965.438 233.943,846.607 236.293,710.937 238.644,827.175 240.994,798.438 243.345,728.795 245.695,1059.9 248.046,960.595 250.396,1014.65 252.747,697.01 255.097,919.239 257.448,832.339 259.798,1055.83 262.148,1060.5 264.499,764.689 266.849,971.448 269.2,800.671 271.55,943.455 273.901,941.588 276.251,871.334 278.602,843.904 280.952,1117.23 283.303,815.219 285.653,887.477 288.004,717.13 290.354,830.826 292.705,778.709 295.055,854.473 297.406,1041.07 299.756,880.883 302.107,958.933 304.457,1051.48 306.807,796.402 309.158,905.709 311.508,881.863 313.859,887.942 316.209,869.901 318.56,908.951 320.91,963.347 323.261,1128.94 325.611,1114.89 327.962,864.305 330.312,969.227 332.663,997.031 335.013,1050.58 337.364,1068.9 339.714,915.367 342.065,791.187 344.415,1142.59 346.765,950.016 349.116,1154.69 351.466,935.924 353.817,977.13 356.167,914.428 358.518,837.928 360.868,913.944 363.219,1011.79 365.569,995.794 367.92,763.19 370.27,923.437 372.621,929.326 374.971,908.81 377.322,912.898 379.672,832.17 382.023,1046.01 384.373,916.216 386.724,817.312 389.074,954.75 391.424,1140.59 393.775,973.955 396.125,866.758 398.476,747.56 400.826,850.78 403.177,923.159 405.527,843.385 407.878,939.498 410.228,790.396 412.579,992.176 414.929,878.262 417.28,893.167 419.63,895.608 421.981,870.687 424.331,842.759 426.682,1041.29 429.032,858.681 431.382,1034.87 433.733,947.089 436.083,989.573 438.434,983.423 440.784,907.028 443.135,893.451 445.485,970.425 447.836,924.629 450.186,831.377 452.537,708.231 454.887,943.823 457.238,945.801 459.588,900.595 461.939,889.109 464.289,1059.39 466.64,902.556 468.99,1008.82 471.341,918.837 473.691,766.72 476.041,871.129 478.392,842.377 480.742,890.926 483.093,902.464 485.443,1062.76 487.794,871.373 490.144,1218.64 492.495,956.05 494.845,978.518 497.196,888.215 499.546,706.238 501.897,990.54 504.247,897.796 506.598,927.392 508.948,641.772 511.299,1026.81 513.649,922.531 515.999,857.21 518.35,890.868 520.7,893.747 523.051,862.451 525.401,921.571 527.752,809.012 530.102,896.253 532.453,824.699 534.803,996.144 537.154,940.152 539.504,851.734 541.855,934.114 544.205,700.858 546.556,1012.97 548.906,918.796 551.257,913.539 553.607,774.362 555.958,842.821 558.308,951.498 560.658,799.454 563.009,975.961 565.359,994.909 567.71,1122.11 570.06,791.738 572.411,853.339 574.761,969.761 577.112,922.61 579.462,844.878 581.813,929.348 584.163,914.197 586.514,930.685 588.864,800.489 591.215,914.813 593.565,855.047 595.916,926.49 598.266,982.847 600.616,855.926 602.967,896.99 605.317,774.504 607.668,772.235 610.018,829.883 612.369,1172.85 614.719,1018.99 617.07,1014.81 619.42,918.69 621.771,873.456 624.121,1058.49 626.472,654.817 628.822,827.361 631.173,1022.01 633.523,873.869 635.874,781.004 638.224,977.66 640.575,1059.49 642.925,908.299 645.275,901.997 647.626,1006.69 649.976,1101.37 652.327,894.856 654.677,821.018 657.028,891.08 659.378,871.816 661.729,927.436 664.079,976.156 666.43,801.426 668.78,1007.6 671.131,949.066 673.481,918.685 675.832,951.945 678.182,726.097 680.533,743.373 682.883,1035.15 685.233,782.49 687.584,1063.45 689.934,942.082 692.285,1101.52 694.635,802.142 696.986,1173.58 699.336,925.898 701.687,881.385 704.037,928.252 706.388,845.454 708.738,891.805 711.089,961.469 713.439,880.64 715.79,584.699 718.14,883.075 720.491,840.111 722.841,922.502 725.192,870.689 727.542,1065.25 729.892,805.47 732.243,934.189 734.593,732.4 736.944,912.195 739.294,1099.26 741.645,1003.48 743.995,1093.35 746.346,788.085 748.696,848.362 751.047,748.397 753.397,996.976 755.748,811.668 758.098,832.759 760.449,840.112 762.799,1021.62 765.15,944.828 767.5,861.997 769.85,908.522 772.201,981.068 774.551,763.779 776.902,920.85 779.252,981.824 781.603,938.856 783.953,1051 786.304,1026.93 788.654,959.979 791.005,961.372 793.355,747.61 795.706,820.956 798.056,915.972 800.407,812.941 802.757,1005.26 805.108,876.961 807.458,895.539 809.809,755.63 812.159,831.699 814.509,898.401 816.86,1036.07 819.21,908.151 821.561,997.315 823.911,959.353 826.262,861.844 828.612,1110.25 830.963,1105.04 833.313,974.388 835.664,854.335 838.014,894.844 840.365,914.06 842.715,736.687 845.066,839.694 847.416,964.639 849.767,901.665 852.117,1080.74 854.467,706.859 856.818,866.453 859.168,769.41 861.519,798.064 863.869,861.322 866.22,1027.92 868.57,915.262 870.921,871.845 873.271,855.972 875.622,754.319 877.972,944.217 880.323,871.138 882.673,924.533 885.024,1043.92 887.374,866.713 889.725,845.582 892.075,734.737 894.426,860.737 896.776,778.245 899.126,942.114 901.477,1035.92 903.827,1077.33 906.178,910.233 908.528,1030.29 910.879,864.343 913.229,932.167 915.58,847.801 917.93,669.648 920.281,978.395 922.631,1016.46 924.982,790.654 927.332,955.245 929.683,814.867 932.033,1015.74 934.384,764.902 936.734,854.223 939.084,1037.05 941.435,1085.67 943.785,976.184 946.136,815.684 948.486,976.819 950.837,761.94 953.187,816.906 955.538,884.491 957.888,907.94 960.239,1081.99 962.589,821.983 964.94,1029.91 967.29,832.288 969.641,881.194 971.991,1016.75 974.342,792.179 976.692,1002.64 979.043,846.474 981.393,876.605 983.743,691.061 986.094,765.016 988.444,887.99 990.795,849.759 993.145,1069.96 995.496,838.369 997.846,958.055 1000.2,679.332 1002.55,900.957 1004.9,892.964 1007.25,915.027 1009.6,891.326 1011.95,756.045 1014.3,868.464 1016.65,978.057 1019,1008.99 1021.35,948.898 1023.7,853.49 1026.05,846.75 1028.4,1101.53 1030.75,796.868 1033.1,921.628 1035.45,986.815 1037.8,851.637 1040.15,915.62 1042.51,824.973 1044.86,766.618 1047.21,898.601 1049.56,929.234 1051.91,945.021 1054.26,914.096 1056.61,904.574 1058.96,861.291 1061.31,932.785 1063.66,1087.24 1066.01,967.558 1068.36,1004.16 1070.71,797.998 1073.06,842.844 1075.41,918.575 1077.76,890.265 1080.11,831.236 1082.46,855.751 1084.81,760.951 1087.16,813.405 1089.51,791.402 1091.87,837.983 1094.22,859.203 1096.57,805.579 1098.92,906.891 1101.27,916.454 1103.62,1011.56 1105.97,991.983 1108.32,962.332 1110.67,836.183 1113.02,902.758 1115.37,820.186 1117.72,933.679 1120.07,987.262 1122.42,1027.35 1124.77,885.289 1127.12,1063.43 1129.47,923.935 1131.82,1032.19 1134.17,985.02 1136.52,991.609 1138.87,712.171 1141.23,833.554 1143.58,870.841 1145.93,767.298 1148.28,803.312 1150.63,978.478 1152.98,814.217 1155.33,914.249 1157.68,1035.4 1160.03,953.813 1162.38,901.867 1164.73,796.784 1167.08,950.523 1169.43,824.467 1171.78,1037.95 1174.13,877.304 1176.48,934.208 1178.83,775.347 1181.18,898.868 1183.53,854.04 1185.88,890.74 1188.23,951.237 1190.59,813.18 1192.94,997.272 1195.29,897.994 1197.64,992.04 1199.99,895.947 1202.34,892.272 1204.69,826.374 1207.04,1004.62 1209.39,874.756 1211.74,786.473 1214.09,829.604 1216.44,886.624 1218.79,1184.23 1221.14,881.842 1223.49,1044.69 1225.84,857.685 1228.19,925.872 1230.54,970.968 1232.89,709.461 1235.24,890.27 1237.59,957.145 1239.94,946.145 1242.3,1019.19 1244.65,769.009 1247,931.609 1249.35,777.831 1251.7,909.971 1254.05,856.254 1256.4,966.773 1258.75,945.114 1261.1,947.754 1263.45,910.132 1265.8,848.834 1268.15,878.186 1270.5,1004.78 1272.85,703.322 1275.2,758.607 1277.55,923.719 1279.9,669.89 1282.25,865.691 1284.6,992.579 1286.95,887.335 1289.3,1093.42 1291.66,1059.71 1294.01,878.753 1296.36,992.014 1298.71,932.529 1301.06,781.24 1303.41,857.722 1305.76,1015.63 1308.11,911.932 1310.46,871.125 1312.81,959.167 1315.16,942.889 1317.51,745.521 1319.86,949.231 1322.21,1067.38 1324.56,1019.36 1326.91,930.686 1329.26,988.86 1331.61,853.237 1333.96,1005.47 1336.31,714.905 1338.66,839.849 1341.02,871.626 1343.37,1002.66 1345.72,992.107 1348.07,842.157 1350.42,851.999 1352.77,957.852 1355.12,845.443 1357.47,1015.31 1359.82,1174.98 1362.17,1009.54 1364.52,946.768 1366.87,862.235 1369.22,789.002 1371.57,931.258 1373.92,832.567 1376.27,915.759 1378.62,768.096 1380.97,787.453 1383.32,865.094 1385.67,948.454 1388.02,869.695 1390.38,1134.22 1392.73,937.631 1395.08,1105.04 1397.43,781 1399.78,1014.12 1402.13,1091.85 1404.48,815.278 1406.83,808.838 1409.18,1006.75 1411.53,830.223 1413.88,872.211 1416.23,894.181 1418.58,846.699 1420.93,967.295 1423.28,916.216 1425.63,829.801 1427.98,815.64 1430.33,974.887 1432.68,913.938 1435.03,889.56 1437.38,957.168 1439.74,1141.27 1442.09,885.194 1444.44,863.673 1446.79,716.757 1449.14,935.89 1451.49,984.798 1453.84,920.823 1456.19,946.333 1458.54,828.459 1460.89,933.752 1463.24,883.537 1465.59,1018.85 1467.94,1059.62 1470.29,707.365 1472.64,830.336 1474.99,916.565 1477.34,847.175 1479.69,824.072 1482.04,959.107 1484.39,1015.18 1486.74,974.365 1489.1,767.044 1491.45,765.998 1493.8,749.071 1496.15,819.798 1498.5,748.971 1500.85,903.559 1503.2,938.184 1505.55,1050.93 1507.9,1008.52 1510.25,834.695 1512.6,796.63 1514.95,890.365 1517.3,866.883 1519.65,1020.76 1522,717.026 1524.35,952.063 1526.7,961.986 1529.05,921.449 1531.4,918.473 1533.75,868.862 1536.1,956.502 1538.45,719.699 1540.81,890.397 1543.16,943.735 1545.51,972.6 1547.86,887.334 1550.21,947.462 1552.56,920.602 1554.91,1009.29 1557.26,888.517 1559.61,687.862 1561.96,1062.52 1564.31,1040.43 1566.66,874.283 1569.01,1148.48 1571.36,892.561 1573.71,746.085 1576.06,1016.26 1578.41,952.462 1580.76,956.615 1583.11,893.313 1585.46,851.073 1587.81,955.066 1590.17,910.107 1592.52,1049.27 1594.87,942.702 1597.22,1050.89 1599.57,930.923 1601.92,945.238 1604.27,904.968 1606.62,799.572 1608.97,911.439 1611.32,810.998 1613.67,868.092 1616.02,840.884 1618.37,759.917 1620.72,756.647 1623.07,1093.86 1625.42,788.3 1627.77,843.551 1630.12,698.305 1632.47,1037.18 1634.82,981.842 1637.17,971.066 1639.53,948.276 1641.88,807.696 1644.23,846.351 1646.58,1085.45 1648.93,1038.83 1651.28,904.741 1653.63,919.557 1655.98,864.965 1658.33,804.595 1660.68,726.456 1663.03,1047.12 1665.38,1077.58 1667.73,984.956 1670.08,1000.02 1672.43,959.909 1674.78,907.52 1677.13,825.063 1679.48,994.448 1681.83,908.082 1684.18,966.371 1686.53,818.052 1688.89,1046.97 1691.24,867.383 1693.59,823.296 1695.94,923.097 1698.29,1000.86 1700.64,1028.2 1702.99,812.693 1705.34,1080.66 1707.69,778.422 1710.04,789.01 1712.39,1002.63 1714.74,856.624 1717.09,995.499 1719.44,721.766 1721.79,918.963 1724.14,823.297 1726.49,781.09 1728.84,905.467 1731.19,898.69 1733.54,888.692 1735.89,902.234 1738.25,946.976 1740.6,939.651 1742.95,981.549 1745.3,850.186 1747.65,919.431 1750,945.349 1752.35,875.026 1754.7,1024 1757.05,796.544 1759.4,959.789 1761.75,1027.53 1764.1,761.165 1766.45,835.288 1768.8,825.535 1771.15,945.277 1773.5,940.042 1775.85,955.592 1778.2,923.076 1780.55,655.19 1782.9,972.12 1785.25,1058.42 1787.6,1085.6 1789.96,1080.01 1792.31,788.502 1794.66,924.196 1797.01,958.76 1799.36,727.109 1801.71,938.817 1804.06,902.946 1806.41,1054.88 1808.76,859.498 1811.11,813.351 1813.46,1017.83 1815.81,1055.83 1818.16,861.346 1820.51,902.219 1822.86,827.387 1825.21,826.313 1827.56,967.685 1829.91,906.718 1832.26,786.65 1834.61,894.385 1836.96,769.263 1839.32,885.426 1841.67,925.753 1844.02,848.049 1846.37,814.338 1848.72,762.321 1851.07,1003.49 1853.42,760.172 1855.77,1064.39 1858.12,859.874 1860.47,994.726 1862.82,826.455 1865.17,1013.73 1867.52,994.398 1869.87,815.606 1872.22,1007.48 1874.57,848.717 1876.92,886.833 1879.27,1049.87 1881.62,984.58 1883.97,780.07 1886.32,916.845 1888.68,1037.12 1891.03,867.463 1893.38,967.63 1895.73,804.162 1898.08,923.79 1900.43,984.74 1902.78,953.568 1905.13,1057.76 1907.48,854.544 1909.83,986.818 1912.18,893.435 1914.53,893.857 1916.88,1024.04 1919.23,913.288 1921.58,1081.79 1923.93,801.339 1926.28,1052.7 1928.63,828.587 1930.98,816.028 1933.33,933.079 1935.68,884.404 1938.04,954.886 1940.39,888.721 1942.74,1008.49 1945.09,956.303 1947.44,974.825 1949.79,860.392 1952.14,831.878 1954.49,1009.72 1956.84,887.686 1959.19,816.783 1961.54,858.813 1963.89,1041.46 1966.24,958.809 1968.59,858.494 1970.94,894.506 1973.29,856.287 1975.64,847.788 1977.99,873.727 1980.34,832.211 1982.69,807.461 1985.04,1062.98 1987.4,859.532 1989.75,1071.06 1992.1,919.383 1994.45,895.886 1996.8,911.696 1999.15,790.374 2001.5,1082.38 2003.85,957.187 2006.2,839.055 2008.55,1008.36 2010.9,1029.4 2013.25,1014.77 2015.6,742.588 2017.95,823.82 2020.3,915.333 2022.65,835.355 2025,771.957 2027.35,994.913 2029.7,938.488 2032.05,1022.78 2034.4,961.146 2036.76,861.698 2039.11,894.555 2041.46,898.477 2043.81,858.869 2046.16,976.098 2048.51,845.204 2050.86,881.221 2053.21,1111.73 2055.56,784.12 2057.91,1031.53 2060.26,825.242 2062.61,809.784 2064.96,903.26 2067.31,785.253 2069.66,797.587 2072.01,957.417 2074.36,975.758 2076.71,732.531 2079.06,936.007 2081.41,775.592 2083.76,901.932 2086.11,846.889 2088.47,877.166 2090.82,855.361 2093.17,1020.12 2095.52,864.274 2097.87,906.093 2100.22,1011.18 2102.57,808.564 2104.92,1020.14 2107.27,868.364 2109.62,947.802 2111.97,707.902 2114.32,768.818 2116.67,801.745 2119.02,888.442 2121.37,877.45 2123.72,735.273 2126.07,885.712 2128.42,897.256 2130.77,1022.93 2133.12,1005.68 2135.47,1051.82 2137.83,1004.32 2140.18,920.699 2142.53,946.323 2144.88,840.225 2147.23,920.019 2149.58,957.278 2151.93,779.721 2154.28,923.845 2156.63,947.163 2158.98,806.47 2161.33,842.478 2163.68,929.932 2166.03,785.412 2168.38,997.242 2170.73,970.504 2173.08,942.72 2175.43,911.808 2177.78,629.786 2180.13,1009.62 2182.48,868.936 2184.83,680.41 2187.19,1001.92 2189.54,757.037 2191.89,720.017 2194.24,897.165 2196.59,817.805 2198.94,708.137 2201.29,894.625 2203.64,1166.34 2205.99,1013.53 2208.34,840.293 2210.69,874.689 2213.04,948.405 2215.39,1113.64 2217.74,931.008 2220.09,1083.04 2222.44,830.257 2224.79,975.301 2227.14,951.042 2229.49,1041.08 2231.84,895.318 2234.19,942.441 2236.55,856.329 2238.9,970.343 2241.25,868.899 2243.6,863.061 2245.95,936.282 2248.3,885.724 2250.65,781.964 2253,1019.76 2255.35,840.265 2257.7,933.518 2260.05,949.365 2262.4,990.445 2264.75,903.46 2267.1,935.35 2269.45,930.912 2271.8,907.511 2274.15,683.143 2276.5,885.058 2278.85,897.701 2281.2,926.489 2283.55,887.938 2285.91,898.828 2288.26,1001.76 2290.61,952.332 2292.96,935.906 2295.31,719.32 2297.66,795.694 2300.01,783.708 2302.36,1006.7 2304.71,787.548 2307.06,964.915 2309.41,807.696 2311.76,798.602 2314.11,835.02 2316.46,887.395 2318.81,986.874 2321.16,1006.17 2323.51,739.743 2325.86,999.811 2328.21,1004.81 2330.56,847.175 2332.91,702.857 2335.27,977.666 2337.62,1003.61 2339.97,892.326 2342.32,874.928 2344.67,968.452 2347.02,941.809 2349.37,1039.65 2351.72,1027.69 2354.07,797.703 2356.42,827.708 2358.77,856.406 2361.12,936.511 2363.47,1014.24 2365.82,947.562 2368.17,908.296 2370.52,1148.29 2372.87,952.235 2375.22,923.988 2377.57,921.207 2379.92,726.011 2382.27,982.713 2384.62,724.797 2386.98,999.617 2389.33,830.851 2391.68,757.329 2394.03,945.669 2396.38,647.654 2398.73,901.726 2401.08,1091.67 2403.43,797.267 2405.78,941.894 2408.13,840.49 2410.48,918.34 2412.83,932.533 2415.18,885.167 2417.53,1053.59 2419.88,843.337 2422.23,957.771 2424.58,982.096 2426.93,824.754 2429.28,1097.47 2431.63,662.947 2433.98,748.815 2436.34,918.865 2438.69,1030.9 2441.04,857.653 2443.39,898.034 2445.74,935.524 2448.09,915.495 2450.44,800.959 2452.79,824.715 2455.14,981.126 2457.49,885.309 2459.84,768.216 2462.19,727.163 2464.54,992.361 2466.89,1184.76 2469.24,921.801 2471.59,678.821 2473.94,1053.22 2476.29,714.428 2478.64,1008.02 2480.99,795.845 2483.34,892.042 2485.7,669.171 2488.05,1095.31 2490.4,813.219 2492.75,935.391 2495.1,991.567 2497.45,826.827 2499.8,827.726 2502.15,890.767 2504.5,1058.14 2506.85,997.529 2509.2,928.953 2511.55,852.546 2513.9,749.623 2516.25,968.644 2518.6,833.497 2520.95,731.987 2523.3,934.85 2525.65,1144.72 2528,875.362 2530.35,774.558 2532.7,983.324 2535.06,804.294 2537.41,844.2 2539.76,905.274 2542.11,903.782 2544.46,798.139 2546.81,1104.9 2549.16,1024.26 2551.51,905.296 2553.86,873.604 2556.21,734.833 2558.56,1085.1 2560.91,978.273 2563.26,737.918 2565.61,930.394 2567.96,955.332 2570.31,937.275 "></polyline>
<polyline clip-path="url(#clip272)" style="stroke:#3da44d; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,589.509 224.541,284.124 226.891,456.832 229.242,440.832 231.592,428.765 233.943,318.723 236.293,405.273 238.644,331.022 240.994,193.754 243.345,535.785 245.695,529.926 248.046,355.799 250.396,500.872 252.747,428.631 255.097,416.088 257.448,388.363 259.798,639.714 262.148,478.501 264.499,327.334 266.849,427.846 269.2,413.003 271.55,571.638 273.901,320.411 276.251,533.794 278.602,437.577 280.952,402.73 283.303,326.283 285.653,295.643 288.004,486.211 290.354,273.95 292.705,385.458 295.055,507.049 297.406,378.822 299.756,382.585 302.107,261.754 304.457,222.139 306.807,443.796 309.158,412.886 311.508,481.01 313.859,319.489 316.209,326.802 318.56,600.437 320.91,318.972 323.261,574.047 325.611,381.048 327.962,393.161 330.312,420.56 332.663,297.183 335.013,360.029 337.364,461.939 339.714,366.809 342.065,393.573 344.415,514.802 346.765,372.427 349.116,419.213 351.466,416.165 353.817,377.023 356.167,401.102 358.518,240.698 360.868,444.391 363.219,338.518 365.569,381.533 367.92,384.866 370.27,476.252 372.621,286.71 374.971,675.367 377.322,395.422 379.672,375.426 382.023,241.136 384.373,315.79 386.724,476.128 389.074,446.556 391.424,326.446 393.775,102.846 396.125,509.855 398.476,448.393 400.826,312.999 403.177,319.297 405.527,539.083 407.878,490.463 410.228,536.082 412.579,373.841 414.929,363.708 417.28,499.824 419.63,467.966 421.981,476.996 424.331,372.931 426.682,418.656 429.032,361.316 431.382,548.971 433.733,398.367 436.083,260.759 438.434,313.751 440.784,261.17 443.135,395.738 445.485,301.329 447.836,432.489 450.186,308.543 452.537,486.996 454.887,497.686 457.238,355.795 459.588,410.117 461.939,343.702 464.289,583.347 466.64,320.077 468.99,460.402 471.341,360.815 473.691,450.986 476.041,477.57 478.392,402.894 480.742,445.977 483.093,322.308 485.443,476.479 487.794,416.753 490.144,385.75 492.495,248.491 494.845,364.62 497.196,313.537 499.546,520.114 501.897,500.807 504.247,272.682 506.598,399.803 508.948,376.121 511.299,251.317 513.649,402.846 515.999,239.462 518.35,530.797 520.7,381.035 523.051,522.792 525.401,549.475 527.752,519.997 530.102,139.709 532.453,326.386 534.803,536.284 537.154,440.696 539.504,431.669 541.855,485.522 544.205,406.262 546.556,300.874 548.906,193.95 551.257,453.11 553.607,314.18 555.958,413.158 558.308,397.024 560.658,322.017 563.009,456.201 565.359,455.692 567.71,386.263 570.06,521.823 572.411,379.376 574.761,465.009 577.112,352.299 579.462,395.459 581.813,308.247 584.163,569.936 586.514,430.877 588.864,474.47 591.215,407.297 593.565,473.272 595.916,395.572 598.266,469.824 600.616,260.418 602.967,447.61 605.317,429.533 607.668,295.747 610.018,255.631 612.369,447.875 614.719,456.785 617.07,362.313 619.42,377.201 621.771,293.178 624.121,247.72 626.472,279.2 628.822,305.679 631.173,151.619 633.523,578.562 635.874,474.719 638.224,572.692 640.575,393.569 642.925,384.404 645.275,383.855 647.626,366.147 649.976,364.522 652.327,328.046 654.677,419.261 657.028,471.659 659.378,399.312 661.729,304.023 664.079,477.777 666.43,273.854 668.78,401.927 671.131,414.889 673.481,478.549 675.832,396.029 678.182,464.109 680.533,353.82 682.883,360.202 685.233,442.569 687.584,333.83 689.934,420.636 692.285,197.087 694.635,537.937 696.986,413.899 699.336,560.876 701.687,486.505 704.037,248.879 706.388,293.027 708.738,219.079 711.089,314.255 713.439,468.347 715.79,392.973 718.14,426.21 720.491,274.651 722.841,332.906 725.192,480.695 727.542,623.539 729.892,292.275 732.243,385.863 734.593,398.148 736.944,316.316 739.294,387.62 741.645,377.972 743.995,435.121 746.346,406.127 748.696,544.788 751.047,372.457 753.397,292.318 755.748,456.647 758.098,464.706 760.449,519.279 762.799,302.816 765.15,345.508 767.5,369.657 769.85,462.006 772.201,297.462 774.551,278.398 776.902,492.302 779.252,441.825 781.603,475.767 783.953,367.877 786.304,652.928 788.654,407.167 791.005,434.721 793.355,479.244 795.706,286.402 798.056,461.41 800.407,406.054 802.757,304.301 805.108,423.781 807.458,141.368 809.809,449.825 812.159,288.684 814.509,484.991 816.86,442.041 819.21,527.55 821.561,399.058 823.911,325.29 826.262,334.22 828.612,343.757 830.963,394.456 833.313,450.137 835.664,467.544 838.014,441.733 840.365,478.354 842.715,259.585 845.066,338.795 847.416,153.136 849.767,565.554 852.117,356.707 854.467,450.774 856.818,327.034 859.168,437.3 861.519,238.804 863.869,586.955 866.22,302.72 868.57,278.393 870.921,276.906 873.271,425.427 875.622,489.275 877.972,364.231 880.323,358.339 882.673,347.425 885.024,270.394 887.374,383.341 889.725,544.422 892.075,443.248 894.426,362.812 896.776,604.771 899.126,589.972 901.477,457.001 903.827,224.083 906.178,492.046 908.528,376.393 910.879,383.87 913.229,366.233 915.58,337.93 917.93,305.184 920.281,541.699 922.631,329.244 924.982,467.106 927.332,298.578 929.683,537.945 932.033,227.923 934.384,239.098 936.734,281.268 939.084,386.267 941.435,571.168 943.785,480.007 946.136,520.769 948.486,340.126 950.837,349.162 953.187,365.072 955.538,447.828 957.888,415.686 960.239,318.765 962.589,330.004 964.94,404.404 967.29,362.789 969.641,341.337 971.991,368.441 974.342,305.581 976.692,592.716 979.043,623.103 981.393,515.726 983.743,524.978 986.094,358.406 988.444,529.74 990.795,351.667 993.145,445.782 995.496,381.611 997.846,332.566 1000.2,477.89 1002.55,541.196 1004.9,319.241 1007.25,552.017 1009.6,493.863 1011.95,438.426 1014.3,333.38 1016.65,387.196 1019,516.426 1021.35,488.71 1023.7,418.129 1026.05,288.279 1028.4,282.438 1030.75,449.825 1033.1,307.705 1035.45,289.823 1037.8,127.06 1040.15,295 1042.51,581.054 1044.86,267.742 1047.21,402.234 1049.56,365.513 1051.91,322.353 1054.26,379.229 1056.61,313.359 1058.96,442.151 1061.31,495.626 1063.66,368.144 1066.01,418.058 1068.36,497.25 1070.71,245.956 1073.06,387.629 1075.41,352.978 1077.76,533.316 1080.11,473.198 1082.46,284.353 1084.81,390.659 1087.16,390.953 1089.51,296.137 1091.87,488.264 1094.22,442.474 1096.57,339.533 1098.92,413.625 1101.27,467.912 1103.62,164.345 1105.97,264.298 1108.32,429.952 1110.67,301.4 1113.02,288.46 1115.37,337.372 1117.72,527.959 1120.07,386.289 1122.42,514.375 1124.77,483.338 1127.12,458.539 1129.47,463.856 1131.82,284.331 1134.17,478.398 1136.52,295.454 1138.87,350.513 1141.23,475.895 1143.58,474.936 1145.93,345.935 1148.28,381.218 1150.63,439.081 1152.98,332.443 1155.33,287.819 1157.68,455.347 1160.03,361.436 1162.38,499.91 1164.73,493.295 1167.08,411.084 1169.43,531.548 1171.78,338.86 1174.13,528.737 1176.48,441.54 1178.83,185.925 1181.18,519.248 1183.53,303.589 1185.88,325.961 1188.23,364.564 1190.59,207.636 1192.94,266.795 1195.29,372.591 1197.64,269.018 1199.99,391.256 1202.34,391.78 1204.69,523.805 1207.04,403.236 1209.39,531.015 1211.74,317.292 1214.09,403.425 1216.44,427.942 1218.79,588.338 1221.14,294.248 1223.49,318.424 1225.84,602.919 1228.19,269.565 1230.54,514.209 1232.89,246.011 1235.24,492.562 1237.59,442.352 1239.94,323.945 1242.3,416.574 1244.65,454.014 1247,421.704 1249.35,299.709 1251.7,315.497 1254.05,364.932 1256.4,558.843 1258.75,386.981 1261.1,471.165 1263.45,461.114 1265.8,294.357 1268.15,137.214 1270.5,351.464 1272.85,470.834 1275.2,554.06 1277.55,338.394 1279.9,469.87 1282.25,501.395 1284.6,512.759 1286.95,345.501 1289.3,399.878 1291.66,310.173 1294.01,222.57 1296.36,284.526 1298.71,410.231 1301.06,439.435 1303.41,427.221 1305.76,436.737 1308.11,448.577 1310.46,354.698 1312.81,457.491 1315.16,337.662 1317.51,422.24 1319.86,530.681 1322.21,414.489 1324.56,442.905 1326.91,271.752 1329.26,549.653 1331.61,416.643 1333.96,183.169 1336.31,303.977 1338.66,500.63 1341.02,382.124 1343.37,444.091 1345.72,503.472 1348.07,382.433 1350.42,330.608 1352.77,265.732 1355.12,616.953 1357.47,455.169 1359.82,385.564 1362.17,419.413 1364.52,420.372 1366.87,430.132 1369.22,532.092 1371.57,504.659 1373.92,274.941 1376.27,596.588 1378.62,290.924 1380.97,359.182 1383.32,393.186 1385.67,399.404 1388.02,472.269 1390.38,291.009 1392.73,401.555 1395.08,258.622 1397.43,457.353 1399.78,460.672 1402.13,350.905 1404.48,378.489 1406.83,340.019 1409.18,420.419 1411.53,637.018 1413.88,338.945 1416.23,441.199 1418.58,235.712 1420.93,479.949 1423.28,339.281 1425.63,399.985 1427.98,384.772 1430.33,625.173 1432.68,338.23 1435.03,392.516 1437.38,361.84 1439.74,777.836 1442.09,371.15 1444.44,484.847 1446.79,590.343 1449.14,402.658 1451.49,388.728 1453.84,234.841 1456.19,328.185 1458.54,391.721 1460.89,479.788 1463.24,453.736 1465.59,418.814 1467.94,314.749 1470.29,253.965 1472.64,554.967 1474.99,501.773 1477.34,484.405 1479.69,521.702 1482.04,364.222 1484.39,484.328 1486.74,440.168 1489.1,322.706 1491.45,327.637 1493.8,282.163 1496.15,376.72 1498.5,277.38 1500.85,386.951 1503.2,430.387 1505.55,386.163 1507.9,434.457 1510.25,362.685 1512.6,396.099 1514.95,334.811 1517.3,335.317 1519.65,435.722 1522,463.446 1524.35,444.615 1526.7,420.536 1529.05,414.43 1531.4,443.115 1533.75,582.674 1536.1,324.538 1538.45,539.993 1540.81,434.013 1543.16,394.69 1545.51,460.747 1547.86,405.889 1550.21,279.463 1552.56,339.539 1554.91,411.262 1557.26,369.573 1559.61,287 1561.96,475.423 1564.31,402.417 1566.66,355.5 1569.01,483.248 1571.36,274.946 1573.71,482.409 1576.06,401.902 1578.41,239.261 1580.76,489.785 1583.11,359.115 1585.46,423.867 1587.81,379.448 1590.17,249.654 1592.52,395.984 1594.87,336.032 1597.22,481.961 1599.57,431.879 1601.92,389.976 1604.27,390.32 1606.62,387.491 1608.97,485.664 1611.32,356.416 1613.67,370.254 1616.02,381.848 1618.37,380.944 1620.72,445.787 1623.07,238.132 1625.42,390.187 1627.77,289.697 1630.12,482.755 1632.47,498.735 1634.82,254.516 1637.17,531.168 1639.53,554.258 1641.88,320.611 1644.23,298.522 1646.58,430.138 1648.93,555.953 1651.28,267.469 1653.63,382.49 1655.98,286.381 1658.33,454.376 1660.68,405.962 1663.03,390.925 1665.38,524.761 1667.73,362.043 1670.08,358.749 1672.43,491.722 1674.78,391.512 1677.13,469.026 1679.48,301.594 1681.83,383.064 1684.18,658.257 1686.53,359.774 1688.89,497.749 1691.24,417.085 1693.59,549.89 1695.94,574.26 1698.29,410.297 1700.64,226.573 1702.99,578.582 1705.34,376.072 1707.69,414.005 1710.04,343.291 1712.39,422.816 1714.74,411.301 1717.09,531.38 1719.44,414.069 1721.79,530.372 1724.14,525.516 1726.49,371.756 1728.84,343.133 1731.19,405.913 1733.54,437.508 1735.89,329.305 1738.25,370.953 1740.6,411.655 1742.95,330.11 1745.3,307.156 1747.65,476.953 1750,550.134 1752.35,444.946 1754.7,305.409 1757.05,249.027 1759.4,410.016 1761.75,222.293 1764.1,369.682 1766.45,438.01 1768.8,532.851 1771.15,594.058 1773.5,375.615 1775.85,502.081 1778.2,341.613 1780.55,269.1 1782.9,353.407 1785.25,327.522 1787.6,435.549 1789.96,379.064 1792.31,405.974 1794.66,417.378 1797.01,537.651 1799.36,213.541 1801.71,533.925 1804.06,432.65 1806.41,377.69 1808.76,304.16 1811.11,403.294 1813.46,560.011 1815.81,390.157 1818.16,447.708 1820.51,346.175 1822.86,331.377 1825.21,260.161 1827.56,204.729 1829.91,472.442 1832.26,278.722 1834.61,685.125 1836.96,470.198 1839.32,543.026 1841.67,496.51 1844.02,375.074 1846.37,430.71 1848.72,564.048 1851.07,455.606 1853.42,191.569 1855.77,469.037 1858.12,145.265 1860.47,291.102 1862.82,487.027 1865.17,371.737 1867.52,351.367 1869.87,469.116 1872.22,393.701 1874.57,466.078 1876.92,383.833 1879.27,399.32 1881.62,444.515 1883.97,464.406 1886.32,421.061 1888.68,469.077 1891.03,325.245 1893.38,367.796 1895.73,551.04 1898.08,418.317 1900.43,426.166 1902.78,509.98 1905.13,396.106 1907.48,572.965 1909.83,462.632 1912.18,368.474 1914.53,391.578 1916.88,336.015 1919.23,553.108 1921.58,577.947 1923.93,429.648 1926.28,354.009 1928.63,391.001 1930.98,426.538 1933.33,442.789 1935.68,360.321 1938.04,351.835 1940.39,451.264 1942.74,447.194 1945.09,438.635 1947.44,530.881 1949.79,505.996 1952.14,369.982 1954.49,461.116 1956.84,356.669 1959.19,298.724 1961.54,408.354 1963.89,354.563 1966.24,398.991 1968.59,413.976 1970.94,263.743 1973.29,490.804 1975.64,374.299 1977.99,385.925 1980.34,418.784 1982.69,445.832 1985.04,579.906 1987.4,495.486 1989.75,339.306 1992.1,645.696 1994.45,479.695 1996.8,621.453 1999.15,635.347 2001.5,315.958 2003.85,446.77 2006.2,324.577 2008.55,363.954 2010.9,387.891 2013.25,437.756 2015.6,225.64 2017.95,335.554 2020.3,463.24 2022.65,243.216 2025,423.633 2027.35,673.092 2029.7,441.698 2032.05,437.055 2034.4,348.242 2036.76,593.178 2039.11,482.062 2041.46,506.731 2043.81,405.304 2046.16,327.869 2048.51,254.316 2050.86,443.841 2053.21,343.708 2055.56,370.119 2057.91,330.224 2060.26,367.587 2062.61,533.372 2064.96,392.012 2067.31,404.585 2069.66,421.49 2072.01,599.382 2074.36,170.277 2076.71,376.869 2079.06,324.186 2081.41,278.554 2083.76,388.689 2086.11,427.967 2088.47,404.833 2090.82,439.732 2093.17,391.487 2095.52,436.132 2097.87,436.76 2100.22,499.243 2102.57,243.944 2104.92,329.015 2107.27,451.781 2109.62,421.717 2111.97,202.395 2114.32,562.855 2116.67,560.53 2119.02,440.476 2121.37,497.681 2123.72,389.626 2126.07,496.24 2128.42,323.52 2130.77,380.48 2133.12,434.83 2135.47,609.194 2137.83,549.032 2140.18,461.809 2142.53,391.454 2144.88,487.458 2147.23,388.385 2149.58,567.532 2151.93,340.299 2154.28,474.618 2156.63,224.57 2158.98,436.138 2161.33,556.801 2163.68,322.145 2166.03,214.287 2168.38,324.806 2170.73,397.883 2173.08,420.581 2175.43,347.868 2177.78,283.461 2180.13,220.714 2182.48,477.334 2184.83,319.613 2187.19,96.8724 2189.54,396.363 2191.89,334.182 2194.24,322.589 2196.59,606.109 2198.94,336.339 2201.29,385.301 2203.64,490.653 2205.99,481.325 2208.34,411.367 2210.69,531.977 2213.04,350.007 2215.39,307.405 2217.74,254.65 2220.09,462.453 2222.44,357.486 2224.79,447.328 2227.14,501.748 2229.49,462.484 2231.84,496.1 2234.19,414.174 2236.55,508.764 2238.9,280.396 2241.25,293.123 2243.6,459.905 2245.95,378.347 2248.3,205.856 2250.65,521.686 2253,236.269 2255.35,417.121 2257.7,335.683 2260.05,374.402 2262.4,393.456 2264.75,521.032 2267.1,478.55 2269.45,384.899 2271.8,529.968 2274.15,387.416 2276.5,337.65 2278.85,294.39 2281.2,508.307 2283.55,476.835 2285.91,264.567 2288.26,469.692 2290.61,509.828 2292.96,446.68 2295.31,217.915 2297.66,407.604 2300.01,416.587 2302.36,315.886 2304.71,430.988 2307.06,320.398 2309.41,325.226 2311.76,303.147 2314.11,532.413 2316.46,374.043 2318.81,488.348 2321.16,475.044 2323.51,286.261 2325.86,351.612 2328.21,276.114 2330.56,472.132 2332.91,544.779 2335.27,294.921 2337.62,505.585 2339.97,498.154 2342.32,369.401 2344.67,329.396 2347.02,302.769 2349.37,425.957 2351.72,590.61 2354.07,286.501 2356.42,343.843 2358.77,184.498 2361.12,372.43 2363.47,307.839 2365.82,383.075 2368.17,436.179 2370.52,566.151 2372.87,434.172 2375.22,145.526 2377.57,272.504 2379.92,208.527 2382.27,488.941 2384.62,317.617 2386.98,510.974 2389.33,446.1 2391.68,412.741 2394.03,583.684 2396.38,491.594 2398.73,317.084 2401.08,465.701 2403.43,388.76 2405.78,260.869 2408.13,524.337 2410.48,377.01 2412.83,394.315 2415.18,243.367 2417.53,279.275 2419.88,284.577 2422.23,359.03 2424.58,324.399 2426.93,432.527 2429.28,450.014 2431.63,434.024 2433.98,492.794 2436.34,186.135 2438.69,269.49 2441.04,173.872 2443.39,375.929 2445.74,442.17 2448.09,534.539 2450.44,348.672 2452.79,505.335 2455.14,527.368 2457.49,275.821 2459.84,344.318 2462.19,563.611 2464.54,476.443 2466.89,574.015 2469.24,354.923 2471.59,404.798 2473.94,296.161 2476.29,363.786 2478.64,450.004 2480.99,363.378 2483.34,440.636 2485.7,458.742 2488.05,252.018 2490.4,546.944 2492.75,262.148 2495.1,550.604 2497.45,416.624 2499.8,376.436 2502.15,400.278 2504.5,557.003 2506.85,365.998 2509.2,350.962 2511.55,342.592 2513.9,482.028 2516.25,495.162 2518.6,258.279 2520.95,514.01 2523.3,719.604 2525.65,496.983 2528,373.871 2530.35,508.581 2532.7,305.926 2535.06,574.217 2537.41,327.257 2539.76,301.199 2542.11,237.437 2544.46,549.873 2546.81,373.93 2549.16,504.019 2551.51,376.118 2553.86,608.196 2556.21,407.803 2558.56,310.085 2560.91,434.096 2563.26,327.804 2565.61,235.621 2567.96,568.975 2570.31,434.932 "></polyline>
</svg>
</div>
</div>
<p>Look at that! Things are working; amazin’.</p>
<p>We can also exploit <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>’s parallel sampling capabilities:</p>
<div id="34" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run separate 4 chains for 10 000 iterations using threads to parallelize.</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>num_chains <span class="op">=</span> <span class="fl">4</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    model_with_grad,</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">MCMCThreads</span>(),</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>,</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    num_chains;</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Note we need to provide an initial state for every chain.</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>    initial_state<span class="op">=</span><span class="fu">fill</span>(state, num_chains),</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>samples_array <span class="op">=</span> <span class="fu">stack</span>(<span class="fu">map</span>(<span class="bu">Base</span>.<span class="fu">Fix1</span>(stack, sample <span class="op">-&gt;</span> sample.x), samples))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000×4 Array{Float64, 3}:
[:, :, 1] =
 -1.62036   -3.88345  -5.25969  -4.21599    …  -4.54339  -5.00129  -7.1072
  0.317321  -1.39736   0.43393  -0.0981153      1.5303    1.45251  -0.188564
  2.04494    3.74842   5.42961   5.67313        3.99172   4.10555   4.24872

[:, :, 2] =
 -3.88528  -2.65505  -2.10514  -2.70284  …  -4.04673   -4.77956  -3.67259
  1.22088   1.50009   1.85968  -1.66096     -0.472646   1.50318   0.372518
  1.46611   1.39994   1.62865   3.31028      2.67151    3.46874   3.80171

[:, :, 3] =
 -2.99354   -4.59924   -5.51464  -4.88649  …  -3.43681   -4.31657  -4.28907
 -0.963233  -0.347516  -1.85454  -1.6976       0.932088   1.67302   1.36084
  0.922072   2.17559    3.72347   5.30909      5.69689    3.5899    6.03086

[:, :, 4] =
 -2.7158     -4.59439   -5.50879  -4.90887  …  -3.73412  -4.62649  -4.17646
 -0.0599066   0.239202   1.75861   1.42105      1.98977   1.7215    0.206537
  3.5763      4.27267    4.22818   5.12152      4.25084   4.54964   5.5136</code></pre>
</div>
</div>
<p>But the fact that we have to provide the <code>AbstractMCMC.sample</code> call, etc. with an <code>initial_state</code> to get started is a bit annoying. We can avoid this by also defining a <code>AbstractMCMC.step</code> <em>without</em> the <code>state</code> argument:</p>
<div id="36" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">::</span><span class="dt">MALA</span>;</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># </span><span class="al">NOTE</span><span class="co">: No state provided!</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just create the initial state by sampling using  a Gaussian.</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="fu">randn</span>(rng, LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(x), <span class="fu">MALAState</span>(x)</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Equipped with this, we no longer need to provide the <code>initial_state</code> everywhere:</p>
<div id="38" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -5.02547    1.01473
 -0.0206491  0.999516
  4.97987    1.01327</code></pre>
</div>
</div>
</section>
<section id="using-our-sampler-with-turing.jl" class="level2">
<h2 class="anchored" data-anchor-id="using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</h2>
<p>As we promised, all of this hassle of implementing our <code>MALA</code> sampler in a way that uses <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> and <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> gets us something more than <em>just</em> an “automatic” implementation of <code>AbstractMCMC.sample</code>.</p>
<p>It also enables use with Turing.jl through the <code>externalsampler</code>, but we need to do one final thing first: we need to tell Turing.jl how to extract a vector of parameters from the “sample” returned in our implementation of <code>AbstractMCMC.step</code>. In our case, the “sample” is a <code>MALASample</code>, so we just need the following line:</p>
<div id="40" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load Turing.jl.</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Turing</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Overload the `getparams` method for our "sample" type, which is just a vector.</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>Turing.Inference.<span class="fu">getparams</span>(<span class="op">::</span><span class="dt">Turing.Model</span>, sample<span class="op">::</span><span class="dt">MALASample</span>) <span class="op">=</span> sample.x</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And with that, we’re good to go!</p>
<div id="42" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Our previous model defined as a Turing.jl model.</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">mvnormal_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">MvNormal</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.], I)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate our model.</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">mvnormal_model</span>()</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Call `sample` but now we're passing in a Turing.jl `model` and wrapping</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co"># our `MALA` sampler in the `externalsampler` to tell Turing.jl that the sampler</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co"># expects something that implements LogDensityProblems.jl.</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×4×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 2.94 seconds
Compute duration  = 2.94 seconds
parameters        = x[1], x[2], x[3]
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters  </span><span class="ansi-bold">    mean  </span><span class="ansi-bold">     std  </span><span class="ansi-bold">    mcse  </span><span class="ansi-bold">  ess_bulk  </span><span class="ansi-bold">  ess_tail  </span><span class="ansi-bold">    rhat  </span><span class="ansi-bold"> ⋯
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">   Float64  </span><span class="ansi-bright-black-fg ansi-bold">   Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> ⋯

        x[1]   -4.9928    1.0004    0.0175   3260.7608   5438.6409    1.0003   ⋯
        x[2]   -0.0059    1.0044    0.0175   3307.8299   4965.9221    1.0008   ⋯
        x[3]    5.0262    0.9879    0.0171   3337.1837   5310.1110    1.0004   ⋯
</span><span class="ansi-cyan-fg ansi-bold">                                                                1 column omitted

Quantiles
 </span><span class="ansi-cyan-fg ansi-bold"> parameters  </span><span class="ansi-cyan-fg ansi-bold">    2.5%  </span><span class="ansi-cyan-fg ansi-bold">   25.0%  </span><span class="ansi-cyan-fg ansi-bold">   50.0%  </span><span class="ansi-cyan-fg ansi-bold">   75.0%  </span><span class="ansi-cyan-fg ansi-bold">   97.5%
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64

        x[1]   -6.9599   -5.6660   -4.9994   -4.3221   -2.9875
        x[2]   -1.9882   -0.6965    0.0079    0.6700    1.9732
        x[3]    3.0519    4.3780    5.0199    5.7051    6.9496
</span></pre>
</div>
</div>
</div>
<p>Pretty neat, eh?</p>
<section id="models-with-constrained-parameters" class="level3">
<h3 class="anchored" data-anchor-id="models-with-constrained-parameters">Models with constrained parameters</h3>
<p>One thing we’ve sort of glossed over in all of the above is that MALA, at least how we’ve implemented it, requires <span class="math inline">\(x\)</span> to live in <span class="math inline">\(\mathbb{R}^d\)</span> for some <span class="math inline">\(d &gt; 0\)</span>. If some of the parameters were in fact constrained, e.g.&nbsp;we were working with a <code>Beta</code> distribution which has support on the interval <span class="math inline">\((0, 1)\)</span>, <em>not</em> on <span class="math inline">\(\mathbb{R}^d\)</span>, we could easily end up outside of the valid range <span class="math inline">\((0, 1)\)</span>.</p>
<div id="44" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">beta_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">beta_model</span>()</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 1.9 seconds
Compute duration  = 1.9 seconds
parameters        = x
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters  </span><span class="ansi-bold">    mean  </span><span class="ansi-bold">     std  </span><span class="ansi-bold">    mcse  </span><span class="ansi-bold">  ess_bulk  </span><span class="ansi-bold">  ess_tail  </span><span class="ansi-bold">    rhat  </span><span class="ansi-bold"> ⋯
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">   Float64  </span><span class="ansi-bright-black-fg ansi-bold">   Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> ⋯

           x    0.5039    0.1874    0.0027   4610.0217   5701.6130    0.9999   ⋯
</span><span class="ansi-cyan-fg ansi-bold">                                                                1 column omitted

Quantiles
 </span><span class="ansi-cyan-fg ansi-bold"> parameters  </span><span class="ansi-cyan-fg ansi-bold">    2.5%  </span><span class="ansi-cyan-fg ansi-bold">   25.0%  </span><span class="ansi-cyan-fg ansi-bold">   50.0%  </span><span class="ansi-cyan-fg ansi-bold">   75.0%  </span><span class="ansi-cyan-fg ansi-bold">   97.5%
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64

           x    0.1491    0.3681    0.5059    0.6437    0.8503
</span></pre>
</div>
</div>
</div>
<p>Yep, that still works, but only because Turing.jl actually <em>transforms</em> the <code>turing_model</code> from constrained to unconstrained, so that the <code>sampler</code> provided to <code>externalsampler</code> is actually always working in unconstrained space! This is not always desirable, so we can turn this off:</p>
<div id="46" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 0.17 seconds
Compute duration  = 0.17 seconds
parameters        = x
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters  </span><span class="ansi-bold">    mean  </span><span class="ansi-bold">     std  </span><span class="ansi-bold">    mcse  </span><span class="ansi-bold"> ess_bulk  </span><span class="ansi-bold"> ess_tail  </span><span class="ansi-bold">    rhat  </span><span class="ansi-bold"> e ⋯
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">  Float64  </span><span class="ansi-bright-black-fg ansi-bold">  Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">   ⋯

           x    0.5085    0.1593    0.0132   127.1820    64.2729    1.0162     ⋯
</span><span class="ansi-cyan-fg ansi-bold">                                                                1 column omitted

Quantiles
 </span><span class="ansi-cyan-fg ansi-bold"> parameters  </span><span class="ansi-cyan-fg ansi-bold">    2.5%  </span><span class="ansi-cyan-fg ansi-bold">   25.0%  </span><span class="ansi-cyan-fg ansi-bold">   50.0%  </span><span class="ansi-cyan-fg ansi-bold">   75.0%  </span><span class="ansi-cyan-fg ansi-bold">   97.5%
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64

           x    0.2174    0.3816    0.5168    0.6356    0.7572
</span></pre>
</div>
</div>
</div>
<p>The fun thing is that this still sort of works because</p>
<div id="48" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">logpdf</span>(<span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>), <span class="fl">10.0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-Inf</code></pre>
</div>
</div>
<p>and so the samples that fall outside of the range are always rejected. But do notice how much worse all the diagnostics are, e.g.&nbsp;<code>ess_tail</code> is very poor compared to when we use <code>unconstrained=true</code>. Moreover, in more complex cases this won’t just result in a “nice” <code>-Inf</code> log-density value, but instead will error:</p>
<div id="50" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="kw">function</span> <span class="fu">demo</span>()</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>    σ² <span class="op">~</span> <span class="fu">truncated</span>(<span class="fu">Normal</span>(), lower<span class="op">=</span><span class="fl">0</span>)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If we end up with negative values for `σ²`, the `Normal` will error.</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>    x <span class="op">~</span> <span class="fu">Normal</span>(<span class="fl">0</span>, σ²)</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre>DomainError with Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}}(-0.5169520797792995,1.0,0.0):
Normal: the condition σ &gt;= zero(σ) is not satisfied.
Stacktrace:
  [1] <span class="ansi-bold">#371</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/qRkAO/src/univariate/continuous/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">normal.jl:37</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [2] <span class="ansi-bold">check_args</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/qRkAO/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">utils.jl:89</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [3] <span class="ansi-bold">#Normal#370</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/qRkAO/src/univariate/continuous/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">normal.jl:37</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [4] <span class="ansi-bold">Normal</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/qRkAO/src/univariate/continuous/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">normal.jl:36</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [5] <span class="ansi-bold">Normal</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/qRkAO/src/univariate/continuous/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">normal.jl:42</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [6] <span class="ansi-bold">macro expansion</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/8nuZQ/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">compiler.jl:558</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [7] <span class="ansi-bold">demo</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">__model__</span>::DynamicPPL.Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}</span>, <span class="ansi-bright-black-fg">__varinfo__</span>::DynamicPPL.ThreadSafeVarInfo<span class="ansi-bright-black-fg">{DynamicPPL.VarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}, ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}, Vector{Base.RefValue{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}</span>, <span class="ansi-bright-black-fg">__context__</span>::DynamicPPL.DefaultContext<span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-magenta-fg">Main.Notebook</span> <span class="ansi-bright-black-fg">~/work/docs/docs/developers/inference/implementing-samplers/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">index.qmd:457</span>
  [8] <span class="ansi-bold">_evaluate!!</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/8nuZQ/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">model.jl:913</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [9] <span class="ansi-bold">evaluate_threadsafe!!</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">model</span>::DynamicPPL.Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}</span>, <span class="ansi-bright-black-fg">varinfo</span>::DynamicPPL.VarInfo<span class="ansi-bright-black-fg">{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}, ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}</span>, <span class="ansi-bright-black-fg">context</span>::DynamicPPL.DefaultContext<span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-cyan-fg">DynamicPPL</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/8nuZQ/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">model.jl:902</span>
 [10] <span class="ansi-bold">evaluate!!</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/8nuZQ/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">model.jl:832</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [11] <span class="ansi-bold">logdensity_at</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/8nuZQ/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">logdensityfunction.jl:184</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [12] <span class="ansi-bold">FixTail</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DifferentiationInterface/yNR8B/src/utils/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">context.jl:169</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [13] <span class="ansi-bold">vector_mode_dual_eval!</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">f</span>::DifferentiationInterface.FixTail<span class="ansi-bright-black-fg">{typeof(DynamicPPL.logdensity_at), Tuple{DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, DynamicPPL.VarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}, DynamicPPL.DefaultContext}}</span>, <span class="ansi-bright-black-fg">cfg</span>::ForwardDiff.GradientConfig<span class="ansi-bright-black-fg">{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}</span>, <span class="ansi-bright-black-fg">x</span>::Vector<span class="ansi-bright-black-fg">{Float64}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-green-fg">ForwardDiff</span> <span class="ansi-bright-black-fg">~/.julia/packages/ForwardDiff/UBbGT/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">apiutils.jl:24</span>
 [14] <span class="ansi-bold">vector_mode_gradient!</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/ForwardDiff/UBbGT/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">gradient.jl:98</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [15] <span class="ansi-bold">gradient!</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">result</span>::DiffResults.MutableDiffResult<span class="ansi-bright-black-fg">{1, Float64, Tuple{Vector{Float64}}}</span>, <span class="ansi-bright-black-fg">f</span>::DifferentiationInterface.FixTail<span class="ansi-bright-black-fg">{typeof(DynamicPPL.logdensity_at), Tuple{DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, DynamicPPL.VarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}, DynamicPPL.DefaultContext}}</span>, <span class="ansi-bright-black-fg">x</span>::Vector<span class="ansi-bright-black-fg">{Float64}</span>, <span class="ansi-bright-black-fg">cfg</span>::ForwardDiff.GradientConfig<span class="ansi-bright-black-fg">{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}</span>, ::Val<span class="ansi-bright-black-fg">{false}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-green-fg">ForwardDiff</span> <span class="ansi-bright-black-fg">~/.julia/packages/ForwardDiff/UBbGT/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">gradient.jl:39</span>
 [16] <span class="ansi-bold">value_and_gradient</span><span class="ansi-bold">(</span>::typeof(DynamicPPL.logdensity_at), ::DifferentiationInterfaceForwardDiffExt.ForwardDiffGradientPrep<span class="ansi-bright-black-fg">{Nothing, ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}, Tuple{Nothing, Nothing, Nothing}}</span>, ::AutoForwardDiff<span class="ansi-bright-black-fg">{2, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}}</span>, ::Vector<span class="ansi-bright-black-fg">{Float64}</span>, ::DifferentiationInterface.Constant<span class="ansi-bright-black-fg">{DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}}</span>, ::DifferentiationInterface.Constant<span class="ansi-bright-black-fg">{DynamicPPL.VarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}}</span>, ::DifferentiationInterface.Constant<span class="ansi-bright-black-fg">{DynamicPPL.DefaultContext}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-yellow-fg">DifferentiationInterfaceForwardDiffExt</span> <span class="ansi-bright-black-fg">~/.julia/packages/DifferentiationInterface/yNR8B/ext/DifferentiationInterfaceForwardDiffExt/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">onearg.jl:417</span>
 [17] <span class="ansi-bold">logdensity_and_gradient</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">f</span>::LogDensityFunction<span class="ansi-bright-black-fg">{DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, DynamicPPL.VarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}, DynamicPPL.DefaultContext, AutoForwardDiff{2, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}}}</span>, <span class="ansi-bright-black-fg">x</span>::Vector<span class="ansi-bright-black-fg">{Float64}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-cyan-fg">DynamicPPL</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/8nuZQ/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">logdensityfunction.jl:215</span>
 [18] <span class="ansi-bold">leapfrog_step</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">model</span>::LogDensityFunction<span class="ansi-bright-black-fg">{DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, DynamicPPL.VarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}, DynamicPPL.DefaultContext, AutoForwardDiff{2, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}}}</span>, <span class="ansi-bright-black-fg">x</span>::Vector<span class="ansi-bright-black-fg">{Float64}</span>, <span class="ansi-bright-black-fg">p</span>::Vector<span class="ansi-bright-black-fg">{Float64}</span>, <span class="ansi-bright-black-fg">ϵ</span>::Int64, <span class="ansi-bright-black-fg">M</span>::UniformScaling<span class="ansi-bright-black-fg">{Bool}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-magenta-fg">Main.Notebook</span> <span class="ansi-bright-black-fg">~/work/docs/docs/developers/inference/implementing-samplers/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">index.qmd:305</span>
 [19] <span class="ansi-bold">step</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">rng</span>::TaskLocalRNG, <span class="ansi-bright-black-fg">model_wrapper</span>::AbstractMCMC.LogDensityModel<span class="ansi-bright-black-fg">{LogDensityFunction{DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, DynamicPPL.VarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}, DynamicPPL.DefaultContext, AutoForwardDiff{2, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}}}}</span>, <span class="ansi-bright-black-fg">sampler</span>::MALA<span class="ansi-bright-black-fg">{Int64, UniformScaling{Bool}}</span>, <span class="ansi-bright-black-fg">state</span>::MALAState<span class="ansi-bright-black-fg">{Vector{Float64}}</span>; <span class="ansi-bright-black-fg">kwargs</span>::@Kwargs<span class="ansi-bright-black-fg">{}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-magenta-fg">Main.Notebook</span> <span class="ansi-bright-black-fg">~/work/docs/docs/developers/inference/implementing-samplers/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">index.qmd:276</span>
 [20] <span class="ansi-bold">step</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">rng</span>::TaskLocalRNG, <span class="ansi-bright-black-fg">model_wrapper</span>::AbstractMCMC.LogDensityModel<span class="ansi-bright-black-fg">{LogDensityFunction{DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, DynamicPPL.VarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}, DynamicPPL.DefaultContext, AutoForwardDiff{2, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}}}}</span>, <span class="ansi-bright-black-fg">sampler</span>::MALA<span class="ansi-bright-black-fg">{Int64, UniformScaling{Bool}}</span>, <span class="ansi-bright-black-fg">state</span>::MALAState<span class="ansi-bright-black-fg">{Vector{Float64}}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-magenta-fg">Main.Notebook</span> <span class="ansi-bright-black-fg">~/work/docs/docs/developers/inference/implementing-samplers/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">index.qmd:258</span>
 [21] <span class="ansi-bold">step</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">rng</span>::TaskLocalRNG, <span class="ansi-bright-black-fg">model</span>::DynamicPPL.Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}</span>, <span class="ansi-bright-black-fg">sampler_wrapper</span>::DynamicPPL.Sampler<span class="ansi-bright-black-fg">{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}</span>, <span class="ansi-bright-black-fg">state</span>::Turing.Inference.TuringState<span class="ansi-bright-black-fg">{MALAState{Vector{Float64}}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, DynamicPPL.VarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}, DynamicPPL.DefaultContext}</span>; <span class="ansi-bright-black-fg">kwargs</span>::@Kwargs<span class="ansi-bright-black-fg">{}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-magenta-fg">Turing.Inference</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/nQwbh/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">abstractmcmc.jl:91</span>
 [22] <span class="ansi-bold">step</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">rng</span>::TaskLocalRNG, <span class="ansi-bright-black-fg">model</span>::DynamicPPL.Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}</span>, <span class="ansi-bright-black-fg">sampler_wrapper</span>::DynamicPPL.Sampler<span class="ansi-bright-black-fg">{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}</span>, <span class="ansi-bright-black-fg">state</span>::Turing.Inference.TuringState<span class="ansi-bright-black-fg">{MALAState{Vector{Float64}}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, DynamicPPL.VarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}, DynamicPPL.DefaultContext}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-magenta-fg">Turing.Inference</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/nQwbh/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">abstractmcmc.jl:80</span>
 [23] <span class="ansi-bold">macro expansion</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/AbstractMCMC/FSyVk/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">sample.jl:217</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [24] <span class="ansi-bold">macro expansion</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/AbstractMCMC/FSyVk/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">logging.jl:16</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [25] <span class="ansi-bold">mcmcsample</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">rng</span>::TaskLocalRNG, <span class="ansi-bright-black-fg">model</span>::DynamicPPL.Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}</span>, <span class="ansi-bright-black-fg">sampler</span>::DynamicPPL.Sampler<span class="ansi-bright-black-fg">{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}</span>, <span class="ansi-bright-black-fg">N</span>::Int64; <span class="ansi-bright-black-fg">progress</span>::Bool, <span class="ansi-bright-black-fg">progressname</span>::String, <span class="ansi-bright-black-fg">callback</span>::Nothing, <span class="ansi-bright-black-fg">num_warmup</span>::Int64, <span class="ansi-bright-black-fg">discard_initial</span>::Int64, <span class="ansi-bright-black-fg">thinning</span>::Int64, <span class="ansi-bright-black-fg">chain_type</span>::Type, <span class="ansi-bright-black-fg">initial_state</span>::Nothing, <span class="ansi-bright-black-fg">kwargs</span>::@Kwargs<span class="ansi-bright-black-fg">{}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-cyan-fg">AbstractMCMC</span> <span class="ansi-bright-black-fg">~/.julia/packages/AbstractMCMC/FSyVk/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">sample.jl:142</span>
 [26] <span class="ansi-bold">sample</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">rng</span>::TaskLocalRNG, <span class="ansi-bright-black-fg">model</span>::DynamicPPL.Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}</span>, <span class="ansi-bright-black-fg">sampler</span>::DynamicPPL.Sampler<span class="ansi-bright-black-fg">{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}</span>, <span class="ansi-bright-black-fg">N</span>::Int64; <span class="ansi-bright-black-fg">chain_type</span>::Type, <span class="ansi-bright-black-fg">resume_from</span>::Nothing, <span class="ansi-bright-black-fg">initial_state</span>::Nothing, <span class="ansi-bright-black-fg">kwargs</span>::@Kwargs<span class="ansi-bright-black-fg">{progress::Bool}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-cyan-fg">DynamicPPL</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/8nuZQ/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">sampler.jl:102</span>
 [27] <span class="ansi-bold">sample</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/8nuZQ/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">sampler.jl:92</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [28] <span class="ansi-bold">#sample#8</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/nQwbh/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">Inference.jl:277</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [29] <span class="ansi-bold">sample</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/nQwbh/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">Inference.jl:268</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [30] <span class="ansi-bold">#sample#7</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/nQwbh/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">Inference.jl:265</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [31] top-level scope
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/work/docs/docs/developers/inference/implementing-samplers/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">index.qmd:459</span></pre>
</div>
</div>
</div>
<p>As expected, we run into a <code>DomainError</code> at some point, while if we set <code>unconstrained=true</code>, letting Turing.jl transform the model to a unconstrained form behind the scenes, everything works as expected:</p>
<div id="52" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 0.58 seconds
Compute duration  = 0.58 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters  </span><span class="ansi-bold">    mean  </span><span class="ansi-bold">     std  </span><span class="ansi-bold">    mcse  </span><span class="ansi-bold"> ess_bulk  </span><span class="ansi-bold"> ess_tail  </span><span class="ansi-bold">    rhat  </span><span class="ansi-bold"> e ⋯
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">  Float64  </span><span class="ansi-bright-black-fg ansi-bold">  Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">   ⋯

          σ²    0.8659    0.5843    0.0236   377.2919   138.9274    1.0013     ⋯
           x    0.0103    1.0028    0.0501   553.8952   430.0597    1.0063     ⋯
</span><span class="ansi-cyan-fg ansi-bold">                                                                1 column omitted

Quantiles
 </span><span class="ansi-cyan-fg ansi-bold"> parameters  </span><span class="ansi-cyan-fg ansi-bold">    2.5%  </span><span class="ansi-cyan-fg ansi-bold">   25.0%  </span><span class="ansi-cyan-fg ansi-bold">   50.0%  </span><span class="ansi-cyan-fg ansi-bold">   75.0%  </span><span class="ansi-cyan-fg ansi-bold">   97.5%
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64

          σ²    0.1280    0.4028    0.7323    1.2054    2.2762
           x   -2.0744   -0.3935    0.0094    0.3946    2.3200
</span></pre>
</div>
</div>
</div>
<p>Neat!</p>
<p>Similarly, which automatic differentiation backend one should use can be specified through the <code>adtype</code> keyword argument too. For example, if we want to use <a href="https://github.com/JuliaDiff/ReverseDiff.jl">ReverseDiff.jl</a> instead of the default <a href="https://github.com/JuliaDiff/ForwardDiff.jl">ForwardDiff.jl</a>:</p>
<div id="54" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">ReverseDiff</span>: ReverseDiff</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify that we want to use `AutoReverseDiff`.</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">demo</span>(),</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>, adtype<span class="op">=</span><span class="fu">AutoReverseDiff</span>()),</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>;</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 2.91 seconds
Compute duration  = 2.91 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters  </span><span class="ansi-bold">    mean  </span><span class="ansi-bold">     std  </span><span class="ansi-bold">    mcse  </span><span class="ansi-bold"> ess_bulk  </span><span class="ansi-bold"> ess_tail  </span><span class="ansi-bold">    rhat  </span><span class="ansi-bold"> e ⋯
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">  Float64  </span><span class="ansi-bright-black-fg ansi-bold">  Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">   ⋯

          σ²    0.8574    0.5716    0.0307   275.8385   158.4680    1.0002     ⋯
           x    0.0174    1.0788    0.0670   412.9702   242.4619    1.0026     ⋯
</span><span class="ansi-cyan-fg ansi-bold">                                                                1 column omitted

Quantiles
 </span><span class="ansi-cyan-fg ansi-bold"> parameters  </span><span class="ansi-cyan-fg ansi-bold">    2.5%  </span><span class="ansi-cyan-fg ansi-bold">   25.0%  </span><span class="ansi-cyan-fg ansi-bold">   50.0%  </span><span class="ansi-cyan-fg ansi-bold">   75.0%  </span><span class="ansi-cyan-fg ansi-bold">   97.5%
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64

          σ²    0.1269    0.3989    0.7321    1.2278    2.1811
           x   -2.2287   -0.3880    0.0155    0.4412    2.3840
</span></pre>
</div>
</div>
</div>
<p>Double-neat.</p>
</section>
</section>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<p>At this point it’s worth maybe reminding ourselves what we did and also <em>why</em> we did it:</p>
<ol type="1">
<li>We define our models in the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface because it makes the sampler agnostic to how the underlying model is implemented.</li>
<li>We implement our sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> interface, which just means that our sampler is a subtype of <code>AbstractMCMC.AbstractSampler</code> and we implement the MCMC transition in <code>AbstractMCMC.step</code>.</li>
<li>Points 1 and 2 makes it so our sampler can be used with a wide range of model implementations, amongst them being models implemented in both Turing.jl and Stan. This gives you, the inference implementer, a large collection of models to test your inference method on, in addition to allowing users of Turing.jl and Stan to try out your inference method with minimal effort.</li>
</ol>


</section>


<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a><div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>We’re going with the leapfrog formulation because in a future version of this tutorial we’ll add a section extending this simple “baseline” MALA sampler to more complex versions. See <a href="https://github.com/TuringLang/docs/issues/479">issue #479</a> for progress on this.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>There is no such thing as a proper interface in Julia (at least not officially), and so we use the word “interface” here to mean a few minimal methods that needs to be implemented by any type that we treat as a target model.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    // Ensure there is a toggle, if there isn't float one in the top right
    if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
      const a = window.document.createElement('a');
      a.classList.add('top-right');
      a.classList.add('quarto-color-scheme-toggle');
      a.href = "";
      a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
      const i = window.document.createElement("i");
      i.classList.add('bi');
      a.appendChild(i);
      window.document.body.appendChild(a);
    }
    setColorSchemeToggle(hasAlternateSentinel())
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/turinglang\.org\/docs\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../../developers/inference/variational-inference/index.html" class="pagination-link" aria-label="Variational Inference">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Variational Inference</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Turing is created by <a href="http://mlg.eng.cam.ac.uk/hong/" target="_blank">Hong Ge</a>, and lovingly maintained by the <a href="https://github.com/TuringLang/Turing.jl/graphs/contributors" target="_blank">core team</a> of volunteers. <br> The contents of this website are © 2024 under the terms of the <a href="https://github.com/TuringLang/Turing.jl/blob/main/LICENCE" target="_blank">MIT License</a>.</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/TuringLang/docs/edit/main/developers/inference/implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/docs/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://x.com/TuringLang">
      <i class="bi bi-twitter" role="img" aria-label="Turing Twitter">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/TuringLang/Turing.jl">
      <i class="bi bi-github" role="img" aria-label="Turing GitHub">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




<script src="../../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>