<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.3">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Implementing samplers – Turing.jl</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../tutorials/docs-07-for-developers-variational-inference/index.html" rel="prev">
<link href="../../assets/favicon.ico" rel="icon">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-81b5c3e63835cfde897ecd3d35a35a41.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark-c634bf5241e7a0f0add955421922332b.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-5870358ca908ec11c7112509c02a969e.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark-44ada009216185fff2c787be4097b66f.min.css" rel="prefetch" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<style>
  a {
    text-decoration: none;
  }
  a:hover {
    text-decoration: underline;
  }
</style>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../theming/styles.css">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="https://turinglang.org/" class="navbar-brand navbar-brand-logo">
    <img src="../../assets/images/turing-logo.svg" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="https://turinglang.org/">
    <span class="navbar-title">Turing.jl</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../tutorials/docs-00-getting-started/"> 
<span class="menu-text">Get Started</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../tutorials/00-introduction/"> 
<span class="menu-text">Tutorials</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/library/"> 
<span class="menu-text">Libraries</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/news/"> 
<span class="menu-text">News</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/team/"> 
<span class="menu-text">Team</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-v0.35" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">v0.35</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-v0.35">    
        <li>
    <a class="dropdown-item" href="https://turinglang.org/docs/changelog.html">
 <span class="dropdown-text">Changelog</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://turinglang.org/docs/versions.html">
 <span class="dropdown-text">All Versions</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools tools-wide">
    <a href="https://x.com/TuringLang" title="Turing Twitter" class="quarto-navigation-tool px-1" aria-label="Turing Twitter"><i class="bi bi-twitter"></i></a>
    <a href="https://github.com/TuringLang/Turing.jl" title="Turing GitHub" class="quarto-navigation-tool px-1" aria-label="Turing GitHub"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Developers</li><li class="breadcrumb-item"><a href="../../tutorials/docs-06-for-developers-interface/index.html">Inference (note: outdated)</a></li><li class="breadcrumb-item"><a href="../../tutorials/docs-17-implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false">
 <span class="menu-text">Users</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-00-getting-started/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Getting Started</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-12-using-turing-guide/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Core Functionality</span></a>
  </div>
</li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false">
 <span class="menu-text">Usage Tips</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-10-using-turing-autodiff/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Automatic Differentiation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/usage-custom-distribution/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Custom Distributions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/usage-probability-interface/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Querying Model Probabilities</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/usage-modifying-logprob/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Modifying the Log Probability</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/usage-generated-quantities/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Generated Quantities</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-17-mode-estimation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Mode Estimation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-13-using-turing-performance-tips/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Performance Tips</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-15-using-turing-sampler-viz/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Sampler Visualization</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-11-using-turing-dynamichmc/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using DynamicHMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-16-using-turing-external-samplers/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using External Samplers</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false">
 <span class="menu-text">Tutorials</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/00-introduction/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction: Coin Flipping</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/01-gaussian-mixture-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Mixture Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/02-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/03-bayesian-neural-network/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Neural Networks</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/04-hidden-markov-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Hidden Markov Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/05-linear-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Linear Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/06-infinite-mixture-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Infinite Mixture Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/07-poisson-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Poisson Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/08-multinomial-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Multinomial Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/09-variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/10-bayesian-differential-equations/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Differential Equations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/11-probabilistic-pca/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Probabilistic PCA</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/13-seasonal-time-series/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Time Series Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/15-gaussian-processes/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction to Gaussian Processes</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/12-gplvm/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Process Latent Variable Models</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Developers</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false">
 <span class="menu-text">Contributing</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-01-contributing-guide/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">How to Contribute</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="false">
 <span class="menu-text">DynamicPPL in Depth</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/dev-model-manual/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Manually Defining a Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-05-for-developers-compiler/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Turing Compiler Design</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/14-minituring/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation I: Compiler</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/16-contexts/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation II: Contexts</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true">
 <span class="menu-text">Inference (note: outdated)</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-06-for-developers-interface/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Interface Guide</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-04-for-developers-abstractmcmc-turing/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">How Turing implements AbstractMCMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-07-for-developers-variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-17-implementing-samplers/index.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Implementing Samplers</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of Contents</h2>
   
  <ul>
  <li><a href="#quick-overview-of-mala" id="toc-quick-overview-of-mala" class="nav-link active" data-scroll-target="#quick-overview-of-mala">Quick overview of MALA</a></li>
  <li><a href="#what-we-need-from-a-model-logdensityproblems.jl" id="toc-what-we-need-from-a-model-logdensityproblems.jl" class="nav-link" data-scroll-target="#what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: LogDensityProblems.jl</a></li>
  <li><a href="#implementing-mala-in-abstractmcmc.jl" id="toc-implementing-mala-in-abstractmcmc.jl" class="nav-link" data-scroll-target="#implementing-mala-in-abstractmcmc.jl">Implementing MALA in AbstractMCMC.jl</a></li>
  <li><a href="#using-our-sampler-with-turing.jl" id="toc-using-our-sampler-with-turing.jl" class="nav-link" data-scroll-target="#using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</a>
  <ul class="collapse">
  <li><a href="#models-with-constrained-parameters" id="toc-models-with-constrained-parameters" class="nav-link" data-scroll-target="#models-with-constrained-parameters">Models with constrained parameters</a></li>
  </ul></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/TuringLang/docs/edit/master/tutorials/docs-17-implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/docs/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Developers</li><li class="breadcrumb-item"><a href="../../tutorials/docs-06-for-developers-interface/index.html">Inference (note: outdated)</a></li><li class="breadcrumb-item"><a href="../../tutorials/docs-17-implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Implementing samplers</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>In this tutorial, we’ll go through step-by-step how to implement a “simple” sampler in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> in such a way that it can be easily applied to Turing.jl models.</p>
<p>In particular, we’re going to implement a version of <strong>Metropolis-adjusted Langevin (MALA)</strong>.</p>
<p>Note that we will implement this sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> framework, completely “ignoring” Turing.jl until the very end of the tutorial, at which point we’ll use a single line of code to make the resulting sampler available to Turing.jl. This is to really drive home the point that one can implement samplers in a way that is accessible to all of Turing.jl’s users without having to use Turing.jl yourself.</p>
<section id="quick-overview-of-mala" class="level2">
<h2 class="anchored" data-anchor-id="quick-overview-of-mala">Quick overview of MALA</h2>
<p>We can view MALA as a single step of the leapfrog intergrator with resampling of momentum <span class="math inline">\(p\)</span> at every step.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> To make that statement a bit more concrete, we first define the <em>extended</em> target <span class="math inline">\(\bar{\gamma}(x, p)\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\log \bar{\gamma}(x, p) \propto \log \gamma(x) + \log \gamma_{\mathcal{N}(0, M)}(p)
\end{equation*}\]</span></p>
<p>where <span class="math inline">\(\gamma_{\mathcal{N}(0, M)}\)</span> denotes the density for a zero-centered Gaussian with covariance matrix <span class="math inline">\(M\)</span>. We then consider targeting this joint distribution over both <span class="math inline">\(x\)</span> and <span class="math inline">\(p\)</span> as follows. First we define the map</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  L_{\epsilon}: \quad &amp; \mathbb{R}^d \times \mathbb{R}^d \to \mathbb{R}^d \times \mathbb{R}^d \\
  &amp; (x, p) \mapsto (\tilde{x}, \tilde{p}) := L_{\epsilon}(x, p)
\end{split}
\end{equation*}\]</span></p>
<p>as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p_{1 / 2} &amp;:= p + \frac{\epsilon}{2} \nabla \log \gamma(x) \\
  \tilde{x} &amp;:= x + \epsilon M^{-1} p_{1 /2 } \\
  p_1 &amp;:= p_{1 / 2} + \frac{\epsilon}{2} \nabla \log \gamma(\tilde{x}) \\
  \tilde{p} &amp;:= - p_1
\end{split}
\end{equation*}\]</span></p>
<p>This might be familiar for some readers as a single step of the Leapfrog integrator. We then define the MALA kernel as follows: given the current iterate <span class="math inline">\(x_i\)</span>, we sample the next iterate <span class="math inline">\(x_{i + 1}\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p &amp;\sim \mathcal{N}(0, M) \\
  (\tilde{x}, \tilde{p}) &amp;:= L_{\epsilon}(x_i, p) \\
  \alpha &amp;:= \min \left\{ 1, \frac{\bar{\gamma}(\tilde{x}, \tilde{p})}{\bar{\gamma}(x_i, p)} \right\} \\
  x_{i + 1} &amp;:=
  \begin{cases}
    \tilde{x} \quad &amp; \text{ with prob. } \alpha \\
    x_i       \quad &amp; \text{ with prob. } 1 - \alpha
  \end{cases}
\end{split}
\end{equation*}\]</span></p>
<p>i.e.&nbsp;we accept the proposal <span class="math inline">\(\tilde{x}\)</span> with probability <span class="math inline">\(\alpha\)</span> and reject it, thus sticking with our current iterate, with probability <span class="math inline">\(1 - \alpha\)</span>.</p>
</section>
<section id="what-we-need-from-a-model-logdensityproblems.jl" class="level2">
<h2 class="anchored" data-anchor-id="what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a></h2>
<p>There are a few things we need from the “target” / “model” / density that we want to sample from:</p>
<ol type="1">
<li>We need access to log-density <em>evaluations</em> <span class="math inline">\(\log \gamma(x)\)</span> so we can compute the acceptance ratio involving <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>We need access to log-density <em>gradients</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span> so we can compute the Leapfrog steps <span class="math inline">\(L_{\epsilon}(x, p)\)</span>.</li>
<li>We also need access to the “size” of the model so we can determine the size of <span class="math inline">\(M\)</span>.</li>
</ol>
<p>Luckily for us, there is a package called <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> which provides an interface for <em>exactly</em> this!</p>
<p>To demonstrate how one can implement the “<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface”<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> we will use a simple Gaussian model as an example:</p>
<div id="4" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblems</span>: LogDensityProblems;</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's define some type that represents the model.</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> IsotropicNormalModel{M<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"mean of the isotropic Gaussian"</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    mean<span class="op">::</span><span class="dt">M</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Specifies what input length the model expects.</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">dimension</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> <span class="fu">length</span>(model.mean)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Implementation of the log-density evaluation of the model.</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x<span class="op">::</span><span class="dt">AbstractVector{&lt;:Real}</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">-</span> <span class="fu">sum</span>(abs2, x <span class="op">.-</span> model.mean) <span class="op">/</span> <span class="fl">2</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This gives us all of the properties we want for our MALA sampler with the exception of the computation of the <em>gradient</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span>. There is the method <code>LogDensityProblems.logdensity_and_gradient</code> which should return a 2-tuple where the first entry is the evaluation of the logdensity <span class="math inline">\(\log \gamma(x)\)</span> and the second entry is the gradient <span class="math inline">\(\nabla \log \gamma(x)\)</span>.</p>
<p>There are two ways to “implement” this method: 1) we implement it by hand, which is feasible in the case of our <code>IsotropicNormalModel</code>, or b) we defer the implementation of this to a automatic differentiation backend.</p>
<p>To implement it by hand we can simply do</p>
<div id="6" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl that first-order, i.e. gradient information, is available.</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{1}</span>()</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Implement `logdensity_and_gradient`.</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    logγ_x <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="op">-</span>x <span class="op">.*</span> (x <span class="op">-</span> model.mean)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> logγ_x, ∇logγ_x</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s just try it out:</p>
<div id="8" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate the problem.</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> <span class="fu">IsotropicNormalModel</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.])</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create some example input that we can test on.</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>x_example <span class="op">=</span> <span class="fu">randn</span>(LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate!</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-27.401165736235036</code></pre>
</div>
</div>
<p>To defer it to an automatic differentiation backend, we can do</p>
<div id="10" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl we only have access to 0-th order information.</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{0}</span>()</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Use `LogDensityProblemsAD`'s `ADgradient` in combination with some AD backend to implement `logdensity_and_gradient`.</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblemsAD</span>, <span class="bu">ADTypes</span>, <span class="bu">ForwardDiff</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>model_with_grad <span class="op">=</span> <span class="fu">ADgradient</span>(<span class="fu">AutoForwardDiff</span>(), model)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model_with_grad, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-27.401165736235036</code></pre>
</div>
</div>
<p>We’ll continue with the second approach in this tutorial since this is typically what one does in practice, because there are better hobbies to spend time on than deriving gradients by hand.</p>
<p>At this point, one might wonder how we’re going to tie this back to Turing.jl in the end. Effectively, when working with inference methods that only require log-density evaluations and / or higher-order information of the log-density, Turing.jl actually converts the user-provided <code>Model</code> into an object implementing the above methods for <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>. As a result, most samplers provided by Turing.jl are actually implemented to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, enabling their use both <em>within</em> Turing.jl and <em>outside</em> of Turing.jl! Morever, there exists similar conversions for Stan through BridgeStan and Stan<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, which means that a sampler supporting the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface can easily be used on both Turing.jl <em>and</em> Stan models (in addition to user-provided models, as our <code>IsotropicNormalModel</code> above)!</p>
<p>Anyways, let’s move on to actually implementing the sampler.</p>
</section>
<section id="implementing-mala-in-abstractmcmc.jl" class="level2">
<h2 class="anchored" data-anchor-id="implementing-mala-in-abstractmcmc.jl">Implementing MALA in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a></h2>
<p>Now that we’ve established that a model implementing the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface provides us with all the information we need from <span class="math inline">\(\log \gamma(x)\)</span>, we can address the question: given an object that implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, how can we define a sampler for it?</p>
<p>We’re going to do this by making our sampler a sub-type of <code>AbstractMCMC.AbstractSampler</code> in addition to implementing a few methods from <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>. Why? Because it gets us <em>a lot</em> of functionality for free, as we will see later.</p>
<p>Moreover, <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> provides a very natural interface for MCMC algorithms.</p>
<p>First, we’ll define our <code>MALA</code> type</p>
<div id="12" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">AbstractMCMC</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALA{T,A} <span class="op">&lt;:</span><span class="dt"> AbstractMCMC.AbstractSampler</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"stepsize used in the leapfrog step"</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    ϵ_init<span class="op">::</span><span class="dt">T</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"covariance matrix used for the momentum"</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    M_init<span class="op">::</span><span class="dt">A</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notice how we’ve added the suffix <code>_init</code> to both the stepsize and the covariance matrix. We’ve done this because a <code>AbstractMCMC.AbstractSampler</code> should be <em>immutable</em>. Of course there might be many scenarios where we want to allow something like the stepsize and / or the covariance matrix to vary between iterations, e.g.&nbsp;during the burn-in / adaptation phase of the sampling process we might want to adjust the parameters using statistics computed from these initial iterations. But information which can change between iterations <em>should not go in the sampler itself</em>! Instead, this information should go in the sampler <em>state</em>.</p>
<p>The sampler state should at the very least contain all the necessary information to perform the next MCMC iteration, but usually contains further information, e.g.&nbsp;quantities and statistics useful for evaluating whether the sampler has converged.</p>
<p>We will use the following sampler state for our <code>MALA</code> sampler:</p>
<div id="14" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALAState{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This might seem overly redundant: we’re defining a type <code>MALAState</code> and it only contains a simple vector of reals. In this particular case we indeed could have dropped this and simply used a <code>AbstractVector{&lt;:Real}</code> as our sampler state, but typically, as we will see later, one wants to include other quantities in the sampler state. For example, if we also wanted to adapt the parameters of our <code>MALA</code>, e.g.&nbsp;alter the stepsize depending on acceptance rates, in which case we should also put <code>ϵ</code> in the state, but for now we’ll keep things simple.</p>
<p>Moreover, we also want a <em>sample</em> type, which is a type meant for “public consumption”, i.e.&nbsp;the end-user. This is generally going to contain a subset of the information present in the state. But in such a simple scenario as this, we similarly only have a <code>AbstractVector{&lt;:Real}</code>:</p>
<div id="16" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALASample{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We currently have three things:</p>
<ol type="1">
<li>A <code>AbstractMCMC.AbstractSampler</code> implementation called <code>MALA</code>.</li>
<li>A state <code>MALAState</code> for our sampler <code>MALA</code>.</li>
<li>A sample <code>MALASample</code> for our sampler <code>MALA</code>.</li>
</ol>
<p>That means that we’re ready to implement the only thing that really matters: <code>AbstractMCMC.step</code>.</p>
<p><code>AbstractMCMC.step</code> defines the MCMC iteration of our <code>MALA</code> given the current <code>MALAState</code>. Specifically, the signature of the function is as follows:</p>
<div id="18" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The RNG to ensure reproducibility.</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The model that defines our target.</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.AbstractModel</span>,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The sampler for which we're taking a `step`.</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">AbstractMCMC.AbstractSampler</span>,</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The current sampler `state`.</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    state;</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Additional keyword arguments that we may or may not need.</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Moreover, there is a specific <code>AbstractMCMC.AbstractModel</code> which is used to indicate that the model that is provided implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface: <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Since, as we discussed earlier, in our case we’re indeed going to work with types that support the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, we’ll define <code>AbstractMCMC.step</code> for such a <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Note that <code>AbstractMCMC.LogDensityModel</code> has no other purpose; it has a single field called <code>logdensity</code>, and it does nothing else. But by wrapping the model in <code>AbstractMCMC.LogDensityModel</code>, it allows samplers that want to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> to define their <code>AbstractMCMC.step</code> on this type without running into method ambiguities.</p>
<p>All in all, that means that the signature for our <code>AbstractMCMC.step</code> is going to be the following:</p>
<div id="20" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># `LogDensityModel` so we know we're working with LogDensityProblems.jl model.</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler.</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler state.</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Great! Now let’s actually implement the full <code>AbstractMCMC.step</code> for our <code>MALA</code>.</p>
<p>Let’s remind ourselves what we’re going to do:</p>
<ol type="1">
<li>Sample a new momentum <span class="math inline">\(p\)</span>.</li>
<li>Compute the log-density of the extended target <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>Take a single leapfrog step <span class="math inline">\((\tilde{x}, \tilde{p}) = L_{\epsilon}(x, p)\)</span>.</li>
<li>Accept or reject the proposed <span class="math inline">\((\tilde{x}, \tilde{p})\)</span>.</li>
</ol>
<p>All in all, this results in the following:</p>
<div id="22" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>: Random</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Distributions</span>  <span class="co"># so we get the `MvNormal`</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the wrapped model which implements LogDensityProblems.jl.</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just extract the sampler parameters to make our lives easier.</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    ϵ <span class="op">=</span> sampler.ϵ_init</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    M <span class="op">=</span> sampler.M_init</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the current parameters.</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> state.x</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sample the momentum.</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>    p_dist <span class="op">=</span> <span class="fu">MvNormal</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)), M)</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> <span class="fu">rand</span>(rng, p_dist)</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Propose using a single leapfrog step.</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>    x̃, p̃ <span class="op">=</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Accept or reject proposal.</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>    logp <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p)</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>    logp̃ <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x̃) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p̃)</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>    logα <span class="op">=</span> logp̃ <span class="op">-</span> logp</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>    state_new <span class="op">=</span> <span class="cf">if</span> <span class="fu">log</span>(<span class="fu">rand</span>(rng)) <span class="op">&lt;</span> logα</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Accept.</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x̃)</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Reject.</span></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x)</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return the "sample" and the sampler state.</span></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(state_new.x), state_new</span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Fairly straight-forward.</p>
<p>Of course, we haven’t defined the <code>leapfrog_step</code> method yet, so let’s do that:</p>
<div id="24" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p` using "position" `x`.</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x))</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    p1 <span class="op">=</span> p <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update the "position" `x` using momentum `p1`.</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    x̃ <span class="op">=</span> x <span class="op">+</span> ϵ <span class="op">.*</span> (M <span class="op">\</span> p1)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p1` using position `x̃`</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x̃ <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x̃))</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    p2 <span class="op">=</span> p1 <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x̃</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Flip momentum `p2`.</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    p̃ <span class="op">=</span> <span class="op">-</span>p2</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x̃, p̃</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>leapfrog_step (generic function with 1 method)</code></pre>
</div>
</div>
<p>With all of this, we’re technically ready to sample!</p>
<div id="26" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>, <span class="bu">LinearAlgebra</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>rng <span class="op">=</span> <span class="bu">Random</span>.<span class="fu">default_rng</span>()</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>sampler <span class="op">=</span> <span class="fu">MALA</span>(<span class="fl">1</span>, I)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>state <span class="op">=</span> <span class="fu">MALAState</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)))</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>x_next, state_next <span class="op">=</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    rng,</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    AbstractMCMC.<span class="fu">LogDensityModel</span>(model),</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    state</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>(MALASample{Vector{Float64}}([-1.8258409899205021, 0.574223469569364, -0.20754878380167976]), MALAState{Vector{Float64}}([-1.8258409899205021, 0.574223469569364, -0.20754878380167976]))</code></pre>
</div>
</div>
<p>Great, it works!</p>
<p>And I promised we would get quite some functionality for free if we implemented <code>AbstractMCMC.step</code>, and so we can now simply call <code>sample</code> to perform standard MCMC sampling:</p>
<div id="28" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform 1000 iterations with our `MALA` sampler.</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; initial_state<span class="op">=</span>state, progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Concatenate into a matrix.</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000 Matrix{Float64}:
 -2.50803  -4.19966  -2.85406  -4.85651  …  -4.5108    -3.92298   -4.50417
 -1.42692  -2.2159   -1.4121   -1.81365     -0.265354  -0.336367  -0.161187
  1.7224    3.77466   5.58993   5.20747      3.95856    3.78064    5.48159</code></pre>
</div>
</div>
<div id="30" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the marginal means and standard deviations.</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -4.99067     0.996633
  0.00150706  0.996612
  5.01006     0.997547</code></pre>
</div>
</div>
<p>Let’s visualize the samples</p>
<div id="32" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">StatsPlots</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">transpose</span>(samples_matrix[<span class="op">:</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">:</span><span class="kw">end</span>]), alpha<span class="op">=</span><span class="fl">0.5</span>, legend<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<!--?xml version="1.0" encoding="utf-8"?-->
<svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" width="672" height="480" viewbox="0 0 2688 1920">
<defs>
  <clippath id="clip560">
    <rect x="0" y="0" width="2688" height="1920"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip560)" d="M0 1920 L2688 1920 L2688 0 L0 0  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip561">
    <rect x="537" y="0" width="1883" height="1883"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip560)" d="M196.816 1800.78 L2640.76 1800.78 L2640.76 47.2441 L196.816 47.2441  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip562">
    <rect x="196" y="47" width="2445" height="1755"></rect>
  </clippath>
</defs>
<polyline clip-path="url(#clip562)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="263.676,1800.78 263.676,47.2441 "></polyline>
<polyline clip-path="url(#clip562)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="840.654,1800.78 840.654,47.2441 "></polyline>
<polyline clip-path="url(#clip562)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1417.63,1800.78 1417.63,47.2441 "></polyline>
<polyline clip-path="url(#clip562)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1994.61,1800.78 1994.61,47.2441 "></polyline>
<polyline clip-path="url(#clip562)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="2571.59,1800.78 2571.59,47.2441 "></polyline>
<polyline clip-path="url(#clip562)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,1589.09 2640.76,1589.09 "></polyline>
<polyline clip-path="url(#clip562)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,1349.66 2640.76,1349.66 "></polyline>
<polyline clip-path="url(#clip562)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,1110.24 2640.76,1110.24 "></polyline>
<polyline clip-path="url(#clip562)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,870.811 2640.76,870.811 "></polyline>
<polyline clip-path="url(#clip562)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,631.385 2640.76,631.385 "></polyline>
<polyline clip-path="url(#clip562)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,391.96 2640.76,391.96 "></polyline>
<polyline clip-path="url(#clip562)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,152.535 2640.76,152.535 "></polyline>
<polyline clip-path="url(#clip560)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1800.78 2640.76,1800.78 "></polyline>
<polyline clip-path="url(#clip560)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="263.676,1800.78 263.676,1781.88 "></polyline>
<polyline clip-path="url(#clip560)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="840.654,1800.78 840.654,1781.88 "></polyline>
<polyline clip-path="url(#clip560)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1417.63,1800.78 1417.63,1781.88 "></polyline>
<polyline clip-path="url(#clip560)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1994.61,1800.78 1994.61,1781.88 "></polyline>
<polyline clip-path="url(#clip560)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="2571.59,1800.78 2571.59,1781.88 "></polyline>
<path clip-path="url(#clip560)" d="M263.676 1834 Q260.065 1834 258.236 1837.57 Q256.431 1841.11 256.431 1848.24 Q256.431 1855.34 258.236 1858.91 Q260.065 1862.45 263.676 1862.45 Q267.31 1862.45 269.116 1858.91 Q270.945 1855.34 270.945 1848.24 Q270.945 1841.11 269.116 1837.57 Q267.31 1834 263.676 1834 M263.676 1830.3 Q269.486 1830.3 272.542 1834.9 Q275.621 1839.49 275.621 1848.24 Q275.621 1856.96 272.542 1861.57 Q269.486 1866.15 263.676 1866.15 Q257.866 1866.15 254.787 1861.57 Q251.732 1856.96 251.732 1848.24 Q251.732 1839.49 254.787 1834.9 Q257.866 1830.3 263.676 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip560)" d="M804.346 1861.55 L820.666 1861.55 L820.666 1865.48 L798.721 1865.48 L798.721 1861.55 Q801.383 1858.79 805.967 1854.16 Q810.573 1849.51 811.754 1848.17 Q813.999 1845.65 814.879 1843.91 Q815.782 1842.15 815.782 1840.46 Q815.782 1837.71 813.837 1835.97 Q811.916 1834.23 808.814 1834.23 Q806.615 1834.23 804.161 1835 Q801.731 1835.76 798.953 1837.31 L798.953 1832.59 Q801.777 1831.46 804.231 1830.88 Q806.684 1830.3 808.721 1830.3 Q814.092 1830.3 817.286 1832.98 Q820.481 1835.67 820.481 1840.16 Q820.481 1842.29 819.67 1844.21 Q818.883 1846.11 816.777 1848.7 Q816.198 1849.37 813.096 1852.59 Q809.995 1855.78 804.346 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip560)" d="M830.527 1830.92 L848.883 1830.92 L848.883 1834.86 L834.809 1834.86 L834.809 1843.33 Q835.828 1842.98 836.846 1842.82 Q837.865 1842.64 838.883 1842.64 Q844.67 1842.64 848.05 1845.81 Q851.43 1848.98 851.43 1854.4 Q851.43 1859.97 847.957 1863.08 Q844.485 1866.15 838.166 1866.15 Q835.99 1866.15 833.721 1865.78 Q831.476 1865.41 829.069 1864.67 L829.069 1859.97 Q831.152 1861.11 833.374 1861.66 Q835.596 1862.22 838.073 1862.22 Q842.078 1862.22 844.416 1860.11 Q846.754 1858.01 846.754 1854.4 Q846.754 1850.78 844.416 1848.68 Q842.078 1846.57 838.073 1846.57 Q836.198 1846.57 834.323 1846.99 Q832.471 1847.4 830.527 1848.28 L830.527 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip560)" d="M870.642 1834 Q867.031 1834 865.203 1837.57 Q863.397 1841.11 863.397 1848.24 Q863.397 1855.34 865.203 1858.91 Q867.031 1862.45 870.642 1862.45 Q874.277 1862.45 876.082 1858.91 Q877.911 1855.34 877.911 1848.24 Q877.911 1841.11 876.082 1837.57 Q874.277 1834 870.642 1834 M870.642 1830.3 Q876.453 1830.3 879.508 1834.9 Q882.587 1839.49 882.587 1848.24 Q882.587 1856.96 879.508 1861.57 Q876.453 1866.15 870.642 1866.15 Q864.832 1866.15 861.754 1861.57 Q858.698 1856.96 858.698 1848.24 Q858.698 1839.49 861.754 1834.9 Q864.832 1830.3 870.642 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip560)" d="M1377.25 1830.92 L1395.61 1830.92 L1395.61 1834.86 L1381.53 1834.86 L1381.53 1843.33 Q1382.55 1842.98 1383.57 1842.82 Q1384.59 1842.64 1385.61 1842.64 Q1391.39 1842.64 1394.77 1845.81 Q1398.15 1848.98 1398.15 1854.4 Q1398.15 1859.97 1394.68 1863.08 Q1391.21 1866.15 1384.89 1866.15 Q1382.71 1866.15 1380.44 1865.78 Q1378.2 1865.41 1375.79 1864.67 L1375.79 1859.97 Q1377.88 1861.11 1380.1 1861.66 Q1382.32 1862.22 1384.8 1862.22 Q1388.8 1862.22 1391.14 1860.11 Q1393.48 1858.01 1393.48 1854.4 Q1393.48 1850.78 1391.14 1848.68 Q1388.8 1846.57 1384.8 1846.57 Q1382.92 1846.57 1381.05 1846.99 Q1379.19 1847.4 1377.25 1848.28 L1377.25 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip560)" d="M1417.37 1834 Q1413.75 1834 1411.93 1837.57 Q1410.12 1841.11 1410.12 1848.24 Q1410.12 1855.34 1411.93 1858.91 Q1413.75 1862.45 1417.37 1862.45 Q1421 1862.45 1422.81 1858.91 Q1424.63 1855.34 1424.63 1848.24 Q1424.63 1841.11 1422.81 1837.57 Q1421 1834 1417.37 1834 M1417.37 1830.3 Q1423.18 1830.3 1426.23 1834.9 Q1429.31 1839.49 1429.31 1848.24 Q1429.31 1856.96 1426.23 1861.57 Q1423.18 1866.15 1417.37 1866.15 Q1411.56 1866.15 1408.48 1861.57 Q1405.42 1856.96 1405.42 1848.24 Q1405.42 1839.49 1408.48 1834.9 Q1411.56 1830.3 1417.37 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip560)" d="M1447.53 1834 Q1443.92 1834 1442.09 1837.57 Q1440.28 1841.11 1440.28 1848.24 Q1440.28 1855.34 1442.09 1858.91 Q1443.92 1862.45 1447.53 1862.45 Q1451.16 1862.45 1452.97 1858.91 Q1454.8 1855.34 1454.8 1848.24 Q1454.8 1841.11 1452.97 1837.57 Q1451.16 1834 1447.53 1834 M1447.53 1830.3 Q1453.34 1830.3 1456.39 1834.9 Q1459.47 1839.49 1459.47 1848.24 Q1459.47 1856.96 1456.39 1861.57 Q1453.34 1866.15 1447.53 1866.15 Q1441.72 1866.15 1438.64 1861.57 Q1435.58 1856.96 1435.58 1848.24 Q1435.58 1839.49 1438.64 1834.9 Q1441.72 1830.3 1447.53 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip560)" d="M1952.89 1830.92 L1975.11 1830.92 L1975.11 1832.91 L1962.56 1865.48 L1957.68 1865.48 L1969.48 1834.86 L1952.89 1834.86 L1952.89 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip560)" d="M1984.27 1830.92 L2002.63 1830.92 L2002.63 1834.86 L1988.56 1834.86 L1988.56 1843.33 Q1989.58 1842.98 1990.59 1842.82 Q1991.61 1842.64 1992.63 1842.64 Q1998.42 1842.64 2001.8 1845.81 Q2005.18 1848.98 2005.18 1854.4 Q2005.18 1859.97 2001.7 1863.08 Q1998.23 1866.15 1991.91 1866.15 Q1989.74 1866.15 1987.47 1865.78 Q1985.22 1865.41 1982.82 1864.67 L1982.82 1859.97 Q1984.9 1861.11 1987.12 1861.66 Q1989.34 1862.22 1991.82 1862.22 Q1995.83 1862.22 1998.16 1860.11 Q2000.5 1858.01 2000.5 1854.4 Q2000.5 1850.78 1998.16 1848.68 Q1995.83 1846.57 1991.82 1846.57 Q1989.95 1846.57 1988.07 1846.99 Q1986.22 1847.4 1984.27 1848.28 L1984.27 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip560)" d="M2024.39 1834 Q2020.78 1834 2018.95 1837.57 Q2017.14 1841.11 2017.14 1848.24 Q2017.14 1855.34 2018.95 1858.91 Q2020.78 1862.45 2024.39 1862.45 Q2028.02 1862.45 2029.83 1858.91 Q2031.66 1855.34 2031.66 1848.24 Q2031.66 1841.11 2029.83 1837.57 Q2028.02 1834 2024.39 1834 M2024.39 1830.3 Q2030.2 1830.3 2033.26 1834.9 Q2036.33 1839.49 2036.33 1848.24 Q2036.33 1856.96 2033.26 1861.57 Q2030.2 1866.15 2024.39 1866.15 Q2018.58 1866.15 2015.5 1861.57 Q2012.45 1856.96 2012.45 1848.24 Q2012.45 1839.49 2015.5 1834.9 Q2018.58 1830.3 2024.39 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip560)" d="M2516.11 1861.55 L2523.75 1861.55 L2523.75 1835.18 L2515.44 1836.85 L2515.44 1832.59 L2523.71 1830.92 L2528.38 1830.92 L2528.38 1861.55 L2536.02 1861.55 L2536.02 1865.48 L2516.11 1865.48 L2516.11 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip560)" d="M2555.47 1834 Q2551.85 1834 2550.03 1837.57 Q2548.22 1841.11 2548.22 1848.24 Q2548.22 1855.34 2550.03 1858.91 Q2551.85 1862.45 2555.47 1862.45 Q2559.1 1862.45 2560.9 1858.91 Q2562.73 1855.34 2562.73 1848.24 Q2562.73 1841.11 2560.9 1837.57 Q2559.1 1834 2555.47 1834 M2555.47 1830.3 Q2561.28 1830.3 2564.33 1834.9 Q2567.41 1839.49 2567.41 1848.24 Q2567.41 1856.96 2564.33 1861.57 Q2561.28 1866.15 2555.47 1866.15 Q2549.66 1866.15 2546.58 1861.57 Q2543.52 1856.96 2543.52 1848.24 Q2543.52 1839.49 2546.58 1834.9 Q2549.66 1830.3 2555.47 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip560)" d="M2585.63 1834 Q2582.02 1834 2580.19 1837.57 Q2578.38 1841.11 2578.38 1848.24 Q2578.38 1855.34 2580.19 1858.91 Q2582.02 1862.45 2585.63 1862.45 Q2589.26 1862.45 2591.07 1858.91 Q2592.9 1855.34 2592.9 1848.24 Q2592.9 1841.11 2591.07 1837.57 Q2589.26 1834 2585.63 1834 M2585.63 1830.3 Q2591.44 1830.3 2594.49 1834.9 Q2597.57 1839.49 2597.57 1848.24 Q2597.57 1856.96 2594.49 1861.57 Q2591.44 1866.15 2585.63 1866.15 Q2579.82 1866.15 2576.74 1861.57 Q2573.68 1856.96 2573.68 1848.24 Q2573.68 1839.49 2576.74 1834.9 Q2579.82 1830.3 2585.63 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip560)" d="M2615.79 1834 Q2612.18 1834 2610.35 1837.57 Q2608.54 1841.11 2608.54 1848.24 Q2608.54 1855.34 2610.35 1858.91 Q2612.18 1862.45 2615.79 1862.45 Q2619.42 1862.45 2621.23 1858.91 Q2623.06 1855.34 2623.06 1848.24 Q2623.06 1841.11 2621.23 1837.57 Q2619.42 1834 2615.79 1834 M2615.79 1830.3 Q2621.6 1830.3 2624.65 1834.9 Q2627.73 1839.49 2627.73 1848.24 Q2627.73 1856.96 2624.65 1861.57 Q2621.6 1866.15 2615.79 1866.15 Q2609.98 1866.15 2606.9 1861.57 Q2603.84 1856.96 2603.84 1848.24 Q2603.84 1839.49 2606.9 1834.9 Q2609.98 1830.3 2615.79 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip560)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1800.78 196.816,47.2441 "></polyline>
<polyline clip-path="url(#clip560)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1589.09 215.714,1589.09 "></polyline>
<polyline clip-path="url(#clip560)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1349.66 215.714,1349.66 "></polyline>
<polyline clip-path="url(#clip560)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1110.24 215.714,1110.24 "></polyline>
<polyline clip-path="url(#clip560)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,870.811 215.714,870.811 "></polyline>
<polyline clip-path="url(#clip560)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,631.385 215.714,631.385 "></polyline>
<polyline clip-path="url(#clip560)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,391.96 215.714,391.96 "></polyline>
<polyline clip-path="url(#clip560)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,152.535 215.714,152.535 "></polyline>
<path clip-path="url(#clip560)" d="M50.5475 1589.54 L80.2233 1589.54 L80.2233 1593.47 L50.5475 1593.47 L50.5475 1589.54 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip560)" d="M89.1352 1571.81 L111.357 1571.81 L111.357 1573.8 L98.8111 1606.37 L93.9269 1606.37 L105.732 1575.74 L89.1352 1575.74 L89.1352 1571.81 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip560)" d="M120.478 1600.49 L125.362 1600.49 L125.362 1606.37 L120.478 1606.37 L120.478 1600.49 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip560)" d="M135.593 1571.81 L153.95 1571.81 L153.95 1575.74 L139.876 1575.74 L139.876 1584.21 Q140.894 1583.87 141.913 1583.7 Q142.931 1583.52 143.95 1583.52 Q149.737 1583.52 153.116 1586.69 Q156.496 1589.86 156.496 1595.28 Q156.496 1600.86 153.024 1603.96 Q149.552 1607.04 143.232 1607.04 Q141.056 1607.04 138.788 1606.67 Q136.542 1606.3 134.135 1605.56 L134.135 1600.86 Q136.218 1601.99 138.441 1602.55 Q140.663 1603.1 143.14 1603.1 Q147.144 1603.1 149.482 1601 Q151.82 1598.89 151.82 1595.28 Q151.82 1591.67 149.482 1589.56 Q147.144 1587.45 143.14 1587.45 Q141.265 1587.45 139.39 1587.87 Q137.538 1588.29 135.593 1589.17 L135.593 1571.81 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip560)" d="M49.5521 1350.11 L79.2279 1350.11 L79.2279 1354.05 L49.5521 1354.05 L49.5521 1350.11 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip560)" d="M89.3667 1332.38 L107.723 1332.38 L107.723 1336.32 L93.6491 1336.32 L93.6491 1344.79 Q94.6676 1344.44 95.6861 1344.28 Q96.7047 1344.09 97.7232 1344.09 Q103.51 1344.09 106.89 1347.27 Q110.269 1350.44 110.269 1355.85 Q110.269 1361.43 106.797 1364.53 Q103.325 1367.61 97.0056 1367.61 Q94.8297 1367.61 92.5612 1367.24 Q90.3158 1366.87 87.9084 1366.13 L87.9084 1361.43 Q89.9917 1362.57 92.2139 1363.12 Q94.4361 1363.68 96.913 1363.68 Q100.918 1363.68 103.256 1361.57 Q105.593 1359.46 105.593 1355.85 Q105.593 1352.24 103.256 1350.14 Q100.918 1348.03 96.913 1348.03 Q95.038 1348.03 93.163 1348.45 Q91.3112 1348.86 89.3667 1349.74 L89.3667 1332.38 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip560)" d="M119.482 1361.06 L124.367 1361.06 L124.367 1366.94 L119.482 1366.94 L119.482 1361.06 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip560)" d="M144.552 1335.46 Q140.941 1335.46 139.112 1339.02 Q137.306 1342.57 137.306 1349.7 Q137.306 1356.8 139.112 1360.37 Q140.941 1363.91 144.552 1363.91 Q148.186 1363.91 149.991 1360.37 Q151.82 1356.8 151.82 1349.7 Q151.82 1342.57 149.991 1339.02 Q148.186 1335.46 144.552 1335.46 M144.552 1331.76 Q150.362 1331.76 153.417 1336.36 Q156.496 1340.95 156.496 1349.7 Q156.496 1358.42 153.417 1363.03 Q150.362 1367.61 144.552 1367.61 Q138.741 1367.61 135.663 1363.03 Q132.607 1358.42 132.607 1349.7 Q132.607 1340.95 135.663 1336.36 Q138.741 1331.76 144.552 1331.76 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip560)" d="M50.5475 1110.69 L80.2233 1110.69 L80.2233 1114.62 L50.5475 1114.62 L50.5475 1110.69 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip560)" d="M94.3436 1123.58 L110.663 1123.58 L110.663 1127.52 L88.7186 1127.52 L88.7186 1123.58 Q91.3806 1120.83 95.9639 1116.2 Q100.57 1111.54 101.751 1110.2 Q103.996 1107.68 104.876 1105.94 Q105.779 1104.18 105.779 1102.49 Q105.779 1099.74 103.834 1098 Q101.913 1096.27 98.8111 1096.27 Q96.6121 1096.27 94.1584 1097.03 Q91.7278 1097.79 88.9501 1099.34 L88.9501 1094.62 Q91.7741 1093.49 94.2278 1092.91 Q96.6815 1092.33 98.7185 1092.33 Q104.089 1092.33 107.283 1095.02 Q110.478 1097.7 110.478 1102.19 Q110.478 1104.32 109.668 1106.24 Q108.881 1108.14 106.774 1110.73 Q106.195 1111.41 103.094 1114.62 Q99.9917 1117.82 94.3436 1123.58 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip560)" d="M120.478 1121.64 L125.362 1121.64 L125.362 1127.52 L120.478 1127.52 L120.478 1121.64 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip560)" d="M135.593 1092.96 L153.95 1092.96 L153.95 1096.89 L139.876 1096.89 L139.876 1105.36 Q140.894 1105.02 141.913 1104.85 Q142.931 1104.67 143.95 1104.67 Q149.737 1104.67 153.116 1107.84 Q156.496 1111.01 156.496 1116.43 Q156.496 1122.01 153.024 1125.11 Q149.552 1128.19 143.232 1128.19 Q141.056 1128.19 138.788 1127.82 Q136.542 1127.45 134.135 1126.71 L134.135 1122.01 Q136.218 1123.14 138.441 1123.7 Q140.663 1124.25 143.14 1124.25 Q147.144 1124.25 149.482 1122.15 Q151.82 1120.04 151.82 1116.43 Q151.82 1112.82 149.482 1110.71 Q147.144 1108.6 143.14 1108.6 Q141.265 1108.6 139.39 1109.02 Q137.538 1109.44 135.593 1110.32 L135.593 1092.96 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip560)" d="M99.3204 856.609 Q95.7093 856.609 93.8806 860.174 Q92.075 863.716 92.075 870.845 Q92.075 877.952 93.8806 881.517 Q95.7093 885.058 99.3204 885.058 Q102.955 885.058 104.76 881.517 Q106.589 877.952 106.589 870.845 Q106.589 863.716 104.76 860.174 Q102.955 856.609 99.3204 856.609 M99.3204 852.906 Q105.131 852.906 108.186 857.512 Q111.265 862.096 111.265 870.845 Q111.265 879.572 108.186 884.179 Q105.131 888.762 99.3204 888.762 Q93.5102 888.762 90.4315 884.179 Q87.376 879.572 87.376 870.845 Q87.376 862.096 90.4315 857.512 Q93.5102 852.906 99.3204 852.906 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip560)" d="M119.482 882.211 L124.367 882.211 L124.367 888.091 L119.482 888.091 L119.482 882.211 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip560)" d="M144.552 856.609 Q140.941 856.609 139.112 860.174 Q137.306 863.716 137.306 870.845 Q137.306 877.952 139.112 881.517 Q140.941 885.058 144.552 885.058 Q148.186 885.058 149.991 881.517 Q151.82 877.952 151.82 870.845 Q151.82 863.716 149.991 860.174 Q148.186 856.609 144.552 856.609 M144.552 852.906 Q150.362 852.906 153.417 857.512 Q156.496 862.096 156.496 870.845 Q156.496 879.572 153.417 884.179 Q150.362 888.762 144.552 888.762 Q138.741 888.762 135.663 884.179 Q132.607 879.572 132.607 870.845 Q132.607 862.096 135.663 857.512 Q138.741 852.906 144.552 852.906 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip560)" d="M94.3436 644.73 L110.663 644.73 L110.663 648.665 L88.7186 648.665 L88.7186 644.73 Q91.3806 641.976 95.9639 637.346 Q100.57 632.693 101.751 631.351 Q103.996 628.828 104.876 627.091 Q105.779 625.332 105.779 623.642 Q105.779 620.888 103.834 619.152 Q101.913 617.416 98.8111 617.416 Q96.6121 617.416 94.1584 618.179 Q91.7278 618.943 88.9501 620.494 L88.9501 615.772 Q91.7741 614.638 94.2278 614.059 Q96.6815 613.48 98.7185 613.48 Q104.089 613.48 107.283 616.166 Q110.478 618.851 110.478 623.341 Q110.478 625.471 109.668 627.392 Q108.881 629.291 106.774 631.883 Q106.195 632.554 103.094 635.772 Q99.9917 638.966 94.3436 644.73 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip560)" d="M120.478 642.786 L125.362 642.786 L125.362 648.665 L120.478 648.665 L120.478 642.786 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip560)" d="M135.593 614.105 L153.95 614.105 L153.95 618.041 L139.876 618.041 L139.876 626.513 Q140.894 626.166 141.913 626.003 Q142.931 625.818 143.95 625.818 Q149.737 625.818 153.116 628.99 Q156.496 632.161 156.496 637.578 Q156.496 643.156 153.024 646.258 Q149.552 649.337 143.232 649.337 Q141.056 649.337 138.788 648.966 Q136.542 648.596 134.135 647.855 L134.135 643.156 Q136.218 644.29 138.441 644.846 Q140.663 645.402 143.14 645.402 Q147.144 645.402 149.482 643.295 Q151.82 641.189 151.82 637.578 Q151.82 633.966 149.482 631.86 Q147.144 629.753 143.14 629.753 Q141.265 629.753 139.39 630.17 Q137.538 630.587 135.593 631.466 L135.593 614.105 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip560)" d="M89.3667 374.68 L107.723 374.68 L107.723 378.615 L93.6491 378.615 L93.6491 387.087 Q94.6676 386.74 95.6861 386.578 Q96.7047 386.393 97.7232 386.393 Q103.51 386.393 106.89 389.564 Q110.269 392.736 110.269 398.152 Q110.269 403.731 106.797 406.833 Q103.325 409.911 97.0056 409.911 Q94.8297 409.911 92.5612 409.541 Q90.3158 409.171 87.9084 408.43 L87.9084 403.731 Q89.9917 404.865 92.2139 405.421 Q94.4361 405.976 96.913 405.976 Q100.918 405.976 103.256 403.87 Q105.593 401.763 105.593 398.152 Q105.593 394.541 103.256 392.435 Q100.918 390.328 96.913 390.328 Q95.038 390.328 93.163 390.745 Q91.3112 391.161 89.3667 392.041 L89.3667 374.68 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip560)" d="M119.482 403.36 L124.367 403.36 L124.367 409.24 L119.482 409.24 L119.482 403.36 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip560)" d="M144.552 377.759 Q140.941 377.759 139.112 381.324 Q137.306 384.865 137.306 391.995 Q137.306 399.101 139.112 402.666 Q140.941 406.208 144.552 406.208 Q148.186 406.208 149.991 402.666 Q151.82 399.101 151.82 391.995 Q151.82 384.865 149.991 381.324 Q148.186 377.759 144.552 377.759 M144.552 374.055 Q150.362 374.055 153.417 378.662 Q156.496 383.245 156.496 391.995 Q156.496 400.722 153.417 405.328 Q150.362 409.911 144.552 409.911 Q138.741 409.911 135.663 405.328 Q132.607 400.722 132.607 391.995 Q132.607 383.245 135.663 378.662 Q138.741 374.055 144.552 374.055 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip560)" d="M89.1352 135.255 L111.357 135.255 L111.357 137.245 L98.8111 169.815 L93.9269 169.815 L105.732 139.19 L89.1352 139.19 L89.1352 135.255 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip560)" d="M120.478 163.935 L125.362 163.935 L125.362 169.815 L120.478 169.815 L120.478 163.935 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip560)" d="M135.593 135.255 L153.95 135.255 L153.95 139.19 L139.876 139.19 L139.876 147.662 Q140.894 147.315 141.913 147.153 Q142.931 146.968 143.95 146.968 Q149.737 146.968 153.116 150.139 Q156.496 153.31 156.496 158.727 Q156.496 164.305 153.024 167.407 Q149.552 170.486 143.232 170.486 Q141.056 170.486 138.788 170.116 Q136.542 169.745 134.135 169.005 L134.135 164.305 Q136.218 165.44 138.441 165.995 Q140.663 166.551 143.14 166.551 Q147.144 166.551 149.482 164.444 Q151.82 162.338 151.82 158.727 Q151.82 155.116 149.482 153.009 Q147.144 150.903 143.14 150.903 Q141.265 150.903 139.39 151.319 Q137.538 151.736 135.593 152.616 L135.593 135.255 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip562)" style="stroke:#009af9; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="265.984,1111 268.292,1389.01 270.6,1471.28 272.908,1372.72 275.216,1332.61 277.524,1193.51 279.832,1366.98 282.139,1360.89 284.447,1341.65 286.755,1244.21 289.063,1467.2 291.371,1394.86 293.679,1345.69 295.987,1460.93 298.295,1441.19 300.603,1205.25 302.911,1349.18 305.219,1280.77 307.527,1301.94 309.834,1372.78 312.142,1247.23 314.45,1342.74 316.758,1324.53 319.066,1167.35 321.374,1417.32 323.682,1467.77 325.99,1447.07 328.298,1358.3 330.606,1315.93 332.914,1474.38 335.221,1407.16 337.529,1236.01 339.837,1447.68 342.145,1446.88 344.453,1216.63 346.761,1391.67 349.069,1165.49 351.377,1414.87 353.685,1475.58 355.993,1536.4 358.301,1373.55 360.608,1287.45 362.916,1348.57 365.224,1486.38 367.532,1326.88 369.84,1347.51 372.148,1373.33 374.456,1409.54 376.764,1511.42 379.072,1384.17 381.38,1406.54 383.688,1340.01 385.996,1271.86 388.303,1207.62 390.611,1392.42 392.919,1423.55 395.227,1390.54 397.535,1396.56 399.843,1289.18 402.151,1437.38 404.459,1204.91 406.767,1451.66 409.075,1331.98 411.383,1474.06 413.69,1390.79 415.998,1278.51 418.306,1398.9 420.614,1211.71 422.922,1505.05 425.23,1374.85 427.538,1234.11 429.846,1290.39 432.154,1254.85 434.462,1359.61 436.77,1530.82 439.077,1195.31 441.385,1331.45 443.693,1380.99 446.001,1371.18 448.309,1400.68 450.617,1226.94 452.925,1326.17 455.233,1298.4 457.541,1434.02 459.849,1409.07 462.157,1283.84 464.465,1487.05 466.772,1440.72 469.08,1363.64 471.388,1469.11 473.696,1397.55 476.004,1351.58 478.312,1401.16 480.62,1348.16 482.928,1450.39 485.236,1353.48 487.544,1436.46 489.852,1132.92 492.159,1403.12 494.467,1341.66 496.775,1359.8 499.083,1455.29 501.391,1365.63 503.699,1320.7 506.007,1293.65 508.315,1480.02 510.623,1159.84 512.931,1431.17 515.239,1456.13 517.546,1352.27 519.854,1271.09 522.162,1393.31 524.47,1421.69 526.778,1289.56 529.086,1361.36 531.394,1429.71 533.702,1162 536.01,1313.13 538.318,1413.42 540.626,1354.12 542.933,1413.57 545.241,1184.8 547.549,1306.95 549.857,1526.94 552.165,1427.96 554.473,1287.59 556.781,1394.06 559.089,1389.63 561.397,1262.66 563.705,1259.63 566.013,1250.83 568.321,1343.37 570.628,1311.98 572.936,1109.14 575.244,1518.23 577.552,1443.13 579.86,1180.63 582.168,1389.99 584.476,1450.32 586.784,1453.6 589.092,1294.97 591.4,1472.41 593.708,1212.44 596.015,1384.52 598.323,1288.61 600.631,1299.3 602.939,1454.51 605.247,1384.28 607.555,1481.73 609.863,1321.77 612.171,1406.53 614.479,1294.79 616.787,1278.17 619.095,1320.83 621.402,1552.86 623.71,1337.9 626.018,1305.49 628.326,1242.81 630.634,1419.17 632.942,1382.2 635.25,1426.14 637.558,1289.61 639.866,1271.38 642.174,1346.97 644.482,1358.94 646.79,1298.26 649.097,1248.7 651.405,1313.36 653.713,1360.21 656.021,1274.69 658.329,1342.51 660.637,1317.34 662.945,1392.12 665.253,1401.1 667.561,1278.29 669.869,1473.13 672.177,1121.58 674.484,1507.19 676.792,1234.28 679.1,1209.48 681.408,1492.53 683.716,1341.81 686.024,1168.42 688.332,1416.56 690.64,1313.98 692.948,1610.2 695.256,1364.03 697.564,1372.01 699.871,1155.81 702.179,1292.28 704.487,1284.87 706.795,1489.49 709.103,1319.14 711.411,1323.42 713.719,1181.14 716.027,1556.35 718.335,1389.71 720.643,1279.66 722.951,1298.94 725.259,1190.41 727.566,1274.83 729.874,1370.48 732.182,1465.69 734.49,1275.65 736.798,1350.71 739.106,1239.7 741.414,1308.33 743.722,1443.34 746.03,1284.26 748.338,1377.93 750.646,1448.89 752.953,1317.53 755.261,1341.3 757.569,1338.77 759.877,1420.63 762.185,1452.45 764.493,1421.68 766.801,1415.43 769.109,1416.25 771.417,1268.65 773.725,1317.95 776.033,1303.96 778.34,1204.57 780.648,1598.79 782.956,1490.89 785.264,1311.56 787.572,1354.74 789.88,1334.3 792.188,1253.68 794.496,1222.77 796.804,1395.86 799.112,1328.37 801.42,1251.52 803.728,1533.27 806.035,1365.64 808.343,1403.35 810.651,1285.51 812.959,1339.46 815.267,1149.11 817.575,1383.2 819.883,1376.97 822.191,1316.94 824.499,1286.63 826.807,1367.94 829.115,1349.46 831.422,1552.16 833.73,1316.15 836.038,1284.15 838.346,1417.3 840.654,1326.84 842.962,1297.95 845.27,1235.64 847.578,1404.54 849.886,1383.21 852.194,1463.75 854.502,1339.3 856.809,1307.86 859.117,1392.51 861.425,1280.09 863.733,1337.62 866.041,1323.51 868.349,1532.59 870.657,1359.44 872.965,1434.81 875.273,1427.94 877.581,1527.07 879.889,1252.81 882.197,1297.89 884.504,1495.54 886.812,1202.03 889.12,1401.93 891.428,1302.84 893.736,1387.03 896.044,1310.77 898.352,1362.15 900.66,1247.65 902.968,1449.02 905.276,1364.28 907.584,1125.47 909.891,1343.81 912.199,1199.98 914.507,1147.52 916.815,1454.74 919.123,1115.84 921.431,1358.56 923.739,1338.35 926.047,1361.96 928.355,1355.63 930.663,1419.29 932.971,1451.46 935.278,1255.47 937.586,1325.79 939.894,1526.78 942.202,1445.62 944.51,1379.84 946.818,1380.36 949.126,1177.14 951.434,1295.56 953.742,1211.9 956.05,1401.69 958.358,1494.52 960.665,1465.56 962.973,1386.07 965.281,1400.64 967.589,1304.66 969.897,1419.77 972.205,1303.53 974.513,1404.26 976.821,1240.33 979.129,1305.02 981.437,1427.39 983.745,1372.79 986.053,1325.73 988.36,1444.79 990.668,1430.37 992.976,1414.19 995.284,1455.39 997.592,1520.49 999.9,1268.35 1002.21,1537.65 1004.52,1328.43 1006.82,1426.01 1009.13,1303.83 1011.44,1404.07 1013.75,1291.13 1016.06,1298.3 1018.36,1325.93 1020.67,1318.73 1022.98,1499.08 1025.29,1256 1027.59,1430.77 1029.9,1282.3 1032.21,1509.36 1034.52,1631.2 1036.83,1480.4 1039.13,1486.79 1041.44,1330.11 1043.75,1339.54 1046.06,1258.66 1048.37,1310.73 1050.67,1348.27 1052.98,1483.46 1055.29,1458.26 1057.6,1384.01 1059.91,1416.1 1062.21,1242.12 1064.52,1180.32 1066.83,1442.13 1069.14,1212.62 1071.45,1474.21 1073.75,1492.75 1076.06,1421.09 1078.37,1306.98 1080.68,1312.16 1082.98,1386.71 1085.29,1438.55 1087.6,1421.51 1089.91,1351.79 1092.22,1328.91 1094.52,1344.69 1096.83,1231.75 1099.14,1310.55 1101.45,1208.5 1103.76,1308.23 1106.06,1417.89 1108.37,1090.63 1110.68,1285.59 1112.99,1495.1 1115.3,1399.74 1117.6,1396.5 1119.91,1341.73 1122.22,1266.36 1124.53,1445.65 1126.84,1482.06 1129.14,1392.36 1131.45,1294.81 1133.76,1276.37 1136.07,1328.48 1138.37,1367.19 1140.68,1193.58 1142.99,1249.28 1145.3,1303.56 1147.61,1272.38 1149.91,1467.15 1152.22,1418.42 1154.53,1393.55 1156.84,1441.79 1159.15,1440.6 1161.45,1305.06 1163.76,1401.55 1166.07,1331.52 1168.38,1165.79 1170.69,1250.06 1172.99,1424.71 1175.3,1480.68 1177.61,1442.81 1179.92,1487.59 1182.23,1400.4 1184.53,1399.93 1186.84,1341.59 1189.15,1561.83 1191.46,1353.88 1193.76,1367.77 1196.07,1275.45 1198.38,1438.33 1200.69,1250.13 1203,1394.8 1205.3,1422.47 1207.61,1569.26 1209.92,1316.51 1212.23,1424.73 1214.54,1414.56 1216.84,1514.6 1219.15,1447.69 1221.46,1485.06 1223.77,1182.14 1226.08,1337.46 1228.38,1359.7 1230.69,1421.92 1233,1246.18 1235.31,1449.74 1237.61,1339.5 1239.92,1403.28 1242.23,1324.76 1244.54,1452.71 1246.85,1430.65 1249.15,1261.24 1251.46,1115.29 1253.77,1146.9 1256.08,1281.05 1258.39,1296.84 1260.69,1206.71 1263,1358.22 1265.31,1403.97 1267.62,1201.87 1269.93,1335.6 1272.23,1254.52 1274.54,1407.58 1276.85,1342.78 1279.16,1282.37 1281.47,1300.78 1283.77,1262.74 1286.08,1185.24 1288.39,1303.75 1290.7,1388.38 1293,1263.95 1295.31,1400.71 1297.62,1363.9 1299.93,1311.77 1302.24,1274.44 1304.54,1284.34 1306.85,1288.2 1309.16,1446.89 1311.47,1169.62 1313.78,1323.85 1316.08,1247.24 1318.39,1197.83 1320.7,1477.51 1323.01,1448.61 1325.32,1297.17 1327.62,1323.32 1329.93,1496.43 1332.24,1274.92 1334.55,1319.28 1336.86,1342.19 1339.16,1177.94 1341.47,1459.16 1343.78,1375.26 1346.09,1301.93 1348.39,1247.49 1350.7,1439.93 1353.01,1438.37 1355.32,1384.59 1357.63,1369.73 1359.93,1239.77 1362.24,1359.52 1364.55,1287 1366.86,1473.71 1369.17,1320.7 1371.47,1486.75 1373.78,1439.43 1376.09,1426.74 1378.4,1358.08 1380.71,1350.8 1383.01,1521.29 1385.32,1366.41 1387.63,1268.19 1389.94,1402.58 1392.24,1344.73 1394.55,1308.03 1396.86,1225.03 1399.17,1443.35 1401.48,1356.74 1403.78,1466.49 1406.09,1292.67 1408.4,1285 1410.71,1370.22 1413.02,1418.46 1415.32,1244.41 1417.63,1292.92 1419.94,1519.05 1422.25,1367.53 1424.56,1328.76 1426.86,1384.76 1429.17,1485.49 1431.48,1216.81 1433.79,1455.1 1436.1,1097.81 1438.4,1453.23 1440.71,1352.74 1443.02,1406.75 1445.33,1457.49 1447.63,1305.69 1449.94,1366.99 1452.25,1373.58 1454.56,1484.75 1456.87,1273.65 1459.17,1387.61 1461.48,1317.83 1463.79,1386.01 1466.1,1477.52 1468.41,1443.55 1470.71,1372.85 1473.02,1316.2 1475.33,1362.92 1477.64,1359.03 1479.95,1412.02 1482.25,1316.95 1484.56,1425.51 1486.87,1431.58 1489.18,1329.7 1491.49,1385.18 1493.79,1313.38 1496.1,1438.11 1498.41,1305.09 1500.72,1343.95 1503.02,1211.09 1505.33,1379.56 1507.64,1258.62 1509.95,1355.8 1512.26,1241.74 1514.56,1167.93 1516.87,1295.43 1519.18,1363.78 1521.49,1326.35 1523.8,1307.12 1526.1,1559.77 1528.41,1277.17 1530.72,1219.2 1533.03,1264.59 1535.34,1153.46 1537.64,1268.57 1539.95,1344.24 1542.26,1451.04 1544.57,1313.37 1546.88,1431.26 1549.18,1441.17 1551.49,1241.17 1553.8,1341.33 1556.11,1216.77 1558.41,1358.87 1560.72,1336.72 1563.03,1283.33 1565.34,1259.45 1567.65,1305.06 1569.95,1041.5 1572.26,1492.55 1574.57,1326.32 1576.88,1323.8 1579.19,1436.48 1581.49,1408.7 1583.8,1399.22 1586.11,1473.26 1588.42,1554.03 1590.73,1291.3 1593.03,1487.64 1595.34,1442.19 1597.65,1177.48 1599.96,1304.38 1602.26,1413.65 1604.57,1384.98 1606.88,1526.17 1609.19,1298.39 1611.5,1401.78 1613.8,1455.8 1616.11,1318.3 1618.42,1534.54 1620.73,1375.76 1623.04,1293.04 1625.34,1491.98 1627.65,1561.56 1629.96,1495.68 1632.27,1393.32 1634.58,1325.96 1636.88,1260.74 1639.19,1297.2 1641.5,1342.69 1643.81,1261.95 1646.12,1454.69 1648.42,1287.55 1650.73,1333.86 1653.04,1515.95 1655.35,1351.51 1657.65,1344.88 1659.96,1260.61 1662.27,1267.61 1664.58,1349.26 1666.89,1178.13 1669.19,1232.9 1671.5,1270.99 1673.81,1419.64 1676.12,1306.87 1678.43,1278.57 1680.73,1358.68 1683.04,1291.97 1685.35,1582.62 1687.66,1311.65 1689.97,1437.24 1692.27,1384.9 1694.58,1258.4 1696.89,1475.89 1699.2,1393.65 1701.51,1356.75 1703.81,1548.67 1706.12,1195.79 1708.43,1314.65 1710.74,1272.3 1713.04,1303.66 1715.35,1293.72 1717.66,1380 1719.97,1433.53 1722.28,1182.21 1724.58,1417.43 1726.89,1334.53 1729.2,1433.71 1731.51,1423.8 1733.82,1426.58 1736.12,1342.3 1738.43,1324.38 1740.74,1441.85 1743.05,1364.89 1745.36,1322.28 1747.66,1329.89 1749.97,1304.41 1752.28,1456.93 1754.59,1378.67 1756.9,1348.86 1759.2,1367.55 1761.51,1316.08 1763.82,1147.49 1766.13,1257.88 1768.43,1200.58 1770.74,1232.05 1773.05,1311.89 1775.36,1373.41 1777.67,1489.41 1779.97,1436.7 1782.28,1261.33 1784.59,1386.59 1786.9,1395.53 1789.21,1404.13 1791.51,1240.67 1793.82,1237.94 1796.13,1408.98 1798.44,1358.57 1800.75,1374.03 1803.05,1526.19 1805.36,1297.11 1807.67,1314.6 1809.98,1371.98 1812.28,1275.92 1814.59,1322.55 1816.9,1373.31 1819.21,1314.28 1821.52,1298.74 1823.82,1508.53 1826.13,1418.77 1828.44,1551.4 1830.75,1255.56 1833.06,1342.44 1835.36,1319.19 1837.67,1376.3 1839.98,1429.27 1842.29,1331.63 1844.6,1472.25 1846.9,1333.21 1849.21,1340.32 1851.52,1385.47 1853.83,1378.42 1856.14,1441.63 1858.44,1462.31 1860.75,1307.33 1863.06,1398.93 1865.37,1350.54 1867.67,1202.8 1869.98,1424.41 1872.29,1176.26 1874.6,1355.56 1876.91,1325.92 1879.21,1344.34 1881.52,1325.72 1883.83,1323.69 1886.14,1265.86 1888.45,1393.48 1890.75,1233.81 1893.06,1291.03 1895.37,1364.33 1897.68,1372.92 1899.99,1316.9 1902.29,1333.94 1904.6,1488.87 1906.91,1081.04 1909.22,1428.38 1911.53,1301.71 1913.83,1444.91 1916.14,1360.83 1918.45,1179.57 1920.76,1298.33 1923.06,1251.39 1925.37,1208.64 1927.68,1422.55 1929.99,1344.81 1932.3,1356.78 1934.6,1493.74 1936.91,1310.16 1939.22,1335.79 1941.53,1187.62 1943.84,1429.97 1946.14,1339.15 1948.45,1341.04 1950.76,1371.93 1953.07,1384.26 1955.38,1251.49 1957.68,1259.72 1959.99,1304.41 1962.3,1516.7 1964.61,1351.44 1966.91,1335.18 1969.22,1462.93 1971.53,1298.83 1973.84,1454.18 1976.15,1181.79 1978.45,1460.39 1980.76,1312.57 1983.07,1327.21 1985.38,1311.05 1987.69,1276.76 1989.99,1638.04 1992.3,1295.99 1994.61,1269.35 1996.92,1359.48 1999.23,1228.94 2001.53,1463.91 2003.84,1258.96 2006.15,1244.99 2008.46,1273.82 2010.77,1450.61 2013.07,1367.11 2015.38,1260.48 2017.69,1284.02 2020,1270.15 2022.3,1425.18 2024.61,1330.47 2026.92,1500.54 2029.23,1416.3 2031.54,1285.02 2033.84,1366.08 2036.15,1393.27 2038.46,1479.63 2040.77,1209.55 2043.08,1351.46 2045.38,1405.27 2047.69,1421.62 2050,1502.04 2052.31,1461.52 2054.62,1419.87 2056.92,1141.05 2059.23,1315.67 2061.54,1360.05 2063.85,1235.77 2066.16,1531.08 2068.46,1340.14 2070.77,1503.2 2073.08,1395.92 2075.39,1161.83 2077.69,1465.15 2080,1299.16 2082.31,1418.08 2084.62,1483.14 2086.93,1227.42 2089.23,1331.94 2091.54,1355.85 2093.85,1376.41 2096.16,1346.23 2098.47,1445.21 2100.77,1351.73 2103.08,1322.68 2105.39,1302.32 2107.7,1478.54 2110.01,1103.82 2112.31,1416.35 2114.62,1374.66 2116.93,1446.87 2119.24,1290.02 2121.55,1405.14 2123.85,1234.17 2126.16,1194.34 2128.47,1404.16 2130.78,1263.41 2133.08,1446.26 2135.39,1371.22 2137.7,1398.48 2140.01,1331.54 2142.32,1361.77 2144.62,1168.19 2146.93,1411.57 2149.24,1302.34 2151.55,1428 2153.86,1299.87 2156.16,1260.76 2158.47,1412.62 2160.78,1410.8 2163.09,1569.3 2165.4,1396.85 2167.7,1332.68 2170.01,1359.91 2172.32,1311.4 2174.63,1276.15 2176.93,1274.78 2179.24,1416.54 2181.55,1511.52 2183.86,1291.92 2186.17,1512.75 2188.47,1379.62 2190.78,1381.36 2193.09,1398.92 2195.4,1361.08 2197.71,1288.7 2200.01,1289.18 2202.32,1250.83 2204.63,1274.6 2206.94,1431.11 2209.25,1448.2 2211.55,1266.3 2213.86,1278.24 2216.17,1380.52 2218.48,1451.77 2220.79,1454.28 2223.09,1343.03 2225.4,1326.13 2227.71,1245.16 2230.02,1445.52 2232.32,1340.41 2234.63,1382.2 2236.94,1417.81 2239.25,1389.96 2241.56,1494.21 2243.86,1385.03 2246.17,1484.16 2248.48,1530.54 2250.79,1341.62 2253.1,1300.75 2255.4,1264.88 2257.71,1462.2 2260.02,1384.45 2262.33,1392.95 2264.64,1407.82 2266.94,1159.97 2269.25,1282.86 2271.56,1520.67 2273.87,1396.13 2276.18,1470.51 2278.48,1438.34 2280.79,1417.76 2283.1,1060.2 2285.41,1384.77 2287.71,1398.94 2290.02,1387.39 2292.33,1377.13 2294.64,1383.89 2296.95,1332.49 2299.25,887.362 2301.56,1395.49 2303.87,1318.59 2306.18,1213.52 2308.49,1297.56 2310.79,1370.89 2313.1,1558.24 2315.41,1444.97 2317.72,1215.75 2320.03,1291.64 2322.33,1324.44 2324.64,1421.01 2326.95,1388.88 2329.26,1468.58 2331.56,1417.46 2333.87,1294.13 2336.18,1603.62 2338.49,1312.35 2340.8,1368.98 2343.1,1488.93 2345.41,1428.03 2347.72,1339.08 2350.03,1324.12 2352.34,1751.15 2354.64,1442.35 2356.95,1285.24 2359.26,1562.07 2361.57,1436.32 2363.88,1303.11 2366.18,1619.65 2368.49,1383.29 2370.8,1226.46 2373.11,1433.78 2375.42,1424.37 2377.72,1410.41 2380.03,1442.63 2382.34,1311.87 2384.65,1379.62 2386.95,1195.11 2389.26,1298.99 2391.57,1349.83 2393.88,1519.26 2396.19,1407.66 2398.49,1265.82 2400.8,1227.4 2403.11,1227.46 2405.42,1266.79 2407.73,1147.74 2410.03,1386.91 2412.34,1288.38 2414.65,1401.56 2416.96,1258.88 2419.27,1229.56 2421.57,1344.91 2423.88,1333.5 2426.19,1148.1 2428.5,1336.44 2430.81,1380.78 2433.11,1557.65 2435.42,1458.67 2437.73,1577.93 2440.04,1272.56 2442.34,1154.07 2444.65,1244.47 2446.96,1251.16 2449.27,1479.05 2451.58,1362.11 2453.88,1301.36 2456.19,1390.85 2458.5,1391.76 2460.81,1296.83 2463.12,1180.27 2465.42,1287.27 2467.73,1467.5 2470.04,1386.72 2472.35,1510.69 2474.66,1416.87 2476.96,1228.81 2479.27,1273.79 2481.58,1317 2483.89,1205.63 2486.2,1312.8 2488.5,1380.7 2490.81,1216.79 2493.12,1505.41 2495.43,1310.01 2497.73,1307.93 2500.04,1496.88 2502.35,1235.58 2504.66,1287.43 2506.97,1191.97 2509.27,1330.42 2511.58,1221.36 2513.89,1352.39 2516.2,1403.54 2518.51,1468.12 2520.81,1464.02 2523.12,1400.38 2525.43,1244.59 2527.74,1277.52 2530.05,1348.13 2532.35,1401.7 2534.66,1495.73 2536.97,1409.83 2539.28,1280.38 2541.58,1301.86 2543.89,1217.25 2546.2,1292.29 2548.51,1284.6 2550.82,1325.67 2553.12,1237.39 2555.43,1411.64 2557.74,1340.09 2560.05,1279.24 2562.36,1334.87 2564.66,1437.63 2566.97,1316.64 2569.28,1441.47 2571.59,1348.26 "></polyline>
<polyline clip-path="url(#clip562)" style="stroke:#e26f46; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="265.984,1007.47 268.292,891.532 270.6,788.683 272.908,892.058 275.216,1026.52 277.524,814.505 279.832,921.488 282.139,862.168 284.447,817.577 286.755,856.582 289.063,921.611 291.371,993.362 293.679,1027.79 295.987,779.951 298.295,768.506 300.603,692.342 302.911,825.878 305.219,897.581 307.527,747.654 309.834,770.175 312.142,869.556 314.45,896.12 316.758,852.589 319.066,1069.79 321.374,805.93 323.682,841.208 325.99,897.673 328.298,797.152 330.606,756.635 332.914,807.125 335.221,780.224 337.529,776.261 339.837,933.765 342.145,928.445 344.453,709.794 346.761,729.435 349.069,1048.97 351.377,846.614 353.685,649.352 355.993,994.66 358.301,971.869 360.608,987.858 362.916,816.535 365.224,989.526 367.532,925.412 369.84,662.508 372.148,1096.52 374.456,857.21 376.764,840.152 379.072,841.475 381.38,885.926 383.688,905.235 385.996,862.097 388.303,911.768 390.611,917.707 392.919,894.369 395.227,900.095 397.535,1023.74 399.843,734.59 402.151,984.958 404.459,912.265 406.767,830.42 409.075,924.815 411.383,802.345 413.69,990.477 415.998,651.795 418.306,854.853 420.614,730.598 422.922,1004.11 425.23,901.116 427.538,814.831 429.846,920.534 432.154,944.723 434.462,764.706 436.77,898.457 439.077,1048.34 441.385,967.699 443.693,826.912 446.001,934.567 448.309,714.596 450.617,821.987 452.925,942.793 455.233,808.549 457.541,922.61 459.849,898.353 462.157,808.648 464.465,797.988 466.772,982.471 469.08,826.111 471.388,779.068 473.696,881.3 476.004,791.916 478.312,879.555 480.62,841.156 482.928,1005.75 485.236,886.864 487.544,1002.06 489.852,784.324 492.159,896.072 494.467,812.26 496.775,989.452 499.083,938.712 501.391,870.385 503.699,774.657 506.007,751.94 508.315,809.494 510.623,934.467 512.931,790.153 515.239,982.586 517.546,708.397 519.854,741.082 522.162,897.058 524.47,795.003 526.778,715.124 529.086,703.896 531.394,916.644 533.702,865.959 536.01,793.364 538.318,897.631 540.626,732.537 542.933,863.624 545.241,811.016 547.549,766.37 549.857,950.937 552.165,1032.04 554.473,818.895 556.781,881.628 559.089,856.289 561.397,793.683 563.705,887.248 566.013,866.933 568.321,877.007 570.628,749.687 572.936,817.426 575.244,750.23 577.552,837.562 579.86,902.302 582.168,759.29 584.476,942.722 586.784,865.902 589.092,765.611 591.4,945.676 593.708,994.855 596.015,974.033 598.323,968.53 600.631,877.229 602.939,762.479 605.247,841.045 607.555,902.521 609.863,823.307 612.171,869.58 614.479,960.824 616.787,925.479 619.095,896.452 621.402,809.919 623.71,883.507 626.018,792.553 628.326,928.685 630.634,1133.68 632.942,824.832 635.25,914.469 637.558,824.537 639.866,860.043 642.174,829.554 644.482,971.924 646.79,849.505 649.097,864.573 651.405,1003.67 653.713,871.415 656.021,868.012 658.329,902.694 660.637,1042.48 662.945,821.18 665.253,853.446 667.561,912.783 669.869,902.575 672.177,939.459 674.484,969.106 676.792,955.211 679.1,811.032 681.408,892.316 683.716,677.729 686.024,773.702 688.332,779.837 690.64,823.183 692.948,941.33 695.256,835.141 697.564,824.011 699.871,875.338 702.179,694.237 704.487,868.651 706.795,868.999 709.103,869.068 711.411,909.61 713.719,1063.45 716.027,819.207 718.335,869.839 720.643,1053.78 722.951,806.243 725.259,828.625 727.566,955.369 729.874,844.981 732.182,956.849 734.49,958.931 736.798,908.785 739.106,929.275 741.414,890.126 743.722,939.622 746.03,830.563 748.338,884.448 750.646,966.382 752.953,865.193 755.261,871.338 757.569,748.597 759.877,1000.48 762.185,663.521 764.493,911.816 766.801,867.134 769.109,852.974 771.417,827.064 773.725,804.741 776.033,886.408 778.34,947.643 780.648,679.531 782.956,1036.22 785.264,905.062 787.572,797.758 789.88,1014.39 792.188,893.112 794.496,821.792 796.804,866.675 799.112,848.065 801.42,942.861 803.728,829.771 806.035,904.344 808.343,965.396 810.651,937.747 812.959,716.445 815.267,792.342 817.575,949.762 819.883,986.465 822.191,1021.47 824.499,1056.29 826.807,851.875 829.115,976.404 831.422,873.838 833.73,790.673 836.038,751.154 838.346,832.173 840.654,945.124 842.962,818.911 845.27,872.627 847.578,929.463 849.886,947.671 852.194,823.64 854.502,878.178 856.809,960.988 859.117,872.679 861.425,937.202 863.733,765.39 866.041,1049.65 868.349,820.337 870.657,961.311 872.965,761.595 875.273,997.891 877.581,886.693 879.889,1101.35 882.197,799.149 884.504,934.589 886.812,814.079 889.12,949.248 891.428,995.89 893.736,816.819 896.044,909.303 898.352,875.217 900.66,933.006 902.968,778.761 905.276,747.92 907.584,882.32 909.891,678.896 912.199,1043.38 914.507,816.996 916.815,855.441 919.123,764.871 921.431,988.238 923.739,1039.41 926.047,976.276 928.355,966.336 930.663,893.579 932.971,924.227 935.278,875.669 937.586,930.188 939.894,965.301 942.202,878.251 944.51,818.881 946.818,724.74 949.126,869.535 951.434,754.429 953.742,982.284 956.05,821.871 958.358,909.549 960.665,979.964 962.973,898.736 965.281,808.946 967.589,1016.67 969.897,752.308 972.205,978.858 974.513,774 976.821,1054.5 979.129,816.311 981.437,942.145 983.745,857.527 986.053,786.088 988.36,840.49 990.668,984.51 992.976,734.864 995.284,832.36 997.592,772.666 999.9,643.326 1002.21,973.78 1004.52,952.197 1006.82,794.075 1009.13,691.332 1011.44,839.931 1013.75,743.493 1016.06,802.171 1018.36,984.619 1020.67,687.646 1022.98,929.271 1025.29,777.908 1027.59,799.744 1029.9,887.438 1032.21,883.677 1034.52,678.517 1036.83,954.57 1039.13,880.016 1041.44,1019.31 1043.75,908.22 1046.06,845.396 1048.37,806.365 1050.67,718.631 1052.98,928.108 1055.29,757.539 1057.6,896.175 1059.91,888.587 1062.21,753.839 1064.52,737.002 1066.83,923.806 1069.14,911.708 1071.45,914.43 1073.75,765.632 1076.06,787.525 1078.37,921.517 1080.68,863.778 1082.98,788.028 1085.29,934.084 1087.6,917.938 1089.91,732.074 1092.22,933.247 1094.52,856.166 1096.83,844.949 1099.14,962.689 1101.45,703.318 1103.76,743.71 1106.06,691.365 1108.37,835.748 1110.68,847.265 1112.99,924.704 1115.3,884.664 1117.6,915.294 1119.91,885.277 1122.22,736.76 1124.53,833.561 1126.84,898.801 1129.14,911.719 1131.45,869.153 1133.76,840.374 1136.07,888.987 1138.37,882.13 1140.68,892.932 1142.99,930.61 1145.3,772.282 1147.61,846.78 1149.91,977.242 1152.22,955.89 1154.53,924.599 1156.84,834.109 1159.15,923.923 1161.45,864.155 1163.76,936.747 1166.07,816.491 1168.38,670.47 1170.69,874.973 1172.99,1027.97 1175.3,905.863 1177.61,846.322 1179.92,908.271 1182.23,853.273 1184.53,844.536 1186.84,1017.32 1189.15,832.48 1191.46,1008.63 1193.76,540.172 1196.07,942.649 1198.38,896.825 1200.69,892.36 1203,969.008 1205.3,782.18 1207.61,900.235 1209.92,874.478 1212.23,992.385 1214.54,793.887 1216.84,980.606 1219.15,930.974 1221.46,976.967 1223.77,927.483 1226.08,715.626 1228.38,947.517 1230.69,1086.26 1233,830.398 1235.31,889.766 1237.61,806.302 1239.92,864.418 1242.23,864.08 1244.54,828.253 1246.85,796.17 1249.15,731.44 1251.46,850.251 1253.77,968.638 1256.08,797.094 1258.39,922.153 1260.69,868.797 1263,908.078 1265.31,1050.52 1267.62,867.834 1269.93,905.1 1272.23,986.283 1274.54,757.545 1276.85,1003.07 1279.16,975.463 1281.47,861.248 1283.77,933.536 1286.08,812.936 1288.39,758.537 1290.7,996.092 1293,916.798 1295.31,986.242 1297.62,952.734 1299.93,943.121 1302.24,761.956 1304.54,785.852 1306.85,795.5 1309.16,728.789 1311.47,971.64 1313.78,944.737 1316.08,888.793 1318.39,867.434 1320.7,999.604 1323.01,858.933 1325.32,836.29 1327.62,719.906 1329.93,881.579 1332.24,835.12 1334.55,877.387 1336.86,898.319 1339.16,892.121 1341.47,877.369 1343.78,908.673 1346.09,920.207 1348.39,832.732 1350.7,768.043 1353.01,914.648 1355.32,799.683 1357.63,747.695 1359.93,760.067 1362.24,740.065 1364.55,977.379 1366.86,919.121 1369.17,878.524 1371.47,1082.7 1373.78,883.251 1376.09,973.908 1378.4,849.817 1380.71,864.504 1383.01,838.795 1385.32,980.963 1387.63,894.519 1389.94,866.466 1392.24,852.456 1394.55,743.231 1396.86,839.507 1399.17,884.309 1401.48,931.649 1403.78,921.205 1406.09,947.025 1408.4,824.989 1410.71,790.203 1413.02,968.321 1415.32,989.816 1417.63,754.851 1419.94,709.61 1422.25,676.133 1424.56,801.738 1426.86,882.544 1429.17,653.52 1431.48,895.672 1433.79,840.824 1436.1,915.669 1438.4,767.557 1440.71,872.865 1443.02,854.246 1445.33,980.236 1447.63,974.697 1449.94,881.468 1452.25,820.822 1454.56,768.158 1456.87,834.971 1459.17,885.548 1461.48,779.689 1463.79,901.442 1466.1,990.465 1468.41,933.604 1470.71,868.955 1473.02,865.044 1475.33,940.962 1477.64,797.595 1479.95,902.225 1482.25,898.062 1484.56,970.348 1486.87,1005.06 1489.18,779.221 1491.49,1096.48 1493.79,690.459 1496.1,765.873 1498.41,950.849 1500.72,844.379 1503.02,785.786 1505.33,750.082 1507.64,968.701 1509.95,993.26 1512.26,811.916 1514.56,802.289 1516.87,655.661 1519.18,841.501 1521.49,743.372 1523.8,1024.22 1526.1,847.207 1528.41,943.569 1530.72,775.521 1533.03,824.77 1535.34,916.895 1537.64,880.084 1539.95,740.746 1542.26,943.73 1544.57,760.118 1546.88,1124.79 1549.18,838.437 1551.49,717.201 1553.8,727.49 1556.11,919.536 1558.41,737.885 1560.72,1063.43 1563.03,825.218 1565.34,806.612 1567.65,898.658 1569.95,1023.91 1572.26,965.657 1574.57,1012.49 1576.88,834.21 1579.19,1016.51 1581.49,782.553 1583.8,792.345 1586.11,904.862 1588.42,897.862 1590.73,959.599 1593.03,910.606 1595.34,796.269 1597.65,1038.09 1599.96,832.137 1602.26,935.608 1604.57,963.163 1606.88,919.611 1609.19,921.695 1611.5,818.331 1613.8,907.355 1616.11,822.539 1618.42,783.94 1620.73,809.2 1623.04,786.429 1625.34,907.33 1627.65,839.78 1629.96,788.428 1632.27,755.058 1634.58,737.834 1636.88,951.757 1639.19,1029.25 1641.5,858.442 1643.81,857.287 1646.12,963.763 1648.42,794.46 1650.73,741.576 1653.04,779.499 1655.35,831.893 1657.65,989.304 1659.96,900.271 1662.27,1019.83 1664.58,794.009 1666.89,863.578 1669.19,887.112 1671.5,852.273 1673.81,795.213 1676.12,938.023 1678.43,872.906 1680.73,943.758 1683.04,846.577 1685.35,838.788 1687.66,671.955 1689.97,864.134 1692.27,882.817 1694.58,977.292 1696.89,789.576 1699.2,929.637 1701.51,835.375 1703.81,854.788 1706.12,885.861 1708.43,632.017 1710.74,790.715 1713.04,925.501 1715.35,913.708 1717.66,915.463 1719.97,837.702 1722.28,917.047 1724.58,872.5 1726.89,983.193 1729.2,746.21 1731.51,897.288 1733.82,921.614 1736.12,902.407 1738.43,756.457 1740.74,810.796 1743.05,900.036 1745.36,870.081 1747.66,734.903 1749.97,991.867 1752.28,1005.02 1754.59,933.6 1756.9,971.02 1759.2,844.392 1761.51,968.391 1763.82,880.154 1766.13,844.284 1768.43,798.17 1770.74,757.111 1773.05,1000.11 1775.36,1009.02 1777.67,998.107 1779.97,955.392 1782.28,930.564 1784.59,890.838 1786.9,878.854 1789.21,874.199 1791.51,894.367 1793.82,904.832 1796.13,978.903 1798.44,880.699 1800.75,933.689 1803.05,795.958 1805.36,775.29 1807.67,951.331 1809.98,840.343 1812.28,807.837 1814.59,891.205 1816.9,826.842 1819.21,865.988 1821.52,981.48 1823.82,946.074 1826.13,719.776 1828.44,778.947 1830.75,816.899 1833.06,852.253 1835.36,892.808 1837.67,922.122 1839.98,836.127 1842.29,773.322 1844.6,727.373 1846.9,846.528 1849.21,926.463 1851.52,906.252 1853.83,743.747 1856.14,1058.52 1858.44,770.909 1860.75,948.933 1863.06,923.467 1865.37,796.224 1867.67,981.456 1869.98,789.175 1872.29,974.792 1874.6,830.861 1876.91,782.806 1879.21,769.135 1881.52,741.983 1883.83,777.99 1886.14,875.503 1888.45,744.431 1890.75,913.774 1893.06,884.354 1895.37,938.283 1897.68,794.632 1899.99,784.687 1902.29,960.855 1904.6,834.158 1906.91,663.661 1909.22,972.747 1911.53,858.851 1913.83,909.116 1916.14,918.623 1918.45,840.333 1920.76,881.832 1923.06,700.739 1925.37,914.739 1927.68,808.547 1929.99,966.204 1932.3,759.084 1934.6,708.555 1936.91,723.73 1939.22,1006.63 1941.53,925.849 1943.84,921.562 1946.14,846.071 1948.45,921.746 1950.76,918.393 1953.07,1015.93 1955.38,980.827 1957.68,915.697 1959.99,1076.81 1962.3,928.424 1964.61,837.61 1966.91,1045.21 1969.22,628.181 1971.53,722.953 1973.84,931.782 1976.15,923.636 1978.45,871.945 1980.76,873.762 1983.07,834.699 1985.38,710.776 1987.69,755.328 1989.99,679.651 1992.3,983.459 1994.61,823.815 1996.92,947.232 1999.23,742.812 2001.53,905.11 2003.84,734.903 2006.15,875.679 2008.46,747.354 2010.77,960.036 2013.07,948.45 2015.38,788.867 2017.69,918.83 2020,888.176 2022.3,922.343 2024.61,765.779 2026.92,751.84 2029.23,948.508 2031.54,777.408 2033.84,948.581 2036.15,708.761 2038.46,947.41 2040.77,1021.07 2043.08,858.841 2045.38,619.895 2047.69,927.696 2050,961.384 2052.31,1044.95 2054.62,845.913 2056.92,785.483 2059.23,844.697 2061.54,943.206 2063.85,771.215 2066.16,785.01 2068.46,693.32 2070.77,732.634 2073.08,785.877 2075.39,847.222 2077.69,991.184 2080,760.529 2082.31,698.852 2084.62,1009.2 2086.93,979.618 2089.23,890.78 2091.54,773.047 2093.85,940.691 2096.16,860.131 2098.47,653.162 2100.77,779.839 2103.08,878.397 2105.39,972.934 2107.7,823.174 2110.01,861.498 2112.31,844.52 2114.62,770.522 2116.93,1024.46 2119.24,924.482 2121.55,867.314 2123.85,820.65 2126.16,873.849 2128.47,802.525 2130.78,848.536 2133.08,1093.84 2135.39,794.119 2137.7,858.774 2140.01,928.973 2142.32,665.944 2144.62,827.614 2146.93,712.352 2149.24,870.831 2151.55,933.19 2153.86,933.197 2156.16,910.073 2158.47,824.747 2160.78,894.595 2163.09,860.311 2165.4,1010.23 2167.7,808.878 2170.01,728.721 2172.32,1001.64 2174.63,833.67 2176.93,945.003 2179.24,779.389 2181.55,991.68 2183.86,837.965 2186.17,867.977 2188.47,868.03 2190.78,820.998 2193.09,869.824 2195.4,804.015 2197.71,924.272 2200.01,805.335 2202.32,895.769 2204.63,768.299 2206.94,913.986 2209.25,1049.5 2211.55,961.979 2213.86,1075.42 2216.17,855.163 2218.48,985.897 2220.79,833.36 2223.09,699.781 2225.4,900.7 2227.71,908.951 2230.02,915.349 2232.32,854.721 2234.63,762.77 2236.94,804.376 2239.25,956.307 2241.56,1035.05 2243.86,939.551 2246.17,934.665 2248.48,915.763 2250.79,799.859 2253.1,810.782 2255.4,1034.02 2257.71,719.629 2260.02,758.326 2262.33,700.918 2264.64,920.702 2266.94,892.871 2269.25,751.574 2271.56,891.15 2273.87,960.346 2276.18,900.121 2278.48,823.241 2280.79,898.556 2283.1,901.855 2285.41,790.624 2287.71,1072.85 2290.02,820.194 2292.33,933.817 2294.64,973.544 2296.95,741.882 2299.25,945.922 2301.56,791.224 2303.87,873.275 2306.18,915.628 2308.49,765.881 2310.79,879.309 2313.1,807.271 2315.41,853.72 2317.72,920.648 2320.03,738.566 2322.33,1038.52 2324.64,898.138 2326.95,973.885 2329.26,980.382 2331.56,1001.76 2333.87,822.23 2336.18,971.507 2338.49,749.46 2340.8,748.492 2343.1,1030.29 2345.41,753.363 2347.72,932.873 2350.03,843.933 2352.34,938.971 2354.64,942.449 2356.95,817.3 2359.26,862.655 2361.57,830.788 2363.88,823.06 2366.18,931.754 2368.49,824.655 2370.8,793.762 2373.11,713.895 2375.42,817.95 2377.72,965.403 2380.03,907.943 2382.34,874.214 2384.65,883.553 2386.95,890.456 2389.26,1100.38 2391.57,732.688 2393.88,771.332 2396.19,860.214 2398.49,1003.26 2400.8,938.488 2403.11,654.114 2405.42,898.353 2407.73,907.221 2410.03,1005.31 2412.34,874.124 2414.65,914.239 2416.96,930.966 2419.27,785.842 2421.57,937.914 2423.88,834.367 2426.19,893.989 2428.5,961.866 2430.81,920.946 2433.11,924.756 2435.42,870.109 2437.73,1019.9 2440.04,959.541 2442.34,891.287 2444.65,951.08 2446.96,873.412 2449.27,670.112 2451.58,868.853 2453.88,784.608 2456.19,743.629 2458.5,972.434 2460.81,833.851 2463.12,896.469 2465.42,804.484 2467.73,922.968 2470.04,859.742 2472.35,897.638 2474.66,685.196 2476.96,1064.61 2479.27,943.236 2481.58,897.58 2483.89,799.163 2486.2,927.07 2488.5,957.142 2490.81,877.915 2493.12,888.076 2495.43,810.317 2497.73,890.42 2500.04,842.412 2502.35,961.661 2504.66,901.506 2506.97,802.731 2509.27,967.919 2511.58,817.133 2513.89,956.817 2516.2,1111.83 2518.51,912.528 2520.81,954.97 2523.12,797.449 2525.43,969.189 2527.74,721.936 2530.05,891.214 2532.35,949.748 2534.66,825.715 2536.97,853.574 2539.28,1024.16 2541.58,875.56 2543.89,944.889 2546.2,740.222 2548.51,1052.55 2550.82,836.235 2553.12,814.82 2555.43,822.842 2557.74,921.768 2560.05,889.653 2562.36,994.721 2564.66,926.117 2566.97,765.313 2569.28,884.583 2571.59,639.264 "></polyline>
<polyline clip-path="url(#clip562)" style="stroke:#3da44d; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="265.984,705.857 268.292,296.952 270.6,396.263 272.908,387.421 275.216,244.178 277.524,372.795 279.832,397.676 282.139,553.611 284.447,533.563 286.755,255.783 289.063,385.616 291.371,507.172 293.679,487.52 295.987,388.872 298.295,344.947 300.603,288.207 302.911,436.51 305.219,325.201 307.527,330.402 309.834,423.864 312.142,155.912 314.45,409.47 316.758,385.407 319.066,278.111 321.374,148.911 323.682,188.737 325.99,443.437 328.298,325.068 330.606,422.653 332.914,452.115 335.221,531.198 337.529,379.37 339.837,380.168 342.145,401.749 344.453,388.455 346.761,417.761 349.069,241.348 351.377,466.223 353.685,511.686 355.993,226.508 358.301,357.1 360.608,469.603 362.916,420.213 365.224,415.682 367.532,468.64 369.84,423.014 372.148,264.211 374.456,351.07 376.764,413.999 379.072,581.284 381.38,343.61 383.688,336.853 385.996,445.512 388.303,409.135 390.611,396.197 392.919,489.789 395.227,385.306 397.535,385.549 399.843,401.202 402.151,391.042 404.459,337.327 406.767,295.536 409.075,441.042 411.383,480.737 413.69,314.599 415.998,335.116 418.306,327.595 420.614,428.21 422.922,451.312 425.23,351.616 427.538,444.495 429.846,361.694 432.154,509.266 434.462,255.507 436.77,466.474 439.077,275.081 441.385,298.505 443.693,482.831 446.001,516.747 448.309,361.404 450.617,323.52 452.925,469.582 455.233,435.352 457.541,580.851 459.849,504.091 462.157,540.267 464.465,265.259 466.772,419.811 469.08,309 471.388,639.159 473.696,612.26 476.004,525.07 478.312,451.752 480.62,378.877 482.928,445.266 485.236,451.365 487.544,546.76 489.852,371.982 492.159,346.221 494.467,491.355 496.775,519.511 499.083,438.488 501.391,425.117 503.699,430.397 506.007,557.904 508.315,437.851 510.623,240.551 512.931,416.228 515.239,233.436 517.546,419.047 519.854,197.382 522.162,351.837 524.47,332.978 526.778,273.024 529.086,513.429 531.394,310.517 533.702,481.14 536.01,336.916 538.318,362.726 540.626,447.847 542.933,122.422 545.241,400.695 547.549,361.045 549.857,384.867 552.165,373.662 554.473,454.342 556.781,405.299 559.089,465.1 561.397,384.425 563.705,375.774 566.013,559.833 568.321,366.148 570.628,298.078 572.936,317.12 575.244,329.288 577.552,395.408 579.86,471.624 582.168,443.917 584.476,465.319 586.784,457.942 589.092,478.967 591.4,455.068 593.708,524.853 596.015,348.806 598.323,281.598 600.631,460.807 602.939,478.722 605.247,380.015 607.555,509.332 609.863,355.538 612.171,439.365 614.479,371.466 616.787,521.859 619.095,292.499 621.402,397.24 623.71,425.663 626.018,466.339 628.326,323.19 630.634,300.594 632.942,429.349 635.25,407.339 637.558,489.826 639.866,380.837 642.174,138.088 644.482,337.649 646.79,404.969 649.097,509.403 651.405,416.421 653.713,396.307 656.021,298.968 658.329,625.615 660.637,293.665 662.945,402.773 665.253,525.43 667.561,411.135 669.869,451.851 672.177,282.21 674.484,332.036 676.792,487.373 679.1,541.205 681.408,468.664 683.716,335.356 686.024,366.975 688.332,384.109 690.64,258.618 692.948,377.107 695.256,261.093 697.564,266.819 699.871,325.842 702.179,378.613 704.487,272.005 706.795,351.935 709.103,424.924 711.411,352.008 713.719,381.245 716.027,386.833 718.335,317.813 720.643,524.679 722.951,347.084 725.259,491.468 727.566,296.477 729.874,370.598 732.182,373.402 734.49,382.381 736.798,467.117 739.106,381.746 741.414,432.038 743.722,465.055 746.03,294.063 748.338,419.975 750.646,449.658 752.953,407.136 755.261,284.262 757.569,400.083 759.877,510.128 762.185,576.295 764.493,407.383 766.801,319.319 769.109,379.983 771.417,404.756 773.725,347.533 776.033,474.784 778.34,496.231 780.648,349.977 782.956,278.243 785.264,475.557 787.572,237.36 789.88,385.896 792.188,519.283 794.496,487.874 796.804,423.411 799.112,481.165 801.42,451.163 803.728,250.189 806.035,371.516 808.343,387.342 810.651,637.893 812.959,207.155 815.267,305.898 817.575,316.416 819.883,377.003 822.191,544.66 824.499,502.6 826.807,319.964 829.115,122.65 831.422,431.029 833.73,201.509 836.038,381.613 838.346,371.38 840.654,443.961 842.962,390.695 845.27,381.99 847.578,539.351 849.886,281.888 852.194,348.779 854.502,421.771 856.809,265.187 859.117,477.211 861.425,456.551 863.733,273.554 866.041,242.216 868.349,551.155 870.657,331.661 872.965,352.716 875.273,346.482 877.581,282.973 879.889,454.797 882.197,540.663 884.504,482.106 886.812,380.091 889.12,458.896 891.428,384.347 893.736,243.879 896.044,298.907 898.352,488.833 900.66,429.239 902.968,353.469 905.276,375.389 907.584,147.528 909.891,457.749 912.199,315.714 914.507,315.276 916.815,230.304 919.123,277.487 921.431,527.896 923.739,211.001 926.047,419.052 928.355,504.778 930.663,544.415 932.971,387.369 935.278,406.195 937.586,365.522 939.894,478.189 942.202,227.336 944.51,368.006 946.818,150.774 949.126,424.77 951.434,342.116 953.742,397.401 956.05,302.166 958.358,424.169 960.665,368.913 962.973,351.17 965.281,485.074 967.589,367.614 969.897,410.751 972.205,365.981 974.513,463.778 976.821,307.879 979.129,402.241 981.437,330.598 983.745,350.222 986.053,364.616 988.36,302.235 990.668,382.554 992.976,325.875 995.284,415.998 997.592,333.606 999.9,451.835 1002.21,433.253 1004.52,480.246 1006.82,308.588 1009.13,550.775 1011.44,389.582 1013.75,581.699 1016.06,472.054 1018.36,325.5 1020.67,271.607 1022.98,495.843 1025.29,462.53 1027.59,400.052 1029.9,351.518 1032.21,412.708 1034.52,334.675 1036.83,393.016 1039.13,342.381 1041.44,364.356 1043.75,471.732 1046.06,434.42 1048.37,400.157 1050.67,391.201 1052.98,382.246 1055.29,294.847 1057.6,198.307 1059.91,578.666 1062.21,334.194 1064.52,438.989 1066.83,387.134 1069.14,402.121 1071.45,525.4 1073.75,389.644 1076.06,419.493 1078.37,198.659 1080.68,195.462 1082.98,419.699 1085.29,454.042 1087.6,352.353 1089.91,283.533 1092.22,456.343 1094.52,518.823 1096.83,402.431 1099.14,168.123 1101.45,391.743 1103.76,496.531 1106.06,524.957 1108.37,188.496 1110.68,516.576 1112.99,331.539 1115.3,419.193 1117.6,247.669 1119.91,516.919 1122.22,508.373 1124.53,394.89 1126.84,324.675 1129.14,287.335 1131.45,553.019 1133.76,238.52 1136.07,504.178 1138.37,457.702 1140.68,406.501 1142.99,416.49 1145.3,250.407 1147.61,557.909 1149.91,446.405 1152.22,191.319 1154.53,418.994 1156.84,589.709 1159.15,217.811 1161.45,218.488 1163.76,412.158 1166.07,346.382 1168.38,429.279 1170.69,440.861 1172.99,408.967 1175.3,239.739 1177.61,365.266 1179.92,389.177 1182.23,215.053 1184.53,396.407 1186.84,441.667 1189.15,290.728 1191.46,412.314 1193.76,353.368 1196.07,167.322 1198.38,515.215 1200.69,490.836 1203,493.597 1205.3,236.444 1207.61,364.534 1209.92,460.844 1212.23,420.399 1214.54,375.255 1216.84,490.912 1219.15,598.656 1221.46,404.193 1223.77,319.386 1226.08,461.478 1228.38,510.686 1230.69,405.894 1233,411.719 1235.31,431.431 1237.61,320.306 1239.92,389.017 1242.23,255.544 1244.54,243.041 1246.85,480.876 1249.15,282.294 1251.46,373.934 1253.77,541.116 1256.08,385.486 1258.39,406.407 1260.69,381.096 1263,377.227 1265.31,350.387 1267.62,258.594 1269.93,187.145 1272.23,499.611 1274.54,356.228 1276.85,364.189 1279.16,413.255 1281.47,232.724 1283.77,484.95 1286.08,450.886 1288.39,332.589 1290.7,399.021 1293,317.033 1295.31,495.287 1297.62,376.375 1299.93,360.686 1302.24,391.403 1304.54,268.871 1306.85,387.79 1309.16,372.428 1311.47,405.726 1313.78,388.685 1316.08,595.187 1318.39,479.04 1320.7,484.845 1323.01,308.536 1325.32,437.935 1327.62,353.437 1329.93,432.477 1332.24,465.013 1334.55,306.864 1336.86,611.249 1339.16,458.23 1341.47,430.499 1343.78,337.593 1346.09,342.918 1348.39,256.234 1350.7,229.121 1353.01,432.881 1355.32,315.931 1357.63,254.927 1359.93,408.555 1362.24,476.709 1364.55,547.506 1366.86,453.637 1369.17,374.031 1371.47,454.07 1373.78,355.168 1376.09,509.872 1378.4,408.414 1380.71,665.925 1383.01,363.394 1385.32,532.18 1387.63,534.672 1389.94,294.367 1392.24,380.396 1394.55,232.919 1396.86,542.505 1399.17,364.218 1401.48,300.311 1403.78,574.49 1406.09,395.012 1408.4,437.261 1410.71,422.933 1413.02,622.988 1415.32,238.608 1417.63,701.203 1419.94,256.861 1422.25,302.547 1424.56,397.689 1426.86,485.349 1429.17,361.431 1431.48,535.356 1433.79,373.347 1436.1,491.17 1438.4,540.556 1440.71,354.81 1443.02,357.186 1445.33,492.264 1447.63,364.302 1449.94,314.971 1452.25,423.034 1454.56,386.606 1456.87,426.913 1459.17,272.559 1461.48,358.923 1463.79,233.596 1466.1,368.32 1468.41,306.452 1470.71,478.517 1473.02,411.683 1475.33,462.666 1477.64,282.034 1479.95,513.796 1482.25,422.789 1484.56,359.084 1486.87,341.7 1489.18,337.033 1491.49,356.128 1493.79,439.093 1496.1,178.297 1498.41,552.573 1500.72,382.044 1503.02,389.351 1505.33,332.46 1507.64,438.505 1509.95,329.601 1512.26,467.264 1514.56,346.064 1516.87,164.787 1519.18,349.642 1521.49,480.571 1523.8,261.499 1526.1,501.259 1528.41,346.441 1530.72,402.243 1533.03,352.185 1535.34,424.918 1537.64,456.559 1539.95,554.298 1542.26,352.949 1544.57,422.73 1546.88,383.824 1549.18,295.066 1551.49,485.784 1553.8,395.927 1556.11,263.802 1558.41,434.666 1560.72,451.509 1563.03,431.4 1565.34,220.804 1567.65,471.836 1569.95,495.76 1572.26,426.036 1574.57,411.592 1576.88,422.826 1579.19,372.777 1581.49,422.994 1583.8,402.535 1586.11,206.575 1588.42,396.417 1590.73,464.576 1593.03,359.463 1595.34,325.196 1597.65,500.871 1599.96,350.994 1602.26,512.194 1604.57,556.087 1606.88,532.682 1609.19,290.39 1611.5,434.828 1613.8,261.011 1616.11,395.956 1618.42,260.548 1620.73,488.554 1623.04,307.437 1625.34,423.284 1627.65,336.981 1629.96,480.723 1632.27,377.587 1634.58,264.861 1636.88,334.513 1639.19,546.728 1641.5,400.927 1643.81,428.589 1646.12,431.547 1648.42,401.567 1650.73,351.439 1653.04,375.597 1655.35,318.058 1657.65,378.552 1659.96,368.725 1662.27,287.496 1664.58,381.96 1666.89,446.783 1669.19,241.487 1671.5,522.493 1673.81,483.77 1676.12,339.176 1678.43,235.976 1680.73,424.166 1683.04,414.887 1685.35,390.568 1687.66,403.313 1689.97,243.19 1692.27,411.701 1694.58,500.171 1696.89,293.941 1699.2,363.225 1701.51,371.643 1703.81,255.432 1706.12,438.038 1708.43,350.8 1710.74,382.618 1713.04,472.649 1715.35,218.143 1717.66,291.823 1719.97,242.1 1722.28,211.624 1724.58,329.726 1726.89,238.837 1729.2,549.411 1731.51,311.304 1733.82,270.267 1736.12,343.203 1738.43,340.386 1740.74,338.701 1743.05,509.25 1745.36,220.073 1747.66,592.332 1749.97,405.795 1752.28,361.167 1754.59,283.379 1756.9,294.584 1759.2,453.295 1761.51,288.121 1763.82,225.955 1766.13,439.434 1768.43,354.99 1770.74,311.99 1773.05,600.788 1775.36,304.537 1777.67,360.99 1779.97,254.173 1782.28,348.979 1784.59,396.333 1786.9,431.593 1789.21,338.741 1791.51,415.963 1793.82,334.237 1796.13,229.055 1798.44,412.731 1800.75,305.795 1803.05,439.119 1805.36,418.274 1807.67,348.245 1809.98,296.107 1812.28,410.761 1814.59,286.978 1816.9,231.411 1819.21,286.383 1821.52,337.3 1823.82,435.189 1826.13,507.768 1828.44,260.187 1830.75,581.764 1833.06,405.227 1835.36,550.684 1837.67,535.165 1839.98,439.392 1842.29,274.616 1844.6,377.624 1846.9,384.553 1849.21,506.319 1851.52,423.897 1853.83,387.43 1856.14,229.032 1858.44,450.255 1860.75,448.924 1863.06,382.917 1865.37,500.332 1867.67,582.43 1869.98,348.472 1872.29,442.349 1874.6,266.94 1876.91,416.809 1879.21,474.491 1881.52,489.169 1883.83,416.449 1886.14,136.333 1888.45,360.569 1890.75,338.719 1893.06,404.121 1895.37,299.978 1897.68,320.27 1899.99,394.083 1902.29,394.311 1904.6,493.838 1906.91,346.811 1909.22,430.93 1911.53,459.407 1913.83,631.732 1916.14,276.188 1918.45,476.269 1920.76,411.586 1923.06,563.19 1925.37,401.432 1927.68,356.65 1929.99,417.343 1932.3,315.708 1934.6,341.123 1936.91,434.484 1939.22,361.271 1941.53,510.314 1943.84,317.55 1946.14,442.485 1948.45,198.752 1950.76,307.736 1953.07,373.724 1955.38,309.162 1957.68,412.457 1959.99,170.834 1962.3,401.216 1964.61,471.126 1966.91,641.709 1969.22,409.686 1971.53,332.793 1973.84,342.974 1976.15,547.474 1978.45,511.433 1980.76,324.392 1983.07,457.028 1985.38,539.403 1987.69,330.938 1989.99,318.357 1992.3,394.403 1994.61,347.996 1996.92,438.167 1999.23,277.292 2001.53,506.148 2003.84,410.215 2006.15,313.089 2008.46,421.212 2010.77,354.154 2013.07,368.203 2015.38,462.577 2017.69,215.886 2020,603.289 2022.3,309.832 2024.61,423.305 2026.92,300.413 2029.23,571.308 2031.54,463.719 2033.84,346.554 2036.15,335.928 2038.46,373.24 2040.77,455.073 2043.08,440.306 2045.38,477.141 2047.69,330.719 2050,425.188 2052.31,495.849 2054.62,448.013 2056.92,357.876 2059.23,339.891 2061.54,408.805 2063.85,290.943 2066.16,317.73 2068.46,478.612 2070.77,451.371 2073.08,439.282 2075.39,586.92 2077.69,231.622 2080,531.355 2082.31,431.163 2084.62,303.213 2086.93,340.885 2089.23,321.109 2091.54,365.013 2093.85,362.717 2096.16,491.232 2098.47,456.847 2100.77,448.729 2103.08,381.568 2105.39,437.144 2107.7,501.92 2110.01,371.727 2112.31,96.8724 2114.62,567.823 2116.93,173.034 2119.24,412.539 2121.55,348.977 2123.85,255.291 2126.16,542.666 2128.47,467.387 2130.78,356.439 2133.08,292.476 2135.39,369.93 2137.7,363.155 2140.01,375.783 2142.32,381.726 2144.62,243.991 2146.93,179.623 2149.24,287.986 2151.55,583.897 2153.86,491.745 2156.16,294.887 2158.47,532.659 2160.78,599.271 2163.09,255.32 2165.4,377.477 2167.7,414.256 2170.01,390.618 2172.32,321.014 2174.63,179.341 2176.93,488.27 2179.24,315.886 2181.55,330.221 2183.86,381.995 2186.17,374.371 2188.47,262.839 2190.78,451.514 2193.09,396.25 2195.4,227.128 2197.71,224.738 2200.01,451.247 2202.32,444.523 2204.63,359.714 2206.94,231.211 2209.25,414.211 2211.55,255.756 2213.86,354.788 2216.17,452.452 2218.48,286.618 2220.79,266.936 2223.09,364.406 2225.4,428.837 2227.71,465.702 2230.02,282.067 2232.32,494.301 2234.63,242.989 2236.94,324.585 2239.25,442.819 2241.56,317.424 2243.86,464.729 2246.17,387.55 2248.48,491.775 2250.79,303.204 2253.1,395.273 2255.4,483.458 2257.71,373.914 2260.02,356.315 2262.33,553.897 2264.64,586.992 2266.94,394.58 2269.25,476.328 2271.56,314.533 2273.87,353.187 2276.18,394.913 2278.48,308.939 2280.79,356.495 2283.1,540.384 2285.41,274.499 2287.71,605.096 2290.02,442.751 2292.33,280.254 2294.64,637.97 2296.95,310.695 2299.25,426.9 2301.56,454.092 2303.87,279.107 2306.18,482.812 2308.49,426.249 2310.79,361.047 2313.1,449.807 2315.41,371.137 2317.72,500.011 2320.03,365.02 2322.33,337.079 2324.64,389.445 2326.95,383.391 2329.26,331.928 2331.56,238.749 2333.87,413.218 2336.18,327.005 2338.49,284.06 2340.8,360.253 2343.1,371.645 2345.41,295.554 2347.72,325.798 2350.03,538.254 2352.34,403.743 2354.64,385.321 2356.95,409.82 2359.26,512.324 2361.57,208.016 2363.88,428.785 2366.18,192.34 2368.49,369.85 2370.8,253.198 2373.11,248.019 2375.42,320.044 2377.72,348.731 2380.03,301.344 2382.34,452.51 2384.65,401.563 2386.95,445.404 2389.26,490.968 2391.57,307.813 2393.88,433.975 2396.19,447.992 2398.49,272.543 2400.8,466.933 2403.11,374.927 2405.42,341.614 2407.73,394.987 2410.03,127.446 2412.34,381.813 2414.65,401.362 2416.96,399.925 2419.27,345.83 2421.57,303.563 2423.88,569.918 2426.19,315.671 2428.5,381.492 2430.81,330.651 2433.11,374.17 2435.42,450.822 2437.73,480.12 2440.04,462.06 2442.34,275.052 2444.65,352.807 2446.96,458.965 2449.27,399.338 2451.58,508.1 2453.88,454.714 2456.19,215.487 2458.5,224.991 2460.81,311.169 2463.12,490.938 2465.42,278.407 2467.73,428.112 2470.04,266.939 2472.35,406.476 2474.66,456.089 2476.96,499.782 2479.27,385.603 2481.58,549.537 2483.89,474.138 2486.2,445.461 2488.5,376.143 2490.81,474.053 2493.12,365.88 2495.43,477.406 2497.73,431.618 2500.04,334.884 2502.35,414.81 2504.66,389.299 2506.97,475.064 2509.27,420.668 2511.58,350.153 2513.89,362.5 2516.2,613.778 2518.51,655.079 2520.81,379.748 2523.12,285.5 2525.43,275.283 2527.74,388.814 2530.05,408.967 2532.35,333.926 2534.66,344.679 2536.97,387.556 2539.28,428.412 2541.58,301.59 2543.89,400.779 2546.2,473.78 2548.51,339.184 2550.82,480.841 2553.12,405.669 2555.43,266.636 2557.74,429.314 2560.05,443.584 2562.36,488.433 2564.66,597.08 2566.97,362.433 2569.28,417.414 2571.59,451.257 "></polyline>
</svg>
</div>
</div>
<p>Look at that! Things are working; amazin’.</p>
<p>We can also exploit <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>’s parallel sampling capabilities:</p>
<div id="34" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run separate 4 chains for 10 000 iterations using threads to parallelize.</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>num_chains <span class="op">=</span> <span class="fl">4</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    model_with_grad,</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">MCMCThreads</span>(),</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>,</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    num_chains;</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Note we need to provide an initial state for every chain.</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>    initial_state<span class="op">=</span><span class="fu">fill</span>(state, num_chains),</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>samples_array <span class="op">=</span> <span class="fu">stack</span>(<span class="fu">map</span>(<span class="bu">Base</span>.<span class="fu">Fix1</span>(stack, sample <span class="op">-&gt;</span> sample.x), samples))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000×4 Array{Float64, 3}:
[:, :, 1] =
 -1.26616   -2.90873  -2.71623   …  -4.88506   -5.29726   -5.76876
  0.509164   2.2757    0.360332     -0.773066   0.796505  -0.172264
  2.02997    1.50609   2.36858       3.5132     6.15047    3.90874

[:, :, 2] =
 -2.66131   -3.37491  -4.34996   -4.58635  …  -3.6976    -4.29574  -4.00614
 -0.645395  -1.21813  -0.080664  -2.33213     -0.725703  -0.59602   1.02473
  2.11633    3.56788   5.31661    5.23423      3.92679    5.18645   4.51785

[:, :, 3] =
 -1.73677   -3.37427    -4.74633   -4.13937  …  -3.37377   -5.25781  -5.83557
  0.759289  -0.0749482   0.346811   1.25652      0.552104   1.25557   1.75795
  3.40292    4.67962     4.20513    4.29201      5.54681    3.78244   3.81347

[:, :, 4] =
 -4.1432    -3.03461  -3.53911  -3.78056   …  -4.68784   -4.68784   -4.37558
 -0.990043  -1.96478   1.39327  -0.744079      0.534586   0.534586  -0.171496
  3.65113    3.57743   4.01166   4.18707       4.45022    4.45022    6.06992</code></pre>
</div>
</div>
<p>But the fact that we have to provide the <code>AbstractMCMC.sample</code> call, etc. with an <code>initial_state</code> to get started is a bit annoying. We can avoid this by also defining a <code>AbstractMCMC.step</code> <em>without</em> the <code>state</code> argument:</p>
<div id="36" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">::</span><span class="dt">MALA</span>;</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># </span><span class="al">NOTE</span><span class="co">: No state provided!</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just create the initial state by sampling using  a Gaussian.</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="fu">randn</span>(rng, LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(x), <span class="fu">MALAState</span>(x)</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Equipped with this, we no longer need to provide the <code>initial_state</code> everywhere:</p>
<div id="38" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -5.01313    1.00575
  0.0116864  0.99907
  4.9935     0.996626</code></pre>
</div>
</div>
</section>
<section id="using-our-sampler-with-turing.jl" class="level2">
<h2 class="anchored" data-anchor-id="using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</h2>
<p>As we promised, all of this hassle of implementing our <code>MALA</code> sampler in a way that uses <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> and <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> gets us something more than <em>just</em> an “automatic” implementation of <code>AbstractMCMC.sample</code>.</p>
<p>It also enables use with Turing.jl through the <code>externalsampler</code>, but we need to do one final thing first: we need to tell Turing.jl how to extract a vector of parameters from the “sample” returned in our implementation of <code>AbstractMCMC.step</code>. In our case, the “sample” is a <code>MALASample</code>, so we just need the following line:</p>
<div id="40" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load Turing.jl.</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Turing</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Overload the `getparams` method for our "sample" type, which is just a vector.</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>Turing.Inference.<span class="fu">getparams</span>(<span class="op">::</span><span class="dt">Turing.Model</span>, sample<span class="op">::</span><span class="dt">MALASample</span>) <span class="op">=</span> sample.x</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And with that, we’re good to go!</p>
<div id="42" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Our previous model defined as a Turing.jl model.</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">mvnormal_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">MvNormal</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.], I)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate our model.</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">mvnormal_model</span>()</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Call `sample` but now we're passing in a Turing.jl `model` and wrapping</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co"># our `MALA` sampler in the `externalsampler` to tell Turing.jl that the sampler</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co"># expects something that implements LogDensityProblems.jl.</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×4×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 2.89 seconds
Compute duration  = 2.89 seconds
parameters        = x[1], x[2], x[3]
internals         = lp

Summary Statistics
  parameters      mean       std      mcse    ess_bulk    ess_tail      rhat   ⋯
      Symbol   Float64   Float64   Float64     Float64     Float64   Float64   ⋯

        x[1]   -5.0424    0.9965    0.0178   3117.5457   5050.7005    1.0001   ⋯
        x[2]   -0.0222    1.0126    0.0185   3001.5236   4530.9895    1.0000   ⋯
        x[3]    5.0306    0.9999    0.0178   3154.1560   5583.4046    1.0000   ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

        x[1]   -7.0280   -5.7037   -5.0450   -4.3659   -3.0765
        x[2]   -2.0053   -0.7138   -0.0293    0.6693    1.9485
        x[3]    3.1181    4.3405    5.0235    5.7157    6.9952</code></pre>
</div>
</div>
<p>Pretty neat, eh?</p>
<section id="models-with-constrained-parameters" class="level3">
<h3 class="anchored" data-anchor-id="models-with-constrained-parameters">Models with constrained parameters</h3>
<p>One thing we’ve sort of glossed over in all of the above is that MALA, at least how we’ve implemented it, requires <span class="math inline">\(x\)</span> to live in <span class="math inline">\(\mathbb{R}^d\)</span> for some <span class="math inline">\(d &gt; 0\)</span>. If some of the parameters were in fact constrained, e.g.&nbsp;we were working with a <code>Beta</code> distribution which has support on the interval <span class="math inline">\((0, 1)\)</span>, <em>not</em> on <span class="math inline">\(\mathbb{R}^d\)</span>, we could easily end up outside of the valid range <span class="math inline">\((0, 1)\)</span>.</p>
<div id="44" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">beta_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">beta_model</span>()</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 1.94 seconds
Compute duration  = 1.94 seconds
parameters        = x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse    ess_bulk    ess_tail      rhat   ⋯
      Symbol   Float64   Float64   Float64     Float64     Float64   Float64   ⋯

           x    0.4981    0.1870    0.0027   4569.0235   6098.9547    1.0000   ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

           x    0.1462    0.3615    0.5003    0.6360    0.8504</code></pre>
</div>
</div>
<p>Yep, that still works, but only because Turing.jl actually <em>transforms</em> the <code>turing_model</code> from constrained to unconstrained, so that the <code>sampler</code> provided to <code>externalsampler</code> is actually always working in unconstrained space! This is not always desirable, so we can turn this off:</p>
<div id="46" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 0.15 seconds
Compute duration  = 0.15 seconds
parameters        = x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse   ess_bulk   ess_tail      rhat   e ⋯
      Symbol   Float64   Float64   Float64    Float64    Float64   Float64     ⋯

           x    0.4616    0.1553    0.0178    65.8024    34.1951    1.0252     ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

           x    0.1973    0.3340    0.4557    0.5813    0.7614</code></pre>
</div>
</div>
<p>The fun thing is that this still sort of works because</p>
<div id="48" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">logpdf</span>(<span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>), <span class="fl">10.0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-Inf</code></pre>
</div>
</div>
<p>and so the samples that fall outside of the range are always rejected. But do notice how much worse all the diagnostics are, e.g.&nbsp;<code>ess_tail</code> is very poor compared to when we use <code>unconstrained=true</code>. Moreover, in more complex cases this won’t just result in a “nice” <code>-Inf</code> log-density value, but instead will error:</p>
<div id="50" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="kw">function</span> <span class="fu">demo</span>()</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>    σ² <span class="op">~</span> <span class="fu">truncated</span>(<span class="fu">Normal</span>(), lower<span class="op">=</span><span class="fl">0</span>)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If we end up with negative values for `σ²`, the `Normal` will error.</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>    x <span class="op">~</span> <span class="fu">Normal</span>(<span class="fl">0</span>, σ²)</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>DomainError: DomainError(-0.19618810163200956, "Normal: the condition σ &gt;= zero(σ) is not satisfied.")
DomainError with -0.19618810163200956:
Normal: the condition σ &gt;= zero(σ) is not satisfied.
Stacktrace:
  [1] #371
    @ ~/.julia/packages/Distributions/gGoCk/src/univariate/continuous/normal.jl:37 [inlined]
  [2] check_args
    @ ~/.julia/packages/Distributions/gGoCk/src/utils.jl:89 [inlined]
  [3] #Normal#370
    @ ~/.julia/packages/Distributions/gGoCk/src/univariate/continuous/normal.jl:37 [inlined]
  [4] Normal
    @ ~/.julia/packages/Distributions/gGoCk/src/univariate/continuous/normal.jl:36 [inlined]
  [5] Normal
    @ ~/.julia/packages/Distributions/gGoCk/src/univariate/continuous/normal.jl:42 [inlined]
  [6] macro expansion
    @ ~/.julia/packages/DynamicPPL/Jf0cM/src/compiler.jl:584 [inlined]
  [7] demo
    @ ~/work/docs/docs/tutorials/docs-17-implementing-samplers/index.qmd:593 [inlined]
  [8] _evaluate!!
    @ ~/.julia/packages/DynamicPPL/Jf0cM/src/model.jl:914 [inlined]
  [9] evaluate_threadsafe!!(model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, varinfo::DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, context::DynamicPPL.ValuesAsInModelContext{OrderedDict{Any, Any}, DynamicPPL.DefaultContext})
    @ DynamicPPL ~/.julia/packages/DynamicPPL/Jf0cM/src/model.jl:903
 [10] evaluate!!
    @ ~/.julia/packages/DynamicPPL/Jf0cM/src/model.jl:833 [inlined]
 [11] values_as_in_model
    @ ~/.julia/packages/DynamicPPL/Jf0cM/src/values_as_in_model.jl:196 [inlined]
 [12] values_as_in_model
    @ ~/.julia/packages/DynamicPPL/Jf0cM/src/values_as_in_model.jl:195 [inlined]
 [13] getparams(model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, vi::DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64})
    @ Turing.Inference ~/.julia/packages/Turing/nwmUC/src/mcmc/Inference.jl:383
 [14] Turing.Inference.Transition(model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, vi::DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, t::MALASample{Vector{Float64}})
    @ Turing.Inference ~/.julia/packages/Turing/nwmUC/src/mcmc/Inference.jl:258
 [15] transition_to_turing
    @ ~/.julia/packages/Turing/nwmUC/src/mcmc/abstractmcmc.jl:12 [inlined]
 [16] transition_to_turing(f::LogDensityProblemsADForwardDiffExt.ForwardDiffLogDensity{LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, Nothing}, ForwardDiff.Chunk{2}, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}, transition::MALASample{Vector{Float64}})
    @ Turing.Inference ~/.julia/packages/Turing/nwmUC/src/mcmc/abstractmcmc.jl:17
 [17] step(rng::TaskLocalRNG, model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, sampler_wrapper::DynamicPPL.Sampler{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}; initial_state::Nothing, initial_params::Nothing, kwargs::@Kwargs{})
    @ Turing.Inference ~/.julia/packages/Turing/nwmUC/src/mcmc/abstractmcmc.jl:147
 [18] macro expansion
    @ ~/.julia/packages/AbstractMCMC/FSyVk/src/sample.jl:0 [inlined]
 [19] macro expansion
    @ ~/.julia/packages/AbstractMCMC/FSyVk/src/logging.jl:16 [inlined]
 [20] mcmcsample(rng::TaskLocalRNG, model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, sampler::DynamicPPL.Sampler{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}, N::Int64; progress::Bool, progressname::String, callback::Nothing, num_warmup::Int64, discard_initial::Int64, thinning::Int64, chain_type::Type, initial_state::Nothing, kwargs::@Kwargs{})
    @ AbstractMCMC ~/.julia/packages/AbstractMCMC/FSyVk/src/sample.jl:142
 [21] sample(rng::TaskLocalRNG, model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, sampler::DynamicPPL.Sampler{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}, N::Int64; chain_type::Type, resume_from::Nothing, initial_state::Nothing, kwargs::@Kwargs{progress::Bool})
    @ DynamicPPL ~/.julia/packages/DynamicPPL/Jf0cM/src/sampler.jl:107
 [22] sample
    @ ~/.julia/packages/DynamicPPL/Jf0cM/src/sampler.jl:97 [inlined]
 [23] #sample#4
    @ ~/.julia/packages/Turing/nwmUC/src/mcmc/Inference.jl:305 [inlined]
 [24] sample
    @ ~/.julia/packages/Turing/nwmUC/src/mcmc/Inference.jl:296 [inlined]
 [25] #sample#3
    @ ~/.julia/packages/Turing/nwmUC/src/mcmc/Inference.jl:293 [inlined]
 [26] top-level scope
    @ ~/work/docs/docs/tutorials/docs-17-implementing-samplers/index.qmd:595</code></pre>
</div>
</div>
<p>As expected, we run into a <code>DomainError</code> at some point, while if we set <code>unconstrained=true</code>, letting Turing.jl transform the model to a unconstrained form behind the scenes, everything works as expected:</p>
<div id="52" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 1.96 seconds
Compute duration  = 1.96 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse   ess_bulk   ess_tail      rhat   e ⋯
      Symbol   Float64   Float64   Float64    Float64    Float64   Float64     ⋯

          σ²    1.3468    1.0895    0.2105    36.2029        NaN    1.1942     ⋯
           x    0.6327    1.5131    0.2789    41.9252   164.0532    1.1102     ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

          σ²    0.1085    0.4799    0.9507    1.9736    3.2237
           x   -1.9986   -0.2649    0.2106    1.4724    3.0743</code></pre>
</div>
</div>
<p>Neat!</p>
<p>Similarly, which automatic differentiation backend one should use can be specified through the <code>adtype</code> keyword argument too. For example, if we want to use <a href="https://github.com/JuliaDiff/ReverseDiff.jl">ReverseDiff.jl</a> instead of the default <a href="https://github.com/JuliaDiff/ForwardDiff.jl">ForwardDiff.jl</a>:</p>
<div id="54" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">ReverseDiff</span>: ReverseDiff</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify that we want to use `AutoReverseDiff`.</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">demo</span>(),</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>, adtype<span class="op">=</span><span class="fu">AutoReverseDiff</span>()),</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>;</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 3.76 seconds
Compute duration  = 3.76 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse   ess_bulk   ess_tail      rhat   e ⋯
      Symbol   Float64   Float64   Float64    Float64    Float64   Float64     ⋯

          σ²    0.9133    0.6223    0.0408   319.6884   169.0916    1.0004     ⋯
           x    0.0937    1.1384    0.1116   186.6826    85.5066    1.0003     ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

          σ²    0.1497    0.4294    0.7759    1.2612    2.5570
           x   -2.3419   -0.4278    0.0091    0.5295    4.0217</code></pre>
</div>
</div>
<p>Double-neat.</p>
</section>
</section>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<p>At this point it’s worth maybe reminding ourselves what we did and also <em>why</em> we did it:</p>
<ol type="1">
<li>We define our models in the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface because it makes the sampler agnostic to how the underlying model is implemented.</li>
<li>We implement our sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> interface, which just means that our sampler is a subtype of <code>AbstractMCMC.AbstractSampler</code> and we implement the MCMC transition in <code>AbstractMCMC.step</code>.</li>
<li>Points 1 and 2 makes it so our sampler can be used with a wide range of model implementations, amongst them being models implemented in both Turing.jl and Stan. This gives you, the inference implementer, a large collection of models to test your inference method on, in addition to allowing users of Turing.jl and Stan to try out your inference method with minimal effort.</li>
</ol>


</section>


<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a><div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>We’re going with the leapfrog formulation because in a future version of this tutorial we’ll add a section extending this simple “baseline” MALA sampler to more complex versions. See <a href="https://github.com/TuringLang/docs/issues/479">issue #479</a> for progress on this.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>There is no such thing as a proper interface in Julia (at least not officially), and so we use the word “interface” here to mean a few minimal methods that needs to be implemented by any type that we treat as a target model.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/turinglang\.org\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../tutorials/docs-07-for-developers-variational-inference/index.html" class="pagination-link" aria-label="Variational Inference">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Variational Inference</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Turing is created by <a href="http://mlg.eng.cam.ac.uk/hong/" target="_blank">Hong Ge</a>, and lovingly maintained by the <a href="https://github.com/TuringLang/Turing.jl/graphs/contributors" target="_blank">core team</a> of volunteers. <br> The contents of this website are © 2024 under the terms of the <a href="https://github.com/TuringLang/Turing.jl/blob/master/LICENCE" target="_blank">MIT License</a>.</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/TuringLang/docs/edit/master/tutorials/docs-17-implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/docs/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://x.com/TuringLang">
      <i class="bi bi-twitter" role="img" aria-label="Turing Twitter">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/TuringLang/Turing.jl">
      <i class="bi bi-github" role="img" aria-label="Turing GitHub">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




<script src="../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>