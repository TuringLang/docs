<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Implementing samplers – Turing.jl</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../tutorials/docs-07-for-developers-variational-inference/index.html" rel="prev">
<link href="../../assets/favicon.ico" rel="icon">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<style>
  a {
    text-decoration: none;
  }
  a:hover {
    text-decoration: underline;
  }
</style>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../theming/styles.css">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="https://turinglang.org/" class="navbar-brand navbar-brand-logo">
    <img src="../../assets/images/turing-logo.svg" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="https://turinglang.org/">
    <span class="navbar-title">Turing.jl</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../tutorials/docs-00-getting-started/"> 
<span class="menu-text">Get Started</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../tutorials/00-introduction/"> 
<span class="menu-text">Tutorials</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/library/"> 
<span class="menu-text">Libraries</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/news/"> 
<span class="menu-text">News</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/team/"> 
<span class="menu-text">Team</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-v0.34" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">v0.34</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-v0.34">    
        <li>
    <a class="dropdown-item" href="https://turinglang.org/docs/changelog.html">
 <span class="dropdown-text">Changelog</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://turinglang.org/docs/versions.html">
 <span class="dropdown-text">All Versions</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools tools-wide">
    <a href="https://x.com/TuringLang" title="Turing Twitter" class="quarto-navigation-tool px-1" aria-label="Turing Twitter"><i class="bi bi-twitter"></i></a>
    <a href="https://github.com/TuringLang/Turing.jl" title="Turing GitHub" class="quarto-navigation-tool px-1" aria-label="Turing GitHub"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Developers</li><li class="breadcrumb-item"><a href="../../tutorials/docs-06-for-developers-interface/index.html">Inference (note: outdated)</a></li><li class="breadcrumb-item"><a href="../../tutorials/docs-17-implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false">
 <span class="menu-text">Users</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-00-getting-started/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Getting Started</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-12-using-turing-guide/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Core Functionality</span></a>
  </div>
</li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false">
 <span class="menu-text">Usage Tips</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-10-using-turing-autodiff/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Automatic Differentiation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/usage-custom-distribution/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Custom Distributions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/usage-probability-interface/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Querying Model Probabilities</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/usage-modifying-logprob/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Modifying the Log Probability</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/usage-generated-quantities/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Generated Quantities</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-17-mode-estimation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Mode Estimation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-13-using-turing-performance-tips/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Performance Tips</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-15-using-turing-sampler-viz/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Sampler Visualization</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-11-using-turing-dynamichmc/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using DynamicHMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-16-using-turing-external-samplers/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using External Samplers</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false">
 <span class="menu-text">Tutorials</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/00-introduction/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction: Coin Flipping</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/01-gaussian-mixture-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Mixture Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/02-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/03-bayesian-neural-network/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Neural Networks</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/04-hidden-markov-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Hidden Markov Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/05-linear-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Linear Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/06-infinite-mixture-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Infinite Mixture Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/07-poisson-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Poisson Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/08-multinomial-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Multinomial Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/09-variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/10-bayesian-differential-equations/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Differential Equations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/11-probabilistic-pca/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Probabilistic PCA</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/13-seasonal-time-series/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Time Series Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/15-gaussian-processes/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction to Gaussian Processes</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/12-gplvm/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Process Latent Variable Models</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Developers</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false">
 <span class="menu-text">Contributing</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-01-contributing-guide/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">How to Contribute</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="false">
 <span class="menu-text">DynamicPPL in Depth</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/dev-model-manual/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Manually Defining a Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-05-for-developers-compiler/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Turing Compiler Design</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/14-minituring/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation I: Compiler</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/16-contexts/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation II: Contexts</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true">
 <span class="menu-text">Inference (note: outdated)</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-06-for-developers-interface/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Interface Guide</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-04-for-developers-abstractmcmc-turing/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">How Turing implements AbstractMCMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-07-for-developers-variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-17-implementing-samplers/index.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Implementing Samplers</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of Contents</h2>
   
  <ul>
  <li><a href="#quick-overview-of-mala" id="toc-quick-overview-of-mala" class="nav-link active" data-scroll-target="#quick-overview-of-mala">Quick overview of MALA</a></li>
  <li><a href="#what-we-need-from-a-model-logdensityproblems.jl" id="toc-what-we-need-from-a-model-logdensityproblems.jl" class="nav-link" data-scroll-target="#what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: LogDensityProblems.jl</a></li>
  <li><a href="#implementing-mala-in-abstractmcmc.jl" id="toc-implementing-mala-in-abstractmcmc.jl" class="nav-link" data-scroll-target="#implementing-mala-in-abstractmcmc.jl">Implementing MALA in AbstractMCMC.jl</a></li>
  <li><a href="#using-our-sampler-with-turing.jl" id="toc-using-our-sampler-with-turing.jl" class="nav-link" data-scroll-target="#using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</a>
  <ul class="collapse">
  <li><a href="#models-with-constrained-parameters" id="toc-models-with-constrained-parameters" class="nav-link" data-scroll-target="#models-with-constrained-parameters">Models with constrained parameters</a></li>
  </ul></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/TuringLang/docs/edit/master/tutorials/docs-17-implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/docs/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Developers</li><li class="breadcrumb-item"><a href="../../tutorials/docs-06-for-developers-interface/index.html">Inference (note: outdated)</a></li><li class="breadcrumb-item"><a href="../../tutorials/docs-17-implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Implementing samplers</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>In this tutorial, we’ll go through step-by-step how to implement a “simple” sampler in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> in such a way that it can be easily applied to Turing.jl models.</p>
<p>In particular, we’re going to implement a version of <strong>Metropolis-adjusted Langevin (MALA)</strong>.</p>
<p>Note that we will implement this sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> framework, completely “ignoring” Turing.jl until the very end of the tutorial, at which point we’ll use a single line of code to make the resulting sampler available to Turing.jl. This is to really drive home the point that one can implement samplers in a way that is accessible to all of Turing.jl’s users without having to use Turing.jl yourself.</p>
<section id="quick-overview-of-mala" class="level2">
<h2 class="anchored" data-anchor-id="quick-overview-of-mala">Quick overview of MALA</h2>
<p>We can view MALA as a single step of the leapfrog intergrator with resampling of momentum <span class="math inline">\(p\)</span> at every step.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> To make that statement a bit more concrete, we first define the <em>extended</em> target <span class="math inline">\(\bar{\gamma}(x, p)\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\log \bar{\gamma}(x, p) \propto \log \gamma(x) + \log \gamma_{\mathcal{N}(0, M)}(p)
\end{equation*}\]</span></p>
<p>where <span class="math inline">\(\gamma_{\mathcal{N}(0, M)}\)</span> denotes the density for a zero-centered Gaussian with covariance matrix <span class="math inline">\(M\)</span>. We then consider targeting this joint distribution over both <span class="math inline">\(x\)</span> and <span class="math inline">\(p\)</span> as follows. First we define the map</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  L_{\epsilon}: \quad &amp; \mathbb{R}^d \times \mathbb{R}^d \to \mathbb{R}^d \times \mathbb{R}^d \\
  &amp; (x, p) \mapsto (\tilde{x}, \tilde{p}) := L_{\epsilon}(x, p)
\end{split}
\end{equation*}\]</span></p>
<p>as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p_{1 / 2} &amp;:= p + \frac{\epsilon}{2} \nabla \log \gamma(x) \\
  \tilde{x} &amp;:= x + \epsilon M^{-1} p_{1 /2 } \\
  p_1 &amp;:= p_{1 / 2} + \frac{\epsilon}{2} \nabla \log \gamma(\tilde{x}) \\
  \tilde{p} &amp;:= - p_1
\end{split}
\end{equation*}\]</span></p>
<p>This might be familiar for some readers as a single step of the Leapfrog integrator. We then define the MALA kernel as follows: given the current iterate <span class="math inline">\(x_i\)</span>, we sample the next iterate <span class="math inline">\(x_{i + 1}\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p &amp;\sim \mathcal{N}(0, M) \\
  (\tilde{x}, \tilde{p}) &amp;:= L_{\epsilon}(x_i, p) \\
  \alpha &amp;:= \min \left\{ 1, \frac{\bar{\gamma}(\tilde{x}, \tilde{p})}{\bar{\gamma}(x_i, p)} \right\} \\
  x_{i + 1} &amp;:=
  \begin{cases}
    \tilde{x} \quad &amp; \text{ with prob. } \alpha \\
    x_i       \quad &amp; \text{ with prob. } 1 - \alpha
  \end{cases}
\end{split}
\end{equation*}\]</span></p>
<p>i.e.&nbsp;we accept the proposal <span class="math inline">\(\tilde{x}\)</span> with probability <span class="math inline">\(\alpha\)</span> and reject it, thus sticking with our current iterate, with probability <span class="math inline">\(1 - \alpha\)</span>.</p>
</section>
<section id="what-we-need-from-a-model-logdensityproblems.jl" class="level2">
<h2 class="anchored" data-anchor-id="what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a></h2>
<p>There are a few things we need from the “target” / “model” / density that we want to sample from:</p>
<ol type="1">
<li>We need access to log-density <em>evaluations</em> <span class="math inline">\(\log \gamma(x)\)</span> so we can compute the acceptance ratio involving <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>We need access to log-density <em>gradients</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span> so we can compute the Leapfrog steps <span class="math inline">\(L_{\epsilon}(x, p)\)</span>.</li>
<li>We also need access to the “size” of the model so we can determine the size of <span class="math inline">\(M\)</span>.</li>
</ol>
<p>Luckily for us, there is a package called <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> which provides an interface for <em>exactly</em> this!</p>
<p>To demonstrate how one can implement the “<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface”<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> we will use a simple Gaussian model as an example:</p>
<div id="4" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblems</span>: LogDensityProblems;</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's define some type that represents the model.</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> IsotropicNormalModel{M<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"mean of the isotropic Gaussian"</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    mean<span class="op">::</span><span class="dt">M</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Specifies what input length the model expects.</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">dimension</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> <span class="fu">length</span>(model.mean)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Implementation of the log-density evaluation of the model.</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x<span class="op">::</span><span class="dt">AbstractVector{&lt;:Real}</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">-</span> <span class="fu">sum</span>(abs2, x <span class="op">.-</span> model.mean) <span class="op">/</span> <span class="fl">2</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This gives us all of the properties we want for our MALA sampler with the exception of the computation of the <em>gradient</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span>. There is the method <code>LogDensityProblems.logdensity_and_gradient</code> which should return a 2-tuple where the first entry is the evaluation of the logdensity <span class="math inline">\(\log \gamma(x)\)</span> and the second entry is the gradient <span class="math inline">\(\nabla \log \gamma(x)\)</span>.</p>
<p>There are two ways to “implement” this method: 1) we implement it by hand, which is feasible in the case of our <code>IsotropicNormalModel</code>, or b) we defer the implementation of this to a automatic differentiation backend.</p>
<p>To implement it by hand we can simply do</p>
<div id="6" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl that first-order, i.e. gradient information, is available.</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{1}</span>()</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Implement `logdensity_and_gradient`.</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    logγ_x <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="op">-</span>x <span class="op">.*</span> (x <span class="op">-</span> model.mean)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> logγ_x, ∇logγ_x</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s just try it out:</p>
<div id="8" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate the problem.</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> <span class="fu">IsotropicNormalModel</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.])</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create some example input that we can test on.</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>x_example <span class="op">=</span> <span class="fu">randn</span>(LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate!</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-23.79106824768798</code></pre>
</div>
</div>
<p>To defer it to an automatic differentiation backend, we can do</p>
<div id="10" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl we only have access to 0-th order information.</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{0}</span>()</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Use `LogDensityProblemsAD`'s `ADgradient` in combination with some AD backend to implement `logdensity_and_gradient`.</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblemsAD</span>, <span class="bu">ADTypes</span>, <span class="bu">ForwardDiff</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>model_with_grad <span class="op">=</span> <span class="fu">ADgradient</span>(<span class="fu">AutoForwardDiff</span>(), model)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model_with_grad, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-23.79106824768798</code></pre>
</div>
</div>
<p>We’ll continue with the second approach in this tutorial since this is typically what one does in practice, because there are better hobbies to spend time on than deriving gradients by hand.</p>
<p>At this point, one might wonder how we’re going to tie this back to Turing.jl in the end. Effectively, when working with inference methods that only require log-density evaluations and / or higher-order information of the log-density, Turing.jl actually converts the user-provided <code>Model</code> into an object implementing the above methods for <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>. As a result, most samplers provided by Turing.jl are actually implemented to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, enabling their use both <em>within</em> Turing.jl and <em>outside</em> of Turing.jl! Morever, there exists similar conversions for Stan through BridgeStan and Stan<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, which means that a sampler supporting the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface can easily be used on both Turing.jl <em>and</em> Stan models (in addition to user-provided models, as our <code>IsotropicNormalModel</code> above)!</p>
<p>Anyways, let’s move on to actually implementing the sampler.</p>
</section>
<section id="implementing-mala-in-abstractmcmc.jl" class="level2">
<h2 class="anchored" data-anchor-id="implementing-mala-in-abstractmcmc.jl">Implementing MALA in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a></h2>
<p>Now that we’ve established that a model implementing the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface provides us with all the information we need from <span class="math inline">\(\log \gamma(x)\)</span>, we can address the question: given an object that implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, how can we define a sampler for it?</p>
<p>We’re going to do this by making our sampler a sub-type of <code>AbstractMCMC.AbstractSampler</code> in addition to implementing a few methods from <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>. Why? Because it gets us <em>a lot</em> of functionality for free, as we will see later.</p>
<p>Moreover, <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> provides a very natural interface for MCMC algorithms.</p>
<p>First, we’ll define our <code>MALA</code> type</p>
<div id="12" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">AbstractMCMC</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALA{T,A} <span class="op">&lt;:</span><span class="dt"> AbstractMCMC.AbstractSampler</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"stepsize used in the leapfrog step"</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    ϵ_init<span class="op">::</span><span class="dt">T</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"covariance matrix used for the momentum"</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    M_init<span class="op">::</span><span class="dt">A</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notice how we’ve added the suffix <code>_init</code> to both the stepsize and the covariance matrix. We’ve done this because a <code>AbstractMCMC.AbstractSampler</code> should be <em>immutable</em>. Of course there might be many scenarios where we want to allow something like the stepsize and / or the covariance matrix to vary between iterations, e.g.&nbsp;during the burn-in / adaptation phase of the sampling process we might want to adjust the parameters using statistics computed from these initial iterations. But information which can change between iterations <em>should not go in the sampler itself</em>! Instead, this information should go in the sampler <em>state</em>.</p>
<p>The sampler state should at the very least contain all the necessary information to perform the next MCMC iteration, but usually contains further information, e.g.&nbsp;quantities and statistics useful for evaluating whether the sampler has converged.</p>
<p>We will use the following sampler state for our <code>MALA</code> sampler:</p>
<div id="14" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALAState{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This might seem overly redundant: we’re defining a type <code>MALAState</code> and it only contains a simple vector of reals. In this particular case we indeed could have dropped this and simply used a <code>AbstractVector{&lt;:Real}</code> as our sampler state, but typically, as we will see later, one wants to include other quantities in the sampler state. For example, if we also wanted to adapt the parameters of our <code>MALA</code>, e.g.&nbsp;alter the stepsize depending on acceptance rates, in which case we should also put <code>ϵ</code> in the state, but for now we’ll keep things simple.</p>
<p>Moreover, we also want a <em>sample</em> type, which is a type meant for “public consumption”, i.e.&nbsp;the end-user. This is generally going to contain a subset of the information present in the state. But in such a simple scenario as this, we similarly only have a <code>AbstractVector{&lt;:Real}</code>:</p>
<div id="16" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALASample{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We currently have three things:</p>
<ol type="1">
<li>A <code>AbstractMCMC.AbstractSampler</code> implementation called <code>MALA</code>.</li>
<li>A state <code>MALAState</code> for our sampler <code>MALA</code>.</li>
<li>A sample <code>MALASample</code> for our sampler <code>MALA</code>.</li>
</ol>
<p>That means that we’re ready to implement the only thing that really matters: <code>AbstractMCMC.step</code>.</p>
<p><code>AbstractMCMC.step</code> defines the MCMC iteration of our <code>MALA</code> given the current <code>MALAState</code>. Specifically, the signature of the function is as follows:</p>
<div id="18" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The RNG to ensure reproducibility.</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The model that defines our target.</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.AbstractModel</span>,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The sampler for which we're taking a `step`.</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">AbstractMCMC.AbstractSampler</span>,</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The current sampler `state`.</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    state;</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Additional keyword arguments that we may or may not need.</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Moreover, there is a specific <code>AbstractMCMC.AbstractModel</code> which is used to indicate that the model that is provided implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface: <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Since, as we discussed earlier, in our case we’re indeed going to work with types that support the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, we’ll define <code>AbstractMCMC.step</code> for such a <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Note that <code>AbstractMCMC.LogDensityModel</code> has no other purpose; it has a single field called <code>logdensity</code>, and it does nothing else. But by wrapping the model in <code>AbstractMCMC.LogDensityModel</code>, it allows samplers that want to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> to define their <code>AbstractMCMC.step</code> on this type without running into method ambiguities.</p>
<p>All in all, that means that the signature for our <code>AbstractMCMC.step</code> is going to be the following:</p>
<div id="20" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># `LogDensityModel` so we know we're working with LogDensityProblems.jl model.</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler.</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler state.</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Great! Now let’s actually implement the full <code>AbstractMCMC.step</code> for our <code>MALA</code>.</p>
<p>Let’s remind ourselves what we’re going to do:</p>
<ol type="1">
<li>Sample a new momentum <span class="math inline">\(p\)</span>.</li>
<li>Compute the log-density of the extended target <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>Take a single leapfrog step <span class="math inline">\((\tilde{x}, \tilde{p}) = L_{\epsilon}(x, p)\)</span>.</li>
<li>Accept or reject the proposed <span class="math inline">\((\tilde{x}, \tilde{p})\)</span>.</li>
</ol>
<p>All in all, this results in the following:</p>
<div id="22" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>: Random</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Distributions</span>  <span class="co"># so we get the `MvNormal`</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the wrapped model which implements LogDensityProblems.jl.</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just extract the sampler parameters to make our lives easier.</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    ϵ <span class="op">=</span> sampler.ϵ_init</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    M <span class="op">=</span> sampler.M_init</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the current parameters.</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> state.x</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sample the momentum.</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>    p_dist <span class="op">=</span> <span class="fu">MvNormal</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)), M)</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> <span class="fu">rand</span>(rng, p_dist)</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Propose using a single leapfrog step.</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>    x̃, p̃ <span class="op">=</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Accept or reject proposal.</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>    logp <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p)</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>    logp̃ <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x̃) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p̃)</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>    logα <span class="op">=</span> logp̃ <span class="op">-</span> logp</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>    state_new <span class="op">=</span> <span class="cf">if</span> <span class="fu">log</span>(<span class="fu">rand</span>(rng)) <span class="op">&lt;</span> logα</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Accept.</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x̃)</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Reject.</span></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x)</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return the "sample" and the sampler state.</span></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(state_new.x), state_new</span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Fairly straight-forward.</p>
<p>Of course, we haven’t defined the <code>leapfrog_step</code> method yet, so let’s do that:</p>
<div id="24" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p` using "position" `x`.</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x))</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    p1 <span class="op">=</span> p <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update the "position" `x` using momentum `p1`.</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    x̃ <span class="op">=</span> x <span class="op">+</span> ϵ <span class="op">.*</span> (M <span class="op">\</span> p1)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p1` using position `x̃`</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x̃ <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x̃))</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    p2 <span class="op">=</span> p1 <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x̃</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Flip momentum `p2`.</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    p̃ <span class="op">=</span> <span class="op">-</span>p2</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x̃, p̃</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>leapfrog_step (generic function with 1 method)</code></pre>
</div>
</div>
<p>With all of this, we’re technically ready to sample!</p>
<div id="26" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>, <span class="bu">LinearAlgebra</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>rng <span class="op">=</span> <span class="bu">Random</span>.<span class="fu">default_rng</span>()</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>sampler <span class="op">=</span> <span class="fu">MALA</span>(<span class="fl">1</span>, I)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>state <span class="op">=</span> <span class="fu">MALAState</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)))</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>x_next, state_next <span class="op">=</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    rng,</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    AbstractMCMC.<span class="fu">LogDensityModel</span>(model),</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    state</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>(MALASample{Vector{Float64}}([0.0, 0.0, 0.0]), MALAState{Vector{Float64}}([0.0, 0.0, 0.0]))</code></pre>
</div>
</div>
<p>Great, it works!</p>
<p>And I promised we would get quite some functionality for free if we implemented <code>AbstractMCMC.step</code>, and so we can now simply call <code>sample</code> to perform standard MCMC sampling:</p>
<div id="28" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform 1000 iterations with our `MALA` sampler.</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; initial_state<span class="op">=</span>state, progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Concatenate into a matrix.</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000 Matrix{Float64}:
 -3.67309   -3.86325   -2.94296   …  -5.01304   -4.92776   -4.90963
 -0.454228   0.513755   0.198781      0.990174  -0.507276   0.761453
  3.50519    6.63044    4.07475       5.46379    4.11675    3.83869</code></pre>
</div>
</div>
<div id="30" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the marginal means and standard deviations.</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -5.00494    0.997112
 -0.0277339  1.00653
  4.99483    0.991775</code></pre>
</div>
</div>
<p>Let’s visualize the samples</p>
<div id="32" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">StatsPlots</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">transpose</span>(samples_matrix[<span class="op">:</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">:</span><span class="kw">end</span>]), alpha<span class="op">=</span><span class="fl">0.5</span>, legend<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<!--?xml version="1.0" encoding="utf-8"?-->
<svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" width="672" height="480" viewbox="0 0 2688 1920">
<defs>
  <clippath id="clip030">
    <rect x="0" y="0" width="2688" height="1920"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip030)" d="M0 1920 L2688 1920 L2688 0 L0 0  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip031">
    <rect x="537" y="0" width="1883" height="1883"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip030)" d="M151.747 1800.78 L2640.76 1800.78 L2640.76 47.2441 L151.747 47.2441  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip032">
    <rect x="151" y="47" width="2490" height="1755"></rect>
  </clippath>
</defs>
<polyline clip-path="url(#clip032)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="219.84,1800.78 219.84,47.2441 "></polyline>
<polyline clip-path="url(#clip032)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="807.458,1800.78 807.458,47.2441 "></polyline>
<polyline clip-path="url(#clip032)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1395.08,1800.78 1395.08,47.2441 "></polyline>
<polyline clip-path="url(#clip032)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1982.69,1800.78 1982.69,47.2441 "></polyline>
<polyline clip-path="url(#clip032)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="2570.31,1800.78 2570.31,47.2441 "></polyline>
<polyline clip-path="url(#clip032)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,1513.55 2640.76,1513.55 "></polyline>
<polyline clip-path="url(#clip032)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,1205.55 2640.76,1205.55 "></polyline>
<polyline clip-path="url(#clip032)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,897.544 2640.76,897.544 "></polyline>
<polyline clip-path="url(#clip032)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,589.541 2640.76,589.541 "></polyline>
<polyline clip-path="url(#clip032)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,281.539 2640.76,281.539 "></polyline>
<polyline clip-path="url(#clip030)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1800.78 2640.76,1800.78 "></polyline>
<polyline clip-path="url(#clip030)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="219.84,1800.78 219.84,1781.88 "></polyline>
<polyline clip-path="url(#clip030)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="807.458,1800.78 807.458,1781.88 "></polyline>
<polyline clip-path="url(#clip030)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1395.08,1800.78 1395.08,1781.88 "></polyline>
<polyline clip-path="url(#clip030)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1982.69,1800.78 1982.69,1781.88 "></polyline>
<polyline clip-path="url(#clip030)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="2570.31,1800.78 2570.31,1781.88 "></polyline>
<path clip-path="url(#clip030)" d="M219.84 1834 Q216.229 1834 214.4 1837.57 Q212.595 1841.11 212.595 1848.24 Q212.595 1855.34 214.4 1858.91 Q216.229 1862.45 219.84 1862.45 Q223.474 1862.45 225.28 1858.91 Q227.108 1855.34 227.108 1848.24 Q227.108 1841.11 225.28 1837.57 Q223.474 1834 219.84 1834 M219.84 1830.3 Q225.65 1830.3 228.706 1834.9 Q231.784 1839.49 231.784 1848.24 Q231.784 1856.96 228.706 1861.57 Q225.65 1866.15 219.84 1866.15 Q214.03 1866.15 210.951 1861.57 Q207.896 1856.96 207.896 1848.24 Q207.896 1839.49 210.951 1834.9 Q214.03 1830.3 219.84 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip030)" d="M771.15 1861.55 L787.47 1861.55 L787.47 1865.48 L765.525 1865.48 L765.525 1861.55 Q768.187 1858.79 772.771 1854.16 Q777.377 1849.51 778.558 1848.17 Q780.803 1845.65 781.683 1843.91 Q782.585 1842.15 782.585 1840.46 Q782.585 1837.71 780.641 1835.97 Q778.72 1834.23 775.618 1834.23 Q773.419 1834.23 770.965 1835 Q768.535 1835.76 765.757 1837.31 L765.757 1832.59 Q768.581 1831.46 771.035 1830.88 Q773.488 1830.3 775.525 1830.3 Q780.896 1830.3 784.09 1832.98 Q787.285 1835.67 787.285 1840.16 Q787.285 1842.29 786.474 1844.21 Q785.687 1846.11 783.581 1848.7 Q783.002 1849.37 779.9 1852.59 Q776.798 1855.78 771.15 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip030)" d="M797.331 1830.92 L815.687 1830.92 L815.687 1834.86 L801.613 1834.86 L801.613 1843.33 Q802.632 1842.98 803.65 1842.82 Q804.669 1842.64 805.687 1842.64 Q811.474 1842.64 814.854 1845.81 Q818.233 1848.98 818.233 1854.4 Q818.233 1859.97 814.761 1863.08 Q811.289 1866.15 804.97 1866.15 Q802.794 1866.15 800.525 1865.78 Q798.28 1865.41 795.872 1864.67 L795.872 1859.97 Q797.956 1861.11 800.178 1861.66 Q802.4 1862.22 804.877 1862.22 Q808.882 1862.22 811.22 1860.11 Q813.558 1858.01 813.558 1854.4 Q813.558 1850.78 811.22 1848.68 Q808.882 1846.57 804.877 1846.57 Q803.002 1846.57 801.127 1846.99 Q799.275 1847.4 797.331 1848.28 L797.331 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip030)" d="M837.446 1834 Q833.835 1834 832.007 1837.57 Q830.201 1841.11 830.201 1848.24 Q830.201 1855.34 832.007 1858.91 Q833.835 1862.45 837.446 1862.45 Q841.081 1862.45 842.886 1858.91 Q844.715 1855.34 844.715 1848.24 Q844.715 1841.11 842.886 1837.57 Q841.081 1834 837.446 1834 M837.446 1830.3 Q843.256 1830.3 846.312 1834.9 Q849.391 1839.49 849.391 1848.24 Q849.391 1856.96 846.312 1861.57 Q843.256 1866.15 837.446 1866.15 Q831.636 1866.15 828.557 1861.57 Q825.502 1856.96 825.502 1848.24 Q825.502 1839.49 828.557 1834.9 Q831.636 1830.3 837.446 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip030)" d="M1354.69 1830.92 L1373.05 1830.92 L1373.05 1834.86 L1358.98 1834.86 L1358.98 1843.33 Q1360 1842.98 1361.01 1842.82 Q1362.03 1842.64 1363.05 1842.64 Q1368.84 1842.64 1372.22 1845.81 Q1375.6 1848.98 1375.6 1854.4 Q1375.6 1859.97 1372.12 1863.08 Q1368.65 1866.15 1362.33 1866.15 Q1360.16 1866.15 1357.89 1865.78 Q1355.64 1865.41 1353.24 1864.67 L1353.24 1859.97 Q1355.32 1861.11 1357.54 1861.66 Q1359.76 1862.22 1362.24 1862.22 Q1366.25 1862.22 1368.58 1860.11 Q1370.92 1858.01 1370.92 1854.4 Q1370.92 1850.78 1368.58 1848.68 Q1366.25 1846.57 1362.24 1846.57 Q1360.37 1846.57 1358.49 1846.99 Q1356.64 1847.4 1354.69 1848.28 L1354.69 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip030)" d="M1394.81 1834 Q1391.2 1834 1389.37 1837.57 Q1387.56 1841.11 1387.56 1848.24 Q1387.56 1855.34 1389.37 1858.91 Q1391.2 1862.45 1394.81 1862.45 Q1398.44 1862.45 1400.25 1858.91 Q1402.08 1855.34 1402.08 1848.24 Q1402.08 1841.11 1400.25 1837.57 Q1398.44 1834 1394.81 1834 M1394.81 1830.3 Q1400.62 1830.3 1403.68 1834.9 Q1406.75 1839.49 1406.75 1848.24 Q1406.75 1856.96 1403.68 1861.57 Q1400.62 1866.15 1394.81 1866.15 Q1389 1866.15 1385.92 1861.57 Q1382.87 1856.96 1382.87 1848.24 Q1382.87 1839.49 1385.92 1834.9 Q1389 1830.3 1394.81 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip030)" d="M1424.97 1834 Q1421.36 1834 1419.53 1837.57 Q1417.73 1841.11 1417.73 1848.24 Q1417.73 1855.34 1419.53 1858.91 Q1421.36 1862.45 1424.97 1862.45 Q1428.61 1862.45 1430.41 1858.91 Q1432.24 1855.34 1432.24 1848.24 Q1432.24 1841.11 1430.41 1837.57 Q1428.61 1834 1424.97 1834 M1424.97 1830.3 Q1430.78 1830.3 1433.84 1834.9 Q1436.92 1839.49 1436.92 1848.24 Q1436.92 1856.96 1433.84 1861.57 Q1430.78 1866.15 1424.97 1866.15 Q1419.16 1866.15 1416.08 1861.57 Q1413.03 1856.96 1413.03 1848.24 Q1413.03 1839.49 1416.08 1834.9 Q1419.16 1830.3 1424.97 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip030)" d="M1940.97 1830.92 L1963.19 1830.92 L1963.19 1832.91 L1950.65 1865.48 L1945.76 1865.48 L1957.57 1834.86 L1940.97 1834.86 L1940.97 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip030)" d="M1972.36 1830.92 L1990.71 1830.92 L1990.71 1834.86 L1976.64 1834.86 L1976.64 1843.33 Q1977.66 1842.98 1978.68 1842.82 Q1979.7 1842.64 1980.72 1842.64 Q1986.5 1842.64 1989.88 1845.81 Q1993.26 1848.98 1993.26 1854.4 Q1993.26 1859.97 1989.79 1863.08 Q1986.32 1866.15 1980 1866.15 Q1977.82 1866.15 1975.55 1865.78 Q1973.31 1865.41 1970.9 1864.67 L1970.9 1859.97 Q1972.98 1861.11 1975.21 1861.66 Q1977.43 1862.22 1979.9 1862.22 Q1983.91 1862.22 1986.25 1860.11 Q1988.59 1858.01 1988.59 1854.4 Q1988.59 1850.78 1986.25 1848.68 Q1983.91 1846.57 1979.9 1846.57 Q1978.03 1846.57 1976.15 1846.99 Q1974.3 1847.4 1972.36 1848.28 L1972.36 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip030)" d="M2012.47 1834 Q2008.86 1834 2007.03 1837.57 Q2005.23 1841.11 2005.23 1848.24 Q2005.23 1855.34 2007.03 1858.91 Q2008.86 1862.45 2012.47 1862.45 Q2016.11 1862.45 2017.91 1858.91 Q2019.74 1855.34 2019.74 1848.24 Q2019.74 1841.11 2017.91 1837.57 Q2016.11 1834 2012.47 1834 M2012.47 1830.3 Q2018.28 1830.3 2021.34 1834.9 Q2024.42 1839.49 2024.42 1848.24 Q2024.42 1856.96 2021.34 1861.57 Q2018.28 1866.15 2012.47 1866.15 Q2006.66 1866.15 2003.59 1861.57 Q2000.53 1856.96 2000.53 1848.24 Q2000.53 1839.49 2003.59 1834.9 Q2006.66 1830.3 2012.47 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip030)" d="M2514.84 1861.55 L2522.48 1861.55 L2522.48 1835.18 L2514.17 1836.85 L2514.17 1832.59 L2522.43 1830.92 L2527.11 1830.92 L2527.11 1861.55 L2534.75 1861.55 L2534.75 1865.48 L2514.84 1865.48 L2514.84 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip030)" d="M2554.19 1834 Q2550.58 1834 2548.75 1837.57 Q2546.94 1841.11 2546.94 1848.24 Q2546.94 1855.34 2548.75 1858.91 Q2550.58 1862.45 2554.19 1862.45 Q2557.82 1862.45 2559.63 1858.91 Q2561.46 1855.34 2561.46 1848.24 Q2561.46 1841.11 2559.63 1837.57 Q2557.82 1834 2554.19 1834 M2554.19 1830.3 Q2560 1830.3 2563.06 1834.9 Q2566.13 1839.49 2566.13 1848.24 Q2566.13 1856.96 2563.06 1861.57 Q2560 1866.15 2554.19 1866.15 Q2548.38 1866.15 2545.3 1861.57 Q2542.25 1856.96 2542.25 1848.24 Q2542.25 1839.49 2545.3 1834.9 Q2548.38 1830.3 2554.19 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip030)" d="M2584.35 1834 Q2580.74 1834 2578.91 1837.57 Q2577.11 1841.11 2577.11 1848.24 Q2577.11 1855.34 2578.91 1858.91 Q2580.74 1862.45 2584.35 1862.45 Q2587.99 1862.45 2589.79 1858.91 Q2591.62 1855.34 2591.62 1848.24 Q2591.62 1841.11 2589.79 1837.57 Q2587.99 1834 2584.35 1834 M2584.35 1830.3 Q2590.16 1830.3 2593.22 1834.9 Q2596.3 1839.49 2596.3 1848.24 Q2596.3 1856.96 2593.22 1861.57 Q2590.16 1866.15 2584.35 1866.15 Q2578.54 1866.15 2575.46 1861.57 Q2572.41 1856.96 2572.41 1848.24 Q2572.41 1839.49 2575.46 1834.9 Q2578.54 1830.3 2584.35 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip030)" d="M2614.51 1834 Q2610.9 1834 2609.07 1837.57 Q2607.27 1841.11 2607.27 1848.24 Q2607.27 1855.34 2609.07 1858.91 Q2610.9 1862.45 2614.51 1862.45 Q2618.15 1862.45 2619.95 1858.91 Q2621.78 1855.34 2621.78 1848.24 Q2621.78 1841.11 2619.95 1837.57 Q2618.15 1834 2614.51 1834 M2614.51 1830.3 Q2620.32 1830.3 2623.38 1834.9 Q2626.46 1839.49 2626.46 1848.24 Q2626.46 1856.96 2623.38 1861.57 Q2620.32 1866.15 2614.51 1866.15 Q2608.7 1866.15 2605.62 1861.57 Q2602.57 1856.96 2602.57 1848.24 Q2602.57 1839.49 2605.62 1834.9 Q2608.7 1830.3 2614.51 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip030)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1800.78 151.747,47.2441 "></polyline>
<polyline clip-path="url(#clip030)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1513.55 170.644,1513.55 "></polyline>
<polyline clip-path="url(#clip030)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1205.55 170.644,1205.55 "></polyline>
<polyline clip-path="url(#clip030)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,897.544 170.644,897.544 "></polyline>
<polyline clip-path="url(#clip030)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,589.541 170.644,589.541 "></polyline>
<polyline clip-path="url(#clip030)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,281.539 170.644,281.539 "></polyline>
<path clip-path="url(#clip030)" d="M49.5521 1514 L79.2279 1514 L79.2279 1517.93 L49.5521 1517.93 L49.5521 1514 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip030)" d="M99.8991 1511.68 Q96.7509 1511.68 94.8991 1513.84 Q93.0704 1515.99 93.0704 1519.74 Q93.0704 1523.47 94.8991 1525.64 Q96.7509 1527.8 99.8991 1527.8 Q103.047 1527.8 104.876 1525.64 Q106.728 1523.47 106.728 1519.74 Q106.728 1515.99 104.876 1513.84 Q103.047 1511.68 99.8991 1511.68 M109.181 1497.03 L109.181 1501.29 Q107.422 1500.46 105.617 1500.02 Q103.834 1499.58 102.075 1499.58 Q97.4454 1499.58 94.9917 1502.7 Q92.5612 1505.83 92.2139 1512.15 Q93.5797 1510.13 95.6398 1509.07 Q97.7 1507.98 100.177 1507.98 Q105.385 1507.98 108.394 1511.15 Q111.427 1514.3 111.427 1519.74 Q111.427 1525.06 108.279 1528.28 Q105.131 1531.5 99.8991 1531.5 Q93.9037 1531.5 90.7325 1526.92 Q87.5612 1522.31 87.5612 1513.58 Q87.5612 1505.39 91.45 1500.53 Q95.3389 1495.64 101.89 1495.64 Q103.649 1495.64 105.431 1495.99 Q107.237 1496.34 109.181 1497.03 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip030)" d="M50.3623 1206 L80.0381 1206 L80.0381 1209.93 L50.3623 1209.93 L50.3623 1206 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip030)" d="M104.297 1204.19 Q107.654 1204.91 109.529 1207.18 Q111.427 1209.45 111.427 1212.78 Q111.427 1217.9 107.908 1220.7 Q104.39 1223.5 97.9083 1223.5 Q95.7324 1223.5 93.4176 1223.06 Q91.126 1222.64 88.6723 1221.78 L88.6723 1217.27 Q90.6167 1218.4 92.9315 1218.98 Q95.2463 1219.56 97.7695 1219.56 Q102.168 1219.56 104.459 1217.83 Q106.774 1216.09 106.774 1212.78 Q106.774 1209.72 104.621 1208.01 Q102.492 1206.28 98.6722 1206.28 L94.6445 1206.28 L94.6445 1202.43 L98.8574 1202.43 Q102.306 1202.43 104.135 1201.07 Q105.964 1199.68 105.964 1197.09 Q105.964 1194.42 104.066 1193.01 Q102.191 1191.58 98.6722 1191.58 Q96.7509 1191.58 94.5519 1191.99 Q92.3528 1192.41 89.7139 1193.29 L89.7139 1189.12 Q92.376 1188.38 94.6908 1188.01 Q97.0287 1187.64 99.0889 1187.64 Q104.413 1187.64 107.515 1190.07 Q110.617 1192.48 110.617 1196.6 Q110.617 1199.47 108.973 1201.46 Q107.33 1203.43 104.297 1204.19 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip030)" d="M99.4824 883.342 Q95.8713 883.342 94.0426 886.907 Q92.2371 890.449 92.2371 897.578 Q92.2371 904.685 94.0426 908.25 Q95.8713 911.791 99.4824 911.791 Q103.117 911.791 104.922 908.25 Q106.751 904.685 106.751 897.578 Q106.751 890.449 104.922 886.907 Q103.117 883.342 99.4824 883.342 M99.4824 879.639 Q105.293 879.639 108.348 884.245 Q111.427 888.829 111.427 897.578 Q111.427 906.305 108.348 910.912 Q105.293 915.495 99.4824 915.495 Q93.6723 915.495 90.5936 910.912 Q87.538 906.305 87.538 897.578 Q87.538 888.829 90.5936 884.245 Q93.6723 879.639 99.4824 879.639 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip030)" d="M104.297 588.187 Q107.654 588.905 109.529 591.173 Q111.427 593.442 111.427 596.775 Q111.427 601.891 107.908 604.692 Q104.39 607.493 97.9083 607.493 Q95.7324 607.493 93.4176 607.053 Q91.126 606.636 88.6723 605.78 L88.6723 601.266 Q90.6167 602.4 92.9315 602.979 Q95.2463 603.558 97.7695 603.558 Q102.168 603.558 104.459 601.821 Q106.774 600.085 106.774 596.775 Q106.774 593.72 104.621 592.007 Q102.492 590.271 98.6722 590.271 L94.6445 590.271 L94.6445 586.428 L98.8574 586.428 Q102.306 586.428 104.135 585.062 Q105.964 583.673 105.964 581.081 Q105.964 578.419 104.066 577.007 Q102.191 575.572 98.6722 575.572 Q96.7509 575.572 94.5519 575.988 Q92.3528 576.405 89.7139 577.285 L89.7139 573.118 Q92.376 572.377 94.6908 572.007 Q97.0287 571.636 99.0889 571.636 Q104.413 571.636 107.515 574.067 Q110.617 576.474 110.617 580.595 Q110.617 583.465 108.973 585.456 Q107.33 587.423 104.297 588.187 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip030)" d="M99.8991 279.676 Q96.7509 279.676 94.8991 281.828 Q93.0704 283.981 93.0704 287.731 Q93.0704 291.458 94.8991 293.634 Q96.7509 295.787 99.8991 295.787 Q103.047 295.787 104.876 293.634 Q106.728 291.458 106.728 287.731 Q106.728 283.981 104.876 281.828 Q103.047 279.676 99.8991 279.676 M109.181 265.023 L109.181 269.282 Q107.422 268.449 105.617 268.009 Q103.834 267.569 102.075 267.569 Q97.4454 267.569 94.9917 270.694 Q92.5612 273.819 92.2139 280.139 Q93.5797 278.125 95.6398 277.06 Q97.7 275.972 100.177 275.972 Q105.385 275.972 108.394 279.143 Q111.427 282.291 111.427 287.731 Q111.427 293.055 108.279 296.273 Q105.131 299.49 99.8991 299.49 Q93.9037 299.49 90.7325 294.907 Q87.5612 290.301 87.5612 281.574 Q87.5612 273.379 91.45 268.518 Q95.3389 263.634 101.89 263.634 Q103.649 263.634 105.431 263.981 Q107.237 264.329 109.181 265.023 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip032)" style="stroke:#009af9; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,1274.65 224.541,1360.76 226.891,1300.47 229.242,1408.1 231.592,1447.77 233.943,1377.44 236.293,1559.55 238.644,1355.23 240.994,1464.8 243.345,1599.6 245.695,1383.57 248.046,1364.16 250.396,1183.86 252.747,1470.13 255.097,1349.86 257.448,1381.57 259.798,1495.71 262.148,1302.96 264.499,1287.44 266.849,1516.19 269.2,1325.09 271.55,1473.93 273.901,1422.09 276.251,1350.52 278.602,1379.85 280.952,1286.32 283.303,1472.87 285.653,1522.63 288.004,1395.02 290.354,1167.47 292.705,1379.97 295.055,1376.85 297.406,1329.45 299.756,1448.41 302.107,1426.34 304.457,1360.78 306.807,1432.44 309.158,1389.11 311.508,1210.6 313.859,1292.12 316.209,1411.03 318.56,1342.99 320.91,1299.23 323.261,1476.36 325.611,1299.59 327.962,1453.87 330.312,1407.32 332.663,1417.35 335.013,1271.44 337.364,1347.31 339.714,1370.56 342.065,1348.31 344.415,1300.93 346.765,1642.59 349.116,1569.46 351.466,1420.85 353.817,1308.91 356.167,1473.83 358.518,1221.51 360.868,1482.28 363.219,1445.31 365.569,1370.88 367.92,1268.3 370.27,1291.78 372.621,1426.5 374.971,1554.83 377.322,1495.94 379.672,1276.97 382.023,1450.64 384.373,1239.62 386.724,1378.18 389.074,1328.75 391.424,1483.74 393.775,1310.14 396.125,1208.48 398.476,1237.72 400.826,1582.74 403.177,1544.87 405.527,1545.03 407.878,1318.08 410.228,1391.01 412.579,1389 414.929,1365.2 417.28,1478.5 419.63,1305.48 421.981,1393.61 424.331,1183.14 426.682,1429.09 429.032,1495.24 431.382,1373.12 433.733,1488.04 436.083,1481.98 438.434,1289.87 440.784,1414.19 443.135,1327.1 445.485,1484.59 447.836,1588.9 450.186,1338.91 452.537,1489.59 454.887,1238.38 457.238,1510.19 459.588,1386.23 461.939,1383.57 464.289,1432.74 466.64,1508.5 468.99,1526.08 471.341,1426.3 473.691,1282.93 476.041,1393.09 478.392,1299.29 480.742,1495.46 483.093,1520.52 485.443,1466.49 487.794,1347.4 490.144,1641.75 492.495,1431.17 494.845,1445.9 497.196,1319.16 499.546,1315.9 501.897,1317.17 504.247,1609.78 506.598,1493.18 508.948,1361.11 511.299,1367.62 513.649,1482.55 515.999,1259.06 518.35,1364.2 520.7,1394.91 523.051,1471.95 525.401,1441.27 527.752,1437.04 530.102,1305.6 532.453,1314.56 534.803,1559.41 537.154,1315.24 539.504,1385.5 541.855,1449.33 544.205,1425.01 546.556,1272.35 548.906,1362.39 551.257,1427.96 553.607,1542.11 555.958,1370.32 558.308,1515.34 560.658,1278.56 563.009,1365.05 565.359,1392.31 567.71,1326.51 570.06,1277.6 572.411,1468.41 574.761,1312.77 577.112,1288.07 579.462,1499.93 581.813,1329.26 584.163,1388.85 586.514,1375.82 588.864,1531.17 591.215,1429.67 593.565,1516.33 595.916,1383.3 598.266,1456.06 600.616,1422.23 602.967,1370.08 605.317,1546.26 607.668,1470.74 610.018,1439.2 612.369,1436.41 614.719,1221.13 617.07,1451.37 619.42,1225.75 621.771,1599.72 624.121,1405.88 626.472,1448.46 628.822,1434.16 631.173,1372.55 633.523,1351.73 635.874,1537.27 638.224,1465.63 640.575,1418.56 642.925,1298.32 645.275,1409.15 647.626,1429.99 649.976,1492.35 652.327,1383.85 654.677,1339.64 657.028,1331.12 659.378,1444.82 661.729,1170.15 664.079,1248.6 666.43,1153.28 668.78,1261.27 671.131,1255.26 673.481,1408.11 675.832,1593.3 678.182,1361.65 680.533,1279.61 682.883,1480.76 685.233,1184.58 687.584,1266.27 689.934,1382.65 692.285,1443.23 694.635,1455.98 696.986,1329.64 699.336,1496.05 701.687,1212.26 704.037,1387.83 706.388,1499.7 708.738,1355.26 711.089,1578.38 713.439,1704.15 715.79,1480.56 718.14,1439.6 720.491,1505.42 722.841,1378.44 725.192,1550.33 727.542,1340.69 729.892,1494.51 732.243,1379.71 734.593,1363.9 736.944,1493.69 739.294,1414.88 741.645,1430.16 743.995,1273.55 746.346,1457.27 748.696,1648.96 751.047,1281.2 753.397,1487.27 755.748,1324.01 758.098,1195.46 760.449,1394.67 762.799,1272.41 765.15,1367.78 767.5,1507.31 769.85,1598.5 772.201,1485.45 774.551,1323.39 776.902,1283.95 779.252,1584.15 781.603,1469.75 783.953,1376.6 786.304,1366.46 788.654,1321.69 791.005,1254.81 793.355,1345.26 795.706,1392.6 798.056,1511.12 800.407,1412.86 802.757,1525.73 805.108,1173.08 807.458,1423.76 809.809,1605.47 812.159,1375.72 814.509,1209.82 816.86,1356.85 819.21,1680.52 821.561,1251.77 823.911,1382.05 826.262,1397.05 828.612,1391.93 830.963,1402.22 833.313,1614.1 835.664,1589.33 838.014,1352.56 840.365,1621.7 842.715,1537.33 845.066,1428.41 847.416,1530.48 849.767,1506.73 852.117,1664.61 854.467,1639.39 856.818,1553.65 859.168,1355.4 861.519,1448.93 863.869,1399.18 866.22,1386.64 868.57,1231.95 870.921,1366.48 873.271,1406.7 875.622,1474.1 877.972,1518.01 880.323,1188.88 882.673,1492.84 885.024,1495.54 887.374,1477.22 889.725,1461.57 892.075,1319.31 894.426,1206.12 896.776,1612.16 899.126,1290.18 901.477,1202.83 903.827,1453.64 906.178,1307.12 908.528,1381.45 910.879,1686.98 913.229,1449.36 915.58,1330.95 917.93,1415.76 920.281,1505.73 922.631,1563.91 924.982,1536.86 927.332,1410.43 929.683,1461.97 932.033,1396.12 934.384,1205.83 936.734,1399 939.084,1501.09 941.435,1354.16 943.785,1392.69 946.136,1525.51 948.486,1394.43 950.837,1365.06 953.187,1412.49 955.538,1541.53 957.888,1352.36 960.239,1434.1 962.589,1203.85 964.94,1163.13 967.29,1427.29 969.641,1209.24 971.991,1456.79 974.342,1491.05 976.692,1563.3 979.043,1414.49 981.393,1533.97 983.743,1455.82 986.094,1299.92 988.444,1339.8 990.795,1411.29 993.145,1358.13 995.496,1262.37 997.846,1353.74 1000.2,1338.63 1002.55,1387.5 1004.9,1403.33 1007.25,1294.16 1009.6,1552.61 1011.95,1484.01 1014.3,1252.09 1016.65,1291.06 1019,1536.56 1021.35,1300.21 1023.7,1509.6 1026.05,1346.54 1028.4,1440.66 1030.75,1382.52 1033.1,1473.87 1035.45,1460.54 1037.8,1350.67 1040.15,1459.51 1042.51,1511.07 1044.86,1572.74 1047.21,1489.94 1049.56,1503.37 1051.91,1623.62 1054.26,1549.15 1056.61,1420.62 1058.96,1416.41 1061.31,1278.35 1063.66,1283.25 1066.01,1559.27 1068.36,1503.54 1070.71,1396.63 1073.06,1367.98 1075.41,1394.96 1077.76,1495.12 1080.11,1467.72 1082.46,1361.68 1084.81,1366.14 1087.16,1273.49 1089.51,1590.42 1091.87,1486.05 1094.22,1377.08 1096.57,1255.3 1098.92,1406.86 1101.27,1208.53 1103.62,1335.69 1105.97,1322.17 1108.32,1378.68 1110.67,1539.26 1113.02,1501.97 1115.37,1208.02 1117.72,1269.38 1120.07,1417.81 1122.42,1406.46 1124.77,1360.2 1127.12,1245.22 1129.47,1464.4 1131.82,1491.81 1134.17,1390.61 1136.52,1346.26 1138.87,1587.59 1141.23,1355.54 1143.58,1503.9 1145.93,1490.96 1148.28,1179.29 1150.63,1463.98 1152.98,1392.15 1155.33,1350.95 1157.68,1319.92 1160.03,1296.03 1162.38,1635.03 1164.73,1423.48 1167.08,1505.62 1169.43,1400.19 1171.78,1575.14 1174.13,1416.63 1176.48,1270.75 1178.83,1448.49 1181.18,1511.74 1183.53,1351.78 1185.88,1489.87 1188.23,1405.47 1190.59,1221.58 1192.94,1342.4 1195.29,1597.57 1197.64,1256.16 1199.99,1394.58 1202.34,1253.24 1204.69,1318.25 1207.04,1379.14 1209.39,1345.94 1211.74,1342.14 1214.09,1272.13 1216.44,1336.56 1218.79,1425 1221.14,1232.03 1223.49,1298.04 1225.84,1343.77 1228.19,1478.84 1230.54,1474.91 1232.89,1260.41 1235.24,1405.36 1237.59,1507.46 1239.94,1355.3 1242.3,1502.48 1244.65,1270.31 1247,1542.62 1249.35,1066.8 1251.7,1482.49 1254.05,1440.22 1256.4,1456.07 1258.75,1469 1261.1,1461.57 1263.45,1413.03 1265.8,1329.37 1268.15,1355.33 1270.5,1492.71 1272.85,1342.86 1275.2,1409.54 1277.55,1175.55 1279.9,1494.08 1282.25,1455.99 1284.6,1371.55 1286.95,1423.49 1289.3,1472.98 1291.66,1644.13 1294.01,1521.65 1296.36,1518.52 1298.71,1415.7 1301.06,1462.98 1303.41,1411.36 1305.76,1609.57 1308.11,1631.01 1310.46,1509.4 1312.81,1313.5 1315.16,1353.37 1317.51,1307.72 1319.86,1486.88 1322.21,1367.79 1324.56,1416.85 1326.91,1210.56 1329.26,1432.52 1331.61,1416.31 1333.96,1633.19 1336.31,1489.53 1338.66,1604.4 1341.02,1503.12 1343.37,1369.95 1345.72,1438.8 1348.07,1407.58 1350.42,1450.22 1352.77,1372.16 1355.12,1417.31 1357.47,1454.21 1359.82,1328.5 1362.17,1431.38 1364.52,1264.79 1366.87,1239.37 1369.22,1697.23 1371.57,1354.41 1373.92,1636.98 1376.27,1450.75 1378.62,1560.8 1380.97,1477.84 1383.32,1375.41 1385.67,1243.03 1388.02,1282.37 1390.38,1588.86 1392.73,1664.69 1395.08,1542.35 1397.43,1211.8 1399.78,1597.48 1402.13,1400.34 1404.48,1437.92 1406.83,1446.33 1409.18,1395.51 1411.53,1091.59 1413.88,1490.03 1416.23,1458.64 1418.58,1324.39 1420.93,1213.25 1423.28,1505.52 1425.63,1377.24 1427.98,1413.44 1430.33,1389.45 1432.68,1343.03 1435.03,1439.14 1437.38,1414.08 1439.74,1382 1442.09,1386.94 1444.44,1268.69 1446.79,1322.9 1449.14,1529.78 1451.49,1332.43 1453.84,1442.87 1456.19,1481.03 1458.54,1316.44 1460.89,1477.63 1463.24,1225.69 1465.59,1468.82 1467.94,1481.43 1470.29,1421.99 1472.64,1393.73 1474.99,1601.65 1477.34,1353.07 1479.69,1309.79 1482.04,1506.16 1484.39,1355.34 1486.74,1537.09 1489.1,1313.57 1491.45,1321.87 1493.8,1415.6 1496.15,1355.84 1498.5,1390.7 1500.85,1361.19 1503.2,1534.05 1505.55,1280.41 1507.9,1485.22 1510.25,1528.13 1512.6,1377.05 1514.95,1353.19 1517.3,1264.14 1519.65,1475.75 1522,1531.48 1524.35,1219.73 1526.7,1344.99 1529.05,1389.44 1531.4,1400.89 1533.75,1342.37 1536.1,1237.69 1538.45,1499.41 1540.81,1400.05 1543.16,1517.84 1545.51,1235.89 1547.86,1499.51 1550.21,1463.45 1552.56,1300.67 1554.91,1751.15 1557.26,1378.65 1559.61,1518.42 1561.96,1295.64 1564.31,1599.49 1566.66,1339.46 1569.01,1361.02 1571.36,1446.81 1573.71,1404.34 1576.06,1375.92 1578.41,1489.17 1580.76,1617.5 1583.11,1332.14 1585.46,1250.4 1587.81,1352.44 1590.17,1573.95 1592.52,1372.26 1594.87,1618.28 1597.22,1442.12 1599.57,1439.59 1601.92,1313.4 1604.27,1245.02 1606.62,1559.43 1608.97,1229.72 1611.32,1408.35 1613.67,1325.01 1616.02,1441.31 1618.37,1433.77 1620.72,1487.62 1623.07,1273.87 1625.42,1313.93 1627.77,1369.55 1630.12,1181.25 1632.47,1397.92 1634.82,1396.32 1637.17,1548.99 1639.53,1467.88 1641.88,1370.34 1644.23,1369.43 1646.58,1511.44 1648.93,1398.19 1651.28,1394.83 1653.63,1486.27 1655.98,1303.53 1658.33,1402.66 1660.68,1438.48 1663.03,1554.82 1665.38,1337.57 1667.73,1315.3 1670.08,1265.85 1672.43,1385.01 1674.78,1492.85 1677.13,1415.01 1679.48,1469.34 1681.83,1408.89 1684.18,1419.73 1686.53,1393.13 1688.89,1284.41 1691.24,1302.7 1693.59,1373.76 1695.94,1508.58 1698.29,1549.72 1700.64,1676.77 1702.99,1528.88 1705.34,1396.81 1707.69,1479.01 1710.04,1345.85 1712.39,1499.77 1714.74,1391 1717.09,1480.61 1719.44,1653.04 1721.79,1360.5 1724.14,1326.04 1726.49,1371.29 1728.84,1328.64 1731.19,1458.52 1733.54,1471.35 1735.89,1483.74 1738.25,1507.28 1740.6,1368.95 1742.95,1272.89 1745.3,1456.84 1747.65,1362.95 1750,1355.9 1752.35,1584.29 1754.7,1352.4 1757.05,1250.85 1759.4,1378.47 1761.75,1550.71 1764.1,1367.9 1766.45,1301.49 1768.8,1486.48 1771.15,1525.8 1773.5,1359.89 1775.85,1517.69 1778.2,1270.18 1780.55,1427.67 1782.9,1390.01 1785.25,1241.66 1787.6,1453.52 1789.96,1430.7 1792.31,1271.93 1794.66,1332.5 1797.01,1518.01 1799.36,1473.34 1801.71,1210.34 1804.06,1441.28 1806.41,1340.86 1808.76,1439.33 1811.11,1547.5 1813.46,1417.98 1815.81,1384.47 1818.16,1213.65 1820.51,1229.02 1822.86,1442.7 1825.21,1330.12 1827.56,1404.31 1829.91,1354.5 1832.26,1384.59 1834.61,1439.9 1836.96,1543.13 1839.32,1483.12 1841.67,1427.81 1844.02,1559.05 1846.37,1261.48 1848.72,1522.6 1851.07,1436.18 1853.42,1342.4 1855.77,1193.03 1858.12,1454.47 1860.47,1382.5 1862.82,1459.14 1865.17,1329.48 1867.52,1547.14 1869.87,1284.75 1872.22,1365.23 1874.57,1594.1 1876.92,1551.37 1879.27,1332.99 1881.62,1343.22 1883.97,1441.47 1886.32,1292.62 1888.68,1277.31 1891.03,1639.1 1893.38,1450.11 1895.73,1484.9 1898.08,1327.66 1900.43,1464.69 1902.78,1363.75 1905.13,1236.9 1907.48,1552.51 1909.83,1275.19 1912.18,1426.95 1914.53,1504.61 1916.88,1432.42 1919.23,1322.3 1921.58,1435.76 1923.93,1325.76 1926.28,1445.16 1928.63,1477.53 1930.98,1318.28 1933.33,1266.69 1935.68,1521 1938.04,1390.48 1940.39,1313.34 1942.74,1427.94 1945.09,1351.13 1947.44,1510.58 1949.79,1471.15 1952.14,1556.34 1954.49,1226.75 1956.84,1306.06 1959.19,1563.36 1961.54,1585.27 1963.89,1291.71 1966.24,1685.82 1968.59,1290.07 1970.94,1417.8 1973.29,1494.42 1975.64,1569.38 1977.99,1628.05 1980.34,1261.79 1982.69,1331.86 1985.04,1366.05 1987.4,1224.08 1989.75,1377.28 1992.1,1349.67 1994.45,1375.94 1996.8,1423.04 1999.15,1443.91 2001.5,1406.1 2003.85,1448.01 2006.2,1341.71 2008.55,1449.21 2010.9,1429.97 2013.25,1313.92 2015.6,1323.7 2017.95,1483.83 2020.3,1331.21 2022.65,1455.88 2025,1374.3 2027.35,1315.12 2029.7,1198.22 2032.05,1380.77 2034.4,1395.57 2036.76,1599.5 2039.11,1402.02 2041.46,1325.36 2043.81,1447.67 2046.16,1468.85 2048.51,1265.04 2050.86,1413.54 2053.21,1450.83 2055.56,1385.8 2057.91,1412.26 2060.26,1599.26 2062.61,1272.82 2064.96,1382.09 2067.31,1602.32 2069.66,1185.16 2072.01,1491.84 2074.36,1410 2076.71,1245.95 2079.06,1312.67 2081.41,1325.02 2083.76,1467.67 2086.11,1317.47 2088.47,1500.9 2090.82,1561.04 2093.17,1506.98 2095.52,1541.85 2097.87,1189.62 2100.22,1444.16 2102.57,1341.12 2104.92,1153.53 2107.27,1492.28 2109.62,1544.7 2111.97,1464.09 2114.32,1532.6 2116.67,1499.27 2119.02,1371.4 2121.37,1413.5 2123.72,1615.9 2126.07,1315.78 2128.42,1521.34 2130.77,1366.94 2133.12,1441.35 2135.47,1452.96 2137.83,1535.03 2140.18,1432.09 2142.53,1535.72 2144.88,1426.26 2147.23,1506.19 2149.58,1494.17 2151.93,1265.91 2154.28,1179.27 2156.63,1595.95 2158.98,1379.7 2161.33,1264.28 2163.68,1334.93 2166.03,1329.81 2168.38,1200.06 2170.73,1498.67 2173.08,1424.31 2175.43,1486.04 2177.78,1465.88 2180.13,1278.76 2182.48,1508.81 2184.83,1330.54 2187.19,1446.99 2189.54,1301.34 2191.89,1611.69 2194.24,1235.95 2196.59,1249.43 2198.94,1390.47 2201.29,1331.31 2203.64,1442.42 2205.99,1606.78 2208.34,1466.2 2210.69,1428.1 2213.04,1113.81 2215.39,1479.59 2217.74,1537.59 2220.09,1604.11 2222.44,1536.24 2224.79,1233.27 2227.14,1362.29 2229.49,1442.31 2231.84,1492.05 2234.19,1450.9 2236.55,1359.48 2238.9,1197.43 2241.25,1249.73 2243.6,1540.94 2245.95,1255.79 2248.3,1336.12 2250.65,1366.42 2253,1583.69 2255.35,1354.61 2257.7,1512.67 2260.05,1426.29 2262.4,1369.08 2264.75,1281.04 2267.1,1393.62 2269.45,1405.5 2271.8,1516.11 2274.15,1547.51 2276.5,1418.63 2278.85,1426.21 2281.2,1513.05 2283.55,1611.66 2285.91,1498.75 2288.26,1604.41 2290.61,1265.17 2292.96,1637.81 2295.31,1501.03 2297.66,1363.9 2300.01,1383.82 2302.36,1385.22 2304.71,1421.78 2307.06,1293.82 2309.41,1403.41 2311.76,1424.64 2314.11,1613.43 2316.46,1528.58 2318.81,1336.89 2321.16,1408.1 2323.51,1414.48 2325.86,1418.08 2328.21,1556.83 2330.56,1415.28 2332.91,1408.27 2335.27,1459.15 2337.62,1271.03 2339.97,1384.34 2342.32,1174.33 2344.67,1313.36 2347.02,1419.27 2349.37,1644.6 2351.72,1377.11 2354.07,1298.39 2356.42,1326.05 2358.77,1315.19 2361.12,1517.03 2363.47,1350.21 2365.82,1317.85 2368.17,1491.9 2370.52,1296.92 2372.87,1429.86 2375.22,1482.22 2377.57,1493.04 2379.92,1301.31 2382.27,1332.45 2384.62,1395.41 2386.98,1446.8 2389.33,1293.08 2391.68,1538.41 2394.03,1384.05 2396.38,1349.57 2398.73,1451.29 2401.08,1469.8 2403.43,1381.32 2405.78,1222.51 2408.13,1356.14 2410.48,1512.86 2412.83,1443.27 2415.18,1353.85 2417.53,1412.87 2419.88,1351 2422.23,1519.77 2424.58,1365.47 2426.93,1492.1 2429.28,1609.05 2431.63,1387.39 2433.98,1319.69 2436.34,1354.5 2438.69,1489.42 2441.04,1236.88 2443.39,1308.58 2445.74,1383.13 2448.09,1573.96 2450.44,1454.94 2452.79,1509.09 2455.14,1681.35 2457.49,1307.55 2459.84,1346.55 2462.19,1580.53 2464.54,1347.87 2466.89,1391.2 2469.24,1470.45 2471.59,1466.12 2473.94,1470.41 2476.29,1353.58 2478.64,1453.76 2480.99,1336.92 2483.34,1267.09 2485.7,1452.06 2488.05,1609.55 2490.4,1190.39 2492.75,1414.82 2495.1,1423.05 2497.45,1555.1 2499.8,1376.48 2502.15,1391.16 2504.5,1426.37 2506.85,1495.64 2509.2,1375.48 2511.55,1334.46 2513.9,1319.92 2516.25,1415.98 2518.6,1290.28 2520.95,1467.43 2523.3,1655.67 2525.65,1402.87 2528,1412.2 2530.35,1242.39 2532.7,1444.04 2535.06,1360.81 2537.41,1362.8 2539.76,1499.94 2542.11,1312.19 2544.46,1200.47 2546.81,1680.24 2549.16,1302.8 2551.51,1380.07 2553.86,1532.8 2556.21,1375.58 2558.56,1527.31 2560.91,1556.7 2563.26,1413.89 2565.61,1537.46 2567.96,1395.43 2570.31,1394.45 "></polyline>
<polyline clip-path="url(#clip032)" style="stroke:#e26f46; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,944.178 224.541,992.688 226.891,913.6 229.242,835.51 231.592,811.357 233.943,766.141 236.293,964.628 238.644,894.291 240.994,821.297 243.345,901.792 245.695,885.638 248.046,866.922 250.396,894.756 252.747,769.537 255.097,1051.06 257.448,990.849 259.798,918.595 262.148,880.962 264.499,874.799 266.849,879.662 269.2,797.19 271.55,733.633 273.901,911.268 276.251,992.214 278.602,936.366 280.952,823.666 283.303,711.981 285.653,897.793 288.004,856.441 290.354,1041.15 292.705,869.49 295.055,931.141 297.406,883.711 299.756,846.003 302.107,1021.23 304.457,1049.37 306.807,782.133 309.158,884.016 311.508,923.034 313.859,850.507 316.209,775.06 318.56,809.325 320.91,751.907 323.261,726.864 325.611,787.973 327.962,931.486 330.312,885.732 332.663,875.645 335.013,738.914 337.364,867.705 339.714,889.807 342.065,1076.18 344.415,973.673 346.765,819.931 349.116,824.84 351.466,762.013 353.817,972.078 356.167,915.856 358.518,1043.06 360.868,1067.4 363.219,924.601 365.569,970.406 367.92,1033.6 370.27,1014.9 372.621,795.592 374.971,845.799 377.322,948.217 379.672,908.408 382.023,762.715 384.373,693.247 386.724,823.413 389.074,970.176 391.424,872.759 393.775,938.406 396.125,934.627 398.476,977.929 400.826,874.547 403.177,796.431 405.527,718.827 407.878,859.883 410.228,929.416 412.579,924.03 414.929,929.455 417.28,734.08 419.63,763.992 421.981,932.983 424.331,979.783 426.682,869.823 429.032,929.577 431.382,810.632 433.733,846.165 436.083,846.267 438.434,932.847 440.784,880.768 443.135,1029.19 445.485,1033.7 447.836,864.274 450.186,1015.83 452.537,944.631 454.887,941.129 457.238,855.113 459.588,1094.5 461.939,854.154 464.289,810.356 466.64,889.709 468.99,927.711 471.341,798.347 473.691,708.439 476.041,1146.89 478.392,745.333 480.742,990.339 483.093,1045.07 485.443,804.75 487.794,970.16 490.144,1053.54 492.495,969.049 494.845,638.618 497.196,812.089 499.546,759.617 501.897,1122.98 504.247,830.474 506.598,791.554 508.948,895.331 511.299,812.017 513.649,838.133 515.999,941.277 518.35,995.227 520.7,1016.27 523.051,866.17 525.401,778.256 527.752,817.597 530.102,888.201 532.453,788.015 534.803,914.798 537.154,987.387 539.504,920.909 541.855,1022.7 544.205,645.59 546.556,838.658 548.906,921.598 551.257,1016.87 553.607,956.005 555.958,944.677 558.308,822.453 560.658,1108.1 563.009,953.402 565.359,949.551 567.71,733.572 570.06,761.468 572.411,990.171 574.761,835.618 577.112,903.882 579.462,689.261 581.813,853.276 584.163,885.396 586.514,924.092 588.864,851.382 591.215,1018.72 593.565,928.753 595.916,838.15 598.266,895.289 600.616,1025.33 602.967,895.319 605.317,772.229 607.668,890.396 610.018,785.261 612.369,919.655 614.719,1100.24 617.07,815.407 619.42,1067.75 621.771,773.712 624.121,872.264 626.472,985.657 628.822,895.637 631.173,694.41 633.523,772.26 635.874,842.976 638.224,880.453 640.575,920.428 642.925,907.334 645.275,747.377 647.626,1058.26 649.976,931.297 652.327,937.132 654.677,822.017 657.028,748.095 659.378,749.651 661.729,1053.27 664.079,924.919 666.43,1124.46 668.78,1098.34 671.131,1181.31 673.481,931.985 675.832,1016.73 678.182,984.133 680.533,922.746 682.883,925.758 685.233,911.059 687.584,895.736 689.934,814.031 692.285,819.743 694.635,892.988 696.986,856.932 699.336,976.9 701.687,875.744 704.037,818.212 706.388,797.529 708.738,1053 711.089,693.349 713.439,831.452 715.79,732.643 718.14,793.174 720.491,682.686 722.841,982.052 725.192,902.494 727.542,934.617 729.892,896.542 732.243,827.288 734.593,1027.26 736.944,762.637 739.294,931.508 741.645,1032.71 743.995,990.496 746.346,928.422 748.696,982.169 751.047,1004.46 753.397,946.291 755.748,790.742 758.098,811.873 760.449,842.313 762.799,975.28 765.15,1033.91 767.5,723.216 769.85,680.447 772.201,1004.77 774.551,1009.81 776.902,976.016 779.252,1010.82 781.603,820.331 783.953,906.888 786.304,928.304 788.654,1058.43 791.005,858.895 793.355,874.459 795.706,1045.16 798.056,765.931 800.407,941.765 802.757,740.988 805.108,828.007 807.458,924.789 809.809,949.787 812.159,953.732 814.509,924.613 816.86,891.399 819.21,962.507 821.561,1023.34 823.911,953.796 826.262,840.073 828.612,719.063 830.963,1020.73 833.313,843.213 835.664,784.03 838.014,811.168 840.365,667.618 842.715,876.075 845.066,888.52 847.416,969.172 849.767,854.241 852.117,884.397 854.467,896.917 856.818,827.297 859.168,955.616 861.519,861.156 863.869,889.117 866.22,912.903 868.57,867.609 870.921,856.195 873.271,927.035 875.622,988.612 877.972,789.431 880.323,1015.67 882.673,686.556 885.024,937.224 887.374,967.414 889.725,875.206 892.075,985.225 894.426,867.293 896.776,919.152 899.126,1073.67 901.477,809.056 903.827,755.923 906.178,697.858 908.528,875.838 910.879,887.176 913.229,794.352 915.58,829.163 917.93,832.73 920.281,939.102 922.631,919.412 924.982,845.73 927.332,943.156 929.683,861.537 932.033,927.741 934.384,903.552 936.734,795.013 939.084,1140.09 941.435,849.366 943.785,896.369 946.136,940.146 948.486,1043.77 950.837,834.829 953.187,721.566 955.538,826.016 957.888,989.171 960.239,714.759 962.589,751.504 964.94,863.125 967.29,785.945 969.641,944.245 971.991,832.975 974.342,912.217 976.692,1168.12 979.043,923.958 981.393,874.874 983.743,928.243 986.094,944.446 988.444,862.391 990.795,732.357 993.145,893.458 995.496,911.281 997.846,972.964 1000.2,774.157 1002.55,1008.73 1004.9,859.577 1007.25,769.46 1009.6,1124.22 1011.95,1035.92 1014.3,828.653 1016.65,889.646 1019,930.351 1021.35,969.49 1023.7,924.085 1026.05,867.937 1028.4,1168.1 1030.75,922.825 1033.1,898.529 1035.45,742.356 1037.8,928.081 1040.15,839.948 1042.51,891.21 1044.86,961.115 1047.21,876.312 1049.56,896.527 1051.91,971.282 1054.26,1167.98 1056.61,1162.14 1058.96,903.796 1061.31,922.85 1063.66,755.285 1066.01,1044.54 1068.36,778.517 1070.71,690.947 1073.06,884.652 1075.41,955.859 1077.76,923.181 1080.11,889.409 1082.46,997.077 1084.81,916.654 1087.16,910.841 1089.51,843.625 1091.87,866.143 1094.22,856.14 1096.57,1054.57 1098.92,823.986 1101.27,913.491 1103.62,1076.98 1105.97,922.352 1108.32,830.951 1110.67,851.575 1113.02,905.389 1115.37,903.429 1117.72,1171.75 1120.07,877.69 1122.42,913.217 1124.77,977.731 1127.12,989.92 1129.47,986.845 1131.82,879.001 1134.17,839.617 1136.52,831.183 1138.87,1008.74 1141.23,842.217 1143.58,809.076 1145.93,925.289 1148.28,1037.69 1150.63,910.743 1152.98,833.814 1155.33,804.107 1157.68,924.143 1160.03,785.265 1162.38,950.421 1164.73,1006.35 1167.08,1014.47 1169.43,939.854 1171.78,967.35 1174.13,815.037 1176.48,897.791 1178.83,952.656 1181.18,720.676 1183.53,765.023 1185.88,924.265 1188.23,782.313 1190.59,976.469 1192.94,625.412 1195.29,851.921 1197.64,799.927 1199.99,923.031 1202.34,930.564 1204.69,974.331 1207.04,971.588 1209.39,817.835 1211.74,863.438 1214.09,968.741 1216.44,968.135 1218.79,843.862 1221.14,892.587 1223.49,996.942 1225.84,957.247 1228.19,800.573 1230.54,825.521 1232.89,762.568 1235.24,851.017 1237.59,918.946 1239.94,859.125 1242.3,1161.05 1244.65,897.428 1247,912.773 1249.35,973.177 1251.7,941.968 1254.05,953.726 1256.4,1150.63 1258.75,756.571 1261.1,819.852 1263.45,767.04 1265.8,821.494 1268.15,860.207 1270.5,986.055 1272.85,924.482 1275.2,808.575 1277.55,808.591 1279.9,1035.02 1282.25,830.455 1284.6,1025.68 1286.95,834.947 1289.3,795.08 1291.66,791.217 1294.01,905.811 1296.36,923.351 1298.71,882.497 1301.06,923.502 1303.41,764.623 1305.76,846.296 1308.11,963.624 1310.46,1065.56 1312.81,691.057 1315.16,772.791 1317.51,1008.44 1319.86,885.545 1322.21,865.561 1324.56,982.963 1326.91,971.378 1329.26,1060.27 1331.61,996.763 1333.96,906.664 1336.31,735.267 1338.66,729.669 1341.02,901.177 1343.37,901.437 1345.72,1001.97 1348.07,1000.43 1350.42,965.493 1352.77,1008.88 1355.12,872.614 1357.47,935.621 1359.82,875.266 1362.17,815.172 1364.52,1148.4 1366.87,1129.55 1369.22,972.37 1371.57,802.085 1373.92,818.479 1376.27,960.953 1378.62,863.763 1380.97,909.378 1383.32,822.915 1385.67,1008.84 1388.02,776.834 1390.38,877.41 1392.73,676.052 1395.08,798.86 1397.43,877.049 1399.78,870.967 1402.13,942.081 1404.48,788.46 1406.83,1047.68 1409.18,883.893 1411.53,893.921 1413.88,1071.34 1416.23,790.684 1418.58,935.985 1420.93,826.388 1423.28,710.834 1425.63,953.837 1427.98,666.249 1430.33,979.123 1432.68,924.928 1435.03,855.692 1437.38,846.926 1439.74,942.28 1442.09,839.838 1444.44,889.289 1446.79,1076.49 1449.14,801.574 1451.49,953.824 1453.84,926.311 1456.19,696.65 1458.54,693.148 1460.89,879.523 1463.24,1067.54 1465.59,720.965 1467.94,1050.72 1470.29,980.891 1472.64,653.888 1474.99,835.122 1477.34,886.953 1479.69,926.015 1482.04,985.287 1484.39,1017.5 1486.74,768.73 1489.1,861.028 1491.45,840.125 1493.8,824.308 1496.15,972.468 1498.5,843.18 1500.85,881.753 1503.2,792.099 1505.55,994.32 1507.9,876.002 1510.25,939.322 1512.6,1067.64 1514.95,966.731 1517.3,856.739 1519.65,891.498 1522,860.952 1524.35,1015.22 1526.7,945.108 1529.05,930.87 1531.4,1159.79 1533.75,778.314 1536.1,1085.29 1538.45,964.334 1540.81,897.074 1543.16,850.813 1545.51,769.626 1547.86,641.237 1550.21,1054.04 1552.56,1175.3 1554.91,797.224 1557.26,978.941 1559.61,912.275 1561.96,1011.63 1564.31,740.845 1566.66,702.329 1569.01,956.255 1571.36,931.791 1573.71,836.258 1576.06,975.894 1578.41,964.447 1580.76,900.288 1583.11,1098.47 1585.46,855.764 1587.81,715.323 1590.17,698.226 1592.52,868.748 1594.87,931.083 1597.22,1039.74 1599.57,835.222 1601.92,1008.83 1604.27,987.21 1606.62,834.901 1608.97,874.11 1611.32,864.152 1613.67,933.64 1616.02,817.746 1618.37,1006.03 1620.72,716.672 1623.07,954.655 1625.42,821.506 1627.77,957.527 1630.12,889.895 1632.47,751.569 1634.82,754.505 1637.17,868.53 1639.53,995.661 1641.88,968.191 1644.23,946.304 1646.58,806.44 1648.93,917.596 1651.28,859.547 1653.63,906.246 1655.98,824.239 1658.33,918.847 1660.68,932.174 1663.03,882.397 1665.38,959.373 1667.73,1011.48 1670.08,1026.47 1672.43,780.908 1674.78,851.4 1677.13,945.988 1679.48,924.57 1681.83,900.702 1684.18,938.085 1686.53,990.018 1688.89,947.323 1691.24,955.142 1693.59,1083.16 1695.94,841.257 1698.29,889.823 1700.64,741.904 1702.99,985.704 1705.34,965.904 1707.69,909.777 1710.04,759.226 1712.39,844.645 1714.74,912.818 1717.09,900.452 1719.44,1096.16 1721.79,894.707 1724.14,977.587 1726.49,721.682 1728.84,980.056 1731.19,869.804 1733.54,666.219 1735.89,870.083 1738.25,950.721 1740.6,878.079 1742.95,823.083 1745.3,863.764 1747.65,971.885 1750,997.332 1752.35,910.487 1754.7,1068.62 1757.05,927.177 1759.4,965.186 1761.75,791.51 1764.1,862.299 1766.45,1148.04 1768.8,715.59 1771.15,1037.05 1773.5,996.291 1775.85,951.954 1778.2,983.906 1780.55,1035.27 1782.9,994.896 1785.25,964.668 1787.6,1028.93 1789.96,810.873 1792.31,856.079 1794.66,883.289 1797.01,933.267 1799.36,905.059 1801.71,859.232 1804.06,805.879 1806.41,885.976 1808.76,936.21 1811.11,746.802 1813.46,936.815 1815.81,1104.04 1818.16,1014.19 1820.51,926.127 1822.86,1016.37 1825.21,1029.32 1827.56,778.395 1829.91,772.713 1832.26,824.946 1834.61,897.186 1836.96,1021.91 1839.32,842.934 1841.67,971.981 1844.02,757.418 1846.37,1112.88 1848.72,958.205 1851.07,864.218 1853.42,1071.97 1855.77,973.307 1858.12,883.402 1860.47,848.335 1862.82,873.863 1865.17,811.686 1867.52,905.134 1869.87,998.866 1872.22,721.544 1874.57,801 1876.92,922.847 1879.27,830.947 1881.62,761.083 1883.97,965.686 1886.32,820.17 1888.68,828.929 1891.03,956.341 1893.38,917.332 1895.73,980.568 1898.08,883.438 1900.43,1037.54 1902.78,1074.29 1905.13,926.632 1907.48,986.35 1909.83,851.115 1912.18,907.031 1914.53,926.274 1916.88,907.863 1919.23,1071.42 1921.58,988.068 1923.93,908.272 1926.28,671.591 1928.63,773.693 1930.98,991.123 1933.33,760.315 1935.68,801.757 1938.04,856.197 1940.39,869.385 1942.74,936.752 1945.09,883.703 1947.44,1038.35 1949.79,867.498 1952.14,833.713 1954.49,790.456 1956.84,758.472 1959.19,916.512 1961.54,1028.49 1963.89,933.011 1966.24,1009.21 1968.59,1102.22 1970.94,756.336 1973.29,1010.99 1975.64,1005.54 1977.99,985.76 1980.34,1038.01 1982.69,885.075 1985.04,704.657 1987.4,886.949 1989.75,848.197 1992.1,781.158 1994.45,1015 1996.8,801.125 1999.15,864.096 2001.5,994.428 2003.85,695.663 2006.2,865.392 2008.55,733.791 2010.9,1018.24 2013.25,860.068 2015.6,904.003 2017.95,758.252 2020.3,827.548 2022.65,834.26 2025,925.945 2027.35,907.806 2029.7,849.228 2032.05,881.571 2034.4,969.258 2036.76,869.869 2039.11,636.959 2041.46,931.933 2043.81,920.831 2046.16,762.565 2048.51,875.792 2050.86,816.493 2053.21,978.837 2055.56,858.872 2057.91,907.875 2060.26,917.005 2062.61,883.191 2064.96,787.977 2067.31,829.932 2069.66,753.704 2072.01,1082.27 2074.36,1013.6 2076.71,1052.75 2079.06,1018.09 2081.41,847.725 2083.76,886.494 2086.11,985.153 2088.47,896.9 2090.82,949.254 2093.17,777.784 2095.52,779.303 2097.87,900.983 2100.22,937.08 2102.57,883.947 2104.92,984.409 2107.27,874.83 2109.62,1028.02 2111.97,932.303 2114.32,705.425 2116.67,791.956 2119.02,1046.29 2121.37,971.506 2123.72,937.122 2126.07,875.464 2128.42,1033.89 2130.77,660.436 2133.12,784.32 2135.47,818.737 2137.83,900.695 2140.18,812.45 2142.53,853.789 2144.88,1024.61 2147.23,1012.87 2149.58,931.468 2151.93,707.99 2154.28,832.363 2156.63,844.382 2158.98,944.716 2161.33,774.348 2163.68,994.616 2166.03,807.661 2168.38,823.206 2170.73,844.806 2173.08,874.56 2175.43,894.709 2177.78,966.825 2180.13,862.272 2182.48,958.784 2184.83,894.24 2187.19,734.985 2189.54,909.496 2191.89,1054.99 2194.24,856.702 2196.59,968.066 2198.94,766.388 2201.29,1059.18 2203.64,865.79 2205.99,708.619 2208.34,780.599 2210.69,900.814 2213.04,924.417 2215.39,750.405 2217.74,1118.58 2220.09,1101.9 2222.44,864.944 2224.79,1121.02 2227.14,845.596 2229.49,1058.53 2231.84,936.279 2234.19,861.331 2236.55,735.79 2238.9,919.549 2241.25,873.142 2243.6,887.066 2245.95,925.223 2248.3,1057.58 2250.65,783.407 2253,800.182 2255.35,883.501 2257.7,923.523 2260.05,950.961 2262.4,972.96 2264.75,949.086 2267.1,822.53 2269.45,1200.33 2271.8,908.3 2274.15,973.076 2276.5,1061.96 2278.85,942.764 2281.2,758.825 2283.55,899.415 2285.91,834.843 2288.26,896.397 2290.61,884.521 2292.96,968.371 2295.31,1026.55 2297.66,814.578 2300.01,880.93 2302.36,903.852 2304.71,954.557 2307.06,914.112 2309.41,674.659 2311.76,804.228 2314.11,992.863 2316.46,1017.69 2318.81,917.943 2321.16,891.256 2323.51,932.414 2325.86,789.678 2328.21,1014.85 2330.56,940.926 2332.91,961.357 2335.27,964.395 2337.62,789.201 2339.97,659.978 2342.32,793.364 2344.67,891.588 2347.02,849.61 2349.37,945.806 2351.72,972.071 2354.07,972.692 2356.42,675.109 2358.77,907.808 2361.12,887.921 2363.47,828.491 2365.82,884.541 2368.17,844.172 2370.52,893.104 2372.87,877.574 2375.22,763.507 2377.57,856.493 2379.92,1011.3 2382.27,911.457 2384.62,924.506 2386.98,726.88 2389.33,919.496 2391.68,975.179 2394.03,1002.56 2396.38,1087.96 2398.73,865.729 2401.08,943.081 2403.43,1026.77 2405.78,1026.67 2408.13,758.948 2410.48,1063.79 2412.83,900.971 2415.18,906.25 2417.53,944.65 2419.88,998.945 2422.23,1058.08 2424.58,897.742 2426.93,676.038 2429.28,956.508 2431.63,792.902 2433.98,801.093 2436.34,943.235 2438.69,970.286 2441.04,901.451 2443.39,758.992 2445.74,864.5 2448.09,1016.4 2450.44,838.163 2452.79,977.218 2455.14,1022.55 2457.49,1051.14 2459.84,876.826 2462.19,913.321 2464.54,926.935 2466.89,940.244 2469.24,796.367 2471.59,616.493 2473.94,922.742 2476.29,923.547 2478.64,990.85 2480.99,1052.27 2483.34,850.727 2485.7,917.381 2488.05,832.769 2490.4,842.224 2492.75,862.304 2495.1,997.506 2497.45,997.108 2499.8,900.295 2502.15,1078.1 2504.5,900.657 2506.85,896.994 2509.2,997.92 2511.55,800.137 2513.9,889.978 2516.25,862.084 2518.6,973.954 2520.95,737.92 2523.3,1081.14 2525.65,885.207 2528,896.039 2530.35,689.029 2532.7,771.399 2535.06,1121.6 2537.41,799.485 2539.76,634.416 2542.11,945.003 2544.46,778.268 2546.81,967.274 2549.16,1042.1 2551.51,952.122 2553.86,963.716 2556.21,869.976 2558.56,916.172 2560.91,1028.68 2563.26,943.252 2565.61,951.3 2567.96,949.109 2570.31,910.714 "></polyline>
<polyline clip-path="url(#clip032)" style="stroke:#3da44d; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,537.675 224.541,318.494 226.891,382.638 229.242,205.362 231.592,271.449 233.943,241.174 236.293,288.944 238.644,305.065 240.994,372.124 243.345,267.245 245.695,451.494 248.046,332.608 250.396,406.754 252.747,508.815 255.097,486.904 257.448,484.724 259.798,224.486 262.148,364.444 264.499,413.92 266.849,306.243 269.2,360.676 271.55,427.305 273.901,519.139 276.251,425.08 278.602,384.083 280.952,389.481 283.303,506.443 285.653,328.919 288.004,419.51 290.354,417.151 292.705,466.799 295.055,122.252 297.406,349.549 299.756,343.718 302.107,536.218 304.457,527.399 306.807,450.633 309.158,482.377 311.508,382.839 313.859,342.208 316.209,462.331 318.56,485.751 320.91,527.591 323.261,409.656 325.611,563.654 327.962,461.888 330.312,418.851 332.663,427.425 335.013,546.934 337.364,418.242 339.714,385.275 342.065,509.151 344.415,455.501 346.765,500.37 349.116,429.067 351.466,243.142 353.817,311.123 356.167,271.596 358.518,361.103 360.868,406.401 363.219,563.705 365.569,387.119 367.92,282.141 370.27,525.595 372.621,411.808 374.971,430.602 377.322,360.718 379.672,436.028 382.023,183.87 384.373,450.421 386.724,367.094 389.074,367.789 391.424,260.711 393.775,518.56 396.125,397.528 398.476,443.378 400.826,394.694 403.177,299.734 405.527,406.226 407.878,247.547 410.228,447.437 412.579,143.34 414.929,450.764 417.28,167.057 419.63,278.932 421.981,670.309 424.331,364.669 426.682,505.809 429.032,290.831 431.382,576.041 433.733,540.85 436.083,389.076 438.434,492.905 440.784,291.049 443.135,464.682 445.485,284.34 447.836,352.109 450.186,539.088 452.537,316.01 454.887,376.889 457.238,374.235 459.588,419.138 461.939,552.728 464.289,515.945 466.64,494.495 468.99,425.424 471.341,417.361 473.691,427.392 476.041,357.683 478.392,348.899 480.742,326.751 483.093,301.314 485.443,494.443 487.794,371.809 490.144,233.485 492.495,340.232 494.845,200.084 497.196,246.089 499.546,367.547 501.897,326.994 504.247,511.6 506.598,405.679 508.948,568.68 511.299,513.991 513.649,468.734 515.999,376.812 518.35,458.941 520.7,377.383 523.051,256.741 525.401,352.388 527.752,440.727 530.102,472.975 532.453,399.146 534.803,237.868 537.154,286.985 539.504,300.634 541.855,401.694 544.205,254.597 546.556,529.559 548.906,203.199 551.257,517.879 553.607,387.623 555.958,220.125 558.308,522.688 560.658,515.751 563.009,141.424 565.359,487.488 567.71,503.531 570.06,190.217 572.411,310.471 574.761,264.34 577.112,309.781 579.462,428.517 581.813,524.785 584.163,548.406 586.514,377.795 588.864,136.359 591.215,417.167 593.565,151.715 595.916,326.859 598.266,388.312 600.616,456.697 602.967,488.529 605.317,394.75 607.668,310.335 610.018,401.938 612.369,282.243 614.719,334.769 617.07,462.039 619.42,422.027 621.771,415.904 624.121,432.578 626.472,394.445 628.822,439.832 631.173,278.771 633.523,489.102 635.874,634.667 638.224,369.161 640.575,492.559 642.925,254.38 645.275,575.284 647.626,364.898 649.976,449.955 652.327,234.073 654.677,272.604 657.028,263.253 659.378,366.186 661.729,476.695 664.079,258.277 666.43,372.516 668.78,402.9 671.131,458.309 673.481,389.897 675.832,488.341 678.182,556.724 680.533,357.327 682.883,375.171 685.233,527.997 687.584,463.684 689.934,264.874 692.285,241.772 694.635,423.737 696.986,384.9 699.336,393.856 701.687,314.004 704.037,455.481 706.388,452.305 708.738,383.312 711.089,389.334 713.439,402.59 715.79,234.569 718.14,447.663 720.491,279.068 722.841,411.483 725.192,418.51 727.542,513.22 729.892,368.554 732.243,401.009 734.593,219.413 736.944,325.292 739.294,474.743 741.645,601.093 743.995,315.373 746.346,214.949 748.696,231.839 751.047,321.907 753.397,433.439 755.748,506.137 758.098,537.595 760.449,367.877 762.799,577.88 765.15,521.658 767.5,327.988 769.85,465.584 772.201,445.352 774.551,412.899 776.902,319.753 779.252,399.16 781.603,424.65 783.953,375.742 786.304,479.847 788.654,365.41 791.005,303.119 793.355,311.239 795.706,439.22 798.056,405.921 800.407,242.751 802.757,275.581 805.108,367.182 807.458,399.207 809.809,255.428 812.159,479.196 814.509,600.652 816.86,310.12 819.21,397.266 821.561,96.8724 823.911,362.285 826.262,399.172 828.612,361.226 830.963,263.468 833.313,144.255 835.664,192.876 838.014,502.351 840.365,515.09 842.715,178.937 845.066,433.95 847.416,257.339 849.767,494.791 852.117,260.171 854.467,511.88 856.818,209.953 859.168,422.248 861.519,424.449 863.869,200.493 866.22,347.257 868.57,328.16 870.921,350.938 873.271,265.203 875.622,331.215 877.972,381.278 880.323,512.93 882.673,292.969 885.024,407.064 887.374,376.484 889.725,444.907 892.075,482.41 894.426,272.618 896.776,156.15 899.126,451.788 901.477,312.878 903.827,384.965 906.178,261.176 908.528,496.232 910.879,227.453 913.229,311.454 915.58,474.825 917.93,377.929 920.281,454.939 922.631,377.401 924.982,417.529 927.332,469.084 929.683,283.021 932.033,394.866 934.384,400.206 936.734,102.922 939.084,239.942 941.435,508.368 943.785,417.89 946.136,326.866 948.486,273.428 950.837,539.661 953.187,386.072 955.538,389.431 957.888,532.424 960.239,323.383 962.589,590.606 964.94,473.303 967.29,359.416 969.641,473.868 971.991,247.045 974.342,413.295 976.692,460.401 979.043,369.53 981.393,502.107 983.743,410.613 986.094,398.296 988.444,479.927 990.795,540.444 993.145,427.477 995.496,403.75 997.846,350.781 1000.2,476.151 1002.55,210.913 1004.9,332.695 1007.25,321.599 1009.6,261.733 1011.95,364.545 1014.3,447.203 1016.65,318.466 1019,511.494 1021.35,329.38 1023.7,430.861 1026.05,297.518 1028.4,332.186 1030.75,401.165 1033.1,315.523 1035.45,293.083 1037.8,380.586 1040.15,337.243 1042.51,298.182 1044.86,370.16 1047.21,166.241 1049.56,486.621 1051.91,370.547 1054.26,414.182 1056.61,322.554 1058.96,430.861 1061.31,236.237 1063.66,287.323 1066.01,576.679 1068.36,449.745 1070.71,406.043 1073.06,336.318 1075.41,288.468 1077.76,442.557 1080.11,288.666 1082.46,282.06 1084.81,374.615 1087.16,397.806 1089.51,422.51 1091.87,352.268 1094.22,611.272 1096.57,408.678 1098.92,411.97 1101.27,369.367 1103.62,363.921 1105.97,453.668 1108.32,572.164 1110.67,343.491 1113.02,359.923 1115.37,401.206 1117.72,469.554 1120.07,326.609 1122.42,490.831 1124.77,271.944 1127.12,378.994 1129.47,380.626 1131.82,403.597 1134.17,332.005 1136.52,469.063 1138.87,522.794 1141.23,442.848 1143.58,202.864 1145.93,446.022 1148.28,634.107 1150.63,297.371 1152.98,387.923 1155.33,334.279 1157.68,521.895 1160.03,472.821 1162.38,339.019 1164.73,442.714 1167.08,306.536 1169.43,407.73 1171.78,445.764 1174.13,405.663 1176.48,282.17 1178.83,419.367 1181.18,370.108 1183.53,455.252 1185.88,452.335 1188.23,350.944 1190.59,292.361 1192.94,305.121 1195.29,556.119 1197.64,406.329 1199.99,310.27 1202.34,494.875 1204.69,404.832 1207.04,529.455 1209.39,273.785 1211.74,515.61 1214.09,454.815 1216.44,518.117 1218.79,457.822 1221.14,347.223 1223.49,605.68 1225.84,391.056 1228.19,507.476 1230.54,434.236 1232.89,493.224 1235.24,394.041 1237.59,482.156 1239.94,413.123 1242.3,299.296 1244.65,452.605 1247,303.773 1249.35,547.177 1251.7,399.976 1254.05,293.152 1256.4,553.228 1258.75,398.362 1261.1,302.428 1263.45,570.153 1265.8,516.836 1268.15,456.131 1270.5,279.354 1272.85,215.146 1275.2,534.61 1277.55,244.791 1279.9,217.851 1282.25,332.314 1284.6,331.661 1286.95,487.64 1289.3,342.379 1291.66,455.934 1294.01,342.462 1296.36,213.556 1298.71,446.699 1301.06,435.201 1303.41,276.375 1305.76,262.833 1308.11,268.578 1310.46,387.018 1312.81,327.443 1315.16,536.549 1317.51,336.542 1319.86,447.637 1322.21,424.746 1324.56,517.501 1326.91,415.744 1329.26,393.763 1331.61,332.541 1333.96,326.066 1336.31,442.793 1338.66,300.821 1341.02,262.384 1343.37,320.676 1345.72,342.475 1348.07,254.639 1350.42,593.727 1352.77,523.684 1355.12,551.333 1357.47,635.885 1359.82,346.62 1362.17,459.055 1364.52,510.83 1366.87,303.112 1369.22,332.338 1371.57,315.134 1373.92,411.68 1376.27,450.654 1378.62,199.833 1380.97,234.205 1383.32,505.193 1385.67,347.114 1388.02,358.871 1390.38,469.524 1392.73,472.491 1395.08,366.859 1397.43,236.497 1399.78,272.649 1402.13,338.345 1404.48,265.405 1406.83,513.546 1409.18,338.721 1411.53,273.808 1413.88,416.523 1416.23,523.011 1418.58,387.677 1420.93,463.64 1423.28,535.705 1425.63,285.513 1427.98,570.911 1430.33,579.208 1432.68,293.168 1435.03,483.429 1437.38,383.294 1439.74,351.348 1442.09,410.945 1444.44,274.278 1446.79,351.122 1449.14,329.067 1451.49,394.571 1453.84,332.664 1456.19,426.024 1458.54,382.279 1460.89,724.187 1463.24,532.845 1465.59,274.379 1467.94,380.665 1470.29,339.763 1472.64,386.369 1474.99,354.661 1477.34,394.571 1479.69,415.129 1482.04,502.802 1484.39,359.869 1486.74,532.161 1489.1,444.513 1491.45,484.464 1493.8,440.529 1496.15,335.941 1498.5,456.201 1500.85,200.959 1503.2,591.605 1505.55,385.269 1507.9,308.102 1510.25,407.157 1512.6,468.02 1514.95,291.669 1517.3,438.957 1519.65,496.457 1522,344.224 1524.35,360.634 1526.7,249.092 1529.05,403.798 1531.4,301.027 1533.75,353.515 1536.1,657.521 1538.45,626.586 1540.81,269.105 1543.16,326.699 1545.51,359.015 1547.86,282.51 1550.21,243.295 1552.56,583.326 1554.91,163.745 1557.26,433.179 1559.61,386.887 1561.96,332.318 1564.31,201.961 1566.66,623.323 1569.01,178.961 1571.36,347.444 1573.71,358.982 1576.06,307.785 1578.41,367.621 1580.76,311.752 1583.11,410.207 1585.46,399.425 1587.81,518.327 1590.17,406.38 1592.52,430.798 1594.87,308.014 1597.22,293.988 1599.57,236.746 1601.92,370.354 1604.27,241.536 1606.62,325.836 1608.97,366.31 1611.32,346.24 1613.67,385.094 1616.02,354.91 1618.37,441.611 1620.72,249.093 1623.07,441.012 1625.42,474.529 1627.77,501.008 1630.12,426.233 1632.47,450.992 1634.82,356.831 1637.17,413.34 1639.53,377.405 1641.88,181.526 1644.23,319.435 1646.58,401.652 1648.93,293.598 1651.28,453.077 1653.63,486.577 1655.98,221.167 1658.33,271.737 1660.68,596.745 1663.03,454.195 1665.38,622.683 1667.73,341.478 1670.08,255.851 1672.43,594.145 1674.78,313.956 1677.13,320.642 1679.48,496.943 1681.83,610.776 1684.18,369.296 1686.53,543.265 1688.89,433.701 1691.24,488.901 1693.59,568.619 1695.94,448.949 1698.29,501.357 1700.64,399.822 1702.99,253.283 1705.34,396.557 1707.69,444.337 1710.04,377.187 1712.39,453.013 1714.74,515.039 1717.09,252.481 1719.44,351.618 1721.79,277.69 1724.14,252.354 1726.49,434.863 1728.84,412.525 1731.19,335.92 1733.54,500.376 1735.89,548.874 1738.25,480.101 1740.6,426.115 1742.95,314.796 1745.3,488.045 1747.65,393.997 1750,314.34 1752.35,441.332 1754.7,384.226 1757.05,457.724 1759.4,343.187 1761.75,385.793 1764.1,391.318 1766.45,281.116 1768.8,330.563 1771.15,349.505 1773.5,217.519 1775.85,339.18 1778.2,383.963 1780.55,487.137 1782.9,214.869 1785.25,579.615 1787.6,341.106 1789.96,393.17 1792.31,505.06 1794.66,501.518 1797.01,449.336 1799.36,310.222 1801.71,453.719 1804.06,454.471 1806.41,235.801 1808.76,485.361 1811.11,362.318 1813.46,419.992 1815.81,480.595 1818.16,287.116 1820.51,375.668 1822.86,330.626 1825.21,402.002 1827.56,371.119 1829.91,543.283 1832.26,376.455 1834.61,410.893 1836.96,419.966 1839.32,330.062 1841.67,480.71 1844.02,376.605 1846.37,460.819 1848.72,373.671 1851.07,452.084 1853.42,496.104 1855.77,502.549 1858.12,271.914 1860.47,353.9 1862.82,373.711 1865.17,514.996 1867.52,485.781 1869.87,364.261 1872.22,338.909 1874.57,233.08 1876.92,415.708 1879.27,367.269 1881.62,329.822 1883.97,425.619 1886.32,254.853 1888.68,522.583 1891.03,276.838 1893.38,476.493 1895.73,586.565 1898.08,372.743 1900.43,397.926 1902.78,328.509 1905.13,299.597 1907.48,421.38 1909.83,469.058 1912.18,426.466 1914.53,262.699 1916.88,331.189 1919.23,234.408 1921.58,665.56 1923.93,571.803 1926.28,280.812 1928.63,293.87 1930.98,281.279 1933.33,334.811 1935.68,446.737 1938.04,356.193 1940.39,332.586 1942.74,509.195 1945.09,255.639 1947.44,415.815 1949.79,344.875 1952.14,484.718 1954.49,309.425 1956.84,423.461 1959.19,174.451 1961.54,468.068 1963.89,470.914 1966.24,296.23 1968.59,235.307 1970.94,355.173 1973.29,171.843 1975.64,375.422 1977.99,423.87 1980.34,462.013 1982.69,355.601 1985.04,442.008 1987.4,225.48 1989.75,177.321 1992.1,515.571 1994.45,334.759 1996.8,436.836 1999.15,233.858 2001.5,426.222 2003.85,499.666 2006.2,460.424 2008.55,458.442 2010.9,486.055 2013.25,441.516 2015.6,375.07 2017.95,420.627 2020.3,304.374 2022.65,292.49 2025,399.416 2027.35,336.878 2029.7,507.174 2032.05,171.129 2034.4,383.411 2036.76,576.454 2039.11,437.977 2041.46,516.346 2043.81,491.885 2046.16,447.753 2048.51,457.405 2050.86,360.262 2053.21,377.172 2055.56,244.687 2057.91,417.789 2060.26,219.49 2062.61,249.793 2064.96,297.112 2067.31,361.316 2069.66,430.125 2072.01,459.624 2074.36,349.798 2076.71,227.043 2079.06,403.688 2081.41,323.924 2083.76,323.303 2086.11,313.438 2088.47,276.822 2090.82,338.103 2093.17,505.93 2095.52,468.908 2097.87,363.444 2100.22,460.025 2102.57,335.854 2104.92,459.206 2107.27,437.072 2109.62,313.647 2111.97,325.854 2114.32,442.047 2116.67,250.733 2119.02,237.578 2121.37,268.117 2123.72,170.83 2126.07,306.677 2128.42,164.902 2130.77,365.313 2133.12,394.327 2135.47,496.465 2137.83,610.679 2140.18,492.033 2142.53,370.12 2144.88,474.268 2147.23,390.518 2149.58,554.986 2151.93,393.784 2154.28,317.904 2156.63,288.453 2158.98,348.47 2161.33,567.479 2163.68,407.5 2166.03,481.451 2168.38,392.391 2170.73,322.008 2173.08,198.619 2175.43,251.161 2177.78,389.597 2180.13,367.842 2182.48,409.526 2184.83,407.297 2187.19,219.17 2189.54,273.762 2191.89,341.617 2194.24,460.561 2196.59,353.149 2198.94,187.44 2201.29,443.098 2203.64,390.789 2205.99,435.889 2208.34,463.03 2210.69,458.625 2213.04,553.591 2215.39,542.061 2217.74,559.097 2220.09,267.671 2222.44,333.002 2224.79,354.966 2227.14,396.571 2229.49,353.675 2231.84,346.26 2234.19,563.92 2236.55,323.143 2238.9,429.359 2241.25,375.786 2243.6,356.693 2245.95,494.174 2248.3,360.745 2250.65,325.408 2253,326.36 2255.35,468.181 2257.7,296.734 2260.05,312.719 2262.4,341.849 2264.75,337.803 2267.1,383.143 2269.45,492.543 2271.8,257.227 2274.15,450.342 2276.5,347.903 2278.85,336.21 2281.2,444.418 2283.55,157.361 2285.91,260.451 2288.26,434.96 2290.61,393.918 2292.96,494.529 2295.31,525.406 2297.66,539.346 2300.01,180.326 2302.36,388.963 2304.71,376.321 2307.06,419.734 2309.41,244.866 2311.76,226.425 2314.11,520.383 2316.46,493.736 2318.81,295.629 2321.16,441.28 2323.51,427.625 2325.86,478.337 2328.21,176.324 2330.56,143.913 2332.91,352.634 2335.27,563.876 2337.62,345.082 2339.97,176.252 2342.32,489.646 2344.67,487.799 2347.02,394.098 2349.37,418.824 2351.72,739.816 2354.07,290.918 2356.42,534.394 2358.77,405.189 2361.12,274.105 2363.47,339.354 2365.82,440.464 2368.17,439.093 2370.52,408.253 2372.87,254.409 2375.22,371.345 2377.57,393.026 2379.92,463.801 2382.27,380.369 2384.62,439.851 2386.98,441.27 2389.33,408.156 2391.68,353.004 2394.03,443.761 2396.38,309.948 2398.73,361.799 2401.08,395.397 2403.43,309.723 2405.78,338.219 2408.13,312.424 2410.48,461.409 2412.83,561.833 2415.18,284.562 2417.53,458.238 2419.88,364.333 2422.23,421.286 2424.58,223.253 2426.93,478.632 2429.28,377.349 2431.63,367.549 2433.98,383.985 2436.34,467.788 2438.69,376.429 2441.04,459.471 2443.39,401.596 2445.74,206.721 2448.09,323.598 2450.44,401.198 2452.79,362.748 2455.14,475.862 2457.49,665.783 2459.84,370.818 2462.19,435.743 2464.54,450.71 2466.89,453.567 2469.24,153.627 2471.59,455.629 2473.94,547.543 2476.29,532.689 2478.64,403.834 2480.99,508.768 2483.34,465.306 2485.7,270.132 2488.05,325.221 2490.4,300.559 2492.75,340.554 2495.1,338.568 2497.45,282.356 2499.8,239.17 2502.15,363.169 2504.5,349.882 2506.85,551.11 2509.2,460.52 2511.55,379.876 2513.9,537.184 2516.25,349.118 2518.6,201.613 2520.95,438.341 2523.3,343.346 2525.65,404.615 2528,461.346 2530.35,403.078 2532.7,381.894 2535.06,402.2 2537.41,425.621 2539.76,398.787 2542.11,314.241 2544.46,364.698 2546.81,584.63 2549.16,346.772 2551.51,429.387 2553.86,515.963 2556.21,384.472 2558.56,202.171 2560.91,555.646 2563.26,498.976 2565.61,367.477 2567.96,252.24 2570.31,433.128 "></polyline>
</svg>
</div>
</div>
<p>Look at that! Things are working; amazin’.</p>
<p>We can also exploit <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>’s parallel sampling capabilities:</p>
<div id="34" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run separate 4 chains for 10 000 iterations using threads to parallelize.</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>num_chains <span class="op">=</span> <span class="fl">4</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    model_with_grad,</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">MCMCThreads</span>(),</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>,</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    num_chains;</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Note we need to provide an initial state for every chain.</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>    initial_state<span class="op">=</span><span class="fu">fill</span>(state, num_chains),</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>samples_array <span class="op">=</span> <span class="fu">stack</span>(<span class="fu">map</span>(<span class="bu">Base</span>.<span class="fu">Fix1</span>(stack, sample <span class="op">-&gt;</span> sample.x), samples))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000×4 Array{Float64, 3}:
[:, :, 1] =
 -2.45745    -5.00567  -3.91513   …  -6.13961   -6.13961   -6.89039
  0.0492271   1.11184  -0.193479      0.439805   0.439805  -0.466571
  2.35742     2.21588   3.07507       6.11082    6.11082    6.81956

[:, :, 2] =
 -2.53707  -2.76051   -4.16596  -3.01233  …  -5.59361   -4.74841  -4.93943
 -1.1932   -0.979229  -1.46343  -1.8319       0.554526   1.46709   0.817372
  3.28661   2.39652    4.52294   3.96517      5.44014    5.12387   5.69337

[:, :, 3] =
 -2.33961   -2.4991   -4.50323  -3.98878   …  -3.24481  -2.64606  -4.20839
 -0.693612   1.06666  -0.12247  -0.916436      2.34172   2.06679   1.12049
  2.9433     4.49094   4.58233   4.78941       5.15666   5.31994   7.87678

[:, :, 4] =
 -2.84721  -2.84721  -2.93853   -2.93853   …  -5.30112   -2.53909   -4.11124
 -1.99091  -1.99091   0.132834   0.132834      0.895445   0.203621  -0.296309
  3.55024   3.55024   4.06121    4.06121       6.15723    5.79752    6.45928</code></pre>
</div>
</div>
<p>But the fact that we have to provide the <code>AbstractMCMC.sample</code> call, etc. with an <code>initial_state</code> to get started is a bit annoying. We can avoid this by also defining a <code>AbstractMCMC.step</code> <em>without</em> the <code>state</code> argument:</p>
<div id="36" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">::</span><span class="dt">MALA</span>;</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># </span><span class="al">NOTE</span><span class="co">: No state provided!</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just create the initial state by sampling using  a Gaussian.</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="fu">randn</span>(rng, LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(x), <span class="fu">MALAState</span>(x)</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Equipped with this, we no longer need to provide the <code>initial_state</code> everywhere:</p>
<div id="38" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -4.98673    1.01441
  0.0239057  0.99522
  4.99195    1.01455</code></pre>
</div>
</div>
</section>
<section id="using-our-sampler-with-turing.jl" class="level2">
<h2 class="anchored" data-anchor-id="using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</h2>
<p>As we promised, all of this hassle of implementing our <code>MALA</code> sampler in a way that uses <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> and <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> gets us something more than <em>just</em> an “automatic” implementation of <code>AbstractMCMC.sample</code>.</p>
<p>It also enables use with Turing.jl through the <code>externalsampler</code>, but we need to do one final thing first: we need to tell Turing.jl how to extract a vector of parameters from the “sample” returned in our implementation of <code>AbstractMCMC.step</code>. In our case, the “sample” is a <code>MALASample</code>, so we just need the following line:</p>
<div id="40" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load Turing.jl.</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Turing</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Overload the `getparams` method for our "sample" type, which is just a vector.</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>Turing.Inference.<span class="fu">getparams</span>(<span class="op">::</span><span class="dt">Turing.Model</span>, sample<span class="op">::</span><span class="dt">MALASample</span>) <span class="op">=</span> sample.x</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And with that, we’re good to go!</p>
<div id="42" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Our previous model defined as a Turing.jl model.</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">mvnormal_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">MvNormal</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.], I)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate our model.</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">mvnormal_model</span>()</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Call `sample` but now we're passing in a Turing.jl `model` and wrapping</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co"># our `MALA` sampler in the `externalsampler` to tell Turing.jl that the sampler</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co"># expects something that implements LogDensityProblems.jl.</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×4×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 2.52 seconds
Compute duration  = 2.52 seconds
parameters        = x[1], x[2], x[3]
internals         = lp

Summary Statistics
  parameters      mean       std      mcse    ess_bulk    ess_tail      rhat   ⋯
      Symbol   Float64   Float64   Float64     Float64     Float64   Float64   ⋯

        x[1]   -4.9997    1.0155    0.0180   3180.3654   5070.4858    1.0002   ⋯
        x[2]   -0.0096    1.0099    0.0177   3244.6030   4677.4688    1.0001   ⋯
        x[3]    4.9976    1.0057    0.0172   3430.9385   5170.7367    1.0000   ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

        x[1]   -7.0099   -5.6783   -5.0148   -4.3226   -2.9765
        x[2]   -1.9897   -0.6958   -0.0192    0.6761    1.9781
        x[3]    3.0146    4.3264    5.0058    5.6895    6.9236</code></pre>
</div>
</div>
<p>Pretty neat, eh?</p>
<section id="models-with-constrained-parameters" class="level3">
<h3 class="anchored" data-anchor-id="models-with-constrained-parameters">Models with constrained parameters</h3>
<p>One thing we’ve sort of glossed over in all of the above is that MALA, at least how we’ve implemented it, requires <span class="math inline">\(x\)</span> to live in <span class="math inline">\(\mathbb{R}^d\)</span> for some <span class="math inline">\(d &gt; 0\)</span>. If some of the parameters were in fact constrained, e.g.&nbsp;we were working with a <code>Beta</code> distribution which has support on the interval <span class="math inline">\((0, 1)\)</span>, <em>not</em> on <span class="math inline">\(\mathbb{R}^d\)</span>, we could easily end up outside of the valid range <span class="math inline">\((0, 1)\)</span>.</p>
<div id="44" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">beta_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">beta_model</span>()</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 1.48 seconds
Compute duration  = 1.48 seconds
parameters        = x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse    ess_bulk    ess_tail      rhat   ⋯
      Symbol   Float64   Float64   Float64     Float64     Float64   Float64   ⋯

           x    0.5031    0.1903    0.0028   4419.8872   5688.3062    1.0004   ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

           x    0.1426    0.3622    0.5047    0.6434    0.8611</code></pre>
</div>
</div>
<p>Yep, that still works, but only because Turing.jl actually <em>transforms</em> the <code>turing_model</code> from constrained to unconstrained, so that the <code>sampler</code> provided to <code>externalsampler</code> is actually always working in unconstrained space! This is not always desirable, so we can turn this off:</p>
<div id="46" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 0.24 seconds
Compute duration  = 0.24 seconds
parameters        = x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse   ess_bulk   ess_tail      rhat   e ⋯
      Symbol   Float64   Float64   Float64    Float64    Float64   Float64     ⋯

           x    0.5089    0.1445    0.0106   165.1567    66.1571    1.0154     ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

           x    0.2539    0.3876    0.5064    0.6226    0.7567</code></pre>
</div>
</div>
<p>The fun thing is that this still sort of works because</p>
<div id="48" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">logpdf</span>(<span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>), <span class="fl">10.0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-Inf</code></pre>
</div>
</div>
<p>and so the samples that fall outside of the range are always rejected. But do notice how much worse all the diagnostics are, e.g.&nbsp;<code>ess_tail</code> is very poor compared to when we use <code>unconstrained=true</code>. Moreover, in more complex cases this won’t just result in a “nice” <code>-Inf</code> log-density value, but instead will error:</p>
<div id="50" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="kw">function</span> <span class="fu">demo</span>()</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>    σ² <span class="op">~</span> <span class="fu">truncated</span>(<span class="fu">Normal</span>(), lower<span class="op">=</span><span class="fl">0</span>)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If we end up with negative values for `σ²`, the `Normal` will error.</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>    x <span class="op">~</span> <span class="fu">Normal</span>(<span class="fl">0</span>, σ²)</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 2.34 seconds
Compute duration  = 2.34 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse   ess_bulk   ess_tail      rhat   e ⋯
      Symbol   Float64   Float64   Float64    Float64    Float64   Float64     ⋯

          σ²    0.3405    0.0000    0.0000        NaN        NaN       NaN     ⋯
           x    1.4874    0.0000    0.0000        NaN        NaN       NaN     ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

          σ²    0.3405    0.3405    0.3405    0.3405    0.3405
           x    1.4874    1.4874    1.4874    1.4874    1.4874</code></pre>
</div>
</div>
<p>As expected, we run into a <code>DomainError</code> at some point, while if we set <code>unconstrained=true</code>, letting Turing.jl transform the model to a unconstrained form behind the scenes, everything works as expected:</p>
<div id="52" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 0.56 seconds
Compute duration  = 0.56 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse   ess_bulk   ess_tail      rhat   e ⋯
      Symbol   Float64   Float64   Float64    Float64    Float64   Float64     ⋯

          σ²    1.1511    0.9666    0.1691    61.3249        NaN    1.0553     ⋯
           x   -0.0363    0.9628    0.0632   203.7553   319.1598    1.0056     ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

          σ²    0.1405    0.4472    0.8550    1.4718    3.5432
           x   -2.0494   -0.6626   -0.0588    0.3867    2.1557</code></pre>
</div>
</div>
<p>Neat!</p>
<p>Similarly, which automatic differentiation backend one should use can be specified through the <code>adtype</code> keyword argument too. For example, if we want to use <a href="https://github.com/JuliaDiff/ReverseDiff.jl">ReverseDiff.jl</a> instead of the default <a href="https://github.com/JuliaDiff/ForwardDiff.jl">ForwardDiff.jl</a>:</p>
<div id="54" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">ReverseDiff</span>: ReverseDiff</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify that we want to use `AutoReverseDiff`.</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">demo</span>(),</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>, adtype<span class="op">=</span><span class="fu">AutoReverseDiff</span>()),</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>;</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 2.99 seconds
Compute duration  = 2.99 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse   ess_bulk   ess_tail      rhat   e ⋯
      Symbol   Float64   Float64   Float64    Float64    Float64   Float64     ⋯

          σ²    7.9478    0.0000    0.0000        NaN        NaN       NaN     ⋯
           x    0.0520    0.0000    0.0000        NaN        NaN       NaN     ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

          σ²    7.9478    7.9478    7.9478    7.9478    7.9478
           x    0.0520    0.0520    0.0520    0.0520    0.0520</code></pre>
</div>
</div>
<p>Double-neat.</p>
</section>
</section>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<p>At this point it’s worth maybe reminding ourselves what we did and also <em>why</em> we did it:</p>
<ol type="1">
<li>We define our models in the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface because it makes the sampler agnostic to how the underlying model is implemented.</li>
<li>We implement our sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> interface, which just means that our sampler is a subtype of <code>AbstractMCMC.AbstractSampler</code> and we implement the MCMC transition in <code>AbstractMCMC.step</code>.</li>
<li>Points 1 and 2 makes it so our sampler can be used with a wide range of model implementations, amongst them being models implemented in both Turing.jl and Stan. This gives you, the inference implementer, a large collection of models to test your inference method on, in addition to allowing users of Turing.jl and Stan to try out your inference method with minimal effort.</li>
</ol>


</section>


<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a><div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>We’re going with the leapfrog formulation because in a future version of this tutorial we’ll add a section extending this simple “baseline” MALA sampler to more complex versions. See <a href="https://github.com/TuringLang/docs/issues/479">issue #479</a> for progress on this.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>There is no such thing as a proper interface in Julia (at least not officially), and so we use the word “interface” here to mean a few minimal methods that needs to be implemented by any type that we treat as a target model.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/turinglang\.org\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../tutorials/docs-07-for-developers-variational-inference/index.html" class="pagination-link" aria-label="Variational Inference">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Variational Inference</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Turing is created by <a href="http://mlg.eng.cam.ac.uk/hong/" target="_blank">Hong Ge</a>, and lovingly maintained by the <a href="https://github.com/TuringLang/Turing.jl/graphs/contributors" target="_blank">core team</a> of volunteers. <br> The contents of this website are © 2024 under the terms of the <a href="https://github.com/TuringLang/Turing.jl/blob/master/LICENCE" target="_blank">MIT License</a>.</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/TuringLang/docs/edit/master/tutorials/docs-17-implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/docs/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://x.com/TuringLang">
      <i class="bi bi-twitter" role="img" aria-label="Turing Twitter">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/TuringLang/Turing.jl">
      <i class="bi bi-github" role="img" aria-label="Turing GitHub">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




<script src="../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>