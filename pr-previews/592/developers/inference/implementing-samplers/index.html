<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.29">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Implementing Samplers – Turing.jl</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<link href="../../../developers/inference/variational-inference/index.html" rel="prev">
<link href="../../../assets/favicon.ico" rel="icon">
<script src="../../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-0815c480559380816a4d1ea211a47e91.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-dark-748b535e376f14d4692bf2b2e5fd6380.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-0815c480559380816a4d1ea211a47e91.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap-3cc9661ad5558cf991e5d482cb1ae91a.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../../site_libs/bootstrap/bootstrap-dark-c86e2dc3ddafb79a8bfacad56f06eefd.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="../../../site_libs/bootstrap/bootstrap-3cc9661ad5558cf991e5d482cb1ae91a.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<style>
  a {
    text-decoration: none;
  }
  a:hover {
    text-decoration: underline;
  }
</style>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../../theming/styles.css">
</head>

<body class="nav-sidebar floating nav-fixed quarto-light"><script id="quarto-html-before-body" type="application/javascript">
    const toggleBodyColorMode = (bsSheetEl) => {
      const mode = bsSheetEl.getAttribute("data-mode");
      const bodyEl = window.document.querySelector("body");
      if (mode === "dark") {
        bodyEl.classList.add("quarto-dark");
        bodyEl.classList.remove("quarto-light");
      } else {
        bodyEl.classList.add("quarto-light");
        bodyEl.classList.remove("quarto-dark");
      }
    }
    const toggleBodyColorPrimary = () => {
      const bsSheetEl = window.document.querySelector("link#quarto-bootstrap:not([rel=disabled-stylesheet])");
      if (bsSheetEl) {
        toggleBodyColorMode(bsSheetEl);
      }
    }
    const setColorSchemeToggle = (alternate) => {
      const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
      for (let i=0; i < toggles.length; i++) {
        const toggle = toggles[i];
        if (toggle) {
          if (alternate) {
            toggle.classList.add("alternate");
          } else {
            toggle.classList.remove("alternate");
          }
        }
      }
    };
    const toggleColorMode = (alternate) => {
      // Switch the stylesheets
      const primaryStylesheets = window.document.querySelectorAll('link.quarto-color-scheme:not(.quarto-color-alternate)');
      const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
      manageTransitions('#quarto-margin-sidebar .nav-link', false);
      if (alternate) {
        // note: dark is layered on light, we don't disable primary!
        enableStylesheet(alternateStylesheets);
        for (const sheetNode of alternateStylesheets) {
          if (sheetNode.id === "quarto-bootstrap") {
            toggleBodyColorMode(sheetNode);
          }
        }
      } else {
        disableStylesheet(alternateStylesheets);
        enableStylesheet(primaryStylesheets)
        toggleBodyColorPrimary();
      }
      manageTransitions('#quarto-margin-sidebar .nav-link', true);
      // Switch the toggles
      setColorSchemeToggle(alternate)
      // Hack to workaround the fact that safari doesn't
      // properly recolor the scrollbar when toggling (#1455)
      if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
        manageTransitions("body", false);
        window.scrollTo(0, 1);
        setTimeout(() => {
          window.scrollTo(0, 0);
          manageTransitions("body", true);
        }, 40);
      }
    }
    const disableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        stylesheet.rel = 'disabled-stylesheet';
      }
    }
    const enableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        if(stylesheet.rel !== 'stylesheet') { // for Chrome, which will still FOUC without this check
          stylesheet.rel = 'stylesheet';
        }
      }
    }
    const manageTransitions = (selector, allowTransitions) => {
      const els = window.document.querySelectorAll(selector);
      for (let i=0; i < els.length; i++) {
        const el = els[i];
        if (allowTransitions) {
          el.classList.remove('notransition');
        } else {
          el.classList.add('notransition');
        }
      }
    }
    const isFileUrl = () => {
      return window.location.protocol === 'file:';
    }
    const hasAlternateSentinel = () => {
      let styleSentinel = getColorSchemeSentinel();
      if (styleSentinel !== null) {
        return styleSentinel === "alternate";
      } else {
        return false;
      }
    }
    const setStyleSentinel = (alternate) => {
      const value = alternate ? "alternate" : "default";
      if (!isFileUrl()) {
        window.localStorage.setItem("quarto-color-scheme", value);
      } else {
        localAlternateSentinel = value;
      }
    }
    const getColorSchemeSentinel = () => {
      if (!isFileUrl()) {
        const storageValue = window.localStorage.getItem("quarto-color-scheme");
        return storageValue != null ? storageValue : localAlternateSentinel;
      } else {
        return localAlternateSentinel;
      }
    }
    const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
      const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
      const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
      let newTheme = '';
      if(authorPrefersDark) {
        newTheme = isAlternate ? baseTheme : alternateTheme;
      } else {
        newTheme = isAlternate ? alternateTheme : baseTheme;
      }
      const changeGiscusTheme = () => {
        // From: https://github.com/giscus/giscus/issues/336
        const sendMessage = (message) => {
          const iframe = document.querySelector('iframe.giscus-frame');
          if (!iframe) return;
          iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
        }
        sendMessage({
          setConfig: {
            theme: newTheme
          }
        });
      }
      const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
      if (isGiscussLoaded) {
        changeGiscusTheme();
      }
    };
    const authorPrefersDark = false;
    const darkModeDefault = authorPrefersDark;
      document.querySelector('link#quarto-text-highlighting-styles.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
      document.querySelector('link#quarto-bootstrap.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
    let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
    // Dark / light mode switch
    window.quartoToggleColorScheme = () => {
      // Read the current dark / light value
      let toAlternate = !hasAlternateSentinel();
      toggleColorMode(toAlternate);
      setStyleSentinel(toAlternate);
      toggleGiscusIfUsed(toAlternate, darkModeDefault);
    };
    // Switch to dark mode if need be
    if (hasAlternateSentinel()) {
      toggleColorMode(true);
    } else {
      toggleColorMode(false);
    }
  </script>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="https://turinglang.org/" class="navbar-brand navbar-brand-logo">
    <img src="../../../assets/images/turing-logo.svg" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="https://turinglang.org/">
    <span class="navbar-title">Turing.jl</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../getting-started/"> 
<span class="menu-text">Get Started</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../tutorials/coin-flipping/"> 
<span class="menu-text">Tutorials</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/library/"> 
<span class="menu-text">Libraries</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/news/"> 
<span class="menu-text">News</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/team/"> 
<span class="menu-text">Team</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-v0.37" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">v0.37</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-v0.37">    
        <li>
    <a class="dropdown-item" href="https://turinglang.org/docs/changelog.html">
 <span class="dropdown-text">Changelog</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://turinglang.org/docs/versions.html">
 <span class="dropdown-text">All Versions</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools tools-wide">
    <a href="https://x.com/TuringLang" title="Turing Twitter" class="quarto-navigation-tool px-1" aria-label="Turing Twitter"><i class="bi bi-twitter"></i></a>
    <a href="https://github.com/TuringLang/Turing.jl" title="Turing GitHub" class="quarto-navigation-tool px-1" aria-label="Turing GitHub"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../../developers/contributing/index.html">Developers</a></li><li class="breadcrumb-item"><a href="../../../developers/inference/abstractmcmc-interface/index.html">Inference (note: outdated)</a></li><li class="breadcrumb-item"><a href="../../../developers/inference/implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../getting-started/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Getting Started</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../core-functionality/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Core Functionality</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false">
 <span class="menu-text">User Guide</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/automatic-differentiation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Automatic Differentiation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/custom-distribution/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Custom Distributions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/probability-interface/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Querying Model Probabilities</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/modifying-logprob/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Modifying the Log Probability</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/generated-quantities/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Generated Quantities</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/mode-estimation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Mode Estimation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/performance-tips/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Performance Tips</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/sampler-visualisation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Sampler Visualization</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/dynamichmc/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using DynamicHMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/external-samplers/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using External Samplers</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false">
 <span class="menu-text">Tutorials</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/coin-flipping/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction: Coin Flipping</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/gaussian-mixture-models/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Mixture Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-neural-networks/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Neural Networks</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/hidden-markov-models/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Hidden Markov Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-linear-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Linear Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/infinite-mixture-models/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Infinite Mixture Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-poisson-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Poisson Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/multinomial-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Multinomial Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-differential-equations/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Differential Equations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/probabilistic-pca/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Probabilistic PCA</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-time-series-analysis/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Time Series Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/gaussian-processes-introduction/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Processes: Introduction</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/gaussian-process-latent-variable-models/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Process Latent Variable Models</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Developers</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/contributing/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Contributing</span></a>
  </div>
</li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false">
 <span class="menu-text">DynamicPPL’s Compiler</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/compiler/model-manual/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Manually Defining a Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/compiler/minituring-compiler/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation I: Compiler</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/compiler/minituring-contexts/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation II: Contexts</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/compiler/design-overview/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Turing Compiler Design (Outdated)</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false">
 <span class="menu-text">Variable Transformations</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/transforms/distributions/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Distributions and the Jacobian</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/transforms/bijectors/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bijectors in MCMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/transforms/dynamicppl/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variable transformations in DynamicPPL</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true">
 <span class="menu-text">Inference (note: outdated)</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/inference/abstractmcmc-interface/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Interface Guide</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/inference/abstractmcmc-turing/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">How Turing Implements AbstractMCMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/inference/variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/inference/implementing-samplers/index.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Implementing Samplers</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of Contents</h2>
   
  <ul>
  <li><a href="#quick-overview-of-mala" id="toc-quick-overview-of-mala" class="nav-link active" data-scroll-target="#quick-overview-of-mala">Quick overview of MALA</a></li>
  <li><a href="#what-we-need-from-a-model-logdensityproblems.jl" id="toc-what-we-need-from-a-model-logdensityproblems.jl" class="nav-link" data-scroll-target="#what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: LogDensityProblems.jl</a></li>
  <li><a href="#implementing-mala-in-abstractmcmc.jl" id="toc-implementing-mala-in-abstractmcmc.jl" class="nav-link" data-scroll-target="#implementing-mala-in-abstractmcmc.jl">Implementing MALA in AbstractMCMC.jl</a></li>
  <li><a href="#using-our-sampler-with-turing.jl" id="toc-using-our-sampler-with-turing.jl" class="nav-link" data-scroll-target="#using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</a>
  <ul class="collapse">
  <li><a href="#models-with-constrained-parameters" id="toc-models-with-constrained-parameters" class="nav-link" data-scroll-target="#models-with-constrained-parameters">Models with constrained parameters</a></li>
  </ul></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/TuringLang/docs/edit/main/developers/inference/implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/docs/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">


<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../../developers/contributing/index.html">Developers</a></li><li class="breadcrumb-item"><a href="../../../developers/inference/abstractmcmc-interface/index.html">Inference (note: outdated)</a></li><li class="breadcrumb-item"><a href="../../../developers/inference/implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Implementing Samplers</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>In this tutorial, we’ll go through step-by-step how to implement a “simple” sampler in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> in such a way that it can be easily applied to Turing.jl models.</p>
<p>In particular, we’re going to implement a version of <strong>Metropolis-adjusted Langevin (MALA)</strong>.</p>
<p>Note that we will implement this sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> framework, completely “ignoring” Turing.jl until the very end of the tutorial, at which point we’ll use a single line of code to make the resulting sampler available to Turing.jl. This is to really drive home the point that one can implement samplers in a way that is accessible to all of Turing.jl’s users without having to use Turing.jl yourself.</p>
<section id="quick-overview-of-mala" class="level2">
<h2 class="anchored" data-anchor-id="quick-overview-of-mala">Quick overview of MALA</h2>
<p>We can view MALA as a single step of the leapfrog intergrator with resampling of momentum <span class="math inline">\(p\)</span> at every step.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> To make that statement a bit more concrete, we first define the <em>extended</em> target <span class="math inline">\(\bar{\gamma}(x, p)\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\log \bar{\gamma}(x, p) \propto \log \gamma(x) + \log \gamma_{\mathcal{N}(0, M)}(p)
\end{equation*}\]</span></p>
<p>where <span class="math inline">\(\gamma_{\mathcal{N}(0, M)}\)</span> denotes the density for a zero-centered Gaussian with covariance matrix <span class="math inline">\(M\)</span>. We then consider targeting this joint distribution over both <span class="math inline">\(x\)</span> and <span class="math inline">\(p\)</span> as follows. First we define the map</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  L_{\epsilon}: \quad &amp; \mathbb{R}^d \times \mathbb{R}^d \to \mathbb{R}^d \times \mathbb{R}^d \\
  &amp; (x, p) \mapsto (\tilde{x}, \tilde{p}) := L_{\epsilon}(x, p)
\end{split}
\end{equation*}\]</span></p>
<p>as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p_{1 / 2} &amp;:= p + \frac{\epsilon}{2} \nabla \log \gamma(x) \\
  \tilde{x} &amp;:= x + \epsilon M^{-1} p_{1 /2 } \\
  p_1 &amp;:= p_{1 / 2} + \frac{\epsilon}{2} \nabla \log \gamma(\tilde{x}) \\
  \tilde{p} &amp;:= - p_1
\end{split}
\end{equation*}\]</span></p>
<p>This might be familiar for some readers as a single step of the Leapfrog integrator. We then define the MALA kernel as follows: given the current iterate <span class="math inline">\(x_i\)</span>, we sample the next iterate <span class="math inline">\(x_{i + 1}\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p &amp;\sim \mathcal{N}(0, M) \\
  (\tilde{x}, \tilde{p}) &amp;:= L_{\epsilon}(x_i, p) \\
  \alpha &amp;:= \min \left\{ 1, \frac{\bar{\gamma}(\tilde{x}, \tilde{p})}{\bar{\gamma}(x_i, p)} \right\} \\
  x_{i + 1} &amp;:=
  \begin{cases}
    \tilde{x} \quad &amp; \text{ with prob. } \alpha \\
    x_i       \quad &amp; \text{ with prob. } 1 - \alpha
  \end{cases}
\end{split}
\end{equation*}\]</span></p>
<p>i.e.&nbsp;we accept the proposal <span class="math inline">\(\tilde{x}\)</span> with probability <span class="math inline">\(\alpha\)</span> and reject it, thus sticking with our current iterate, with probability <span class="math inline">\(1 - \alpha\)</span>.</p>
</section>
<section id="what-we-need-from-a-model-logdensityproblems.jl" class="level2">
<h2 class="anchored" data-anchor-id="what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a></h2>
<p>There are a few things we need from the “target” / “model” / density that we want to sample from:</p>
<ol type="1">
<li>We need access to log-density <em>evaluations</em> <span class="math inline">\(\log \gamma(x)\)</span> so we can compute the acceptance ratio involving <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>We need access to log-density <em>gradients</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span> so we can compute the Leapfrog steps <span class="math inline">\(L_{\epsilon}(x, p)\)</span>.</li>
<li>We also need access to the “size” of the model so we can determine the size of <span class="math inline">\(M\)</span>.</li>
</ol>
<p>Luckily for us, there is a package called <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> which provides an interface for <em>exactly</em> this!</p>
<p>To demonstrate how one can implement the “<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface”<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> we will use a simple Gaussian model as an example:</p>
<div id="4" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblems</span>: LogDensityProblems;</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's define some type that represents the model.</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> IsotropicNormalModel{M<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"mean of the isotropic Gaussian"</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    mean<span class="op">::</span><span class="dt">M</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Specifies what input length the model expects.</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">dimension</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> <span class="fu">length</span>(model.mean)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Implementation of the log-density evaluation of the model.</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x<span class="op">::</span><span class="dt">AbstractVector{&lt;:Real}</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">-</span> <span class="fu">sum</span>(abs2, x <span class="op">.-</span> model.mean) <span class="op">/</span> <span class="fl">2</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This gives us all of the properties we want for our MALA sampler with the exception of the computation of the <em>gradient</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span>. There is the method <code>LogDensityProblems.logdensity_and_gradient</code> which should return a 2-tuple where the first entry is the evaluation of the logdensity <span class="math inline">\(\log \gamma(x)\)</span> and the second entry is the gradient <span class="math inline">\(\nabla \log \gamma(x)\)</span>.</p>
<p>There are two ways to “implement” this method: 1) we implement it by hand, which is feasible in the case of our <code>IsotropicNormalModel</code>, or b) we defer the implementation of this to a automatic differentiation backend.</p>
<p>To implement it by hand we can simply do</p>
<div id="6" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl that first-order, i.e. gradient information, is available.</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{1}</span>()</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Implement `logdensity_and_gradient`.</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    logγ_x <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="op">-</span>x <span class="op">.*</span> (x <span class="op">-</span> model.mean)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> logγ_x, ∇logγ_x</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s just try it out:</p>
<div id="8" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate the problem.</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> <span class="fu">IsotropicNormalModel</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.])</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create some example input that we can test on.</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>x_example <span class="op">=</span> <span class="fu">randn</span>(LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate!</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-26.215956899905493</code></pre>
</div>
</div>
<p>To defer it to an automatic differentiation backend, we can do</p>
<div id="10" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl we only have access to 0-th order information.</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{0}</span>()</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Use `LogDensityProblemsAD`'s `ADgradient` in combination with some AD backend to implement `logdensity_and_gradient`.</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblemsAD</span>, <span class="bu">ADTypes</span>, <span class="bu">ForwardDiff</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>model_with_grad <span class="op">=</span> <span class="fu">ADgradient</span>(<span class="fu">AutoForwardDiff</span>(), model)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model_with_grad, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-26.215956899905493</code></pre>
</div>
</div>
<p>We’ll continue with the second approach in this tutorial since this is typically what one does in practice, because there are better hobbies to spend time on than deriving gradients by hand.</p>
<p>At this point, one might wonder how we’re going to tie this back to Turing.jl in the end. Effectively, when working with inference methods that only require log-density evaluations and / or higher-order information of the log-density, Turing.jl actually converts the user-provided <code>Model</code> into an object implementing the above methods for <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>. As a result, most samplers provided by Turing.jl are actually implemented to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, enabling their use both <em>within</em> Turing.jl and <em>outside</em> of Turing.jl! Morever, there exists similar conversions for Stan through BridgeStan and Stan<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, which means that a sampler supporting the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface can easily be used on both Turing.jl <em>and</em> Stan models (in addition to user-provided models, as our <code>IsotropicNormalModel</code> above)!</p>
<p>Anyways, let’s move on to actually implementing the sampler.</p>
</section>
<section id="implementing-mala-in-abstractmcmc.jl" class="level2">
<h2 class="anchored" data-anchor-id="implementing-mala-in-abstractmcmc.jl">Implementing MALA in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a></h2>
<p>Now that we’ve established that a model implementing the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface provides us with all the information we need from <span class="math inline">\(\log \gamma(x)\)</span>, we can address the question: given an object that implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, how can we define a sampler for it?</p>
<p>We’re going to do this by making our sampler a sub-type of <code>AbstractMCMC.AbstractSampler</code> in addition to implementing a few methods from <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>. Why? Because it gets us <em>a lot</em> of functionality for free, as we will see later.</p>
<p>Moreover, <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> provides a very natural interface for MCMC algorithms.</p>
<p>First, we’ll define our <code>MALA</code> type</p>
<div id="12" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">AbstractMCMC</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALA{T,A} <span class="op">&lt;:</span><span class="dt"> AbstractMCMC.AbstractSampler</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"stepsize used in the leapfrog step"</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    ϵ_init<span class="op">::</span><span class="dt">T</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"covariance matrix used for the momentum"</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    M_init<span class="op">::</span><span class="dt">A</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notice how we’ve added the suffix <code>_init</code> to both the stepsize and the covariance matrix. We’ve done this because a <code>AbstractMCMC.AbstractSampler</code> should be <em>immutable</em>. Of course there might be many scenarios where we want to allow something like the stepsize and / or the covariance matrix to vary between iterations, e.g.&nbsp;during the burn-in / adaptation phase of the sampling process we might want to adjust the parameters using statistics computed from these initial iterations. But information which can change between iterations <em>should not go in the sampler itself</em>! Instead, this information should go in the sampler <em>state</em>.</p>
<p>The sampler state should at the very least contain all the necessary information to perform the next MCMC iteration, but usually contains further information, e.g.&nbsp;quantities and statistics useful for evaluating whether the sampler has converged.</p>
<p>We will use the following sampler state for our <code>MALA</code> sampler:</p>
<div id="14" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALAState{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This might seem overly redundant: we’re defining a type <code>MALAState</code> and it only contains a simple vector of reals. In this particular case we indeed could have dropped this and simply used a <code>AbstractVector{&lt;:Real}</code> as our sampler state, but typically, as we will see later, one wants to include other quantities in the sampler state. For example, if we also wanted to adapt the parameters of our <code>MALA</code>, e.g.&nbsp;alter the stepsize depending on acceptance rates, in which case we should also put <code>ϵ</code> in the state, but for now we’ll keep things simple.</p>
<p>Moreover, we also want a <em>sample</em> type, which is a type meant for “public consumption”, i.e.&nbsp;the end-user. This is generally going to contain a subset of the information present in the state. But in such a simple scenario as this, we similarly only have a <code>AbstractVector{&lt;:Real}</code>:</p>
<div id="16" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALASample{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We currently have three things:</p>
<ol type="1">
<li>A <code>AbstractMCMC.AbstractSampler</code> implementation called <code>MALA</code>.</li>
<li>A state <code>MALAState</code> for our sampler <code>MALA</code>.</li>
<li>A sample <code>MALASample</code> for our sampler <code>MALA</code>.</li>
</ol>
<p>That means that we’re ready to implement the only thing that really matters: <code>AbstractMCMC.step</code>.</p>
<p><code>AbstractMCMC.step</code> defines the MCMC iteration of our <code>MALA</code> given the current <code>MALAState</code>. Specifically, the signature of the function is as follows:</p>
<div id="18" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The RNG to ensure reproducibility.</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The model that defines our target.</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.AbstractModel</span>,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The sampler for which we're taking a `step`.</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">AbstractMCMC.AbstractSampler</span>,</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The current sampler `state`.</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    state;</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Additional keyword arguments that we may or may not need.</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Moreover, there is a specific <code>AbstractMCMC.AbstractModel</code> which is used to indicate that the model that is provided implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface: <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Since, as we discussed earlier, in our case we’re indeed going to work with types that support the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, we’ll define <code>AbstractMCMC.step</code> for such a <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Note that <code>AbstractMCMC.LogDensityModel</code> has no other purpose; it has a single field called <code>logdensity</code>, and it does nothing else. But by wrapping the model in <code>AbstractMCMC.LogDensityModel</code>, it allows samplers that want to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> to define their <code>AbstractMCMC.step</code> on this type without running into method ambiguities.</p>
<p>All in all, that means that the signature for our <code>AbstractMCMC.step</code> is going to be the following:</p>
<div id="20" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># `LogDensityModel` so we know we're working with LogDensityProblems.jl model.</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler.</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler state.</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Great! Now let’s actually implement the full <code>AbstractMCMC.step</code> for our <code>MALA</code>.</p>
<p>Let’s remind ourselves what we’re going to do:</p>
<ol type="1">
<li>Sample a new momentum <span class="math inline">\(p\)</span>.</li>
<li>Compute the log-density of the extended target <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>Take a single leapfrog step <span class="math inline">\((\tilde{x}, \tilde{p}) = L_{\epsilon}(x, p)\)</span>.</li>
<li>Accept or reject the proposed <span class="math inline">\((\tilde{x}, \tilde{p})\)</span>.</li>
</ol>
<p>All in all, this results in the following:</p>
<div id="22" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>: Random</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Distributions</span>  <span class="co"># so we get the `MvNormal`</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the wrapped model which implements LogDensityProblems.jl.</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just extract the sampler parameters to make our lives easier.</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    ϵ <span class="op">=</span> sampler.ϵ_init</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    M <span class="op">=</span> sampler.M_init</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the current parameters.</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> state.x</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sample the momentum.</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>    p_dist <span class="op">=</span> <span class="fu">MvNormal</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)), M)</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> <span class="fu">rand</span>(rng, p_dist)</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Propose using a single leapfrog step.</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>    x̃, p̃ <span class="op">=</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Accept or reject proposal.</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>    logp <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p)</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>    logp̃ <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x̃) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p̃)</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>    logα <span class="op">=</span> logp̃ <span class="op">-</span> logp</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>    state_new <span class="op">=</span> <span class="cf">if</span> <span class="fu">log</span>(<span class="fu">rand</span>(rng)) <span class="op">&lt;</span> logα</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Accept.</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x̃)</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Reject.</span></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x)</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return the "sample" and the sampler state.</span></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(state_new.x), state_new</span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Fairly straight-forward.</p>
<p>Of course, we haven’t defined the <code>leapfrog_step</code> method yet, so let’s do that:</p>
<div id="24" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p` using "position" `x`.</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x))</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    p1 <span class="op">=</span> p <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update the "position" `x` using momentum `p1`.</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    x̃ <span class="op">=</span> x <span class="op">+</span> ϵ <span class="op">.*</span> (M <span class="op">\</span> p1)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p1` using position `x̃`</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x̃ <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x̃))</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    p2 <span class="op">=</span> p1 <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x̃</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Flip momentum `p2`.</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    p̃ <span class="op">=</span> <span class="op">-</span>p2</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x̃, p̃</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>leapfrog_step (generic function with 1 method)</code></pre>
</div>
</div>
<p>With all of this, we’re technically ready to sample!</p>
<div id="26" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>, <span class="bu">LinearAlgebra</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>rng <span class="op">=</span> <span class="bu">Random</span>.<span class="fu">default_rng</span>()</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>sampler <span class="op">=</span> <span class="fu">MALA</span>(<span class="fl">1</span>, I)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>state <span class="op">=</span> <span class="fu">MALAState</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)))</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>x_next, state_next <span class="op">=</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    rng,</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    AbstractMCMC.<span class="fu">LogDensityModel</span>(model),</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    state</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>(MALASample{Vector{Float64}}([-0.3405345190185257, 0.07650417517337907, 1.167977238352595]), MALAState{Vector{Float64}}([-0.3405345190185257, 0.07650417517337907, 1.167977238352595]))</code></pre>
</div>
</div>
<p>Great, it works!</p>
<p>And I promised we would get quite some functionality for free if we implemented <code>AbstractMCMC.step</code>, and so we can now simply call <code>sample</code> to perform standard MCMC sampling:</p>
<div id="28" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform 1000 iterations with our `MALA` sampler.</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; initial_state<span class="op">=</span>state, progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Concatenate into a matrix.</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000 Matrix{Float64}:
 -3.49249  -4.66049  -5.65214  -5.22594  …  -4.99449  -3.16796  -2.55931
  1.49009   1.46264   1.48656  -0.46046     -1.45737  -1.1328    0.0432916
  1.72864   3.22669   4.59417   4.16334      4.68855   5.99614   6.52701</code></pre>
</div>
</div>
<div id="30" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the marginal means and standard deviations.</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -4.99836   0.994245
 -0.012537  0.989697
  5.01342   1.01683</code></pre>
</div>
</div>
<p>Let’s visualize the samples</p>
<div id="32" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">StatsPlots</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">transpose</span>(samples_matrix[<span class="op">:</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">:</span><span class="kw">end</span>]), alpha<span class="op">=</span><span class="fl">0.5</span>, legend<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<!--?xml version="1.0" encoding="utf-8"?-->
<svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" width="672" height="480" viewbox="0 0 2688 1920">
<defs>
  <clippath id="clip210">
    <rect x="0" y="0" width="2688" height="1920"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip210)" d="M0 1920 L2688 1920 L2688 0 L0 0  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip211">
    <rect x="537" y="0" width="1883" height="1883"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip210)" d="M196.816 1800.78 L2640.76 1800.78 L2640.76 47.2441 L196.816 47.2441  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip212">
    <rect x="196" y="47" width="2445" height="1755"></rect>
  </clippath>
</defs>
<polyline clip-path="url(#clip212)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="263.676,1800.78 263.676,47.2441 "></polyline>
<polyline clip-path="url(#clip212)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="840.654,1800.78 840.654,47.2441 "></polyline>
<polyline clip-path="url(#clip212)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1417.63,1800.78 1417.63,47.2441 "></polyline>
<polyline clip-path="url(#clip212)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1994.61,1800.78 1994.61,47.2441 "></polyline>
<polyline clip-path="url(#clip212)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="2571.59,1800.78 2571.59,47.2441 "></polyline>
<polyline clip-path="url(#clip212)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,1647.96 2640.76,1647.96 "></polyline>
<polyline clip-path="url(#clip212)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,1401.49 2640.76,1401.49 "></polyline>
<polyline clip-path="url(#clip212)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,1155.03 2640.76,1155.03 "></polyline>
<polyline clip-path="url(#clip212)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,908.564 2640.76,908.564 "></polyline>
<polyline clip-path="url(#clip212)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,662.099 2640.76,662.099 "></polyline>
<polyline clip-path="url(#clip212)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,415.635 2640.76,415.635 "></polyline>
<polyline clip-path="url(#clip212)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,169.17 2640.76,169.17 "></polyline>
<polyline clip-path="url(#clip210)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1800.78 2640.76,1800.78 "></polyline>
<polyline clip-path="url(#clip210)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="263.676,1800.78 263.676,1781.88 "></polyline>
<polyline clip-path="url(#clip210)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="840.654,1800.78 840.654,1781.88 "></polyline>
<polyline clip-path="url(#clip210)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1417.63,1800.78 1417.63,1781.88 "></polyline>
<polyline clip-path="url(#clip210)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1994.61,1800.78 1994.61,1781.88 "></polyline>
<polyline clip-path="url(#clip210)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="2571.59,1800.78 2571.59,1781.88 "></polyline>
<path clip-path="url(#clip210)" d="M263.676 1834 Q260.065 1834 258.236 1837.57 Q256.431 1841.11 256.431 1848.24 Q256.431 1855.34 258.236 1858.91 Q260.065 1862.45 263.676 1862.45 Q267.31 1862.45 269.116 1858.91 Q270.945 1855.34 270.945 1848.24 Q270.945 1841.11 269.116 1837.57 Q267.31 1834 263.676 1834 M263.676 1830.3 Q269.486 1830.3 272.542 1834.9 Q275.621 1839.49 275.621 1848.24 Q275.621 1856.96 272.542 1861.57 Q269.486 1866.15 263.676 1866.15 Q257.866 1866.15 254.787 1861.57 Q251.732 1856.96 251.732 1848.24 Q251.732 1839.49 254.787 1834.9 Q257.866 1830.3 263.676 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip210)" d="M804.346 1861.55 L820.666 1861.55 L820.666 1865.48 L798.721 1865.48 L798.721 1861.55 Q801.383 1858.79 805.967 1854.16 Q810.573 1849.51 811.754 1848.17 Q813.999 1845.65 814.879 1843.91 Q815.782 1842.15 815.782 1840.46 Q815.782 1837.71 813.837 1835.97 Q811.916 1834.23 808.814 1834.23 Q806.615 1834.23 804.161 1835 Q801.731 1835.76 798.953 1837.31 L798.953 1832.59 Q801.777 1831.46 804.231 1830.88 Q806.684 1830.3 808.721 1830.3 Q814.092 1830.3 817.286 1832.98 Q820.481 1835.67 820.481 1840.16 Q820.481 1842.29 819.67 1844.21 Q818.883 1846.11 816.777 1848.7 Q816.198 1849.37 813.096 1852.59 Q809.995 1855.78 804.346 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip210)" d="M830.527 1830.92 L848.883 1830.92 L848.883 1834.86 L834.809 1834.86 L834.809 1843.33 Q835.828 1842.98 836.846 1842.82 Q837.865 1842.64 838.883 1842.64 Q844.67 1842.64 848.05 1845.81 Q851.43 1848.98 851.43 1854.4 Q851.43 1859.97 847.957 1863.08 Q844.485 1866.15 838.166 1866.15 Q835.99 1866.15 833.721 1865.78 Q831.476 1865.41 829.069 1864.67 L829.069 1859.97 Q831.152 1861.11 833.374 1861.66 Q835.596 1862.22 838.073 1862.22 Q842.078 1862.22 844.416 1860.11 Q846.754 1858.01 846.754 1854.4 Q846.754 1850.78 844.416 1848.68 Q842.078 1846.57 838.073 1846.57 Q836.198 1846.57 834.323 1846.99 Q832.471 1847.4 830.527 1848.28 L830.527 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip210)" d="M870.642 1834 Q867.031 1834 865.203 1837.57 Q863.397 1841.11 863.397 1848.24 Q863.397 1855.34 865.203 1858.91 Q867.031 1862.45 870.642 1862.45 Q874.277 1862.45 876.082 1858.91 Q877.911 1855.34 877.911 1848.24 Q877.911 1841.11 876.082 1837.57 Q874.277 1834 870.642 1834 M870.642 1830.3 Q876.453 1830.3 879.508 1834.9 Q882.587 1839.49 882.587 1848.24 Q882.587 1856.96 879.508 1861.57 Q876.453 1866.15 870.642 1866.15 Q864.832 1866.15 861.754 1861.57 Q858.698 1856.96 858.698 1848.24 Q858.698 1839.49 861.754 1834.9 Q864.832 1830.3 870.642 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip210)" d="M1377.25 1830.92 L1395.61 1830.92 L1395.61 1834.86 L1381.53 1834.86 L1381.53 1843.33 Q1382.55 1842.98 1383.57 1842.82 Q1384.59 1842.64 1385.61 1842.64 Q1391.39 1842.64 1394.77 1845.81 Q1398.15 1848.98 1398.15 1854.4 Q1398.15 1859.97 1394.68 1863.08 Q1391.21 1866.15 1384.89 1866.15 Q1382.71 1866.15 1380.44 1865.78 Q1378.2 1865.41 1375.79 1864.67 L1375.79 1859.97 Q1377.88 1861.11 1380.1 1861.66 Q1382.32 1862.22 1384.8 1862.22 Q1388.8 1862.22 1391.14 1860.11 Q1393.48 1858.01 1393.48 1854.4 Q1393.48 1850.78 1391.14 1848.68 Q1388.8 1846.57 1384.8 1846.57 Q1382.92 1846.57 1381.05 1846.99 Q1379.19 1847.4 1377.25 1848.28 L1377.25 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip210)" d="M1417.37 1834 Q1413.75 1834 1411.93 1837.57 Q1410.12 1841.11 1410.12 1848.24 Q1410.12 1855.34 1411.93 1858.91 Q1413.75 1862.45 1417.37 1862.45 Q1421 1862.45 1422.81 1858.91 Q1424.63 1855.34 1424.63 1848.24 Q1424.63 1841.11 1422.81 1837.57 Q1421 1834 1417.37 1834 M1417.37 1830.3 Q1423.18 1830.3 1426.23 1834.9 Q1429.31 1839.49 1429.31 1848.24 Q1429.31 1856.96 1426.23 1861.57 Q1423.18 1866.15 1417.37 1866.15 Q1411.56 1866.15 1408.48 1861.57 Q1405.42 1856.96 1405.42 1848.24 Q1405.42 1839.49 1408.48 1834.9 Q1411.56 1830.3 1417.37 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip210)" d="M1447.53 1834 Q1443.92 1834 1442.09 1837.57 Q1440.28 1841.11 1440.28 1848.24 Q1440.28 1855.34 1442.09 1858.91 Q1443.92 1862.45 1447.53 1862.45 Q1451.16 1862.45 1452.97 1858.91 Q1454.8 1855.34 1454.8 1848.24 Q1454.8 1841.11 1452.97 1837.57 Q1451.16 1834 1447.53 1834 M1447.53 1830.3 Q1453.34 1830.3 1456.39 1834.9 Q1459.47 1839.49 1459.47 1848.24 Q1459.47 1856.96 1456.39 1861.57 Q1453.34 1866.15 1447.53 1866.15 Q1441.72 1866.15 1438.64 1861.57 Q1435.58 1856.96 1435.58 1848.24 Q1435.58 1839.49 1438.64 1834.9 Q1441.72 1830.3 1447.53 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip210)" d="M1952.89 1830.92 L1975.11 1830.92 L1975.11 1832.91 L1962.56 1865.48 L1957.68 1865.48 L1969.48 1834.86 L1952.89 1834.86 L1952.89 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip210)" d="M1984.27 1830.92 L2002.63 1830.92 L2002.63 1834.86 L1988.56 1834.86 L1988.56 1843.33 Q1989.58 1842.98 1990.59 1842.82 Q1991.61 1842.64 1992.63 1842.64 Q1998.42 1842.64 2001.8 1845.81 Q2005.18 1848.98 2005.18 1854.4 Q2005.18 1859.97 2001.7 1863.08 Q1998.23 1866.15 1991.91 1866.15 Q1989.74 1866.15 1987.47 1865.78 Q1985.22 1865.41 1982.82 1864.67 L1982.82 1859.97 Q1984.9 1861.11 1987.12 1861.66 Q1989.34 1862.22 1991.82 1862.22 Q1995.83 1862.22 1998.16 1860.11 Q2000.5 1858.01 2000.5 1854.4 Q2000.5 1850.78 1998.16 1848.68 Q1995.83 1846.57 1991.82 1846.57 Q1989.95 1846.57 1988.07 1846.99 Q1986.22 1847.4 1984.27 1848.28 L1984.27 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip210)" d="M2024.39 1834 Q2020.78 1834 2018.95 1837.57 Q2017.14 1841.11 2017.14 1848.24 Q2017.14 1855.34 2018.95 1858.91 Q2020.78 1862.45 2024.39 1862.45 Q2028.02 1862.45 2029.83 1858.91 Q2031.66 1855.34 2031.66 1848.24 Q2031.66 1841.11 2029.83 1837.57 Q2028.02 1834 2024.39 1834 M2024.39 1830.3 Q2030.2 1830.3 2033.26 1834.9 Q2036.33 1839.49 2036.33 1848.24 Q2036.33 1856.96 2033.26 1861.57 Q2030.2 1866.15 2024.39 1866.15 Q2018.58 1866.15 2015.5 1861.57 Q2012.45 1856.96 2012.45 1848.24 Q2012.45 1839.49 2015.5 1834.9 Q2018.58 1830.3 2024.39 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip210)" d="M2516.11 1861.55 L2523.75 1861.55 L2523.75 1835.18 L2515.44 1836.85 L2515.44 1832.59 L2523.71 1830.92 L2528.38 1830.92 L2528.38 1861.55 L2536.02 1861.55 L2536.02 1865.48 L2516.11 1865.48 L2516.11 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip210)" d="M2555.47 1834 Q2551.85 1834 2550.03 1837.57 Q2548.22 1841.11 2548.22 1848.24 Q2548.22 1855.34 2550.03 1858.91 Q2551.85 1862.45 2555.47 1862.45 Q2559.1 1862.45 2560.9 1858.91 Q2562.73 1855.34 2562.73 1848.24 Q2562.73 1841.11 2560.9 1837.57 Q2559.1 1834 2555.47 1834 M2555.47 1830.3 Q2561.28 1830.3 2564.33 1834.9 Q2567.41 1839.49 2567.41 1848.24 Q2567.41 1856.96 2564.33 1861.57 Q2561.28 1866.15 2555.47 1866.15 Q2549.66 1866.15 2546.58 1861.57 Q2543.52 1856.96 2543.52 1848.24 Q2543.52 1839.49 2546.58 1834.9 Q2549.66 1830.3 2555.47 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip210)" d="M2585.63 1834 Q2582.02 1834 2580.19 1837.57 Q2578.38 1841.11 2578.38 1848.24 Q2578.38 1855.34 2580.19 1858.91 Q2582.02 1862.45 2585.63 1862.45 Q2589.26 1862.45 2591.07 1858.91 Q2592.9 1855.34 2592.9 1848.24 Q2592.9 1841.11 2591.07 1837.57 Q2589.26 1834 2585.63 1834 M2585.63 1830.3 Q2591.44 1830.3 2594.49 1834.9 Q2597.57 1839.49 2597.57 1848.24 Q2597.57 1856.96 2594.49 1861.57 Q2591.44 1866.15 2585.63 1866.15 Q2579.82 1866.15 2576.74 1861.57 Q2573.68 1856.96 2573.68 1848.24 Q2573.68 1839.49 2576.74 1834.9 Q2579.82 1830.3 2585.63 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip210)" d="M2615.79 1834 Q2612.18 1834 2610.35 1837.57 Q2608.54 1841.11 2608.54 1848.24 Q2608.54 1855.34 2610.35 1858.91 Q2612.18 1862.45 2615.79 1862.45 Q2619.42 1862.45 2621.23 1858.91 Q2623.06 1855.34 2623.06 1848.24 Q2623.06 1841.11 2621.23 1837.57 Q2619.42 1834 2615.79 1834 M2615.79 1830.3 Q2621.6 1830.3 2624.65 1834.9 Q2627.73 1839.49 2627.73 1848.24 Q2627.73 1856.96 2624.65 1861.57 Q2621.6 1866.15 2615.79 1866.15 Q2609.98 1866.15 2606.9 1861.57 Q2603.84 1856.96 2603.84 1848.24 Q2603.84 1839.49 2606.9 1834.9 Q2609.98 1830.3 2615.79 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip210)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1800.78 196.816,47.2441 "></polyline>
<polyline clip-path="url(#clip210)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1647.96 215.714,1647.96 "></polyline>
<polyline clip-path="url(#clip210)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1401.49 215.714,1401.49 "></polyline>
<polyline clip-path="url(#clip210)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1155.03 215.714,1155.03 "></polyline>
<polyline clip-path="url(#clip210)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,908.564 215.714,908.564 "></polyline>
<polyline clip-path="url(#clip210)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,662.099 215.714,662.099 "></polyline>
<polyline clip-path="url(#clip210)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,415.635 215.714,415.635 "></polyline>
<polyline clip-path="url(#clip210)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,169.17 215.714,169.17 "></polyline>
<path clip-path="url(#clip210)" d="M50.5475 1648.41 L80.2233 1648.41 L80.2233 1652.34 L50.5475 1652.34 L50.5475 1648.41 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip210)" d="M89.1352 1630.68 L111.357 1630.68 L111.357 1632.67 L98.8111 1665.24 L93.9269 1665.24 L105.732 1634.61 L89.1352 1634.61 L89.1352 1630.68 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip210)" d="M120.478 1659.36 L125.362 1659.36 L125.362 1665.24 L120.478 1665.24 L120.478 1659.36 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip210)" d="M135.593 1630.68 L153.95 1630.68 L153.95 1634.61 L139.876 1634.61 L139.876 1643.08 Q140.894 1642.74 141.913 1642.58 Q142.931 1642.39 143.95 1642.39 Q149.737 1642.39 153.116 1645.56 Q156.496 1648.73 156.496 1654.15 Q156.496 1659.73 153.024 1662.83 Q149.552 1665.91 143.232 1665.91 Q141.056 1665.91 138.788 1665.54 Q136.542 1665.17 134.135 1664.43 L134.135 1659.73 Q136.218 1660.86 138.441 1661.42 Q140.663 1661.97 143.14 1661.97 Q147.144 1661.97 149.482 1659.87 Q151.82 1657.76 151.82 1654.15 Q151.82 1650.54 149.482 1648.43 Q147.144 1646.33 143.14 1646.33 Q141.265 1646.33 139.39 1646.74 Q137.538 1647.16 135.593 1648.04 L135.593 1630.68 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip210)" d="M49.5521 1401.94 L79.2279 1401.94 L79.2279 1405.88 L49.5521 1405.88 L49.5521 1401.94 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip210)" d="M89.3667 1384.21 L107.723 1384.21 L107.723 1388.15 L93.6491 1388.15 L93.6491 1396.62 Q94.6676 1396.27 95.6861 1396.11 Q96.7047 1395.93 97.7232 1395.93 Q103.51 1395.93 106.89 1399.1 Q110.269 1402.27 110.269 1407.68 Q110.269 1413.26 106.797 1416.37 Q103.325 1419.44 97.0056 1419.44 Q94.8297 1419.44 92.5612 1419.07 Q90.3158 1418.7 87.9084 1417.96 L87.9084 1413.26 Q89.9917 1414.4 92.2139 1414.95 Q94.4361 1415.51 96.913 1415.51 Q100.918 1415.51 103.256 1413.4 Q105.593 1411.3 105.593 1407.68 Q105.593 1404.07 103.256 1401.97 Q100.918 1399.86 96.913 1399.86 Q95.038 1399.86 93.163 1400.28 Q91.3112 1400.69 89.3667 1401.57 L89.3667 1384.21 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip210)" d="M119.482 1412.89 L124.367 1412.89 L124.367 1418.77 L119.482 1418.77 L119.482 1412.89 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip210)" d="M144.552 1387.29 Q140.941 1387.29 139.112 1390.86 Q137.306 1394.4 137.306 1401.53 Q137.306 1408.63 139.112 1412.2 Q140.941 1415.74 144.552 1415.74 Q148.186 1415.74 149.991 1412.2 Q151.82 1408.63 151.82 1401.53 Q151.82 1394.4 149.991 1390.86 Q148.186 1387.29 144.552 1387.29 M144.552 1383.59 Q150.362 1383.59 153.417 1388.19 Q156.496 1392.78 156.496 1401.53 Q156.496 1410.25 153.417 1414.86 Q150.362 1419.44 144.552 1419.44 Q138.741 1419.44 135.663 1414.86 Q132.607 1410.25 132.607 1401.53 Q132.607 1392.78 135.663 1388.19 Q138.741 1383.59 144.552 1383.59 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip210)" d="M50.5475 1155.48 L80.2233 1155.48 L80.2233 1159.41 L50.5475 1159.41 L50.5475 1155.48 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip210)" d="M94.3436 1168.37 L110.663 1168.37 L110.663 1172.31 L88.7186 1172.31 L88.7186 1168.37 Q91.3806 1165.62 95.9639 1160.99 Q100.57 1156.34 101.751 1154.99 Q103.996 1152.47 104.876 1150.73 Q105.779 1148.98 105.779 1147.29 Q105.779 1144.53 103.834 1142.79 Q101.913 1141.06 98.8111 1141.06 Q96.6121 1141.06 94.1584 1141.82 Q91.7278 1142.59 88.9501 1144.14 L88.9501 1139.41 Q91.7741 1138.28 94.2278 1137.7 Q96.6815 1137.12 98.7185 1137.12 Q104.089 1137.12 107.283 1139.81 Q110.478 1142.49 110.478 1146.98 Q110.478 1149.11 109.668 1151.04 Q108.881 1152.93 106.774 1155.53 Q106.195 1156.2 103.094 1159.41 Q99.9917 1162.61 94.3436 1168.37 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip210)" d="M120.478 1166.43 L125.362 1166.43 L125.362 1172.31 L120.478 1172.31 L120.478 1166.43 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip210)" d="M135.593 1137.75 L153.95 1137.75 L153.95 1141.68 L139.876 1141.68 L139.876 1150.16 Q140.894 1149.81 141.913 1149.65 Q142.931 1149.46 143.95 1149.46 Q149.737 1149.46 153.116 1152.63 Q156.496 1155.8 156.496 1161.22 Q156.496 1166.8 153.024 1169.9 Q149.552 1172.98 143.232 1172.98 Q141.056 1172.98 138.788 1172.61 Q136.542 1172.24 134.135 1171.5 L134.135 1166.8 Q136.218 1167.93 138.441 1168.49 Q140.663 1169.04 143.14 1169.04 Q147.144 1169.04 149.482 1166.94 Q151.82 1164.83 151.82 1161.22 Q151.82 1157.61 149.482 1155.5 Q147.144 1153.4 143.14 1153.4 Q141.265 1153.4 139.39 1153.81 Q137.538 1154.23 135.593 1155.11 L135.593 1137.75 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip210)" d="M99.3204 894.362 Q95.7093 894.362 93.8806 897.927 Q92.075 901.469 92.075 908.598 Q92.075 915.705 93.8806 919.27 Q95.7093 922.811 99.3204 922.811 Q102.955 922.811 104.76 919.27 Q106.589 915.705 106.589 908.598 Q106.589 901.469 104.76 897.927 Q102.955 894.362 99.3204 894.362 M99.3204 890.659 Q105.131 890.659 108.186 895.265 Q111.265 899.849 111.265 908.598 Q111.265 917.325 108.186 921.932 Q105.131 926.515 99.3204 926.515 Q93.5102 926.515 90.4315 921.932 Q87.376 917.325 87.376 908.598 Q87.376 899.849 90.4315 895.265 Q93.5102 890.659 99.3204 890.659 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip210)" d="M119.482 919.964 L124.367 919.964 L124.367 925.844 L119.482 925.844 L119.482 919.964 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip210)" d="M144.552 894.362 Q140.941 894.362 139.112 897.927 Q137.306 901.469 137.306 908.598 Q137.306 915.705 139.112 919.27 Q140.941 922.811 144.552 922.811 Q148.186 922.811 149.991 919.27 Q151.82 915.705 151.82 908.598 Q151.82 901.469 149.991 897.927 Q148.186 894.362 144.552 894.362 M144.552 890.659 Q150.362 890.659 153.417 895.265 Q156.496 899.849 156.496 908.598 Q156.496 917.325 153.417 921.932 Q150.362 926.515 144.552 926.515 Q138.741 926.515 135.663 921.932 Q132.607 917.325 132.607 908.598 Q132.607 899.849 135.663 895.265 Q138.741 890.659 144.552 890.659 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip210)" d="M94.3436 675.444 L110.663 675.444 L110.663 679.379 L88.7186 679.379 L88.7186 675.444 Q91.3806 672.689 95.9639 668.06 Q100.57 663.407 101.751 662.065 Q103.996 659.541 104.876 657.805 Q105.779 656.046 105.779 654.356 Q105.779 651.602 103.834 649.866 Q101.913 648.129 98.8111 648.129 Q96.6121 648.129 94.1584 648.893 Q91.7278 649.657 88.9501 651.208 L88.9501 646.486 Q91.7741 645.352 94.2278 644.773 Q96.6815 644.194 98.7185 644.194 Q104.089 644.194 107.283 646.879 Q110.478 649.565 110.478 654.055 Q110.478 656.185 109.668 658.106 Q108.881 660.004 106.774 662.597 Q106.195 663.268 103.094 666.486 Q99.9917 669.68 94.3436 675.444 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip210)" d="M120.478 673.5 L125.362 673.5 L125.362 679.379 L120.478 679.379 L120.478 673.5 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip210)" d="M135.593 644.819 L153.95 644.819 L153.95 648.754 L139.876 648.754 L139.876 657.227 Q140.894 656.879 141.913 656.717 Q142.931 656.532 143.95 656.532 Q149.737 656.532 153.116 659.703 Q156.496 662.875 156.496 668.291 Q156.496 673.87 153.024 676.972 Q149.552 680.051 143.232 680.051 Q141.056 680.051 138.788 679.68 Q136.542 679.31 134.135 678.569 L134.135 673.87 Q136.218 675.004 138.441 675.56 Q140.663 676.115 143.14 676.115 Q147.144 676.115 149.482 674.009 Q151.82 671.902 151.82 668.291 Q151.82 664.68 149.482 662.574 Q147.144 660.467 143.14 660.467 Q141.265 660.467 139.39 660.884 Q137.538 661.301 135.593 662.18 L135.593 644.819 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip210)" d="M89.3667 398.355 L107.723 398.355 L107.723 402.29 L93.6491 402.29 L93.6491 410.762 Q94.6676 410.415 95.6861 410.253 Q96.7047 410.068 97.7232 410.068 Q103.51 410.068 106.89 413.239 Q110.269 416.41 110.269 421.827 Q110.269 427.406 106.797 430.507 Q103.325 433.586 97.0056 433.586 Q94.8297 433.586 92.5612 433.216 Q90.3158 432.845 87.9084 432.105 L87.9084 427.406 Q89.9917 428.54 92.2139 429.095 Q94.4361 429.651 96.913 429.651 Q100.918 429.651 103.256 427.544 Q105.593 425.438 105.593 421.827 Q105.593 418.216 103.256 416.109 Q100.918 414.003 96.913 414.003 Q95.038 414.003 93.163 414.42 Q91.3112 414.836 89.3667 415.716 L89.3667 398.355 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip210)" d="M119.482 427.035 L124.367 427.035 L124.367 432.915 L119.482 432.915 L119.482 427.035 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip210)" d="M144.552 401.433 Q140.941 401.433 139.112 404.998 Q137.306 408.54 137.306 415.67 Q137.306 422.776 139.112 426.341 Q140.941 429.882 144.552 429.882 Q148.186 429.882 149.991 426.341 Q151.82 422.776 151.82 415.67 Q151.82 408.54 149.991 404.998 Q148.186 401.433 144.552 401.433 M144.552 397.73 Q150.362 397.73 153.417 402.336 Q156.496 406.92 156.496 415.67 Q156.496 424.396 153.417 429.003 Q150.362 433.586 144.552 433.586 Q138.741 433.586 135.663 429.003 Q132.607 424.396 132.607 415.67 Q132.607 406.92 135.663 402.336 Q138.741 397.73 144.552 397.73 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip210)" d="M89.1352 151.89 L111.357 151.89 L111.357 153.881 L98.8111 186.45 L93.9269 186.45 L105.732 155.825 L89.1352 155.825 L89.1352 151.89 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip210)" d="M120.478 180.571 L125.362 180.571 L125.362 186.45 L120.478 186.45 L120.478 180.571 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip210)" d="M135.593 151.89 L153.95 151.89 L153.95 155.825 L139.876 155.825 L139.876 164.298 Q140.894 163.95 141.913 163.788 Q142.931 163.603 143.95 163.603 Q149.737 163.603 153.116 166.774 Q156.496 169.946 156.496 175.362 Q156.496 180.941 153.024 184.043 Q149.552 187.122 143.232 187.122 Q141.056 187.122 138.788 186.751 Q136.542 186.381 134.135 185.64 L134.135 180.941 Q136.218 182.075 138.441 182.631 Q140.663 183.186 143.14 183.186 Q147.144 183.186 149.482 181.08 Q151.82 178.973 151.82 175.362 Q151.82 171.751 149.482 169.645 Q147.144 167.538 143.14 167.538 Q141.265 167.538 139.39 167.955 Q137.538 168.372 135.593 169.251 L135.593 151.89 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip212)" style="stroke:#009af9; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="265.984,1252.87 268.292,1417.24 270.6,1253.08 272.908,1530.32 275.216,1350.84 277.524,1593.54 279.832,1519.46 282.139,1334.7 284.447,1266.12 286.755,1370.53 289.063,1455.7 291.371,1303.72 293.679,1398.12 295.987,1470.67 298.295,1611.33 300.603,1513.84 302.911,1380.93 305.219,1438.95 307.527,1414.33 309.834,1352.74 312.142,1325.25 314.45,1346.89 316.758,1464.97 319.066,1296.68 321.374,1388.86 323.682,1475.9 325.99,1261.57 328.298,1445.77 330.606,1267.93 332.914,1357.6 335.221,1554.81 337.529,1368.48 339.837,1352.94 342.145,1360.72 344.453,1461.83 346.761,1265.99 349.069,1335.54 351.377,1453.26 353.685,1350.26 355.993,1312.35 358.301,1390 360.608,1321.65 362.916,1435.16 365.224,1453.37 367.532,1409.74 369.84,1539.03 372.148,1378.22 374.456,1516.26 376.764,1435.89 379.072,1415.35 381.38,1278.79 383.688,1125.38 385.996,1446.48 388.303,1330.18 390.611,1689.3 392.919,1386.08 395.227,1315.36 397.535,1357.25 399.843,1322.98 402.151,1420.64 404.459,1203.88 406.767,1407.63 409.075,1504.13 411.383,1285.11 413.69,1266.19 415.998,1526.76 418.306,1643.01 420.614,1584.44 422.922,1293.54 425.23,1227.94 427.538,1441.15 429.846,1282.14 432.154,1392.13 434.462,1520.01 436.77,1485.89 439.077,1396.83 441.385,1446.85 443.693,1511.74 446.001,1404.95 448.309,1568.7 450.617,1445.45 452.925,1478.29 455.233,1391.26 457.541,1305.22 459.849,1489.37 462.157,1428.17 464.465,1446.2 466.772,1401.36 469.08,1523.16 471.388,1421.65 473.696,1501.14 476.004,1348.23 478.312,1521.78 480.62,1420.79 482.928,1448.65 485.236,1364.46 487.544,1489.1 489.852,1328.55 492.159,1228.9 494.467,1248.94 496.775,1219.74 499.083,1467.11 501.391,1273.72 503.699,1307.38 506.007,1349.01 508.315,1443.19 510.623,1379.05 512.931,1281.75 515.239,1599.11 517.546,1226.67 519.854,1440.42 522.162,1504.66 524.47,1367.75 526.778,1496.56 529.086,1388.36 531.394,1375.88 533.702,1367.08 536.01,1398.98 538.318,1416.11 540.626,1252.95 542.933,1519.51 545.241,1524.39 547.549,1507.29 549.857,1367.1 552.165,1464.22 554.473,1472.44 556.781,1325.85 559.089,1479.82 561.397,1497.96 563.705,1361.03 566.013,1328.25 568.321,1246.42 570.628,1394.74 572.936,1407.93 575.244,1508.37 577.552,1340.2 579.86,1313.58 582.168,1417.29 584.476,1444.87 586.784,1440.36 589.092,1439.24 591.4,1340.23 593.708,1167.05 596.015,1326.31 598.323,1385.92 600.631,1465.05 602.939,1399.97 605.247,1385.43 607.555,1406.29 609.863,1382.81 612.171,1262.48 614.479,1368.26 616.787,1610.82 619.095,1307.88 621.402,1454.55 623.71,1280.18 626.018,1402.46 628.326,1429.16 630.634,1390.1 632.942,1318.21 635.25,1507.45 637.558,1637.84 639.866,1353.87 642.174,1558.54 644.482,1461.37 646.79,1472.56 649.097,1307.55 651.405,1388.09 653.713,1415.97 656.021,1480.7 658.329,1237.6 660.637,1399.9 662.945,1341.27 665.253,1292.57 667.561,1435.91 669.869,1659.51 672.177,1181.94 674.484,1422.16 676.792,1561 679.1,1301.34 681.408,1469.16 683.716,1447.73 686.024,1359.43 688.332,1402.93 690.64,1573.01 692.948,1307.91 695.256,1546.49 697.564,1470.38 699.871,1390.03 702.179,1508.98 704.487,1335.54 706.795,1242.62 709.103,1481.62 711.411,1372 713.719,1613.72 716.027,1395.65 718.335,1360.26 720.643,1345.1 722.951,1491.22 725.259,1375.47 727.566,1467.79 729.874,1342.88 732.182,1319.06 734.49,1422.97 736.798,1275.67 739.106,1331.81 741.414,1404.31 743.722,1510.76 746.03,1480.34 748.338,1688.28 750.646,1522.55 752.953,1343.24 755.261,1384.45 757.569,1307.35 759.877,1342.98 762.185,1256.1 764.493,1364.1 766.801,1320.33 769.109,1386.3 771.417,1502.08 773.725,1333.26 776.033,1329.39 778.34,1253.49 780.648,1515.43 782.956,1431.45 785.264,1420.52 787.572,1352.41 789.88,1286.01 792.188,1452.37 794.496,1439.03 796.804,1397.12 799.112,1346.91 801.42,1380.21 803.728,1276.71 806.035,1354.15 808.343,1302.34 810.651,1422.07 812.959,1303.9 815.267,1352.07 817.575,1320.49 819.883,1471.77 822.191,1481.52 824.499,1298.75 826.807,1420.69 829.115,1396.89 831.422,1410.12 833.73,1424.63 836.038,1594.62 838.346,1282.39 840.654,1480.46 842.962,1441.24 845.27,1550.64 847.578,1467.41 849.886,1508.01 852.194,1369.37 854.502,1432.71 856.809,1479.15 859.117,1375.71 861.425,1339.12 863.733,1231.53 866.041,1364.28 868.349,1355.59 870.657,1341.45 872.965,1430.75 875.273,1347.3 877.581,1534.74 879.889,1395.18 882.197,1312.89 884.504,1347.23 886.812,1368.56 889.12,1455.53 891.428,1402.26 893.736,1375.65 896.044,1274.68 898.352,1324.51 900.66,1280.07 902.968,1405.92 905.276,1259.78 907.584,1465.39 909.891,1274.87 912.199,1394.09 914.507,1497.66 916.815,1419.2 919.123,1434.03 921.431,1375.17 923.739,1597.64 926.047,1463.9 928.355,1447.49 930.663,1492.82 932.971,1330.16 935.278,1291.31 937.586,1677.95 939.894,1368.19 942.202,1414.04 944.51,1337.9 946.818,1412.85 949.126,1539.84 951.434,1544.68 953.742,1465.02 956.05,1390.35 958.358,1246 960.665,1319.01 962.973,1397.11 965.281,1400.43 967.589,1376.4 969.897,1562.48 972.205,1329.15 974.513,1418.82 976.821,1384.36 979.129,1250.07 981.437,1353.31 983.745,1371.47 986.053,1335.39 988.36,1353.8 990.668,1378.52 992.976,1336.21 995.284,1357.01 997.592,1581.68 999.9,1224.7 1002.21,1415.42 1004.52,1565.21 1006.82,1430.99 1009.13,1446.33 1011.44,1417.64 1013.75,1444.92 1016.06,1537.96 1018.36,1340.38 1020.67,1407.42 1022.98,1469.54 1025.29,1411.06 1027.59,1383.05 1029.9,1508.67 1032.21,1506.59 1034.52,1393.74 1036.83,1357.16 1039.13,1405.62 1041.44,1425.02 1043.75,1428.34 1046.06,1441.59 1048.37,1346.75 1050.67,1328.71 1052.98,1298.87 1055.29,1357.24 1057.6,1476.17 1059.91,1449.21 1062.21,1403.8 1064.52,1562.03 1066.83,1411.12 1069.14,1330.2 1071.45,1276.24 1073.75,1382.61 1076.06,1371.6 1078.37,1346.74 1080.68,1393.05 1082.98,1584.96 1085.29,1273.56 1087.6,1345.27 1089.91,1540.95 1092.22,1277.2 1094.52,1338.36 1096.83,1439.52 1099.14,1577.23 1101.45,1481.26 1103.76,1352.78 1106.06,1306.87 1108.37,1392.61 1110.68,1274.92 1112.99,1554.77 1115.3,1344.37 1117.6,1363.18 1119.91,1420.13 1122.22,1441.66 1124.53,1400.71 1126.84,1532.87 1129.14,1450.69 1131.45,1224.36 1133.76,1632.64 1136.07,1383.23 1138.37,1292.34 1140.68,1377.77 1142.99,1610.3 1145.3,1294.98 1147.61,1431.33 1149.91,1382.8 1152.22,1312.88 1154.53,1441.22 1156.84,1560.34 1159.15,1447.21 1161.45,1375.06 1163.76,1290.41 1166.07,1282.63 1168.38,1389.67 1170.69,1222.72 1172.99,1366.35 1175.3,1428.41 1177.61,1576.08 1179.92,1347.06 1182.23,1452.83 1184.53,1259.96 1186.84,1288.73 1189.15,1464.21 1191.46,1512.75 1193.76,1490.12 1196.07,1300.12 1198.38,1535.83 1200.69,1429.73 1203,1356.92 1205.3,1337.33 1207.61,1484.11 1209.92,1466.51 1212.23,1471 1214.54,1251.1 1216.84,1210.4 1219.15,1497.42 1221.46,1214.76 1223.77,1406.01 1226.08,1421.61 1228.38,1333.18 1230.69,1430.91 1233,1401.39 1235.31,1142.59 1237.61,1417.72 1239.92,1288.93 1242.23,1448.44 1244.54,1652.15 1246.85,1288.62 1249.15,1195.53 1251.46,1372.29 1253.77,1235.3 1256.08,1525.05 1258.39,1471.61 1260.69,1225.85 1263,1411.02 1265.31,1290.37 1267.62,1523.72 1269.93,1501.42 1272.23,1421.03 1274.54,1563.24 1276.85,1337.3 1279.16,1405.97 1281.47,1569.58 1283.77,1415.69 1286.08,1378.45 1288.39,1368.5 1290.7,1199.26 1293,1597.01 1295.31,1444.93 1297.62,1391.3 1299.93,1496.61 1302.24,1600.45 1304.54,1462.4 1306.85,1456.22 1309.16,1465.37 1311.47,1308.28 1313.78,1495.92 1316.08,1331.2 1318.39,1424.02 1320.7,1290.37 1323.01,1308.28 1325.32,1426.34 1327.62,1543.63 1329.93,1686.26 1332.24,1398.93 1334.55,1290.18 1336.86,1243.85 1339.16,1520.08 1341.47,1392.19 1343.78,1378.47 1346.09,1482.1 1348.39,1528.13 1350.7,1487.21 1353.01,1442.94 1355.32,1355.26 1357.63,1339.22 1359.93,1436.42 1362.24,1395.67 1364.55,1441.55 1366.86,1452.34 1369.17,1526.34 1371.47,1444.25 1373.78,1297.95 1376.09,1315.03 1378.4,1218.73 1380.71,1397.31 1383.01,1280.44 1385.32,1361.11 1387.63,1449.23 1389.94,1498.28 1392.24,1356.69 1394.55,1600.88 1396.86,1472.38 1399.17,1302.8 1401.48,1362.33 1403.78,1462.83 1406.09,1558.55 1408.4,1467.14 1410.71,1553.68 1413.02,1395.75 1415.32,1388.69 1417.63,1396.36 1419.94,1210.73 1422.25,1427.36 1424.56,1403.87 1426.86,1444.77 1429.17,1525.37 1431.48,1340.71 1433.79,1281.34 1436.1,1398.15 1438.4,1251.21 1440.71,1535.79 1443.02,1348.29 1445.33,1299.87 1447.63,1410.82 1449.94,1343.8 1452.25,1461.55 1454.56,1346.6 1456.87,1514.44 1459.17,1424.59 1461.48,1543.38 1463.79,1404.21 1466.1,1413.97 1468.41,1343.71 1470.71,1443.16 1473.02,1443.18 1475.33,1356.5 1477.64,1411.77 1479.95,1278.06 1482.25,1343.96 1484.56,1346.38 1486.87,1375.11 1489.18,1358.17 1491.49,1364.23 1493.79,1289.16 1496.1,1437.72 1498.41,1712.08 1500.72,1310.38 1503.02,1392.91 1505.33,1306.4 1507.64,1308.55 1509.95,1424.11 1512.26,1538.15 1514.56,1374.49 1516.87,1379.64 1519.18,1345.32 1521.49,1192.19 1523.8,1350.86 1526.1,1375.51 1528.41,1492.66 1530.72,1223.75 1533.03,1437.5 1535.34,1368.42 1537.64,1492.26 1539.95,1420.43 1542.26,1481.6 1544.57,1520.1 1546.88,1416.87 1549.18,1233.98 1551.49,1386.86 1553.8,1345.83 1556.11,1337.3 1558.41,1507.67 1560.72,1411.23 1563.03,1386.41 1565.34,1501.03 1567.65,1469.48 1569.95,1262.72 1572.26,1418.22 1574.57,1412.17 1576.88,1485.11 1579.19,1371.64 1581.49,1458.84 1583.8,1491.43 1586.11,1276.47 1588.42,1565.79 1590.73,1216.92 1593.03,1363.03 1595.34,1399.25 1597.65,1443.43 1599.96,1456.38 1602.26,1478.41 1604.57,1513.64 1606.88,1418.67 1609.19,1246.83 1611.5,1427.17 1613.8,1547.83 1616.11,1360.49 1618.42,1531.58 1620.73,1418.54 1623.04,1344.13 1625.34,1231.3 1627.65,1364.77 1629.96,1516.95 1632.27,1419.09 1634.58,1337.01 1636.88,1470.7 1639.19,1539.54 1641.5,1429.06 1643.81,1423.67 1646.12,1397.52 1648.42,1446.93 1650.73,1437.15 1653.04,1337.92 1655.35,1338.82 1657.65,1434.12 1659.96,1410.76 1662.27,1486.54 1664.58,1324.48 1666.89,1396.88 1669.19,1434.19 1671.5,1351.39 1673.81,1331.43 1676.12,1546.72 1678.43,1471.13 1680.73,1355.81 1683.04,1549.32 1685.35,1374.35 1687.66,1321.86 1689.97,1294.4 1692.27,1279.1 1694.58,1262.62 1696.89,1431.87 1699.2,1196.74 1701.51,1414.59 1703.81,1198.5 1706.12,1469.18 1708.43,1428.8 1710.74,1485.6 1713.04,1458.39 1715.35,1437.08 1717.66,1128.22 1719.97,1428.41 1722.28,1526.6 1724.58,1354.34 1726.89,1411.54 1729.2,1292.94 1731.51,1413.98 1733.82,1277.16 1736.12,1341.53 1738.43,1561.36 1740.74,1397.03 1743.05,1255.19 1745.36,1408.57 1747.66,1446.38 1749.97,1447.45 1752.28,1272.16 1754.59,1491.63 1756.9,1387.4 1759.2,1369.41 1761.51,1487.58 1763.82,1360.78 1766.13,1348.9 1768.43,1380.09 1770.74,1303.28 1773.05,1528.36 1775.36,1358.51 1777.67,1366.35 1779.97,1409.69 1782.28,1555.09 1784.59,1310.12 1786.9,1517.36 1789.21,1539.56 1791.51,1281.83 1793.82,1290.01 1796.13,1388.88 1798.44,1583.15 1800.75,1430.81 1803.05,1507.42 1805.36,1392.1 1807.67,1395.77 1809.98,1470.42 1812.28,1410.95 1814.59,1618.93 1816.9,1464.46 1819.21,1535.1 1821.52,1386.99 1823.82,1450.43 1826.13,1335.21 1828.44,1524.09 1830.75,1382.93 1833.06,1415 1835.36,1381.58 1837.67,1334.49 1839.98,1364.99 1842.29,1534.76 1844.6,1313.15 1846.9,1339.22 1849.21,1317.22 1851.52,1442.95 1853.83,1378.79 1856.14,1491.1 1858.44,1463.97 1860.75,1458.23 1863.06,1360.59 1865.37,1351.49 1867.67,1527.53 1869.98,1369.64 1872.29,1478.28 1874.6,1360.59 1876.91,1496.56 1879.21,1336.23 1881.52,1426.11 1883.83,1415.3 1886.14,1471.94 1888.45,1398.62 1890.75,1372.09 1893.06,1283.17 1895.37,1242.56 1897.68,1408.29 1899.99,1394.24 1902.29,1452.3 1904.6,1413.99 1906.91,1505.65 1909.22,1400.9 1911.53,1425.01 1913.83,1426.86 1916.14,1318.6 1918.45,1329.09 1920.76,1468.12 1923.06,1346.54 1925.37,1534.98 1927.68,1641.5 1929.99,1285.35 1932.3,1537.58 1934.6,1548.43 1936.91,1255.51 1939.22,1339.08 1941.53,1427.85 1943.84,1462 1946.14,1446.77 1948.45,1327.82 1950.76,1534.87 1953.07,1398.55 1955.38,1414.19 1957.68,1380.47 1959.99,1428.4 1962.3,1387.1 1964.61,1533.17 1966.91,1459.38 1969.22,1304.79 1971.53,1381.03 1973.84,1377.04 1976.15,1318.02 1978.45,1398.75 1980.76,1354.73 1983.07,1392.39 1985.38,1476.44 1987.69,1310.54 1989.99,1380.56 1992.3,1320.5 1994.61,1425.71 1996.92,1302.75 1999.23,1536.37 2001.53,1175.13 2003.84,1404.08 2006.15,1386.24 2008.46,1160.47 2010.77,1379.1 2013.07,1419.82 2015.38,1425.06 2017.69,1423.36 2020,1396.25 2022.3,1490.09 2024.61,1391.04 2026.92,1333.07 2029.23,1421.16 2031.54,1380.98 2033.84,1351.24 2036.15,1517.05 2038.46,1503.23 2040.77,1502.68 2043.08,1237 2045.38,1545.02 2047.69,1432.95 2050,1576.12 2052.31,1517.05 2054.62,1383.4 2056.92,1491.79 2059.23,1496.94 2061.54,1417.46 2063.85,1449.69 2066.16,1411.26 2068.46,1313.67 2070.77,1482.72 2073.08,1490.71 2075.39,1455.07 2077.69,1249 2080,1417.51 2082.31,1511.67 2084.62,1265.16 2086.93,1479.45 2089.23,1331.51 2091.54,1460.28 2093.85,1504.44 2096.16,1485.22 2098.47,1437.2 2100.77,1401.61 2103.08,1220.08 2105.39,1552.55 2107.7,1425.18 2110.01,1282.21 2112.31,1476.05 2114.62,1315.58 2116.93,1317.17 2119.24,1399.59 2121.55,1275.6 2123.85,1267.76 2126.16,1497.3 2128.47,1453.5 2130.78,1294.04 2133.08,1330.81 2135.39,1295.75 2137.7,1510.21 2140.01,1305.53 2142.32,1503.31 2144.62,1449.68 2146.93,1454.31 2149.24,1487.61 2151.55,1311.51 2153.86,1239.62 2156.16,1491.84 2158.47,1295.09 2160.78,1505.72 2163.09,1302.52 2165.4,1524.05 2167.7,1362.4 2170.01,1391.6 2172.32,1463.59 2174.63,1402.39 2176.93,1424.62 2179.24,1393.07 2181.55,1283 2183.86,1433.82 2186.17,1238.92 2188.47,1248.38 2190.78,1416.99 2193.09,1411.24 2195.4,1439.49 2197.71,1367.29 2200.01,1429.72 2202.32,1497.73 2204.63,1335.18 2206.94,1478.35 2209.25,1385.57 2211.55,1365.43 2213.86,1477.88 2216.17,1317.06 2218.48,1315.69 2220.79,1404.85 2223.09,1443.09 2225.4,1502.32 2227.71,1546.1 2230.02,1568.9 2232.32,1475.77 2234.63,1469.65 2236.94,1353.36 2239.25,1385.31 2241.56,1399.18 2243.86,1329.67 2246.17,1311.82 2248.48,1476.69 2250.79,1529.25 2253.1,1411.75 2255.4,1637.97 2257.71,1304.57 2260.02,1238.81 2262.33,1751.15 2264.64,1451.67 2266.94,1286.57 2269.25,1431.71 2271.56,1541.21 2273.87,1213.34 2276.18,1475.22 2278.48,1514.04 2280.79,1356.4 2283.1,1491.22 2285.41,1349.02 2287.71,1226.37 2290.02,1449.3 2292.33,1300.95 2294.64,1426.2 2296.95,1463.69 2299.25,1383.53 2301.56,1324.5 2303.87,1350.77 2306.18,1363.39 2308.49,1331 2310.79,1373.61 2313.1,1405.99 2315.41,1355.77 2317.72,1226.18 2320.03,1397.1 2322.33,1444.3 2324.64,1520.58 2326.95,1272.87 2329.26,1360.78 2331.56,1393.14 2333.87,1507.15 2336.18,1306.02 2338.49,1389.29 2340.8,1372.92 2343.1,1552.74 2345.41,1359.07 2347.72,1279 2350.03,1277.4 2352.34,1576.57 2354.64,1495.69 2356.95,1368.98 2359.26,1322.19 2361.57,1417.8 2363.88,1315.03 2366.18,1538.31 2368.49,1376.93 2370.8,1361.5 2373.11,1429.24 2375.42,1465.11 2377.72,1395.89 2380.03,1316.33 2382.34,1466.36 2384.65,1435.18 2386.95,1554.14 2389.26,1364.46 2391.57,1398.12 2393.88,1582.28 2396.19,1463.76 2398.49,1419.66 2400.8,1323.06 2403.11,1373.61 2405.42,1461.01 2407.73,1397.86 2410.03,1444.47 2412.34,1415.16 2414.65,1548.12 2416.96,1448.48 2419.27,1480.88 2421.57,1258.15 2423.88,1211.81 2426.19,1419.75 2428.5,1306.43 2430.81,1547.44 2433.11,1433.69 2435.42,1333.88 2437.73,1404.01 2440.04,1495.38 2442.34,1376.39 2444.65,1363.14 2446.96,1463.74 2449.27,1660.79 2451.58,1284.9 2453.88,1411.64 2456.19,1242.22 2458.5,1205.4 2460.81,1576.4 2463.12,1457.55 2465.42,1361.58 2467.73,1410.29 2470.04,1354.17 2472.35,1497.1 2474.66,1502.28 2476.96,1488.56 2479.27,1668.17 2481.58,1335.83 2483.89,1273.24 2486.2,1448.03 2488.5,1291.36 2490.81,1454.77 2493.12,1449.31 2495.43,1533.93 2497.73,1387.43 2500.04,1437.84 2502.35,1418.05 2504.66,1445.63 2506.97,1469.51 2509.27,1462.09 2511.58,1399.36 2513.89,1332.51 2516.2,1441.74 2518.51,1296.77 2520.81,1501.91 2523.12,1479.18 2525.43,1248.56 2527.74,1397.46 2530.05,1524.22 2532.35,1392.98 2534.66,1472.94 2536.97,1350.12 2539.28,1580.7 2541.58,1472.6 2543.89,1499.05 2546.2,1585.89 2548.51,1341.9 2550.82,1403.34 2553.12,1232.97 2555.43,1285.49 2557.74,1331.97 2560.05,1388.02 2562.36,1419.82 2564.66,1231.1 2566.97,1467.58 2569.28,1419.14 2571.59,1334.01 "></polyline>
<polyline clip-path="url(#clip212)" style="stroke:#e26f46; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="265.984,761.662 268.292,800.617 270.6,977.417 272.908,925.059 275.216,937.868 277.524,895.728 279.832,885.401 282.139,868.564 284.447,904.692 286.755,981.342 289.063,826.084 291.371,836.101 293.679,889.463 295.987,842.772 298.295,880.535 300.603,894.64 302.911,912.062 305.219,1093.73 307.527,914.305 309.834,723.733 312.142,901.508 314.45,750.563 316.758,889.147 319.066,796.081 321.374,854.647 323.682,941.933 325.99,791.464 328.298,842.693 330.606,880.357 332.914,980.634 335.221,1003.75 337.529,823.051 339.837,824.961 342.145,1031.37 344.453,798.058 346.761,954.677 349.069,798.571 351.377,980.103 353.685,902.127 355.993,984.938 358.301,879.262 360.608,942.28 362.916,867.73 365.224,975.746 367.532,745.527 369.84,844.996 372.148,933.853 374.456,887.695 376.764,901.167 379.072,810.997 381.38,746.736 383.688,965.893 385.996,803.595 388.303,958.252 390.611,906.54 392.919,1004.65 395.227,934.041 397.535,936.512 399.843,791.91 402.151,1000.06 404.459,789.38 406.767,1054.91 409.075,929.443 411.383,950.45 413.69,1015.65 415.998,1003.78 418.306,988.125 420.614,995.177 422.922,999.175 425.23,1007.51 427.538,879.841 429.846,961.006 432.154,817.012 434.462,1156.39 436.77,741.962 439.077,988.305 441.385,882.147 443.693,1048.36 446.001,957.802 448.309,875.579 450.617,875.928 452.925,932.371 455.233,812.078 457.541,847.351 459.849,952.134 462.157,890.016 464.465,1139.33 466.772,878.7 469.08,856.998 471.388,919.047 473.696,1039.1 476.004,931.15 478.312,976.71 480.62,903.88 482.928,896.262 485.236,1074.61 487.544,984.051 489.852,990.719 492.159,981.753 494.467,811.904 496.775,955.117 499.083,1010.13 501.391,922.943 503.699,971.903 506.007,828.105 508.315,653.548 510.623,780.147 512.931,964.439 515.239,1009.46 517.546,1084.89 519.854,788.76 522.162,1030.44 524.47,852.52 526.778,844.255 529.086,1053.08 531.394,874.445 533.702,681.862 536.01,926.356 538.318,1041.49 540.626,832.679 542.933,927.926 545.241,952.048 547.549,1046.05 549.857,1020.96 552.165,949.969 554.473,991.366 556.781,860.784 559.089,942.855 561.397,943.273 563.705,949.254 566.013,846.794 568.321,767.422 570.628,901.267 572.936,987.958 575.244,1060.33 577.552,881.311 579.86,812.75 582.168,1006.97 584.476,860.674 586.784,752.734 589.092,977.157 591.4,1037.86 593.708,937.677 596.015,777.074 598.323,990.647 600.631,924.066 602.939,852.39 605.247,594.543 607.555,963.155 609.863,991.321 612.171,994.183 614.479,903.553 616.787,801.735 619.095,881.716 621.402,798.512 623.71,937.238 626.018,1059.79 628.326,1012.05 630.634,899.734 632.942,805.165 635.25,902.143 637.558,1119.44 639.866,994.76 642.174,927.371 644.482,963.262 646.79,733.61 649.097,882.223 651.405,970.756 653.713,875.025 656.021,889.654 658.329,995.012 660.637,1006.89 662.945,902.755 665.253,864.005 667.561,1028.06 669.869,929.297 672.177,874.102 674.484,947.027 676.792,918.363 679.1,922.667 681.408,823.179 683.716,856.96 686.024,1028.92 688.332,976.488 690.64,931.812 692.948,980.467 695.256,909.794 697.564,814.837 699.871,1087.45 702.179,852.266 704.487,1086.87 706.795,916.131 709.103,1173.44 711.411,988.984 713.719,825.121 716.027,1064.5 718.335,895.337 720.643,901.394 722.951,893.719 725.259,885.221 727.566,1035.62 729.874,879.78 732.182,754.94 734.49,956.374 736.798,903.165 739.106,1028.86 741.414,902.297 743.722,996.875 746.03,962.617 748.338,903.935 750.646,831.867 752.953,997.558 755.261,843.57 757.569,712.897 759.877,828.882 762.185,768.044 764.493,930.831 766.801,862.119 769.109,1037.3 771.417,1042.6 773.725,811.29 776.033,852.57 778.34,701.31 780.648,1022.63 782.956,930.406 785.264,982.696 787.572,948.844 789.88,859.208 792.188,811.259 794.496,879.976 796.804,835.574 799.112,927.84 801.42,1178.74 803.728,844.437 806.035,994.376 808.343,833.127 810.651,956.809 812.959,1006.11 815.267,821.104 817.575,798.872 819.883,938.756 822.191,848.996 824.499,926.103 826.807,763.457 829.115,698.281 831.422,892.424 833.73,870.928 836.038,857.963 838.346,1071.34 840.654,1122.67 842.962,738.036 845.27,1145.07 847.578,775.622 849.886,1025.5 852.194,804.332 854.502,776.71 856.809,835.263 859.117,918.007 861.425,849.789 863.733,821.1 866.041,831.965 868.349,999.662 870.657,800.477 872.965,976.419 875.273,731.533 877.581,985.187 879.889,928.616 882.197,988.726 884.504,868.583 886.812,919.356 889.12,1105.39 891.428,789.475 893.736,911.278 896.044,985.19 898.352,1097.04 900.66,847.022 902.968,713.795 905.276,1052.09 907.584,1006.31 909.891,1056.41 912.199,1086.51 914.507,730.949 916.815,1099.19 919.123,990.718 921.431,705.826 923.739,761.431 926.047,976.159 928.355,796.198 930.663,1073.86 932.971,783.978 935.278,957.616 937.586,925.085 939.894,836.2 942.202,683.566 944.51,966.195 946.818,1022.18 949.126,990.285 951.434,1031.56 953.742,964.973 956.05,1009.21 958.358,726.238 960.665,749.43 962.973,781.194 965.281,907.187 967.589,983.624 969.897,877.327 972.205,1073.43 974.513,934.161 976.821,744.874 979.129,780.362 981.437,744.796 983.745,1274.04 986.053,614.319 988.36,1018.52 990.668,966.561 992.976,842.963 995.284,778.325 997.592,932.998 999.9,984.382 1002.21,812.854 1004.52,906.918 1006.82,748.274 1009.13,954.86 1011.44,800.636 1013.75,803.437 1016.06,742.742 1018.36,925.16 1020.67,763.187 1022.98,990.659 1025.29,862.881 1027.59,744.16 1029.9,748.555 1032.21,864.091 1034.52,1005.15 1036.83,1031.48 1039.13,1017.1 1041.44,913.642 1043.75,1032.41 1046.06,758.09 1048.37,980.966 1050.67,823.507 1052.98,917.13 1055.29,839.763 1057.6,967.495 1059.91,876.255 1062.21,916.531 1064.52,895.841 1066.83,842.899 1069.14,904.087 1071.45,1074.33 1073.75,903.1 1076.06,848.092 1078.37,735.648 1080.68,849.214 1082.98,909.01 1085.29,1081.77 1087.6,862.273 1089.91,1010.31 1092.22,771.759 1094.52,811.269 1096.83,1016.07 1099.14,1065.35 1101.45,982 1103.76,843.311 1106.06,904.923 1108.37,1130.41 1110.68,1103.71 1112.99,935.397 1115.3,991.246 1117.6,847.661 1119.91,806.487 1122.22,976.633 1124.53,1172.83 1126.84,904.324 1129.14,818.261 1131.45,860.954 1133.76,763.494 1136.07,962.118 1138.37,727.319 1140.68,952.834 1142.99,778.018 1145.3,920.281 1147.61,709.707 1149.91,822.096 1152.22,957.567 1154.53,844.527 1156.84,919.776 1159.15,882.238 1161.45,825.634 1163.76,807.889 1166.07,874.618 1168.38,857.444 1170.69,895.322 1172.99,926.001 1175.3,1087.07 1177.61,663.894 1179.92,1088.12 1182.23,742.005 1184.53,952.228 1186.84,760.551 1189.15,861.939 1191.46,882.948 1193.76,852.893 1196.07,965.5 1198.38,913.372 1200.69,1017.16 1203,741.067 1205.3,1057.11 1207.61,936.328 1209.92,796.437 1212.23,961.925 1214.54,908.416 1216.84,1041.37 1219.15,940.035 1221.46,802.277 1223.77,864.198 1226.08,994.218 1228.38,836.21 1230.69,1055.91 1233,885.866 1235.31,901.511 1237.61,961.832 1239.92,909.081 1242.23,851.632 1244.54,876.89 1246.85,934.734 1249.15,860.434 1251.46,881.015 1253.77,904.764 1256.08,958.17 1258.39,899.742 1260.69,923.323 1263,864.388 1265.31,1030.56 1267.62,959.712 1269.93,936.744 1272.23,1090.63 1274.54,946.58 1276.85,872.765 1279.16,914.321 1281.47,916.011 1283.77,901.786 1286.08,1083.71 1288.39,865.639 1290.7,957.654 1293,964.92 1295.31,952.751 1297.62,939.091 1299.93,829.083 1302.24,969.516 1304.54,909.667 1306.85,780.904 1309.16,848.591 1311.47,1053.94 1313.78,939.247 1316.08,880.826 1318.39,992.876 1320.7,834.82 1323.01,800.33 1325.32,931.56 1327.62,916.313 1329.93,846.451 1332.24,925.88 1334.55,709.838 1336.86,823.391 1339.16,791.98 1341.47,799.191 1343.78,833.771 1346.09,1059.99 1348.39,1021.83 1350.7,725.977 1353.01,843.698 1355.32,818.804 1357.63,899.484 1359.93,920.554 1362.24,873.492 1364.55,1061.16 1366.86,970.374 1369.17,935.285 1371.47,862.648 1373.78,837.624 1376.09,861.811 1378.4,891.182 1380.71,933.253 1383.01,952.74 1385.32,966.502 1387.63,805.958 1389.94,836.655 1392.24,843.633 1394.55,673.945 1396.86,840.096 1399.17,968.535 1401.48,863.618 1403.78,875.456 1406.09,889.871 1408.4,903.09 1410.71,963.188 1413.02,778.943 1415.32,884.129 1417.63,1058.31 1419.94,748.773 1422.25,1008.07 1424.56,846.5 1426.86,1025.02 1429.17,834.85 1431.48,917.613 1433.79,995.639 1436.1,881.964 1438.4,813.321 1440.71,1015.02 1443.02,758.524 1445.33,870.88 1447.63,956.499 1449.94,931.609 1452.25,897.986 1454.56,823.575 1456.87,885.032 1459.17,868.989 1461.48,911.329 1463.79,887.879 1466.1,997.173 1468.41,856.062 1470.71,952.848 1473.02,940.029 1475.33,921.483 1477.64,777.483 1479.95,1075.73 1482.25,1008.83 1484.56,970.569 1486.87,848.121 1489.18,866.344 1491.49,912.367 1493.79,823.702 1496.1,915.4 1498.41,880.139 1500.72,1135.31 1503.02,710.38 1505.33,853.269 1507.64,919.956 1509.95,795.507 1512.26,893.442 1514.56,1091.34 1516.87,872.814 1519.18,918.849 1521.49,811.279 1523.8,886.125 1526.1,798.297 1528.41,1033.16 1530.72,710.932 1533.03,820.857 1535.34,948.548 1537.64,863.232 1539.95,958.111 1542.26,982.335 1544.57,908.163 1546.88,700.452 1549.18,904.389 1551.49,864.246 1553.8,757.457 1556.11,930.197 1558.41,898.849 1560.72,825.494 1563.03,873.44 1565.34,916.823 1567.65,865.399 1569.95,914.866 1572.26,994.987 1574.57,946.529 1576.88,776.049 1579.19,799.263 1581.49,953.266 1583.8,861.833 1586.11,913.039 1588.42,778.902 1590.73,890.224 1593.03,1059.8 1595.34,765.464 1597.65,892.228 1599.96,1032.8 1602.26,937.018 1604.57,883.54 1606.88,858.136 1609.19,921.533 1611.5,770.235 1613.8,907.939 1616.11,1060.79 1618.42,975.186 1620.73,788.657 1623.04,916.484 1625.34,1028.54 1627.65,837.233 1629.96,940.709 1632.27,977.849 1634.58,768.927 1636.88,997.698 1639.19,959.162 1641.5,833.482 1643.81,906.35 1646.12,940.972 1648.42,906.234 1650.73,1027.89 1653.04,800.335 1655.35,669.615 1657.65,880.442 1659.96,1045.23 1662.27,1056.87 1664.58,884.733 1666.89,924.071 1669.19,907.507 1671.5,936.277 1673.81,828.751 1676.12,833.985 1678.43,867.377 1680.73,755.843 1683.04,984.931 1685.35,1043.18 1687.66,879.892 1689.97,878.535 1692.27,848.748 1694.58,928.702 1696.89,791.106 1699.2,901.38 1701.51,890.651 1703.81,826.622 1706.12,860.323 1708.43,911.402 1710.74,800.677 1713.04,947.34 1715.35,779.624 1717.66,898.227 1719.97,941.3 1722.28,799.987 1724.58,857.384 1726.89,1037.09 1729.2,990.339 1731.51,1015.61 1733.82,936.77 1736.12,1024.02 1738.43,843.667 1740.74,817.661 1743.05,870.675 1745.36,873.757 1747.66,859.197 1749.97,922.882 1752.28,848.893 1754.59,762.312 1756.9,1018.14 1759.2,862.111 1761.51,966.971 1763.82,994.828 1766.13,929.117 1768.43,760.641 1770.74,952.143 1773.05,969.659 1775.36,845.595 1777.67,766.294 1779.97,846.663 1782.28,677.343 1784.59,981.089 1786.9,865.641 1789.21,954.069 1791.51,1002.21 1793.82,906.523 1796.13,1019.66 1798.44,812.791 1800.75,868.993 1803.05,844.826 1805.36,1023.88 1807.67,833.847 1809.98,929.729 1812.28,980.888 1814.59,832.896 1816.9,804.541 1819.21,995.012 1821.52,959.968 1823.82,898.429 1826.13,994.615 1828.44,957.271 1830.75,933.899 1833.06,834.974 1835.36,784.482 1837.67,859.328 1839.98,958.138 1842.29,824.161 1844.6,963.019 1846.9,1094.03 1849.21,899.867 1851.52,867.077 1853.83,970.045 1856.14,915.903 1858.44,798.175 1860.75,859.728 1863.06,793.827 1865.37,943.112 1867.67,843.758 1869.98,864.72 1872.29,987.092 1874.6,1061.48 1876.91,834.042 1879.21,637.673 1881.52,926.085 1883.83,957.998 1886.14,609.089 1888.45,1012.03 1890.75,863.714 1893.06,967.828 1895.37,754.739 1897.68,941.557 1899.99,925.555 1902.29,940.127 1904.6,1013.28 1906.91,872.766 1909.22,879.12 1911.53,997.973 1913.83,1010.58 1916.14,765.263 1918.45,892.226 1920.76,932.769 1923.06,862.241 1925.37,916.272 1927.68,888.816 1929.99,1025.68 1932.3,819.067 1934.6,939.737 1936.91,893.801 1939.22,959.603 1941.53,1033.6 1943.84,942.556 1946.14,886.868 1948.45,867.093 1950.76,1068.54 1953.07,845.517 1955.38,972.918 1957.68,966.154 1959.99,1074.13 1962.3,845.778 1964.61,798.963 1966.91,1062.03 1969.22,737.711 1971.53,982.875 1973.84,1017.88 1976.15,845.663 1978.45,959.173 1980.76,943.942 1983.07,809.299 1985.38,1044.56 1987.69,996.236 1989.99,1019.87 1992.3,889.565 1994.61,997.714 1996.92,930.74 1999.23,961.604 2001.53,845.139 2003.84,961.065 2006.15,850.144 2008.46,1027.7 2010.77,736.679 2013.07,943.696 2015.38,1008.86 2017.69,903.893 2020,913.523 2022.3,956.91 2024.61,1048.27 2026.92,876.373 2029.23,1057.68 2031.54,861.924 2033.84,863.786 2036.15,884.428 2038.46,974.124 2040.77,1024.65 2043.08,840.663 2045.38,1041.67 2047.69,1020.68 2050,1052.87 2052.31,983.615 2054.62,810.599 2056.92,897.871 2059.23,938.943 2061.54,928.214 2063.85,984.953 2066.16,1014.95 2068.46,1071.6 2070.77,922.162 2073.08,775.526 2075.39,864.331 2077.69,892.999 2080,988.952 2082.31,983.574 2084.62,1001.91 2086.93,826.693 2089.23,904.622 2091.54,943.493 2093.85,964.999 2096.16,635.83 2098.47,1060.55 2100.77,810.01 2103.08,916.815 2105.39,1057.05 2107.7,959.329 2110.01,834.27 2112.31,895.507 2114.62,902.112 2116.93,865.707 2119.24,933.058 2121.55,904.57 2123.85,1075.31 2126.16,919.421 2128.47,991.748 2130.78,1026.87 2133.08,745.62 2135.39,960.29 2137.7,899.33 2140.01,829.587 2142.32,809.664 2144.62,902.863 2146.93,951.621 2149.24,1050.32 2151.55,866.019 2153.86,701.345 2156.16,856.095 2158.47,975.138 2160.78,1047.81 2163.09,891.418 2165.4,761.898 2167.7,847.621 2170.01,791.312 2172.32,967.958 2174.63,941.792 2176.93,750.351 2179.24,896.873 2181.55,1084.21 2183.86,755.492 2186.17,908.582 2188.47,1005.55 2190.78,708.916 2193.09,806.438 2195.4,958.577 2197.71,980.497 2200.01,922.365 2202.32,781.364 2204.63,884.195 2206.94,864.985 2209.25,970.781 2211.55,1171.27 2213.86,751.475 2216.17,1037.95 2218.48,934.903 2220.79,899.89 2223.09,785.958 2225.4,842.033 2227.71,802.498 2230.02,1110.65 2232.32,823.206 2234.63,825.908 2236.94,724.876 2239.25,882.362 2241.56,911.345 2243.86,1080.88 2246.17,791.253 2248.48,1001.37 2250.79,943.801 2253.1,1070 2255.4,824.83 2257.71,1015.63 2260.02,959.968 2262.33,969.904 2264.64,870.197 2266.94,811.095 2269.25,976.32 2271.56,969.893 2273.87,806.705 2276.18,1029.69 2278.48,1021.63 2280.79,1084.24 2283.1,941.791 2285.41,941.517 2287.71,897.378 2290.02,874.662 2292.33,871.614 2294.64,780.382 2296.95,879.903 2299.25,915.269 2301.56,975.196 2303.87,913.004 2306.18,891.193 2308.49,949.413 2310.79,899.849 2313.1,946.176 2315.41,813.975 2317.72,976.581 2320.03,1048.74 2322.33,854.592 2324.64,902.707 2326.95,884.11 2329.26,1012.76 2331.56,739.932 2333.87,957.358 2336.18,845.046 2338.49,757.193 2340.8,1022.29 2343.1,1005.14 2345.41,934.294 2347.72,888.272 2350.03,1038.43 2352.34,1025.68 2354.64,1069.59 2356.95,802.24 2359.26,736.363 2361.57,981.165 2363.88,833.735 2366.18,957.048 2368.49,987.742 2370.8,959.886 2373.11,835.447 2375.42,908.96 2377.72,1038.97 2380.03,878.127 2382.34,941.372 2384.65,799.985 2386.95,973.99 2389.26,802.195 2391.57,880.209 2393.88,905.343 2396.19,953.651 2398.49,689.13 2400.8,735.603 2403.11,1015.33 2405.42,789.726 2407.73,729.809 2410.03,1113.83 2412.34,902.301 2414.65,938.534 2416.96,1047.79 2419.27,844.112 2421.57,902.571 2423.88,880.676 2426.19,1138.63 2428.5,701.345 2430.81,973.366 2433.11,925.073 2435.42,890.426 2437.73,936.198 2440.04,852.637 2442.34,755.307 2444.65,970.389 2446.96,989.935 2449.27,794.12 2451.58,1083.74 2453.88,777.229 2456.19,860.002 2458.5,1013.83 2460.81,1010.21 2463.12,898.275 2465.42,884.216 2467.73,1031.87 2470.04,952.488 2472.35,950.855 2474.66,1087.73 2476.96,836.147 2479.27,918.964 2481.58,975.964 2483.89,967.797 2486.2,929.784 2488.5,952.721 2490.81,872.23 2493.12,947.234 2495.43,949.459 2497.73,945.431 2500.04,892.331 2502.35,924.587 2504.66,870.02 2506.97,959.256 2509.27,1076.94 2511.58,971.221 2513.89,897.937 2516.2,824.434 2518.51,976.247 2520.81,919.039 2523.12,874.566 2525.43,955.445 2527.74,917.439 2530.05,1048.28 2532.35,1164.54 2534.66,878.39 2536.97,1014.04 2539.28,812.687 2541.58,835.991 2543.89,824.269 2546.2,939.863 2548.51,856.586 2550.82,833.492 2553.12,882.821 2555.43,990.27 2557.74,852.605 2560.05,876.986 2562.36,898.261 2564.66,837.677 2566.97,833.224 2569.28,920.542 2571.59,960.263 "></polyline>
<polyline clip-path="url(#clip212)" style="stroke:#3da44d; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="265.984,738.145 268.292,392.563 270.6,408.394 272.908,451.135 275.216,427.325 277.524,491.473 279.832,527.008 282.139,488.53 284.447,270.694 286.755,384.246 289.063,381.331 291.371,321.582 293.679,549.779 295.987,316.647 298.295,523.941 300.603,383.167 302.911,575.497 305.219,416.139 307.527,440.03 309.834,576.161 312.142,382.555 314.45,404.639 316.758,363.661 319.066,498.886 321.374,599.34 323.682,482.965 325.99,507.87 328.298,459.618 330.606,388.744 332.914,387.962 335.221,306.366 337.529,206.377 339.837,420.164 342.145,410.777 344.453,310.041 346.761,331.845 349.069,312.316 351.377,423.624 353.685,322.649 355.993,416.526 358.301,445.415 360.608,468.951 362.916,389.244 365.224,233.874 367.532,334.382 369.84,459.695 372.148,386.556 374.456,373.321 376.764,397.849 379.072,458.537 381.38,345.52 383.688,478.676 385.996,341.884 388.303,456.692 390.611,446.991 392.919,356.807 395.227,429.264 397.535,412.048 399.843,422.47 402.151,227.785 404.459,520.702 406.767,399.824 409.075,517.403 411.383,413.815 413.69,341.901 415.998,403.755 418.306,406.635 420.614,433.695 422.922,272.047 425.23,335.232 427.538,533.671 429.846,322.726 432.154,509.063 434.462,304.883 436.77,481.13 439.077,374.725 441.385,341.697 443.693,346.679 446.001,264.983 448.309,449.499 450.617,487.685 452.925,450.132 455.233,283.661 457.541,437.837 459.849,96.8724 462.157,371.289 464.465,484.033 466.772,408.026 469.08,255.224 471.388,620.299 473.696,483.002 476.004,419.651 478.312,370.206 480.62,326.771 482.928,447.455 485.236,557.421 487.544,301.246 489.852,445.457 492.159,485.2 494.467,485.036 496.775,530.481 499.083,277.357 501.391,404.002 503.699,482.739 506.007,365.373 508.315,294.133 510.623,433.009 512.931,606.936 515.239,481.212 517.546,446.171 519.854,429.828 522.162,191.192 524.47,488.634 526.778,367.853 529.086,440.732 531.394,260.972 533.702,428.823 536.01,441.229 538.318,321.703 540.626,284.347 542.933,368.493 545.241,449.062 547.549,390.379 549.857,456.119 552.165,452.304 554.473,342.673 556.781,457.678 559.089,334.079 561.397,465.858 563.705,351.233 566.013,444.83 568.321,546.152 570.628,398.467 572.936,422.702 575.244,318.613 577.552,465.47 579.86,368.952 582.168,322.753 584.476,369.383 586.784,457.752 589.092,421.483 591.4,410.49 593.708,614.829 596.015,478.939 598.323,365.251 600.631,376.462 602.939,476.639 605.247,374.206 607.555,396.661 609.863,388.611 612.171,428.05 614.479,331.768 616.787,214.239 619.095,189.865 621.402,390.767 623.71,591.616 626.018,301.678 628.326,447.031 630.634,387.913 632.942,436.187 635.25,354.497 637.558,310.019 639.866,350.518 642.174,307.929 644.482,523.027 646.79,465.485 649.097,405.19 651.405,449.077 653.713,498.046 656.021,256.89 658.329,327.714 660.637,511.642 662.945,342.469 665.253,391.105 667.561,311.536 669.869,544.854 672.177,559.712 674.484,313.357 676.792,273.287 679.1,417.334 681.408,458.631 683.716,424.961 686.024,647.538 688.332,388.215 690.64,488.077 692.948,338.537 695.256,723.408 697.564,273.521 699.871,474.852 702.179,547.285 704.487,374.255 706.795,373.602 709.103,325.478 711.411,500.741 713.719,413.474 716.027,414.161 718.335,475.158 720.643,345.499 722.951,404.054 725.259,235.528 727.566,561.024 729.874,441.266 732.182,523.636 734.49,454.741 736.798,479.981 739.106,291.166 741.414,332.811 743.722,292.323 746.03,468.03 748.338,512.568 750.646,403.715 752.953,327.581 755.261,281.483 757.569,527.569 759.877,321.814 762.185,508.916 764.493,339.981 766.801,437.288 769.109,394.489 771.417,625.35 773.725,477.237 776.033,504.105 778.34,337.304 780.648,351.22 782.956,430.751 785.264,351.651 787.572,338.629 789.88,325.207 792.188,434.556 794.496,308.34 796.804,340.039 799.112,551.334 801.42,293.77 803.728,326.349 806.035,444.926 808.343,531.232 810.651,377.306 812.959,472.452 815.267,238.51 817.575,468.417 819.883,413.775 822.191,323.099 824.499,511.444 826.807,347.736 829.115,424.256 831.422,435.259 833.73,398.912 836.038,442.21 838.346,399.197 840.654,442.359 842.962,403.369 845.27,421.553 847.578,448.521 849.886,372.249 852.194,392.676 854.502,456.595 856.809,403.949 859.117,419.506 861.425,429.098 863.733,441.779 866.041,551.117 868.349,484.649 870.657,446.334 872.965,349.481 875.273,456.055 877.581,482.506 879.889,197.487 882.197,488.204 884.504,446.084 886.812,425.098 889.12,302.979 891.428,460.516 893.736,504.231 896.044,493.229 898.352,240.111 900.66,471.361 902.968,370.445 905.276,374.359 907.584,389.969 909.891,435.907 912.199,278.645 914.507,228.425 916.815,291.003 919.123,388.264 921.431,375.418 923.739,326.175 926.047,480.697 928.355,504.704 930.663,379.792 932.971,513.282 935.278,356.222 937.586,459.192 939.894,384.023 942.202,607.72 944.51,335.274 946.818,437.245 949.126,467.757 951.434,300.637 953.742,350.462 956.05,491.541 958.358,598.462 960.665,512.792 962.973,560.45 965.281,415.866 967.589,400.881 969.897,422.795 972.205,429.655 974.513,318.899 976.821,428.705 979.129,416.52 981.437,328.616 983.745,374.14 986.053,348.149 988.36,425.847 990.668,438.203 992.976,429.502 995.284,394.929 997.592,365.649 999.9,369.022 1002.21,548.72 1004.52,423.004 1006.82,346.801 1009.13,452.843 1011.44,363.522 1013.75,584.452 1016.06,215.134 1018.36,509.332 1020.67,518.756 1022.98,417.243 1025.29,442.353 1027.59,455.143 1029.9,486.212 1032.21,584.573 1034.52,367.805 1036.83,474.147 1039.13,321.671 1041.44,441.999 1043.75,530.522 1046.06,325.056 1048.37,402.86 1050.67,558.797 1052.98,311.172 1055.29,334.4 1057.6,422.107 1059.91,625.144 1062.21,498.878 1064.52,392.532 1066.83,446.797 1069.14,490.868 1071.45,347.58 1073.75,438.259 1076.06,274.733 1078.37,583.088 1080.68,362.181 1082.98,581.813 1085.29,495.39 1087.6,483.16 1089.91,361.867 1092.22,312.464 1094.52,390.887 1096.83,354.554 1099.14,487.103 1101.45,337.828 1103.76,381.189 1106.06,597.813 1108.37,499.277 1110.68,473.337 1112.99,583.196 1115.3,423.099 1117.6,319.177 1119.91,431.997 1122.22,346.285 1124.53,516.573 1126.84,295.973 1129.14,449.466 1131.45,296.184 1133.76,346.667 1136.07,491.934 1138.37,476.354 1140.68,367.96 1142.99,384.337 1145.3,393.979 1147.61,642.655 1149.91,289.562 1152.22,364.984 1154.53,519.683 1156.84,557.995 1159.15,507.321 1161.45,383.346 1163.76,359.235 1166.07,248.053 1168.38,510.36 1170.69,248.445 1172.99,326.806 1175.3,343.966 1177.61,321.936 1179.92,558.388 1182.23,242.888 1184.53,282.84 1186.84,409.13 1189.15,567.663 1191.46,481.89 1193.76,513.29 1196.07,601.518 1198.38,440.649 1200.69,300.836 1203,401.081 1205.3,401.775 1207.61,490.424 1209.92,411.337 1212.23,366.129 1214.54,538.059 1216.84,452.251 1219.15,301.504 1221.46,203.997 1223.77,439.046 1226.08,284.398 1228.38,332.739 1230.69,328.443 1233,368.518 1235.31,557.314 1237.61,512.387 1239.92,570.498 1242.23,583.614 1244.54,361.606 1246.85,454.048 1249.15,466.875 1251.46,535.962 1253.77,405.2 1256.08,536.925 1258.39,470.889 1260.69,318.002 1263,355.814 1265.31,421.609 1267.62,535.47 1269.93,511.136 1272.23,313.025 1274.54,227.135 1276.85,374.999 1279.16,348.725 1281.47,353.519 1283.77,393.493 1286.08,345.842 1288.39,552.562 1290.7,480.326 1293,378.748 1295.31,445.097 1297.62,439.556 1299.93,274.412 1302.24,238.059 1304.54,227.887 1306.85,414.913 1309.16,456.582 1311.47,349.368 1313.78,397.516 1316.08,549.317 1318.39,442.34 1320.7,579.032 1323.01,363.782 1325.32,287.913 1327.62,352.936 1329.93,360.806 1332.24,359.126 1334.55,502.684 1336.86,271.002 1339.16,348.815 1341.47,411.276 1343.78,651.557 1346.09,346.048 1348.39,365.685 1350.7,415.93 1353.01,455.885 1355.32,371.852 1357.63,374.017 1359.93,453.939 1362.24,503.38 1364.55,380.95 1366.86,602.257 1369.17,582.136 1371.47,497.011 1373.78,305.672 1376.09,514.192 1378.4,321.461 1380.71,399.99 1383.01,350.475 1385.32,423.841 1387.63,405.321 1389.94,366.616 1392.24,507.202 1394.55,524.753 1396.86,359.025 1399.17,470.985 1401.48,509.091 1403.78,409.959 1406.09,559.968 1408.4,388.619 1410.71,397.333 1413.02,488.282 1415.32,338.706 1417.63,486.464 1419.94,537.944 1422.25,401.639 1424.56,317.919 1426.86,187.752 1429.17,257.423 1431.48,349.996 1433.79,271.54 1436.1,528.163 1438.4,399.36 1440.71,305.657 1443.02,342.808 1445.33,402.579 1447.63,439.094 1449.94,355.56 1452.25,557.013 1454.56,482.108 1456.87,344.368 1459.17,328.146 1461.48,474.79 1463.79,219.096 1466.1,401.049 1468.41,447.099 1470.71,239.933 1473.02,467.832 1475.33,453.911 1477.64,444.231 1479.95,351.251 1482.25,261.023 1484.56,424.039 1486.87,377.645 1489.18,436.649 1491.49,406.939 1493.79,294.887 1496.1,524.187 1498.41,434.787 1500.72,500.643 1503.02,345.309 1505.33,452.542 1507.64,481.278 1509.95,385.521 1512.26,280.877 1514.56,404.192 1516.87,492.922 1519.18,572.533 1521.49,488.464 1523.8,493.466 1526.1,623.728 1528.41,344.877 1530.72,612.557 1533.03,693.871 1535.34,396.038 1537.64,302.681 1539.95,367.434 1542.26,558.402 1544.57,243.983 1546.88,399.642 1549.18,342.915 1551.49,235.051 1553.8,326.444 1556.11,360.074 1558.41,283.849 1560.72,428.959 1563.03,501.515 1565.34,206.887 1567.65,431.767 1569.95,316.678 1572.26,316.114 1574.57,551.624 1576.88,326.203 1579.19,376.614 1581.49,353.601 1583.8,442.167 1586.11,483.876 1588.42,404.351 1590.73,537.553 1593.03,287.051 1595.34,409.446 1597.65,227.849 1599.96,337.019 1602.26,391.674 1604.57,441.713 1606.88,409.94 1609.19,458.735 1611.5,330.976 1613.8,359.484 1616.11,298.728 1618.42,288.877 1620.73,509.116 1623.04,417.221 1625.34,393.166 1627.65,472.42 1629.96,408.292 1632.27,395.328 1634.58,488.76 1636.88,257.895 1639.19,517.059 1641.5,372.959 1643.81,243.103 1646.12,307.034 1648.42,424.109 1650.73,446.133 1653.04,316.159 1655.35,408.232 1657.65,408.353 1659.96,403.573 1662.27,518.401 1664.58,388.753 1666.89,474.113 1669.19,304.413 1671.5,403.277 1673.81,235.929 1676.12,371.485 1678.43,330.351 1680.73,303.285 1683.04,448.354 1685.35,380.725 1687.66,507.364 1689.97,386.963 1692.27,310.28 1694.58,360.549 1696.89,448.547 1699.2,364.726 1701.51,534.43 1703.81,556.037 1706.12,435.353 1708.43,381.68 1710.74,454.963 1713.04,431.319 1715.35,551.299 1717.66,419.349 1719.97,457.35 1722.28,346.831 1724.58,499.612 1726.89,274.021 1729.2,293.281 1731.51,633.628 1733.82,219.151 1736.12,545.085 1738.43,213.485 1740.74,510.345 1743.05,432.463 1745.36,304.928 1747.66,503.372 1749.97,511.256 1752.28,369.447 1754.59,374.779 1756.9,200.721 1759.2,532.955 1761.51,501.093 1763.82,404.832 1766.13,371.228 1768.43,257.24 1770.74,504.704 1773.05,215.029 1775.36,276.72 1777.67,382.798 1779.97,345.291 1782.28,314.11 1784.59,424.955 1786.9,315.313 1789.21,340.929 1791.51,493.033 1793.82,321.484 1796.13,521.173 1798.44,413.453 1800.75,511.318 1803.05,405.522 1805.36,428.87 1807.67,631.751 1809.98,333.941 1812.28,431.789 1814.59,574.273 1816.9,370.23 1819.21,486.431 1821.52,453.327 1823.82,382.165 1826.13,512.649 1828.44,490.446 1830.75,402.596 1833.06,464.509 1835.36,413.177 1837.67,369.296 1839.98,453.408 1842.29,419.452 1844.6,349.862 1846.9,419.984 1849.21,619.646 1851.52,565.248 1853.83,467.876 1856.14,402.013 1858.44,311.475 1860.75,486.609 1863.06,304.922 1865.37,361.604 1867.67,535.451 1869.98,577.05 1872.29,269.787 1874.6,231.283 1876.91,375.773 1879.21,656.622 1881.52,647.275 1883.83,481.63 1886.14,403.121 1888.45,475.247 1890.75,391.439 1893.06,365.722 1895.37,323.927 1897.68,402.158 1899.99,196.034 1902.29,598.431 1904.6,409.164 1906.91,346.186 1909.22,467.298 1911.53,512.257 1913.83,429.006 1916.14,554.474 1918.45,298.857 1920.76,474.414 1923.06,361.317 1925.37,238.545 1927.68,381.744 1929.99,387.63 1932.3,600.851 1934.6,310.098 1936.91,425.406 1939.22,371.678 1941.53,318.119 1943.84,402.729 1946.14,417.126 1948.45,353.254 1950.76,452.225 1953.07,268.496 1955.38,351.695 1957.68,334.223 1959.99,271.733 1962.3,389.317 1964.61,266.649 1966.91,334.427 1969.22,246.948 1971.53,317.162 1973.84,543.188 1976.15,314.945 1978.45,430.703 1980.76,528.497 1983.07,564.477 1985.38,340.955 1987.69,366.544 1989.99,321.277 1992.3,568.238 1994.61,241.158 1996.92,507.039 1999.23,499.281 2001.53,385.29 2003.84,562.771 2006.15,399.469 2008.46,415.845 2010.77,460.786 2013.07,521.728 2015.38,622.763 2017.69,442.051 2020,328.313 2022.3,332.154 2024.61,413.808 2026.92,482.916 2029.23,494.955 2031.54,394.095 2033.84,347.641 2036.15,393.923 2038.46,332.036 2040.77,417.053 2043.08,294.915 2045.38,353.396 2047.69,307.037 2050,408.837 2052.31,468.886 2054.62,266.796 2056.92,248.485 2059.23,347.234 2061.54,289.376 2063.85,586.81 2066.16,492.893 2068.46,354.071 2070.77,218.597 2073.08,317.853 2075.39,474.875 2077.69,412.625 2080,510.4 2082.31,574.119 2084.62,453.76 2086.93,304.926 2089.23,221.503 2091.54,383.623 2093.85,323.253 2096.16,321.945 2098.47,397.466 2100.77,367.177 2103.08,485.21 2105.39,532.468 2107.7,468.663 2110.01,278.928 2112.31,429.568 2114.62,332.853 2116.93,209.19 2119.24,475.68 2121.55,408.148 2123.85,348.018 2126.16,469.102 2128.47,524.358 2130.78,401.707 2133.08,241.853 2135.39,493.212 2137.7,532.854 2140.01,432.788 2142.32,417.618 2144.62,484.185 2146.93,387.476 2149.24,291.657 2151.55,495.573 2153.86,326.499 2156.16,354.89 2158.47,608.463 2160.78,240.598 2163.09,499.73 2165.4,296.905 2167.7,260.652 2170.01,452.262 2172.32,499.003 2174.63,491.328 2176.93,378.811 2179.24,306.916 2181.55,518.304 2183.86,337.76 2186.17,449.465 2188.47,317.668 2190.78,565.775 2193.09,406.961 2195.4,449.861 2197.71,323.543 2200.01,242.509 2202.32,329.091 2204.63,580.705 2206.94,326.495 2209.25,420.11 2211.55,534.046 2213.86,386.445 2216.17,497.511 2218.48,346.155 2220.79,328.362 2223.09,404.996 2225.4,399.794 2227.71,556.756 2230.02,298.791 2232.32,506.137 2234.63,542.047 2236.94,492.183 2239.25,448.566 2241.56,391.561 2243.86,388.957 2246.17,425.516 2248.48,472.768 2250.79,260.428 2253.1,342.663 2255.4,422.994 2257.71,340.842 2260.02,409.513 2262.33,496.841 2264.64,618.524 2266.94,270.316 2269.25,495.222 2271.56,364.624 2273.87,441.907 2276.18,501.841 2278.48,516.397 2280.79,410.464 2283.1,466.864 2285.41,548.324 2287.71,329.58 2290.02,356.126 2292.33,182.993 2294.64,299.898 2296.95,328.091 2299.25,493.722 2301.56,453.223 2303.87,368.046 2306.18,425.84 2308.49,317.25 2310.79,637.408 2313.1,471.355 2315.41,428.571 2317.72,499.628 2320.03,365.042 2322.33,286.612 2324.64,423.777 2326.95,397.276 2329.26,350.456 2331.56,410.604 2333.87,350.336 2336.18,395.34 2338.49,392.236 2340.8,256.041 2343.1,322.676 2345.41,483.83 2347.72,434.672 2350.03,323.822 2352.34,263.658 2354.64,378.641 2356.95,336.345 2359.26,319.145 2361.57,253.041 2363.88,304.587 2366.18,529.069 2368.49,516.456 2370.8,575.578 2373.11,299.876 2375.42,388.163 2377.72,413.78 2380.03,293.571 2382.34,587.267 2384.65,411.717 2386.95,315.847 2389.26,333.131 2391.57,353.106 2393.88,323.489 2396.19,328.819 2398.49,311.851 2400.8,395.357 2403.11,333.343 2405.42,379.168 2407.73,504.177 2410.03,262.44 2412.34,409.541 2414.65,353.72 2416.96,403.949 2419.27,499.073 2421.57,341.168 2423.88,185.804 2426.19,248.568 2428.5,359.227 2430.81,460.199 2433.11,377.991 2435.42,471.175 2437.73,451.888 2440.04,452.601 2442.34,563.569 2444.65,321.784 2446.96,341.559 2449.27,325.484 2451.58,451.159 2453.88,545.636 2456.19,425.597 2458.5,322.929 2460.81,600.79 2463.12,327.492 2465.42,421.635 2467.73,491.332 2470.04,238.938 2472.35,488.295 2474.66,510.364 2476.96,441.544 2479.27,499.86 2481.58,381.837 2483.89,311.779 2486.2,329.048 2488.5,374.42 2490.81,504.203 2493.12,302.492 2495.43,469.595 2497.73,343.152 2500.04,260.128 2502.35,473.628 2504.66,466.677 2506.97,418.659 2509.27,404.419 2511.58,468.744 2513.89,505.211 2516.2,410.581 2518.51,373.904 2520.81,457.465 2523.12,477.471 2525.43,267.195 2527.74,388.888 2530.05,243.353 2532.35,596.892 2534.66,398.761 2536.97,417.155 2539.28,578.956 2541.58,380.251 2543.89,316.628 2546.2,470.182 2548.51,463.693 2550.82,615.933 2553.12,562.484 2555.43,380.55 2557.74,314.859 2560.05,385.586 2562.36,652.474 2564.66,467.153 2566.97,389.834 2569.28,199.342 2571.59,433.292 "></polyline>
</svg>
</div>
</div>
<p>Look at that! Things are working; amazin’.</p>
<p>We can also exploit <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>’s parallel sampling capabilities:</p>
<div id="34" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run separate 4 chains for 10 000 iterations using threads to parallelize.</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>num_chains <span class="op">=</span> <span class="fl">4</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    model_with_grad,</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">MCMCThreads</span>(),</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>,</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    num_chains;</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Note we need to provide an initial state for every chain.</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>    initial_state<span class="op">=</span><span class="fu">fill</span>(state, num_chains),</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>samples_array <span class="op">=</span> <span class="fu">stack</span>(<span class="fu">map</span>(<span class="bu">Base</span>.<span class="fu">Fix1</span>(stack, sample <span class="op">-&gt;</span> sample.x), samples))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000×4 Array{Float64, 3}:
[:, :, 1] =
 -3.73522    -3.56994   -3.56994   -5.41529   …  -4.79994  -4.79994  -4.79994
  0.0656629   0.395627   0.395627   0.775114      0.71792   0.71792   0.71792
  1.2125      4.01218    4.01218    4.56922       5.08764   5.08764   5.08764

[:, :, 2] =
 -2.67987  -5.50305    -3.25999  …  -3.32433   -3.72516    -3.71033
  1.11487  -0.0388312  -1.94071      0.264512  -0.0993342  -0.476208
  2.06793   2.4849      3.72335      5.35504    5.15694     6.59321

[:, :, 3] =
 -1.85148   -5.00723   -5.00723   -5.87005  …  -4.85281  -3.9       -3.9
  0.417739   0.583685   0.583685   1.73097      1.4556    0.496022   0.496022
  2.50767    4.36773    4.36773    4.95836      4.10218   4.12154    4.12154

[:, :, 4] =
 -0.32246   -4.76579   -4.85164   -5.69546  …  -4.79039  -5.98596  -5.96264
  0.120825   0.338447   0.162759  -0.39255     -1.14049   1.04378   0.278059
  2.90743    4.11341    4.75441    6.58743      4.50911   4.16108   3.7221</code></pre>
</div>
</div>
<p>But the fact that we have to provide the <code>AbstractMCMC.sample</code> call, etc. with an <code>initial_state</code> to get started is a bit annoying. We can avoid this by also defining a <code>AbstractMCMC.step</code> <em>without</em> the <code>state</code> argument:</p>
<div id="36" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">::</span><span class="dt">MALA</span>;</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># </span><span class="al">NOTE</span><span class="co">: No state provided!</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just create the initial state by sampling using  a Gaussian.</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="fu">randn</span>(rng, LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(x), <span class="fu">MALAState</span>(x)</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Equipped with this, we no longer need to provide the <code>initial_state</code> everywhere:</p>
<div id="38" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -4.9872      1.01592
 -0.00465474  0.976807
  5.00284     0.997539</code></pre>
</div>
</div>
</section>
<section id="using-our-sampler-with-turing.jl" class="level2">
<h2 class="anchored" data-anchor-id="using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</h2>
<p>As we promised, all of this hassle of implementing our <code>MALA</code> sampler in a way that uses <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> and <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> gets us something more than <em>just</em> an “automatic” implementation of <code>AbstractMCMC.sample</code>.</p>
<p>It also enables use with Turing.jl through the <code>externalsampler</code>, but we need to do one final thing first: we need to tell Turing.jl how to extract a vector of parameters from the “sample” returned in our implementation of <code>AbstractMCMC.step</code>. In our case, the “sample” is a <code>MALASample</code>, so we just need the following line:</p>
<div id="40" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load Turing.jl.</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Turing</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Overload the `getparams` method for our "sample" type, which is just a vector.</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>Turing.Inference.<span class="fu">getparams</span>(<span class="op">::</span><span class="dt">Turing.Model</span>, sample<span class="op">::</span><span class="dt">MALASample</span>) <span class="op">=</span> sample.x</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And with that, we’re good to go!</p>
<div id="42" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Our previous model defined as a Turing.jl model.</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">mvnormal_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">MvNormal</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.], I)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate our model.</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">mvnormal_model</span>()</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Call `sample` but now we're passing in a Turing.jl `model` and wrapping</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co"># our `MALA` sampler in the `externalsampler` to tell Turing.jl that the sampler</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co"># expects something that implements LogDensityProblems.jl.</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×4×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 3.14 seconds
Compute duration  = 3.14 seconds
parameters        = x[1], x[2], x[3]
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters  </span><span class="ansi-bold">    mean  </span><span class="ansi-bold">     std  </span><span class="ansi-bold">    mcse  </span><span class="ansi-bold">  ess_bulk  </span><span class="ansi-bold">  ess_tail  </span><span class="ansi-bold">    rhat  </span><span class="ansi-bold"> ⋯
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">   Float64  </span><span class="ansi-bright-black-fg ansi-bold">   Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> ⋯

        x[1]   -4.9886    0.9906    0.0172   3300.3916   5070.1656    1.0000   ⋯
        x[2]    0.0081    1.0086    0.0176   3272.4487   5026.0985    1.0002   ⋯
        x[3]    5.0274    1.0032    0.0181   3063.8078   4865.7275    1.0000   ⋯
</span><span class="ansi-cyan-fg ansi-bold">                                                                1 column omitted

Quantiles
 </span><span class="ansi-cyan-fg ansi-bold"> parameters  </span><span class="ansi-cyan-fg ansi-bold">    2.5%  </span><span class="ansi-cyan-fg ansi-bold">   25.0%  </span><span class="ansi-cyan-fg ansi-bold">   50.0%  </span><span class="ansi-cyan-fg ansi-bold">   75.0%  </span><span class="ansi-cyan-fg ansi-bold">   97.5%
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64

        x[1]   -6.9557   -5.6514   -4.9868   -4.3374   -3.0178
        x[2]   -1.9309   -0.6645   -0.0053    0.6945    2.0050
        x[3]    3.0717    4.3453    5.0175    5.7120    6.9723
</span></pre>
</div>
</div>
</div>
<p>Pretty neat, eh?</p>
<section id="models-with-constrained-parameters" class="level3">
<h3 class="anchored" data-anchor-id="models-with-constrained-parameters">Models with constrained parameters</h3>
<p>One thing we’ve sort of glossed over in all of the above is that MALA, at least how we’ve implemented it, requires <span class="math inline">\(x\)</span> to live in <span class="math inline">\(\mathbb{R}^d\)</span> for some <span class="math inline">\(d &gt; 0\)</span>. If some of the parameters were in fact constrained, e.g.&nbsp;we were working with a <code>Beta</code> distribution which has support on the interval <span class="math inline">\((0, 1)\)</span>, <em>not</em> on <span class="math inline">\(\mathbb{R}^d\)</span>, we could easily end up outside of the valid range <span class="math inline">\((0, 1)\)</span>.</p>
<div id="44" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">beta_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">beta_model</span>()</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 1.93 seconds
Compute duration  = 1.93 seconds
parameters        = x
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters  </span><span class="ansi-bold">    mean  </span><span class="ansi-bold">     std  </span><span class="ansi-bold">    mcse  </span><span class="ansi-bold">  ess_bulk  </span><span class="ansi-bold">  ess_tail  </span><span class="ansi-bold">    rhat  </span><span class="ansi-bold"> ⋯
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">   Float64  </span><span class="ansi-bright-black-fg ansi-bold">   Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> ⋯

           x    0.5020    0.1895    0.0028   4310.3216   6117.6091    1.0006   ⋯
</span><span class="ansi-cyan-fg ansi-bold">                                                                1 column omitted

Quantiles
 </span><span class="ansi-cyan-fg ansi-bold"> parameters  </span><span class="ansi-cyan-fg ansi-bold">    2.5%  </span><span class="ansi-cyan-fg ansi-bold">   25.0%  </span><span class="ansi-cyan-fg ansi-bold">   50.0%  </span><span class="ansi-cyan-fg ansi-bold">   75.0%  </span><span class="ansi-cyan-fg ansi-bold">   97.5%
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64

           x    0.1452    0.3586    0.5038    0.6425    0.8560
</span></pre>
</div>
</div>
</div>
<p>Yep, that still works, but only because Turing.jl actually <em>transforms</em> the <code>turing_model</code> from constrained to unconstrained, so that the <code>sampler</code> provided to <code>externalsampler</code> is actually always working in unconstrained space! This is not always desirable, so we can turn this off:</p>
<div id="46" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 0.17 seconds
Compute duration  = 0.17 seconds
parameters        = x
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters  </span><span class="ansi-bold">    mean  </span><span class="ansi-bold">     std  </span><span class="ansi-bold">    mcse  </span><span class="ansi-bold"> ess_bulk  </span><span class="ansi-bold"> ess_tail  </span><span class="ansi-bold">    rhat  </span><span class="ansi-bold"> e ⋯
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">  Float64  </span><span class="ansi-bright-black-fg ansi-bold">  Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">   ⋯

           x    0.4815    0.1336    0.0101   165.3950    66.4508    1.0126     ⋯
</span><span class="ansi-cyan-fg ansi-bold">                                                                1 column omitted

Quantiles
 </span><span class="ansi-cyan-fg ansi-bold"> parameters  </span><span class="ansi-cyan-fg ansi-bold">    2.5%  </span><span class="ansi-cyan-fg ansi-bold">   25.0%  </span><span class="ansi-cyan-fg ansi-bold">   50.0%  </span><span class="ansi-cyan-fg ansi-bold">   75.0%  </span><span class="ansi-cyan-fg ansi-bold">   97.5%
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64

           x    0.2482    0.3785    0.4786    0.5787    0.7506
</span></pre>
</div>
</div>
</div>
<p>The fun thing is that this still sort of works because</p>
<div id="48" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">logpdf</span>(<span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>), <span class="fl">10.0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-Inf</code></pre>
</div>
</div>
<p>and so the samples that fall outside of the range are always rejected. But do notice how much worse all the diagnostics are, e.g.&nbsp;<code>ess_tail</code> is very poor compared to when we use <code>unconstrained=true</code>. Moreover, in more complex cases this won’t just result in a “nice” <code>-Inf</code> log-density value, but instead will error:</p>
<div id="50" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="kw">function</span> <span class="fu">demo</span>()</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>    σ² <span class="op">~</span> <span class="fu">truncated</span>(<span class="fu">Normal</span>(), lower<span class="op">=</span><span class="fl">0</span>)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If we end up with negative values for `σ²`, the `Normal` will error.</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>    x <span class="op">~</span> <span class="fu">Normal</span>(<span class="fl">0</span>, σ²)</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre>DomainError with -0.5601006171631286:
Normal: the condition σ &gt;= zero(σ) is not satisfied.
Stacktrace:
  [1] <span class="ansi-bold">#371</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/fi8Qd/src/univariate/continuous/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">normal.jl:37</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [2] <span class="ansi-bold">check_args</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/fi8Qd/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">utils.jl:89</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [3] <span class="ansi-bold">#Normal#370</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/fi8Qd/src/univariate/continuous/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">normal.jl:37</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [4] <span class="ansi-bold">Normal</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/fi8Qd/src/univariate/continuous/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">normal.jl:36</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [5] <span class="ansi-bold">Normal</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/fi8Qd/src/univariate/continuous/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">normal.jl:42</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [6] <span class="ansi-bold">macro expansion</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/DxBhI/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">compiler.jl:574</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [7] <span class="ansi-bold">demo</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">__model__</span>::DynamicPPL.Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}</span>, <span class="ansi-bright-black-fg">__varinfo__</span>::DynamicPPL.ThreadSafeVarInfo<span class="ansi-bright-black-fg">{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}, Vector{Base.RefValue{Float64}}}</span>, <span class="ansi-bright-black-fg">__context__</span>::DynamicPPL.ValuesAsInModelContext<span class="ansi-bright-black-fg">{DynamicPPL.DefaultContext}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-magenta-fg">Main.Notebook</span> <span class="ansi-bright-black-fg">~/work/docs/docs/developers/inference/implementing-samplers/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">index.qmd:457</span>
  [8] <span class="ansi-bold">_evaluate!!</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/DxBhI/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">model.jl:936</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [9] <span class="ansi-bold">evaluate_threadsafe!!</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">model</span>::DynamicPPL.Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}</span>, <span class="ansi-bright-black-fg">varinfo</span>::DynamicPPL.TypedVarInfo<span class="ansi-bright-black-fg">{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}</span>, <span class="ansi-bright-black-fg">context</span>::DynamicPPL.ValuesAsInModelContext<span class="ansi-bright-black-fg">{DynamicPPL.DefaultContext}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-cyan-fg">DynamicPPL</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/DxBhI/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">model.jl:925</span>
 [10] <span class="ansi-bold">evaluate!!</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/DxBhI/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">model.jl:855</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [11] <span class="ansi-bold">values_as_in_model</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/DxBhI/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">values_as_in_model.jl:173</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [12] <span class="ansi-bold">values_as_in_model</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/DxBhI/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">values_as_in_model.jl:172</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [13] <span class="ansi-bold">getparams</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">model</span>::DynamicPPL.Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}</span>, <span class="ansi-bright-black-fg">vi</span>::DynamicPPL.TypedVarInfo<span class="ansi-bright-black-fg">{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-green-fg">Turing.Inference</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/IXycm/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">Inference.jl:354</span>
 [14] <span class="ansi-bold">Turing.Inference.Transition</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">model</span>::DynamicPPL.Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}</span>, <span class="ansi-bright-black-fg">vi</span>::DynamicPPL.TypedVarInfo<span class="ansi-bright-black-fg">{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}</span>, <span class="ansi-bright-black-fg">t</span>::MALASample<span class="ansi-bright-black-fg">{Vector{Float64}}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-green-fg">Turing.Inference</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/IXycm/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">Inference.jl:231</span>
 [15] <span class="ansi-bold">transition_to_turing</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">f</span>::LogDensityFunction<span class="ansi-bright-black-fg">{DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}, DynamicPPL.DefaultContext, AutoForwardDiff{2, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}}}</span>, <span class="ansi-bright-black-fg">transition</span>::MALASample<span class="ansi-bright-black-fg">{Vector{Float64}}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-green-fg">Turing.Inference</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/IXycm/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">abstractmcmc.jl:12</span>
 [16] <span class="ansi-bold">step</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">rng</span>::TaskLocalRNG, <span class="ansi-bright-black-fg">model</span>::DynamicPPL.Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}</span>, <span class="ansi-bright-black-fg">sampler_wrapper</span>::DynamicPPL.Sampler<span class="ansi-bright-black-fg">{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}</span>; <span class="ansi-bright-black-fg">initial_state</span>::Nothing, <span class="ansi-bright-black-fg">initial_params</span>::Nothing, <span class="ansi-bright-black-fg">kwargs</span>::@Kwargs<span class="ansi-bright-black-fg">{}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-green-fg">Turing.Inference</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/IXycm/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">abstractmcmc.jl:77</span>
 [17] <span class="ansi-bold">macro expansion</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/AbstractMCMC/FSyVk/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">sample.jl:0</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [18] <span class="ansi-bold">macro expansion</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/AbstractMCMC/FSyVk/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">logging.jl:16</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [19] <span class="ansi-bold">mcmcsample</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">rng</span>::TaskLocalRNG, <span class="ansi-bright-black-fg">model</span>::DynamicPPL.Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}</span>, <span class="ansi-bright-black-fg">sampler</span>::DynamicPPL.Sampler<span class="ansi-bright-black-fg">{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}</span>, <span class="ansi-bright-black-fg">N</span>::Int64; <span class="ansi-bright-black-fg">progress</span>::Bool, <span class="ansi-bright-black-fg">progressname</span>::String, <span class="ansi-bright-black-fg">callback</span>::Nothing, <span class="ansi-bright-black-fg">num_warmup</span>::Int64, <span class="ansi-bright-black-fg">discard_initial</span>::Int64, <span class="ansi-bright-black-fg">thinning</span>::Int64, <span class="ansi-bright-black-fg">chain_type</span>::Type, <span class="ansi-bright-black-fg">initial_state</span>::Nothing, <span class="ansi-bright-black-fg">kwargs</span>::@Kwargs<span class="ansi-bright-black-fg">{}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-yellow-fg">AbstractMCMC</span> <span class="ansi-bright-black-fg">~/.julia/packages/AbstractMCMC/FSyVk/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">sample.jl:142</span>
 [20] <span class="ansi-bold">sample</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">rng</span>::TaskLocalRNG, <span class="ansi-bright-black-fg">model</span>::DynamicPPL.Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}</span>, <span class="ansi-bright-black-fg">sampler</span>::DynamicPPL.Sampler<span class="ansi-bright-black-fg">{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}</span>, <span class="ansi-bright-black-fg">N</span>::Int64; <span class="ansi-bright-black-fg">chain_type</span>::Type, <span class="ansi-bright-black-fg">resume_from</span>::Nothing, <span class="ansi-bright-black-fg">initial_state</span>::Nothing, <span class="ansi-bright-black-fg">kwargs</span>::@Kwargs<span class="ansi-bright-black-fg">{progress::Bool}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-cyan-fg">DynamicPPL</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/DxBhI/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">sampler.jl:102</span>
 [21] <span class="ansi-bold">sample</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/DxBhI/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">sampler.jl:92</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [22] <span class="ansi-bold">#sample#8</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/IXycm/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">Inference.jl:278</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [23] <span class="ansi-bold">sample</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/IXycm/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">Inference.jl:269</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [24] <span class="ansi-bold">#sample#7</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/IXycm/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">Inference.jl:266</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [25] top-level scope
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/work/docs/docs/developers/inference/implementing-samplers/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">index.qmd:459</span></pre>
</div>
</div>
</div>
<p>As expected, we run into a <code>DomainError</code> at some point, while if we set <code>unconstrained=true</code>, letting Turing.jl transform the model to a unconstrained form behind the scenes, everything works as expected:</p>
<div id="52" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 2.08 seconds
Compute duration  = 2.08 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters  </span><span class="ansi-bold">    mean  </span><span class="ansi-bold">     std  </span><span class="ansi-bold">    mcse  </span><span class="ansi-bold"> ess_bulk  </span><span class="ansi-bold"> ess_tail  </span><span class="ansi-bold">    rhat  </span><span class="ansi-bold"> e ⋯
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">  Float64  </span><span class="ansi-bright-black-fg ansi-bold">  Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">   ⋯

          σ²    0.8534    0.5934    0.0371   209.8437   160.6509    1.0060     ⋯
           x   -0.1545    1.0528    0.0730   398.2880   178.0707    1.0006     ⋯
</span><span class="ansi-cyan-fg ansi-bold">                                                                1 column omitted

Quantiles
 </span><span class="ansi-cyan-fg ansi-bold"> parameters  </span><span class="ansi-cyan-fg ansi-bold">    2.5%  </span><span class="ansi-cyan-fg ansi-bold">   25.0%  </span><span class="ansi-cyan-fg ansi-bold">   50.0%  </span><span class="ansi-cyan-fg ansi-bold">   75.0%  </span><span class="ansi-cyan-fg ansi-bold">   97.5%
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64

          σ²    0.1476    0.3735    0.7409    1.1989    2.2863
           x   -2.7273   -0.4337   -0.0560    0.3241    1.8155
</span></pre>
</div>
</div>
</div>
<p>Neat!</p>
<p>Similarly, which automatic differentiation backend one should use can be specified through the <code>adtype</code> keyword argument too. For example, if we want to use <a href="https://github.com/JuliaDiff/ReverseDiff.jl">ReverseDiff.jl</a> instead of the default <a href="https://github.com/JuliaDiff/ForwardDiff.jl">ForwardDiff.jl</a>:</p>
<div id="54" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">ReverseDiff</span>: ReverseDiff</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify that we want to use `AutoReverseDiff`.</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">demo</span>(),</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>, adtype<span class="op">=</span><span class="fu">AutoReverseDiff</span>()),</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>;</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 2.93 seconds
Compute duration  = 2.93 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters  </span><span class="ansi-bold">    mean  </span><span class="ansi-bold">     std  </span><span class="ansi-bold">    mcse  </span><span class="ansi-bold"> ess_bulk  </span><span class="ansi-bold"> ess_tail  </span><span class="ansi-bold">    rhat  </span><span class="ansi-bold"> e ⋯
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">  Float64  </span><span class="ansi-bright-black-fg ansi-bold">  Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">   ⋯

          σ²    0.9347    0.5811    0.0229   620.9905   485.3093    1.0056     ⋯
           x    0.1423    1.0354    0.0573   412.5476   274.8354    1.0009     ⋯
</span><span class="ansi-cyan-fg ansi-bold">                                                                1 column omitted

Quantiles
 </span><span class="ansi-cyan-fg ansi-bold"> parameters  </span><span class="ansi-cyan-fg ansi-bold">    2.5%  </span><span class="ansi-cyan-fg ansi-bold">   25.0%  </span><span class="ansi-cyan-fg ansi-bold">   50.0%  </span><span class="ansi-cyan-fg ansi-bold">   75.0%  </span><span class="ansi-cyan-fg ansi-bold">   97.5%
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64

          σ²    0.1682    0.4838    0.8136    1.2688    2.3296
           x   -1.8749   -0.4277    0.0568    0.6031    2.5377
</span></pre>
</div>
</div>
</div>
<p>Double-neat.</p>
</section>
</section>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<p>At this point it’s worth maybe reminding ourselves what we did and also <em>why</em> we did it:</p>
<ol type="1">
<li>We define our models in the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface because it makes the sampler agnostic to how the underlying model is implemented.</li>
<li>We implement our sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> interface, which just means that our sampler is a subtype of <code>AbstractMCMC.AbstractSampler</code> and we implement the MCMC transition in <code>AbstractMCMC.step</code>.</li>
<li>Points 1 and 2 makes it so our sampler can be used with a wide range of model implementations, amongst them being models implemented in both Turing.jl and Stan. This gives you, the inference implementer, a large collection of models to test your inference method on, in addition to allowing users of Turing.jl and Stan to try out your inference method with minimal effort.</li>
</ol>


</section>


<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a><div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>We’re going with the leapfrog formulation because in a future version of this tutorial we’ll add a section extending this simple “baseline” MALA sampler to more complex versions. See <a href="https://github.com/TuringLang/docs/issues/479">issue #479</a> for progress on this.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>There is no such thing as a proper interface in Julia (at least not officially), and so we use the word “interface” here to mean a few minimal methods that needs to be implemented by any type that we treat as a target model.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    // Ensure there is a toggle, if there isn't float one in the top right
    if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
      const a = window.document.createElement('a');
      a.classList.add('top-right');
      a.classList.add('quarto-color-scheme-toggle');
      a.href = "";
      a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
      const i = window.document.createElement("i");
      i.classList.add('bi');
      a.appendChild(i);
      window.document.body.appendChild(a);
    }
    setColorSchemeToggle(hasAlternateSentinel())
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/turinglang\.org\/docs\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../../developers/inference/variational-inference/index.html" class="pagination-link" aria-label="Variational Inference">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Variational Inference</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Turing is created by <a href="http://mlg.eng.cam.ac.uk/hong/" target="_blank">Hong Ge</a>, and lovingly maintained by the <a href="https://github.com/TuringLang/Turing.jl/graphs/contributors" target="_blank">core team</a> of volunteers. <br> The contents of this website are © 2024 under the terms of the <a href="https://github.com/TuringLang/Turing.jl/blob/main/LICENCE" target="_blank">MIT License</a>.</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/TuringLang/docs/edit/main/developers/inference/implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/docs/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://x.com/TuringLang">
      <i class="bi bi-twitter" role="img" aria-label="Turing Twitter">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/TuringLang/Turing.jl">
      <i class="bi bi-github" role="img" aria-label="Turing GitHub">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




<script src="../../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>