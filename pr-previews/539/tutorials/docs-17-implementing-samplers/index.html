<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Implementing samplers – Turing.jl</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../tutorials/docs-07-for-developers-variational-inference/index.html" rel="prev">
<link href="../../assets/favicon.ico" rel="icon">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-2486e1f0a3ee9ee1fc393803a1361cdb.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark-6561bbde787c299e21493071c8edc6ff.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-67f38b0742f9bce76ffb8d9491dae701.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<style>
  a {
    text-decoration: none;
  }
  a:hover {
    text-decoration: underline;
  }
</style>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../theming/styles.css">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="https://turinglang.org/" class="navbar-brand navbar-brand-logo">
    <img src="../../assets/images/turing-logo.svg" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="https://turinglang.org/">
    <span class="navbar-title">Turing.jl</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../tutorials/docs-00-getting-started/"> 
<span class="menu-text">Get Started</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../tutorials/00-introduction/"> 
<span class="menu-text">Tutorials</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/library/"> 
<span class="menu-text">Libraries</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/news/"> 
<span class="menu-text">News</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/team/"> 
<span class="menu-text">Team</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-v0.34" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">v0.34</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-v0.34">    
        <li>
    <a class="dropdown-item" href="https://turinglang.org/docs/changelog.html">
 <span class="dropdown-text">Changelog</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://turinglang.org/docs/versions.html">
 <span class="dropdown-text">All Versions</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools tools-wide">
    <a href="https://x.com/TuringLang" title="Turing Twitter" class="quarto-navigation-tool px-1" aria-label="Turing Twitter"><i class="bi bi-twitter"></i></a>
    <a href="https://github.com/TuringLang/Turing.jl" title="Turing GitHub" class="quarto-navigation-tool px-1" aria-label="Turing GitHub"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Developers</li><li class="breadcrumb-item"><a href="../../tutorials/docs-06-for-developers-interface/index.html">Inference (note: outdated)</a></li><li class="breadcrumb-item"><a href="../../tutorials/docs-17-implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false">
 <span class="menu-text">Users</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-00-getting-started/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Getting Started</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-12-using-turing-guide/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Core Functionality</span></a>
  </div>
</li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false">
 <span class="menu-text">Usage Tips</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-10-using-turing-autodiff/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Automatic Differentiation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/usage-custom-distribution/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Custom Distributions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/usage-probability-interface/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Querying Model Probabilities</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/usage-modifying-logprob/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Modifying the Log Probability</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/usage-generated-quantities/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Generated Quantities</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-17-mode-estimation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Mode Estimation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-13-using-turing-performance-tips/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Performance Tips</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-15-using-turing-sampler-viz/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Sampler Visualization</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-11-using-turing-dynamichmc/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using DynamicHMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-16-using-turing-external-samplers/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using External Samplers</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false">
 <span class="menu-text">Tutorials</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/00-introduction/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction: Coin Flipping</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/01-gaussian-mixture-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Mixture Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/02-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/03-bayesian-neural-network/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Neural Networks</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/04-hidden-markov-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Hidden Markov Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/05-linear-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Linear Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/06-infinite-mixture-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Infinite Mixture Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/07-poisson-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Poisson Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/08-multinomial-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Multinomial Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/09-variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/10-bayesian-differential-equations/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Differential Equations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/11-probabilistic-pca/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Probabilistic PCA</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/13-seasonal-time-series/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Time Series Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/15-gaussian-processes/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction to Gaussian Processes</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/12-gplvm/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Process Latent Variable Models</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Developers</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false">
 <span class="menu-text">Contributing</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-01-contributing-guide/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">How to Contribute</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="false">
 <span class="menu-text">DynamicPPL in Depth</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/dev-model-manual/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Manually Defining a Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-05-for-developers-compiler/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Turing Compiler Design</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/14-minituring/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation I: Compiler</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/16-contexts/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation II: Contexts</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true">
 <span class="menu-text">Inference (note: outdated)</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-06-for-developers-interface/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Interface Guide</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-04-for-developers-abstractmcmc-turing/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">How Turing implements AbstractMCMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-07-for-developers-variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-17-implementing-samplers/index.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Implementing Samplers</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of Contents</h2>
   
  <ul>
  <li><a href="#quick-overview-of-mala" id="toc-quick-overview-of-mala" class="nav-link active" data-scroll-target="#quick-overview-of-mala">Quick overview of MALA</a></li>
  <li><a href="#what-we-need-from-a-model-logdensityproblems.jl" id="toc-what-we-need-from-a-model-logdensityproblems.jl" class="nav-link" data-scroll-target="#what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: LogDensityProblems.jl</a></li>
  <li><a href="#implementing-mala-in-abstractmcmc.jl" id="toc-implementing-mala-in-abstractmcmc.jl" class="nav-link" data-scroll-target="#implementing-mala-in-abstractmcmc.jl">Implementing MALA in AbstractMCMC.jl</a></li>
  <li><a href="#using-our-sampler-with-turing.jl" id="toc-using-our-sampler-with-turing.jl" class="nav-link" data-scroll-target="#using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</a>
  <ul class="collapse">
  <li><a href="#models-with-constrained-parameters" id="toc-models-with-constrained-parameters" class="nav-link" data-scroll-target="#models-with-constrained-parameters">Models with constrained parameters</a></li>
  </ul></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/TuringLang/docs/edit/master/tutorials/docs-17-implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/docs/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Developers</li><li class="breadcrumb-item"><a href="../../tutorials/docs-06-for-developers-interface/index.html">Inference (note: outdated)</a></li><li class="breadcrumb-item"><a href="../../tutorials/docs-17-implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Implementing samplers</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>In this tutorial, we’ll go through step-by-step how to implement a “simple” sampler in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> in such a way that it can be easily applied to Turing.jl models.</p>
<p>In particular, we’re going to implement a version of <strong>Metropolis-adjusted Langevin (MALA)</strong>.</p>
<p>Note that we will implement this sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> framework, completely “ignoring” Turing.jl until the very end of the tutorial, at which point we’ll use a single line of code to make the resulting sampler available to Turing.jl. This is to really drive home the point that one can implement samplers in a way that is accessible to all of Turing.jl’s users without having to use Turing.jl yourself.</p>
<section id="quick-overview-of-mala" class="level2">
<h2 class="anchored" data-anchor-id="quick-overview-of-mala">Quick overview of MALA</h2>
<p>We can view MALA as a single step of the leapfrog intergrator with resampling of momentum <span class="math inline">\(p\)</span> at every step.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> To make that statement a bit more concrete, we first define the <em>extended</em> target <span class="math inline">\(\bar{\gamma}(x, p)\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\log \bar{\gamma}(x, p) \propto \log \gamma(x) + \log \gamma_{\mathcal{N}(0, M)}(p)
\end{equation*}\]</span></p>
<p>where <span class="math inline">\(\gamma_{\mathcal{N}(0, M)}\)</span> denotes the density for a zero-centered Gaussian with covariance matrix <span class="math inline">\(M\)</span>. We then consider targeting this joint distribution over both <span class="math inline">\(x\)</span> and <span class="math inline">\(p\)</span> as follows. First we define the map</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  L_{\epsilon}: \quad &amp; \mathbb{R}^d \times \mathbb{R}^d \to \mathbb{R}^d \times \mathbb{R}^d \\
  &amp; (x, p) \mapsto (\tilde{x}, \tilde{p}) := L_{\epsilon}(x, p)
\end{split}
\end{equation*}\]</span></p>
<p>as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p_{1 / 2} &amp;:= p + \frac{\epsilon}{2} \nabla \log \gamma(x) \\
  \tilde{x} &amp;:= x + \epsilon M^{-1} p_{1 /2 } \\
  p_1 &amp;:= p_{1 / 2} + \frac{\epsilon}{2} \nabla \log \gamma(\tilde{x}) \\
  \tilde{p} &amp;:= - p_1
\end{split}
\end{equation*}\]</span></p>
<p>This might be familiar for some readers as a single step of the Leapfrog integrator. We then define the MALA kernel as follows: given the current iterate <span class="math inline">\(x_i\)</span>, we sample the next iterate <span class="math inline">\(x_{i + 1}\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p &amp;\sim \mathcal{N}(0, M) \\
  (\tilde{x}, \tilde{p}) &amp;:= L_{\epsilon}(x_i, p) \\
  \alpha &amp;:= \min \left\{ 1, \frac{\bar{\gamma}(\tilde{x}, \tilde{p})}{\bar{\gamma}(x_i, p)} \right\} \\
  x_{i + 1} &amp;:=
  \begin{cases}
    \tilde{x} \quad &amp; \text{ with prob. } \alpha \\
    x_i       \quad &amp; \text{ with prob. } 1 - \alpha
  \end{cases}
\end{split}
\end{equation*}\]</span></p>
<p>i.e.&nbsp;we accept the proposal <span class="math inline">\(\tilde{x}\)</span> with probability <span class="math inline">\(\alpha\)</span> and reject it, thus sticking with our current iterate, with probability <span class="math inline">\(1 - \alpha\)</span>.</p>
</section>
<section id="what-we-need-from-a-model-logdensityproblems.jl" class="level2">
<h2 class="anchored" data-anchor-id="what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a></h2>
<p>There are a few things we need from the “target” / “model” / density that we want to sample from:</p>
<ol type="1">
<li>We need access to log-density <em>evaluations</em> <span class="math inline">\(\log \gamma(x)\)</span> so we can compute the acceptance ratio involving <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>We need access to log-density <em>gradients</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span> so we can compute the Leapfrog steps <span class="math inline">\(L_{\epsilon}(x, p)\)</span>.</li>
<li>We also need access to the “size” of the model so we can determine the size of <span class="math inline">\(M\)</span>.</li>
</ol>
<p>Luckily for us, there is a package called <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> which provides an interface for <em>exactly</em> this!</p>
<p>To demonstrate how one can implement the “<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface”<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> we will use a simple Gaussian model as an example:</p>
<div id="4" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblems</span>: LogDensityProblems;</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's define some type that represents the model.</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> IsotropicNormalModel{M<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"mean of the isotropic Gaussian"</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    mean<span class="op">::</span><span class="dt">M</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Specifies what input length the model expects.</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">dimension</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> <span class="fu">length</span>(model.mean)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Implementation of the log-density evaluation of the model.</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x<span class="op">::</span><span class="dt">AbstractVector{&lt;:Real}</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">-</span> <span class="fu">sum</span>(abs2, x <span class="op">.-</span> model.mean) <span class="op">/</span> <span class="fl">2</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This gives us all of the properties we want for our MALA sampler with the exception of the computation of the <em>gradient</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span>. There is the method <code>LogDensityProblems.logdensity_and_gradient</code> which should return a 2-tuple where the first entry is the evaluation of the logdensity <span class="math inline">\(\log \gamma(x)\)</span> and the second entry is the gradient <span class="math inline">\(\nabla \log \gamma(x)\)</span>.</p>
<p>There are two ways to “implement” this method: 1) we implement it by hand, which is feasible in the case of our <code>IsotropicNormalModel</code>, or b) we defer the implementation of this to a automatic differentiation backend.</p>
<p>To implement it by hand we can simply do</p>
<div id="6" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl that first-order, i.e. gradient information, is available.</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{1}</span>()</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Implement `logdensity_and_gradient`.</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    logγ_x <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="op">-</span>x <span class="op">.*</span> (x <span class="op">-</span> model.mean)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> logγ_x, ∇logγ_x</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s just try it out:</p>
<div id="8" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate the problem.</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> <span class="fu">IsotropicNormalModel</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.])</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create some example input that we can test on.</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>x_example <span class="op">=</span> <span class="fu">randn</span>(LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate!</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-23.908899040770677</code></pre>
</div>
</div>
<p>To defer it to an automatic differentiation backend, we can do</p>
<div id="10" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl we only have access to 0-th order information.</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{0}</span>()</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Use `LogDensityProblemsAD`'s `ADgradient` in combination with some AD backend to implement `logdensity_and_gradient`.</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblemsAD</span>, <span class="bu">ADTypes</span>, <span class="bu">ForwardDiff</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>model_with_grad <span class="op">=</span> <span class="fu">ADgradient</span>(<span class="fu">AutoForwardDiff</span>(), model)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model_with_grad, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-23.908899040770677</code></pre>
</div>
</div>
<p>We’ll continue with the second approach in this tutorial since this is typically what one does in practice, because there are better hobbies to spend time on than deriving gradients by hand.</p>
<p>At this point, one might wonder how we’re going to tie this back to Turing.jl in the end. Effectively, when working with inference methods that only require log-density evaluations and / or higher-order information of the log-density, Turing.jl actually converts the user-provided <code>Model</code> into an object implementing the above methods for <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>. As a result, most samplers provided by Turing.jl are actually implemented to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, enabling their use both <em>within</em> Turing.jl and <em>outside</em> of Turing.jl! Morever, there exists similar conversions for Stan through BridgeStan and Stan<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, which means that a sampler supporting the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface can easily be used on both Turing.jl <em>and</em> Stan models (in addition to user-provided models, as our <code>IsotropicNormalModel</code> above)!</p>
<p>Anyways, let’s move on to actually implementing the sampler.</p>
</section>
<section id="implementing-mala-in-abstractmcmc.jl" class="level2">
<h2 class="anchored" data-anchor-id="implementing-mala-in-abstractmcmc.jl">Implementing MALA in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a></h2>
<p>Now that we’ve established that a model implementing the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface provides us with all the information we need from <span class="math inline">\(\log \gamma(x)\)</span>, we can address the question: given an object that implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, how can we define a sampler for it?</p>
<p>We’re going to do this by making our sampler a sub-type of <code>AbstractMCMC.AbstractSampler</code> in addition to implementing a few methods from <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>. Why? Because it gets us <em>a lot</em> of functionality for free, as we will see later.</p>
<p>Moreover, <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> provides a very natural interface for MCMC algorithms.</p>
<p>First, we’ll define our <code>MALA</code> type</p>
<div id="12" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">AbstractMCMC</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALA{T,A} <span class="op">&lt;:</span><span class="dt"> AbstractMCMC.AbstractSampler</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"stepsize used in the leapfrog step"</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    ϵ_init<span class="op">::</span><span class="dt">T</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"covariance matrix used for the momentum"</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    M_init<span class="op">::</span><span class="dt">A</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notice how we’ve added the suffix <code>_init</code> to both the stepsize and the covariance matrix. We’ve done this because a <code>AbstractMCMC.AbstractSampler</code> should be <em>immutable</em>. Of course there might be many scenarios where we want to allow something like the stepsize and / or the covariance matrix to vary between iterations, e.g.&nbsp;during the burn-in / adaptation phase of the sampling process we might want to adjust the parameters using statistics computed from these initial iterations. But information which can change between iterations <em>should not go in the sampler itself</em>! Instead, this information should go in the sampler <em>state</em>.</p>
<p>The sampler state should at the very least contain all the necessary information to perform the next MCMC iteration, but usually contains further information, e.g.&nbsp;quantities and statistics useful for evaluating whether the sampler has converged.</p>
<p>We will use the following sampler state for our <code>MALA</code> sampler:</p>
<div id="14" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALAState{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This might seem overly redundant: we’re defining a type <code>MALAState</code> and it only contains a simple vector of reals. In this particular case we indeed could have dropped this and simply used a <code>AbstractVector{&lt;:Real}</code> as our sampler state, but typically, as we will see later, one wants to include other quantities in the sampler state. For example, if we also wanted to adapt the parameters of our <code>MALA</code>, e.g.&nbsp;alter the stepsize depending on acceptance rates, in which case we should also put <code>ϵ</code> in the state, but for now we’ll keep things simple.</p>
<p>Moreover, we also want a <em>sample</em> type, which is a type meant for “public consumption”, i.e.&nbsp;the end-user. This is generally going to contain a subset of the information present in the state. But in such a simple scenario as this, we similarly only have a <code>AbstractVector{&lt;:Real}</code>:</p>
<div id="16" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALASample{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We currently have three things:</p>
<ol type="1">
<li>A <code>AbstractMCMC.AbstractSampler</code> implementation called <code>MALA</code>.</li>
<li>A state <code>MALAState</code> for our sampler <code>MALA</code>.</li>
<li>A sample <code>MALASample</code> for our sampler <code>MALA</code>.</li>
</ol>
<p>That means that we’re ready to implement the only thing that really matters: <code>AbstractMCMC.step</code>.</p>
<p><code>AbstractMCMC.step</code> defines the MCMC iteration of our <code>MALA</code> given the current <code>MALAState</code>. Specifically, the signature of the function is as follows:</p>
<div id="18" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The RNG to ensure reproducibility.</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The model that defines our target.</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.AbstractModel</span>,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The sampler for which we're taking a `step`.</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">AbstractMCMC.AbstractSampler</span>,</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The current sampler `state`.</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    state;</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Additional keyword arguments that we may or may not need.</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Moreover, there is a specific <code>AbstractMCMC.AbstractModel</code> which is used to indicate that the model that is provided implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface: <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Since, as we discussed earlier, in our case we’re indeed going to work with types that support the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, we’ll define <code>AbstractMCMC.step</code> for such a <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Note that <code>AbstractMCMC.LogDensityModel</code> has no other purpose; it has a single field called <code>logdensity</code>, and it does nothing else. But by wrapping the model in <code>AbstractMCMC.LogDensityModel</code>, it allows samplers that want to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> to define their <code>AbstractMCMC.step</code> on this type without running into method ambiguities.</p>
<p>All in all, that means that the signature for our <code>AbstractMCMC.step</code> is going to be the following:</p>
<div id="20" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># `LogDensityModel` so we know we're working with LogDensityProblems.jl model.</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler.</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler state.</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Great! Now let’s actually implement the full <code>AbstractMCMC.step</code> for our <code>MALA</code>.</p>
<p>Let’s remind ourselves what we’re going to do:</p>
<ol type="1">
<li>Sample a new momentum <span class="math inline">\(p\)</span>.</li>
<li>Compute the log-density of the extended target <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>Take a single leapfrog step <span class="math inline">\((\tilde{x}, \tilde{p}) = L_{\epsilon}(x, p)\)</span>.</li>
<li>Accept or reject the proposed <span class="math inline">\((\tilde{x}, \tilde{p})\)</span>.</li>
</ol>
<p>All in all, this results in the following:</p>
<div id="22" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>: Random</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Distributions</span>  <span class="co"># so we get the `MvNormal`</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the wrapped model which implements LogDensityProblems.jl.</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just extract the sampler parameters to make our lives easier.</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    ϵ <span class="op">=</span> sampler.ϵ_init</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    M <span class="op">=</span> sampler.M_init</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the current parameters.</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> state.x</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sample the momentum.</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>    p_dist <span class="op">=</span> <span class="fu">MvNormal</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)), M)</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> <span class="fu">rand</span>(rng, p_dist)</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Propose using a single leapfrog step.</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>    x̃, p̃ <span class="op">=</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Accept or reject proposal.</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>    logp <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p)</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>    logp̃ <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x̃) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p̃)</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>    logα <span class="op">=</span> logp̃ <span class="op">-</span> logp</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>    state_new <span class="op">=</span> <span class="cf">if</span> <span class="fu">log</span>(<span class="fu">rand</span>(rng)) <span class="op">&lt;</span> logα</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Accept.</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x̃)</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Reject.</span></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x)</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return the "sample" and the sampler state.</span></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(state_new.x), state_new</span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Fairly straight-forward.</p>
<p>Of course, we haven’t defined the <code>leapfrog_step</code> method yet, so let’s do that:</p>
<div id="24" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p` using "position" `x`.</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x))</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    p1 <span class="op">=</span> p <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update the "position" `x` using momentum `p1`.</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    x̃ <span class="op">=</span> x <span class="op">+</span> ϵ <span class="op">.*</span> (M <span class="op">\</span> p1)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p1` using position `x̃`</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x̃ <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x̃))</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    p2 <span class="op">=</span> p1 <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x̃</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Flip momentum `p2`.</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    p̃ <span class="op">=</span> <span class="op">-</span>p2</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x̃, p̃</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>leapfrog_step (generic function with 1 method)</code></pre>
</div>
</div>
<p>With all of this, we’re technically ready to sample!</p>
<div id="26" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>, <span class="bu">LinearAlgebra</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>rng <span class="op">=</span> <span class="bu">Random</span>.<span class="fu">default_rng</span>()</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>sampler <span class="op">=</span> <span class="fu">MALA</span>(<span class="fl">1</span>, I)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>state <span class="op">=</span> <span class="fu">MALAState</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)))</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>x_next, state_next <span class="op">=</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    rng,</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    AbstractMCMC.<span class="fu">LogDensityModel</span>(model),</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    state</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>(MALASample{Vector{Float64}}([0.1835331049260048, 0.09496587045636812, 1.0012267647978366]), MALAState{Vector{Float64}}([0.1835331049260048, 0.09496587045636812, 1.0012267647978366]))</code></pre>
</div>
</div>
<p>Great, it works!</p>
<p>And I promised we would get quite some functionality for free if we implemented <code>AbstractMCMC.step</code>, and so we can now simply call <code>sample</code> to perform standard MCMC sampling:</p>
<div id="28" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform 1000 iterations with our `MALA` sampler.</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; initial_state<span class="op">=</span>state, progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Concatenate into a matrix.</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000 Matrix{Float64}:
 -2.33476   -3.54744  -4.06973  -5.72327   …  -4.81853  -4.81853  -6.46369
 -0.147487  -1.08901  -0.50335   0.636943     -1.61726  -1.61726  -2.41686
  2.18793    2.41145   3.42993   4.5782        6.33627   6.33627   6.68833</code></pre>
</div>
</div>
<div id="30" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the marginal means and standard deviations.</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -5.01228     1.00281
  0.00810034  1.00689
  5.00415     1.00494</code></pre>
</div>
</div>
<p>Let’s visualize the samples</p>
<div id="32" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">StatsPlots</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">transpose</span>(samples_matrix[<span class="op">:</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">:</span><span class="kw">end</span>]), alpha<span class="op">=</span><span class="fl">0.5</span>, legend<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<!--?xml version="1.0" encoding="utf-8"?-->
<svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" width="672" height="480" viewbox="0 0 2688 1920">
<defs>
  <clippath id="clip200">
    <rect x="0" y="0" width="2688" height="1920"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip200)" d="M0 1920 L2688 1920 L2688 0 L0 0  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip201">
    <rect x="537" y="0" width="1883" height="1883"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip200)" d="M196.816 1800.78 L2640.76 1800.78 L2640.76 47.2441 L196.816 47.2441  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip202">
    <rect x="196" y="47" width="2445" height="1755"></rect>
  </clippath>
</defs>
<polyline clip-path="url(#clip202)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="263.676,1800.78 263.676,47.2441 "></polyline>
<polyline clip-path="url(#clip202)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="840.654,1800.78 840.654,47.2441 "></polyline>
<polyline clip-path="url(#clip202)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1417.63,1800.78 1417.63,47.2441 "></polyline>
<polyline clip-path="url(#clip202)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1994.61,1800.78 1994.61,47.2441 "></polyline>
<polyline clip-path="url(#clip202)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="2571.59,1800.78 2571.59,47.2441 "></polyline>
<polyline clip-path="url(#clip202)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,1644.76 2640.76,1644.76 "></polyline>
<polyline clip-path="url(#clip202)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,1395.62 2640.76,1395.62 "></polyline>
<polyline clip-path="url(#clip202)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,1146.48 2640.76,1146.48 "></polyline>
<polyline clip-path="url(#clip202)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,897.341 2640.76,897.341 "></polyline>
<polyline clip-path="url(#clip202)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,648.203 2640.76,648.203 "></polyline>
<polyline clip-path="url(#clip202)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,399.065 2640.76,399.065 "></polyline>
<polyline clip-path="url(#clip202)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,149.927 2640.76,149.927 "></polyline>
<polyline clip-path="url(#clip200)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1800.78 2640.76,1800.78 "></polyline>
<polyline clip-path="url(#clip200)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="263.676,1800.78 263.676,1781.88 "></polyline>
<polyline clip-path="url(#clip200)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="840.654,1800.78 840.654,1781.88 "></polyline>
<polyline clip-path="url(#clip200)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1417.63,1800.78 1417.63,1781.88 "></polyline>
<polyline clip-path="url(#clip200)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1994.61,1800.78 1994.61,1781.88 "></polyline>
<polyline clip-path="url(#clip200)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="2571.59,1800.78 2571.59,1781.88 "></polyline>
<path clip-path="url(#clip200)" d="M263.676 1834 Q260.065 1834 258.236 1837.57 Q256.431 1841.11 256.431 1848.24 Q256.431 1855.34 258.236 1858.91 Q260.065 1862.45 263.676 1862.45 Q267.31 1862.45 269.116 1858.91 Q270.945 1855.34 270.945 1848.24 Q270.945 1841.11 269.116 1837.57 Q267.31 1834 263.676 1834 M263.676 1830.3 Q269.486 1830.3 272.542 1834.9 Q275.621 1839.49 275.621 1848.24 Q275.621 1856.96 272.542 1861.57 Q269.486 1866.15 263.676 1866.15 Q257.866 1866.15 254.787 1861.57 Q251.732 1856.96 251.732 1848.24 Q251.732 1839.49 254.787 1834.9 Q257.866 1830.3 263.676 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip200)" d="M804.346 1861.55 L820.666 1861.55 L820.666 1865.48 L798.721 1865.48 L798.721 1861.55 Q801.383 1858.79 805.967 1854.16 Q810.573 1849.51 811.754 1848.17 Q813.999 1845.65 814.879 1843.91 Q815.782 1842.15 815.782 1840.46 Q815.782 1837.71 813.837 1835.97 Q811.916 1834.23 808.814 1834.23 Q806.615 1834.23 804.161 1835 Q801.731 1835.76 798.953 1837.31 L798.953 1832.59 Q801.777 1831.46 804.231 1830.88 Q806.684 1830.3 808.721 1830.3 Q814.092 1830.3 817.286 1832.98 Q820.481 1835.67 820.481 1840.16 Q820.481 1842.29 819.67 1844.21 Q818.883 1846.11 816.777 1848.7 Q816.198 1849.37 813.096 1852.59 Q809.995 1855.78 804.346 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip200)" d="M830.527 1830.92 L848.883 1830.92 L848.883 1834.86 L834.809 1834.86 L834.809 1843.33 Q835.828 1842.98 836.846 1842.82 Q837.865 1842.64 838.883 1842.64 Q844.67 1842.64 848.05 1845.81 Q851.43 1848.98 851.43 1854.4 Q851.43 1859.97 847.957 1863.08 Q844.485 1866.15 838.166 1866.15 Q835.99 1866.15 833.721 1865.78 Q831.476 1865.41 829.069 1864.67 L829.069 1859.97 Q831.152 1861.11 833.374 1861.66 Q835.596 1862.22 838.073 1862.22 Q842.078 1862.22 844.416 1860.11 Q846.754 1858.01 846.754 1854.4 Q846.754 1850.78 844.416 1848.68 Q842.078 1846.57 838.073 1846.57 Q836.198 1846.57 834.323 1846.99 Q832.471 1847.4 830.527 1848.28 L830.527 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip200)" d="M870.642 1834 Q867.031 1834 865.203 1837.57 Q863.397 1841.11 863.397 1848.24 Q863.397 1855.34 865.203 1858.91 Q867.031 1862.45 870.642 1862.45 Q874.277 1862.45 876.082 1858.91 Q877.911 1855.34 877.911 1848.24 Q877.911 1841.11 876.082 1837.57 Q874.277 1834 870.642 1834 M870.642 1830.3 Q876.453 1830.3 879.508 1834.9 Q882.587 1839.49 882.587 1848.24 Q882.587 1856.96 879.508 1861.57 Q876.453 1866.15 870.642 1866.15 Q864.832 1866.15 861.754 1861.57 Q858.698 1856.96 858.698 1848.24 Q858.698 1839.49 861.754 1834.9 Q864.832 1830.3 870.642 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip200)" d="M1377.25 1830.92 L1395.61 1830.92 L1395.61 1834.86 L1381.53 1834.86 L1381.53 1843.33 Q1382.55 1842.98 1383.57 1842.82 Q1384.59 1842.64 1385.61 1842.64 Q1391.39 1842.64 1394.77 1845.81 Q1398.15 1848.98 1398.15 1854.4 Q1398.15 1859.97 1394.68 1863.08 Q1391.21 1866.15 1384.89 1866.15 Q1382.71 1866.15 1380.44 1865.78 Q1378.2 1865.41 1375.79 1864.67 L1375.79 1859.97 Q1377.88 1861.11 1380.1 1861.66 Q1382.32 1862.22 1384.8 1862.22 Q1388.8 1862.22 1391.14 1860.11 Q1393.48 1858.01 1393.48 1854.4 Q1393.48 1850.78 1391.14 1848.68 Q1388.8 1846.57 1384.8 1846.57 Q1382.92 1846.57 1381.05 1846.99 Q1379.19 1847.4 1377.25 1848.28 L1377.25 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip200)" d="M1417.37 1834 Q1413.75 1834 1411.93 1837.57 Q1410.12 1841.11 1410.12 1848.24 Q1410.12 1855.34 1411.93 1858.91 Q1413.75 1862.45 1417.37 1862.45 Q1421 1862.45 1422.81 1858.91 Q1424.63 1855.34 1424.63 1848.24 Q1424.63 1841.11 1422.81 1837.57 Q1421 1834 1417.37 1834 M1417.37 1830.3 Q1423.18 1830.3 1426.23 1834.9 Q1429.31 1839.49 1429.31 1848.24 Q1429.31 1856.96 1426.23 1861.57 Q1423.18 1866.15 1417.37 1866.15 Q1411.56 1866.15 1408.48 1861.57 Q1405.42 1856.96 1405.42 1848.24 Q1405.42 1839.49 1408.48 1834.9 Q1411.56 1830.3 1417.37 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip200)" d="M1447.53 1834 Q1443.92 1834 1442.09 1837.57 Q1440.28 1841.11 1440.28 1848.24 Q1440.28 1855.34 1442.09 1858.91 Q1443.92 1862.45 1447.53 1862.45 Q1451.16 1862.45 1452.97 1858.91 Q1454.8 1855.34 1454.8 1848.24 Q1454.8 1841.11 1452.97 1837.57 Q1451.16 1834 1447.53 1834 M1447.53 1830.3 Q1453.34 1830.3 1456.39 1834.9 Q1459.47 1839.49 1459.47 1848.24 Q1459.47 1856.96 1456.39 1861.57 Q1453.34 1866.15 1447.53 1866.15 Q1441.72 1866.15 1438.64 1861.57 Q1435.58 1856.96 1435.58 1848.24 Q1435.58 1839.49 1438.64 1834.9 Q1441.72 1830.3 1447.53 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip200)" d="M1952.89 1830.92 L1975.11 1830.92 L1975.11 1832.91 L1962.56 1865.48 L1957.68 1865.48 L1969.48 1834.86 L1952.89 1834.86 L1952.89 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip200)" d="M1984.27 1830.92 L2002.63 1830.92 L2002.63 1834.86 L1988.56 1834.86 L1988.56 1843.33 Q1989.58 1842.98 1990.59 1842.82 Q1991.61 1842.64 1992.63 1842.64 Q1998.42 1842.64 2001.8 1845.81 Q2005.18 1848.98 2005.18 1854.4 Q2005.18 1859.97 2001.7 1863.08 Q1998.23 1866.15 1991.91 1866.15 Q1989.74 1866.15 1987.47 1865.78 Q1985.22 1865.41 1982.82 1864.67 L1982.82 1859.97 Q1984.9 1861.11 1987.12 1861.66 Q1989.34 1862.22 1991.82 1862.22 Q1995.83 1862.22 1998.16 1860.11 Q2000.5 1858.01 2000.5 1854.4 Q2000.5 1850.78 1998.16 1848.68 Q1995.83 1846.57 1991.82 1846.57 Q1989.95 1846.57 1988.07 1846.99 Q1986.22 1847.4 1984.27 1848.28 L1984.27 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip200)" d="M2024.39 1834 Q2020.78 1834 2018.95 1837.57 Q2017.14 1841.11 2017.14 1848.24 Q2017.14 1855.34 2018.95 1858.91 Q2020.78 1862.45 2024.39 1862.45 Q2028.02 1862.45 2029.83 1858.91 Q2031.66 1855.34 2031.66 1848.24 Q2031.66 1841.11 2029.83 1837.57 Q2028.02 1834 2024.39 1834 M2024.39 1830.3 Q2030.2 1830.3 2033.26 1834.9 Q2036.33 1839.49 2036.33 1848.24 Q2036.33 1856.96 2033.26 1861.57 Q2030.2 1866.15 2024.39 1866.15 Q2018.58 1866.15 2015.5 1861.57 Q2012.45 1856.96 2012.45 1848.24 Q2012.45 1839.49 2015.5 1834.9 Q2018.58 1830.3 2024.39 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip200)" d="M2516.11 1861.55 L2523.75 1861.55 L2523.75 1835.18 L2515.44 1836.85 L2515.44 1832.59 L2523.71 1830.92 L2528.38 1830.92 L2528.38 1861.55 L2536.02 1861.55 L2536.02 1865.48 L2516.11 1865.48 L2516.11 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip200)" d="M2555.47 1834 Q2551.85 1834 2550.03 1837.57 Q2548.22 1841.11 2548.22 1848.24 Q2548.22 1855.34 2550.03 1858.91 Q2551.85 1862.45 2555.47 1862.45 Q2559.1 1862.45 2560.9 1858.91 Q2562.73 1855.34 2562.73 1848.24 Q2562.73 1841.11 2560.9 1837.57 Q2559.1 1834 2555.47 1834 M2555.47 1830.3 Q2561.28 1830.3 2564.33 1834.9 Q2567.41 1839.49 2567.41 1848.24 Q2567.41 1856.96 2564.33 1861.57 Q2561.28 1866.15 2555.47 1866.15 Q2549.66 1866.15 2546.58 1861.57 Q2543.52 1856.96 2543.52 1848.24 Q2543.52 1839.49 2546.58 1834.9 Q2549.66 1830.3 2555.47 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip200)" d="M2585.63 1834 Q2582.02 1834 2580.19 1837.57 Q2578.38 1841.11 2578.38 1848.24 Q2578.38 1855.34 2580.19 1858.91 Q2582.02 1862.45 2585.63 1862.45 Q2589.26 1862.45 2591.07 1858.91 Q2592.9 1855.34 2592.9 1848.24 Q2592.9 1841.11 2591.07 1837.57 Q2589.26 1834 2585.63 1834 M2585.63 1830.3 Q2591.44 1830.3 2594.49 1834.9 Q2597.57 1839.49 2597.57 1848.24 Q2597.57 1856.96 2594.49 1861.57 Q2591.44 1866.15 2585.63 1866.15 Q2579.82 1866.15 2576.74 1861.57 Q2573.68 1856.96 2573.68 1848.24 Q2573.68 1839.49 2576.74 1834.9 Q2579.82 1830.3 2585.63 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip200)" d="M2615.79 1834 Q2612.18 1834 2610.35 1837.57 Q2608.54 1841.11 2608.54 1848.24 Q2608.54 1855.34 2610.35 1858.91 Q2612.18 1862.45 2615.79 1862.45 Q2619.42 1862.45 2621.23 1858.91 Q2623.06 1855.34 2623.06 1848.24 Q2623.06 1841.11 2621.23 1837.57 Q2619.42 1834 2615.79 1834 M2615.79 1830.3 Q2621.6 1830.3 2624.65 1834.9 Q2627.73 1839.49 2627.73 1848.24 Q2627.73 1856.96 2624.65 1861.57 Q2621.6 1866.15 2615.79 1866.15 Q2609.98 1866.15 2606.9 1861.57 Q2603.84 1856.96 2603.84 1848.24 Q2603.84 1839.49 2606.9 1834.9 Q2609.98 1830.3 2615.79 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip200)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1800.78 196.816,47.2441 "></polyline>
<polyline clip-path="url(#clip200)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1644.76 215.714,1644.76 "></polyline>
<polyline clip-path="url(#clip200)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1395.62 215.714,1395.62 "></polyline>
<polyline clip-path="url(#clip200)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1146.48 215.714,1146.48 "></polyline>
<polyline clip-path="url(#clip200)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,897.341 215.714,897.341 "></polyline>
<polyline clip-path="url(#clip200)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,648.203 215.714,648.203 "></polyline>
<polyline clip-path="url(#clip200)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,399.065 215.714,399.065 "></polyline>
<polyline clip-path="url(#clip200)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,149.927 215.714,149.927 "></polyline>
<path clip-path="url(#clip200)" d="M50.5475 1645.21 L80.2233 1645.21 L80.2233 1649.14 L50.5475 1649.14 L50.5475 1645.21 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip200)" d="M89.1352 1627.48 L111.357 1627.48 L111.357 1629.47 L98.8111 1662.04 L93.9269 1662.04 L105.732 1631.41 L89.1352 1631.41 L89.1352 1627.48 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip200)" d="M120.478 1656.16 L125.362 1656.16 L125.362 1662.04 L120.478 1662.04 L120.478 1656.16 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip200)" d="M135.593 1627.48 L153.95 1627.48 L153.95 1631.41 L139.876 1631.41 L139.876 1639.88 Q140.894 1639.54 141.913 1639.37 Q142.931 1639.19 143.95 1639.19 Q149.737 1639.19 153.116 1642.36 Q156.496 1645.53 156.496 1650.95 Q156.496 1656.53 153.024 1659.63 Q149.552 1662.71 143.232 1662.71 Q141.056 1662.71 138.788 1662.34 Q136.542 1661.97 134.135 1661.23 L134.135 1656.53 Q136.218 1657.66 138.441 1658.22 Q140.663 1658.77 143.14 1658.77 Q147.144 1658.77 149.482 1656.66 Q151.82 1654.56 151.82 1650.95 Q151.82 1647.34 149.482 1645.23 Q147.144 1643.12 143.14 1643.12 Q141.265 1643.12 139.39 1643.54 Q137.538 1643.96 135.593 1644.84 L135.593 1627.48 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip200)" d="M49.5521 1396.07 L79.2279 1396.07 L79.2279 1400 L49.5521 1400 L49.5521 1396.07 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip200)" d="M89.3667 1378.34 L107.723 1378.34 L107.723 1382.27 L93.6491 1382.27 L93.6491 1390.74 Q94.6676 1390.4 95.6861 1390.24 Q96.7047 1390.05 97.7232 1390.05 Q103.51 1390.05 106.89 1393.22 Q110.269 1396.39 110.269 1401.81 Q110.269 1407.39 106.797 1410.49 Q103.325 1413.57 97.0056 1413.57 Q94.8297 1413.57 92.5612 1413.2 Q90.3158 1412.83 87.9084 1412.09 L87.9084 1407.39 Q89.9917 1408.52 92.2139 1409.08 Q94.4361 1409.63 96.913 1409.63 Q100.918 1409.63 103.256 1407.53 Q105.593 1405.42 105.593 1401.81 Q105.593 1398.2 103.256 1396.09 Q100.918 1393.99 96.913 1393.99 Q95.038 1393.99 93.163 1394.4 Q91.3112 1394.82 89.3667 1395.7 L89.3667 1378.34 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip200)" d="M119.482 1407.02 L124.367 1407.02 L124.367 1412.9 L119.482 1412.9 L119.482 1407.02 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip200)" d="M144.552 1381.42 Q140.941 1381.42 139.112 1384.98 Q137.306 1388.52 137.306 1395.65 Q137.306 1402.76 139.112 1406.32 Q140.941 1409.86 144.552 1409.86 Q148.186 1409.86 149.991 1406.32 Q151.82 1402.76 151.82 1395.65 Q151.82 1388.52 149.991 1384.98 Q148.186 1381.42 144.552 1381.42 M144.552 1377.71 Q150.362 1377.71 153.417 1382.32 Q156.496 1386.9 156.496 1395.65 Q156.496 1404.38 153.417 1408.99 Q150.362 1413.57 144.552 1413.57 Q138.741 1413.57 135.663 1408.99 Q132.607 1404.38 132.607 1395.65 Q132.607 1386.9 135.663 1382.32 Q138.741 1377.71 144.552 1377.71 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip200)" d="M50.5475 1146.93 L80.2233 1146.93 L80.2233 1150.87 L50.5475 1150.87 L50.5475 1146.93 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip200)" d="M94.3436 1159.82 L110.663 1159.82 L110.663 1163.76 L88.7186 1163.76 L88.7186 1159.82 Q91.3806 1157.07 95.9639 1152.44 Q100.57 1147.79 101.751 1146.44 Q103.996 1143.92 104.876 1142.19 Q105.779 1140.43 105.779 1138.74 Q105.779 1135.98 103.834 1134.25 Q101.913 1132.51 98.8111 1132.51 Q96.6121 1132.51 94.1584 1133.27 Q91.7278 1134.04 88.9501 1135.59 L88.9501 1130.87 Q91.7741 1129.73 94.2278 1129.15 Q96.6815 1128.57 98.7185 1128.57 Q104.089 1128.57 107.283 1131.26 Q110.478 1133.94 110.478 1138.44 Q110.478 1140.56 109.668 1142.49 Q108.881 1144.38 106.774 1146.98 Q106.195 1147.65 103.094 1150.87 Q99.9917 1154.06 94.3436 1159.82 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip200)" d="M120.478 1157.88 L125.362 1157.88 L125.362 1163.76 L120.478 1163.76 L120.478 1157.88 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip200)" d="M135.593 1129.2 L153.95 1129.2 L153.95 1133.13 L139.876 1133.13 L139.876 1141.61 Q140.894 1141.26 141.913 1141.1 Q142.931 1140.91 143.95 1140.91 Q149.737 1140.91 153.116 1144.08 Q156.496 1147.25 156.496 1152.67 Q156.496 1158.25 153.024 1161.35 Q149.552 1164.43 143.232 1164.43 Q141.056 1164.43 138.788 1164.06 Q136.542 1163.69 134.135 1162.95 L134.135 1158.25 Q136.218 1159.38 138.441 1159.94 Q140.663 1160.5 143.14 1160.5 Q147.144 1160.5 149.482 1158.39 Q151.82 1156.28 151.82 1152.67 Q151.82 1149.06 149.482 1146.95 Q147.144 1144.85 143.14 1144.85 Q141.265 1144.85 139.39 1145.26 Q137.538 1145.68 135.593 1146.56 L135.593 1129.2 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip200)" d="M99.3204 883.14 Q95.7093 883.14 93.8806 886.705 Q92.075 890.246 92.075 897.376 Q92.075 904.482 93.8806 908.047 Q95.7093 911.589 99.3204 911.589 Q102.955 911.589 104.76 908.047 Q106.589 904.482 106.589 897.376 Q106.589 890.246 104.76 886.705 Q102.955 883.14 99.3204 883.14 M99.3204 879.436 Q105.131 879.436 108.186 884.043 Q111.265 888.626 111.265 897.376 Q111.265 906.103 108.186 910.709 Q105.131 915.292 99.3204 915.292 Q93.5102 915.292 90.4315 910.709 Q87.376 906.103 87.376 897.376 Q87.376 888.626 90.4315 884.043 Q93.5102 879.436 99.3204 879.436 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip200)" d="M119.482 908.742 L124.367 908.742 L124.367 914.621 L119.482 914.621 L119.482 908.742 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip200)" d="M144.552 883.14 Q140.941 883.14 139.112 886.705 Q137.306 890.246 137.306 897.376 Q137.306 904.482 139.112 908.047 Q140.941 911.589 144.552 911.589 Q148.186 911.589 149.991 908.047 Q151.82 904.482 151.82 897.376 Q151.82 890.246 149.991 886.705 Q148.186 883.14 144.552 883.14 M144.552 879.436 Q150.362 879.436 153.417 884.043 Q156.496 888.626 156.496 897.376 Q156.496 906.103 153.417 910.709 Q150.362 915.292 144.552 915.292 Q138.741 915.292 135.663 910.709 Q132.607 906.103 132.607 897.376 Q132.607 888.626 135.663 884.043 Q138.741 879.436 144.552 879.436 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip200)" d="M94.3436 661.548 L110.663 661.548 L110.663 665.483 L88.7186 665.483 L88.7186 661.548 Q91.3806 658.793 95.9639 654.164 Q100.57 649.511 101.751 648.168 Q103.996 645.645 104.876 643.909 Q105.779 642.15 105.779 640.46 Q105.779 637.706 103.834 635.969 Q101.913 634.233 98.8111 634.233 Q96.6121 634.233 94.1584 634.997 Q91.7278 635.761 88.9501 637.312 L88.9501 632.59 Q91.7741 631.456 94.2278 630.877 Q96.6815 630.298 98.7185 630.298 Q104.089 630.298 107.283 632.983 Q110.478 635.669 110.478 640.159 Q110.478 642.289 109.668 644.21 Q108.881 646.108 106.774 648.701 Q106.195 649.372 103.094 652.59 Q99.9917 655.784 94.3436 661.548 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip200)" d="M120.478 659.604 L125.362 659.604 L125.362 665.483 L120.478 665.483 L120.478 659.604 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip200)" d="M135.593 630.923 L153.95 630.923 L153.95 634.858 L139.876 634.858 L139.876 643.331 Q140.894 642.983 141.913 642.821 Q142.931 642.636 143.95 642.636 Q149.737 642.636 153.116 645.807 Q156.496 648.979 156.496 654.395 Q156.496 659.974 153.024 663.076 Q149.552 666.154 143.232 666.154 Q141.056 666.154 138.788 665.784 Q136.542 665.414 134.135 664.673 L134.135 659.974 Q136.218 661.108 138.441 661.664 Q140.663 662.219 143.14 662.219 Q147.144 662.219 149.482 660.113 Q151.82 658.006 151.82 654.395 Q151.82 650.784 149.482 648.678 Q147.144 646.571 143.14 646.571 Q141.265 646.571 139.39 646.988 Q137.538 647.405 135.593 648.284 L135.593 630.923 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip200)" d="M89.3667 381.785 L107.723 381.785 L107.723 385.72 L93.6491 385.72 L93.6491 394.192 Q94.6676 393.845 95.6861 393.683 Q96.7047 393.498 97.7232 393.498 Q103.51 393.498 106.89 396.669 Q110.269 399.841 110.269 405.257 Q110.269 410.836 106.797 413.938 Q103.325 417.016 97.0056 417.016 Q94.8297 417.016 92.5612 416.646 Q90.3158 416.276 87.9084 415.535 L87.9084 410.836 Q89.9917 411.97 92.2139 412.526 Q94.4361 413.081 96.913 413.081 Q100.918 413.081 103.256 410.975 Q105.593 408.868 105.593 405.257 Q105.593 401.646 103.256 399.54 Q100.918 397.433 96.913 397.433 Q95.038 397.433 93.163 397.85 Q91.3112 398.267 89.3667 399.146 L89.3667 381.785 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip200)" d="M119.482 410.466 L124.367 410.466 L124.367 416.345 L119.482 416.345 L119.482 410.466 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip200)" d="M144.552 384.864 Q140.941 384.864 139.112 388.429 Q137.306 391.97 137.306 399.1 Q137.306 406.206 139.112 409.771 Q140.941 413.313 144.552 413.313 Q148.186 413.313 149.991 409.771 Q151.82 406.206 151.82 399.1 Q151.82 391.97 149.991 388.429 Q148.186 384.864 144.552 384.864 M144.552 381.16 Q150.362 381.16 153.417 385.767 Q156.496 390.35 156.496 399.1 Q156.496 407.827 153.417 412.433 Q150.362 417.016 144.552 417.016 Q138.741 417.016 135.663 412.433 Q132.607 407.827 132.607 399.1 Q132.607 390.35 135.663 385.767 Q138.741 381.16 144.552 381.16 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip200)" d="M89.1352 132.647 L111.357 132.647 L111.357 134.638 L98.8111 167.207 L93.9269 167.207 L105.732 136.582 L89.1352 136.582 L89.1352 132.647 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip200)" d="M120.478 161.327 L125.362 161.327 L125.362 167.207 L120.478 167.207 L120.478 161.327 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip200)" d="M135.593 132.647 L153.95 132.647 L153.95 136.582 L139.876 136.582 L139.876 145.054 Q140.894 144.707 141.913 144.545 Q142.931 144.36 143.95 144.36 Q149.737 144.36 153.116 147.531 Q156.496 150.703 156.496 156.119 Q156.496 161.698 153.024 164.8 Q149.552 167.878 143.232 167.878 Q141.056 167.878 138.788 167.508 Q136.542 167.138 134.135 166.397 L134.135 161.698 Q136.218 162.832 138.441 163.388 Q140.663 163.943 143.14 163.943 Q147.144 163.943 149.482 161.837 Q151.82 159.73 151.82 156.119 Q151.82 152.508 149.482 150.402 Q147.144 148.295 143.14 148.295 Q141.265 148.295 139.39 148.712 Q137.538 149.128 135.593 150.008 L135.593 132.647 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip202)" style="stroke:#009af9; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="265.984,1130.01 268.292,1316.09 270.6,1307.78 272.908,1313.18 275.216,1457.43 277.524,1475.49 279.832,1346.79 282.139,1280.86 284.447,1470.18 286.755,1329.21 289.063,1304.49 291.371,1353.62 293.679,1409.78 295.987,1336.16 298.295,1385.87 300.603,1511.49 302.911,1466.31 305.219,1423.97 307.527,1096.9 309.834,1300.96 312.142,1415.18 314.45,1474.24 316.758,1526.27 319.066,1328.73 321.374,1406.71 323.682,1416.59 325.99,1462.94 328.298,1399.76 330.606,1479.94 332.914,1349.29 335.221,1454.36 337.529,1601.85 339.837,1400.43 342.145,1362.89 344.453,1413.43 346.761,1448.4 349.069,1403.23 351.377,1411.86 353.685,1350.56 355.993,1320.98 358.301,1486.78 360.608,1340.84 362.916,1468.82 365.224,1135.96 367.532,1619.54 369.84,1308.48 372.148,1334.86 374.456,1424.95 376.764,1387.44 379.072,1231.3 381.38,1506.07 383.688,1438.91 385.996,1347.99 388.303,1292.78 390.611,1385.98 392.919,1384.42 395.227,1471.77 397.535,1379.76 399.843,1664.52 402.151,1411.98 404.459,1383.04 406.767,1443.26 409.075,1470.62 411.383,1306.88 413.69,1338.22 415.998,1376.16 418.306,1446.1 420.614,1532.27 422.922,1526.86 425.23,1403.79 427.538,1443.05 429.846,1528.81 432.154,1417.23 434.462,1429.76 436.77,1229.31 439.077,1459.79 441.385,1233.29 443.693,1162.89 446.001,1427.49 448.309,1542.57 450.617,1287.41 452.925,1362.37 455.233,1375.63 457.541,1536.65 459.849,1565.96 462.157,1348.16 464.465,1343.89 466.772,1356.19 469.08,1246 471.388,1471.18 473.696,1407.23 476.004,1419.96 478.312,1401.68 480.62,1399.07 482.928,1416.28 485.236,1381.99 487.544,1751.15 489.852,1550.67 492.159,1305.86 494.467,1340.87 496.775,1549.73 499.083,1443.21 501.391,1514.87 503.699,1431.83 506.007,1443.26 508.315,1454.93 510.623,1473.3 512.931,1239.63 515.239,1443.69 517.546,1522.06 519.854,1552.45 522.162,1301.5 524.47,1630.3 526.778,1358.5 529.086,1263.43 531.394,1575.33 533.702,1359.38 536.01,1239.6 538.318,1364.99 540.626,1342.69 542.933,1291.14 545.241,1402.02 547.549,1392.56 549.857,1471.96 552.165,1401.21 554.473,1334.55 556.781,1344.83 559.089,1542.76 561.397,1327.81 563.705,1340.97 566.013,1485.89 568.321,1449.16 570.628,1310.49 572.936,1505.98 575.244,1466.14 577.552,1421.51 579.86,1328.4 582.168,1349.21 584.476,1549.4 586.784,1497.03 589.092,1437.06 591.4,1165.09 593.708,1449.36 596.015,1332.43 598.323,1316.05 600.631,1529.32 602.939,1481.82 605.247,1301.45 607.555,1302.3 609.863,1479.72 612.171,1454.23 614.479,1482.22 616.787,1418.76 619.095,1431.1 621.402,1406.81 623.71,1217.08 626.018,1352.53 628.326,1262.34 630.634,1413.48 632.942,1340.62 635.25,1384.27 637.558,1304.63 639.866,1293.5 642.174,1396.77 644.482,1442.04 646.79,1462.14 649.097,1432.38 651.405,1500.06 653.713,1385.36 656.021,1466.43 658.329,1299.03 660.637,1171.58 662.945,1623.05 665.253,1579.04 667.561,1551.66 669.869,1452.38 672.177,1596.24 674.484,1413.39 676.792,1458.78 679.1,1533.88 681.408,1529.79 683.716,1341.47 686.024,1279.69 688.332,1400.04 690.64,1354.41 692.948,1469.28 695.256,1111.14 697.564,1491.03 699.871,1372.05 702.179,1411.07 704.487,1487.23 706.795,1284.78 709.103,1525.73 711.411,1621.55 713.719,1353.16 716.027,1414.94 718.335,1481.33 720.643,1468.65 722.951,1291.67 725.259,1354.37 727.566,1442.43 729.874,1461.71 732.182,1334.14 734.49,1326.03 736.798,1387.4 739.106,1296.3 741.414,1296.89 743.722,1202.73 746.03,1221.6 748.338,1376.18 750.646,1307.34 752.953,1489.77 755.261,1492.97 757.569,1528.41 759.877,1517.41 762.185,1521.23 764.493,1215.16 766.801,1545.69 769.109,1320.96 771.417,1242.98 773.725,1211.9 776.033,1373.26 778.34,1382.43 780.648,1334.39 782.956,1545.3 785.264,1457.13 787.572,1268.44 789.88,1439.78 792.188,1375.99 794.496,1298.18 796.804,1453.05 799.112,1267.64 801.42,1464.02 803.728,1573.67 806.035,1170.88 808.343,1314.79 810.651,1385.63 812.959,1299.18 815.267,1299.59 817.575,1385.07 819.883,1268.6 822.191,1343.89 824.499,1264.14 826.807,1206.13 829.115,1328.34 831.422,1339.33 833.73,1335.29 836.038,1384.61 838.346,1445.36 840.654,1275 842.962,1353.22 845.27,1277.54 847.578,1324.01 849.886,1360.45 852.194,1615.63 854.502,1419.56 856.809,1218.8 859.117,1369.28 861.425,1332.83 863.733,1409.49 866.041,1617.53 868.349,1374.6 870.657,1376.88 872.965,1412.33 875.273,1315.76 877.581,1622.93 879.889,1346.9 882.197,1595.29 884.504,1519.02 886.812,1378.33 889.12,1342.32 891.428,1373.91 893.736,1383.43 896.044,1264.08 898.352,1209.1 900.66,1421.69 902.968,1149.18 905.276,1383.84 907.584,1506.03 909.891,1345.6 912.199,1256.87 914.507,1441.88 916.815,1303.73 919.123,1327.8 921.431,1429.19 923.739,1353.41 926.047,1393.5 928.355,1389.43 930.663,1445.9 932.971,1367.65 935.278,1520.16 937.586,1375.64 939.894,1272.42 942.202,1474.47 944.51,1280.02 946.818,1443.06 949.126,1508.54 951.434,1267.84 953.742,1297.49 956.05,1492.17 958.358,1288.62 960.665,1519.51 962.973,1282.74 965.281,1347.61 967.589,1385.7 969.897,1396.12 972.205,1303.32 974.513,1233.06 976.821,1353.63 979.129,1419.95 981.437,1342.85 983.745,1511.95 986.053,1363.58 988.36,1340.11 990.668,1445.38 992.976,1473.78 995.284,1315.97 997.592,1456.22 999.9,1360.13 1002.21,1543.52 1004.52,1551.43 1006.82,1362.65 1009.13,1268.84 1011.44,1354.59 1013.75,1408.21 1016.06,1434.06 1018.36,1411.59 1020.67,1307.22 1022.98,1300.13 1025.29,1444.85 1027.59,1465.89 1029.9,1486.46 1032.21,1506.79 1034.52,1474.05 1036.83,1439.11 1039.13,1277.46 1041.44,1444.19 1043.75,1236.67 1046.06,1410.94 1048.37,1411.2 1050.67,1483.18 1052.98,1310 1055.29,1538.74 1057.6,1394.39 1059.91,1427.31 1062.21,1376.44 1064.52,1432.45 1066.83,1415.78 1069.14,1501.32 1071.45,1356.89 1073.75,1560.98 1076.06,1658.42 1078.37,1347.33 1080.68,1206 1082.98,1342.28 1085.29,1508.87 1087.6,1558.33 1089.91,1265.25 1092.22,1273.46 1094.52,1343.57 1096.83,1416.82 1099.14,1396.93 1101.45,1554.25 1103.76,1339.66 1106.06,1262.34 1108.37,1367.38 1110.68,1580.61 1112.99,1355.87 1115.3,1455.19 1117.6,1454.06 1119.91,1478.24 1122.22,1292.32 1124.53,1485.41 1126.84,1520.41 1129.14,1489.63 1131.45,1435.33 1133.76,1397.89 1136.07,1163.29 1138.37,1472.22 1140.68,1512.82 1142.99,1474.99 1145.3,1438.8 1147.61,1387.78 1149.91,1303.96 1152.22,1355.42 1154.53,1329.66 1156.84,1407.21 1159.15,1515.23 1161.45,1296.04 1163.76,1393.5 1166.07,1527.06 1168.38,1321.83 1170.69,1296.71 1172.99,1083.25 1175.3,1381.3 1177.61,1344.34 1179.92,1459.83 1182.23,1241.56 1184.53,1399.89 1186.84,1364.78 1189.15,1400.83 1191.46,1505.5 1193.76,1257.08 1196.07,1349.27 1198.38,1487.84 1200.69,1311.53 1203,1474.18 1205.3,1266.1 1207.61,1285.64 1209.92,1329.65 1212.23,1548.64 1214.54,1580.68 1216.84,1572.31 1219.15,1263.04 1221.46,1500.27 1223.77,1207.27 1226.08,1401.31 1228.38,1454.92 1230.69,1278.02 1233,1389.99 1235.31,1374.29 1237.61,1356.95 1239.92,1369.15 1242.23,1545.13 1244.54,1400.46 1246.85,1336.75 1249.15,1434.1 1251.46,1383.05 1253.77,1420.91 1256.08,1331.15 1258.39,1488.55 1260.69,1341.57 1263,1486.87 1265.31,1351.8 1267.62,1609.05 1269.93,1218.96 1272.23,1606.61 1274.54,1354.71 1276.85,1513.45 1279.16,1411.76 1281.47,1222.61 1283.77,1320.47 1286.08,1496.5 1288.39,1351.19 1290.7,1344.44 1293,1270.58 1295.31,1227.3 1297.62,1244.61 1299.93,1377.62 1302.24,1444.18 1304.54,1470 1306.85,1435.52 1309.16,1528.2 1311.47,1497.54 1313.78,1430 1316.08,1306.57 1318.39,1575.35 1320.7,1507.74 1323.01,1356.77 1325.32,1378.68 1327.62,1393.26 1329.93,1507.04 1332.24,1461.99 1334.55,1421.71 1336.86,1302.12 1339.16,1401.09 1341.47,1432.85 1343.78,1399.3 1346.09,1373.99 1348.39,1235.66 1350.7,1498.91 1353.01,1354.14 1355.32,1375.87 1357.63,1356.98 1359.93,1572.16 1362.24,1313.62 1364.55,1180.04 1366.86,1563.78 1369.17,1468.24 1371.47,1328.59 1373.78,1478.46 1376.09,1252.07 1378.4,1334.81 1380.71,1380.58 1383.01,1414.12 1385.32,1437.61 1387.63,1444.95 1389.94,1338.78 1392.24,1320.55 1394.55,1336.62 1396.86,1345.5 1399.17,1574.85 1401.48,1234.38 1403.78,1385.3 1406.09,1358.96 1408.4,1393.65 1410.71,1419.64 1413.02,1212.49 1415.32,1338 1417.63,1484.17 1419.94,1434.43 1422.25,1407.48 1424.56,1342.46 1426.86,1375 1429.17,1440.69 1431.48,1438.24 1433.79,1369.82 1436.1,1499.16 1438.4,1258.23 1440.71,1218.05 1443.02,1213.15 1445.33,1390.91 1447.63,1480.62 1449.94,1451.45 1452.25,1481.41 1454.56,1326.69 1456.87,1509.06 1459.17,1339.27 1461.48,1447.48 1463.79,1438.12 1466.1,1350.88 1468.41,1349.82 1470.71,1382.77 1473.02,1471.34 1475.33,1488.02 1477.64,1350.85 1479.95,1431.84 1482.25,1427.65 1484.56,1314.67 1486.87,1479.41 1489.18,1497.7 1491.49,1354.03 1493.79,1337.41 1496.1,1661.27 1498.41,1225.62 1500.72,1294.62 1503.02,1328.47 1505.33,1347.34 1507.64,1292.95 1509.95,1290.28 1512.26,1363.44 1514.56,1459.46 1516.87,1367.71 1519.18,1304.49 1521.49,1617.94 1523.8,1281.77 1526.1,1525.55 1528.41,1569.03 1530.72,1402.76 1533.03,1271.56 1535.34,1411.41 1537.64,1507.16 1539.95,1465.38 1542.26,1531.44 1544.57,1412.3 1546.88,1292.09 1549.18,1627.46 1551.49,1360.48 1553.8,1247.52 1556.11,1437.94 1558.41,1557.29 1560.72,1431.26 1563.03,1398.2 1565.34,1546.13 1567.65,1279.27 1569.95,1327.96 1572.26,1401.87 1574.57,1382.88 1576.88,1369.71 1579.19,1499.77 1581.49,1515.66 1583.8,1512.23 1586.11,1359.83 1588.42,1334.47 1590.73,1407.01 1593.03,1251.02 1595.34,1480.63 1597.65,1297.46 1599.96,1296.49 1602.26,1361.7 1604.57,1465.57 1606.88,1232.34 1609.19,1407.74 1611.5,1358.88 1613.8,1590.09 1616.11,1430.25 1618.42,1458.11 1620.73,1476.12 1623.04,1503.11 1625.34,1381.76 1627.65,1491.56 1629.96,1364.2 1632.27,1496.28 1634.58,1427.57 1636.88,1430.11 1639.19,1496.34 1641.5,1217.77 1643.81,1453.44 1646.12,1261.77 1648.42,1335.69 1650.73,1472.29 1653.04,1518.24 1655.35,1482.63 1657.65,1382.87 1659.96,1312.73 1662.27,1414.11 1664.58,1423.79 1666.89,1391.71 1669.19,1288.58 1671.5,1343.86 1673.81,1316.99 1676.12,1435.21 1678.43,1532.66 1680.73,1414.58 1683.04,1419.26 1685.35,1621.82 1687.66,1362.04 1689.97,1381.07 1692.27,1415.06 1694.58,1343.06 1696.89,1354.59 1699.2,1262.1 1701.51,1327.44 1703.81,1528.24 1706.12,1347.11 1708.43,1230.2 1710.74,1312.01 1713.04,1468.06 1715.35,1414.45 1717.66,1200.65 1719.97,1350.31 1722.28,1347.48 1724.58,1410.21 1726.89,1408.77 1729.2,1427.81 1731.51,1437.11 1733.82,1485.18 1736.12,1423.31 1738.43,1452.66 1740.74,1362.24 1743.05,1321.56 1745.36,1539.59 1747.66,1587.49 1749.97,1386.19 1752.28,1621.9 1754.59,1348.98 1756.9,1445.5 1759.2,1373.32 1761.51,1305.33 1763.82,1659.53 1766.13,1339.2 1768.43,1461.87 1770.74,1523.92 1773.05,1408.39 1775.36,1391.93 1777.67,1534.72 1779.97,1207.82 1782.28,1375.8 1784.59,1557.25 1786.9,1313.97 1789.21,1410.19 1791.51,1541.49 1793.82,1507.15 1796.13,1480.33 1798.44,1313.56 1800.75,1335.6 1803.05,1376.71 1805.36,1494.98 1807.67,1541.73 1809.98,1498.58 1812.28,1325.98 1814.59,1232.75 1816.9,1304.81 1819.21,1432.69 1821.52,1415.64 1823.82,1287.19 1826.13,1491.72 1828.44,1424.83 1830.75,1467.66 1833.06,1083.03 1835.36,1359.88 1837.67,1362.99 1839.98,1291.7 1842.29,1369.48 1844.6,1408.27 1846.9,1342.04 1849.21,1500.69 1851.52,1332.94 1853.83,1327.86 1856.14,1540.71 1858.44,1360.63 1860.75,1254.55 1863.06,1295.72 1865.37,1322.69 1867.67,1418.98 1869.98,1529.54 1872.29,1296.38 1874.6,1491.16 1876.91,1371.34 1879.21,1475.39 1881.52,1331.96 1883.83,1411.79 1886.14,1296.83 1888.45,1366 1890.75,1442.07 1893.06,1436.5 1895.37,1238.5 1897.68,1491.22 1899.99,1428.33 1902.29,1417.37 1904.6,1412.48 1906.91,1431.37 1909.22,1464.31 1911.53,1435.48 1913.83,1415.64 1916.14,1455.86 1918.45,1493.59 1920.76,1475.54 1923.06,1534.52 1925.37,1421.85 1927.68,1390.48 1929.99,1500.24 1932.3,1165.28 1934.6,1365.77 1936.91,1163.76 1939.22,1415.33 1941.53,1521.29 1943.84,1407.86 1946.14,1240.6 1948.45,1076.39 1950.76,1372.91 1953.07,1410.59 1955.38,1325.94 1957.68,1453.45 1959.99,1336.15 1962.3,1227.33 1964.61,1428.02 1966.91,1242.98 1969.22,1436.92 1971.53,1419.89 1973.84,1254.39 1976.15,1565.19 1978.45,1480.5 1980.76,1439 1983.07,1426.15 1985.38,1524.75 1987.69,1394.88 1989.99,1336.05 1992.3,1538.26 1994.61,1472.73 1996.92,1623.62 1999.23,1339.74 2001.53,1607.38 2003.84,1506.33 2006.15,1299.9 2008.46,1481.01 2010.77,1354.78 2013.07,1383.67 2015.38,1368.01 2017.69,1399.32 2020,1327.06 2022.3,1357.76 2024.61,1329.14 2026.92,1411.01 2029.23,1341.71 2031.54,1304.14 2033.84,1443.83 2036.15,1236.86 2038.46,1391.63 2040.77,1235.36 2043.08,1365.26 2045.38,1438.41 2047.69,1397.94 2050,1317.44 2052.31,1260.24 2054.62,1278.65 2056.92,1454.61 2059.23,1389.06 2061.54,1503.29 2063.85,1272.29 2066.16,1338.28 2068.46,1281.76 2070.77,1181.94 2073.08,1487.58 2075.39,1284.87 2077.69,1473.11 2080,1418.79 2082.31,1355.79 2084.62,1380.46 2086.93,1321.8 2089.23,1524.03 2091.54,1445.32 2093.85,1480.9 2096.16,1570.66 2098.47,1221.97 2100.77,1415.27 2103.08,1357.43 2105.39,1469.85 2107.7,1532.44 2110.01,1490.92 2112.31,1474.68 2114.62,1225.9 2116.93,1430.61 2119.24,1390.51 2121.55,1365.18 2123.85,1622.51 2126.16,1342.9 2128.47,1197.72 2130.78,1341.02 2133.08,1282.55 2135.39,1456.01 2137.7,1441.32 2140.01,1398.2 2142.32,1451.3 2144.62,1508.88 2146.93,1349.45 2149.24,1433.47 2151.55,1370.66 2153.86,1634.78 2156.16,1250.73 2158.47,1491.7 2160.78,1357.93 2163.09,1290.87 2165.4,1356.14 2167.7,1386.24 2170.01,1297.72 2172.32,1423.49 2174.63,1400.84 2176.93,1573.84 2179.24,1351.98 2181.55,1427.88 2183.86,1430.14 2186.17,1425.88 2188.47,1339.71 2190.78,1532.83 2193.09,1434.26 2195.4,1425.19 2197.71,1231.98 2200.01,1377.66 2202.32,1322.92 2204.63,1556.37 2206.94,1505.07 2209.25,1261.79 2211.55,1409.39 2213.86,1355.38 2216.17,1368.53 2218.48,1422.1 2220.79,1365.53 2223.09,1496.59 2225.4,1333.15 2227.71,1343.93 2230.02,1504.09 2232.32,1554.53 2234.63,1497.48 2236.94,1380.21 2239.25,1319.79 2241.56,1451.16 2243.86,1365.21 2246.17,1559.91 2248.48,1399.73 2250.79,1419.06 2253.1,1518.06 2255.4,1511.3 2257.71,1243.77 2260.02,1245.76 2262.33,1420.41 2264.64,1271.6 2266.94,1174 2269.25,1552.43 2271.56,1457.79 2273.87,1339.31 2276.18,1358.7 2278.48,1456.46 2280.79,1429.4 2283.1,1465.58 2285.41,1487.52 2287.71,1512.85 2290.02,1355.45 2292.33,1300.74 2294.64,1400.44 2296.95,1291.46 2299.25,1516.05 2301.56,1459 2303.87,1486.23 2306.18,1613.09 2308.49,1372.44 2310.79,1505.09 2313.1,1315.69 2315.41,1338.41 2317.72,1257.91 2320.03,1286.8 2322.33,1406.22 2324.64,1411.39 2326.95,1341.44 2329.26,1342.77 2331.56,1545.02 2333.87,1367.15 2336.18,1293.79 2338.49,1331.59 2340.8,1552.79 2343.1,1382.69 2345.41,1429.85 2347.72,1236.43 2350.03,1389.51 2352.34,1530.01 2354.64,1368.23 2356.95,1227.79 2359.26,1572.6 2361.57,1408.7 2363.88,1363.9 2366.18,1585.06 2368.49,1296.48 2370.8,1529.4 2373.11,1336.98 2375.42,1330.01 2377.72,1521.93 2380.03,1196.86 2382.34,1454.55 2384.65,1612.97 2386.95,1391.13 2389.26,1604.01 2391.57,1571.27 2393.88,1407.77 2396.19,1427.1 2398.49,1368.18 2400.8,1401.21 2403.11,1346.37 2405.42,1378.06 2407.73,1314.15 2410.03,1166.87 2412.34,1410.51 2414.65,1343.77 2416.96,1462.55 2419.27,1388.27 2421.57,1295.52 2423.88,1400.79 2426.19,1501.54 2428.5,1567.79 2430.81,1561.56 2433.11,1320.88 2435.42,1448.71 2437.73,1486.72 2440.04,1461.56 2442.34,1396.64 2444.65,1451.64 2446.96,1587.03 2449.27,1430.51 2451.58,1408.01 2453.88,1432.79 2456.19,1291.16 2458.5,1345.01 2460.81,1311.62 2463.12,1574.12 2465.42,1419.77 2467.73,1338.31 2470.04,1317.73 2472.35,1452.05 2474.66,1493.82 2476.96,1439.68 2479.27,1398.52 2481.58,1442.14 2483.89,1541.81 2486.2,1394.93 2488.5,1440.87 2490.81,1409.96 2493.12,1328.95 2495.43,1344.53 2497.73,1372.11 2500.04,1433.14 2502.35,1385.86 2504.66,1487.07 2506.97,1614.21 2509.27,1350.23 2511.58,1220.83 2513.89,1538.08 2516.2,1317.16 2518.51,1461.92 2520.81,1586.53 2523.12,1521.94 2525.43,1421.07 2527.74,1486.61 2530.05,1545.72 2532.35,1328.09 2534.66,1457.15 2536.97,1391.7 2539.28,1291.19 2541.58,1411.73 2543.89,1510.54 2546.2,1370.64 2548.51,1356.26 2550.82,1413.08 2553.12,1362.87 2555.43,1479.18 2557.74,1315.92 2560.05,1442.9 2562.36,1512.5 2564.66,1229.85 2566.97,1493.65 2569.28,1333.45 2571.59,1263.93 "></polyline>
<polyline clip-path="url(#clip202)" style="stroke:#e26f46; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="265.984,912.039 268.292,847.764 270.6,984.966 272.908,1052.52 275.216,769.429 277.524,923.015 279.832,907.566 282.139,1001.32 284.447,947.082 286.755,796.532 289.063,886.35 291.371,886.781 293.679,965.919 295.987,821.617 298.295,823.684 300.603,996.835 302.911,958.008 305.219,827.201 307.527,891.427 309.834,949.15 312.142,945.798 314.45,929.989 316.758,1001.77 319.066,1024.27 321.374,868.977 323.682,988.395 325.99,892.969 328.298,957.564 330.606,928.471 332.914,1054.86 335.221,953.52 337.529,830.39 339.837,785.021 342.145,786.16 344.453,825.872 346.761,625.288 349.069,978.862 351.377,1045.19 353.685,939.68 355.993,1063.91 358.301,789.81 360.608,816.653 362.916,884.401 365.224,839.492 367.532,795.243 369.84,858.533 372.148,784.094 374.456,881.507 376.764,1005.68 379.072,969.869 381.38,997.414 383.688,954.498 385.996,1003.94 388.303,858.202 390.611,863.807 392.919,825.853 395.227,785.521 397.535,934.855 399.843,937.344 402.151,1075.61 404.459,869.824 406.767,864.638 409.075,862.581 411.383,851.064 413.69,993.799 415.998,697.992 418.306,1120.98 420.614,805.818 422.922,1021.45 425.23,832.403 427.538,805.329 429.846,1031.19 432.154,977.8 434.462,994.427 436.77,864.968 439.077,939.146 441.385,922.908 443.693,800.987 446.001,866.106 448.309,892.175 450.617,776.486 452.925,792.847 455.233,820.603 457.541,959.664 459.849,993.045 462.157,959.754 464.465,777.854 466.772,945.917 469.08,888.161 471.388,850.205 473.696,863.487 476.004,954.438 478.312,995.189 480.62,877.42 482.928,916.767 485.236,874.567 487.544,768.313 489.852,840.611 492.159,900.923 494.467,889.872 496.775,943.679 499.083,920.858 501.391,696.445 503.699,829.035 506.007,806.547 508.315,873.664 510.623,888.523 512.931,890.448 515.239,850.559 517.546,841.374 519.854,1037.66 522.162,874.799 524.47,978.492 526.778,967.676 529.086,850.81 531.394,928.307 533.702,931.294 536.01,748.518 538.318,952.552 540.626,983.055 542.933,941.166 545.241,961.055 547.549,816.854 549.857,871.486 552.165,729.866 554.473,858.079 556.781,1064.37 559.089,803.058 561.397,912.725 563.705,885.006 566.013,767.148 568.321,689.251 570.628,881 572.936,1016.07 575.244,757.12 577.552,904.211 579.86,930.83 582.168,982.566 584.476,722.67 586.784,864.906 589.092,908.955 591.4,1066.86 593.708,889.09 596.015,866.275 598.323,855.578 600.631,1089.09 602.939,859.883 605.247,839.12 607.555,938.371 609.863,849.285 612.171,888.528 614.479,841.42 616.787,1040.94 619.095,839.599 621.402,899.179 623.71,782.231 626.018,809.354 628.326,998.338 630.634,1039.22 632.942,712.917 635.25,850.114 637.558,890.973 639.866,1009.59 642.174,746.846 644.482,902.922 646.79,816.493 649.097,897.427 651.405,862.146 653.713,886.128 656.021,832.407 658.329,837.862 660.637,919.772 662.945,941.945 665.253,879.564 667.561,771.999 669.869,785.46 672.177,841.424 674.484,836.49 676.792,819.839 679.1,988.479 681.408,921.353 683.716,1089.92 686.024,908.392 688.332,912.708 690.64,779.37 692.948,928.874 695.256,1036.48 697.564,875.602 699.871,940.007 702.179,745.498 704.487,904.552 706.795,964.448 709.103,876.133 711.411,835.041 713.719,680.16 716.027,734.504 718.335,1044.77 720.643,865.784 722.951,872.955 725.259,979.115 727.566,830.548 729.874,719.643 732.182,808.116 734.49,804.02 736.798,808.917 739.106,922.519 741.414,878.604 743.722,785.959 746.03,833.496 748.338,1016.51 750.646,821.518 752.953,757.535 755.261,843.81 757.569,913.341 759.877,764.243 762.185,1110.3 764.493,1095.95 766.801,988.171 769.109,668.99 771.417,836.184 773.725,1079.3 776.033,771.44 778.34,987.451 780.648,1142.34 782.956,1017.5 785.264,792.107 787.572,932.497 789.88,1001.71 792.188,835.709 794.496,886.022 796.804,1057.17 799.112,926.908 801.42,790.157 803.728,794.541 806.035,810.177 808.343,863.651 810.651,948.066 812.959,830.422 815.267,927.513 817.575,964.316 819.883,802.714 822.191,712.542 824.499,923.045 826.807,940.197 829.115,789.364 831.422,969.125 833.73,920.468 836.038,980.988 838.346,771.027 840.654,991.877 842.962,903.14 845.27,819.418 847.578,816.342 849.886,1056.87 852.194,882.963 854.502,967.3 856.809,783.603 859.117,921.563 861.425,889.277 863.733,799.141 866.041,804.942 868.349,881.284 870.657,900.862 872.965,724.436 875.273,801.141 877.581,998.713 879.889,659.023 882.197,838.048 884.504,1071.62 886.812,844.463 889.12,1106.7 891.428,1120.73 893.736,1028.15 896.044,807.628 898.352,856.223 900.66,990.545 902.968,1065.63 905.276,867.878 907.584,835.71 909.891,740.162 912.199,693.967 914.507,961.782 916.815,748.03 919.123,866.122 921.431,951.295 923.739,821.296 926.047,877.036 928.355,932.062 930.663,944.413 932.971,798.05 935.278,964.612 937.586,938.6 939.894,1025.93 942.202,951.595 944.51,849.556 946.818,817.538 949.126,743.648 951.434,1004.72 953.742,839.876 956.05,949.531 958.358,943.572 960.665,1022.17 962.973,950.582 965.281,730.956 967.589,1034.55 969.897,751.002 972.205,983.434 974.513,967.037 976.821,1034.67 979.129,839.527 981.437,766.654 983.745,743.915 986.053,961.417 988.36,994.535 990.668,976.229 992.976,831.037 995.284,801.122 997.592,815.347 999.9,973.669 1002.21,1020.11 1004.52,1002.38 1006.82,848.706 1009.13,823.428 1011.44,1009.31 1013.75,953.119 1016.06,913.428 1018.36,1003.32 1020.67,984.563 1022.98,712.948 1025.29,973.537 1027.59,933.932 1029.9,766.907 1032.21,854.678 1034.52,883.116 1036.83,970.104 1039.13,830.805 1041.44,1097.57 1043.75,1142.51 1046.06,829.885 1048.37,819.001 1050.67,827.838 1052.98,926.833 1055.29,903.478 1057.6,1098.68 1059.91,1075.3 1062.21,956.843 1064.52,818.135 1066.83,1111.2 1069.14,830.388 1071.45,1001.09 1073.75,785.717 1076.06,1105.77 1078.37,1000.19 1080.68,853.724 1082.98,865.121 1085.29,1010.57 1087.6,853.246 1089.91,1131.68 1092.22,887.695 1094.52,940.087 1096.83,752.219 1099.14,931.387 1101.45,785.967 1103.76,994.75 1106.06,1008.72 1108.37,1005.77 1110.68,839.909 1112.99,924.092 1115.3,887.984 1117.6,955.756 1119.91,958.574 1122.22,1041.09 1124.53,1176.95 1126.84,823.998 1129.14,869.494 1131.45,844.263 1133.76,1062.08 1136.07,951.276 1138.37,931.184 1140.68,907.582 1142.99,869.311 1145.3,826.952 1147.61,934.004 1149.91,794.058 1152.22,861.93 1154.53,758.614 1156.84,764.087 1159.15,708.969 1161.45,854.501 1163.76,942.758 1166.07,689.198 1168.38,900.978 1170.69,787.371 1172.99,824.066 1175.3,790.357 1177.61,823.216 1179.92,961.978 1182.23,904.304 1184.53,842.499 1186.84,972.289 1189.15,1022.74 1191.46,963.15 1193.76,809.093 1196.07,762.351 1198.38,978.746 1200.69,962.18 1203,755.334 1205.3,842.568 1207.61,882.906 1209.92,848.639 1212.23,1053.9 1214.54,700.157 1216.84,911.079 1219.15,934.498 1221.46,1102.17 1223.77,953.549 1226.08,841.1 1228.38,801.455 1230.69,771.119 1233,963.817 1235.31,789.492 1237.61,891.234 1239.92,944.515 1242.23,712.269 1244.54,987.434 1246.85,856.934 1249.15,901.751 1251.46,847.141 1253.77,955.7 1256.08,903.855 1258.39,653.442 1260.69,1136.77 1263,684.901 1265.31,932.463 1267.62,865.792 1269.93,948.905 1272.23,760.741 1274.54,934.53 1276.85,886.654 1279.16,835.92 1281.47,1043.96 1283.77,830.088 1286.08,798.495 1288.39,963.476 1290.7,1098.16 1293,1021.61 1295.31,883.38 1297.62,943.686 1299.93,855.697 1302.24,897.25 1304.54,855.804 1306.85,942.187 1309.16,898.924 1311.47,949.149 1313.78,903.503 1316.08,810.931 1318.39,873.049 1320.7,935.628 1323.01,862.197 1325.32,1003.86 1327.62,794.65 1329.93,941.324 1332.24,859.89 1334.55,926.645 1336.86,952.282 1339.16,856.556 1341.47,802.765 1343.78,871.162 1346.09,899.03 1348.39,729.795 1350.7,1012.53 1353.01,825.622 1355.32,867.958 1357.63,934.928 1359.93,781.255 1362.24,839.602 1364.55,670.949 1366.86,858.289 1369.17,912.525 1371.47,893.824 1373.78,765.148 1376.09,1015.81 1378.4,708.838 1380.71,936.574 1383.01,1131.06 1385.32,863.055 1387.63,817.5 1389.94,867.383 1392.24,1153.42 1394.55,939.316 1396.86,924.372 1399.17,767.066 1401.48,801.868 1403.78,710.893 1406.09,829.939 1408.4,923.555 1410.71,965.912 1413.02,958.464 1415.32,737.345 1417.63,889.305 1419.94,922.588 1422.25,1019.19 1424.56,839.559 1426.86,829.614 1429.17,936.375 1431.48,989.166 1433.79,932.452 1436.1,838.865 1438.4,909.605 1440.71,998.302 1443.02,701.092 1445.33,835.835 1447.63,779.285 1449.94,901.11 1452.25,1001.65 1454.56,682.434 1456.87,890.235 1459.17,772.108 1461.48,977.491 1463.79,1000.43 1466.1,940.371 1468.41,851.792 1470.71,888.147 1473.02,818.077 1475.33,868.393 1477.64,857.829 1479.95,765.868 1482.25,833.548 1484.56,860.505 1486.87,893.246 1489.18,876.962 1491.49,919.318 1493.79,796.963 1496.1,941.764 1498.41,915.697 1500.72,982.125 1503.02,979.183 1505.33,910.712 1507.64,1009.67 1509.95,973.277 1512.26,837.328 1514.56,911.795 1516.87,796.7 1519.18,918.504 1521.49,1221.08 1523.8,926.613 1526.1,822.646 1528.41,754.583 1530.72,1066.5 1533.03,961.573 1535.34,921.766 1537.64,915.522 1539.95,832.231 1542.26,1143.13 1544.57,790.772 1546.88,819.569 1549.18,956.923 1551.49,1075.92 1553.8,812.07 1556.11,695.924 1558.41,824.141 1560.72,933.063 1563.03,983.822 1565.34,738.274 1567.65,871.131 1569.95,1015.79 1572.26,762.521 1574.57,904.798 1576.88,901.86 1579.19,855.662 1581.49,744.19 1583.8,1165.73 1586.11,793.004 1588.42,792.816 1590.73,884.37 1593.03,907.136 1595.34,790.819 1597.65,1020.83 1599.96,994.296 1602.26,848.55 1604.57,929.016 1606.88,947.681 1609.19,999.423 1611.5,943.37 1613.8,867.385 1616.11,841.526 1618.42,723.302 1620.73,999.494 1623.04,1014.49 1625.34,944.156 1627.65,814.159 1629.96,939.525 1632.27,960.909 1634.58,861.554 1636.88,902.164 1639.19,836.46 1641.5,939.389 1643.81,943.61 1646.12,814.878 1648.42,982.69 1650.73,990.636 1653.04,851.768 1655.35,988.218 1657.65,899.43 1659.96,888.539 1662.27,851.809 1664.58,852.715 1666.89,922.485 1669.19,981.213 1671.5,959.586 1673.81,875.402 1676.12,1010.47 1678.43,852.449 1680.73,872.498 1683.04,867.459 1685.35,858.974 1687.66,867.024 1689.97,879.936 1692.27,850.007 1694.58,1016.77 1696.89,1032.65 1699.2,882.535 1701.51,933.186 1703.81,1122.19 1706.12,706.964 1708.43,886.792 1710.74,817.977 1713.04,893.159 1715.35,874.284 1717.66,871.125 1719.97,917.876 1722.28,775.566 1724.58,962.923 1726.89,1181.25 1729.2,986.259 1731.51,680.396 1733.82,860.853 1736.12,777.98 1738.43,841.95 1740.74,979.568 1743.05,905.23 1745.36,806.441 1747.66,990.48 1749.97,890.85 1752.28,878.25 1754.59,960.593 1756.9,862.808 1759.2,939.39 1761.51,907.325 1763.82,860.033 1766.13,795.46 1768.43,944.754 1770.74,882.091 1773.05,869.692 1775.36,696.441 1777.67,1044.92 1779.97,985.173 1782.28,825.336 1784.59,987.204 1786.9,974.578 1789.21,892.276 1791.51,965.751 1793.82,1096.73 1796.13,961.631 1798.44,953.396 1800.75,798.54 1803.05,914.428 1805.36,980.167 1807.67,747.659 1809.98,830.504 1812.28,957.188 1814.59,756.799 1816.9,1050.64 1819.21,809.127 1821.52,892.171 1823.82,1040.31 1826.13,896.313 1828.44,1010.49 1830.75,940.985 1833.06,948.417 1835.36,926.74 1837.67,867.487 1839.98,918.009 1842.29,759.421 1844.6,948.407 1846.9,902.64 1849.21,994.294 1851.52,900.673 1853.83,936.485 1856.14,862.532 1858.44,977.932 1860.75,890.241 1863.06,1021.14 1865.37,921.898 1867.67,1037.36 1869.98,769.866 1872.29,756.522 1874.6,915.597 1876.91,1028.6 1879.21,752.795 1881.52,983.339 1883.83,929.592 1886.14,778.572 1888.45,863.284 1890.75,1036.39 1893.06,982.231 1895.37,918.234 1897.68,817.443 1899.99,797.987 1902.29,884.547 1904.6,915.765 1906.91,863.171 1909.22,978.232 1911.53,818.068 1913.83,964.454 1916.14,988.334 1918.45,826.889 1920.76,930.332 1923.06,908.304 1925.37,921.233 1927.68,982.776 1929.99,810.945 1932.3,725.949 1934.6,946.468 1936.91,1035.52 1939.22,1038.78 1941.53,990.487 1943.84,1080.81 1946.14,949.904 1948.45,981.847 1950.76,863.373 1953.07,825.581 1955.38,872.265 1957.68,1000.56 1959.99,805.3 1962.3,1146.33 1964.61,979.689 1966.91,851.782 1969.22,834.828 1971.53,875.03 1973.84,807.931 1976.15,786.119 1978.45,931.961 1980.76,887.093 1983.07,751.132 1985.38,809.866 1987.69,939.385 1989.99,835.182 1992.3,869.973 1994.61,902.7 1996.92,1087.9 1999.23,1133.83 2001.53,1049.23 2003.84,942.128 2006.15,1056.5 2008.46,878.667 2010.77,652 2013.07,1028.69 2015.38,949.684 2017.69,897.09 2020,855.392 2022.3,810.784 2024.61,647.629 2026.92,1054.75 2029.23,814.776 2031.54,972.86 2033.84,845.909 2036.15,903.336 2038.46,802.229 2040.77,629.261 2043.08,1137.94 2045.38,793.776 2047.69,900.327 2050,787.146 2052.31,877.945 2054.62,1009.95 2056.92,793.946 2059.23,684.667 2061.54,1036.2 2063.85,920.646 2066.16,1027.43 2068.46,872.423 2070.77,835.452 2073.08,854.272 2075.39,1070.95 2077.69,929.551 2080,874.7 2082.31,917.452 2084.62,634.11 2086.93,1093.61 2089.23,926.411 2091.54,947.361 2093.85,1018.59 2096.16,1010.83 2098.47,964.171 2100.77,617.242 2103.08,980.49 2105.39,822.434 2107.7,799.893 2110.01,1112.5 2112.31,1028.04 2114.62,902.989 2116.93,1104.86 2119.24,964.144 2121.55,874.227 2123.85,964.195 2126.16,989.816 2128.47,797.329 2130.78,887.688 2133.08,1055.62 2135.39,884.95 2137.7,894.492 2140.01,756.742 2142.32,1059.03 2144.62,820.625 2146.93,902.559 2149.24,1019.25 2151.55,867.589 2153.86,972.503 2156.16,1000.18 2158.47,936.03 2160.78,815.801 2163.09,913.351 2165.4,923.685 2167.7,926.284 2170.01,838.917 2172.32,942.146 2174.63,903.397 2176.93,824.269 2179.24,845.875 2181.55,823.041 2183.86,923.704 2186.17,778.45 2188.47,881.568 2190.78,967.316 2193.09,974.279 2195.4,855.327 2197.71,768.216 2200.01,767.744 2202.32,1063.79 2204.63,954.264 2206.94,733.394 2209.25,766.964 2211.55,838.963 2213.86,828.657 2216.17,928.174 2218.48,879.935 2220.79,1025.88 2223.09,1084.91 2225.4,902.304 2227.71,878.072 2230.02,1148.21 2232.32,922.799 2234.63,992.568 2236.94,877.946 2239.25,821.316 2241.56,1098.42 2243.86,731.48 2246.17,846.684 2248.48,1030.12 2250.79,924.602 2253.1,1000.52 2255.4,789.023 2257.71,822.393 2260.02,890.942 2262.33,1087.52 2264.64,874.987 2266.94,816.996 2269.25,701.764 2271.56,926.255 2273.87,1026.66 2276.18,1062.03 2278.48,1007.8 2280.79,974.343 2283.1,1034.19 2285.41,944.222 2287.71,877.166 2290.02,904.952 2292.33,950.153 2294.64,931.081 2296.95,797.959 2299.25,758.323 2301.56,908.703 2303.87,906.636 2306.18,1017.8 2308.49,1014 2310.79,929.909 2313.1,890.033 2315.41,848.922 2317.72,1067.58 2320.03,1036.73 2322.33,710.468 2324.64,972.003 2326.95,852.937 2329.26,941.825 2331.56,969.797 2333.87,866.972 2336.18,984.831 2338.49,897.802 2340.8,1017.59 2343.1,961.49 2345.41,792.931 2347.72,864.183 2350.03,879.036 2352.34,896.031 2354.64,709.757 2356.95,963.335 2359.26,1178.81 2361.57,966.167 2363.88,885.553 2366.18,1032.11 2368.49,1125.18 2370.8,839.428 2373.11,844.958 2375.42,941.79 2377.72,979.214 2380.03,902.206 2382.34,936.91 2384.65,854.08 2386.95,915.799 2389.26,975.841 2391.57,860.722 2393.88,855.279 2396.19,933.015 2398.49,1103.34 2400.8,808.5 2403.11,942.354 2405.42,975.451 2407.73,835.768 2410.03,920.356 2412.34,1047.72 2414.65,732.237 2416.96,841.008 2419.27,1142.49 2421.57,677.141 2423.88,912.71 2426.19,888.155 2428.5,924.81 2430.81,767.17 2433.11,854.5 2435.42,923.887 2437.73,846.277 2440.04,830.014 2442.34,881.226 2444.65,777.906 2446.96,868.898 2449.27,886.189 2451.58,893.305 2453.88,880.976 2456.19,868.46 2458.5,991.029 2460.81,921.92 2463.12,788.807 2465.42,1007.47 2467.73,932.137 2470.04,887.745 2472.35,739.027 2474.66,912.24 2476.96,760.763 2479.27,810.031 2481.58,956.341 2483.89,873.81 2486.2,1001.58 2488.5,840.782 2490.81,856.214 2493.12,1089.89 2495.43,943.926 2497.73,1105.91 2500.04,849.214 2502.35,970.157 2504.66,1061.1 2506.97,903.256 2509.27,961.962 2511.58,907.302 2513.89,799.04 2516.2,1032.3 2518.51,983.569 2520.81,821.545 2523.12,874.81 2525.43,874.345 2527.74,866.556 2530.05,1150.45 2532.35,885.783 2534.66,769.319 2536.97,752.027 2539.28,829.006 2541.58,731.776 2543.89,828.425 2546.2,849.617 2548.51,1197.48 2550.82,766.818 2553.12,953.372 2555.43,905.445 2557.74,926.184 2560.05,865.033 2562.36,751.621 2564.66,808.881 2566.97,947.828 2569.28,841.186 2571.59,959.879 "></polyline>
<polyline clip-path="url(#clip202)" style="stroke:#3da44d; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="265.984,679.303 268.292,465.685 270.6,297.417 272.908,270.054 275.216,345.308 277.524,489.587 279.832,358.646 282.139,484.619 284.447,428.146 286.755,378.022 289.063,341.432 291.371,433.617 293.679,543.295 295.987,370.694 298.295,372.513 300.603,358.792 302.911,348.597 305.219,389.225 307.527,361.3 309.834,364.457 312.142,349.266 314.45,317.152 316.758,559.945 319.066,422.953 321.374,304.746 323.682,452.913 325.99,443.846 328.298,421.238 330.606,425.956 332.914,666.077 335.221,330.744 337.529,341.354 339.837,309.196 342.145,513.875 344.453,494.277 346.761,307.714 349.069,434.441 351.377,498.803 353.685,266.136 355.993,418.113 358.301,399.803 360.608,409.158 362.916,445.465 365.224,385.496 367.532,377.028 369.84,429.482 372.148,356.176 374.456,476.237 376.764,189.007 379.072,296.077 381.38,453.639 383.688,402.481 385.996,456.954 388.303,569.525 390.611,328.483 392.919,251.195 395.227,436.006 397.535,473.166 399.843,205.808 402.151,461.346 404.459,393.378 406.767,495.112 409.075,297.759 411.383,449.05 413.69,414.819 415.998,442.794 418.306,321.192 420.614,418.56 422.922,392.788 425.23,465.156 427.538,488.092 429.846,291.414 432.154,440.661 434.462,483.468 436.77,371.091 439.077,353.22 441.385,350.517 443.693,304.925 446.001,395.266 448.309,456.093 450.617,479.64 452.925,415.52 455.233,532.11 457.541,408.815 459.849,283.999 462.157,397.031 464.465,525.958 466.772,436.944 469.08,483.126 471.388,513.41 473.696,480.279 476.004,507.286 478.312,373.401 480.62,492.416 482.928,563.795 485.236,296.524 487.544,430.262 489.852,289.316 492.159,238.194 494.467,528.373 496.775,322.178 499.083,350.865 501.391,328.748 503.699,362.23 506.007,476.003 508.315,307.044 510.623,292.281 512.931,384.179 515.239,259.806 517.546,467.846 519.854,349.314 522.162,504.596 524.47,494.785 526.778,461.107 529.086,324.323 531.394,393.624 533.702,301.803 536.01,498.181 538.318,345.797 540.626,396.93 542.933,441.246 545.241,457.007 547.549,387.054 549.857,460.88 552.165,415.242 554.473,484.997 556.781,545.599 559.089,506.529 561.397,384.441 563.705,495.539 566.013,286.874 568.321,398.933 570.628,257.211 572.936,407.682 575.244,369.212 577.552,586.674 579.86,359.699 582.168,293.555 584.476,288.845 586.784,360.139 589.092,273.958 591.4,492.421 593.708,481.9 596.015,535.06 598.323,495.218 600.631,459.537 602.939,317.824 605.247,249.881 607.555,422.861 609.863,479.062 612.171,417.175 614.479,247.092 616.787,283.421 619.095,415.3 621.402,369.411 623.71,233.369 626.018,396.337 628.326,549.463 630.634,378.179 632.942,419.047 635.25,368.432 637.558,416.486 639.866,252.352 642.174,310.974 644.482,242.418 646.79,361.593 649.097,504.538 651.405,432.62 653.713,523.45 656.021,321.116 658.329,388.36 660.637,367.426 662.945,404.883 665.253,340.364 667.561,331.996 669.869,398.148 672.177,495.688 674.484,448.95 676.792,232.016 679.1,304.777 681.408,442.541 683.716,307.493 686.024,196.669 688.332,427.314 690.64,425.868 692.948,487.056 695.256,445.793 697.564,416.01 699.871,543.092 702.179,404.517 704.487,386.794 706.795,269.019 709.103,466.059 711.411,437.367 713.719,372.807 716.027,447.425 718.335,487.189 720.643,515.984 722.951,326.946 725.259,487.138 727.566,360.112 729.874,563.867 732.182,450.913 734.49,566.193 736.798,334.44 739.106,350.138 741.414,339.339 743.722,307.706 746.03,484.885 748.338,284.779 750.646,125.319 752.953,449.719 755.261,454.191 757.569,601.026 759.877,575.483 762.185,429.907 764.493,337.684 766.801,356.26 769.109,276.331 771.417,283.506 773.725,465.198 776.033,552.015 778.34,493.665 780.648,277.963 782.956,337.095 785.264,357.602 787.572,348.975 789.88,421.738 792.188,498.312 794.496,445.219 796.804,351.029 799.112,370.302 801.42,385.916 803.728,396.825 806.035,428.995 808.343,382.867 810.651,273.929 812.959,434.644 815.267,367.884 817.575,513.535 819.883,374.194 822.191,651.129 824.499,419.143 826.807,492.364 829.115,421.941 831.422,461.446 833.73,573.59 836.038,477.143 838.346,407.772 840.654,509.005 842.962,564.219 845.27,587.905 847.578,391.402 849.886,459.798 852.194,160.056 854.502,323.817 856.809,402.049 859.117,372.761 861.425,463.011 863.733,527.2 866.041,465.693 868.349,497.07 870.657,502.204 872.965,479.367 875.273,477.122 877.581,348.89 879.889,416.085 882.197,417.714 884.504,446.237 886.812,367.858 889.12,490.225 891.428,279.749 893.736,286.068 896.044,507.438 898.352,378.748 900.66,223.093 902.968,509.093 905.276,260.187 907.584,516.046 909.891,421.776 912.199,497.266 914.507,393.032 916.815,316.619 919.123,452.983 921.431,291.752 923.739,429.215 926.047,271.963 928.355,419.133 930.663,691.127 932.971,348.841 935.278,382.749 937.586,392.639 939.894,493.412 942.202,293.499 944.51,491.67 946.818,407.38 949.126,418.318 951.434,539.961 953.742,606.177 956.05,180.573 958.358,258.74 960.665,414.807 962.973,408.077 965.281,276.166 967.589,597.83 969.897,361.128 972.205,436.609 974.513,199.418 976.821,356.398 979.129,531.023 981.437,432.697 983.745,416.728 986.053,468.684 988.36,632.263 990.668,174.112 992.976,507.422 995.284,532.923 997.592,469.122 999.9,437.147 1002.21,402.002 1004.52,464.534 1006.82,394.61 1009.13,473.142 1011.44,563.204 1013.75,251.741 1016.06,314.375 1018.36,386.125 1020.67,468.56 1022.98,331.362 1025.29,253.964 1027.59,396.516 1029.9,385.822 1032.21,329.865 1034.52,560.245 1036.83,322.011 1039.13,376.886 1041.44,271.459 1043.75,398.082 1046.06,330.6 1048.37,388.885 1050.67,408.035 1052.98,481.094 1055.29,428.056 1057.6,220.822 1059.91,470.308 1062.21,487.104 1064.52,467.114 1066.83,333.583 1069.14,304.141 1071.45,311.749 1073.75,409.819 1076.06,431.601 1078.37,277.137 1080.68,452.844 1082.98,314.128 1085.29,373.817 1087.6,431.068 1089.91,564.454 1092.22,372.678 1094.52,186.575 1096.83,250.489 1099.14,389.982 1101.45,462.937 1103.76,209.243 1106.06,352.505 1108.37,392.431 1110.68,466.887 1112.99,577.768 1115.3,420.269 1117.6,545.984 1119.91,373.267 1122.22,417.848 1124.53,425.718 1126.84,496.638 1129.14,347.941 1131.45,472.165 1133.76,497.87 1136.07,429.378 1138.37,345.546 1140.68,519.198 1142.99,618.779 1145.3,424.986 1147.61,575.349 1149.91,609.354 1152.22,471.157 1154.53,411.052 1156.84,287.983 1159.15,327.431 1161.45,460.423 1163.76,286.761 1166.07,429.005 1168.38,570 1170.69,390.525 1172.99,519.857 1175.3,431.485 1177.61,346.834 1179.92,235.508 1182.23,516.426 1184.53,333.58 1186.84,488.9 1189.15,400.383 1191.46,424.427 1193.76,451.901 1196.07,529.428 1198.38,499.683 1200.69,361.658 1203,431.743 1205.3,511.603 1207.61,251.09 1209.92,393.511 1212.23,377.917 1214.54,493.692 1216.84,164.958 1219.15,364.268 1221.46,449.926 1223.77,357.277 1226.08,587.646 1228.38,534.124 1230.69,249.273 1233,484.399 1235.31,594.631 1237.61,420.039 1239.92,519.649 1242.23,532.68 1244.54,552.979 1246.85,416.734 1249.15,429.184 1251.46,231.803 1253.77,567.204 1256.08,291.645 1258.39,338.052 1260.69,227.857 1263,322.914 1265.31,417.193 1267.62,513.48 1269.93,248.007 1272.23,465.04 1274.54,291.872 1276.85,444.792 1279.16,477.851 1281.47,265.01 1283.77,301.362 1286.08,428.849 1288.39,341.378 1290.7,511.727 1293,484.422 1295.31,376.692 1297.62,347.316 1299.93,397.008 1302.24,424.008 1304.54,426.017 1306.85,487.801 1309.16,351.54 1311.47,217.744 1313.78,532.105 1316.08,568.204 1318.39,472.22 1320.7,397.154 1323.01,450.166 1325.32,572.516 1327.62,396.977 1329.93,379.246 1332.24,296.152 1334.55,492.679 1336.86,97.2199 1339.16,360.065 1341.47,451.048 1343.78,211.5 1346.09,511.831 1348.39,421.551 1350.7,349.717 1353.01,297.136 1355.32,311.51 1357.63,200.041 1359.93,284.562 1362.24,260.193 1364.55,431.339 1366.86,440.951 1369.17,406.338 1371.47,247.602 1373.78,441.106 1376.09,313.19 1378.4,471.62 1380.71,497.683 1383.01,408.378 1385.32,440.023 1387.63,459.556 1389.94,460.354 1392.24,423.426 1394.55,348.796 1396.86,298.439 1399.17,492.167 1401.48,387.393 1403.78,456.985 1406.09,385.305 1408.4,270.42 1410.71,450.583 1413.02,458.438 1415.32,435.197 1417.63,352.895 1419.94,523.546 1422.25,325.563 1424.56,248.487 1426.86,399.896 1429.17,187.629 1431.48,399.237 1433.79,591.719 1436.1,386.158 1438.4,384.58 1440.71,502.024 1443.02,182.933 1445.33,344.788 1447.63,387.122 1449.94,305.126 1452.25,370.645 1454.56,452.666 1456.87,398.032 1459.17,415.049 1461.48,298.315 1463.79,435.138 1466.1,483.146 1468.41,290.112 1470.71,426.534 1473.02,443.463 1475.33,363.849 1477.64,294.316 1479.95,403.396 1482.25,428.63 1484.56,373.29 1486.87,368.068 1489.18,284.168 1491.49,544.935 1493.79,440.369 1496.1,524.667 1498.41,450.664 1500.72,388.519 1503.02,562.314 1505.33,360.741 1507.64,240.077 1509.95,566.905 1512.26,317.563 1514.56,458.585 1516.87,438.763 1519.18,320.566 1521.49,409.772 1523.8,447.631 1526.1,438.739 1528.41,508.6 1530.72,275.372 1533.03,438.596 1535.34,166.502 1537.64,307.689 1539.95,439.624 1542.26,406.777 1544.57,434.173 1546.88,315.491 1549.18,607.18 1551.49,333.836 1553.8,443.303 1556.11,469.96 1558.41,428.969 1560.72,361.856 1563.03,333.767 1565.34,406.611 1567.65,600.884 1569.95,332.495 1572.26,427.927 1574.57,333.418 1576.88,403.347 1579.19,482.666 1581.49,579.131 1583.8,287.496 1586.11,421.226 1588.42,312.279 1590.73,272.6 1593.03,340.988 1595.34,361.135 1597.65,488.086 1599.96,303.536 1602.26,418.525 1604.57,542.128 1606.88,408.393 1609.19,365.634 1611.5,553.129 1613.8,375.513 1616.11,230.672 1618.42,288.774 1620.73,459.484 1623.04,451.749 1625.34,477.523 1627.65,309.286 1629.96,283.197 1632.27,307.327 1634.58,503.076 1636.88,540.328 1639.19,538.93 1641.5,327.607 1643.81,463.871 1646.12,341.647 1648.42,374.55 1650.73,313.402 1653.04,406.872 1655.35,512.002 1657.65,406.026 1659.96,243.271 1662.27,457.587 1664.58,448.371 1666.89,564.073 1669.19,227.409 1671.5,242.831 1673.81,244.142 1676.12,414.409 1678.43,410.456 1680.73,318.014 1683.04,559.459 1685.35,449.348 1687.66,456.406 1689.97,498.595 1692.27,497.711 1694.58,302.98 1696.89,353.852 1699.2,414.674 1701.51,333.583 1703.81,375.758 1706.12,390.447 1708.43,180.755 1710.74,366.979 1713.04,430.856 1715.35,379.58 1717.66,252.707 1719.97,386.121 1722.28,340.089 1724.58,458.017 1726.89,403.948 1729.2,253.415 1731.51,549.583 1733.82,464.24 1736.12,464.976 1738.43,240.117 1740.74,459.089 1743.05,507.723 1745.36,444.06 1747.66,579.951 1749.97,517.973 1752.28,353.658 1754.59,638.316 1756.9,372.094 1759.2,406.685 1761.51,407.917 1763.82,334.534 1766.13,487.062 1768.43,309.389 1770.74,579.009 1773.05,555.494 1775.36,471.768 1777.67,413.157 1779.97,598.573 1782.28,647.233 1784.59,385.172 1786.9,299.423 1789.21,223.581 1791.51,445.931 1793.82,336.381 1796.13,366.444 1798.44,235.936 1800.75,429.211 1803.05,572.015 1805.36,295.884 1807.67,231.654 1809.98,578.441 1812.28,330.508 1814.59,339.508 1816.9,501.145 1819.21,464.376 1821.52,365.939 1823.82,362.376 1826.13,387.694 1828.44,344.677 1830.75,237.696 1833.06,567.566 1835.36,345.371 1837.67,246.404 1839.98,440.235 1842.29,497.1 1844.6,436.02 1846.9,312.789 1849.21,334.13 1851.52,472.593 1853.83,414.731 1856.14,477.642 1858.44,207.878 1860.75,329.657 1863.06,382.607 1865.37,316.516 1867.67,183.748 1869.98,392.569 1872.29,330.891 1874.6,310.878 1876.91,379.368 1879.21,407.694 1881.52,482.227 1883.83,533.048 1886.14,446.052 1888.45,566.222 1890.75,310.138 1893.06,394.905 1895.37,343.075 1897.68,423.137 1899.99,379.256 1902.29,506.182 1904.6,342.713 1906.91,431.347 1909.22,486.383 1911.53,340.498 1913.83,528.234 1916.14,433.884 1918.45,396.997 1920.76,547.939 1923.06,406.164 1925.37,483.073 1927.68,410.813 1929.99,376.445 1932.3,403.928 1934.6,375.661 1936.91,298.558 1939.22,422.74 1941.53,419.771 1943.84,452.108 1946.14,404.5 1948.45,431.231 1950.76,358.635 1953.07,381.465 1955.38,518.523 1957.68,371.922 1959.99,256.916 1962.3,300.54 1964.61,479.667 1966.91,326.477 1969.22,593.94 1971.53,369.28 1973.84,192.812 1976.15,184.046 1978.45,267.1 1980.76,441.898 1983.07,249.987 1985.38,506.362 1987.69,336.225 1989.99,454.486 1992.3,496.987 1994.61,322.67 1996.92,435.791 1999.23,403.046 2001.53,445.908 2003.84,358.091 2006.15,505.845 2008.46,519.389 2010.77,300.567 2013.07,277.798 2015.38,622.736 2017.69,372.063 2020,381.459 2022.3,566.463 2024.61,437.78 2026.92,344.739 2029.23,453.997 2031.54,419.115 2033.84,507.481 2036.15,393.396 2038.46,511.702 2040.77,423.802 2043.08,332.742 2045.38,517.584 2047.69,439.974 2050,276.745 2052.31,262.599 2054.62,473.048 2056.92,424.136 2059.23,439.2 2061.54,424.636 2063.85,350.808 2066.16,539.338 2068.46,349.978 2070.77,338.727 2073.08,396.179 2075.39,551.666 2077.69,391.048 2080,364.934 2082.31,502.216 2084.62,410.658 2086.93,409.947 2089.23,447.629 2091.54,451.377 2093.85,486.66 2096.16,390.206 2098.47,379.569 2100.77,246.763 2103.08,309.641 2105.39,298.161 2107.7,494.362 2110.01,396.748 2112.31,358.862 2114.62,323.046 2116.93,380.84 2119.24,450.005 2121.55,351.994 2123.85,469.931 2126.16,180.25 2128.47,450.657 2130.78,303.551 2133.08,438.096 2135.39,499.62 2137.7,439.057 2140.01,554.538 2142.32,478.602 2144.62,465.924 2146.93,255.021 2149.24,421.872 2151.55,318.117 2153.86,398.197 2156.16,308.792 2158.47,343.763 2160.78,447.606 2163.09,370.756 2165.4,333.944 2167.7,336.181 2170.01,357.955 2172.32,536.97 2174.63,442.425 2176.93,96.8724 2179.24,335.858 2181.55,589.579 2183.86,336.697 2186.17,573.859 2188.47,353.636 2190.78,354.972 2193.09,396.473 2195.4,472.083 2197.71,242.278 2200.01,522.717 2202.32,331.65 2204.63,454.739 2206.94,435.844 2209.25,535.663 2211.55,276.519 2213.86,245.135 2216.17,537.2 2218.48,418.694 2220.79,561.05 2223.09,545.859 2225.4,455.539 2227.71,394.273 2230.02,432.718 2232.32,335.487 2234.63,454.489 2236.94,305.762 2239.25,340.102 2241.56,302.039 2243.86,469.739 2246.17,338.67 2248.48,432.097 2250.79,517.255 2253.1,545.792 2255.4,320.691 2257.71,342.373 2260.02,390.636 2262.33,504.725 2264.64,369.953 2266.94,241.418 2269.25,565.597 2271.56,410.092 2273.87,289.537 2276.18,436.94 2278.48,320.15 2280.79,268.349 2283.1,461.897 2285.41,476.533 2287.71,284.793 2290.02,484.674 2292.33,420.505 2294.64,644.44 2296.95,452.385 2299.25,397.96 2301.56,482.602 2303.87,400.609 2306.18,362.026 2308.49,366.63 2310.79,285.548 2313.1,535.863 2315.41,495.842 2317.72,481.114 2320.03,389.118 2322.33,314.902 2324.64,414.949 2326.95,356.186 2329.26,574.647 2331.56,441.273 2333.87,476.533 2336.18,536.561 2338.49,346.515 2340.8,246.944 2343.1,396.789 2345.41,396.035 2347.72,527.687 2350.03,541.176 2352.34,336.421 2354.64,436.692 2356.95,253.092 2359.26,365.917 2361.57,489.718 2363.88,298.012 2366.18,391.665 2368.49,518.159 2370.8,435.187 2373.11,436.49 2375.42,384.686 2377.72,306.548 2380.03,360.461 2382.34,395.096 2384.65,454.412 2386.95,266.838 2389.26,391.585 2391.57,474.652 2393.88,465.422 2396.19,460.446 2398.49,300.728 2400.8,381.301 2403.11,469.219 2405.42,375.999 2407.73,545.443 2410.03,427.809 2412.34,470.844 2414.65,393.84 2416.96,431.067 2419.27,399.3 2421.57,379.324 2423.88,286.9 2426.19,385.071 2428.5,372.274 2430.81,323.38 2433.11,521.84 2435.42,311.559 2437.73,300.581 2440.04,447.577 2442.34,435.489 2444.65,479.238 2446.96,435.055 2449.27,233.285 2451.58,290.076 2453.88,492.045 2456.19,409.349 2458.5,556.941 2460.81,370.796 2463.12,484.894 2465.42,379.713 2467.73,523.557 2470.04,482.073 2472.35,422.596 2474.66,478.038 2476.96,435.933 2479.27,255.68 2481.58,457.337 2483.89,384.6 2486.2,377.42 2488.5,372.597 2490.81,290.134 2493.12,352.521 2495.43,219.89 2497.73,391.166 2500.04,225.066 2502.35,454.611 2504.66,363.928 2506.97,448.248 2509.27,266.221 2511.58,298.905 2513.89,357.674 2516.2,331.716 2518.51,362.735 2520.81,599.074 2523.12,411.725 2525.43,269.022 2527.74,269.661 2530.05,473.839 2532.35,389.466 2534.66,281.492 2536.97,448.559 2539.28,433.801 2541.58,317.825 2543.89,364.943 2546.2,423.997 2548.51,384.73 2550.82,538.175 2553.12,291.369 2555.43,261.556 2557.74,315.346 2560.05,395.752 2562.36,528.653 2564.66,369.908 2566.97,287.434 2569.28,416.731 2571.59,412.947 "></polyline>
</svg>
</div>
</div>
<p>Look at that! Things are working; amazin’.</p>
<p>We can also exploit <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>’s parallel sampling capabilities:</p>
<div id="34" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run separate 4 chains for 10 000 iterations using threads to parallelize.</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>num_chains <span class="op">=</span> <span class="fl">4</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    model_with_grad,</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">MCMCThreads</span>(),</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>,</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    num_chains;</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Note we need to provide an initial state for every chain.</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>    initial_state<span class="op">=</span><span class="fu">fill</span>(state, num_chains),</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>samples_array <span class="op">=</span> <span class="fu">stack</span>(<span class="fu">map</span>(<span class="bu">Base</span>.<span class="fu">Fix1</span>(stack, sample <span class="op">-&gt;</span> sample.x), samples))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000×4 Array{Float64, 3}:
[:, :, 1] =
 -1.50035  -2.99539   -3.06014  -4.46939   …  -7.94304   -6.1068    -6.1068
 -2.54999  -0.889292  -1.88778  -0.906732      0.917414   0.371954   0.371954
  1.95157   2.32704    3.41894   4.58322       6.00469    3.61473    3.61473

[:, :, 2] =
 -3.03496  -3.40089   -4.17135    …  -5.97658   -5.47869   -5.72235
 -3.56344   0.245303  -0.0899902      0.514323   0.266876  -0.219773
  5.01771   5.42588    4.30159        3.79588    3.64152    4.93095

[:, :, 3] =
 -1.50976   -2.22793  -4.21084    …  -6.50174   -4.96362   -5.00232
  0.015175   1.08891  -0.0999051     -0.177128   0.906465   0.294158
  2.52985    3.35601   1.58242        5.32433    6.53459    7.08328

[:, :, 4] =
 -2.02192   -3.77135  -3.75171  -4.25134  …  -4.11625  -5.6351     -5.6351
  0.899519  -1.11019  -2.07137  -2.65461     -1.20742  -0.0427135  -0.0427135
  2.79404    2.03282   2.3559    3.41672      5.28904   4.89158     4.89158</code></pre>
</div>
</div>
<p>But the fact that we have to provide the <code>AbstractMCMC.sample</code> call, etc. with an <code>initial_state</code> to get started is a bit annoying. We can avoid this by also defining a <code>AbstractMCMC.step</code> <em>without</em> the <code>state</code> argument:</p>
<div id="36" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">::</span><span class="dt">MALA</span>;</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># </span><span class="al">NOTE</span><span class="co">: No state provided!</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just create the initial state by sampling using  a Gaussian.</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="fu">randn</span>(rng, LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(x), <span class="fu">MALAState</span>(x)</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Equipped with this, we no longer need to provide the <code>initial_state</code> everywhere:</p>
<div id="38" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -4.99796      0.99596
 -0.000138923  0.989515
  5.00023      1.00864</code></pre>
</div>
</div>
</section>
<section id="using-our-sampler-with-turing.jl" class="level2">
<h2 class="anchored" data-anchor-id="using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</h2>
<p>As we promised, all of this hassle of implementing our <code>MALA</code> sampler in a way that uses <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> and <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> gets us something more than <em>just</em> an “automatic” implementation of <code>AbstractMCMC.sample</code>.</p>
<p>It also enables use with Turing.jl through the <code>externalsampler</code>, but we need to do one final thing first: we need to tell Turing.jl how to extract a vector of parameters from the “sample” returned in our implementation of <code>AbstractMCMC.step</code>. In our case, the “sample” is a <code>MALASample</code>, so we just need the following line:</p>
<div id="40" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load Turing.jl.</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Turing</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Overload the `getparams` method for our "sample" type, which is just a vector.</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>Turing.Inference.<span class="fu">getparams</span>(<span class="op">::</span><span class="dt">Turing.Model</span>, sample<span class="op">::</span><span class="dt">MALASample</span>) <span class="op">=</span> sample.x</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And with that, we’re good to go!</p>
<div id="42" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Our previous model defined as a Turing.jl model.</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">mvnormal_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">MvNormal</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.], I)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate our model.</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">mvnormal_model</span>()</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Call `sample` but now we're passing in a Turing.jl `model` and wrapping</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co"># our `MALA` sampler in the `externalsampler` to tell Turing.jl that the sampler</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co"># expects something that implements LogDensityProblems.jl.</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×4×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 2.5 seconds
Compute duration  = 2.5 seconds
parameters        = x[1], x[2], x[3]
internals         = lp

Summary Statistics
  parameters      mean       std      mcse    ess_bulk    ess_tail      rhat   ⋯
      Symbol   Float64   Float64   Float64     Float64     Float64   Float64   ⋯

        x[1]   -5.0023    1.0073    0.0183   3024.9337   4965.6193    0.9999   ⋯
        x[2]   -0.0377    0.9997    0.0175   3255.5343   4762.0074    1.0004   ⋯
        x[3]    5.0110    1.0082    0.0179   3191.2272   5351.7298    1.0000   ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

        x[1]   -6.9784   -5.6799   -5.0189   -4.3191   -3.0287
        x[2]   -2.0162   -0.6961   -0.0419    0.6420    1.9174
        x[3]    3.0233    4.3333    5.0180    5.6922    6.9648</code></pre>
</div>
</div>
<p>Pretty neat, eh?</p>
<section id="models-with-constrained-parameters" class="level3">
<h3 class="anchored" data-anchor-id="models-with-constrained-parameters">Models with constrained parameters</h3>
<p>One thing we’ve sort of glossed over in all of the above is that MALA, at least how we’ve implemented it, requires <span class="math inline">\(x\)</span> to live in <span class="math inline">\(\mathbb{R}^d\)</span> for some <span class="math inline">\(d &gt; 0\)</span>. If some of the parameters were in fact constrained, e.g.&nbsp;we were working with a <code>Beta</code> distribution which has support on the interval <span class="math inline">\((0, 1)\)</span>, <em>not</em> on <span class="math inline">\(\mathbb{R}^d\)</span>, we could easily end up outside of the valid range <span class="math inline">\((0, 1)\)</span>.</p>
<div id="44" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">beta_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">beta_model</span>()</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 1.45 seconds
Compute duration  = 1.45 seconds
parameters        = x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse    ess_bulk    ess_tail      rhat   ⋯
      Symbol   Float64   Float64   Float64     Float64     Float64   Float64   ⋯

           x    0.4950    0.1907    0.0030   3997.1110   5278.0331    1.0000   ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

           x    0.1390    0.3524    0.4973    0.6355    0.8497</code></pre>
</div>
</div>
<p>Yep, that still works, but only because Turing.jl actually <em>transforms</em> the <code>turing_model</code> from constrained to unconstrained, so that the <code>sampler</code> provided to <code>externalsampler</code> is actually always working in unconstrained space! This is not always desirable, so we can turn this off:</p>
<div id="46" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 0.23 seconds
Compute duration  = 0.23 seconds
parameters        = x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse   ess_bulk   ess_tail      rhat   e ⋯
      Symbol   Float64   Float64   Float64    Float64    Float64   Float64     ⋯

           x    0.4877    0.1436    0.0082   269.4569   120.9895    1.0062     ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

           x    0.2662    0.3667    0.4812    0.6037    0.7444</code></pre>
</div>
</div>
<p>The fun thing is that this still sort of works because</p>
<div id="48" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">logpdf</span>(<span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>), <span class="fl">10.0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-Inf</code></pre>
</div>
</div>
<p>and so the samples that fall outside of the range are always rejected. But do notice how much worse all the diagnostics are, e.g.&nbsp;<code>ess_tail</code> is very poor compared to when we use <code>unconstrained=true</code>. Moreover, in more complex cases this won’t just result in a “nice” <code>-Inf</code> log-density value, but instead will error:</p>
<div id="50" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="kw">function</span> <span class="fu">demo</span>()</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>    σ² <span class="op">~</span> <span class="fu">truncated</span>(<span class="fu">Normal</span>(), lower<span class="op">=</span><span class="fl">0</span>)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If we end up with negative values for `σ²`, the `Normal` will error.</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>    x <span class="op">~</span> <span class="fu">Normal</span>(<span class="fl">0</span>, σ²)</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>DomainError: DomainError(-1.3811461532052418, "Normal: the condition σ &gt;= zero(σ) is not satisfied.")
DomainError with -1.3811461532052418:
Normal: the condition σ &gt;= zero(σ) is not satisfied.
Stacktrace:
  [1] #371
    @ ~/.julia/packages/Distributions/uuqsE/src/univariate/continuous/normal.jl:37 [inlined]
  [2] check_args
    @ ~/.julia/packages/Distributions/uuqsE/src/utils.jl:89 [inlined]
  [3] #Normal#370
    @ ~/.julia/packages/Distributions/uuqsE/src/univariate/continuous/normal.jl:37 [inlined]
  [4] Normal
    @ ~/.julia/packages/Distributions/uuqsE/src/univariate/continuous/normal.jl:36 [inlined]
  [5] Normal
    @ ~/.julia/packages/Distributions/uuqsE/src/univariate/continuous/normal.jl:42 [inlined]
  [6] macro expansion
    @ ~/.julia/packages/DynamicPPL/DvdZw/src/compiler.jl:579 [inlined]
  [7] demo(__model__::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, __varinfo__::DynamicPPL.ThreadSafeVarInfo{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, Vector{Base.RefValue{Float64}}}, __context__::DynamicPPL.ValuesAsInModelContext{OrderedDict{Any, Any}, DynamicPPL.DefaultContext})
    @ Main.Notebook ~/work/docs/docs/tutorials/docs-17-implementing-samplers/index.qmd:593
  [8] _evaluate!!
    @ ~/.julia/packages/DynamicPPL/DvdZw/src/model.jl:973 [inlined]
  [9] evaluate_threadsafe!!(model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, varinfo::DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, context::DynamicPPL.ValuesAsInModelContext{OrderedDict{Any, Any}, DynamicPPL.DefaultContext})
    @ DynamicPPL ~/.julia/packages/DynamicPPL/DvdZw/src/model.jl:962
 [10] evaluate!!
    @ ~/.julia/packages/DynamicPPL/DvdZw/src/model.jl:892 [inlined]
 [11] values_as_in_model
    @ ~/.julia/packages/DynamicPPL/DvdZw/src/values_as_in_model.jl:196 [inlined]
 [12] values_as_in_model
    @ ~/.julia/packages/DynamicPPL/DvdZw/src/values_as_in_model.jl:195 [inlined]
 [13] getparams(model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, vi::DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64})
    @ Turing.Inference ~/.julia/packages/Turing/QN7BL/src/mcmc/Inference.jl:343
 [14] Turing.Inference.Transition(model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, vi::DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, t::MALASample{Vector{Float64}})
    @ Turing.Inference ~/.julia/packages/Turing/QN7BL/src/mcmc/Inference.jl:226
 [15] transition_to_turing
    @ ~/.julia/packages/Turing/QN7BL/src/mcmc/abstractmcmc.jl:12 [inlined]
 [16] transition_to_turing(f::LogDensityProblemsADForwardDiffExt.ForwardDiffLogDensity{LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, Nothing}, ForwardDiff.Chunk{2}, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}, transition::MALASample{Vector{Float64}})
    @ Turing.Inference ~/.julia/packages/Turing/QN7BL/src/mcmc/abstractmcmc.jl:17
 [17] step(rng::TaskLocalRNG, model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, sampler_wrapper::DynamicPPL.Sampler{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}; initial_state::Nothing, initial_params::Nothing, kwargs::@Kwargs{})
    @ Turing.Inference ~/.julia/packages/Turing/QN7BL/src/mcmc/abstractmcmc.jl:147
 [18] macro expansion
    @ ~/.julia/packages/AbstractMCMC/z1nwm/src/sample.jl:0 [inlined]
 [19] macro expansion
    @ ~/.julia/packages/AbstractMCMC/z1nwm/src/logging.jl:16 [inlined]
 [20] mcmcsample(rng::TaskLocalRNG, model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, sampler::DynamicPPL.Sampler{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}, N::Int64; progress::Bool, progressname::String, callback::Nothing, num_warmup::Int64, discard_initial::Int64, thinning::Int64, chain_type::Type, initial_state::Nothing, kwargs::@Kwargs{})
    @ AbstractMCMC ~/.julia/packages/AbstractMCMC/z1nwm/src/sample.jl:142
 [21] sample(rng::TaskLocalRNG, model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, sampler::DynamicPPL.Sampler{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}, N::Int64; chain_type::Type, resume_from::Nothing, initial_state::Nothing, kwargs::@Kwargs{progress::Bool})
    @ DynamicPPL ~/.julia/packages/DynamicPPL/DvdZw/src/sampler.jl:93
 [22] sample
    @ ~/.julia/packages/DynamicPPL/DvdZw/src/sampler.jl:83 [inlined]
 [23] #sample#4
    @ ~/.julia/packages/Turing/QN7BL/src/mcmc/Inference.jl:276 [inlined]
 [24] sample
    @ ~/.julia/packages/Turing/QN7BL/src/mcmc/Inference.jl:267 [inlined]
 [25] #sample#3
    @ ~/.julia/packages/Turing/QN7BL/src/mcmc/Inference.jl:264 [inlined]
 [26] top-level scope
    @ ~/work/docs/docs/tutorials/docs-17-implementing-samplers/index.qmd:595</code></pre>
</div>
</div>
<p>As expected, we run into a <code>DomainError</code> at some point, while if we set <code>unconstrained=true</code>, letting Turing.jl transform the model to a unconstrained form behind the scenes, everything works as expected:</p>
<div id="52" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 1.62 seconds
Compute duration  = 1.62 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse   ess_bulk   ess_tail      rhat   e ⋯
      Symbol   Float64   Float64   Float64    Float64    Float64   Float64     ⋯

          σ²    8.0777    0.0000    0.0000        NaN        NaN       NaN     ⋯
           x    0.8247    0.0000    0.0000        NaN        NaN       NaN     ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

          σ²    8.0777    8.0777    8.0777    8.0777    8.0777
           x    0.8247    0.8247    0.8247    0.8247    0.8247</code></pre>
</div>
</div>
<p>Neat!</p>
<p>Similarly, which automatic differentiation backend one should use can be specified through the <code>adtype</code> keyword argument too. For example, if we want to use <a href="https://github.com/JuliaDiff/ReverseDiff.jl">ReverseDiff.jl</a> instead of the default <a href="https://github.com/JuliaDiff/ForwardDiff.jl">ForwardDiff.jl</a>:</p>
<div id="54" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">ReverseDiff</span>: ReverseDiff</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify that we want to use `AutoReverseDiff`.</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">demo</span>(),</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>, adtype<span class="op">=</span><span class="fu">AutoReverseDiff</span>()),</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>;</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 2.95 seconds
Compute duration  = 2.95 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse    ess_bulk   ess_tail      rhat    ⋯
      Symbol   Float64   Float64   Float64     Float64    Float64   Float64    ⋯

          σ²    0.8334    0.5355    0.0175    685.4540   381.3211    1.0000    ⋯
           x    0.0154    0.8364    0.0289   1003.4159   788.4564    1.0007    ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

          σ²    0.1466    0.4023    0.7174    1.1574    2.1408
           x   -1.7168   -0.3836    0.0077    0.4131    1.7948</code></pre>
</div>
</div>
<p>Double-neat.</p>
</section>
</section>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<p>At this point it’s worth maybe reminding ourselves what we did and also <em>why</em> we did it:</p>
<ol type="1">
<li>We define our models in the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface because it makes the sampler agnostic to how the underlying model is implemented.</li>
<li>We implement our sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> interface, which just means that our sampler is a subtype of <code>AbstractMCMC.AbstractSampler</code> and we implement the MCMC transition in <code>AbstractMCMC.step</code>.</li>
<li>Points 1 and 2 makes it so our sampler can be used with a wide range of model implementations, amongst them being models implemented in both Turing.jl and Stan. This gives you, the inference implementer, a large collection of models to test your inference method on, in addition to allowing users of Turing.jl and Stan to try out your inference method with minimal effort.</li>
</ol>


</section>


<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a><div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>We’re going with the leapfrog formulation because in a future version of this tutorial we’ll add a section extending this simple “baseline” MALA sampler to more complex versions. See <a href="https://github.com/TuringLang/docs/issues/479">issue #479</a> for progress on this.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>There is no such thing as a proper interface in Julia (at least not officially), and so we use the word “interface” here to mean a few minimal methods that needs to be implemented by any type that we treat as a target model.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/turinglang\.org\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../tutorials/docs-07-for-developers-variational-inference/index.html" class="pagination-link" aria-label="Variational Inference">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Variational Inference</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Turing is created by <a href="http://mlg.eng.cam.ac.uk/hong/" target="_blank">Hong Ge</a>, and lovingly maintained by the <a href="https://github.com/TuringLang/Turing.jl/graphs/contributors" target="_blank">core team</a> of volunteers. <br> The contents of this website are © 2024 under the terms of the <a href="https://github.com/TuringLang/Turing.jl/blob/master/LICENCE" target="_blank">MIT License</a>.</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/TuringLang/docs/edit/master/tutorials/docs-17-implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/docs/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://x.com/TuringLang">
      <i class="bi bi-twitter" role="img" aria-label="Turing Twitter">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/TuringLang/Turing.jl">
      <i class="bi bi-github" role="img" aria-label="Turing GitHub">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




<script src="../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>