<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Bayesian Neural Networks – Turing.jl</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../tutorials/04-hidden-markov-model/index.html" rel="next">
<link href="../../tutorials/02-logistic-regression/index.html" rel="prev">
<link href="../../assets/favicon.ico" rel="icon">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<style>
  a {
    text-decoration: none;
  }
  a:hover {
    text-decoration: underline;
  }
</style>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../theming/styles.css">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="https://turinglang.org/" class="navbar-brand navbar-brand-logo">
    <img src="../../assets/images/turing-logo.svg" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="https://turinglang.org/">
    <span class="navbar-title">Turing.jl</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../tutorials/docs-00-getting-started/"> 
<span class="menu-text">Get Started</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../tutorials/00-introduction/"> 
<span class="menu-text">Tutorials</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/library/"> 
<span class="menu-text">Libraries</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/news/"> 
<span class="menu-text">News</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/team/"> 
<span class="menu-text">Team</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-v0.34" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">v0.34</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-v0.34">    
        <li>
    <a class="dropdown-item" href="https://turinglang.org/docs/changelog.html">
 <span class="dropdown-text">Changelog</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://turinglang.org/docs/versions.html">
 <span class="dropdown-text">All Versions</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
    <a href="https://x.com/TuringLang" title="Turing Twitter" class="quarto-navigation-tool px-1" aria-label="Turing Twitter"><i class="bi bi-twitter"></i></a>
    <a href="https://github.com/TuringLang/Turing.jl" title="Turing GitHub" class="quarto-navigation-tool px-1" aria-label="Turing GitHub"><i class="bi bi-github"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Documentation</li><li class="breadcrumb-item"><a href="../../tutorials/00-introduction/index.html">Using Turing - Tutorials</a></li><li class="breadcrumb-item"><a href="../../tutorials/03-bayesian-neural-network/index.html">Bayesian Neural Networks</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Documentation</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false">
 <span class="menu-text">Using Turing - Modelling Syntax and Interface</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-00-getting-started/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Getting Started</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-14-using-turing-quick-start/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Quick Start</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-12-using-turing-guide/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Guide</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-17-mode-estimation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Mode Estimation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-09-using-turing-advanced/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Advanced Usage</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-10-using-turing-autodiff/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Automatic Differentiation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-13-using-turing-performance-tips/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Performance Tips</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-11-using-turing-dynamichmc/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using DynamicHMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-15-using-turing-sampler-viz/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Sampler Visualization</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-16-using-turing-external-samplers/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">External Samplers</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Using Turing - Tutorials</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/00-introduction/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction to Turing</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/01-gaussian-mixture-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Mixture Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/02-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/03-bayesian-neural-network/index.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Bayesian Neural Networks</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/04-hidden-markov-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Hidden Markov Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/05-linear-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Linear Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/06-infinite-mixture-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Infinite Mixture Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/07-poisson-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Poisson Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/08-multinomial-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Multinomial Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/09-variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/10-bayesian-differential-equations/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Differential Equations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/11-probabilistic-pca/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Probabilistic PCA</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/13-seasonal-time-series/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Time Series Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/15-gaussian-processes/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction to Gaussian Processes</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/12-gplvm/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Process Latent Variable Models</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false">
 <span class="menu-text">Developers: Contributing</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-01-contributing-guide/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">How to Contribute</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false">
 <span class="menu-text">Developers: PPL</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-05-for-developers-compiler/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Turing Compiler Design</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/14-minituring/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation I: Compiler</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/16-contexts/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation II: Contexts</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-06-for-developers-interface/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Interface Guide</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="false">
 <span class="menu-text">Developers: Inference</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-04-for-developers-abstractmcmc-turing/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">How Turing implements AbstractMCMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-07-for-developers-variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-17-implementing-samplers/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Implementing Samplers</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of Contents</h2>
   
  <ul>
  <li><a href="#building-a-neural-network" id="toc-building-a-neural-network" class="nav-link active" data-scroll-target="#building-a-neural-network">Building a Neural Network</a></li>
  <li><a href="#prediction-visualization" id="toc-prediction-visualization" class="nav-link" data-scroll-target="#prediction-visualization">Prediction Visualization</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/TuringLang/docs/edit/master/tutorials/03-bayesian-neural-network/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/docs/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Documentation</li><li class="breadcrumb-item"><a href="../../tutorials/00-introduction/index.html">Using Turing - Tutorials</a></li><li class="breadcrumb-item"><a href="../../tutorials/03-bayesian-neural-network/index.html">Bayesian Neural Networks</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Bayesian Neural Networks</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>In this tutorial, we demonstrate how one can implement a Bayesian Neural Network using a combination of Turing and <a href="https://github.com/LuxDL/Lux.jl">Lux</a>, a suite of machine learning tools. We will use Lux to specify the neural network’s layers and Turing to implement the probabilistic inference, with the goal of implementing a classification algorithm.</p>
<p>We will begin with importing the relevant libraries.</p>
<div id="4" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Turing</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">FillArrays</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Lux</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Plots</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Tracker</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Functors</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LinearAlgebra</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>WARNING: Method definition rrule(typeof(Base.merge), NamedTuple{F1, T} where T&lt;:Tuple, NamedTuple{F2, T} where T&lt;:Tuple) where {F1, F2} in module ChainRules at /home/runner/.julia/packages/ChainRules/hShjJ/src/rulesets/Base/base.jl:313 overwritten in module Lux at /home/runner/.julia/packages/Lux/5xfGO/src/chainrules.jl:16.
ERROR: Method overwriting is not permitted during Module precompilation. Use `__precompile__(false)` to opt-out of precompilation.</code></pre>
</div>
</div>
<p>Our goal here is to use a Bayesian neural network to classify points in an artificial dataset. The code below generates data points arranged in a box-like pattern and displays a graph of the dataset we will be working with.</p>
<div id="6" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Number of points to generate</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>N <span class="op">=</span> <span class="fl">80</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>M <span class="op">=</span> <span class="fu">round</span>(<span class="dt">Int</span>, N <span class="op">/</span> <span class="fl">4</span>)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>rng <span class="op">=</span> <span class="bu">Random</span>.<span class="fu">default_rng</span>()</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="bu">Random</span>.<span class="fu">seed!</span>(rng, <span class="fl">1234</span>)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate artificial data</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>x1s <span class="op">=</span> <span class="fu">rand</span>(rng, <span class="dt">Float32</span>, M) <span class="op">*</span> <span class="fl">4.5f0</span>;</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>x2s <span class="op">=</span> <span class="fu">rand</span>(rng, <span class="dt">Float32</span>, M) <span class="op">*</span> <span class="fl">4.5f0</span>;</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>xt1s <span class="op">=</span> <span class="fu">Array</span>([[x1s[i] <span class="op">+</span> <span class="fl">0.5f0</span>; x2s[i] <span class="op">+</span> <span class="fl">0.5f0</span>] for i <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span>M])</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>x1s <span class="op">=</span> <span class="fu">rand</span>(rng, <span class="dt">Float32</span>, M) <span class="op">*</span> <span class="fl">4.5f0</span>;</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>x2s <span class="op">=</span> <span class="fu">rand</span>(rng, <span class="dt">Float32</span>, M) <span class="op">*</span> <span class="fl">4.5f0</span>;</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="fu">append!</span>(xt1s, <span class="fu">Array</span>([[x1s[i] <span class="op">-</span> <span class="fl">5.0f0</span>; x2s[i] <span class="op">-</span> <span class="fl">5.0f0</span>] for i <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span>M]))</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>x1s <span class="op">=</span> <span class="fu">rand</span>(rng, <span class="dt">Float32</span>, M) <span class="op">*</span> <span class="fl">4.5f0</span>;</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>x2s <span class="op">=</span> <span class="fu">rand</span>(rng, <span class="dt">Float32</span>, M) <span class="op">*</span> <span class="fl">4.5f0</span>;</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>xt0s <span class="op">=</span> <span class="fu">Array</span>([[x1s[i] <span class="op">+</span> <span class="fl">0.5f0</span>; x2s[i] <span class="op">-</span> <span class="fl">5.0f0</span>] for i <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span>M])</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>x1s <span class="op">=</span> <span class="fu">rand</span>(rng, <span class="dt">Float32</span>, M) <span class="op">*</span> <span class="fl">4.5f0</span>;</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>x2s <span class="op">=</span> <span class="fu">rand</span>(rng, <span class="dt">Float32</span>, M) <span class="op">*</span> <span class="fl">4.5f0</span>;</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a><span class="fu">append!</span>(xt0s, <span class="fu">Array</span>([[x1s[i] <span class="op">-</span> <span class="fl">5.0f0</span>; x2s[i] <span class="op">+</span> <span class="fl">0.5f0</span>] for i <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span>M]))</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Store all the data for later</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>xs <span class="op">=</span> [xt1s; xt0s]</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>ts <span class="op">=</span> [<span class="fu">ones</span>(<span class="fl">2</span> <span class="op">*</span> M); <span class="fu">zeros</span>(<span class="fl">2</span> <span class="op">*</span> M)]</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot data points.</span></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">plot_data</span>()</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>    x1 <span class="op">=</span> <span class="fu">map</span>(<span class="cn">e</span> <span class="op">-&gt;</span> <span class="cn">e</span>[<span class="fl">1</span>], xt1s)</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>    y1 <span class="op">=</span> <span class="fu">map</span>(<span class="cn">e</span> <span class="op">-&gt;</span> <span class="cn">e</span>[<span class="fl">2</span>], xt1s)</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>    x2 <span class="op">=</span> <span class="fu">map</span>(<span class="cn">e</span> <span class="op">-&gt;</span> <span class="cn">e</span>[<span class="fl">1</span>], xt0s)</span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>    y2 <span class="op">=</span> <span class="fu">map</span>(<span class="cn">e</span> <span class="op">-&gt;</span> <span class="cn">e</span>[<span class="fl">2</span>], xt0s)</span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>    Plots.<span class="fu">scatter</span>(x1, y1; color<span class="op">=</span><span class="st">"red"</span>, clim<span class="op">=</span>(<span class="fl">0</span>, <span class="fl">1</span>))</span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> Plots.<span class="fu">scatter!</span>(x2, y2; color<span class="op">=</span><span class="st">"blue"</span>, clim<span class="op">=</span>(<span class="fl">0</span>, <span class="fl">1</span>))</span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_data</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<!--?xml version="1.0" encoding="utf-8"?-->
<svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" width="672" height="480" viewbox="0 0 2688 1920">
<defs>
  <clippath id="clip380">
    <rect x="0" y="0" width="2688" height="1920"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip380)" d="M0 1920 L2688 1920 L2688 0 L0 0  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip381">
    <rect x="537" y="0" width="1883" height="1883"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip380)" d="M152.071 1800.78 L2640.76 1800.78 L2640.76 47.2441 L152.071 47.2441  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip382">
    <rect x="152" y="47" width="2490" height="1755"></rect>
  </clippath>
</defs>
<polyline clip-path="url(#clip382)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="455.736,1800.78 455.736,47.2441 "></polyline>
<polyline clip-path="url(#clip382)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="932.283,1800.78 932.283,47.2441 "></polyline>
<polyline clip-path="url(#clip382)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1408.83,1800.78 1408.83,47.2441 "></polyline>
<polyline clip-path="url(#clip382)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1885.38,1800.78 1885.38,47.2441 "></polyline>
<polyline clip-path="url(#clip382)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="2361.92,1800.78 2361.92,47.2441 "></polyline>
<polyline clip-path="url(#clip382)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="152.071,1615.13 2640.76,1615.13 "></polyline>
<polyline clip-path="url(#clip382)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="152.071,1277.14 2640.76,1277.14 "></polyline>
<polyline clip-path="url(#clip382)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="152.071,939.136 2640.76,939.136 "></polyline>
<polyline clip-path="url(#clip382)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="152.071,601.137 2640.76,601.137 "></polyline>
<polyline clip-path="url(#clip382)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="152.071,263.138 2640.76,263.138 "></polyline>
<polyline clip-path="url(#clip380)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="152.071,1800.78 2640.76,1800.78 "></polyline>
<polyline clip-path="url(#clip380)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="455.736,1800.78 455.736,1781.88 "></polyline>
<polyline clip-path="url(#clip380)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="932.283,1800.78 932.283,1781.88 "></polyline>
<polyline clip-path="url(#clip380)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1408.83,1800.78 1408.83,1781.88 "></polyline>
<polyline clip-path="url(#clip380)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1885.38,1800.78 1885.38,1781.88 "></polyline>
<polyline clip-path="url(#clip380)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="2361.92,1800.78 2361.92,1781.88 "></polyline>
<path clip-path="url(#clip380)" d="M424.636 1848.65 L454.312 1848.65 L454.312 1852.59 L424.636 1852.59 L424.636 1848.65 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip380)" d="M477.252 1835 L465.446 1853.45 L477.252 1853.45 L477.252 1835 M476.025 1830.92 L481.904 1830.92 L481.904 1853.45 L486.835 1853.45 L486.835 1857.34 L481.904 1857.34 L481.904 1865.48 L477.252 1865.48 L477.252 1857.34 L461.65 1857.34 L461.65 1852.82 L476.025 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip380)" d="M902.225 1848.65 L931.901 1848.65 L931.901 1852.59 L902.225 1852.59 L902.225 1848.65 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip380)" d="M946.021 1861.55 L962.34 1861.55 L962.34 1865.48 L940.396 1865.48 L940.396 1861.55 Q943.058 1858.79 947.641 1854.16 Q952.248 1849.51 953.428 1848.17 Q955.674 1845.65 956.553 1843.91 Q957.456 1842.15 957.456 1840.46 Q957.456 1837.71 955.512 1835.97 Q953.591 1834.23 950.489 1834.23 Q948.29 1834.23 945.836 1835 Q943.405 1835.76 940.628 1837.31 L940.628 1832.59 Q943.452 1831.46 945.905 1830.88 Q948.359 1830.3 950.396 1830.3 Q955.766 1830.3 958.961 1832.98 Q962.155 1835.67 962.155 1840.16 Q962.155 1842.29 961.345 1844.21 Q960.558 1846.11 958.452 1848.7 Q957.873 1849.37 954.771 1852.59 Q951.669 1855.78 946.021 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip380)" d="M1408.83 1834 Q1405.22 1834 1403.39 1837.57 Q1401.58 1841.11 1401.58 1848.24 Q1401.58 1855.34 1403.39 1858.91 Q1405.22 1862.45 1408.83 1862.45 Q1412.46 1862.45 1414.27 1858.91 Q1416.1 1855.34 1416.1 1848.24 Q1416.1 1841.11 1414.27 1837.57 Q1412.46 1834 1408.83 1834 M1408.83 1830.3 Q1414.64 1830.3 1417.7 1834.9 Q1420.77 1839.49 1420.77 1848.24 Q1420.77 1856.96 1417.7 1861.57 Q1414.64 1866.15 1408.83 1866.15 Q1403.02 1866.15 1399.94 1861.57 Q1396.89 1856.96 1396.89 1848.24 Q1396.89 1839.49 1399.94 1834.9 Q1403.02 1830.3 1408.83 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip380)" d="M1880.03 1861.55 L1896.35 1861.55 L1896.35 1865.48 L1874.41 1865.48 L1874.41 1861.55 Q1877.07 1858.79 1881.65 1854.16 Q1886.26 1849.51 1887.44 1848.17 Q1889.68 1845.65 1890.56 1843.91 Q1891.47 1842.15 1891.47 1840.46 Q1891.47 1837.71 1889.52 1835.97 Q1887.6 1834.23 1884.5 1834.23 Q1882.3 1834.23 1879.84 1835 Q1877.41 1835.76 1874.64 1837.31 L1874.64 1832.59 Q1877.46 1831.46 1879.91 1830.88 Q1882.37 1830.3 1884.4 1830.3 Q1889.78 1830.3 1892.97 1832.98 Q1896.16 1835.67 1896.16 1840.16 Q1896.16 1842.29 1895.35 1844.21 Q1894.57 1846.11 1892.46 1848.7 Q1891.88 1849.37 1888.78 1852.59 Q1885.68 1855.78 1880.03 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip380)" d="M2364.93 1835 L2353.13 1853.45 L2364.93 1853.45 L2364.93 1835 M2363.71 1830.92 L2369.59 1830.92 L2369.59 1853.45 L2374.52 1853.45 L2374.52 1857.34 L2369.59 1857.34 L2369.59 1865.48 L2364.93 1865.48 L2364.93 1857.34 L2349.33 1857.34 L2349.33 1852.82 L2363.71 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip380)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="152.071,1800.78 152.071,47.2441 "></polyline>
<polyline clip-path="url(#clip380)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="152.071,1615.13 170.969,1615.13 "></polyline>
<polyline clip-path="url(#clip380)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="152.071,1277.14 170.969,1277.14 "></polyline>
<polyline clip-path="url(#clip380)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="152.071,939.136 170.969,939.136 "></polyline>
<polyline clip-path="url(#clip380)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="152.071,601.137 170.969,601.137 "></polyline>
<polyline clip-path="url(#clip380)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="152.071,263.138 170.969,263.138 "></polyline>
<path clip-path="url(#clip380)" d="M49.5521 1615.59 L79.2279 1615.59 L79.2279 1619.52 L49.5521 1619.52 L49.5521 1615.59 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip380)" d="M102.168 1601.93 L90.3621 1620.38 L102.168 1620.38 L102.168 1601.93 M100.941 1597.85 L106.82 1597.85 L106.82 1620.38 L111.751 1620.38 L111.751 1624.27 L106.82 1624.27 L106.82 1632.41 L102.168 1632.41 L102.168 1624.27 L86.5658 1624.27 L86.5658 1619.75 L100.941 1597.85 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip380)" d="M51.6354 1277.59 L81.3112 1277.59 L81.3112 1281.52 L51.6354 1281.52 L51.6354 1277.59 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip380)" d="M95.4315 1290.48 L111.751 1290.48 L111.751 1294.42 L89.8065 1294.42 L89.8065 1290.48 Q92.4686 1287.73 97.0519 1283.1 Q101.658 1278.44 102.839 1277.1 Q105.084 1274.58 105.964 1272.84 Q106.867 1271.08 106.867 1269.39 Q106.867 1266.64 104.922 1264.9 Q103.001 1263.17 99.8991 1263.17 Q97.7 1263.17 95.2463 1263.93 Q92.8158 1264.69 90.038 1266.24 L90.038 1261.52 Q92.8621 1260.39 95.3158 1259.81 Q97.7695 1259.23 99.8065 1259.23 Q105.177 1259.23 108.371 1261.92 Q111.566 1264.6 111.566 1269.09 Q111.566 1271.22 110.756 1273.14 Q109.968 1275.04 107.862 1277.63 Q107.283 1278.3 104.181 1281.52 Q101.08 1284.72 95.4315 1290.48 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip380)" d="M99.8065 924.935 Q96.1954 924.935 94.3667 928.499 Q92.5612 932.041 92.5612 939.171 Q92.5612 946.277 94.3667 949.842 Q96.1954 953.384 99.8065 953.384 Q103.441 953.384 105.246 949.842 Q107.075 946.277 107.075 939.171 Q107.075 932.041 105.246 928.499 Q103.441 924.935 99.8065 924.935 M99.8065 921.231 Q105.617 921.231 108.672 925.837 Q111.751 930.421 111.751 939.171 Q111.751 947.897 108.672 952.504 Q105.617 957.087 99.8065 957.087 Q93.9963 957.087 90.9176 952.504 Q87.8621 947.897 87.8621 939.171 Q87.8621 930.421 90.9176 925.837 Q93.9963 921.231 99.8065 921.231 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip380)" d="M95.4315 614.482 L111.751 614.482 L111.751 618.417 L89.8065 618.417 L89.8065 614.482 Q92.4686 611.727 97.0519 607.097 Q101.658 602.445 102.839 601.102 Q105.084 598.579 105.964 596.843 Q106.867 595.084 106.867 593.394 Q106.867 590.639 104.922 588.903 Q103.001 587.167 99.8991 587.167 Q97.7 587.167 95.2463 587.931 Q92.8158 588.695 90.038 590.246 L90.038 585.523 Q92.8621 584.389 95.3158 583.81 Q97.7695 583.232 99.8065 583.232 Q105.177 583.232 108.371 585.917 Q111.566 588.602 111.566 593.093 Q111.566 595.222 110.756 597.144 Q109.968 599.042 107.862 601.634 Q107.283 602.306 104.181 605.523 Q101.08 608.718 95.4315 614.482 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip380)" d="M102.168 249.932 L90.3621 268.381 L102.168 268.381 L102.168 249.932 M100.941 245.858 L106.82 245.858 L106.82 268.381 L111.751 268.381 L111.751 272.269 L106.82 272.269 L106.82 280.418 L102.168 280.418 L102.168 272.269 L86.5658 272.269 L86.5658 267.756 L100.941 245.858 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><circle clip-path="url(#clip382)" cx="1705.23" cy="680.446" r="14.4" fill="#ff0000" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.84"></circle>
<circle clip-path="url(#clip382)" cx="2149.71" cy="284.476" r="14.4" fill="#ff0000" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.84"></circle>
<circle clip-path="url(#clip382)" cx="2205.38" cy="280.738" r="14.4" fill="#ff0000" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.84"></circle>
<circle clip-path="url(#clip382)" cx="1968.97" cy="434.435" r="14.4" fill="#ff0000" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.84"></circle>
<circle clip-path="url(#clip382)" cx="1965.22" cy="636.918" r="14.4" fill="#ff0000" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.84"></circle>
<circle clip-path="url(#clip382)" cx="2570.32" cy="791.18" r="14.4" fill="#ff0000" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.84"></circle>
<circle clip-path="url(#clip382)" cx="1635.72" cy="324.956" r="14.4" fill="#ff0000" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.84"></circle>
<circle clip-path="url(#clip382)" cx="1543.95" cy="454.77" r="14.4" fill="#ff0000" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.84"></circle>
<circle clip-path="url(#clip382)" cx="1907.17" cy="217.047" r="14.4" fill="#ff0000" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.84"></circle>
<circle clip-path="url(#clip382)" cx="2085.91" cy="215.33" r="14.4" fill="#ff0000" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.84"></circle>
<circle clip-path="url(#clip382)" cx="1961.38" cy="348.264" r="14.4" fill="#ff0000" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.84"></circle>
<circle clip-path="url(#clip382)" cx="2213.72" cy="456.175" r="14.4" fill="#ff0000" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.84"></circle>
<circle clip-path="url(#clip382)" cx="2368.26" cy="200.3" r="14.4" fill="#ff0000" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.84"></circle>
<circle clip-path="url(#clip382)" cx="2428.24" cy="844.867" r="14.4" fill="#ff0000" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.84"></circle>
<circle clip-path="url(#clip382)" cx="1586.36" cy="233.369" r="14.4" fill="#ff0000" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.84"></circle>
<circle clip-path="url(#clip382)" cx="2564.97" cy="546.079" r="14.4" fill="#ff0000" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.84"></circle>
<circle clip-path="url(#clip382)" cx="1962.79" cy="722.24" r="14.4" fill="#ff0000" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.84"></circle>
<circle clip-path="url(#clip382)" cx="1668.46" cy="300.581" r="14.4" fill="#ff0000" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.84"></circle>
<circle clip-path="url(#clip382)" cx="2447.38" cy="563.697" r="14.4" fill="#ff0000" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.84"></circle>
<circle clip-path="url(#clip382)" cx="2542.78" cy="852.525" r="14.4" fill="#ff0000" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.84"></circle>
<circle clip-path="url(#clip382)" cx="1266.2" cy="1526.95" r="14.4" fill="#ff0000" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.84"></circle>
<circle clip-path="url(#clip382)" cx="439.053" cy="1570.17" r="14.4" fill="#ff0000" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.84"></circle>
<circle clip-path="url(#clip382)" cx="901.179" cy="1294.47" r="14.4" fill="#ff0000" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.84"></circle>
<circle clip-path="url(#clip382)" cx="645.329" cy="1674.03" r="14.4" fill="#ff0000" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.84"></circle>
<circle clip-path="url(#clip382)" cx="1154.21" cy="1714.75" r="14.4" fill="#ff0000" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.84"></circle>
<circle clip-path="url(#clip382)" cx="693.778" cy="1552.32" r="14.4" fill="#ff0000" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.84"></circle>
<circle clip-path="url(#clip382)" cx="445.692" cy="1043.74" r="14.4" fill="#ff0000" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.84"></circle>
<circle clip-path="url(#clip382)" cx="491.326" cy="1621.22" r="14.4" fill="#ff0000" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.84"></circle>
<circle clip-path="url(#clip382)" cx="222.505" cy="1252.62" r="14.4" fill="#ff0000" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.84"></circle>
<circle clip-path="url(#clip382)" cx="1066.27" cy="1657.43" r="14.4" fill="#ff0000" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.84"></circle>
<circle clip-path="url(#clip382)" cx="1212.41" cy="1350.82" r="14.4" fill="#ff0000" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.84"></circle>
<circle clip-path="url(#clip382)" cx="710.52" cy="1705.48" r="14.4" fill="#ff0000" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.84"></circle>
<circle clip-path="url(#clip382)" cx="983.189" cy="1086.82" r="14.4" fill="#ff0000" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.84"></circle>
<circle clip-path="url(#clip382)" cx="731.924" cy="1342.4" r="14.4" fill="#ff0000" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.84"></circle>
<circle clip-path="url(#clip382)" cx="821.069" cy="1220.44" r="14.4" fill="#ff0000" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.84"></circle>
<circle clip-path="url(#clip382)" cx="509.81" cy="1120.37" r="14.4" fill="#ff0000" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.84"></circle>
<circle clip-path="url(#clip382)" cx="461.833" cy="1441.45" r="14.4" fill="#ff0000" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.84"></circle>
<circle clip-path="url(#clip382)" cx="708.329" cy="1751.15" r="14.4" fill="#ff0000" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.84"></circle>
<circle clip-path="url(#clip382)" cx="372.869" cy="1038.71" r="14.4" fill="#ff0000" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.84"></circle>
<circle clip-path="url(#clip382)" cx="659.463" cy="1114.25" r="14.4" fill="#ff0000" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.84"></circle>
<circle clip-path="url(#clip382)" cx="1777.33" cy="1491.59" r="14.4" fill="#0000ff" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.84"></circle>
<circle clip-path="url(#clip382)" cx="1971.34" cy="1031.36" r="14.4" fill="#0000ff" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.84"></circle>
<circle clip-path="url(#clip382)" cx="1921.2" cy="1230.82" r="14.4" fill="#0000ff" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.84"></circle>
<circle clip-path="url(#clip382)" cx="1833.21" cy="1577.14" r="14.4" fill="#0000ff" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.84"></circle>
<circle clip-path="url(#clip382)" cx="1584.75" cy="1530.4" r="14.4" fill="#0000ff" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.84"></circle>
<circle clip-path="url(#clip382)" cx="1815.58" cy="1126.52" r="14.4" fill="#0000ff" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.84"></circle>
<circle clip-path="url(#clip382)" cx="2530.15" cy="1736.89" r="14.4" fill="#0000ff" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.84"></circle>
<circle clip-path="url(#clip382)" cx="1766.96" cy="1099.19" r="14.4" fill="#0000ff" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.84"></circle>
<circle clip-path="url(#clip382)" cx="2428.06" cy="1062.62" r="14.4" fill="#0000ff" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.84"></circle>
<circle clip-path="url(#clip382)" cx="2056.06" cy="1030.07" r="14.4" fill="#0000ff" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.84"></circle>
<circle clip-path="url(#clip382)" cx="2203.55" cy="1041.96" r="14.4" fill="#0000ff" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.84"></circle>
<circle clip-path="url(#clip382)" cx="1748.49" cy="1716.47" r="14.4" fill="#0000ff" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.84"></circle>
<circle clip-path="url(#clip382)" cx="2506.83" cy="1549.45" r="14.4" fill="#0000ff" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.84"></circle>
<circle clip-path="url(#clip382)" cx="1691.02" cy="1561.42" r="14.4" fill="#0000ff" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.84"></circle>
<circle clip-path="url(#clip382)" cx="1881.7" cy="1670.36" r="14.4" fill="#0000ff" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.84"></circle>
<circle clip-path="url(#clip382)" cx="2110.98" cy="1691.42" r="14.4" fill="#0000ff" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.84"></circle>
<circle clip-path="url(#clip382)" cx="1612.29" cy="1402.39" r="14.4" fill="#0000ff" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.84"></circle>
<circle clip-path="url(#clip382)" cx="1797.66" cy="1644.46" r="14.4" fill="#0000ff" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.84"></circle>
<circle clip-path="url(#clip382)" cx="2275.5" cy="1103.97" r="14.4" fill="#0000ff" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.84"></circle>
<circle clip-path="url(#clip382)" cx="1787.2" cy="1369.98" r="14.4" fill="#0000ff" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.84"></circle>
<circle clip-path="url(#clip382)" cx="267.562" cy="155.289" r="14.4" fill="#0000ff" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.84"></circle>
<circle clip-path="url(#clip382)" cx="254.305" cy="831.263" r="14.4" fill="#0000ff" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.84"></circle>
<circle clip-path="url(#clip382)" cx="1282.04" cy="843.893" r="14.4" fill="#0000ff" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.84"></circle>
<circle clip-path="url(#clip382)" cx="570.784" cy="407.369" r="14.4" fill="#0000ff" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.84"></circle>
<circle clip-path="url(#clip382)" cx="1189.37" cy="274.961" r="14.4" fill="#0000ff" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.84"></circle>
<circle clip-path="url(#clip382)" cx="549.034" cy="96.8724" r="14.4" fill="#0000ff" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.84"></circle>
<circle clip-path="url(#clip382)" cx="660.931" cy="347.011" r="14.4" fill="#0000ff" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.84"></circle>
<circle clip-path="url(#clip382)" cx="1146.87" cy="308.505" r="14.4" fill="#0000ff" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.84"></circle>
<circle clip-path="url(#clip382)" cx="1010.19" cy="123.257" r="14.4" fill="#0000ff" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.84"></circle>
<circle clip-path="url(#clip382)" cx="1056.62" cy="485.497" r="14.4" fill="#0000ff" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.84"></circle>
<circle clip-path="url(#clip382)" cx="853.003" cy="661.865" r="14.4" fill="#0000ff" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.84"></circle>
<circle clip-path="url(#clip382)" cx="825.116" cy="725.352" r="14.4" fill="#0000ff" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.84"></circle>
<circle clip-path="url(#clip382)" cx="561.634" cy="339.815" r="14.4" fill="#0000ff" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.84"></circle>
<circle clip-path="url(#clip382)" cx="944.716" cy="231.547" r="14.4" fill="#0000ff" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.84"></circle>
<circle clip-path="url(#clip382)" cx="865.129" cy="605.61" r="14.4" fill="#0000ff" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.84"></circle>
<circle clip-path="url(#clip382)" cx="1204.83" cy="578.382" r="14.4" fill="#0000ff" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.84"></circle>
<circle clip-path="url(#clip382)" cx="1082.51" cy="292.216" r="14.4" fill="#0000ff" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.84"></circle>
<circle clip-path="url(#clip382)" cx="473.256" cy="826.13" r="14.4" fill="#0000ff" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.84"></circle>
<circle clip-path="url(#clip382)" cx="671.681" cy="143.571" r="14.4" fill="#0000ff" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.84"></circle>
<circle clip-path="url(#clip382)" cx="1042.04" cy="713.941" r="14.4" fill="#0000ff" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="3.84"></circle>
<path clip-path="url(#clip380)" d="M2256.5 261.215 L2557.8 261.215 L2557.8 105.695 L2256.5 105.695  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<polyline clip-path="url(#clip380)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="2256.5,261.215 2557.8,261.215 2557.8,105.695 2256.5,105.695 2256.5,261.215 "></polyline>
<circle clip-path="url(#clip380)" cx="2367.11" cy="157.535" r="20.48" fill="#ff0000" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="5.46133"></circle>
<path clip-path="url(#clip380)" d="M2491.56 177.223 Q2489.75 181.852 2488.04 183.264 Q2486.33 184.676 2483.46 184.676 L2480.06 184.676 L2480.06 181.112 L2482.56 181.112 Q2484.31 181.112 2485.29 180.278 Q2486.26 179.445 2487.44 176.343 L2488.2 174.399 L2477.72 148.889 L2482.23 148.889 L2490.33 169.167 L2498.43 148.889 L2502.95 148.889 L2491.56 177.223 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip380)" d="M2510.24 170.88 L2517.88 170.88 L2517.88 144.515 L2509.57 146.181 L2509.57 141.922 L2517.83 140.255 L2522.51 140.255 L2522.51 170.88 L2530.15 170.88 L2530.15 174.815 L2510.24 174.815 L2510.24 170.88 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><circle clip-path="url(#clip380)" cx="2367.11" cy="209.375" r="20.48" fill="#0000ff" fill-rule="evenodd" fill-opacity="1" stroke="#000000" stroke-opacity="1" stroke-width="5.46133"></circle>
<path clip-path="url(#clip380)" d="M2491.56 229.063 Q2489.75 233.692 2488.04 235.104 Q2486.33 236.516 2483.46 236.516 L2480.06 236.516 L2480.06 232.952 L2482.56 232.952 Q2484.31 232.952 2485.29 232.118 Q2486.26 231.285 2487.44 228.183 L2488.2 226.239 L2477.72 200.729 L2482.23 200.729 L2490.33 221.007 L2498.43 200.729 L2502.95 200.729 L2491.56 229.063 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip380)" d="M2513.46 222.72 L2529.78 222.72 L2529.78 226.655 L2507.83 226.655 L2507.83 222.72 Q2510.5 219.965 2515.08 215.336 Q2519.68 210.683 2520.87 209.341 Q2523.11 206.817 2523.99 205.081 Q2524.89 203.322 2524.89 201.632 Q2524.89 198.878 2522.95 197.142 Q2521.03 195.405 2517.93 195.405 Q2515.73 195.405 2513.27 196.169 Q2510.84 196.933 2508.06 198.484 L2508.06 193.762 Q2510.89 192.628 2513.34 192.049 Q2515.8 191.47 2517.83 191.47 Q2523.2 191.47 2526.4 194.155 Q2529.59 196.841 2529.59 201.331 Q2529.59 203.461 2528.78 205.382 Q2527.99 207.28 2525.89 209.873 Q2525.31 210.544 2522.21 213.762 Q2519.11 216.956 2513.46 222.72 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path></svg>
</div>
</div>
<section id="building-a-neural-network" class="level2">
<h2 class="anchored" data-anchor-id="building-a-neural-network">Building a Neural Network</h2>
<p>The next step is to define a <a href="https://en.wikipedia.org/wiki/Feedforward_neural_network">feedforward neural network</a> where we express our parameters as distributions, and not single points as with traditional neural networks. For this we will use <code>Dense</code> to define liner layers and compose them via <code>Chain</code>, both are neural network primitives from Lux. The network <code>nn_initial</code> we created has two hidden layers with <code>tanh</code> activations and one output layer with sigmoid (<code>σ</code>) activation, as shown below.</p>
<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>
<svg width="672" height="480" viewbox="0.00 0.00 446.00 358.40" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" style="; max-width: none; max-height: none">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 354.4)">
<title>G</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-354.4 442,-354.4 442,4 -4,4"></polygon>
<text text-anchor="middle" x="219" y="-9.1" font-family="Times,serif" font-size="17.00">Input layer &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Hidden layers &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Output layer</text>
<g id="clust1" class="cluster">
<title>cluster_input</title>
<path fill="none" stroke="black" d="M20,-94.4C20,-94.4 70,-94.4 70,-94.4 76,-94.4 82,-100.4 82,-106.4 82,-106.4 82,-272.4 82,-272.4 82,-278.4 76,-284.4 70,-284.4 70,-284.4 20,-284.4 20,-284.4 14,-284.4 8,-278.4 8,-272.4 8,-272.4 8,-106.4 8,-106.4 8,-100.4 14,-94.4 20,-94.4"></path>
</g>
<g id="clust2" class="cluster">
<title>cluster_hidden1</title>
<path fill="none" stroke="black" d="M136,-36.4C136,-36.4 186,-36.4 186,-36.4 192,-36.4 198,-42.4 198,-48.4 198,-48.4 198,-330.4 198,-330.4 198,-336.4 192,-342.4 186,-342.4 186,-342.4 136,-342.4 136,-342.4 130,-342.4 124,-336.4 124,-330.4 124,-330.4 124,-48.4 124,-48.4 124,-42.4 130,-36.4 136,-36.4"></path>
</g>
<g id="clust3" class="cluster">
<title>cluster_hidden2</title>
<path fill="none" stroke="black" d="M252,-36.4C252,-36.4 302,-36.4 302,-36.4 308,-36.4 314,-42.4 314,-48.4 314,-48.4 314,-214.4 314,-214.4 314,-220.4 308,-226.4 302,-226.4 302,-226.4 252,-226.4 252,-226.4 246,-226.4 240,-220.4 240,-214.4 240,-214.4 240,-48.4 240,-48.4 240,-42.4 246,-36.4 252,-36.4"></path>
</g>
<g id="clust4" class="cluster">
<title>cluster_output</title>
<path fill="none" stroke="black" d="M368,-94.4C368,-94.4 418,-94.4 418,-94.4 424,-94.4 430,-100.4 430,-106.4 430,-106.4 430,-156.4 430,-156.4 430,-162.4 424,-168.4 418,-168.4 418,-168.4 368,-168.4 368,-168.4 362,-168.4 356,-162.4 356,-156.4 356,-156.4 356,-106.4 356,-106.4 356,-100.4 362,-94.4 368,-94.4"></path>
</g>
<!-- input1 -->
<g id="node1" class="node">
<title>input1</title>
<ellipse fill="white" stroke="black" cx="45" cy="-247.4" rx="29" ry="29"></ellipse>
</g>
<!-- hidden11 -->
<g id="node3" class="node">
<title>hidden11</title>
<ellipse fill="white" stroke="black" cx="161" cy="-73.4" rx="29" ry="29"></ellipse>
</g>
<!-- input1&#45;&#45;hidden11 -->
<g id="edge1" class="edge">
<title>input1--hidden11</title>
<path fill="none" stroke="black" d="M61.61,-223.57C83.38,-190.34 122.63,-130.44 144.39,-97.22"></path>
</g>
<!-- hidden12 -->
<g id="node4" class="node">
<title>hidden12</title>
<ellipse fill="white" stroke="black" cx="161" cy="-305.4" rx="29" ry="29"></ellipse>
</g>
<!-- input1&#45;&#45;hidden12 -->
<g id="edge2" class="edge">
<title>input1--hidden12</title>
<path fill="none" stroke="black" d="M71.3,-260.27C90.19,-269.88 115.9,-282.96 134.77,-292.56"></path>
</g>
<!-- hidden13 -->
<g id="node5" class="node">
<title>hidden13</title>
<ellipse fill="white" stroke="black" cx="161" cy="-189.4" rx="29" ry="29"></ellipse>
</g>
<!-- input1&#45;&#45;hidden13 -->
<g id="edge3" class="edge">
<title>input1--hidden13</title>
<path fill="none" stroke="black" d="M71.3,-234.53C90.19,-224.92 115.9,-211.84 134.77,-202.24"></path>
</g>
<!-- input2 -->
<g id="node2" class="node">
<title>input2</title>
<ellipse fill="white" stroke="black" cx="45" cy="-131.4" rx="29" ry="29"></ellipse>
</g>
<!-- input2&#45;&#45;hidden11 -->
<g id="edge4" class="edge">
<title>input2--hidden11</title>
<path fill="none" stroke="black" d="M71.3,-118.53C90.19,-108.92 115.9,-95.84 134.77,-86.24"></path>
</g>
<!-- input2&#45;&#45;hidden12 -->
<g id="edge5" class="edge">
<title>input2--hidden12</title>
<path fill="none" stroke="black" d="M61.61,-155.23C83.38,-188.46 122.63,-248.36 144.39,-281.58"></path>
</g>
<!-- input2&#45;&#45;hidden13 -->
<g id="edge6" class="edge">
<title>input2--hidden13</title>
<path fill="none" stroke="black" d="M71.3,-144.27C90.19,-153.88 115.9,-166.96 134.77,-176.56"></path>
</g>
<!-- hidden21 -->
<g id="node6" class="node">
<title>hidden21</title>
<ellipse fill="white" stroke="black" cx="277" cy="-189.4" rx="29" ry="29"></ellipse>
</g>
<!-- hidden11&#45;&#45;hidden21 -->
<g id="edge7" class="edge">
<title>hidden11--hidden21</title>
<path fill="none" stroke="black" d="M181.86,-93.61C202.65,-114.77 235.13,-147.82 255.99,-169.04"></path>
</g>
<!-- hidden22 -->
<g id="node7" class="node">
<title>hidden22</title>
<ellipse fill="white" stroke="black" cx="277" cy="-73.4" rx="29" ry="29"></ellipse>
</g>
<!-- hidden11&#45;&#45;hidden22 -->
<g id="edge8" class="edge">
<title>hidden11--hidden22</title>
<path fill="none" stroke="black" d="M190.18,-73.4C207.72,-73.4 230.2,-73.4 247.75,-73.4"></path>
</g>
<!-- hidden12&#45;&#45;hidden21 -->
<g id="edge9" class="edge">
<title>hidden12--hidden21</title>
<path fill="none" stroke="black" d="M181.86,-285.19C202.65,-264.03 235.13,-230.98 255.99,-209.76"></path>
</g>
<!-- hidden12&#45;&#45;hidden22 -->
<g id="edge10" class="edge">
<title>hidden12--hidden22</title>
<path fill="none" stroke="black" d="M178.22,-281.77C184.87,-271.49 192.31,-259.13 198,-247.4 221.92,-198.06 216.08,-180.74 240,-131.4 245.69,-119.67 253.13,-107.31 259.78,-97.03"></path>
</g>
<!-- hidden13&#45;&#45;hidden21 -->
<g id="edge11" class="edge">
<title>hidden13--hidden21</title>
<path fill="none" stroke="black" d="M190.18,-189.4C207.72,-189.4 230.2,-189.4 247.75,-189.4"></path>
</g>
<!-- hidden13&#45;&#45;hidden22 -->
<g id="edge12" class="edge">
<title>hidden13--hidden22</title>
<path fill="none" stroke="black" d="M181.86,-169.19C202.65,-148.03 235.13,-114.98 255.99,-93.76"></path>
</g>
<!-- output1 -->
<g id="node8" class="node">
<title>output1</title>
<ellipse fill="white" stroke="black" cx="393" cy="-131.4" rx="29" ry="29"></ellipse>
</g>
<!-- hidden21&#45;&#45;output1 -->
<g id="edge13" class="edge">
<title>hidden21--output1</title>
<path fill="none" stroke="black" d="M303.3,-176.53C322.19,-166.92 347.9,-153.84 366.77,-144.24"></path>
</g>
<!-- hidden22&#45;&#45;output1 -->
<g id="edge14" class="edge">
<title>hidden22--output1</title>
<path fill="none" stroke="black" d="M303.3,-86.27C322.19,-95.88 347.9,-108.96 366.77,-118.56"></path>
</g>
</g>
</svg>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
<p>The <code>nn_initial</code> is an instance that acts as a function and can take data as inputs and output predictions. We will define distributions on the neural network parameters. <!-- and use `destructure` from Flux to extract the parameters as `parameters_initial`.
The function `destructure` also returns another function `reconstruct` that can take (new) parameters in and return us a neural network instance whose architecture is the same as `nn_initial` but with updated parameters. --></p>
<div id="8" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Construct a neural network using Lux</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>nn_initial <span class="op">=</span> <span class="fu">Chain</span>(<span class="fu">Dense</span>(<span class="fl">2</span> <span class="op">=&gt;</span> <span class="fl">3</span>, tanh), <span class="fu">Dense</span>(<span class="fl">3</span> <span class="op">=&gt;</span> <span class="fl">2</span>, tanh), <span class="fu">Dense</span>(<span class="fl">2</span> <span class="op">=&gt;</span> <span class="fl">1</span>, σ))</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize the model weights and state</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>ps, st <span class="op">=</span> Lux.<span class="fu">setup</span>(rng, nn_initial)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>Lux.<span class="fu">parameterlength</span>(nn_initial) <span class="co"># number of paraemters in NN</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>20</code></pre>
</div>
</div>
<p>The probabilistic model specification below creates a <code>parameters</code> variable, which has IID normal variables. The <code>parameters</code> vector represents all parameters of our neural net (weights and biases).</p>
<div id="10" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a regularization term and a Gaussian prior variance term.</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>alpha <span class="op">=</span> <span class="fl">0.09</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>sigma <span class="op">=</span> <span class="fu">sqrt</span>(<span class="fl">1.0</span> <span class="op">/</span> alpha)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3.3333333333333335</code></pre>
</div>
</div>
<p>Construct named tuple from a sampled parameter vector. We could also use ComponentArrays here and simply broadcast to avoid doing this. But let’s do it this way to avoid dependencies.</p>
<div id="12" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">vector_to_parameters</span>(ps_new<span class="op">::</span><span class="dt">AbstractVector</span>, ps<span class="op">::</span><span class="dt">NamedTuple</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="pp">@assert</span> <span class="fu">length</span>(ps_new) <span class="op">==</span> Lux.<span class="fu">parameterlength</span>(ps)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    i <span class="op">=</span> <span class="fl">1</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">function</span> <span class="fu">get_ps</span>(x)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>        z <span class="op">=</span> <span class="fu">reshape</span>(<span class="fu">view</span>(ps_new, i<span class="op">:</span>(i <span class="op">+</span> <span class="fu">length</span>(x) <span class="op">-</span> <span class="fl">1</span>)), <span class="fu">size</span>(x))</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>        i <span class="op">+=</span> <span class="fu">length</span>(x)</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> z</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">end</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">fmap</span>(get_ps, ps)</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>vector_to_parameters (generic function with 1 method)</code></pre>
</div>
</div>
<p>To interface with external libraries it is often desirable to use the <a href="https://lux.csail.mit.edu/stable/api/Lux/contrib#StatefulLuxLayer"><code>StatefulLuxLayer</code></a> to automatically handle the neural network states.</p>
<div id="14" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> nn <span class="op">=</span> <span class="fu">StatefulLuxLayer</span>(nn_initial, st)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify the probabilistic model.</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="kw">function</span> <span class="fu">bayes_nn</span>(xs, ts; sigma <span class="op">=</span> sigma, ps <span class="op">=</span> ps, nn <span class="op">=</span> nn)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sample the parameters</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    nparameters <span class="op">=</span> Lux.<span class="fu">parameterlength</span>(nn_initial)</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    parameters <span class="op">~</span> <span class="fu">MvNormal</span>(<span class="fu">zeros</span>(nparameters), <span class="fu">Diagonal</span>(<span class="fu">abs2</span>.(sigma <span class="op">.*</span> <span class="fu">ones</span>(nparameters))))</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Forward NN to make predictions</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    preds <span class="op">=</span> Lux.<span class="fu">apply</span>(nn, xs, <span class="fu">vector_to_parameters</span>(parameters, ps))</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Observe each prediction.</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="fu">eachindex</span>(ts)</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>        ts[i] <span class="op">~</span> <span class="fu">Bernoulli</span>(preds[i])</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>UndefVarError: UndefVarError(:StatefulLuxLayer)
UndefVarError: `StatefulLuxLayer` not defined
Stacktrace:
 [1] top-level scope
   @ ~/work/docs/docs/tutorials/03-bayesian-neural-network/index.qmd:226</code></pre>
</div>
</div>
<p>Inference can now be performed by calling <code>sample</code>. We use the <code>NUTS</code> Hamiltonian Monte Carlo sampler here.</p>
<div id="16" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">setprogress!</span>(<span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="18" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform inference.</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>N <span class="op">=</span> <span class="fl">2_000</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>ch <span class="op">=</span> <span class="fu">sample</span>(<span class="fu">bayes_nn</span>(<span class="fu">reduce</span>(hcat, xs), ts), <span class="fu">NUTS</span>(; adtype<span class="op">=</span><span class="fu">AutoTracker</span>()), N);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>UndefVarError: 
UndefVarError: `bayes_nn` not defined
Stacktrace:
 [1] top-level scope
   @ ~/work/docs/docs/tutorials/03-bayesian-neural-network/index.qmd:259</code></pre>
</div>
</div>
<p>Now we extract the parameter samples from the sampled chain as <code>θ</code> (this is of size <code>5000 x 20</code> where <code>5000</code> is the number of iterations and <code>20</code> is the number of parameters). We’ll use these primarily to determine how good our model’s classifier is.</p>
<div id="20" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract all weight and bias parameters.</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>θ <span class="op">=</span> MCMCChains.<span class="fu">group</span>(ch, <span class="op">:</span>parameters).value;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>UndefVarError: 
UndefVarError: `ch` not defined
Stacktrace:
 [1] top-level scope
   @ ~/work/docs/docs/tutorials/03-bayesian-neural-network/index.qmd:273</code></pre>
</div>
</div>
</section>
<section id="prediction-visualization" class="level2">
<h2 class="anchored" data-anchor-id="prediction-visualization">Prediction Visualization</h2>
<p>We can use <a href="https://en.wikipedia.org/wiki/Maximum_a_posteriori_estimation">MAP estimation</a> to classify our population by using the set of weights that provided the highest log posterior.</p>
<div id="22" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># A helper to run the nn through data `x` using parameters `θ`</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">nn_forward</span>(x, θ) <span class="op">=</span> <span class="fu">nn</span>(x, <span class="fu">vector_to_parameters</span>(θ, ps))</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the data we have.</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> <span class="fu">plot_data</span>()</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Find the index that provided the highest log posterior in the chain.</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>_, i <span class="op">=</span> <span class="fu">findmax</span>(ch[<span class="op">:</span>lp])</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the max row value from i.</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>i <span class="op">=</span> i.I[<span class="fl">1</span>]</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the posterior distribution with a contour plot</span></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>x1_range <span class="op">=</span> <span class="fu">collect</span>(<span class="fu">range</span>(<span class="op">-</span><span class="fl">6</span>; stop<span class="op">=</span><span class="fl">6</span>, length<span class="op">=</span><span class="fl">25</span>))</span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>x2_range <span class="op">=</span> <span class="fu">collect</span>(<span class="fu">range</span>(<span class="op">-</span><span class="fl">6</span>; stop<span class="op">=</span><span class="fl">6</span>, length<span class="op">=</span><span class="fl">25</span>))</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>Z <span class="op">=</span> [<span class="fu">nn_forward</span>([x1, x2], θ[i, <span class="op">:</span>])[<span class="fl">1</span>] for x1 <span class="kw">in</span> x1_range, x2 <span class="kw">in</span> x2_range]</span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a><span class="fu">contour!</span>(x1_range, x2_range, Z; linewidth<span class="op">=</span><span class="fl">3</span>, colormap<span class="op">=:</span>seaborn_bright)</span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>fig</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>UndefVarError: UndefVarError(:ch)
UndefVarError: `ch` not defined
Stacktrace:
 [1] top-level scope
   @ ~/work/docs/docs/tutorials/03-bayesian-neural-network/index.qmd:295</code></pre>
</div>
</div>
<p>The contour plot above shows that the MAP method is not too bad at classifying our data.</p>
<p>Now we can visualize our predictions.</p>
<p><span class="math display">\[
p(\tilde{x} | X, \alpha) = \int_{\theta} p(\tilde{x} | \theta) p(\theta | X, \alpha) \approx \sum_{\theta \sim p(\theta | X, \alpha)}f_{\theta}(\tilde{x})
\]</span></p>
<p>The <code>nn_predict</code> function takes the average predicted value from a network parameterized by weights drawn from the MCMC chain.</p>
<div id="24" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Return the average predicted value across</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="co"># multiple weights.</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">nn_predict</span>(x, θ, num)</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>    num <span class="op">=</span> <span class="fu">min</span>(num, <span class="fu">size</span>(θ, <span class="fl">1</span>))  <span class="co"># make sure num does not exceed the number of samples</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">mean</span>([<span class="fu">first</span>(<span class="fu">nn_forward</span>(x, <span class="fu">view</span>(θ, i, <span class="op">:</span>))) for i <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">:</span>num])</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>nn_predict (generic function with 1 method)</code></pre>
</div>
</div>
<p>Next, we use the <code>nn_predict</code> function to predict the value at a sample of points where the <code>x1</code> and <code>x2</code> coordinates range between -6 and 6. As we can see below, we still have a satisfactory fit to our data, and more importantly, we can also see where the neural network is uncertain about its predictions much easier—those regions between cluster boundaries.</p>
<div id="26" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the average prediction.</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> <span class="fu">plot_data</span>()</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>n_end <span class="op">=</span> <span class="fl">1500</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>x1_range <span class="op">=</span> <span class="fu">collect</span>(<span class="fu">range</span>(<span class="op">-</span><span class="fl">6</span>; stop<span class="op">=</span><span class="fl">6</span>, length<span class="op">=</span><span class="fl">25</span>))</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>x2_range <span class="op">=</span> <span class="fu">collect</span>(<span class="fu">range</span>(<span class="op">-</span><span class="fl">6</span>; stop<span class="op">=</span><span class="fl">6</span>, length<span class="op">=</span><span class="fl">25</span>))</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>Z <span class="op">=</span> [<span class="fu">nn_predict</span>([x1, x2], θ, n_end)[<span class="fl">1</span>] for x1 <span class="kw">in</span> x1_range, x2 <span class="kw">in</span> x2_range]</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a><span class="fu">contour!</span>(x1_range, x2_range, Z; linewidth<span class="op">=</span><span class="fl">3</span>, colormap<span class="op">=:</span>seaborn_bright)</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>fig</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>UndefVarError: UndefVarError(:θ)
UndefVarError: `θ` not defined
Stacktrace:
 [1] (::var"#20#21")(::Tuple{Float64, Float64})
   @ Main.Notebook ./none:0
 [2] iterate
   @ ./generator.jl:47 [inlined]
 [3] collect(itr::Base.Generator{Base.Iterators.ProductIterator{Tuple{Vector{Float64}, Vector{Float64}}}, var"#20#21"})
   @ Base ./array.jl:834
 [4] top-level scope
   @ ~/work/docs/docs/tutorials/03-bayesian-neural-network/index.qmd:348</code></pre>
</div>
</div>
<p>Suppose we are interested in how the predictive power of our Bayesian neural network evolved between samples. In that case, the following graph displays an animation of the contour plot generated from the network weights in samples 1 to 1,000.</p>
<div id="28" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Number of iterations to plot.</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>n_end <span class="op">=</span> <span class="fl">500</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>anim <span class="op">=</span> <span class="pp">@gif</span> <span class="cf">for</span> i <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span>n_end</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot_data</span>()</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>    Z <span class="op">=</span> [<span class="fu">nn_forward</span>([x1, x2], θ[i, <span class="op">:</span>])[<span class="fl">1</span>] for x1 <span class="kw">in</span> x1_range, x2 <span class="kw">in</span> x2_range]</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">contour!</span>(x1_range, x2_range, Z; title<span class="op">=</span><span class="st">"Iteration </span><span class="sc">$</span>i<span class="st">"</span>, clim<span class="op">=</span>(<span class="fl">0</span>, <span class="fl">1</span>))</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span> every <span class="fl">5</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>UndefVarError: UndefVarError(:θ)
UndefVarError: `θ` not defined
Stacktrace:
 [1] (::var"#22#23"{Int64})(::Tuple{Float64, Float64})
   @ Main.Notebook ./none:0
 [2] iterate
   @ ./generator.jl:47 [inlined]
 [3] collect(itr::Base.Generator{Base.Iterators.ProductIterator{Tuple{Vector{Float64}, Vector{Float64}}}, var"#22#23"{Int64}})
   @ Base ./array.jl:834
 [4] macro expansion
   @ ~/work/docs/docs/tutorials/03-bayesian-neural-network/index.qmd:367 [inlined]
 [5] top-level scope
   @ ~/.julia/packages/Plots/kLeqV/src/animation.jl:251</code></pre>
</div>
</div>
<p>This has been an introduction to the applications of Turing and Lux in defining Bayesian neural networks.</p>


</section>

<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/turinglang\.org\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../tutorials/02-logistic-regression/index.html" class="pagination-link" aria-label="Bayesian Logistic Regression">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Bayesian Logistic Regression</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../../tutorials/04-hidden-markov-model/index.html" class="pagination-link" aria-label="Hidden Markov Models">
        <span class="nav-page-text">Hidden Markov Models</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Turing is created by <a href="http://mlg.eng.cam.ac.uk/hong/" target="_blank">Hong Ge</a>, and lovingly maintained by the <a href="https://github.com/TuringLang/Turing.jl/graphs/contributors" target="_blank">core team</a> of volunteers. <br> The contents of this website are © 2024 under the terms of the <a href="https://github.com/TuringLang/Turing.jl/blob/master/LICENCE" target="_blank">MIT License</a>.</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/TuringLang/docs/edit/master/tutorials/03-bayesian-neural-network/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/docs/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://x.com/TuringLang">
      <i class="bi bi-twitter" role="img" aria-label="Turing Twitter">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/TuringLang/Turing.jl">
      <i class="bi bi-github" role="img" aria-label="Turing GitHub">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




<script src="../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>