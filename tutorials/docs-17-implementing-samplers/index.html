<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.36">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Implementing samplers – Turing.jl</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../tutorials/docs-07-for-developers-variational-inference/index.html" rel="prev">
<link href="../../assets/favicon.ico" rel="icon">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-01c78b5cd655e4cd89133cf59d535862.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark-474c6d7e63be50eb6972897072b39b27.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-5a965d03c83b9a52a3a52c83f34fadca.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark-03f81fcb35c69179f531195cac5ac726.min.css" rel="prefetch" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<style>
  a {
    text-decoration: none;
  }
  a:hover {
    text-decoration: underline;
  }
</style>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../theming/styles.css">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="https://turinglang.org/" class="navbar-brand navbar-brand-logo">
    <img src="../../assets/images/turing-logo.svg" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="https://turinglang.org/">
    <span class="navbar-title">Turing.jl</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../tutorials/docs-00-getting-started/"> 
<span class="menu-text">Get Started</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../tutorials/00-introduction/"> 
<span class="menu-text">Tutorials</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/library/"> 
<span class="menu-text">Libraries</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/news/"> 
<span class="menu-text">News</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/team/"> 
<span class="menu-text">Team</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-v0.34" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">v0.34</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-v0.34">    
        <li>
    <a class="dropdown-item" href="https://turinglang.org/docs/changelog.html">
 <span class="dropdown-text">Changelog</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://turinglang.org/docs/versions.html">
 <span class="dropdown-text">All Versions</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools tools-wide">
    <a href="https://x.com/TuringLang" title="Turing Twitter" class="quarto-navigation-tool px-1" aria-label="Turing Twitter"><i class="bi bi-twitter"></i></a>
    <a href="https://github.com/TuringLang/Turing.jl" title="Turing GitHub" class="quarto-navigation-tool px-1" aria-label="Turing GitHub"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Developers</li><li class="breadcrumb-item"><a href="../../tutorials/docs-06-for-developers-interface/index.html">Inference (note: outdated)</a></li><li class="breadcrumb-item"><a href="../../tutorials/docs-17-implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false">
 <span class="menu-text">Users</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-00-getting-started/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Getting Started</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-12-using-turing-guide/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Core Functionality</span></a>
  </div>
</li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false">
 <span class="menu-text">Usage Tips</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-10-using-turing-autodiff/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Automatic Differentiation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/usage-custom-distribution/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Custom Distributions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/usage-probability-interface/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Querying Model Probabilities</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/usage-modifying-logprob/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Modifying the Log Probability</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/usage-generated-quantities/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Generated Quantities</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-17-mode-estimation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Mode Estimation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-13-using-turing-performance-tips/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Performance Tips</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-15-using-turing-sampler-viz/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Sampler Visualization</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-11-using-turing-dynamichmc/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using DynamicHMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-16-using-turing-external-samplers/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using External Samplers</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false">
 <span class="menu-text">Tutorials</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/00-introduction/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction: Coin Flipping</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/01-gaussian-mixture-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Mixture Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/02-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/03-bayesian-neural-network/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Neural Networks</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/04-hidden-markov-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Hidden Markov Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/05-linear-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Linear Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/06-infinite-mixture-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Infinite Mixture Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/07-poisson-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Poisson Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/08-multinomial-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Multinomial Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/09-variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/10-bayesian-differential-equations/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Differential Equations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/11-probabilistic-pca/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Probabilistic PCA</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/13-seasonal-time-series/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Time Series Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/15-gaussian-processes/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction to Gaussian Processes</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/12-gplvm/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Process Latent Variable Models</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Developers</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false">
 <span class="menu-text">Contributing</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-01-contributing-guide/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">How to Contribute</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="false">
 <span class="menu-text">DynamicPPL in Depth</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/dev-model-manual/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Manually Defining a Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-05-for-developers-compiler/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Turing Compiler Design</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/14-minituring/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation I: Compiler</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/16-contexts/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation II: Contexts</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true">
 <span class="menu-text">Inference (note: outdated)</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-06-for-developers-interface/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Interface Guide</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-04-for-developers-abstractmcmc-turing/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">How Turing implements AbstractMCMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-07-for-developers-variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-17-implementing-samplers/index.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Implementing Samplers</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of Contents</h2>
   
  <ul>
  <li><a href="#quick-overview-of-mala" id="toc-quick-overview-of-mala" class="nav-link active" data-scroll-target="#quick-overview-of-mala">Quick overview of MALA</a></li>
  <li><a href="#what-we-need-from-a-model-logdensityproblems.jl" id="toc-what-we-need-from-a-model-logdensityproblems.jl" class="nav-link" data-scroll-target="#what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: LogDensityProblems.jl</a></li>
  <li><a href="#implementing-mala-in-abstractmcmc.jl" id="toc-implementing-mala-in-abstractmcmc.jl" class="nav-link" data-scroll-target="#implementing-mala-in-abstractmcmc.jl">Implementing MALA in AbstractMCMC.jl</a></li>
  <li><a href="#using-our-sampler-with-turing.jl" id="toc-using-our-sampler-with-turing.jl" class="nav-link" data-scroll-target="#using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</a>
  <ul class="collapse">
  <li><a href="#models-with-constrained-parameters" id="toc-models-with-constrained-parameters" class="nav-link" data-scroll-target="#models-with-constrained-parameters">Models with constrained parameters</a></li>
  </ul></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/TuringLang/docs/edit/master/tutorials/docs-17-implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/docs/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Developers</li><li class="breadcrumb-item"><a href="../../tutorials/docs-06-for-developers-interface/index.html">Inference (note: outdated)</a></li><li class="breadcrumb-item"><a href="../../tutorials/docs-17-implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Implementing samplers</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>In this tutorial, we’ll go through step-by-step how to implement a “simple” sampler in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> in such a way that it can be easily applied to Turing.jl models.</p>
<p>In particular, we’re going to implement a version of <strong>Metropolis-adjusted Langevin (MALA)</strong>.</p>
<p>Note that we will implement this sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> framework, completely “ignoring” Turing.jl until the very end of the tutorial, at which point we’ll use a single line of code to make the resulting sampler available to Turing.jl. This is to really drive home the point that one can implement samplers in a way that is accessible to all of Turing.jl’s users without having to use Turing.jl yourself.</p>
<section id="quick-overview-of-mala" class="level2">
<h2 class="anchored" data-anchor-id="quick-overview-of-mala">Quick overview of MALA</h2>
<p>We can view MALA as a single step of the leapfrog intergrator with resampling of momentum <span class="math inline">\(p\)</span> at every step.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> To make that statement a bit more concrete, we first define the <em>extended</em> target <span class="math inline">\(\bar{\gamma}(x, p)\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\log \bar{\gamma}(x, p) \propto \log \gamma(x) + \log \gamma_{\mathcal{N}(0, M)}(p)
\end{equation*}\]</span></p>
<p>where <span class="math inline">\(\gamma_{\mathcal{N}(0, M)}\)</span> denotes the density for a zero-centered Gaussian with covariance matrix <span class="math inline">\(M\)</span>. We then consider targeting this joint distribution over both <span class="math inline">\(x\)</span> and <span class="math inline">\(p\)</span> as follows. First we define the map</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  L_{\epsilon}: \quad &amp; \mathbb{R}^d \times \mathbb{R}^d \to \mathbb{R}^d \times \mathbb{R}^d \\
  &amp; (x, p) \mapsto (\tilde{x}, \tilde{p}) := L_{\epsilon}(x, p)
\end{split}
\end{equation*}\]</span></p>
<p>as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p_{1 / 2} &amp;:= p + \frac{\epsilon}{2} \nabla \log \gamma(x) \\
  \tilde{x} &amp;:= x + \epsilon M^{-1} p_{1 /2 } \\
  p_1 &amp;:= p_{1 / 2} + \frac{\epsilon}{2} \nabla \log \gamma(\tilde{x}) \\
  \tilde{p} &amp;:= - p_1
\end{split}
\end{equation*}\]</span></p>
<p>This might be familiar for some readers as a single step of the Leapfrog integrator. We then define the MALA kernel as follows: given the current iterate <span class="math inline">\(x_i\)</span>, we sample the next iterate <span class="math inline">\(x_{i + 1}\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p &amp;\sim \mathcal{N}(0, M) \\
  (\tilde{x}, \tilde{p}) &amp;:= L_{\epsilon}(x_i, p) \\
  \alpha &amp;:= \min \left\{ 1, \frac{\bar{\gamma}(\tilde{x}, \tilde{p})}{\bar{\gamma}(x_i, p)} \right\} \\
  x_{i + 1} &amp;:=
  \begin{cases}
    \tilde{x} \quad &amp; \text{ with prob. } \alpha \\
    x_i       \quad &amp; \text{ with prob. } 1 - \alpha
  \end{cases}
\end{split}
\end{equation*}\]</span></p>
<p>i.e.&nbsp;we accept the proposal <span class="math inline">\(\tilde{x}\)</span> with probability <span class="math inline">\(\alpha\)</span> and reject it, thus sticking with our current iterate, with probability <span class="math inline">\(1 - \alpha\)</span>.</p>
</section>
<section id="what-we-need-from-a-model-logdensityproblems.jl" class="level2">
<h2 class="anchored" data-anchor-id="what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a></h2>
<p>There are a few things we need from the “target” / “model” / density that we want to sample from:</p>
<ol type="1">
<li>We need access to log-density <em>evaluations</em> <span class="math inline">\(\log \gamma(x)\)</span> so we can compute the acceptance ratio involving <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>We need access to log-density <em>gradients</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span> so we can compute the Leapfrog steps <span class="math inline">\(L_{\epsilon}(x, p)\)</span>.</li>
<li>We also need access to the “size” of the model so we can determine the size of <span class="math inline">\(M\)</span>.</li>
</ol>
<p>Luckily for us, there is a package called <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> which provides an interface for <em>exactly</em> this!</p>
<p>To demonstrate how one can implement the “<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface”<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> we will use a simple Gaussian model as an example:</p>
<div id="4" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblems</span>: LogDensityProblems;</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's define some type that represents the model.</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> IsotropicNormalModel{M<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"mean of the isotropic Gaussian"</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    mean<span class="op">::</span><span class="dt">M</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Specifies what input length the model expects.</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">dimension</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> <span class="fu">length</span>(model.mean)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Implementation of the log-density evaluation of the model.</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x<span class="op">::</span><span class="dt">AbstractVector{&lt;:Real}</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">-</span> <span class="fu">sum</span>(abs2, x <span class="op">.-</span> model.mean) <span class="op">/</span> <span class="fl">2</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This gives us all of the properties we want for our MALA sampler with the exception of the computation of the <em>gradient</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span>. There is the method <code>LogDensityProblems.logdensity_and_gradient</code> which should return a 2-tuple where the first entry is the evaluation of the logdensity <span class="math inline">\(\log \gamma(x)\)</span> and the second entry is the gradient <span class="math inline">\(\nabla \log \gamma(x)\)</span>.</p>
<p>There are two ways to “implement” this method: 1) we implement it by hand, which is feasible in the case of our <code>IsotropicNormalModel</code>, or b) we defer the implementation of this to a automatic differentiation backend.</p>
<p>To implement it by hand we can simply do</p>
<div id="6" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl that first-order, i.e. gradient information, is available.</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{1}</span>()</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Implement `logdensity_and_gradient`.</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    logγ_x <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="op">-</span>x <span class="op">.*</span> (x <span class="op">-</span> model.mean)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> logγ_x, ∇logγ_x</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s just try it out:</p>
<div id="8" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate the problem.</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> <span class="fu">IsotropicNormalModel</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.])</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create some example input that we can test on.</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>x_example <span class="op">=</span> <span class="fu">randn</span>(LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate!</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-21.786101664128765</code></pre>
</div>
</div>
<p>To defer it to an automatic differentiation backend, we can do</p>
<div id="10" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl we only have access to 0-th order information.</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{0}</span>()</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Use `LogDensityProblemsAD`'s `ADgradient` in combination with some AD backend to implement `logdensity_and_gradient`.</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblemsAD</span>, <span class="bu">ADTypes</span>, <span class="bu">ForwardDiff</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>model_with_grad <span class="op">=</span> <span class="fu">ADgradient</span>(<span class="fu">AutoForwardDiff</span>(), model)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model_with_grad, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-21.786101664128765</code></pre>
</div>
</div>
<p>We’ll continue with the second approach in this tutorial since this is typically what one does in practice, because there are better hobbies to spend time on than deriving gradients by hand.</p>
<p>At this point, one might wonder how we’re going to tie this back to Turing.jl in the end. Effectively, when working with inference methods that only require log-density evaluations and / or higher-order information of the log-density, Turing.jl actually converts the user-provided <code>Model</code> into an object implementing the above methods for <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>. As a result, most samplers provided by Turing.jl are actually implemented to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, enabling their use both <em>within</em> Turing.jl and <em>outside</em> of Turing.jl! Morever, there exists similar conversions for Stan through BridgeStan and Stan<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, which means that a sampler supporting the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface can easily be used on both Turing.jl <em>and</em> Stan models (in addition to user-provided models, as our <code>IsotropicNormalModel</code> above)!</p>
<p>Anyways, let’s move on to actually implementing the sampler.</p>
</section>
<section id="implementing-mala-in-abstractmcmc.jl" class="level2">
<h2 class="anchored" data-anchor-id="implementing-mala-in-abstractmcmc.jl">Implementing MALA in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a></h2>
<p>Now that we’ve established that a model implementing the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface provides us with all the information we need from <span class="math inline">\(\log \gamma(x)\)</span>, we can address the question: given an object that implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, how can we define a sampler for it?</p>
<p>We’re going to do this by making our sampler a sub-type of <code>AbstractMCMC.AbstractSampler</code> in addition to implementing a few methods from <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>. Why? Because it gets us <em>a lot</em> of functionality for free, as we will see later.</p>
<p>Moreover, <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> provides a very natural interface for MCMC algorithms.</p>
<p>First, we’ll define our <code>MALA</code> type</p>
<div id="12" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">AbstractMCMC</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALA{T,A} <span class="op">&lt;:</span><span class="dt"> AbstractMCMC.AbstractSampler</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"stepsize used in the leapfrog step"</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    ϵ_init<span class="op">::</span><span class="dt">T</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"covariance matrix used for the momentum"</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    M_init<span class="op">::</span><span class="dt">A</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notice how we’ve added the suffix <code>_init</code> to both the stepsize and the covariance matrix. We’ve done this because a <code>AbstractMCMC.AbstractSampler</code> should be <em>immutable</em>. Of course there might be many scenarios where we want to allow something like the stepsize and / or the covariance matrix to vary between iterations, e.g.&nbsp;during the burn-in / adaptation phase of the sampling process we might want to adjust the parameters using statistics computed from these initial iterations. But information which can change between iterations <em>should not go in the sampler itself</em>! Instead, this information should go in the sampler <em>state</em>.</p>
<p>The sampler state should at the very least contain all the necessary information to perform the next MCMC iteration, but usually contains further information, e.g.&nbsp;quantities and statistics useful for evaluating whether the sampler has converged.</p>
<p>We will use the following sampler state for our <code>MALA</code> sampler:</p>
<div id="14" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALAState{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This might seem overly redundant: we’re defining a type <code>MALAState</code> and it only contains a simple vector of reals. In this particular case we indeed could have dropped this and simply used a <code>AbstractVector{&lt;:Real}</code> as our sampler state, but typically, as we will see later, one wants to include other quantities in the sampler state. For example, if we also wanted to adapt the parameters of our <code>MALA</code>, e.g.&nbsp;alter the stepsize depending on acceptance rates, in which case we should also put <code>ϵ</code> in the state, but for now we’ll keep things simple.</p>
<p>Moreover, we also want a <em>sample</em> type, which is a type meant for “public consumption”, i.e.&nbsp;the end-user. This is generally going to contain a subset of the information present in the state. But in such a simple scenario as this, we similarly only have a <code>AbstractVector{&lt;:Real}</code>:</p>
<div id="16" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALASample{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We currently have three things:</p>
<ol type="1">
<li>A <code>AbstractMCMC.AbstractSampler</code> implementation called <code>MALA</code>.</li>
<li>A state <code>MALAState</code> for our sampler <code>MALA</code>.</li>
<li>A sample <code>MALASample</code> for our sampler <code>MALA</code>.</li>
</ol>
<p>That means that we’re ready to implement the only thing that really matters: <code>AbstractMCMC.step</code>.</p>
<p><code>AbstractMCMC.step</code> defines the MCMC iteration of our <code>MALA</code> given the current <code>MALAState</code>. Specifically, the signature of the function is as follows:</p>
<div id="18" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The RNG to ensure reproducibility.</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The model that defines our target.</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.AbstractModel</span>,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The sampler for which we're taking a `step`.</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">AbstractMCMC.AbstractSampler</span>,</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The current sampler `state`.</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    state;</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Additional keyword arguments that we may or may not need.</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Moreover, there is a specific <code>AbstractMCMC.AbstractModel</code> which is used to indicate that the model that is provided implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface: <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Since, as we discussed earlier, in our case we’re indeed going to work with types that support the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, we’ll define <code>AbstractMCMC.step</code> for such a <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Note that <code>AbstractMCMC.LogDensityModel</code> has no other purpose; it has a single field called <code>logdensity</code>, and it does nothing else. But by wrapping the model in <code>AbstractMCMC.LogDensityModel</code>, it allows samplers that want to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> to define their <code>AbstractMCMC.step</code> on this type without running into method ambiguities.</p>
<p>All in all, that means that the signature for our <code>AbstractMCMC.step</code> is going to be the following:</p>
<div id="20" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># `LogDensityModel` so we know we're working with LogDensityProblems.jl model.</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler.</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler state.</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Great! Now let’s actually implement the full <code>AbstractMCMC.step</code> for our <code>MALA</code>.</p>
<p>Let’s remind ourselves what we’re going to do:</p>
<ol type="1">
<li>Sample a new momentum <span class="math inline">\(p\)</span>.</li>
<li>Compute the log-density of the extended target <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>Take a single leapfrog step <span class="math inline">\((\tilde{x}, \tilde{p}) = L_{\epsilon}(x, p)\)</span>.</li>
<li>Accept or reject the proposed <span class="math inline">\((\tilde{x}, \tilde{p})\)</span>.</li>
</ol>
<p>All in all, this results in the following:</p>
<div id="22" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>: Random</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Distributions</span>  <span class="co"># so we get the `MvNormal`</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the wrapped model which implements LogDensityProblems.jl.</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just extract the sampler parameters to make our lives easier.</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    ϵ <span class="op">=</span> sampler.ϵ_init</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    M <span class="op">=</span> sampler.M_init</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the current parameters.</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> state.x</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sample the momentum.</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>    p_dist <span class="op">=</span> <span class="fu">MvNormal</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)), M)</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> <span class="fu">rand</span>(rng, p_dist)</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Propose using a single leapfrog step.</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>    x̃, p̃ <span class="op">=</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Accept or reject proposal.</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>    logp <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p)</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>    logp̃ <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x̃) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p̃)</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>    logα <span class="op">=</span> logp̃ <span class="op">-</span> logp</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>    state_new <span class="op">=</span> <span class="cf">if</span> <span class="fu">log</span>(<span class="fu">rand</span>(rng)) <span class="op">&lt;</span> logα</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Accept.</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x̃)</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Reject.</span></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x)</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return the "sample" and the sampler state.</span></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(state_new.x), state_new</span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Fairly straight-forward.</p>
<p>Of course, we haven’t defined the <code>leapfrog_step</code> method yet, so let’s do that:</p>
<div id="24" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p` using "position" `x`.</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x))</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    p1 <span class="op">=</span> p <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update the "position" `x` using momentum `p1`.</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    x̃ <span class="op">=</span> x <span class="op">+</span> ϵ <span class="op">.*</span> (M <span class="op">\</span> p1)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p1` using position `x̃`</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x̃ <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x̃))</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    p2 <span class="op">=</span> p1 <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x̃</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Flip momentum `p2`.</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    p̃ <span class="op">=</span> <span class="op">-</span>p2</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x̃, p̃</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>leapfrog_step (generic function with 1 method)</code></pre>
</div>
</div>
<p>With all of this, we’re technically ready to sample!</p>
<div id="26" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>, <span class="bu">LinearAlgebra</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>rng <span class="op">=</span> <span class="bu">Random</span>.<span class="fu">default_rng</span>()</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>sampler <span class="op">=</span> <span class="fu">MALA</span>(<span class="fl">1</span>, I)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>state <span class="op">=</span> <span class="fu">MALAState</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)))</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>x_next, state_next <span class="op">=</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    rng,</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    AbstractMCMC.<span class="fu">LogDensityModel</span>(model),</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    state</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>(MALASample{Vector{Float64}}([0.0, 0.0, 0.0]), MALAState{Vector{Float64}}([0.0, 0.0, 0.0]))</code></pre>
</div>
</div>
<p>Great, it works!</p>
<p>And I promised we would get quite some functionality for free if we implemented <code>AbstractMCMC.step</code>, and so we can now simply call <code>sample</code> to perform standard MCMC sampling:</p>
<div id="28" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform 1000 iterations with our `MALA` sampler.</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; initial_state<span class="op">=</span>state, progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Concatenate into a matrix.</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000 Matrix{Float64}:
 -2.37239    -3.81434  -4.58395   -5.13899   …  -4.86871  -4.32474   -3.94319
 -0.0508748   1.25924   0.540633   0.633697      0.50242  -0.699573   0.59933
  2.01533     4.79048   5.43006    5.72653       6.21491   6.2324     4.17817</code></pre>
</div>
</div>
<div id="30" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the marginal means and standard deviations.</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -4.98192     1.00236
 -0.00447641  1.00292
  5.00118     0.997667</code></pre>
</div>
</div>
<p>Let’s visualize the samples</p>
<div id="32" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">StatsPlots</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">transpose</span>(samples_matrix[<span class="op">:</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">:</span><span class="kw">end</span>]), alpha<span class="op">=</span><span class="fl">0.5</span>, legend<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<!--?xml version="1.0" encoding="utf-8"?-->
<svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" width="672" height="480" viewbox="0 0 2688 1920">
<defs>
  <clippath id="clip020">
    <rect x="0" y="0" width="2688" height="1920"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip020)" d="M0 1920 L2688 1920 L2688 0 L0 0  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip021">
    <rect x="537" y="0" width="1883" height="1883"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip020)" d="M196.816 1800.78 L2640.76 1800.78 L2640.76 47.2441 L196.816 47.2441  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip022">
    <rect x="196" y="47" width="2445" height="1755"></rect>
  </clippath>
</defs>
<polyline clip-path="url(#clip022)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="263.676,1800.78 263.676,47.2441 "></polyline>
<polyline clip-path="url(#clip022)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="840.654,1800.78 840.654,47.2441 "></polyline>
<polyline clip-path="url(#clip022)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1417.63,1800.78 1417.63,47.2441 "></polyline>
<polyline clip-path="url(#clip022)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1994.61,1800.78 1994.61,47.2441 "></polyline>
<polyline clip-path="url(#clip022)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="2571.59,1800.78 2571.59,47.2441 "></polyline>
<polyline clip-path="url(#clip022)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,1635.28 2640.76,1635.28 "></polyline>
<polyline clip-path="url(#clip022)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,1388.45 2640.76,1388.45 "></polyline>
<polyline clip-path="url(#clip022)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,1141.61 2640.76,1141.61 "></polyline>
<polyline clip-path="url(#clip022)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,894.768 2640.76,894.768 "></polyline>
<polyline clip-path="url(#clip022)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,647.929 2640.76,647.929 "></polyline>
<polyline clip-path="url(#clip022)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,401.09 2640.76,401.09 "></polyline>
<polyline clip-path="url(#clip022)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,154.251 2640.76,154.251 "></polyline>
<polyline clip-path="url(#clip020)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1800.78 2640.76,1800.78 "></polyline>
<polyline clip-path="url(#clip020)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="263.676,1800.78 263.676,1781.88 "></polyline>
<polyline clip-path="url(#clip020)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="840.654,1800.78 840.654,1781.88 "></polyline>
<polyline clip-path="url(#clip020)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1417.63,1800.78 1417.63,1781.88 "></polyline>
<polyline clip-path="url(#clip020)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1994.61,1800.78 1994.61,1781.88 "></polyline>
<polyline clip-path="url(#clip020)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="2571.59,1800.78 2571.59,1781.88 "></polyline>
<path clip-path="url(#clip020)" d="M263.676 1834 Q260.065 1834 258.236 1837.57 Q256.431 1841.11 256.431 1848.24 Q256.431 1855.34 258.236 1858.91 Q260.065 1862.45 263.676 1862.45 Q267.31 1862.45 269.116 1858.91 Q270.945 1855.34 270.945 1848.24 Q270.945 1841.11 269.116 1837.57 Q267.31 1834 263.676 1834 M263.676 1830.3 Q269.486 1830.3 272.542 1834.9 Q275.621 1839.49 275.621 1848.24 Q275.621 1856.96 272.542 1861.57 Q269.486 1866.15 263.676 1866.15 Q257.866 1866.15 254.787 1861.57 Q251.732 1856.96 251.732 1848.24 Q251.732 1839.49 254.787 1834.9 Q257.866 1830.3 263.676 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip020)" d="M804.346 1861.55 L820.666 1861.55 L820.666 1865.48 L798.721 1865.48 L798.721 1861.55 Q801.383 1858.79 805.967 1854.16 Q810.573 1849.51 811.754 1848.17 Q813.999 1845.65 814.879 1843.91 Q815.782 1842.15 815.782 1840.46 Q815.782 1837.71 813.837 1835.97 Q811.916 1834.23 808.814 1834.23 Q806.615 1834.23 804.161 1835 Q801.731 1835.76 798.953 1837.31 L798.953 1832.59 Q801.777 1831.46 804.231 1830.88 Q806.684 1830.3 808.721 1830.3 Q814.092 1830.3 817.286 1832.98 Q820.481 1835.67 820.481 1840.16 Q820.481 1842.29 819.67 1844.21 Q818.883 1846.11 816.777 1848.7 Q816.198 1849.37 813.096 1852.59 Q809.995 1855.78 804.346 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip020)" d="M830.527 1830.92 L848.883 1830.92 L848.883 1834.86 L834.809 1834.86 L834.809 1843.33 Q835.828 1842.98 836.846 1842.82 Q837.865 1842.64 838.883 1842.64 Q844.67 1842.64 848.05 1845.81 Q851.43 1848.98 851.43 1854.4 Q851.43 1859.97 847.957 1863.08 Q844.485 1866.15 838.166 1866.15 Q835.99 1866.15 833.721 1865.78 Q831.476 1865.41 829.069 1864.67 L829.069 1859.97 Q831.152 1861.11 833.374 1861.66 Q835.596 1862.22 838.073 1862.22 Q842.078 1862.22 844.416 1860.11 Q846.754 1858.01 846.754 1854.4 Q846.754 1850.78 844.416 1848.68 Q842.078 1846.57 838.073 1846.57 Q836.198 1846.57 834.323 1846.99 Q832.471 1847.4 830.527 1848.28 L830.527 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip020)" d="M870.642 1834 Q867.031 1834 865.203 1837.57 Q863.397 1841.11 863.397 1848.24 Q863.397 1855.34 865.203 1858.91 Q867.031 1862.45 870.642 1862.45 Q874.277 1862.45 876.082 1858.91 Q877.911 1855.34 877.911 1848.24 Q877.911 1841.11 876.082 1837.57 Q874.277 1834 870.642 1834 M870.642 1830.3 Q876.453 1830.3 879.508 1834.9 Q882.587 1839.49 882.587 1848.24 Q882.587 1856.96 879.508 1861.57 Q876.453 1866.15 870.642 1866.15 Q864.832 1866.15 861.754 1861.57 Q858.698 1856.96 858.698 1848.24 Q858.698 1839.49 861.754 1834.9 Q864.832 1830.3 870.642 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip020)" d="M1377.25 1830.92 L1395.61 1830.92 L1395.61 1834.86 L1381.53 1834.86 L1381.53 1843.33 Q1382.55 1842.98 1383.57 1842.82 Q1384.59 1842.64 1385.61 1842.64 Q1391.39 1842.64 1394.77 1845.81 Q1398.15 1848.98 1398.15 1854.4 Q1398.15 1859.97 1394.68 1863.08 Q1391.21 1866.15 1384.89 1866.15 Q1382.71 1866.15 1380.44 1865.78 Q1378.2 1865.41 1375.79 1864.67 L1375.79 1859.97 Q1377.88 1861.11 1380.1 1861.66 Q1382.32 1862.22 1384.8 1862.22 Q1388.8 1862.22 1391.14 1860.11 Q1393.48 1858.01 1393.48 1854.4 Q1393.48 1850.78 1391.14 1848.68 Q1388.8 1846.57 1384.8 1846.57 Q1382.92 1846.57 1381.05 1846.99 Q1379.19 1847.4 1377.25 1848.28 L1377.25 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip020)" d="M1417.37 1834 Q1413.75 1834 1411.93 1837.57 Q1410.12 1841.11 1410.12 1848.24 Q1410.12 1855.34 1411.93 1858.91 Q1413.75 1862.45 1417.37 1862.45 Q1421 1862.45 1422.81 1858.91 Q1424.63 1855.34 1424.63 1848.24 Q1424.63 1841.11 1422.81 1837.57 Q1421 1834 1417.37 1834 M1417.37 1830.3 Q1423.18 1830.3 1426.23 1834.9 Q1429.31 1839.49 1429.31 1848.24 Q1429.31 1856.96 1426.23 1861.57 Q1423.18 1866.15 1417.37 1866.15 Q1411.56 1866.15 1408.48 1861.57 Q1405.42 1856.96 1405.42 1848.24 Q1405.42 1839.49 1408.48 1834.9 Q1411.56 1830.3 1417.37 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip020)" d="M1447.53 1834 Q1443.92 1834 1442.09 1837.57 Q1440.28 1841.11 1440.28 1848.24 Q1440.28 1855.34 1442.09 1858.91 Q1443.92 1862.45 1447.53 1862.45 Q1451.16 1862.45 1452.97 1858.91 Q1454.8 1855.34 1454.8 1848.24 Q1454.8 1841.11 1452.97 1837.57 Q1451.16 1834 1447.53 1834 M1447.53 1830.3 Q1453.34 1830.3 1456.39 1834.9 Q1459.47 1839.49 1459.47 1848.24 Q1459.47 1856.96 1456.39 1861.57 Q1453.34 1866.15 1447.53 1866.15 Q1441.72 1866.15 1438.64 1861.57 Q1435.58 1856.96 1435.58 1848.24 Q1435.58 1839.49 1438.64 1834.9 Q1441.72 1830.3 1447.53 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip020)" d="M1952.89 1830.92 L1975.11 1830.92 L1975.11 1832.91 L1962.56 1865.48 L1957.68 1865.48 L1969.48 1834.86 L1952.89 1834.86 L1952.89 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip020)" d="M1984.27 1830.92 L2002.63 1830.92 L2002.63 1834.86 L1988.56 1834.86 L1988.56 1843.33 Q1989.58 1842.98 1990.59 1842.82 Q1991.61 1842.64 1992.63 1842.64 Q1998.42 1842.64 2001.8 1845.81 Q2005.18 1848.98 2005.18 1854.4 Q2005.18 1859.97 2001.7 1863.08 Q1998.23 1866.15 1991.91 1866.15 Q1989.74 1866.15 1987.47 1865.78 Q1985.22 1865.41 1982.82 1864.67 L1982.82 1859.97 Q1984.9 1861.11 1987.12 1861.66 Q1989.34 1862.22 1991.82 1862.22 Q1995.83 1862.22 1998.16 1860.11 Q2000.5 1858.01 2000.5 1854.4 Q2000.5 1850.78 1998.16 1848.68 Q1995.83 1846.57 1991.82 1846.57 Q1989.95 1846.57 1988.07 1846.99 Q1986.22 1847.4 1984.27 1848.28 L1984.27 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip020)" d="M2024.39 1834 Q2020.78 1834 2018.95 1837.57 Q2017.14 1841.11 2017.14 1848.24 Q2017.14 1855.34 2018.95 1858.91 Q2020.78 1862.45 2024.39 1862.45 Q2028.02 1862.45 2029.83 1858.91 Q2031.66 1855.34 2031.66 1848.24 Q2031.66 1841.11 2029.83 1837.57 Q2028.02 1834 2024.39 1834 M2024.39 1830.3 Q2030.2 1830.3 2033.26 1834.9 Q2036.33 1839.49 2036.33 1848.24 Q2036.33 1856.96 2033.26 1861.57 Q2030.2 1866.15 2024.39 1866.15 Q2018.58 1866.15 2015.5 1861.57 Q2012.45 1856.96 2012.45 1848.24 Q2012.45 1839.49 2015.5 1834.9 Q2018.58 1830.3 2024.39 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip020)" d="M2516.11 1861.55 L2523.75 1861.55 L2523.75 1835.18 L2515.44 1836.85 L2515.44 1832.59 L2523.71 1830.92 L2528.38 1830.92 L2528.38 1861.55 L2536.02 1861.55 L2536.02 1865.48 L2516.11 1865.48 L2516.11 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip020)" d="M2555.47 1834 Q2551.85 1834 2550.03 1837.57 Q2548.22 1841.11 2548.22 1848.24 Q2548.22 1855.34 2550.03 1858.91 Q2551.85 1862.45 2555.47 1862.45 Q2559.1 1862.45 2560.9 1858.91 Q2562.73 1855.34 2562.73 1848.24 Q2562.73 1841.11 2560.9 1837.57 Q2559.1 1834 2555.47 1834 M2555.47 1830.3 Q2561.28 1830.3 2564.33 1834.9 Q2567.41 1839.49 2567.41 1848.24 Q2567.41 1856.96 2564.33 1861.57 Q2561.28 1866.15 2555.47 1866.15 Q2549.66 1866.15 2546.58 1861.57 Q2543.52 1856.96 2543.52 1848.24 Q2543.52 1839.49 2546.58 1834.9 Q2549.66 1830.3 2555.47 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip020)" d="M2585.63 1834 Q2582.02 1834 2580.19 1837.57 Q2578.38 1841.11 2578.38 1848.24 Q2578.38 1855.34 2580.19 1858.91 Q2582.02 1862.45 2585.63 1862.45 Q2589.26 1862.45 2591.07 1858.91 Q2592.9 1855.34 2592.9 1848.24 Q2592.9 1841.11 2591.07 1837.57 Q2589.26 1834 2585.63 1834 M2585.63 1830.3 Q2591.44 1830.3 2594.49 1834.9 Q2597.57 1839.49 2597.57 1848.24 Q2597.57 1856.96 2594.49 1861.57 Q2591.44 1866.15 2585.63 1866.15 Q2579.82 1866.15 2576.74 1861.57 Q2573.68 1856.96 2573.68 1848.24 Q2573.68 1839.49 2576.74 1834.9 Q2579.82 1830.3 2585.63 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip020)" d="M2615.79 1834 Q2612.18 1834 2610.35 1837.57 Q2608.54 1841.11 2608.54 1848.24 Q2608.54 1855.34 2610.35 1858.91 Q2612.18 1862.45 2615.79 1862.45 Q2619.42 1862.45 2621.23 1858.91 Q2623.06 1855.34 2623.06 1848.24 Q2623.06 1841.11 2621.23 1837.57 Q2619.42 1834 2615.79 1834 M2615.79 1830.3 Q2621.6 1830.3 2624.65 1834.9 Q2627.73 1839.49 2627.73 1848.24 Q2627.73 1856.96 2624.65 1861.57 Q2621.6 1866.15 2615.79 1866.15 Q2609.98 1866.15 2606.9 1861.57 Q2603.84 1856.96 2603.84 1848.24 Q2603.84 1839.49 2606.9 1834.9 Q2609.98 1830.3 2615.79 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip020)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1800.78 196.816,47.2441 "></polyline>
<polyline clip-path="url(#clip020)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1635.28 215.714,1635.28 "></polyline>
<polyline clip-path="url(#clip020)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1388.45 215.714,1388.45 "></polyline>
<polyline clip-path="url(#clip020)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1141.61 215.714,1141.61 "></polyline>
<polyline clip-path="url(#clip020)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,894.768 215.714,894.768 "></polyline>
<polyline clip-path="url(#clip020)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,647.929 215.714,647.929 "></polyline>
<polyline clip-path="url(#clip020)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,401.09 215.714,401.09 "></polyline>
<polyline clip-path="url(#clip020)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,154.251 215.714,154.251 "></polyline>
<path clip-path="url(#clip020)" d="M50.5475 1635.74 L80.2233 1635.74 L80.2233 1639.67 L50.5475 1639.67 L50.5475 1635.74 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip020)" d="M89.1352 1618 L111.357 1618 L111.357 1620 L98.8111 1652.56 L93.9269 1652.56 L105.732 1621.94 L89.1352 1621.94 L89.1352 1618 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip020)" d="M120.478 1646.68 L125.362 1646.68 L125.362 1652.56 L120.478 1652.56 L120.478 1646.68 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip020)" d="M135.593 1618 L153.95 1618 L153.95 1621.94 L139.876 1621.94 L139.876 1630.41 Q140.894 1630.06 141.913 1629.9 Q142.931 1629.72 143.95 1629.72 Q149.737 1629.72 153.116 1632.89 Q156.496 1636.06 156.496 1641.48 Q156.496 1647.06 153.024 1650.16 Q149.552 1653.24 143.232 1653.24 Q141.056 1653.24 138.788 1652.87 Q136.542 1652.49 134.135 1651.75 L134.135 1647.06 Q136.218 1648.19 138.441 1648.74 Q140.663 1649.3 143.14 1649.3 Q147.144 1649.3 149.482 1647.19 Q151.82 1645.09 151.82 1641.48 Q151.82 1637.87 149.482 1635.76 Q147.144 1633.65 143.14 1633.65 Q141.265 1633.65 139.39 1634.07 Q137.538 1634.49 135.593 1635.37 L135.593 1618 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip020)" d="M49.5521 1388.9 L79.2279 1388.9 L79.2279 1392.83 L49.5521 1392.83 L49.5521 1388.9 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip020)" d="M89.3667 1371.17 L107.723 1371.17 L107.723 1375.1 L93.6491 1375.1 L93.6491 1383.57 Q94.6676 1383.23 95.6861 1383.06 Q96.7047 1382.88 97.7232 1382.88 Q103.51 1382.88 106.89 1386.05 Q110.269 1389.22 110.269 1394.64 Q110.269 1400.22 106.797 1403.32 Q103.325 1406.4 97.0056 1406.4 Q94.8297 1406.4 92.5612 1406.03 Q90.3158 1405.66 87.9084 1404.92 L87.9084 1400.22 Q89.9917 1401.35 92.2139 1401.91 Q94.4361 1402.46 96.913 1402.46 Q100.918 1402.46 103.256 1400.36 Q105.593 1398.25 105.593 1394.64 Q105.593 1391.03 103.256 1388.92 Q100.918 1386.81 96.913 1386.81 Q95.038 1386.81 93.163 1387.23 Q91.3112 1387.65 89.3667 1388.53 L89.3667 1371.17 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip020)" d="M119.482 1399.85 L124.367 1399.85 L124.367 1405.73 L119.482 1405.73 L119.482 1399.85 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip020)" d="M144.552 1374.24 Q140.941 1374.24 139.112 1377.81 Q137.306 1381.35 137.306 1388.48 Q137.306 1395.59 139.112 1399.15 Q140.941 1402.69 144.552 1402.69 Q148.186 1402.69 149.991 1399.15 Q151.82 1395.59 151.82 1388.48 Q151.82 1381.35 149.991 1377.81 Q148.186 1374.24 144.552 1374.24 M144.552 1370.54 Q150.362 1370.54 153.417 1375.15 Q156.496 1379.73 156.496 1388.48 Q156.496 1397.21 153.417 1401.81 Q150.362 1406.4 144.552 1406.4 Q138.741 1406.4 135.663 1401.81 Q132.607 1397.21 132.607 1388.48 Q132.607 1379.73 135.663 1375.15 Q138.741 1370.54 144.552 1370.54 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip020)" d="M50.5475 1142.06 L80.2233 1142.06 L80.2233 1145.99 L50.5475 1145.99 L50.5475 1142.06 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip020)" d="M94.3436 1154.95 L110.663 1154.95 L110.663 1158.89 L88.7186 1158.89 L88.7186 1154.95 Q91.3806 1152.2 95.9639 1147.57 Q100.57 1142.91 101.751 1141.57 Q103.996 1139.05 104.876 1137.31 Q105.779 1135.55 105.779 1133.86 Q105.779 1131.11 103.834 1129.37 Q101.913 1127.64 98.8111 1127.64 Q96.6121 1127.64 94.1584 1128.4 Q91.7278 1129.16 88.9501 1130.72 L88.9501 1125.99 Q91.7741 1124.86 94.2278 1124.28 Q96.6815 1123.7 98.7185 1123.7 Q104.089 1123.7 107.283 1126.39 Q110.478 1129.07 110.478 1133.56 Q110.478 1135.69 109.668 1137.61 Q108.881 1139.51 106.774 1142.1 Q106.195 1142.78 103.094 1145.99 Q99.9917 1149.19 94.3436 1154.95 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip020)" d="M120.478 1153.01 L125.362 1153.01 L125.362 1158.89 L120.478 1158.89 L120.478 1153.01 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip020)" d="M135.593 1124.33 L153.95 1124.33 L153.95 1128.26 L139.876 1128.26 L139.876 1136.73 Q140.894 1136.39 141.913 1136.22 Q142.931 1136.04 143.95 1136.04 Q149.737 1136.04 153.116 1139.21 Q156.496 1142.38 156.496 1147.8 Q156.496 1153.38 153.024 1156.48 Q149.552 1159.56 143.232 1159.56 Q141.056 1159.56 138.788 1159.19 Q136.542 1158.82 134.135 1158.08 L134.135 1153.38 Q136.218 1154.51 138.441 1155.07 Q140.663 1155.62 143.14 1155.62 Q147.144 1155.62 149.482 1153.52 Q151.82 1151.41 151.82 1147.8 Q151.82 1144.19 149.482 1142.08 Q147.144 1139.97 143.14 1139.97 Q141.265 1139.97 139.39 1140.39 Q137.538 1140.81 135.593 1141.69 L135.593 1124.33 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip020)" d="M99.3204 880.566 Q95.7093 880.566 93.8806 884.131 Q92.075 887.673 92.075 894.802 Q92.075 901.909 93.8806 905.474 Q95.7093 909.015 99.3204 909.015 Q102.955 909.015 104.76 905.474 Q106.589 901.909 106.589 894.802 Q106.589 887.673 104.76 884.131 Q102.955 880.566 99.3204 880.566 M99.3204 876.863 Q105.131 876.863 108.186 881.469 Q111.265 886.052 111.265 894.802 Q111.265 903.529 108.186 908.136 Q105.131 912.719 99.3204 912.719 Q93.5102 912.719 90.4315 908.136 Q87.376 903.529 87.376 894.802 Q87.376 886.052 90.4315 881.469 Q93.5102 876.863 99.3204 876.863 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip020)" d="M119.482 906.168 L124.367 906.168 L124.367 912.048 L119.482 912.048 L119.482 906.168 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip020)" d="M144.552 880.566 Q140.941 880.566 139.112 884.131 Q137.306 887.673 137.306 894.802 Q137.306 901.909 139.112 905.474 Q140.941 909.015 144.552 909.015 Q148.186 909.015 149.991 905.474 Q151.82 901.909 151.82 894.802 Q151.82 887.673 149.991 884.131 Q148.186 880.566 144.552 880.566 M144.552 876.863 Q150.362 876.863 153.417 881.469 Q156.496 886.052 156.496 894.802 Q156.496 903.529 153.417 908.136 Q150.362 912.719 144.552 912.719 Q138.741 912.719 135.663 908.136 Q132.607 903.529 132.607 894.802 Q132.607 886.052 135.663 881.469 Q138.741 876.863 144.552 876.863 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip020)" d="M94.3436 661.274 L110.663 661.274 L110.663 665.209 L88.7186 665.209 L88.7186 661.274 Q91.3806 658.519 95.9639 653.889 Q100.57 649.237 101.751 647.894 Q103.996 645.371 104.876 643.635 Q105.779 641.875 105.779 640.186 Q105.779 637.431 103.834 635.695 Q101.913 633.959 98.8111 633.959 Q96.6121 633.959 94.1584 634.723 Q91.7278 635.487 88.9501 637.038 L88.9501 632.315 Q91.7741 631.181 94.2278 630.602 Q96.6815 630.024 98.7185 630.024 Q104.089 630.024 107.283 632.709 Q110.478 635.394 110.478 639.885 Q110.478 642.014 109.668 643.936 Q108.881 645.834 106.774 648.426 Q106.195 649.098 103.094 652.315 Q99.9917 655.51 94.3436 661.274 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip020)" d="M120.478 659.329 L125.362 659.329 L125.362 665.209 L120.478 665.209 L120.478 659.329 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip020)" d="M135.593 630.649 L153.95 630.649 L153.95 634.584 L139.876 634.584 L139.876 643.056 Q140.894 642.709 141.913 642.547 Q142.931 642.362 143.95 642.362 Q149.737 642.362 153.116 645.533 Q156.496 648.704 156.496 654.121 Q156.496 659.699 153.024 662.801 Q149.552 665.88 143.232 665.88 Q141.056 665.88 138.788 665.51 Q136.542 665.139 134.135 664.398 L134.135 659.699 Q136.218 660.834 138.441 661.389 Q140.663 661.945 143.14 661.945 Q147.144 661.945 149.482 659.838 Q151.82 657.732 151.82 654.121 Q151.82 650.51 149.482 648.403 Q147.144 646.297 143.14 646.297 Q141.265 646.297 139.39 646.713 Q137.538 647.13 135.593 648.01 L135.593 630.649 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip020)" d="M89.3667 383.81 L107.723 383.81 L107.723 387.745 L93.6491 387.745 L93.6491 396.217 Q94.6676 395.87 95.6861 395.708 Q96.7047 395.523 97.7232 395.523 Q103.51 395.523 106.89 398.694 Q110.269 401.865 110.269 407.282 Q110.269 412.861 106.797 415.962 Q103.325 419.041 97.0056 419.041 Q94.8297 419.041 92.5612 418.671 Q90.3158 418.3 87.9084 417.56 L87.9084 412.861 Q89.9917 413.995 92.2139 414.55 Q94.4361 415.106 96.913 415.106 Q100.918 415.106 103.256 412.999 Q105.593 410.893 105.593 407.282 Q105.593 403.671 103.256 401.564 Q100.918 399.458 96.913 399.458 Q95.038 399.458 93.163 399.874 Q91.3112 400.291 89.3667 401.171 L89.3667 383.81 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip020)" d="M119.482 412.49 L124.367 412.49 L124.367 418.37 L119.482 418.37 L119.482 412.49 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip020)" d="M144.552 386.888 Q140.941 386.888 139.112 390.453 Q137.306 393.995 137.306 401.124 Q137.306 408.231 139.112 411.796 Q140.941 415.337 144.552 415.337 Q148.186 415.337 149.991 411.796 Q151.82 408.231 151.82 401.124 Q151.82 393.995 149.991 390.453 Q148.186 386.888 144.552 386.888 M144.552 383.185 Q150.362 383.185 153.417 387.791 Q156.496 392.375 156.496 401.124 Q156.496 409.851 153.417 414.458 Q150.362 419.041 144.552 419.041 Q138.741 419.041 135.663 414.458 Q132.607 409.851 132.607 401.124 Q132.607 392.375 135.663 387.791 Q138.741 383.185 144.552 383.185 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip020)" d="M89.1352 136.971 L111.357 136.971 L111.357 138.962 L98.8111 171.531 L93.9269 171.531 L105.732 140.906 L89.1352 140.906 L89.1352 136.971 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip020)" d="M120.478 165.651 L125.362 165.651 L125.362 171.531 L120.478 171.531 L120.478 165.651 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip020)" d="M135.593 136.971 L153.95 136.971 L153.95 140.906 L139.876 140.906 L139.876 149.378 Q140.894 149.031 141.913 148.869 Q142.931 148.684 143.95 148.684 Q149.737 148.684 153.116 151.855 Q156.496 155.026 156.496 160.443 Q156.496 166.022 153.024 169.123 Q149.552 172.202 143.232 172.202 Q141.056 172.202 138.788 171.832 Q136.542 171.461 134.135 170.721 L134.135 166.022 Q136.218 167.156 138.441 167.711 Q140.663 168.267 143.14 168.267 Q147.144 168.267 149.482 166.161 Q151.82 164.054 151.82 160.443 Q151.82 156.832 149.482 154.725 Q147.144 152.619 143.14 152.619 Q141.265 152.619 139.39 153.036 Q137.538 153.452 135.593 154.332 L135.593 136.971 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip022)" style="stroke:#009af9; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="265.984,1129.01 268.292,1307.91 270.6,1452.99 272.908,1279.82 275.216,1383.73 277.524,1565.68 279.832,1444.56 282.139,1275.23 284.447,1570.76 286.755,1249.81 289.063,1269.59 291.371,1415.85 293.679,1482 295.987,1390.18 298.295,1409.04 300.603,1379.91 302.911,1493.92 305.219,1258.36 307.527,1528.87 309.834,1324.8 312.142,1257.19 314.45,1460.1 316.758,1333.89 319.066,1470.52 321.374,1283.36 323.682,1459.7 325.99,1396.05 328.298,1338.89 330.606,1235.21 332.914,1615.58 335.221,1398.85 337.529,1141.44 339.837,1451.5 342.145,1392.71 344.453,1359.66 346.761,1560.42 349.069,1446.03 351.377,1430.51 353.685,1418.03 355.993,1411.47 358.301,1389.33 360.608,1457.02 362.916,1574.85 365.224,1414.47 367.532,1385.79 369.84,1358.9 372.148,1333.68 374.456,1290.89 376.764,1463.94 379.072,1353.04 381.38,1258.69 383.688,1397.7 385.996,1371.91 388.303,1336.85 390.611,1314.13 392.919,1258.57 395.227,1153.09 397.535,1412.24 399.843,1363.61 402.151,1214.62 404.459,1345.51 406.767,1384.19 409.075,1362.7 411.383,1388.44 413.69,1622.59 415.998,1420.4 418.306,1366.69 420.614,1326.42 422.922,1470.75 425.23,1471.26 427.538,1478.58 429.846,1361.11 432.154,1271.14 434.462,1568.96 436.77,1372.41 439.077,1501.08 441.385,1290.35 443.693,1320.55 446.001,1251.92 448.309,1323.9 450.617,1410.13 452.925,1321.38 455.233,1355.74 457.541,1361.78 459.849,1478.42 462.157,1301.98 464.465,1322.82 466.772,1292.74 469.08,1533.78 471.388,1377.41 473.696,1478.96 476.004,1501.11 478.312,1480.32 480.62,1352.19 482.928,1395.76 485.236,1349.8 487.544,1202.05 489.852,1519.57 492.159,1356.23 494.467,1351.65 496.775,1314.44 499.083,1239.2 501.391,1478.71 503.699,1515.28 506.007,1446.5 508.315,1208.71 510.623,1453.07 512.931,1380.45 515.239,1431.91 517.546,1255.49 519.854,1344.11 522.162,1338.2 524.47,1366.82 526.778,1224.78 529.086,1350.85 531.394,1362.25 533.702,1546.63 536.01,1455.54 538.318,1449.58 540.626,1316.31 542.933,1488.86 545.241,1388.57 547.549,1519.15 549.857,1361.02 552.165,1385.26 554.473,1373.98 556.781,1450.12 559.089,1320.89 561.397,1432.27 563.705,1435.41 566.013,1207.25 568.321,1323.65 570.628,1426.63 572.936,1364.03 575.244,1326.46 577.552,1345.79 579.86,1514.72 582.168,1489.58 584.476,1410.72 586.784,1337.61 589.092,1456.11 591.4,1405.29 593.708,1189.32 596.015,1405.14 598.323,1350.73 600.631,1454.52 602.939,1219.84 605.247,1380.99 607.555,1450.53 609.863,1440.14 612.171,1438.35 614.479,1459.23 616.787,1394.74 619.095,1217.75 621.402,1351.99 623.71,1499.39 626.018,1267.34 628.326,1591.4 630.634,1497.07 632.942,1336.32 635.25,1422.84 637.558,1303.2 639.866,1469.26 642.174,1427.93 644.482,1417.51 646.79,1353.89 649.097,1384.17 651.405,1580.2 653.713,1498.79 656.021,1393.55 658.329,1382.65 660.637,1528.96 662.945,1539.39 665.253,1528.13 667.561,1361.6 669.869,1496.69 672.177,1281.08 674.484,1416.94 676.792,1252.06 679.1,1255.65 681.408,1378.66 683.716,1460.36 686.024,1359.71 688.332,1527.03 690.64,1298.04 692.948,1245.13 695.256,1465.09 697.564,1274.42 699.871,1530.83 702.179,1486.41 704.487,1277.42 706.795,1469.5 709.103,1469.88 711.411,1145.17 713.719,1234.82 716.027,1410.12 718.335,1328.87 720.643,1428.77 722.951,1484.01 725.259,1358.25 727.566,1199.15 729.874,1425.97 732.182,1354.57 734.49,1211.65 736.798,1320.45 739.106,1543.19 741.414,1465.19 743.722,1458.56 746.03,1467.65 748.338,1421.78 750.646,1616.12 752.953,1467.55 755.261,1455.24 757.569,1304.39 759.877,1602.49 762.185,1411.29 764.493,1189.96 766.801,1574.83 769.109,1534.93 771.417,1378.77 773.725,1345.37 776.033,1420.72 778.34,1503.82 780.648,1446.36 782.956,1444.27 785.264,1318.24 787.572,1423.36 789.88,1495.17 792.188,1490.68 794.496,1229.03 796.804,1437.49 799.112,1362.84 801.42,1398.14 803.728,1555.59 806.035,1425.1 808.343,1405.75 810.651,1315.39 812.959,1405.41 815.267,1645.19 817.575,1412.24 819.883,1442.83 822.191,1285.86 824.499,1418.33 826.807,1532.07 829.115,1371.33 831.422,1419.32 833.73,1264.78 836.038,1415.95 838.346,1467.16 840.654,1406.24 842.962,1291.2 845.27,1481.27 847.578,1426.23 849.886,1524.27 852.194,1383.88 854.502,1455.37 856.809,1395.36 859.117,1514.39 861.425,1277.19 863.733,1398.95 866.041,1424.9 868.349,1366.62 870.657,1399.21 872.965,1295.95 875.273,1369.05 877.581,1396.8 879.889,1217.24 882.197,1423.88 884.504,1429.49 886.812,1519.9 889.12,1326.96 891.428,1321.26 893.736,1286.62 896.044,1405.52 898.352,1438.43 900.66,1227.77 902.968,1396 905.276,1283.92 907.584,1234.1 909.891,1365.35 912.199,1365.46 914.507,1184.97 916.815,1309.42 919.123,1522.24 921.431,1376.6 923.739,1207.06 926.047,1651.8 928.355,1437.83 930.663,1310.28 932.971,1289.98 935.278,1317.32 937.586,1383.75 939.894,1391.29 942.202,1358.42 944.51,1347.05 946.818,1362.73 949.126,1294.11 951.434,1402.94 953.742,1455.77 956.05,1450.1 958.358,1387.15 960.665,1166.89 962.973,1263.69 965.281,1415.84 967.589,1537.03 969.897,1311.75 972.205,1312.19 974.513,1504.24 976.821,1429.35 979.129,1487.87 981.437,1066.42 983.745,1438.73 986.053,1412.41 988.36,1315.79 990.668,1284.27 992.976,1322.46 995.284,1389.22 997.592,1407.35 999.9,1437.3 1002.21,1482.35 1004.52,1466.68 1006.82,1351.94 1009.13,1400.32 1011.44,1396.93 1013.75,1345.32 1016.06,1254.51 1018.36,1432.55 1020.67,1243.47 1022.98,1464.72 1025.29,1439.76 1027.59,1360.68 1029.9,1363.36 1032.21,1353.54 1034.52,1206.07 1036.83,1200.37 1039.13,1351.71 1041.44,1323.74 1043.75,1342.14 1046.06,1154.54 1048.37,1405.79 1050.67,1403.09 1052.98,1331.99 1055.29,1521.12 1057.6,1328.24 1059.91,1562.65 1062.21,1390.57 1064.52,1358.16 1066.83,1234.64 1069.14,1491.49 1071.45,1524.5 1073.75,1306.78 1076.06,1449.26 1078.37,1402.15 1080.68,1443.42 1082.98,1490.8 1085.29,1594 1087.6,1323.15 1089.91,1354.44 1092.22,1662.26 1094.52,1553.82 1096.83,1556.04 1099.14,1430.3 1101.45,1232.68 1103.76,1383.21 1106.06,1393.58 1108.37,1509.31 1110.68,1552.44 1112.99,1541.07 1115.3,1248.58 1117.6,1284.8 1119.91,1459.56 1122.22,1468.93 1124.53,1341.4 1126.84,1278.95 1129.14,1461.22 1131.45,1414.51 1133.76,1408.66 1136.07,1550.58 1138.37,1361.11 1140.68,1419.15 1142.99,1316.67 1145.3,1424.67 1147.61,1391.6 1149.91,1418.26 1152.22,1386.69 1154.53,1321.47 1156.84,1349.81 1159.15,1354.44 1161.45,1300.5 1163.76,1288.55 1166.07,1377.17 1168.38,1219.74 1170.69,1347.57 1172.99,1370.55 1175.3,1439.91 1177.61,1291.94 1179.92,1429.5 1182.23,1378.35 1184.53,1366.4 1186.84,1476.11 1189.15,1380.19 1191.46,1374.65 1193.76,1376.95 1196.07,1430.91 1198.38,1316.47 1200.69,1499.51 1203,1265.49 1205.3,1288.04 1207.61,1302.78 1209.92,1260.29 1212.23,1477.17 1214.54,1359.87 1216.84,1727.2 1219.15,1585 1221.46,1342.66 1223.77,1206.16 1226.08,1370.01 1228.38,1571.14 1230.69,1318.77 1233,1412.25 1235.31,1438.77 1237.61,1377.75 1239.92,1398.49 1242.23,1309.45 1244.54,1368.74 1246.85,1462.86 1249.15,1244.07 1251.46,1271.84 1253.77,1304.58 1256.08,1315.79 1258.39,1433.01 1260.69,1460.8 1263,1299.75 1265.31,1353.68 1267.62,1487.77 1269.93,1263.54 1272.23,1392.7 1274.54,1499.18 1276.85,1390.14 1279.16,1459.97 1281.47,1168.43 1283.77,1531.36 1286.08,1461.01 1288.39,1301.01 1290.7,1484.67 1293,1439.3 1295.31,1426.42 1297.62,1349.54 1299.93,1472.69 1302.24,1362.12 1304.54,1307.52 1306.85,1230.74 1309.16,1598.23 1311.47,1529.96 1313.78,1511.61 1316.08,1373.02 1318.39,1467.35 1320.7,1476.37 1323.01,1357.2 1325.32,1499.04 1327.62,1375.41 1329.93,1400.74 1332.24,1300.77 1334.55,1375.95 1336.86,1389.42 1339.16,1298.32 1341.47,1357.85 1343.78,1284.5 1346.09,1304.94 1348.39,1573.21 1350.7,1297.73 1353.01,1219.84 1355.32,1575.67 1357.63,1526.5 1359.93,1376.52 1362.24,1448.26 1364.55,1423.88 1366.86,1159.17 1369.17,1301.61 1371.47,1300.48 1373.78,1384.24 1376.09,1598.22 1378.4,1526.48 1380.71,1342.2 1383.01,1690.87 1385.32,1325.08 1387.63,1424.67 1389.94,1395.51 1392.24,1507.68 1394.55,1301.41 1396.86,1512.97 1399.17,1197.98 1401.48,1516.68 1403.78,1327.86 1406.09,1548.92 1408.4,1286.18 1410.71,1560.38 1413.02,1413.94 1415.32,1204.2 1417.63,1600.65 1419.94,1505.35 1422.25,1360.94 1424.56,1546.27 1426.86,1382.74 1429.17,1360.1 1431.48,1283.52 1433.79,1440.04 1436.1,1352.35 1438.4,1342.21 1440.71,1488.15 1443.02,1533.8 1445.33,1481.95 1447.63,1529.38 1449.94,1300.89 1452.25,1296.44 1454.56,1374.46 1456.87,1472.93 1459.17,1344.71 1461.48,1458.3 1463.79,1186.62 1466.1,1486.83 1468.41,1567.35 1470.71,1551.2 1473.02,1419.79 1475.33,1465.15 1477.64,1300.13 1479.95,1569.38 1482.25,1296.69 1484.56,1361.28 1486.87,1372.73 1489.18,1505.48 1491.49,1329.29 1493.79,1456.7 1496.1,1383.54 1498.41,1332.47 1500.72,1381.45 1503.02,1433.8 1505.33,1381.35 1507.64,1375.79 1509.95,1300.07 1512.26,1450.97 1514.56,1161.16 1516.87,1472.09 1519.18,1582.1 1521.49,1345.61 1523.8,1407.13 1526.1,1514.25 1528.41,1316.41 1530.72,1235.4 1533.03,1540.38 1535.34,1155.83 1537.64,1303.76 1539.95,1396.92 1542.26,1491.88 1544.57,1374.45 1546.88,1376.46 1549.18,1542.09 1551.49,1381.02 1553.8,1274.53 1556.11,1290.62 1558.41,1349.28 1560.72,1311.09 1563.03,1432.26 1565.34,1384.82 1567.65,1203.14 1569.95,1347.89 1572.26,1512.59 1574.57,1454.92 1576.88,1248.31 1579.19,1488.16 1581.49,1461.62 1583.8,1240.79 1586.11,1351.07 1588.42,1558.6 1590.73,1334.7 1593.03,1171.81 1595.34,1394.62 1597.65,1350.7 1599.96,1276.5 1602.26,1433.4 1604.57,1426.7 1606.88,1441.78 1609.19,1260.62 1611.5,1288.61 1613.8,1279.69 1616.11,1394.62 1618.42,1328.64 1620.73,1251.31 1623.04,1214.56 1625.34,1331.69 1627.65,1331.25 1629.96,1302.25 1632.27,1353.8 1634.58,1388.29 1636.88,1598.4 1639.19,1520.22 1641.5,1316.26 1643.81,1495.93 1646.12,1470.68 1648.42,1487.01 1650.73,1310.33 1653.04,1530.7 1655.35,1425.78 1657.65,1278.94 1659.96,1441.12 1662.27,1144.89 1664.58,1386.39 1666.89,1402.85 1669.19,1341.95 1671.5,1204.47 1673.81,1460.46 1676.12,1372 1678.43,1293.6 1680.73,1314.84 1683.04,1310.03 1685.35,1299.79 1687.66,1411.62 1689.97,1407.09 1692.27,1413.12 1694.58,1323.76 1696.89,1412.51 1699.2,1410.67 1701.51,1355.31 1703.81,1414.97 1706.12,1243.06 1708.43,1337.26 1710.74,1385.55 1713.04,1370.2 1715.35,1602.01 1717.66,1444.58 1719.97,1354.88 1722.28,1517.72 1724.58,1254.73 1726.89,1313.7 1729.2,1377.06 1731.51,1365.94 1733.82,1571.78 1736.12,1469.77 1738.43,1393.24 1740.74,1272.51 1743.05,1371.66 1745.36,1378 1747.66,1434.13 1749.97,1422.82 1752.28,1504.37 1754.59,1244.13 1756.9,1358.83 1759.2,1549.13 1761.51,1282.22 1763.82,1336.87 1766.13,1375.68 1768.43,1386.53 1770.74,1344.16 1773.05,1325.31 1775.36,1484.06 1777.67,1430.42 1779.97,1348.9 1782.28,1555.65 1784.59,1317.27 1786.9,1403.85 1789.21,1160.94 1791.51,1416.58 1793.82,1323.3 1796.13,1411.27 1798.44,1418.16 1800.75,1525.98 1803.05,1465.86 1805.36,1270.79 1807.67,1382.92 1809.98,1318.99 1812.28,1451.04 1814.59,1380.34 1816.9,1447.87 1819.21,1406.3 1821.52,1334.25 1823.82,1387.93 1826.13,1338.3 1828.44,1484.44 1830.75,1394.99 1833.06,1305.21 1835.36,1416.31 1837.67,1402.38 1839.98,1336.03 1842.29,1454.06 1844.6,1352.96 1846.9,1418.04 1849.21,1324.93 1851.52,1547.4 1853.83,1342.77 1856.14,1463.73 1858.44,1463.33 1860.75,1319.11 1863.06,1430.4 1865.37,1291.8 1867.67,1314.46 1869.98,1367.5 1872.29,1425.14 1874.6,1350.83 1876.91,1433.49 1879.21,1476.24 1881.52,1487.5 1883.83,1359.85 1886.14,1374.58 1888.45,1417.31 1890.75,1344.12 1893.06,1458.84 1895.37,1552 1897.68,1271.93 1899.99,1321.8 1902.29,1202.41 1904.6,1426.83 1906.91,1442.64 1909.22,1294.41 1911.53,1371.73 1913.83,1402.98 1916.14,1404.03 1918.45,1437.89 1920.76,1302.92 1923.06,1257.35 1925.37,1518.3 1927.68,1380.44 1929.99,1410.75 1932.3,1115.56 1934.6,1456.84 1936.91,1311.82 1939.22,1498.84 1941.53,1500.4 1943.84,1185.28 1946.14,1475.52 1948.45,1237.75 1950.76,1357.17 1953.07,1355.48 1955.38,1283.56 1957.68,1199.97 1959.99,1307.3 1962.3,1356.66 1964.61,1531.08 1966.91,1274.64 1969.22,1359.57 1971.53,1379.83 1973.84,1362.35 1976.15,1261.84 1978.45,1349.12 1980.76,1405.07 1983.07,1442.64 1985.38,1463.32 1987.69,1249.18 1989.99,1501.2 1992.3,1466.44 1994.61,1414.98 1996.92,1446.03 1999.23,1477.85 2001.53,1381.55 2003.84,1254.86 2006.15,1314.91 2008.46,1287.31 2010.77,1509.85 2013.07,1431.31 2015.38,1406.66 2017.69,1375.91 2020,1365.69 2022.3,1265 2024.61,1351.4 2026.92,1295.62 2029.23,1379.01 2031.54,1381.18 2033.84,1506.14 2036.15,1350.54 2038.46,1109.34 2040.77,1429.63 2043.08,1238.63 2045.38,1401.72 2047.69,1549.09 2050,1327.29 2052.31,1374.42 2054.62,1411.64 2056.92,1274.06 2059.23,1248.32 2061.54,1546.8 2063.85,1405.76 2066.16,1174.23 2068.46,1161.13 2070.77,1345.62 2073.08,1429.92 2075.39,1394.59 2077.69,1272.57 2080,1504.07 2082.31,1398.16 2084.62,1298.82 2086.93,1517.63 2089.23,1168.24 2091.54,1511.11 2093.85,1327.75 2096.16,1397.53 2098.47,1478.42 2100.77,1319.44 2103.08,1475.6 2105.39,1565.59 2107.7,1283.79 2110.01,1409.01 2112.31,1416.49 2114.62,1443.65 2116.93,1335.84 2119.24,1106.55 2121.55,1392.81 2123.85,1446.42 2126.16,1286.97 2128.47,1464.75 2130.78,1278.77 2133.08,1328.65 2135.39,1535.62 2137.7,1262.14 2140.01,1651.71 2142.32,1751.15 2144.62,1640.21 2146.93,1453.44 2149.24,1348.38 2151.55,1509.29 2153.86,1377 2156.16,1314.04 2158.47,1280.72 2160.78,1414.11 2163.09,1392.24 2165.4,1508.54 2167.7,1386.9 2170.01,1469.37 2172.32,1435.3 2174.63,1440.32 2176.93,1392.72 2179.24,1428.7 2181.55,1311.15 2183.86,1475.49 2186.17,1347.02 2188.47,1437.77 2190.78,1506.3 2193.09,1185.46 2195.4,1161.16 2197.71,1403.24 2200.01,1382.92 2202.32,1416.57 2204.63,1213.94 2206.94,1278.91 2209.25,1372.62 2211.55,1262.41 2213.86,1493.85 2216.17,1319.31 2218.48,1361.31 2220.79,1456.52 2223.09,1455.17 2225.4,1273.78 2227.71,1286.46 2230.02,1350.07 2232.32,1292.06 2234.63,1077.59 2236.94,1265.65 2239.25,1366.36 2241.56,1430.05 2243.86,1477.76 2246.17,1362.22 2248.48,1459.03 2250.79,1174.25 2253.1,1436.76 2255.4,1450.72 2257.71,1355.18 2260.02,1377.27 2262.33,1532.85 2264.64,1337.03 2266.94,1240.84 2269.25,1322.95 2271.56,1433.73 2273.87,1430.17 2276.18,1217.35 2278.48,1231.52 2280.79,1446.94 2283.1,1360.25 2285.41,1455.36 2287.71,1410.62 2290.02,1287.53 2292.33,1538.79 2294.64,1239.98 2296.95,1287.02 2299.25,1304.35 2301.56,1452.89 2303.87,1342.65 2306.18,1353.89 2308.49,1606.45 2310.79,1462.89 2313.1,1339.6 2315.41,1312.25 2317.72,1548.1 2320.03,1383.02 2322.33,1471.46 2324.64,1372.58 2326.95,1406.43 2329.26,1506.94 2331.56,1350.15 2333.87,1318.86 2336.18,1441.19 2338.49,1296.75 2340.8,1300.45 2343.1,1460.15 2345.41,1333.96 2347.72,1475.17 2350.03,1352.5 2352.34,1257.6 2354.64,1233.73 2356.95,1467.15 2359.26,1372.33 2361.57,1355.47 2363.88,1356.38 2366.18,1452.76 2368.49,1415.99 2370.8,1428.57 2373.11,1542.52 2375.42,1425.76 2377.72,1416.18 2380.03,1326.24 2382.34,1272.11 2384.65,1256.18 2386.95,1425.28 2389.26,1220.69 2391.57,1249.12 2393.88,1382.62 2396.19,1523.77 2398.49,1332.69 2400.8,1277.28 2403.11,1474.89 2405.42,1301.96 2407.73,1480.42 2410.03,1242.52 2412.34,1189.52 2414.65,1381.05 2416.96,1522.53 2419.27,1328.59 2421.57,1298.68 2423.88,1602.3 2426.19,1381.71 2428.5,1405.9 2430.81,1427.81 2433.11,1400.07 2435.42,1428.38 2437.73,1463.89 2440.04,1266.51 2442.34,1563.06 2444.65,1322.02 2446.96,1337.77 2449.27,1216.83 2451.58,1429.24 2453.88,1526.03 2456.19,1459.19 2458.5,1422.03 2460.81,1533.63 2463.12,1394.2 2465.42,1364.49 2467.73,1283.42 2470.04,1276.07 2472.35,1403.25 2474.66,1401.62 2476.96,1402.12 2479.27,1330.31 2481.58,1187.45 2483.89,1420.72 2486.2,1421.68 2488.5,1360.75 2490.81,1484.2 2493.12,1318.56 2495.43,1350.22 2497.73,1356.76 2500.04,1287.89 2502.35,1313.45 2504.66,1506.96 2506.97,1376.64 2509.27,1488.51 2511.58,1358.36 2513.89,1229.14 2516.2,1221.55 2518.51,1348.48 2520.81,1508.47 2523.12,1453.25 2525.43,1411.44 2527.74,1504.87 2530.05,1328.59 2532.35,1434.68 2534.66,1568.15 2536.97,1381.82 2539.28,1543.35 2541.58,1623.26 2543.89,1317.85 2546.2,1330.86 2548.51,1520.53 2550.82,1293.86 2553.12,1367.9 2555.43,1314.74 2557.74,1463.05 2560.05,1427.39 2562.36,1417.71 2564.66,1158.38 2566.97,1425.72 2569.28,1440.66 2571.59,1354.41 "></polyline>
<polyline clip-path="url(#clip022)" style="stroke:#e26f46; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="265.984,899.791 268.292,809.73 270.6,1071.91 272.908,1022.79 275.216,990.422 277.524,851.498 279.832,772.368 282.139,895.754 284.447,992.469 286.755,843.174 289.063,797.536 291.371,834.796 293.679,904.356 295.987,756.597 298.295,901.514 300.603,825.937 302.911,996.487 305.219,836.283 307.527,987.808 309.834,884.246 312.142,874.093 314.45,850.18 316.758,941.124 319.066,994.332 321.374,817.562 323.682,1081.74 325.99,780.832 328.298,948.334 330.606,738.012 332.914,822.496 335.221,894.504 337.529,988.635 339.837,847.061 342.145,956.398 344.453,1067.93 346.761,977.812 349.069,946.488 351.377,754.365 353.685,955.33 355.993,916.309 358.301,939.608 360.608,797.441 362.916,947.779 365.224,740.57 367.532,925.314 369.84,864.959 372.148,1018.68 374.456,984.833 376.764,845.311 379.072,911.561 381.38,932.483 383.688,952.372 385.996,889.455 388.303,954.551 390.611,770.413 392.919,761.335 395.227,879.239 397.535,887.95 399.843,873.78 402.151,930.795 404.459,822.005 406.767,807.135 409.075,956.649 411.383,872.94 413.69,996.634 415.998,910.434 418.306,655.041 420.614,871.999 422.922,1017.09 425.23,864.636 427.538,1010.8 429.846,758.921 432.154,816.406 434.462,811.704 436.77,895.009 439.077,882.669 441.385,953.978 443.693,914.694 446.001,862.23 448.309,952.607 450.617,923.493 452.925,880.979 455.233,867.91 457.541,986.771 459.849,812.464 462.157,636.892 464.465,854.263 466.772,981.96 469.08,937.919 471.388,940.915 473.696,722.965 476.004,896.796 478.312,952.642 480.62,830.151 482.928,1133.37 485.236,892.5 487.544,1020.51 489.852,736.385 492.159,912.679 494.467,852.836 496.775,866.086 499.083,984.324 501.391,933.488 503.699,948.248 506.007,923.31 508.315,977.309 510.623,893.027 512.931,926.873 515.239,823.82 517.546,878.475 519.854,845.095 522.162,850.32 524.47,951.705 526.778,916.79 529.086,954.888 531.394,939.185 533.702,1003.77 536.01,1030.26 538.318,973.847 540.626,900.322 542.933,845.891 545.241,888.776 547.549,990.22 549.857,728.137 552.165,892.002 554.473,981.467 556.781,895.073 559.089,862.204 561.397,1008.81 563.705,948.367 566.013,895.397 568.321,898.48 570.628,862.466 572.936,907.6 575.244,988.28 577.552,948.414 579.86,902.262 582.168,920.84 584.476,919.737 586.784,942.966 589.092,915.051 591.4,873.007 593.708,922.693 596.015,872.919 598.323,868.954 600.631,771.979 602.939,932.934 605.247,793.877 607.555,956.897 609.863,955.19 612.171,935.123 614.479,1033.08 616.787,916.213 619.095,790.612 621.402,1034.63 623.71,947.693 626.018,927.818 628.326,828.011 630.634,924.727 632.942,775.514 635.25,1050.72 637.558,862.7 639.866,1025 642.174,966.626 644.482,975.48 646.79,981.449 649.097,755.163 651.405,833.498 653.713,953.594 656.021,1142.01 658.329,932.334 660.637,1118.02 662.945,900.039 665.253,866.063 667.561,963.834 669.869,950.46 672.177,960.782 674.484,1064.06 676.792,951.116 679.1,763.648 681.408,786.144 683.716,887.513 686.024,928.224 688.332,1038.93 690.64,1062.24 692.948,979.819 695.256,992.37 697.564,959.922 699.871,906.21 702.179,998.993 704.487,911.332 706.795,799.685 709.103,970.655 711.411,992.726 713.719,1132.6 716.027,847.578 718.335,755.549 720.643,651.617 722.951,841.619 725.259,676.896 727.566,850.946 729.874,733.854 732.182,922.772 734.49,739.723 736.798,1005.48 739.106,927.601 741.414,834.586 743.722,771.524 746.03,928.95 748.338,851.589 750.646,1037.57 752.953,896.099 755.261,871.653 757.569,789.976 759.877,895.265 762.185,827.071 764.493,972.243 766.801,991.851 769.109,1009.36 771.417,839.329 773.725,829.474 776.033,847.215 778.34,781.374 780.648,932.74 782.956,974.305 785.264,1074.72 787.572,715.485 789.88,1036.65 792.188,941.373 794.496,849.206 796.804,967.916 799.112,998.842 801.42,836.674 803.728,765.25 806.035,908.909 808.343,763.275 810.651,791.916 812.959,818.218 815.267,936.389 817.575,985.821 819.883,793.095 822.191,959.713 824.499,976.881 826.807,942.073 829.115,781.202 831.422,1092.45 833.73,1012.67 836.038,910.301 838.346,872.232 840.654,1040.02 842.962,810.028 845.27,830.447 847.578,960.743 849.886,1160.24 852.194,911.678 854.502,798.445 856.809,708.201 859.117,996.556 861.425,873.69 863.733,751.491 866.041,901.353 868.349,903.164 870.657,1072.77 872.965,842.995 875.273,877.139 877.581,999.419 879.889,909.479 882.197,780.348 884.504,913.834 886.812,837.264 889.12,937.807 891.428,898.902 893.736,876.665 896.044,952.737 898.352,890.124 900.66,732.77 902.968,793.679 905.276,886.521 907.584,921.896 909.891,865.997 912.199,946.663 914.507,1034.59 916.815,829.134 919.123,715.647 921.431,918.886 923.739,861.627 926.047,748.74 928.355,958.923 930.663,818.636 932.971,874.424 935.278,851.276 937.586,916.055 939.894,861.101 942.202,780.286 944.51,906.175 946.818,905.122 949.126,787.632 951.434,966.065 953.742,847.173 956.05,826.283 958.358,915.704 960.665,1039.32 962.973,838.42 965.281,974.563 967.589,833.677 969.897,969.528 972.205,899.951 974.513,813.112 976.821,850.058 979.129,787.049 981.437,853.447 983.745,882.455 986.053,772.082 988.36,701.426 990.668,1011.95 992.976,1081.63 995.284,890.974 997.592,848.955 999.9,931.334 1002.21,796.175 1004.52,921.647 1006.82,757.426 1009.13,910.981 1011.44,884.209 1013.75,893.019 1016.06,1000.64 1018.36,900.721 1020.67,989.74 1022.98,671.614 1025.29,801.835 1027.59,885.478 1029.9,805.566 1032.21,887.94 1034.52,879.771 1036.83,682.596 1039.13,858.577 1041.44,873.178 1043.75,797.063 1046.06,921.989 1048.37,855.482 1050.67,903.733 1052.98,1125.7 1055.29,993.589 1057.6,884.478 1059.91,996.144 1062.21,1100.53 1064.52,837.126 1066.83,1121.64 1069.14,932.628 1071.45,808.2 1073.75,1023.18 1076.06,811.401 1078.37,910.578 1080.68,960.718 1082.98,1044 1085.29,951.577 1087.6,807.848 1089.91,900.821 1092.22,849.47 1094.52,990.943 1096.83,852.073 1099.14,940.073 1101.45,919.701 1103.76,1014.17 1106.06,840.107 1108.37,935.774 1110.68,844.384 1112.99,966.358 1115.3,666.682 1117.6,1026.7 1119.91,1179.29 1122.22,824.671 1124.53,859.062 1126.84,854.943 1129.14,1004.23 1131.45,782.622 1133.76,1000.55 1136.07,1049.88 1138.37,676.56 1140.68,802.486 1142.99,928.888 1145.3,874.644 1147.61,804.886 1149.91,812.382 1152.22,927.435 1154.53,1057.55 1156.84,726.129 1159.15,779.325 1161.45,858.774 1163.76,944.121 1166.07,817.044 1168.38,844.762 1170.69,859.699 1172.99,904.011 1175.3,822.204 1177.61,943.414 1179.92,1014.89 1182.23,926.465 1184.53,752.681 1186.84,926.836 1189.15,799.374 1191.46,847.944 1193.76,754.897 1196.07,762.723 1198.38,969.16 1200.69,969.997 1203,855.654 1205.3,1070.72 1207.61,775.325 1209.92,1061.44 1212.23,854.545 1214.54,885.282 1216.84,871.946 1219.15,913.857 1221.46,977.067 1223.77,874.524 1226.08,947.297 1228.38,736.821 1230.69,818.458 1233,942.139 1235.31,1016.28 1237.61,950.184 1239.92,1147.45 1242.23,817.967 1244.54,971.536 1246.85,920.354 1249.15,928.608 1251.46,894.562 1253.77,935.937 1256.08,675.454 1258.39,935.383 1260.69,888.234 1263,1114.72 1265.31,949.535 1267.62,881.451 1269.93,881.456 1272.23,806.5 1274.54,783.67 1276.85,762.226 1279.16,905.34 1281.47,938.031 1283.77,904.108 1286.08,886.472 1288.39,900.417 1290.7,949.48 1293,959.288 1295.31,824.123 1297.62,1021.24 1299.93,907.041 1302.24,909.09 1304.54,766.045 1306.85,907.919 1309.16,882.087 1311.47,831.344 1313.78,764.154 1316.08,784.238 1318.39,830.186 1320.7,1022.44 1323.01,923.009 1325.32,900.63 1327.62,899.952 1329.93,1051.69 1332.24,1027.61 1334.55,803.166 1336.86,815.833 1339.16,843.328 1341.47,940.376 1343.78,943.818 1346.09,944.671 1348.39,903.225 1350.7,758.815 1353.01,805.395 1355.32,1023.59 1357.63,905.982 1359.93,1024.38 1362.24,881.591 1364.55,676.296 1366.86,816.886 1369.17,1054.5 1371.47,853.924 1373.78,861.869 1376.09,949.353 1378.4,948.555 1380.71,925.046 1383.01,953.735 1385.32,804.228 1387.63,763.466 1389.94,932.936 1392.24,1094.41 1394.55,982.009 1396.86,923.96 1399.17,791.066 1401.48,878.862 1403.78,987.567 1406.09,1114.73 1408.4,889.208 1410.71,746.141 1413.02,1013.46 1415.32,830.564 1417.63,934.821 1419.94,844.809 1422.25,757.209 1424.56,945.213 1426.86,952.256 1429.17,1174.22 1431.48,808.141 1433.79,781.107 1436.1,789.864 1438.4,853.428 1440.71,990.535 1443.02,1044.96 1445.33,900.001 1447.63,864.58 1449.94,1009.76 1452.25,854.175 1454.56,980.997 1456.87,899.719 1459.17,1050.89 1461.48,1017.58 1463.79,816.094 1466.1,899.049 1468.41,857.454 1470.71,845.589 1473.02,905.93 1475.33,846.146 1477.64,885.385 1479.95,906.478 1482.25,1029.16 1484.56,892.516 1486.87,872.956 1489.18,1024.61 1491.49,839.438 1493.79,842.884 1496.1,876.307 1498.41,832.896 1500.72,834.298 1503.02,928.675 1505.33,1023.83 1507.64,873.832 1509.95,1115.4 1512.26,847.23 1514.56,885.768 1516.87,834.754 1519.18,751.538 1521.49,952.519 1523.8,950.736 1526.1,890.468 1528.41,955.013 1530.72,915.211 1533.03,1000.33 1535.34,915.801 1537.64,803.588 1539.95,1070.71 1542.26,1065.95 1544.57,892.106 1546.88,855.785 1549.18,894.805 1551.49,759.724 1553.8,529.163 1556.11,949.891 1558.41,1022.43 1560.72,745.88 1563.03,911.298 1565.34,938.936 1567.65,811.065 1569.95,907.562 1572.26,896.734 1574.57,897.726 1576.88,949.097 1579.19,745.199 1581.49,919.749 1583.8,956.413 1586.11,823.382 1588.42,956.269 1590.73,872.336 1593.03,972.422 1595.34,892.339 1597.65,989.492 1599.96,958.776 1602.26,851.659 1604.57,894.288 1606.88,879.056 1609.19,992.348 1611.5,980.751 1613.8,879.461 1616.11,974.519 1618.42,803.537 1620.73,737.339 1623.04,784.576 1625.34,987.506 1627.65,1036.33 1629.96,744.742 1632.27,910.154 1634.58,878.876 1636.88,825.672 1639.19,839.442 1641.5,792.432 1643.81,815.232 1646.12,870.714 1648.42,911.376 1650.73,1037.81 1653.04,892.741 1655.35,796.901 1657.65,1022.94 1659.96,993.497 1662.27,884.579 1664.58,966.277 1666.89,879.717 1669.19,809.467 1671.5,982.91 1673.81,933.957 1676.12,640.14 1678.43,766.339 1680.73,860.111 1683.04,830.741 1685.35,801.155 1687.66,1063.38 1689.97,991.838 1692.27,1056.91 1694.58,922.103 1696.89,996.534 1699.2,995.101 1701.51,1036.46 1703.81,928.467 1706.12,808.48 1708.43,762.634 1710.74,917.802 1713.04,852.312 1715.35,914.186 1717.66,1054.77 1719.97,843.189 1722.28,941.04 1724.58,895.953 1726.89,1072.56 1729.2,1005.31 1731.51,911.358 1733.82,776.032 1736.12,807.939 1738.43,1025.55 1740.74,835.458 1743.05,869.204 1745.36,1025.61 1747.66,886.75 1749.97,930.444 1752.28,864.694 1754.59,946.025 1756.9,1036.68 1759.2,851.781 1761.51,684.023 1763.82,1013.24 1766.13,896.699 1768.43,856.294 1770.74,1023.45 1773.05,1017.27 1775.36,859.502 1777.67,901.22 1779.97,926.845 1782.28,909.34 1784.59,995.095 1786.9,896.485 1789.21,877.196 1791.51,1025.67 1793.82,1057.34 1796.13,877.371 1798.44,977.671 1800.75,904.869 1803.05,992.388 1805.36,963.562 1807.67,889.004 1809.98,1000.03 1812.28,1094.54 1814.59,905.608 1816.9,791.61 1819.21,955.593 1821.52,805.165 1823.82,890.695 1826.13,899.161 1828.44,874.025 1830.75,824.147 1833.06,1069.88 1835.36,1011.17 1837.67,755.089 1839.98,931.17 1842.29,1052.87 1844.6,950.061 1846.9,847.484 1849.21,991.172 1851.52,995.261 1853.83,931.396 1856.14,1011.2 1858.44,871.171 1860.75,842.739 1863.06,944.454 1865.37,800.328 1867.67,660.995 1869.98,925.993 1872.29,1127.3 1874.6,812.291 1876.91,733.981 1879.21,967.509 1881.52,629.942 1883.83,772.99 1886.14,778.263 1888.45,832.823 1890.75,1099.36 1893.06,869.561 1895.37,959.365 1897.68,854.801 1899.99,963.751 1902.29,928.209 1904.6,868.105 1906.91,833.452 1909.22,784.231 1911.53,998.594 1913.83,650.127 1916.14,917.351 1918.45,940.901 1920.76,802.996 1923.06,967.384 1925.37,957.252 1927.68,945.783 1929.99,980.392 1932.3,1110.6 1934.6,830.505 1936.91,977.462 1939.22,1012.06 1941.53,763.066 1943.84,772.471 1946.14,741.244 1948.45,911.423 1950.76,959.158 1953.07,1059.6 1955.38,921.284 1957.68,1057.25 1959.99,964.212 1962.3,851.77 1964.61,696.608 1966.91,875.648 1969.22,838.482 1971.53,758.303 1973.84,873.34 1976.15,940.033 1978.45,827.205 1980.76,855.744 1983.07,857.177 1985.38,1001.95 1987.69,924.495 1989.99,824.035 1992.3,742.481 1994.61,848.603 1996.92,949.55 1999.23,960.798 2001.53,838.889 2003.84,822.36 2006.15,866.209 2008.46,1021.94 2010.77,868.597 2013.07,904.518 2015.38,1082.46 2017.69,833.688 2020,759.79 2022.3,823.486 2024.61,1052.37 2026.92,757.011 2029.23,1040.04 2031.54,1035.71 2033.84,938.807 2036.15,963.858 2038.46,798.171 2040.77,723.733 2043.08,773.977 2045.38,966.51 2047.69,1033.57 2050,874.791 2052.31,907.714 2054.62,944.902 2056.92,738.525 2059.23,865.246 2061.54,961.388 2063.85,786.159 2066.16,1079.77 2068.46,1001.19 2070.77,1066.45 2073.08,957.461 2075.39,880.639 2077.69,871.184 2080,1053.75 2082.31,941.918 2084.62,846.249 2086.93,1045.69 2089.23,1081.84 2091.54,1078.63 2093.85,890.254 2096.16,1061.52 2098.47,789.172 2100.77,870.254 2103.08,843.489 2105.39,867.93 2107.7,681.006 2110.01,988.536 2112.31,950.868 2114.62,877.703 2116.93,791.873 2119.24,748.661 2121.55,996.177 2123.85,960.351 2126.16,876.392 2128.47,905.364 2130.78,1130.5 2133.08,849.145 2135.39,835.606 2137.7,935.706 2140.01,903.009 2142.32,850.434 2144.62,1000.21 2146.93,957.059 2149.24,1087.72 2151.55,980.606 2153.86,842.994 2156.16,1006.44 2158.47,795.198 2160.78,753.833 2163.09,938.905 2165.4,983.435 2167.7,876.509 2170.01,876.63 2172.32,961.759 2174.63,815.017 2176.93,920.358 2179.24,1052.95 2181.55,737.5 2183.86,985.038 2186.17,852.806 2188.47,897.314 2190.78,878.596 2193.09,993.139 2195.4,941.61 2197.71,972.51 2200.01,895.736 2202.32,902.843 2204.63,985.866 2206.94,876.89 2209.25,827.399 2211.55,840.276 2213.86,952.025 2216.17,908.4 2218.48,859.963 2220.79,830.841 2223.09,988.553 2225.4,1083.11 2227.71,1041.28 2230.02,987.265 2232.32,962.818 2234.63,762.327 2236.94,973.083 2239.25,1063.77 2241.56,1036.42 2243.86,835.096 2246.17,813.42 2248.48,1015.13 2250.79,916.84 2253.1,895.368 2255.4,725.782 2257.71,782.182 2260.02,985.06 2262.33,878.188 2264.64,816.881 2266.94,800.103 2269.25,1049.19 2271.56,797.359 2273.87,918.033 2276.18,935.259 2278.48,1068.28 2280.79,851.808 2283.1,927.677 2285.41,787.317 2287.71,1079.67 2290.02,1055.45 2292.33,762.694 2294.64,806.001 2296.95,1036.29 2299.25,876.67 2301.56,1094.72 2303.87,825.973 2306.18,966.684 2308.49,900.39 2310.79,875.906 2313.1,968.177 2315.41,631.096 2317.72,738.667 2320.03,848.519 2322.33,718.883 2324.64,797.57 2326.95,663.538 2329.26,1021.17 2331.56,662.418 2333.87,874.111 2336.18,964.273 2338.49,867.302 2340.8,993.453 2343.1,879.896 2345.41,1000.23 2347.72,796.916 2350.03,961.897 2352.34,826.607 2354.64,884.996 2356.95,718.781 2359.26,958.759 2361.57,923.962 2363.88,823.448 2366.18,800.514 2368.49,844.045 2370.8,691.383 2373.11,850.195 2375.42,951.16 2377.72,954.751 2380.03,1129.8 2382.34,818.915 2384.65,841.669 2386.95,965.542 2389.26,889.462 2391.57,1057.49 2393.88,810.366 2396.19,763.487 2398.49,703.223 2400.8,933.859 2403.11,826.559 2405.42,1064.68 2407.73,853.519 2410.03,948.931 2412.34,991.354 2414.65,1015.72 2416.96,1075.87 2419.27,834.845 2421.57,975.046 2423.88,953.793 2426.19,873.2 2428.5,1001.29 2430.81,849.272 2433.11,858.051 2435.42,796.448 2437.73,803.481 2440.04,906.159 2442.34,842.373 2444.65,864.09 2446.96,1046.85 2449.27,967.661 2451.58,905.539 2453.88,879.587 2456.19,902.534 2458.5,1129.42 2460.81,1067.37 2463.12,953.985 2465.42,665.232 2467.73,747.4 2470.04,821.07 2472.35,879.878 2474.66,927.663 2476.96,1074.3 2479.27,960.032 2481.58,881.015 2483.89,759.51 2486.2,825.094 2488.5,793.578 2490.81,868.844 2493.12,1001.5 2495.43,993.289 2497.73,857.838 2500.04,880.148 2502.35,934.774 2504.66,872.157 2506.97,875.749 2509.27,766.591 2511.58,870.984 2513.89,884.906 2516.2,1040.47 2518.51,867.581 2520.81,627.888 2523.12,820.247 2525.43,967.315 2527.74,857.864 2530.05,857.052 2532.35,931.399 2534.66,940.038 2536.97,990.579 2539.28,942.75 2541.58,809.75 2543.89,883.964 2546.2,904.675 2548.51,957.522 2550.82,751.271 2553.12,658.299 2555.43,838.582 2557.74,881.833 2560.05,833.081 2562.36,832.756 2564.66,858.552 2566.97,989.9 2569.28,838.333 2571.59,897.237 "></polyline>
<polyline clip-path="url(#clip022)" style="stroke:#3da44d; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="265.984,695.783 268.292,347.207 270.6,458.207 272.908,285.062 275.216,487.022 277.524,529.993 279.832,523.494 282.139,571.403 284.447,366.988 286.755,464.608 289.063,344.595 291.371,407.432 293.679,519.067 295.987,521.745 298.295,447.367 300.603,475.259 302.911,278.645 305.219,659.413 307.527,267.506 309.834,497.733 312.142,353.902 314.45,536.391 316.758,331.252 319.066,384.586 321.374,472.914 323.682,600.126 325.99,386.235 328.298,512.58 330.606,312.883 332.914,341.731 335.221,378.825 337.529,393.091 339.837,215.351 342.145,428.191 344.453,348.4 346.761,483.622 349.069,499.464 351.377,455.51 353.685,299.718 355.993,338.213 358.301,301.845 360.608,271.643 362.916,429.862 365.224,348.935 367.532,262.315 369.84,303.875 372.148,336.96 374.456,501.609 376.764,512.662 379.072,432.681 381.38,430.444 383.688,472.792 385.996,592.875 388.303,317.709 390.611,283.736 392.919,502.387 395.227,411.213 397.535,510.054 399.843,389.45 402.151,392.664 404.459,447.035 406.767,429.077 409.075,367.252 411.383,449.227 413.69,342.962 415.998,506.514 418.306,375.169 420.614,487.102 422.922,450.656 425.23,291.069 427.538,409.349 429.846,316.122 432.154,428.261 434.462,448.691 436.77,406.841 439.077,353.335 441.385,490.848 443.693,461.379 446.001,331.393 448.309,269.404 450.617,265.125 452.925,420.698 455.233,307.428 457.541,394.321 459.849,382.091 462.157,329.119 464.465,542.838 466.772,397.598 469.08,528.211 471.388,461.677 473.696,592.59 476.004,504.138 478.312,345.454 480.62,570.054 482.928,281.221 485.236,413.043 487.544,582.433 489.852,296.936 492.159,418.67 494.467,437.259 496.775,463.472 499.083,453.716 501.391,249.523 503.699,473.81 506.007,318.388 508.315,410.425 510.623,341.865 512.931,282.557 515.239,471.482 517.546,469.429 519.854,344.893 522.162,525.632 524.47,498.329 526.778,417.566 529.086,532.88 531.394,246.644 533.702,534.58 536.01,373.648 538.318,428.838 540.626,532.005 542.933,486.841 545.241,277.152 547.549,406.758 549.857,319.237 552.165,454.703 554.473,421.675 556.781,284.743 559.089,313.803 561.397,330.054 563.705,435.152 566.013,277.051 568.321,392.493 570.628,394.776 572.936,331.162 575.244,396.776 577.552,236.249 579.86,390.177 582.168,377.191 584.476,401.479 586.784,389.188 589.092,488.053 591.4,627.578 593.708,357.538 596.015,477.531 598.323,560.276 600.631,425.29 602.939,334.11 605.247,535.494 607.555,462.305 609.863,529.283 612.171,358.52 614.479,354.31 616.787,447.234 619.095,467.538 621.402,466.833 623.71,317.397 626.018,243.724 628.326,290.428 630.634,449.921 632.942,376.736 635.25,329.705 637.558,475.026 639.866,434.166 642.174,349.908 644.482,312.978 646.79,410.392 649.097,257.706 651.405,461.75 653.713,434.116 656.021,593.538 658.329,434.881 660.637,466.65 662.945,390.032 665.253,547.457 667.561,470.936 669.869,621.556 672.177,406.246 674.484,422.944 676.792,490.052 679.1,316.762 681.408,407.025 683.716,557.131 686.024,549.902 688.332,174.572 690.64,390.162 692.948,364.388 695.256,307.928 697.564,368.169 699.871,506.601 702.179,513.044 704.487,457.206 706.795,220.644 709.103,337.256 711.411,436.629 713.719,226.38 716.027,459.829 718.335,222.472 720.643,240.36 722.951,344.127 725.259,387.138 727.566,423.374 729.874,482.429 732.182,472.085 734.49,370.655 736.798,298.384 739.106,524.601 741.414,435.666 743.722,488.311 746.03,330.722 748.338,374.351 750.646,522.023 752.953,286.16 755.261,468.607 757.569,516.994 759.877,503.717 762.185,516.794 764.493,398.101 766.801,282.991 769.109,447.853 771.417,570.212 773.725,458.652 776.033,441.148 778.34,411.45 780.648,314.69 782.956,293.897 785.264,374.861 787.572,477.175 789.88,384.954 792.188,357.786 794.496,220.918 796.804,406.893 799.112,564.125 801.42,552.321 803.728,486.503 806.035,327.95 808.343,532.501 810.651,574.332 812.959,365.216 815.267,200.872 817.575,658.462 819.883,393.524 822.191,587.338 824.499,423.589 826.807,370.32 829.115,358.66 831.422,476.433 833.73,333.382 836.038,423.661 838.346,350.355 840.654,285.767 842.962,505.777 845.27,515.183 847.578,478.393 849.886,388.24 852.194,431.162 854.502,381.267 856.809,410.104 859.117,411.888 861.425,391.896 863.733,335.189 866.041,551.701 868.349,447.773 870.657,395.335 872.965,408.384 875.273,425.786 877.581,332.057 879.889,343.887 882.197,471.373 884.504,445.955 886.812,209.659 889.12,460.158 891.428,245.192 893.736,433.595 896.044,376.899 898.352,516.889 900.66,416.808 902.968,399.39 905.276,454.422 907.584,495.341 909.891,454.256 912.199,289.138 914.507,244.546 916.815,367.289 919.123,461.396 921.431,399.357 923.739,482.17 926.047,383.339 928.355,334.257 930.663,384.454 932.971,380.096 935.278,384.005 937.586,435.585 939.894,587.636 942.202,426.206 944.51,462.695 946.818,582.884 949.126,315.407 951.434,311.199 953.742,260.95 956.05,310.235 958.358,517.113 960.665,490.942 962.973,272.222 965.281,439.044 967.589,390.752 969.897,307.059 972.205,424.612 974.513,397.663 976.821,601.842 979.129,350.788 981.437,621.171 983.745,540.783 986.053,715.369 988.36,503.109 990.668,281.468 992.976,560.313 995.284,436.001 997.592,495.079 999.9,376.873 1002.21,433.893 1004.52,309.15 1006.82,434.649 1009.13,616.863 1011.44,346.403 1013.75,530.106 1016.06,339.818 1018.36,539.58 1020.67,470.642 1022.98,290.406 1025.29,483.036 1027.59,383.207 1029.9,363.736 1032.21,325.656 1034.52,418.167 1036.83,302.778 1039.13,305.335 1041.44,428.709 1043.75,377.242 1046.06,431.41 1048.37,479.609 1050.67,352.268 1052.98,303.729 1055.29,395.774 1057.6,420.553 1059.91,518.721 1062.21,430.064 1064.52,378.721 1066.83,485.95 1069.14,510.425 1071.45,470.169 1073.75,392.853 1076.06,562.276 1078.37,419.542 1080.68,517.403 1082.98,483.907 1085.29,354.949 1087.6,542.31 1089.91,326.89 1092.22,435.736 1094.52,357.236 1096.83,241.674 1099.14,494.469 1101.45,430.017 1103.76,375.962 1106.06,439.006 1108.37,476.666 1110.68,433.976 1112.99,509.347 1115.3,382.844 1117.6,379.414 1119.91,481.851 1122.22,187.118 1124.53,414.498 1126.84,430.55 1129.14,423.055 1131.45,530.246 1133.76,351.186 1136.07,176.106 1138.37,476.723 1140.68,483.167 1142.99,521.871 1145.3,485.226 1147.61,365.158 1149.91,314.766 1152.22,441.103 1154.53,505.152 1156.84,560.778 1159.15,371.257 1161.45,387.681 1163.76,390.265 1166.07,253.981 1168.38,461.731 1170.69,453.074 1172.99,528.371 1175.3,427.185 1177.61,293.547 1179.92,390.372 1182.23,486.963 1184.53,426.112 1186.84,361.059 1189.15,386.768 1191.46,559.849 1193.76,375.559 1196.07,321.943 1198.38,292.646 1200.69,517.109 1203,444.669 1205.3,365.326 1207.61,437.435 1209.92,362.97 1212.23,402.97 1214.54,335.397 1216.84,99.9522 1219.15,296.146 1221.46,540.968 1223.77,325.607 1226.08,225.033 1228.38,386.039 1230.69,410.825 1233,215.856 1235.31,345.144 1237.61,543.541 1239.92,533.086 1242.23,297.108 1244.54,485.931 1246.85,301.467 1249.15,407.127 1251.46,334.032 1253.77,252.442 1256.08,410.08 1258.39,442.188 1260.69,402.602 1263,463.441 1265.31,673.301 1267.62,421.942 1269.93,279.144 1272.23,482.279 1274.54,484.218 1276.85,474.909 1279.16,645.864 1281.47,215.834 1283.77,185.684 1286.08,556.748 1288.39,373.051 1290.7,358.703 1293,518.495 1295.31,343.568 1297.62,189.638 1299.93,405.847 1302.24,412.616 1304.54,338.272 1306.85,606.816 1309.16,449.629 1311.47,332.716 1313.78,393.358 1316.08,513.011 1318.39,546.836 1320.7,498.866 1323.01,317.839 1325.32,283.943 1327.62,517.941 1329.93,367.918 1332.24,400.436 1334.55,410.516 1336.86,395.593 1339.16,443.415 1341.47,421.153 1343.78,333.149 1346.09,195.819 1348.39,443.804 1350.7,403.598 1353.01,300.155 1355.32,349.205 1357.63,553.216 1359.93,286.868 1362.24,506.764 1364.55,287.013 1366.86,451.294 1369.17,300.309 1371.47,383.556 1373.78,434.261 1376.09,339.5 1378.4,326.772 1380.71,246.76 1383.01,362.364 1385.32,123.375 1387.63,366.433 1389.94,284.672 1392.24,358.157 1394.55,322.918 1396.86,409.658 1399.17,199.724 1401.48,306.993 1403.78,544.516 1406.09,383.713 1408.4,480.345 1410.71,461.775 1413.02,294.013 1415.32,437.359 1417.63,580.98 1419.94,395.372 1422.25,367.551 1424.56,382.612 1426.86,297.225 1429.17,230.767 1431.48,365.334 1433.79,329.044 1436.1,510.66 1438.4,474.964 1440.71,402.129 1443.02,478.715 1445.33,380.812 1447.63,292.82 1449.94,295.566 1452.25,640.17 1454.56,459.794 1456.87,708.615 1459.17,439.263 1461.48,324.596 1463.79,514.17 1466.1,421.245 1468.41,545.7 1470.71,407.802 1473.02,159.081 1475.33,360.21 1477.64,341.039 1479.95,146.948 1482.25,413.153 1484.56,499.583 1486.87,430.224 1489.18,523.582 1491.49,338.56 1493.79,503.087 1496.1,474.023 1498.41,590.002 1500.72,529.622 1503.02,336.227 1505.33,482.829 1507.64,410.711 1509.95,233.047 1512.26,473.814 1514.56,198.013 1516.87,278.378 1519.18,442.29 1521.49,433.458 1523.8,339.072 1526.1,538.617 1528.41,371.623 1530.72,385.154 1533.03,375.617 1535.34,421.278 1537.64,307.991 1539.95,400.36 1542.26,420.472 1544.57,487.724 1546.88,498.149 1549.18,418.426 1551.49,339.772 1553.8,321.793 1556.11,340.312 1558.41,268.266 1560.72,379.56 1563.03,505.244 1565.34,360.865 1567.65,414.189 1569.95,409.765 1572.26,390.71 1574.57,331.702 1576.88,539.793 1579.19,419.417 1581.49,453.884 1583.8,309.395 1586.11,166.626 1588.42,402.214 1590.73,438.516 1593.03,404.516 1595.34,480.819 1597.65,296.218 1599.96,392.381 1602.26,485.468 1604.57,446.136 1606.88,189.796 1609.19,245.41 1611.5,387.5 1613.8,460.748 1616.11,371.774 1618.42,207.863 1620.73,319.387 1623.04,394.841 1625.34,575.221 1627.65,434.745 1629.96,534.515 1632.27,440.944 1634.58,399.537 1636.88,348.032 1639.19,497.398 1641.5,234.077 1643.81,297.064 1646.12,241.789 1648.42,344.037 1650.73,323.525 1653.04,356.915 1655.35,365.204 1657.65,441.589 1659.96,411.805 1662.27,296.193 1664.58,425.632 1666.89,456.848 1669.19,409.849 1671.5,294.271 1673.81,381.184 1676.12,569.39 1678.43,292.598 1680.73,295.323 1683.04,407.646 1685.35,502.101 1687.66,407.293 1689.97,526.149 1692.27,535.543 1694.58,477.187 1696.89,236.385 1699.2,402.594 1701.51,375.511 1703.81,327.074 1706.12,475.496 1708.43,353.301 1710.74,636.285 1713.04,369.076 1715.35,306.614 1717.66,469.052 1719.97,543.136 1722.28,431.832 1724.58,344.324 1726.89,287.619 1729.2,335.044 1731.51,381.864 1733.82,429.525 1736.12,426.405 1738.43,420.496 1740.74,427.256 1743.05,240.578 1745.36,200.604 1747.66,397.039 1749.97,375.35 1752.28,189.957 1754.59,430.694 1756.9,388.652 1759.2,372.251 1761.51,255.533 1763.82,433.821 1766.13,412.641 1768.43,345.866 1770.74,377.024 1773.05,346.393 1775.36,464.668 1777.67,412.186 1779.97,317.911 1782.28,528.997 1784.59,475.918 1786.9,325.924 1789.21,348.66 1791.51,350.675 1793.82,677.292 1796.13,483.515 1798.44,329.816 1800.75,325.039 1803.05,394.097 1805.36,529.093 1807.67,307.074 1809.98,486.729 1812.28,359.015 1814.59,542.255 1816.9,421.626 1819.21,522.85 1821.52,236.902 1823.82,531.262 1826.13,317.868 1828.44,411.818 1830.75,425.499 1833.06,572.2 1835.36,498.975 1837.67,520.286 1839.98,460.547 1842.29,413.998 1844.6,281.554 1846.9,458.548 1849.21,338.812 1851.52,388.621 1853.83,427.328 1856.14,437.39 1858.44,338.859 1860.75,417.236 1863.06,526.49 1865.37,346.01 1867.67,368.676 1869.98,640.91 1872.29,331.035 1874.6,359.968 1876.91,455.617 1879.21,441.302 1881.52,389.178 1883.83,391.382 1886.14,501.156 1888.45,297.372 1890.75,319.463 1893.06,374.1 1895.37,654.292 1897.68,355.304 1899.99,394.51 1902.29,471.583 1904.6,483.529 1906.91,298.697 1909.22,395.018 1911.53,335.358 1913.83,329.687 1916.14,509.229 1918.45,326.881 1920.76,506.708 1923.06,392.772 1925.37,323.857 1927.68,441.499 1929.99,213.051 1932.3,524.302 1934.6,411.889 1936.91,377.859 1939.22,227.991 1941.53,394.544 1943.84,463.934 1946.14,407.015 1948.45,359.568 1950.76,403.231 1953.07,613.891 1955.38,345.252 1957.68,422.04 1959.99,469.238 1962.3,514.217 1964.61,376.574 1966.91,382.601 1969.22,468.733 1971.53,572.259 1973.84,323.518 1976.15,333.794 1978.45,401.834 1980.76,467.725 1983.07,419.126 1985.38,211.074 1987.69,395.249 1989.99,476.573 1992.3,402.312 1994.61,303.875 1996.92,411.108 1999.23,443.483 2001.53,319.79 2003.84,656.092 2006.15,389.67 2008.46,401.249 2010.77,162.045 2013.07,549.631 2015.38,423.164 2017.69,371.035 2020,325.991 2022.3,361.705 2024.61,491.953 2026.92,519.234 2029.23,348.851 2031.54,285.138 2033.84,609.347 2036.15,484.484 2038.46,419.891 2040.77,349.421 2043.08,402.747 2045.38,328.082 2047.69,543.48 2050,544.15 2052.31,297.838 2054.62,411.465 2056.92,170.436 2059.23,300.588 2061.54,467.077 2063.85,277.055 2066.16,279.91 2068.46,402.819 2070.77,349.45 2073.08,530.508 2075.39,366.889 2077.69,256.724 2080,262.209 2082.31,541.279 2084.62,226.858 2086.93,555.099 2089.23,423.136 2091.54,493.893 2093.85,401.681 2096.16,483.437 2098.47,523.462 2100.77,493.938 2103.08,600.479 2105.39,351.544 2107.7,473.375 2110.01,310.219 2112.31,344.095 2114.62,491.139 2116.93,243.756 2119.24,258.524 2121.55,329.999 2123.85,609.056 2126.16,559.175 2128.47,399.157 2130.78,299.805 2133.08,278.596 2135.39,368.51 2137.7,499.535 2140.01,339.995 2142.32,513.412 2144.62,646.758 2146.93,387.218 2149.24,344.038 2151.55,439.183 2153.86,440.298 2156.16,359.711 2158.47,472.888 2160.78,404.009 2163.09,375.591 2165.4,421.952 2167.7,493.458 2170.01,216.792 2172.32,383.542 2174.63,283.725 2176.93,548.621 2179.24,524.996 2181.55,221.947 2183.86,288.224 2186.17,263.107 2188.47,502.074 2190.78,148.144 2193.09,319.041 2195.4,237.56 2197.71,543.511 2200.01,320.868 2202.32,379.098 2204.63,391.226 2206.94,253.009 2209.25,270.205 2211.55,439.797 2213.86,201.022 2216.17,402.511 2218.48,302.317 2220.79,457.352 2223.09,460.976 2225.4,397.119 2227.71,404.167 2230.02,256.467 2232.32,318.082 2234.63,391.366 2236.94,289.286 2239.25,241.774 2241.56,294.27 2243.86,537.42 2246.17,552.131 2248.48,388.823 2250.79,304.041 2253.1,570.053 2255.4,210.988 2257.71,276.1 2260.02,384.155 2262.33,417.797 2264.64,334.532 2266.94,345.363 2269.25,577.824 2271.56,260.508 2273.87,417.483 2276.18,350.686 2278.48,290.476 2280.79,340.809 2283.1,446.859 2285.41,320.482 2287.71,409.076 2290.02,573.657 2292.33,320.618 2294.64,384.443 2296.95,343.751 2299.25,536.178 2301.56,487.631 2303.87,374.047 2306.18,190.384 2308.49,527.426 2310.79,368.664 2313.1,288.766 2315.41,220.255 2317.72,471.395 2320.03,430.839 2322.33,375.801 2324.64,242.92 2326.95,297.08 2329.26,310.786 2331.56,405.745 2333.87,404.198 2336.18,437.683 2338.49,395.857 2340.8,579.602 2343.1,424.585 2345.41,406.611 2347.72,219.58 2350.03,96.8724 2352.34,416.9 2354.64,247.807 2356.95,284.656 2359.26,276.449 2361.57,435.951 2363.88,354 2366.18,427.1 2368.49,281.07 2370.8,494.928 2373.11,283.639 2375.42,267.678 2377.72,409.701 2380.03,489.081 2382.34,408.609 2384.65,303.327 2386.95,331.71 2389.26,589.763 2391.57,340.628 2393.88,310.762 2396.19,330.972 2398.49,508.138 2400.8,299.86 2403.11,276.464 2405.42,364.36 2407.73,446.958 2410.03,521.358 2412.34,460.686 2414.65,379.272 2416.96,352.035 2419.27,372.466 2421.57,272.802 2423.88,472.061 2426.19,284.083 2428.5,306.233 2430.81,481.404 2433.11,461.085 2435.42,391.354 2437.73,313.367 2440.04,429.633 2442.34,355.986 2444.65,349.99 2446.96,393.237 2449.27,430.608 2451.58,370.643 2453.88,442.782 2456.19,407.525 2458.5,391.218 2460.81,469.371 2463.12,466.005 2465.42,318.656 2467.73,493.957 2470.04,344.906 2472.35,592.176 2474.66,233.75 2476.96,507.609 2479.27,528.16 2481.58,475.296 2483.89,459.597 2486.2,264.235 2488.5,370.202 2490.81,439.957 2493.12,459.329 2495.43,499.733 2497.73,407.656 2500.04,234.828 2502.35,345.853 2504.66,422.847 2506.97,527.511 2509.27,381.645 2511.58,311.401 2513.89,168.337 2516.2,327.688 2518.51,498.074 2520.81,331.846 2523.12,330.505 2525.43,500.153 2527.74,440.618 2530.05,355.23 2532.35,214.875 2534.66,365.066 2536.97,307.784 2539.28,369.413 2541.58,411.897 2543.89,468.095 2546.2,438.245 2548.51,170.479 2550.82,350.942 2553.12,239.982 2555.43,512.133 2557.74,315.962 2560.05,360.165 2562.36,452.369 2564.66,423.163 2566.97,573.751 2569.28,199.826 2571.59,324.619 "></polyline>
</svg>
</div>
</div>
<p>Look at that! Things are working; amazin’.</p>
<p>We can also exploit <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>’s parallel sampling capabilities:</p>
<div id="34" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run separate 4 chains for 10 000 iterations using threads to parallelize.</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>num_chains <span class="op">=</span> <span class="fl">4</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    model_with_grad,</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">MCMCThreads</span>(),</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>,</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    num_chains;</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Note we need to provide an initial state for every chain.</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>    initial_state<span class="op">=</span><span class="fu">fill</span>(state, num_chains),</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>samples_array <span class="op">=</span> <span class="fu">stack</span>(<span class="fu">map</span>(<span class="bu">Base</span>.<span class="fu">Fix1</span>(stack, sample <span class="op">-&gt;</span> sample.x), samples))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000×4 Array{Float64, 3}:
[:, :, 1] =
 -2.23671      -4.61949    -4.85619  …  -5.73974  -4.52126    -4.42248
  0.000882482   0.0295248   1.51016     -0.20179  -0.0421941   0.228151
  1.39739       2.59358     3.76588      3.48055   3.85493     3.4583

[:, :, 2] =
 -2.43789   -2.91765   -5.05763  -6.22407  …  -5.11149   -3.85071  -3.03706
  0.285881  -0.524364  -1.32892  -1.04882      0.302992   1.39856  -0.48604
  3.64679    4.89439    3.74543   5.03001      3.28274    4.87009   4.79716

[:, :, 3] =
 -2.0237    -3.45489   -3.97208  -4.0561   …  -2.59549  -4.13747  -4.46199
  0.773427   0.224835   0.15764   2.03776      1.23189   2.61799   2.49639
  3.35692    4.35895    4.64349   5.34479      5.11481   4.88716   6.34721

[:, :, 4] =
 -1.85668   -3.63119   -3.63119   -3.64468   …  -5.29111  -4.4255   -4.41179
 -0.692523  -0.169537  -0.169537  -0.910128     -1.03701   0.80509   0.501866
  3.81451    3.14381    3.14381    3.69604       3.54577   4.18928   5.43837</code></pre>
</div>
</div>
<p>But the fact that we have to provide the <code>AbstractMCMC.sample</code> call, etc. with an <code>initial_state</code> to get started is a bit annoying. We can avoid this by also defining a <code>AbstractMCMC.step</code> <em>without</em> the <code>state</code> argument:</p>
<div id="36" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">::</span><span class="dt">MALA</span>;</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># </span><span class="al">NOTE</span><span class="co">: No state provided!</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just create the initial state by sampling using  a Gaussian.</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="fu">randn</span>(rng, LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(x), <span class="fu">MALAState</span>(x)</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Equipped with this, we no longer need to provide the <code>initial_state</code> everywhere:</p>
<div id="38" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -5.01084      1.0006
  0.000195093  0.99597
  4.99267      1.00079</code></pre>
</div>
</div>
</section>
<section id="using-our-sampler-with-turing.jl" class="level2">
<h2 class="anchored" data-anchor-id="using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</h2>
<p>As we promised, all of this hassle of implementing our <code>MALA</code> sampler in a way that uses <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> and <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> gets us something more than <em>just</em> an “automatic” implementation of <code>AbstractMCMC.sample</code>.</p>
<p>It also enables use with Turing.jl through the <code>externalsampler</code>, but we need to do one final thing first: we need to tell Turing.jl how to extract a vector of parameters from the “sample” returned in our implementation of <code>AbstractMCMC.step</code>. In our case, the “sample” is a <code>MALASample</code>, so we just need the following line:</p>
<div id="40" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load Turing.jl.</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Turing</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Overload the `getparams` method for our "sample" type, which is just a vector.</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>Turing.Inference.<span class="fu">getparams</span>(<span class="op">::</span><span class="dt">Turing.Model</span>, sample<span class="op">::</span><span class="dt">MALASample</span>) <span class="op">=</span> sample.x</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And with that, we’re good to go!</p>
<div id="42" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Our previous model defined as a Turing.jl model.</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">mvnormal_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">MvNormal</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.], I)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate our model.</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">mvnormal_model</span>()</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Call `sample` but now we're passing in a Turing.jl `model` and wrapping</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co"># our `MALA` sampler in the `externalsampler` to tell Turing.jl that the sampler</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co"># expects something that implements LogDensityProblems.jl.</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×4×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 2.4 seconds
Compute duration  = 2.4 seconds
parameters        = x[1], x[2], x[3]
internals         = lp

Summary Statistics
  parameters      mean       std      mcse    ess_bulk    ess_tail      rhat   ⋯
      Symbol   Float64   Float64   Float64     Float64     Float64   Float64   ⋯

        x[1]   -5.0092    1.0120    0.0187   2932.5831   4727.9927    1.0001   ⋯
        x[2]   -0.0246    1.0040    0.0174   3331.1056   5228.2384    1.0003   ⋯
        x[3]    4.9856    0.9966    0.0166   3620.4030   5887.4580    1.0000   ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

        x[1]   -7.0119   -5.6896   -5.0125   -4.3353   -2.9939
        x[2]   -1.9859   -0.6834   -0.0191    0.6528    1.9025
        x[3]    3.0361    4.3124    4.9806    5.6685    6.9305</code></pre>
</div>
</div>
<p>Pretty neat, eh?</p>
<section id="models-with-constrained-parameters" class="level3">
<h3 class="anchored" data-anchor-id="models-with-constrained-parameters">Models with constrained parameters</h3>
<p>One thing we’ve sort of glossed over in all of the above is that MALA, at least how we’ve implemented it, requires <span class="math inline">\(x\)</span> to live in <span class="math inline">\(\mathbb{R}^d\)</span> for some <span class="math inline">\(d &gt; 0\)</span>. If some of the parameters were in fact constrained, e.g.&nbsp;we were working with a <code>Beta</code> distribution which has support on the interval <span class="math inline">\((0, 1)\)</span>, <em>not</em> on <span class="math inline">\(\mathbb{R}^d\)</span>, we could easily end up outside of the valid range <span class="math inline">\((0, 1)\)</span>.</p>
<div id="44" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">beta_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">beta_model</span>()</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 1.41 seconds
Compute duration  = 1.41 seconds
parameters        = x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse    ess_bulk    ess_tail      rhat   ⋯
      Symbol   Float64   Float64   Float64     Float64     Float64   Float64   ⋯

           x    0.4981    0.1902    0.0029   4295.6714   5170.1277    1.0000   ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

           x    0.1414    0.3572    0.4972    0.6391    0.8479</code></pre>
</div>
</div>
<p>Yep, that still works, but only because Turing.jl actually <em>transforms</em> the <code>turing_model</code> from constrained to unconstrained, so that the <code>sampler</code> provided to <code>externalsampler</code> is actually always working in unconstrained space! This is not always desirable, so we can turn this off:</p>
<div id="46" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 0.23 seconds
Compute duration  = 0.23 seconds
parameters        = x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse   ess_bulk   ess_tail      rhat   e ⋯
      Symbol   Float64   Float64   Float64    Float64    Float64   Float64     ⋯

           x    0.5102    0.1587    0.0183    68.8852    52.8682    1.0419     ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

           x    0.2309    0.3870    0.5116    0.6378    0.7617</code></pre>
</div>
</div>
<p>The fun thing is that this still sort of works because</p>
<div id="48" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">logpdf</span>(<span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>), <span class="fl">10.0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-Inf</code></pre>
</div>
</div>
<p>and so the samples that fall outside of the range are always rejected. But do notice how much worse all the diagnostics are, e.g.&nbsp;<code>ess_tail</code> is very poor compared to when we use <code>unconstrained=true</code>. Moreover, in more complex cases this won’t just result in a “nice” <code>-Inf</code> log-density value, but instead will error:</p>
<div id="50" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="kw">function</span> <span class="fu">demo</span>()</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>    σ² <span class="op">~</span> <span class="fu">truncated</span>(<span class="fu">Normal</span>(), lower<span class="op">=</span><span class="fl">0</span>)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If we end up with negative values for `σ²`, the `Normal` will error.</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>    x <span class="op">~</span> <span class="fu">Normal</span>(<span class="fl">0</span>, σ²)</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>DomainError: DomainError(-0.6987129066579123, "Normal: the condition σ &gt;= zero(σ) is not satisfied.")
DomainError with -0.6987129066579123:
Normal: the condition σ &gt;= zero(σ) is not satisfied.
Stacktrace:
  [1] #371
    @ ~/.julia/packages/Distributions/uuqsE/src/univariate/continuous/normal.jl:37 [inlined]
  [2] check_args
    @ ~/.julia/packages/Distributions/uuqsE/src/utils.jl:89 [inlined]
  [3] #Normal#370
    @ ~/.julia/packages/Distributions/uuqsE/src/univariate/continuous/normal.jl:37 [inlined]
  [4] Normal
    @ ~/.julia/packages/Distributions/uuqsE/src/univariate/continuous/normal.jl:36 [inlined]
  [5] Normal
    @ ~/.julia/packages/Distributions/uuqsE/src/univariate/continuous/normal.jl:42 [inlined]
  [6] macro expansion
    @ ~/.julia/packages/DynamicPPL/DvdZw/src/compiler.jl:579 [inlined]
  [7] demo(__model__::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, __varinfo__::DynamicPPL.ThreadSafeVarInfo{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, Vector{Base.RefValue{Float64}}}, __context__::DynamicPPL.ValuesAsInModelContext{OrderedDict{Any, Any}, DynamicPPL.DefaultContext})
    @ Main.Notebook ~/work/docs/docs/tutorials/docs-17-implementing-samplers/index.qmd:593
  [8] _evaluate!!
    @ ~/.julia/packages/DynamicPPL/DvdZw/src/model.jl:973 [inlined]
  [9] evaluate_threadsafe!!(model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, varinfo::DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, context::DynamicPPL.ValuesAsInModelContext{OrderedDict{Any, Any}, DynamicPPL.DefaultContext})
    @ DynamicPPL ~/.julia/packages/DynamicPPL/DvdZw/src/model.jl:962
 [10] evaluate!!
    @ ~/.julia/packages/DynamicPPL/DvdZw/src/model.jl:892 [inlined]
 [11] values_as_in_model
    @ ~/.julia/packages/DynamicPPL/DvdZw/src/values_as_in_model.jl:196 [inlined]
 [12] values_as_in_model
    @ ~/.julia/packages/DynamicPPL/DvdZw/src/values_as_in_model.jl:195 [inlined]
 [13] getparams(model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, vi::DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64})
    @ Turing.Inference ~/.julia/packages/Turing/QN7BL/src/mcmc/Inference.jl:343
 [14] Turing.Inference.Transition(model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, vi::DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, t::MALASample{Vector{Float64}})
    @ Turing.Inference ~/.julia/packages/Turing/QN7BL/src/mcmc/Inference.jl:226
 [15] transition_to_turing
    @ ~/.julia/packages/Turing/QN7BL/src/mcmc/abstractmcmc.jl:12 [inlined]
 [16] transition_to_turing(f::LogDensityProblemsADForwardDiffExt.ForwardDiffLogDensity{LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, Nothing}, ForwardDiff.Chunk{2}, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}, transition::MALASample{Vector{Float64}})
    @ Turing.Inference ~/.julia/packages/Turing/QN7BL/src/mcmc/abstractmcmc.jl:17
 [17] step(rng::TaskLocalRNG, model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, sampler_wrapper::DynamicPPL.Sampler{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}; initial_state::Nothing, initial_params::Nothing, kwargs::@Kwargs{})
    @ Turing.Inference ~/.julia/packages/Turing/QN7BL/src/mcmc/abstractmcmc.jl:147
 [18] macro expansion
    @ ~/.julia/packages/AbstractMCMC/z1nwm/src/sample.jl:0 [inlined]
 [19] macro expansion
    @ ~/.julia/packages/AbstractMCMC/z1nwm/src/logging.jl:16 [inlined]
 [20] mcmcsample(rng::TaskLocalRNG, model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, sampler::DynamicPPL.Sampler{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}, N::Int64; progress::Bool, progressname::String, callback::Nothing, num_warmup::Int64, discard_initial::Int64, thinning::Int64, chain_type::Type, initial_state::Nothing, kwargs::@Kwargs{})
    @ AbstractMCMC ~/.julia/packages/AbstractMCMC/z1nwm/src/sample.jl:142
 [21] sample(rng::TaskLocalRNG, model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, sampler::DynamicPPL.Sampler{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}, N::Int64; chain_type::Type, resume_from::Nothing, initial_state::Nothing, kwargs::@Kwargs{progress::Bool})
    @ DynamicPPL ~/.julia/packages/DynamicPPL/DvdZw/src/sampler.jl:93
 [22] sample
    @ ~/.julia/packages/DynamicPPL/DvdZw/src/sampler.jl:83 [inlined]
 [23] #sample#4
    @ ~/.julia/packages/Turing/QN7BL/src/mcmc/Inference.jl:276 [inlined]
 [24] sample
    @ ~/.julia/packages/Turing/QN7BL/src/mcmc/Inference.jl:267 [inlined]
 [25] #sample#3
    @ ~/.julia/packages/Turing/QN7BL/src/mcmc/Inference.jl:264 [inlined]
 [26] top-level scope
    @ ~/work/docs/docs/tutorials/docs-17-implementing-samplers/index.qmd:595</code></pre>
</div>
</div>
<p>As expected, we run into a <code>DomainError</code> at some point, while if we set <code>unconstrained=true</code>, letting Turing.jl transform the model to a unconstrained form behind the scenes, everything works as expected:</p>
<div id="52" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 1.58 seconds
Compute duration  = 1.58 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse   ess_bulk   ess_tail      rhat   e ⋯
      Symbol   Float64   Float64   Float64    Float64    Float64   Float64     ⋯

          σ²    0.4675    0.0000    0.0000        NaN        NaN       NaN     ⋯
           x    1.7741    0.0000    0.0000        NaN        NaN       NaN     ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

          σ²    0.4675    0.4675    0.4675    0.4675    0.4675
           x    1.7741    1.7741    1.7741    1.7741    1.7741</code></pre>
</div>
</div>
<p>Neat!</p>
<p>Similarly, which automatic differentiation backend one should use can be specified through the <code>adtype</code> keyword argument too. For example, if we want to use <a href="https://github.com/JuliaDiff/ReverseDiff.jl">ReverseDiff.jl</a> instead of the default <a href="https://github.com/JuliaDiff/ForwardDiff.jl">ForwardDiff.jl</a>:</p>
<div id="54" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">ReverseDiff</span>: ReverseDiff</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify that we want to use `AutoReverseDiff`.</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">demo</span>(),</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>, adtype<span class="op">=</span><span class="fu">AutoReverseDiff</span>()),</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>;</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 2.84 seconds
Compute duration  = 2.84 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse   ess_bulk   ess_tail      rhat   e ⋯
      Symbol   Float64   Float64   Float64    Float64    Float64   Float64     ⋯

          σ²    0.7070    0.5959    0.0730    65.8346    71.8390    1.0325     ⋯
           x    0.3571    1.0278    0.0849   114.0333   168.5240    1.0149     ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

          σ²    0.0952    0.2558    0.4932    1.0274    2.2595
           x   -1.8003   -0.1313    0.3461    0.7528    2.7833</code></pre>
</div>
</div>
<p>Double-neat.</p>
</section>
</section>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<p>At this point it’s worth maybe reminding ourselves what we did and also <em>why</em> we did it:</p>
<ol type="1">
<li>We define our models in the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface because it makes the sampler agnostic to how the underlying model is implemented.</li>
<li>We implement our sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> interface, which just means that our sampler is a subtype of <code>AbstractMCMC.AbstractSampler</code> and we implement the MCMC transition in <code>AbstractMCMC.step</code>.</li>
<li>Points 1 and 2 makes it so our sampler can be used with a wide range of model implementations, amongst them being models implemented in both Turing.jl and Stan. This gives you, the inference implementer, a large collection of models to test your inference method on, in addition to allowing users of Turing.jl and Stan to try out your inference method with minimal effort.</li>
</ol>


</section>


<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a><div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>We’re going with the leapfrog formulation because in a future version of this tutorial we’ll add a section extending this simple “baseline” MALA sampler to more complex versions. See <a href="https://github.com/TuringLang/docs/issues/479">issue #479</a> for progress on this.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>There is no such thing as a proper interface in Julia (at least not officially), and so we use the word “interface” here to mean a few minimal methods that needs to be implemented by any type that we treat as a target model.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/turinglang\.org\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../tutorials/docs-07-for-developers-variational-inference/index.html" class="pagination-link" aria-label="Variational Inference">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Variational Inference</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Turing is created by <a href="http://mlg.eng.cam.ac.uk/hong/" target="_blank">Hong Ge</a>, and lovingly maintained by the <a href="https://github.com/TuringLang/Turing.jl/graphs/contributors" target="_blank">core team</a> of volunteers. <br> The contents of this website are © 2024 under the terms of the <a href="https://github.com/TuringLang/Turing.jl/blob/master/LICENCE" target="_blank">MIT License</a>.</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/TuringLang/docs/edit/master/tutorials/docs-17-implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/docs/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://x.com/TuringLang">
      <i class="bi bi-twitter" role="img" aria-label="Turing Twitter">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/TuringLang/Turing.jl">
      <i class="bi bi-github" role="img" aria-label="Turing GitHub">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




<script src="../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>