<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.31">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Implementing Samplers – Turing.jl</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<link href="../../../developers/inference/variational-inference/index.html" rel="prev">
<link href="../../../assets/favicon.ico" rel="icon">
<script src="../../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-e1a5c8363afafaef2c763b6775fbf3ca.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-dark-8ef56b68f8fa1e9d2ba328e99e439f80.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-e1a5c8363afafaef2c763b6775fbf3ca.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap-18ccf09ac862cdae137f1cff9f0dff93.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../../site_libs/bootstrap/bootstrap-dark-5bdfca418a03f22e36e5c4143ed53dd5.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="../../../site_libs/bootstrap/bootstrap-18ccf09ac862cdae137f1cff9f0dff93.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<style>
  a {
    text-decoration: none;
  }
  a:hover {
    text-decoration: underline;
  }
</style>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../../theming/styles.css">
</head>

<body class="nav-sidebar floating nav-fixed quarto-light"><script id="quarto-html-before-body" type="application/javascript">
    const toggleBodyColorMode = (bsSheetEl) => {
      const mode = bsSheetEl.getAttribute("data-mode");
      const bodyEl = window.document.querySelector("body");
      if (mode === "dark") {
        bodyEl.classList.add("quarto-dark");
        bodyEl.classList.remove("quarto-light");
      } else {
        bodyEl.classList.add("quarto-light");
        bodyEl.classList.remove("quarto-dark");
      }
    }
    const toggleBodyColorPrimary = () => {
      const bsSheetEl = window.document.querySelector("link#quarto-bootstrap:not([rel=disabled-stylesheet])");
      if (bsSheetEl) {
        toggleBodyColorMode(bsSheetEl);
      }
    }
    const setColorSchemeToggle = (alternate) => {
      const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
      for (let i=0; i < toggles.length; i++) {
        const toggle = toggles[i];
        if (toggle) {
          if (alternate) {
            toggle.classList.add("alternate");
          } else {
            toggle.classList.remove("alternate");
          }
        }
      }
    };
    const toggleColorMode = (alternate) => {
      // Switch the stylesheets
      const primaryStylesheets = window.document.querySelectorAll('link.quarto-color-scheme:not(.quarto-color-alternate)');
      const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
      manageTransitions('#quarto-margin-sidebar .nav-link', false);
      if (alternate) {
        // note: dark is layered on light, we don't disable primary!
        enableStylesheet(alternateStylesheets);
        for (const sheetNode of alternateStylesheets) {
          if (sheetNode.id === "quarto-bootstrap") {
            toggleBodyColorMode(sheetNode);
          }
        }
      } else {
        disableStylesheet(alternateStylesheets);
        enableStylesheet(primaryStylesheets)
        toggleBodyColorPrimary();
      }
      manageTransitions('#quarto-margin-sidebar .nav-link', true);
      // Switch the toggles
      setColorSchemeToggle(alternate)
      // Hack to workaround the fact that safari doesn't
      // properly recolor the scrollbar when toggling (#1455)
      if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
        manageTransitions("body", false);
        window.scrollTo(0, 1);
        setTimeout(() => {
          window.scrollTo(0, 0);
          manageTransitions("body", true);
        }, 40);
      }
    }
    const disableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        stylesheet.rel = 'disabled-stylesheet';
      }
    }
    const enableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        if(stylesheet.rel !== 'stylesheet') { // for Chrome, which will still FOUC without this check
          stylesheet.rel = 'stylesheet';
        }
      }
    }
    const manageTransitions = (selector, allowTransitions) => {
      const els = window.document.querySelectorAll(selector);
      for (let i=0; i < els.length; i++) {
        const el = els[i];
        if (allowTransitions) {
          el.classList.remove('notransition');
        } else {
          el.classList.add('notransition');
        }
      }
    }
    const isFileUrl = () => {
      return window.location.protocol === 'file:';
    }
    const hasAlternateSentinel = () => {
      let styleSentinel = getColorSchemeSentinel();
      if (styleSentinel !== null) {
        return styleSentinel === "alternate";
      } else {
        return false;
      }
    }
    const setStyleSentinel = (alternate) => {
      const value = alternate ? "alternate" : "default";
      if (!isFileUrl()) {
        window.localStorage.setItem("quarto-color-scheme", value);
      } else {
        localAlternateSentinel = value;
      }
    }
    const getColorSchemeSentinel = () => {
      if (!isFileUrl()) {
        const storageValue = window.localStorage.getItem("quarto-color-scheme");
        return storageValue != null ? storageValue : localAlternateSentinel;
      } else {
        return localAlternateSentinel;
      }
    }
    const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
      const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
      const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
      let newTheme = '';
      if(authorPrefersDark) {
        newTheme = isAlternate ? baseTheme : alternateTheme;
      } else {
        newTheme = isAlternate ? alternateTheme : baseTheme;
      }
      const changeGiscusTheme = () => {
        // From: https://github.com/giscus/giscus/issues/336
        const sendMessage = (message) => {
          const iframe = document.querySelector('iframe.giscus-frame');
          if (!iframe) return;
          iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
        }
        sendMessage({
          setConfig: {
            theme: newTheme
          }
        });
      }
      const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
      if (isGiscussLoaded) {
        changeGiscusTheme();
      }
    };
    const authorPrefersDark = false;
    const darkModeDefault = authorPrefersDark;
      document.querySelector('link#quarto-text-highlighting-styles.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
      document.querySelector('link#quarto-bootstrap.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
    let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
    // Dark / light mode switch
    window.quartoToggleColorScheme = () => {
      // Read the current dark / light value
      let toAlternate = !hasAlternateSentinel();
      toggleColorMode(toAlternate);
      setStyleSentinel(toAlternate);
      toggleGiscusIfUsed(toAlternate, darkModeDefault);
      window.dispatchEvent(new Event('resize'));
    };
    // Switch to dark mode if need be
    if (hasAlternateSentinel()) {
      toggleColorMode(true);
    } else {
      toggleColorMode(false);
    }
  </script>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="https://turinglang.org/" class="navbar-brand navbar-brand-logo">
    <img src="../../../assets/images/turing-logo.svg" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="https://turinglang.org/">
    <span class="navbar-title">Turing.jl</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../getting-started/"> 
<span class="menu-text">Get Started</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../tutorials/coin-flipping/"> 
<span class="menu-text">Tutorials</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/library/"> 
<span class="menu-text">Libraries</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/news/"> 
<span class="menu-text">News</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/team/"> 
<span class="menu-text">Team</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-v0.39" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">v0.39</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-v0.39">    
        <li>
    <a class="dropdown-item" href="https://turinglang.org/docs/changelog.html">
 <span class="dropdown-text">Changelog</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://turinglang.org/docs/versions.html">
 <span class="dropdown-text">All Versions</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools tools-wide">
    <a href="https://x.com/TuringLang" title="Turing Twitter" class="quarto-navigation-tool px-1" aria-label="Turing Twitter"><i class="bi bi-twitter"></i></a>
    <a href="https://github.com/TuringLang/Turing.jl" title="Turing GitHub" class="quarto-navigation-tool px-1" aria-label="Turing GitHub"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../../developers/contributing/index.html">Developers</a></li><li class="breadcrumb-item"><a href="../../../developers/inference/variational-inference/index.html">Inference in Detail</a></li><li class="breadcrumb-item"><a href="../../../developers/inference/implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../getting-started/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Getting Started</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../core-functionality/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Core Functionality</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false">
 <span class="menu-text">User Guide</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/automatic-differentiation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Automatic Differentiation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/custom-distribution/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Custom Distributions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/probability-interface/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Querying Model Probabilities</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/modifying-logprob/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Modifying the Log Probability</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/tracking-extra-quantities/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Tracking Extra Quantities</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/mode-estimation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Mode Estimation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/performance-tips/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Performance Tips</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/sampler-visualisation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Sampler Visualization</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/dynamichmc/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using DynamicHMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/external-samplers/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using External Samplers</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/troubleshooting/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Troubleshooting</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false">
 <span class="menu-text">Tutorials</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/coin-flipping/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction: Coin Flipping</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/gaussian-mixture-models/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Mixture Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-neural-networks/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Neural Networks</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/hidden-markov-models/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Hidden Markov Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-linear-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Linear Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/infinite-mixture-models/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Infinite Mixture Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-poisson-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Poisson Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/multinomial-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Multinomial Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-differential-equations/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Differential Equations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/probabilistic-pca/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Probabilistic PCA</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-time-series-analysis/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Time Series Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/gaussian-processes-introduction/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Processes: Introduction</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/gaussian-process-latent-variable-models/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Process Latent Variable Models</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Developers</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/contributing/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Contributing</span></a>
  </div>
</li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false">
 <span class="menu-text">DynamicPPL’s Compiler</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/compiler/model-manual/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Manually Defining a Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/compiler/minituring-compiler/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation I: Compiler</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/compiler/minituring-contexts/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation II: Contexts</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/compiler/design-overview/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Turing Compiler Design (Outdated)</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false">
 <span class="menu-text">DynamicPPL Contexts</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/contexts/submodel-condition/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Conditioning and fixing in submodels</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="false">
 <span class="menu-text">Variable Transformations</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/transforms/distributions/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Distributions and the Jacobian</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/transforms/bijectors/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bijectors in MCMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/transforms/dynamicppl/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variable transformations in DynamicPPL</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true">
 <span class="menu-text">Inference in Detail</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/inference/variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/inference/implementing-samplers/index.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Implementing Samplers</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of Contents</h2>
   
  <ul>
  <li><a href="#quick-overview-of-mala" id="toc-quick-overview-of-mala" class="nav-link active" data-scroll-target="#quick-overview-of-mala">Quick overview of MALA</a></li>
  <li><a href="#what-we-need-from-a-model-logdensityproblems.jl" id="toc-what-we-need-from-a-model-logdensityproblems.jl" class="nav-link" data-scroll-target="#what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: LogDensityProblems.jl</a></li>
  <li><a href="#implementing-mala-in-abstractmcmc.jl" id="toc-implementing-mala-in-abstractmcmc.jl" class="nav-link" data-scroll-target="#implementing-mala-in-abstractmcmc.jl">Implementing MALA in AbstractMCMC.jl</a></li>
  <li><a href="#using-our-sampler-with-turing.jl" id="toc-using-our-sampler-with-turing.jl" class="nav-link" data-scroll-target="#using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</a>
  <ul class="collapse">
  <li><a href="#models-with-constrained-parameters" id="toc-models-with-constrained-parameters" class="nav-link" data-scroll-target="#models-with-constrained-parameters">Models with constrained parameters</a></li>
  </ul></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/TuringLang/docs/edit/main/developers/inference/implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/docs/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">


<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../../developers/contributing/index.html">Developers</a></li><li class="breadcrumb-item"><a href="../../../developers/inference/variational-inference/index.html">Inference in Detail</a></li><li class="breadcrumb-item"><a href="../../../developers/inference/implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Implementing Samplers</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>In this tutorial, we’ll go through step-by-step how to implement a “simple” sampler in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> in such a way that it can be easily applied to Turing.jl models.</p>
<p>In particular, we’re going to implement a version of <strong>Metropolis-adjusted Langevin (MALA)</strong>.</p>
<p>Note that we will implement this sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> framework, completely “ignoring” Turing.jl until the very end of the tutorial, at which point we’ll use a single line of code to make the resulting sampler available to Turing.jl. This is to really drive home the point that one can implement samplers in a way that is accessible to all of Turing.jl’s users without having to use Turing.jl yourself.</p>
<section id="quick-overview-of-mala" class="level2">
<h2 class="anchored" data-anchor-id="quick-overview-of-mala">Quick overview of MALA</h2>
<p>We can view MALA as a single step of the leapfrog intergrator with resampling of momentum <span class="math inline">\(p\)</span> at every step.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> To make that statement a bit more concrete, we first define the <em>extended</em> target <span class="math inline">\(\bar{\gamma}(x, p)\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\log \bar{\gamma}(x, p) \propto \log \gamma(x) + \log \gamma_{\mathcal{N}(0, M)}(p)
\end{equation*}\]</span></p>
<p>where <span class="math inline">\(\gamma_{\mathcal{N}(0, M)}\)</span> denotes the density for a zero-centered Gaussian with covariance matrix <span class="math inline">\(M\)</span>. We then consider targeting this joint distribution over both <span class="math inline">\(x\)</span> and <span class="math inline">\(p\)</span> as follows. First we define the map</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  L_{\epsilon}: \quad &amp; \mathbb{R}^d \times \mathbb{R}^d \to \mathbb{R}^d \times \mathbb{R}^d \\
  &amp; (x, p) \mapsto (\tilde{x}, \tilde{p}) := L_{\epsilon}(x, p)
\end{split}
\end{equation*}\]</span></p>
<p>as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p_{1 / 2} &amp;:= p + \frac{\epsilon}{2} \nabla \log \gamma(x) \\
  \tilde{x} &amp;:= x + \epsilon M^{-1} p_{1 /2 } \\
  p_1 &amp;:= p_{1 / 2} + \frac{\epsilon}{2} \nabla \log \gamma(\tilde{x}) \\
  \tilde{p} &amp;:= - p_1
\end{split}
\end{equation*}\]</span></p>
<p>This might be familiar for some readers as a single step of the Leapfrog integrator. We then define the MALA kernel as follows: given the current iterate <span class="math inline">\(x_i\)</span>, we sample the next iterate <span class="math inline">\(x_{i + 1}\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p &amp;\sim \mathcal{N}(0, M) \\
  (\tilde{x}, \tilde{p}) &amp;:= L_{\epsilon}(x_i, p) \\
  \alpha &amp;:= \min \left\{ 1, \frac{\bar{\gamma}(\tilde{x}, \tilde{p})}{\bar{\gamma}(x_i, p)} \right\} \\
  x_{i + 1} &amp;:=
  \begin{cases}
    \tilde{x} \quad &amp; \text{ with prob. } \alpha \\
    x_i       \quad &amp; \text{ with prob. } 1 - \alpha
  \end{cases}
\end{split}
\end{equation*}\]</span></p>
<p>i.e.&nbsp;we accept the proposal <span class="math inline">\(\tilde{x}\)</span> with probability <span class="math inline">\(\alpha\)</span> and reject it, thus sticking with our current iterate, with probability <span class="math inline">\(1 - \alpha\)</span>.</p>
</section>
<section id="what-we-need-from-a-model-logdensityproblems.jl" class="level2">
<h2 class="anchored" data-anchor-id="what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a></h2>
<p>There are a few things we need from the “target” / “model” / density that we want to sample from:</p>
<ol type="1">
<li>We need access to log-density <em>evaluations</em> <span class="math inline">\(\log \gamma(x)\)</span> so we can compute the acceptance ratio involving <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>We need access to log-density <em>gradients</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span> so we can compute the Leapfrog steps <span class="math inline">\(L_{\epsilon}(x, p)\)</span>.</li>
<li>We also need access to the “size” of the model so we can determine the size of <span class="math inline">\(M\)</span>.</li>
</ol>
<p>Luckily for us, there is a package called <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> which provides an interface for <em>exactly</em> this!</p>
<p>To demonstrate how one can implement the “<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface”<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> we will use a simple Gaussian model as an example:</p>
<div id="4" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblems</span>: LogDensityProblems;</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's define some type that represents the model.</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> IsotropicNormalModel{M<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"mean of the isotropic Gaussian"</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    mean<span class="op">::</span><span class="dt">M</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Specifies what input length the model expects.</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">dimension</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> <span class="fu">length</span>(model.mean)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Implementation of the log-density evaluation of the model.</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x<span class="op">::</span><span class="dt">AbstractVector{&lt;:Real}</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">-</span> <span class="fu">sum</span>(abs2, x <span class="op">.-</span> model.mean) <span class="op">/</span> <span class="fl">2</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This gives us all of the properties we want for our MALA sampler with the exception of the computation of the <em>gradient</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span>. There is the method <code>LogDensityProblems.logdensity_and_gradient</code> which should return a 2-tuple where the first entry is the evaluation of the logdensity <span class="math inline">\(\log \gamma(x)\)</span> and the second entry is the gradient <span class="math inline">\(\nabla \log \gamma(x)\)</span>.</p>
<p>There are two ways to “implement” this method: 1) we implement it by hand, which is feasible in the case of our <code>IsotropicNormalModel</code>, or b) we defer the implementation of this to a automatic differentiation backend.</p>
<p>To implement it by hand we can simply do</p>
<div id="6" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl that first-order, i.e. gradient information, is available.</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{1}</span>()</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Implement `logdensity_and_gradient`.</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    logγ_x <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="op">-</span>x <span class="op">.*</span> (x <span class="op">-</span> model.mean)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> logγ_x, ∇logγ_x</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s just try it out:</p>
<div id="8" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate the problem.</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> <span class="fu">IsotropicNormalModel</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.])</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create some example input that we can test on.</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>x_example <span class="op">=</span> <span class="fu">randn</span>(LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate!</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-17.348124295309965</code></pre>
</div>
</div>
<p>To defer it to an automatic differentiation backend, we can do</p>
<div id="10" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl we only have access to 0-th order information.</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{0}</span>()</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Use `LogDensityProblemsAD`'s `ADgradient` in combination with some AD backend to implement `logdensity_and_gradient`.</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblemsAD</span>, <span class="bu">ADTypes</span>, <span class="bu">ForwardDiff</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>model_with_grad <span class="op">=</span> <span class="fu">ADgradient</span>(<span class="fu">AutoForwardDiff</span>(), model)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model_with_grad, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-17.348124295309965</code></pre>
</div>
</div>
<p>We’ll continue with the second approach in this tutorial since this is typically what one does in practice, because there are better hobbies to spend time on than deriving gradients by hand.</p>
<p>At this point, one might wonder how we’re going to tie this back to Turing.jl in the end. Effectively, when working with inference methods that only require log-density evaluations and / or higher-order information of the log-density, Turing.jl actually converts the user-provided <code>Model</code> into an object implementing the above methods for <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>. As a result, most samplers provided by Turing.jl are actually implemented to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, enabling their use both <em>within</em> Turing.jl and <em>outside</em> of Turing.jl! Morever, there exists similar conversions for Stan through BridgeStan and Stan<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, which means that a sampler supporting the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface can easily be used on both Turing.jl <em>and</em> Stan models (in addition to user-provided models, as our <code>IsotropicNormalModel</code> above)!</p>
<p>Anyways, let’s move on to actually implementing the sampler.</p>
</section>
<section id="implementing-mala-in-abstractmcmc.jl" class="level2">
<h2 class="anchored" data-anchor-id="implementing-mala-in-abstractmcmc.jl">Implementing MALA in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a></h2>
<p>Now that we’ve established that a model implementing the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface provides us with all the information we need from <span class="math inline">\(\log \gamma(x)\)</span>, we can address the question: given an object that implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, how can we define a sampler for it?</p>
<p>We’re going to do this by making our sampler a sub-type of <code>AbstractMCMC.AbstractSampler</code> in addition to implementing a few methods from <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>. Why? Because it gets us <em>a lot</em> of functionality for free, as we will see later.</p>
<p>Moreover, <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> provides a very natural interface for MCMC algorithms.</p>
<p>First, we’ll define our <code>MALA</code> type</p>
<div id="12" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">AbstractMCMC</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALA{T,A} <span class="op">&lt;:</span><span class="dt"> AbstractMCMC.AbstractSampler</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"stepsize used in the leapfrog step"</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    ϵ_init<span class="op">::</span><span class="dt">T</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"covariance matrix used for the momentum"</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    M_init<span class="op">::</span><span class="dt">A</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notice how we’ve added the suffix <code>_init</code> to both the stepsize and the covariance matrix. We’ve done this because a <code>AbstractMCMC.AbstractSampler</code> should be <em>immutable</em>. Of course there might be many scenarios where we want to allow something like the stepsize and / or the covariance matrix to vary between iterations, e.g.&nbsp;during the burn-in / adaptation phase of the sampling process we might want to adjust the parameters using statistics computed from these initial iterations. But information which can change between iterations <em>should not go in the sampler itself</em>! Instead, this information should go in the sampler <em>state</em>.</p>
<p>The sampler state should at the very least contain all the necessary information to perform the next MCMC iteration, but usually contains further information, e.g.&nbsp;quantities and statistics useful for evaluating whether the sampler has converged.</p>
<p>We will use the following sampler state for our <code>MALA</code> sampler:</p>
<div id="14" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALAState{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This might seem overly redundant: we’re defining a type <code>MALAState</code> and it only contains a simple vector of reals. In this particular case we indeed could have dropped this and simply used a <code>AbstractVector{&lt;:Real}</code> as our sampler state, but typically, as we will see later, one wants to include other quantities in the sampler state. For example, if we also wanted to adapt the parameters of our <code>MALA</code>, e.g.&nbsp;alter the stepsize depending on acceptance rates, in which case we should also put <code>ϵ</code> in the state, but for now we’ll keep things simple.</p>
<p>Moreover, we also want a <em>sample</em> type, which is a type meant for “public consumption”, i.e.&nbsp;the end-user. This is generally going to contain a subset of the information present in the state. But in such a simple scenario as this, we similarly only have a <code>AbstractVector{&lt;:Real}</code>:</p>
<div id="16" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALASample{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We currently have three things:</p>
<ol type="1">
<li>A <code>AbstractMCMC.AbstractSampler</code> implementation called <code>MALA</code>.</li>
<li>A state <code>MALAState</code> for our sampler <code>MALA</code>.</li>
<li>A sample <code>MALASample</code> for our sampler <code>MALA</code>.</li>
</ol>
<p>That means that we’re ready to implement the only thing that really matters: <code>AbstractMCMC.step</code>.</p>
<p><code>AbstractMCMC.step</code> defines the MCMC iteration of our <code>MALA</code> given the current <code>MALAState</code>. Specifically, the signature of the function is as follows:</p>
<div id="18" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The RNG to ensure reproducibility.</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The model that defines our target.</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.AbstractModel</span>,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The sampler for which we're taking a `step`.</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">AbstractMCMC.AbstractSampler</span>,</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The current sampler `state`.</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    state;</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Additional keyword arguments that we may or may not need.</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Moreover, there is a specific <code>AbstractMCMC.AbstractModel</code> which is used to indicate that the model that is provided implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface: <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Since, as we discussed earlier, in our case we’re indeed going to work with types that support the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, we’ll define <code>AbstractMCMC.step</code> for such a <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Note that <code>AbstractMCMC.LogDensityModel</code> has no other purpose; it has a single field called <code>logdensity</code>, and it does nothing else. But by wrapping the model in <code>AbstractMCMC.LogDensityModel</code>, it allows samplers that want to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> to define their <code>AbstractMCMC.step</code> on this type without running into method ambiguities.</p>
<p>All in all, that means that the signature for our <code>AbstractMCMC.step</code> is going to be the following:</p>
<div id="20" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># `LogDensityModel` so we know we're working with LogDensityProblems.jl model.</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler.</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler state.</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Great! Now let’s actually implement the full <code>AbstractMCMC.step</code> for our <code>MALA</code>.</p>
<p>Let’s remind ourselves what we’re going to do:</p>
<ol type="1">
<li>Sample a new momentum <span class="math inline">\(p\)</span>.</li>
<li>Compute the log-density of the extended target <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>Take a single leapfrog step <span class="math inline">\((\tilde{x}, \tilde{p}) = L_{\epsilon}(x, p)\)</span>.</li>
<li>Accept or reject the proposed <span class="math inline">\((\tilde{x}, \tilde{p})\)</span>.</li>
</ol>
<p>All in all, this results in the following:</p>
<div id="22" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>: Random</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Distributions</span>  <span class="co"># so we get the `MvNormal`</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the wrapped model which implements LogDensityProblems.jl.</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just extract the sampler parameters to make our lives easier.</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    ϵ <span class="op">=</span> sampler.ϵ_init</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    M <span class="op">=</span> sampler.M_init</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the current parameters.</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> state.x</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sample the momentum.</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>    p_dist <span class="op">=</span> <span class="fu">MvNormal</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)), M)</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> <span class="fu">rand</span>(rng, p_dist)</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Propose using a single leapfrog step.</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>    x̃, p̃ <span class="op">=</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Accept or reject proposal.</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>    logp <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p)</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>    logp̃ <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x̃) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p̃)</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>    logα <span class="op">=</span> logp̃ <span class="op">-</span> logp</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>    state_new <span class="op">=</span> <span class="cf">if</span> <span class="fu">log</span>(<span class="fu">rand</span>(rng)) <span class="op">&lt;</span> logα</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Accept.</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x̃)</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Reject.</span></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x)</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return the "sample" and the sampler state.</span></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(state_new.x), state_new</span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Fairly straight-forward.</p>
<p>Of course, we haven’t defined the <code>leapfrog_step</code> method yet, so let’s do that:</p>
<div id="24" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p` using "position" `x`.</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x))</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    p1 <span class="op">=</span> p <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update the "position" `x` using momentum `p1`.</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    x̃ <span class="op">=</span> x <span class="op">+</span> ϵ <span class="op">.*</span> (M <span class="op">\</span> p1)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p1` using position `x̃`</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x̃ <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x̃))</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    p2 <span class="op">=</span> p1 <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x̃</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Flip momentum `p2`.</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    p̃ <span class="op">=</span> <span class="op">-</span>p2</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x̃, p̃</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>leapfrog_step (generic function with 1 method)</code></pre>
</div>
</div>
<p>With all of this, we’re technically ready to sample!</p>
<div id="26" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>, <span class="bu">LinearAlgebra</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>rng <span class="op">=</span> <span class="bu">Random</span>.<span class="fu">default_rng</span>()</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>sampler <span class="op">=</span> <span class="fu">MALA</span>(<span class="fl">1</span>, I)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>state <span class="op">=</span> <span class="fu">MALAState</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)))</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>x_next, state_next <span class="op">=</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    rng,</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    AbstractMCMC.<span class="fu">LogDensityModel</span>(model),</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    state</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>(MALASample{Vector{Float64}}([0.0, 0.0, 0.0]), MALAState{Vector{Float64}}([0.0, 0.0, 0.0]))</code></pre>
</div>
</div>
<p>Great, it works!</p>
<p>And I promised we would get quite some functionality for free if we implemented <code>AbstractMCMC.step</code>, and so we can now simply call <code>sample</code> to perform standard MCMC sampling:</p>
<div id="28" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform 1000 iterations with our `MALA` sampler.</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; initial_state<span class="op">=</span>state, progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Concatenate into a matrix.</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000 Matrix{Float64}:
 -1.84472    -3.58702  -3.28885  …  -4.05505  -3.17752   -6.35925
  0.0713501  -1.14737  -1.63269     -1.2386   -0.496235  -1.29123
  2.45399     3.34365   5.78144      3.69125   3.87393    3.37067</code></pre>
</div>
</div>
<div id="30" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the marginal means and standard deviations.</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -5.00108    0.998087
  0.0067116  0.982703
  4.98763    0.997247</code></pre>
</div>
</div>
<p>Let’s visualize the samples</p>
<div id="32" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">StatsPlots</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">transpose</span>(samples_matrix[<span class="op">:</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">:</span><span class="kw">end</span>]), alpha<span class="op">=</span><span class="fl">0.5</span>, legend<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<!--?xml version="1.0" encoding="utf-8"?-->
<svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" width="672" height="480" viewbox="0 0 2688 1920">
<defs>
  <clippath id="clip760">
    <rect x="0" y="0" width="2688" height="1920"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip760)" d="M0 1920 L2688 1920 L2688 0 L0 0  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip761">
    <rect x="537" y="0" width="1883" height="1883"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip760)" d="M196.816 1800.78 L2640.76 1800.78 L2640.76 47.2441 L196.816 47.2441  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip762">
    <rect x="196" y="47" width="2445" height="1755"></rect>
  </clippath>
</defs>
<polyline clip-path="url(#clip762)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="263.676,1800.78 263.676,47.2441 "></polyline>
<polyline clip-path="url(#clip762)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="840.654,1800.78 840.654,47.2441 "></polyline>
<polyline clip-path="url(#clip762)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1417.63,1800.78 1417.63,47.2441 "></polyline>
<polyline clip-path="url(#clip762)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1994.61,1800.78 1994.61,47.2441 "></polyline>
<polyline clip-path="url(#clip762)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="2571.59,1800.78 2571.59,47.2441 "></polyline>
<polyline clip-path="url(#clip762)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,1679.78 2640.76,1679.78 "></polyline>
<polyline clip-path="url(#clip762)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,1435.82 2640.76,1435.82 "></polyline>
<polyline clip-path="url(#clip762)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,1191.86 2640.76,1191.86 "></polyline>
<polyline clip-path="url(#clip762)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,947.896 2640.76,947.896 "></polyline>
<polyline clip-path="url(#clip762)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,703.935 2640.76,703.935 "></polyline>
<polyline clip-path="url(#clip762)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,459.974 2640.76,459.974 "></polyline>
<polyline clip-path="url(#clip762)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,216.013 2640.76,216.013 "></polyline>
<polyline clip-path="url(#clip760)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1800.78 2640.76,1800.78 "></polyline>
<polyline clip-path="url(#clip760)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="263.676,1800.78 263.676,1781.88 "></polyline>
<polyline clip-path="url(#clip760)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="840.654,1800.78 840.654,1781.88 "></polyline>
<polyline clip-path="url(#clip760)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1417.63,1800.78 1417.63,1781.88 "></polyline>
<polyline clip-path="url(#clip760)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1994.61,1800.78 1994.61,1781.88 "></polyline>
<polyline clip-path="url(#clip760)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="2571.59,1800.78 2571.59,1781.88 "></polyline>
<path clip-path="url(#clip760)" d="M263.676 1834 Q260.065 1834 258.236 1837.57 Q256.431 1841.11 256.431 1848.24 Q256.431 1855.34 258.236 1858.91 Q260.065 1862.45 263.676 1862.45 Q267.31 1862.45 269.116 1858.91 Q270.945 1855.34 270.945 1848.24 Q270.945 1841.11 269.116 1837.57 Q267.31 1834 263.676 1834 M263.676 1830.3 Q269.486 1830.3 272.542 1834.9 Q275.621 1839.49 275.621 1848.24 Q275.621 1856.96 272.542 1861.57 Q269.486 1866.15 263.676 1866.15 Q257.866 1866.15 254.787 1861.57 Q251.732 1856.96 251.732 1848.24 Q251.732 1839.49 254.787 1834.9 Q257.866 1830.3 263.676 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip760)" d="M804.346 1861.55 L820.666 1861.55 L820.666 1865.48 L798.721 1865.48 L798.721 1861.55 Q801.383 1858.79 805.967 1854.16 Q810.573 1849.51 811.754 1848.17 Q813.999 1845.65 814.879 1843.91 Q815.782 1842.15 815.782 1840.46 Q815.782 1837.71 813.837 1835.97 Q811.916 1834.23 808.814 1834.23 Q806.615 1834.23 804.161 1835 Q801.731 1835.76 798.953 1837.31 L798.953 1832.59 Q801.777 1831.46 804.231 1830.88 Q806.684 1830.3 808.721 1830.3 Q814.092 1830.3 817.286 1832.98 Q820.481 1835.67 820.481 1840.16 Q820.481 1842.29 819.67 1844.21 Q818.883 1846.11 816.777 1848.7 Q816.198 1849.37 813.096 1852.59 Q809.995 1855.78 804.346 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip760)" d="M830.527 1830.92 L848.883 1830.92 L848.883 1834.86 L834.809 1834.86 L834.809 1843.33 Q835.828 1842.98 836.846 1842.82 Q837.865 1842.64 838.883 1842.64 Q844.67 1842.64 848.05 1845.81 Q851.43 1848.98 851.43 1854.4 Q851.43 1859.97 847.957 1863.08 Q844.485 1866.15 838.166 1866.15 Q835.99 1866.15 833.721 1865.78 Q831.476 1865.41 829.069 1864.67 L829.069 1859.97 Q831.152 1861.11 833.374 1861.66 Q835.596 1862.22 838.073 1862.22 Q842.078 1862.22 844.416 1860.11 Q846.754 1858.01 846.754 1854.4 Q846.754 1850.78 844.416 1848.68 Q842.078 1846.57 838.073 1846.57 Q836.198 1846.57 834.323 1846.99 Q832.471 1847.4 830.527 1848.28 L830.527 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip760)" d="M870.642 1834 Q867.031 1834 865.203 1837.57 Q863.397 1841.11 863.397 1848.24 Q863.397 1855.34 865.203 1858.91 Q867.031 1862.45 870.642 1862.45 Q874.277 1862.45 876.082 1858.91 Q877.911 1855.34 877.911 1848.24 Q877.911 1841.11 876.082 1837.57 Q874.277 1834 870.642 1834 M870.642 1830.3 Q876.453 1830.3 879.508 1834.9 Q882.587 1839.49 882.587 1848.24 Q882.587 1856.96 879.508 1861.57 Q876.453 1866.15 870.642 1866.15 Q864.832 1866.15 861.754 1861.57 Q858.698 1856.96 858.698 1848.24 Q858.698 1839.49 861.754 1834.9 Q864.832 1830.3 870.642 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip760)" d="M1377.25 1830.92 L1395.61 1830.92 L1395.61 1834.86 L1381.53 1834.86 L1381.53 1843.33 Q1382.55 1842.98 1383.57 1842.82 Q1384.59 1842.64 1385.61 1842.64 Q1391.39 1842.64 1394.77 1845.81 Q1398.15 1848.98 1398.15 1854.4 Q1398.15 1859.97 1394.68 1863.08 Q1391.21 1866.15 1384.89 1866.15 Q1382.71 1866.15 1380.44 1865.78 Q1378.2 1865.41 1375.79 1864.67 L1375.79 1859.97 Q1377.88 1861.11 1380.1 1861.66 Q1382.32 1862.22 1384.8 1862.22 Q1388.8 1862.22 1391.14 1860.11 Q1393.48 1858.01 1393.48 1854.4 Q1393.48 1850.78 1391.14 1848.68 Q1388.8 1846.57 1384.8 1846.57 Q1382.92 1846.57 1381.05 1846.99 Q1379.19 1847.4 1377.25 1848.28 L1377.25 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip760)" d="M1417.37 1834 Q1413.75 1834 1411.93 1837.57 Q1410.12 1841.11 1410.12 1848.24 Q1410.12 1855.34 1411.93 1858.91 Q1413.75 1862.45 1417.37 1862.45 Q1421 1862.45 1422.81 1858.91 Q1424.63 1855.34 1424.63 1848.24 Q1424.63 1841.11 1422.81 1837.57 Q1421 1834 1417.37 1834 M1417.37 1830.3 Q1423.18 1830.3 1426.23 1834.9 Q1429.31 1839.49 1429.31 1848.24 Q1429.31 1856.96 1426.23 1861.57 Q1423.18 1866.15 1417.37 1866.15 Q1411.56 1866.15 1408.48 1861.57 Q1405.42 1856.96 1405.42 1848.24 Q1405.42 1839.49 1408.48 1834.9 Q1411.56 1830.3 1417.37 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip760)" d="M1447.53 1834 Q1443.92 1834 1442.09 1837.57 Q1440.28 1841.11 1440.28 1848.24 Q1440.28 1855.34 1442.09 1858.91 Q1443.92 1862.45 1447.53 1862.45 Q1451.16 1862.45 1452.97 1858.91 Q1454.8 1855.34 1454.8 1848.24 Q1454.8 1841.11 1452.97 1837.57 Q1451.16 1834 1447.53 1834 M1447.53 1830.3 Q1453.34 1830.3 1456.39 1834.9 Q1459.47 1839.49 1459.47 1848.24 Q1459.47 1856.96 1456.39 1861.57 Q1453.34 1866.15 1447.53 1866.15 Q1441.72 1866.15 1438.64 1861.57 Q1435.58 1856.96 1435.58 1848.24 Q1435.58 1839.49 1438.64 1834.9 Q1441.72 1830.3 1447.53 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip760)" d="M1952.89 1830.92 L1975.11 1830.92 L1975.11 1832.91 L1962.56 1865.48 L1957.68 1865.48 L1969.48 1834.86 L1952.89 1834.86 L1952.89 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip760)" d="M1984.27 1830.92 L2002.63 1830.92 L2002.63 1834.86 L1988.56 1834.86 L1988.56 1843.33 Q1989.58 1842.98 1990.59 1842.82 Q1991.61 1842.64 1992.63 1842.64 Q1998.42 1842.64 2001.8 1845.81 Q2005.18 1848.98 2005.18 1854.4 Q2005.18 1859.97 2001.7 1863.08 Q1998.23 1866.15 1991.91 1866.15 Q1989.74 1866.15 1987.47 1865.78 Q1985.22 1865.41 1982.82 1864.67 L1982.82 1859.97 Q1984.9 1861.11 1987.12 1861.66 Q1989.34 1862.22 1991.82 1862.22 Q1995.83 1862.22 1998.16 1860.11 Q2000.5 1858.01 2000.5 1854.4 Q2000.5 1850.78 1998.16 1848.68 Q1995.83 1846.57 1991.82 1846.57 Q1989.95 1846.57 1988.07 1846.99 Q1986.22 1847.4 1984.27 1848.28 L1984.27 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip760)" d="M2024.39 1834 Q2020.78 1834 2018.95 1837.57 Q2017.14 1841.11 2017.14 1848.24 Q2017.14 1855.34 2018.95 1858.91 Q2020.78 1862.45 2024.39 1862.45 Q2028.02 1862.45 2029.83 1858.91 Q2031.66 1855.34 2031.66 1848.24 Q2031.66 1841.11 2029.83 1837.57 Q2028.02 1834 2024.39 1834 M2024.39 1830.3 Q2030.2 1830.3 2033.26 1834.9 Q2036.33 1839.49 2036.33 1848.24 Q2036.33 1856.96 2033.26 1861.57 Q2030.2 1866.15 2024.39 1866.15 Q2018.58 1866.15 2015.5 1861.57 Q2012.45 1856.96 2012.45 1848.24 Q2012.45 1839.49 2015.5 1834.9 Q2018.58 1830.3 2024.39 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip760)" d="M2516.11 1861.55 L2523.75 1861.55 L2523.75 1835.18 L2515.44 1836.85 L2515.44 1832.59 L2523.71 1830.92 L2528.38 1830.92 L2528.38 1861.55 L2536.02 1861.55 L2536.02 1865.48 L2516.11 1865.48 L2516.11 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip760)" d="M2555.47 1834 Q2551.85 1834 2550.03 1837.57 Q2548.22 1841.11 2548.22 1848.24 Q2548.22 1855.34 2550.03 1858.91 Q2551.85 1862.45 2555.47 1862.45 Q2559.1 1862.45 2560.9 1858.91 Q2562.73 1855.34 2562.73 1848.24 Q2562.73 1841.11 2560.9 1837.57 Q2559.1 1834 2555.47 1834 M2555.47 1830.3 Q2561.28 1830.3 2564.33 1834.9 Q2567.41 1839.49 2567.41 1848.24 Q2567.41 1856.96 2564.33 1861.57 Q2561.28 1866.15 2555.47 1866.15 Q2549.66 1866.15 2546.58 1861.57 Q2543.52 1856.96 2543.52 1848.24 Q2543.52 1839.49 2546.58 1834.9 Q2549.66 1830.3 2555.47 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip760)" d="M2585.63 1834 Q2582.02 1834 2580.19 1837.57 Q2578.38 1841.11 2578.38 1848.24 Q2578.38 1855.34 2580.19 1858.91 Q2582.02 1862.45 2585.63 1862.45 Q2589.26 1862.45 2591.07 1858.91 Q2592.9 1855.34 2592.9 1848.24 Q2592.9 1841.11 2591.07 1837.57 Q2589.26 1834 2585.63 1834 M2585.63 1830.3 Q2591.44 1830.3 2594.49 1834.9 Q2597.57 1839.49 2597.57 1848.24 Q2597.57 1856.96 2594.49 1861.57 Q2591.44 1866.15 2585.63 1866.15 Q2579.82 1866.15 2576.74 1861.57 Q2573.68 1856.96 2573.68 1848.24 Q2573.68 1839.49 2576.74 1834.9 Q2579.82 1830.3 2585.63 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip760)" d="M2615.79 1834 Q2612.18 1834 2610.35 1837.57 Q2608.54 1841.11 2608.54 1848.24 Q2608.54 1855.34 2610.35 1858.91 Q2612.18 1862.45 2615.79 1862.45 Q2619.42 1862.45 2621.23 1858.91 Q2623.06 1855.34 2623.06 1848.24 Q2623.06 1841.11 2621.23 1837.57 Q2619.42 1834 2615.79 1834 M2615.79 1830.3 Q2621.6 1830.3 2624.65 1834.9 Q2627.73 1839.49 2627.73 1848.24 Q2627.73 1856.96 2624.65 1861.57 Q2621.6 1866.15 2615.79 1866.15 Q2609.98 1866.15 2606.9 1861.57 Q2603.84 1856.96 2603.84 1848.24 Q2603.84 1839.49 2606.9 1834.9 Q2609.98 1830.3 2615.79 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip760)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1800.78 196.816,47.2441 "></polyline>
<polyline clip-path="url(#clip760)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1679.78 215.714,1679.78 "></polyline>
<polyline clip-path="url(#clip760)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1435.82 215.714,1435.82 "></polyline>
<polyline clip-path="url(#clip760)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1191.86 215.714,1191.86 "></polyline>
<polyline clip-path="url(#clip760)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,947.896 215.714,947.896 "></polyline>
<polyline clip-path="url(#clip760)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,703.935 215.714,703.935 "></polyline>
<polyline clip-path="url(#clip760)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,459.974 215.714,459.974 "></polyline>
<polyline clip-path="url(#clip760)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,216.013 215.714,216.013 "></polyline>
<path clip-path="url(#clip760)" d="M50.5475 1680.23 L80.2233 1680.23 L80.2233 1684.17 L50.5475 1684.17 L50.5475 1680.23 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip760)" d="M89.1352 1662.5 L111.357 1662.5 L111.357 1664.49 L98.8111 1697.06 L93.9269 1697.06 L105.732 1666.43 L89.1352 1666.43 L89.1352 1662.5 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip760)" d="M120.478 1691.18 L125.362 1691.18 L125.362 1697.06 L120.478 1697.06 L120.478 1691.18 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip760)" d="M135.593 1662.5 L153.95 1662.5 L153.95 1666.43 L139.876 1666.43 L139.876 1674.91 Q140.894 1674.56 141.913 1674.4 Q142.931 1674.21 143.95 1674.21 Q149.737 1674.21 153.116 1677.38 Q156.496 1680.55 156.496 1685.97 Q156.496 1691.55 153.024 1694.65 Q149.552 1697.73 143.232 1697.73 Q141.056 1697.73 138.788 1697.36 Q136.542 1696.99 134.135 1696.25 L134.135 1691.55 Q136.218 1692.68 138.441 1693.24 Q140.663 1693.8 143.14 1693.8 Q147.144 1693.8 149.482 1691.69 Q151.82 1689.58 151.82 1685.97 Q151.82 1682.36 149.482 1680.25 Q147.144 1678.15 143.14 1678.15 Q141.265 1678.15 139.39 1678.56 Q137.538 1678.98 135.593 1679.86 L135.593 1662.5 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip760)" d="M49.5521 1436.27 L79.2279 1436.27 L79.2279 1440.2 L49.5521 1440.2 L49.5521 1436.27 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip760)" d="M89.3667 1418.54 L107.723 1418.54 L107.723 1422.47 L93.6491 1422.47 L93.6491 1430.95 Q94.6676 1430.6 95.6861 1430.44 Q96.7047 1430.25 97.7232 1430.25 Q103.51 1430.25 106.89 1433.42 Q110.269 1436.59 110.269 1442.01 Q110.269 1447.59 106.797 1450.69 Q103.325 1453.77 97.0056 1453.77 Q94.8297 1453.77 92.5612 1453.4 Q90.3158 1453.03 87.9084 1452.29 L87.9084 1447.59 Q89.9917 1448.72 92.2139 1449.28 Q94.4361 1449.83 96.913 1449.83 Q100.918 1449.83 103.256 1447.73 Q105.593 1445.62 105.593 1442.01 Q105.593 1438.4 103.256 1436.29 Q100.918 1434.19 96.913 1434.19 Q95.038 1434.19 93.163 1434.6 Q91.3112 1435.02 89.3667 1435.9 L89.3667 1418.54 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip760)" d="M119.482 1447.22 L124.367 1447.22 L124.367 1453.1 L119.482 1453.1 L119.482 1447.22 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip760)" d="M144.552 1421.62 Q140.941 1421.62 139.112 1425.18 Q137.306 1428.72 137.306 1435.85 Q137.306 1442.96 139.112 1446.52 Q140.941 1450.07 144.552 1450.07 Q148.186 1450.07 149.991 1446.52 Q151.82 1442.96 151.82 1435.85 Q151.82 1428.72 149.991 1425.18 Q148.186 1421.62 144.552 1421.62 M144.552 1417.91 Q150.362 1417.91 153.417 1422.52 Q156.496 1427.1 156.496 1435.85 Q156.496 1444.58 153.417 1449.19 Q150.362 1453.77 144.552 1453.77 Q138.741 1453.77 135.663 1449.19 Q132.607 1444.58 132.607 1435.85 Q132.607 1427.1 135.663 1422.52 Q138.741 1417.91 144.552 1417.91 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip760)" d="M50.5475 1192.31 L80.2233 1192.31 L80.2233 1196.24 L50.5475 1196.24 L50.5475 1192.31 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip760)" d="M94.3436 1205.2 L110.663 1205.2 L110.663 1209.14 L88.7186 1209.14 L88.7186 1205.2 Q91.3806 1202.45 95.9639 1197.82 Q100.57 1193.17 101.751 1191.82 Q103.996 1189.3 104.876 1187.56 Q105.779 1185.8 105.779 1184.11 Q105.779 1181.36 103.834 1179.62 Q101.913 1177.89 98.8111 1177.89 Q96.6121 1177.89 94.1584 1178.65 Q91.7278 1179.42 88.9501 1180.97 L88.9501 1176.24 Q91.7741 1175.11 94.2278 1174.53 Q96.6815 1173.95 98.7185 1173.95 Q104.089 1173.95 107.283 1176.64 Q110.478 1179.32 110.478 1183.81 Q110.478 1185.94 109.668 1187.86 Q108.881 1189.76 106.774 1192.36 Q106.195 1193.03 103.094 1196.24 Q99.9917 1199.44 94.3436 1205.2 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip760)" d="M120.478 1203.26 L125.362 1203.26 L125.362 1209.14 L120.478 1209.14 L120.478 1203.26 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip760)" d="M135.593 1174.58 L153.95 1174.58 L153.95 1178.51 L139.876 1178.51 L139.876 1186.98 Q140.894 1186.64 141.913 1186.48 Q142.931 1186.29 143.95 1186.29 Q149.737 1186.29 153.116 1189.46 Q156.496 1192.63 156.496 1198.05 Q156.496 1203.63 153.024 1206.73 Q149.552 1209.81 143.232 1209.81 Q141.056 1209.81 138.788 1209.44 Q136.542 1209.07 134.135 1208.33 L134.135 1203.63 Q136.218 1204.76 138.441 1205.32 Q140.663 1205.87 143.14 1205.87 Q147.144 1205.87 149.482 1203.77 Q151.82 1201.66 151.82 1198.05 Q151.82 1194.44 149.482 1192.33 Q147.144 1190.23 143.14 1190.23 Q141.265 1190.23 139.39 1190.64 Q137.538 1191.06 135.593 1191.94 L135.593 1174.58 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip760)" d="M99.3204 933.695 Q95.7093 933.695 93.8806 937.26 Q92.075 940.801 92.075 947.931 Q92.075 955.037 93.8806 958.602 Q95.7093 962.144 99.3204 962.144 Q102.955 962.144 104.76 958.602 Q106.589 955.037 106.589 947.931 Q106.589 940.801 104.76 937.26 Q102.955 933.695 99.3204 933.695 M99.3204 929.991 Q105.131 929.991 108.186 934.598 Q111.265 939.181 111.265 947.931 Q111.265 956.658 108.186 961.264 Q105.131 965.848 99.3204 965.848 Q93.5102 965.848 90.4315 961.264 Q87.376 956.658 87.376 947.931 Q87.376 939.181 90.4315 934.598 Q93.5102 929.991 99.3204 929.991 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip760)" d="M119.482 959.297 L124.367 959.297 L124.367 965.176 L119.482 965.176 L119.482 959.297 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip760)" d="M144.552 933.695 Q140.941 933.695 139.112 937.26 Q137.306 940.801 137.306 947.931 Q137.306 955.037 139.112 958.602 Q140.941 962.144 144.552 962.144 Q148.186 962.144 149.991 958.602 Q151.82 955.037 151.82 947.931 Q151.82 940.801 149.991 937.26 Q148.186 933.695 144.552 933.695 M144.552 929.991 Q150.362 929.991 153.417 934.598 Q156.496 939.181 156.496 947.931 Q156.496 956.658 153.417 961.264 Q150.362 965.848 144.552 965.848 Q138.741 965.848 135.663 961.264 Q132.607 956.658 132.607 947.931 Q132.607 939.181 135.663 934.598 Q138.741 929.991 144.552 929.991 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip760)" d="M94.3436 717.28 L110.663 717.28 L110.663 721.215 L88.7186 721.215 L88.7186 717.28 Q91.3806 714.525 95.9639 709.896 Q100.57 705.243 101.751 703.9 Q103.996 701.377 104.876 699.641 Q105.779 697.882 105.779 696.192 Q105.779 693.438 103.834 691.701 Q101.913 689.965 98.8111 689.965 Q96.6121 689.965 94.1584 690.729 Q91.7278 691.493 88.9501 693.044 L88.9501 688.322 Q91.7741 687.188 94.2278 686.609 Q96.6815 686.03 98.7185 686.03 Q104.089 686.03 107.283 688.715 Q110.478 691.401 110.478 695.891 Q110.478 698.021 109.668 699.942 Q108.881 701.84 106.774 704.433 Q106.195 705.104 103.094 708.322 Q99.9917 711.516 94.3436 717.28 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip760)" d="M120.478 715.336 L125.362 715.336 L125.362 721.215 L120.478 721.215 L120.478 715.336 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip760)" d="M135.593 686.655 L153.95 686.655 L153.95 690.59 L139.876 690.59 L139.876 699.063 Q140.894 698.715 141.913 698.553 Q142.931 698.368 143.95 698.368 Q149.737 698.368 153.116 701.539 Q156.496 704.711 156.496 710.127 Q156.496 715.706 153.024 718.808 Q149.552 721.887 143.232 721.887 Q141.056 721.887 138.788 721.516 Q136.542 721.146 134.135 720.405 L134.135 715.706 Q136.218 716.84 138.441 717.396 Q140.663 717.951 143.14 717.951 Q147.144 717.951 149.482 715.845 Q151.82 713.738 151.82 710.127 Q151.82 706.516 149.482 704.41 Q147.144 702.303 143.14 702.303 Q141.265 702.303 139.39 702.72 Q137.538 703.137 135.593 704.016 L135.593 686.655 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip760)" d="M89.3667 442.694 L107.723 442.694 L107.723 446.629 L93.6491 446.629 L93.6491 455.101 Q94.6676 454.754 95.6861 454.592 Q96.7047 454.407 97.7232 454.407 Q103.51 454.407 106.89 457.578 Q110.269 460.75 110.269 466.166 Q110.269 471.745 106.797 474.847 Q103.325 477.925 97.0056 477.925 Q94.8297 477.925 92.5612 477.555 Q90.3158 477.185 87.9084 476.444 L87.9084 471.745 Q89.9917 472.879 92.2139 473.435 Q94.4361 473.99 96.913 473.99 Q100.918 473.99 103.256 471.884 Q105.593 469.777 105.593 466.166 Q105.593 462.555 103.256 460.449 Q100.918 458.342 96.913 458.342 Q95.038 458.342 93.163 458.759 Q91.3112 459.176 89.3667 460.055 L89.3667 442.694 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip760)" d="M119.482 471.375 L124.367 471.375 L124.367 477.254 L119.482 477.254 L119.482 471.375 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip760)" d="M144.552 445.773 Q140.941 445.773 139.112 449.338 Q137.306 452.879 137.306 460.009 Q137.306 467.115 139.112 470.68 Q140.941 474.222 144.552 474.222 Q148.186 474.222 149.991 470.68 Q151.82 467.115 151.82 460.009 Q151.82 452.879 149.991 449.338 Q148.186 445.773 144.552 445.773 M144.552 442.069 Q150.362 442.069 153.417 446.676 Q156.496 451.259 156.496 460.009 Q156.496 468.736 153.417 473.342 Q150.362 477.925 144.552 477.925 Q138.741 477.925 135.663 473.342 Q132.607 468.736 132.607 460.009 Q132.607 451.259 135.663 446.676 Q138.741 442.069 144.552 442.069 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip760)" d="M89.1352 198.733 L111.357 198.733 L111.357 200.724 L98.8111 233.293 L93.9269 233.293 L105.732 202.668 L89.1352 202.668 L89.1352 198.733 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip760)" d="M120.478 227.413 L125.362 227.413 L125.362 233.293 L120.478 233.293 L120.478 227.413 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip760)" d="M135.593 198.733 L153.95 198.733 L153.95 202.668 L139.876 202.668 L139.876 211.14 Q140.894 210.793 141.913 210.631 Q142.931 210.446 143.95 210.446 Q149.737 210.446 153.116 213.617 Q156.496 216.789 156.496 222.205 Q156.496 227.784 153.024 230.886 Q149.552 233.964 143.232 233.964 Q141.056 233.964 138.788 233.594 Q136.542 233.224 134.135 232.483 L134.135 227.784 Q136.218 228.918 138.441 229.474 Q140.663 230.029 143.14 230.029 Q147.144 230.029 149.482 227.923 Q151.82 225.816 151.82 222.205 Q151.82 218.594 149.482 216.488 Q147.144 214.381 143.14 214.381 Q141.265 214.381 139.39 214.798 Q137.538 215.214 135.593 216.094 L135.593 198.733 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip762)" style="stroke:#009af9; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="265.984,1127.91 268.292,1254.04 270.6,1470.55 272.908,1437.16 275.216,1508.48 277.524,1381.33 279.832,1559.52 282.139,1335.44 284.447,1544.04 286.755,1549.53 289.063,1431.79 291.371,1477.48 293.679,1208.15 295.987,1345.87 298.295,1368.31 300.603,1439.98 302.911,1528.22 305.219,1489.1 307.527,1481.43 309.834,1462.98 312.142,1320.56 314.45,1394.62 316.758,1445.29 319.066,1401.63 321.374,1547.2 323.682,1364.46 325.99,1520.03 328.298,1540.4 330.606,1341.26 332.914,1443.08 335.221,1483.29 337.529,1630.39 339.837,1396.63 342.145,1367.39 344.453,1574.71 346.761,1356.65 349.069,1556.85 351.377,1468.67 353.685,1425.27 355.993,1540.7 358.301,1515.18 360.608,1357.53 362.916,1402.34 365.224,1434.27 367.532,1727.86 369.84,1490.33 372.148,1513.54 374.456,1474.43 376.764,1525.82 379.072,1546.15 381.38,1507.72 383.688,1460.54 385.996,1361.09 388.303,1578.35 390.611,1526.84 392.919,1482.88 395.227,1466.41 397.535,1323.61 399.843,1330.76 402.151,1449.54 404.459,1611.79 406.767,1454.77 409.075,1424.88 411.383,1447.14 413.69,1374.8 415.998,1458.6 418.306,1303.21 420.614,1610.77 422.922,1541.25 425.23,1570.49 427.538,1430.34 429.846,1386.6 432.154,1404.95 434.462,1558.83 436.77,1397.83 439.077,1437.21 441.385,1548.1 443.693,1330.94 446.001,1436.41 448.309,1382.01 450.617,1452.1 452.925,1358.1 455.233,1486.13 457.541,1168.19 459.849,1674.53 462.157,1369.77 464.465,1547.14 466.772,1267.59 469.08,1439.93 471.388,1354.32 473.696,1411.04 476.004,1456.84 478.312,1453.2 480.62,1459.39 482.928,1257.74 485.236,1442.52 487.544,1304.2 489.852,1476.33 492.159,1477.42 494.467,1454.17 496.775,1472.2 499.083,1370.13 501.391,1451.49 503.699,1364.68 506.007,1435.87 508.315,1438.27 510.623,1536.86 512.931,1547.87 515.239,1552.07 517.546,1391.88 519.854,1298.77 522.162,1495.81 524.47,1357.96 526.778,1522.29 529.086,1376.52 531.394,1514.3 533.702,1412.21 536.01,1447.74 538.318,1411.01 540.626,1444.41 542.933,1325.83 545.241,1518.17 547.549,1394.1 549.857,1365.03 552.165,1391.62 554.473,1603.27 556.781,1398.69 559.089,1480.17 561.397,1441.92 563.705,1476.62 566.013,1437.91 568.321,1345.44 570.628,1409.02 572.936,1352.17 575.244,1270.33 577.552,1336.29 579.86,1566.75 582.168,1307.34 584.476,1366.43 586.784,1456.43 589.092,1558.1 591.4,1488.38 593.708,1446.08 596.015,1606.28 598.323,1466.94 600.631,1458.87 602.939,1541.6 605.247,1256.61 607.555,1635.92 609.863,1366.34 612.171,1556.82 614.479,1243.6 616.787,1613.52 619.095,1469.88 621.402,1523.79 623.71,1400.46 626.018,1313.8 628.326,1416.21 630.634,1347.87 632.942,1370.97 635.25,1479.64 637.558,1532.65 639.866,1493.73 642.174,1306.39 644.482,1480.09 646.79,1372.78 649.097,1522.8 651.405,1545.73 653.713,1372.42 656.021,1462.64 658.329,1475.7 660.637,1324.65 662.945,1420.32 665.253,1476.7 667.561,1393.62 669.869,1328.96 672.177,1447.14 674.484,1383.18 676.792,1393.28 679.1,1554.42 681.408,1373.81 683.716,1632.09 686.024,1338.5 688.332,1475.87 690.64,1504.63 692.948,1446.72 695.256,1351.98 697.564,1460.5 699.871,1513.26 702.179,1410.68 704.487,1338.54 706.795,1500.35 709.103,1345.73 711.411,1608.78 713.719,1391.02 716.027,1548.35 718.335,1505.79 720.643,1388.65 722.951,1326.77 725.259,1539.43 727.566,1333.81 729.874,1444.46 732.182,1515.16 734.49,1498.38 736.798,1488.03 739.106,1684.36 741.414,1558.14 743.722,1400.76 746.03,1643.36 748.338,1258.67 750.646,1369.61 752.953,1426.23 755.261,1502.72 757.569,1478.46 759.877,1467.9 762.185,1527.96 764.493,1501.57 766.801,1501.84 769.109,1285.09 771.417,1428.85 773.725,1489.38 776.033,1530.23 778.34,1268.58 780.648,1561.39 782.956,1332.52 785.264,1465.72 787.572,1502.96 789.88,1530.09 792.188,1429.43 794.496,1486.54 796.804,1380.6 799.112,1423.55 801.42,1442.22 803.728,1525.75 806.035,1551.61 808.343,1538.33 810.651,1443.2 812.959,1322.26 815.267,1531.89 817.575,1413.1 819.883,1492.06 822.191,1546.17 824.499,1366.46 826.807,1390.42 829.115,1368.87 831.422,1395.02 833.73,1471.42 836.038,1381.97 838.346,1413.11 840.654,1349.52 842.962,1400.17 845.27,1287.41 847.578,1281.3 849.886,1384.24 852.194,1378.29 854.502,1587.45 856.809,1398.55 859.117,1232.8 861.425,1364.62 863.733,1440.81 866.041,1452.52 868.349,1357.52 870.657,1483.33 872.965,1276.79 875.273,1542.02 877.581,1457.17 879.889,1401.6 882.197,1216.47 884.504,1309.11 886.812,1258.11 889.12,1489.47 891.428,1438.26 893.736,1240.63 896.044,1554.05 898.352,1466.3 900.66,1335.37 902.968,1485.91 905.276,1521.09 907.584,1456.6 909.891,1426.57 912.199,1413.31 914.507,1561.49 916.815,1554.62 919.123,1370.93 921.431,1412.94 923.739,1454.67 926.047,1422.22 928.355,1435.22 930.663,1530.6 932.971,1562.15 935.278,1301.6 937.586,1379.31 939.894,1392.75 942.202,1274.36 944.51,1415.43 946.818,1379.75 949.126,1240.65 951.434,1427.5 953.742,1361.33 956.05,1435.29 958.358,1455.94 960.665,1553.45 962.973,1560.2 965.281,1389.38 967.589,1551.12 969.897,1390.61 972.205,1355.77 974.513,1487.46 976.821,1351.35 979.129,1369.33 981.437,1388.48 983.745,1411.86 986.053,1443.57 988.36,1549.41 990.668,1414.13 992.976,1551.94 995.284,1466.19 997.592,1534.12 999.9,1364.84 1002.21,1514.01 1004.52,1517.87 1006.82,1366.86 1009.13,1402.56 1011.44,1368.43 1013.75,1485.29 1016.06,1195.78 1018.36,1353.85 1020.67,1510.53 1022.98,1558.68 1025.29,1501.19 1027.59,1415.99 1029.9,1577.25 1032.21,1446.87 1034.52,1406.88 1036.83,1362.81 1039.13,1638.88 1041.44,1333 1043.75,1507.21 1046.06,1445.46 1048.37,1447.28 1050.67,1490.1 1052.98,1292.71 1055.29,1413.24 1057.6,1319.81 1059.91,1675.13 1062.21,1397.68 1064.52,1392.41 1066.83,1407.09 1069.14,1493.34 1071.45,1414.98 1073.75,1416.18 1076.06,1466.97 1078.37,1364.65 1080.68,1417.4 1082.98,1434.49 1085.29,1354.02 1087.6,1448.01 1089.91,1471.26 1092.22,1495.3 1094.52,1400.31 1096.83,1440.39 1099.14,1372.9 1101.45,1419.86 1103.76,1477.25 1106.06,1385.35 1108.37,1444.11 1110.68,1460 1112.99,1416.07 1115.3,1525.48 1117.6,1415.36 1119.91,1339.05 1122.22,1441.22 1124.53,1559.98 1126.84,1494.65 1129.14,1513.62 1131.45,1456.45 1133.76,1215.77 1136.07,1394.12 1138.37,1494.03 1140.68,1507.36 1142.99,1437.21 1145.3,1450.26 1147.61,1270.18 1149.91,1442.51 1152.22,1402.74 1154.53,1465.95 1156.84,1255.05 1159.15,1381.69 1161.45,1388.89 1163.76,1604.55 1166.07,1367.16 1168.38,1460.93 1170.69,1450.9 1172.99,1317.52 1175.3,1297.72 1177.61,1388.52 1179.92,1350.15 1182.23,1492.76 1184.53,1492.17 1186.84,1690.07 1189.15,1393.54 1191.46,1474.01 1193.76,1249.04 1196.07,1485.77 1198.38,1340.55 1200.69,1435.03 1203,1534.62 1205.3,1351.9 1207.61,1288.24 1209.92,1509.58 1212.23,1328.81 1214.54,1360.02 1216.84,1438.19 1219.15,1505.34 1221.46,1468.88 1223.77,1234.23 1226.08,1542.7 1228.38,1377.65 1230.69,1395.99 1233,1380.74 1235.31,1460.83 1237.61,1586.93 1239.92,1413.19 1242.23,1492.83 1244.54,1514.66 1246.85,1535.55 1249.15,1448.58 1251.46,1428.52 1253.77,1662.98 1256.08,1308.44 1258.39,1530.28 1260.69,1451.98 1263,1368.01 1265.31,1417.66 1267.62,1369.53 1269.93,1512.35 1272.23,1523.25 1274.54,1583.02 1276.85,1458.26 1279.16,1516.7 1281.47,1422.9 1283.77,1476.7 1286.08,1450.04 1288.39,1422.04 1290.7,1396.29 1293,1605.86 1295.31,1314.14 1297.62,1338.74 1299.93,1389.89 1302.24,1499.51 1304.54,1190.23 1306.85,1433.93 1309.16,1592.47 1311.47,1443.02 1313.78,1350.81 1316.08,1631.31 1318.39,1376.32 1320.7,1202.38 1323.01,1637.2 1325.32,1446.26 1327.62,1286.28 1329.93,1398.25 1332.24,1295.39 1334.55,1432.08 1336.86,1419.78 1339.16,1327.53 1341.47,1316.81 1343.78,1364.12 1346.09,1361.01 1348.39,1402.22 1350.7,1542.85 1353.01,1371.22 1355.32,1492.02 1357.63,1475.88 1359.93,1560.34 1362.24,1342.71 1364.55,1527.99 1366.86,1538.36 1369.17,1618.63 1371.47,1399.41 1373.78,1378.94 1376.09,1424.67 1378.4,1379.16 1380.71,1372.67 1383.01,1369.95 1385.32,1459.54 1387.63,1452.33 1389.94,1449.15 1392.24,1336.88 1394.55,1515.73 1396.86,1440.21 1399.17,1463.52 1401.48,1429.8 1403.78,1452.94 1406.09,1442.7 1408.4,1484.71 1410.71,1457.59 1413.02,1354.62 1415.32,1397.41 1417.63,1488.54 1419.94,1548.56 1422.25,1552.01 1424.56,1523 1426.86,1456.77 1429.17,1369.86 1431.48,1235.63 1433.79,1327.32 1436.1,1530.85 1438.4,1513.11 1440.71,1330.29 1443.02,1247.6 1445.33,1552.5 1447.63,1408.7 1449.94,1296.08 1452.25,1337.89 1454.56,1373.32 1456.87,1459.01 1459.17,1514.86 1461.48,1263.16 1463.79,1494.02 1466.1,1377.65 1468.41,1421.56 1470.71,1312.43 1473.02,1280.38 1475.33,1491.79 1477.64,1406.72 1479.95,1472.63 1482.25,1289.62 1484.56,1393.91 1486.87,1448.36 1489.18,1365.13 1491.49,1467.36 1493.79,1453.52 1496.1,1479.86 1498.41,1388.46 1500.72,1532.28 1503.02,1493.06 1505.33,1452.45 1507.64,1347.2 1509.95,1582.72 1512.26,1531.96 1514.56,1376.71 1516.87,1493.81 1519.18,1257.99 1521.49,1471.69 1523.8,1488.83 1526.1,1461.8 1528.41,1397.49 1530.72,1473.97 1533.03,1709.65 1535.34,1350.3 1537.64,1599.51 1539.95,1246.45 1542.26,1383.51 1544.57,1506.2 1546.88,1451.1 1549.18,1282.74 1551.49,1435.17 1553.8,1360.53 1556.11,1393.02 1558.41,1338.09 1560.72,1352.19 1563.03,1255.06 1565.34,1489.65 1567.65,1556.17 1569.95,1518.47 1572.26,1396.1 1574.57,1336.68 1576.88,1377.63 1579.19,1476.6 1581.49,1509.53 1583.8,1396.56 1586.11,1331.62 1588.42,1580.14 1590.73,1504.43 1593.03,1646.07 1595.34,1502.48 1597.65,1664.43 1599.96,1419.58 1602.26,1464.46 1604.57,1454.83 1606.88,1397.59 1609.19,1438.17 1611.5,1307.9 1613.8,1486.38 1616.11,1506.41 1618.42,1401.6 1620.73,1533.22 1623.04,1488.06 1625.34,1329.41 1627.65,1398.69 1629.96,1492.47 1632.27,1263.8 1634.58,1431.03 1636.88,1432.27 1639.19,1452.31 1641.5,1369.3 1643.81,1396.78 1646.12,1568.41 1648.42,1563.57 1650.73,1356.11 1653.04,1477.9 1655.35,1464.75 1657.65,1454.73 1659.96,1597.33 1662.27,1266.71 1664.58,1401.25 1666.89,1486.72 1669.19,1493.52 1671.5,1571.32 1673.81,1269.46 1676.12,1306.02 1678.43,1396.6 1680.73,1278.17 1683.04,1470.71 1685.35,1456.59 1687.66,1475.94 1689.97,1296.71 1692.27,1509.91 1694.58,1300.75 1696.89,1382.85 1699.2,1363.1 1701.51,1443.5 1703.81,1415.71 1706.12,1490.72 1708.43,1372.38 1710.74,1536.65 1713.04,1289.87 1715.35,1429.92 1717.66,1296 1719.97,1409.07 1722.28,1716.61 1724.58,1297.48 1726.89,1366.69 1729.2,1379.29 1731.51,1492.69 1733.82,1442.24 1736.12,1392.51 1738.43,1298.03 1740.74,1526.03 1743.05,1436.31 1745.36,1453.5 1747.66,1388.74 1749.97,1419.96 1752.28,1572.32 1754.59,1454.69 1756.9,1415.28 1759.2,1597.24 1761.51,1375.44 1763.82,1396.41 1766.13,1476.14 1768.43,1442.05 1770.74,1340.88 1773.05,1449.25 1775.36,1262.36 1777.67,1320.82 1779.97,1435.98 1782.28,1554.22 1784.59,1497.73 1786.9,1530.75 1789.21,1523.83 1791.51,1487.09 1793.82,1416.3 1796.13,1414.94 1798.44,1459.68 1800.75,1476.4 1803.05,1395.32 1805.36,1209.92 1807.67,1455.42 1809.98,1460.78 1812.28,1343.82 1814.59,1355.52 1816.9,1426.18 1819.21,1524.44 1821.52,1502.97 1823.82,1527.11 1826.13,1425.47 1828.44,1393 1830.75,1321.83 1833.06,1432.25 1835.36,1576.23 1837.67,1248.2 1839.98,1427.96 1842.29,1395.6 1844.6,1442.02 1846.9,1484.04 1849.21,1469.21 1851.52,1465.46 1853.83,1422.24 1856.14,1550.56 1858.44,1490.52 1860.75,1464.62 1863.06,1536.98 1865.37,1405.92 1867.67,1475.58 1869.98,1487.32 1872.29,1470.94 1874.6,1444.97 1876.91,1328.19 1879.21,1436.94 1881.52,1510.38 1883.83,1236.4 1886.14,1418.6 1888.45,1360.63 1890.75,1481.09 1893.06,1455.6 1895.37,1449.99 1897.68,1502.82 1899.99,1450.24 1902.29,1249.09 1904.6,1390.13 1906.91,1319.51 1909.22,1335.77 1911.53,1321.07 1913.83,1608.98 1916.14,1422.1 1918.45,1210.35 1920.76,1442.76 1923.06,1407.74 1925.37,1534.93 1927.68,1516.56 1929.99,1384.88 1932.3,1431.6 1934.6,1418.06 1936.91,1500.86 1939.22,1251.77 1941.53,1678.32 1943.84,1398.21 1946.14,1417.17 1948.45,1286.39 1950.76,1357.49 1953.07,1260.16 1955.38,1545.48 1957.68,1371.86 1959.99,1512.02 1962.3,1347.79 1964.61,1410.78 1966.91,1433.21 1969.22,1434.99 1971.53,1330.27 1973.84,1253.4 1976.15,1506.85 1978.45,1227.03 1980.76,1332.27 1983.07,1598.94 1985.38,1406.28 1987.69,1434.91 1989.99,1472.36 1992.3,1508.77 1994.61,1450.39 1996.92,1474.77 1999.23,1389.91 2001.53,1305.29 2003.84,1404.74 2006.15,1211.69 2008.46,1347.49 2010.77,1310.91 2013.07,1468.52 2015.38,1452.93 2017.69,1394.35 2020,1444.03 2022.3,1428.54 2024.61,1495.76 2026.92,1342.67 2029.23,1397.37 2031.54,1423.28 2033.84,1431.95 2036.15,1513.08 2038.46,1429.55 2040.77,1443.8 2043.08,1213.2 2045.38,1600.22 2047.69,1373.07 2050,1564.18 2052.31,1458.18 2054.62,1518.08 2056.92,1329.68 2059.23,1299.18 2061.54,1448.79 2063.85,1275.78 2066.16,1585 2068.46,1316.29 2070.77,1207.01 2073.08,1490.84 2075.39,1430.85 2077.69,1672.92 2080,1359.17 2082.31,1555.16 2084.62,1490.55 2086.93,1382.71 2089.23,1479.76 2091.54,1491.26 2093.85,1456.53 2096.16,1334.34 2098.47,1502.32 2100.77,1481.49 2103.08,1555.35 2105.39,1341.64 2107.7,1318.46 2110.01,1431.91 2112.31,1407.71 2114.62,1525.65 2116.93,1497.5 2119.24,1388.16 2121.55,1481.47 2123.85,1350.5 2126.16,1415.99 2128.47,1751.15 2130.78,1372.3 2133.08,1630.11 2135.39,1289.23 2137.7,1527.55 2140.01,1497.23 2142.32,1430.82 2144.62,1349.69 2146.93,1407.68 2149.24,1334.3 2151.55,1477.82 2153.86,1451.8 2156.16,1366.25 2158.47,1514.16 2160.78,1501.43 2163.09,1339.38 2165.4,1420.29 2167.7,1461.35 2170.01,1426.42 2172.32,1333.97 2174.63,1456.48 2176.93,1323.86 2179.24,1525.87 2181.55,1542.32 2183.86,1293.59 2186.17,1318.74 2188.47,1367.62 2190.78,1299.5 2193.09,1406.15 2195.4,1402.24 2197.71,1336.58 2200.01,1511.61 2202.32,1357.4 2204.63,1397.35 2206.94,1408.64 2209.25,1345.38 2211.55,1575.93 2213.86,1464.24 2216.17,1423.22 2218.48,1411.34 2220.79,1452.86 2223.09,1477.95 2225.4,1500.26 2227.71,1546.19 2230.02,1495.69 2232.32,1535.53 2234.63,1506.14 2236.94,1356.88 2239.25,1397.14 2241.56,1480.1 2243.86,1284.89 2246.17,1304.16 2248.48,1391.65 2250.79,1557.7 2253.1,1416.36 2255.4,1320.07 2257.71,1682.47 2260.02,1614.3 2262.33,1596.29 2264.64,1300.97 2266.94,1304.51 2269.25,1628.11 2271.56,1307.07 2273.87,1415.29 2276.18,1528.58 2278.48,1379.97 2280.79,1452.88 2283.1,1387.94 2285.41,1400.02 2287.71,1585.96 2290.02,1409.14 2292.33,1483.14 2294.64,1620.48 2296.95,1357.16 2299.25,1558.23 2301.56,1418.41 2303.87,1366.05 2306.18,1513.17 2308.49,1345.15 2310.79,1444.38 2313.1,1471.68 2315.41,1428.71 2317.72,1465.03 2320.03,1415.16 2322.33,1354.39 2324.64,1335.34 2326.95,1492.27 2329.26,1434.15 2331.56,1496.9 2333.87,1242.35 2336.18,1561.86 2338.49,1582.86 2340.8,1376.98 2343.1,1359.6 2345.41,1537.64 2347.72,1504.03 2350.03,1569.61 2352.34,1419.09 2354.64,1522.06 2356.95,1535.2 2359.26,1418.27 2361.57,1252.81 2363.88,1324.72 2366.18,1540.22 2368.49,1243.22 2370.8,1255.77 2373.11,1450.38 2375.42,1345.52 2377.72,1444.83 2380.03,1533.52 2382.34,1500.45 2384.65,1560.01 2386.95,1414.61 2389.26,1361.77 2391.57,1390.62 2393.88,1416.23 2396.19,1320.54 2398.49,1378.76 2400.8,1508.79 2403.11,1413.1 2405.42,1604.81 2407.73,1503.38 2410.03,1549.39 2412.34,1435.86 2414.65,1491.71 2416.96,1562.24 2419.27,1328.44 2421.57,1423.51 2423.88,1565.33 2426.19,1585.35 2428.5,1589.57 2430.81,1187.87 2433.11,1514.97 2435.42,1395.5 2437.73,1463.01 2440.04,1552.23 2442.34,1373.58 2444.65,1514.67 2446.96,1293.01 2449.27,1457.63 2451.58,1461.5 2453.88,1535.72 2456.19,1534.69 2458.5,1520.79 2460.81,1389.23 2463.12,1517.72 2465.42,1472.25 2467.73,1295.41 2470.04,1603.03 2472.35,1316.35 2474.66,1323.71 2476.96,1591.93 2479.27,1399.24 2481.58,1531.08 2483.89,1370.02 2486.2,1335.41 2488.5,1399.7 2490.81,1368.15 2493.12,1506.41 2495.43,1740.43 2497.73,1443.11 2500.04,1399.28 2502.35,1391.52 2504.66,1563.05 2506.97,1359.76 2509.27,1438.34 2511.58,1426.94 2513.89,1453.28 2516.2,1553.04 2518.51,1319.14 2520.81,1219.3 2523.12,1419.42 2525.43,1502.61 2527.74,1469.06 2530.05,1521.84 2532.35,1347.16 2534.66,1343.22 2536.97,1401.02 2539.28,1480.46 2541.58,1344.68 2543.89,1364.95 2546.2,1542.54 2548.51,1365.09 2550.82,1557.85 2553.12,1518.98 2555.43,1418.97 2557.74,1479.26 2560.05,1461.84 2562.36,1537.09 2564.66,1617.91 2566.97,1555.08 2569.28,1302.91 2571.59,1425.98 "></polyline>
<polyline clip-path="url(#clip762)" style="stroke:#e26f46; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="265.984,940.934 268.292,960.525 270.6,846.232 272.908,996.088 275.216,988.738 277.524,920.526 279.832,933.673 282.139,926.417 284.447,868.591 286.755,969.908 289.063,905.907 291.371,1098.86 293.679,852.674 295.987,972.183 298.295,939.298 300.603,1101.38 302.911,893.067 305.219,1005.48 307.527,912.74 309.834,964.794 312.142,984.052 314.45,994.951 316.758,1032.03 319.066,857.027 321.374,739.069 323.682,891.829 325.99,1056.27 328.298,1073.75 330.606,994.193 332.914,957.775 335.221,1026.39 337.529,946.296 339.837,942.326 342.145,865.355 344.453,1118.08 346.761,924.849 349.069,1006.27 351.377,942.941 353.685,990.723 355.993,949.142 358.301,807.105 360.608,898.296 362.916,897.313 365.224,909.833 367.532,923.603 369.84,789.724 372.148,938.501 374.456,955.969 376.764,1098.94 379.072,995.046 381.38,807.95 383.688,948.046 385.996,769.971 388.303,1061.58 390.611,884.579 392.919,1020.75 395.227,1025.91 397.535,857.935 399.843,919.173 402.151,1043.42 404.459,948.064 406.767,908.119 409.075,918.388 411.383,972.89 413.69,969.244 415.998,1043.2 418.306,808.036 420.614,921.404 422.922,928.821 425.23,873.017 427.538,950.705 429.846,966.009 432.154,946.308 434.462,1112.74 436.77,899.108 439.077,989.683 441.385,794.245 443.693,869.248 446.001,848.583 448.309,752.177 450.617,939.147 452.925,1092.1 455.233,909.402 457.541,804.727 459.849,1031 462.157,878.576 464.465,1004.09 466.772,981.469 469.08,1024.38 471.388,886.068 473.696,844.605 476.004,976.283 478.312,1090.2 480.62,853.417 482.928,1006.59 485.236,893.646 487.544,858.19 489.852,1025.32 492.159,884 494.467,1103.13 496.775,931.256 499.083,874.248 501.391,1131.13 503.699,754.558 506.007,906.502 508.315,1079.85 510.623,1027.55 512.931,1114.39 515.239,895.027 517.546,1015.46 519.854,856.473 522.162,1109.13 524.47,955.842 526.778,873.962 529.086,905.99 531.394,896.753 533.702,953.891 536.01,1050.82 538.318,960.352 540.626,1024.97 542.933,918.68 545.241,955.399 547.549,1024.81 549.857,980.087 552.165,952.886 554.473,1023.64 556.781,944.811 559.089,1014.72 561.397,949.498 563.705,1034.13 566.013,827.977 568.321,858.699 570.628,963.47 572.936,793.429 575.244,929.222 577.552,888.542 579.86,944.103 582.168,1069.99 584.476,909.16 586.784,1010.7 589.092,1131.75 591.4,835.301 593.708,922.905 596.015,923.518 598.323,864.794 600.631,836.519 602.939,1083.83 605.247,854.993 607.555,1016.1 609.863,1034.57 612.171,892.546 614.479,1071.35 616.787,909.22 619.095,762.655 621.402,1033.19 623.71,975.293 626.018,1122.69 628.326,942.707 630.634,983.31 632.942,1184.47 635.25,937.177 637.558,1109.77 639.866,791.575 642.174,966.981 644.482,877.017 646.79,1117.73 649.097,1016.83 651.405,886.286 653.713,993.341 656.021,873.92 658.329,1144.53 660.637,838.366 662.945,855.947 665.253,976.523 667.561,920.09 669.869,1032.78 672.177,1153.78 674.484,972.995 676.792,949.344 679.1,888.683 681.408,906.383 683.716,817.163 686.024,826.356 688.332,968.667 690.64,912.672 692.948,786.612 695.256,859.301 697.564,878.157 699.871,956.898 702.179,1029.49 704.487,906.258 706.795,895.589 709.103,836.215 711.411,1025.45 713.719,925.452 716.027,818.385 718.335,999.313 720.643,1057.9 722.951,975.265 725.259,1079.28 727.566,756.713 729.874,865.202 732.182,1085.76 734.49,722.88 736.798,897.819 739.106,1056.94 741.414,814.125 743.722,919.863 746.03,918.949 748.338,984.05 750.646,1129.05 752.953,1050.7 755.261,1124.37 757.569,1107.77 759.877,1162.93 762.185,775.405 764.493,965.641 766.801,1035.57 769.109,961.058 771.417,883.82 773.725,1129.38 776.033,864.882 778.34,1007.03 780.648,1053.65 782.956,1226.51 785.264,819.505 787.572,911.62 789.88,915.489 792.188,982.665 794.496,945.334 796.804,975.269 799.112,977.004 801.42,1023.86 803.728,926.584 806.035,748.326 808.343,856.761 810.651,893.373 812.959,845.925 815.267,793.177 817.575,869.83 819.883,1000.75 822.191,993.17 824.499,1022.34 826.807,990.655 829.115,848.105 831.422,968.077 833.73,891.306 836.038,925.956 838.346,1012.48 840.654,1034.55 842.962,917.267 845.27,886.575 847.578,946.405 849.886,896.12 852.194,1063.94 854.502,848.903 856.809,846.999 859.117,902.988 861.425,1027.2 863.733,884.026 866.041,900.508 868.349,1130 870.657,1052.78 872.965,856.955 875.273,748.823 877.581,973.763 879.889,1042.11 882.197,1022.72 884.504,970.771 886.812,1037.2 889.12,916.139 891.428,909.754 893.736,960.686 896.044,709.478 898.352,925.916 900.66,959.674 902.968,1038.07 905.276,829.53 907.584,930.367 909.891,899.644 912.199,1051.48 914.507,834.764 916.815,867.045 919.123,808.697 921.431,952.281 923.739,1071.07 926.047,905.31 928.355,953.263 930.663,970.582 932.971,922.529 935.278,963.397 937.586,802.804 939.894,1044.08 942.202,847.755 944.51,1066.95 946.818,1067.27 949.126,912.265 951.434,907.314 953.742,1069.67 956.05,1004.87 958.358,919.846 960.665,1013.94 962.973,872.968 965.281,762.167 967.589,989.557 969.897,1132.33 972.205,958.659 974.513,1053.35 976.821,931.41 979.129,766.591 981.437,1034.73 983.745,1030.67 986.053,1058.23 988.36,939.389 990.668,1070.97 992.976,962.48 995.284,773.464 997.592,880.434 999.9,902.517 1002.21,897.146 1004.52,756.262 1006.82,1054.58 1009.13,1007.17 1011.44,993.37 1013.75,1046.13 1016.06,876.708 1018.36,766.937 1020.67,833.714 1022.98,923.834 1025.29,832.249 1027.59,895.029 1029.9,915.484 1032.21,915.387 1034.52,1165.9 1036.83,799.829 1039.13,945.38 1041.44,882.223 1043.75,988.154 1046.06,919.265 1048.37,976.919 1050.67,1056.56 1052.98,936.424 1055.29,1048.86 1057.6,891.717 1059.91,1116.69 1062.21,1149.82 1064.52,931.823 1066.83,832.351 1069.14,902.279 1071.45,946.717 1073.75,1054.56 1076.06,893.897 1078.37,1166.69 1080.68,931.682 1082.98,842.605 1085.29,964.881 1087.6,910.667 1089.91,988.116 1092.22,1005 1094.52,993.681 1096.83,975.647 1099.14,937.535 1101.45,912.311 1103.76,882.585 1106.06,903.899 1108.37,1045.74 1110.68,843.183 1112.99,814.557 1115.3,882.747 1117.6,809.504 1119.91,983.519 1122.22,947.756 1124.53,948.718 1126.84,972.359 1129.14,1000.62 1131.45,849.404 1133.76,856.771 1136.07,939.172 1138.37,850.298 1140.68,843.374 1142.99,972.527 1145.3,1002.12 1147.61,965.76 1149.91,879.81 1152.22,990.267 1154.53,994.129 1156.84,998.519 1159.15,1014.61 1161.45,851.875 1163.76,875.26 1166.07,817.923 1168.38,1108.94 1170.69,744.205 1172.99,1093.88 1175.3,1079.04 1177.61,965.765 1179.92,851.56 1182.23,1042.94 1184.53,836.232 1186.84,1091.67 1189.15,928.228 1191.46,950.935 1193.76,974.134 1196.07,895.411 1198.38,963.31 1200.69,916.758 1203,1060.56 1205.3,997.214 1207.61,1030.41 1209.92,940.984 1212.23,981.621 1214.54,954.32 1216.84,681.432 1219.15,853.305 1221.46,866.269 1223.77,839.651 1226.08,1159.51 1228.38,809.97 1230.69,935.117 1233,919.944 1235.31,1037.09 1237.61,1047.05 1239.92,950.504 1242.23,859.768 1244.54,811.857 1246.85,1115.27 1249.15,941.03 1251.46,1104.35 1253.77,854.793 1256.08,906.799 1258.39,1000.96 1260.69,974.135 1263,881.93 1265.31,794.107 1267.62,935.407 1269.93,846.67 1272.23,924.641 1274.54,1048.44 1276.85,845.835 1279.16,938.161 1281.47,801.236 1283.77,989.145 1286.08,833.159 1288.39,868.647 1290.7,968.209 1293,809.206 1295.31,1097.81 1297.62,997.712 1299.93,995.792 1302.24,790.141 1304.54,1037.17 1306.85,860.298 1309.16,973.496 1311.47,909.112 1313.78,831.376 1316.08,831.194 1318.39,889.987 1320.7,813.15 1323.01,1066.91 1325.32,865.956 1327.62,931.466 1329.93,876.54 1332.24,972.809 1334.55,789.552 1336.86,999.236 1339.16,1041.76 1341.47,957.474 1343.78,848.575 1346.09,960.53 1348.39,972.705 1350.7,947.48 1353.01,1065.16 1355.32,978.813 1357.63,792.369 1359.93,1142.17 1362.24,757.57 1364.55,958.261 1366.86,1134.94 1369.17,993.895 1371.47,1110.01 1373.78,1043.46 1376.09,791.973 1378.4,1019.05 1380.71,830.048 1383.01,887.469 1385.32,826.923 1387.63,927.382 1389.94,906.687 1392.24,1129.51 1394.55,1066.02 1396.86,900.696 1399.17,1023.29 1401.48,1066.43 1403.78,1055.06 1406.09,1043.1 1408.4,1009.02 1410.71,989.74 1413.02,1069.83 1415.32,1102.74 1417.63,968.917 1419.94,856.902 1422.25,937.629 1424.56,1028.11 1426.86,795.196 1429.17,1020.36 1431.48,749.204 1433.79,911.361 1436.1,820.362 1438.4,832.183 1440.71,1035.76 1443.02,1104.73 1445.33,998.668 1447.63,1012.84 1449.94,963.816 1452.25,1018.25 1454.56,1039.51 1456.87,1077.95 1459.17,952.909 1461.48,956.621 1463.79,897.736 1466.1,809.711 1468.41,960.269 1470.71,954.017 1473.02,990.969 1475.33,992.378 1477.64,948.745 1479.95,1052.1 1482.25,1140.33 1484.56,1120.7 1486.87,1017.31 1489.18,1019.25 1491.49,725.81 1493.79,942.689 1496.1,1083.44 1498.41,1160.15 1500.72,1046.95 1503.02,1025.47 1505.33,977.843 1507.64,1076.79 1509.95,889.327 1512.26,1077.99 1514.56,875.387 1516.87,954.641 1519.18,980.723 1521.49,961.761 1523.8,946.93 1526.1,785.909 1528.41,891.185 1530.72,1010.42 1533.03,974.801 1535.34,1026.92 1537.64,996.902 1539.95,1040.84 1542.26,863.896 1544.57,862.076 1546.88,889.698 1549.18,1010.74 1551.49,958.968 1553.8,1026.85 1556.11,764.495 1558.41,911.189 1560.72,931.587 1563.03,976.137 1565.34,1032.88 1567.65,890.046 1569.95,929.862 1572.26,793.339 1574.57,782.172 1576.88,988.539 1579.19,997.682 1581.49,1131.35 1583.8,1044.32 1586.11,879.617 1588.42,981.837 1590.73,997.1 1593.03,835.468 1595.34,922.854 1597.65,1038.92 1599.96,934.298 1602.26,1072.86 1604.57,788.597 1606.88,1052.7 1609.19,878.704 1611.5,944.456 1613.8,893.774 1616.11,758.719 1618.42,1049.58 1620.73,965.954 1623.04,809.62 1625.34,1016.73 1627.65,1068.94 1629.96,865.332 1632.27,865.436 1634.58,939.306 1636.88,899.175 1639.19,992.993 1641.5,1052.6 1643.81,976.278 1646.12,987.409 1648.42,981.353 1650.73,871.659 1653.04,816.668 1655.35,1030.9 1657.65,1048.29 1659.96,813.33 1662.27,1034.17 1664.58,927.48 1666.89,747.795 1669.19,882.707 1671.5,934.328 1673.81,979.797 1676.12,916.304 1678.43,944.237 1680.73,850.844 1683.04,1055.02 1685.35,929.124 1687.66,970.777 1689.97,963.39 1692.27,858.263 1694.58,1121.57 1696.89,1071.75 1699.2,835.105 1701.51,1017.23 1703.81,1038.56 1706.12,1037.44 1708.43,1012.76 1710.74,829.578 1713.04,975.856 1715.35,993.387 1717.66,1044.28 1719.97,893.281 1722.28,1110.21 1724.58,1059.54 1726.89,933.345 1729.2,973.896 1731.51,891.995 1733.82,963.31 1736.12,891.86 1738.43,865.119 1740.74,983.063 1743.05,1051.77 1745.36,855.901 1747.66,990.867 1749.97,965.99 1752.28,912.832 1754.59,1025.08 1756.9,708.601 1759.2,933.329 1761.51,896.247 1763.82,897.102 1766.13,903.425 1768.43,970.625 1770.74,816.671 1773.05,890.281 1775.36,857.512 1777.67,728.441 1779.97,823.689 1782.28,1056.99 1784.59,906.318 1786.9,958.468 1789.21,920.271 1791.51,947.436 1793.82,912.74 1796.13,1038.27 1798.44,919.61 1800.75,1025.2 1803.05,1041.62 1805.36,1204.58 1807.67,787.443 1809.98,986.324 1812.28,931.195 1814.59,837.859 1816.9,1139.28 1819.21,1092.47 1821.52,753.018 1823.82,1025.69 1826.13,873.437 1828.44,1041.43 1830.75,978.684 1833.06,949.623 1835.36,1001.23 1837.67,886.711 1839.98,1043.75 1842.29,779.599 1844.6,926.298 1846.9,978.941 1849.21,999.576 1851.52,932.422 1853.83,880.459 1856.14,918.002 1858.44,837.751 1860.75,947.116 1863.06,1087.26 1865.37,700.719 1867.67,942.962 1869.98,1014.62 1872.29,806.623 1874.6,1117.48 1876.91,1002.99 1879.21,870.548 1881.52,790.859 1883.83,1036.6 1886.14,1142.94 1888.45,921.483 1890.75,915.17 1893.06,1016.03 1895.37,846.924 1897.68,862.661 1899.99,1152.26 1902.29,1012.32 1904.6,871.602 1906.91,961.896 1909.22,864.199 1911.53,1078.2 1913.83,1033.66 1916.14,926.543 1918.45,940.012 1920.76,1029.25 1923.06,984.009 1925.37,867.997 1927.68,1141.25 1929.99,1059.42 1932.3,1017.27 1934.6,991.926 1936.91,957.733 1939.22,903.268 1941.53,837.83 1943.84,946.967 1946.14,926.266 1948.45,1087.44 1950.76,998.974 1953.07,967.868 1955.38,898.903 1957.68,984.223 1959.99,1073.03 1962.3,1098.59 1964.61,893.652 1966.91,983.4 1969.22,986.303 1971.53,1027.15 1973.84,830.984 1976.15,968.4 1978.45,958.274 1980.76,894.384 1983.07,858.233 1985.38,802.112 1987.69,858.669 1989.99,1037.54 1992.3,1046 1994.61,1037.9 1996.92,809.913 1999.23,770.334 2001.53,979.187 2003.84,1069.62 2006.15,867.129 2008.46,1136.59 2010.77,960.424 2013.07,980.588 2015.38,988.292 2017.69,946.982 2020,1083.82 2022.3,870.792 2024.61,880.785 2026.92,1033.84 2029.23,907.427 2031.54,832.385 2033.84,817.083 2036.15,934.23 2038.46,853.195 2040.77,920.82 2043.08,872.08 2045.38,933.565 2047.69,936.079 2050,977.847 2052.31,964.807 2054.62,904.282 2056.92,973.289 2059.23,858.61 2061.54,932.06 2063.85,859.101 2066.16,935.261 2068.46,837.127 2070.77,982.692 2073.08,957.603 2075.39,982.954 2077.69,879.864 2080,869.448 2082.31,855.956 2084.62,854.491 2086.93,854.055 2089.23,1014.45 2091.54,841.215 2093.85,1025.34 2096.16,957.186 2098.47,852.53 2100.77,879.167 2103.08,908.824 2105.39,985.82 2107.7,869.953 2110.01,1052.65 2112.31,988.474 2114.62,831.242 2116.93,918.943 2119.24,838.692 2121.55,1050.91 2123.85,1066.35 2126.16,706.576 2128.47,1101.08 2130.78,1016.93 2133.08,961.955 2135.39,917.345 2137.7,887.36 2140.01,904.449 2142.32,977.041 2144.62,928.486 2146.93,1219.24 2149.24,1002.97 2151.55,859.417 2153.86,830.262 2156.16,899.752 2158.47,980.25 2160.78,948.511 2163.09,887.809 2165.4,1178.61 2167.7,828.295 2170.01,1054.99 2172.32,1031.63 2174.63,972.156 2176.93,878.044 2179.24,983.361 2181.55,1073.27 2183.86,918.951 2186.17,1007.96 2188.47,868.271 2190.78,773.178 2193.09,812.428 2195.4,1014.92 2197.71,860.665 2200.01,764.519 2202.32,962.725 2204.63,946.854 2206.94,888.253 2209.25,853.291 2211.55,1005.37 2213.86,831.558 2216.17,1084.98 2218.48,897.684 2220.79,939.047 2223.09,913.994 2225.4,1055.88 2227.71,928.925 2230.02,963.596 2232.32,894.347 2234.63,836.386 2236.94,1018.86 2239.25,801.702 2241.56,942.108 2243.86,909.373 2246.17,911.159 2248.48,1016.52 2250.79,877.738 2253.1,936.389 2255.4,852.754 2257.71,916.415 2260.02,1015.58 2262.33,890.605 2264.64,949.275 2266.94,875.898 2269.25,788.661 2271.56,924.281 2273.87,894.642 2276.18,784.229 2278.48,1063.21 2280.79,898.635 2283.1,883.879 2285.41,808.094 2287.71,866.997 2290.02,982.731 2292.33,964.274 2294.64,791.589 2296.95,839.887 2299.25,985.452 2301.56,946.347 2303.87,741.756 2306.18,1012.7 2308.49,1028.33 2310.79,863.241 2313.1,965.397 2315.41,841.036 2317.72,856.676 2320.03,1142.47 2322.33,901.126 2324.64,1016.15 2326.95,899.054 2329.26,1240.58 2331.56,886.421 2333.87,948.841 2336.18,911.679 2338.49,719.782 2340.8,858.617 2343.1,996.208 2345.41,980.918 2347.72,983.703 2350.03,930.597 2352.34,1053.32 2354.64,910.589 2356.95,912.383 2359.26,926.235 2361.57,1051.98 2363.88,824.258 2366.18,905.893 2368.49,1024.55 2370.8,1011.38 2373.11,892.707 2375.42,1124.09 2377.72,761.112 2380.03,840.275 2382.34,880.496 2384.65,879.649 2386.95,918.007 2389.26,843.046 2391.57,836.586 2393.88,1096.27 2396.19,1025.8 2398.49,903.843 2400.8,991.355 2403.11,1019.11 2405.42,970.399 2407.73,1005.98 2410.03,705.962 2412.34,1068.34 2414.65,993.238 2416.96,1143.29 2419.27,1071.63 2421.57,834.944 2423.88,1141.95 2426.19,886.495 2428.5,983.425 2430.81,909.731 2433.11,996.036 2435.42,966.974 2437.73,859.104 2440.04,944.124 2442.34,806.253 2444.65,876.158 2446.96,1041.58 2449.27,975.602 2451.58,874.57 2453.88,1131.31 2456.19,895.577 2458.5,1003.93 2460.81,1034.16 2463.12,840.016 2465.42,942.49 2467.73,1012.87 2470.04,838.702 2472.35,977.698 2474.66,933.927 2476.96,982.372 2479.27,968.806 2481.58,1014.45 2483.89,1002.46 2486.2,910.081 2488.5,1096.96 2490.81,1086.12 2493.12,721.773 2495.43,909.092 2497.73,961.926 2500.04,977.488 2502.35,900.936 2504.66,937.152 2506.97,989.213 2509.27,766.625 2511.58,946.425 2513.89,997.496 2516.2,1041.52 2518.51,824.52 2520.81,659.072 2523.12,863.171 2525.43,880.098 2527.74,903.293 2530.05,962.876 2532.35,896.692 2534.66,900.98 2536.97,913.58 2539.28,1024.11 2541.58,657.832 2543.89,1147.47 2546.2,1039.5 2548.51,949.092 2550.82,1008.09 2553.12,963.808 2555.43,1029.78 2557.74,1057.47 2560.05,1024.75 2562.36,1009.51 2564.66,993.896 2566.97,1073.31 2569.28,954.997 2571.59,1006.74 "></polyline>
<polyline clip-path="url(#clip762)" style="stroke:#3da44d; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="265.984,708.425 268.292,456.249 270.6,304.393 272.908,395.955 275.216,514.553 277.524,501.759 279.832,564.817 282.139,391.329 284.447,403.223 286.755,398.607 289.063,485.1 291.371,501.459 293.679,647.556 295.987,476.758 298.295,430.401 300.603,600.368 302.911,410.247 305.219,560.315 307.527,508.997 309.834,434.994 312.142,544.968 314.45,577.93 316.758,376.454 319.066,632.968 321.374,557.465 323.682,514.04 325.99,503.033 328.298,295.806 330.606,405.378 332.914,341.829 335.221,475.878 337.529,493.654 339.837,316.892 342.145,560.786 344.453,639.489 346.761,560.307 349.069,557.084 351.377,486.313 353.685,634.602 355.993,474.166 358.301,535.832 360.608,382.416 362.916,480.075 365.224,602.232 367.532,268.371 369.84,415.801 372.148,472.998 374.456,543.604 376.764,463.204 379.072,448.414 381.38,360.987 383.688,561.278 385.996,318.588 388.303,459.748 390.611,538.701 392.919,607.951 395.227,383.806 397.535,347.276 399.843,547.717 402.151,413.895 404.459,479.657 406.767,570.639 409.075,335.027 411.383,427.712 413.69,593.179 415.998,636.387 418.306,323.637 420.614,515.38 422.922,420.627 425.23,384.29 427.538,532.774 429.846,375.733 432.154,476.799 434.462,421.174 436.77,278.628 439.077,419.098 441.385,475.309 443.693,366.67 446.001,469.789 448.309,355.294 450.617,446.115 452.925,250.784 455.233,453.537 457.541,505.63 459.849,512.937 462.157,329.868 464.465,523.36 466.772,427.647 469.08,401.907 471.388,619.866 473.696,375.723 476.004,329.362 478.312,498.388 480.62,521.393 482.928,372.26 485.236,477.924 487.544,574.467 489.852,352.715 492.159,542.092 494.467,554.952 496.775,406.17 499.083,418.34 501.391,547.318 503.699,248.846 506.007,298.565 508.315,499.49 510.623,490.112 512.931,545.038 515.239,343.559 517.546,534.789 519.854,553.046 522.162,538.455 524.47,337.82 526.778,464.811 529.086,547.942 531.394,363.399 533.702,425.408 536.01,333.578 538.318,448.889 540.626,466.321 542.933,370.871 545.241,325.007 547.549,583.668 549.857,315.881 552.165,504.449 554.473,436.959 556.781,540.526 559.089,587.269 561.397,426.519 563.705,640.414 566.013,412.066 568.321,418.318 570.628,660.165 572.936,437.325 575.244,675.69 577.552,367.132 579.86,513.066 582.168,504.356 584.476,437.427 586.784,433.583 589.092,380.441 591.4,408.996 593.708,592.169 596.015,548.609 598.323,475.548 600.631,422.239 602.939,627.749 605.247,352.14 607.555,550.015 609.863,459.831 612.171,438.318 614.479,441.113 616.787,431.863 619.095,373.778 621.402,520.441 623.71,520.141 626.018,286.039 628.326,577.451 630.634,427.084 632.942,455.05 635.25,427.082 637.558,528.615 639.866,436.998 642.174,609.367 644.482,461.986 646.79,615.904 649.097,367.458 651.405,502.44 653.713,504.847 656.021,489.773 658.329,417.293 660.637,513.951 662.945,455.008 665.253,249.582 667.561,257.929 669.869,451.556 672.177,404.655 674.484,445.429 676.792,621.436 679.1,342.779 681.408,352.898 683.716,425.467 686.024,454.126 688.332,643.002 690.64,547.839 692.948,469.755 695.256,671.029 697.564,485.703 699.871,619.754 702.179,230.174 704.487,646.331 706.795,480.835 709.103,363.979 711.411,476.965 713.719,471.997 716.027,512.295 718.335,363.451 720.643,454.69 722.951,620.991 725.259,475.038 727.566,494.156 729.874,217.127 732.182,362.739 734.49,448.839 736.798,384.993 739.106,685.49 741.414,574.223 743.722,588.18 746.03,631.655 748.338,454.478 750.646,422.588 752.953,395.9 755.261,402.93 757.569,577.194 759.877,363.21 762.185,464.507 764.493,412.545 766.801,652.623 769.109,464.384 771.417,650.481 773.725,467.707 776.033,438.411 778.34,188.798 780.648,452.881 782.956,291.499 785.264,353.053 787.572,467.056 789.88,515.257 792.188,294.741 794.496,432.07 796.804,548.302 799.112,253.656 801.42,436.154 803.728,643.639 806.035,363.325 808.343,412.869 810.651,478.867 812.959,560.92 815.267,419.112 817.575,528.652 819.883,407.791 822.191,338.546 824.499,401.2 826.807,505.233 829.115,471.552 831.422,647.64 833.73,593.618 836.038,540.597 838.346,365.305 840.654,312.942 842.962,422.942 845.27,420.864 847.578,484.458 849.886,380.976 852.194,554.076 854.502,546.057 856.809,352.784 859.117,445.804 861.425,650.919 863.733,614.366 866.041,278.629 868.349,383.014 870.657,710.231 872.965,483.454 875.273,410.254 877.581,577.049 879.889,423.508 882.197,559.025 884.504,518.095 886.812,566.393 889.12,354.65 891.428,577.723 893.736,442.954 896.044,582.169 898.352,542.593 900.66,281.352 902.968,451.668 905.276,409.167 907.584,401.872 909.891,376.88 912.199,326.07 914.507,365.721 916.815,392.046 919.123,622.123 921.431,468.145 923.739,422.851 926.047,533.252 928.355,364.292 930.663,344.963 932.971,439.759 935.278,372.331 937.586,375.473 939.894,343.555 942.202,495.227 944.51,357.123 946.818,372.72 949.126,449.318 951.434,484.97 953.742,328.516 956.05,464.662 958.358,498.959 960.665,382.22 962.973,503.813 965.281,410.307 967.589,557.155 969.897,404.854 972.205,463.75 974.513,424.984 976.821,589.09 979.129,284.837 981.437,364.27 983.745,493.787 986.053,628.246 988.36,515.21 990.668,441.357 992.976,454.199 995.284,353.108 997.592,542.95 999.9,366.557 1002.21,352.922 1004.52,460.2 1006.82,579.797 1009.13,409.281 1011.44,482.015 1013.75,564.339 1016.06,426.494 1018.36,559.904 1020.67,487.082 1022.98,551.996 1025.29,489.799 1027.59,400.472 1029.9,559.988 1032.21,516.587 1034.52,424.795 1036.83,306.28 1039.13,455.966 1041.44,379.445 1043.75,426.012 1046.06,454.926 1048.37,525.785 1050.67,552.908 1052.98,375.574 1055.29,443.21 1057.6,448.431 1059.91,476.845 1062.21,435.516 1064.52,511.998 1066.83,443.545 1069.14,527.719 1071.45,291.336 1073.75,471.721 1076.06,522.85 1078.37,626.92 1080.68,368.452 1082.98,381.906 1085.29,540.394 1087.6,484.152 1089.91,504.746 1092.22,364.994 1094.52,554.208 1096.83,500.492 1099.14,536.302 1101.45,465.122 1103.76,410.181 1106.06,437.238 1108.37,504.819 1110.68,517.988 1112.99,420.938 1115.3,593.881 1117.6,371.943 1119.91,378.16 1122.22,321.203 1124.53,326.12 1126.84,339.801 1129.14,497.294 1131.45,423.801 1133.76,329.299 1136.07,691.582 1138.37,441.3 1140.68,711.496 1142.99,366.34 1145.3,446.166 1147.61,410.741 1149.91,373.267 1152.22,489.051 1154.53,476.069 1156.84,498.295 1159.15,478.743 1161.45,408.289 1163.76,426.808 1166.07,279.467 1168.38,486.806 1170.69,405.664 1172.99,500.678 1175.3,532.735 1177.61,595.533 1179.92,415.292 1182.23,546.132 1184.53,447.507 1186.84,513.011 1189.15,512.25 1191.46,507.932 1193.76,324.674 1196.07,429.143 1198.38,454.579 1200.69,361.726 1203,430.282 1205.3,689.907 1207.61,471.581 1209.92,563.783 1212.23,519.646 1214.54,491.891 1216.84,552.568 1219.15,539.181 1221.46,331.247 1223.77,448.167 1226.08,502.729 1228.38,540.671 1230.69,533.78 1233,495.934 1235.31,606.714 1237.61,481.304 1239.92,356.08 1242.23,354.817 1244.54,355.9 1246.85,626.474 1249.15,262.754 1251.46,517.401 1253.77,551.099 1256.08,406.948 1258.39,96.8724 1260.69,292.836 1263,388.092 1265.31,556.157 1267.62,652.289 1269.93,581.524 1272.23,375.355 1274.54,343.556 1276.85,605.307 1279.16,398.783 1281.47,462.553 1283.77,433.935 1286.08,517.837 1288.39,413.329 1290.7,272.192 1293,561.455 1295.31,495.237 1297.62,473.486 1299.93,664.086 1302.24,472.961 1304.54,487.094 1306.85,524.994 1309.16,340.064 1311.47,382.473 1313.78,429.182 1316.08,473.125 1318.39,321.383 1320.7,676.434 1323.01,416.114 1325.32,492.314 1327.62,515.222 1329.93,450.094 1332.24,534.947 1334.55,491.302 1336.86,567.211 1339.16,354.348 1341.47,414.896 1343.78,430.28 1346.09,389.301 1348.39,706.239 1350.7,320.14 1353.01,409.673 1355.32,563.064 1357.63,555.304 1359.93,377.423 1362.24,473.92 1364.55,544.111 1366.86,693.453 1369.17,453.886 1371.47,415 1373.78,520.784 1376.09,478.948 1378.4,536.374 1380.71,390.86 1383.01,416.449 1385.32,407.136 1387.63,523.231 1389.94,401.82 1392.24,569.728 1394.55,641.645 1396.86,431.94 1399.17,458.829 1401.48,620.059 1403.78,326.733 1406.09,489.913 1408.4,498.352 1410.71,444.341 1413.02,499.871 1415.32,713.063 1417.63,710.377 1419.94,375.298 1422.25,386.637 1424.56,418.728 1426.86,425.375 1429.17,485.903 1431.48,491.004 1433.79,549.168 1436.1,397.718 1438.4,550.077 1440.71,578.887 1443.02,537.919 1445.33,521.965 1447.63,465.518 1449.94,313.253 1452.25,391.776 1454.56,674.344 1456.87,379.917 1459.17,412.559 1461.48,396.327 1463.79,510.234 1466.1,288.329 1468.41,452.813 1470.71,456.302 1473.02,520.533 1475.33,413.873 1477.64,529.505 1479.95,296.118 1482.25,493.608 1484.56,434.999 1486.87,384.878 1489.18,354.496 1491.49,397.615 1493.79,512.288 1496.1,509.719 1498.41,234.574 1500.72,400.528 1503.02,505.275 1505.33,376.684 1507.64,458.999 1509.95,524.082 1512.26,524.381 1514.56,590.188 1516.87,348.563 1519.18,542.403 1521.49,496.322 1523.8,521.599 1526.1,403.676 1528.41,516.733 1530.72,328.96 1533.03,461.733 1535.34,350.414 1537.64,573.052 1539.95,445.375 1542.26,476.11 1544.57,388.769 1546.88,365.916 1549.18,420.344 1551.49,591.463 1553.8,467.749 1556.11,442.567 1558.41,503.828 1560.72,668.621 1563.03,405.696 1565.34,361.135 1567.65,446.572 1569.95,467.073 1572.26,508.654 1574.57,325.746 1576.88,399.631 1579.19,603.422 1581.49,336.296 1583.8,589.648 1586.11,389.187 1588.42,550.097 1590.73,173.141 1593.03,355.491 1595.34,620.408 1597.65,330.515 1599.96,524.893 1602.26,421.382 1604.57,470.874 1606.88,621.201 1609.19,495.006 1611.5,403.432 1613.8,498.862 1616.11,462.962 1618.42,403.995 1620.73,229.88 1623.04,526.805 1625.34,367.962 1627.65,475.132 1629.96,465.073 1632.27,436.876 1634.58,275.77 1636.88,344.685 1639.19,649.217 1641.5,604.079 1643.81,538.883 1646.12,508.433 1648.42,444.301 1650.73,305.328 1653.04,551.292 1655.35,286.415 1657.65,400.369 1659.96,466.12 1662.27,516.698 1664.58,608.414 1666.89,415.149 1669.19,584.544 1671.5,596.613 1673.81,405.486 1676.12,465.149 1678.43,336.462 1680.73,488.283 1683.04,407.753 1685.35,439.775 1687.66,589.541 1689.97,445.352 1692.27,481.934 1694.58,371.658 1696.89,502.25 1699.2,449.383 1701.51,581.43 1703.81,460.148 1706.12,417.654 1708.43,454.176 1710.74,497.495 1713.04,448.291 1715.35,508.038 1717.66,453.287 1719.97,647.825 1722.28,613.154 1724.58,650.551 1726.89,493.729 1729.2,238.95 1731.51,503.797 1733.82,467.448 1736.12,439.634 1738.43,427.77 1740.74,564.247 1743.05,524.723 1745.36,504.738 1747.66,471.041 1749.97,468.25 1752.28,387.698 1754.59,490.468 1756.9,440.866 1759.2,519.528 1761.51,417.061 1763.82,584.492 1766.13,508.975 1768.43,562.289 1770.74,317.177 1773.05,601.547 1775.36,265.754 1777.67,356.671 1779.97,521.467 1782.28,427.62 1784.59,211.022 1786.9,576.657 1789.21,476.488 1791.51,378.806 1793.82,427.589 1796.13,387.032 1798.44,642.59 1800.75,384.669 1803.05,525.938 1805.36,403.63 1807.67,249.344 1809.98,393.13 1812.28,282.999 1814.59,401.682 1816.9,279.586 1819.21,429.348 1821.52,398.469 1823.82,418.53 1826.13,500.992 1828.44,509.435 1830.75,549.217 1833.06,425.662 1835.36,652.431 1837.67,533.581 1839.98,595.521 1842.29,408.593 1844.6,469.477 1846.9,452.654 1849.21,318.43 1851.52,322.28 1853.83,368.037 1856.14,368.51 1858.44,735.516 1860.75,426.087 1863.06,304.711 1865.37,620.678 1867.67,510.363 1869.98,509.082 1872.29,531.956 1874.6,486.335 1876.91,483.652 1879.21,482.716 1881.52,345.019 1883.83,361.949 1886.14,502.134 1888.45,464.5 1890.75,387.621 1893.06,412.627 1895.37,434.873 1897.68,441.323 1899.99,412.322 1902.29,317.926 1904.6,392.148 1906.91,506.977 1909.22,472.964 1911.53,482.295 1913.83,423.6 1916.14,448.508 1918.45,533.638 1920.76,426.957 1923.06,256.668 1925.37,506.316 1927.68,419.935 1929.99,466.869 1932.3,402.728 1934.6,446.692 1936.91,423.986 1939.22,559.162 1941.53,442.343 1943.84,450.868 1946.14,586.878 1948.45,399.32 1950.76,371.84 1953.07,463.391 1955.38,498.654 1957.68,483.856 1959.99,443.245 1962.3,493.271 1964.61,520.234 1966.91,478.708 1969.22,540.178 1971.53,393.809 1973.84,484.148 1976.15,360.942 1978.45,317.668 1980.76,311.638 1983.07,323.685 1985.38,503.779 1987.69,400.796 1989.99,591.204 1992.3,371.975 1994.61,627.651 1996.92,377.927 1999.23,644.851 2001.53,420.981 2003.84,602.825 2006.15,481.267 2008.46,313.495 2010.77,472.514 2013.07,512.788 2015.38,689.1 2017.69,511.144 2020,449.659 2022.3,507.659 2024.61,322.749 2026.92,555.815 2029.23,468.143 2031.54,558.863 2033.84,327.807 2036.15,256.801 2038.46,302.095 2040.77,437.66 2043.08,472.31 2045.38,518.805 2047.69,323.764 2050,443.515 2052.31,415.993 2054.62,485.258 2056.92,329.728 2059.23,507.902 2061.54,367.442 2063.85,455.728 2066.16,566.016 2068.46,431.246 2070.77,488.527 2073.08,489.018 2075.39,399.174 2077.69,508.261 2080,485.27 2082.31,371.455 2084.62,454.823 2086.93,360.899 2089.23,536.805 2091.54,410.411 2093.85,702.19 2096.16,376.119 2098.47,434.799 2100.77,513.369 2103.08,389.961 2105.39,537.189 2107.7,384.929 2110.01,481.533 2112.31,523.352 2114.62,480.956 2116.93,284.436 2119.24,457.87 2121.55,372.829 2123.85,590.77 2126.16,441.718 2128.47,575.369 2130.78,266.306 2133.08,541.201 2135.39,657.941 2137.7,377.982 2140.01,565.529 2142.32,396.484 2144.62,542.266 2146.93,628.179 2149.24,396.208 2151.55,426.42 2153.86,606.321 2156.16,639.107 2158.47,387.055 2160.78,400.314 2163.09,414.591 2165.4,500.914 2167.7,478.315 2170.01,417.907 2172.32,551.405 2174.63,410.206 2176.93,464.582 2179.24,389.717 2181.55,461.832 2183.86,653.416 2186.17,307.482 2188.47,358.298 2190.78,272.608 2193.09,495.474 2195.4,441.73 2197.71,413.173 2200.01,371.187 2202.32,210.162 2204.63,461.938 2206.94,450.725 2209.25,429.639 2211.55,335.612 2213.86,558.138 2216.17,205 2218.48,243.792 2220.79,451.027 2223.09,508.598 2225.4,464.274 2227.71,480.349 2230.02,491.497 2232.32,394.02 2234.63,424.66 2236.94,474.587 2239.25,443.383 2241.56,297.152 2243.86,366.703 2246.17,291.388 2248.48,317.986 2250.79,466.286 2253.1,429.178 2255.4,529.091 2257.71,625.896 2260.02,595.014 2262.33,326.241 2264.64,369.24 2266.94,413.507 2269.25,398.601 2271.56,382.87 2273.87,593.286 2276.18,528.033 2278.48,351.362 2280.79,511.77 2283.1,339.734 2285.41,339.551 2287.71,400.803 2290.02,487.1 2292.33,467.01 2294.64,437.249 2296.95,455.207 2299.25,432.325 2301.56,378.861 2303.87,587.126 2306.18,473.996 2308.49,321.647 2310.79,560.656 2313.1,574.52 2315.41,411.702 2317.72,356.751 2320.03,484.179 2322.33,512.351 2324.64,333.127 2326.95,515.622 2329.26,602.912 2331.56,330.922 2333.87,745.223 2336.18,561.684 2338.49,337.978 2340.8,389.72 2343.1,372.054 2345.41,411.61 2347.72,469.383 2350.03,552.312 2352.34,545.767 2354.64,331.291 2356.95,490.592 2359.26,472.164 2361.57,603.024 2363.88,573.715 2366.18,435.058 2368.49,510.7 2370.8,398.723 2373.11,573.381 2375.42,528.631 2377.72,511.208 2380.03,492.805 2382.34,467.925 2384.65,599.316 2386.95,456.486 2389.26,544.419 2391.57,517.946 2393.88,402.502 2396.19,276.34 2398.49,570.778 2400.8,495.422 2403.11,582.732 2405.42,339.227 2407.73,685.672 2410.03,377.667 2412.34,586.752 2414.65,590.339 2416.96,532.92 2419.27,317.107 2421.57,594.743 2423.88,527.655 2426.19,333.282 2428.5,532.959 2430.81,599.754 2433.11,573.081 2435.42,403.566 2437.73,440.894 2440.04,464.806 2442.34,423.202 2444.65,442.858 2446.96,373.569 2449.27,472.637 2451.58,640.964 2453.88,506.37 2456.19,692.806 2458.5,281.252 2460.81,463.548 2463.12,514.899 2465.42,420.961 2467.73,578.442 2470.04,570.956 2472.35,323.69 2474.66,387.084 2476.96,695.247 2479.27,522.52 2481.58,456.678 2483.89,285.058 2486.2,366.409 2488.5,585.229 2490.81,479.896 2493.12,305.693 2495.43,374.902 2497.73,400.533 2500.04,399.068 2502.35,501.842 2504.66,466.709 2506.97,604.88 2509.27,477.251 2511.58,494.297 2513.89,543.145 2516.2,480.538 2518.51,405.024 2520.81,477.071 2523.12,565.628 2525.43,404.209 2527.74,501.723 2530.05,354.246 2532.35,500.883 2534.66,562.182 2536.97,504.73 2539.28,540.941 2541.58,407.616 2543.89,340.36 2546.2,435.809 2548.51,466.116 2550.82,248.832 2553.12,430.759 2555.43,531.271 2557.74,420.81 2560.05,442.274 2562.36,481.321 2564.66,461.186 2566.97,488.737 2569.28,463.366 2571.59,522.704 "></polyline>
</svg>
</div>
</div>
<p>Look at that! Things are working; amazin’.</p>
<p>We can also exploit <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>’s parallel sampling capabilities:</p>
<div id="34" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run separate 4 chains for 10 000 iterations using threads to parallelize.</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>num_chains <span class="op">=</span> <span class="fl">4</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    model_with_grad,</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">MCMCThreads</span>(),</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>,</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    num_chains;</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Note we need to provide an initial state for every chain.</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>    initial_state<span class="op">=</span><span class="fu">fill</span>(state, num_chains),</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>samples_array <span class="op">=</span> <span class="fu">stack</span>(<span class="fu">map</span>(<span class="bu">Base</span>.<span class="fu">Fix1</span>(stack, sample <span class="op">-&gt;</span> sample.x), samples))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000×4 Array{Float64, 3}:
[:, :, 1] =
 -1.74327  -4.5443    -4.20617   -4.59437   …  -4.25763  -4.6128    -4.97478
  2.07773   0.866809  -0.606145  -0.909795     -0.64512  -0.267949   0.286991
  2.26373   2.79185    2.92172    4.16845       4.84981   6.08862    5.65717

[:, :, 2] =
 -2.12052    -4.11935   -3.89837   …  -3.9516   -3.7346    -3.7346
  0.0371665   0.493575  -0.500908      1.13139   0.123833   0.123833
  1.03182     2.50649    4.62457       5.27154   5.47831    5.47831

[:, :, 3] =
 -2.57434  -3.7239   -3.7239   -5.00721  …  -5.93387  -6.00116   -5.28746
  1.55414   1.54268   1.54268   1.5929       1.33928   0.213703  -0.222696
  3.31011   4.45892   4.45892   4.49415      5.99106   6.28484    5.76733

[:, :, 4] =
 -2.1802    -3.2992   -4.61526  -3.32011  …  -6.18753   -5.52906  -5.21029
 -0.974584  -1.99243  -1.3686   -1.96447      0.011076   1.06173   1.07624
  3.29987    3.7921    5.08777   3.0397       4.12837    5.85176   5.61908</code></pre>
</div>
</div>
<p>But the fact that we have to provide the <code>AbstractMCMC.sample</code> call, etc. with an <code>initial_state</code> to get started is a bit annoying. We can avoid this by also defining a <code>AbstractMCMC.step</code> <em>without</em> the <code>state</code> argument:</p>
<div id="36" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">::</span><span class="dt">MALA</span>;</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># </span><span class="al">NOTE</span><span class="co">: No state provided!</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just create the initial state by sampling using  a Gaussian.</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="fu">randn</span>(rng, LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(x), <span class="fu">MALAState</span>(x)</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Equipped with this, we no longer need to provide the <code>initial_state</code> everywhere:</p>
<div id="38" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -5.0012      1.00839
 -0.00765001  0.996041
  5.00383     0.997079</code></pre>
</div>
</div>
</section>
<section id="using-our-sampler-with-turing.jl" class="level2">
<h2 class="anchored" data-anchor-id="using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</h2>
<p>As we promised, all of this hassle of implementing our <code>MALA</code> sampler in a way that uses <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> and <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> gets us something more than <em>just</em> an “automatic” implementation of <code>AbstractMCMC.sample</code>.</p>
<p>It also enables use with Turing.jl through the <code>externalsampler</code>, but we need to do one final thing first: we need to tell Turing.jl how to extract a vector of parameters from the “sample” returned in our implementation of <code>AbstractMCMC.step</code>. In our case, the “sample” is a <code>MALASample</code>, so we just need the following line:</p>
<div id="40" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Turing</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">DynamicPPL</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Overload the `getparams` method for our "sample" type, which is just a vector.</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>Turing.Inference.<span class="fu">getparams</span>(<span class="op">::</span><span class="dt">DynamicPPL.Model</span>, sample<span class="op">::</span><span class="dt">MALASample</span>) <span class="op">=</span> sample.x</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And with that, we’re good to go!</p>
<div id="42" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Our previous model defined as a Turing.jl model.</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">mvnormal_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">MvNormal</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.], I)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate our model.</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">mvnormal_model</span>()</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Call `sample` but now we're passing in a Turing.jl `model` and wrapping</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co"># our `MALA` sampler in the `externalsampler` to tell Turing.jl that the sampler</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co"># expects something that implements LogDensityProblems.jl.</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×4×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 3.26 seconds
Compute duration  = 3.26 seconds
parameters        = x[1], x[2], x[3]
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters  </span><span class="ansi-bold">    mean  </span><span class="ansi-bold">     std  </span><span class="ansi-bold">    mcse  </span><span class="ansi-bold">  ess_bulk  </span><span class="ansi-bold">  ess_tail  </span><span class="ansi-bold">    rhat  </span><span class="ansi-bold"> ⋯
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">   Float64  </span><span class="ansi-bright-black-fg ansi-bold">   Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> ⋯

        x[1]   -4.9934    1.0046    0.0175   3306.5415   5162.4477    1.0001   ⋯
        x[2]   -0.0027    0.9853    0.0170   3373.4743   5542.8142    1.0000   ⋯
        x[3]    4.9922    0.9746    0.0174   3126.0243   5356.3704    1.0000   ⋯
</span><span class="ansi-cyan-fg ansi-bold">                                                                1 column omitted

Quantiles
 </span><span class="ansi-cyan-fg ansi-bold"> parameters  </span><span class="ansi-cyan-fg ansi-bold">    2.5%  </span><span class="ansi-cyan-fg ansi-bold">   25.0%  </span><span class="ansi-cyan-fg ansi-bold">   50.0%  </span><span class="ansi-cyan-fg ansi-bold">   75.0%  </span><span class="ansi-cyan-fg ansi-bold">   97.5%
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64

        x[1]   -6.9687   -5.6703   -5.0104   -4.3097   -3.0235
        x[2]   -1.8969   -0.6699   -0.0008    0.6515    1.9596
        x[3]    3.0570    4.3346    4.9905    5.6488    6.8937
</span></pre>
</div>
</div>
</div>
<p>Pretty neat, eh?</p>
<section id="models-with-constrained-parameters" class="level3">
<h3 class="anchored" data-anchor-id="models-with-constrained-parameters">Models with constrained parameters</h3>
<p>One thing we’ve sort of glossed over in all of the above is that MALA, at least how we’ve implemented it, requires <span class="math inline">\(x\)</span> to live in <span class="math inline">\(\mathbb{R}^d\)</span> for some <span class="math inline">\(d &gt; 0\)</span>. If some of the parameters were in fact constrained, e.g.&nbsp;we were working with a <code>Beta</code> distribution which has support on the interval <span class="math inline">\((0, 1)\)</span>, <em>not</em> on <span class="math inline">\(\mathbb{R}^d\)</span>, we could easily end up outside of the valid range <span class="math inline">\((0, 1)\)</span>.</p>
<div id="44" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">beta_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">beta_model</span>()</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 1.96 seconds
Compute duration  = 1.96 seconds
parameters        = x
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters  </span><span class="ansi-bold">    mean  </span><span class="ansi-bold">     std  </span><span class="ansi-bold">    mcse  </span><span class="ansi-bold">  ess_bulk  </span><span class="ansi-bold">  ess_tail  </span><span class="ansi-bold">    rhat  </span><span class="ansi-bold"> ⋯
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">   Float64  </span><span class="ansi-bright-black-fg ansi-bold">   Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> ⋯

           x    0.4968    0.1891    0.0027   4771.5551   5891.7144    1.0000   ⋯
</span><span class="ansi-cyan-fg ansi-bold">                                                                1 column omitted

Quantiles
 </span><span class="ansi-cyan-fg ansi-bold"> parameters  </span><span class="ansi-cyan-fg ansi-bold">    2.5%  </span><span class="ansi-cyan-fg ansi-bold">   25.0%  </span><span class="ansi-cyan-fg ansi-bold">   50.0%  </span><span class="ansi-cyan-fg ansi-bold">   75.0%  </span><span class="ansi-cyan-fg ansi-bold">   97.5%
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64

           x    0.1419    0.3540    0.4996    0.6386    0.8501
</span></pre>
</div>
</div>
</div>
<p>Yep, that still works, but only because Turing.jl actually <em>transforms</em> the <code>turing_model</code> from constrained to unconstrained, so that the <code>sampler</code> provided to <code>externalsampler</code> is actually always working in unconstrained space! This is not always desirable, so we can turn this off:</p>
<div id="46" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 0.2 seconds
Compute duration  = 0.2 seconds
parameters        = x
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters  </span><span class="ansi-bold">    mean  </span><span class="ansi-bold">     std  </span><span class="ansi-bold">    mcse  </span><span class="ansi-bold"> ess_bulk  </span><span class="ansi-bold"> ess_tail  </span><span class="ansi-bold">    rhat  </span><span class="ansi-bold"> e ⋯
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">  Float64  </span><span class="ansi-bright-black-fg ansi-bold">  Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">   ⋯

           x    0.4442    0.2142    0.0391    25.7755        NaN    1.0334     ⋯
</span><span class="ansi-cyan-fg ansi-bold">                                                                1 column omitted

Quantiles
 </span><span class="ansi-cyan-fg ansi-bold"> parameters  </span><span class="ansi-cyan-fg ansi-bold">    2.5%  </span><span class="ansi-cyan-fg ansi-bold">   25.0%  </span><span class="ansi-cyan-fg ansi-bold">   50.0%  </span><span class="ansi-cyan-fg ansi-bold">   75.0%  </span><span class="ansi-cyan-fg ansi-bold">   97.5%
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64

           x    0.2121    0.2184    0.4196    0.6217    0.7918
</span></pre>
</div>
</div>
</div>
<p>The fun thing is that this still sort of works because</p>
<div id="48" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">logpdf</span>(<span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>), <span class="fl">10.0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-Inf</code></pre>
</div>
</div>
<p>and so the samples that fall outside of the range are always rejected. But do notice how much worse all the diagnostics are, e.g.&nbsp;<code>ess_tail</code> is very poor compared to when we use <code>unconstrained=true</code>. Moreover, in more complex cases this won’t just result in a “nice” <code>-Inf</code> log-density value, but instead will error:</p>
<div id="50" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="kw">function</span> <span class="fu">demo</span>()</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>    σ² <span class="op">~</span> <span class="fu">truncated</span>(<span class="fu">Normal</span>(), lower<span class="op">=</span><span class="fl">0</span>)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If we end up with negative values for `σ²`, the `Normal` will error.</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>    x <span class="op">~</span> <span class="fu">Normal</span>(<span class="fl">0</span>, σ²)</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre>DomainError with -0.606123058014126:
Normal: the condition σ &gt;= zero(σ) is not satisfied.
Stacktrace:
  [1] <span class="ansi-bold">#371</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/YQSrn/src/univariate/continuous/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">normal.jl:37</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [2] <span class="ansi-bold">check_args</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/YQSrn/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">utils.jl:89</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [3] <span class="ansi-bold">#Normal#370</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/YQSrn/src/univariate/continuous/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">normal.jl:37</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [4] <span class="ansi-bold">Normal</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/YQSrn/src/univariate/continuous/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">normal.jl:36</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [5] <span class="ansi-bold">Normal</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/YQSrn/src/univariate/continuous/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">normal.jl:42</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [6] <span class="ansi-bold">macro expansion</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/I9lST/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">compiler.jl:558</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [7] <span class="ansi-bold">demo</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">__model__</span>::Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DefaultContext}</span>, <span class="ansi-bright-black-fg">__varinfo__</span>::DynamicPPL.ThreadSafeVarInfo<span class="ansi-bright-black-fg">{VarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}, Vector{Base.RefValue{Float64}}}</span>, <span class="ansi-bright-black-fg">__context__</span>::DynamicPPL.ValuesAsInModelContext<span class="ansi-bright-black-fg">{DefaultContext}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-magenta-fg">Main.Notebook</span> <span class="ansi-bright-black-fg">~/work/docs/docs/developers/inference/implementing-samplers/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">index.qmd:457</span>
  [8] <span class="ansi-bold">_evaluate!!</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/I9lST/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">model.jl:913</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [9] <span class="ansi-bold">evaluate_threadsafe!!</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">model</span>::Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DefaultContext}</span>, <span class="ansi-bright-black-fg">varinfo</span>::VarInfo<span class="ansi-bright-black-fg">{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}</span>, <span class="ansi-bright-black-fg">context</span>::DynamicPPL.ValuesAsInModelContext<span class="ansi-bright-black-fg">{DefaultContext}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-cyan-fg">DynamicPPL</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/I9lST/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">model.jl:902</span>
 [10] <span class="ansi-bold">evaluate!!</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/I9lST/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">model.jl:832</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [11] <span class="ansi-bold">values_as_in_model</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/I9lST/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">values_as_in_model.jl:173</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [12] <span class="ansi-bold">values_as_in_model</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/I9lST/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">values_as_in_model.jl:172</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [13] <span class="ansi-bold">getparams</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">model</span>::Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DefaultContext}</span>, <span class="ansi-bright-black-fg">vi</span>::VarInfo<span class="ansi-bright-black-fg">{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-green-fg">Turing.Inference</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/1Egt9/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">Inference.jl:176</span>
 [14] <span class="ansi-bold">Turing.Inference.Transition</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">model</span>::Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DefaultContext}</span>, <span class="ansi-bright-black-fg">vi</span>::VarInfo<span class="ansi-bright-black-fg">{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}</span>, <span class="ansi-bright-black-fg">t</span>::MALASample<span class="ansi-bright-black-fg">{Vector{Float64}}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-green-fg">Turing.Inference</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/1Egt9/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">Inference.jl:138</span>
 [15] <span class="ansi-bold">transition_to_turing</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">f</span>::LogDensityFunction<span class="ansi-bright-black-fg">{Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DefaultContext}, VarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}, DefaultContext, AutoForwardDiff{2, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}}}</span>, <span class="ansi-bright-black-fg">transition</span>::MALASample<span class="ansi-bright-black-fg">{Vector{Float64}}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-green-fg">Turing.Inference</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/1Egt9/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">external_sampler.jl:80</span>
 [16] <span class="ansi-bold">step</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">rng</span>::TaskLocalRNG, <span class="ansi-bright-black-fg">model</span>::Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DefaultContext}</span>, <span class="ansi-bright-black-fg">sampler_wrapper</span>::Sampler<span class="ansi-bright-black-fg">{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}</span>; <span class="ansi-bright-black-fg">initial_state</span>::Nothing, <span class="ansi-bright-black-fg">initial_params</span>::Nothing, <span class="ansi-bright-black-fg">kwargs</span>::@Kwargs<span class="ansi-bright-black-fg">{}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-green-fg">Turing.Inference</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/1Egt9/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">external_sampler.jl:145</span>
 [17] <span class="ansi-bold">macro expansion</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/AbstractMCMC/kwj9g/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">sample.jl:0</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [18] <span class="ansi-bold">macro expansion</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/AbstractMCMC/kwj9g/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">logging.jl:16</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [19] <span class="ansi-bold">mcmcsample</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">rng</span>::TaskLocalRNG, <span class="ansi-bright-black-fg">model</span>::Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DefaultContext}</span>, <span class="ansi-bright-black-fg">sampler</span>::Sampler<span class="ansi-bright-black-fg">{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}</span>, <span class="ansi-bright-black-fg">N</span>::Int64; <span class="ansi-bright-black-fg">progress</span>::Bool, <span class="ansi-bright-black-fg">progressname</span>::String, <span class="ansi-bright-black-fg">callback</span>::Nothing, <span class="ansi-bright-black-fg">num_warmup</span>::Int64, <span class="ansi-bright-black-fg">discard_initial</span>::Int64, <span class="ansi-bright-black-fg">thinning</span>::Int64, <span class="ansi-bright-black-fg">chain_type</span>::Type, <span class="ansi-bright-black-fg">initial_state</span>::Nothing, <span class="ansi-bright-black-fg">kwargs</span>::@Kwargs<span class="ansi-bright-black-fg">{}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-yellow-fg">AbstractMCMC</span> <span class="ansi-bright-black-fg">~/.julia/packages/AbstractMCMC/kwj9g/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">sample.jl:144</span>
 [20] <span class="ansi-bold">sample</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">rng</span>::TaskLocalRNG, <span class="ansi-bright-black-fg">model</span>::Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DefaultContext}</span>, <span class="ansi-bright-black-fg">sampler</span>::Sampler<span class="ansi-bright-black-fg">{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}</span>, <span class="ansi-bright-black-fg">N</span>::Int64; <span class="ansi-bright-black-fg">chain_type</span>::Type, <span class="ansi-bright-black-fg">resume_from</span>::Nothing, <span class="ansi-bright-black-fg">initial_state</span>::Nothing, <span class="ansi-bright-black-fg">kwargs</span>::@Kwargs<span class="ansi-bright-black-fg">{progress::Bool}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-cyan-fg">DynamicPPL</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/I9lST/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">sampler.jl:102</span>
 [21] <span class="ansi-bold">sample</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/I9lST/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">sampler.jl:92</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [22] <span class="ansi-bold">#sample#101</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/1Egt9/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">abstractmcmc.jl:29</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [23] <span class="ansi-bold">sample</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/1Egt9/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">abstractmcmc.jl:20</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [24] <span class="ansi-bold">#sample#100</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/1Egt9/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">abstractmcmc.jl:17</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [25] top-level scope
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/work/docs/docs/developers/inference/implementing-samplers/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">index.qmd:459</span></pre>
</div>
</div>
</div>
<p>As expected, we run into a <code>DomainError</code> at some point, while if we set <code>unconstrained=true</code>, letting Turing.jl transform the model to a unconstrained form behind the scenes, everything works as expected:</p>
<div id="52" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 2.17 seconds
Compute duration  = 2.17 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters  </span><span class="ansi-bold">    mean  </span><span class="ansi-bold">     std  </span><span class="ansi-bold">    mcse  </span><span class="ansi-bold"> ess_bulk  </span><span class="ansi-bold"> ess_tail  </span><span class="ansi-bold">    rhat  </span><span class="ansi-bold"> e ⋯
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">  Float64  </span><span class="ansi-bright-black-fg ansi-bold">  Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">   ⋯

          σ²    0.8200    0.5623    0.0252   229.4661    59.7228    1.0058     ⋯
           x   -0.0849    0.9180    0.0382   707.3265   490.9313    1.0014     ⋯
</span><span class="ansi-cyan-fg ansi-bold">                                                                1 column omitted

Quantiles
 </span><span class="ansi-cyan-fg ansi-bold"> parameters  </span><span class="ansi-cyan-fg ansi-bold">    2.5%  </span><span class="ansi-cyan-fg ansi-bold">   25.0%  </span><span class="ansi-cyan-fg ansi-bold">   50.0%  </span><span class="ansi-cyan-fg ansi-bold">   75.0%  </span><span class="ansi-cyan-fg ansi-bold">   97.5%
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64

          σ²    0.0590    0.3634    0.7124    1.1439    2.2076
           x   -2.4472   -0.4448   -0.0061    0.3188    1.8226
</span></pre>
</div>
</div>
</div>
<p>Neat!</p>
<p>Similarly, which automatic differentiation backend one should use can be specified through the <code>adtype</code> keyword argument too. For example, if we want to use <a href="https://github.com/JuliaDiff/ReverseDiff.jl">ReverseDiff.jl</a> instead of the default <a href="https://github.com/JuliaDiff/ForwardDiff.jl">ForwardDiff.jl</a>:</p>
<div id="54" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">ReverseDiff</span>: ReverseDiff</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify that we want to use `AutoReverseDiff`.</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">demo</span>(),</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>, adtype<span class="op">=</span><span class="fu">AutoReverseDiff</span>()),</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>;</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 3.14 seconds
Compute duration  = 3.14 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters  </span><span class="ansi-bold">    mean  </span><span class="ansi-bold">     std  </span><span class="ansi-bold">    mcse  </span><span class="ansi-bold"> ess_bulk  </span><span class="ansi-bold"> ess_tail  </span><span class="ansi-bold">    rhat  </span><span class="ansi-bold"> e ⋯
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">  Float64  </span><span class="ansi-bright-black-fg ansi-bold">  Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">   ⋯

          σ²    0.8539    0.5741    0.0252   351.1103   456.4055    1.0026     ⋯
           x    0.0425    0.9908    0.0508   452.7749   307.9256    1.0029     ⋯
</span><span class="ansi-cyan-fg ansi-bold">                                                                1 column omitted

Quantiles
 </span><span class="ansi-cyan-fg ansi-bold"> parameters  </span><span class="ansi-cyan-fg ansi-bold">    2.5%  </span><span class="ansi-cyan-fg ansi-bold">   25.0%  </span><span class="ansi-cyan-fg ansi-bold">   50.0%  </span><span class="ansi-cyan-fg ansi-bold">   75.0%  </span><span class="ansi-cyan-fg ansi-bold">   97.5%
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64

          σ²    0.1441    0.3968    0.7189    1.1945    2.2924
           x   -1.8327   -0.4932   -0.0106    0.4174    2.5389
</span></pre>
</div>
</div>
</div>
<p>Double-neat.</p>
</section>
</section>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<p>At this point it’s worth maybe reminding ourselves what we did and also <em>why</em> we did it:</p>
<ol type="1">
<li>We define our models in the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface because it makes the sampler agnostic to how the underlying model is implemented.</li>
<li>We implement our sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> interface, which just means that our sampler is a subtype of <code>AbstractMCMC.AbstractSampler</code> and we implement the MCMC transition in <code>AbstractMCMC.step</code>.</li>
<li>Points 1 and 2 makes it so our sampler can be used with a wide range of model implementations, amongst them being models implemented in both Turing.jl and Stan. This gives you, the inference implementer, a large collection of models to test your inference method on, in addition to allowing users of Turing.jl and Stan to try out your inference method with minimal effort.</li>
</ol>


</section>


<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a><div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>We’re going with the leapfrog formulation because in a future version of this tutorial we’ll add a section extending this simple “baseline” MALA sampler to more complex versions. See <a href="https://github.com/TuringLang/docs/issues/479">issue #479</a> for progress on this.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>There is no such thing as a proper interface in Julia (at least not officially), and so we use the word “interface” here to mean a few minimal methods that needs to be implemented by any type that we treat as a target model.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    // Ensure there is a toggle, if there isn't float one in the top right
    if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
      const a = window.document.createElement('a');
      a.classList.add('top-right');
      a.classList.add('quarto-color-scheme-toggle');
      a.href = "";
      a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
      const i = window.document.createElement("i");
      i.classList.add('bi');
      a.appendChild(i);
      window.document.body.appendChild(a);
    }
    setColorSchemeToggle(hasAlternateSentinel())
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/turinglang\.org\/docs\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../../developers/inference/variational-inference/index.html" class="pagination-link" aria-label="Variational Inference">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Variational Inference</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Turing is created by <a href="http://mlg.eng.cam.ac.uk/hong/" target="_blank">Hong Ge</a>, and lovingly maintained by the <a href="https://github.com/TuringLang/Turing.jl/graphs/contributors" target="_blank">core team</a> of volunteers. <br> The contents of this website are © 2024 under the terms of the <a href="https://github.com/TuringLang/Turing.jl/blob/main/LICENCE" target="_blank">MIT License</a>.</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/TuringLang/docs/edit/main/developers/inference/implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/docs/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://x.com/TuringLang">
      <i class="bi bi-twitter" role="img" aria-label="Turing Twitter">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/TuringLang/Turing.jl">
      <i class="bi bi-github" role="img" aria-label="Turing GitHub">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




<script src="../../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>