<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.30">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Implementing Samplers – Turing.jl</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<link href="../../../developers/inference/variational-inference/index.html" rel="prev">
<link href="../../../assets/favicon.ico" rel="icon">
<script src="../../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-de070a7b0ab54f8780927367ac907214.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-dark-2b3e328b71be8d25427581baeb23079b.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-de070a7b0ab54f8780927367ac907214.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap-45df24dc1485a233dc76492db592b344.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../../site_libs/bootstrap/bootstrap-dark-3d2c2b059e745154d0d7919feeea7e11.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="../../../site_libs/bootstrap/bootstrap-45df24dc1485a233dc76492db592b344.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<style>
  a {
    text-decoration: none;
  }
  a:hover {
    text-decoration: underline;
  }
</style>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../../theming/styles.css">
</head>

<body class="nav-sidebar floating nav-fixed quarto-light"><script id="quarto-html-before-body" type="application/javascript">
    const toggleBodyColorMode = (bsSheetEl) => {
      const mode = bsSheetEl.getAttribute("data-mode");
      const bodyEl = window.document.querySelector("body");
      if (mode === "dark") {
        bodyEl.classList.add("quarto-dark");
        bodyEl.classList.remove("quarto-light");
      } else {
        bodyEl.classList.add("quarto-light");
        bodyEl.classList.remove("quarto-dark");
      }
    }
    const toggleBodyColorPrimary = () => {
      const bsSheetEl = window.document.querySelector("link#quarto-bootstrap:not([rel=disabled-stylesheet])");
      if (bsSheetEl) {
        toggleBodyColorMode(bsSheetEl);
      }
    }
    const setColorSchemeToggle = (alternate) => {
      const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
      for (let i=0; i < toggles.length; i++) {
        const toggle = toggles[i];
        if (toggle) {
          if (alternate) {
            toggle.classList.add("alternate");
          } else {
            toggle.classList.remove("alternate");
          }
        }
      }
    };
    const toggleColorMode = (alternate) => {
      // Switch the stylesheets
      const primaryStylesheets = window.document.querySelectorAll('link.quarto-color-scheme:not(.quarto-color-alternate)');
      const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
      manageTransitions('#quarto-margin-sidebar .nav-link', false);
      if (alternate) {
        // note: dark is layered on light, we don't disable primary!
        enableStylesheet(alternateStylesheets);
        for (const sheetNode of alternateStylesheets) {
          if (sheetNode.id === "quarto-bootstrap") {
            toggleBodyColorMode(sheetNode);
          }
        }
      } else {
        disableStylesheet(alternateStylesheets);
        enableStylesheet(primaryStylesheets)
        toggleBodyColorPrimary();
      }
      manageTransitions('#quarto-margin-sidebar .nav-link', true);
      // Switch the toggles
      setColorSchemeToggle(alternate)
      // Hack to workaround the fact that safari doesn't
      // properly recolor the scrollbar when toggling (#1455)
      if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
        manageTransitions("body", false);
        window.scrollTo(0, 1);
        setTimeout(() => {
          window.scrollTo(0, 0);
          manageTransitions("body", true);
        }, 40);
      }
    }
    const disableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        stylesheet.rel = 'disabled-stylesheet';
      }
    }
    const enableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        if(stylesheet.rel !== 'stylesheet') { // for Chrome, which will still FOUC without this check
          stylesheet.rel = 'stylesheet';
        }
      }
    }
    const manageTransitions = (selector, allowTransitions) => {
      const els = window.document.querySelectorAll(selector);
      for (let i=0; i < els.length; i++) {
        const el = els[i];
        if (allowTransitions) {
          el.classList.remove('notransition');
        } else {
          el.classList.add('notransition');
        }
      }
    }
    const isFileUrl = () => {
      return window.location.protocol === 'file:';
    }
    const hasAlternateSentinel = () => {
      let styleSentinel = getColorSchemeSentinel();
      if (styleSentinel !== null) {
        return styleSentinel === "alternate";
      } else {
        return false;
      }
    }
    const setStyleSentinel = (alternate) => {
      const value = alternate ? "alternate" : "default";
      if (!isFileUrl()) {
        window.localStorage.setItem("quarto-color-scheme", value);
      } else {
        localAlternateSentinel = value;
      }
    }
    const getColorSchemeSentinel = () => {
      if (!isFileUrl()) {
        const storageValue = window.localStorage.getItem("quarto-color-scheme");
        return storageValue != null ? storageValue : localAlternateSentinel;
      } else {
        return localAlternateSentinel;
      }
    }
    const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
      const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
      const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
      let newTheme = '';
      if(authorPrefersDark) {
        newTheme = isAlternate ? baseTheme : alternateTheme;
      } else {
        newTheme = isAlternate ? alternateTheme : baseTheme;
      }
      const changeGiscusTheme = () => {
        // From: https://github.com/giscus/giscus/issues/336
        const sendMessage = (message) => {
          const iframe = document.querySelector('iframe.giscus-frame');
          if (!iframe) return;
          iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
        }
        sendMessage({
          setConfig: {
            theme: newTheme
          }
        });
      }
      const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
      if (isGiscussLoaded) {
        changeGiscusTheme();
      }
    };
    const authorPrefersDark = false;
    const darkModeDefault = authorPrefersDark;
      document.querySelector('link#quarto-text-highlighting-styles.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
      document.querySelector('link#quarto-bootstrap.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
    let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
    // Dark / light mode switch
    window.quartoToggleColorScheme = () => {
      // Read the current dark / light value
      let toAlternate = !hasAlternateSentinel();
      toggleColorMode(toAlternate);
      setStyleSentinel(toAlternate);
      toggleGiscusIfUsed(toAlternate, darkModeDefault);
      window.dispatchEvent(new Event('resize'));
    };
    // Switch to dark mode if need be
    if (hasAlternateSentinel()) {
      toggleColorMode(true);
    } else {
      toggleColorMode(false);
    }
  </script>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="https://turinglang.org/" class="navbar-brand navbar-brand-logo">
    <img src="../../../assets/images/turing-logo.svg" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="https://turinglang.org/">
    <span class="navbar-title">Turing.jl</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../getting-started/"> 
<span class="menu-text">Get Started</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../tutorials/coin-flipping/"> 
<span class="menu-text">Tutorials</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/library/"> 
<span class="menu-text">Libraries</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/news/"> 
<span class="menu-text">News</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/team/"> 
<span class="menu-text">Team</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-v0.38" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">v0.38</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-v0.38">    
        <li>
    <a class="dropdown-item" href="https://turinglang.org/docs/changelog.html">
 <span class="dropdown-text">Changelog</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://turinglang.org/docs/versions.html">
 <span class="dropdown-text">All Versions</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools tools-wide">
    <a href="https://x.com/TuringLang" title="Turing Twitter" class="quarto-navigation-tool px-1" aria-label="Turing Twitter"><i class="bi bi-twitter"></i></a>
    <a href="https://github.com/TuringLang/Turing.jl" title="Turing GitHub" class="quarto-navigation-tool px-1" aria-label="Turing GitHub"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../../developers/contributing/index.html">Developers</a></li><li class="breadcrumb-item"><a href="../../../developers/inference/abstractmcmc-interface/index.html">Inference (note: outdated)</a></li><li class="breadcrumb-item"><a href="../../../developers/inference/implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../getting-started/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Getting Started</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../core-functionality/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Core Functionality</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false">
 <span class="menu-text">User Guide</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/automatic-differentiation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Automatic Differentiation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/custom-distribution/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Custom Distributions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/probability-interface/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Querying Model Probabilities</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/modifying-logprob/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Modifying the Log Probability</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/tracking-extra-quantities/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Tracking Extra Quantities</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/mode-estimation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Mode Estimation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/performance-tips/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Performance Tips</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/sampler-visualisation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Sampler Visualization</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/dynamichmc/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using DynamicHMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/external-samplers/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using External Samplers</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false">
 <span class="menu-text">Tutorials</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/coin-flipping/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction: Coin Flipping</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/gaussian-mixture-models/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Mixture Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-neural-networks/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Neural Networks</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/hidden-markov-models/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Hidden Markov Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-linear-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Linear Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/infinite-mixture-models/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Infinite Mixture Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-poisson-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Poisson Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/multinomial-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Multinomial Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-differential-equations/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Differential Equations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/probabilistic-pca/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Probabilistic PCA</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-time-series-analysis/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Time Series Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/gaussian-processes-introduction/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Processes: Introduction</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/gaussian-process-latent-variable-models/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Process Latent Variable Models</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Developers</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/contributing/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Contributing</span></a>
  </div>
</li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false">
 <span class="menu-text">DynamicPPL’s Compiler</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/compiler/model-manual/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Manually Defining a Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/compiler/minituring-compiler/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation I: Compiler</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/compiler/minituring-contexts/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation II: Contexts</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/compiler/design-overview/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Turing Compiler Design (Outdated)</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false">
 <span class="menu-text">Variable Transformations</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/transforms/distributions/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Distributions and the Jacobian</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/transforms/bijectors/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bijectors in MCMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/transforms/dynamicppl/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variable transformations in DynamicPPL</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true">
 <span class="menu-text">Inference (note: outdated)</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/inference/abstractmcmc-interface/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Interface Guide</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/inference/abstractmcmc-turing/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">How Turing Implements AbstractMCMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/inference/variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/inference/implementing-samplers/index.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Implementing Samplers</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of Contents</h2>
   
  <ul>
  <li><a href="#quick-overview-of-mala" id="toc-quick-overview-of-mala" class="nav-link active" data-scroll-target="#quick-overview-of-mala">Quick overview of MALA</a></li>
  <li><a href="#what-we-need-from-a-model-logdensityproblems.jl" id="toc-what-we-need-from-a-model-logdensityproblems.jl" class="nav-link" data-scroll-target="#what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: LogDensityProblems.jl</a></li>
  <li><a href="#implementing-mala-in-abstractmcmc.jl" id="toc-implementing-mala-in-abstractmcmc.jl" class="nav-link" data-scroll-target="#implementing-mala-in-abstractmcmc.jl">Implementing MALA in AbstractMCMC.jl</a></li>
  <li><a href="#using-our-sampler-with-turing.jl" id="toc-using-our-sampler-with-turing.jl" class="nav-link" data-scroll-target="#using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</a>
  <ul class="collapse">
  <li><a href="#models-with-constrained-parameters" id="toc-models-with-constrained-parameters" class="nav-link" data-scroll-target="#models-with-constrained-parameters">Models with constrained parameters</a></li>
  </ul></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/TuringLang/docs/edit/main/developers/inference/implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/docs/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">


<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../../developers/contributing/index.html">Developers</a></li><li class="breadcrumb-item"><a href="../../../developers/inference/abstractmcmc-interface/index.html">Inference (note: outdated)</a></li><li class="breadcrumb-item"><a href="../../../developers/inference/implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Implementing Samplers</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>In this tutorial, we’ll go through step-by-step how to implement a “simple” sampler in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> in such a way that it can be easily applied to Turing.jl models.</p>
<p>In particular, we’re going to implement a version of <strong>Metropolis-adjusted Langevin (MALA)</strong>.</p>
<p>Note that we will implement this sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> framework, completely “ignoring” Turing.jl until the very end of the tutorial, at which point we’ll use a single line of code to make the resulting sampler available to Turing.jl. This is to really drive home the point that one can implement samplers in a way that is accessible to all of Turing.jl’s users without having to use Turing.jl yourself.</p>
<section id="quick-overview-of-mala" class="level2">
<h2 class="anchored" data-anchor-id="quick-overview-of-mala">Quick overview of MALA</h2>
<p>We can view MALA as a single step of the leapfrog intergrator with resampling of momentum <span class="math inline">\(p\)</span> at every step.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> To make that statement a bit more concrete, we first define the <em>extended</em> target <span class="math inline">\(\bar{\gamma}(x, p)\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\log \bar{\gamma}(x, p) \propto \log \gamma(x) + \log \gamma_{\mathcal{N}(0, M)}(p)
\end{equation*}\]</span></p>
<p>where <span class="math inline">\(\gamma_{\mathcal{N}(0, M)}\)</span> denotes the density for a zero-centered Gaussian with covariance matrix <span class="math inline">\(M\)</span>. We then consider targeting this joint distribution over both <span class="math inline">\(x\)</span> and <span class="math inline">\(p\)</span> as follows. First we define the map</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  L_{\epsilon}: \quad &amp; \mathbb{R}^d \times \mathbb{R}^d \to \mathbb{R}^d \times \mathbb{R}^d \\
  &amp; (x, p) \mapsto (\tilde{x}, \tilde{p}) := L_{\epsilon}(x, p)
\end{split}
\end{equation*}\]</span></p>
<p>as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p_{1 / 2} &amp;:= p + \frac{\epsilon}{2} \nabla \log \gamma(x) \\
  \tilde{x} &amp;:= x + \epsilon M^{-1} p_{1 /2 } \\
  p_1 &amp;:= p_{1 / 2} + \frac{\epsilon}{2} \nabla \log \gamma(\tilde{x}) \\
  \tilde{p} &amp;:= - p_1
\end{split}
\end{equation*}\]</span></p>
<p>This might be familiar for some readers as a single step of the Leapfrog integrator. We then define the MALA kernel as follows: given the current iterate <span class="math inline">\(x_i\)</span>, we sample the next iterate <span class="math inline">\(x_{i + 1}\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p &amp;\sim \mathcal{N}(0, M) \\
  (\tilde{x}, \tilde{p}) &amp;:= L_{\epsilon}(x_i, p) \\
  \alpha &amp;:= \min \left\{ 1, \frac{\bar{\gamma}(\tilde{x}, \tilde{p})}{\bar{\gamma}(x_i, p)} \right\} \\
  x_{i + 1} &amp;:=
  \begin{cases}
    \tilde{x} \quad &amp; \text{ with prob. } \alpha \\
    x_i       \quad &amp; \text{ with prob. } 1 - \alpha
  \end{cases}
\end{split}
\end{equation*}\]</span></p>
<p>i.e.&nbsp;we accept the proposal <span class="math inline">\(\tilde{x}\)</span> with probability <span class="math inline">\(\alpha\)</span> and reject it, thus sticking with our current iterate, with probability <span class="math inline">\(1 - \alpha\)</span>.</p>
</section>
<section id="what-we-need-from-a-model-logdensityproblems.jl" class="level2">
<h2 class="anchored" data-anchor-id="what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a></h2>
<p>There are a few things we need from the “target” / “model” / density that we want to sample from:</p>
<ol type="1">
<li>We need access to log-density <em>evaluations</em> <span class="math inline">\(\log \gamma(x)\)</span> so we can compute the acceptance ratio involving <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>We need access to log-density <em>gradients</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span> so we can compute the Leapfrog steps <span class="math inline">\(L_{\epsilon}(x, p)\)</span>.</li>
<li>We also need access to the “size” of the model so we can determine the size of <span class="math inline">\(M\)</span>.</li>
</ol>
<p>Luckily for us, there is a package called <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> which provides an interface for <em>exactly</em> this!</p>
<p>To demonstrate how one can implement the “<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface”<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> we will use a simple Gaussian model as an example:</p>
<div id="4" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblems</span>: LogDensityProblems;</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's define some type that represents the model.</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> IsotropicNormalModel{M<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"mean of the isotropic Gaussian"</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    mean<span class="op">::</span><span class="dt">M</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Specifies what input length the model expects.</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">dimension</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> <span class="fu">length</span>(model.mean)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Implementation of the log-density evaluation of the model.</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x<span class="op">::</span><span class="dt">AbstractVector{&lt;:Real}</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">-</span> <span class="fu">sum</span>(abs2, x <span class="op">.-</span> model.mean) <span class="op">/</span> <span class="fl">2</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This gives us all of the properties we want for our MALA sampler with the exception of the computation of the <em>gradient</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span>. There is the method <code>LogDensityProblems.logdensity_and_gradient</code> which should return a 2-tuple where the first entry is the evaluation of the logdensity <span class="math inline">\(\log \gamma(x)\)</span> and the second entry is the gradient <span class="math inline">\(\nabla \log \gamma(x)\)</span>.</p>
<p>There are two ways to “implement” this method: 1) we implement it by hand, which is feasible in the case of our <code>IsotropicNormalModel</code>, or b) we defer the implementation of this to a automatic differentiation backend.</p>
<p>To implement it by hand we can simply do</p>
<div id="6" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl that first-order, i.e. gradient information, is available.</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{1}</span>()</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Implement `logdensity_and_gradient`.</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    logγ_x <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="op">-</span>x <span class="op">.*</span> (x <span class="op">-</span> model.mean)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> logγ_x, ∇logγ_x</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s just try it out:</p>
<div id="8" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate the problem.</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> <span class="fu">IsotropicNormalModel</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.])</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create some example input that we can test on.</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>x_example <span class="op">=</span> <span class="fu">randn</span>(LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate!</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-19.828311210876173</code></pre>
</div>
</div>
<p>To defer it to an automatic differentiation backend, we can do</p>
<div id="10" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl we only have access to 0-th order information.</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{0}</span>()</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Use `LogDensityProblemsAD`'s `ADgradient` in combination with some AD backend to implement `logdensity_and_gradient`.</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblemsAD</span>, <span class="bu">ADTypes</span>, <span class="bu">ForwardDiff</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>model_with_grad <span class="op">=</span> <span class="fu">ADgradient</span>(<span class="fu">AutoForwardDiff</span>(), model)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model_with_grad, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-19.828311210876173</code></pre>
</div>
</div>
<p>We’ll continue with the second approach in this tutorial since this is typically what one does in practice, because there are better hobbies to spend time on than deriving gradients by hand.</p>
<p>At this point, one might wonder how we’re going to tie this back to Turing.jl in the end. Effectively, when working with inference methods that only require log-density evaluations and / or higher-order information of the log-density, Turing.jl actually converts the user-provided <code>Model</code> into an object implementing the above methods for <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>. As a result, most samplers provided by Turing.jl are actually implemented to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, enabling their use both <em>within</em> Turing.jl and <em>outside</em> of Turing.jl! Morever, there exists similar conversions for Stan through BridgeStan and Stan<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, which means that a sampler supporting the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface can easily be used on both Turing.jl <em>and</em> Stan models (in addition to user-provided models, as our <code>IsotropicNormalModel</code> above)!</p>
<p>Anyways, let’s move on to actually implementing the sampler.</p>
</section>
<section id="implementing-mala-in-abstractmcmc.jl" class="level2">
<h2 class="anchored" data-anchor-id="implementing-mala-in-abstractmcmc.jl">Implementing MALA in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a></h2>
<p>Now that we’ve established that a model implementing the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface provides us with all the information we need from <span class="math inline">\(\log \gamma(x)\)</span>, we can address the question: given an object that implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, how can we define a sampler for it?</p>
<p>We’re going to do this by making our sampler a sub-type of <code>AbstractMCMC.AbstractSampler</code> in addition to implementing a few methods from <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>. Why? Because it gets us <em>a lot</em> of functionality for free, as we will see later.</p>
<p>Moreover, <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> provides a very natural interface for MCMC algorithms.</p>
<p>First, we’ll define our <code>MALA</code> type</p>
<div id="12" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">AbstractMCMC</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALA{T,A} <span class="op">&lt;:</span><span class="dt"> AbstractMCMC.AbstractSampler</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"stepsize used in the leapfrog step"</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    ϵ_init<span class="op">::</span><span class="dt">T</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"covariance matrix used for the momentum"</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    M_init<span class="op">::</span><span class="dt">A</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notice how we’ve added the suffix <code>_init</code> to both the stepsize and the covariance matrix. We’ve done this because a <code>AbstractMCMC.AbstractSampler</code> should be <em>immutable</em>. Of course there might be many scenarios where we want to allow something like the stepsize and / or the covariance matrix to vary between iterations, e.g.&nbsp;during the burn-in / adaptation phase of the sampling process we might want to adjust the parameters using statistics computed from these initial iterations. But information which can change between iterations <em>should not go in the sampler itself</em>! Instead, this information should go in the sampler <em>state</em>.</p>
<p>The sampler state should at the very least contain all the necessary information to perform the next MCMC iteration, but usually contains further information, e.g.&nbsp;quantities and statistics useful for evaluating whether the sampler has converged.</p>
<p>We will use the following sampler state for our <code>MALA</code> sampler:</p>
<div id="14" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALAState{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This might seem overly redundant: we’re defining a type <code>MALAState</code> and it only contains a simple vector of reals. In this particular case we indeed could have dropped this and simply used a <code>AbstractVector{&lt;:Real}</code> as our sampler state, but typically, as we will see later, one wants to include other quantities in the sampler state. For example, if we also wanted to adapt the parameters of our <code>MALA</code>, e.g.&nbsp;alter the stepsize depending on acceptance rates, in which case we should also put <code>ϵ</code> in the state, but for now we’ll keep things simple.</p>
<p>Moreover, we also want a <em>sample</em> type, which is a type meant for “public consumption”, i.e.&nbsp;the end-user. This is generally going to contain a subset of the information present in the state. But in such a simple scenario as this, we similarly only have a <code>AbstractVector{&lt;:Real}</code>:</p>
<div id="16" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALASample{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We currently have three things:</p>
<ol type="1">
<li>A <code>AbstractMCMC.AbstractSampler</code> implementation called <code>MALA</code>.</li>
<li>A state <code>MALAState</code> for our sampler <code>MALA</code>.</li>
<li>A sample <code>MALASample</code> for our sampler <code>MALA</code>.</li>
</ol>
<p>That means that we’re ready to implement the only thing that really matters: <code>AbstractMCMC.step</code>.</p>
<p><code>AbstractMCMC.step</code> defines the MCMC iteration of our <code>MALA</code> given the current <code>MALAState</code>. Specifically, the signature of the function is as follows:</p>
<div id="18" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The RNG to ensure reproducibility.</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The model that defines our target.</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.AbstractModel</span>,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The sampler for which we're taking a `step`.</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">AbstractMCMC.AbstractSampler</span>,</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The current sampler `state`.</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    state;</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Additional keyword arguments that we may or may not need.</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Moreover, there is a specific <code>AbstractMCMC.AbstractModel</code> which is used to indicate that the model that is provided implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface: <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Since, as we discussed earlier, in our case we’re indeed going to work with types that support the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, we’ll define <code>AbstractMCMC.step</code> for such a <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Note that <code>AbstractMCMC.LogDensityModel</code> has no other purpose; it has a single field called <code>logdensity</code>, and it does nothing else. But by wrapping the model in <code>AbstractMCMC.LogDensityModel</code>, it allows samplers that want to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> to define their <code>AbstractMCMC.step</code> on this type without running into method ambiguities.</p>
<p>All in all, that means that the signature for our <code>AbstractMCMC.step</code> is going to be the following:</p>
<div id="20" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># `LogDensityModel` so we know we're working with LogDensityProblems.jl model.</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler.</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler state.</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Great! Now let’s actually implement the full <code>AbstractMCMC.step</code> for our <code>MALA</code>.</p>
<p>Let’s remind ourselves what we’re going to do:</p>
<ol type="1">
<li>Sample a new momentum <span class="math inline">\(p\)</span>.</li>
<li>Compute the log-density of the extended target <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>Take a single leapfrog step <span class="math inline">\((\tilde{x}, \tilde{p}) = L_{\epsilon}(x, p)\)</span>.</li>
<li>Accept or reject the proposed <span class="math inline">\((\tilde{x}, \tilde{p})\)</span>.</li>
</ol>
<p>All in all, this results in the following:</p>
<div id="22" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>: Random</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Distributions</span>  <span class="co"># so we get the `MvNormal`</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the wrapped model which implements LogDensityProblems.jl.</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just extract the sampler parameters to make our lives easier.</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    ϵ <span class="op">=</span> sampler.ϵ_init</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    M <span class="op">=</span> sampler.M_init</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the current parameters.</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> state.x</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sample the momentum.</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>    p_dist <span class="op">=</span> <span class="fu">MvNormal</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)), M)</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> <span class="fu">rand</span>(rng, p_dist)</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Propose using a single leapfrog step.</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>    x̃, p̃ <span class="op">=</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Accept or reject proposal.</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>    logp <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p)</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>    logp̃ <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x̃) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p̃)</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>    logα <span class="op">=</span> logp̃ <span class="op">-</span> logp</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>    state_new <span class="op">=</span> <span class="cf">if</span> <span class="fu">log</span>(<span class="fu">rand</span>(rng)) <span class="op">&lt;</span> logα</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Accept.</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x̃)</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Reject.</span></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x)</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return the "sample" and the sampler state.</span></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(state_new.x), state_new</span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Fairly straight-forward.</p>
<p>Of course, we haven’t defined the <code>leapfrog_step</code> method yet, so let’s do that:</p>
<div id="24" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p` using "position" `x`.</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x))</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    p1 <span class="op">=</span> p <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update the "position" `x` using momentum `p1`.</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    x̃ <span class="op">=</span> x <span class="op">+</span> ϵ <span class="op">.*</span> (M <span class="op">\</span> p1)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p1` using position `x̃`</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x̃ <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x̃))</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    p2 <span class="op">=</span> p1 <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x̃</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Flip momentum `p2`.</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    p̃ <span class="op">=</span> <span class="op">-</span>p2</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x̃, p̃</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>leapfrog_step (generic function with 1 method)</code></pre>
</div>
</div>
<p>With all of this, we’re technically ready to sample!</p>
<div id="26" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>, <span class="bu">LinearAlgebra</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>rng <span class="op">=</span> <span class="bu">Random</span>.<span class="fu">default_rng</span>()</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>sampler <span class="op">=</span> <span class="fu">MALA</span>(<span class="fl">1</span>, I)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>state <span class="op">=</span> <span class="fu">MALAState</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)))</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>x_next, state_next <span class="op">=</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    rng,</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    AbstractMCMC.<span class="fu">LogDensityModel</span>(model),</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    state</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>(MALASample{Vector{Float64}}([-0.003452873707651478, -0.5863272088652156, -0.1354104068893221]), MALAState{Vector{Float64}}([-0.003452873707651478, -0.5863272088652156, -0.1354104068893221]))</code></pre>
</div>
</div>
<p>Great, it works!</p>
<p>And I promised we would get quite some functionality for free if we implemented <code>AbstractMCMC.step</code>, and so we can now simply call <code>sample</code> to perform standard MCMC sampling:</p>
<div id="28" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform 1000 iterations with our `MALA` sampler.</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; initial_state<span class="op">=</span>state, progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Concatenate into a matrix.</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000 Matrix{Float64}:
 -0.45243  -2.96717   -4.60275   -6.56223   …  -3.8064    -4.37612   -4.33038
  0.54043   0.503489   0.481219   0.812947     -0.578332  -0.314445   1.44825
  4.08079   3.37538    4.14067    5.96694       2.85583    3.58666    3.21589</code></pre>
</div>
</div>
<div id="30" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the marginal means and standard deviations.</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -5.0097      1.00071
 -0.00352376  1.00515
  4.96885     1.00596</code></pre>
</div>
</div>
<p>Let’s visualize the samples</p>
<div id="32" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">StatsPlots</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">transpose</span>(samples_matrix[<span class="op">:</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">:</span><span class="kw">end</span>]), alpha<span class="op">=</span><span class="fl">0.5</span>, legend<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<!--?xml version="1.0" encoding="utf-8"?-->
<svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" width="672" height="480" viewbox="0 0 2688 1920">
<defs>
  <clippath id="clip150">
    <rect x="0" y="0" width="2688" height="1920"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip150)" d="M0 1920 L2688 1920 L2688 0 L0 0  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip151">
    <rect x="537" y="0" width="1883" height="1883"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip150)" d="M151.747 1800.78 L2640.76 1800.78 L2640.76 47.2441 L151.747 47.2441  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip152">
    <rect x="151" y="47" width="2490" height="1755"></rect>
  </clippath>
</defs>
<polyline clip-path="url(#clip152)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="219.84,1800.78 219.84,47.2441 "></polyline>
<polyline clip-path="url(#clip152)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="807.458,1800.78 807.458,47.2441 "></polyline>
<polyline clip-path="url(#clip152)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1395.08,1800.78 1395.08,47.2441 "></polyline>
<polyline clip-path="url(#clip152)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1982.69,1800.78 1982.69,47.2441 "></polyline>
<polyline clip-path="url(#clip152)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="2570.31,1800.78 2570.31,47.2441 "></polyline>
<polyline clip-path="url(#clip152)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,1531.26 2640.76,1531.26 "></polyline>
<polyline clip-path="url(#clip152)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,1228.17 2640.76,1228.17 "></polyline>
<polyline clip-path="url(#clip152)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,925.084 2640.76,925.084 "></polyline>
<polyline clip-path="url(#clip152)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,621.998 2640.76,621.998 "></polyline>
<polyline clip-path="url(#clip152)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,318.911 2640.76,318.911 "></polyline>
<polyline clip-path="url(#clip150)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1800.78 2640.76,1800.78 "></polyline>
<polyline clip-path="url(#clip150)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="219.84,1800.78 219.84,1781.88 "></polyline>
<polyline clip-path="url(#clip150)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="807.458,1800.78 807.458,1781.88 "></polyline>
<polyline clip-path="url(#clip150)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1395.08,1800.78 1395.08,1781.88 "></polyline>
<polyline clip-path="url(#clip150)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1982.69,1800.78 1982.69,1781.88 "></polyline>
<polyline clip-path="url(#clip150)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="2570.31,1800.78 2570.31,1781.88 "></polyline>
<path clip-path="url(#clip150)" d="M219.84 1834 Q216.229 1834 214.4 1837.57 Q212.595 1841.11 212.595 1848.24 Q212.595 1855.34 214.4 1858.91 Q216.229 1862.45 219.84 1862.45 Q223.474 1862.45 225.28 1858.91 Q227.108 1855.34 227.108 1848.24 Q227.108 1841.11 225.28 1837.57 Q223.474 1834 219.84 1834 M219.84 1830.3 Q225.65 1830.3 228.706 1834.9 Q231.784 1839.49 231.784 1848.24 Q231.784 1856.96 228.706 1861.57 Q225.65 1866.15 219.84 1866.15 Q214.03 1866.15 210.951 1861.57 Q207.896 1856.96 207.896 1848.24 Q207.896 1839.49 210.951 1834.9 Q214.03 1830.3 219.84 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip150)" d="M771.15 1861.55 L787.47 1861.55 L787.47 1865.48 L765.525 1865.48 L765.525 1861.55 Q768.187 1858.79 772.771 1854.16 Q777.377 1849.51 778.558 1848.17 Q780.803 1845.65 781.683 1843.91 Q782.585 1842.15 782.585 1840.46 Q782.585 1837.71 780.641 1835.97 Q778.72 1834.23 775.618 1834.23 Q773.419 1834.23 770.965 1835 Q768.535 1835.76 765.757 1837.31 L765.757 1832.59 Q768.581 1831.46 771.035 1830.88 Q773.488 1830.3 775.525 1830.3 Q780.896 1830.3 784.09 1832.98 Q787.285 1835.67 787.285 1840.16 Q787.285 1842.29 786.474 1844.21 Q785.687 1846.11 783.581 1848.7 Q783.002 1849.37 779.9 1852.59 Q776.798 1855.78 771.15 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip150)" d="M797.331 1830.92 L815.687 1830.92 L815.687 1834.86 L801.613 1834.86 L801.613 1843.33 Q802.632 1842.98 803.65 1842.82 Q804.669 1842.64 805.687 1842.64 Q811.474 1842.64 814.854 1845.81 Q818.233 1848.98 818.233 1854.4 Q818.233 1859.97 814.761 1863.08 Q811.289 1866.15 804.97 1866.15 Q802.794 1866.15 800.525 1865.78 Q798.28 1865.41 795.872 1864.67 L795.872 1859.97 Q797.956 1861.11 800.178 1861.66 Q802.4 1862.22 804.877 1862.22 Q808.882 1862.22 811.22 1860.11 Q813.558 1858.01 813.558 1854.4 Q813.558 1850.78 811.22 1848.68 Q808.882 1846.57 804.877 1846.57 Q803.002 1846.57 801.127 1846.99 Q799.275 1847.4 797.331 1848.28 L797.331 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip150)" d="M837.446 1834 Q833.835 1834 832.007 1837.57 Q830.201 1841.11 830.201 1848.24 Q830.201 1855.34 832.007 1858.91 Q833.835 1862.45 837.446 1862.45 Q841.081 1862.45 842.886 1858.91 Q844.715 1855.34 844.715 1848.24 Q844.715 1841.11 842.886 1837.57 Q841.081 1834 837.446 1834 M837.446 1830.3 Q843.256 1830.3 846.312 1834.9 Q849.391 1839.49 849.391 1848.24 Q849.391 1856.96 846.312 1861.57 Q843.256 1866.15 837.446 1866.15 Q831.636 1866.15 828.557 1861.57 Q825.502 1856.96 825.502 1848.24 Q825.502 1839.49 828.557 1834.9 Q831.636 1830.3 837.446 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip150)" d="M1354.69 1830.92 L1373.05 1830.92 L1373.05 1834.86 L1358.98 1834.86 L1358.98 1843.33 Q1360 1842.98 1361.01 1842.82 Q1362.03 1842.64 1363.05 1842.64 Q1368.84 1842.64 1372.22 1845.81 Q1375.6 1848.98 1375.6 1854.4 Q1375.6 1859.97 1372.12 1863.08 Q1368.65 1866.15 1362.33 1866.15 Q1360.16 1866.15 1357.89 1865.78 Q1355.64 1865.41 1353.24 1864.67 L1353.24 1859.97 Q1355.32 1861.11 1357.54 1861.66 Q1359.76 1862.22 1362.24 1862.22 Q1366.25 1862.22 1368.58 1860.11 Q1370.92 1858.01 1370.92 1854.4 Q1370.92 1850.78 1368.58 1848.68 Q1366.25 1846.57 1362.24 1846.57 Q1360.37 1846.57 1358.49 1846.99 Q1356.64 1847.4 1354.69 1848.28 L1354.69 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip150)" d="M1394.81 1834 Q1391.2 1834 1389.37 1837.57 Q1387.56 1841.11 1387.56 1848.24 Q1387.56 1855.34 1389.37 1858.91 Q1391.2 1862.45 1394.81 1862.45 Q1398.44 1862.45 1400.25 1858.91 Q1402.08 1855.34 1402.08 1848.24 Q1402.08 1841.11 1400.25 1837.57 Q1398.44 1834 1394.81 1834 M1394.81 1830.3 Q1400.62 1830.3 1403.68 1834.9 Q1406.75 1839.49 1406.75 1848.24 Q1406.75 1856.96 1403.68 1861.57 Q1400.62 1866.15 1394.81 1866.15 Q1389 1866.15 1385.92 1861.57 Q1382.87 1856.96 1382.87 1848.24 Q1382.87 1839.49 1385.92 1834.9 Q1389 1830.3 1394.81 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip150)" d="M1424.97 1834 Q1421.36 1834 1419.53 1837.57 Q1417.73 1841.11 1417.73 1848.24 Q1417.73 1855.34 1419.53 1858.91 Q1421.36 1862.45 1424.97 1862.45 Q1428.61 1862.45 1430.41 1858.91 Q1432.24 1855.34 1432.24 1848.24 Q1432.24 1841.11 1430.41 1837.57 Q1428.61 1834 1424.97 1834 M1424.97 1830.3 Q1430.78 1830.3 1433.84 1834.9 Q1436.92 1839.49 1436.92 1848.24 Q1436.92 1856.96 1433.84 1861.57 Q1430.78 1866.15 1424.97 1866.15 Q1419.16 1866.15 1416.08 1861.57 Q1413.03 1856.96 1413.03 1848.24 Q1413.03 1839.49 1416.08 1834.9 Q1419.16 1830.3 1424.97 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip150)" d="M1940.97 1830.92 L1963.19 1830.92 L1963.19 1832.91 L1950.65 1865.48 L1945.76 1865.48 L1957.57 1834.86 L1940.97 1834.86 L1940.97 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip150)" d="M1972.36 1830.92 L1990.71 1830.92 L1990.71 1834.86 L1976.64 1834.86 L1976.64 1843.33 Q1977.66 1842.98 1978.68 1842.82 Q1979.7 1842.64 1980.72 1842.64 Q1986.5 1842.64 1989.88 1845.81 Q1993.26 1848.98 1993.26 1854.4 Q1993.26 1859.97 1989.79 1863.08 Q1986.32 1866.15 1980 1866.15 Q1977.82 1866.15 1975.55 1865.78 Q1973.31 1865.41 1970.9 1864.67 L1970.9 1859.97 Q1972.98 1861.11 1975.21 1861.66 Q1977.43 1862.22 1979.9 1862.22 Q1983.91 1862.22 1986.25 1860.11 Q1988.59 1858.01 1988.59 1854.4 Q1988.59 1850.78 1986.25 1848.68 Q1983.91 1846.57 1979.9 1846.57 Q1978.03 1846.57 1976.15 1846.99 Q1974.3 1847.4 1972.36 1848.28 L1972.36 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip150)" d="M2012.47 1834 Q2008.86 1834 2007.03 1837.57 Q2005.23 1841.11 2005.23 1848.24 Q2005.23 1855.34 2007.03 1858.91 Q2008.86 1862.45 2012.47 1862.45 Q2016.11 1862.45 2017.91 1858.91 Q2019.74 1855.34 2019.74 1848.24 Q2019.74 1841.11 2017.91 1837.57 Q2016.11 1834 2012.47 1834 M2012.47 1830.3 Q2018.28 1830.3 2021.34 1834.9 Q2024.42 1839.49 2024.42 1848.24 Q2024.42 1856.96 2021.34 1861.57 Q2018.28 1866.15 2012.47 1866.15 Q2006.66 1866.15 2003.59 1861.57 Q2000.53 1856.96 2000.53 1848.24 Q2000.53 1839.49 2003.59 1834.9 Q2006.66 1830.3 2012.47 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip150)" d="M2514.84 1861.55 L2522.48 1861.55 L2522.48 1835.18 L2514.17 1836.85 L2514.17 1832.59 L2522.43 1830.92 L2527.11 1830.92 L2527.11 1861.55 L2534.75 1861.55 L2534.75 1865.48 L2514.84 1865.48 L2514.84 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip150)" d="M2554.19 1834 Q2550.58 1834 2548.75 1837.57 Q2546.94 1841.11 2546.94 1848.24 Q2546.94 1855.34 2548.75 1858.91 Q2550.58 1862.45 2554.19 1862.45 Q2557.82 1862.45 2559.63 1858.91 Q2561.46 1855.34 2561.46 1848.24 Q2561.46 1841.11 2559.63 1837.57 Q2557.82 1834 2554.19 1834 M2554.19 1830.3 Q2560 1830.3 2563.06 1834.9 Q2566.13 1839.49 2566.13 1848.24 Q2566.13 1856.96 2563.06 1861.57 Q2560 1866.15 2554.19 1866.15 Q2548.38 1866.15 2545.3 1861.57 Q2542.25 1856.96 2542.25 1848.24 Q2542.25 1839.49 2545.3 1834.9 Q2548.38 1830.3 2554.19 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip150)" d="M2584.35 1834 Q2580.74 1834 2578.91 1837.57 Q2577.11 1841.11 2577.11 1848.24 Q2577.11 1855.34 2578.91 1858.91 Q2580.74 1862.45 2584.35 1862.45 Q2587.99 1862.45 2589.79 1858.91 Q2591.62 1855.34 2591.62 1848.24 Q2591.62 1841.11 2589.79 1837.57 Q2587.99 1834 2584.35 1834 M2584.35 1830.3 Q2590.16 1830.3 2593.22 1834.9 Q2596.3 1839.49 2596.3 1848.24 Q2596.3 1856.96 2593.22 1861.57 Q2590.16 1866.15 2584.35 1866.15 Q2578.54 1866.15 2575.46 1861.57 Q2572.41 1856.96 2572.41 1848.24 Q2572.41 1839.49 2575.46 1834.9 Q2578.54 1830.3 2584.35 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip150)" d="M2614.51 1834 Q2610.9 1834 2609.07 1837.57 Q2607.27 1841.11 2607.27 1848.24 Q2607.27 1855.34 2609.07 1858.91 Q2610.9 1862.45 2614.51 1862.45 Q2618.15 1862.45 2619.95 1858.91 Q2621.78 1855.34 2621.78 1848.24 Q2621.78 1841.11 2619.95 1837.57 Q2618.15 1834 2614.51 1834 M2614.51 1830.3 Q2620.32 1830.3 2623.38 1834.9 Q2626.46 1839.49 2626.46 1848.24 Q2626.46 1856.96 2623.38 1861.57 Q2620.32 1866.15 2614.51 1866.15 Q2608.7 1866.15 2605.62 1861.57 Q2602.57 1856.96 2602.57 1848.24 Q2602.57 1839.49 2605.62 1834.9 Q2608.7 1830.3 2614.51 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip150)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1800.78 151.747,47.2441 "></polyline>
<polyline clip-path="url(#clip150)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1531.26 170.644,1531.26 "></polyline>
<polyline clip-path="url(#clip150)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1228.17 170.644,1228.17 "></polyline>
<polyline clip-path="url(#clip150)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,925.084 170.644,925.084 "></polyline>
<polyline clip-path="url(#clip150)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,621.998 170.644,621.998 "></polyline>
<polyline clip-path="url(#clip150)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,318.911 170.644,318.911 "></polyline>
<path clip-path="url(#clip150)" d="M49.5521 1531.71 L79.2279 1531.71 L79.2279 1535.64 L49.5521 1535.64 L49.5521 1531.71 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip150)" d="M99.8991 1529.39 Q96.7509 1529.39 94.8991 1531.55 Q93.0704 1533.7 93.0704 1537.45 Q93.0704 1541.18 94.8991 1543.35 Q96.7509 1545.51 99.8991 1545.51 Q103.047 1545.51 104.876 1543.35 Q106.728 1541.18 106.728 1537.45 Q106.728 1533.7 104.876 1531.55 Q103.047 1529.39 99.8991 1529.39 M109.181 1514.74 L109.181 1519 Q107.422 1518.17 105.617 1517.73 Q103.834 1517.29 102.075 1517.29 Q97.4454 1517.29 94.9917 1520.41 Q92.5612 1523.54 92.2139 1529.86 Q93.5797 1527.84 95.6398 1526.78 Q97.7 1525.69 100.177 1525.69 Q105.385 1525.69 108.394 1528.86 Q111.427 1532.01 111.427 1537.45 Q111.427 1542.77 108.279 1545.99 Q105.131 1549.21 99.8991 1549.21 Q93.9037 1549.21 90.7325 1544.63 Q87.5612 1540.02 87.5612 1531.29 Q87.5612 1523.1 91.45 1518.24 Q95.3389 1513.35 101.89 1513.35 Q103.649 1513.35 105.431 1513.7 Q107.237 1514.05 109.181 1514.74 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip150)" d="M50.3623 1228.62 L80.0381 1228.62 L80.0381 1232.56 L50.3623 1232.56 L50.3623 1228.62 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip150)" d="M104.297 1226.82 Q107.654 1227.53 109.529 1229.8 Q111.427 1232.07 111.427 1235.4 Q111.427 1240.52 107.908 1243.32 Q104.39 1246.12 97.9083 1246.12 Q95.7324 1246.12 93.4176 1245.68 Q91.126 1245.27 88.6723 1244.41 L88.6723 1239.9 Q90.6167 1241.03 92.9315 1241.61 Q95.2463 1242.19 97.7695 1242.19 Q102.168 1242.19 104.459 1240.45 Q106.774 1238.72 106.774 1235.4 Q106.774 1232.35 104.621 1230.64 Q102.492 1228.9 98.6722 1228.9 L94.6445 1228.9 L94.6445 1225.06 L98.8574 1225.06 Q102.306 1225.06 104.135 1223.69 Q105.964 1222.3 105.964 1219.71 Q105.964 1217.05 104.066 1215.64 Q102.191 1214.2 98.6722 1214.2 Q96.7509 1214.2 94.5519 1214.62 Q92.3528 1215.03 89.7139 1215.91 L89.7139 1211.75 Q92.376 1211.01 94.6908 1210.64 Q97.0287 1210.27 99.0889 1210.27 Q104.413 1210.27 107.515 1212.7 Q110.617 1215.1 110.617 1219.22 Q110.617 1222.09 108.973 1224.09 Q107.33 1226.05 104.297 1226.82 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip150)" d="M99.4824 910.883 Q95.8713 910.883 94.0426 914.448 Q92.2371 917.99 92.2371 925.119 Q92.2371 932.226 94.0426 935.79 Q95.8713 939.332 99.4824 939.332 Q103.117 939.332 104.922 935.79 Q106.751 932.226 106.751 925.119 Q106.751 917.99 104.922 914.448 Q103.117 910.883 99.4824 910.883 M99.4824 907.179 Q105.293 907.179 108.348 911.786 Q111.427 916.369 111.427 925.119 Q111.427 933.846 108.348 938.452 Q105.293 943.036 99.4824 943.036 Q93.6723 943.036 90.5936 938.452 Q87.538 933.846 87.538 925.119 Q87.538 916.369 90.5936 911.786 Q93.6723 907.179 99.4824 907.179 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip150)" d="M104.297 620.644 Q107.654 621.361 109.529 623.63 Q111.427 625.898 111.427 629.232 Q111.427 634.347 107.908 637.148 Q104.39 639.949 97.9083 639.949 Q95.7324 639.949 93.4176 639.509 Q91.126 639.093 88.6723 638.236 L88.6723 633.722 Q90.6167 634.857 92.9315 635.435 Q95.2463 636.014 97.7695 636.014 Q102.168 636.014 104.459 634.278 Q106.774 632.542 106.774 629.232 Q106.774 626.176 104.621 624.463 Q102.492 622.727 98.6722 622.727 L94.6445 622.727 L94.6445 618.884 L98.8574 618.884 Q102.306 618.884 104.135 617.519 Q105.964 616.13 105.964 613.537 Q105.964 610.875 104.066 609.463 Q102.191 608.028 98.6722 608.028 Q96.7509 608.028 94.5519 608.445 Q92.3528 608.861 89.7139 609.741 L89.7139 605.574 Q92.376 604.834 94.6908 604.463 Q97.0287 604.093 99.0889 604.093 Q104.413 604.093 107.515 606.523 Q110.617 608.931 110.617 613.051 Q110.617 615.921 108.973 617.912 Q107.33 619.88 104.297 620.644 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip150)" d="M99.8991 317.048 Q96.7509 317.048 94.8991 319.2 Q93.0704 321.353 93.0704 325.103 Q93.0704 328.83 94.8991 331.006 Q96.7509 333.159 99.8991 333.159 Q103.047 333.159 104.876 331.006 Q106.728 328.83 106.728 325.103 Q106.728 321.353 104.876 319.2 Q103.047 317.048 99.8991 317.048 M109.181 302.395 L109.181 306.654 Q107.422 305.821 105.617 305.381 Q103.834 304.941 102.075 304.941 Q97.4454 304.941 94.9917 308.066 Q92.5612 311.191 92.2139 317.511 Q93.5797 315.497 95.6398 314.432 Q97.7 313.344 100.177 313.344 Q105.385 313.344 108.394 316.515 Q111.427 319.663 111.427 325.103 Q111.427 330.427 108.279 333.645 Q105.131 336.862 99.8991 336.862 Q93.9037 336.862 90.7325 332.279 Q87.5612 327.673 87.5612 318.946 Q87.5612 310.751 91.45 305.89 Q95.3389 301.006 101.89 301.006 Q103.649 301.006 105.431 301.353 Q107.237 301.701 109.181 302.395 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip152)" style="stroke:#009af9; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,970.793 224.541,1234.79 226.891,1490.52 229.242,1439.62 231.592,1401.89 233.943,1663.74 236.293,1506.8 238.644,1356.93 240.994,1430.36 243.345,1447.48 245.695,1321.17 248.046,1385.58 250.396,1540.64 252.747,1387.63 255.097,1397.47 257.448,1182.41 259.798,1529.54 262.148,1303.64 264.499,1567.6 266.849,1523.69 269.2,1303.25 271.55,1516.32 273.901,1751.15 276.251,1648.75 278.602,1379.46 280.952,1371.76 283.303,1426.87 285.653,1544.3 288.004,1372.81 290.354,1348.13 292.705,1224.04 295.055,1448.35 297.406,1414.69 299.756,1363.63 302.107,1285.42 304.457,1436.35 306.807,1330.68 309.158,1397.67 311.508,1520.82 313.859,1414.5 316.209,1553.15 318.56,1246.24 320.91,1510.94 323.261,1575.5 325.611,1526.94 327.962,1362.93 330.312,1599.58 332.663,1393.86 335.013,1464.99 337.364,1370.08 339.714,1462.42 342.065,1392.4 344.415,1403.06 346.765,1352.45 349.116,1426.23 351.466,1376.37 353.817,1424.7 356.167,1294.63 358.518,1434.18 360.868,1480.35 363.219,1415.13 365.569,1314.21 367.92,1440.2 370.27,1604.88 372.621,1570.87 374.971,1475.03 377.322,1590.76 379.672,1691.5 382.023,1316.23 384.373,1242.86 386.724,1508.62 389.074,1230.48 391.424,1402.95 393.775,1378.54 396.125,1445.47 398.476,1467.79 400.826,1368.34 403.177,1394.33 405.527,1296.46 407.878,1372.05 410.228,1568.04 412.579,1629.62 414.929,1663.1 417.28,1558.14 419.63,1393.63 421.981,1336.89 424.331,1502.16 426.682,1501.65 429.032,1429.19 431.382,1558.03 433.733,1527.46 436.083,1483.9 438.434,1504.81 440.784,1407.85 443.135,1258.19 445.485,1512.47 447.836,1347 450.186,1483.68 452.537,1399.4 454.887,1282.58 457.238,1385.37 459.588,1404.46 461.939,1530.42 464.289,1456.01 466.64,1318.54 468.99,1363.9 471.341,1298.7 473.691,1376.55 476.041,1297.16 478.392,1561.23 480.742,1563.64 483.093,1446.02 485.443,1542.91 487.794,1385.44 490.144,1541.23 492.495,1479.02 494.845,1449.98 497.196,1283.95 499.546,1261.69 501.897,1330.85 504.247,1222 506.598,1431.06 508.948,1487.71 511.299,1395.24 513.649,1532.75 515.999,1356.94 518.35,1480.09 520.7,1380.18 523.051,1363.45 525.401,1543.89 527.752,1570.18 530.102,1409.95 532.453,1534.89 534.803,1231.59 537.154,1371.73 539.504,1299.54 541.855,1553.41 544.205,1464.94 546.556,1355.26 548.906,1313.22 551.257,1410.45 553.607,1573.69 555.958,1357.18 558.308,1312.57 560.658,1416.29 563.009,1252.74 565.359,1422.47 567.71,1418.27 570.06,1457.93 572.411,1425.07 574.761,1303.58 577.112,1367.62 579.462,1411.58 581.813,1648.14 584.163,1269.55 586.514,1315.52 588.864,1316.03 591.215,1287.86 593.565,1412.54 595.916,1405.03 598.266,1551.91 600.616,1669.65 602.967,1457.71 605.317,1364.98 607.668,1359.48 610.018,1592.23 612.369,1437.99 614.719,1427.81 617.07,1424.22 619.42,1513.67 621.771,1543.85 624.121,1359.97 626.472,1319.24 628.822,1353.12 631.173,1404.41 633.523,1392.66 635.874,1457.38 638.224,1567.48 640.575,1545.67 642.925,1397.48 645.275,1560.14 647.626,1357.25 649.976,1583.21 652.327,1372.42 654.677,1462.64 657.028,1290.98 659.378,1425.42 661.729,1415.54 664.079,1434.21 666.43,1448.08 668.78,1527.52 671.131,1290.3 673.481,1449.34 675.832,1369.26 678.182,1403.55 680.533,1555.89 682.883,1542.13 685.233,1351.8 687.584,1321.56 689.934,1427.06 692.285,1352.11 694.635,1513.13 696.986,1183.09 699.336,1336.06 701.687,1360.39 704.037,1357.39 706.388,1392.33 708.738,1243.09 711.089,1383.17 713.439,1457.32 715.79,1488.48 718.14,1302.5 720.491,1391.56 722.841,1478.77 725.192,1181.21 727.542,1427.32 729.892,1448.61 732.243,1288.5 734.593,1382.83 736.944,1431.2 739.294,1372.34 741.645,1517.47 743.995,1373.62 746.346,1523.71 748.696,1454.84 751.047,1617.45 753.397,1528.98 755.748,1460.38 758.098,1452.98 760.449,1438.75 762.799,1461.14 765.15,1606.37 767.5,1363.96 769.85,1296.26 772.201,1635.87 774.551,1341.48 776.902,1244 779.252,1404.99 781.603,1414.89 783.953,1294.89 786.304,1491.84 788.654,1246.66 791.005,1557.82 793.355,1497.05 795.706,1439.45 798.056,1369.52 800.407,1430.71 802.757,1411.12 805.108,1426.86 807.458,1352.76 809.809,1351.95 812.159,1432.15 814.509,1666.46 816.86,1383.22 819.21,1357.54 821.561,1374.41 823.911,1202.21 826.262,1308.83 828.612,1516.25 830.963,1440.26 833.313,1551.24 835.664,1533.98 838.014,1495.1 840.365,1479.16 842.715,1320.21 845.066,1545.33 847.416,1269.1 849.767,1630.18 852.117,1259.23 854.467,1594.25 856.818,1354.85 859.168,1282.72 861.519,1345.31 863.869,1427.51 866.22,1433.18 868.57,1362.31 870.921,1405.14 873.271,1349.68 875.622,1618.53 877.972,1612.44 880.323,1454.43 882.673,1318.77 885.024,1327.06 887.374,1593.46 889.725,1544.01 892.075,1645.14 894.426,1449.33 896.776,1384.78 899.126,1324.07 901.477,1486 903.827,1465.01 906.178,1433.66 908.528,1502.57 910.879,1490.76 913.229,1620.55 915.58,1577.95 917.93,1378.91 920.281,1300.95 922.631,1386.95 924.982,1525.47 927.332,1422.67 929.683,1280.7 932.033,1433.89 934.384,1474.53 936.734,1410.09 939.084,1513.04 941.435,1634.05 943.785,1310.88 946.136,1293.87 948.486,1481.77 950.837,1255.2 953.187,1415.43 955.538,1450.12 957.888,1407.4 960.239,1471.42 962.589,1554 964.94,1249.07 967.29,1426.24 969.641,1369.08 971.991,1464.1 974.342,1308.66 976.692,1355.72 979.043,1229.14 981.393,1321.12 983.743,1351.69 986.094,1393.52 988.444,1189.09 990.795,1289.62 993.145,1404.23 995.496,1405.98 997.846,1279.68 1000.2,1514.99 1002.55,1505.74 1004.9,1522.69 1007.25,1433.44 1009.6,1291.86 1011.95,1463.1 1014.3,1431.9 1016.65,1437.83 1019,1314.39 1021.35,1444.36 1023.7,1377.72 1026.05,1556.49 1028.4,1433.89 1030.75,1381.75 1033.1,1344.13 1035.45,1555.5 1037.8,1464.93 1040.15,1453.79 1042.51,1436.48 1044.86,1486.75 1047.21,1399.99 1049.56,1471.22 1051.91,1332 1054.26,1474.05 1056.61,1351.73 1058.96,1378.26 1061.31,1456.32 1063.66,1435.65 1066.01,1402.28 1068.36,1370.93 1070.71,1216.34 1073.06,1529.93 1075.41,1489.29 1077.76,1425.95 1080.11,1502.35 1082.46,1499.33 1084.81,1331.06 1087.16,1425.98 1089.51,1395.18 1091.87,1385.27 1094.22,1372.44 1096.57,1492.98 1098.92,1396.6 1101.27,1504.93 1103.62,1447.09 1105.97,1588.71 1108.32,1291.22 1110.67,1302.81 1113.02,1442.08 1115.37,1435.56 1117.72,1457.76 1120.07,1432.38 1122.42,1242.84 1124.77,1365.1 1127.12,1404.33 1129.47,1436.09 1131.82,1484.14 1134.17,1474.02 1136.52,1364.58 1138.87,1391.51 1141.23,1507.68 1143.58,1500.01 1145.93,1501.64 1148.28,1604.17 1150.63,1484.7 1152.98,1522.36 1155.33,1441.46 1157.68,1311.75 1160.03,1353.76 1162.38,1523.52 1164.73,1390.37 1167.08,1409.43 1169.43,1558.24 1171.78,1470.77 1174.13,1462.1 1176.48,1386.04 1178.83,1558.34 1181.18,1571.4 1183.53,1457.87 1185.88,1481.06 1188.23,1499.58 1190.59,1555.19 1192.94,1393.53 1195.29,1238.77 1197.64,1631.38 1199.99,1560.31 1202.34,1380.51 1204.69,1373.46 1207.04,1510.63 1209.39,1693.02 1211.74,1433.79 1214.09,1502.44 1216.44,1502.57 1218.79,1451.14 1221.14,1449.34 1223.49,1551.09 1225.84,1332.51 1228.19,1400.01 1230.54,1256.77 1232.89,1435.55 1235.24,1500.29 1237.59,1479.17 1239.94,1425.03 1242.3,1407.13 1244.65,1355.56 1247,1452.76 1249.35,1518.15 1251.7,1395.93 1254.05,1517.91 1256.4,1455.9 1258.75,1267.29 1261.1,1424.54 1263.45,1431.5 1265.8,1394.73 1268.15,1389.25 1270.5,1383.06 1272.85,1638.05 1275.2,1448.6 1277.55,1499.52 1279.9,1417.45 1282.25,1535.79 1284.6,1648.5 1286.95,1376.08 1289.3,1257.46 1291.66,1277.01 1294.01,1438.81 1296.36,1496.26 1298.71,1602.59 1301.06,1485.07 1303.41,1410.75 1305.76,1322.53 1308.11,1358.58 1310.46,1267.14 1312.81,1546.76 1315.16,1591.17 1317.51,1412.15 1319.86,1535.64 1322.21,1411.31 1324.56,1433.71 1326.91,1351.99 1329.26,1488.04 1331.61,1272.62 1333.96,1462.05 1336.31,1396.16 1338.66,1422.89 1341.02,1486.55 1343.37,1317.77 1345.72,1491.89 1348.07,1266.79 1350.42,1446.49 1352.77,1626.6 1355.12,1458.07 1357.47,1348.77 1359.82,1395.23 1362.17,1600.48 1364.52,1383.88 1366.87,1462.13 1369.22,1429.91 1371.57,1601.02 1373.92,1395.67 1376.27,1427.43 1378.62,1401.53 1380.97,1309.47 1383.32,1502.45 1385.67,1397.69 1388.02,1562.45 1390.38,1487.17 1392.73,1531.28 1395.08,1424.52 1397.43,1577.96 1399.78,1600.25 1402.13,1536.36 1404.48,1582.06 1406.83,1477.74 1409.18,1272.68 1411.53,1641.79 1413.88,1304.99 1416.23,1510.14 1418.58,1399.41 1420.93,1298.69 1423.28,1452.17 1425.63,1302.82 1427.98,1412.98 1430.33,1368.82 1432.68,1591.27 1435.03,1484.39 1437.38,1607.97 1439.74,1405.46 1442.09,1458.82 1444.44,1280.32 1446.79,1562.83 1449.14,1436.61 1451.49,1377.33 1453.84,1321.26 1456.19,1414.89 1458.54,1280.07 1460.89,1458.77 1463.24,1367.15 1465.59,1383.88 1467.94,1463.12 1470.29,1545.43 1472.64,1589.36 1474.99,1479.76 1477.34,1490.74 1479.69,1381.38 1482.04,1437.71 1484.39,1228.6 1486.74,1459.94 1489.1,1348.19 1491.45,1614.46 1493.8,1500.12 1496.15,1408.61 1498.5,1360.74 1500.85,1341.36 1503.2,1299.75 1505.55,1317.33 1507.9,1526.77 1510.25,1488.37 1512.6,1437.29 1514.95,1370.45 1517.3,1421.69 1519.65,1329.16 1522,1512.52 1524.35,1455.19 1526.7,1358.12 1529.05,1300.81 1531.4,1433.61 1533.75,1349.09 1536.1,1338.57 1538.45,1567.4 1540.81,1359.12 1543.16,1596.75 1545.51,1467.87 1547.86,1311.87 1550.21,1257.91 1552.56,1384.28 1554.91,1296.91 1557.26,1479.61 1559.61,1416.85 1561.96,1421.95 1564.31,1437.41 1566.66,1468.76 1569.01,1364.13 1571.36,1459.67 1573.71,1496.07 1576.06,1346.33 1578.41,1555.18 1580.76,1360.19 1583.11,1283.07 1585.46,1602.16 1587.81,1298.74 1590.17,1516.11 1592.52,1553.65 1594.87,1370.05 1597.22,1352.27 1599.57,1504.16 1601.92,1443.07 1604.27,1546.83 1606.62,1318.64 1608.97,1509.94 1611.32,1432.73 1613.67,1494.36 1616.02,1446.66 1618.37,1530.2 1620.72,1510.43 1623.07,1416.71 1625.42,1429.12 1627.77,1448.02 1630.12,1442.19 1632.47,1441.15 1634.82,1346.42 1637.17,1737.16 1639.53,1476.77 1641.88,1471.45 1644.23,1499.83 1646.58,1393.77 1648.93,1360.24 1651.28,1479.67 1653.63,1436.5 1655.98,1622.96 1658.33,1380.83 1660.68,1464.86 1663.03,1185.09 1665.38,1373.68 1667.73,1433.41 1670.08,1352.34 1672.43,1381.6 1674.78,1258.33 1677.13,1476.65 1679.48,1465.6 1681.83,1390.14 1684.18,1510.05 1686.53,1457.87 1688.89,1155.26 1691.24,1388.35 1693.59,1452.51 1695.94,1389.41 1698.29,1332.2 1700.64,1501.2 1702.99,1442.36 1705.34,1345.15 1707.69,1280.31 1710.04,1370.67 1712.39,1515.57 1714.74,1502.7 1717.09,1605.74 1719.44,1369.07 1721.79,1403.8 1724.14,1456.3 1726.49,1664.08 1728.84,1393.62 1731.19,1447.65 1733.54,1484.9 1735.89,1299.1 1738.25,1566.18 1740.6,1447.63 1742.95,1413.39 1745.3,1449.62 1747.65,1523.59 1750,1556.4 1752.35,1359.82 1754.7,1633.46 1757.05,1402.58 1759.4,1337.39 1761.75,1401.22 1764.1,1451.59 1766.45,1417.43 1768.8,1391.68 1771.15,1424.49 1773.5,1442.35 1775.85,1345.49 1778.2,1340 1780.55,1306.16 1782.9,1352.39 1785.25,1443.05 1787.6,1586.27 1789.96,1426.45 1792.31,1411.79 1794.66,1502.5 1797.01,1471.29 1799.36,1397.51 1801.71,1551.62 1804.06,1317.31 1806.41,1496.04 1808.76,1377.17 1811.11,1503.15 1813.46,1316.87 1815.81,1362.69 1818.16,1644.76 1820.51,1322 1822.86,1488.47 1825.21,1341.39 1827.56,1366.05 1829.91,1289.58 1832.26,1513.02 1834.61,1283.79 1836.96,1372.6 1839.32,1409.44 1841.67,1465.55 1844.02,1407.05 1846.37,1225.54 1848.72,1408.81 1851.07,1442.3 1853.42,1367.37 1855.77,1445.87 1858.12,1276.72 1860.47,1567.18 1862.82,1442.61 1865.17,1519.44 1867.52,1365.78 1869.87,1381.38 1872.22,1562.21 1874.57,1338.49 1876.92,1434.17 1879.27,1248.26 1881.62,1408.91 1883.97,1409.36 1886.32,1440.66 1888.68,1523.65 1891.03,1319.56 1893.38,1533.56 1895.73,1333.96 1898.08,1338.68 1900.43,1415.02 1902.78,1239.32 1905.13,1513.5 1907.48,1365.75 1909.83,1334.07 1912.18,1285.89 1914.53,1384.74 1916.88,1425.12 1919.23,1500.79 1921.58,1296.01 1923.93,1485.69 1926.28,1523 1928.63,1545.71 1930.98,1306.43 1933.33,1486.35 1935.68,1226.98 1938.04,1267.62 1940.39,1422.78 1942.74,1456.28 1945.09,1354.88 1947.44,1214.72 1949.79,1416.46 1952.14,1540.42 1954.49,1578.88 1956.84,1591.45 1959.19,1368.21 1961.54,1552.62 1963.89,1360.05 1966.24,1375.48 1968.59,1633.92 1970.94,1514.93 1973.29,1299.35 1975.64,1445.65 1977.99,1535.24 1980.34,1545.91 1982.69,1452.84 1985.04,1509.5 1987.4,1462.25 1989.75,1228.3 1992.1,1551.33 1994.45,1404.15 1996.8,1520.88 1999.15,1456.45 2001.5,1507.25 2003.85,1360.28 2006.2,1409.17 2008.55,1358.22 2010.9,1379.24 2013.25,1495.1 2015.6,1404.29 2017.95,1531.03 2020.3,1279.09 2022.65,1567.07 2025,1365.74 2027.35,1445.09 2029.7,1505.67 2032.05,1440.89 2034.4,1455.93 2036.76,1458.82 2039.11,1569.89 2041.46,1254.91 2043.81,1425.3 2046.16,1405.69 2048.51,1376.33 2050.86,1607.74 2053.21,1454.55 2055.56,1387.66 2057.91,1440.25 2060.26,1522.85 2062.61,1533.74 2064.96,1352.12 2067.31,1444.74 2069.66,1559.9 2072.01,1511.86 2074.36,1540.79 2076.71,1211.89 2079.06,1435.23 2081.41,1528.55 2083.76,1535.18 2086.11,1350.92 2088.47,1404.61 2090.82,1396.26 2093.17,1293.84 2095.52,1598.39 2097.87,1362.06 2100.22,1276.21 2102.57,1333.83 2104.92,1441.7 2107.27,1225.78 2109.62,1389.18 2111.97,1583.53 2114.32,1498.99 2116.67,1498.85 2119.02,1446.19 2121.37,1264.89 2123.72,1485.92 2126.07,1545.58 2128.42,1289.7 2130.77,1606.51 2133.12,1494.73 2135.47,1286.31 2137.83,1349.45 2140.18,1315.56 2142.53,1533.98 2144.88,1492.51 2147.23,1423.47 2149.58,1485.15 2151.93,1633.8 2154.28,1396.05 2156.63,1402.42 2158.98,1414.58 2161.33,1454.66 2163.68,1533.35 2166.03,1388.55 2168.38,1332.87 2170.73,1625.83 2173.08,1478.27 2175.43,1398.32 2177.78,1239.86 2180.13,1507.21 2182.48,1402.62 2184.83,1433.86 2187.19,1486.97 2189.54,1480.56 2191.89,1439.14 2194.24,1453.72 2196.59,1519.53 2198.94,1443.12 2201.29,1397.93 2203.64,1605.86 2205.99,1419.25 2208.34,1492.27 2210.69,1369.42 2213.04,1557.34 2215.39,1354.2 2217.74,1413.34 2220.09,1521.93 2222.44,1595.26 2224.79,1390.05 2227.14,1491.99 2229.49,1485.7 2231.84,1473.27 2234.19,1516.16 2236.55,1389.49 2238.9,1227.28 2241.25,1397.95 2243.6,1647.53 2245.95,1460.3 2248.3,1604.07 2250.65,1413.71 2253,1424.02 2255.35,1431.36 2257.7,1540.6 2260.05,1501.98 2262.4,1398.47 2264.75,1342.48 2267.1,1515.98 2269.45,1513.02 2271.8,1445.57 2274.15,1443.67 2276.5,1474.82 2278.85,1533.35 2281.2,1490.14 2283.55,1318.52 2285.91,1486.09 2288.26,1541.05 2290.61,1415.93 2292.96,1377.03 2295.31,1330.11 2297.66,1706.37 2300.01,1389.65 2302.36,1497.86 2304.71,1536.02 2307.06,1370.64 2309.41,1249.47 2311.76,1471.8 2314.11,1403.58 2316.46,1700.43 2318.81,1383.67 2321.16,1455.72 2323.51,1528.44 2325.86,1278.62 2328.21,1298.36 2330.56,1550.79 2332.91,1397.57 2335.27,1418.32 2337.62,1617.83 2339.97,1447.45 2342.32,1532.93 2344.67,1330.26 2347.02,1535.76 2349.37,1439.62 2351.72,1684.93 2354.07,1452.67 2356.42,1405.07 2358.77,1419.22 2361.12,1429.91 2363.47,1300.38 2365.82,1384.53 2368.17,1513.76 2370.52,1457.96 2372.87,1402.31 2375.22,1217.29 2377.57,1338.88 2379.92,1495.11 2382.27,1542.69 2384.62,1567.48 2386.98,1502.62 2389.33,1602.4 2391.68,1530.71 2394.03,1484.09 2396.38,1473.47 2398.73,1476.03 2401.08,1338.74 2403.43,1456.02 2405.78,1679.87 2408.13,1436.75 2410.48,1442.17 2412.83,1305.16 2415.18,1578.32 2417.53,1351.61 2419.88,1511.15 2422.23,1611.21 2424.58,1426.51 2426.93,1446.62 2429.28,1402.98 2431.63,1447.02 2433.98,1404.84 2436.34,1287.8 2438.69,1422.23 2441.04,1398.49 2443.39,1555.33 2445.74,1432.45 2448.09,1430.82 2450.44,1513.89 2452.79,1459.24 2455.14,1506.78 2457.49,1366.11 2459.84,1326.96 2462.19,1344.57 2464.54,1412.71 2466.89,1623.36 2469.24,1392.51 2471.59,1450.28 2473.94,1264.74 2476.29,1505.93 2478.64,1337.7 2480.99,1568.06 2483.34,1426.02 2485.7,1369.08 2488.05,1421.61 2490.4,1533.31 2492.75,1359.72 2495.1,1270.13 2497.45,1161.85 2499.8,1451.26 2502.15,1528.96 2504.5,1517.34 2506.85,1461.45 2509.2,1347.81 2511.55,1365.37 2513.9,1351.94 2516.25,1520.75 2518.6,1353.07 2520.95,1406.56 2523.3,1501.27 2525.65,1594.1 2528,1267.5 2530.35,1533.12 2532.7,1400.32 2535.06,1396.15 2537.41,1488 2539.76,1588.72 2542.11,1490.49 2544.46,1325.75 2546.81,1465.81 2549.16,1486.35 2551.51,1414.65 2553.86,1438.09 2556.21,1521.48 2558.56,1403.18 2560.91,1360.97 2563.26,1730.49 2565.61,1286.64 2567.96,1300.7 2570.31,1524.8 "></polyline>
<polyline clip-path="url(#clip152)" style="stroke:#e26f46; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,870.485 224.541,851.424 226.891,845.572 229.242,936.422 231.592,872.709 233.943,803.659 236.293,787.302 238.644,900.753 240.994,969.884 243.345,770.675 245.695,846.586 248.046,815.725 250.396,827.158 252.747,777.891 255.097,1165.95 257.448,998.704 259.798,987.748 262.148,1037.35 264.499,1051.74 266.849,855.238 269.2,830.731 271.55,687.934 273.901,769.254 276.251,918.728 278.602,949.306 280.952,899.316 283.303,975.236 285.653,936.54 288.004,860.489 290.354,905.142 292.705,953.776 295.055,896.811 297.406,845.317 299.756,1036.5 302.107,945.926 304.457,946.485 306.807,935.36 309.158,1060.99 311.508,866.082 313.859,781.02 316.209,909.228 318.56,645.813 320.91,765.181 323.261,944.271 325.611,1008.76 327.962,1045.21 330.312,890.159 332.663,922.555 335.013,942.054 337.364,870.329 339.714,981.301 342.065,872.745 344.415,882.52 346.765,968.11 349.116,867.832 351.466,1044.33 353.817,943.082 356.167,880.828 358.518,765.621 360.868,718.341 363.219,871.08 365.569,768.466 367.92,859.08 370.27,1009.35 372.621,853.328 374.971,822.505 377.322,826.256 379.672,712.37 382.023,1016.15 384.373,1095.5 386.724,1045.61 389.074,811.751 391.424,959.104 393.775,1011.92 396.125,795.901 398.476,921.055 400.826,875.273 403.177,980.714 405.527,1043.34 407.878,821.761 410.228,1050.27 412.579,946.298 414.929,801.866 417.28,893.285 419.63,838.613 421.981,1079.32 424.331,938.356 426.682,866.469 429.032,1090.56 431.382,1001.79 433.733,888.123 436.083,956.166 438.434,1014.35 440.784,946.696 443.135,959.401 445.485,1000.41 447.836,703.24 450.186,1087.81 452.537,966.033 454.887,789.811 457.238,1102.56 459.588,1016.8 461.939,823.124 464.289,878.967 466.64,857.778 468.99,882.471 471.341,1086.37 473.691,1070.28 476.041,914.742 478.392,744.677 480.742,837.203 483.093,973.317 485.443,888.124 487.794,941.385 490.144,980.189 492.495,1124.19 494.845,983.844 497.196,885.202 499.546,894.635 501.897,1015.86 504.247,922.941 506.598,1065.58 508.948,914.822 511.299,975.902 513.649,961.124 515.999,1084.1 518.35,960.321 520.7,967.664 523.051,948.965 525.401,965.365 527.752,978.843 530.102,884.008 532.453,1022.73 534.803,932.652 537.154,936.202 539.504,714.283 541.855,911.1 544.205,812.644 546.556,1055.01 548.906,975.298 551.257,787.157 553.607,807.119 555.958,960.094 558.308,861.168 560.658,947.701 563.009,939.307 565.359,874.916 567.71,1059.74 570.06,903.672 572.411,1050.87 574.761,933.67 577.112,762.672 579.462,985.766 581.813,935.059 584.163,924.872 586.514,899.31 588.864,1136.79 591.215,1112.78 593.565,805.826 595.916,943.113 598.266,1077.68 600.616,1028.4 602.967,891.607 605.317,958.314 607.668,832.741 610.018,879.801 612.369,875.744 614.719,992.484 617.07,1007.88 619.42,821.567 621.771,935.803 624.121,759.558 626.472,929.248 628.822,832.929 631.173,1051.85 633.523,1019.84 635.874,1025.05 638.224,909.836 640.575,1123.69 642.925,953.849 645.275,908.199 647.626,839.692 649.976,841.17 652.327,912.169 654.677,773.258 657.028,928.534 659.378,945.668 661.729,914.732 664.079,876.966 666.43,1012.98 668.78,830.322 671.131,883.624 673.481,953.198 675.832,931.474 678.182,1045.93 680.533,993.008 682.883,792.888 685.233,814.729 687.584,1001.96 689.934,931.983 692.285,992.695 694.635,996.117 696.986,974.634 699.336,930.847 701.687,922.41 704.037,993.675 706.388,1149.71 708.738,978.397 711.089,835.768 713.439,902.994 715.79,944.069 718.14,1076.2 720.491,1005.7 722.841,958.2 725.192,977.083 727.542,702.759 729.892,750.958 732.243,839.833 734.593,1116.96 736.944,933.883 739.294,940.491 741.645,926.55 743.995,850.461 746.346,861.718 748.696,921.862 751.047,1146.29 753.397,860.739 755.748,724.225 758.098,834.642 760.449,835.593 762.799,960.674 765.15,1037.03 767.5,902.247 769.85,980.48 772.201,864.983 774.551,1035.19 776.902,843.249 779.252,868.623 781.603,1150.98 783.953,878.6 786.304,910.316 788.654,1113.25 791.005,982.349 793.355,839.185 795.706,709.872 798.056,1051.16 800.407,956.165 802.757,1152.84 805.108,1071.96 807.458,983.712 809.809,891.113 812.159,1054.49 814.509,1044.54 816.86,888.72 819.21,932.315 821.561,898.138 823.911,961.477 826.262,774.736 828.612,737.944 830.963,958.379 833.313,1101.88 835.664,943.53 838.014,1008.21 840.365,944.436 842.715,889.653 845.066,936.31 847.416,871.027 849.767,1021.11 852.117,979 854.467,1021.2 856.818,1130.22 859.168,758.388 861.519,860.771 863.869,987.251 866.22,999.885 868.57,850.209 870.921,940.879 873.271,998.168 875.622,969.217 877.972,1063.75 880.323,987.069 882.673,1002.23 885.024,845.847 887.374,941.526 889.725,1047.91 892.075,1022.33 894.426,1007.86 896.776,913.938 899.126,961.548 901.477,821.404 903.827,1095.46 906.178,999.33 908.528,1043.23 910.879,1036.27 913.229,851.56 915.58,835.407 917.93,951.769 920.281,882.614 922.631,1103.39 924.982,663.513 927.332,1011.68 929.683,902.699 932.033,880.091 934.384,970.2 936.734,1000.76 939.084,1145.46 941.435,1080.25 943.785,1073.52 946.136,843.096 948.486,897.598 950.837,824.404 953.187,805.743 955.538,942.704 957.888,983.591 960.239,953.511 962.589,978.076 964.94,1016.68 967.29,943.887 969.641,904.283 971.991,994.112 974.342,1116.66 976.692,958.029 979.043,934.878 981.393,951.575 983.743,804.688 986.094,917.514 988.444,1060.03 990.795,900.051 993.145,995.988 995.496,832.565 997.846,870.801 1000.2,852.596 1002.55,933.817 1004.9,926.491 1007.25,835.347 1009.6,1015.75 1011.95,922.244 1014.3,979.798 1016.65,863.078 1019,761.52 1021.35,882.624 1023.7,1007.63 1026.05,933.079 1028.4,997.592 1030.75,942.3 1033.1,1179.99 1035.45,981.707 1037.8,933.346 1040.15,895.515 1042.51,1143.55 1044.86,924.956 1047.21,827.549 1049.56,914.95 1051.91,1072.43 1054.26,892.19 1056.61,885.914 1058.96,918.649 1061.31,1189.44 1063.66,729.15 1066.01,1015.53 1068.36,939.375 1070.71,836.793 1073.06,538.767 1075.41,884.175 1077.76,997.014 1080.11,837.483 1082.46,912.621 1084.81,884.1 1087.16,1027.28 1089.51,960.142 1091.87,964.108 1094.22,980.417 1096.57,1008.52 1098.92,854.804 1101.27,820.893 1103.62,866.42 1105.97,872.547 1108.32,966.141 1110.67,961.543 1113.02,978.255 1115.37,943.084 1117.72,994.481 1120.07,966.422 1122.42,1180.04 1124.77,980.113 1127.12,999.464 1129.47,894.52 1131.82,1001.1 1134.17,890.998 1136.52,763.412 1138.87,934.649 1141.23,896.723 1143.58,855.683 1145.93,1083.35 1148.28,857.135 1150.63,949.495 1152.98,931.575 1155.33,924.651 1157.68,828.432 1160.03,1081.05 1162.38,998.053 1164.73,998.882 1167.08,854.731 1169.43,791.423 1171.78,922.161 1174.13,930.864 1176.48,962.873 1178.83,877.48 1181.18,915.278 1183.53,869.474 1185.88,1022.48 1188.23,851.358 1190.59,923.308 1192.94,951.703 1195.29,1006.5 1197.64,991.669 1199.99,990.883 1202.34,980.481 1204.69,597.084 1207.04,985.859 1209.39,863.659 1211.74,936.872 1214.09,1010.83 1216.44,995.554 1218.79,935.714 1221.14,872.677 1223.49,850.466 1225.84,929.506 1228.19,893.322 1230.54,920.646 1232.89,938.643 1235.24,796.512 1237.59,972.014 1239.94,1117.33 1242.3,951.869 1244.65,915.618 1247,959.246 1249.35,872.757 1251.7,1052.5 1254.05,960.775 1256.4,908.989 1258.75,702.517 1261.1,936.717 1263.45,958.461 1265.8,867.83 1268.15,1108.78 1270.5,975.35 1272.85,869.692 1275.2,908.707 1277.55,863.195 1279.9,983.384 1282.25,868.897 1284.6,857.328 1286.95,848.491 1289.3,1019.77 1291.66,892.699 1294.01,1058.62 1296.36,1029.21 1298.71,1012.53 1301.06,826.972 1303.41,1040.53 1305.76,902.985 1308.11,902.133 1310.46,891.46 1312.81,1026.07 1315.16,839.259 1317.51,823.565 1319.86,986.152 1322.21,807.17 1324.56,961.266 1326.91,1016.93 1329.26,757.435 1331.61,835.292 1333.96,950.008 1336.31,953.519 1338.66,1016.39 1341.02,816.143 1343.37,863.643 1345.72,1043.13 1348.07,984.047 1350.42,811.205 1352.77,880.214 1355.12,1079.58 1357.47,877.991 1359.82,1008.37 1362.17,858.872 1364.52,826.502 1366.87,1059.91 1369.22,779.441 1371.57,793.146 1373.92,827.606 1376.27,923.15 1378.62,857.544 1380.97,992.284 1383.32,835.698 1385.67,904.132 1388.02,852.815 1390.38,925.653 1392.73,978.002 1395.08,959.676 1397.43,813.286 1399.78,919.531 1402.13,899.961 1404.48,1178.57 1406.83,820.186 1409.18,1035.77 1411.53,820.125 1413.88,653.557 1416.23,1013.9 1418.58,839.761 1420.93,877.577 1423.28,1098.42 1425.63,740.627 1427.98,1097.77 1430.33,899.091 1432.68,1015.2 1435.03,872.555 1437.38,808.194 1439.74,818.291 1442.09,958.403 1444.44,866.255 1446.79,924.531 1449.14,858.835 1451.49,999.798 1453.84,947.057 1456.19,1112.43 1458.54,1023.64 1460.89,727.601 1463.24,846.085 1465.59,876.521 1467.94,958.268 1470.29,846.667 1472.64,1038.35 1474.99,921.092 1477.34,797.594 1479.69,1044.28 1482.04,978.482 1484.39,916.5 1486.74,866.334 1489.1,1066.67 1491.45,1038.76 1493.8,1077.11 1496.15,951.922 1498.5,941.803 1500.85,1021.42 1503.2,927.525 1505.55,1014.69 1507.9,969.288 1510.25,974.517 1512.6,1116.52 1514.95,816.225 1517.3,771.845 1519.65,960.446 1522,840.681 1524.35,932.864 1526.7,852.426 1529.05,994.02 1531.4,1029.63 1533.75,902.582 1536.1,993.394 1538.45,880.512 1540.81,967.173 1543.16,1092.68 1545.51,853.226 1547.86,1230.86 1550.21,856.899 1552.56,971.946 1554.91,846.57 1557.26,1075.72 1559.61,1013.73 1561.96,877.461 1564.31,809.753 1566.66,1021.74 1569.01,1010.22 1571.36,945.804 1573.71,939.072 1576.06,822.663 1578.41,1081.44 1580.76,1040.26 1583.11,889.818 1585.46,814.55 1587.81,781.79 1590.17,872.69 1592.52,924.969 1594.87,855.403 1597.22,1079.87 1599.57,932.204 1601.92,1043.52 1604.27,897.741 1606.62,1048.69 1608.97,1038.51 1611.32,941.316 1613.67,720.632 1616.02,1123.52 1618.37,992.723 1620.72,1040.31 1623.07,918.4 1625.42,978.225 1627.77,807.299 1630.12,1139.16 1632.47,853.872 1634.82,844.502 1637.17,875.519 1639.53,924.788 1641.88,1023.37 1644.23,749.948 1646.58,877.305 1648.93,1060.91 1651.28,931.777 1653.63,836.399 1655.98,972.748 1658.33,958.691 1660.68,924.853 1663.03,861.909 1665.38,796.49 1667.73,936.129 1670.08,725.143 1672.43,930.94 1674.78,829.825 1677.13,1017.04 1679.48,948.125 1681.83,1005.93 1684.18,844.681 1686.53,933.108 1688.89,874.801 1691.24,1086.22 1693.59,984.634 1695.94,993.145 1698.29,871.514 1700.64,998.301 1702.99,834.068 1705.34,1115.21 1707.69,916.182 1710.04,868.173 1712.39,648.163 1714.74,841.138 1717.09,868.755 1719.44,884.53 1721.79,983.984 1724.14,755.798 1726.49,812.866 1728.84,1055.72 1731.19,993.782 1733.54,880.443 1735.89,988.747 1738.25,861.256 1740.6,831.726 1742.95,952.623 1745.3,911.763 1747.65,913.129 1750,815.107 1752.35,848.076 1754.7,970.877 1757.05,910.769 1759.4,955.577 1761.75,870.341 1764.1,1067.19 1766.45,935.084 1768.8,871.94 1771.15,938.015 1773.5,949.821 1775.85,860.999 1778.2,727.833 1780.55,888.885 1782.9,773.041 1785.25,840.088 1787.6,778.978 1789.96,932.578 1792.31,918.711 1794.66,676.01 1797.01,922.127 1799.36,923.212 1801.71,810.941 1804.06,754.296 1806.41,1024.86 1808.76,862.495 1811.11,1034.61 1813.46,753.514 1815.81,889.069 1818.16,657.086 1820.51,959.167 1822.86,939.072 1825.21,894.934 1827.56,707.384 1829.91,817.712 1832.26,1011.27 1834.61,1186.17 1836.96,908.275 1839.32,901.727 1841.67,982.231 1844.02,1096.24 1846.37,1080.58 1848.72,891.375 1851.07,936.083 1853.42,985.843 1855.77,986.175 1858.12,806.143 1860.47,937.263 1862.82,831.861 1865.17,961.811 1867.52,865.361 1869.87,852.35 1872.22,938.07 1874.57,691.199 1876.92,1100.42 1879.27,866.815 1881.62,973.596 1883.97,900.962 1886.32,857.277 1888.68,743.134 1891.03,899.165 1893.38,1036.29 1895.73,1063.72 1898.08,935.016 1900.43,1008.38 1902.78,895.037 1905.13,1044.66 1907.48,1021.26 1909.83,1047.61 1912.18,1041.01 1914.53,777.247 1916.88,967.875 1919.23,1023.94 1921.58,914.154 1923.93,881.594 1926.28,914.073 1928.63,903.759 1930.98,989.964 1933.33,880.242 1935.68,913.91 1938.04,740.425 1940.39,867.157 1942.74,1111.49 1945.09,1003.28 1947.44,1146.8 1949.79,1026.64 1952.14,923.841 1954.49,913.407 1956.84,879.956 1959.19,769.137 1961.54,797.246 1963.89,968.364 1966.24,879.884 1968.59,997.804 1970.94,875.378 1973.29,1070.76 1975.64,871.823 1977.99,912.022 1980.34,957.74 1982.69,1119.97 1985.04,911.935 1987.4,953.285 1989.75,1032.03 1992.1,811.315 1994.45,1028.02 1996.8,852.544 1999.15,800.379 2001.5,830.749 2003.85,837.079 2006.2,946.998 2008.55,873.485 2010.9,973.125 2013.25,966.672 2015.6,1065.15 2017.95,1162.52 2020.3,1141.42 2022.65,686.343 2025,862.507 2027.35,1151.92 2029.7,969.133 2032.05,742.541 2034.4,792.678 2036.76,710.924 2039.11,746.387 2041.46,744.413 2043.81,918.845 2046.16,939.753 2048.51,748.749 2050.86,879.351 2053.21,926.942 2055.56,823.217 2057.91,831.993 2060.26,770.214 2062.61,1068.4 2064.96,932.878 2067.31,919.38 2069.66,854.891 2072.01,887.654 2074.36,928.03 2076.71,1024.02 2079.06,1143.08 2081.41,870.12 2083.76,908.854 2086.11,941.024 2088.47,1118.27 2090.82,852.307 2093.17,878.872 2095.52,948.76 2097.87,854.347 2100.22,987.161 2102.57,1115.57 2104.92,1005.57 2107.27,1024.79 2109.62,868.162 2111.97,823.279 2114.32,891.352 2116.67,1069.66 2119.02,1126.01 2121.37,754.689 2123.72,922.405 2126.07,650.236 2128.42,910.672 2130.77,888.344 2133.12,913.478 2135.47,655.3 2137.83,919.697 2140.18,838.306 2142.53,1116.39 2144.88,817.36 2147.23,887.01 2149.58,893.097 2151.93,1092.51 2154.28,976.75 2156.63,943.594 2158.98,1149.76 2161.33,847.054 2163.68,841.222 2166.03,953.762 2168.38,805.445 2170.73,750.467 2173.08,949.956 2175.43,976.817 2177.78,867.503 2180.13,827.544 2182.48,959.009 2184.83,864.588 2187.19,1000.9 2189.54,987.867 2191.89,1031.15 2194.24,763.367 2196.59,970.272 2198.94,891.377 2201.29,934.744 2203.64,899.353 2205.99,864.762 2208.34,843.342 2210.69,962.139 2213.04,730.94 2215.39,1013.65 2217.74,931.042 2220.09,902.207 2222.44,748.745 2224.79,846.567 2227.14,914.978 2229.49,887.774 2231.84,839.432 2234.19,887.119 2236.55,871.272 2238.9,823.672 2241.25,847.032 2243.6,790.053 2245.95,981.956 2248.3,886.407 2250.65,870.951 2253,985.695 2255.35,821.57 2257.7,868.318 2260.05,1029.49 2262.4,1137.84 2264.75,917.397 2267.1,1077.27 2269.45,1075.3 2271.8,847.037 2274.15,917.707 2276.5,936.33 2278.85,986.684 2281.2,927.346 2283.55,1145.87 2285.91,875.185 2288.26,962.009 2290.61,1032.78 2292.96,906.048 2295.31,918.455 2297.66,752.957 2300.01,1069.64 2302.36,925.99 2304.71,945.061 2307.06,907.391 2309.41,812.548 2311.76,1007.34 2314.11,843.969 2316.46,867.634 2318.81,903.624 2321.16,1167.49 2323.51,905.639 2325.86,903.539 2328.21,974.766 2330.56,764.837 2332.91,1052.35 2335.27,1046.4 2337.62,1037.68 2339.97,946.109 2342.32,940.737 2344.67,842.651 2347.02,835.156 2349.37,853.69 2351.72,856.505 2354.07,913.663 2356.42,972.951 2358.77,883.803 2361.12,933.543 2363.47,964.596 2365.82,707.452 2368.17,964.445 2370.52,858.497 2372.87,1071.39 2375.22,782.98 2377.57,946.881 2379.92,803.672 2382.27,1029.03 2384.62,870.2 2386.98,976.819 2389.33,737.732 2391.68,754.197 2394.03,966.32 2396.38,961.337 2398.73,986.56 2401.08,1064.15 2403.43,970.522 2405.78,927.344 2408.13,855.839 2410.48,1035.5 2412.83,1087.19 2415.18,889.341 2417.53,1012.63 2419.88,878.128 2422.23,950.215 2424.58,915.607 2426.93,763.432 2429.28,960.22 2431.63,835.242 2433.98,686.073 2436.34,835.859 2438.69,877.599 2441.04,1044.8 2443.39,993.563 2445.74,943.863 2448.09,982.077 2450.44,749.865 2452.79,939.012 2455.14,860.403 2457.49,1167.59 2459.84,997.774 2462.19,962.148 2464.54,837.474 2466.89,927.382 2469.24,1016.01 2471.59,914.851 2473.94,1036.68 2476.29,845.785 2478.64,912.12 2480.99,817.693 2483.34,828.193 2485.7,1088.7 2488.05,932.297 2490.4,970.72 2492.75,887.476 2495.1,952.422 2497.45,694.443 2499.8,878.142 2502.15,930.392 2504.5,973.125 2506.85,916.777 2509.2,1060.01 2511.55,948.954 2513.9,888.926 2516.25,1032.91 2518.6,934.474 2520.95,1059.6 2523.3,931.41 2525.65,966.807 2528,888.215 2530.35,949.114 2532.7,906.316 2535.06,901.327 2537.41,884.986 2539.76,945.154 2542.11,1071.34 2544.46,778.665 2546.81,864.373 2549.16,991.852 2551.51,1004.41 2553.86,1049.57 2556.21,1115.7 2558.56,1000.02 2560.91,1041.7 2563.26,891.271 2565.61,990.634 2567.96,922.614 2570.31,844.418 "></polyline>
<polyline clip-path="url(#clip152)" style="stroke:#3da44d; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,512.806 224.541,321.639 226.891,659.406 229.242,366.891 231.592,351.337 233.943,316.636 236.293,451.141 238.644,260.844 240.994,542.38 243.345,660.735 245.695,502.098 248.046,383.656 250.396,556.103 252.747,264.696 255.097,351.981 257.448,348.586 259.798,467.076 262.148,563.349 264.499,409.231 266.849,275.328 269.2,370.152 271.55,270.201 273.901,533.96 276.251,461.387 278.602,409.284 280.952,308.067 283.303,456.963 285.653,285.075 288.004,456.259 290.354,274.243 292.705,653.887 295.055,555.501 297.406,523.228 299.756,466.081 302.107,512.153 304.457,334.499 306.807,322.965 309.158,487.476 311.508,473.525 313.859,311.808 316.209,411.781 318.56,327.807 320.91,391.397 323.261,403.176 325.611,478.695 327.962,427.796 330.312,509.694 332.663,342.557 335.013,408.792 337.364,548.213 339.714,362.987 342.065,365.69 344.415,365.172 346.765,311.844 349.116,584.913 351.466,512.949 353.817,269.859 356.167,379.707 358.518,405.508 360.868,520.349 363.219,469.801 365.569,688.95 367.92,479.89 370.27,180.428 372.621,414.976 374.971,652.27 377.322,206.471 379.672,526.583 382.023,438.22 384.373,445.975 386.724,630.638 389.074,269.572 391.424,345.967 393.775,473.93 396.125,96.8724 398.476,469.592 400.826,415.361 403.177,456.407 405.527,411.362 407.878,372.548 410.228,503.343 412.579,424.433 414.929,523.342 417.28,374.02 419.63,567.192 421.981,531.485 424.331,570.345 426.682,354.105 429.032,365.932 431.382,336.471 433.733,426.862 436.083,488.841 438.434,525.516 440.784,602.627 443.135,378.855 445.485,324.666 447.836,526.404 450.186,373.104 452.537,472.963 454.887,354.217 457.238,306.317 459.588,397.942 461.939,506.074 464.289,378.618 466.64,546.26 468.99,345.881 471.341,437.724 473.691,474.4 476.041,605.129 478.392,352.866 480.742,466.827 483.093,311.176 485.443,395.003 487.794,298.687 490.144,520.661 492.495,299.485 494.845,407.006 497.196,500.389 499.546,398.559 501.897,428.704 504.247,477.093 506.598,581.967 508.948,311.739 511.299,486.979 513.649,397.048 515.999,575.005 518.35,442.071 520.7,559.243 523.051,383.361 525.401,183.633 527.752,424.987 530.102,644.258 532.453,296.962 534.803,410.684 537.154,479.141 539.504,416.364 541.855,202.675 544.205,403.631 546.556,291.419 548.906,350.149 551.257,490.371 553.607,331.59 555.958,448.894 558.308,529.498 560.658,383.222 563.009,467.341 565.359,459.464 567.71,462.433 570.06,557.749 572.411,293.469 574.761,578.267 577.112,376.134 579.462,381.534 581.813,378.991 584.163,572.529 586.514,280.766 588.864,344.671 591.215,454.906 593.565,528.05 595.916,449.521 598.266,360.784 600.616,497.055 602.967,382.249 605.317,321.449 607.668,462.401 610.018,484.054 612.369,597.855 614.719,178.33 617.07,289.2 619.42,373.712 621.771,474.449 624.121,516.818 626.472,375.355 628.822,487.808 631.173,521.147 633.523,385.638 635.874,464.408 638.224,429.348 640.575,418.273 642.925,573.332 645.275,389.956 647.626,470.739 649.976,429.937 652.327,479.644 654.677,396.231 657.028,352.425 659.378,382.155 661.729,297.9 664.079,389.972 666.43,255.106 668.78,401.363 671.131,450.594 673.481,517.343 675.832,424.332 678.182,307.207 680.533,281.226 682.883,393.814 685.233,388.665 687.584,440.223 689.934,442.969 692.285,403.471 694.635,451.002 696.986,422.477 699.336,311.03 701.687,573.934 704.037,461.413 706.388,293.1 708.738,443.857 711.089,594.526 713.439,447.491 715.79,496.442 718.14,485.536 720.491,566.905 722.841,492.789 725.192,448.32 727.542,598.147 729.892,484.007 732.243,418.891 734.593,431.106 736.944,538.807 739.294,342.636 741.645,417.94 743.995,250.816 746.346,386.894 748.696,453.853 751.047,484.772 753.397,441.991 755.748,526.148 758.098,647.061 760.449,354.665 762.799,543.037 765.15,496.483 767.5,436.427 769.85,490.697 772.201,568.03 774.551,472.289 776.902,379.944 779.252,525.509 781.603,498.552 783.953,453.642 786.304,327.189 788.654,413.398 791.005,362.496 793.355,597.57 795.706,467.792 798.056,343.461 800.407,501.27 802.757,224.889 805.108,307.599 807.458,368.195 809.809,291.393 812.159,446.103 814.509,282.952 816.86,494.857 819.21,496.07 821.561,466.096 823.911,555.513 826.262,491.794 828.612,544.623 830.963,421.128 833.313,440.681 835.664,369.652 838.014,525.712 840.365,468.837 842.715,433.593 845.066,493.967 847.416,366.498 849.767,287.558 852.117,409.677 854.467,687.326 856.818,577.057 859.168,324.764 861.519,361.215 863.869,418.014 866.22,291.722 868.57,258.756 870.921,502.559 873.271,473.126 875.622,545.472 877.972,583.703 880.323,228.711 882.673,508.584 885.024,320.695 887.374,242.701 889.725,250.26 892.075,320.64 894.426,493.699 896.776,394.102 899.126,442.881 901.477,448.582 903.827,234.393 906.178,415.838 908.528,419.136 910.879,449.77 913.229,340.862 915.58,351.404 917.93,392.834 920.281,581.644 922.631,745.413 924.982,542.572 927.332,247.125 929.683,392.349 932.033,540.87 934.384,356.324 936.734,496.717 939.084,493.915 941.435,438.43 943.785,410.117 946.136,563.628 948.486,278.016 950.837,397.616 953.187,536.28 955.538,387.05 957.888,387.099 960.239,359.254 962.589,380.179 964.94,471.852 967.29,538.659 969.641,325.491 971.991,453.657 974.342,382.043 976.692,647.353 979.043,602.977 981.393,494.091 983.743,240.597 986.094,415.893 988.444,240.24 990.795,473.477 993.145,625.543 995.496,237.355 997.846,531.92 1000.2,322.489 1002.55,412.118 1004.9,521.475 1007.25,471.187 1009.6,476.341 1011.95,472.585 1014.3,535.434 1016.65,379.515 1019,459.173 1021.35,437.274 1023.7,205.027 1026.05,577.953 1028.4,501.226 1030.75,586.629 1033.1,467.609 1035.45,640.299 1037.8,440.906 1040.15,533.4 1042.51,389.753 1044.86,583.749 1047.21,435.536 1049.56,511.185 1051.91,455.526 1054.26,547.694 1056.61,644.2 1058.96,358.249 1061.31,498.108 1063.66,413.425 1066.01,449.321 1068.36,583.832 1070.71,324.944 1073.06,601.484 1075.41,364.24 1077.76,489.714 1080.11,306.497 1082.46,280.372 1084.81,513.055 1087.16,362.624 1089.51,314.061 1091.87,492.892 1094.22,526.418 1096.57,394.214 1098.92,405.054 1101.27,397.11 1103.62,553.478 1105.97,467.548 1108.32,586.083 1110.67,574.426 1113.02,398.518 1115.37,519.772 1117.72,608.977 1120.07,562.63 1122.42,471.05 1124.77,361.142 1127.12,361.558 1129.47,179.264 1131.82,332.631 1134.17,459.607 1136.52,380.2 1138.87,480.62 1141.23,519.269 1143.58,283.919 1145.93,478.687 1148.28,558.715 1150.63,410.774 1152.98,567.384 1155.33,378.444 1157.68,491.861 1160.03,465.557 1162.38,538.93 1164.73,444.235 1167.08,559.244 1169.43,424.91 1171.78,390.808 1174.13,413.972 1176.48,408.727 1178.83,231.494 1181.18,453.828 1183.53,522.742 1185.88,348.929 1188.23,300.313 1190.59,296.865 1192.94,500.634 1195.29,435.433 1197.64,503.866 1199.99,331.724 1202.34,426.974 1204.69,361.426 1207.04,481.036 1209.39,355.31 1211.74,471.8 1214.09,444.208 1216.44,360.949 1218.79,408.394 1221.14,465.578 1223.49,349.772 1225.84,199.756 1228.19,490.924 1230.54,444.073 1232.89,384.045 1235.24,563.744 1237.59,342.744 1239.94,362.033 1242.3,580.143 1244.65,248.914 1247,380.261 1249.35,339.202 1251.7,98.864 1254.05,383.212 1256.4,385.389 1258.75,448.271 1261.1,572.929 1263.45,504.519 1265.8,428.442 1268.15,507.534 1270.5,456.641 1272.85,308.524 1275.2,415.687 1277.55,372.38 1279.9,475.242 1282.25,414.515 1284.6,382.384 1286.95,433.455 1289.3,333.831 1291.66,403.758 1294.01,604.972 1296.36,620.998 1298.71,314.08 1301.06,265.247 1303.41,415.01 1305.76,335.04 1308.11,389.173 1310.46,424.356 1312.81,341.047 1315.16,359.271 1317.51,509.923 1319.86,587.861 1322.21,472.628 1324.56,394.655 1326.91,230.345 1329.26,410.792 1331.61,415.586 1333.96,315.904 1336.31,402.452 1338.66,489.709 1341.02,339.102 1343.37,214.71 1345.72,512.562 1348.07,524.124 1350.42,527.707 1352.77,351.331 1355.12,572.268 1357.47,498.321 1359.82,469.259 1362.17,413.662 1364.52,514.576 1366.87,542.735 1369.22,446.257 1371.57,595.399 1373.92,424.622 1376.27,526.797 1378.62,390.494 1380.97,499.335 1383.32,458.523 1385.67,443.811 1388.02,600.918 1390.38,350.977 1392.73,377.021 1395.08,439.622 1397.43,340.034 1399.78,609.202 1402.13,462.719 1404.48,465.035 1406.83,561.486 1409.18,588.193 1411.53,521.553 1413.88,500.365 1416.23,395.111 1418.58,283.841 1420.93,321.246 1423.28,574.802 1425.63,325.947 1427.98,284.999 1430.33,386.655 1432.68,370.771 1435.03,327.954 1437.38,500.96 1439.74,373.162 1442.09,383.609 1444.44,269.08 1446.79,531.809 1449.14,437.644 1451.49,538.194 1453.84,212.884 1456.19,451.695 1458.54,332.076 1460.89,362.146 1463.24,527.013 1465.59,589.737 1467.94,290.788 1470.29,460.816 1472.64,377.817 1474.99,265.384 1477.34,579.195 1479.69,480.863 1482.04,597.644 1484.39,354.526 1486.74,239.261 1489.1,351.694 1491.45,334.126 1493.8,522.468 1496.15,575.218 1498.5,415.635 1500.85,201.319 1503.2,484.039 1505.55,397.417 1507.9,459.166 1510.25,257.846 1512.6,388.85 1514.95,443.514 1517.3,303.881 1519.65,341.034 1522,451.885 1524.35,494.226 1526.7,489.407 1529.05,319.052 1531.4,370.04 1533.75,504.945 1536.1,610.171 1538.45,445.077 1540.81,507.097 1543.16,417.586 1545.51,409.718 1547.86,469.201 1550.21,510.805 1552.56,337.413 1554.91,384.745 1557.26,372.618 1559.61,479.021 1561.96,412.95 1564.31,558.619 1566.66,364.141 1569.01,533.24 1571.36,374.38 1573.71,280.991 1576.06,496.746 1578.41,435.001 1580.76,372.658 1583.11,540.734 1585.46,297.141 1587.81,320.675 1590.17,491.412 1592.52,616.905 1594.87,258.637 1597.22,376.462 1599.57,330.075 1601.92,355.808 1604.27,224.148 1606.62,316.581 1608.97,343.391 1611.32,186.043 1613.67,359.135 1616.02,402.603 1618.37,313.449 1620.72,471.716 1623.07,596.574 1625.42,310.183 1627.77,456.676 1630.12,503.761 1632.47,421.134 1634.82,343.464 1637.17,482.439 1639.53,405.636 1641.88,470.058 1644.23,333.197 1646.58,444.296 1648.93,282.691 1651.28,532.114 1653.63,400.658 1655.98,390.296 1658.33,427.34 1660.68,414.92 1663.03,741.214 1665.38,383.016 1667.73,249.288 1670.08,692.013 1672.43,512.484 1674.78,266.357 1677.13,459.789 1679.48,484.545 1681.83,518.742 1684.18,519.176 1686.53,454.834 1688.89,260.211 1691.24,265.14 1693.59,541.303 1695.94,428.981 1698.29,440.413 1700.64,236.713 1702.99,402.606 1705.34,496.304 1707.69,496.231 1710.04,456.233 1712.39,405.063 1714.74,449.163 1717.09,472.294 1719.44,456.187 1721.79,573.469 1724.14,413.846 1726.49,346.829 1728.84,449.64 1731.19,470.812 1733.54,425.211 1735.89,280.591 1738.25,352.109 1740.6,615.946 1742.95,525.401 1745.3,449.829 1747.65,473.904 1750,533.438 1752.35,355.998 1754.7,597.654 1757.05,265.61 1759.4,300.868 1761.75,502.409 1764.1,176.514 1766.45,464.957 1768.8,364.328 1771.15,457.25 1773.5,314.855 1775.85,395.395 1778.2,220.863 1780.55,479.162 1782.9,301.237 1785.25,370.665 1787.6,360.18 1789.96,325.197 1792.31,415.118 1794.66,553.199 1797.01,418.009 1799.36,564.732 1801.71,440.951 1804.06,495.872 1806.41,235.126 1808.76,416.182 1811.11,452.249 1813.46,369.176 1815.81,337.884 1818.16,338.573 1820.51,437.947 1822.86,401.565 1825.21,407.033 1827.56,409.707 1829.91,335.268 1832.26,493.602 1834.61,429.185 1836.96,253.604 1839.32,476.694 1841.67,310.417 1844.02,435.457 1846.37,489.323 1848.72,548.971 1851.07,387.969 1853.42,459.954 1855.77,485.988 1858.12,430.7 1860.47,330.994 1862.82,474.728 1865.17,649.853 1867.52,382.573 1869.87,502.161 1872.22,322.137 1874.57,747.288 1876.92,439.109 1879.27,339.087 1881.62,331.926 1883.97,287.822 1886.32,415.293 1888.68,360.528 1891.03,609.677 1893.38,491.319 1895.73,410.996 1898.08,528.689 1900.43,396.653 1902.78,479.153 1905.13,467.148 1907.48,162.158 1909.83,336.061 1912.18,267.549 1914.53,430.668 1916.88,277.676 1919.23,421.258 1921.58,585.741 1923.93,422.942 1926.28,458.303 1928.63,441.206 1930.98,511.979 1933.33,447.491 1935.68,497.163 1938.04,411.882 1940.39,486.703 1942.74,403.989 1945.09,265.538 1947.44,289.191 1949.79,397.614 1952.14,679.342 1954.49,620.01 1956.84,357.406 1959.19,386.068 1961.54,326.948 1963.89,513.22 1966.24,317.233 1968.59,292.727 1970.94,419.825 1973.29,438.557 1975.64,489.28 1977.99,373.128 1980.34,298.593 1982.69,670.983 1985.04,511.713 1987.4,399.613 1989.75,362.87 1992.1,327.181 1994.45,627.631 1996.8,445.024 1999.15,125.448 2001.5,277.852 2003.85,573.38 2006.2,228.865 2008.55,478.371 2010.9,393.649 2013.25,183.987 2015.6,505.764 2017.95,507.944 2020.3,513.467 2022.65,512.575 2025,396.19 2027.35,321.093 2029.7,558.214 2032.05,398.376 2034.4,534.191 2036.76,423.873 2039.11,485.894 2041.46,475.544 2043.81,546.695 2046.16,401.927 2048.51,445.093 2050.86,503.032 2053.21,472.632 2055.56,577.935 2057.91,436.228 2060.26,434.558 2062.61,252.055 2064.96,491.968 2067.31,578.104 2069.66,547.183 2072.01,538.135 2074.36,536.602 2076.71,574.879 2079.06,236.869 2081.41,456.19 2083.76,477.717 2086.11,439.265 2088.47,384.056 2090.82,426.604 2093.17,378.45 2095.52,408.676 2097.87,609.491 2100.22,304.01 2102.57,164.793 2104.92,531.92 2107.27,396.889 2109.62,497.893 2111.97,531.382 2114.32,338.392 2116.67,511.578 2119.02,382.65 2121.37,433.308 2123.72,212.264 2126.07,496.589 2128.42,352.577 2130.77,434.216 2133.12,442.625 2135.47,389.921 2137.83,478.907 2140.18,560.921 2142.53,403.912 2144.88,451.019 2147.23,317.425 2149.58,428.804 2151.93,341.748 2154.28,555.628 2156.63,397.493 2158.98,244.965 2161.33,472.726 2163.68,413.606 2166.03,431.494 2168.38,551.962 2170.73,456.784 2173.08,543.595 2175.43,630.111 2177.78,460.525 2180.13,352.926 2182.48,502.09 2184.83,402.848 2187.19,371.531 2189.54,328.05 2191.89,542.506 2194.24,359.4 2196.59,378.757 2198.94,430.725 2201.29,400.378 2203.64,407.048 2205.99,167.597 2208.34,282.545 2210.69,594.032 2213.04,352.151 2215.39,336.656 2217.74,426.353 2220.09,397.165 2222.44,428.072 2224.79,400.897 2227.14,437.589 2229.49,470.117 2231.84,350.143 2234.19,437.637 2236.55,336.227 2238.9,385.097 2241.25,497.555 2243.6,426.055 2245.95,526.046 2248.3,575.435 2250.65,452.154 2253,357.459 2255.35,491.3 2257.7,432.266 2260.05,567.241 2262.4,441.888 2264.75,516.346 2267.1,540.15 2269.45,436.703 2271.8,216.869 2274.15,303.143 2276.5,354.637 2278.85,359.197 2281.2,257.584 2283.55,198.861 2285.91,592.743 2288.26,517.745 2290.61,331.169 2292.96,283.908 2295.31,474.98 2297.66,255.797 2300.01,506.417 2302.36,296.746 2304.71,545.283 2307.06,276.451 2309.41,489.376 2311.76,361.618 2314.11,337.388 2316.46,433.264 2318.81,452.91 2321.16,358.206 2323.51,526.563 2325.86,506.044 2328.21,484.433 2330.56,410.897 2332.91,435.603 2335.27,321.683 2337.62,421.63 2339.97,372.473 2342.32,483.041 2344.67,259.686 2347.02,285.896 2349.37,198.254 2351.72,411.89 2354.07,518.016 2356.42,510.465 2358.77,493.524 2361.12,491.276 2363.47,432.878 2365.82,418.246 2368.17,413.008 2370.52,537.01 2372.87,419.336 2375.22,413.672 2377.57,343.148 2379.92,324.821 2382.27,505.595 2384.62,377.216 2386.98,458.46 2389.33,267.026 2391.68,415.653 2394.03,342.412 2396.38,309.457 2398.73,596.517 2401.08,360.576 2403.43,318.133 2405.78,504.121 2408.13,419.054 2410.48,564.614 2412.83,319.014 2415.18,392.658 2417.53,625.722 2419.88,397.304 2422.23,685.286 2424.58,456.477 2426.93,302.937 2429.28,342.853 2431.63,340.828 2433.98,210.624 2436.34,267.509 2438.69,584.02 2441.04,583.267 2443.39,260.187 2445.74,297.628 2448.09,391.969 2450.44,533.829 2452.79,563.534 2455.14,349.574 2457.49,355.593 2459.84,409.546 2462.19,402.128 2464.54,370.605 2466.89,379.186 2469.24,356.423 2471.59,458.309 2473.94,394.978 2476.29,369.217 2478.64,499.485 2480.99,471.614 2483.34,653.291 2485.7,469.72 2488.05,432.921 2490.4,318.662 2492.75,563.307 2495.1,456.514 2497.45,506.117 2499.8,451.246 2502.15,294.329 2504.5,276.746 2506.85,430.67 2509.2,329.475 2511.55,416.159 2513.9,423.805 2516.25,414.777 2518.6,564.532 2520.95,519.431 2523.3,369.243 2525.65,482.657 2528,435.521 2530.35,452.246 2532.7,331.651 2535.06,345.973 2537.41,368.941 2539.76,374.98 2542.11,447.923 2544.46,454.918 2546.81,587.858 2549.16,207.372 2551.51,511.783 2553.86,428.83 2556.21,437.476 2558.56,598.735 2560.91,272.264 2563.26,490.098 2565.61,298.69 2567.96,367.313 2570.31,409.236 "></polyline>
</svg>
</div>
</div>
<p>Look at that! Things are working; amazin’.</p>
<p>We can also exploit <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>’s parallel sampling capabilities:</p>
<div id="34" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run separate 4 chains for 10 000 iterations using threads to parallelize.</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>num_chains <span class="op">=</span> <span class="fl">4</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    model_with_grad,</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">MCMCThreads</span>(),</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>,</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    num_chains;</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Note we need to provide an initial state for every chain.</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>    initial_state<span class="op">=</span><span class="fu">fill</span>(state, num_chains),</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>samples_array <span class="op">=</span> <span class="fu">stack</span>(<span class="fu">map</span>(<span class="bu">Base</span>.<span class="fu">Fix1</span>(stack, sample <span class="op">-&gt;</span> sample.x), samples))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000×4 Array{Float64, 3}:
[:, :, 1] =
 -2.52647   -3.21214   -4.48848   …  -4.21551   -2.93858   -4.89216
  0.545175  -0.083697   0.442596     -0.258242   0.227152   0.464991
  2.63333    3.13187    3.56553       2.62546    4.71785    5.00595

[:, :, 2] =
 -3.2803     -3.13606  -4.41263  -5.82076  …  -4.61706   -5.04244  -5.5798
 -0.0412755   2.14065   2.75332   1.33146     -0.205106  -0.68907  -1.38122
  1.76718     3.85323   3.13406   2.65931      5.05945    6.18568   6.87264

[:, :, 3] =
 -2.046    -3.77758  -4.84472   -6.53556  …  -3.5962    -5.0152    -5.82163
 -2.02832  -1.85279  -0.617397  -2.07227      0.378916  -0.249971  -0.335922
  1.97936   2.73504   4.13447    5.59307      3.53385    3.20428    4.58768

[:, :, 4] =
 -3.56047   -3.43569   -6.15353  -5.27041  …  -3.92533  -4.39369   -4.61103
  0.355346   0.542528   0.18104   1.04321     -0.58533  -0.267744  -1.41049
  2.34492    4.76396    6.11238   5.40202      2.85108   5.45776    3.57699</code></pre>
</div>
</div>
<p>But the fact that we have to provide the <code>AbstractMCMC.sample</code> call, etc. with an <code>initial_state</code> to get started is a bit annoying. We can avoid this by also defining a <code>AbstractMCMC.step</code> <em>without</em> the <code>state</code> argument:</p>
<div id="36" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">::</span><span class="dt">MALA</span>;</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># </span><span class="al">NOTE</span><span class="co">: No state provided!</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just create the initial state by sampling using  a Gaussian.</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="fu">randn</span>(rng, LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(x), <span class="fu">MALAState</span>(x)</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Equipped with this, we no longer need to provide the <code>initial_state</code> everywhere:</p>
<div id="38" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -5.00046    1.0153
  0.0087964  0.989486
  5.00457    0.99672</code></pre>
</div>
</div>
</section>
<section id="using-our-sampler-with-turing.jl" class="level2">
<h2 class="anchored" data-anchor-id="using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</h2>
<p>As we promised, all of this hassle of implementing our <code>MALA</code> sampler in a way that uses <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> and <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> gets us something more than <em>just</em> an “automatic” implementation of <code>AbstractMCMC.sample</code>.</p>
<p>It also enables use with Turing.jl through the <code>externalsampler</code>, but we need to do one final thing first: we need to tell Turing.jl how to extract a vector of parameters from the “sample” returned in our implementation of <code>AbstractMCMC.step</code>. In our case, the “sample” is a <code>MALASample</code>, so we just need the following line:</p>
<div id="40" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load Turing.jl.</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Turing</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Overload the `getparams` method for our "sample" type, which is just a vector.</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>Turing.Inference.<span class="fu">getparams</span>(<span class="op">::</span><span class="dt">Turing.Model</span>, sample<span class="op">::</span><span class="dt">MALASample</span>) <span class="op">=</span> sample.x</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And with that, we’re good to go!</p>
<div id="42" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Our previous model defined as a Turing.jl model.</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">mvnormal_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">MvNormal</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.], I)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate our model.</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">mvnormal_model</span>()</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Call `sample` but now we're passing in a Turing.jl `model` and wrapping</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co"># our `MALA` sampler in the `externalsampler` to tell Turing.jl that the sampler</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co"># expects something that implements LogDensityProblems.jl.</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×4×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 3.1 seconds
Compute duration  = 3.1 seconds
parameters        = x[1], x[2], x[3]
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters  </span><span class="ansi-bold">    mean  </span><span class="ansi-bold">     std  </span><span class="ansi-bold">    mcse  </span><span class="ansi-bold">  ess_bulk  </span><span class="ansi-bold">  ess_tail  </span><span class="ansi-bold">    rhat  </span><span class="ansi-bold"> ⋯
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">   Float64  </span><span class="ansi-bright-black-fg ansi-bold">   Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> ⋯

        x[1]   -5.0178    0.9943    0.0175   3239.7531   5271.5561    1.0000   ⋯
        x[2]    0.0078    0.9987    0.0177   3167.4152   5394.9887    1.0009   ⋯
        x[3]    5.0014    0.9973    0.0173   3334.6619   5291.4065    1.0004   ⋯
</span><span class="ansi-cyan-fg ansi-bold">                                                                1 column omitted

Quantiles
 </span><span class="ansi-cyan-fg ansi-bold"> parameters  </span><span class="ansi-cyan-fg ansi-bold">    2.5%  </span><span class="ansi-cyan-fg ansi-bold">   25.0%  </span><span class="ansi-cyan-fg ansi-bold">   50.0%  </span><span class="ansi-cyan-fg ansi-bold">   75.0%  </span><span class="ansi-cyan-fg ansi-bold">   97.5%
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64

        x[1]   -6.9651   -5.7028   -5.0091   -4.3350   -3.0888
        x[2]   -1.9267   -0.6747    0.0026    0.6870    1.9757
        x[3]    3.0357    4.3525    5.0031    5.6627    6.9619
</span></pre>
</div>
</div>
</div>
<p>Pretty neat, eh?</p>
<section id="models-with-constrained-parameters" class="level3">
<h3 class="anchored" data-anchor-id="models-with-constrained-parameters">Models with constrained parameters</h3>
<p>One thing we’ve sort of glossed over in all of the above is that MALA, at least how we’ve implemented it, requires <span class="math inline">\(x\)</span> to live in <span class="math inline">\(\mathbb{R}^d\)</span> for some <span class="math inline">\(d &gt; 0\)</span>. If some of the parameters were in fact constrained, e.g.&nbsp;we were working with a <code>Beta</code> distribution which has support on the interval <span class="math inline">\((0, 1)\)</span>, <em>not</em> on <span class="math inline">\(\mathbb{R}^d\)</span>, we could easily end up outside of the valid range <span class="math inline">\((0, 1)\)</span>.</p>
<div id="44" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">beta_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">beta_model</span>()</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 1.96 seconds
Compute duration  = 1.96 seconds
parameters        = x
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters  </span><span class="ansi-bold">    mean  </span><span class="ansi-bold">     std  </span><span class="ansi-bold">    mcse  </span><span class="ansi-bold">  ess_bulk  </span><span class="ansi-bold">  ess_tail  </span><span class="ansi-bold">    rhat  </span><span class="ansi-bold"> ⋯
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">   Float64  </span><span class="ansi-bright-black-fg ansi-bold">   Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> ⋯

           x    0.5008    0.1895    0.0029   4083.7621   5657.1287    1.0008   ⋯
</span><span class="ansi-cyan-fg ansi-bold">                                                                1 column omitted

Quantiles
 </span><span class="ansi-cyan-fg ansi-bold"> parameters  </span><span class="ansi-cyan-fg ansi-bold">    2.5%  </span><span class="ansi-cyan-fg ansi-bold">   25.0%  </span><span class="ansi-cyan-fg ansi-bold">   50.0%  </span><span class="ansi-cyan-fg ansi-bold">   75.0%  </span><span class="ansi-cyan-fg ansi-bold">   97.5%
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64

           x    0.1431    0.3600    0.5029    0.6414    0.8531
</span></pre>
</div>
</div>
</div>
<p>Yep, that still works, but only because Turing.jl actually <em>transforms</em> the <code>turing_model</code> from constrained to unconstrained, so that the <code>sampler</code> provided to <code>externalsampler</code> is actually always working in unconstrained space! This is not always desirable, so we can turn this off:</p>
<div id="46" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 0.18 seconds
Compute duration  = 0.18 seconds
parameters        = x
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters  </span><span class="ansi-bold">    mean  </span><span class="ansi-bold">     std  </span><span class="ansi-bold">    mcse  </span><span class="ansi-bold"> ess_bulk  </span><span class="ansi-bold"> ess_tail  </span><span class="ansi-bold">    rhat  </span><span class="ansi-bold"> e ⋯
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">  Float64  </span><span class="ansi-bright-black-fg ansi-bold">  Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">   ⋯

           x    0.4944    0.1682    0.0181    63.2622    29.5624    1.0190     ⋯
</span><span class="ansi-cyan-fg ansi-bold">                                                                1 column omitted

Quantiles
 </span><span class="ansi-cyan-fg ansi-bold"> parameters  </span><span class="ansi-cyan-fg ansi-bold">    2.5%  </span><span class="ansi-cyan-fg ansi-bold">   25.0%  </span><span class="ansi-cyan-fg ansi-bold">   50.0%  </span><span class="ansi-cyan-fg ansi-bold">   75.0%  </span><span class="ansi-cyan-fg ansi-bold">   97.5%
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64

           x    0.2331    0.3475    0.4941    0.6332    0.7890
</span></pre>
</div>
</div>
</div>
<p>The fun thing is that this still sort of works because</p>
<div id="48" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">logpdf</span>(<span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>), <span class="fl">10.0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-Inf</code></pre>
</div>
</div>
<p>and so the samples that fall outside of the range are always rejected. But do notice how much worse all the diagnostics are, e.g.&nbsp;<code>ess_tail</code> is very poor compared to when we use <code>unconstrained=true</code>. Moreover, in more complex cases this won’t just result in a “nice” <code>-Inf</code> log-density value, but instead will error:</p>
<div id="50" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="kw">function</span> <span class="fu">demo</span>()</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>    σ² <span class="op">~</span> <span class="fu">truncated</span>(<span class="fu">Normal</span>(), lower<span class="op">=</span><span class="fl">0</span>)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If we end up with negative values for `σ²`, the `Normal` will error.</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>    x <span class="op">~</span> <span class="fu">Normal</span>(<span class="fl">0</span>, σ²)</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre>DomainError with -0.8284801311274823:
Normal: the condition σ &gt;= zero(σ) is not satisfied.
Stacktrace:
  [1] <span class="ansi-bold">#371</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/qRkAO/src/univariate/continuous/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">normal.jl:37</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [2] <span class="ansi-bold">check_args</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/qRkAO/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">utils.jl:89</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [3] <span class="ansi-bold">#Normal#370</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/qRkAO/src/univariate/continuous/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">normal.jl:37</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [4] <span class="ansi-bold">Normal</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/qRkAO/src/univariate/continuous/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">normal.jl:36</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [5] <span class="ansi-bold">Normal</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/qRkAO/src/univariate/continuous/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">normal.jl:42</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [6] <span class="ansi-bold">macro expansion</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/8nuZQ/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">compiler.jl:558</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [7] <span class="ansi-bold">demo</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">__model__</span>::DynamicPPL.Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}</span>, <span class="ansi-bright-black-fg">__varinfo__</span>::DynamicPPL.ThreadSafeVarInfo<span class="ansi-bright-black-fg">{DynamicPPL.VarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}, Vector{Base.RefValue{Float64}}}</span>, <span class="ansi-bright-black-fg">__context__</span>::DynamicPPL.ValuesAsInModelContext<span class="ansi-bright-black-fg">{DynamicPPL.DefaultContext}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-magenta-fg">Main.Notebook</span> <span class="ansi-bright-black-fg">~/work/docs/docs/developers/inference/implementing-samplers/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">index.qmd:457</span>
  [8] <span class="ansi-bold">_evaluate!!</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/8nuZQ/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">model.jl:913</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [9] <span class="ansi-bold">evaluate_threadsafe!!</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">model</span>::DynamicPPL.Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}</span>, <span class="ansi-bright-black-fg">varinfo</span>::DynamicPPL.VarInfo<span class="ansi-bright-black-fg">{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}</span>, <span class="ansi-bright-black-fg">context</span>::DynamicPPL.ValuesAsInModelContext<span class="ansi-bright-black-fg">{DynamicPPL.DefaultContext}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-cyan-fg">DynamicPPL</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/8nuZQ/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">model.jl:902</span>
 [10] <span class="ansi-bold">evaluate!!</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/8nuZQ/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">model.jl:832</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [11] <span class="ansi-bold">values_as_in_model</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/8nuZQ/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">values_as_in_model.jl:173</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [12] <span class="ansi-bold">values_as_in_model</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/8nuZQ/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">values_as_in_model.jl:172</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [13] <span class="ansi-bold">getparams</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">model</span>::DynamicPPL.Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}</span>, <span class="ansi-bright-black-fg">vi</span>::DynamicPPL.VarInfo<span class="ansi-bright-black-fg">{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-green-fg">Turing.Inference</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/nQwbh/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">Inference.jl:353</span>
 [14] <span class="ansi-bold">Turing.Inference.Transition</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">model</span>::DynamicPPL.Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}</span>, <span class="ansi-bright-black-fg">vi</span>::DynamicPPL.VarInfo<span class="ansi-bright-black-fg">{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}</span>, <span class="ansi-bright-black-fg">t</span>::MALASample<span class="ansi-bright-black-fg">{Vector{Float64}}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-green-fg">Turing.Inference</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/nQwbh/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">Inference.jl:230</span>
 [15] <span class="ansi-bold">transition_to_turing</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">f</span>::LogDensityFunction<span class="ansi-bright-black-fg">{DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, DynamicPPL.VarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}, DynamicPPL.DefaultContext, AutoForwardDiff{2, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}}}</span>, <span class="ansi-bright-black-fg">transition</span>::MALASample<span class="ansi-bright-black-fg">{Vector{Float64}}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-green-fg">Turing.Inference</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/nQwbh/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">abstractmcmc.jl:12</span>
 [16] <span class="ansi-bold">step</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">rng</span>::TaskLocalRNG, <span class="ansi-bright-black-fg">model</span>::DynamicPPL.Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}</span>, <span class="ansi-bright-black-fg">sampler_wrapper</span>::DynamicPPL.Sampler<span class="ansi-bright-black-fg">{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}</span>; <span class="ansi-bright-black-fg">initial_state</span>::Nothing, <span class="ansi-bright-black-fg">initial_params</span>::Nothing, <span class="ansi-bright-black-fg">kwargs</span>::@Kwargs<span class="ansi-bright-black-fg">{}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-green-fg">Turing.Inference</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/nQwbh/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">abstractmcmc.jl:77</span>
 [17] <span class="ansi-bold">macro expansion</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/AbstractMCMC/FSyVk/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">sample.jl:0</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [18] <span class="ansi-bold">macro expansion</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/AbstractMCMC/FSyVk/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">logging.jl:16</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [19] <span class="ansi-bold">mcmcsample</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">rng</span>::TaskLocalRNG, <span class="ansi-bright-black-fg">model</span>::DynamicPPL.Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}</span>, <span class="ansi-bright-black-fg">sampler</span>::DynamicPPL.Sampler<span class="ansi-bright-black-fg">{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}</span>, <span class="ansi-bright-black-fg">N</span>::Int64; <span class="ansi-bright-black-fg">progress</span>::Bool, <span class="ansi-bright-black-fg">progressname</span>::String, <span class="ansi-bright-black-fg">callback</span>::Nothing, <span class="ansi-bright-black-fg">num_warmup</span>::Int64, <span class="ansi-bright-black-fg">discard_initial</span>::Int64, <span class="ansi-bright-black-fg">thinning</span>::Int64, <span class="ansi-bright-black-fg">chain_type</span>::Type, <span class="ansi-bright-black-fg">initial_state</span>::Nothing, <span class="ansi-bright-black-fg">kwargs</span>::@Kwargs<span class="ansi-bright-black-fg">{}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-yellow-fg">AbstractMCMC</span> <span class="ansi-bright-black-fg">~/.julia/packages/AbstractMCMC/FSyVk/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">sample.jl:142</span>
 [20] <span class="ansi-bold">sample</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">rng</span>::TaskLocalRNG, <span class="ansi-bright-black-fg">model</span>::DynamicPPL.Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}</span>, <span class="ansi-bright-black-fg">sampler</span>::DynamicPPL.Sampler<span class="ansi-bright-black-fg">{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}</span>, <span class="ansi-bright-black-fg">N</span>::Int64; <span class="ansi-bright-black-fg">chain_type</span>::Type, <span class="ansi-bright-black-fg">resume_from</span>::Nothing, <span class="ansi-bright-black-fg">initial_state</span>::Nothing, <span class="ansi-bright-black-fg">kwargs</span>::@Kwargs<span class="ansi-bright-black-fg">{progress::Bool}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-cyan-fg">DynamicPPL</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/8nuZQ/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">sampler.jl:102</span>
 [21] <span class="ansi-bold">sample</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/8nuZQ/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">sampler.jl:92</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [22] <span class="ansi-bold">#sample#8</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/nQwbh/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">Inference.jl:277</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [23] <span class="ansi-bold">sample</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/nQwbh/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">Inference.jl:268</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [24] <span class="ansi-bold">#sample#7</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/nQwbh/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">Inference.jl:265</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [25] top-level scope
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/work/docs/docs/developers/inference/implementing-samplers/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">index.qmd:459</span></pre>
</div>
</div>
</div>
<p>As expected, we run into a <code>DomainError</code> at some point, while if we set <code>unconstrained=true</code>, letting Turing.jl transform the model to a unconstrained form behind the scenes, everything works as expected:</p>
<div id="52" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 2.06 seconds
Compute duration  = 2.06 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters  </span><span class="ansi-bold">    mean  </span><span class="ansi-bold">     std  </span><span class="ansi-bold">    mcse  </span><span class="ansi-bold"> ess_bulk  </span><span class="ansi-bold"> ess_tail  </span><span class="ansi-bold">    rhat  </span><span class="ansi-bold"> e ⋯
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">  Float64  </span><span class="ansi-bright-black-fg ansi-bold">  Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">   ⋯

          σ²    0.8293    0.5517    0.0250   291.4190    54.7041    1.0046     ⋯
           x    0.0554    0.9308    0.0479   481.2463   379.2546    1.0072     ⋯
</span><span class="ansi-cyan-fg ansi-bold">                                                                1 column omitted

Quantiles
 </span><span class="ansi-cyan-fg ansi-bold"> parameters  </span><span class="ansi-cyan-fg ansi-bold">    2.5%  </span><span class="ansi-cyan-fg ansi-bold">   25.0%  </span><span class="ansi-cyan-fg ansi-bold">   50.0%  </span><span class="ansi-cyan-fg ansi-bold">   75.0%  </span><span class="ansi-cyan-fg ansi-bold">   97.5%
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64

          σ²    0.1280    0.3735    0.7253    1.1914    2.1225
           x   -2.0216   -0.3565    0.0510    0.3998    2.0518
</span></pre>
</div>
</div>
</div>
<p>Neat!</p>
<p>Similarly, which automatic differentiation backend one should use can be specified through the <code>adtype</code> keyword argument too. For example, if we want to use <a href="https://github.com/JuliaDiff/ReverseDiff.jl">ReverseDiff.jl</a> instead of the default <a href="https://github.com/JuliaDiff/ForwardDiff.jl">ForwardDiff.jl</a>:</p>
<div id="54" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">ReverseDiff</span>: ReverseDiff</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify that we want to use `AutoReverseDiff`.</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">demo</span>(),</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>, adtype<span class="op">=</span><span class="fu">AutoReverseDiff</span>()),</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>;</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 2.89 seconds
Compute duration  = 2.89 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters  </span><span class="ansi-bold">    mean  </span><span class="ansi-bold">     std  </span><span class="ansi-bold">    mcse  </span><span class="ansi-bold"> ess_bulk  </span><span class="ansi-bold"> ess_tail  </span><span class="ansi-bold">    rhat  </span><span class="ansi-bold"> e ⋯
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">  Float64  </span><span class="ansi-bright-black-fg ansi-bold">  Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">   ⋯

          σ²    0.8229    0.5639    0.0301   183.8539    70.2083    1.0067     ⋯
           x    0.0146    0.9131    0.0406   649.8966   537.5739    1.0077     ⋯
</span><span class="ansi-cyan-fg ansi-bold">                                                                1 column omitted

Quantiles
 </span><span class="ansi-cyan-fg ansi-bold"> parameters  </span><span class="ansi-cyan-fg ansi-bold">    2.5%  </span><span class="ansi-cyan-fg ansi-bold">   25.0%  </span><span class="ansi-cyan-fg ansi-bold">   50.0%  </span><span class="ansi-cyan-fg ansi-bold">   75.0%  </span><span class="ansi-cyan-fg ansi-bold">   97.5%
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64

          σ²    0.0941    0.3722    0.6994    1.1385    2.1896
           x   -1.9222   -0.3692    0.0039    0.3816    2.0128
</span></pre>
</div>
</div>
</div>
<p>Double-neat.</p>
</section>
</section>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<p>At this point it’s worth maybe reminding ourselves what we did and also <em>why</em> we did it:</p>
<ol type="1">
<li>We define our models in the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface because it makes the sampler agnostic to how the underlying model is implemented.</li>
<li>We implement our sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> interface, which just means that our sampler is a subtype of <code>AbstractMCMC.AbstractSampler</code> and we implement the MCMC transition in <code>AbstractMCMC.step</code>.</li>
<li>Points 1 and 2 makes it so our sampler can be used with a wide range of model implementations, amongst them being models implemented in both Turing.jl and Stan. This gives you, the inference implementer, a large collection of models to test your inference method on, in addition to allowing users of Turing.jl and Stan to try out your inference method with minimal effort.</li>
</ol>


</section>


<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a><div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>We’re going with the leapfrog formulation because in a future version of this tutorial we’ll add a section extending this simple “baseline” MALA sampler to more complex versions. See <a href="https://github.com/TuringLang/docs/issues/479">issue #479</a> for progress on this.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>There is no such thing as a proper interface in Julia (at least not officially), and so we use the word “interface” here to mean a few minimal methods that needs to be implemented by any type that we treat as a target model.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    // Ensure there is a toggle, if there isn't float one in the top right
    if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
      const a = window.document.createElement('a');
      a.classList.add('top-right');
      a.classList.add('quarto-color-scheme-toggle');
      a.href = "";
      a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
      const i = window.document.createElement("i");
      i.classList.add('bi');
      a.appendChild(i);
      window.document.body.appendChild(a);
    }
    setColorSchemeToggle(hasAlternateSentinel())
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/turinglang\.org\/docs\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../../developers/inference/variational-inference/index.html" class="pagination-link" aria-label="Variational Inference">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Variational Inference</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Turing is created by <a href="http://mlg.eng.cam.ac.uk/hong/" target="_blank">Hong Ge</a>, and lovingly maintained by the <a href="https://github.com/TuringLang/Turing.jl/graphs/contributors" target="_blank">core team</a> of volunteers. <br> The contents of this website are © 2024 under the terms of the <a href="https://github.com/TuringLang/Turing.jl/blob/main/LICENCE" target="_blank">MIT License</a>.</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/TuringLang/docs/edit/main/developers/inference/implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/docs/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://x.com/TuringLang">
      <i class="bi bi-twitter" role="img" aria-label="Turing Twitter">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/TuringLang/Turing.jl">
      <i class="bi bi-github" role="img" aria-label="Turing GitHub">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




<script src="../../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>