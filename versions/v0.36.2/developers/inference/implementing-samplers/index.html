<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.40">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Implementing Samplers – Turing.jl</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<link href="../../../developers/inference/variational-inference/index.html" rel="prev">
<link href="../../../assets/favicon.ico" rel="icon">
<script src="../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-549806ee2085284f45b00abea8c6df48.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-dark-8ea72dc5fed832574809a9c94082fbbb.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap-6cd699286831e1a51092dd37a8f143c8.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../../site_libs/bootstrap/bootstrap-dark-0fe6c82f0128f372cccc6e05b9c0dd0b.min.css" rel="prefetch" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<style>
  a {
    text-decoration: none;
  }
  a:hover {
    text-decoration: underline;
  }
</style>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../../theming/styles.css">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="https://turinglang.org/" class="navbar-brand navbar-brand-logo">
    <img src="../../../assets/images/turing-logo.svg" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="https://turinglang.org/">
    <span class="navbar-title">Turing.jl</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../getting-started/"> 
<span class="menu-text">Get Started</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../tutorials/coin-flipping/"> 
<span class="menu-text">Tutorials</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/library/"> 
<span class="menu-text">Libraries</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/news/"> 
<span class="menu-text">News</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/team/"> 
<span class="menu-text">Team</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-v0.36" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">v0.36</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-v0.36">    
        <li>
    <a class="dropdown-item" href="https://turinglang.org/docs/changelog.html">
 <span class="dropdown-text">Changelog</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://turinglang.org/docs/versions.html">
 <span class="dropdown-text">All Versions</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools tools-wide">
    <a href="https://x.com/TuringLang" title="Turing Twitter" class="quarto-navigation-tool px-1" aria-label="Turing Twitter"><i class="bi bi-twitter"></i></a>
    <a href="https://github.com/TuringLang/Turing.jl" title="Turing GitHub" class="quarto-navigation-tool px-1" aria-label="Turing GitHub"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../../developers/contributing/index.html">Developers</a></li><li class="breadcrumb-item"><a href="../../../developers/inference/abstractmcmc-interface/index.html">Inference (note: outdated)</a></li><li class="breadcrumb-item"><a href="../../../developers/inference/implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../getting-started/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Getting Started</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../core-functionality/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Core Functionality</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false">
 <span class="menu-text">User Guide</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/automatic-differentiation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Automatic Differentiation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/custom-distribution/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Custom Distributions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/probability-interface/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Querying Model Probabilities</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/modifying-logprob/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Modifying the Log Probability</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/generated-quantities/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Generated Quantities</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/mode-estimation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Mode Estimation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/performance-tips/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Performance Tips</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/sampler-visualisation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Sampler Visualization</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/dynamichmc/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using DynamicHMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/external-samplers/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using External Samplers</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false">
 <span class="menu-text">Tutorials</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/coin-flipping/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction: Coin Flipping</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/gaussian-mixture-models/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Mixture Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-neural-networks/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Neural Networks</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/hidden-markov-models/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Hidden Markov Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-linear-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Linear Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/infinite-mixture-models/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Infinite Mixture Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-poisson-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Poisson Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/multinomial-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Multinomial Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-differential-equations/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Differential Equations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/probabilistic-pca/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Probabilistic PCA</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-time-series-analysis/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Time Series Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/gaussian-processes-introduction/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Processes: Introduction</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/gaussian-process-latent-variable-models/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Process Latent Variable Models</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Developers</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/contributing/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Contributing</span></a>
  </div>
</li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false">
 <span class="menu-text">DynamicPPL’s Compiler</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/compiler/model-manual/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Manually Defining a Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/compiler/minituring-compiler/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation I: Compiler</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/compiler/minituring-contexts/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation II: Contexts</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/compiler/design-overview/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Turing Compiler Design (Outdated)</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false">
 <span class="menu-text">Variable Transformations</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/transforms/distributions/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Distributions and the Jacobian</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/transforms/bijectors/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bijectors in MCMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/transforms/dynamicppl/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variable transformations in DynamicPPL</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true">
 <span class="menu-text">Inference (note: outdated)</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/inference/abstractmcmc-interface/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Interface Guide</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/inference/abstractmcmc-turing/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">How Turing Implements AbstractMCMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/inference/variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/inference/implementing-samplers/index.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Implementing Samplers</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of Contents</h2>
   
  <ul>
  <li><a href="#quick-overview-of-mala" id="toc-quick-overview-of-mala" class="nav-link active" data-scroll-target="#quick-overview-of-mala">Quick overview of MALA</a></li>
  <li><a href="#what-we-need-from-a-model-logdensityproblems.jl" id="toc-what-we-need-from-a-model-logdensityproblems.jl" class="nav-link" data-scroll-target="#what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: LogDensityProblems.jl</a></li>
  <li><a href="#implementing-mala-in-abstractmcmc.jl" id="toc-implementing-mala-in-abstractmcmc.jl" class="nav-link" data-scroll-target="#implementing-mala-in-abstractmcmc.jl">Implementing MALA in AbstractMCMC.jl</a></li>
  <li><a href="#using-our-sampler-with-turing.jl" id="toc-using-our-sampler-with-turing.jl" class="nav-link" data-scroll-target="#using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</a>
  <ul class="collapse">
  <li><a href="#models-with-constrained-parameters" id="toc-models-with-constrained-parameters" class="nav-link" data-scroll-target="#models-with-constrained-parameters">Models with constrained parameters</a></li>
  </ul></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/TuringLang/docs/edit/master/developers/inference/implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/docs/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../../developers/contributing/index.html">Developers</a></li><li class="breadcrumb-item"><a href="../../../developers/inference/abstractmcmc-interface/index.html">Inference (note: outdated)</a></li><li class="breadcrumb-item"><a href="../../../developers/inference/implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Implementing Samplers</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>In this tutorial, we’ll go through step-by-step how to implement a “simple” sampler in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> in such a way that it can be easily applied to Turing.jl models.</p>
<p>In particular, we’re going to implement a version of <strong>Metropolis-adjusted Langevin (MALA)</strong>.</p>
<p>Note that we will implement this sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> framework, completely “ignoring” Turing.jl until the very end of the tutorial, at which point we’ll use a single line of code to make the resulting sampler available to Turing.jl. This is to really drive home the point that one can implement samplers in a way that is accessible to all of Turing.jl’s users without having to use Turing.jl yourself.</p>
<section id="quick-overview-of-mala" class="level2">
<h2 class="anchored" data-anchor-id="quick-overview-of-mala">Quick overview of MALA</h2>
<p>We can view MALA as a single step of the leapfrog intergrator with resampling of momentum <span class="math inline">\(p\)</span> at every step.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> To make that statement a bit more concrete, we first define the <em>extended</em> target <span class="math inline">\(\bar{\gamma}(x, p)\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\log \bar{\gamma}(x, p) \propto \log \gamma(x) + \log \gamma_{\mathcal{N}(0, M)}(p)
\end{equation*}\]</span></p>
<p>where <span class="math inline">\(\gamma_{\mathcal{N}(0, M)}\)</span> denotes the density for a zero-centered Gaussian with covariance matrix <span class="math inline">\(M\)</span>. We then consider targeting this joint distribution over both <span class="math inline">\(x\)</span> and <span class="math inline">\(p\)</span> as follows. First we define the map</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  L_{\epsilon}: \quad &amp; \mathbb{R}^d \times \mathbb{R}^d \to \mathbb{R}^d \times \mathbb{R}^d \\
  &amp; (x, p) \mapsto (\tilde{x}, \tilde{p}) := L_{\epsilon}(x, p)
\end{split}
\end{equation*}\]</span></p>
<p>as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p_{1 / 2} &amp;:= p + \frac{\epsilon}{2} \nabla \log \gamma(x) \\
  \tilde{x} &amp;:= x + \epsilon M^{-1} p_{1 /2 } \\
  p_1 &amp;:= p_{1 / 2} + \frac{\epsilon}{2} \nabla \log \gamma(\tilde{x}) \\
  \tilde{p} &amp;:= - p_1
\end{split}
\end{equation*}\]</span></p>
<p>This might be familiar for some readers as a single step of the Leapfrog integrator. We then define the MALA kernel as follows: given the current iterate <span class="math inline">\(x_i\)</span>, we sample the next iterate <span class="math inline">\(x_{i + 1}\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p &amp;\sim \mathcal{N}(0, M) \\
  (\tilde{x}, \tilde{p}) &amp;:= L_{\epsilon}(x_i, p) \\
  \alpha &amp;:= \min \left\{ 1, \frac{\bar{\gamma}(\tilde{x}, \tilde{p})}{\bar{\gamma}(x_i, p)} \right\} \\
  x_{i + 1} &amp;:=
  \begin{cases}
    \tilde{x} \quad &amp; \text{ with prob. } \alpha \\
    x_i       \quad &amp; \text{ with prob. } 1 - \alpha
  \end{cases}
\end{split}
\end{equation*}\]</span></p>
<p>i.e.&nbsp;we accept the proposal <span class="math inline">\(\tilde{x}\)</span> with probability <span class="math inline">\(\alpha\)</span> and reject it, thus sticking with our current iterate, with probability <span class="math inline">\(1 - \alpha\)</span>.</p>
</section>
<section id="what-we-need-from-a-model-logdensityproblems.jl" class="level2">
<h2 class="anchored" data-anchor-id="what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a></h2>
<p>There are a few things we need from the “target” / “model” / density that we want to sample from:</p>
<ol type="1">
<li>We need access to log-density <em>evaluations</em> <span class="math inline">\(\log \gamma(x)\)</span> so we can compute the acceptance ratio involving <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>We need access to log-density <em>gradients</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span> so we can compute the Leapfrog steps <span class="math inline">\(L_{\epsilon}(x, p)\)</span>.</li>
<li>We also need access to the “size” of the model so we can determine the size of <span class="math inline">\(M\)</span>.</li>
</ol>
<p>Luckily for us, there is a package called <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> which provides an interface for <em>exactly</em> this!</p>
<p>To demonstrate how one can implement the “<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface”<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> we will use a simple Gaussian model as an example:</p>
<div id="4" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblems</span>: LogDensityProblems;</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's define some type that represents the model.</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> IsotropicNormalModel{M<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"mean of the isotropic Gaussian"</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    mean<span class="op">::</span><span class="dt">M</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Specifies what input length the model expects.</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">dimension</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> <span class="fu">length</span>(model.mean)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Implementation of the log-density evaluation of the model.</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x<span class="op">::</span><span class="dt">AbstractVector{&lt;:Real}</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">-</span> <span class="fu">sum</span>(abs2, x <span class="op">.-</span> model.mean) <span class="op">/</span> <span class="fl">2</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This gives us all of the properties we want for our MALA sampler with the exception of the computation of the <em>gradient</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span>. There is the method <code>LogDensityProblems.logdensity_and_gradient</code> which should return a 2-tuple where the first entry is the evaluation of the logdensity <span class="math inline">\(\log \gamma(x)\)</span> and the second entry is the gradient <span class="math inline">\(\nabla \log \gamma(x)\)</span>.</p>
<p>There are two ways to “implement” this method: 1) we implement it by hand, which is feasible in the case of our <code>IsotropicNormalModel</code>, or b) we defer the implementation of this to a automatic differentiation backend.</p>
<p>To implement it by hand we can simply do</p>
<div id="6" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl that first-order, i.e. gradient information, is available.</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{1}</span>()</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Implement `logdensity_and_gradient`.</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    logγ_x <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="op">-</span>x <span class="op">.*</span> (x <span class="op">-</span> model.mean)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> logγ_x, ∇logγ_x</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s just try it out:</p>
<div id="8" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate the problem.</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> <span class="fu">IsotropicNormalModel</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.])</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create some example input that we can test on.</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>x_example <span class="op">=</span> <span class="fu">randn</span>(LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate!</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-25.45598843780339</code></pre>
</div>
</div>
<p>To defer it to an automatic differentiation backend, we can do</p>
<div id="10" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl we only have access to 0-th order information.</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{0}</span>()</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Use `LogDensityProblemsAD`'s `ADgradient` in combination with some AD backend to implement `logdensity_and_gradient`.</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblemsAD</span>, <span class="bu">ADTypes</span>, <span class="bu">ForwardDiff</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>model_with_grad <span class="op">=</span> <span class="fu">ADgradient</span>(<span class="fu">AutoForwardDiff</span>(), model)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model_with_grad, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-25.45598843780339</code></pre>
</div>
</div>
<p>We’ll continue with the second approach in this tutorial since this is typically what one does in practice, because there are better hobbies to spend time on than deriving gradients by hand.</p>
<p>At this point, one might wonder how we’re going to tie this back to Turing.jl in the end. Effectively, when working with inference methods that only require log-density evaluations and / or higher-order information of the log-density, Turing.jl actually converts the user-provided <code>Model</code> into an object implementing the above methods for <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>. As a result, most samplers provided by Turing.jl are actually implemented to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, enabling their use both <em>within</em> Turing.jl and <em>outside</em> of Turing.jl! Morever, there exists similar conversions for Stan through BridgeStan and Stan<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, which means that a sampler supporting the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface can easily be used on both Turing.jl <em>and</em> Stan models (in addition to user-provided models, as our <code>IsotropicNormalModel</code> above)!</p>
<p>Anyways, let’s move on to actually implementing the sampler.</p>
</section>
<section id="implementing-mala-in-abstractmcmc.jl" class="level2">
<h2 class="anchored" data-anchor-id="implementing-mala-in-abstractmcmc.jl">Implementing MALA in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a></h2>
<p>Now that we’ve established that a model implementing the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface provides us with all the information we need from <span class="math inline">\(\log \gamma(x)\)</span>, we can address the question: given an object that implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, how can we define a sampler for it?</p>
<p>We’re going to do this by making our sampler a sub-type of <code>AbstractMCMC.AbstractSampler</code> in addition to implementing a few methods from <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>. Why? Because it gets us <em>a lot</em> of functionality for free, as we will see later.</p>
<p>Moreover, <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> provides a very natural interface for MCMC algorithms.</p>
<p>First, we’ll define our <code>MALA</code> type</p>
<div id="12" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">AbstractMCMC</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALA{T,A} <span class="op">&lt;:</span><span class="dt"> AbstractMCMC.AbstractSampler</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"stepsize used in the leapfrog step"</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    ϵ_init<span class="op">::</span><span class="dt">T</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"covariance matrix used for the momentum"</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    M_init<span class="op">::</span><span class="dt">A</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notice how we’ve added the suffix <code>_init</code> to both the stepsize and the covariance matrix. We’ve done this because a <code>AbstractMCMC.AbstractSampler</code> should be <em>immutable</em>. Of course there might be many scenarios where we want to allow something like the stepsize and / or the covariance matrix to vary between iterations, e.g.&nbsp;during the burn-in / adaptation phase of the sampling process we might want to adjust the parameters using statistics computed from these initial iterations. But information which can change between iterations <em>should not go in the sampler itself</em>! Instead, this information should go in the sampler <em>state</em>.</p>
<p>The sampler state should at the very least contain all the necessary information to perform the next MCMC iteration, but usually contains further information, e.g.&nbsp;quantities and statistics useful for evaluating whether the sampler has converged.</p>
<p>We will use the following sampler state for our <code>MALA</code> sampler:</p>
<div id="14" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALAState{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This might seem overly redundant: we’re defining a type <code>MALAState</code> and it only contains a simple vector of reals. In this particular case we indeed could have dropped this and simply used a <code>AbstractVector{&lt;:Real}</code> as our sampler state, but typically, as we will see later, one wants to include other quantities in the sampler state. For example, if we also wanted to adapt the parameters of our <code>MALA</code>, e.g.&nbsp;alter the stepsize depending on acceptance rates, in which case we should also put <code>ϵ</code> in the state, but for now we’ll keep things simple.</p>
<p>Moreover, we also want a <em>sample</em> type, which is a type meant for “public consumption”, i.e.&nbsp;the end-user. This is generally going to contain a subset of the information present in the state. But in such a simple scenario as this, we similarly only have a <code>AbstractVector{&lt;:Real}</code>:</p>
<div id="16" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALASample{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We currently have three things:</p>
<ol type="1">
<li>A <code>AbstractMCMC.AbstractSampler</code> implementation called <code>MALA</code>.</li>
<li>A state <code>MALAState</code> for our sampler <code>MALA</code>.</li>
<li>A sample <code>MALASample</code> for our sampler <code>MALA</code>.</li>
</ol>
<p>That means that we’re ready to implement the only thing that really matters: <code>AbstractMCMC.step</code>.</p>
<p><code>AbstractMCMC.step</code> defines the MCMC iteration of our <code>MALA</code> given the current <code>MALAState</code>. Specifically, the signature of the function is as follows:</p>
<div id="18" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The RNG to ensure reproducibility.</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The model that defines our target.</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.AbstractModel</span>,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The sampler for which we're taking a `step`.</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">AbstractMCMC.AbstractSampler</span>,</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The current sampler `state`.</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    state;</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Additional keyword arguments that we may or may not need.</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Moreover, there is a specific <code>AbstractMCMC.AbstractModel</code> which is used to indicate that the model that is provided implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface: <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Since, as we discussed earlier, in our case we’re indeed going to work with types that support the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, we’ll define <code>AbstractMCMC.step</code> for such a <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Note that <code>AbstractMCMC.LogDensityModel</code> has no other purpose; it has a single field called <code>logdensity</code>, and it does nothing else. But by wrapping the model in <code>AbstractMCMC.LogDensityModel</code>, it allows samplers that want to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> to define their <code>AbstractMCMC.step</code> on this type without running into method ambiguities.</p>
<p>All in all, that means that the signature for our <code>AbstractMCMC.step</code> is going to be the following:</p>
<div id="20" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># `LogDensityModel` so we know we're working with LogDensityProblems.jl model.</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler.</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler state.</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Great! Now let’s actually implement the full <code>AbstractMCMC.step</code> for our <code>MALA</code>.</p>
<p>Let’s remind ourselves what we’re going to do:</p>
<ol type="1">
<li>Sample a new momentum <span class="math inline">\(p\)</span>.</li>
<li>Compute the log-density of the extended target <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>Take a single leapfrog step <span class="math inline">\((\tilde{x}, \tilde{p}) = L_{\epsilon}(x, p)\)</span>.</li>
<li>Accept or reject the proposed <span class="math inline">\((\tilde{x}, \tilde{p})\)</span>.</li>
</ol>
<p>All in all, this results in the following:</p>
<div id="22" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>: Random</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Distributions</span>  <span class="co"># so we get the `MvNormal`</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the wrapped model which implements LogDensityProblems.jl.</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just extract the sampler parameters to make our lives easier.</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    ϵ <span class="op">=</span> sampler.ϵ_init</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    M <span class="op">=</span> sampler.M_init</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the current parameters.</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> state.x</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sample the momentum.</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>    p_dist <span class="op">=</span> <span class="fu">MvNormal</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)), M)</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> <span class="fu">rand</span>(rng, p_dist)</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Propose using a single leapfrog step.</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>    x̃, p̃ <span class="op">=</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Accept or reject proposal.</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>    logp <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p)</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>    logp̃ <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x̃) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p̃)</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>    logα <span class="op">=</span> logp̃ <span class="op">-</span> logp</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>    state_new <span class="op">=</span> <span class="cf">if</span> <span class="fu">log</span>(<span class="fu">rand</span>(rng)) <span class="op">&lt;</span> logα</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Accept.</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x̃)</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Reject.</span></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x)</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return the "sample" and the sampler state.</span></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(state_new.x), state_new</span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Fairly straight-forward.</p>
<p>Of course, we haven’t defined the <code>leapfrog_step</code> method yet, so let’s do that:</p>
<div id="24" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p` using "position" `x`.</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x))</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    p1 <span class="op">=</span> p <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update the "position" `x` using momentum `p1`.</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    x̃ <span class="op">=</span> x <span class="op">+</span> ϵ <span class="op">.*</span> (M <span class="op">\</span> p1)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p1` using position `x̃`</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x̃ <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x̃))</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    p2 <span class="op">=</span> p1 <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x̃</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Flip momentum `p2`.</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    p̃ <span class="op">=</span> <span class="op">-</span>p2</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x̃, p̃</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>leapfrog_step (generic function with 1 method)</code></pre>
</div>
</div>
<p>With all of this, we’re technically ready to sample!</p>
<div id="26" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>, <span class="bu">LinearAlgebra</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>rng <span class="op">=</span> <span class="bu">Random</span>.<span class="fu">default_rng</span>()</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>sampler <span class="op">=</span> <span class="fu">MALA</span>(<span class="fl">1</span>, I)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>state <span class="op">=</span> <span class="fu">MALAState</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)))</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>x_next, state_next <span class="op">=</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    rng,</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    AbstractMCMC.<span class="fu">LogDensityModel</span>(model),</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    state</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>(MALASample{Vector{Float64}}([0.0, 0.0, 0.0]), MALAState{Vector{Float64}}([0.0, 0.0, 0.0]))</code></pre>
</div>
</div>
<p>Great, it works!</p>
<p>And I promised we would get quite some functionality for free if we implemented <code>AbstractMCMC.step</code>, and so we can now simply call <code>sample</code> to perform standard MCMC sampling:</p>
<div id="28" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform 1000 iterations with our `MALA` sampler.</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; initial_state<span class="op">=</span>state, progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Concatenate into a matrix.</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000 Matrix{Float64}:
 -1.95282   -2.17639   -2.36005   -3.93832  …  -4.87258   -5.90682   -5.9466
  0.628139  -0.322667   0.445555  -1.23431     -0.322026  -0.884955  -1.45498
  3.14037    3.38176    4.02431    4.80971      4.83418    5.09356    3.91909</code></pre>
</div>
</div>
<div id="30" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the marginal means and standard deviations.</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -4.98466    0.993281
  0.0128678  1.00058
  4.98709    0.986542</code></pre>
</div>
</div>
<p>Let’s visualize the samples</p>
<div id="32" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">StatsPlots</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">transpose</span>(samples_matrix[<span class="op">:</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">:</span><span class="kw">end</span>]), alpha<span class="op">=</span><span class="fl">0.5</span>, legend<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<!--?xml version="1.0" encoding="utf-8"?-->
<svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" width="672" height="480" viewbox="0 0 2688 1920">
<defs>
  <clippath id="clip450">
    <rect x="0" y="0" width="2688" height="1920"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip450)" d="M0 1920 L2688 1920 L2688 0 L0 0  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip451">
    <rect x="537" y="0" width="1883" height="1883"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip450)" d="M151.747 1800.78 L2640.76 1800.78 L2640.76 47.2441 L151.747 47.2441  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip452">
    <rect x="151" y="47" width="2490" height="1755"></rect>
  </clippath>
</defs>
<polyline clip-path="url(#clip452)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="219.84,1800.78 219.84,47.2441 "></polyline>
<polyline clip-path="url(#clip452)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="807.458,1800.78 807.458,47.2441 "></polyline>
<polyline clip-path="url(#clip452)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1395.08,1800.78 1395.08,47.2441 "></polyline>
<polyline clip-path="url(#clip452)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1982.69,1800.78 1982.69,47.2441 "></polyline>
<polyline clip-path="url(#clip452)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="2570.31,1800.78 2570.31,47.2441 "></polyline>
<polyline clip-path="url(#clip452)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,1524.29 2640.76,1524.29 "></polyline>
<polyline clip-path="url(#clip452)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,1216.19 2640.76,1216.19 "></polyline>
<polyline clip-path="url(#clip452)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,908.087 2640.76,908.087 "></polyline>
<polyline clip-path="url(#clip452)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,599.988 2640.76,599.988 "></polyline>
<polyline clip-path="url(#clip452)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,291.889 2640.76,291.889 "></polyline>
<polyline clip-path="url(#clip450)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1800.78 2640.76,1800.78 "></polyline>
<polyline clip-path="url(#clip450)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="219.84,1800.78 219.84,1781.88 "></polyline>
<polyline clip-path="url(#clip450)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="807.458,1800.78 807.458,1781.88 "></polyline>
<polyline clip-path="url(#clip450)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1395.08,1800.78 1395.08,1781.88 "></polyline>
<polyline clip-path="url(#clip450)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1982.69,1800.78 1982.69,1781.88 "></polyline>
<polyline clip-path="url(#clip450)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="2570.31,1800.78 2570.31,1781.88 "></polyline>
<path clip-path="url(#clip450)" d="M219.84 1834 Q216.229 1834 214.4 1837.57 Q212.595 1841.11 212.595 1848.24 Q212.595 1855.34 214.4 1858.91 Q216.229 1862.45 219.84 1862.45 Q223.474 1862.45 225.28 1858.91 Q227.108 1855.34 227.108 1848.24 Q227.108 1841.11 225.28 1837.57 Q223.474 1834 219.84 1834 M219.84 1830.3 Q225.65 1830.3 228.706 1834.9 Q231.784 1839.49 231.784 1848.24 Q231.784 1856.96 228.706 1861.57 Q225.65 1866.15 219.84 1866.15 Q214.03 1866.15 210.951 1861.57 Q207.896 1856.96 207.896 1848.24 Q207.896 1839.49 210.951 1834.9 Q214.03 1830.3 219.84 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip450)" d="M771.15 1861.55 L787.47 1861.55 L787.47 1865.48 L765.525 1865.48 L765.525 1861.55 Q768.187 1858.79 772.771 1854.16 Q777.377 1849.51 778.558 1848.17 Q780.803 1845.65 781.683 1843.91 Q782.585 1842.15 782.585 1840.46 Q782.585 1837.71 780.641 1835.97 Q778.72 1834.23 775.618 1834.23 Q773.419 1834.23 770.965 1835 Q768.535 1835.76 765.757 1837.31 L765.757 1832.59 Q768.581 1831.46 771.035 1830.88 Q773.488 1830.3 775.525 1830.3 Q780.896 1830.3 784.09 1832.98 Q787.285 1835.67 787.285 1840.16 Q787.285 1842.29 786.474 1844.21 Q785.687 1846.11 783.581 1848.7 Q783.002 1849.37 779.9 1852.59 Q776.798 1855.78 771.15 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip450)" d="M797.331 1830.92 L815.687 1830.92 L815.687 1834.86 L801.613 1834.86 L801.613 1843.33 Q802.632 1842.98 803.65 1842.82 Q804.669 1842.64 805.687 1842.64 Q811.474 1842.64 814.854 1845.81 Q818.233 1848.98 818.233 1854.4 Q818.233 1859.97 814.761 1863.08 Q811.289 1866.15 804.97 1866.15 Q802.794 1866.15 800.525 1865.78 Q798.28 1865.41 795.872 1864.67 L795.872 1859.97 Q797.956 1861.11 800.178 1861.66 Q802.4 1862.22 804.877 1862.22 Q808.882 1862.22 811.22 1860.11 Q813.558 1858.01 813.558 1854.4 Q813.558 1850.78 811.22 1848.68 Q808.882 1846.57 804.877 1846.57 Q803.002 1846.57 801.127 1846.99 Q799.275 1847.4 797.331 1848.28 L797.331 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip450)" d="M837.446 1834 Q833.835 1834 832.007 1837.57 Q830.201 1841.11 830.201 1848.24 Q830.201 1855.34 832.007 1858.91 Q833.835 1862.45 837.446 1862.45 Q841.081 1862.45 842.886 1858.91 Q844.715 1855.34 844.715 1848.24 Q844.715 1841.11 842.886 1837.57 Q841.081 1834 837.446 1834 M837.446 1830.3 Q843.256 1830.3 846.312 1834.9 Q849.391 1839.49 849.391 1848.24 Q849.391 1856.96 846.312 1861.57 Q843.256 1866.15 837.446 1866.15 Q831.636 1866.15 828.557 1861.57 Q825.502 1856.96 825.502 1848.24 Q825.502 1839.49 828.557 1834.9 Q831.636 1830.3 837.446 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip450)" d="M1354.69 1830.92 L1373.05 1830.92 L1373.05 1834.86 L1358.98 1834.86 L1358.98 1843.33 Q1360 1842.98 1361.01 1842.82 Q1362.03 1842.64 1363.05 1842.64 Q1368.84 1842.64 1372.22 1845.81 Q1375.6 1848.98 1375.6 1854.4 Q1375.6 1859.97 1372.12 1863.08 Q1368.65 1866.15 1362.33 1866.15 Q1360.16 1866.15 1357.89 1865.78 Q1355.64 1865.41 1353.24 1864.67 L1353.24 1859.97 Q1355.32 1861.11 1357.54 1861.66 Q1359.76 1862.22 1362.24 1862.22 Q1366.25 1862.22 1368.58 1860.11 Q1370.92 1858.01 1370.92 1854.4 Q1370.92 1850.78 1368.58 1848.68 Q1366.25 1846.57 1362.24 1846.57 Q1360.37 1846.57 1358.49 1846.99 Q1356.64 1847.4 1354.69 1848.28 L1354.69 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip450)" d="M1394.81 1834 Q1391.2 1834 1389.37 1837.57 Q1387.56 1841.11 1387.56 1848.24 Q1387.56 1855.34 1389.37 1858.91 Q1391.2 1862.45 1394.81 1862.45 Q1398.44 1862.45 1400.25 1858.91 Q1402.08 1855.34 1402.08 1848.24 Q1402.08 1841.11 1400.25 1837.57 Q1398.44 1834 1394.81 1834 M1394.81 1830.3 Q1400.62 1830.3 1403.68 1834.9 Q1406.75 1839.49 1406.75 1848.24 Q1406.75 1856.96 1403.68 1861.57 Q1400.62 1866.15 1394.81 1866.15 Q1389 1866.15 1385.92 1861.57 Q1382.87 1856.96 1382.87 1848.24 Q1382.87 1839.49 1385.92 1834.9 Q1389 1830.3 1394.81 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip450)" d="M1424.97 1834 Q1421.36 1834 1419.53 1837.57 Q1417.73 1841.11 1417.73 1848.24 Q1417.73 1855.34 1419.53 1858.91 Q1421.36 1862.45 1424.97 1862.45 Q1428.61 1862.45 1430.41 1858.91 Q1432.24 1855.34 1432.24 1848.24 Q1432.24 1841.11 1430.41 1837.57 Q1428.61 1834 1424.97 1834 M1424.97 1830.3 Q1430.78 1830.3 1433.84 1834.9 Q1436.92 1839.49 1436.92 1848.24 Q1436.92 1856.96 1433.84 1861.57 Q1430.78 1866.15 1424.97 1866.15 Q1419.16 1866.15 1416.08 1861.57 Q1413.03 1856.96 1413.03 1848.24 Q1413.03 1839.49 1416.08 1834.9 Q1419.16 1830.3 1424.97 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip450)" d="M1940.97 1830.92 L1963.19 1830.92 L1963.19 1832.91 L1950.65 1865.48 L1945.76 1865.48 L1957.57 1834.86 L1940.97 1834.86 L1940.97 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip450)" d="M1972.36 1830.92 L1990.71 1830.92 L1990.71 1834.86 L1976.64 1834.86 L1976.64 1843.33 Q1977.66 1842.98 1978.68 1842.82 Q1979.7 1842.64 1980.72 1842.64 Q1986.5 1842.64 1989.88 1845.81 Q1993.26 1848.98 1993.26 1854.4 Q1993.26 1859.97 1989.79 1863.08 Q1986.32 1866.15 1980 1866.15 Q1977.82 1866.15 1975.55 1865.78 Q1973.31 1865.41 1970.9 1864.67 L1970.9 1859.97 Q1972.98 1861.11 1975.21 1861.66 Q1977.43 1862.22 1979.9 1862.22 Q1983.91 1862.22 1986.25 1860.11 Q1988.59 1858.01 1988.59 1854.4 Q1988.59 1850.78 1986.25 1848.68 Q1983.91 1846.57 1979.9 1846.57 Q1978.03 1846.57 1976.15 1846.99 Q1974.3 1847.4 1972.36 1848.28 L1972.36 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip450)" d="M2012.47 1834 Q2008.86 1834 2007.03 1837.57 Q2005.23 1841.11 2005.23 1848.24 Q2005.23 1855.34 2007.03 1858.91 Q2008.86 1862.45 2012.47 1862.45 Q2016.11 1862.45 2017.91 1858.91 Q2019.74 1855.34 2019.74 1848.24 Q2019.74 1841.11 2017.91 1837.57 Q2016.11 1834 2012.47 1834 M2012.47 1830.3 Q2018.28 1830.3 2021.34 1834.9 Q2024.42 1839.49 2024.42 1848.24 Q2024.42 1856.96 2021.34 1861.57 Q2018.28 1866.15 2012.47 1866.15 Q2006.66 1866.15 2003.59 1861.57 Q2000.53 1856.96 2000.53 1848.24 Q2000.53 1839.49 2003.59 1834.9 Q2006.66 1830.3 2012.47 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip450)" d="M2514.84 1861.55 L2522.48 1861.55 L2522.48 1835.18 L2514.17 1836.85 L2514.17 1832.59 L2522.43 1830.92 L2527.11 1830.92 L2527.11 1861.55 L2534.75 1861.55 L2534.75 1865.48 L2514.84 1865.48 L2514.84 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip450)" d="M2554.19 1834 Q2550.58 1834 2548.75 1837.57 Q2546.94 1841.11 2546.94 1848.24 Q2546.94 1855.34 2548.75 1858.91 Q2550.58 1862.45 2554.19 1862.45 Q2557.82 1862.45 2559.63 1858.91 Q2561.46 1855.34 2561.46 1848.24 Q2561.46 1841.11 2559.63 1837.57 Q2557.82 1834 2554.19 1834 M2554.19 1830.3 Q2560 1830.3 2563.06 1834.9 Q2566.13 1839.49 2566.13 1848.24 Q2566.13 1856.96 2563.06 1861.57 Q2560 1866.15 2554.19 1866.15 Q2548.38 1866.15 2545.3 1861.57 Q2542.25 1856.96 2542.25 1848.24 Q2542.25 1839.49 2545.3 1834.9 Q2548.38 1830.3 2554.19 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip450)" d="M2584.35 1834 Q2580.74 1834 2578.91 1837.57 Q2577.11 1841.11 2577.11 1848.24 Q2577.11 1855.34 2578.91 1858.91 Q2580.74 1862.45 2584.35 1862.45 Q2587.99 1862.45 2589.79 1858.91 Q2591.62 1855.34 2591.62 1848.24 Q2591.62 1841.11 2589.79 1837.57 Q2587.99 1834 2584.35 1834 M2584.35 1830.3 Q2590.16 1830.3 2593.22 1834.9 Q2596.3 1839.49 2596.3 1848.24 Q2596.3 1856.96 2593.22 1861.57 Q2590.16 1866.15 2584.35 1866.15 Q2578.54 1866.15 2575.46 1861.57 Q2572.41 1856.96 2572.41 1848.24 Q2572.41 1839.49 2575.46 1834.9 Q2578.54 1830.3 2584.35 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip450)" d="M2614.51 1834 Q2610.9 1834 2609.07 1837.57 Q2607.27 1841.11 2607.27 1848.24 Q2607.27 1855.34 2609.07 1858.91 Q2610.9 1862.45 2614.51 1862.45 Q2618.15 1862.45 2619.95 1858.91 Q2621.78 1855.34 2621.78 1848.24 Q2621.78 1841.11 2619.95 1837.57 Q2618.15 1834 2614.51 1834 M2614.51 1830.3 Q2620.32 1830.3 2623.38 1834.9 Q2626.46 1839.49 2626.46 1848.24 Q2626.46 1856.96 2623.38 1861.57 Q2620.32 1866.15 2614.51 1866.15 Q2608.7 1866.15 2605.62 1861.57 Q2602.57 1856.96 2602.57 1848.24 Q2602.57 1839.49 2605.62 1834.9 Q2608.7 1830.3 2614.51 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip450)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1800.78 151.747,47.2441 "></polyline>
<polyline clip-path="url(#clip450)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1524.29 170.644,1524.29 "></polyline>
<polyline clip-path="url(#clip450)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1216.19 170.644,1216.19 "></polyline>
<polyline clip-path="url(#clip450)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,908.087 170.644,908.087 "></polyline>
<polyline clip-path="url(#clip450)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,599.988 170.644,599.988 "></polyline>
<polyline clip-path="url(#clip450)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,291.889 170.644,291.889 "></polyline>
<path clip-path="url(#clip450)" d="M49.5521 1524.74 L79.2279 1524.74 L79.2279 1528.67 L49.5521 1528.67 L49.5521 1524.74 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip450)" d="M99.8991 1522.42 Q96.7509 1522.42 94.8991 1524.58 Q93.0704 1526.73 93.0704 1530.48 Q93.0704 1534.2 94.8991 1536.38 Q96.7509 1538.53 99.8991 1538.53 Q103.047 1538.53 104.876 1536.38 Q106.728 1534.2 106.728 1530.48 Q106.728 1526.73 104.876 1524.58 Q103.047 1522.42 99.8991 1522.42 M109.181 1507.77 L109.181 1512.03 Q107.422 1511.2 105.617 1510.76 Q103.834 1510.32 102.075 1510.32 Q97.4454 1510.32 94.9917 1513.44 Q92.5612 1516.57 92.2139 1522.89 Q93.5797 1520.87 95.6398 1519.81 Q97.7 1518.72 100.177 1518.72 Q105.385 1518.72 108.394 1521.89 Q111.427 1525.04 111.427 1530.48 Q111.427 1535.8 108.279 1539.02 Q105.131 1542.24 99.8991 1542.24 Q93.9037 1542.24 90.7325 1537.65 Q87.5612 1533.05 87.5612 1524.32 Q87.5612 1516.13 91.45 1511.27 Q95.3389 1506.38 101.89 1506.38 Q103.649 1506.38 105.431 1506.73 Q107.237 1507.08 109.181 1507.77 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip450)" d="M50.3623 1216.64 L80.0381 1216.64 L80.0381 1220.57 L50.3623 1220.57 L50.3623 1216.64 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip450)" d="M104.297 1214.83 Q107.654 1215.55 109.529 1217.82 Q111.427 1220.09 111.427 1223.42 Q111.427 1228.54 107.908 1231.34 Q104.39 1234.14 97.9083 1234.14 Q95.7324 1234.14 93.4176 1233.7 Q91.126 1233.28 88.6723 1232.43 L88.6723 1227.91 Q90.6167 1229.05 92.9315 1229.62 Q95.2463 1230.2 97.7695 1230.2 Q102.168 1230.2 104.459 1228.47 Q106.774 1226.73 106.774 1223.42 Q106.774 1220.36 104.621 1218.65 Q102.492 1216.92 98.6722 1216.92 L94.6445 1216.92 L94.6445 1213.07 L98.8574 1213.07 Q102.306 1213.07 104.135 1211.71 Q105.964 1210.32 105.964 1207.73 Q105.964 1205.06 104.066 1203.65 Q102.191 1202.22 98.6722 1202.22 Q96.7509 1202.22 94.5519 1202.63 Q92.3528 1203.05 89.7139 1203.93 L89.7139 1199.76 Q92.376 1199.02 94.6908 1198.65 Q97.0287 1198.28 99.0889 1198.28 Q104.413 1198.28 107.515 1200.71 Q110.617 1203.12 110.617 1207.24 Q110.617 1210.11 108.973 1212.1 Q107.33 1214.07 104.297 1214.83 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip450)" d="M99.4824 893.886 Q95.8713 893.886 94.0426 897.451 Q92.2371 900.993 92.2371 908.122 Q92.2371 915.229 94.0426 918.793 Q95.8713 922.335 99.4824 922.335 Q103.117 922.335 104.922 918.793 Q106.751 915.229 106.751 908.122 Q106.751 900.993 104.922 897.451 Q103.117 893.886 99.4824 893.886 M99.4824 890.182 Q105.293 890.182 108.348 894.789 Q111.427 899.372 111.427 908.122 Q111.427 916.849 108.348 921.455 Q105.293 926.039 99.4824 926.039 Q93.6723 926.039 90.5936 921.455 Q87.538 916.849 87.538 908.122 Q87.538 899.372 90.5936 894.789 Q93.6723 890.182 99.4824 890.182 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip450)" d="M104.297 598.634 Q107.654 599.352 109.529 601.62 Q111.427 603.889 111.427 607.222 Q111.427 612.338 107.908 615.139 Q104.39 617.939 97.9083 617.939 Q95.7324 617.939 93.4176 617.5 Q91.126 617.083 88.6723 616.226 L88.6723 611.713 Q90.6167 612.847 92.9315 613.426 Q95.2463 614.004 97.7695 614.004 Q102.168 614.004 104.459 612.268 Q106.774 610.532 106.774 607.222 Q106.774 604.166 104.621 602.453 Q102.492 600.717 98.6722 600.717 L94.6445 600.717 L94.6445 596.875 L98.8574 596.875 Q102.306 596.875 104.135 595.509 Q105.964 594.12 105.964 591.528 Q105.964 588.866 104.066 587.453 Q102.191 586.018 98.6722 586.018 Q96.7509 586.018 94.5519 586.435 Q92.3528 586.852 89.7139 587.731 L89.7139 583.565 Q92.376 582.824 94.6908 582.454 Q97.0287 582.083 99.0889 582.083 Q104.413 582.083 107.515 584.514 Q110.617 586.921 110.617 591.041 Q110.617 593.912 108.973 595.903 Q107.33 597.87 104.297 598.634 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip450)" d="M99.8991 290.025 Q96.7509 290.025 94.8991 292.178 Q93.0704 294.331 93.0704 298.081 Q93.0704 301.808 94.8991 303.984 Q96.7509 306.136 99.8991 306.136 Q103.047 306.136 104.876 303.984 Q106.728 301.808 106.728 298.081 Q106.728 294.331 104.876 292.178 Q103.047 290.025 99.8991 290.025 M109.181 275.373 L109.181 279.632 Q107.422 278.799 105.617 278.359 Q103.834 277.919 102.075 277.919 Q97.4454 277.919 94.9917 281.044 Q92.5612 284.169 92.2139 290.488 Q93.5797 288.475 95.6398 287.41 Q97.7 286.322 100.177 286.322 Q105.385 286.322 108.394 289.493 Q111.427 292.641 111.427 298.081 Q111.427 303.405 108.279 306.623 Q105.131 309.84 99.8991 309.84 Q93.9037 309.84 90.7325 305.257 Q87.5612 300.65 87.5612 291.924 Q87.5612 283.729 91.45 278.868 Q95.3389 273.984 101.89 273.984 Q103.649 273.984 105.431 274.331 Q107.237 274.678 109.181 275.373 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip452)" style="stroke:#009af9; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,1108.64 224.541,1389.87 226.891,1469.25 229.242,1491.26 231.592,1435.1 233.943,1470.99 236.293,1392.81 238.644,1271.31 240.994,1494.48 243.345,1415.13 245.695,1492.49 248.046,1499.15 250.396,1303.93 252.747,1605.3 255.097,1311.93 257.448,1722.96 259.798,1374.74 262.148,1363.98 264.499,1546.53 266.849,1390.33 269.2,1233.33 271.55,1494.78 273.901,1435.83 276.251,1380.75 278.602,1417.63 280.952,1450.6 283.303,1554.25 285.653,1396.78 288.004,1384.54 290.354,1270.98 292.705,1239.65 295.055,1314.72 297.406,1400.62 299.756,1673.52 302.107,1488.57 304.457,1464.43 306.807,1355.99 309.158,1427.15 311.508,1459.42 313.859,1531.85 316.209,1625.36 318.56,1598.95 320.91,1516.97 323.261,1582.78 325.611,1387.28 327.962,1443.14 330.312,1388.21 332.663,1407.62 335.013,1449.15 337.364,1493.74 339.714,1446.52 342.065,1360.02 344.415,1518.39 346.765,1455.67 349.116,1314.17 351.466,1395.18 353.817,1512.12 356.167,1397.33 358.518,1310.82 360.868,1343.34 363.219,1452.38 365.569,1451.01 367.92,1535.12 370.27,1317.33 372.621,1617.89 374.971,1404.83 377.322,1387.83 379.672,1364.38 382.023,1482.62 384.373,1585.43 386.724,1623.41 389.074,1340.63 391.424,1379.24 393.775,1349.98 396.125,1577.36 398.476,1555.47 400.826,1386.19 403.177,1376.91 405.527,1337.91 407.878,1583.8 410.228,1415.47 412.579,1372.88 414.929,1371.4 417.28,1422.76 419.63,1276.71 421.981,1510.53 424.331,1398.39 426.682,1371.03 429.032,1337.86 431.382,1436.53 433.733,1428.63 436.083,1575.96 438.434,1319.53 440.784,1582.1 443.135,1408.48 445.485,1333.62 447.836,1349.38 450.186,1419.8 452.537,1560.34 454.887,1509.38 457.238,1545.79 459.588,1454.15 461.939,1370.94 464.289,1355.06 466.64,1284.91 468.99,1516.87 471.341,1240.07 473.691,1487.2 476.041,1455 478.392,1386.54 480.742,1394.68 483.093,1365.94 485.443,1414.88 487.794,1486.76 490.144,1412.68 492.495,1353.34 494.845,1572.32 497.196,1601.89 499.546,1517.37 501.897,1423.57 504.247,1549.18 506.598,1480.14 508.948,1438.97 511.299,1625.65 513.649,1484.63 515.999,1249.8 518.35,1506.67 520.7,1302.08 523.051,1410.37 525.401,1588.32 527.752,1519.79 530.102,1366.22 532.453,1354.6 534.803,1375.2 537.154,1430.66 539.504,1394.36 541.855,1439.14 544.205,1281.39 546.556,1324.62 548.906,1513.21 551.257,1401.34 553.607,1478.8 555.958,1476.69 558.308,1450.45 560.658,1368.38 563.009,1449.17 565.359,1369.9 567.71,1420.61 570.06,1310.63 572.411,1546.43 574.761,1331.78 577.112,1444.93 579.462,1595.52 581.813,1425 584.163,1432.46 586.514,1464.28 588.864,1368.1 591.215,1751.15 593.565,1463.54 595.916,1386.39 598.266,1273.62 600.616,1387.62 602.967,1468.9 605.317,1362.06 607.668,1480.37 610.018,1447.15 612.369,1450.71 614.719,1411.07 617.07,1372.27 619.42,1478.25 621.771,1313.77 624.121,1451.74 626.472,1411.86 628.822,1370.08 631.173,1363.64 633.523,1478.85 635.874,1346.82 638.224,1682.07 640.575,1262.03 642.925,1548.83 645.275,1322.5 647.626,1423.86 649.976,1394.78 652.327,1327.43 654.677,1429.06 657.028,1492.56 659.378,1297.27 661.729,1389.18 664.079,1299.2 666.43,1479.83 668.78,1436.99 671.131,1375.16 673.481,1501.06 675.832,1387.06 678.182,1409.39 680.533,1587.41 682.883,1574.65 685.233,1394.34 687.584,1347.4 689.934,1487.59 692.285,1387.36 694.635,1240.75 696.986,1520.07 699.336,1246.35 701.687,1406.39 704.037,1267.29 706.388,1568.18 708.738,1443.14 711.089,1416.56 713.439,1372.55 715.79,1406.73 718.14,1414.67 720.491,1322.91 722.841,1302.1 725.192,1608.86 727.542,1483.1 729.892,1447.93 732.243,1454.31 734.593,1567.19 736.944,1430.86 739.294,1409.69 741.645,1448.21 743.995,1399.87 746.346,1217.79 748.696,1488.26 751.047,1250.35 753.397,1391.76 755.748,1518.06 758.098,1254.81 760.449,1504.48 762.799,1448.02 765.15,1500.6 767.5,1593.61 769.85,1299.69 772.201,1411.34 774.551,1320.11 776.902,1534.3 779.252,1457.36 781.603,1463.16 783.953,1487.95 786.304,1455.2 788.654,1504.04 791.005,1537.1 793.355,1378.7 795.706,1334.04 798.056,1139.36 800.407,1548.92 802.757,1390.08 805.108,1315.59 807.458,1364.47 809.809,1282.99 812.159,1482.85 814.509,1502.68 816.86,1423.51 819.21,1367.52 821.561,1406.13 823.911,1400.82 826.262,1560.06 828.612,1323.04 830.963,1355.04 833.313,1476.27 835.664,1434.3 838.014,1485.73 840.365,1360.62 842.715,1370.77 845.066,1357.79 847.416,1404.67 849.767,1358.04 852.117,1457.46 854.467,1238.17 856.818,1304.84 859.168,1450.14 861.519,1509.95 863.869,1472.6 866.22,1510.65 868.57,1303.25 870.921,1264.2 873.271,1474.94 875.622,1483.06 877.972,1463.5 880.323,1481.28 882.673,1512.97 885.024,1370.85 887.374,1312.64 889.725,1325.37 892.075,1568.94 894.426,1457.81 896.776,1352.27 899.126,1619.23 901.477,1484.61 903.827,1535.09 906.178,1530.2 908.528,1526.66 910.879,1366 913.229,1214.89 915.58,1379.19 917.93,1226.35 920.281,1507.96 922.631,1422.48 924.982,1436.44 927.332,1501.21 929.683,1540.37 932.033,1412.19 934.384,1646.46 936.734,1353.97 939.084,1485.04 941.435,1579 943.785,1371.46 946.136,1378.5 948.486,1588.3 950.837,1280.98 953.187,1268.93 955.538,1341.54 957.888,1478.22 960.239,1300.44 962.589,1242.95 964.94,1495.75 967.29,1491.01 969.641,1408.55 971.991,1427.01 974.342,1461.57 976.692,1476.11 979.043,1273.31 981.393,1547.87 983.743,1471.25 986.094,1497.63 988.444,1265.68 990.795,1375.46 993.145,1510.37 995.496,1645.75 997.846,1380.38 1000.2,1412.48 1002.55,1469.79 1004.9,1599.82 1007.25,1446.92 1009.6,1427.51 1011.95,1584.65 1014.3,1386.28 1016.65,1341.19 1019,1323.36 1021.35,1260.17 1023.7,1267.96 1026.05,1457.47 1028.4,1418.42 1030.75,1673.28 1033.1,1538.47 1035.45,1443.19 1037.8,1659 1040.15,1512.77 1042.51,1632.46 1044.86,1321.09 1047.21,1439.63 1049.56,1290.77 1051.91,1418.87 1054.26,1384.14 1056.61,1303.67 1058.96,1290.41 1061.31,1463.44 1063.66,1320.98 1066.01,1517.39 1068.36,1303.91 1070.71,1564.32 1073.06,1394.78 1075.41,1357.7 1077.76,1398.21 1080.11,1570.01 1082.46,1496.44 1084.81,1501.13 1087.16,1405.05 1089.51,1373.65 1091.87,1284.23 1094.22,1490.63 1096.57,1484.43 1098.92,1422.6 1101.27,1477.97 1103.62,1429.71 1105.97,1516.48 1108.32,1231.99 1110.67,1455.31 1113.02,1378.9 1115.37,1366.25 1117.72,1398.36 1120.07,1336.11 1122.42,1558.88 1124.77,1385.24 1127.12,1455.6 1129.47,1272.1 1131.82,1399.99 1134.17,1481.66 1136.52,1434.14 1138.87,1278.76 1141.23,1642.75 1143.58,1317.97 1145.93,1374.68 1148.28,1490.44 1150.63,1512.63 1152.98,1353.37 1155.33,1336.66 1157.68,1389.94 1160.03,1443.75 1162.38,1291.42 1164.73,1280.87 1167.08,1376.07 1169.43,1345.45 1171.78,1528.39 1174.13,1240.82 1176.48,1361.77 1178.83,1420.67 1181.18,1386.21 1183.53,1388.84 1185.88,1505.39 1188.23,1350.3 1190.59,1452.25 1192.94,1559.83 1195.29,1445.24 1197.64,1576.9 1199.99,1343.01 1202.34,1329.04 1204.69,1386.75 1207.04,1409.24 1209.39,1490.23 1211.74,1498.41 1214.09,1481.52 1216.44,1358.58 1218.79,1394.46 1221.14,1305.92 1223.49,1315.27 1225.84,1477.5 1228.19,1560.4 1230.54,1466.95 1232.89,1524.44 1235.24,1386.69 1237.59,1570.6 1239.94,1153.54 1242.3,1583.42 1244.65,1372.45 1247,1568.9 1249.35,1393.7 1251.7,1601.96 1254.05,1489.27 1256.4,1311.84 1258.75,1485.66 1261.1,1416.8 1263.45,1413.45 1265.8,1479.15 1268.15,1362.46 1270.5,1170.59 1272.85,1407.51 1275.2,1380.09 1277.55,1443.78 1279.9,1373.13 1282.25,1357.2 1284.6,1376.35 1286.95,1404.9 1289.3,1309.92 1291.66,1390.65 1294.01,1412.48 1296.36,1328.48 1298.71,1450.66 1301.06,1547.16 1303.41,1451.35 1305.76,1479.29 1308.11,1420.13 1310.46,1449.61 1312.81,1354.58 1315.16,1315.4 1317.51,1511.25 1319.86,1401.78 1322.21,1266.04 1324.56,1522.87 1326.91,1368.2 1329.26,1510.35 1331.61,1468.57 1333.96,1418.72 1336.31,1492.77 1338.66,1362.16 1341.02,1299.26 1343.37,1550.28 1345.72,1484.28 1348.07,1371.97 1350.42,1421.31 1352.77,1375.48 1355.12,1266.27 1357.47,1316.28 1359.82,1557.11 1362.17,1430.43 1364.52,1451.44 1366.87,1312.81 1369.22,1419.58 1371.57,1471.83 1373.92,1513.82 1376.27,1350.68 1378.62,1339.11 1380.97,1259.1 1383.32,1468.25 1385.67,1610.05 1388.02,1398.11 1390.38,1322.12 1392.73,1503.44 1395.08,1305.77 1397.43,1616.26 1399.78,1437.52 1402.13,1572.5 1404.48,1518.02 1406.83,1478.18 1409.18,1338.99 1411.53,1368.22 1413.88,1647.95 1416.23,1384.52 1418.58,1328.7 1420.93,1464.03 1423.28,1334.58 1425.63,1296.31 1427.98,1158.38 1430.33,1393.99 1432.68,1504.14 1435.03,1538.97 1437.38,1356.76 1439.74,1369.16 1442.09,1244.27 1444.44,1309.43 1446.79,1480.59 1449.14,1567.43 1451.49,1379.82 1453.84,1439.77 1456.19,1211.14 1458.54,1483.01 1460.89,1332.12 1463.24,1436.82 1465.59,1331.87 1467.94,1414.98 1470.29,1523.06 1472.64,1493.39 1474.99,1317.54 1477.34,1389.87 1479.69,1549.82 1482.04,1527.32 1484.39,1451.17 1486.74,1337.6 1489.1,1520.83 1491.45,1455.86 1493.8,1321.04 1496.15,1380.43 1498.5,1514.94 1500.85,1413.72 1503.2,1625.1 1505.55,1534.09 1507.9,1413.95 1510.25,1534.68 1512.6,1392.89 1514.95,1701.86 1517.3,1382.39 1519.65,1458.22 1522,1534.39 1524.35,1539.1 1526.7,1614.12 1529.05,1576.92 1531.4,1512.48 1533.75,1592.87 1536.1,1584.49 1538.45,1326.4 1540.81,1483.51 1543.16,1321.24 1545.51,1441.11 1547.86,1463.14 1550.21,1419.35 1552.56,1337.78 1554.91,1330.23 1557.26,1517.34 1559.61,1469.24 1561.96,1387.03 1564.31,1629.33 1566.66,1358.08 1569.01,1449.09 1571.36,1623.21 1573.71,1468.98 1576.06,1302.52 1578.41,1544.12 1580.76,1607.78 1583.11,1443.4 1585.46,1458.8 1587.81,1503.65 1590.17,1323.58 1592.52,1342.46 1594.87,1631.21 1597.22,1590.49 1599.57,1354.91 1601.92,1492.52 1604.27,1232.89 1606.62,1399.54 1608.97,1449.57 1611.32,1581.71 1613.67,1190.54 1616.02,1650.2 1618.37,1379.06 1620.72,1490.08 1623.07,1489.38 1625.42,1405.43 1627.77,1605.66 1630.12,1387.14 1632.47,1493.64 1634.82,1341.13 1637.17,1258.44 1639.53,1451.44 1641.88,1381.99 1644.23,1410.83 1646.58,1297.99 1648.93,1354.37 1651.28,1428.9 1653.63,1395.35 1655.98,1411.9 1658.33,1505.7 1660.68,1482.41 1663.03,1231.5 1665.38,1264.5 1667.73,1491.37 1670.08,1378.33 1672.43,1449.14 1674.78,1220.59 1677.13,1488.22 1679.48,1419.75 1681.83,1383.84 1684.18,1549.5 1686.53,1442.45 1688.89,1576.37 1691.24,1509.9 1693.59,1363.5 1695.94,1428.15 1698.29,1398.16 1700.64,1548.76 1702.99,1583.36 1705.34,1360.39 1707.69,1268.22 1710.04,1360.54 1712.39,1402.51 1714.74,1491.3 1717.09,1339.94 1719.44,1381.57 1721.79,1509.42 1724.14,1370.91 1726.49,1460.95 1728.84,1434.47 1731.19,1395.84 1733.54,1230.35 1735.89,1429.59 1738.25,1414.48 1740.6,1503.72 1742.95,1488.24 1745.3,1391.25 1747.65,1433.59 1750,1190.39 1752.35,1456.45 1754.7,1404.29 1757.05,1271.54 1759.4,1545.59 1761.75,1442.44 1764.1,1458.5 1766.45,1401.32 1768.8,1442.83 1771.15,1466.76 1773.5,1214.33 1775.85,1421.24 1778.2,1444.03 1780.55,1397.13 1782.9,1535.88 1785.25,1410.89 1787.6,1480.73 1789.96,1260.63 1792.31,1395.92 1794.66,1379.66 1797.01,1335.76 1799.36,1495.29 1801.71,1539.11 1804.06,1362.81 1806.41,1397.07 1808.76,1499.82 1811.11,1433.34 1813.46,1317.48 1815.81,1493.76 1818.16,1677.1 1820.51,1309.68 1822.86,1429.46 1825.21,1466.45 1827.56,1621.4 1829.91,1366.94 1832.26,1547.1 1834.61,1293.84 1836.96,1331.26 1839.32,1547.43 1841.67,1271.87 1844.02,1397.45 1846.37,1421.79 1848.72,1322.56 1851.07,1395.73 1853.42,1280.42 1855.77,1447.41 1858.12,1529.01 1860.47,1324.54 1862.82,1176.67 1865.17,1383.57 1867.52,1429.5 1869.87,1350.91 1872.22,1375.69 1874.57,1269.78 1876.92,1276.24 1879.27,1452.32 1881.62,1518.45 1883.97,1623.67 1886.32,1523.4 1888.68,1276.53 1891.03,1333.65 1893.38,1260.66 1895.73,1449.08 1898.08,1476.46 1900.43,1366.79 1902.78,1356.48 1905.13,1510.75 1907.48,1463.27 1909.83,1539.77 1912.18,1568.83 1914.53,1345.05 1916.88,1273.49 1919.23,1393.83 1921.58,1522.63 1923.93,1523.46 1926.28,1355.52 1928.63,1391.73 1930.98,1327.54 1933.33,1380.31 1935.68,1424.87 1938.04,1325.89 1940.39,1397.98 1942.74,1611.2 1945.09,1338.18 1947.44,1565.66 1949.79,1359.13 1952.14,1327.37 1954.49,1401.71 1956.84,1297.73 1959.19,1438.09 1961.54,1619.79 1963.89,1395.56 1966.24,1409.65 1968.59,1629.65 1970.94,1445.69 1973.29,1621.73 1975.64,1374.88 1977.99,1335.98 1980.34,1414.27 1982.69,1378.56 1985.04,1330.79 1987.4,1443.63 1989.75,1447.01 1992.1,1460.81 1994.45,1393.38 1996.8,1330.45 1999.15,1311.93 2001.5,1542.47 2003.85,1508.58 2006.2,1303.1 2008.55,1387.51 2010.9,1311.78 2013.25,1528.84 2015.6,1486.3 2017.95,1382.95 2020.3,1414.53 2022.65,1608.67 2025,1393.5 2027.35,1527.72 2029.7,1341.18 2032.05,1685.01 2034.4,1443.98 2036.76,1228.38 2039.11,1505.62 2041.46,1333.42 2043.81,1463.91 2046.16,1557.01 2048.51,1429.82 2050.86,1557.6 2053.21,1401.13 2055.56,1321.34 2057.91,1488.71 2060.26,1277.2 2062.61,1410.74 2064.96,1451.76 2067.31,1530.53 2069.66,1591.63 2072.01,1123.18 2074.36,1377.29 2076.71,1386.12 2079.06,1479.1 2081.41,1410.65 2083.76,1652.17 2086.11,1255.85 2088.47,1427.92 2090.82,1307.23 2093.17,1520.99 2095.52,1245.33 2097.87,1412.38 2100.22,1507.96 2102.57,1619.99 2104.92,1473.8 2107.27,1534.5 2109.62,1562.38 2111.97,1358.67 2114.32,1362.52 2116.67,1505.29 2119.02,1476.03 2121.37,1554.04 2123.72,1384.03 2126.07,1454.81 2128.42,1479.95 2130.77,1355.73 2133.12,1547.45 2135.47,1550.17 2137.83,1452.87 2140.18,1412.76 2142.53,1464.11 2144.88,1460.29 2147.23,1491.22 2149.58,1416.87 2151.93,1565.64 2154.28,1334.79 2156.63,1625.38 2158.98,1383.78 2161.33,1298.73 2163.68,1486.2 2166.03,1462.78 2168.38,1561.58 2170.73,1296.98 2173.08,1318.29 2175.43,1406.22 2177.78,1430.99 2180.13,1284.65 2182.48,1661.66 2184.83,1379.21 2187.19,1458.85 2189.54,1312.97 2191.89,1513.56 2194.24,1355.25 2196.59,1496.51 2198.94,1272.39 2201.29,1357.48 2203.64,1418.24 2205.99,1587.96 2208.34,1505.09 2210.69,1296.31 2213.04,1434.32 2215.39,1440.18 2217.74,1403.29 2220.09,1457.2 2222.44,1469.8 2224.79,1348.4 2227.14,1132.99 2229.49,1502.93 2231.84,1464.9 2234.19,1333.63 2236.55,1450.38 2238.9,1375.57 2241.25,1398.47 2243.6,1396.45 2245.95,1539.62 2248.3,1424.39 2250.65,1505.51 2253,1398.86 2255.35,1322.85 2257.7,1442.15 2260.05,1215.86 2262.4,1220.69 2264.75,1389.36 2267.1,1514.85 2269.45,1605.62 2271.8,1505.84 2274.15,1347.42 2276.5,1462.28 2278.85,1455.6 2281.2,1420.66 2283.55,1457.8 2285.91,1334.91 2288.26,1396.43 2290.61,1443.98 2292.96,1434.46 2295.31,1445.33 2297.66,1488.29 2300.01,1364.56 2302.36,1557.91 2304.71,1434.74 2307.06,1384.44 2309.41,1291.31 2311.76,1500.89 2314.11,1319.06 2316.46,1377.31 2318.81,1285.91 2321.16,1606.83 2323.51,1348.03 2325.86,1241.18 2328.21,1454.08 2330.56,1464.52 2332.91,1487.25 2335.27,1176.57 2337.62,1421.95 2339.97,1544.06 2342.32,1455.11 2344.67,1318.56 2347.02,1458.75 2349.37,1461.7 2351.72,1451.45 2354.07,1258.17 2356.42,1218.19 2358.77,1542.06 2361.12,1495.92 2363.47,1342.36 2365.82,1341.16 2368.17,1384.84 2370.52,1510.35 2372.87,1475.61 2375.22,1385.16 2377.57,1350.88 2379.92,1296.8 2382.27,1558.57 2384.62,1414.12 2386.98,1501.06 2389.33,1349.19 2391.68,1606.75 2394.03,1435.42 2396.38,1547.02 2398.73,1497.63 2401.08,1298.26 2403.43,1348.35 2405.78,1462.07 2408.13,1464.3 2410.48,1362.45 2412.83,1421.22 2415.18,1592.13 2417.53,1349.3 2419.88,1301.42 2422.23,1432.23 2424.58,1354.29 2426.93,1338.07 2429.28,1460.19 2431.63,1262.68 2433.98,1276.38 2436.34,1258.45 2438.69,1402.24 2441.04,1541.25 2443.39,1479.98 2445.74,1491.6 2448.09,1282.9 2450.44,1474.68 2452.79,1445.04 2455.14,1432.54 2457.49,1268.56 2459.84,1663.37 2462.19,1577.45 2464.54,1219.85 2466.89,1528.11 2469.24,1333.94 2471.59,1404.74 2473.94,1427.65 2476.29,1448.22 2478.64,1378.85 2480.99,1325.22 2483.34,1647.46 2485.7,1467.32 2488.05,1442.76 2490.4,1467.84 2492.75,1428.19 2495.1,1326.51 2497.45,1244.97 2499.8,1611.16 2502.15,1501.42 2504.5,1623.96 2506.85,1254.97 2509.2,1294.75 2511.55,1463.65 2513.9,1345.8 2516.25,1453.43 2518.6,1381.36 2520.95,1533 2523.3,1463.57 2525.65,1367.64 2528,1498.15 2530.35,1524.64 2532.7,1397.51 2535.06,1429.06 2537.41,1522.03 2539.76,1439.9 2542.11,1454.57 2544.46,1457.44 2546.81,1329.25 2549.16,1435.1 2551.51,1524.73 2553.86,1391.8 2556.21,1557.08 2558.56,1334.41 2560.91,1548.87 2563.26,1334.92 2565.61,1463.73 2567.96,1363.78 2570.31,1307.92 "></polyline>
<polyline clip-path="url(#clip452)" style="stroke:#e26f46; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,843.578 224.541,679.788 226.891,851.042 229.242,1029.63 231.592,970.455 233.943,836.049 236.293,1171.92 238.644,879.913 240.994,712.793 243.345,966.648 245.695,708.323 248.046,1017.66 250.396,935.586 252.747,714.083 255.097,791.261 257.448,962.49 259.798,783.681 262.148,1075.17 264.499,1005.29 266.849,718.904 269.2,835.845 271.55,852.678 273.901,713.336 276.251,973.552 278.602,836.844 280.952,782.469 283.303,1052.42 285.653,790.989 288.004,956.443 290.354,910.913 292.705,891.196 295.055,843.666 297.406,1012.78 299.756,764.875 302.107,1019.52 304.457,1065.95 306.807,896.315 309.158,1000.28 311.508,940.352 313.859,911.941 316.209,802.506 318.56,958.845 320.91,731.641 323.261,915.811 325.611,776.974 327.962,901.34 330.312,1097.28 332.663,814.449 335.013,766.84 337.364,749.832 339.714,1033.62 342.065,1023.45 344.415,1064.73 346.765,826.331 349.116,964.851 351.466,973.332 353.817,994.969 356.167,1070.54 358.518,996.585 360.868,926.685 363.219,802.729 365.569,796.584 367.92,802.908 370.27,872.753 372.621,815.838 374.971,906.982 377.322,779.826 379.672,818.211 382.023,985.416 384.373,893.217 386.724,939.022 389.074,913.566 391.424,1131.34 393.775,834.06 396.125,990.443 398.476,988.048 400.826,856.007 403.177,984.709 405.527,971.914 407.878,976.936 410.228,937.825 412.579,918.114 414.929,1020.48 417.28,987.381 419.63,1031.91 421.981,777.796 424.331,961.959 426.682,805.164 429.032,949.632 431.382,907.132 433.733,772.886 436.083,891.945 438.434,1048.07 440.784,882.301 443.135,801.562 445.485,839.18 447.836,940.119 450.186,1058.02 452.537,931.013 454.887,955.71 457.238,889.78 459.588,884.428 461.939,924.636 464.289,827.659 466.64,886.249 468.99,933.023 471.341,1006.52 473.691,822.542 476.041,771.972 478.392,818.713 480.742,959.162 483.093,922.9 485.443,753.893 487.794,716.196 490.144,1106.58 492.495,859.344 494.845,913.001 497.196,875.434 499.546,901.306 501.897,866.017 504.247,909.881 506.598,832.925 508.948,897.974 511.299,782.358 513.649,935.223 515.999,789.178 518.35,638.328 520.7,910.332 523.051,862.84 525.401,948.216 527.752,586.342 530.102,833.445 532.453,938.598 534.803,999.072 537.154,896.507 539.504,924.075 541.855,886.138 544.205,932.402 546.556,804.894 548.906,903.697 551.257,951.403 553.607,844.787 555.958,1094.69 558.308,934.868 560.658,842.837 563.009,1069.44 565.359,916.065 567.71,1084.75 570.06,827.822 572.411,868.43 574.761,988.354 577.112,850.013 579.462,1049.92 581.813,864.617 584.163,959.791 586.514,938.445 588.864,962.837 591.215,797.041 593.565,754.93 595.916,848.143 598.266,795.172 600.616,947.862 602.967,875.208 605.317,957.17 607.668,926.362 610.018,989.412 612.369,907.239 614.719,911.579 617.07,854.078 619.42,668.579 621.771,1101.57 624.121,830.182 626.472,1044.09 628.822,1036.08 631.173,939.974 633.523,831.274 635.874,757.151 638.224,824.755 640.575,915.862 642.925,1048.46 645.275,980.33 647.626,829.559 649.976,788.73 652.327,883.039 654.677,690.07 657.028,816.106 659.378,964.722 661.729,976.966 664.079,759.952 666.43,899.611 668.78,1001.04 671.131,793.012 673.481,929.553 675.832,1024.79 678.182,984.848 680.533,873.698 682.883,1146.2 685.233,980.623 687.584,937.414 689.934,896.668 692.285,926.969 694.635,892.384 696.986,1010.68 699.336,1064.25 701.687,985.673 704.037,1019.98 706.388,977.105 708.738,1015.57 711.089,802.648 713.439,1122.07 715.79,741.889 718.14,925.607 720.491,865.891 722.841,879.733 725.192,884.408 727.542,1095.93 729.892,851.978 732.243,948.469 734.593,905.295 736.944,766.768 739.294,787.793 741.645,941.929 743.995,886.992 746.346,770.833 748.696,1113.36 751.047,908.939 753.397,875.942 755.748,1199.67 758.098,948.345 760.449,997.357 762.799,849.452 765.15,1061.13 767.5,674.196 769.85,787.616 772.201,875.805 774.551,978.602 776.902,871.37 779.252,822.799 781.603,789.643 783.953,843.413 786.304,943.99 788.654,832.972 791.005,920.363 793.355,818.172 795.706,829.251 798.056,726.842 800.407,958.376 802.757,909.249 805.108,1134.27 807.458,889.621 809.809,897.158 812.159,932.316 814.509,931.658 816.86,1000.88 819.21,903.433 821.561,953.54 823.911,838.891 826.262,967.342 828.612,854.227 830.963,842.332 833.313,743.395 835.664,926.975 838.014,926.528 840.365,902.795 842.715,708.488 845.066,1101.89 847.416,948.984 849.767,849.908 852.117,865.012 854.467,809.742 856.818,834.579 859.168,834.329 861.519,1010.15 863.869,836.323 866.22,762.507 868.57,890.793 870.921,705.144 873.271,842.805 875.622,1010.55 877.972,926.365 880.323,988.428 882.673,856.897 885.024,903.19 887.374,916.254 889.725,980.37 892.075,896.875 894.426,935.193 896.776,778.165 899.126,930.99 901.477,836.423 903.827,826.427 906.178,772.171 908.528,990.144 910.879,951.592 913.229,828.205 915.58,972.899 917.93,983.098 920.281,897.264 922.631,970.77 924.982,900.996 927.332,912.978 929.683,762.314 932.033,880.722 934.384,854.454 936.734,863.008 939.084,982.836 941.435,994.65 943.785,889.835 946.136,911.447 948.486,1045.17 950.837,785.719 953.187,867.526 955.538,913.661 957.888,995.217 960.239,958.234 962.589,823.767 964.94,924.013 967.29,864.899 969.641,900.538 971.991,893.982 974.342,903.663 976.692,663.086 979.043,800.184 981.393,815.153 983.743,824.94 986.094,870.155 988.444,857.336 990.795,965.243 993.145,937.841 995.496,821.015 997.846,824.562 1000.2,881.093 1002.55,861.217 1004.9,817.375 1007.25,851.077 1009.6,914.742 1011.95,639.554 1014.3,1108.79 1016.65,1000.1 1019,1133.43 1021.35,1027.83 1023.7,999.915 1026.05,841.428 1028.4,868.327 1030.75,974.194 1033.1,899.255 1035.45,931.916 1037.8,801.632 1040.15,1006.76 1042.51,969.462 1044.86,922.414 1047.21,880.628 1049.56,869.765 1051.91,1043.03 1054.26,919.477 1056.61,901.406 1058.96,844.1 1061.31,865.298 1063.66,1005.87 1066.01,895.257 1068.36,1039.28 1070.71,854.127 1073.06,1122.22 1075.41,899.285 1077.76,1061.7 1080.11,921.513 1082.46,887.859 1084.81,929.994 1087.16,997.826 1089.51,849.481 1091.87,960.483 1094.22,809.221 1096.57,765.371 1098.92,1030.7 1101.27,962.706 1103.62,983.394 1105.97,1066.64 1108.32,852.125 1110.67,909.049 1113.02,896.173 1115.37,1098.82 1117.72,913.694 1120.07,866.792 1122.42,1063.27 1124.77,952.523 1127.12,943.489 1129.47,869.67 1131.82,843.718 1134.17,867.747 1136.52,885.278 1138.87,928.613 1141.23,881.848 1143.58,675.715 1145.93,1113.44 1148.28,780.393 1150.63,890.382 1152.98,962.778 1155.33,966.759 1157.68,1067.75 1160.03,868.507 1162.38,882.609 1164.73,820.785 1167.08,904.105 1169.43,961.119 1171.78,895.619 1174.13,1028.1 1176.48,773.478 1178.83,1069.06 1181.18,954.72 1183.53,898.314 1185.88,916.295 1188.23,859.861 1190.59,723.242 1192.94,919.562 1195.29,691.929 1197.64,908.809 1199.99,626.389 1202.34,831.283 1204.69,981.645 1207.04,1120.69 1209.39,924.17 1211.74,930.636 1214.09,991.818 1216.44,960.199 1218.79,973.42 1221.14,1006.46 1223.49,898.809 1225.84,817.772 1228.19,774.789 1230.54,837.092 1232.89,963.715 1235.24,832.961 1237.59,738.706 1239.94,988.812 1242.3,900.376 1244.65,994.746 1247,886.777 1249.35,887.575 1251.7,987.564 1254.05,907.044 1256.4,1016.66 1258.75,786.745 1261.1,882.172 1263.45,1118.08 1265.8,1001.25 1268.15,754.64 1270.5,626.266 1272.85,978.492 1275.2,906.422 1277.55,905.154 1279.9,749.466 1282.25,850.963 1284.6,878.946 1286.95,902.746 1289.3,878.456 1291.66,868.458 1294.01,944.394 1296.36,834.725 1298.71,914.451 1301.06,1027.56 1303.41,900.847 1305.76,739.599 1308.11,751.509 1310.46,1055.97 1312.81,946.128 1315.16,947.396 1317.51,787.136 1319.86,843.395 1322.21,787.458 1324.56,1026.23 1326.91,908.332 1329.26,1040.85 1331.61,717.539 1333.96,828.564 1336.31,869.133 1338.66,1067.46 1341.02,928.666 1343.37,905.749 1345.72,936.658 1348.07,997.089 1350.42,1004.27 1352.77,948.52 1355.12,979.002 1357.47,952.15 1359.82,804.785 1362.17,797.205 1364.52,771.735 1366.87,845.445 1369.22,836.931 1371.57,909.578 1373.92,904.097 1376.27,889.762 1378.62,976.05 1380.97,926.601 1383.32,951.166 1385.67,954.61 1388.02,904.709 1390.38,1010.15 1392.73,861.218 1395.08,788.857 1397.43,894.889 1399.78,893.611 1402.13,872.463 1404.48,902.035 1406.83,1001.62 1409.18,736.122 1411.53,920.41 1413.88,852.334 1416.23,806.359 1418.58,598.87 1420.93,1002.04 1423.28,878.294 1425.63,814.946 1427.98,933.244 1430.33,981.973 1432.68,817.354 1435.03,998.704 1437.38,733.518 1439.74,1036.32 1442.09,1225.83 1444.44,858.283 1446.79,776.546 1449.14,968.038 1451.49,681.243 1453.84,894.252 1456.19,1037.38 1458.54,972.333 1460.89,830.041 1463.24,1117.1 1465.59,942.754 1467.94,934.909 1470.29,1059.35 1472.64,767.081 1474.99,753.139 1477.34,1011.18 1479.69,982.639 1482.04,926.594 1484.39,688.703 1486.74,923.676 1489.1,879.823 1491.45,953.774 1493.8,990.602 1496.15,1115.82 1498.5,954.864 1500.85,1091.88 1503.2,755.327 1505.55,1001.41 1507.9,944.781 1510.25,956.39 1512.6,1059.86 1514.95,900.554 1517.3,1093.9 1519.65,687.554 1522,871.109 1524.35,974.283 1526.7,932.798 1529.05,839.008 1531.4,1113.21 1533.75,1038.06 1536.1,953.461 1538.45,1140.42 1540.81,858.275 1543.16,797.532 1545.51,686.886 1547.86,790.908 1550.21,855.861 1552.56,890.254 1554.91,931.239 1557.26,745.574 1559.61,1034.7 1561.96,983.498 1564.31,750.088 1566.66,953.154 1569.01,885.544 1571.36,1024.76 1573.71,868.152 1576.06,794.872 1578.41,937.784 1580.76,854.716 1583.11,880.307 1585.46,886.027 1587.81,1029.49 1590.17,774.748 1592.52,795.131 1594.87,941.495 1597.22,910.453 1599.57,851.832 1601.92,1066.98 1604.27,896.211 1606.62,881.529 1608.97,932.93 1611.32,861.144 1613.67,1017.07 1616.02,1135.85 1618.37,1017.63 1620.72,894.838 1623.07,858.037 1625.42,1144.12 1627.77,977.45 1630.12,960.881 1632.47,748.44 1634.82,946.079 1637.17,1055.17 1639.53,929.114 1641.88,784.456 1644.23,815.39 1646.58,984.552 1648.93,972.457 1651.28,993.37 1653.63,976.627 1655.98,807.603 1658.33,1100.52 1660.68,966.814 1663.03,897.375 1665.38,813.019 1667.73,1026.83 1670.08,919.726 1672.43,950.167 1674.78,919.801 1677.13,960.388 1679.48,956.61 1681.83,677.37 1684.18,795.058 1686.53,1022.04 1688.89,976.519 1691.24,791.89 1693.59,838.481 1695.94,829.955 1698.29,1071.84 1700.64,891.342 1702.99,885.714 1705.34,692.649 1707.69,859.2 1710.04,1137.46 1712.39,946.364 1714.74,972.082 1717.09,895.181 1719.44,895.425 1721.79,769.808 1724.14,760.476 1726.49,1079.42 1728.84,863.962 1731.19,966.764 1733.54,890.509 1735.89,804.467 1738.25,861.854 1740.6,937.166 1742.95,813.383 1745.3,995.821 1747.65,916.017 1750,1012.32 1752.35,844.784 1754.7,872.65 1757.05,848.819 1759.4,1019.84 1761.75,1110.01 1764.1,855.68 1766.45,919.536 1768.8,1047.85 1771.15,858.608 1773.5,1215.19 1775.85,1015.74 1778.2,1149.29 1780.55,917.23 1782.9,1035.99 1785.25,1002.8 1787.6,812.554 1789.96,898.33 1792.31,1102.59 1794.66,883.423 1797.01,886.732 1799.36,1035.66 1801.71,930.071 1804.06,849.575 1806.41,815.323 1808.76,1192.65 1811.11,940.104 1813.46,981.508 1815.81,1082.12 1818.16,921.82 1820.51,712.695 1822.86,883.13 1825.21,918.831 1827.56,866.263 1829.91,887.676 1832.26,960.467 1834.61,890.333 1836.96,848.638 1839.32,1016.19 1841.67,942.14 1844.02,824.976 1846.37,831.52 1848.72,779.8 1851.07,972.854 1853.42,896.006 1855.77,856.86 1858.12,854.988 1860.47,808.86 1862.82,1041.86 1865.17,1037.14 1867.52,858.79 1869.87,794.464 1872.22,905.114 1874.57,956.72 1876.92,1073.22 1879.27,953.505 1881.62,773.205 1883.97,886.525 1886.32,884.97 1888.68,921.677 1891.03,890.396 1893.38,1089.54 1895.73,843.083 1898.08,1025.18 1900.43,946.184 1902.78,892.086 1905.13,1060.18 1907.48,836.614 1909.83,874.532 1912.18,977.216 1914.53,856.366 1916.88,1005.22 1919.23,937.016 1921.58,840.123 1923.93,729.223 1926.28,858.385 1928.63,969.71 1930.98,926.429 1933.33,833.707 1935.68,1090.8 1938.04,847.488 1940.39,1090.43 1942.74,925.47 1945.09,836.627 1947.44,737.996 1949.79,876.073 1952.14,1201.9 1954.49,935.146 1956.84,930.015 1959.19,1031.74 1961.54,920.709 1963.89,1047.15 1966.24,735.186 1968.59,883.827 1970.94,842.819 1973.29,806.351 1975.64,945.297 1977.99,952.978 1980.34,916.507 1982.69,1022.9 1985.04,1012.73 1987.4,915.462 1989.75,977.609 1992.1,753.096 1994.45,799.286 1996.8,762.39 1999.15,867.329 2001.5,976.889 2003.85,860.163 2006.2,962.428 2008.55,730.899 2010.9,922.674 2013.25,903.529 2015.6,765.413 2017.95,954.966 2020.3,1038.7 2022.65,1048.53 2025,977.531 2027.35,866.213 2029.7,914.612 2032.05,770.619 2034.4,1046.61 2036.76,934.675 2039.11,943.995 2041.46,1097.61 2043.81,823.048 2046.16,856.621 2048.51,946.112 2050.86,966.463 2053.21,747.625 2055.56,783.889 2057.91,989.576 2060.26,779.809 2062.61,982.848 2064.96,809.091 2067.31,820.02 2069.66,1116.94 2072.01,775.462 2074.36,899.832 2076.71,1054.11 2079.06,1037.27 2081.41,934.033 2083.76,1021.29 2086.11,902.289 2088.47,1111.77 2090.82,1013 2093.17,770.351 2095.52,914.949 2097.87,996.996 2100.22,891.218 2102.57,1016.87 2104.92,907.943 2107.27,898.947 2109.62,826.702 2111.97,924.06 2114.32,921.001 2116.67,940.247 2119.02,887.473 2121.37,857.411 2123.72,872.518 2126.07,758.202 2128.42,904.318 2130.77,1054.75 2133.12,932.976 2135.47,1039.73 2137.83,952.753 2140.18,763.221 2142.53,1002.58 2144.88,794.117 2147.23,854.295 2149.58,954.03 2151.93,930.038 2154.28,1025.65 2156.63,946.596 2158.98,982.934 2161.33,841.708 2163.68,822.545 2166.03,820.51 2168.38,1136.91 2170.73,883.763 2173.08,1047.45 2175.43,1021.81 2177.78,892.924 2180.13,744.596 2182.48,927.052 2184.83,873.427 2187.19,847.496 2189.54,982.123 2191.89,1090.99 2194.24,724.817 2196.59,901.317 2198.94,763.905 2201.29,1004.81 2203.64,870.148 2205.99,1053.91 2208.34,829.547 2210.69,833.054 2213.04,900.967 2215.39,782.176 2217.74,744.796 2220.09,1049.38 2222.44,803.991 2224.79,861.044 2227.14,831.066 2229.49,1090.55 2231.84,814.978 2234.19,763.57 2236.55,814.607 2238.9,967.455 2241.25,940.477 2243.6,1083.58 2245.95,934.769 2248.3,832.507 2250.65,958.315 2253,1103.93 2255.35,935.239 2257.7,942.088 2260.05,873.821 2262.4,1114.78 2264.75,899.232 2267.1,886.504 2269.45,733.956 2271.8,875.026 2274.15,1016.38 2276.5,866.204 2278.85,963.151 2281.2,938.192 2283.55,830.999 2285.91,938.516 2288.26,808.635 2290.61,891.392 2292.96,847.682 2295.31,778.919 2297.66,934.241 2300.01,957.745 2302.36,828.328 2304.71,822.937 2307.06,938.628 2309.41,1146.77 2311.76,1052.12 2314.11,728.322 2316.46,859.23 2318.81,894.927 2321.16,974.063 2323.51,939.148 2325.86,881.181 2328.21,847.309 2330.56,1101.43 2332.91,989.922 2335.27,705.797 2337.62,980.097 2339.97,811.998 2342.32,818.873 2344.67,855.263 2347.02,846.969 2349.37,946.905 2351.72,981.982 2354.07,852.197 2356.42,889.649 2358.77,935.49 2361.12,893.709 2363.47,854.76 2365.82,888.513 2368.17,896.752 2370.52,958.365 2372.87,1010.36 2375.22,931.112 2377.57,838.522 2379.92,876.96 2382.27,977.695 2384.62,898.293 2386.98,820.573 2389.33,954.318 2391.68,922.89 2394.03,768.609 2396.38,977.87 2398.73,875.122 2401.08,799.11 2403.43,795.517 2405.78,1082.39 2408.13,849.224 2410.48,792.807 2412.83,987.322 2415.18,868.994 2417.53,914.837 2419.88,1121.89 2422.23,762.164 2424.58,735.623 2426.93,744.24 2429.28,907.535 2431.63,1032.12 2433.98,928.491 2436.34,830.457 2438.69,927.16 2441.04,933.483 2443.39,947.917 2445.74,809.122 2448.09,829.778 2450.44,952.946 2452.79,1117.59 2455.14,971.455 2457.49,911.069 2459.84,882.693 2462.19,942.732 2464.54,898.271 2466.89,763.415 2469.24,997.045 2471.59,969.678 2473.94,1177.91 2476.29,1016.92 2478.64,882.827 2480.99,904.179 2483.34,870.123 2485.7,958.979 2488.05,934.608 2490.4,1002.39 2492.75,1007.5 2495.1,881.44 2497.45,700.283 2499.8,980.752 2502.15,973.878 2504.5,955.525 2506.85,847.698 2509.2,1064.15 2511.55,842.406 2513.9,920.599 2516.25,919.474 2518.6,776.08 2520.95,1020.83 2523.3,869.519 2525.65,817.509 2528,801.79 2530.35,753.296 2532.7,1087.23 2535.06,846.623 2537.41,957.139 2539.76,970.335 2542.11,787.055 2544.46,918.315 2546.81,788.138 2549.16,954.912 2551.51,1084.2 2553.86,794.244 2556.21,827.063 2558.56,673.175 2560.91,1016.31 2563.26,846.446 2565.61,792.386 2567.96,758.337 2570.31,1011.43 "></polyline>
<polyline clip-path="url(#clip452)" style="stroke:#3da44d; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,585.572 224.541,263.055 226.891,360.412 229.242,304.081 231.592,594.746 233.943,369.901 236.293,370.245 238.644,399.602 240.994,447.965 243.345,145.996 245.695,416.055 248.046,463.394 250.396,482.036 252.747,342.376 255.097,286.746 257.448,403.035 259.798,307.618 262.148,570.707 264.499,285.968 266.849,328.12 269.2,538.543 271.55,317.543 273.901,535.846 276.251,396.845 278.602,576.714 280.952,429.264 283.303,283.38 285.653,255.184 288.004,490.841 290.354,354.126 292.705,272.644 295.055,500.63 297.406,96.8724 299.756,157.366 302.107,414.055 304.457,333.118 306.807,359.946 309.158,415.482 311.508,333.267 313.859,493.56 316.209,406.688 318.56,535.936 320.91,378.698 323.261,181.448 325.611,401.262 327.962,287.654 330.312,389.816 332.663,308.736 335.013,340.621 337.364,480.51 339.714,347.246 342.065,733.086 344.415,445.982 346.765,389.502 349.116,410.631 351.466,199.848 353.817,533.244 356.167,432.711 358.518,401.728 360.868,164.173 363.219,471.593 365.569,438.926 367.92,414.033 370.27,372.101 372.621,453.518 374.971,503.588 377.322,560.418 379.672,287.507 382.023,332.422 384.373,350.471 386.724,481.217 389.074,364.221 391.424,227.703 393.775,295.488 396.125,476.854 398.476,223.696 400.826,376.713 403.177,490.115 405.527,527.548 407.878,443.163 410.228,138.318 412.579,590.044 414.929,416.572 417.28,392.241 419.63,423.946 421.981,498.018 424.331,426.959 426.682,305.005 429.032,501.191 431.382,298.621 433.733,490.402 436.083,314.373 438.434,495.814 440.784,263.362 443.135,373.529 445.485,418.339 447.836,474.796 450.186,328.358 452.537,355.276 454.887,422.373 457.238,276.848 459.588,529.693 461.939,494.027 464.289,264.793 466.64,472.61 468.99,218.623 471.341,475.706 473.691,381.775 476.041,348.391 478.392,364.703 480.742,354.169 483.093,494.907 485.443,544.676 487.794,497.982 490.144,551.506 492.495,388.802 494.845,544.677 497.196,515.162 499.546,510.783 501.897,261.065 504.247,459.566 506.598,422.449 508.948,455.945 511.299,306.474 513.649,280.723 515.999,479.834 518.35,410.273 520.7,409.425 523.051,401.669 525.401,293.568 527.752,479.052 530.102,443.675 532.453,388.617 534.803,445.869 537.154,488.635 539.504,483.718 541.855,359.22 544.205,458.716 546.556,465.147 548.906,324.884 551.257,476.284 553.607,502.981 555.958,399.014 558.308,490.04 560.658,462.196 563.009,407.796 565.359,478.426 567.71,484.639 570.06,397.251 572.411,235.674 574.761,344.676 577.112,356.198 579.462,505.798 581.813,272.074 584.163,304.319 586.514,257.183 588.864,538.715 591.215,398.552 593.565,386.645 595.916,557.08 598.266,367.221 600.616,366.815 602.967,425.92 605.317,345.674 607.668,272.537 610.018,189.939 612.369,438.535 614.719,399.639 617.07,342.641 619.42,377.277 621.771,380.182 624.121,440.212 626.472,380.261 628.822,537.317 631.173,449.81 633.523,196.678 635.874,559.424 638.224,357.343 640.575,460.896 642.925,331.443 645.275,225.028 647.626,435.747 649.976,372.932 652.327,480.593 654.677,527.578 657.028,329.936 659.378,362.673 661.729,486.652 664.079,254.981 666.43,436.939 668.78,494.281 671.131,435.088 673.481,522.179 675.832,327.245 678.182,138.532 680.533,404.762 682.883,473.648 685.233,305.041 687.584,385.162 689.934,482.304 692.285,487.577 694.635,507.095 696.986,345.575 699.336,452.988 701.687,483.802 704.037,392.275 706.388,597.875 708.738,312.743 711.089,348.695 713.439,408.602 715.79,401.521 718.14,302.482 720.491,369.775 722.841,469.138 725.192,625.409 727.542,377.869 729.892,191.396 732.243,339.664 734.593,405.527 736.944,478.916 739.294,444.129 741.645,498.585 743.995,387.835 746.346,494.585 748.696,321.211 751.047,330.679 753.397,479.396 755.748,402.132 758.098,418.764 760.449,395.998 762.799,277.366 765.15,300.93 767.5,543.867 769.85,283.591 772.201,482.822 774.551,407.912 776.902,472.374 779.252,339.303 781.603,253.365 783.953,360.122 786.304,319.384 788.654,288.936 791.005,286.289 793.355,459.865 795.706,433.961 798.056,439.898 800.407,366.769 802.757,371.888 805.108,315.577 807.458,464.725 809.809,271.402 812.159,415.001 814.509,426.873 816.86,614.368 819.21,420.89 821.561,529.549 823.911,453.209 826.262,277.855 828.612,351.792 830.963,540.279 833.313,454.166 835.664,252.301 838.014,320.212 840.365,479.336 842.715,363.13 845.066,304.109 847.416,448.938 849.767,369.54 852.117,391.121 854.467,406.006 856.818,399.657 859.168,403.97 861.519,524.686 863.869,407.872 866.22,370.561 868.57,293.169 870.921,681.948 873.271,448.413 875.622,388.967 877.972,443.446 880.323,324.163 882.673,454.714 885.024,489.121 887.374,543.086 889.725,401.17 892.075,290.527 894.426,414.877 896.776,337.641 899.126,472.477 901.477,361.565 903.827,547.266 906.178,261.904 908.528,508.581 910.879,413.1 913.229,281.025 915.58,390.565 917.93,272.295 920.281,391.248 922.631,229.487 924.982,377.441 927.332,528.454 929.683,230.48 932.033,500.718 934.384,497.525 936.734,390.832 939.084,411.385 941.435,291.526 943.785,471.804 946.136,199.602 948.486,320.182 950.837,509.42 953.187,326.993 955.538,407.418 957.888,425.106 960.239,441.262 962.589,391.419 964.94,274.298 967.29,460.674 969.641,170.978 971.991,325.491 974.342,389.156 976.692,287.867 979.043,354.299 981.393,322.013 983.743,214.09 986.094,381.98 988.444,498.885 990.795,387.189 993.145,560.038 995.496,393.861 997.846,461.262 1000.2,417.515 1002.55,273.324 1004.9,374.347 1007.25,283.222 1009.6,270.306 1011.95,344.59 1014.3,372.785 1016.65,375.083 1019,378.053 1021.35,455.739 1023.7,726.337 1026.05,383.576 1028.4,486.771 1030.75,280.521 1033.1,385.346 1035.45,334.699 1037.8,375.903 1040.15,409.616 1042.51,281.457 1044.86,443.54 1047.21,269.139 1049.56,443.924 1051.91,439.47 1054.26,272.652 1056.61,688.153 1058.96,354.832 1061.31,328.786 1063.66,375.434 1066.01,201.606 1068.36,380.814 1070.71,474.451 1073.06,270.334 1075.41,656.847 1077.76,519.92 1080.11,471.709 1082.46,362.175 1084.81,368.294 1087.16,396.223 1089.51,577.789 1091.87,271.14 1094.22,384.017 1096.57,381.581 1098.92,570.66 1101.27,376.308 1103.62,587.949 1105.97,453.791 1108.32,452.017 1110.67,377.517 1113.02,234.082 1115.37,343.631 1117.72,332.819 1120.07,356.436 1122.42,499.364 1124.77,479.954 1127.12,624.195 1129.47,399.769 1131.82,353.288 1134.17,364.319 1136.52,434.226 1138.87,393.907 1141.23,324.262 1143.58,396.489 1145.93,517.291 1148.28,422.813 1150.63,351.281 1152.98,364.826 1155.33,396.914 1157.68,292.682 1160.03,305.802 1162.38,295.784 1164.73,355.05 1167.08,506.661 1169.43,464.045 1171.78,494.517 1174.13,610.101 1176.48,294.651 1178.83,413.252 1181.18,345.806 1183.53,448.783 1185.88,442.186 1188.23,306.408 1190.59,504.442 1192.94,256.736 1195.29,414.183 1197.64,323.562 1199.99,410.017 1202.34,400.709 1204.69,504.748 1207.04,393.259 1209.39,265.753 1211.74,420.016 1214.09,305.299 1216.44,394.741 1218.79,102.255 1221.14,154.555 1223.49,325.194 1225.84,343.255 1228.19,255.136 1230.54,442.106 1232.89,397.486 1235.24,359.33 1237.59,430.976 1239.94,295.581 1242.3,418.842 1244.65,432.367 1247,472.158 1249.35,400.005 1251.7,362.95 1254.05,229.31 1256.4,489.398 1258.75,420.185 1261.1,285.947 1263.45,357.217 1265.8,555.023 1268.15,202.831 1270.5,329.013 1272.85,323.123 1275.2,379.354 1277.55,482.959 1279.9,406.656 1282.25,556.475 1284.6,422.68 1286.95,309.662 1289.3,490.65 1291.66,525.7 1294.01,579.506 1296.36,544.97 1298.71,386.39 1301.06,408.696 1303.41,377.883 1305.76,477.655 1308.11,467.479 1310.46,497.255 1312.81,283.721 1315.16,486.941 1317.51,470.416 1319.86,422.431 1322.21,506.36 1324.56,304.636 1326.91,405.51 1329.26,478.569 1331.61,492.033 1333.96,423.427 1336.31,463.512 1338.66,440.628 1341.02,456.975 1343.37,558.008 1345.72,117.165 1348.07,136.157 1350.42,391.883 1352.77,438.357 1355.12,569.448 1357.47,522.632 1359.82,316.155 1362.17,255.199 1364.52,478.137 1366.87,453.123 1369.22,259.098 1371.57,405.472 1373.92,393.022 1376.27,576.026 1378.62,428.773 1380.97,424.044 1383.32,645.867 1385.67,269.254 1388.02,357.165 1390.38,393.937 1392.73,470.19 1395.08,523.846 1397.43,541.814 1399.78,202.294 1402.13,407.274 1404.48,359.559 1406.83,459.442 1409.18,534.389 1411.53,433.577 1413.88,454.957 1416.23,444.893 1418.58,356.933 1420.93,333.446 1423.28,211.087 1425.63,345.439 1427.98,378.592 1430.33,411.868 1432.68,320.198 1435.03,343.009 1437.38,385.116 1439.74,484.076 1442.09,526.268 1444.44,363.915 1446.79,451.097 1449.14,492.219 1451.49,489.293 1453.84,499.855 1456.19,467.086 1458.54,324.542 1460.89,219.843 1463.24,404.562 1465.59,414.781 1467.94,252.767 1470.29,674.826 1472.64,437.324 1474.99,281.152 1477.34,455.381 1479.69,412.457 1482.04,491.851 1484.39,476.346 1486.74,323.445 1489.1,377.518 1491.45,429.139 1493.8,473.433 1496.15,386.637 1498.5,393.883 1500.85,529.439 1503.2,417.945 1505.55,231.849 1507.9,417.529 1510.25,284.127 1512.6,442.439 1514.95,498.849 1517.3,296.231 1519.65,425.961 1522,405.756 1524.35,399.135 1526.7,489.97 1529.05,317.799 1531.4,396.653 1533.75,297.051 1536.1,405.544 1538.45,405.842 1540.81,350.274 1543.16,195.809 1545.51,319.241 1547.86,431.427 1550.21,375.157 1552.56,414.746 1554.91,481.36 1557.26,338.592 1559.61,404.38 1561.96,420.685 1564.31,453.951 1566.66,530.75 1569.01,448.654 1571.36,267.264 1573.71,418.008 1576.06,660.176 1578.41,442.033 1580.76,472.563 1583.11,384.038 1585.46,559.675 1587.81,388.755 1590.17,476.948 1592.52,447.984 1594.87,411.345 1597.22,401.087 1599.57,364.991 1601.92,281.067 1604.27,261.056 1606.62,349.886 1608.97,568.768 1611.32,309.546 1613.67,374.636 1616.02,259.937 1618.37,616.517 1620.72,328.016 1623.07,343.742 1625.42,529.067 1627.77,434.58 1630.12,417.106 1632.47,406.764 1634.82,384.738 1637.17,284.966 1639.53,486.754 1641.88,332.191 1644.23,351.071 1646.58,417.844 1648.93,338.535 1651.28,395.542 1653.63,449.194 1655.98,450.502 1658.33,548.776 1660.68,579.057 1663.03,374.895 1665.38,324.313 1667.73,420.979 1670.08,427.428 1672.43,305.156 1674.78,308.178 1677.13,458.091 1679.48,395.444 1681.83,368.051 1684.18,443.24 1686.53,331.182 1688.89,272.46 1691.24,405.607 1693.59,491.182 1695.94,561.595 1698.29,318.366 1700.64,286.228 1702.99,389.737 1705.34,434.579 1707.69,470.008 1710.04,448.979 1712.39,419.205 1714.74,567.691 1717.09,267.959 1719.44,382.489 1721.79,150.801 1724.14,418.154 1726.49,615.671 1728.84,396.266 1731.19,340.492 1733.54,205.878 1735.89,178.048 1738.25,283.875 1740.6,307.464 1742.95,406.617 1745.3,432.457 1747.65,428.969 1750,416.962 1752.35,389.349 1754.7,319.374 1757.05,341.778 1759.4,362.537 1761.75,478.704 1764.1,287.542 1766.45,440.226 1768.8,388.593 1771.15,410.021 1773.5,567.643 1775.85,511.621 1778.2,343.122 1780.55,335.048 1782.9,464.963 1785.25,382.971 1787.6,378.211 1789.96,466.617 1792.31,269.556 1794.66,398.051 1797.01,353.707 1799.36,420.421 1801.71,496.111 1804.06,486.196 1806.41,411.756 1808.76,364.374 1811.11,410.569 1813.46,350.367 1815.81,509.261 1818.16,334.236 1820.51,459.363 1822.86,496.558 1825.21,296.708 1827.56,588.218 1829.91,376.004 1832.26,393.947 1834.61,242.694 1836.96,393.959 1839.32,497.584 1841.67,605.493 1844.02,315.317 1846.37,372.441 1848.72,406.992 1851.07,291.058 1853.42,479.947 1855.77,391.814 1858.12,237.356 1860.47,330.291 1862.82,405.21 1865.17,395.664 1867.52,587.661 1869.87,611.209 1872.22,480.603 1874.57,422.59 1876.92,399.728 1879.27,406.933 1881.62,294.335 1883.97,354.436 1886.32,351.562 1888.68,373.451 1891.03,397.474 1893.38,325.18 1895.73,464.354 1898.08,390.824 1900.43,312.222 1902.78,207.074 1905.13,227.157 1907.48,394.776 1909.83,437.371 1912.18,560.206 1914.53,216.941 1916.88,361.411 1919.23,234.725 1921.58,486.935 1923.93,380.487 1926.28,532.193 1928.63,286.656 1930.98,323.488 1933.33,297.139 1935.68,335.435 1938.04,492.181 1940.39,503.881 1942.74,408.517 1945.09,449.192 1947.44,318.134 1949.79,334.319 1952.14,252.412 1954.49,369.701 1956.84,173.448 1959.19,314.569 1961.54,424.34 1963.89,233.729 1966.24,302.732 1968.59,424.425 1970.94,336.137 1973.29,288.989 1975.64,459.729 1977.99,410.053 1980.34,399.438 1982.69,370.26 1985.04,619.937 1987.4,334.141 1989.75,393.082 1992.1,514.032 1994.45,485.656 1996.8,513.336 1999.15,564.483 2001.5,151.193 2003.85,580.435 2006.2,341.102 2008.55,419.483 2010.9,484.809 2013.25,435.591 2015.6,540.904 2017.95,270.957 2020.3,391.15 2022.65,449.625 2025,346.854 2027.35,384.033 2029.7,157.787 2032.05,605.922 2034.4,271.773 2036.76,256.502 2039.11,459.536 2041.46,282.97 2043.81,506.362 2046.16,364.375 2048.51,431.319 2050.86,447.227 2053.21,255.736 2055.56,521.92 2057.91,448.641 2060.26,279.489 2062.61,480.812 2064.96,458.334 2067.31,322.923 2069.66,152.578 2072.01,289.214 2074.36,238.629 2076.71,544.754 2079.06,492.982 2081.41,237.82 2083.76,555.095 2086.11,346.645 2088.47,436.077 2090.82,444.933 2093.17,231.91 2095.52,347.821 2097.87,534.78 2100.22,439.212 2102.57,406.254 2104.92,353.059 2107.27,487.954 2109.62,352.528 2111.97,323.89 2114.32,342.467 2116.67,454.19 2119.02,465.205 2121.37,455.309 2123.72,551.249 2126.07,328.451 2128.42,297.123 2130.77,294.376 2133.12,355.926 2135.47,240.189 2137.83,446.745 2140.18,355.685 2142.53,554.948 2144.88,294.876 2147.23,503.226 2149.58,437.692 2151.93,510.053 2154.28,400.785 2156.63,279.526 2158.98,298.278 2161.33,269.521 2163.68,254.699 2166.03,318.471 2168.38,407.497 2170.73,381.366 2173.08,339.674 2175.43,367.325 2177.78,154.178 2180.13,324.282 2182.48,428.949 2184.83,524.156 2187.19,418.604 2189.54,401.856 2191.89,340.755 2194.24,335.889 2196.59,395.601 2198.94,525.263 2201.29,242.492 2203.64,256.826 2205.99,437.338 2208.34,465.75 2210.69,456.313 2213.04,382.84 2215.39,430.222 2217.74,406.027 2220.09,449.754 2222.44,363.013 2224.79,361.371 2227.14,351.866 2229.49,426.287 2231.84,591.822 2234.19,453.739 2236.55,485.764 2238.9,428.774 2241.25,318.806 2243.6,494.013 2245.95,402.338 2248.3,437.228 2250.65,386.288 2253,321.834 2255.35,496.528 2257.7,377.005 2260.05,420.202 2262.4,220.376 2264.75,462.058 2267.1,460.11 2269.45,300.938 2271.8,513.774 2274.15,336.305 2276.5,336.846 2278.85,509.736 2281.2,388.065 2283.55,400.176 2285.91,255.372 2288.26,397.172 2290.61,415.118 2292.96,310.654 2295.31,365.878 2297.66,481.603 2300.01,462.518 2302.36,363.753 2304.71,361.538 2307.06,454.637 2309.41,615.798 2311.76,545.889 2314.11,492.253 2316.46,181.338 2318.81,299.123 2321.16,406.324 2323.51,576.813 2325.86,391.771 2328.21,599.756 2330.56,484.997 2332.91,450.514 2335.27,406.651 2337.62,302.193 2339.97,288.332 2342.32,449.552 2344.67,400.254 2347.02,204.71 2349.37,383.403 2351.72,454.555 2354.07,382.418 2356.42,343.93 2358.77,482.537 2361.12,245.083 2363.47,280.88 2365.82,383.433 2368.17,555.187 2370.52,513.444 2372.87,473.684 2375.22,488.575 2377.57,357.097 2379.92,241.066 2382.27,278.949 2384.62,259.113 2386.98,183.191 2389.33,452.034 2391.68,511.095 2394.03,327.778 2396.38,314.601 2398.73,501.763 2401.08,329.417 2403.43,424.484 2405.78,392.068 2408.13,343.774 2410.48,557.109 2412.83,425.52 2415.18,480.696 2417.53,236.335 2419.88,272.908 2422.23,413.629 2424.58,307.038 2426.93,636.139 2429.28,542.02 2431.63,271.196 2433.98,387.678 2436.34,349.421 2438.69,333.842 2441.04,281.047 2443.39,656.657 2445.74,453.979 2448.09,320.768 2450.44,264.426 2452.79,471.21 2455.14,416.174 2457.49,421.16 2459.84,491.93 2462.19,415.446 2464.54,326.416 2466.89,235.064 2469.24,424.269 2471.59,541.205 2473.94,295.708 2476.29,399.789 2478.64,511.117 2480.99,440.656 2483.34,483.001 2485.7,513.453 2488.05,334.997 2490.4,362.056 2492.75,293.338 2495.1,376.555 2497.45,469.721 2499.8,226.42 2502.15,203.238 2504.5,278.182 2506.85,189.025 2509.2,553.566 2511.55,511.997 2513.9,449.816 2516.25,484.13 2518.6,540.477 2520.95,274.2 2523.3,301.687 2525.65,260.764 2528,360.609 2530.35,314.268 2532.7,292.525 2535.06,507.298 2537.41,447.919 2539.76,536.288 2542.11,382.06 2544.46,559.261 2546.81,411.744 2549.16,407.962 2551.51,504.931 2553.86,463.073 2556.21,431.42 2558.56,390.565 2560.91,560.539 2563.26,343.949 2565.61,337.585 2567.96,297.537 2570.31,399.855 "></polyline>
</svg>
</div>
</div>
<p>Look at that! Things are working; amazin’.</p>
<p>We can also exploit <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>’s parallel sampling capabilities:</p>
<div id="34" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run separate 4 chains for 10 000 iterations using threads to parallelize.</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>num_chains <span class="op">=</span> <span class="fl">4</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    model_with_grad,</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">MCMCThreads</span>(),</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>,</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    num_chains;</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Note we need to provide an initial state for every chain.</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>    initial_state<span class="op">=</span><span class="fu">fill</span>(state, num_chains),</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>samples_array <span class="op">=</span> <span class="fu">stack</span>(<span class="fu">map</span>(<span class="bu">Base</span>.<span class="fu">Fix1</span>(stack, sample <span class="op">-&gt;</span> sample.x), samples))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000×4 Array{Float64, 3}:
[:, :, 1] =
 -2.73211  -3.29199   -3.89229  -4.009    …  -4.25898    -3.9082    -4.80182
 -0.73957  -0.443299  -1.71126   1.55268      0.0994896  -0.296304   0.455832
  3.60093   3.9259     3.90189   5.50217      4.23725     5.32667    6.37468

[:, :, 2] =
 -3.15055   -3.25784   -4.28224   …  -4.73748   -4.20907   -6.38469
  0.012785   0.335405   0.702014      0.223769  -0.698512  -2.0605
  3.97086    4.83328    6.00956       4.91137    4.46493    4.81223

[:, :, 3] =
 -3.0857   -4.90636  -4.60783   …  -4.121     -3.65007    -3.65007
 -1.93668  -1.72448  -0.478707     -0.213436  -0.0860131  -0.0860131
  3.4508    3.52102   4.51702       5.45134    4.02593     4.02593

[:, :, 4] =
 -5.50867   -4.21944   -5.34031   …  -3.849    -4.33729   -4.33729
  0.385907   0.750817  -0.466029      1.38965   0.958918   0.958918
  3.79212    3.41829    2.62723       4.94192   4.71781    4.71781</code></pre>
</div>
</div>
<p>But the fact that we have to provide the <code>AbstractMCMC.sample</code> call, etc. with an <code>initial_state</code> to get started is a bit annoying. We can avoid this by also defining a <code>AbstractMCMC.step</code> <em>without</em> the <code>state</code> argument:</p>
<div id="36" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">::</span><span class="dt">MALA</span>;</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># </span><span class="al">NOTE</span><span class="co">: No state provided!</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just create the initial state by sampling using  a Gaussian.</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="fu">randn</span>(rng, LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(x), <span class="fu">MALAState</span>(x)</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Equipped with this, we no longer need to provide the <code>initial_state</code> everywhere:</p>
<div id="38" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -4.9931      0.992657
 -0.00569151  1.00698
  4.97647     1.00917</code></pre>
</div>
</div>
</section>
<section id="using-our-sampler-with-turing.jl" class="level2">
<h2 class="anchored" data-anchor-id="using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</h2>
<p>As we promised, all of this hassle of implementing our <code>MALA</code> sampler in a way that uses <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> and <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> gets us something more than <em>just</em> an “automatic” implementation of <code>AbstractMCMC.sample</code>.</p>
<p>It also enables use with Turing.jl through the <code>externalsampler</code>, but we need to do one final thing first: we need to tell Turing.jl how to extract a vector of parameters from the “sample” returned in our implementation of <code>AbstractMCMC.step</code>. In our case, the “sample” is a <code>MALASample</code>, so we just need the following line:</p>
<div id="40" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load Turing.jl.</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Turing</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Overload the `getparams` method for our "sample" type, which is just a vector.</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>Turing.Inference.<span class="fu">getparams</span>(<span class="op">::</span><span class="dt">Turing.Model</span>, sample<span class="op">::</span><span class="dt">MALASample</span>) <span class="op">=</span> sample.x</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And with that, we’re good to go!</p>
<div id="42" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Our previous model defined as a Turing.jl model.</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">mvnormal_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">MvNormal</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.], I)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate our model.</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">mvnormal_model</span>()</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Call `sample` but now we're passing in a Turing.jl `model` and wrapping</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co"># our `MALA` sampler in the `externalsampler` to tell Turing.jl that the sampler</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co"># expects something that implements LogDensityProblems.jl.</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×4×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 2.91 seconds
Compute duration  = 2.91 seconds
parameters        = x[1], x[2], x[3]
internals         = lp

Summary Statistics
  parameters      mean       std      mcse    ess_bulk    ess_tail      rhat   ⋯
      Symbol   Float64   Float64   Float64     Float64     Float64   Float64   ⋯

        x[1]   -5.0066    1.0034    0.0168   3562.1048   5586.3369    0.9999   ⋯
        x[2]   -0.0302    0.9954    0.0175   3246.5779   5086.6268    1.0000   ⋯
        x[3]    4.9962    1.0029    0.0182   3050.2531   5044.0720    1.0001   ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

        x[1]   -6.9242   -5.6903   -5.0137   -4.3331   -2.9883
        x[2]   -2.0014   -0.7081   -0.0146    0.6312    1.8776
        x[3]    3.0207    4.3169    4.9893    5.6717    6.9141</code></pre>
</div>
</div>
<p>Pretty neat, eh?</p>
<section id="models-with-constrained-parameters" class="level3">
<h3 class="anchored" data-anchor-id="models-with-constrained-parameters">Models with constrained parameters</h3>
<p>One thing we’ve sort of glossed over in all of the above is that MALA, at least how we’ve implemented it, requires <span class="math inline">\(x\)</span> to live in <span class="math inline">\(\mathbb{R}^d\)</span> for some <span class="math inline">\(d &gt; 0\)</span>. If some of the parameters were in fact constrained, e.g.&nbsp;we were working with a <code>Beta</code> distribution which has support on the interval <span class="math inline">\((0, 1)\)</span>, <em>not</em> on <span class="math inline">\(\mathbb{R}^d\)</span>, we could easily end up outside of the valid range <span class="math inline">\((0, 1)\)</span>.</p>
<div id="44" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">beta_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">beta_model</span>()</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 1.95 seconds
Compute duration  = 1.95 seconds
parameters        = x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse    ess_bulk    ess_tail      rhat   ⋯
      Symbol   Float64   Float64   Float64     Float64     Float64   Float64   ⋯

           x    0.5030    0.1875    0.0030   3941.9334   5191.3817    1.0001   ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

           x    0.1507    0.3649    0.5031    0.6436    0.8550</code></pre>
</div>
</div>
<p>Yep, that still works, but only because Turing.jl actually <em>transforms</em> the <code>turing_model</code> from constrained to unconstrained, so that the <code>sampler</code> provided to <code>externalsampler</code> is actually always working in unconstrained space! This is not always desirable, so we can turn this off:</p>
<div id="46" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 0.15 seconds
Compute duration  = 0.15 seconds
parameters        = x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse    ess_bulk    ess_tail      rhat   ⋯
      Symbol   Float64   Float64   Float64     Float64     Float64   Float64   ⋯

           x    0.9138    0.0102    0.0003   1153.7299   1153.7299    1.0007   ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

           x    0.9135    0.9135    0.9135    0.9135    0.9135</code></pre>
</div>
</div>
<p>The fun thing is that this still sort of works because</p>
<div id="48" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">logpdf</span>(<span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>), <span class="fl">10.0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-Inf</code></pre>
</div>
</div>
<p>and so the samples that fall outside of the range are always rejected. But do notice how much worse all the diagnostics are, e.g.&nbsp;<code>ess_tail</code> is very poor compared to when we use <code>unconstrained=true</code>. Moreover, in more complex cases this won’t just result in a “nice” <code>-Inf</code> log-density value, but instead will error:</p>
<div id="50" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="kw">function</span> <span class="fu">demo</span>()</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>    σ² <span class="op">~</span> <span class="fu">truncated</span>(<span class="fu">Normal</span>(), lower<span class="op">=</span><span class="fl">0</span>)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If we end up with negative values for `σ²`, the `Normal` will error.</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>    x <span class="op">~</span> <span class="fu">Normal</span>(<span class="fl">0</span>, σ²)</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>DomainError: DomainError(-0.9596638524373254, "Normal: the condition σ &gt;= zero(σ) is not satisfied.")
DomainError with -0.9596638524373254:
Normal: the condition σ &gt;= zero(σ) is not satisfied.
Stacktrace:
  [1] #371
    @ ~/.julia/packages/Distributions/tQhJE/src/univariate/continuous/normal.jl:37 [inlined]
  [2] check_args
    @ ~/.julia/packages/Distributions/tQhJE/src/utils.jl:89 [inlined]
  [3] #Normal#370
    @ ~/.julia/packages/Distributions/tQhJE/src/univariate/continuous/normal.jl:37 [inlined]
  [4] Normal
    @ ~/.julia/packages/Distributions/tQhJE/src/univariate/continuous/normal.jl:36 [inlined]
  [5] Normal
    @ ~/.julia/packages/Distributions/tQhJE/src/univariate/continuous/normal.jl:42 [inlined]
  [6] macro expansion
    @ ~/.julia/packages/DynamicPPL/senfM/src/compiler.jl:584 [inlined]
  [7] demo(__model__::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, __varinfo__::DynamicPPL.ThreadSafeVarInfo{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, Vector{Base.RefValue{Float64}}}, __context__::DynamicPPL.ValuesAsInModelContext{DynamicPPL.DefaultContext})
    @ Main.Notebook ~/work/docs/docs/developers/inference/implementing-samplers/index.qmd:595
  [8] _evaluate!!
    @ ~/.julia/packages/DynamicPPL/senfM/src/model.jl:936 [inlined]
  [9] evaluate_threadsafe!!(model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, varinfo::DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, context::DynamicPPL.ValuesAsInModelContext{DynamicPPL.DefaultContext})
    @ DynamicPPL ~/.julia/packages/DynamicPPL/senfM/src/model.jl:925
 [10] evaluate!!
    @ ~/.julia/packages/DynamicPPL/senfM/src/model.jl:855 [inlined]
 [11] values_as_in_model
    @ ~/.julia/packages/DynamicPPL/senfM/src/values_as_in_model.jl:196 [inlined]
 [12] values_as_in_model
    @ ~/.julia/packages/DynamicPPL/senfM/src/values_as_in_model.jl:195 [inlined]
 [13] getparams(model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, vi::DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64})
    @ Turing.Inference ~/.julia/packages/Turing/oFGEb/src/mcmc/Inference.jl:399
 [14] Turing.Inference.Transition(model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, vi::DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, t::MALASample{Vector{Float64}})
    @ Turing.Inference ~/.julia/packages/Turing/oFGEb/src/mcmc/Inference.jl:274
 [15] transition_to_turing
    @ ~/.julia/packages/Turing/oFGEb/src/mcmc/abstractmcmc.jl:12 [inlined]
 [16] transition_to_turing(f::LogDensityProblemsADForwardDiffExt.ForwardDiffLogDensity{LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, Nothing}, ForwardDiff.Chunk{2}, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}, transition::MALASample{Vector{Float64}})
    @ Turing.Inference ~/.julia/packages/Turing/oFGEb/src/mcmc/abstractmcmc.jl:17
 [17] step(rng::TaskLocalRNG, model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, sampler_wrapper::DynamicPPL.Sampler{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}; initial_state::Nothing, initial_params::Nothing, kwargs::@Kwargs{})
    @ Turing.Inference ~/.julia/packages/Turing/oFGEb/src/mcmc/abstractmcmc.jl:103
 [18] macro expansion
    @ ~/.julia/packages/AbstractMCMC/FSyVk/src/sample.jl:0 [inlined]
 [19] macro expansion
    @ ~/.julia/packages/AbstractMCMC/FSyVk/src/logging.jl:16 [inlined]
 [20] mcmcsample(rng::TaskLocalRNG, model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, sampler::DynamicPPL.Sampler{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}, N::Int64; progress::Bool, progressname::String, callback::Nothing, num_warmup::Int64, discard_initial::Int64, thinning::Int64, chain_type::Type, initial_state::Nothing, kwargs::@Kwargs{})
    @ AbstractMCMC ~/.julia/packages/AbstractMCMC/FSyVk/src/sample.jl:142
 [21] sample(rng::TaskLocalRNG, model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, sampler::DynamicPPL.Sampler{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}, N::Int64; chain_type::Type, resume_from::Nothing, initial_state::Nothing, kwargs::@Kwargs{progress::Bool})
    @ DynamicPPL ~/.julia/packages/DynamicPPL/senfM/src/sampler.jl:107
 [22] sample
    @ ~/.julia/packages/DynamicPPL/senfM/src/sampler.jl:97 [inlined]
 [23] #sample#6
    @ ~/.julia/packages/Turing/oFGEb/src/mcmc/Inference.jl:321 [inlined]
 [24] sample
    @ ~/.julia/packages/Turing/oFGEb/src/mcmc/Inference.jl:312 [inlined]
 [25] #sample#5
    @ ~/.julia/packages/Turing/oFGEb/src/mcmc/Inference.jl:309 [inlined]
 [26] top-level scope
    @ ~/work/docs/docs/developers/inference/implementing-samplers/index.qmd:597</code></pre>
</div>
</div>
<p>As expected, we run into a <code>DomainError</code> at some point, while if we set <code>unconstrained=true</code>, letting Turing.jl transform the model to a unconstrained form behind the scenes, everything works as expected:</p>
<div id="52" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 2.06 seconds
Compute duration  = 2.06 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse   ess_bulk   ess_tail      rhat   e ⋯
      Symbol   Float64   Float64   Float64    Float64    Float64   Float64     ⋯

          σ²    4.0964    0.0000    0.0000        NaN        NaN       NaN     ⋯
           x    0.1133    0.0000    0.0000        NaN        NaN       NaN     ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

          σ²    4.0964    4.0964    4.0964    4.0964    4.0964
           x    0.1133    0.1133    0.1133    0.1133    0.1133</code></pre>
</div>
</div>
<p>Neat!</p>
<p>Similarly, which automatic differentiation backend one should use can be specified through the <code>adtype</code> keyword argument too. For example, if we want to use <a href="https://github.com/JuliaDiff/ReverseDiff.jl">ReverseDiff.jl</a> instead of the default <a href="https://github.com/JuliaDiff/ForwardDiff.jl">ForwardDiff.jl</a>:</p>
<div id="54" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">ReverseDiff</span>: ReverseDiff</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify that we want to use `AutoReverseDiff`.</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">demo</span>(),</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>, adtype<span class="op">=</span><span class="fu">AutoReverseDiff</span>()),</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>;</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 3.78 seconds
Compute duration  = 3.78 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse   ess_bulk   ess_tail      rhat   e ⋯
      Symbol   Float64   Float64   Float64    Float64    Float64   Float64     ⋯

          σ²    0.8662    0.5750    0.0222   576.7896   393.2104    1.0000     ⋯
           x    0.0552    0.9333    0.0395   775.8937   513.5706    1.0051     ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

          σ²    0.1387    0.4006    0.7452    1.2095    2.1370
           x   -1.8541   -0.3517   -0.0053    0.4285    2.3353</code></pre>
</div>
</div>
<p>Double-neat.</p>
</section>
</section>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<p>At this point it’s worth maybe reminding ourselves what we did and also <em>why</em> we did it:</p>
<ol type="1">
<li>We define our models in the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface because it makes the sampler agnostic to how the underlying model is implemented.</li>
<li>We implement our sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> interface, which just means that our sampler is a subtype of <code>AbstractMCMC.AbstractSampler</code> and we implement the MCMC transition in <code>AbstractMCMC.step</code>.</li>
<li>Points 1 and 2 makes it so our sampler can be used with a wide range of model implementations, amongst them being models implemented in both Turing.jl and Stan. This gives you, the inference implementer, a large collection of models to test your inference method on, in addition to allowing users of Turing.jl and Stan to try out your inference method with minimal effort.</li>
</ol>


</section>


<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a><div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>We’re going with the leapfrog formulation because in a future version of this tutorial we’ll add a section extending this simple “baseline” MALA sampler to more complex versions. See <a href="https://github.com/TuringLang/docs/issues/479">issue #479</a> for progress on this.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>There is no such thing as a proper interface in Julia (at least not officially), and so we use the word “interface” here to mean a few minimal methods that needs to be implemented by any type that we treat as a target model.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/turinglang\.org\/docs\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../../developers/inference/variational-inference/index.html" class="pagination-link" aria-label="Variational Inference">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Variational Inference</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Turing is created by <a href="http://mlg.eng.cam.ac.uk/hong/" target="_blank">Hong Ge</a>, and lovingly maintained by the <a href="https://github.com/TuringLang/Turing.jl/graphs/contributors" target="_blank">core team</a> of volunteers. <br> The contents of this website are © 2024 under the terms of the <a href="https://github.com/TuringLang/Turing.jl/blob/master/LICENCE" target="_blank">MIT License</a>.</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/TuringLang/docs/edit/master/developers/inference/implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/docs/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://x.com/TuringLang">
      <i class="bi bi-twitter" role="img" aria-label="Turing Twitter">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/TuringLang/Turing.jl">
      <i class="bi bi-github" role="img" aria-label="Turing GitHub">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




<script src="../../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>