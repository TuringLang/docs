<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Implementing Samplers – Turing.jl</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<link href="../../../developers/inference/variational-inference/index.html" rel="prev">
<link href="../../../assets/favicon.ico" rel="icon">
<script src="../../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-dark-2fef5ea3f8957b3e4ecc936fc74692ca.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap-8ca65573be89ab5a614a0758d6e79fa7.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../../site_libs/bootstrap/bootstrap-dark-e4bf857d3af38d284e31ad2f58e22145.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="../../../site_libs/bootstrap/bootstrap-8ca65573be89ab5a614a0758d6e79fa7.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<style>
  a {
    text-decoration: none;
  }
  a:hover {
    text-decoration: underline;
  }
</style>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../../theming/styles.css">
</head>

<body class="nav-sidebar floating nav-fixed quarto-light"><script id="quarto-html-before-body" type="application/javascript">
    const toggleBodyColorMode = (bsSheetEl) => {
      const mode = bsSheetEl.getAttribute("data-mode");
      const bodyEl = window.document.querySelector("body");
      if (mode === "dark") {
        bodyEl.classList.add("quarto-dark");
        bodyEl.classList.remove("quarto-light");
      } else {
        bodyEl.classList.add("quarto-light");
        bodyEl.classList.remove("quarto-dark");
      }
    }
    const toggleBodyColorPrimary = () => {
      const bsSheetEl = window.document.querySelector("link#quarto-bootstrap:not([rel=disabled-stylesheet])");
      if (bsSheetEl) {
        toggleBodyColorMode(bsSheetEl);
      }
    }
    const setColorSchemeToggle = (alternate) => {
      const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
      for (let i=0; i < toggles.length; i++) {
        const toggle = toggles[i];
        if (toggle) {
          if (alternate) {
            toggle.classList.add("alternate");
          } else {
            toggle.classList.remove("alternate");
          }
        }
      }
    };
    const toggleColorMode = (alternate) => {
      // Switch the stylesheets
      const primaryStylesheets = window.document.querySelectorAll('link.quarto-color-scheme:not(.quarto-color-alternate)');
      const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
      manageTransitions('#quarto-margin-sidebar .nav-link', false);
      if (alternate) {
        // note: dark is layered on light, we don't disable primary!
        enableStylesheet(alternateStylesheets);
        for (const sheetNode of alternateStylesheets) {
          if (sheetNode.id === "quarto-bootstrap") {
            toggleBodyColorMode(sheetNode);
          }
        }
      } else {
        disableStylesheet(alternateStylesheets);
        enableStylesheet(primaryStylesheets)
        toggleBodyColorPrimary();
      }
      manageTransitions('#quarto-margin-sidebar .nav-link', true);
      // Switch the toggles
      setColorSchemeToggle(alternate)
      // Hack to workaround the fact that safari doesn't
      // properly recolor the scrollbar when toggling (#1455)
      if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
        manageTransitions("body", false);
        window.scrollTo(0, 1);
        setTimeout(() => {
          window.scrollTo(0, 0);
          manageTransitions("body", true);
        }, 40);
      }
    }
    const disableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        stylesheet.rel = 'disabled-stylesheet';
      }
    }
    const enableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        if(stylesheet.rel !== 'stylesheet') { // for Chrome, which will still FOUC without this check
          stylesheet.rel = 'stylesheet';
        }
      }
    }
    const manageTransitions = (selector, allowTransitions) => {
      const els = window.document.querySelectorAll(selector);
      for (let i=0; i < els.length; i++) {
        const el = els[i];
        if (allowTransitions) {
          el.classList.remove('notransition');
        } else {
          el.classList.add('notransition');
        }
      }
    }
    const isFileUrl = () => {
      return window.location.protocol === 'file:';
    }
    const hasAlternateSentinel = () => {
      let styleSentinel = getColorSchemeSentinel();
      if (styleSentinel !== null) {
        return styleSentinel === "alternate";
      } else {
        return false;
      }
    }
    const setStyleSentinel = (alternate) => {
      const value = alternate ? "alternate" : "default";
      if (!isFileUrl()) {
        window.localStorage.setItem("quarto-color-scheme", value);
      } else {
        localAlternateSentinel = value;
      }
    }
    const getColorSchemeSentinel = () => {
      if (!isFileUrl()) {
        const storageValue = window.localStorage.getItem("quarto-color-scheme");
        return storageValue != null ? storageValue : localAlternateSentinel;
      } else {
        return localAlternateSentinel;
      }
    }
    const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
      const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
      const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
      let newTheme = '';
      if(authorPrefersDark) {
        newTheme = isAlternate ? baseTheme : alternateTheme;
      } else {
        newTheme = isAlternate ? alternateTheme : baseTheme;
      }
      const changeGiscusTheme = () => {
        // From: https://github.com/giscus/giscus/issues/336
        const sendMessage = (message) => {
          const iframe = document.querySelector('iframe.giscus-frame');
          if (!iframe) return;
          iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
        }
        sendMessage({
          setConfig: {
            theme: newTheme
          }
        });
      }
      const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
      if (isGiscussLoaded) {
        changeGiscusTheme();
      }
    };
    const authorPrefersDark = false;
    const darkModeDefault = authorPrefersDark;
      document.querySelector('link#quarto-text-highlighting-styles.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
      document.querySelector('link#quarto-bootstrap.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
    let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
    // Dark / light mode switch
    window.quartoToggleColorScheme = () => {
      // Read the current dark / light value
      let toAlternate = !hasAlternateSentinel();
      toggleColorMode(toAlternate);
      setStyleSentinel(toAlternate);
      toggleGiscusIfUsed(toAlternate, darkModeDefault);
      window.dispatchEvent(new Event('resize'));
    };
    // Switch to dark mode if need be
    if (hasAlternateSentinel()) {
      toggleColorMode(true);
    } else {
      toggleColorMode(false);
    }
  </script>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="https://turinglang.org/" class="navbar-brand navbar-brand-logo">
    <img src="../../../assets/images/turing-logo.svg" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="https://turinglang.org/">
    <span class="navbar-title">Turing.jl</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../getting-started/"> 
<span class="menu-text">Get Started</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../tutorials/coin-flipping/"> 
<span class="menu-text">Tutorials</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../faq/"> 
<span class="menu-text">FAQ</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/library/"> 
<span class="menu-text">Libraries</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/news/"> 
<span class="menu-text">News</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/team/"> 
<span class="menu-text">Team</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-v0.39" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">v0.39</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-v0.39">    
        <li>
    <a class="dropdown-item" href="https://turinglang.org/docs/changelog.html">
 <span class="dropdown-text">Changelog</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://turinglang.org/docs/versions.html">
 <span class="dropdown-text">All Versions</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools tools-wide">
    <a href="https://x.com/TuringLang" title="Turing Twitter" class="quarto-navigation-tool px-1" aria-label="Turing Twitter"><i class="bi bi-twitter"></i></a>
    <a href="https://github.com/TuringLang/Turing.jl" title="Turing GitHub" class="quarto-navigation-tool px-1" aria-label="Turing GitHub"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../../developers/contributing/index.html">Developers</a></li><li class="breadcrumb-item"><a href="../../../developers/inference/variational-inference/index.html">Inference in Detail</a></li><li class="breadcrumb-item"><a href="../../../developers/inference/implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../getting-started/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Getting Started</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../core-functionality/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Core Functionality</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false">
 <span class="menu-text">User Guide</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/automatic-differentiation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Automatic Differentiation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/submodels/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Submodels</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/custom-distribution/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Custom Distributions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/probability-interface/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Querying Model Probabilities</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/modifying-logprob/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Modifying the Log Probability</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/tracking-extra-quantities/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Tracking Extra Quantities</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/mode-estimation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Mode Estimation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/performance-tips/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Performance Tips</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/sampler-visualisation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Sampler Visualization</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/dynamichmc/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using DynamicHMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/external-samplers/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using External Samplers</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/troubleshooting/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Troubleshooting</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false">
 <span class="menu-text">Tutorials</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/coin-flipping/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction: Coin Flipping</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/gaussian-mixture-models/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Mixture Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-neural-networks/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Neural Networks</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/hidden-markov-models/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Hidden Markov Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-linear-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Linear Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/infinite-mixture-models/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Infinite Mixture Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-poisson-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Poisson Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/multinomial-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Multinomial Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-differential-equations/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Differential Equations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/probabilistic-pca/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Probabilistic PCA</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-time-series-analysis/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Time Series Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/gaussian-processes-introduction/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Processes: Introduction</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/gaussian-process-latent-variable-models/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Process Latent Variable Models</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Developers</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/contributing/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Contributing</span></a>
  </div>
</li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false">
 <span class="menu-text">DynamicPPL’s Compiler</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/compiler/model-manual/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Manually Defining a Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/compiler/minituring-compiler/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation I: Compiler</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/compiler/minituring-contexts/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation II: Contexts</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/compiler/design-overview/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Turing Compiler Design (Outdated)</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false">
 <span class="menu-text">DynamicPPL Contexts</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/contexts/submodel-condition/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Conditioning and fixing in submodels</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="false">
 <span class="menu-text">Variable Transformations</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/transforms/distributions/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Distributions and the Jacobian</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/transforms/bijectors/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bijectors in MCMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/transforms/dynamicppl/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variable transformations in DynamicPPL</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true">
 <span class="menu-text">Inference in Detail</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/inference/variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/inference/implementing-samplers/index.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Implementing Samplers</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of Contents</h2>
   
  <ul>
  <li><a href="#quick-overview-of-mala" id="toc-quick-overview-of-mala" class="nav-link active" data-scroll-target="#quick-overview-of-mala">Quick overview of MALA</a></li>
  <li><a href="#what-we-need-from-a-model-logdensityproblems.jl" id="toc-what-we-need-from-a-model-logdensityproblems.jl" class="nav-link" data-scroll-target="#what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: LogDensityProblems.jl</a></li>
  <li><a href="#implementing-mala-in-abstractmcmc.jl" id="toc-implementing-mala-in-abstractmcmc.jl" class="nav-link" data-scroll-target="#implementing-mala-in-abstractmcmc.jl">Implementing MALA in AbstractMCMC.jl</a></li>
  <li><a href="#using-our-sampler-with-turing.jl" id="toc-using-our-sampler-with-turing.jl" class="nav-link" data-scroll-target="#using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</a>
  <ul class="collapse">
  <li><a href="#models-with-constrained-parameters" id="toc-models-with-constrained-parameters" class="nav-link" data-scroll-target="#models-with-constrained-parameters">Models with constrained parameters</a></li>
  </ul></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/TuringLang/docs/edit/main/developers/inference/implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/docs/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">


<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../../developers/contributing/index.html">Developers</a></li><li class="breadcrumb-item"><a href="../../../developers/inference/variational-inference/index.html">Inference in Detail</a></li><li class="breadcrumb-item"><a href="../../../developers/inference/implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Implementing Samplers</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>In this tutorial, we’ll go through step-by-step how to implement a “simple” sampler in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> in such a way that it can be easily applied to Turing.jl models.</p>
<p>In particular, we’re going to implement a version of <strong>Metropolis-adjusted Langevin (MALA)</strong>.</p>
<p>Note that we will implement this sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> framework, completely “ignoring” Turing.jl until the very end of the tutorial, at which point we’ll use a single line of code to make the resulting sampler available to Turing.jl. This is to really drive home the point that one can implement samplers in a way that is accessible to all of Turing.jl’s users without having to use Turing.jl yourself.</p>
<section id="quick-overview-of-mala" class="level2">
<h2 class="anchored" data-anchor-id="quick-overview-of-mala">Quick overview of MALA</h2>
<p>We can view MALA as a single step of the leapfrog intergrator with resampling of momentum <span class="math inline">\(p\)</span> at every step.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> To make that statement a bit more concrete, we first define the <em>extended</em> target <span class="math inline">\(\bar{\gamma}(x, p)\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\log \bar{\gamma}(x, p) \propto \log \gamma(x) + \log \gamma_{\mathcal{N}(0, M)}(p)
\end{equation*}\]</span></p>
<p>where <span class="math inline">\(\gamma_{\mathcal{N}(0, M)}\)</span> denotes the density for a zero-centered Gaussian with covariance matrix <span class="math inline">\(M\)</span>. We then consider targeting this joint distribution over both <span class="math inline">\(x\)</span> and <span class="math inline">\(p\)</span> as follows. First we define the map</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  L_{\epsilon}: \quad &amp; \mathbb{R}^d \times \mathbb{R}^d \to \mathbb{R}^d \times \mathbb{R}^d \\
  &amp; (x, p) \mapsto (\tilde{x}, \tilde{p}) := L_{\epsilon}(x, p)
\end{split}
\end{equation*}\]</span></p>
<p>as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p_{1 / 2} &amp;:= p + \frac{\epsilon}{2} \nabla \log \gamma(x) \\
  \tilde{x} &amp;:= x + \epsilon M^{-1} p_{1 /2 } \\
  p_1 &amp;:= p_{1 / 2} + \frac{\epsilon}{2} \nabla \log \gamma(\tilde{x}) \\
  \tilde{p} &amp;:= - p_1
\end{split}
\end{equation*}\]</span></p>
<p>This might be familiar for some readers as a single step of the Leapfrog integrator. We then define the MALA kernel as follows: given the current iterate <span class="math inline">\(x_i\)</span>, we sample the next iterate <span class="math inline">\(x_{i + 1}\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p &amp;\sim \mathcal{N}(0, M) \\
  (\tilde{x}, \tilde{p}) &amp;:= L_{\epsilon}(x_i, p) \\
  \alpha &amp;:= \min \left\{ 1, \frac{\bar{\gamma}(\tilde{x}, \tilde{p})}{\bar{\gamma}(x_i, p)} \right\} \\
  x_{i + 1} &amp;:=
  \begin{cases}
    \tilde{x} \quad &amp; \text{ with prob. } \alpha \\
    x_i       \quad &amp; \text{ with prob. } 1 - \alpha
  \end{cases}
\end{split}
\end{equation*}\]</span></p>
<p>i.e.&nbsp;we accept the proposal <span class="math inline">\(\tilde{x}\)</span> with probability <span class="math inline">\(\alpha\)</span> and reject it, thus sticking with our current iterate, with probability <span class="math inline">\(1 - \alpha\)</span>.</p>
</section>
<section id="what-we-need-from-a-model-logdensityproblems.jl" class="level2">
<h2 class="anchored" data-anchor-id="what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a></h2>
<p>There are a few things we need from the “target” / “model” / density that we want to sample from:</p>
<ol type="1">
<li>We need access to log-density <em>evaluations</em> <span class="math inline">\(\log \gamma(x)\)</span> so we can compute the acceptance ratio involving <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>We need access to log-density <em>gradients</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span> so we can compute the Leapfrog steps <span class="math inline">\(L_{\epsilon}(x, p)\)</span>.</li>
<li>We also need access to the “size” of the model so we can determine the size of <span class="math inline">\(M\)</span>.</li>
</ol>
<p>Luckily for us, there is a package called <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> which provides an interface for <em>exactly</em> this!</p>
<p>To demonstrate how one can implement the “<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface”<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> we will use a simple Gaussian model as an example:</p>
<div id="4" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblems</span>: LogDensityProblems;</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's define some type that represents the model.</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> IsotropicNormalModel{M<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"mean of the isotropic Gaussian"</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    mean<span class="op">::</span><span class="dt">M</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Specifies what input length the model expects.</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">dimension</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> <span class="fu">length</span>(model.mean)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Implementation of the log-density evaluation of the model.</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x<span class="op">::</span><span class="dt">AbstractVector{&lt;:Real}</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">-</span> <span class="fu">sum</span>(abs2, x <span class="op">.-</span> model.mean) <span class="op">/</span> <span class="fl">2</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This gives us all of the properties we want for our MALA sampler with the exception of the computation of the <em>gradient</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span>. There is the method <code>LogDensityProblems.logdensity_and_gradient</code> which should return a 2-tuple where the first entry is the evaluation of the logdensity <span class="math inline">\(\log \gamma(x)\)</span> and the second entry is the gradient <span class="math inline">\(\nabla \log \gamma(x)\)</span>.</p>
<p>There are two ways to “implement” this method: 1) we implement it by hand, which is feasible in the case of our <code>IsotropicNormalModel</code>, or b) we defer the implementation of this to a automatic differentiation backend.</p>
<p>To implement it by hand we can simply do</p>
<div id="6" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl that first-order, i.e. gradient information, is available.</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{1}</span>()</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Implement `logdensity_and_gradient`.</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    logγ_x <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="op">-</span>x <span class="op">.*</span> (x <span class="op">-</span> model.mean)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> logγ_x, ∇logγ_x</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s just try it out:</p>
<div id="8" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate the problem.</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> <span class="fu">IsotropicNormalModel</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.])</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create some example input that we can test on.</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>x_example <span class="op">=</span> <span class="fu">randn</span>(LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate!</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-32.83063557121679</code></pre>
</div>
</div>
<p>To defer it to an automatic differentiation backend, we can do</p>
<div id="10" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl we only have access to 0-th order information.</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{0}</span>()</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Use `LogDensityProblemsAD`'s `ADgradient` in combination with some AD backend to implement `logdensity_and_gradient`.</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblemsAD</span>, <span class="bu">ADTypes</span>, <span class="bu">ForwardDiff</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>model_with_grad <span class="op">=</span> <span class="fu">ADgradient</span>(<span class="fu">AutoForwardDiff</span>(), model)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model_with_grad, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-32.83063557121679</code></pre>
</div>
</div>
<p>We’ll continue with the second approach in this tutorial since this is typically what one does in practice, because there are better hobbies to spend time on than deriving gradients by hand.</p>
<p>At this point, one might wonder how we’re going to tie this back to Turing.jl in the end. Effectively, when working with inference methods that only require log-density evaluations and / or higher-order information of the log-density, Turing.jl actually converts the user-provided <code>Model</code> into an object implementing the above methods for <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>. As a result, most samplers provided by Turing.jl are actually implemented to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, enabling their use both <em>within</em> Turing.jl and <em>outside</em> of Turing.jl! Morever, there exists similar conversions for Stan through BridgeStan and Stan<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, which means that a sampler supporting the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface can easily be used on both Turing.jl <em>and</em> Stan models (in addition to user-provided models, as our <code>IsotropicNormalModel</code> above)!</p>
<p>Anyways, let’s move on to actually implementing the sampler.</p>
</section>
<section id="implementing-mala-in-abstractmcmc.jl" class="level2">
<h2 class="anchored" data-anchor-id="implementing-mala-in-abstractmcmc.jl">Implementing MALA in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a></h2>
<p>Now that we’ve established that a model implementing the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface provides us with all the information we need from <span class="math inline">\(\log \gamma(x)\)</span>, we can address the question: given an object that implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, how can we define a sampler for it?</p>
<p>We’re going to do this by making our sampler a sub-type of <code>AbstractMCMC.AbstractSampler</code> in addition to implementing a few methods from <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>. Why? Because it gets us <em>a lot</em> of functionality for free, as we will see later.</p>
<p>Moreover, <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> provides a very natural interface for MCMC algorithms.</p>
<p>First, we’ll define our <code>MALA</code> type</p>
<div id="12" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">AbstractMCMC</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALA{T,A} <span class="op">&lt;:</span><span class="dt"> AbstractMCMC.AbstractSampler</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"stepsize used in the leapfrog step"</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    ϵ_init<span class="op">::</span><span class="dt">T</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"covariance matrix used for the momentum"</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    M_init<span class="op">::</span><span class="dt">A</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notice how we’ve added the suffix <code>_init</code> to both the stepsize and the covariance matrix. We’ve done this because a <code>AbstractMCMC.AbstractSampler</code> should be <em>immutable</em>. Of course there might be many scenarios where we want to allow something like the stepsize and / or the covariance matrix to vary between iterations, e.g.&nbsp;during the burn-in / adaptation phase of the sampling process we might want to adjust the parameters using statistics computed from these initial iterations. But information which can change between iterations <em>should not go in the sampler itself</em>! Instead, this information should go in the sampler <em>state</em>.</p>
<p>The sampler state should at the very least contain all the necessary information to perform the next MCMC iteration, but usually contains further information, e.g.&nbsp;quantities and statistics useful for evaluating whether the sampler has converged.</p>
<p>We will use the following sampler state for our <code>MALA</code> sampler:</p>
<div id="14" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALAState{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This might seem overly redundant: we’re defining a type <code>MALAState</code> and it only contains a simple vector of reals. In this particular case we indeed could have dropped this and simply used a <code>AbstractVector{&lt;:Real}</code> as our sampler state, but typically, as we will see later, one wants to include other quantities in the sampler state. For example, if we also wanted to adapt the parameters of our <code>MALA</code>, e.g.&nbsp;alter the stepsize depending on acceptance rates, in which case we should also put <code>ϵ</code> in the state, but for now we’ll keep things simple.</p>
<p>Moreover, we also want a <em>sample</em> type, which is a type meant for “public consumption”, i.e.&nbsp;the end-user. This is generally going to contain a subset of the information present in the state. But in such a simple scenario as this, we similarly only have a <code>AbstractVector{&lt;:Real}</code>:</p>
<div id="16" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALASample{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We currently have three things:</p>
<ol type="1">
<li>A <code>AbstractMCMC.AbstractSampler</code> implementation called <code>MALA</code>.</li>
<li>A state <code>MALAState</code> for our sampler <code>MALA</code>.</li>
<li>A sample <code>MALASample</code> for our sampler <code>MALA</code>.</li>
</ol>
<p>That means that we’re ready to implement the only thing that really matters: <code>AbstractMCMC.step</code>.</p>
<p><code>AbstractMCMC.step</code> defines the MCMC iteration of our <code>MALA</code> given the current <code>MALAState</code>. Specifically, the signature of the function is as follows:</p>
<div id="18" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The RNG to ensure reproducibility.</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The model that defines our target.</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.AbstractModel</span>,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The sampler for which we're taking a `step`.</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">AbstractMCMC.AbstractSampler</span>,</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The current sampler `state`.</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    state;</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Additional keyword arguments that we may or may not need.</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Moreover, there is a specific <code>AbstractMCMC.AbstractModel</code> which is used to indicate that the model that is provided implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface: <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Since, as we discussed earlier, in our case we’re indeed going to work with types that support the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, we’ll define <code>AbstractMCMC.step</code> for such a <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Note that <code>AbstractMCMC.LogDensityModel</code> has no other purpose; it has a single field called <code>logdensity</code>, and it does nothing else. But by wrapping the model in <code>AbstractMCMC.LogDensityModel</code>, it allows samplers that want to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> to define their <code>AbstractMCMC.step</code> on this type without running into method ambiguities.</p>
<p>All in all, that means that the signature for our <code>AbstractMCMC.step</code> is going to be the following:</p>
<div id="20" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># `LogDensityModel` so we know we're working with LogDensityProblems.jl model.</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler.</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler state.</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Great! Now let’s actually implement the full <code>AbstractMCMC.step</code> for our <code>MALA</code>.</p>
<p>Let’s remind ourselves what we’re going to do:</p>
<ol type="1">
<li>Sample a new momentum <span class="math inline">\(p\)</span>.</li>
<li>Compute the log-density of the extended target <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>Take a single leapfrog step <span class="math inline">\((\tilde{x}, \tilde{p}) = L_{\epsilon}(x, p)\)</span>.</li>
<li>Accept or reject the proposed <span class="math inline">\((\tilde{x}, \tilde{p})\)</span>.</li>
</ol>
<p>All in all, this results in the following:</p>
<div id="22" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>: Random</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Distributions</span>  <span class="co"># so we get the `MvNormal`</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the wrapped model which implements LogDensityProblems.jl.</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just extract the sampler parameters to make our lives easier.</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    ϵ <span class="op">=</span> sampler.ϵ_init</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    M <span class="op">=</span> sampler.M_init</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the current parameters.</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> state.x</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sample the momentum.</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>    p_dist <span class="op">=</span> <span class="fu">MvNormal</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)), M)</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> <span class="fu">rand</span>(rng, p_dist)</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Propose using a single leapfrog step.</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>    x̃, p̃ <span class="op">=</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Accept or reject proposal.</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>    logp <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p)</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>    logp̃ <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x̃) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p̃)</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>    logα <span class="op">=</span> logp̃ <span class="op">-</span> logp</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>    state_new <span class="op">=</span> <span class="cf">if</span> <span class="fu">log</span>(<span class="fu">rand</span>(rng)) <span class="op">&lt;</span> logα</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Accept.</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x̃)</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Reject.</span></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x)</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return the "sample" and the sampler state.</span></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(state_new.x), state_new</span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Fairly straight-forward.</p>
<p>Of course, we haven’t defined the <code>leapfrog_step</code> method yet, so let’s do that:</p>
<div id="24" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p` using "position" `x`.</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x))</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    p1 <span class="op">=</span> p <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update the "position" `x` using momentum `p1`.</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    x̃ <span class="op">=</span> x <span class="op">+</span> ϵ <span class="op">.*</span> (M <span class="op">\</span> p1)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p1` using position `x̃`</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x̃ <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x̃))</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    p2 <span class="op">=</span> p1 <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x̃</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Flip momentum `p2`.</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    p̃ <span class="op">=</span> <span class="op">-</span>p2</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x̃, p̃</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>leapfrog_step (generic function with 1 method)</code></pre>
</div>
</div>
<p>With all of this, we’re technically ready to sample!</p>
<div id="26" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>, <span class="bu">LinearAlgebra</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>rng <span class="op">=</span> <span class="bu">Random</span>.<span class="fu">default_rng</span>()</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>sampler <span class="op">=</span> <span class="fu">MALA</span>(<span class="fl">1</span>, I)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>state <span class="op">=</span> <span class="fu">MALAState</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)))</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>x_next, state_next <span class="op">=</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    rng,</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    AbstractMCMC.<span class="fu">LogDensityModel</span>(model),</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    state</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>(MALASample{Vector{Float64}}([-0.15254464506093582, 0.07958475793432046, 0.6667847209134836]), MALAState{Vector{Float64}}([-0.15254464506093582, 0.07958475793432046, 0.6667847209134836]))</code></pre>
</div>
</div>
<p>Great, it works!</p>
<p>And I promised we would get quite some functionality for free if we implemented <code>AbstractMCMC.step</code>, and so we can now simply call <code>sample</code> to perform standard MCMC sampling:</p>
<div id="28" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform 1000 iterations with our `MALA` sampler.</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; initial_state<span class="op">=</span>state, progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Concatenate into a matrix.</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000 Matrix{Float64}:
 -2.33658   -4.51413  -5.1123    -6.5575    …  -4.44017   -5.01566  -5.90369
  0.157027   0.186     0.216185  -0.158174     -0.205154   1.73094   0.966758
  2.58334    3.10061   3.73091    5.80097       2.51876    2.53856   4.20217</code></pre>
</div>
</div>
<div id="30" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the marginal means and standard deviations.</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -4.98513    1.00144
  0.0156878  1.01221
  4.988      1.00867</code></pre>
</div>
</div>
<p>Let’s visualize the samples</p>
<div id="32" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">StatsPlots</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">transpose</span>(samples_matrix[<span class="op">:</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">:</span><span class="kw">end</span>]), alpha<span class="op">=</span><span class="fl">0.5</span>, legend<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<!--?xml version="1.0" encoding="utf-8"?-->
<svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" width="672" height="480" viewbox="0 0 2688 1920">
<defs>
  <clippath id="clip430">
    <rect x="0" y="0" width="2688" height="1920"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip430)" d="M0 1920 L2688 1920 L2688 0 L0 0  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip431">
    <rect x="537" y="0" width="1883" height="1883"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip430)" d="M151.747 1800.78 L2640.76 1800.78 L2640.76 47.2441 L151.747 47.2441  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip432">
    <rect x="151" y="47" width="2490" height="1755"></rect>
  </clippath>
</defs>
<polyline clip-path="url(#clip432)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="219.84,1800.78 219.84,47.2441 "></polyline>
<polyline clip-path="url(#clip432)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="807.458,1800.78 807.458,47.2441 "></polyline>
<polyline clip-path="url(#clip432)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1395.08,1800.78 1395.08,47.2441 "></polyline>
<polyline clip-path="url(#clip432)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1982.69,1800.78 1982.69,47.2441 "></polyline>
<polyline clip-path="url(#clip432)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="2570.31,1800.78 2570.31,47.2441 "></polyline>
<polyline clip-path="url(#clip432)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,1524.35 2640.76,1524.35 "></polyline>
<polyline clip-path="url(#clip432)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,1215.19 2640.76,1215.19 "></polyline>
<polyline clip-path="url(#clip432)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,906.021 2640.76,906.021 "></polyline>
<polyline clip-path="url(#clip432)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,596.855 2640.76,596.855 "></polyline>
<polyline clip-path="url(#clip432)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,287.688 2640.76,287.688 "></polyline>
<polyline clip-path="url(#clip430)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1800.78 2640.76,1800.78 "></polyline>
<polyline clip-path="url(#clip430)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="219.84,1800.78 219.84,1781.88 "></polyline>
<polyline clip-path="url(#clip430)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="807.458,1800.78 807.458,1781.88 "></polyline>
<polyline clip-path="url(#clip430)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1395.08,1800.78 1395.08,1781.88 "></polyline>
<polyline clip-path="url(#clip430)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1982.69,1800.78 1982.69,1781.88 "></polyline>
<polyline clip-path="url(#clip430)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="2570.31,1800.78 2570.31,1781.88 "></polyline>
<path clip-path="url(#clip430)" d="M219.84 1834 Q216.229 1834 214.4 1837.57 Q212.595 1841.11 212.595 1848.24 Q212.595 1855.34 214.4 1858.91 Q216.229 1862.45 219.84 1862.45 Q223.474 1862.45 225.28 1858.91 Q227.108 1855.34 227.108 1848.24 Q227.108 1841.11 225.28 1837.57 Q223.474 1834 219.84 1834 M219.84 1830.3 Q225.65 1830.3 228.706 1834.9 Q231.784 1839.49 231.784 1848.24 Q231.784 1856.96 228.706 1861.57 Q225.65 1866.15 219.84 1866.15 Q214.03 1866.15 210.951 1861.57 Q207.896 1856.96 207.896 1848.24 Q207.896 1839.49 210.951 1834.9 Q214.03 1830.3 219.84 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip430)" d="M771.15 1861.55 L787.47 1861.55 L787.47 1865.48 L765.525 1865.48 L765.525 1861.55 Q768.187 1858.79 772.771 1854.16 Q777.377 1849.51 778.558 1848.17 Q780.803 1845.65 781.683 1843.91 Q782.585 1842.15 782.585 1840.46 Q782.585 1837.71 780.641 1835.97 Q778.72 1834.23 775.618 1834.23 Q773.419 1834.23 770.965 1835 Q768.535 1835.76 765.757 1837.31 L765.757 1832.59 Q768.581 1831.46 771.035 1830.88 Q773.488 1830.3 775.525 1830.3 Q780.896 1830.3 784.09 1832.98 Q787.285 1835.67 787.285 1840.16 Q787.285 1842.29 786.474 1844.21 Q785.687 1846.11 783.581 1848.7 Q783.002 1849.37 779.9 1852.59 Q776.798 1855.78 771.15 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip430)" d="M797.331 1830.92 L815.687 1830.92 L815.687 1834.86 L801.613 1834.86 L801.613 1843.33 Q802.632 1842.98 803.65 1842.82 Q804.669 1842.64 805.687 1842.64 Q811.474 1842.64 814.854 1845.81 Q818.233 1848.98 818.233 1854.4 Q818.233 1859.97 814.761 1863.08 Q811.289 1866.15 804.97 1866.15 Q802.794 1866.15 800.525 1865.78 Q798.28 1865.41 795.872 1864.67 L795.872 1859.97 Q797.956 1861.11 800.178 1861.66 Q802.4 1862.22 804.877 1862.22 Q808.882 1862.22 811.22 1860.11 Q813.558 1858.01 813.558 1854.4 Q813.558 1850.78 811.22 1848.68 Q808.882 1846.57 804.877 1846.57 Q803.002 1846.57 801.127 1846.99 Q799.275 1847.4 797.331 1848.28 L797.331 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip430)" d="M837.446 1834 Q833.835 1834 832.007 1837.57 Q830.201 1841.11 830.201 1848.24 Q830.201 1855.34 832.007 1858.91 Q833.835 1862.45 837.446 1862.45 Q841.081 1862.45 842.886 1858.91 Q844.715 1855.34 844.715 1848.24 Q844.715 1841.11 842.886 1837.57 Q841.081 1834 837.446 1834 M837.446 1830.3 Q843.256 1830.3 846.312 1834.9 Q849.391 1839.49 849.391 1848.24 Q849.391 1856.96 846.312 1861.57 Q843.256 1866.15 837.446 1866.15 Q831.636 1866.15 828.557 1861.57 Q825.502 1856.96 825.502 1848.24 Q825.502 1839.49 828.557 1834.9 Q831.636 1830.3 837.446 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip430)" d="M1354.69 1830.92 L1373.05 1830.92 L1373.05 1834.86 L1358.98 1834.86 L1358.98 1843.33 Q1360 1842.98 1361.01 1842.82 Q1362.03 1842.64 1363.05 1842.64 Q1368.84 1842.64 1372.22 1845.81 Q1375.6 1848.98 1375.6 1854.4 Q1375.6 1859.97 1372.12 1863.08 Q1368.65 1866.15 1362.33 1866.15 Q1360.16 1866.15 1357.89 1865.78 Q1355.64 1865.41 1353.24 1864.67 L1353.24 1859.97 Q1355.32 1861.11 1357.54 1861.66 Q1359.76 1862.22 1362.24 1862.22 Q1366.25 1862.22 1368.58 1860.11 Q1370.92 1858.01 1370.92 1854.4 Q1370.92 1850.78 1368.58 1848.68 Q1366.25 1846.57 1362.24 1846.57 Q1360.37 1846.57 1358.49 1846.99 Q1356.64 1847.4 1354.69 1848.28 L1354.69 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip430)" d="M1394.81 1834 Q1391.2 1834 1389.37 1837.57 Q1387.56 1841.11 1387.56 1848.24 Q1387.56 1855.34 1389.37 1858.91 Q1391.2 1862.45 1394.81 1862.45 Q1398.44 1862.45 1400.25 1858.91 Q1402.08 1855.34 1402.08 1848.24 Q1402.08 1841.11 1400.25 1837.57 Q1398.44 1834 1394.81 1834 M1394.81 1830.3 Q1400.62 1830.3 1403.68 1834.9 Q1406.75 1839.49 1406.75 1848.24 Q1406.75 1856.96 1403.68 1861.57 Q1400.62 1866.15 1394.81 1866.15 Q1389 1866.15 1385.92 1861.57 Q1382.87 1856.96 1382.87 1848.24 Q1382.87 1839.49 1385.92 1834.9 Q1389 1830.3 1394.81 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip430)" d="M1424.97 1834 Q1421.36 1834 1419.53 1837.57 Q1417.73 1841.11 1417.73 1848.24 Q1417.73 1855.34 1419.53 1858.91 Q1421.36 1862.45 1424.97 1862.45 Q1428.61 1862.45 1430.41 1858.91 Q1432.24 1855.34 1432.24 1848.24 Q1432.24 1841.11 1430.41 1837.57 Q1428.61 1834 1424.97 1834 M1424.97 1830.3 Q1430.78 1830.3 1433.84 1834.9 Q1436.92 1839.49 1436.92 1848.24 Q1436.92 1856.96 1433.84 1861.57 Q1430.78 1866.15 1424.97 1866.15 Q1419.16 1866.15 1416.08 1861.57 Q1413.03 1856.96 1413.03 1848.24 Q1413.03 1839.49 1416.08 1834.9 Q1419.16 1830.3 1424.97 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip430)" d="M1940.97 1830.92 L1963.19 1830.92 L1963.19 1832.91 L1950.65 1865.48 L1945.76 1865.48 L1957.57 1834.86 L1940.97 1834.86 L1940.97 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip430)" d="M1972.36 1830.92 L1990.71 1830.92 L1990.71 1834.86 L1976.64 1834.86 L1976.64 1843.33 Q1977.66 1842.98 1978.68 1842.82 Q1979.7 1842.64 1980.72 1842.64 Q1986.5 1842.64 1989.88 1845.81 Q1993.26 1848.98 1993.26 1854.4 Q1993.26 1859.97 1989.79 1863.08 Q1986.32 1866.15 1980 1866.15 Q1977.82 1866.15 1975.55 1865.78 Q1973.31 1865.41 1970.9 1864.67 L1970.9 1859.97 Q1972.98 1861.11 1975.21 1861.66 Q1977.43 1862.22 1979.9 1862.22 Q1983.91 1862.22 1986.25 1860.11 Q1988.59 1858.01 1988.59 1854.4 Q1988.59 1850.78 1986.25 1848.68 Q1983.91 1846.57 1979.9 1846.57 Q1978.03 1846.57 1976.15 1846.99 Q1974.3 1847.4 1972.36 1848.28 L1972.36 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip430)" d="M2012.47 1834 Q2008.86 1834 2007.03 1837.57 Q2005.23 1841.11 2005.23 1848.24 Q2005.23 1855.34 2007.03 1858.91 Q2008.86 1862.45 2012.47 1862.45 Q2016.11 1862.45 2017.91 1858.91 Q2019.74 1855.34 2019.74 1848.24 Q2019.74 1841.11 2017.91 1837.57 Q2016.11 1834 2012.47 1834 M2012.47 1830.3 Q2018.28 1830.3 2021.34 1834.9 Q2024.42 1839.49 2024.42 1848.24 Q2024.42 1856.96 2021.34 1861.57 Q2018.28 1866.15 2012.47 1866.15 Q2006.66 1866.15 2003.59 1861.57 Q2000.53 1856.96 2000.53 1848.24 Q2000.53 1839.49 2003.59 1834.9 Q2006.66 1830.3 2012.47 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip430)" d="M2514.84 1861.55 L2522.48 1861.55 L2522.48 1835.18 L2514.17 1836.85 L2514.17 1832.59 L2522.43 1830.92 L2527.11 1830.92 L2527.11 1861.55 L2534.75 1861.55 L2534.75 1865.48 L2514.84 1865.48 L2514.84 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip430)" d="M2554.19 1834 Q2550.58 1834 2548.75 1837.57 Q2546.94 1841.11 2546.94 1848.24 Q2546.94 1855.34 2548.75 1858.91 Q2550.58 1862.45 2554.19 1862.45 Q2557.82 1862.45 2559.63 1858.91 Q2561.46 1855.34 2561.46 1848.24 Q2561.46 1841.11 2559.63 1837.57 Q2557.82 1834 2554.19 1834 M2554.19 1830.3 Q2560 1830.3 2563.06 1834.9 Q2566.13 1839.49 2566.13 1848.24 Q2566.13 1856.96 2563.06 1861.57 Q2560 1866.15 2554.19 1866.15 Q2548.38 1866.15 2545.3 1861.57 Q2542.25 1856.96 2542.25 1848.24 Q2542.25 1839.49 2545.3 1834.9 Q2548.38 1830.3 2554.19 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip430)" d="M2584.35 1834 Q2580.74 1834 2578.91 1837.57 Q2577.11 1841.11 2577.11 1848.24 Q2577.11 1855.34 2578.91 1858.91 Q2580.74 1862.45 2584.35 1862.45 Q2587.99 1862.45 2589.79 1858.91 Q2591.62 1855.34 2591.62 1848.24 Q2591.62 1841.11 2589.79 1837.57 Q2587.99 1834 2584.35 1834 M2584.35 1830.3 Q2590.16 1830.3 2593.22 1834.9 Q2596.3 1839.49 2596.3 1848.24 Q2596.3 1856.96 2593.22 1861.57 Q2590.16 1866.15 2584.35 1866.15 Q2578.54 1866.15 2575.46 1861.57 Q2572.41 1856.96 2572.41 1848.24 Q2572.41 1839.49 2575.46 1834.9 Q2578.54 1830.3 2584.35 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip430)" d="M2614.51 1834 Q2610.9 1834 2609.07 1837.57 Q2607.27 1841.11 2607.27 1848.24 Q2607.27 1855.34 2609.07 1858.91 Q2610.9 1862.45 2614.51 1862.45 Q2618.15 1862.45 2619.95 1858.91 Q2621.78 1855.34 2621.78 1848.24 Q2621.78 1841.11 2619.95 1837.57 Q2618.15 1834 2614.51 1834 M2614.51 1830.3 Q2620.32 1830.3 2623.38 1834.9 Q2626.46 1839.49 2626.46 1848.24 Q2626.46 1856.96 2623.38 1861.57 Q2620.32 1866.15 2614.51 1866.15 Q2608.7 1866.15 2605.62 1861.57 Q2602.57 1856.96 2602.57 1848.24 Q2602.57 1839.49 2605.62 1834.9 Q2608.7 1830.3 2614.51 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip430)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1800.78 151.747,47.2441 "></polyline>
<polyline clip-path="url(#clip430)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1524.35 170.644,1524.35 "></polyline>
<polyline clip-path="url(#clip430)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1215.19 170.644,1215.19 "></polyline>
<polyline clip-path="url(#clip430)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,906.021 170.644,906.021 "></polyline>
<polyline clip-path="url(#clip430)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,596.855 170.644,596.855 "></polyline>
<polyline clip-path="url(#clip430)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,287.688 170.644,287.688 "></polyline>
<path clip-path="url(#clip430)" d="M49.5521 1524.81 L79.2279 1524.81 L79.2279 1528.74 L49.5521 1528.74 L49.5521 1524.81 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip430)" d="M99.8991 1522.49 Q96.7509 1522.49 94.8991 1524.64 Q93.0704 1526.8 93.0704 1530.55 Q93.0704 1534.27 94.8991 1536.45 Q96.7509 1538.6 99.8991 1538.6 Q103.047 1538.6 104.876 1536.45 Q106.728 1534.27 106.728 1530.55 Q106.728 1526.8 104.876 1524.64 Q103.047 1522.49 99.8991 1522.49 M109.181 1507.84 L109.181 1512.1 Q107.422 1511.26 105.617 1510.82 Q103.834 1510.38 102.075 1510.38 Q97.4454 1510.38 94.9917 1513.51 Q92.5612 1516.63 92.2139 1522.95 Q93.5797 1520.94 95.6398 1519.88 Q97.7 1518.79 100.177 1518.79 Q105.385 1518.79 108.394 1521.96 Q111.427 1525.11 111.427 1530.55 Q111.427 1535.87 108.279 1539.09 Q105.131 1542.31 99.8991 1542.31 Q93.9037 1542.31 90.7325 1537.72 Q87.5612 1533.12 87.5612 1524.39 Q87.5612 1516.2 91.45 1511.33 Q95.3389 1506.45 101.89 1506.45 Q103.649 1506.45 105.431 1506.8 Q107.237 1507.14 109.181 1507.84 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip430)" d="M50.3623 1215.64 L80.0381 1215.64 L80.0381 1219.57 L50.3623 1219.57 L50.3623 1215.64 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip430)" d="M104.297 1213.83 Q107.654 1214.55 109.529 1216.82 Q111.427 1219.09 111.427 1222.42 Q111.427 1227.54 107.908 1230.34 Q104.39 1233.14 97.9083 1233.14 Q95.7324 1233.14 93.4176 1232.7 Q91.126 1232.28 88.6723 1231.43 L88.6723 1226.91 Q90.6167 1228.05 92.9315 1228.63 Q95.2463 1229.2 97.7695 1229.2 Q102.168 1229.2 104.459 1227.47 Q106.774 1225.73 106.774 1222.42 Q106.774 1219.37 104.621 1217.65 Q102.492 1215.92 98.6722 1215.92 L94.6445 1215.92 L94.6445 1212.07 L98.8574 1212.07 Q102.306 1212.07 104.135 1210.71 Q105.964 1209.32 105.964 1206.73 Q105.964 1204.07 104.066 1202.65 Q102.191 1201.22 98.6722 1201.22 Q96.7509 1201.22 94.5519 1201.63 Q92.3528 1202.05 89.7139 1202.93 L89.7139 1198.76 Q92.376 1198.02 94.6908 1197.65 Q97.0287 1197.28 99.0889 1197.28 Q104.413 1197.28 107.515 1199.71 Q110.617 1202.12 110.617 1206.24 Q110.617 1209.11 108.973 1211.1 Q107.33 1213.07 104.297 1213.83 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip430)" d="M99.4824 891.82 Q95.8713 891.82 94.0426 895.385 Q92.2371 898.926 92.2371 906.056 Q92.2371 913.162 94.0426 916.727 Q95.8713 920.269 99.4824 920.269 Q103.117 920.269 104.922 916.727 Q106.751 913.162 106.751 906.056 Q106.751 898.926 104.922 895.385 Q103.117 891.82 99.4824 891.82 M99.4824 888.116 Q105.293 888.116 108.348 892.723 Q111.427 897.306 111.427 906.056 Q111.427 914.783 108.348 919.389 Q105.293 923.973 99.4824 923.973 Q93.6723 923.973 90.5936 919.389 Q87.538 914.783 87.538 906.056 Q87.538 897.306 90.5936 892.723 Q93.6723 888.116 99.4824 888.116 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip430)" d="M104.297 595.5 Q107.654 596.218 109.529 598.487 Q111.427 600.755 111.427 604.088 Q111.427 609.204 107.908 612.005 Q104.39 614.806 97.9083 614.806 Q95.7324 614.806 93.4176 614.366 Q91.126 613.949 88.6723 613.093 L88.6723 608.579 Q90.6167 609.713 92.9315 610.292 Q95.2463 610.871 97.7695 610.871 Q102.168 610.871 104.459 609.135 Q106.774 607.399 106.774 604.088 Q106.774 601.033 104.621 599.32 Q102.492 597.584 98.6722 597.584 L94.6445 597.584 L94.6445 593.741 L98.8574 593.741 Q102.306 593.741 104.135 592.375 Q105.964 590.987 105.964 588.394 Q105.964 585.732 104.066 584.32 Q102.191 582.885 98.6722 582.885 Q96.7509 582.885 94.5519 583.301 Q92.3528 583.718 89.7139 584.598 L89.7139 580.431 Q92.376 579.69 94.6908 579.32 Q97.0287 578.95 99.0889 578.95 Q104.413 578.95 107.515 581.38 Q110.617 583.788 110.617 587.908 Q110.617 590.778 108.973 592.769 Q107.33 594.737 104.297 595.5 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip430)" d="M99.8991 285.824 Q96.7509 285.824 94.8991 287.977 Q93.0704 290.13 93.0704 293.88 Q93.0704 297.607 94.8991 299.783 Q96.7509 301.935 99.8991 301.935 Q103.047 301.935 104.876 299.783 Q106.728 297.607 106.728 293.88 Q106.728 290.13 104.876 287.977 Q103.047 285.824 99.8991 285.824 M109.181 271.172 L109.181 275.431 Q107.422 274.598 105.617 274.158 Q103.834 273.718 102.075 273.718 Q97.4454 273.718 94.9917 276.843 Q92.5612 279.968 92.2139 286.287 Q93.5797 284.274 95.6398 283.209 Q97.7 282.121 100.177 282.121 Q105.385 282.121 108.394 285.292 Q111.427 288.44 111.427 293.88 Q111.427 299.204 108.279 302.422 Q105.131 305.639 99.8991 305.639 Q93.9037 305.639 90.7325 301.056 Q87.5612 296.449 87.5612 287.723 Q87.5612 279.528 91.45 274.667 Q95.3389 269.783 101.89 269.783 Q103.649 269.783 105.431 270.13 Q107.237 270.477 109.181 271.172 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip432)" style="stroke:#009af9; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,1146.82 224.541,1290.52 226.891,1372.15 229.242,1337.39 231.592,1459.51 233.943,1535.96 236.293,1316.83 238.644,1382.03 240.994,1363.82 243.345,1381.76 245.695,1452.82 248.046,1367.2 250.396,1427.14 252.747,1441.43 255.097,1448.2 257.448,1384.78 259.798,1513.18 262.148,1487.73 264.499,1491.6 266.849,1568.4 269.2,1460.04 271.55,1483.1 273.901,1483.74 276.251,1355.45 278.602,1376.64 280.952,1499.13 283.303,1471.02 285.653,1495.95 288.004,1474.53 290.354,1426.15 292.705,1468.92 295.055,1438.6 297.406,1456.95 299.756,1576.15 302.107,1335.11 304.457,1367.84 306.807,1483.42 309.158,1387.95 311.508,1443.53 313.859,1366.02 316.209,1430.77 318.56,1342.36 320.91,1407.85 323.261,1439.12 325.611,1359.03 327.962,1374.28 330.312,1348.47 332.663,1500.47 335.013,1393.64 337.364,1574.82 339.714,1332.09 342.065,1346.2 344.415,1358.56 346.765,1301.15 349.116,1652.49 351.466,1486.33 353.817,1382.45 356.167,1397.45 358.518,1442.83 360.868,1511.71 363.219,1304.78 365.569,1405.04 367.92,1402.8 370.27,1596.53 372.621,1313.88 374.971,1516.57 377.322,1410.27 379.672,1326.32 382.023,1316.62 384.373,1402.56 386.724,1751.15 389.074,1337.09 391.424,1245.31 393.775,1422.4 396.125,1524.33 398.476,1344.04 400.826,1482.09 403.177,1502.29 405.527,1389.21 407.878,1530.62 410.228,1585.53 412.579,1354.54 414.929,1520.27 417.28,1488.53 419.63,1457.32 421.981,1415.11 424.331,1395.31 426.682,1311.61 429.032,1364.68 431.382,1369.01 433.733,1281.3 436.083,1535.2 438.434,1395.96 440.784,1280.36 443.135,1415.24 445.485,1390.31 447.836,1170.5 450.186,1371.98 452.537,1393.65 454.887,1460.42 457.238,1510.31 459.588,1559.18 461.939,1382.85 464.289,1511.7 466.64,1328.78 468.99,1326.14 471.341,1399.05 473.691,1557.3 476.041,1464.71 478.392,1349.65 480.742,1450.03 483.093,1500.12 485.443,1268.95 487.794,1315.76 490.144,1366.63 492.495,1414.27 494.845,1521.26 497.196,1404.75 499.546,1504.16 501.897,1337.12 504.247,1476.46 506.598,1415.18 508.948,1270.72 511.299,1740.08 513.649,1343.04 515.999,1504.09 518.35,1569.68 520.7,1502.04 523.051,1473.77 525.401,1478.13 527.752,1643.67 530.102,1656.88 532.453,1494.76 534.803,1459.48 537.154,1471.26 539.504,1417.18 541.855,1488.21 544.205,1503.72 546.556,1429.33 548.906,1221.57 551.257,1465.24 553.607,1414.84 555.958,1383.4 558.308,1541.82 560.658,1521.84 563.009,1389.22 565.359,1508.65 567.71,1326.19 570.06,1498.81 572.411,1511.09 574.761,1478.08 577.112,1269.27 579.462,1208.36 581.813,1321.62 584.163,1155.54 586.514,1571.19 588.864,1555.13 591.215,1353.28 593.565,1517.47 595.916,1454.66 598.266,1426.13 600.616,1351.57 602.967,1282.28 605.317,1485.74 607.668,1504.65 610.018,1558.96 612.369,1461.15 614.719,1357.17 617.07,1531.16 619.42,1393.41 621.771,1418.17 624.121,1505.7 626.472,1506.41 628.822,1316.27 631.173,1479.06 633.523,1357.27 635.874,1482.75 638.224,1360.39 640.575,1335.77 642.925,1428.07 645.275,1365.26 647.626,1445.9 649.976,1354.65 652.327,1411.49 654.677,1533.27 657.028,1499.82 659.378,1352.22 661.729,1308.96 664.079,1337.12 666.43,1528.04 668.78,1423.29 671.131,1533.37 673.481,1336.4 675.832,1360.8 678.182,1216.95 680.533,1439.15 682.883,1446.96 685.233,1361.83 687.584,1552.69 689.934,1300.37 692.285,1448.06 694.635,1263.78 696.986,1366.26 699.336,1477.63 701.687,1417.45 704.037,1379.78 706.388,1395.27 708.738,1406.09 711.089,1542.1 713.439,1377.31 715.79,1411.53 718.14,1224.55 720.491,1260.86 722.841,1362.36 725.192,1439.99 727.542,1277.69 729.892,1472.37 732.243,1379.06 734.593,1377.32 736.944,1234.81 739.294,1396.27 741.645,1261.97 743.995,1574.58 746.346,1437.09 748.696,1337.29 751.047,1344.34 753.397,1431.67 755.748,1313.81 758.098,1485.75 760.449,1654.34 762.799,1269.93 765.15,1439.86 767.5,1374.29 769.85,1464.63 772.201,1207.63 774.551,1484.3 776.902,1272.47 779.252,1427.66 781.603,1438.24 783.953,1382.68 786.304,1357.32 788.654,1367.46 791.005,1342.33 793.355,1241.11 795.706,1410.35 798.056,1319.07 800.407,1440.35 802.757,1480.94 805.108,1262.38 807.458,1254.33 809.809,1477.38 812.159,1317.04 814.509,1391.59 816.86,1449.13 819.21,1377.92 821.561,1313.34 823.911,1668.68 826.262,1352.55 828.612,1215.72 830.963,1400.54 833.313,1449.64 835.664,1471.22 838.014,1332.85 840.365,1340.97 842.715,1505.35 845.066,1366.02 847.416,1462.02 849.767,1447.53 852.117,1543.86 854.467,1442.2 856.818,1424.12 859.168,1464.37 861.519,1204.36 863.869,1485.56 866.22,1456.42 868.57,1336.74 870.921,1402.71 873.271,1503.74 875.622,1426.52 877.972,1244.2 880.323,1448.02 882.673,1434.64 885.024,1451.01 887.374,1349.54 889.725,1524.02 892.075,1408.49 894.426,1261.89 896.776,1260.82 899.126,1409.78 901.477,1750.39 903.827,1413.74 906.178,1419.98 908.528,1328.48 910.879,1437.34 913.229,1354.91 915.58,1302.39 917.93,1493.05 920.281,1285.85 922.631,1580.76 924.982,1494.07 927.332,1471.17 929.683,1337.01 932.033,1369.37 934.384,1495.98 936.734,1439.45 939.084,1407.09 941.435,1183.57 943.785,1536.86 946.136,1420.12 948.486,1372.63 950.837,1194.22 953.187,1295.71 955.538,1494.39 957.888,1349.75 960.239,1359.33 962.589,1577.43 964.94,1481.86 967.29,1390.62 969.641,1365.32 971.991,1251.69 974.342,1246.82 976.692,1207.94 979.043,1420.12 981.393,1471.04 983.743,1399.14 986.094,1372.14 988.444,1410.18 990.795,1299.89 993.145,1386.49 995.496,1403.17 997.846,1177.05 1000.2,1587.6 1002.55,1396.07 1004.9,1352.01 1007.25,1354.42 1009.6,1442.42 1011.95,1366.01 1014.3,1405.41 1016.65,1445.29 1019,1344.13 1021.35,1227.68 1023.7,1504.41 1026.05,1400.67 1028.4,1440.71 1030.75,1289.77 1033.1,1473.98 1035.45,1493.22 1037.8,1400.75 1040.15,1401.89 1042.51,1450.67 1044.86,1596.6 1047.21,1466.89 1049.56,1470.02 1051.91,1329.45 1054.26,1589.73 1056.61,1537.33 1058.96,1585.93 1061.31,1628.45 1063.66,1369.53 1066.01,1172.9 1068.36,1292.7 1070.71,1499.1 1073.06,1360.97 1075.41,1292.38 1077.76,1297.51 1080.11,1337.07 1082.46,1669.32 1084.81,1279.55 1087.16,1496.18 1089.51,1349.63 1091.87,1344 1094.22,1231.89 1096.57,1320.84 1098.92,1444.04 1101.27,1461.62 1103.62,1317.1 1105.97,1481.31 1108.32,1303.21 1110.67,1366.44 1113.02,1360.93 1115.37,1469.76 1117.72,1452.61 1120.07,1473.91 1122.42,1530.05 1124.77,1395.43 1127.12,1306.69 1129.47,1419.15 1131.82,1316.73 1134.17,1410.19 1136.52,1451.34 1138.87,1493.68 1141.23,1518.89 1143.58,1497.04 1145.93,1526.52 1148.28,1370.03 1150.63,1371.29 1152.98,1448.58 1155.33,1528.56 1157.68,1244.33 1160.03,1401.84 1162.38,1445.77 1164.73,1461.7 1167.08,1346.54 1169.43,1550.52 1171.78,1331.91 1174.13,1516.98 1176.48,1464.23 1178.83,1320.56 1181.18,1566.84 1183.53,1400.83 1185.88,1451 1188.23,1403.95 1190.59,1320.02 1192.94,1345.88 1195.29,1318.16 1197.64,1411.12 1199.99,1376.07 1202.34,1524.32 1204.69,1354.72 1207.04,1383.92 1209.39,1290.82 1211.74,1460.91 1214.09,1304.82 1216.44,1670.5 1218.79,1228.53 1221.14,1345.7 1223.49,1415.48 1225.84,1380.06 1228.19,1536.63 1230.54,1365.24 1232.89,1340.56 1235.24,1571.41 1237.59,1331.54 1239.94,1420.25 1242.3,1285.31 1244.65,1473.05 1247,1482.68 1249.35,1386.91 1251.7,1489.7 1254.05,1294.42 1256.4,1515.53 1258.75,1477.95 1261.1,1332.83 1263.45,1523.36 1265.8,1489.52 1268.15,1645.49 1270.5,1362.12 1272.85,1570.83 1275.2,1509.92 1277.55,1470.28 1279.9,1471.26 1282.25,1310.08 1284.6,1305.85 1286.95,1291.79 1289.3,1374.35 1291.66,1412.3 1294.01,1352.79 1296.36,1473.52 1298.71,1463.11 1301.06,1579.77 1303.41,1442.29 1305.76,1499.65 1308.11,1414.23 1310.46,1553.56 1312.81,1439.04 1315.16,1567.78 1317.51,1527.07 1319.86,1469.15 1322.21,1525.72 1324.56,1697.45 1326.91,1363.04 1329.26,1369.77 1331.61,1679.43 1333.96,1530.42 1336.31,1412.28 1338.66,1293.86 1341.02,1311.77 1343.37,1468.24 1345.72,1425.62 1348.07,1247.91 1350.42,1426.91 1352.77,1446.1 1355.12,1341.87 1357.47,1401.99 1359.82,1256.69 1362.17,1311.76 1364.52,1461.31 1366.87,1391.96 1369.22,1294.91 1371.57,1467.59 1373.92,1549.78 1376.27,1509.09 1378.62,1171.44 1380.97,1399.45 1383.32,1521.4 1385.67,1406.63 1388.02,1496.4 1390.38,1441.26 1392.73,1718.03 1395.08,1502.79 1397.43,1466.97 1399.78,1481.76 1402.13,1406.45 1404.48,1378.19 1406.83,1440.33 1409.18,1539.09 1411.53,1499.75 1413.88,1277.34 1416.23,1479.94 1418.58,1632.31 1420.93,1381.95 1423.28,1504.84 1425.63,1266.48 1427.98,1562 1430.33,1515.72 1432.68,1450.86 1435.03,1365.82 1437.38,1403.52 1439.74,1573.35 1442.09,1450.14 1444.44,1468.76 1446.79,1569.84 1449.14,1299.1 1451.49,1453.88 1453.84,1377.28 1456.19,1455.26 1458.54,1284.02 1460.89,1413.07 1463.24,1595.22 1465.59,1177.88 1467.94,1369.85 1470.29,1243.42 1472.64,1628.51 1474.99,1395.83 1477.34,1373.62 1479.69,1229.52 1482.04,1451.89 1484.39,1349.49 1486.74,1414.96 1489.1,1268.98 1491.45,1511.75 1493.8,1386.46 1496.15,1437.76 1498.5,1419.26 1500.85,1461.96 1503.2,1584.44 1505.55,1419.31 1507.9,1536.56 1510.25,1487.61 1512.6,1349.8 1514.95,1473.57 1517.3,1320.58 1519.65,1373.51 1522,1576.8 1524.35,1402.86 1526.7,1615.22 1529.05,1544.68 1531.4,1540.11 1533.75,1250.05 1536.1,1664.14 1538.45,1601.19 1540.81,1374.06 1543.16,1265.97 1545.51,1415.46 1547.86,1392.51 1550.21,1377.46 1552.56,1533.25 1554.91,1426.44 1557.26,1093.82 1559.61,1457.83 1561.96,1299.46 1564.31,1483.97 1566.66,1257.74 1569.01,1203.67 1571.36,1392.98 1573.71,1496.2 1576.06,1345.42 1578.41,1453.69 1580.76,1452.01 1583.11,1336 1585.46,1430.95 1587.81,1310.57 1590.17,1450.45 1592.52,1273.66 1594.87,1499.42 1597.22,1226.2 1599.57,1296.21 1601.92,1364.39 1604.27,1483.55 1606.62,1382.35 1608.97,1538.49 1611.32,1504.42 1613.67,1493.76 1616.02,1282.34 1618.37,1669.37 1620.72,1414.82 1623.07,1445.85 1625.42,1522.47 1627.77,1455.92 1630.12,1480.78 1632.47,1385.06 1634.82,1595.19 1637.17,1491.65 1639.53,1404.09 1641.88,1316.13 1644.23,1233.27 1646.58,1315.67 1648.93,1440.73 1651.28,1327.42 1653.63,1246.53 1655.98,1467.86 1658.33,1385.78 1660.68,1318.31 1663.03,1451.25 1665.38,1365.53 1667.73,1497.88 1670.08,1202.73 1672.43,1468.82 1674.78,1703.45 1677.13,1480.47 1679.48,1343.98 1681.83,1245.82 1684.18,1367.51 1686.53,1298.34 1688.89,1378.16 1691.24,1441.74 1693.59,1514.99 1695.94,1253.36 1698.29,1447.43 1700.64,1520.31 1702.99,1231.69 1705.34,1462.19 1707.69,1488.58 1710.04,1186.25 1712.39,1426.57 1714.74,1550.28 1717.09,1329.13 1719.44,1337.01 1721.79,1321.91 1724.14,1518.74 1726.49,1502.15 1728.84,1357.84 1731.19,1275.18 1733.54,1348.85 1735.89,1287.25 1738.25,1499.85 1740.6,1509.07 1742.95,1539.05 1745.3,1652.26 1747.65,1344.01 1750,1412.24 1752.35,1272.73 1754.7,1589.71 1757.05,1483.98 1759.4,1439.58 1761.75,1542.42 1764.1,1348.51 1766.45,1389.34 1768.8,1355.48 1771.15,1379.64 1773.5,1541.09 1775.85,1534.96 1778.2,1433.67 1780.55,1478.39 1782.9,1507.01 1785.25,1493.77 1787.6,1500.14 1789.96,1361.27 1792.31,1443.9 1794.66,1421.63 1797.01,1426.3 1799.36,1505.02 1801.71,1447.12 1804.06,1249.42 1806.41,1501.11 1808.76,1491.46 1811.11,1413.7 1813.46,1450.1 1815.81,1390.32 1818.16,1474.16 1820.51,1424.41 1822.86,1419.08 1825.21,1324.81 1827.56,1297.26 1829.91,1361.25 1832.26,1377.75 1834.61,1361.99 1836.96,1465.81 1839.32,1500.71 1841.67,1536.86 1844.02,1367.69 1846.37,1527.8 1848.72,1390.02 1851.07,1448.04 1853.42,1282.06 1855.77,1369.73 1858.12,1116.66 1860.47,1443.96 1862.82,1245.05 1865.17,1242.45 1867.52,1253.04 1869.87,1227.53 1872.22,1493.24 1874.57,1499.18 1876.92,1587.01 1879.27,1448.85 1881.62,1276.1 1883.97,1433.27 1886.32,1297.4 1888.68,1332.17 1891.03,1497.36 1893.38,1225.46 1895.73,1377.77 1898.08,1654.32 1900.43,1376.82 1902.78,1423.18 1905.13,1522.25 1907.48,1532.14 1909.83,1493.33 1912.18,1385.34 1914.53,1496.39 1916.88,1382.55 1919.23,1341.93 1921.58,1219.91 1923.93,1246.8 1926.28,1361.6 1928.63,1452.67 1930.98,1564.92 1933.33,1428.64 1935.68,1634.74 1938.04,1536.74 1940.39,1577.4 1942.74,1374.06 1945.09,1376.91 1947.44,1307.43 1949.79,1513.34 1952.14,1341.98 1954.49,1461.96 1956.84,1356.04 1959.19,1411.78 1961.54,1343.06 1963.89,1168.1 1966.24,1421.54 1968.59,1436.95 1970.94,1351.01 1973.29,1369.58 1975.64,1372.27 1977.99,1330.06 1980.34,1359.96 1982.69,1290.37 1985.04,1275.4 1987.4,1433.64 1989.75,1325.94 1992.1,1426.49 1994.45,1560.47 1996.8,1370.62 1999.15,1521.12 2001.5,1590.14 2003.85,1465.69 2006.2,1407.86 2008.55,1366.93 2010.9,1310.73 2013.25,1310.11 2015.6,1156.6 2017.95,1632.49 2020.3,1351.49 2022.65,1397.22 2025,1301.06 2027.35,1271.95 2029.7,1343.99 2032.05,1441.14 2034.4,1494.51 2036.76,1376.79 2039.11,1415.62 2041.46,1334.72 2043.81,1275.5 2046.16,1345.62 2048.51,1405.08 2050.86,1627.25 2053.21,1595.95 2055.56,1407.73 2057.91,1395.57 2060.26,1556.05 2062.61,1376.25 2064.96,1457.64 2067.31,1550.22 2069.66,1443.06 2072.01,1372.52 2074.36,1476.5 2076.71,1448.59 2079.06,1436.81 2081.41,1386.29 2083.76,1339.94 2086.11,1460.19 2088.47,1361.11 2090.82,1455.44 2093.17,1556.9 2095.52,1537.55 2097.87,1575.05 2100.22,1575.26 2102.57,1371.35 2104.92,1410.55 2107.27,1592.61 2109.62,1297.68 2111.97,1299.85 2114.32,1308.82 2116.67,1510.52 2119.02,1390.64 2121.37,1355.42 2123.72,1478.96 2126.07,1464.17 2128.42,1472.99 2130.77,1303.11 2133.12,1479.31 2135.47,1428.8 2137.83,1433.44 2140.18,1579.12 2142.53,1487.79 2144.88,1418.11 2147.23,1438.28 2149.58,1400.2 2151.93,1515.21 2154.28,1479.06 2156.63,1365.78 2158.98,1400.3 2161.33,1557.9 2163.68,1436.23 2166.03,1381.17 2168.38,1438.93 2170.73,1249.99 2173.08,1435.31 2175.43,1371.74 2177.78,1524.03 2180.13,1371.48 2182.48,1499.31 2184.83,1445.27 2187.19,1549.24 2189.54,1409.63 2191.89,1328.47 2194.24,1455.35 2196.59,1217.79 2198.94,1445.63 2201.29,1516.54 2203.64,1513.69 2205.99,1410.22 2208.34,1521.71 2210.69,1308.74 2213.04,1671.64 2215.39,1518.9 2217.74,1411.45 2220.09,1259.6 2222.44,1568.61 2224.79,1357.16 2227.14,1281.8 2229.49,1373.94 2231.84,1385.78 2234.19,1196.04 2236.55,1462.74 2238.9,1285.51 2241.25,1420.09 2243.6,1504.8 2245.95,1390.3 2248.3,1578.92 2250.65,1608.5 2253,1537.91 2255.35,1317.21 2257.7,1358.77 2260.05,1548.75 2262.4,1513.95 2264.75,1335.9 2267.1,1464.7 2269.45,1538.01 2271.8,1390.22 2274.15,1530.74 2276.5,1308.61 2278.85,1425.44 2281.2,1490.08 2283.55,1541.79 2285.91,1428.82 2288.26,1496.92 2290.61,1661.79 2292.96,1716.82 2295.31,1253.31 2297.66,1559.88 2300.01,1426.1 2302.36,1479.91 2304.71,1444.67 2307.06,1370.1 2309.41,1447.52 2311.76,1370.68 2314.11,1481.73 2316.46,1401.61 2318.81,1317.74 2321.16,1346 2323.51,1392.07 2325.86,1433.96 2328.21,1366.29 2330.56,1412.79 2332.91,1434.25 2335.27,1622.23 2337.62,1453.36 2339.97,1374.64 2342.32,1466.87 2344.67,1465.5 2347.02,1390.8 2349.37,1366.27 2351.72,1249.7 2354.07,1384.89 2356.42,1408.74 2358.77,1300.6 2361.12,1351.18 2363.47,1576.37 2365.82,1380 2368.17,1337.99 2370.52,1272.41 2372.87,1370.78 2375.22,1504.47 2377.57,1338.3 2379.92,1534.88 2382.27,1380.52 2384.62,1372.18 2386.98,1371.93 2389.33,1390.57 2391.68,1450.39 2394.03,1480.15 2396.38,1445.91 2398.73,1470.07 2401.08,1424.43 2403.43,1437.78 2405.78,1359.38 2408.13,1304.53 2410.48,1464.06 2412.83,1350.34 2415.18,1326.62 2417.53,1264.16 2419.88,1489.04 2422.23,1588.45 2424.58,1356.55 2426.93,1272.69 2429.28,1247.51 2431.63,1431.46 2433.98,1523.84 2436.34,1323.79 2438.69,1353.27 2441.04,1303.14 2443.39,1472.91 2445.74,1622.96 2448.09,1517.11 2450.44,1386.75 2452.79,1443.83 2455.14,1488.8 2457.49,1435.26 2459.84,1320.82 2462.19,1532.78 2464.54,1537.68 2466.89,1541.65 2469.24,1390.81 2471.59,1181.43 2473.94,1358.99 2476.29,1309.9 2478.64,1330.13 2480.99,1541.96 2483.34,1502.3 2485.7,1342.55 2488.05,1356.67 2490.4,1430.91 2492.75,1410.11 2495.1,1386.38 2497.45,1402.16 2499.8,1431.72 2502.15,1341.71 2504.5,1472.34 2506.85,1222.27 2509.2,1531.16 2511.55,1620.97 2513.9,1229.91 2516.25,1384.7 2518.6,1498.61 2520.95,1541.01 2523.3,1447.43 2525.65,1554.15 2528,1555.19 2530.35,1367.49 2532.7,1464.79 2535.06,1312.88 2537.41,1342.32 2539.76,1404.22 2542.11,1413.77 2544.46,1519.55 2546.81,1384.26 2549.16,1224.46 2551.51,1462.1 2553.86,1388.51 2556.21,1333.1 2558.56,1325.99 2560.91,1351.43 2563.26,1535.03 2565.61,1642.34 2567.96,1415.43 2570.31,1312.51 "></polyline>
<polyline clip-path="url(#clip432)" style="stroke:#e26f46; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,889.839 224.541,651.157 226.891,988.696 229.242,792.474 231.592,1015.19 233.943,1010.09 236.293,1064.02 238.644,908.636 240.994,977.205 243.345,662.419 245.695,880.371 248.046,703.571 250.396,973.831 252.747,748.005 255.097,936.81 257.448,726.47 259.798,1001.77 262.148,963.157 264.499,868.57 266.849,725.622 269.2,885.759 271.55,848.418 273.901,825.18 276.251,1036.98 278.602,1010.73 280.952,1052.53 283.303,843.496 285.653,848.236 288.004,1056.74 290.354,898.986 292.705,924.471 295.055,987.07 297.406,765.317 299.756,923.439 302.107,923.972 304.457,983.914 306.807,963.296 309.158,968.227 311.508,789.719 313.859,759.452 316.209,954.469 318.56,795.402 320.91,909.219 323.261,733.299 325.611,930.767 327.962,889.791 330.312,921.127 332.663,721.356 335.013,821.161 337.364,855.243 339.714,846.218 342.065,795.747 344.415,981.14 346.765,854.261 349.116,857.49 351.466,972.595 353.817,944.708 356.167,910.722 358.518,901.836 360.868,998.128 363.219,880.501 365.569,904.911 367.92,981.03 370.27,801.52 372.621,951.662 374.971,781.008 377.322,863.086 379.672,837.342 382.023,938.84 384.373,893.107 386.724,873.029 389.074,1126.34 391.424,858.907 393.775,1079.74 396.125,937.627 398.476,1039.88 400.826,936.793 403.177,849.287 405.527,808.678 407.878,831.024 410.228,930.072 412.579,1169.11 414.929,989.104 417.28,886.147 419.63,827.666 421.981,805.506 424.331,852.938 426.682,780.995 429.032,939.776 431.382,1068.81 433.733,842.865 436.083,1050.64 438.434,740.362 440.784,830.95 443.135,796.704 445.485,913.685 447.836,930.135 450.186,900.282 452.537,871.745 454.887,822.83 457.238,940.92 459.588,986.115 461.939,770.777 464.289,930.49 466.64,850.695 468.99,955.269 471.341,1029.05 473.691,1029.61 476.041,959.407 478.392,716.007 480.742,909.505 483.093,982.781 485.443,951.114 487.794,844.629 490.144,1065.85 492.495,896.139 494.845,960.17 497.196,733.81 499.546,954.232 501.897,811.072 504.247,706.348 506.598,1047.89 508.948,1007.15 511.299,966.918 513.649,685.229 515.999,941.559 518.35,1080.37 520.7,796.425 523.051,1002 525.401,1178.06 527.752,886.446 530.102,911.177 532.453,774.432 534.803,904.831 537.154,938.79 539.504,776.784 541.855,944.297 544.205,1063.44 546.556,928.631 548.906,1058.56 551.257,671.264 553.607,988.679 555.958,894.567 558.308,917.718 560.658,960.543 563.009,823.065 565.359,668.388 567.71,913.089 570.06,866.207 572.411,1118.42 574.761,937.019 577.112,803.288 579.462,1073.17 581.813,924.524 584.163,1038.12 586.514,1073.84 588.864,787.7 591.215,792.619 593.565,978.571 595.916,965.422 598.266,895.945 600.616,693.116 602.967,868.441 605.317,859.277 607.668,990.178 610.018,1005.34 612.369,884.583 614.719,937.407 617.07,782.578 619.42,792.201 621.771,1060.69 624.121,816.845 626.472,1016.39 628.822,1028.93 631.173,1029.31 633.523,959.3 635.874,945.36 638.224,738.153 640.575,910.739 642.925,883.827 645.275,853.144 647.626,874.507 649.976,902.588 652.327,858.987 654.677,1010.38 657.028,1008.49 659.378,995.131 661.729,986.67 664.079,892.019 666.43,800.127 668.78,974.186 671.131,988.136 673.481,974.136 675.832,998.319 678.182,929.633 680.533,1070.3 682.883,1045.17 685.233,1038.53 687.584,1008.32 689.934,988.765 692.285,793.578 694.635,764.473 696.986,933.956 699.336,893.724 701.687,929.942 704.037,832.018 706.388,1031.76 708.738,933.023 711.089,1002.16 713.439,809.991 715.79,942.419 718.14,752.303 720.491,972.714 722.841,1073.03 725.192,873.963 727.542,750.178 729.892,940.648 732.243,835.994 734.593,778.321 736.944,1001.4 739.294,777.987 741.645,939.655 743.995,855.297 746.346,973.374 748.696,883.773 751.047,1028.86 753.397,947.008 755.748,887.506 758.098,800.855 760.449,926.905 762.799,1033.15 765.15,906.615 767.5,883.986 769.85,775.014 772.201,1149.49 774.551,962.745 776.902,776.638 779.252,1105.67 781.603,813.151 783.953,675.95 786.304,771.342 788.654,839.737 791.005,766.259 793.355,1033.02 795.706,936.251 798.056,967.718 800.407,954.498 802.757,859.922 805.108,737.311 807.458,864.893 809.809,958.671 812.159,837.363 814.509,941.458 816.86,950.72 819.21,967.571 821.561,780.418 823.911,688.469 826.262,887.512 828.612,860.635 830.963,987.829 833.313,937.684 835.664,962.981 838.014,890.41 840.365,901.4 842.715,970.576 845.066,925.206 847.416,891.566 849.767,1061.92 852.117,916.492 854.467,808.285 856.818,760.231 859.168,700.748 861.519,851.747 863.869,770.774 866.22,1071.53 868.57,733.552 870.921,830.716 873.271,991.364 875.622,783.061 877.972,810.659 880.323,960.959 882.673,890.156 885.024,1011.73 887.374,1031.36 889.725,1025.95 892.075,828.736 894.426,983.692 896.776,850.05 899.126,791.007 901.477,846.463 903.827,1135.39 906.178,919.18 908.528,936.44 910.879,1003.53 913.229,894.353 915.58,1137.53 917.93,776.694 920.281,960.251 922.631,782.122 924.982,918.012 927.332,833.561 929.683,998.874 932.033,960.711 934.384,813.669 936.734,979.969 939.084,1107.74 941.435,934.279 943.785,980.024 946.136,915.898 948.486,973.462 950.837,907.79 953.187,972.978 955.538,930.108 957.888,946.766 960.239,800.338 962.589,759.598 964.94,837.106 967.29,962.355 969.641,808.959 971.991,979.396 974.342,828.677 976.692,836.607 979.043,1049.74 981.393,859.506 983.743,975.019 986.094,988.289 988.444,937.178 990.795,865.539 993.145,817.229 995.496,1092.84 997.846,996.757 1000.2,750.876 1002.55,719.816 1004.9,898.443 1007.25,870.357 1009.6,953.184 1011.95,883.916 1014.3,894.497 1016.65,809.388 1019,1016.84 1021.35,995.415 1023.7,1119.6 1026.05,900.155 1028.4,778.834 1030.75,858.67 1033.1,859.799 1035.45,1104.42 1037.8,1099.08 1040.15,966.149 1042.51,835.428 1044.86,623.792 1047.21,835.893 1049.56,961.216 1051.91,1073.98 1054.26,1055.5 1056.61,847.741 1058.96,997.27 1061.31,888.986 1063.66,1024.21 1066.01,952.252 1068.36,691.318 1070.71,891.651 1073.06,1057.5 1075.41,751.163 1077.76,1031.5 1080.11,792.328 1082.46,949.537 1084.81,1053.9 1087.16,842.413 1089.51,887.382 1091.87,972.156 1094.22,963.707 1096.57,912.793 1098.92,941.197 1101.27,1036.97 1103.62,848.398 1105.97,920.473 1108.32,892.893 1110.67,702.041 1113.02,909.444 1115.37,963.49 1117.72,1001.2 1120.07,887.584 1122.42,900.993 1124.77,990.352 1127.12,878.55 1129.47,1112.17 1131.82,862.388 1134.17,764.205 1136.52,865.148 1138.87,887.83 1141.23,1086.73 1143.58,796.469 1145.93,990.432 1148.28,950.837 1150.63,1034.42 1152.98,913.922 1155.33,742.335 1157.68,957.369 1160.03,858.559 1162.38,972.956 1164.73,836.875 1167.08,815.66 1169.43,737.709 1171.78,723.161 1174.13,812.327 1176.48,1004.59 1178.83,1017.34 1181.18,655.633 1183.53,823.634 1185.88,821.946 1188.23,913.003 1190.59,992.626 1192.94,1004.28 1195.29,815.824 1197.64,990.09 1199.99,757.352 1202.34,905.642 1204.69,1022.5 1207.04,917.42 1209.39,748.064 1211.74,677.605 1214.09,1080.99 1216.44,873.703 1218.79,960.442 1221.14,904.755 1223.49,875.245 1225.84,924.987 1228.19,1013.49 1230.54,910.029 1232.89,824.85 1235.24,799.792 1237.59,972.584 1239.94,823.748 1242.3,912.556 1244.65,1007.5 1247,964.812 1249.35,1070.46 1251.7,912.691 1254.05,787.277 1256.4,1046.71 1258.75,929.071 1261.1,1046.07 1263.45,760.267 1265.8,998.09 1268.15,945.643 1270.5,912.063 1272.85,888.013 1275.2,797.984 1277.55,910.518 1279.9,952.64 1282.25,933.868 1284.6,943.807 1286.95,982.888 1289.3,615.786 1291.66,917.233 1294.01,961.022 1296.36,861.323 1298.71,854.039 1301.06,743.849 1303.41,933.253 1305.76,791.695 1308.11,1024 1310.46,947.616 1312.81,1034.51 1315.16,1080.04 1317.51,824.641 1319.86,915.232 1322.21,970.059 1324.56,951.16 1326.91,1144.48 1329.26,1107.06 1331.61,779.229 1333.96,1122.57 1336.31,1035.29 1338.66,989.887 1341.02,898.7 1343.37,1092.97 1345.72,722.914 1348.07,826.4 1350.42,912.184 1352.77,866.403 1355.12,888.101 1357.47,719.299 1359.82,618.186 1362.17,881.332 1364.52,714.696 1366.87,952.784 1369.22,1115.4 1371.57,735.053 1373.92,968.686 1376.27,892.344 1378.62,787.314 1380.97,733.693 1383.32,911.343 1385.67,770.201 1388.02,943.789 1390.38,958.851 1392.73,809.63 1395.08,695.693 1397.43,856.122 1399.78,793.424 1402.13,944.857 1404.48,954.945 1406.83,671.469 1409.18,962.361 1411.53,925.993 1413.88,926.089 1416.23,1005.26 1418.58,877.366 1420.93,850.1 1423.28,914.433 1425.63,1029.8 1427.98,843.101 1430.33,776.222 1432.68,782.124 1435.03,956.851 1437.38,949.717 1439.74,1118 1442.09,835.758 1444.44,1064.66 1446.79,779.909 1449.14,872.597 1451.49,789.719 1453.84,984.701 1456.19,772.91 1458.54,1039 1460.89,777.881 1463.24,951.903 1465.59,1033.98 1467.94,939.428 1470.29,773.866 1472.64,935.065 1474.99,873.15 1477.34,1039.76 1479.69,810.877 1482.04,900.421 1484.39,918.858 1486.74,935.292 1489.1,739.788 1491.45,959.62 1493.8,983.45 1496.15,806.716 1498.5,835.856 1500.85,910.761 1503.2,931.24 1505.55,889.548 1507.9,710.192 1510.25,721.723 1512.6,1062.78 1514.95,877.473 1517.3,863.309 1519.65,980.237 1522,1034.1 1524.35,845.44 1526.7,1008.96 1529.05,906.299 1531.4,685.84 1533.75,809.566 1536.1,939.209 1538.45,1071.58 1540.81,920.903 1543.16,832.004 1545.51,901.37 1547.86,1016.82 1550.21,910.818 1552.56,837.679 1554.91,743.722 1557.26,884.324 1559.61,675.052 1561.96,975.478 1564.31,813.456 1566.66,788.165 1569.01,798.538 1571.36,972.258 1573.71,957.282 1576.06,944.486 1578.41,1070.02 1580.76,950.199 1583.11,915.32 1585.46,846.074 1587.81,894.981 1590.17,787.56 1592.52,926.075 1594.87,805.139 1597.22,829.628 1599.57,905.565 1601.92,926.345 1604.27,813.809 1606.62,767.822 1608.97,934.551 1611.32,933.931 1613.67,847.115 1616.02,809.607 1618.37,948.982 1620.72,905.137 1623.07,975.519 1625.42,1133.65 1627.77,1139.49 1630.12,947.994 1632.47,856.633 1634.82,914.721 1637.17,1032.91 1639.53,859.706 1641.88,889.483 1644.23,1129.62 1646.58,879.976 1648.93,951.415 1651.28,801.873 1653.63,804.842 1655.98,955.333 1658.33,855.693 1660.68,821.668 1663.03,863.744 1665.38,951 1667.73,875.36 1670.08,754.974 1672.43,1006.51 1674.78,874.058 1677.13,986.241 1679.48,952.427 1681.83,922.289 1684.18,778.243 1686.53,1001.26 1688.89,895.117 1691.24,845.492 1693.59,1004.03 1695.94,1008.71 1698.29,857.105 1700.64,666.24 1702.99,908.156 1705.34,1019.87 1707.69,1083.59 1710.04,853.924 1712.39,958.096 1714.74,1091.32 1717.09,1059.47 1719.44,989.912 1721.79,1168.16 1724.14,845.937 1726.49,804.058 1728.84,875.788 1731.19,955.349 1733.54,907.914 1735.89,702.912 1738.25,923.239 1740.6,751.366 1742.95,821.778 1745.3,1008.7 1747.65,926.896 1750,773.564 1752.35,671.514 1754.7,896.595 1757.05,838.48 1759.4,929.8 1761.75,758.4 1764.1,1028.63 1766.45,992.037 1768.8,922.225 1771.15,930.201 1773.5,873.44 1775.85,737.855 1778.2,841.45 1780.55,1079.31 1782.9,909.377 1785.25,995.59 1787.6,912.309 1789.96,944.939 1792.31,884.714 1794.66,923.016 1797.01,1192.47 1799.36,845.617 1801.71,896.792 1804.06,1068.34 1806.41,1012.68 1808.76,938.116 1811.11,1080.09 1813.46,765.572 1815.81,792.557 1818.16,891.632 1820.51,894.835 1822.86,959.998 1825.21,821.515 1827.56,829.619 1829.91,1025.98 1832.26,1027.21 1834.61,937.44 1836.96,968.075 1839.32,926.735 1841.67,1020.11 1844.02,837.737 1846.37,1024.66 1848.72,761.913 1851.07,875.789 1853.42,979.202 1855.77,898.8 1858.12,894.505 1860.47,928.536 1862.82,952.112 1865.17,960.428 1867.52,856.332 1869.87,839.823 1872.22,974.947 1874.57,910.227 1876.92,959.086 1879.27,857.513 1881.62,1090.64 1883.97,873.45 1886.32,966.049 1888.68,880.876 1891.03,1048.48 1893.38,939.352 1895.73,949.533 1898.08,891.975 1900.43,1022.95 1902.78,888.349 1905.13,969.082 1907.48,838.199 1909.83,850.315 1912.18,913.286 1914.53,831.963 1916.88,982.627 1919.23,944.355 1921.58,851.12 1923.93,889.83 1926.28,810.943 1928.63,972.761 1930.98,883.529 1933.33,838.253 1935.68,1065.47 1938.04,906.382 1940.39,1000.63 1942.74,887.756 1945.09,789.751 1947.44,819.518 1949.79,854.613 1952.14,953.192 1954.49,1007.11 1956.84,875.846 1959.19,949.212 1961.54,970.124 1963.89,1054 1966.24,918.857 1968.59,1109.77 1970.94,979.454 1973.29,699.774 1975.64,963.193 1977.99,787.929 1980.34,764.101 1982.69,964.607 1985.04,1156.05 1987.4,1002.97 1989.75,810.022 1992.1,884.42 1994.45,861.042 1996.8,867.585 1999.15,993.492 2001.5,778.981 2003.85,1148.62 2006.2,799.874 2008.55,893.996 2010.9,932.249 2013.25,859.863 2015.6,947.275 2017.95,998.325 2020.3,936.787 2022.65,939.15 2025,943.476 2027.35,962.053 2029.7,1131.44 2032.05,907.328 2034.4,945.228 2036.76,876.262 2039.11,985.973 2041.46,684.596 2043.81,1119.52 2046.16,1123.66 2048.51,873.324 2050.86,651.974 2053.21,799.467 2055.56,972.125 2057.91,977.677 2060.26,938.53 2062.61,1072.16 2064.96,833.367 2067.31,937.459 2069.66,1111.89 2072.01,950.228 2074.36,1000.89 2076.71,996.195 2079.06,779.501 2081.41,881.629 2083.76,756.424 2086.11,871.478 2088.47,873.358 2090.82,996.068 2093.17,836.427 2095.52,827.276 2097.87,797.603 2100.22,845.956 2102.57,1040.57 2104.92,1098.67 2107.27,1038.34 2109.62,1021.82 2111.97,767.343 2114.32,769.148 2116.67,820.67 2119.02,853.748 2121.37,1014.23 2123.72,922.162 2126.07,759.025 2128.42,965.778 2130.77,995.407 2133.12,921.104 2135.47,1024.02 2137.83,1056.1 2140.18,655.058 2142.53,911.529 2144.88,932.633 2147.23,891.627 2149.58,804.322 2151.93,812.16 2154.28,1046.25 2156.63,1069.7 2158.98,955.564 2161.33,929.838 2163.68,936.343 2166.03,840.223 2168.38,693.193 2170.73,705.145 2173.08,941.542 2175.43,912.177 2177.78,835.225 2180.13,788.509 2182.48,945.484 2184.83,974.212 2187.19,794.567 2189.54,988.678 2191.89,820.714 2194.24,838.609 2196.59,863.056 2198.94,1209.96 2201.29,839.568 2203.64,906.937 2205.99,890.48 2208.34,970.244 2210.69,838.036 2213.04,867.663 2215.39,1030.01 2217.74,822.41 2220.09,837.374 2222.44,1009.33 2224.79,888.934 2227.14,820.315 2229.49,894.871 2231.84,899.466 2234.19,1062.99 2236.55,1016.72 2238.9,986.099 2241.25,826.488 2243.6,894.443 2245.95,861.997 2248.3,1009.55 2250.65,1094.46 2253,937.033 2255.35,780.186 2257.7,1009.77 2260.05,753.399 2262.4,890.808 2264.75,696.942 2267.1,921.426 2269.45,752.249 2271.8,1084 2274.15,967.101 2276.5,764.232 2278.85,690.93 2281.2,894.338 2283.55,912.191 2285.91,876.517 2288.26,898.485 2290.61,907.502 2292.96,896.305 2295.31,989.556 2297.66,847.271 2300.01,811.556 2302.36,926.215 2304.71,761.373 2307.06,728.349 2309.41,845.478 2311.76,1042.58 2314.11,893.994 2316.46,942.635 2318.81,814.391 2321.16,945.563 2323.51,869.55 2325.86,796.858 2328.21,1076.5 2330.56,993.008 2332.91,952.846 2335.27,939.691 2337.62,879.796 2339.97,858.777 2342.32,915.96 2344.67,1009.71 2347.02,970.837 2349.37,1090.86 2351.72,1055.26 2354.07,993.642 2356.42,1052.01 2358.77,955.135 2361.12,850.951 2363.47,974.751 2365.82,921.595 2368.17,1013.84 2370.52,752.062 2372.87,1037.8 2375.22,1045.11 2377.57,988.006 2379.92,1006.34 2382.27,898.784 2384.62,958.218 2386.98,763.785 2389.33,788.393 2391.68,1019.29 2394.03,934.552 2396.38,869.329 2398.73,819.677 2401.08,900.98 2403.43,1008.8 2405.78,857.6 2408.13,912.721 2410.48,1068.69 2412.83,866.368 2415.18,934.738 2417.53,794.274 2419.88,952.137 2422.23,1069.91 2424.58,740.274 2426.93,798.423 2429.28,915.528 2431.63,1106.55 2433.98,1010.24 2436.34,984.338 2438.69,813.533 2441.04,1079.17 2443.39,916.808 2445.74,947.554 2448.09,1007.77 2450.44,754.992 2452.79,832.881 2455.14,708.094 2457.49,962.271 2459.84,848.956 2462.19,1071.59 2464.54,812.066 2466.89,817.389 2469.24,976.337 2471.59,1033.7 2473.94,949.249 2476.29,989.541 2478.64,952.066 2480.99,939.389 2483.34,801.305 2485.7,713.635 2488.05,767.06 2490.4,923.065 2492.75,987.645 2495.1,905.337 2497.45,923.367 2499.8,755.452 2502.15,843.351 2504.5,941.474 2506.85,899.392 2509.2,941.113 2511.55,890.544 2513.9,850.198 2516.25,825.509 2518.6,853.017 2520.95,968.457 2523.3,962.898 2525.65,904.868 2528,876.883 2530.35,1015.38 2532.7,943.866 2535.06,1015.02 2537.41,848.022 2539.76,880.408 2542.11,560.496 2544.46,880.165 2546.81,793.392 2549.16,974.604 2551.51,955.001 2553.86,966.369 2556.21,1137.71 2558.56,998.914 2560.91,917.437 2563.26,897.766 2565.61,815.564 2567.96,1058.94 2570.31,736.719 "></polyline>
<polyline clip-path="url(#clip432)" style="stroke:#3da44d; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,639.794 224.541,425.537 226.891,417.49 229.242,322.306 231.592,412.076 233.943,377.033 236.293,359.535 238.644,300.954 240.994,517.994 243.345,465.191 245.695,409.994 248.046,429.524 250.396,528.233 252.747,488.063 255.097,426.348 257.448,415.22 259.798,495.004 262.148,361.184 264.499,472.861 266.849,512.762 269.2,340.144 271.55,452.844 273.901,248.021 276.251,293.053 278.602,255.245 280.952,309.041 283.303,492.465 285.653,369.26 288.004,368.554 290.354,354.262 292.705,528.25 295.055,287.283 297.406,368.661 299.756,221.245 302.107,462.59 304.457,360.332 306.807,350.84 309.158,594.315 311.508,310.541 313.859,285.717 316.209,317.377 318.56,231.43 320.91,562.31 323.261,452.502 325.611,352.46 327.962,365.066 330.312,329.801 332.663,241.214 335.013,496.559 337.364,390.807 339.714,432.506 342.065,409.216 344.415,464.006 346.765,563.02 349.116,444.635 351.466,255.347 353.817,260.576 356.167,493.618 358.518,306.448 360.868,415.751 363.219,319.662 365.569,455.714 367.92,307.356 370.27,553.73 372.621,430.216 374.971,437.35 377.322,472.88 379.672,427.442 382.023,266.094 384.373,214.148 386.724,536.613 389.074,499.406 391.424,432.923 393.775,558.559 396.125,428.77 398.476,340.491 400.826,197.405 403.177,561.231 405.527,283.423 407.878,468.684 410.228,399.268 412.579,306.022 414.929,460.893 417.28,328.756 419.63,243.714 421.981,490.853 424.331,519.054 426.682,479.901 429.032,437.688 431.382,387.594 433.733,598.534 436.083,299.519 438.434,158.009 440.784,355.241 443.135,218.336 445.485,254.399 447.836,421.478 450.186,266.965 452.537,185.226 454.887,323.172 457.238,419.374 459.588,402.23 461.939,342.877 464.289,278.621 466.64,389.705 468.99,246.487 471.341,424.558 473.691,429.863 476.041,196.319 478.392,491.738 480.742,414.76 483.093,662.116 485.443,259.74 487.794,410.919 490.144,516.208 492.495,520.759 494.845,484.071 497.196,282.16 499.546,360.629 501.897,559.597 504.247,271.174 506.598,301.083 508.948,225.369 511.299,255.791 513.649,448.922 515.999,563.554 518.35,451.489 520.7,317.773 523.051,403.088 525.401,406.377 527.752,366.282 530.102,372.835 532.453,323.806 534.803,303.246 537.154,411.703 539.504,348.131 541.855,347.695 544.205,387.451 546.556,494.725 548.906,277.194 551.257,400.745 553.607,484.872 555.958,592.688 558.308,358.983 560.658,204.842 563.009,449.756 565.359,391.352 567.71,305.333 570.06,414.236 572.411,258.918 574.761,520.605 577.112,359.877 579.462,385.087 581.813,457.516 584.163,514.995 586.514,265.326 588.864,414.734 591.215,352.736 593.565,350.64 595.916,522.487 598.266,231.559 600.616,314.782 602.967,281.855 605.317,509.07 607.668,399.414 610.018,566.256 612.369,375.97 614.719,507.448 617.07,381.514 619.42,372.85 621.771,294.445 624.121,384.697 626.472,441.432 628.822,271.85 631.173,412.06 633.523,453.54 635.874,561.882 638.224,353.755 640.575,252.05 642.925,332.5 645.275,311.86 647.626,547.222 649.976,236.184 652.327,388.96 654.677,562.279 657.028,355.795 659.378,414.411 661.729,456.072 664.079,345.888 666.43,343.576 668.78,269.065 671.131,391.792 673.481,506.174 675.832,377.606 678.182,250.948 680.533,483.263 682.883,351.303 685.233,565.607 687.584,431.055 689.934,305.54 692.285,468.569 694.635,353.022 696.986,554.234 699.336,406.571 701.687,210.29 704.037,434.206 706.388,359.095 708.738,360.502 711.089,339.829 713.439,396.031 715.79,623.567 718.14,292.005 720.491,248.042 722.841,337.87 725.192,324.419 727.542,510.118 729.892,444.666 732.243,282.997 734.593,195.064 736.944,300.477 739.294,559.029 741.645,423.465 743.995,446.409 746.346,233.436 748.696,507.187 751.047,416.056 753.397,466.396 755.748,332.866 758.098,457.24 760.449,535.192 762.799,224.768 765.15,477.486 767.5,528.38 769.85,263.49 772.201,377.385 774.551,429.002 776.902,431.119 779.252,490.598 781.603,498.664 783.953,463.883 786.304,387.093 788.654,357.625 791.005,392.98 793.355,450.129 795.706,404.885 798.056,398.4 800.407,309.686 802.757,360.089 805.108,356.399 807.458,329.394 809.809,317.682 812.159,392.883 814.509,234.294 816.86,414.41 819.21,436.282 821.561,253.169 823.911,440.114 826.262,504.63 828.612,435.202 830.963,528.64 833.313,502.319 835.664,489.628 838.014,432.443 840.365,501.396 842.715,385.138 845.066,439.967 847.416,438.993 849.767,478.642 852.117,328.132 854.467,286.935 856.818,324.768 859.168,493.518 861.519,357.752 863.869,542.333 866.22,461.61 868.57,421.403 870.921,433.759 873.271,447.647 875.622,315.777 877.972,371.243 880.323,627.79 882.673,504.173 885.024,384.26 887.374,326.183 889.725,356.744 892.075,493.818 894.426,585.2 896.776,381.506 899.126,555.985 901.477,519.997 903.827,478.535 906.178,362.114 908.528,699.237 910.879,442.422 913.229,267.201 915.58,538.246 917.93,456.756 920.281,503.747 922.631,241.721 924.982,653.089 927.332,460.103 929.683,535.191 932.033,397.105 934.384,503.928 936.734,475.569 939.084,288.887 941.435,342.072 943.785,348.776 946.136,371.164 948.486,244.478 950.837,478.266 953.187,491.903 955.538,442.31 957.888,215.522 960.239,493.997 962.589,434.007 964.94,265.68 967.29,419.352 969.641,235.686 971.991,446.122 974.342,344.596 976.692,483.979 979.043,305.546 981.393,362.051 983.743,506.331 986.094,262.192 988.444,439.452 990.795,495.21 993.145,376.206 995.496,324.024 997.846,318.87 1000.2,374.261 1002.55,551.507 1004.9,665.226 1007.25,306.676 1009.6,548.937 1011.95,411.144 1014.3,349.108 1016.65,338.127 1019,411.848 1021.35,390.263 1023.7,560.4 1026.05,457.088 1028.4,574.506 1030.75,247.629 1033.1,320.07 1035.45,412.214 1037.8,479.674 1040.15,457.764 1042.51,403.259 1044.86,571.622 1047.21,351.761 1049.56,479.185 1051.91,253.94 1054.26,377.183 1056.61,374.549 1058.96,557.862 1061.31,357.158 1063.66,422.433 1066.01,339.437 1068.36,668.862 1070.71,259.081 1073.06,298.999 1075.41,335.17 1077.76,418.513 1080.11,305.269 1082.46,407.344 1084.81,294.632 1087.16,346.25 1089.51,150.247 1091.87,481.674 1094.22,388.73 1096.57,323.629 1098.92,315.159 1101.27,640.21 1103.62,379.28 1105.97,338.439 1108.32,487.697 1110.67,627.014 1113.02,373.468 1115.37,437.015 1117.72,513.645 1120.07,405.071 1122.42,334.803 1124.77,376.255 1127.12,258.032 1129.47,449.653 1131.82,441.745 1134.17,441.129 1136.52,445.035 1138.87,480.986 1141.23,507.323 1143.58,379.117 1145.93,464.872 1148.28,292.923 1150.63,524.586 1152.98,503.449 1155.33,339.893 1157.68,395.301 1160.03,389.99 1162.38,290.874 1164.73,199.444 1167.08,335.56 1169.43,429.694 1171.78,332.145 1174.13,260.259 1176.48,289.409 1178.83,326.168 1181.18,436.638 1183.53,408.644 1185.88,612.698 1188.23,486.622 1190.59,392.903 1192.94,440.471 1195.29,347.782 1197.64,221.084 1199.99,215.698 1202.34,554.708 1204.69,359.239 1207.04,268.933 1209.39,469.427 1211.74,428.571 1214.09,305.346 1216.44,207.499 1218.79,366.661 1221.14,440.92 1223.49,256.369 1225.84,333.418 1228.19,429.874 1230.54,278.371 1232.89,369.407 1235.24,320.637 1237.59,353.972 1239.94,589.113 1242.3,554.41 1244.65,228.873 1247,337.405 1249.35,326.907 1251.7,626.929 1254.05,321.04 1256.4,501.647 1258.75,307.932 1261.1,372.364 1263.45,400.799 1265.8,284.893 1268.15,427.357 1270.5,182.219 1272.85,370.58 1275.2,432.225 1277.55,314.828 1279.9,369.288 1282.25,348.391 1284.6,496.838 1286.95,302.287 1289.3,135.542 1291.66,550.633 1294.01,375.661 1296.36,517.719 1298.71,422.896 1301.06,232.104 1303.41,474.389 1305.76,283.023 1308.11,234.586 1310.46,287.884 1312.81,536.728 1315.16,334.257 1317.51,149.701 1319.86,297.161 1322.21,371.539 1324.56,460.671 1326.91,270.034 1329.26,284.5 1331.61,192.655 1333.96,283.422 1336.31,256.625 1338.66,356.434 1341.02,500.342 1343.37,363.971 1345.72,308.471 1348.07,402.911 1350.42,457.54 1352.77,434.171 1355.12,406.807 1357.47,346.363 1359.82,307.945 1362.17,352.585 1364.52,458.927 1366.87,167.228 1369.22,290.65 1371.57,444.351 1373.92,532.194 1376.27,406.437 1378.62,613.478 1380.97,289.094 1383.32,446.129 1385.67,318.004 1388.02,610.007 1390.38,462.806 1392.73,360.776 1395.08,363.551 1397.43,528.216 1399.78,334.59 1402.13,354.029 1404.48,566.658 1406.83,575.107 1409.18,325.707 1411.53,361.944 1413.88,100.32 1416.23,554.776 1418.58,276.059 1420.93,458.259 1423.28,266.533 1425.63,371.77 1427.98,373.172 1430.33,285.28 1432.68,529.451 1435.03,442.617 1437.38,337.205 1439.74,441.695 1442.09,426.546 1444.44,371.429 1446.79,394.045 1449.14,416.533 1451.49,302.343 1453.84,243.316 1456.19,209.165 1458.54,166.058 1460.89,362.306 1463.24,198.368 1465.59,506.526 1467.94,469.495 1470.29,309.419 1472.64,410.652 1474.99,480.539 1477.34,456.82 1479.69,279.341 1482.04,453.919 1484.39,532.534 1486.74,506.484 1489.1,420.778 1491.45,348.008 1493.8,529.794 1496.15,434.443 1498.5,372.765 1500.85,619.574 1503.2,443.392 1505.55,412.65 1507.9,532.116 1510.25,518.421 1512.6,356.824 1514.95,439.887 1517.3,233.853 1519.65,322.158 1522,416.579 1524.35,222.845 1526.7,318.706 1529.05,347.97 1531.4,475.357 1533.75,244.365 1536.1,440.042 1538.45,296.724 1540.81,443.146 1543.16,310.959 1545.51,378.708 1547.86,484.843 1550.21,387.651 1552.56,267.02 1554.91,313.861 1557.26,336.539 1559.61,278.61 1561.96,468.154 1564.31,311.977 1566.66,377.35 1569.01,415.766 1571.36,512.767 1573.71,403.144 1576.06,339.347 1578.41,436.716 1580.76,321.694 1583.11,546.72 1585.46,432.341 1587.81,318.745 1590.17,263.163 1592.52,271.456 1594.87,265.253 1597.22,356.402 1599.57,304.545 1601.92,378.61 1604.27,237.342 1606.62,362.139 1608.97,487.506 1611.32,280.381 1613.67,378.271 1616.02,494.595 1618.37,431.303 1620.72,351.691 1623.07,211.405 1625.42,273.455 1627.77,535.55 1630.12,477.258 1632.47,346.315 1634.82,234.61 1637.17,342.739 1639.53,406.456 1641.88,341.098 1644.23,453.89 1646.58,274.406 1648.93,456.196 1651.28,469.17 1653.63,274.416 1655.98,353.326 1658.33,427.227 1660.68,451.97 1663.03,202.185 1665.38,146.293 1667.73,388.742 1670.08,538.761 1672.43,455.688 1674.78,506.273 1677.13,321.515 1679.48,320.663 1681.83,277.425 1684.18,338.981 1686.53,425.417 1688.89,458.776 1691.24,273.616 1693.59,449.537 1695.94,398.091 1698.29,478.925 1700.64,377.418 1702.99,412.137 1705.34,199.012 1707.69,331.828 1710.04,493.285 1712.39,320.604 1714.74,639.858 1717.09,341.105 1719.44,138.731 1721.79,259.999 1724.14,519.079 1726.49,369.874 1728.84,305.672 1731.19,582.759 1733.54,523.256 1735.89,385.833 1738.25,283.341 1740.6,512.709 1742.95,392.97 1745.3,286.52 1747.65,419.705 1750,343.707 1752.35,271.851 1754.7,367.085 1757.05,523.489 1759.4,398.405 1761.75,387.68 1764.1,490.503 1766.45,335.363 1768.8,369.948 1771.15,272.754 1773.5,249.461 1775.85,404.195 1778.2,452.95 1780.55,487.077 1782.9,508.151 1785.25,415.696 1787.6,132.997 1789.96,312.841 1792.31,237.609 1794.66,407.928 1797.01,299.221 1799.36,430.883 1801.71,313.948 1804.06,467.731 1806.41,332.145 1808.76,336.609 1811.11,333.278 1813.46,387.436 1815.81,376.773 1818.16,556.582 1820.51,354.192 1822.86,353.876 1825.21,280.486 1827.56,249.072 1829.91,363.999 1832.26,650.602 1834.61,374.6 1836.96,552.545 1839.32,414.538 1841.67,247.186 1844.02,416.013 1846.37,382.42 1848.72,556.894 1851.07,280.484 1853.42,401.02 1855.77,196.466 1858.12,539.593 1860.47,530.411 1862.82,495.142 1865.17,367.58 1867.52,312.06 1869.87,399.985 1872.22,463.594 1874.57,397.103 1876.92,570.311 1879.27,206.577 1881.62,381.665 1883.97,277.437 1886.32,270.818 1888.68,412.775 1891.03,399.481 1893.38,383.328 1895.73,617.852 1898.08,415.314 1900.43,358.345 1902.78,442.761 1905.13,365.893 1907.48,611.224 1909.83,303.585 1912.18,392.91 1914.53,264.573 1916.88,447.738 1919.23,387.674 1921.58,371.309 1923.93,472.025 1926.28,362.434 1928.63,574.174 1930.98,439.042 1933.33,478.175 1935.68,322.931 1938.04,521.748 1940.39,440.028 1942.74,430.328 1945.09,445.395 1947.44,139.375 1949.79,496.256 1952.14,332.175 1954.49,301.606 1956.84,308.934 1959.19,273.857 1961.54,248.345 1963.89,401.208 1966.24,614.811 1968.59,361.489 1970.94,399.161 1973.29,250.942 1975.64,389.212 1977.99,539.872 1980.34,551.967 1982.69,347.64 1985.04,160.214 1987.4,254.932 1989.75,473.704 1992.1,324.774 1994.45,494.864 1996.8,495.16 1999.15,453.882 2001.5,467.702 2003.85,449.684 2006.2,356.579 2008.55,418.243 2010.9,437.406 2013.25,475.687 2015.6,264.018 2017.95,399.611 2020.3,242.914 2022.65,479.686 2025,419.043 2027.35,383.979 2029.7,567.567 2032.05,461.809 2034.4,509.772 2036.76,518.877 2039.11,387.661 2041.46,488.117 2043.81,518.539 2046.16,327.01 2048.51,508.871 2050.86,322.476 2053.21,515.529 2055.56,335.627 2057.91,445.298 2060.26,601.117 2062.61,392.681 2064.96,267.499 2067.31,408.379 2069.66,301.574 2072.01,390.834 2074.36,527.074 2076.71,443.755 2079.06,426.533 2081.41,413.326 2083.76,340.459 2086.11,400.762 2088.47,340.612 2090.82,438.12 2093.17,319.165 2095.52,285.382 2097.87,426.615 2100.22,530.017 2102.57,426.275 2104.92,417.321 2107.27,389.298 2109.62,469.837 2111.97,344.418 2114.32,483.013 2116.67,393.02 2119.02,366.392 2121.37,364.121 2123.72,340.335 2126.07,501.021 2128.42,588.889 2130.77,364.381 2133.12,368.605 2135.47,491.347 2137.83,301.526 2140.18,510.084 2142.53,359.741 2144.88,667.545 2147.23,416.125 2149.58,565.929 2151.93,561.542 2154.28,262.434 2156.63,399.522 2158.98,355.497 2161.33,399.632 2163.68,158.785 2166.03,322.395 2168.38,333.275 2170.73,369.229 2173.08,411.891 2175.43,423.088 2177.78,329.343 2180.13,503.483 2182.48,316.817 2184.83,400.951 2187.19,375.922 2189.54,455.556 2191.89,448.665 2194.24,454.424 2196.59,437.981 2198.94,149.002 2201.29,468.017 2203.64,491.441 2205.99,389.884 2208.34,335.659 2210.69,473.733 2213.04,486.255 2215.39,296.114 2217.74,374.317 2220.09,309.728 2222.44,441.26 2224.79,281.071 2227.14,311.834 2229.49,423.127 2231.84,250.334 2234.19,312.708 2236.55,346.667 2238.9,476.716 2241.25,468.442 2243.6,403.684 2245.95,346.054 2248.3,419.612 2250.65,462.589 2253,422.634 2255.35,320.188 2257.7,509.551 2260.05,470.743 2262.4,431.229 2264.75,398.62 2267.1,361.728 2269.45,475.969 2271.8,267.053 2274.15,429.896 2276.5,415.561 2278.85,694.375 2281.2,264.985 2283.55,340.828 2285.91,621.957 2288.26,382.867 2290.61,511.365 2292.96,475.551 2295.31,297.948 2297.66,291.67 2300.01,293.712 2302.36,202.536 2304.71,214.766 2307.06,505.109 2309.41,471.463 2311.76,471.463 2314.11,330.386 2316.46,342.707 2318.81,474.15 2321.16,416.908 2323.51,192.171 2325.86,359.918 2328.21,369.599 2330.56,500.172 2332.91,410.685 2335.27,308.734 2337.62,306.188 2339.97,96.8724 2342.32,412.936 2344.67,512.9 2347.02,347.066 2349.37,226.994 2351.72,333.175 2354.07,580.95 2356.42,397.35 2358.77,368 2361.12,348.49 2363.47,526.436 2365.82,280.638 2368.17,432.787 2370.52,462.83 2372.87,364.351 2375.22,467.34 2377.57,391.027 2379.92,396.154 2382.27,412.639 2384.62,301.334 2386.98,412.721 2389.33,442.13 2391.68,560.49 2394.03,341.417 2396.38,200.697 2398.73,378.849 2401.08,363.311 2403.43,494.751 2405.78,377.183 2408.13,304.226 2410.48,394.379 2412.83,401.201 2415.18,262 2417.53,499.135 2419.88,542.828 2422.23,479.865 2424.58,484.9 2426.93,507.588 2429.28,393.926 2431.63,344.675 2433.98,379.799 2436.34,349.669 2438.69,399.28 2441.04,456.496 2443.39,411.784 2445.74,347.966 2448.09,349.047 2450.44,425.528 2452.79,228.41 2455.14,349.564 2457.49,211.861 2459.84,487.16 2462.19,491.607 2464.54,390.881 2466.89,510.986 2469.24,470.909 2471.59,553.843 2473.94,572.447 2476.29,570.056 2478.64,357.734 2480.99,422.659 2483.34,463.355 2485.7,564.849 2488.05,407.322 2490.4,495.893 2492.75,219.948 2495.1,484.614 2497.45,541.358 2499.8,394.424 2502.15,535.229 2504.5,357.158 2506.85,464.501 2509.2,579.255 2511.55,365.727 2513.9,400.447 2516.25,510.846 2518.6,531.085 2520.95,272.943 2523.3,546.27 2525.65,356.93 2528,269.54 2530.35,319.76 2532.7,367.201 2535.06,397.678 2537.41,424.608 2539.76,396.979 2542.11,395.534 2544.46,416.748 2546.81,439.362 2549.16,337.789 2551.51,335.819 2553.86,216.449 2556.21,577.825 2558.56,469.43 2560.91,325.003 2563.26,336.245 2565.61,218.866 2567.96,371.059 2570.31,323.435 "></polyline>
</svg>
</div>
</div>
<p>Look at that! Things are working; amazin’.</p>
<p>We can also exploit <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>’s parallel sampling capabilities:</p>
<div id="34" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run separate 4 chains for 10 000 iterations using threads to parallelize.</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>num_chains <span class="op">=</span> <span class="fl">4</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    model_with_grad,</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">MCMCThreads</span>(),</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>,</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    num_chains;</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Note we need to provide an initial state for every chain.</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>    initial_state<span class="op">=</span><span class="fu">fill</span>(state, num_chains),</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>samples_array <span class="op">=</span> <span class="fu">stack</span>(<span class="fu">map</span>(<span class="bu">Base</span>.<span class="fu">Fix1</span>(stack, sample <span class="op">-&gt;</span> sample.x), samples))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000×4 Array{Float64, 3}:
[:, :, 1] =
 -2.603     -3.81143  -4.6609    -4.89541   …  -3.78292  -5.31862   -6.24474
 -0.446892  -1.44232  -0.280076  -0.557188     -0.16151  -0.333608   0.531385
  0.456248   3.89946   3.99136    6.23592       5.28003   3.98277    3.4005

[:, :, 2] =
 -3.20641   -4.99904   -5.35386  -4.70729    …  -7.27908   -6.2628   -6.3029
 -0.606983  -0.370564  -1.10408  -0.0232518      0.110664  -1.27223   0.58269
  2.19       4.63777    6.09784   5.75612        6.05541    5.89328   3.20477

[:, :, 3] =
 -2.40647   -2.39412   -1.67128  -2.66309  …  -2.54398   -3.36344  -4.00354
  0.922054   0.702442  -1.47492  -1.24564      0.421741   1.03782   0.479973
  1.84361    2.77521    5.22252   5.67406      3.19886    3.16567   1.62579

[:, :, 4] =
 -3.17682   -3.03287   -2.50511   …  -5.99544   -4.69009   -4.37403
 -0.166777   0.294361   0.657333      0.376649   0.357646  -0.483028
  1.89007    1.87431    2.84241       5.15177    3.96909    4.17726</code></pre>
</div>
</div>
<p>But the fact that we have to provide the <code>AbstractMCMC.sample</code> call, etc. with an <code>initial_state</code> to get started is a bit annoying. We can avoid this by also defining a <code>AbstractMCMC.step</code> <em>without</em> the <code>state</code> argument:</p>
<div id="36" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">::</span><span class="dt">MALA</span>;</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># </span><span class="al">NOTE</span><span class="co">: No state provided!</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just create the initial state by sampling using  a Gaussian.</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="fu">randn</span>(rng, LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(x), <span class="fu">MALAState</span>(x)</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Equipped with this, we no longer need to provide the <code>initial_state</code> everywhere:</p>
<div id="38" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -4.98911    1.0045
  0.0198799  1.00798
  5.00119    0.989051</code></pre>
</div>
</div>
</section>
<section id="using-our-sampler-with-turing.jl" class="level2">
<h2 class="anchored" data-anchor-id="using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</h2>
<p>As we promised, all of this hassle of implementing our <code>MALA</code> sampler in a way that uses <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> and <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> gets us something more than <em>just</em> an “automatic” implementation of <code>AbstractMCMC.sample</code>.</p>
<p>It also enables use with Turing.jl through the <code>externalsampler</code>, but we need to do one final thing first: we need to tell Turing.jl how to extract a vector of parameters from the “sample” returned in our implementation of <code>AbstractMCMC.step</code>. In our case, the “sample” is a <code>MALASample</code>, so we just need the following line:</p>
<div id="40" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Turing</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">DynamicPPL</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Overload the `getparams` method for our "sample" type, which is just a vector.</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>Turing.Inference.<span class="fu">getparams</span>(<span class="op">::</span><span class="dt">DynamicPPL.Model</span>, sample<span class="op">::</span><span class="dt">MALASample</span>) <span class="op">=</span> sample.x</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And with that, we’re good to go!</p>
<div id="42" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Our previous model defined as a Turing.jl model.</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">mvnormal_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">MvNormal</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.], I)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate our model.</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">mvnormal_model</span>()</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Call `sample` but now we're passing in a Turing.jl `model` and wrapping</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co"># our `MALA` sampler in the `externalsampler` to tell Turing.jl that the sampler</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co"># expects something that implements LogDensityProblems.jl.</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×4×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 3.03 seconds
Compute duration  = 3.03 seconds
parameters        = x[1], x[2], x[3]
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters  </span><span class="ansi-bold">    mean  </span><span class="ansi-bold">     std  </span><span class="ansi-bold">    mcse  </span><span class="ansi-bold">  ess_bulk  </span><span class="ansi-bold">  ess_tail  </span><span class="ansi-bold">    rhat  </span><span class="ansi-bold"> ⋯
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">   Float64  </span><span class="ansi-bright-black-fg ansi-bold">   Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> ⋯

        x[1]   -4.9978    1.0084    0.0174   3349.2692   5241.4029    1.0000   ⋯
        x[2]    0.0107    1.0074    0.0174   3344.2863   4723.7797    1.0016   ⋯
        x[3]    5.0182    1.0114    0.0183   3050.5736   4885.9189    1.0001   ⋯
</span><span class="ansi-cyan-fg ansi-bold">                                                                1 column omitted

Quantiles
 </span><span class="ansi-cyan-fg ansi-bold"> parameters  </span><span class="ansi-cyan-fg ansi-bold">    2.5%  </span><span class="ansi-cyan-fg ansi-bold">   25.0%  </span><span class="ansi-cyan-fg ansi-bold">   50.0%  </span><span class="ansi-cyan-fg ansi-bold">   75.0%  </span><span class="ansi-cyan-fg ansi-bold">   97.5%
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64

        x[1]   -6.9670   -5.6692   -4.9986   -4.3188   -3.0422
        x[2]   -1.9483   -0.6652    0.0025    0.6888    2.0194
        x[3]    3.0308    4.3328    5.0295    5.6888    7.0487
</span></pre>
</div>
</div>
</div>
<p>Pretty neat, eh?</p>
<section id="models-with-constrained-parameters" class="level3">
<h3 class="anchored" data-anchor-id="models-with-constrained-parameters">Models with constrained parameters</h3>
<p>One thing we’ve sort of glossed over in all of the above is that MALA, at least how we’ve implemented it, requires <span class="math inline">\(x\)</span> to live in <span class="math inline">\(\mathbb{R}^d\)</span> for some <span class="math inline">\(d &gt; 0\)</span>. If some of the parameters were in fact constrained, e.g.&nbsp;we were working with a <code>Beta</code> distribution which has support on the interval <span class="math inline">\((0, 1)\)</span>, <em>not</em> on <span class="math inline">\(\mathbb{R}^d\)</span>, we could easily end up outside of the valid range <span class="math inline">\((0, 1)\)</span>.</p>
<div id="44" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">beta_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">beta_model</span>()</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 1.79 seconds
Compute duration  = 1.79 seconds
parameters        = x
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters  </span><span class="ansi-bold">    mean  </span><span class="ansi-bold">     std  </span><span class="ansi-bold">    mcse  </span><span class="ansi-bold">  ess_bulk  </span><span class="ansi-bold">  ess_tail  </span><span class="ansi-bold">    rhat  </span><span class="ansi-bold"> ⋯
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">   Float64  </span><span class="ansi-bright-black-fg ansi-bold">   Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> ⋯

           x    0.4985    0.1879    0.0028   4496.9288   5563.6941    1.0004   ⋯
</span><span class="ansi-cyan-fg ansi-bold">                                                                1 column omitted

Quantiles
 </span><span class="ansi-cyan-fg ansi-bold"> parameters  </span><span class="ansi-cyan-fg ansi-bold">    2.5%  </span><span class="ansi-cyan-fg ansi-bold">   25.0%  </span><span class="ansi-cyan-fg ansi-bold">   50.0%  </span><span class="ansi-cyan-fg ansi-bold">   75.0%  </span><span class="ansi-cyan-fg ansi-bold">   97.5%
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64

           x    0.1439    0.3594    0.5001    0.6364    0.8492
</span></pre>
</div>
</div>
</div>
<p>Yep, that still works, but only because Turing.jl actually <em>transforms</em> the <code>turing_model</code> from constrained to unconstrained, so that the <code>sampler</code> provided to <code>externalsampler</code> is actually always working in unconstrained space! This is not always desirable, so we can turn this off:</p>
<div id="46" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 0.19 seconds
Compute duration  = 0.19 seconds
parameters        = x
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters  </span><span class="ansi-bold">    mean  </span><span class="ansi-bold">     std  </span><span class="ansi-bold">    mcse  </span><span class="ansi-bold"> ess_bulk  </span><span class="ansi-bold"> ess_tail  </span><span class="ansi-bold">    rhat  </span><span class="ansi-bold"> e ⋯
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">  Float64  </span><span class="ansi-bright-black-fg ansi-bold">  Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">   ⋯

           x    0.4644    0.1564    0.0165    80.9338    28.8433    1.0545     ⋯
</span><span class="ansi-cyan-fg ansi-bold">                                                                1 column omitted

Quantiles
 </span><span class="ansi-cyan-fg ansi-bold"> parameters  </span><span class="ansi-cyan-fg ansi-bold">    2.5%  </span><span class="ansi-cyan-fg ansi-bold">   25.0%  </span><span class="ansi-cyan-fg ansi-bold">   50.0%  </span><span class="ansi-cyan-fg ansi-bold">   75.0%  </span><span class="ansi-cyan-fg ansi-bold">   97.5%
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64

           x    0.2030    0.3372    0.4704    0.5866    0.7353
</span></pre>
</div>
</div>
</div>
<p>The fun thing is that this still sort of works because</p>
<div id="48" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">logpdf</span>(<span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>), <span class="fl">10.0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-Inf</code></pre>
</div>
</div>
<p>and so the samples that fall outside of the range are always rejected. But do notice how much worse all the diagnostics are, e.g.&nbsp;<code>ess_tail</code> is very poor compared to when we use <code>unconstrained=true</code>. Moreover, in more complex cases this won’t just result in a “nice” <code>-Inf</code> log-density value, but instead will error:</p>
<div id="50" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="kw">function</span> <span class="fu">demo</span>()</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>    σ² <span class="op">~</span> <span class="fu">truncated</span>(<span class="fu">Normal</span>(), lower<span class="op">=</span><span class="fl">0</span>)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If we end up with negative values for `σ²`, the `Normal` will error.</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>    x <span class="op">~</span> <span class="fu">Normal</span>(<span class="fl">0</span>, σ²)</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre>DomainError with -0.20629127461582367:
Normal: the condition σ &gt;= zero(σ) is not satisfied.
Stacktrace:
  [1] <span class="ansi-bold">#371</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/YQSrn/src/univariate/continuous/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">normal.jl:37</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [2] <span class="ansi-bold">check_args</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/YQSrn/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">utils.jl:89</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [3] <span class="ansi-bold">#Normal#370</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/YQSrn/src/univariate/continuous/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">normal.jl:37</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [4] <span class="ansi-bold">Normal</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/YQSrn/src/univariate/continuous/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">normal.jl:36</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [5] <span class="ansi-bold">Normal</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/YQSrn/src/univariate/continuous/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">normal.jl:42</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [6] <span class="ansi-bold">macro expansion</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/nxcz4/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">compiler.jl:558</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [7] <span class="ansi-bold">demo</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">__model__</span>::Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DefaultContext}</span>, <span class="ansi-bright-black-fg">__varinfo__</span>::DynamicPPL.ThreadSafeVarInfo<span class="ansi-bright-black-fg">{VarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}, Vector{Base.RefValue{Float64}}}</span>, <span class="ansi-bright-black-fg">__context__</span>::DynamicPPL.ValuesAsInModelContext<span class="ansi-bright-black-fg">{DefaultContext}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-magenta-fg">Main.Notebook</span> <span class="ansi-bright-black-fg">~/work/docs/docs/developers/inference/implementing-samplers/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">index.qmd:457</span>
  [8] <span class="ansi-bold">_evaluate!!</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/nxcz4/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">model.jl:913</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [9] <span class="ansi-bold">evaluate_threadsafe!!</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">model</span>::Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DefaultContext}</span>, <span class="ansi-bright-black-fg">varinfo</span>::VarInfo<span class="ansi-bright-black-fg">{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}</span>, <span class="ansi-bright-black-fg">context</span>::DynamicPPL.ValuesAsInModelContext<span class="ansi-bright-black-fg">{DefaultContext}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-cyan-fg">DynamicPPL</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/nxcz4/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">model.jl:902</span>
 [10] <span class="ansi-bold">evaluate!!</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/nxcz4/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">model.jl:832</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [11] <span class="ansi-bold">values_as_in_model</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/nxcz4/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">values_as_in_model.jl:173</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [12] <span class="ansi-bold">values_as_in_model</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/nxcz4/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">values_as_in_model.jl:172</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [13] <span class="ansi-bold">getparams</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">model</span>::Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DefaultContext}</span>, <span class="ansi-bright-black-fg">vi</span>::VarInfo<span class="ansi-bright-black-fg">{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-green-fg">Turing.Inference</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/1gxqi/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">Inference.jl:179</span>
 [14] <span class="ansi-bold">Turing.Inference.Transition</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">model</span>::Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DefaultContext}</span>, <span class="ansi-bright-black-fg">vi</span>::VarInfo<span class="ansi-bright-black-fg">{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}</span>, <span class="ansi-bright-black-fg">t</span>::MALASample<span class="ansi-bright-black-fg">{Vector{Float64}}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-green-fg">Turing.Inference</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/1gxqi/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">Inference.jl:141</span>
 [15] <span class="ansi-bold">transition_to_turing</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">f</span>::LogDensityFunction<span class="ansi-bright-black-fg">{Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DefaultContext}, VarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}, DefaultContext, AutoForwardDiff{2, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}}}</span>, <span class="ansi-bright-black-fg">transition</span>::MALASample<span class="ansi-bright-black-fg">{Vector{Float64}}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-green-fg">Turing.Inference</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/1gxqi/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">external_sampler.jl:82</span>
 [16] <span class="ansi-bold">step</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">rng</span>::TaskLocalRNG, <span class="ansi-bright-black-fg">model</span>::Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DefaultContext}</span>, <span class="ansi-bright-black-fg">sampler_wrapper</span>::Sampler<span class="ansi-bright-black-fg">{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}</span>; <span class="ansi-bright-black-fg">initial_state</span>::Nothing, <span class="ansi-bright-black-fg">initial_params</span>::Nothing, <span class="ansi-bright-black-fg">kwargs</span>::@Kwargs<span class="ansi-bright-black-fg">{}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-green-fg">Turing.Inference</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/1gxqi/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">external_sampler.jl:147</span>
 [17] <span class="ansi-bold">macro expansion</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/AbstractMCMC/F50rb/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">sample.jl:0</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [18] <span class="ansi-bold">macro expansion</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/AbstractMCMC/F50rb/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">logging.jl:16</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [19] <span class="ansi-bold">mcmcsample</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">rng</span>::TaskLocalRNG, <span class="ansi-bright-black-fg">model</span>::Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DefaultContext}</span>, <span class="ansi-bright-black-fg">sampler</span>::Sampler<span class="ansi-bright-black-fg">{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}</span>, <span class="ansi-bright-black-fg">N</span>::Int64; <span class="ansi-bright-black-fg">progress</span>::Bool, <span class="ansi-bright-black-fg">progressname</span>::String, <span class="ansi-bright-black-fg">callback</span>::Nothing, <span class="ansi-bright-black-fg">num_warmup</span>::Int64, <span class="ansi-bright-black-fg">discard_initial</span>::Int64, <span class="ansi-bright-black-fg">thinning</span>::Int64, <span class="ansi-bright-black-fg">chain_type</span>::Type, <span class="ansi-bright-black-fg">initial_state</span>::Nothing, <span class="ansi-bright-black-fg">kwargs</span>::@Kwargs<span class="ansi-bright-black-fg">{}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-yellow-fg">AbstractMCMC</span> <span class="ansi-bright-black-fg">~/.julia/packages/AbstractMCMC/F50rb/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">sample.jl:144</span>
 [20] <span class="ansi-bold">sample</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">rng</span>::TaskLocalRNG, <span class="ansi-bright-black-fg">model</span>::Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DefaultContext}</span>, <span class="ansi-bright-black-fg">sampler</span>::Sampler<span class="ansi-bright-black-fg">{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}</span>, <span class="ansi-bright-black-fg">N</span>::Int64; <span class="ansi-bright-black-fg">chain_type</span>::Type, <span class="ansi-bright-black-fg">resume_from</span>::Nothing, <span class="ansi-bright-black-fg">initial_state</span>::Nothing, <span class="ansi-bright-black-fg">kwargs</span>::@Kwargs<span class="ansi-bright-black-fg">{progress::Bool}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-cyan-fg">DynamicPPL</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/nxcz4/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">sampler.jl:102</span>
 [21] <span class="ansi-bold">sample</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/nxcz4/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">sampler.jl:92</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [22] <span class="ansi-bold">#sample#101</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/1gxqi/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">abstractmcmc.jl:29</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [23] <span class="ansi-bold">sample</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/1gxqi/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">abstractmcmc.jl:20</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [24] <span class="ansi-bold">#sample#100</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/1gxqi/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">abstractmcmc.jl:17</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [25] top-level scope
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/work/docs/docs/developers/inference/implementing-samplers/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">index.qmd:459</span></pre>
</div>
</div>
</div>
<p>As expected, we run into a <code>DomainError</code> at some point, while if we set <code>unconstrained=true</code>, letting Turing.jl transform the model to a unconstrained form behind the scenes, everything works as expected:</p>
<div id="52" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 1.96 seconds
Compute duration  = 1.96 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters  </span><span class="ansi-bold">    mean  </span><span class="ansi-bold">     std  </span><span class="ansi-bold">    mcse  </span><span class="ansi-bold"> ess_bulk  </span><span class="ansi-bold"> ess_tail  </span><span class="ansi-bold">    rhat  </span><span class="ansi-bold"> e ⋯
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">  Float64  </span><span class="ansi-bright-black-fg ansi-bold">  Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">   ⋯

          σ²    0.8094    0.5893    0.0532    68.7842    23.4246    1.0189     ⋯
           x   -0.0261    0.9933    0.0605   336.3052   302.7292    1.0252     ⋯
</span><span class="ansi-cyan-fg ansi-bold">                                                                1 column omitted

Quantiles
 </span><span class="ansi-cyan-fg ansi-bold"> parameters  </span><span class="ansi-cyan-fg ansi-bold">    2.5%  </span><span class="ansi-cyan-fg ansi-bold">   25.0%  </span><span class="ansi-cyan-fg ansi-bold">   50.0%  </span><span class="ansi-cyan-fg ansi-bold">   75.0%  </span><span class="ansi-cyan-fg ansi-bold">   97.5%
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64

          σ²    0.1114    0.3096    0.6917    1.1790    2.1898
           x   -2.1742   -0.3920   -0.0786    0.3660    2.2694
</span></pre>
</div>
</div>
</div>
<p>Neat!</p>
<p>Similarly, which automatic differentiation backend one should use can be specified through the <code>adtype</code> keyword argument too. For example, if we want to use <a href="https://github.com/JuliaDiff/ReverseDiff.jl">ReverseDiff.jl</a> instead of the default <a href="https://github.com/JuliaDiff/ForwardDiff.jl">ForwardDiff.jl</a>:</p>
<div id="54" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">ReverseDiff</span>: ReverseDiff</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify that we want to use `AutoReverseDiff`.</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">demo</span>(),</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>, adtype<span class="op">=</span><span class="fu">AutoReverseDiff</span>()),</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>;</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 3.02 seconds
Compute duration  = 3.02 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters  </span><span class="ansi-bold">    mean  </span><span class="ansi-bold">     std  </span><span class="ansi-bold">    mcse  </span><span class="ansi-bold"> ess_bulk  </span><span class="ansi-bold"> ess_tail  </span><span class="ansi-bold">    rhat  </span><span class="ansi-bold"> e ⋯
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">  Float64  </span><span class="ansi-bright-black-fg ansi-bold">  Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">   ⋯

          σ²    0.8437    0.5733    0.0292   237.0601   111.2775    1.0052     ⋯
           x    0.0042    0.9533    0.0445   567.2425   434.1484    1.0065     ⋯
</span><span class="ansi-cyan-fg ansi-bold">                                                                1 column omitted

Quantiles
 </span><span class="ansi-cyan-fg ansi-bold"> parameters  </span><span class="ansi-cyan-fg ansi-bold">    2.5%  </span><span class="ansi-cyan-fg ansi-bold">   25.0%  </span><span class="ansi-cyan-fg ansi-bold">   50.0%  </span><span class="ansi-cyan-fg ansi-bold">   75.0%  </span><span class="ansi-cyan-fg ansi-bold">   97.5%
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64

          σ²    0.1022    0.3724    0.7334    1.1713    2.2241
           x   -2.0721   -0.4315    0.0166    0.4367    2.3111
</span></pre>
</div>
</div>
</div>
<p>Double-neat.</p>
</section>
</section>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<p>At this point it’s worth maybe reminding ourselves what we did and also <em>why</em> we did it:</p>
<ol type="1">
<li>We define our models in the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface because it makes the sampler agnostic to how the underlying model is implemented.</li>
<li>We implement our sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> interface, which just means that our sampler is a subtype of <code>AbstractMCMC.AbstractSampler</code> and we implement the MCMC transition in <code>AbstractMCMC.step</code>.</li>
<li>Points 1 and 2 makes it so our sampler can be used with a wide range of model implementations, amongst them being models implemented in both Turing.jl and Stan. This gives you, the inference implementer, a large collection of models to test your inference method on, in addition to allowing users of Turing.jl and Stan to try out your inference method with minimal effort.</li>
</ol>


</section>


<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a><div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>We’re going with the leapfrog formulation because in a future version of this tutorial we’ll add a section extending this simple “baseline” MALA sampler to more complex versions. See <a href="https://github.com/TuringLang/docs/issues/479">issue #479</a> for progress on this.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>There is no such thing as a proper interface in Julia (at least not officially), and so we use the word “interface” here to mean a few minimal methods that needs to be implemented by any type that we treat as a target model.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    // Ensure there is a toggle, if there isn't float one in the top right
    if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
      const a = window.document.createElement('a');
      a.classList.add('top-right');
      a.classList.add('quarto-color-scheme-toggle');
      a.href = "";
      a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
      const i = window.document.createElement("i");
      i.classList.add('bi');
      a.appendChild(i);
      window.document.body.appendChild(a);
    }
    setColorSchemeToggle(hasAlternateSentinel())
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/turinglang\.org\/docs\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../../developers/inference/variational-inference/index.html" class="pagination-link" aria-label="Variational Inference">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Variational Inference</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Turing is created by <a href="http://mlg.eng.cam.ac.uk/hong/" target="_blank">Hong Ge</a>, and lovingly maintained by the <a href="https://github.com/TuringLang/Turing.jl/graphs/contributors" target="_blank">core team</a> of volunteers. <br> The contents of this website are © 2018–2025 under the terms of the <a href="https://github.com/TuringLang/docs/blob/main/LICENCE" target="_blank">MIT License</a>.</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/TuringLang/docs/edit/main/developers/inference/implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/docs/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://x.com/TuringLang">
      <i class="bi bi-twitter" role="img" aria-label="Turing Twitter">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/TuringLang/Turing.jl">
      <i class="bi bi-github" role="img" aria-label="Turing GitHub">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




<script src="../../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>