<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Implementing Samplers – Turing.jl</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<link href="../../../developers/inference/variational-inference/index.html" rel="prev">
<link href="../../../assets/favicon.ico" rel="icon">
<script src="../../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-dark-2fef5ea3f8957b3e4ecc936fc74692ca.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap-a98ec624fb63d9b712fc3a6f62e2b305.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../../site_libs/bootstrap/bootstrap-dark-c480b84dfacb3218d5361005d2868267.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="../../../site_libs/bootstrap/bootstrap-a98ec624fb63d9b712fc3a6f62e2b305.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<style>
  a {
    text-decoration: none;
  }
  a:hover {
    text-decoration: underline;
  }
</style>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../../theming/styles.css">
</head>

<body class="nav-sidebar floating nav-fixed quarto-light"><script id="quarto-html-before-body" type="application/javascript">
    const toggleBodyColorMode = (bsSheetEl) => {
      const mode = bsSheetEl.getAttribute("data-mode");
      const bodyEl = window.document.querySelector("body");
      if (mode === "dark") {
        bodyEl.classList.add("quarto-dark");
        bodyEl.classList.remove("quarto-light");
      } else {
        bodyEl.classList.add("quarto-light");
        bodyEl.classList.remove("quarto-dark");
      }
    }
    const toggleBodyColorPrimary = () => {
      const bsSheetEl = window.document.querySelector("link#quarto-bootstrap:not([rel=disabled-stylesheet])");
      if (bsSheetEl) {
        toggleBodyColorMode(bsSheetEl);
      }
    }
    const setColorSchemeToggle = (alternate) => {
      const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
      for (let i=0; i < toggles.length; i++) {
        const toggle = toggles[i];
        if (toggle) {
          if (alternate) {
            toggle.classList.add("alternate");
          } else {
            toggle.classList.remove("alternate");
          }
        }
      }
    };
    const toggleColorMode = (alternate) => {
      // Switch the stylesheets
      const primaryStylesheets = window.document.querySelectorAll('link.quarto-color-scheme:not(.quarto-color-alternate)');
      const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
      manageTransitions('#quarto-margin-sidebar .nav-link', false);
      if (alternate) {
        // note: dark is layered on light, we don't disable primary!
        enableStylesheet(alternateStylesheets);
        for (const sheetNode of alternateStylesheets) {
          if (sheetNode.id === "quarto-bootstrap") {
            toggleBodyColorMode(sheetNode);
          }
        }
      } else {
        disableStylesheet(alternateStylesheets);
        enableStylesheet(primaryStylesheets)
        toggleBodyColorPrimary();
      }
      manageTransitions('#quarto-margin-sidebar .nav-link', true);
      // Switch the toggles
      setColorSchemeToggle(alternate)
      // Hack to workaround the fact that safari doesn't
      // properly recolor the scrollbar when toggling (#1455)
      if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
        manageTransitions("body", false);
        window.scrollTo(0, 1);
        setTimeout(() => {
          window.scrollTo(0, 0);
          manageTransitions("body", true);
        }, 40);
      }
    }
    const disableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        stylesheet.rel = 'disabled-stylesheet';
      }
    }
    const enableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        if(stylesheet.rel !== 'stylesheet') { // for Chrome, which will still FOUC without this check
          stylesheet.rel = 'stylesheet';
        }
      }
    }
    const manageTransitions = (selector, allowTransitions) => {
      const els = window.document.querySelectorAll(selector);
      for (let i=0; i < els.length; i++) {
        const el = els[i];
        if (allowTransitions) {
          el.classList.remove('notransition');
        } else {
          el.classList.add('notransition');
        }
      }
    }
    const isFileUrl = () => {
      return window.location.protocol === 'file:';
    }
    const hasAlternateSentinel = () => {
      let styleSentinel = getColorSchemeSentinel();
      if (styleSentinel !== null) {
        return styleSentinel === "alternate";
      } else {
        return false;
      }
    }
    const setStyleSentinel = (alternate) => {
      const value = alternate ? "alternate" : "default";
      if (!isFileUrl()) {
        window.localStorage.setItem("quarto-color-scheme", value);
      } else {
        localAlternateSentinel = value;
      }
    }
    const getColorSchemeSentinel = () => {
      if (!isFileUrl()) {
        const storageValue = window.localStorage.getItem("quarto-color-scheme");
        return storageValue != null ? storageValue : localAlternateSentinel;
      } else {
        return localAlternateSentinel;
      }
    }
    const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
      const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
      const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
      let newTheme = '';
      if(authorPrefersDark) {
        newTheme = isAlternate ? baseTheme : alternateTheme;
      } else {
        newTheme = isAlternate ? alternateTheme : baseTheme;
      }
      const changeGiscusTheme = () => {
        // From: https://github.com/giscus/giscus/issues/336
        const sendMessage = (message) => {
          const iframe = document.querySelector('iframe.giscus-frame');
          if (!iframe) return;
          iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
        }
        sendMessage({
          setConfig: {
            theme: newTheme
          }
        });
      }
      const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
      if (isGiscussLoaded) {
        changeGiscusTheme();
      }
    };
    const authorPrefersDark = false;
    const darkModeDefault = authorPrefersDark;
      document.querySelector('link#quarto-text-highlighting-styles.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
      document.querySelector('link#quarto-bootstrap.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
    let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
    // Dark / light mode switch
    window.quartoToggleColorScheme = () => {
      // Read the current dark / light value
      let toAlternate = !hasAlternateSentinel();
      toggleColorMode(toAlternate);
      setStyleSentinel(toAlternate);
      toggleGiscusIfUsed(toAlternate, darkModeDefault);
      window.dispatchEvent(new Event('resize'));
    };
    // Switch to dark mode if need be
    if (hasAlternateSentinel()) {
      toggleColorMode(true);
    } else {
      toggleColorMode(false);
    }
  </script>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="https://turinglang.org/" class="navbar-brand navbar-brand-logo">
    <img src="../../../assets/images/turing-logo.svg" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="https://turinglang.org/">
    <span class="navbar-title">Turing.jl</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../getting-started/"> 
<span class="menu-text">Get Started</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../tutorials/coin-flipping/"> 
<span class="menu-text">Tutorials</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/library/"> 
<span class="menu-text">Libraries</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/news/"> 
<span class="menu-text">News</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/team/"> 
<span class="menu-text">Team</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-v0.39" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">v0.39</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-v0.39">    
        <li>
    <a class="dropdown-item" href="https://turinglang.org/docs/changelog.html">
 <span class="dropdown-text">Changelog</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://turinglang.org/docs/versions.html">
 <span class="dropdown-text">All Versions</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools tools-wide">
    <a href="https://x.com/TuringLang" title="Turing Twitter" class="quarto-navigation-tool px-1" aria-label="Turing Twitter"><i class="bi bi-twitter"></i></a>
    <a href="https://github.com/TuringLang" title="Turing GitHub" class="quarto-navigation-tool px-1" aria-label="Turing GitHub"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../../developers/contributing/index.html">Developers</a></li><li class="breadcrumb-item"><a href="../../../developers/inference/variational-inference/index.html">Inference in Detail</a></li><li class="breadcrumb-item"><a href="../../../developers/inference/implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../getting-started/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Getting Started</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../core-functionality/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Core Functionality</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false">
 <span class="menu-text">User Guide</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/automatic-differentiation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Automatic Differentiation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/custom-distribution/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Custom Distributions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/probability-interface/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Querying Model Probabilities</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/modifying-logprob/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Modifying the Log Probability</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/tracking-extra-quantities/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Tracking Extra Quantities</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/mode-estimation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Mode Estimation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/performance-tips/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Performance Tips</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/sampler-visualisation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Sampler Visualization</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/dynamichmc/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using DynamicHMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/external-samplers/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using External Samplers</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/troubleshooting/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Troubleshooting</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false">
 <span class="menu-text">Tutorials</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/coin-flipping/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction: Coin Flipping</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/gaussian-mixture-models/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Mixture Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-neural-networks/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Neural Networks</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/hidden-markov-models/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Hidden Markov Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-linear-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Linear Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/infinite-mixture-models/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Infinite Mixture Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-poisson-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Poisson Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/multinomial-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Multinomial Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-differential-equations/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Differential Equations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/probabilistic-pca/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Probabilistic PCA</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-time-series-analysis/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Time Series Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/gaussian-processes-introduction/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Processes: Introduction</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/gaussian-process-latent-variable-models/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Process Latent Variable Models</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Developers</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/contributing/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Contributing</span></a>
  </div>
</li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false">
 <span class="menu-text">DynamicPPL’s Compiler</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/compiler/model-manual/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Manually Defining a Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/compiler/minituring-compiler/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation I: Compiler</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/compiler/minituring-contexts/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation II: Contexts</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/compiler/design-overview/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Turing Compiler Design (Outdated)</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false">
 <span class="menu-text">DynamicPPL Contexts</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/contexts/submodel-condition/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Conditioning and fixing in submodels</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="false">
 <span class="menu-text">Variable Transformations</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/transforms/distributions/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Distributions and the Jacobian</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/transforms/bijectors/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bijectors in MCMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/transforms/dynamicppl/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variable transformations in DynamicPPL</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true">
 <span class="menu-text">Inference in Detail</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/inference/variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/inference/implementing-samplers/index.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Implementing Samplers</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of Contents</h2>
   
  <ul>
  <li><a href="#quick-overview-of-mala" id="toc-quick-overview-of-mala" class="nav-link active" data-scroll-target="#quick-overview-of-mala">Quick overview of MALA</a></li>
  <li><a href="#what-we-need-from-a-model-logdensityproblems.jl" id="toc-what-we-need-from-a-model-logdensityproblems.jl" class="nav-link" data-scroll-target="#what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: LogDensityProblems.jl</a></li>
  <li><a href="#implementing-mala-in-abstractmcmc.jl" id="toc-implementing-mala-in-abstractmcmc.jl" class="nav-link" data-scroll-target="#implementing-mala-in-abstractmcmc.jl">Implementing MALA in AbstractMCMC.jl</a></li>
  <li><a href="#using-our-sampler-with-turing.jl" id="toc-using-our-sampler-with-turing.jl" class="nav-link" data-scroll-target="#using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</a>
  <ul class="collapse">
  <li><a href="#models-with-constrained-parameters" id="toc-models-with-constrained-parameters" class="nav-link" data-scroll-target="#models-with-constrained-parameters">Models with constrained parameters</a></li>
  </ul></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/TuringLang/docs/edit/main/developers/inference/implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/docs/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">


<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../../developers/contributing/index.html">Developers</a></li><li class="breadcrumb-item"><a href="../../../developers/inference/variational-inference/index.html">Inference in Detail</a></li><li class="breadcrumb-item"><a href="../../../developers/inference/implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Implementing Samplers</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>In this tutorial, we’ll go through step-by-step how to implement a “simple” sampler in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> in such a way that it can be easily applied to Turing.jl models.</p>
<p>In particular, we’re going to implement a version of <strong>Metropolis-adjusted Langevin (MALA)</strong>.</p>
<p>Note that we will implement this sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> framework, completely “ignoring” Turing.jl until the very end of the tutorial, at which point we’ll use a single line of code to make the resulting sampler available to Turing.jl. This is to really drive home the point that one can implement samplers in a way that is accessible to all of Turing.jl’s users without having to use Turing.jl yourself.</p>
<section id="quick-overview-of-mala" class="level2">
<h2 class="anchored" data-anchor-id="quick-overview-of-mala">Quick overview of MALA</h2>
<p>We can view MALA as a single step of the leapfrog intergrator with resampling of momentum <span class="math inline">\(p\)</span> at every step.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> To make that statement a bit more concrete, we first define the <em>extended</em> target <span class="math inline">\(\bar{\gamma}(x, p)\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\log \bar{\gamma}(x, p) \propto \log \gamma(x) + \log \gamma_{\mathcal{N}(0, M)}(p)
\end{equation*}\]</span></p>
<p>where <span class="math inline">\(\gamma_{\mathcal{N}(0, M)}\)</span> denotes the density for a zero-centered Gaussian with covariance matrix <span class="math inline">\(M\)</span>. We then consider targeting this joint distribution over both <span class="math inline">\(x\)</span> and <span class="math inline">\(p\)</span> as follows. First we define the map</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  L_{\epsilon}: \quad &amp; \mathbb{R}^d \times \mathbb{R}^d \to \mathbb{R}^d \times \mathbb{R}^d \\
  &amp; (x, p) \mapsto (\tilde{x}, \tilde{p}) := L_{\epsilon}(x, p)
\end{split}
\end{equation*}\]</span></p>
<p>as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p_{1 / 2} &amp;:= p + \frac{\epsilon}{2} \nabla \log \gamma(x) \\
  \tilde{x} &amp;:= x + \epsilon M^{-1} p_{1 /2 } \\
  p_1 &amp;:= p_{1 / 2} + \frac{\epsilon}{2} \nabla \log \gamma(\tilde{x}) \\
  \tilde{p} &amp;:= - p_1
\end{split}
\end{equation*}\]</span></p>
<p>This might be familiar for some readers as a single step of the Leapfrog integrator. We then define the MALA kernel as follows: given the current iterate <span class="math inline">\(x_i\)</span>, we sample the next iterate <span class="math inline">\(x_{i + 1}\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p &amp;\sim \mathcal{N}(0, M) \\
  (\tilde{x}, \tilde{p}) &amp;:= L_{\epsilon}(x_i, p) \\
  \alpha &amp;:= \min \left\{ 1, \frac{\bar{\gamma}(\tilde{x}, \tilde{p})}{\bar{\gamma}(x_i, p)} \right\} \\
  x_{i + 1} &amp;:=
  \begin{cases}
    \tilde{x} \quad &amp; \text{ with prob. } \alpha \\
    x_i       \quad &amp; \text{ with prob. } 1 - \alpha
  \end{cases}
\end{split}
\end{equation*}\]</span></p>
<p>i.e.&nbsp;we accept the proposal <span class="math inline">\(\tilde{x}\)</span> with probability <span class="math inline">\(\alpha\)</span> and reject it, thus sticking with our current iterate, with probability <span class="math inline">\(1 - \alpha\)</span>.</p>
</section>
<section id="what-we-need-from-a-model-logdensityproblems.jl" class="level2">
<h2 class="anchored" data-anchor-id="what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a></h2>
<p>There are a few things we need from the “target” / “model” / density that we want to sample from:</p>
<ol type="1">
<li>We need access to log-density <em>evaluations</em> <span class="math inline">\(\log \gamma(x)\)</span> so we can compute the acceptance ratio involving <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>We need access to log-density <em>gradients</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span> so we can compute the Leapfrog steps <span class="math inline">\(L_{\epsilon}(x, p)\)</span>.</li>
<li>We also need access to the “size” of the model so we can determine the size of <span class="math inline">\(M\)</span>.</li>
</ol>
<p>Luckily for us, there is a package called <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> which provides an interface for <em>exactly</em> this!</p>
<p>To demonstrate how one can implement the “<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface”<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> we will use a simple Gaussian model as an example:</p>
<div id="4" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblems</span>: LogDensityProblems;</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's define some type that represents the model.</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> IsotropicNormalModel{M<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"mean of the isotropic Gaussian"</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    mean<span class="op">::</span><span class="dt">M</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Specifies what input length the model expects.</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">dimension</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> <span class="fu">length</span>(model.mean)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Implementation of the log-density evaluation of the model.</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x<span class="op">::</span><span class="dt">AbstractVector{&lt;:Real}</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">-</span> <span class="fu">sum</span>(abs2, x <span class="op">.-</span> model.mean) <span class="op">/</span> <span class="fl">2</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This gives us all of the properties we want for our MALA sampler with the exception of the computation of the <em>gradient</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span>. There is the method <code>LogDensityProblems.logdensity_and_gradient</code> which should return a 2-tuple where the first entry is the evaluation of the logdensity <span class="math inline">\(\log \gamma(x)\)</span> and the second entry is the gradient <span class="math inline">\(\nabla \log \gamma(x)\)</span>.</p>
<p>There are two ways to “implement” this method: 1) we implement it by hand, which is feasible in the case of our <code>IsotropicNormalModel</code>, or b) we defer the implementation of this to a automatic differentiation backend.</p>
<p>To implement it by hand we can simply do</p>
<div id="6" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl that first-order, i.e. gradient information, is available.</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{1}</span>()</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Implement `logdensity_and_gradient`.</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    logγ_x <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="op">-</span>x <span class="op">.*</span> (x <span class="op">-</span> model.mean)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> logγ_x, ∇logγ_x</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s just try it out:</p>
<div id="8" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate the problem.</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> <span class="fu">IsotropicNormalModel</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.])</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create some example input that we can test on.</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>x_example <span class="op">=</span> <span class="fu">randn</span>(LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate!</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-24.717020934684665</code></pre>
</div>
</div>
<p>To defer it to an automatic differentiation backend, we can do</p>
<div id="10" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl we only have access to 0-th order information.</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{0}</span>()</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Use `LogDensityProblemsAD`'s `ADgradient` in combination with some AD backend to implement `logdensity_and_gradient`.</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblemsAD</span>, <span class="bu">ADTypes</span>, <span class="bu">ForwardDiff</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>model_with_grad <span class="op">=</span> <span class="fu">ADgradient</span>(<span class="fu">AutoForwardDiff</span>(), model)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model_with_grad, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-24.717020934684665</code></pre>
</div>
</div>
<p>We’ll continue with the second approach in this tutorial since this is typically what one does in practice, because there are better hobbies to spend time on than deriving gradients by hand.</p>
<p>At this point, one might wonder how we’re going to tie this back to Turing.jl in the end. Effectively, when working with inference methods that only require log-density evaluations and / or higher-order information of the log-density, Turing.jl actually converts the user-provided <code>Model</code> into an object implementing the above methods for <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>. As a result, most samplers provided by Turing.jl are actually implemented to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, enabling their use both <em>within</em> Turing.jl and <em>outside</em> of Turing.jl! Morever, there exists similar conversions for Stan through BridgeStan and Stan<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, which means that a sampler supporting the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface can easily be used on both Turing.jl <em>and</em> Stan models (in addition to user-provided models, as our <code>IsotropicNormalModel</code> above)!</p>
<p>Anyways, let’s move on to actually implementing the sampler.</p>
</section>
<section id="implementing-mala-in-abstractmcmc.jl" class="level2">
<h2 class="anchored" data-anchor-id="implementing-mala-in-abstractmcmc.jl">Implementing MALA in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a></h2>
<p>Now that we’ve established that a model implementing the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface provides us with all the information we need from <span class="math inline">\(\log \gamma(x)\)</span>, we can address the question: given an object that implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, how can we define a sampler for it?</p>
<p>We’re going to do this by making our sampler a sub-type of <code>AbstractMCMC.AbstractSampler</code> in addition to implementing a few methods from <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>. Why? Because it gets us <em>a lot</em> of functionality for free, as we will see later.</p>
<p>Moreover, <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> provides a very natural interface for MCMC algorithms.</p>
<p>First, we’ll define our <code>MALA</code> type</p>
<div id="12" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">AbstractMCMC</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALA{T,A} <span class="op">&lt;:</span><span class="dt"> AbstractMCMC.AbstractSampler</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"stepsize used in the leapfrog step"</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    ϵ_init<span class="op">::</span><span class="dt">T</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"covariance matrix used for the momentum"</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    M_init<span class="op">::</span><span class="dt">A</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notice how we’ve added the suffix <code>_init</code> to both the stepsize and the covariance matrix. We’ve done this because a <code>AbstractMCMC.AbstractSampler</code> should be <em>immutable</em>. Of course there might be many scenarios where we want to allow something like the stepsize and / or the covariance matrix to vary between iterations, e.g.&nbsp;during the burn-in / adaptation phase of the sampling process we might want to adjust the parameters using statistics computed from these initial iterations. But information which can change between iterations <em>should not go in the sampler itself</em>! Instead, this information should go in the sampler <em>state</em>.</p>
<p>The sampler state should at the very least contain all the necessary information to perform the next MCMC iteration, but usually contains further information, e.g.&nbsp;quantities and statistics useful for evaluating whether the sampler has converged.</p>
<p>We will use the following sampler state for our <code>MALA</code> sampler:</p>
<div id="14" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALAState{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This might seem overly redundant: we’re defining a type <code>MALAState</code> and it only contains a simple vector of reals. In this particular case we indeed could have dropped this and simply used a <code>AbstractVector{&lt;:Real}</code> as our sampler state, but typically, as we will see later, one wants to include other quantities in the sampler state. For example, if we also wanted to adapt the parameters of our <code>MALA</code>, e.g.&nbsp;alter the stepsize depending on acceptance rates, in which case we should also put <code>ϵ</code> in the state, but for now we’ll keep things simple.</p>
<p>Moreover, we also want a <em>sample</em> type, which is a type meant for “public consumption”, i.e.&nbsp;the end-user. This is generally going to contain a subset of the information present in the state. But in such a simple scenario as this, we similarly only have a <code>AbstractVector{&lt;:Real}</code>:</p>
<div id="16" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALASample{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We currently have three things:</p>
<ol type="1">
<li>A <code>AbstractMCMC.AbstractSampler</code> implementation called <code>MALA</code>.</li>
<li>A state <code>MALAState</code> for our sampler <code>MALA</code>.</li>
<li>A sample <code>MALASample</code> for our sampler <code>MALA</code>.</li>
</ol>
<p>That means that we’re ready to implement the only thing that really matters: <code>AbstractMCMC.step</code>.</p>
<p><code>AbstractMCMC.step</code> defines the MCMC iteration of our <code>MALA</code> given the current <code>MALAState</code>. Specifically, the signature of the function is as follows:</p>
<div id="18" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The RNG to ensure reproducibility.</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The model that defines our target.</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.AbstractModel</span>,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The sampler for which we're taking a `step`.</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">AbstractMCMC.AbstractSampler</span>,</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The current sampler `state`.</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    state;</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Additional keyword arguments that we may or may not need.</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Moreover, there is a specific <code>AbstractMCMC.AbstractModel</code> which is used to indicate that the model that is provided implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface: <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Since, as we discussed earlier, in our case we’re indeed going to work with types that support the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, we’ll define <code>AbstractMCMC.step</code> for such a <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Note that <code>AbstractMCMC.LogDensityModel</code> has no other purpose; it has a single field called <code>logdensity</code>, and it does nothing else. But by wrapping the model in <code>AbstractMCMC.LogDensityModel</code>, it allows samplers that want to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> to define their <code>AbstractMCMC.step</code> on this type without running into method ambiguities.</p>
<p>All in all, that means that the signature for our <code>AbstractMCMC.step</code> is going to be the following:</p>
<div id="20" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># `LogDensityModel` so we know we're working with LogDensityProblems.jl model.</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler.</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler state.</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Great! Now let’s actually implement the full <code>AbstractMCMC.step</code> for our <code>MALA</code>.</p>
<p>Let’s remind ourselves what we’re going to do:</p>
<ol type="1">
<li>Sample a new momentum <span class="math inline">\(p\)</span>.</li>
<li>Compute the log-density of the extended target <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>Take a single leapfrog step <span class="math inline">\((\tilde{x}, \tilde{p}) = L_{\epsilon}(x, p)\)</span>.</li>
<li>Accept or reject the proposed <span class="math inline">\((\tilde{x}, \tilde{p})\)</span>.</li>
</ol>
<p>All in all, this results in the following:</p>
<div id="22" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>: Random</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Distributions</span>  <span class="co"># so we get the `MvNormal`</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the wrapped model which implements LogDensityProblems.jl.</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just extract the sampler parameters to make our lives easier.</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    ϵ <span class="op">=</span> sampler.ϵ_init</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    M <span class="op">=</span> sampler.M_init</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the current parameters.</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> state.x</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sample the momentum.</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>    p_dist <span class="op">=</span> <span class="fu">MvNormal</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)), M)</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> <span class="fu">rand</span>(rng, p_dist)</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Propose using a single leapfrog step.</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>    x̃, p̃ <span class="op">=</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Accept or reject proposal.</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>    logp <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p)</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>    logp̃ <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x̃) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p̃)</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>    logα <span class="op">=</span> logp̃ <span class="op">-</span> logp</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>    state_new <span class="op">=</span> <span class="cf">if</span> <span class="fu">log</span>(<span class="fu">rand</span>(rng)) <span class="op">&lt;</span> logα</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Accept.</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x̃)</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Reject.</span></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x)</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return the "sample" and the sampler state.</span></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(state_new.x), state_new</span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Fairly straight-forward.</p>
<p>Of course, we haven’t defined the <code>leapfrog_step</code> method yet, so let’s do that:</p>
<div id="24" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p` using "position" `x`.</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x))</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    p1 <span class="op">=</span> p <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update the "position" `x` using momentum `p1`.</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    x̃ <span class="op">=</span> x <span class="op">+</span> ϵ <span class="op">.*</span> (M <span class="op">\</span> p1)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p1` using position `x̃`</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x̃ <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x̃))</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    p2 <span class="op">=</span> p1 <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x̃</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Flip momentum `p2`.</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    p̃ <span class="op">=</span> <span class="op">-</span>p2</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x̃, p̃</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>leapfrog_step (generic function with 1 method)</code></pre>
</div>
</div>
<p>With all of this, we’re technically ready to sample!</p>
<div id="26" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>, <span class="bu">LinearAlgebra</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>rng <span class="op">=</span> <span class="bu">Random</span>.<span class="fu">default_rng</span>()</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>sampler <span class="op">=</span> <span class="fu">MALA</span>(<span class="fl">1</span>, I)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>state <span class="op">=</span> <span class="fu">MALAState</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)))</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>x_next, state_next <span class="op">=</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    rng,</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    AbstractMCMC.<span class="fu">LogDensityModel</span>(model),</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    state</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>(MALASample{Vector{Float64}}([0.0, 0.0, 0.0]), MALAState{Vector{Float64}}([0.0, 0.0, 0.0]))</code></pre>
</div>
</div>
<p>Great, it works!</p>
<p>And I promised we would get quite some functionality for free if we implemented <code>AbstractMCMC.step</code>, and so we can now simply call <code>sample</code> to perform standard MCMC sampling:</p>
<div id="28" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform 1000 iterations with our `MALA` sampler.</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; initial_state<span class="op">=</span>state, progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Concatenate into a matrix.</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000 Matrix{Float64}:
 -2.73717   -4.25848  -5.66592   -4.90761   …  -4.35554   -3.74732  -5.85583
 -2.20448   -1.81639   0.687909  -0.675136     -0.119553  -1.0508   -1.13842
  0.712491   1.56688   3.64266    5.6281        4.33043    4.46352   4.29033</code></pre>
</div>
</div>
<div id="30" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the marginal means and standard deviations.</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -5.01509     1.01172
 -0.00657752  1.00645
  4.97017     0.982283</code></pre>
</div>
</div>
<p>Let’s visualize the samples</p>
<div id="32" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">StatsPlots</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">transpose</span>(samples_matrix[<span class="op">:</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">:</span><span class="kw">end</span>]), alpha<span class="op">=</span><span class="fl">0.5</span>, legend<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<!--?xml version="1.0" encoding="utf-8"?-->
<svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" width="672" height="480" viewbox="0 0 2688 1920">
<defs>
  <clippath id="clip970">
    <rect x="0" y="0" width="2688" height="1920"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip970)" d="M0 1920 L2688 1920 L2688 0 L0 0  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip971">
    <rect x="537" y="0" width="1883" height="1883"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip970)" d="M196.816 1800.78 L2640.76 1800.78 L2640.76 47.2441 L196.816 47.2441  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip972">
    <rect x="196" y="47" width="2445" height="1755"></rect>
  </clippath>
</defs>
<polyline clip-path="url(#clip972)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="263.676,1800.78 263.676,47.2441 "></polyline>
<polyline clip-path="url(#clip972)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="840.654,1800.78 840.654,47.2441 "></polyline>
<polyline clip-path="url(#clip972)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1417.63,1800.78 1417.63,47.2441 "></polyline>
<polyline clip-path="url(#clip972)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1994.61,1800.78 1994.61,47.2441 "></polyline>
<polyline clip-path="url(#clip972)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="2571.59,1800.78 2571.59,47.2441 "></polyline>
<polyline clip-path="url(#clip972)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,1644.98 2640.76,1644.98 "></polyline>
<polyline clip-path="url(#clip972)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,1399.13 2640.76,1399.13 "></polyline>
<polyline clip-path="url(#clip972)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,1153.29 2640.76,1153.29 "></polyline>
<polyline clip-path="url(#clip972)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,907.438 2640.76,907.438 "></polyline>
<polyline clip-path="url(#clip972)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,661.59 2640.76,661.59 "></polyline>
<polyline clip-path="url(#clip972)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,415.742 2640.76,415.742 "></polyline>
<polyline clip-path="url(#clip972)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,169.894 2640.76,169.894 "></polyline>
<polyline clip-path="url(#clip970)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1800.78 2640.76,1800.78 "></polyline>
<polyline clip-path="url(#clip970)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="263.676,1800.78 263.676,1781.88 "></polyline>
<polyline clip-path="url(#clip970)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="840.654,1800.78 840.654,1781.88 "></polyline>
<polyline clip-path="url(#clip970)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1417.63,1800.78 1417.63,1781.88 "></polyline>
<polyline clip-path="url(#clip970)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1994.61,1800.78 1994.61,1781.88 "></polyline>
<polyline clip-path="url(#clip970)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="2571.59,1800.78 2571.59,1781.88 "></polyline>
<path clip-path="url(#clip970)" d="M263.676 1834 Q260.065 1834 258.236 1837.57 Q256.431 1841.11 256.431 1848.24 Q256.431 1855.34 258.236 1858.91 Q260.065 1862.45 263.676 1862.45 Q267.31 1862.45 269.116 1858.91 Q270.945 1855.34 270.945 1848.24 Q270.945 1841.11 269.116 1837.57 Q267.31 1834 263.676 1834 M263.676 1830.3 Q269.486 1830.3 272.542 1834.9 Q275.621 1839.49 275.621 1848.24 Q275.621 1856.96 272.542 1861.57 Q269.486 1866.15 263.676 1866.15 Q257.866 1866.15 254.787 1861.57 Q251.732 1856.96 251.732 1848.24 Q251.732 1839.49 254.787 1834.9 Q257.866 1830.3 263.676 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip970)" d="M804.346 1861.55 L820.666 1861.55 L820.666 1865.48 L798.721 1865.48 L798.721 1861.55 Q801.383 1858.79 805.967 1854.16 Q810.573 1849.51 811.754 1848.17 Q813.999 1845.65 814.879 1843.91 Q815.782 1842.15 815.782 1840.46 Q815.782 1837.71 813.837 1835.97 Q811.916 1834.23 808.814 1834.23 Q806.615 1834.23 804.161 1835 Q801.731 1835.76 798.953 1837.31 L798.953 1832.59 Q801.777 1831.46 804.231 1830.88 Q806.684 1830.3 808.721 1830.3 Q814.092 1830.3 817.286 1832.98 Q820.481 1835.67 820.481 1840.16 Q820.481 1842.29 819.67 1844.21 Q818.883 1846.11 816.777 1848.7 Q816.198 1849.37 813.096 1852.59 Q809.995 1855.78 804.346 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip970)" d="M830.527 1830.92 L848.883 1830.92 L848.883 1834.86 L834.809 1834.86 L834.809 1843.33 Q835.828 1842.98 836.846 1842.82 Q837.865 1842.64 838.883 1842.64 Q844.67 1842.64 848.05 1845.81 Q851.43 1848.98 851.43 1854.4 Q851.43 1859.97 847.957 1863.08 Q844.485 1866.15 838.166 1866.15 Q835.99 1866.15 833.721 1865.78 Q831.476 1865.41 829.069 1864.67 L829.069 1859.97 Q831.152 1861.11 833.374 1861.66 Q835.596 1862.22 838.073 1862.22 Q842.078 1862.22 844.416 1860.11 Q846.754 1858.01 846.754 1854.4 Q846.754 1850.78 844.416 1848.68 Q842.078 1846.57 838.073 1846.57 Q836.198 1846.57 834.323 1846.99 Q832.471 1847.4 830.527 1848.28 L830.527 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip970)" d="M870.642 1834 Q867.031 1834 865.203 1837.57 Q863.397 1841.11 863.397 1848.24 Q863.397 1855.34 865.203 1858.91 Q867.031 1862.45 870.642 1862.45 Q874.277 1862.45 876.082 1858.91 Q877.911 1855.34 877.911 1848.24 Q877.911 1841.11 876.082 1837.57 Q874.277 1834 870.642 1834 M870.642 1830.3 Q876.453 1830.3 879.508 1834.9 Q882.587 1839.49 882.587 1848.24 Q882.587 1856.96 879.508 1861.57 Q876.453 1866.15 870.642 1866.15 Q864.832 1866.15 861.754 1861.57 Q858.698 1856.96 858.698 1848.24 Q858.698 1839.49 861.754 1834.9 Q864.832 1830.3 870.642 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip970)" d="M1377.25 1830.92 L1395.61 1830.92 L1395.61 1834.86 L1381.53 1834.86 L1381.53 1843.33 Q1382.55 1842.98 1383.57 1842.82 Q1384.59 1842.64 1385.61 1842.64 Q1391.39 1842.64 1394.77 1845.81 Q1398.15 1848.98 1398.15 1854.4 Q1398.15 1859.97 1394.68 1863.08 Q1391.21 1866.15 1384.89 1866.15 Q1382.71 1866.15 1380.44 1865.78 Q1378.2 1865.41 1375.79 1864.67 L1375.79 1859.97 Q1377.88 1861.11 1380.1 1861.66 Q1382.32 1862.22 1384.8 1862.22 Q1388.8 1862.22 1391.14 1860.11 Q1393.48 1858.01 1393.48 1854.4 Q1393.48 1850.78 1391.14 1848.68 Q1388.8 1846.57 1384.8 1846.57 Q1382.92 1846.57 1381.05 1846.99 Q1379.19 1847.4 1377.25 1848.28 L1377.25 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip970)" d="M1417.37 1834 Q1413.75 1834 1411.93 1837.57 Q1410.12 1841.11 1410.12 1848.24 Q1410.12 1855.34 1411.93 1858.91 Q1413.75 1862.45 1417.37 1862.45 Q1421 1862.45 1422.81 1858.91 Q1424.63 1855.34 1424.63 1848.24 Q1424.63 1841.11 1422.81 1837.57 Q1421 1834 1417.37 1834 M1417.37 1830.3 Q1423.18 1830.3 1426.23 1834.9 Q1429.31 1839.49 1429.31 1848.24 Q1429.31 1856.96 1426.23 1861.57 Q1423.18 1866.15 1417.37 1866.15 Q1411.56 1866.15 1408.48 1861.57 Q1405.42 1856.96 1405.42 1848.24 Q1405.42 1839.49 1408.48 1834.9 Q1411.56 1830.3 1417.37 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip970)" d="M1447.53 1834 Q1443.92 1834 1442.09 1837.57 Q1440.28 1841.11 1440.28 1848.24 Q1440.28 1855.34 1442.09 1858.91 Q1443.92 1862.45 1447.53 1862.45 Q1451.16 1862.45 1452.97 1858.91 Q1454.8 1855.34 1454.8 1848.24 Q1454.8 1841.11 1452.97 1837.57 Q1451.16 1834 1447.53 1834 M1447.53 1830.3 Q1453.34 1830.3 1456.39 1834.9 Q1459.47 1839.49 1459.47 1848.24 Q1459.47 1856.96 1456.39 1861.57 Q1453.34 1866.15 1447.53 1866.15 Q1441.72 1866.15 1438.64 1861.57 Q1435.58 1856.96 1435.58 1848.24 Q1435.58 1839.49 1438.64 1834.9 Q1441.72 1830.3 1447.53 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip970)" d="M1952.89 1830.92 L1975.11 1830.92 L1975.11 1832.91 L1962.56 1865.48 L1957.68 1865.48 L1969.48 1834.86 L1952.89 1834.86 L1952.89 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip970)" d="M1984.27 1830.92 L2002.63 1830.92 L2002.63 1834.86 L1988.56 1834.86 L1988.56 1843.33 Q1989.58 1842.98 1990.59 1842.82 Q1991.61 1842.64 1992.63 1842.64 Q1998.42 1842.64 2001.8 1845.81 Q2005.18 1848.98 2005.18 1854.4 Q2005.18 1859.97 2001.7 1863.08 Q1998.23 1866.15 1991.91 1866.15 Q1989.74 1866.15 1987.47 1865.78 Q1985.22 1865.41 1982.82 1864.67 L1982.82 1859.97 Q1984.9 1861.11 1987.12 1861.66 Q1989.34 1862.22 1991.82 1862.22 Q1995.83 1862.22 1998.16 1860.11 Q2000.5 1858.01 2000.5 1854.4 Q2000.5 1850.78 1998.16 1848.68 Q1995.83 1846.57 1991.82 1846.57 Q1989.95 1846.57 1988.07 1846.99 Q1986.22 1847.4 1984.27 1848.28 L1984.27 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip970)" d="M2024.39 1834 Q2020.78 1834 2018.95 1837.57 Q2017.14 1841.11 2017.14 1848.24 Q2017.14 1855.34 2018.95 1858.91 Q2020.78 1862.45 2024.39 1862.45 Q2028.02 1862.45 2029.83 1858.91 Q2031.66 1855.34 2031.66 1848.24 Q2031.66 1841.11 2029.83 1837.57 Q2028.02 1834 2024.39 1834 M2024.39 1830.3 Q2030.2 1830.3 2033.26 1834.9 Q2036.33 1839.49 2036.33 1848.24 Q2036.33 1856.96 2033.26 1861.57 Q2030.2 1866.15 2024.39 1866.15 Q2018.58 1866.15 2015.5 1861.57 Q2012.45 1856.96 2012.45 1848.24 Q2012.45 1839.49 2015.5 1834.9 Q2018.58 1830.3 2024.39 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip970)" d="M2516.11 1861.55 L2523.75 1861.55 L2523.75 1835.18 L2515.44 1836.85 L2515.44 1832.59 L2523.71 1830.92 L2528.38 1830.92 L2528.38 1861.55 L2536.02 1861.55 L2536.02 1865.48 L2516.11 1865.48 L2516.11 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip970)" d="M2555.47 1834 Q2551.85 1834 2550.03 1837.57 Q2548.22 1841.11 2548.22 1848.24 Q2548.22 1855.34 2550.03 1858.91 Q2551.85 1862.45 2555.47 1862.45 Q2559.1 1862.45 2560.9 1858.91 Q2562.73 1855.34 2562.73 1848.24 Q2562.73 1841.11 2560.9 1837.57 Q2559.1 1834 2555.47 1834 M2555.47 1830.3 Q2561.28 1830.3 2564.33 1834.9 Q2567.41 1839.49 2567.41 1848.24 Q2567.41 1856.96 2564.33 1861.57 Q2561.28 1866.15 2555.47 1866.15 Q2549.66 1866.15 2546.58 1861.57 Q2543.52 1856.96 2543.52 1848.24 Q2543.52 1839.49 2546.58 1834.9 Q2549.66 1830.3 2555.47 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip970)" d="M2585.63 1834 Q2582.02 1834 2580.19 1837.57 Q2578.38 1841.11 2578.38 1848.24 Q2578.38 1855.34 2580.19 1858.91 Q2582.02 1862.45 2585.63 1862.45 Q2589.26 1862.45 2591.07 1858.91 Q2592.9 1855.34 2592.9 1848.24 Q2592.9 1841.11 2591.07 1837.57 Q2589.26 1834 2585.63 1834 M2585.63 1830.3 Q2591.44 1830.3 2594.49 1834.9 Q2597.57 1839.49 2597.57 1848.24 Q2597.57 1856.96 2594.49 1861.57 Q2591.44 1866.15 2585.63 1866.15 Q2579.82 1866.15 2576.74 1861.57 Q2573.68 1856.96 2573.68 1848.24 Q2573.68 1839.49 2576.74 1834.9 Q2579.82 1830.3 2585.63 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip970)" d="M2615.79 1834 Q2612.18 1834 2610.35 1837.57 Q2608.54 1841.11 2608.54 1848.24 Q2608.54 1855.34 2610.35 1858.91 Q2612.18 1862.45 2615.79 1862.45 Q2619.42 1862.45 2621.23 1858.91 Q2623.06 1855.34 2623.06 1848.24 Q2623.06 1841.11 2621.23 1837.57 Q2619.42 1834 2615.79 1834 M2615.79 1830.3 Q2621.6 1830.3 2624.65 1834.9 Q2627.73 1839.49 2627.73 1848.24 Q2627.73 1856.96 2624.65 1861.57 Q2621.6 1866.15 2615.79 1866.15 Q2609.98 1866.15 2606.9 1861.57 Q2603.84 1856.96 2603.84 1848.24 Q2603.84 1839.49 2606.9 1834.9 Q2609.98 1830.3 2615.79 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip970)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1800.78 196.816,47.2441 "></polyline>
<polyline clip-path="url(#clip970)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1644.98 215.714,1644.98 "></polyline>
<polyline clip-path="url(#clip970)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1399.13 215.714,1399.13 "></polyline>
<polyline clip-path="url(#clip970)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1153.29 215.714,1153.29 "></polyline>
<polyline clip-path="url(#clip970)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,907.438 215.714,907.438 "></polyline>
<polyline clip-path="url(#clip970)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,661.59 215.714,661.59 "></polyline>
<polyline clip-path="url(#clip970)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,415.742 215.714,415.742 "></polyline>
<polyline clip-path="url(#clip970)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,169.894 215.714,169.894 "></polyline>
<path clip-path="url(#clip970)" d="M50.5475 1645.43 L80.2233 1645.43 L80.2233 1649.37 L50.5475 1649.37 L50.5475 1645.43 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip970)" d="M89.1352 1627.7 L111.357 1627.7 L111.357 1629.69 L98.8111 1662.26 L93.9269 1662.26 L105.732 1631.64 L89.1352 1631.64 L89.1352 1627.7 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip970)" d="M120.478 1656.38 L125.362 1656.38 L125.362 1662.26 L120.478 1662.26 L120.478 1656.38 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip970)" d="M135.593 1627.7 L153.95 1627.7 L153.95 1631.64 L139.876 1631.64 L139.876 1640.11 Q140.894 1639.76 141.913 1639.6 Q142.931 1639.42 143.95 1639.42 Q149.737 1639.42 153.116 1642.59 Q156.496 1645.76 156.496 1651.17 Q156.496 1656.75 153.024 1659.85 Q149.552 1662.93 143.232 1662.93 Q141.056 1662.93 138.788 1662.56 Q136.542 1662.19 134.135 1661.45 L134.135 1656.75 Q136.218 1657.89 138.441 1658.44 Q140.663 1659 143.14 1659 Q147.144 1659 149.482 1656.89 Q151.82 1654.79 151.82 1651.17 Q151.82 1647.56 149.482 1645.46 Q147.144 1643.35 143.14 1643.35 Q141.265 1643.35 139.39 1643.77 Q137.538 1644.18 135.593 1645.06 L135.593 1627.7 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip970)" d="M49.5521 1399.59 L79.2279 1399.59 L79.2279 1403.52 L49.5521 1403.52 L49.5521 1399.59 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip970)" d="M89.3667 1381.85 L107.723 1381.85 L107.723 1385.79 L93.6491 1385.79 L93.6491 1394.26 Q94.6676 1393.91 95.6861 1393.75 Q96.7047 1393.57 97.7232 1393.57 Q103.51 1393.57 106.89 1396.74 Q110.269 1399.91 110.269 1405.33 Q110.269 1410.91 106.797 1414.01 Q103.325 1417.09 97.0056 1417.09 Q94.8297 1417.09 92.5612 1416.72 Q90.3158 1416.34 87.9084 1415.6 L87.9084 1410.91 Q89.9917 1412.04 92.2139 1412.59 Q94.4361 1413.15 96.913 1413.15 Q100.918 1413.15 103.256 1411.04 Q105.593 1408.94 105.593 1405.33 Q105.593 1401.72 103.256 1399.61 Q100.918 1397.5 96.913 1397.5 Q95.038 1397.5 93.163 1397.92 Q91.3112 1398.34 89.3667 1399.22 L89.3667 1381.85 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip970)" d="M119.482 1410.53 L124.367 1410.53 L124.367 1416.41 L119.482 1416.41 L119.482 1410.53 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip970)" d="M144.552 1384.93 Q140.941 1384.93 139.112 1388.5 Q137.306 1392.04 137.306 1399.17 Q137.306 1406.28 139.112 1409.84 Q140.941 1413.38 144.552 1413.38 Q148.186 1413.38 149.991 1409.84 Q151.82 1406.28 151.82 1399.17 Q151.82 1392.04 149.991 1388.5 Q148.186 1384.93 144.552 1384.93 M144.552 1381.23 Q150.362 1381.23 153.417 1385.84 Q156.496 1390.42 156.496 1399.17 Q156.496 1407.9 153.417 1412.5 Q150.362 1417.09 144.552 1417.09 Q138.741 1417.09 135.663 1412.5 Q132.607 1407.9 132.607 1399.17 Q132.607 1390.42 135.663 1385.84 Q138.741 1381.23 144.552 1381.23 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip970)" d="M50.5475 1153.74 L80.2233 1153.74 L80.2233 1157.67 L50.5475 1157.67 L50.5475 1153.74 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip970)" d="M94.3436 1166.63 L110.663 1166.63 L110.663 1170.57 L88.7186 1170.57 L88.7186 1166.63 Q91.3806 1163.88 95.9639 1159.25 Q100.57 1154.59 101.751 1153.25 Q103.996 1150.73 104.876 1148.99 Q105.779 1147.23 105.779 1145.54 Q105.779 1142.79 103.834 1141.05 Q101.913 1139.32 98.8111 1139.32 Q96.6121 1139.32 94.1584 1140.08 Q91.7278 1140.84 88.9501 1142.4 L88.9501 1137.67 Q91.7741 1136.54 94.2278 1135.96 Q96.6815 1135.38 98.7185 1135.38 Q104.089 1135.38 107.283 1138.07 Q110.478 1140.75 110.478 1145.24 Q110.478 1147.37 109.668 1149.29 Q108.881 1151.19 106.774 1153.78 Q106.195 1154.46 103.094 1157.67 Q99.9917 1160.87 94.3436 1166.63 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip970)" d="M120.478 1164.69 L125.362 1164.69 L125.362 1170.57 L120.478 1170.57 L120.478 1164.69 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip970)" d="M135.593 1136.01 L153.95 1136.01 L153.95 1139.94 L139.876 1139.94 L139.876 1148.41 Q140.894 1148.07 141.913 1147.9 Q142.931 1147.72 143.95 1147.72 Q149.737 1147.72 153.116 1150.89 Q156.496 1154.06 156.496 1159.48 Q156.496 1165.06 153.024 1168.16 Q149.552 1171.24 143.232 1171.24 Q141.056 1171.24 138.788 1170.87 Q136.542 1170.5 134.135 1169.76 L134.135 1165.06 Q136.218 1166.19 138.441 1166.75 Q140.663 1167.3 143.14 1167.3 Q147.144 1167.3 149.482 1165.2 Q151.82 1163.09 151.82 1159.48 Q151.82 1155.87 149.482 1153.76 Q147.144 1151.65 143.14 1151.65 Q141.265 1151.65 139.39 1152.07 Q137.538 1152.49 135.593 1153.37 L135.593 1136.01 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip970)" d="M99.3204 893.237 Q95.7093 893.237 93.8806 896.802 Q92.075 900.343 92.075 907.473 Q92.075 914.579 93.8806 918.144 Q95.7093 921.686 99.3204 921.686 Q102.955 921.686 104.76 918.144 Q106.589 914.579 106.589 907.473 Q106.589 900.343 104.76 896.802 Q102.955 893.237 99.3204 893.237 M99.3204 889.533 Q105.131 889.533 108.186 894.14 Q111.265 898.723 111.265 907.473 Q111.265 916.2 108.186 920.806 Q105.131 925.39 99.3204 925.39 Q93.5102 925.39 90.4315 920.806 Q87.376 916.2 87.376 907.473 Q87.376 898.723 90.4315 894.14 Q93.5102 889.533 99.3204 889.533 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip970)" d="M119.482 918.839 L124.367 918.839 L124.367 924.718 L119.482 924.718 L119.482 918.839 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip970)" d="M144.552 893.237 Q140.941 893.237 139.112 896.802 Q137.306 900.343 137.306 907.473 Q137.306 914.579 139.112 918.144 Q140.941 921.686 144.552 921.686 Q148.186 921.686 149.991 918.144 Q151.82 914.579 151.82 907.473 Q151.82 900.343 149.991 896.802 Q148.186 893.237 144.552 893.237 M144.552 889.533 Q150.362 889.533 153.417 894.14 Q156.496 898.723 156.496 907.473 Q156.496 916.2 153.417 920.806 Q150.362 925.39 144.552 925.39 Q138.741 925.39 135.663 920.806 Q132.607 916.2 132.607 907.473 Q132.607 898.723 135.663 894.14 Q138.741 889.533 144.552 889.533 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip970)" d="M94.3436 674.935 L110.663 674.935 L110.663 678.87 L88.7186 678.87 L88.7186 674.935 Q91.3806 672.181 95.9639 667.551 Q100.57 662.898 101.751 661.556 Q103.996 659.033 104.876 657.296 Q105.779 655.537 105.779 653.847 Q105.779 651.093 103.834 649.357 Q101.913 647.621 98.8111 647.621 Q96.6121 647.621 94.1584 648.384 Q91.7278 649.148 88.9501 650.699 L88.9501 645.977 Q91.7741 644.843 94.2278 644.264 Q96.6815 643.685 98.7185 643.685 Q104.089 643.685 107.283 646.371 Q110.478 649.056 110.478 653.546 Q110.478 655.676 109.668 657.597 Q108.881 659.495 106.774 662.088 Q106.195 662.759 103.094 665.977 Q99.9917 669.171 94.3436 674.935 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip970)" d="M120.478 672.991 L125.362 672.991 L125.362 678.87 L120.478 678.87 L120.478 672.991 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip970)" d="M135.593 644.31 L153.95 644.31 L153.95 648.246 L139.876 648.246 L139.876 656.718 Q140.894 656.37 141.913 656.208 Q142.931 656.023 143.95 656.023 Q149.737 656.023 153.116 659.195 Q156.496 662.366 156.496 667.782 Q156.496 673.361 153.024 676.463 Q149.552 679.542 143.232 679.542 Q141.056 679.542 138.788 679.171 Q136.542 678.801 134.135 678.06 L134.135 673.361 Q136.218 674.495 138.441 675.051 Q140.663 675.606 143.14 675.606 Q147.144 675.606 149.482 673.5 Q151.82 671.394 151.82 667.782 Q151.82 664.171 149.482 662.065 Q147.144 659.958 143.14 659.958 Q141.265 659.958 139.39 660.375 Q137.538 660.792 135.593 661.671 L135.593 644.31 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip970)" d="M89.3667 398.462 L107.723 398.462 L107.723 402.398 L93.6491 402.398 L93.6491 410.87 Q94.6676 410.523 95.6861 410.36 Q96.7047 410.175 97.7232 410.175 Q103.51 410.175 106.89 413.347 Q110.269 416.518 110.269 421.934 Q110.269 427.513 106.797 430.615 Q103.325 433.694 97.0056 433.694 Q94.8297 433.694 92.5612 433.323 Q90.3158 432.953 87.9084 432.212 L87.9084 427.513 Q89.9917 428.647 92.2139 429.203 Q94.4361 429.759 96.913 429.759 Q100.918 429.759 103.256 427.652 Q105.593 425.546 105.593 421.934 Q105.593 418.323 103.256 416.217 Q100.918 414.11 96.913 414.11 Q95.038 414.11 93.163 414.527 Q91.3112 414.944 89.3667 415.823 L89.3667 398.462 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip970)" d="M119.482 427.143 L124.367 427.143 L124.367 433.022 L119.482 433.022 L119.482 427.143 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip970)" d="M144.552 401.541 Q140.941 401.541 139.112 405.106 Q137.306 408.648 137.306 415.777 Q137.306 422.884 139.112 426.448 Q140.941 429.99 144.552 429.99 Q148.186 429.99 149.991 426.448 Q151.82 422.884 151.82 415.777 Q151.82 408.648 149.991 405.106 Q148.186 401.541 144.552 401.541 M144.552 397.837 Q150.362 397.837 153.417 402.444 Q156.496 407.027 156.496 415.777 Q156.496 424.504 153.417 429.11 Q150.362 433.694 144.552 433.694 Q138.741 433.694 135.663 429.11 Q132.607 424.504 132.607 415.777 Q132.607 407.027 135.663 402.444 Q138.741 397.837 144.552 397.837 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip970)" d="M89.1352 152.614 L111.357 152.614 L111.357 154.605 L98.8111 187.174 L93.9269 187.174 L105.732 156.55 L89.1352 156.55 L89.1352 152.614 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip970)" d="M120.478 181.295 L125.362 181.295 L125.362 187.174 L120.478 187.174 L120.478 181.295 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip970)" d="M135.593 152.614 L153.95 152.614 L153.95 156.55 L139.876 156.55 L139.876 165.022 Q140.894 164.675 141.913 164.512 Q142.931 164.327 143.95 164.327 Q149.737 164.327 153.116 167.499 Q156.496 170.67 156.496 176.087 Q156.496 181.665 153.024 184.767 Q149.552 187.846 143.232 187.846 Q141.056 187.846 138.788 187.475 Q136.542 187.105 134.135 186.364 L134.135 181.665 Q136.218 182.799 138.441 183.355 Q140.663 183.911 143.14 183.911 Q147.144 183.911 149.482 181.804 Q151.82 179.698 151.82 176.087 Q151.82 172.475 149.482 170.369 Q147.144 168.262 143.14 168.262 Q141.265 168.262 139.39 168.679 Q137.538 169.096 135.593 169.975 L135.593 152.614 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip972)" style="stroke:#009af9; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="265.984,1176.61 268.292,1434.45 270.6,1403.46 272.908,1492.95 275.216,1228.4 277.524,1376.88 279.832,1583.35 282.139,1306.52 284.447,1250.4 286.755,1455.29 289.063,1510.81 291.371,1240.02 293.679,1378.35 295.987,1452.43 298.295,1577.97 300.603,1570.34 302.911,1445.94 305.219,1323.86 307.527,1543.13 309.834,1293.28 312.142,1486.05 314.45,1479.55 316.758,1513.34 319.066,1255.8 321.374,1392.92 323.682,1425.83 325.99,1472.42 328.298,1428.5 330.606,1377.64 332.914,1576.83 335.221,1439.75 337.529,1339.87 339.837,1258.01 342.145,1333.59 344.453,1229.81 346.761,1387.01 349.069,1484.48 351.377,1419.31 353.685,1564.6 355.993,1446.84 358.301,1600.36 360.608,1425.33 362.916,1344.1 365.224,1358.92 367.532,1318.97 369.84,1395.18 372.148,1447.42 374.456,1320.48 376.764,1332.69 379.072,1465.16 381.38,1390.47 383.688,1571.93 385.996,1355.67 388.303,1537.33 390.611,1216.76 392.919,1443.76 395.227,1352.67 397.535,1361.01 399.843,1423.09 402.151,1329.74 404.459,1075.71 406.767,1592.57 409.075,1381.76 411.383,1466.64 413.69,1500.47 415.998,1480.16 418.306,1385.7 420.614,1392.25 422.922,1375.78 425.23,1251.17 427.538,1364.99 429.846,1400.77 432.154,1475.44 434.462,1332.19 436.77,1376.68 439.077,1337.31 441.385,1483.64 443.693,1353.74 446.001,1221.2 448.309,1293.43 450.617,1390.2 452.925,1325.48 455.233,1393.26 457.541,1540.35 459.849,1403.81 462.157,1336.98 464.465,1318.96 466.772,1428.92 469.08,1338.36 471.388,1263.54 473.696,1357.75 476.004,1544.69 478.312,1304.09 480.62,1434.4 482.928,1452.17 485.236,1342.38 487.544,1442.57 489.852,1377.12 492.159,1366.13 494.467,1497.68 496.775,1315.02 499.083,1364.69 501.391,1292.87 503.699,1527.92 506.007,1307.56 508.315,1300.81 510.623,1136.49 512.931,1272.84 515.239,1454.39 517.546,1432.38 519.854,1515.79 522.162,1241.86 524.47,1323.59 526.778,1450.38 529.086,1407.48 531.394,1410.87 533.702,1409.7 536.01,1457.48 538.318,1459.9 540.626,1369.54 542.933,1471.65 545.241,1447.16 547.549,1274.88 549.857,1360.91 552.165,1357.4 554.473,1477.4 556.781,1383.48 559.089,1326.91 561.397,1322.64 563.705,1562.04 566.013,1296.82 568.321,1417.9 570.628,1524.9 572.936,1441.66 575.244,1457.68 577.552,1374.53 579.86,1284.79 582.168,1404.95 584.476,1571.46 586.784,1384.56 589.092,1425.62 591.4,1443.36 593.708,1336.04 596.015,1445.59 598.323,1128.6 600.631,1570.1 602.939,1261.35 605.247,1350.02 607.555,1496.36 609.863,1276.37 612.171,1369.19 614.479,1254.52 616.787,1339.48 619.095,1477.15 621.402,1456.23 623.71,1751.15 626.018,1186.76 628.326,1442.45 630.634,1594.36 632.942,1274.8 635.25,1344.36 637.558,1287.31 639.866,1316.86 642.174,1329.77 644.482,1341.77 646.79,1410.31 649.097,1554.04 651.405,1229.25 653.713,1514.53 656.021,1499.24 658.329,1606.03 660.637,1250.47 662.945,1569.1 665.253,1453.4 667.561,1524.67 669.869,1351.05 672.177,1436.76 674.484,1304.31 676.792,1309.05 679.1,1223.38 681.408,1300.63 683.716,1511.33 686.024,1412.65 688.332,1482.5 690.64,1381.2 692.948,1419.66 695.256,1342.45 697.564,1487.22 699.871,1403.14 702.179,1381.57 704.487,1478.59 706.795,1268.94 709.103,1382.39 711.411,1495.92 713.719,1413.46 716.027,1449.16 718.335,1383.9 720.643,1398.92 722.951,1491.86 725.259,1389.69 727.566,1338.67 729.874,1305.84 732.182,1422.41 734.49,1462.49 736.798,1468.81 739.106,1373.66 741.414,1347.6 743.722,1450.79 746.03,1489.29 748.338,1410.79 750.646,1283.9 752.953,1546.2 755.261,1426.61 757.569,1375.42 759.877,1442.83 762.185,1646.24 764.493,1446.58 766.801,1426.87 769.109,1380.84 771.417,1232.58 773.725,1479.03 776.033,1352.83 778.34,1350.45 780.648,1378.32 782.956,1318.37 785.264,1337.61 787.572,1335.89 789.88,1410.37 792.188,1157.97 794.496,1446.04 796.804,1307.21 799.112,1357.67 801.42,1390.86 803.728,1345.54 806.035,1339.74 808.343,1459.71 810.651,1364.85 812.959,1322.05 815.267,1431.35 817.575,1428 819.883,1405.52 822.191,1607.91 824.499,1428.11 826.807,1518.58 829.115,1452.48 831.422,1339.39 833.73,1338.73 836.038,1545.64 838.346,1533.61 840.654,1316.33 842.962,1452.93 845.27,1355.55 847.578,1282.18 849.886,1521.57 852.194,1333.14 854.502,1447.84 856.809,1339.03 859.117,1193.18 861.425,1242.2 863.733,1308.81 866.041,1502.42 868.349,1415.41 870.657,1343.58 872.965,1505.85 875.273,1333.96 877.581,1583.7 879.889,1334.13 882.197,1300.92 884.504,1377.33 886.812,1521.91 889.12,1507.31 891.428,1405.61 893.736,1333.09 896.044,1517.13 898.352,1383.67 900.66,1500.79 902.968,1338.56 905.276,1293.07 907.584,1405.65 909.891,1298.83 912.199,1520.13 914.507,1412.96 916.815,1441.71 919.123,1501.57 921.431,1483.16 923.739,1455.97 926.047,1426.36 928.355,1340.59 930.663,1367.69 932.971,1575.92 935.278,1416.43 937.586,1564.31 939.894,1332.09 942.202,1444.56 944.51,1454.74 946.818,1300.76 949.126,1465.44 951.434,1320.1 953.742,1493.94 956.05,1350.56 958.358,1125.88 960.665,1438.78 962.973,1254.67 965.281,1345.12 967.589,1313.49 969.897,1213.21 972.205,1280.45 974.513,1319.52 976.821,1235.9 979.129,1407.95 981.437,1295.79 983.745,1471.13 986.053,1514.06 988.36,1455.25 990.668,1334.44 992.976,1446.97 995.284,1547.71 997.592,1498.96 999.9,1379.13 1002.21,1381.94 1004.52,1297.15 1006.82,1292.88 1009.13,1341.91 1011.44,1401.37 1013.75,1304.37 1016.06,1460.04 1018.36,1557.37 1020.67,1320.3 1022.98,1374.36 1025.29,1411.3 1027.59,1235.9 1029.9,1494.56 1032.21,1368.32 1034.52,1542.27 1036.83,1435.63 1039.13,1361.92 1041.44,1431.41 1043.75,1433.2 1046.06,1404 1048.37,1443.71 1050.67,1470.29 1052.98,1419.69 1055.29,1441.86 1057.6,1333.86 1059.91,1233.39 1062.21,1411.34 1064.52,1479.61 1066.83,1481.17 1069.14,1394.36 1071.45,1368.9 1073.75,1371.23 1076.06,1386.13 1078.37,1302.67 1080.68,1199.07 1082.98,1412.38 1085.29,1409.2 1087.6,1366.24 1089.91,1467.92 1092.22,1459.08 1094.52,1353.84 1096.83,1488.29 1099.14,1417.17 1101.45,1479.4 1103.76,1544.69 1106.06,1208.42 1108.37,1424.85 1110.68,1367.08 1112.99,1318.6 1115.3,1322.4 1117.6,1536.57 1119.91,1479.77 1122.22,1458.92 1124.53,1373.82 1126.84,1456.26 1129.14,1610.13 1131.45,1433.36 1133.76,1401.78 1136.07,1452.2 1138.37,1397.29 1140.68,1349.47 1142.99,1423.87 1145.3,1356.47 1147.61,1437.38 1149.91,1322.77 1152.22,1440.03 1154.53,1365.56 1156.84,1390.88 1159.15,1405.8 1161.45,1603.41 1163.76,1601.08 1166.07,1427.33 1168.38,1261.29 1170.69,1412.22 1172.99,1474.1 1175.3,1516.06 1177.61,1471.86 1179.92,1504.6 1182.23,1282.25 1184.53,1480.34 1186.84,1217.58 1189.15,1403.09 1191.46,1434.81 1193.76,1365.38 1196.07,1253.06 1198.38,1492.34 1200.69,1468.44 1203,1477.12 1205.3,1447.1 1207.61,1452.71 1209.92,1364.12 1212.23,1349.98 1214.54,1551.02 1216.84,1410.08 1219.15,1475.27 1221.46,1422.07 1223.77,1258.05 1226.08,1457.89 1228.38,1417.39 1230.69,1319.1 1233,1353.27 1235.31,1144.84 1237.61,1272.2 1239.92,1327.88 1242.23,1437.12 1244.54,1421.98 1246.85,1227.1 1249.15,1420.37 1251.46,1283.86 1253.77,1343.42 1256.08,1430.98 1258.39,1445.26 1260.69,1391.92 1263,1501.13 1265.31,1403.19 1267.62,1426.14 1269.93,1290.96 1272.23,1596.2 1274.54,1367.77 1276.85,1409.61 1279.16,1388.84 1281.47,1420.28 1283.77,1230.98 1286.08,1381.57 1288.39,1439.26 1290.7,1443.59 1293,1299.18 1295.31,1320.09 1297.62,1375.5 1299.93,1453.49 1302.24,1572.12 1304.54,1495.92 1306.85,1317.85 1309.16,1352.65 1311.47,1633.95 1313.78,1469.49 1316.08,1265.26 1318.39,1522.24 1320.7,1339.96 1323.01,1348.21 1325.32,1525.34 1327.62,1405.96 1329.93,1578.89 1332.24,1387.3 1334.55,1394.23 1336.86,1102.11 1339.16,1422.84 1341.47,1296.41 1343.78,1592.03 1346.09,1379.8 1348.39,1472.13 1350.7,1352.34 1353.01,1325.36 1355.32,1473.57 1357.63,1606.14 1359.93,1318.79 1362.24,1395.36 1364.55,1316.16 1366.86,1309.92 1369.17,1330.77 1371.47,1309.72 1373.78,1385.13 1376.09,1281.51 1378.4,1283.67 1380.71,1411.79 1383.01,1474.31 1385.32,1270.21 1387.63,1345.15 1389.94,1642.49 1392.24,1424.28 1394.55,1485.29 1396.86,1212.53 1399.17,1682.36 1401.48,1403.99 1403.78,1482.92 1406.09,1529.88 1408.4,1428.77 1410.71,1316.72 1413.02,1391.83 1415.32,1334.02 1417.63,1429.48 1419.94,1332.22 1422.25,1485.45 1424.56,1584.42 1426.86,1494.09 1429.17,1276.25 1431.48,1298.94 1433.79,1269.92 1436.1,1383.84 1438.4,1385.37 1440.71,1264.08 1443.02,1346.94 1445.33,1340.48 1447.63,1474.74 1449.94,1371.26 1452.25,1425.48 1454.56,1405.63 1456.87,1383.89 1459.17,1361.45 1461.48,1446.33 1463.79,1367.39 1466.1,1440.86 1468.41,1271.88 1470.71,1443.94 1473.02,1311.8 1475.33,1307.84 1477.64,1408.09 1479.95,1428.37 1482.25,1295.52 1484.56,1436.79 1486.87,1329.96 1489.18,1435.42 1491.49,1455.07 1493.79,1483.97 1496.1,1433.99 1498.41,1525.06 1500.72,1369.34 1503.02,1371.93 1505.33,1391.15 1507.64,1410.08 1509.95,1559.02 1512.26,1245.03 1514.56,1457.44 1516.87,1366.42 1519.18,1462.81 1521.49,1362.41 1523.8,1297.44 1526.1,1486.36 1528.41,1568.86 1530.72,1516.17 1533.03,1350.17 1535.34,1334.34 1537.64,1388.37 1539.95,1357.66 1542.26,1304.48 1544.57,1310.34 1546.88,1422.56 1549.18,1327.95 1551.49,1480 1553.8,1317.07 1556.11,1457.32 1558.41,1446.33 1560.72,1376.62 1563.03,1367.16 1565.34,1546.91 1567.65,1281.56 1569.95,1398.69 1572.26,1353.42 1574.57,1460.26 1576.88,1282.25 1579.19,1307.4 1581.49,1499.66 1583.8,1592.2 1586.11,1385.95 1588.42,1456.1 1590.73,1417.11 1593.03,1382.26 1595.34,1396.58 1597.65,1462.55 1599.96,1549.15 1602.26,1199.7 1604.57,1326.93 1606.88,1209.27 1609.19,1278.18 1611.5,1269.19 1613.8,1458.89 1616.11,1447.04 1618.42,1353.06 1620.73,1471.67 1623.04,1568.24 1625.34,1433.46 1627.65,1229.75 1629.96,1365.35 1632.27,1321.82 1634.58,1445.8 1636.88,1355.62 1639.19,1499.38 1641.5,1498.35 1643.81,1320.59 1646.12,1366.99 1648.42,1349.69 1650.73,1407.64 1653.04,1289.14 1655.35,1541.64 1657.65,1326.35 1659.96,1437.02 1662.27,1208.77 1664.58,1341.95 1666.89,1349.23 1669.19,1404.59 1671.5,1346.53 1673.81,1521.24 1676.12,1426.02 1678.43,1383.24 1680.73,1354.22 1683.04,1551.91 1685.35,1500.31 1687.66,1458.15 1689.97,1425.44 1692.27,1504.92 1694.58,1357.02 1696.89,1394.26 1699.2,1443.85 1701.51,1462.59 1703.81,1304.78 1706.12,1194.41 1708.43,1402.82 1710.74,1474.31 1713.04,1325.34 1715.35,1617.44 1717.66,1293.95 1719.97,1461.67 1722.28,1462.21 1724.58,1313.12 1726.89,1535.4 1729.2,1491.37 1731.51,1393.49 1733.82,1368.88 1736.12,1398.07 1738.43,1366.65 1740.74,1367.44 1743.05,1405.95 1745.36,1584.64 1747.66,1307.42 1749.97,1182.98 1752.28,1515.28 1754.59,1476.77 1756.9,1284.83 1759.2,1312.39 1761.51,1273.44 1763.82,1420.66 1766.13,1338.17 1768.43,1415.3 1770.74,1440.08 1773.05,1278.27 1775.36,1321.16 1777.67,1421.45 1779.97,1420.08 1782.28,1167.33 1784.59,1509.13 1786.9,1455.16 1789.21,1375.29 1791.51,1317.88 1793.82,1394.96 1796.13,1362.86 1798.44,1369.38 1800.75,1538.32 1803.05,1546.95 1805.36,1459.04 1807.67,1238.65 1809.98,1469.48 1812.28,1313.73 1814.59,1383.91 1816.9,1487.18 1819.21,1426.11 1821.52,1276.24 1823.82,1423.89 1826.13,1381.42 1828.44,1570.19 1830.75,1153.71 1833.06,1304.22 1835.36,1545.45 1837.67,1529.22 1839.98,1379.46 1842.29,1321.81 1844.6,1430.88 1846.9,1307.21 1849.21,1480.18 1851.52,1422.12 1853.83,1498.27 1856.14,1416.03 1858.44,1514.94 1860.75,1541.3 1863.06,1606.49 1865.37,1323.82 1867.67,1359.79 1869.98,1438.53 1872.29,1318.71 1874.6,1648.31 1876.91,1376.02 1879.21,1398.69 1881.52,1226.08 1883.83,1281.67 1886.14,1142.56 1888.45,1388.2 1890.75,1473.55 1893.06,1301.06 1895.37,1571.93 1897.68,1457.39 1899.99,1420.82 1902.29,1192.37 1904.6,1291.68 1906.91,1521.06 1909.22,1498.71 1911.53,1635.1 1913.83,1374.7 1916.14,1373.61 1918.45,1425.78 1920.76,1578.57 1923.06,1467.24 1925.37,1419.27 1927.68,1462.65 1929.99,1616.37 1932.3,1399.06 1934.6,1374.27 1936.91,1619.31 1939.22,1491.56 1941.53,1425.43 1943.84,1258.11 1946.14,1450.11 1948.45,1365.62 1950.76,1538.06 1953.07,1380.81 1955.38,1734.19 1957.68,1441.4 1959.99,1460.11 1962.3,1464.33 1964.61,1495.07 1966.91,1305.95 1969.22,1471.18 1971.53,1313.66 1973.84,1473.94 1976.15,1383.09 1978.45,1424.85 1980.76,1326.81 1983.07,1294.27 1985.38,1541.66 1987.69,1327.07 1989.99,1553.35 1992.3,1457.05 1994.61,1334.58 1996.92,1431.86 1999.23,1422.85 2001.53,1312.49 2003.84,1428.56 2006.15,1410.23 2008.46,1193.68 2010.77,1281.57 2013.07,1494.21 2015.38,1369.34 2017.69,1195.36 2020,1471.88 2022.3,1392.08 2024.61,1423.93 2026.92,1552.15 2029.23,1594.74 2031.54,1449.19 2033.84,1449.05 2036.15,1284.77 2038.46,1438.6 2040.77,1489.39 2043.08,1434.87 2045.38,1435.45 2047.69,1389.26 2050,1508.21 2052.31,1466.66 2054.62,1387.24 2056.92,1467.68 2059.23,1321.97 2061.54,1367.18 2063.85,1326.05 2066.16,1275.06 2068.46,1296.99 2070.77,1280.87 2073.08,1383.97 2075.39,1317.35 2077.69,1433.06 2080,1360.19 2082.31,1264.06 2084.62,1545.43 2086.93,1442.59 2089.23,1510.73 2091.54,1425.42 2093.85,1401.11 2096.16,1450.64 2098.47,1456.18 2100.77,1447.25 2103.08,1356.88 2105.39,1404.8 2107.7,1412.97 2110.01,1249.68 2112.31,1421 2114.62,1259.04 2116.93,1429.25 2119.24,1584.17 2121.55,1443.47 2123.85,1411.51 2126.16,1359.7 2128.47,1386.01 2130.78,1600.01 2133.08,1311.82 2135.39,1362.15 2137.7,1480.53 2140.01,1377.33 2142.32,1401.67 2144.62,1511.57 2146.93,1401.46 2149.24,1430.87 2151.55,1335.38 2153.86,1447.2 2156.16,1536.59 2158.47,1382.46 2160.78,1426.92 2163.09,1412.61 2165.4,1520.74 2167.7,1303.23 2170.01,1198.27 2172.32,1360.09 2174.63,1388.15 2176.93,1352.69 2179.24,1579.53 2181.55,1259.59 2183.86,1365.71 2186.17,1481.18 2188.47,1405.07 2190.78,1497.19 2193.09,1406.17 2195.4,1427.39 2197.71,1424.07 2200.01,1380.51 2202.32,1422.28 2204.63,1381.93 2206.94,1258.67 2209.25,1465.75 2211.55,1405.62 2213.86,1451.45 2216.17,1468.27 2218.48,1246.35 2220.79,1280.59 2223.09,1613.88 2225.4,1256.84 2227.71,1492.97 2230.02,1200.64 2232.32,1211.5 2234.63,1532.81 2236.94,1346.62 2239.25,1385.68 2241.56,1492.06 2243.86,1492.77 2246.17,1326.19 2248.48,1419.38 2250.79,1455.37 2253.1,1247.73 2255.4,1459.44 2257.71,1394.75 2260.02,1349.53 2262.33,1590.55 2264.64,1310.82 2266.94,1482.58 2269.25,1362.24 2271.56,1486.51 2273.87,1400.11 2276.18,1524.42 2278.48,1352.45 2280.79,1486.52 2283.1,1424.72 2285.41,1263.93 2287.71,1442.03 2290.02,1282.02 2292.33,1495.63 2294.64,1530.95 2296.95,1229.85 2299.25,1457.68 2301.56,1246.15 2303.87,1552.23 2306.18,1531.71 2308.49,1443.91 2310.79,1474.63 2313.1,1441.31 2315.41,1403.83 2317.72,1167.67 2320.03,1405.74 2322.33,1343.98 2324.64,1376.05 2326.95,1279.29 2329.26,1476.99 2331.56,1531.66 2333.87,1357.46 2336.18,1367.32 2338.49,1433.67 2340.8,1170.67 2343.1,1318.83 2345.41,1342.39 2347.72,1357.07 2350.03,1522.16 2352.34,1355.47 2354.64,1342.97 2356.95,1479.3 2359.26,1339.27 2361.57,1371.26 2363.88,1318.27 2366.18,1357.4 2368.49,1381.84 2370.8,1458.85 2373.11,1366.24 2375.42,1330.92 2377.72,1423.88 2380.03,1591.69 2382.34,1434.66 2384.65,1551.31 2386.95,1392.87 2389.26,1377.22 2391.57,1327.96 2393.88,1402.92 2396.19,1271.06 2398.49,1590.69 2400.8,1289.07 2403.11,1333.91 2405.42,1399.56 2407.73,1488.97 2410.03,1398.26 2412.34,1468.94 2414.65,1431.9 2416.96,1470.08 2419.27,1340.05 2421.57,1427.17 2423.88,1395.41 2426.19,1574.87 2428.5,1340.86 2430.81,1381.93 2433.11,1384.75 2435.42,1525.01 2437.73,1309.55 2440.04,1474.56 2442.34,1364.94 2444.65,1403.26 2446.96,1447.11 2449.27,1374.55 2451.58,1481.51 2453.88,1372.92 2456.19,1434.58 2458.5,1482.69 2460.81,1392.09 2463.12,1650.71 2465.42,1525.16 2467.73,1520.78 2470.04,1313.76 2472.35,1393.91 2474.66,1423.63 2476.96,1391.56 2479.27,1379.77 2481.58,1445.78 2483.89,1435.37 2486.2,1410.25 2488.5,1314.5 2490.81,1364.63 2493.12,1461.77 2495.43,1402.66 2497.73,1491.06 2500.04,1310.45 2502.35,1513.89 2504.66,1360.19 2506.97,1293.94 2509.27,1490.69 2511.58,1257.72 2513.89,1447.51 2516.2,1535.75 2518.51,1569.16 2520.81,1351.87 2523.12,1268.12 2525.43,1337.58 2527.74,1446.44 2530.05,1435.65 2532.35,1604.07 2534.66,1411.25 2536.97,1367.89 2539.28,1355.19 2541.58,1332.28 2543.89,1446.83 2546.2,1346.26 2548.51,1570.8 2550.82,1567.62 2553.12,1338.97 2555.43,1359.81 2557.74,1347.38 2560.05,1367.4 2562.36,1313.91 2564.66,1339.35 2566.97,1630.44 2569.28,1289.86 2571.59,1355.74 "></polyline>
<polyline clip-path="url(#clip972)" style="stroke:#e26f46; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="265.984,1124.22 268.292,1036.25 270.6,944.63 272.908,784.868 275.216,670.499 277.524,1025.3 279.832,921.489 282.139,1215.88 284.447,1037.28 286.755,916.49 289.063,842.826 291.371,1046.65 293.679,931.281 295.987,812.441 298.295,887.913 300.603,999.049 302.911,882.609 305.219,1009.24 307.527,737.708 309.834,857.476 312.142,873.805 314.45,858.052 316.758,977.67 319.066,918.628 321.374,911.897 323.682,1029.83 325.99,947.85 328.298,876.305 330.606,885.39 332.914,820.17 335.221,838.398 337.529,908.254 339.837,1030.11 342.145,900.588 344.453,945.343 346.761,1004.68 349.069,940.111 351.377,1029.7 353.685,934.317 355.993,838.247 358.301,956.557 360.608,1050.04 362.916,864.317 365.224,882.798 367.532,1043.23 369.84,1126.21 372.148,1024.38 374.456,873.323 376.764,818.715 379.072,877.814 381.38,983.443 383.688,812.02 385.996,1013.2 388.303,905.651 390.611,963.671 392.919,710.866 395.227,840.797 397.535,1002.42 399.843,878.874 402.151,958.118 404.459,907.448 406.767,920.692 409.075,859.415 411.383,889.47 413.69,974.456 415.998,963.735 418.306,985.859 420.614,995.204 422.922,865.068 425.23,978.614 427.538,722.418 429.846,1059.43 432.154,924.118 434.462,928.826 436.77,966.678 439.077,787.639 441.385,843.607 443.693,914.146 446.001,909.125 448.309,1003.22 450.617,676.637 452.925,938.829 455.233,773.868 457.541,865.709 459.849,905.446 462.157,884.013 464.465,900.762 466.772,826.795 469.08,1008.04 471.388,811.143 473.696,968.647 476.004,902.066 478.312,1077.86 480.62,1030.87 482.928,993.033 485.236,783.501 487.544,1019.1 489.852,876.536 492.159,841.902 494.467,840.352 496.775,886.302 499.083,936.501 501.391,858.614 503.699,872.632 506.007,980.086 508.315,834.41 510.623,786.302 512.931,723.669 515.239,898.034 517.546,829.889 519.854,912.65 522.162,823.777 524.47,739.168 526.778,771.796 529.086,1037.43 531.394,902.675 533.702,813.091 536.01,1033.28 538.318,930.833 540.626,1080.72 542.933,822.528 545.241,1012.58 547.549,894.911 549.857,1029.18 552.165,849.689 554.473,1023.76 556.781,971.983 559.089,1035.5 561.397,919.192 563.705,793.177 566.013,788.947 568.321,819.965 570.628,1044.08 572.936,914.544 575.244,851.704 577.552,855.168 579.86,1032.97 582.168,829.251 584.476,999.678 586.784,781.273 589.092,837.552 591.4,1059.8 593.708,985.061 596.015,892.169 598.323,941.991 600.631,744.211 602.939,914.164 605.247,752.989 607.555,1043.09 609.863,951.318 612.171,890.607 614.479,935.24 616.787,918.07 619.095,901.578 621.402,918.25 623.71,839.662 626.018,846.651 628.326,851.665 630.634,820.649 632.942,1071.73 635.25,742.771 637.558,1165.29 639.866,965.023 642.174,891.117 644.482,870.318 646.79,1137.78 649.097,913.805 651.405,846.142 653.713,988.572 656.021,1014.13 658.329,1022.87 660.637,867.011 662.945,724.939 665.253,1007.99 667.561,850.162 669.869,980.308 672.177,1067.03 674.484,837.657 676.792,870.665 679.1,930.747 681.408,880.845 683.716,857.877 686.024,793.902 688.332,803.159 690.64,844.419 692.948,961.588 695.256,850.713 697.564,864.42 699.871,946.871 702.179,1027.38 704.487,858.222 706.795,1016.05 709.103,761.631 711.411,924.359 713.719,881.582 716.027,899.514 718.335,1006.77 720.643,882.656 722.951,913.551 725.259,1125.11 727.566,862.365 729.874,819.169 732.182,990.395 734.49,861.44 736.798,1002.11 739.106,981.016 741.414,905.342 743.722,825.133 746.03,870.051 748.338,874.578 750.646,925.482 752.953,991.556 755.261,864.965 757.569,1052.42 759.877,946.983 762.185,1035.97 764.493,902.191 766.801,982.042 769.109,860.336 771.417,749.127 773.725,935.917 776.033,882.168 778.34,828.943 780.648,875.817 782.956,883.086 785.264,893.735 787.572,846.2 789.88,850.532 792.188,966.536 794.496,1020.91 796.804,877.3 799.112,926.356 801.42,990.446 803.728,1003.45 806.035,1023.93 808.343,789.752 810.651,811.092 812.959,771.692 815.267,973.239 817.575,920.334 819.883,889.741 822.191,989.012 824.499,755.628 826.807,695.687 829.115,843.058 831.422,988.388 833.73,968.747 836.038,917.742 838.346,939.738 840.654,806.27 842.962,926.894 845.27,818.538 847.578,800.317 849.886,894.381 852.194,900.882 854.502,754.192 856.809,894.316 859.117,960.213 861.425,852.309 863.733,864.745 866.041,907.327 868.349,1004.44 870.657,922.696 872.965,712.596 875.273,787.709 877.581,983.251 879.889,986.047 882.197,983.736 884.504,906.005 886.812,751.503 889.12,896.001 891.428,928.483 893.736,873.3 896.044,1085.67 898.352,910.506 900.66,909.492 902.968,796.026 905.276,905.85 907.584,888.439 909.891,840.467 912.199,1019.88 914.507,961.962 916.815,811.708 919.123,997.938 921.431,1164.64 923.739,931.513 926.047,917.584 928.355,809.534 930.663,870.836 932.971,798.758 935.278,834.269 937.586,939.047 939.894,979.591 942.202,910.181 944.51,1232.36 946.818,868.422 949.126,996.476 951.434,978.551 953.742,812.341 956.05,957.02 958.358,813.476 960.665,753 962.973,1051.07 965.281,926.898 967.589,1007.25 969.897,850.869 972.205,1026.04 974.513,851.883 976.821,781.949 979.129,938.215 981.437,870.702 983.745,978.845 986.053,886.114 988.36,910.477 990.668,789.599 992.976,718.392 995.284,890.207 997.592,1125.73 999.9,866.363 1002.21,1081.56 1004.52,810.981 1006.82,1045.71 1009.13,868.113 1011.44,1026.02 1013.75,974.598 1016.06,881.578 1018.36,1066.25 1020.67,699.318 1022.98,950.155 1025.29,934.991 1027.59,648.353 1029.9,809.616 1032.21,968.743 1034.52,759.663 1036.83,884.778 1039.13,995.045 1041.44,823.94 1043.75,896.869 1046.06,872.906 1048.37,847.461 1050.67,910.172 1052.98,937.701 1055.29,906.236 1057.6,851.134 1059.91,872.909 1062.21,701.07 1064.52,987.88 1066.83,901.52 1069.14,976.275 1071.45,965.839 1073.75,707.348 1076.06,858.251 1078.37,859.01 1080.68,749.155 1082.98,923.608 1085.29,1140.03 1087.6,1048.13 1089.91,955.415 1092.22,1125.13 1094.52,879.094 1096.83,1024.1 1099.14,966.766 1101.45,702.977 1103.76,972.673 1106.06,827.339 1108.37,934.871 1110.68,1105.57 1112.99,806.195 1115.3,979.169 1117.6,874.297 1119.91,939.074 1122.22,1041.41 1124.53,981.79 1126.84,978.137 1129.14,981.072 1131.45,935.223 1133.76,600.051 1136.07,1008.08 1138.37,962.176 1140.68,852.754 1142.99,736.7 1145.3,831.504 1147.61,946.52 1149.91,931.834 1152.22,997.966 1154.53,817.824 1156.84,962.425 1159.15,816.12 1161.45,869.733 1163.76,939.11 1166.07,859.425 1168.38,914.569 1170.69,1034.89 1172.99,964.79 1175.3,1019.2 1177.61,848.654 1179.92,997.755 1182.23,948.133 1184.53,1026.57 1186.84,892.015 1189.15,987.91 1191.46,728.214 1193.76,968.022 1196.07,953.836 1198.38,839.294 1200.69,816.797 1203,901.134 1205.3,881.9 1207.61,870.922 1209.92,1020.02 1212.23,801.368 1214.54,690.449 1216.84,905.546 1219.15,976.093 1221.46,866.88 1223.77,860.481 1226.08,891.32 1228.38,854.369 1230.69,880.482 1233,849.037 1235.31,1054.92 1237.61,901.833 1239.92,878.962 1242.23,788.914 1244.54,870.561 1246.85,1005.03 1249.15,1001.06 1251.46,953.472 1253.77,876.906 1256.08,1074.54 1258.39,747.375 1260.69,880.988 1263,809.324 1265.31,1080.67 1267.62,881.702 1269.93,829.516 1272.23,1077.06 1274.54,790.313 1276.85,926.19 1279.16,956.825 1281.47,801.442 1283.77,830.64 1286.08,725.624 1288.39,759.524 1290.7,834.928 1293,999.869 1295.31,969.621 1297.62,1010.68 1299.93,887.905 1302.24,975.615 1304.54,936.7 1306.85,955.788 1309.16,823.59 1311.47,826.208 1313.78,990.054 1316.08,936.637 1318.39,919.151 1320.7,854.748 1323.01,968.679 1325.32,935.415 1327.62,938.549 1329.93,794.286 1332.24,940.401 1334.55,898.696 1336.86,1150.09 1339.16,793.198 1341.47,918.6 1343.78,922.204 1346.09,1008.86 1348.39,832.573 1350.7,984.371 1353.01,853.609 1355.32,770.896 1357.63,858.714 1359.93,813.006 1362.24,1036.87 1364.55,955.578 1366.86,976.871 1369.17,936.467 1371.47,1025.15 1373.78,969.282 1376.09,806.011 1378.4,746.609 1380.71,1004.83 1383.01,858.25 1385.32,963.603 1387.63,1022.22 1389.94,994.11 1392.24,938.005 1394.55,874.38 1396.86,885.569 1399.17,727.966 1401.48,960.025 1403.78,900.79 1406.09,966.786 1408.4,879.589 1410.71,962.064 1413.02,874.331 1415.32,942.07 1417.63,889.416 1419.94,881.778 1422.25,869.662 1424.56,994.199 1426.86,964.369 1429.17,1000.79 1431.48,1052.49 1433.79,961.866 1436.1,991.676 1438.4,1010.24 1440.71,976.578 1443.02,882.084 1445.33,1162.74 1447.63,918.458 1449.94,864.396 1452.25,798.699 1454.56,889.244 1456.87,903.693 1459.17,1155.98 1461.48,835.442 1463.79,943.941 1466.1,877.645 1468.41,828.286 1470.71,1004.33 1473.02,806.805 1475.33,1082.64 1477.64,833.973 1479.95,738.303 1482.25,914.375 1484.56,886.482 1486.87,919.225 1489.18,1106.4 1491.49,840.351 1493.79,708.056 1496.1,897.8 1498.41,826.636 1500.72,845.693 1503.02,1042.66 1505.33,923.358 1507.64,872.704 1509.95,899.645 1512.26,823.724 1514.56,1065.81 1516.87,952.114 1519.18,972.354 1521.49,872.151 1523.8,965.683 1526.1,880.44 1528.41,829.96 1530.72,860.555 1533.03,964.391 1535.34,1054.74 1537.64,972.801 1539.95,888.343 1542.26,997.611 1544.57,836.144 1546.88,867.944 1549.18,831.745 1551.49,1118 1553.8,957.85 1556.11,983.402 1558.41,792.665 1560.72,894.115 1563.03,860.497 1565.34,1094.53 1567.65,837.566 1569.95,819.399 1572.26,842.928 1574.57,833.207 1576.88,857.755 1579.19,1074.01 1581.49,976.614 1583.8,889.334 1586.11,880.09 1588.42,827.59 1590.73,1035.27 1593.03,892.248 1595.34,763.343 1597.65,1094.46 1599.96,824.57 1602.26,913.82 1604.57,814.809 1606.88,763.86 1609.19,994.015 1611.5,910.911 1613.8,974.561 1616.11,888.562 1618.42,1030.42 1620.73,872.061 1623.04,955.763 1625.34,998.613 1627.65,918.024 1629.96,927.746 1632.27,927.985 1634.58,1006.85 1636.88,916.171 1639.19,904.177 1641.5,914.087 1643.81,962.02 1646.12,910.974 1648.42,640.785 1650.73,1062.09 1653.04,867.885 1655.35,851.118 1657.65,845.047 1659.96,875.352 1662.27,794.016 1664.58,989.033 1666.89,974.026 1669.19,1012.52 1671.5,963.633 1673.81,795.787 1676.12,988.334 1678.43,757.377 1680.73,899.436 1683.04,783.39 1685.35,754.698 1687.66,1003.91 1689.97,1038.88 1692.27,847.871 1694.58,877.981 1696.89,909.45 1699.2,859.467 1701.51,860.542 1703.81,809.918 1706.12,975.619 1708.43,928.6 1710.74,1005.21 1713.04,1018.29 1715.35,878.331 1717.66,754.848 1719.97,802.916 1722.28,1072.05 1724.58,859.36 1726.89,800.665 1729.2,976.621 1731.51,919.894 1733.82,889.618 1736.12,805.819 1738.43,855.786 1740.74,838.871 1743.05,977.546 1745.36,1007.21 1747.66,973.288 1749.97,784.246 1752.28,808.243 1754.59,747.807 1756.9,749.061 1759.2,846.159 1761.51,1043.17 1763.82,1007.63 1766.13,976.859 1768.43,1044.66 1770.74,775.278 1773.05,1065.06 1775.36,954.73 1777.67,807.577 1779.97,799.626 1782.28,1141.05 1784.59,1031.11 1786.9,1041.03 1789.21,881.614 1791.51,912.488 1793.82,953.088 1796.13,885.99 1798.44,1045.86 1800.75,870.401 1803.05,722.438 1805.36,898.951 1807.67,1005.42 1809.98,928.511 1812.28,943.076 1814.59,955.037 1816.9,766.178 1819.21,766.594 1821.52,795.891 1823.82,1068.71 1826.13,1108.35 1828.44,966.994 1830.75,960.284 1833.06,880.485 1835.36,723.284 1837.67,726.918 1839.98,888.268 1842.29,1063.21 1844.6,848.35 1846.9,832.127 1849.21,971.406 1851.52,1067.29 1853.83,1208.16 1856.14,1017.88 1858.44,918.122 1860.75,867.733 1863.06,939.394 1865.37,817.475 1867.67,932.121 1869.98,885.764 1872.29,778.735 1874.6,913.947 1876.91,879.708 1879.21,933.808 1881.52,993.336 1883.83,929.237 1886.14,1047.18 1888.45,925.165 1890.75,864.682 1893.06,939.482 1895.37,940.246 1897.68,897.918 1899.99,912.752 1902.29,923.401 1904.6,990.902 1906.91,912.914 1909.22,1093.4 1911.53,860.911 1913.83,1078.21 1916.14,916.934 1918.45,1168.72 1920.76,810.806 1923.06,891.107 1925.37,814.067 1927.68,801.329 1929.99,759.579 1932.3,920.709 1934.6,892.304 1936.91,1069.8 1939.22,926.851 1941.53,942.038 1943.84,882.909 1946.14,885.798 1948.45,878.98 1950.76,1119.12 1953.07,759.992 1955.38,935.271 1957.68,965.605 1959.99,892.084 1962.3,788.119 1964.61,881.973 1966.91,1020.14 1969.22,1122.55 1971.53,781.465 1973.84,806.797 1976.15,1097.88 1978.45,715.353 1980.76,864.738 1983.07,820.09 1985.38,871.382 1987.69,952.805 1989.99,1022.46 1992.3,857.958 1994.61,1001.45 1996.92,730.071 1999.23,997.21 2001.53,1071.54 2003.84,1042.65 2006.15,938.056 2008.46,978.892 2010.77,825.02 2013.07,892.571 2015.38,640.325 2017.69,992.769 2020,980.942 2022.3,845.335 2024.61,777.047 2026.92,866.201 2029.23,921.312 2031.54,870.963 2033.84,821.724 2036.15,884.505 2038.46,988.793 2040.77,770.446 2043.08,1012.41 2045.38,843.414 2047.69,972.309 2050,856.708 2052.31,857.069 2054.62,763.816 2056.92,790.292 2059.23,838.441 2061.54,981.702 2063.85,815.136 2066.16,666.441 2068.46,778.713 2070.77,880.996 2073.08,941.87 2075.39,862.034 2077.69,1034.03 2080,886.905 2082.31,770.741 2084.62,808.554 2086.93,792.344 2089.23,877.278 2091.54,861.139 2093.85,888.768 2096.16,880.388 2098.47,945.381 2100.77,866.911 2103.08,969.266 2105.39,776.796 2107.7,991.229 2110.01,790.581 2112.31,1140.8 2114.62,928.204 2116.93,916.863 2119.24,967.308 2121.55,973.362 2123.85,718.278 2126.16,1125.08 2128.47,969.245 2130.78,1002.36 2133.08,899.362 2135.39,633.983 2137.7,854.439 2140.01,825.843 2142.32,905.105 2144.62,829.387 2146.93,1084.66 2149.24,984.56 2151.55,873.341 2153.86,821.777 2156.16,717.323 2158.47,992.639 2160.78,1006.35 2163.09,912.249 2165.4,895.758 2167.7,923.022 2170.01,834.449 2172.32,944.715 2174.63,1144.15 2176.93,926.573 2179.24,895.502 2181.55,907.278 2183.86,969.623 2186.17,835.709 2188.47,1000.29 2190.78,934.131 2193.09,924.603 2195.4,731.427 2197.71,941.087 2200.01,840.669 2202.32,904.042 2204.63,1084.76 2206.94,933.357 2209.25,832.568 2211.55,821.853 2213.86,917.977 2216.17,856.678 2218.48,896.989 2220.79,970.994 2223.09,890.851 2225.4,1046.27 2227.71,1117.08 2230.02,907.594 2232.32,1005.14 2234.63,932.114 2236.94,988.637 2239.25,1120.97 2241.56,1124.53 2243.86,917.551 2246.17,808.635 2248.48,797.813 2250.79,702.372 2253.1,911.442 2255.4,965.008 2257.71,1173.01 2260.02,1028.87 2262.33,1003.49 2264.64,947.193 2266.94,798.588 2269.25,867.276 2271.56,787.117 2273.87,1076.91 2276.18,937.629 2278.48,869.728 2280.79,1004.42 2283.1,1027.1 2285.41,1094.02 2287.71,766.283 2290.02,924.542 2292.33,789.926 2294.64,983.223 2296.95,998.67 2299.25,888.254 2301.56,1045.24 2303.87,940.483 2306.18,842.599 2308.49,892.09 2310.79,907.47 2313.1,967.48 2315.41,971.451 2317.72,760.948 2320.03,950.798 2322.33,757.728 2324.64,952.329 2326.95,884.093 2329.26,1024.01 2331.56,878.559 2333.87,965.393 2336.18,839.748 2338.49,912.035 2340.8,1014.06 2343.1,949.503 2345.41,1060.42 2347.72,880.179 2350.03,885.238 2352.34,906.797 2354.64,811.007 2356.95,831.062 2359.26,858.382 2361.57,1062.87 2363.88,658.661 2366.18,930.835 2368.49,978.937 2370.8,894.54 2373.11,777.802 2375.42,822.336 2377.72,899.152 2380.03,873.622 2382.34,933.391 2384.65,910.748 2386.95,936.664 2389.26,1006.36 2391.57,891.126 2393.88,911.297 2396.19,1066.32 2398.49,958.95 2400.8,753.048 2403.11,976.202 2405.42,774.561 2407.73,987.574 2410.03,906.844 2412.34,968.151 2414.65,845.047 2416.96,764.304 2419.27,949.497 2421.57,917.142 2423.88,849.131 2426.19,973.249 2428.5,929.775 2430.81,969.166 2433.11,1016.94 2435.42,823.009 2437.73,955.72 2440.04,1021.41 2442.34,862.957 2444.65,925.272 2446.96,819.419 2449.27,1036.7 2451.58,938.963 2453.88,763.194 2456.19,892.056 2458.5,976.362 2460.81,895.963 2463.12,792.316 2465.42,755.638 2467.73,998.578 2470.04,779.336 2472.35,755.563 2474.66,868.968 2476.96,933.719 2479.27,795.758 2481.58,788.724 2483.89,862.11 2486.2,913.754 2488.5,878.264 2490.81,712.074 2493.12,867.248 2495.43,914.349 2497.73,913.301 2500.04,931.822 2502.35,830.066 2504.66,962.323 2506.97,994.769 2509.27,938.7 2511.58,786.288 2513.89,757.299 2516.2,885.756 2518.51,890.61 2520.81,853.989 2523.12,768.316 2525.43,785.745 2527.74,886.299 2530.05,1018.58 2532.35,1035.55 2534.66,945.127 2536.97,1008.76 2539.28,873.799 2541.58,792.431 2543.89,1035.07 2546.2,992.599 2548.51,883.603 2550.82,697.807 2553.12,821.171 2555.43,886.463 2557.74,938.946 2560.05,913.365 2562.36,826.273 2564.66,957.506 2566.97,946.196 2569.28,988.012 2571.59,871.171 "></polyline>
<polyline clip-path="url(#clip972)" style="stroke:#3da44d; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="265.984,837.373 268.292,466.853 270.6,484.711 272.908,500.861 275.216,518.829 277.524,492.588 279.832,361.578 282.139,386.636 284.447,428.729 286.755,424.838 289.063,440.276 291.371,634.301 293.679,477.084 295.987,597.968 298.295,212.229 300.603,490.525 302.911,420.767 305.219,435.385 307.527,531.856 309.834,430.429 312.142,449.573 314.45,455.768 316.758,364.588 319.066,469.59 321.374,359.726 323.682,222.655 325.99,436.165 328.298,300.155 330.606,514.342 332.914,425.822 335.221,471.965 337.529,489.587 339.837,423.306 342.145,517.091 344.453,450.89 346.761,651.645 349.069,365.868 351.377,583.546 353.685,366.868 355.993,507.627 358.301,300.138 360.608,343.667 362.916,564.46 365.224,354.082 367.532,435.215 369.84,565.628 372.148,449.501 374.456,207.333 376.764,313.699 379.072,186.499 381.38,365.837 383.688,413.668 385.996,464.465 388.303,411.348 390.611,543.56 392.919,583.295 395.227,424.187 397.535,459.95 399.843,549.406 402.151,354.844 404.459,282.81 406.767,222.253 409.075,570.844 411.383,559.617 413.69,467.253 415.998,366.184 418.306,544.724 420.614,405.363 422.922,439.962 425.23,461.404 427.538,352.247 429.846,353.144 432.154,381.523 434.462,477.288 436.77,315.977 439.077,394.095 441.385,445.913 443.693,350.193 446.001,500.001 448.309,282.312 450.617,509.262 452.925,275.833 455.233,537.448 457.541,387.632 459.849,424.996 462.157,578.825 464.465,281.83 466.772,442.113 469.08,301.114 471.388,536.082 473.696,446.69 476.004,326.057 478.312,391.049 480.62,667.84 482.928,456.316 485.236,555.986 487.544,460.269 489.852,253.316 492.159,272.513 494.467,480.246 496.775,383.163 499.083,396.48 501.391,365.623 503.699,480.541 506.007,448.854 508.315,328.976 510.623,379.102 512.931,474.979 515.239,420.786 517.546,565.539 519.854,574.428 522.162,531.315 524.47,253.74 526.778,460.49 529.086,536.234 531.394,442.458 533.702,183.58 536.01,504.061 538.318,433.963 540.626,574.431 542.933,488.679 545.241,446.552 547.549,493.023 549.857,443.065 552.165,429.381 554.473,542.536 556.781,329 559.089,501.501 561.397,542.422 563.705,280.377 566.013,485.584 568.321,424.983 570.628,435.492 572.936,503.969 575.244,327.768 577.552,358.985 579.86,397.872 582.168,431.182 584.476,304.855 586.784,339.38 589.092,443.27 591.4,631.603 593.708,510.963 596.015,343.475 598.323,405.458 600.631,397.371 602.939,584.996 605.247,384.548 607.555,450.067 609.863,519.52 612.171,410.805 614.479,478.476 616.787,310.791 619.095,464.063 621.402,459.411 623.71,532.001 626.018,426.146 628.326,410.394 630.634,480.896 632.942,358.553 635.25,430.476 637.558,272.467 639.866,558.834 642.174,492.657 644.482,454.922 646.79,342.923 649.097,226.372 651.405,424.492 653.713,494.094 656.021,551.87 658.329,384.066 660.637,264.681 662.945,501.333 665.253,419.801 667.561,474.942 669.869,345.955 672.177,454.97 674.484,309.655 676.792,426.865 679.1,466.019 681.408,397.87 683.716,456.703 686.024,413.347 688.332,517.652 690.64,398.619 692.948,508.281 695.256,462.226 697.564,400.672 699.871,317.094 702.179,177.841 704.487,215.423 706.795,491.216 709.103,545.851 711.411,486.762 713.719,340.314 716.027,479.287 718.335,369.912 720.643,497.055 722.951,504.269 725.259,339.655 727.566,360.205 729.874,475.409 732.182,620.266 734.49,397.506 736.798,470.334 739.106,542.349 741.414,317.606 743.722,425.255 746.03,357.782 748.338,312.411 750.646,489.238 752.953,348.632 755.261,96.8724 757.569,399.101 759.877,469.655 762.185,502.036 764.493,425.767 766.801,491.157 769.109,526.847 771.417,564.365 773.725,452.597 776.033,691.525 778.34,513.805 780.648,566.532 782.956,375.801 785.264,556.073 787.572,492.305 789.88,419.881 792.188,556.227 794.496,506.649 796.804,666.328 799.112,308.703 801.42,495.794 803.728,349.367 806.035,362.455 808.343,573.611 810.651,353.626 812.959,373.35 815.267,348.897 817.575,397.679 819.883,418.72 822.191,535.521 824.499,441.689 826.807,222.307 829.115,395.822 831.422,399.062 833.73,569.793 836.038,319.863 838.346,343.101 840.654,326.358 842.962,243.387 845.27,441.742 847.578,446.828 849.886,393.005 852.194,423.54 854.502,433.792 856.809,490.78 859.117,544.426 861.425,529.046 863.733,545.96 866.041,519.992 868.349,537.457 870.657,590.647 872.965,582.012 875.273,533.103 877.581,273.304 879.889,453.665 882.197,334.429 884.504,522.141 886.812,376.557 889.12,442.236 891.428,406.808 893.736,287.938 896.044,183.922 898.352,280.529 900.66,381.946 902.968,458.937 905.276,420.555 907.584,462.855 909.891,421.071 912.199,289.822 914.507,275.629 916.815,325.522 919.123,313.761 921.431,448.833 923.739,451.47 926.047,398.454 928.355,473.269 930.663,492.868 932.971,422.092 935.278,316.796 937.586,411.066 939.894,493.868 942.202,360.383 944.51,419.715 946.818,351.952 949.126,559.134 951.434,489.483 953.742,476.237 956.05,530.036 958.358,295.193 960.665,487.195 962.973,503.072 965.281,449.072 967.589,408.518 969.897,359.573 972.205,403.125 974.513,372.072 976.821,421.592 979.129,334.942 981.437,505.491 983.745,422.828 986.053,397.895 988.36,118.44 990.668,434.553 992.976,412.772 995.284,297.709 997.592,534.871 999.9,522.97 1002.21,540.428 1004.52,496.458 1006.82,507.153 1009.13,421.689 1011.44,507.606 1013.75,307.72 1016.06,415.036 1018.36,515.411 1020.67,297.675 1022.98,428.937 1025.29,441.306 1027.59,323.534 1029.9,492.932 1032.21,296.329 1034.52,524.618 1036.83,444.399 1039.13,552.388 1041.44,351.494 1043.75,335.993 1046.06,465.303 1048.37,294.766 1050.67,431.222 1052.98,433.277 1055.29,533.527 1057.6,352.645 1059.91,394.623 1062.21,461.015 1064.52,387.672 1066.83,304.873 1069.14,359.093 1071.45,466.007 1073.75,468.707 1076.06,612.964 1078.37,301.313 1080.68,573.179 1082.98,425.481 1085.29,382.401 1087.6,343.676 1089.91,309.714 1092.22,264.972 1094.52,400.117 1096.83,444.359 1099.14,706.427 1101.45,451.889 1103.76,338.736 1106.06,465.279 1108.37,489.459 1110.68,438.969 1112.99,395.586 1115.3,342.878 1117.6,402.059 1119.91,369.896 1122.22,397.341 1124.53,327.941 1126.84,463.323 1129.14,473.293 1131.45,452.219 1133.76,439.401 1136.07,470.944 1138.37,414.932 1140.68,606.993 1142.99,689.312 1145.3,502.455 1147.61,304.161 1149.91,437.884 1152.22,471.098 1154.53,427.468 1156.84,344.829 1159.15,375.95 1161.45,468.438 1163.76,513.176 1166.07,438.693 1168.38,344.82 1170.69,539.489 1172.99,383.866 1175.3,574.331 1177.61,449.387 1179.92,533.786 1182.23,454.964 1184.53,330.287 1186.84,420.492 1189.15,297.408 1191.46,494.369 1193.76,397.634 1196.07,422.027 1198.38,369.877 1200.69,503.779 1203,434.937 1205.3,580.829 1207.61,434.424 1209.92,518.013 1212.23,289.918 1214.54,399.065 1216.84,224.187 1219.15,371.3 1221.46,354.084 1223.77,175.757 1226.08,394.075 1228.38,254.614 1230.69,488.952 1233,426.418 1235.31,442.252 1237.61,271.972 1239.92,376.814 1242.23,430.215 1244.54,484.909 1246.85,344.189 1249.15,461.629 1251.46,416.18 1253.77,518.886 1256.08,479.576 1258.39,550.405 1260.69,508.921 1263,510.314 1265.31,294.997 1267.62,622.35 1269.93,256.748 1272.23,354.508 1274.54,327.264 1276.85,353.243 1279.16,498.721 1281.47,551.348 1283.77,384.252 1286.08,406.059 1288.39,598.769 1290.7,436.506 1293,479.21 1295.31,253.943 1297.62,381.639 1299.93,334.052 1302.24,437.047 1304.54,388.455 1306.85,475.401 1309.16,330.472 1311.47,297.657 1313.78,474.968 1316.08,514.325 1318.39,352.114 1320.7,382.553 1323.01,374.318 1325.32,357.773 1327.62,534.376 1329.93,311.329 1332.24,479.728 1334.55,466.305 1336.86,557.397 1339.16,449.596 1341.47,425.809 1343.78,510.673 1346.09,375.842 1348.39,546.325 1350.7,448.443 1353.01,501.725 1355.32,253.56 1357.63,473.343 1359.93,366.411 1362.24,357.026 1364.55,468.835 1366.86,392.939 1369.17,508.177 1371.47,416.064 1373.78,399.258 1376.09,508.54 1378.4,420.308 1380.71,484.227 1383.01,427.213 1385.32,419.359 1387.63,304.034 1389.94,271.119 1392.24,390.105 1394.55,336.131 1396.86,343.263 1399.17,527.301 1401.48,480.079 1403.78,511.006 1406.09,261.492 1408.4,493.345 1410.71,394.8 1413.02,575.606 1415.32,281.445 1417.63,177.321 1419.94,398.143 1422.25,343.844 1424.56,294.055 1426.86,416.667 1429.17,288.045 1431.48,313.903 1433.79,371.702 1436.1,301.249 1438.4,393.33 1440.71,387.13 1443.02,429.417 1445.33,564.853 1447.63,456.083 1449.94,366.062 1452.25,474.571 1454.56,469.369 1456.87,252.562 1459.17,379.284 1461.48,202.159 1463.79,291.88 1466.1,343.712 1468.41,484.482 1470.71,300.652 1473.02,365.898 1475.33,454.385 1477.64,459.986 1479.95,419.186 1482.25,390.616 1484.56,533.828 1486.87,443.671 1489.18,470.686 1491.49,641.1 1493.79,407.185 1496.1,454.884 1498.41,479.643 1500.72,512.415 1503.02,548.249 1505.33,356.157 1507.64,454.721 1509.95,436.223 1512.26,550.559 1514.56,599.694 1516.87,598.444 1519.18,473.648 1521.49,484.525 1523.8,473.38 1526.1,457.729 1528.41,513.239 1530.72,460.27 1533.03,448.596 1535.34,460.443 1537.64,446.979 1539.95,375.581 1542.26,558.724 1544.57,544.245 1546.88,230.079 1549.18,283.204 1551.49,422.591 1553.8,363.95 1556.11,402.803 1558.41,331.871 1560.72,431.285 1563.03,464.435 1565.34,451.876 1567.65,383.799 1569.95,453.944 1572.26,268.756 1574.57,406.103 1576.88,324.664 1579.19,492.875 1581.49,498.407 1583.8,366.675 1586.11,514.593 1588.42,419.222 1590.73,341.373 1593.03,356.14 1595.34,348.524 1597.65,359.974 1599.96,341.971 1602.26,443.74 1604.57,322.786 1606.88,446.601 1609.19,431.152 1611.5,411.274 1613.8,382.015 1616.11,307.21 1618.42,573.822 1620.73,407.483 1623.04,516.959 1625.34,467.159 1627.65,452.591 1629.96,363.942 1632.27,437.255 1634.58,261.729 1636.88,546.678 1639.19,421.135 1641.5,468.055 1643.81,546.527 1646.12,291.409 1648.42,216.216 1650.73,483.481 1653.04,447.035 1655.35,389.132 1657.65,423.143 1659.96,365.958 1662.27,324.226 1664.58,593.867 1666.89,483.951 1669.19,237.709 1671.5,467.815 1673.81,276.707 1676.12,470.822 1678.43,376.209 1680.73,598.376 1683.04,373.022 1685.35,466.841 1687.66,625.97 1689.97,629.918 1692.27,255.946 1694.58,379.337 1696.89,310.462 1699.2,463.967 1701.51,276.817 1703.81,317.511 1706.12,385.73 1708.43,353.38 1710.74,331.077 1713.04,351.305 1715.35,497.143 1717.66,379.269 1719.97,515.907 1722.28,392.072 1724.58,428.578 1726.89,500.513 1729.2,387.508 1731.51,328.389 1733.82,485.26 1736.12,400.241 1738.43,460.744 1740.74,470.348 1743.05,349.415 1745.36,461.309 1747.66,501.99 1749.97,440.422 1752.28,281.288 1754.59,330.723 1756.9,530.967 1759.2,239.557 1761.51,445.692 1763.82,326.194 1766.13,305.048 1768.43,592.469 1770.74,416.14 1773.05,505.854 1775.36,284.785 1777.67,576.501 1779.97,465.015 1782.28,415.585 1784.59,470.212 1786.9,306.908 1789.21,269.294 1791.51,556.45 1793.82,254.55 1796.13,556.007 1798.44,454.435 1800.75,442.976 1803.05,474.032 1805.36,680.63 1807.67,514.281 1809.98,453.818 1812.28,543.023 1814.59,300.351 1816.9,396.16 1819.21,326.166 1821.52,466.516 1823.82,459.066 1826.13,428.588 1828.44,455.172 1830.75,465.695 1833.06,470.925 1835.36,402.434 1837.67,432.449 1839.98,421.875 1842.29,442.804 1844.6,584.526 1846.9,290.709 1849.21,455.713 1851.52,288.037 1853.83,318.761 1856.14,376.235 1858.44,396.545 1860.75,411.614 1863.06,510.715 1865.37,607.923 1867.67,529.386 1869.98,572.008 1872.29,400.676 1874.6,508.791 1876.91,520.376 1879.21,359.754 1881.52,424.508 1883.83,517.143 1886.14,440.056 1888.45,566.593 1890.75,107.122 1893.06,472.326 1895.37,304.027 1897.68,448.77 1899.99,554.025 1902.29,315.132 1904.6,236.638 1906.91,525.619 1909.22,328.088 1911.53,308.367 1913.83,579.225 1916.14,332.897 1918.45,456.339 1920.76,294.318 1923.06,327.83 1925.37,402.079 1927.68,489.913 1929.99,278.285 1932.3,419.6 1934.6,379.164 1936.91,401.741 1939.22,526.873 1941.53,312.219 1943.84,486.874 1946.14,448.048 1948.45,449.239 1950.76,387.007 1953.07,368.353 1955.38,396.104 1957.68,395.992 1959.99,498.647 1962.3,575.561 1964.61,488.319 1966.91,499.788 1969.22,549.106 1971.53,374.797 1973.84,360.683 1976.15,356.673 1978.45,411.86 1980.76,630.888 1983.07,368.521 1985.38,362.813 1987.69,294.645 1989.99,358.792 1992.3,310.97 1994.61,464.235 1996.92,464.508 1999.23,471.565 2001.53,364.368 2003.84,294.821 2006.15,301.722 2008.46,435.14 2010.77,347.269 2013.07,378.61 2015.38,397.835 2017.69,387.53 2020,308.835 2022.3,491.88 2024.61,413.843 2026.92,413.637 2029.23,474.901 2031.54,354.731 2033.84,580.171 2036.15,508.174 2038.46,270.174 2040.77,459.546 2043.08,425.713 2045.38,539.902 2047.69,407.819 2050,259.48 2052.31,272.236 2054.62,426.278 2056.92,360.63 2059.23,467.37 2061.54,653.455 2063.85,362.392 2066.16,348.316 2068.46,338.981 2070.77,266.699 2073.08,462.405 2075.39,181.525 2077.69,466.426 2080,408.214 2082.31,473.3 2084.62,362.562 2086.93,418.886 2089.23,452.86 2091.54,263.128 2093.85,276.112 2096.16,407.522 2098.47,413.447 2100.77,503.902 2103.08,370.598 2105.39,359.167 2107.7,477.514 2110.01,334.103 2112.31,454.682 2114.62,564.482 2116.93,218.326 2119.24,553.982 2121.55,321.539 2123.85,479.225 2126.16,489.597 2128.47,314.942 2130.78,418.341 2133.08,568.707 2135.39,460.905 2137.7,609.932 2140.01,443.587 2142.32,352.202 2144.62,377.711 2146.93,413.776 2149.24,600.408 2151.55,444.651 2153.86,394.283 2156.16,495.791 2158.47,418.687 2160.78,393.509 2163.09,387.19 2165.4,393.351 2167.7,440.388 2170.01,298.889 2172.32,330.713 2174.63,453.185 2176.93,582.167 2179.24,397.861 2181.55,467.054 2183.86,303.592 2186.17,187.828 2188.47,485.583 2190.78,479.793 2193.09,335.004 2195.4,407.952 2197.71,394.993 2200.01,548.025 2202.32,571.425 2204.63,404.916 2206.94,303.733 2209.25,206.754 2211.55,452.145 2213.86,388.951 2216.17,341.553 2218.48,530.287 2220.79,370.767 2223.09,276.088 2225.4,274.452 2227.71,322.844 2230.02,389.629 2232.32,427.247 2234.63,398.318 2236.94,260.846 2239.25,324.986 2241.56,261.124 2243.86,436.545 2246.17,302.543 2248.48,395.802 2250.79,651.974 2253.1,351.809 2255.4,306.115 2257.71,636.135 2260.02,470.666 2262.33,352.734 2264.64,406.855 2266.94,471.925 2269.25,425.177 2271.56,405.551 2273.87,338.724 2276.18,263.36 2278.48,278.906 2280.79,395.612 2283.1,348.413 2285.41,221.922 2287.71,282.005 2290.02,407.459 2292.33,399.803 2294.64,329.741 2296.95,407.283 2299.25,361.635 2301.56,482.609 2303.87,357.747 2306.18,315.1 2308.49,318.389 2310.79,332.56 2313.1,358.621 2315.41,502.244 2317.72,312.077 2320.03,390.139 2322.33,521.969 2324.64,599.742 2326.95,288.121 2329.26,244.697 2331.56,530.448 2333.87,441.339 2336.18,469.775 2338.49,346.791 2340.8,445.838 2343.1,343.504 2345.41,411.043 2347.72,415.666 2350.03,373.798 2352.34,350.069 2354.64,416.17 2356.95,561.721 2359.26,399.67 2361.57,521.361 2363.88,551.066 2366.18,346.032 2368.49,438.267 2370.8,465.283 2373.11,573.918 2375.42,531.596 2377.72,269.149 2380.03,293.339 2382.34,574.297 2384.65,491.766 2386.95,270.772 2389.26,409.965 2391.57,427.561 2393.88,490.774 2396.19,535.317 2398.49,372.295 2400.8,410.5 2403.11,437.572 2405.42,389.663 2407.73,553.891 2410.03,432.819 2412.34,473.075 2414.65,600.332 2416.96,237.605 2419.27,349.426 2421.57,272.743 2423.88,480.085 2426.19,495.999 2428.5,502.26 2430.81,381.773 2433.11,500.961 2435.42,410.652 2437.73,397.247 2440.04,515.929 2442.34,588.595 2444.65,366.443 2446.96,403.053 2449.27,539.022 2451.58,293.65 2453.88,366.024 2456.19,385.673 2458.5,429.366 2460.81,325.264 2463.12,551.448 2465.42,430.168 2467.73,599.916 2470.04,410.575 2472.35,487.752 2474.66,461.028 2476.96,383.772 2479.27,394.047 2481.58,552.329 2483.89,352.793 2486.2,342.56 2488.5,587.183 2490.81,363.867 2493.12,570.237 2495.43,508.003 2497.73,613.108 2500.04,411.23 2502.35,407.293 2504.66,584.045 2506.97,276.458 2509.27,408.012 2511.58,492.688 2513.89,422.483 2516.2,473.023 2518.51,326.875 2520.81,316.623 2523.12,471.495 2525.43,456.949 2527.74,249.286 2530.05,473.497 2532.35,615.937 2534.66,351.37 2536.97,319.298 2539.28,459.374 2541.58,572.256 2543.89,325.808 2546.2,596.894 2548.51,428.457 2550.82,337.659 2553.12,435.614 2555.43,354.928 2557.74,358.419 2560.05,451.699 2562.36,326.507 2564.66,359.211 2566.97,268.352 2569.28,382.233 2571.59,415.255 "></polyline>
</svg>
</div>
</div>
<p>Look at that! Things are working; amazin’.</p>
<p>We can also exploit <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>’s parallel sampling capabilities:</p>
<div id="34" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run separate 4 chains for 10 000 iterations using threads to parallelize.</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>num_chains <span class="op">=</span> <span class="fl">4</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    model_with_grad,</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">MCMCThreads</span>(),</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>,</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    num_chains;</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Note we need to provide an initial state for every chain.</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>    initial_state<span class="op">=</span><span class="fu">fill</span>(state, num_chains),</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>samples_array <span class="op">=</span> <span class="fu">stack</span>(<span class="fu">map</span>(<span class="bu">Base</span>.<span class="fu">Fix1</span>(stack, sample <span class="op">-&gt;</span> sample.x), samples))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000×4 Array{Float64, 3}:
[:, :, 1] =
 -3.0353    -2.68086   -4.20573  …  -5.25964    -4.85611   -5.72516
  0.641267   0.632683  -1.11188      0.0492896  -0.308505   0.392205
  2.12211    2.73325    3.21541      4.80957     5.20944    6.66933

[:, :, 2] =
 -2.77125  -3.49927  -4.3744    -4.3744    …  -5.59543   -5.28845   -5.80502
 -1.23755  -1.20921   0.137493   0.137493      0.759093   0.615771   0.441911
  1.57084   4.17646   5.57738    5.57738       2.9283     2.63045    5.58296

[:, :, 3] =
 -2.18784  -4.9154   -6.20885  -4.81738   …  -5.29684  -5.29684  -4.50475
 -0.15831  -1.25692  -1.26117  -0.786959      1.02113   1.02113  -0.175504
  1.55357   3.54746   4.56962   6.66844       5.12838   5.12838   4.84915

[:, :, 4] =
 -4.72633    -5.45392   -5.41957   …  -6.87131  -5.18187  -6.05242
 -0.0678067  -0.132107  -0.127347     -1.81118   0.15764   0.899199
  4.06126     4.38332    4.42455       5.63718   5.51564   4.35598</code></pre>
</div>
</div>
<p>But the fact that we have to provide the <code>AbstractMCMC.sample</code> call, etc. with an <code>initial_state</code> to get started is a bit annoying. We can avoid this by also defining a <code>AbstractMCMC.step</code> <em>without</em> the <code>state</code> argument:</p>
<div id="36" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">::</span><span class="dt">MALA</span>;</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># </span><span class="al">NOTE</span><span class="co">: No state provided!</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just create the initial state by sampling using  a Gaussian.</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="fu">randn</span>(rng, LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(x), <span class="fu">MALAState</span>(x)</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Equipped with this, we no longer need to provide the <code>initial_state</code> everywhere:</p>
<div id="38" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -4.9872      1.01079
 -0.00355491  1.01026
  5.00898     1.00955</code></pre>
</div>
</div>
</section>
<section id="using-our-sampler-with-turing.jl" class="level2">
<h2 class="anchored" data-anchor-id="using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</h2>
<p>As we promised, all of this hassle of implementing our <code>MALA</code> sampler in a way that uses <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> and <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> gets us something more than <em>just</em> an “automatic” implementation of <code>AbstractMCMC.sample</code>.</p>
<p>It also enables use with Turing.jl through the <code>externalsampler</code>, but we need to do one final thing first: we need to tell Turing.jl how to extract a vector of parameters from the “sample” returned in our implementation of <code>AbstractMCMC.step</code>. In our case, the “sample” is a <code>MALASample</code>, so we just need the following line:</p>
<div id="40" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Turing</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">DynamicPPL</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Overload the `getparams` method for our "sample" type, which is just a vector.</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>Turing.Inference.<span class="fu">getparams</span>(<span class="op">::</span><span class="dt">DynamicPPL.Model</span>, sample<span class="op">::</span><span class="dt">MALASample</span>) <span class="op">=</span> sample.x</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And with that, we’re good to go!</p>
<div id="42" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Our previous model defined as a Turing.jl model.</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">mvnormal_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">MvNormal</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.], I)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate our model.</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">mvnormal_model</span>()</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Call `sample` but now we're passing in a Turing.jl `model` and wrapping</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co"># our `MALA` sampler in the `externalsampler` to tell Turing.jl that the sampler</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co"># expects something that implements LogDensityProblems.jl.</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×4×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 3.05 seconds
Compute duration  = 3.05 seconds
parameters        = x[1], x[2], x[3]
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters  </span><span class="ansi-bold">    mean  </span><span class="ansi-bold">     std  </span><span class="ansi-bold">    mcse  </span><span class="ansi-bold">  ess_bulk  </span><span class="ansi-bold">  ess_tail  </span><span class="ansi-bold">    rhat  </span><span class="ansi-bold"> ⋯
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">   Float64  </span><span class="ansi-bright-black-fg ansi-bold">   Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> ⋯

        x[1]   -4.9860    0.9923    0.0175   3230.9082   5126.8880    1.0001   ⋯
        x[2]   -0.0095    1.0024    0.0169   3508.2667   5329.3143    1.0000   ⋯
        x[3]    4.9873    1.0088    0.0184   3017.2560   4633.9431    1.0025   ⋯
</span><span class="ansi-cyan-fg ansi-bold">                                                                1 column omitted

Quantiles
 </span><span class="ansi-cyan-fg ansi-bold"> parameters  </span><span class="ansi-cyan-fg ansi-bold">    2.5%  </span><span class="ansi-cyan-fg ansi-bold">   25.0%  </span><span class="ansi-cyan-fg ansi-bold">   50.0%  </span><span class="ansi-cyan-fg ansi-bold">   75.0%  </span><span class="ansi-cyan-fg ansi-bold">   97.5%
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64

        x[1]   -6.9040   -5.6603   -4.9949   -4.3124   -3.0578
        x[2]   -1.9608   -0.6798   -0.0123    0.6615    1.9753
        x[3]    3.0043    4.3165    4.9775    5.6658    6.9907
</span></pre>
</div>
</div>
</div>
<p>Pretty neat, eh?</p>
<section id="models-with-constrained-parameters" class="level3">
<h3 class="anchored" data-anchor-id="models-with-constrained-parameters">Models with constrained parameters</h3>
<p>One thing we’ve sort of glossed over in all of the above is that MALA, at least how we’ve implemented it, requires <span class="math inline">\(x\)</span> to live in <span class="math inline">\(\mathbb{R}^d\)</span> for some <span class="math inline">\(d &gt; 0\)</span>. If some of the parameters were in fact constrained, e.g.&nbsp;we were working with a <code>Beta</code> distribution which has support on the interval <span class="math inline">\((0, 1)\)</span>, <em>not</em> on <span class="math inline">\(\mathbb{R}^d\)</span>, we could easily end up outside of the valid range <span class="math inline">\((0, 1)\)</span>.</p>
<div id="44" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">beta_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">beta_model</span>()</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 1.83 seconds
Compute duration  = 1.83 seconds
parameters        = x
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters  </span><span class="ansi-bold">    mean  </span><span class="ansi-bold">     std  </span><span class="ansi-bold">    mcse  </span><span class="ansi-bold">  ess_bulk  </span><span class="ansi-bold">  ess_tail  </span><span class="ansi-bold">    rhat  </span><span class="ansi-bold"> ⋯
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">   Float64  </span><span class="ansi-bright-black-fg ansi-bold">   Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> ⋯

           x    0.4998    0.1882    0.0027   4573.3238   5528.6023    1.0003   ⋯
</span><span class="ansi-cyan-fg ansi-bold">                                                                1 column omitted

Quantiles
 </span><span class="ansi-cyan-fg ansi-bold"> parameters  </span><span class="ansi-cyan-fg ansi-bold">    2.5%  </span><span class="ansi-cyan-fg ansi-bold">   25.0%  </span><span class="ansi-cyan-fg ansi-bold">   50.0%  </span><span class="ansi-cyan-fg ansi-bold">   75.0%  </span><span class="ansi-cyan-fg ansi-bold">   97.5%
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64

           x    0.1467    0.3586    0.5010    0.6405    0.8514
</span></pre>
</div>
</div>
</div>
<p>Yep, that still works, but only because Turing.jl actually <em>transforms</em> the <code>turing_model</code> from constrained to unconstrained, so that the <code>sampler</code> provided to <code>externalsampler</code> is actually always working in unconstrained space! This is not always desirable, so we can turn this off:</p>
<div id="46" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 0.18 seconds
Compute duration  = 0.18 seconds
parameters        = x
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters  </span><span class="ansi-bold">    mean  </span><span class="ansi-bold">     std  </span><span class="ansi-bold">    mcse  </span><span class="ansi-bold">  ess_bulk  </span><span class="ansi-bold"> ess_tail  </span><span class="ansi-bold">    rhat  </span><span class="ansi-bold">  ⋯
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">   Float64  </span><span class="ansi-bright-black-fg ansi-bold">  Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">  ⋯

           x    0.9442    0.0459    0.0011   1857.7761        NaN    1.0004    ⋯
</span><span class="ansi-cyan-fg ansi-bold">                                                                1 column omitted

Quantiles
 </span><span class="ansi-cyan-fg ansi-bold"> parameters  </span><span class="ansi-cyan-fg ansi-bold">    2.5%  </span><span class="ansi-cyan-fg ansi-bold">   25.0%  </span><span class="ansi-cyan-fg ansi-bold">   50.0%  </span><span class="ansi-cyan-fg ansi-bold">   75.0%  </span><span class="ansi-cyan-fg ansi-bold">   97.5%
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64

           x    0.9452    0.9452    0.9452    0.9452    0.9452
</span></pre>
</div>
</div>
</div>
<p>The fun thing is that this still sort of works because</p>
<div id="48" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">logpdf</span>(<span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>), <span class="fl">10.0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-Inf</code></pre>
</div>
</div>
<p>and so the samples that fall outside of the range are always rejected. But do notice how much worse all the diagnostics are, e.g.&nbsp;<code>ess_tail</code> is very poor compared to when we use <code>unconstrained=true</code>. Moreover, in more complex cases this won’t just result in a “nice” <code>-Inf</code> log-density value, but instead will error:</p>
<div id="50" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="kw">function</span> <span class="fu">demo</span>()</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>    σ² <span class="op">~</span> <span class="fu">truncated</span>(<span class="fu">Normal</span>(), lower<span class="op">=</span><span class="fl">0</span>)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If we end up with negative values for `σ²`, the `Normal` will error.</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>    x <span class="op">~</span> <span class="fu">Normal</span>(<span class="fl">0</span>, σ²)</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre>DomainError with -1.62220876206967:
Normal: the condition σ &gt;= zero(σ) is not satisfied.
Stacktrace:
  [1] <span class="ansi-bold">#371</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/YQSrn/src/univariate/continuous/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">normal.jl:37</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [2] <span class="ansi-bold">check_args</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/YQSrn/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">utils.jl:89</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [3] <span class="ansi-bold">#Normal#370</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/YQSrn/src/univariate/continuous/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">normal.jl:37</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [4] <span class="ansi-bold">Normal</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/YQSrn/src/univariate/continuous/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">normal.jl:36</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [5] <span class="ansi-bold">Normal</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/YQSrn/src/univariate/continuous/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">normal.jl:42</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [6] <span class="ansi-bold">macro expansion</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/JwgrD/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">compiler.jl:558</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [7] <span class="ansi-bold">demo</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">__model__</span>::Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DefaultContext}</span>, <span class="ansi-bright-black-fg">__varinfo__</span>::DynamicPPL.ThreadSafeVarInfo<span class="ansi-bright-black-fg">{VarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}, Vector{Base.RefValue{Float64}}}</span>, <span class="ansi-bright-black-fg">__context__</span>::DynamicPPL.ValuesAsInModelContext<span class="ansi-bright-black-fg">{DefaultContext}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-magenta-fg">Main.Notebook</span> <span class="ansi-bright-black-fg">~/work/docs/docs/developers/inference/implementing-samplers/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">index.qmd:457</span>
  [8] <span class="ansi-bold">_evaluate!!</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/JwgrD/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">model.jl:913</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [9] <span class="ansi-bold">evaluate_threadsafe!!</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">model</span>::Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DefaultContext}</span>, <span class="ansi-bright-black-fg">varinfo</span>::VarInfo<span class="ansi-bright-black-fg">{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}</span>, <span class="ansi-bright-black-fg">context</span>::DynamicPPL.ValuesAsInModelContext<span class="ansi-bright-black-fg">{DefaultContext}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-cyan-fg">DynamicPPL</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/JwgrD/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">model.jl:902</span>
 [10] <span class="ansi-bold">evaluate!!</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/JwgrD/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">model.jl:832</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [11] <span class="ansi-bold">values_as_in_model</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/JwgrD/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">values_as_in_model.jl:173</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [12] <span class="ansi-bold">values_as_in_model</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/JwgrD/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">values_as_in_model.jl:172</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [13] <span class="ansi-bold">getparams</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">model</span>::Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DefaultContext}</span>, <span class="ansi-bright-black-fg">vi</span>::VarInfo<span class="ansi-bright-black-fg">{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-green-fg">Turing.Inference</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/Phj9t/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">Inference.jl:179</span>
 [14] <span class="ansi-bold">Turing.Inference.Transition</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">model</span>::Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DefaultContext}</span>, <span class="ansi-bright-black-fg">vi</span>::VarInfo<span class="ansi-bright-black-fg">{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}</span>, <span class="ansi-bright-black-fg">t</span>::MALASample<span class="ansi-bright-black-fg">{Vector{Float64}}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-green-fg">Turing.Inference</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/Phj9t/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">Inference.jl:141</span>
 [15] <span class="ansi-bold">transition_to_turing</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">f</span>::LogDensityFunction<span class="ansi-bright-black-fg">{Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DefaultContext}, VarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}, DefaultContext, AutoForwardDiff{2, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}}}</span>, <span class="ansi-bright-black-fg">transition</span>::MALASample<span class="ansi-bright-black-fg">{Vector{Float64}}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-green-fg">Turing.Inference</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/Phj9t/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">external_sampler.jl:80</span>
 [16] <span class="ansi-bold">step</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">rng</span>::TaskLocalRNG, <span class="ansi-bright-black-fg">model</span>::Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DefaultContext}</span>, <span class="ansi-bright-black-fg">sampler_wrapper</span>::Sampler<span class="ansi-bright-black-fg">{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}</span>; <span class="ansi-bright-black-fg">initial_state</span>::Nothing, <span class="ansi-bright-black-fg">initial_params</span>::Nothing, <span class="ansi-bright-black-fg">kwargs</span>::@Kwargs<span class="ansi-bright-black-fg">{}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-green-fg">Turing.Inference</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/Phj9t/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">external_sampler.jl:145</span>
 [17] <span class="ansi-bold">macro expansion</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/AbstractMCMC/F50rb/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">sample.jl:0</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [18] <span class="ansi-bold">macro expansion</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/AbstractMCMC/F50rb/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">logging.jl:16</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [19] <span class="ansi-bold">mcmcsample</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">rng</span>::TaskLocalRNG, <span class="ansi-bright-black-fg">model</span>::Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DefaultContext}</span>, <span class="ansi-bright-black-fg">sampler</span>::Sampler<span class="ansi-bright-black-fg">{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}</span>, <span class="ansi-bright-black-fg">N</span>::Int64; <span class="ansi-bright-black-fg">progress</span>::Bool, <span class="ansi-bright-black-fg">progressname</span>::String, <span class="ansi-bright-black-fg">callback</span>::Nothing, <span class="ansi-bright-black-fg">num_warmup</span>::Int64, <span class="ansi-bright-black-fg">discard_initial</span>::Int64, <span class="ansi-bright-black-fg">thinning</span>::Int64, <span class="ansi-bright-black-fg">chain_type</span>::Type, <span class="ansi-bright-black-fg">initial_state</span>::Nothing, <span class="ansi-bright-black-fg">kwargs</span>::@Kwargs<span class="ansi-bright-black-fg">{}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-yellow-fg">AbstractMCMC</span> <span class="ansi-bright-black-fg">~/.julia/packages/AbstractMCMC/F50rb/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">sample.jl:144</span>
 [20] <span class="ansi-bold">sample</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">rng</span>::TaskLocalRNG, <span class="ansi-bright-black-fg">model</span>::Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DefaultContext}</span>, <span class="ansi-bright-black-fg">sampler</span>::Sampler<span class="ansi-bright-black-fg">{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}</span>, <span class="ansi-bright-black-fg">N</span>::Int64; <span class="ansi-bright-black-fg">chain_type</span>::Type, <span class="ansi-bright-black-fg">resume_from</span>::Nothing, <span class="ansi-bright-black-fg">initial_state</span>::Nothing, <span class="ansi-bright-black-fg">kwargs</span>::@Kwargs<span class="ansi-bright-black-fg">{progress::Bool}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-cyan-fg">DynamicPPL</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/JwgrD/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">sampler.jl:102</span>
 [21] <span class="ansi-bold">sample</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/JwgrD/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">sampler.jl:92</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [22] <span class="ansi-bold">#sample#101</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/Phj9t/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">abstractmcmc.jl:29</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [23] <span class="ansi-bold">sample</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/Phj9t/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">abstractmcmc.jl:20</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [24] <span class="ansi-bold">#sample#100</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/Phj9t/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">abstractmcmc.jl:17</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [25] top-level scope
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/work/docs/docs/developers/inference/implementing-samplers/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">index.qmd:459</span></pre>
</div>
</div>
</div>
<p>As expected, we run into a <code>DomainError</code> at some point, while if we set <code>unconstrained=true</code>, letting Turing.jl transform the model to a unconstrained form behind the scenes, everything works as expected:</p>
<div id="52" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 2.0 seconds
Compute duration  = 2.0 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters  </span><span class="ansi-bold">    mean  </span><span class="ansi-bold">     std  </span><span class="ansi-bold">    mcse  </span><span class="ansi-bold"> ess_bulk  </span><span class="ansi-bold"> ess_tail  </span><span class="ansi-bold">    rhat  </span><span class="ansi-bold"> e ⋯
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">  Float64  </span><span class="ansi-bright-black-fg ansi-bold">  Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">   ⋯

          σ²    0.8587    0.6207    0.0479    91.4833    33.3046    1.0436     ⋯
           x    0.0251    1.1253    0.0879   285.8674   132.1824    1.0170     ⋯
</span><span class="ansi-cyan-fg ansi-bold">                                                                1 column omitted

Quantiles
 </span><span class="ansi-cyan-fg ansi-bold"> parameters  </span><span class="ansi-cyan-fg ansi-bold">    2.5%  </span><span class="ansi-cyan-fg ansi-bold">   25.0%  </span><span class="ansi-cyan-fg ansi-bold">   50.0%  </span><span class="ansi-cyan-fg ansi-bold">   75.0%  </span><span class="ansi-cyan-fg ansi-bold">   97.5%
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64

          σ²    0.0417    0.3789    0.7246    1.2157    2.3655
           x   -2.2635   -0.3987   -0.0061    0.3705    2.5579
</span></pre>
</div>
</div>
</div>
<p>Neat!</p>
<p>Similarly, which automatic differentiation backend one should use can be specified through the <code>adtype</code> keyword argument too. For example, if we want to use <a href="https://github.com/JuliaDiff/ReverseDiff.jl">ReverseDiff.jl</a> instead of the default <a href="https://github.com/JuliaDiff/ForwardDiff.jl">ForwardDiff.jl</a>:</p>
<div id="54" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">ReverseDiff</span>: ReverseDiff</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify that we want to use `AutoReverseDiff`.</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">demo</span>(),</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>, adtype<span class="op">=</span><span class="fu">AutoReverseDiff</span>()),</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>;</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 3.09 seconds
Compute duration  = 3.09 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters  </span><span class="ansi-bold">    mean  </span><span class="ansi-bold">     std  </span><span class="ansi-bold">    mcse  </span><span class="ansi-bold"> ess_bulk  </span><span class="ansi-bold"> ess_tail  </span><span class="ansi-bold">    rhat  </span><span class="ansi-bold"> e ⋯
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">  Float64  </span><span class="ansi-bright-black-fg ansi-bold">  Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">   ⋯

          σ²    0.8476    0.5442    0.0223   389.1766   180.3117    1.0063     ⋯
           x   -0.0544    0.9363    0.0405   625.2353   522.5139    1.0053     ⋯
</span><span class="ansi-cyan-fg ansi-bold">                                                                1 column omitted

Quantiles
 </span><span class="ansi-cyan-fg ansi-bold"> parameters  </span><span class="ansi-cyan-fg ansi-bold">    2.5%  </span><span class="ansi-cyan-fg ansi-bold">   25.0%  </span><span class="ansi-cyan-fg ansi-bold">   50.0%  </span><span class="ansi-cyan-fg ansi-bold">   75.0%  </span><span class="ansi-cyan-fg ansi-bold">   97.5%
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64

          σ²    0.1465    0.4058    0.7455    1.1719    2.1193
           x   -2.0387   -0.4991   -0.0320    0.3652    2.0317
</span></pre>
</div>
</div>
</div>
<p>Double-neat.</p>
</section>
</section>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<p>At this point it’s worth maybe reminding ourselves what we did and also <em>why</em> we did it:</p>
<ol type="1">
<li>We define our models in the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface because it makes the sampler agnostic to how the underlying model is implemented.</li>
<li>We implement our sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> interface, which just means that our sampler is a subtype of <code>AbstractMCMC.AbstractSampler</code> and we implement the MCMC transition in <code>AbstractMCMC.step</code>.</li>
<li>Points 1 and 2 makes it so our sampler can be used with a wide range of model implementations, amongst them being models implemented in both Turing.jl and Stan. This gives you, the inference implementer, a large collection of models to test your inference method on, in addition to allowing users of Turing.jl and Stan to try out your inference method with minimal effort.</li>
</ol>


</section>


<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a><div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>We’re going with the leapfrog formulation because in a future version of this tutorial we’ll add a section extending this simple “baseline” MALA sampler to more complex versions. See <a href="https://github.com/TuringLang/docs/issues/479">issue #479</a> for progress on this.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>There is no such thing as a proper interface in Julia (at least not officially), and so we use the word “interface” here to mean a few minimal methods that needs to be implemented by any type that we treat as a target model.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    // Ensure there is a toggle, if there isn't float one in the top right
    if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
      const a = window.document.createElement('a');
      a.classList.add('top-right');
      a.classList.add('quarto-color-scheme-toggle');
      a.href = "";
      a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
      const i = window.document.createElement("i");
      i.classList.add('bi');
      a.appendChild(i);
      window.document.body.appendChild(a);
    }
    setColorSchemeToggle(hasAlternateSentinel())
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/turinglang\.org\/docs\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../../developers/inference/variational-inference/index.html" class="pagination-link" aria-label="Variational Inference">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Variational Inference</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/TuringLang/docs/edit/main/developers/inference/implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/docs/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div></div></footer><footer class="custom-footer">
  <div class="footer-container">
    <div class="footer-grid">
      <div class="footer-links-wrapper">
        <div class="footer-column footer-explore">
          <h5>Explore</h5>
          <a href="https://turinglang.org/docs/getting-started/">Get Started</a>
          <a href="https://turinglang.org/docs/tutorials/">Tutorials</a>
          <a href="https://turinglang.org/library/">Libraries</a>
          <a href="https://turinglang.org/news/">News</a>
          <a href="https://turinglang.org/team/">Team</a>
        </div>

        <div class="footer-column footer-connect">
          <h5>Connect</h5>
          <a href="https://github.com/TuringLang" target="_blank" rel="noopener"><i class="bi bi-github"></i> GitHub</a>
          <a href="https://x.com/TuringLang" target="_blank" rel="noopener"><i class="bi bi-twitter"></i> Twitter</a>
          <a href="https://julialang.slack.com/archives/CCYDC34A0" target="_blank" rel="noopener"><i class="bi bi-slack"></i> Slack</a>
          <a href="https://discourse.julialang.org/c/domain/probprog/48" target="_blank" rel="noopener"><i class="bi bi-chat-dots"></i> Discourse</a>
        </div>
      </div>

      <div class="footer-column footer-brands">
        <h5>Supported by leading researchers</h5>
        <p>Turing.jl is developed by researchers and engineers at the following research institutions.</p>
        <div class="logo-grid">
          <a href="https://mlg.eng.cam.ac.uk/" class="partner-logo" target="_blank" rel="noopener">
            <img src="../../../assets/images/brands/university-cambridge-logo-black-example-640x132.png" alt="University of Cambridge Logo" class="brands-light-mode-logo">
            <img src="../../../assets/images/brands/university-cambridge-logo-white-example-640x133.png" alt="University of Cambridge Logo Dark" class="brands-dark-mode-logo">
          </a>
          <a href="https://www.turing.ac.uk/" class="partner-logo" target="_blank" rel="noopener">
            <img src="../../../assets/images/brands/Turing_Logo_1000x400px_Black.webp" alt="The Alan Turing Institute Logo" class="brands-light-mode-logo">
            <img src="../../../assets/images/brands/Turing_Logo_1000x400px_White.webp" alt="The Alan Turing Institute Logo Dark" class="brands-dark-mode-logo">
          </a>
        </div>
      </div>

    </div>
    <div class="footer-bottom">
      <p>Turing is created by <a href="https://mlg.eng.cam.ac.uk/hong/" target="_blank" rel="noopener">Hong Ge</a>, and maintained by the core <a href="../../../team" target="_blank" rel="noopener">team</a> of developers and <a href="https://github.com/TuringLang/Turing.jl/graphs/contributors" target="_blank" rel="noopener">contributors</a>!<br>© 2025 The Turing Project Contributors. <a href="https://github.com/TuringLang/Turing.jl/blob/master/LICENCE" target="_blank" rel="noopener">MIT License</a>.</p>
      <a href="https://github.com/TuringLang/turinglang.github.io/" target="_blank" rel="noopener" class="footer-source-link"><i class="bi bi-github"></i> Website Source</a>
    </div>
  </div>
</footer>




<script src="../../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>