<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.31">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Implementing Samplers – Turing.jl</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<link href="../../../developers/inference/variational-inference/index.html" rel="prev">
<link href="../../../assets/favicon.ico" rel="icon">
<script src="../../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-e1a5c8363afafaef2c763b6775fbf3ca.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-dark-8ef56b68f8fa1e9d2ba328e99e439f80.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-e1a5c8363afafaef2c763b6775fbf3ca.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap-905433ffa22618bb005779f2b23c5ce0.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../../site_libs/bootstrap/bootstrap-dark-60c915303214d2913779fa29286ce6c9.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="../../../site_libs/bootstrap/bootstrap-905433ffa22618bb005779f2b23c5ce0.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<style>
  a {
    text-decoration: none;
  }
  a:hover {
    text-decoration: underline;
  }
</style>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../../theming/styles.css">
</head>

<body class="nav-sidebar floating nav-fixed quarto-light"><script id="quarto-html-before-body" type="application/javascript">
    const toggleBodyColorMode = (bsSheetEl) => {
      const mode = bsSheetEl.getAttribute("data-mode");
      const bodyEl = window.document.querySelector("body");
      if (mode === "dark") {
        bodyEl.classList.add("quarto-dark");
        bodyEl.classList.remove("quarto-light");
      } else {
        bodyEl.classList.add("quarto-light");
        bodyEl.classList.remove("quarto-dark");
      }
    }
    const toggleBodyColorPrimary = () => {
      const bsSheetEl = window.document.querySelector("link#quarto-bootstrap:not([rel=disabled-stylesheet])");
      if (bsSheetEl) {
        toggleBodyColorMode(bsSheetEl);
      }
    }
    const setColorSchemeToggle = (alternate) => {
      const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
      for (let i=0; i < toggles.length; i++) {
        const toggle = toggles[i];
        if (toggle) {
          if (alternate) {
            toggle.classList.add("alternate");
          } else {
            toggle.classList.remove("alternate");
          }
        }
      }
    };
    const toggleColorMode = (alternate) => {
      // Switch the stylesheets
      const primaryStylesheets = window.document.querySelectorAll('link.quarto-color-scheme:not(.quarto-color-alternate)');
      const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
      manageTransitions('#quarto-margin-sidebar .nav-link', false);
      if (alternate) {
        // note: dark is layered on light, we don't disable primary!
        enableStylesheet(alternateStylesheets);
        for (const sheetNode of alternateStylesheets) {
          if (sheetNode.id === "quarto-bootstrap") {
            toggleBodyColorMode(sheetNode);
          }
        }
      } else {
        disableStylesheet(alternateStylesheets);
        enableStylesheet(primaryStylesheets)
        toggleBodyColorPrimary();
      }
      manageTransitions('#quarto-margin-sidebar .nav-link', true);
      // Switch the toggles
      setColorSchemeToggle(alternate)
      // Hack to workaround the fact that safari doesn't
      // properly recolor the scrollbar when toggling (#1455)
      if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
        manageTransitions("body", false);
        window.scrollTo(0, 1);
        setTimeout(() => {
          window.scrollTo(0, 0);
          manageTransitions("body", true);
        }, 40);
      }
    }
    const disableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        stylesheet.rel = 'disabled-stylesheet';
      }
    }
    const enableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        if(stylesheet.rel !== 'stylesheet') { // for Chrome, which will still FOUC without this check
          stylesheet.rel = 'stylesheet';
        }
      }
    }
    const manageTransitions = (selector, allowTransitions) => {
      const els = window.document.querySelectorAll(selector);
      for (let i=0; i < els.length; i++) {
        const el = els[i];
        if (allowTransitions) {
          el.classList.remove('notransition');
        } else {
          el.classList.add('notransition');
        }
      }
    }
    const isFileUrl = () => {
      return window.location.protocol === 'file:';
    }
    const hasAlternateSentinel = () => {
      let styleSentinel = getColorSchemeSentinel();
      if (styleSentinel !== null) {
        return styleSentinel === "alternate";
      } else {
        return false;
      }
    }
    const setStyleSentinel = (alternate) => {
      const value = alternate ? "alternate" : "default";
      if (!isFileUrl()) {
        window.localStorage.setItem("quarto-color-scheme", value);
      } else {
        localAlternateSentinel = value;
      }
    }
    const getColorSchemeSentinel = () => {
      if (!isFileUrl()) {
        const storageValue = window.localStorage.getItem("quarto-color-scheme");
        return storageValue != null ? storageValue : localAlternateSentinel;
      } else {
        return localAlternateSentinel;
      }
    }
    const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
      const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
      const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
      let newTheme = '';
      if(authorPrefersDark) {
        newTheme = isAlternate ? baseTheme : alternateTheme;
      } else {
        newTheme = isAlternate ? alternateTheme : baseTheme;
      }
      const changeGiscusTheme = () => {
        // From: https://github.com/giscus/giscus/issues/336
        const sendMessage = (message) => {
          const iframe = document.querySelector('iframe.giscus-frame');
          if (!iframe) return;
          iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
        }
        sendMessage({
          setConfig: {
            theme: newTheme
          }
        });
      }
      const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
      if (isGiscussLoaded) {
        changeGiscusTheme();
      }
    };
    const authorPrefersDark = false;
    const darkModeDefault = authorPrefersDark;
      document.querySelector('link#quarto-text-highlighting-styles.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
      document.querySelector('link#quarto-bootstrap.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
    let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
    // Dark / light mode switch
    window.quartoToggleColorScheme = () => {
      // Read the current dark / light value
      let toAlternate = !hasAlternateSentinel();
      toggleColorMode(toAlternate);
      setStyleSentinel(toAlternate);
      toggleGiscusIfUsed(toAlternate, darkModeDefault);
      window.dispatchEvent(new Event('resize'));
    };
    // Switch to dark mode if need be
    if (hasAlternateSentinel()) {
      toggleColorMode(true);
    } else {
      toggleColorMode(false);
    }
  </script>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="https://turinglang.org/" class="navbar-brand navbar-brand-logo">
    <img src="../../../assets/images/turing-logo.svg" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="https://turinglang.org/">
    <span class="navbar-title">Turing.jl</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../getting-started/"> 
<span class="menu-text">Get Started</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../tutorials/coin-flipping/"> 
<span class="menu-text">Tutorials</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/library/"> 
<span class="menu-text">Libraries</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/news/"> 
<span class="menu-text">News</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/team/"> 
<span class="menu-text">Team</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-v0.38" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">v0.38</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-v0.38">    
        <li>
    <a class="dropdown-item" href="https://turinglang.org/docs/changelog.html">
 <span class="dropdown-text">Changelog</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://turinglang.org/docs/versions.html">
 <span class="dropdown-text">All Versions</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools tools-wide">
    <a href="https://x.com/TuringLang" title="Turing Twitter" class="quarto-navigation-tool px-1" aria-label="Turing Twitter"><i class="bi bi-twitter"></i></a>
    <a href="https://github.com/TuringLang/Turing.jl" title="Turing GitHub" class="quarto-navigation-tool px-1" aria-label="Turing GitHub"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../../developers/contributing/index.html">Developers</a></li><li class="breadcrumb-item"><a href="../../../developers/inference/variational-inference/index.html">Inference in Detail</a></li><li class="breadcrumb-item"><a href="../../../developers/inference/implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../getting-started/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Getting Started</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../core-functionality/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Core Functionality</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false">
 <span class="menu-text">User Guide</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/automatic-differentiation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Automatic Differentiation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/custom-distribution/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Custom Distributions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/probability-interface/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Querying Model Probabilities</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/modifying-logprob/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Modifying the Log Probability</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/tracking-extra-quantities/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Tracking Extra Quantities</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/mode-estimation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Mode Estimation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/performance-tips/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Performance Tips</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/sampler-visualisation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Sampler Visualization</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/dynamichmc/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using DynamicHMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/external-samplers/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using External Samplers</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/troubleshooting/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Troubleshooting</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false">
 <span class="menu-text">Tutorials</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/coin-flipping/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction: Coin Flipping</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/gaussian-mixture-models/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Mixture Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-neural-networks/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Neural Networks</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/hidden-markov-models/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Hidden Markov Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-linear-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Linear Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/infinite-mixture-models/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Infinite Mixture Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-poisson-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Poisson Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/multinomial-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Multinomial Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-differential-equations/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Differential Equations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/probabilistic-pca/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Probabilistic PCA</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-time-series-analysis/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Time Series Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/gaussian-processes-introduction/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Processes: Introduction</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/gaussian-process-latent-variable-models/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Process Latent Variable Models</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Developers</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/contributing/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Contributing</span></a>
  </div>
</li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false">
 <span class="menu-text">DynamicPPL’s Compiler</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/compiler/model-manual/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Manually Defining a Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/compiler/minituring-compiler/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation I: Compiler</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/compiler/minituring-contexts/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation II: Contexts</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/compiler/design-overview/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Turing Compiler Design (Outdated)</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false">
 <span class="menu-text">DynamicPPL Contexts</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/contexts/submodel-condition/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Conditioning and fixing in submodels</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="false">
 <span class="menu-text">Variable Transformations</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/transforms/distributions/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Distributions and the Jacobian</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/transforms/bijectors/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bijectors in MCMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/transforms/dynamicppl/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variable transformations in DynamicPPL</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true">
 <span class="menu-text">Inference in Detail</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/inference/variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/inference/implementing-samplers/index.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Implementing Samplers</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of Contents</h2>
   
  <ul>
  <li><a href="#quick-overview-of-mala" id="toc-quick-overview-of-mala" class="nav-link active" data-scroll-target="#quick-overview-of-mala">Quick overview of MALA</a></li>
  <li><a href="#what-we-need-from-a-model-logdensityproblems.jl" id="toc-what-we-need-from-a-model-logdensityproblems.jl" class="nav-link" data-scroll-target="#what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: LogDensityProblems.jl</a></li>
  <li><a href="#implementing-mala-in-abstractmcmc.jl" id="toc-implementing-mala-in-abstractmcmc.jl" class="nav-link" data-scroll-target="#implementing-mala-in-abstractmcmc.jl">Implementing MALA in AbstractMCMC.jl</a></li>
  <li><a href="#using-our-sampler-with-turing.jl" id="toc-using-our-sampler-with-turing.jl" class="nav-link" data-scroll-target="#using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</a>
  <ul class="collapse">
  <li><a href="#models-with-constrained-parameters" id="toc-models-with-constrained-parameters" class="nav-link" data-scroll-target="#models-with-constrained-parameters">Models with constrained parameters</a></li>
  </ul></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/TuringLang/docs/edit/main/developers/inference/implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/docs/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">


<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../../developers/contributing/index.html">Developers</a></li><li class="breadcrumb-item"><a href="../../../developers/inference/variational-inference/index.html">Inference in Detail</a></li><li class="breadcrumb-item"><a href="../../../developers/inference/implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Implementing Samplers</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>In this tutorial, we’ll go through step-by-step how to implement a “simple” sampler in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> in such a way that it can be easily applied to Turing.jl models.</p>
<p>In particular, we’re going to implement a version of <strong>Metropolis-adjusted Langevin (MALA)</strong>.</p>
<p>Note that we will implement this sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> framework, completely “ignoring” Turing.jl until the very end of the tutorial, at which point we’ll use a single line of code to make the resulting sampler available to Turing.jl. This is to really drive home the point that one can implement samplers in a way that is accessible to all of Turing.jl’s users without having to use Turing.jl yourself.</p>
<section id="quick-overview-of-mala" class="level2">
<h2 class="anchored" data-anchor-id="quick-overview-of-mala">Quick overview of MALA</h2>
<p>We can view MALA as a single step of the leapfrog intergrator with resampling of momentum <span class="math inline">\(p\)</span> at every step.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> To make that statement a bit more concrete, we first define the <em>extended</em> target <span class="math inline">\(\bar{\gamma}(x, p)\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\log \bar{\gamma}(x, p) \propto \log \gamma(x) + \log \gamma_{\mathcal{N}(0, M)}(p)
\end{equation*}\]</span></p>
<p>where <span class="math inline">\(\gamma_{\mathcal{N}(0, M)}\)</span> denotes the density for a zero-centered Gaussian with covariance matrix <span class="math inline">\(M\)</span>. We then consider targeting this joint distribution over both <span class="math inline">\(x\)</span> and <span class="math inline">\(p\)</span> as follows. First we define the map</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  L_{\epsilon}: \quad &amp; \mathbb{R}^d \times \mathbb{R}^d \to \mathbb{R}^d \times \mathbb{R}^d \\
  &amp; (x, p) \mapsto (\tilde{x}, \tilde{p}) := L_{\epsilon}(x, p)
\end{split}
\end{equation*}\]</span></p>
<p>as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p_{1 / 2} &amp;:= p + \frac{\epsilon}{2} \nabla \log \gamma(x) \\
  \tilde{x} &amp;:= x + \epsilon M^{-1} p_{1 /2 } \\
  p_1 &amp;:= p_{1 / 2} + \frac{\epsilon}{2} \nabla \log \gamma(\tilde{x}) \\
  \tilde{p} &amp;:= - p_1
\end{split}
\end{equation*}\]</span></p>
<p>This might be familiar for some readers as a single step of the Leapfrog integrator. We then define the MALA kernel as follows: given the current iterate <span class="math inline">\(x_i\)</span>, we sample the next iterate <span class="math inline">\(x_{i + 1}\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p &amp;\sim \mathcal{N}(0, M) \\
  (\tilde{x}, \tilde{p}) &amp;:= L_{\epsilon}(x_i, p) \\
  \alpha &amp;:= \min \left\{ 1, \frac{\bar{\gamma}(\tilde{x}, \tilde{p})}{\bar{\gamma}(x_i, p)} \right\} \\
  x_{i + 1} &amp;:=
  \begin{cases}
    \tilde{x} \quad &amp; \text{ with prob. } \alpha \\
    x_i       \quad &amp; \text{ with prob. } 1 - \alpha
  \end{cases}
\end{split}
\end{equation*}\]</span></p>
<p>i.e.&nbsp;we accept the proposal <span class="math inline">\(\tilde{x}\)</span> with probability <span class="math inline">\(\alpha\)</span> and reject it, thus sticking with our current iterate, with probability <span class="math inline">\(1 - \alpha\)</span>.</p>
</section>
<section id="what-we-need-from-a-model-logdensityproblems.jl" class="level2">
<h2 class="anchored" data-anchor-id="what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a></h2>
<p>There are a few things we need from the “target” / “model” / density that we want to sample from:</p>
<ol type="1">
<li>We need access to log-density <em>evaluations</em> <span class="math inline">\(\log \gamma(x)\)</span> so we can compute the acceptance ratio involving <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>We need access to log-density <em>gradients</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span> so we can compute the Leapfrog steps <span class="math inline">\(L_{\epsilon}(x, p)\)</span>.</li>
<li>We also need access to the “size” of the model so we can determine the size of <span class="math inline">\(M\)</span>.</li>
</ol>
<p>Luckily for us, there is a package called <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> which provides an interface for <em>exactly</em> this!</p>
<p>To demonstrate how one can implement the “<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface”<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> we will use a simple Gaussian model as an example:</p>
<div id="4" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblems</span>: LogDensityProblems;</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's define some type that represents the model.</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> IsotropicNormalModel{M<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"mean of the isotropic Gaussian"</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    mean<span class="op">::</span><span class="dt">M</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Specifies what input length the model expects.</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">dimension</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> <span class="fu">length</span>(model.mean)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Implementation of the log-density evaluation of the model.</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x<span class="op">::</span><span class="dt">AbstractVector{&lt;:Real}</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">-</span> <span class="fu">sum</span>(abs2, x <span class="op">.-</span> model.mean) <span class="op">/</span> <span class="fl">2</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This gives us all of the properties we want for our MALA sampler with the exception of the computation of the <em>gradient</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span>. There is the method <code>LogDensityProblems.logdensity_and_gradient</code> which should return a 2-tuple where the first entry is the evaluation of the logdensity <span class="math inline">\(\log \gamma(x)\)</span> and the second entry is the gradient <span class="math inline">\(\nabla \log \gamma(x)\)</span>.</p>
<p>There are two ways to “implement” this method: 1) we implement it by hand, which is feasible in the case of our <code>IsotropicNormalModel</code>, or b) we defer the implementation of this to a automatic differentiation backend.</p>
<p>To implement it by hand we can simply do</p>
<div id="6" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl that first-order, i.e. gradient information, is available.</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{1}</span>()</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Implement `logdensity_and_gradient`.</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    logγ_x <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="op">-</span>x <span class="op">.*</span> (x <span class="op">-</span> model.mean)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> logγ_x, ∇logγ_x</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s just try it out:</p>
<div id="8" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate the problem.</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> <span class="fu">IsotropicNormalModel</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.])</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create some example input that we can test on.</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>x_example <span class="op">=</span> <span class="fu">randn</span>(LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate!</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-26.74414679502867</code></pre>
</div>
</div>
<p>To defer it to an automatic differentiation backend, we can do</p>
<div id="10" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl we only have access to 0-th order information.</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{0}</span>()</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Use `LogDensityProblemsAD`'s `ADgradient` in combination with some AD backend to implement `logdensity_and_gradient`.</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblemsAD</span>, <span class="bu">ADTypes</span>, <span class="bu">ForwardDiff</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>model_with_grad <span class="op">=</span> <span class="fu">ADgradient</span>(<span class="fu">AutoForwardDiff</span>(), model)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model_with_grad, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-26.74414679502867</code></pre>
</div>
</div>
<p>We’ll continue with the second approach in this tutorial since this is typically what one does in practice, because there are better hobbies to spend time on than deriving gradients by hand.</p>
<p>At this point, one might wonder how we’re going to tie this back to Turing.jl in the end. Effectively, when working with inference methods that only require log-density evaluations and / or higher-order information of the log-density, Turing.jl actually converts the user-provided <code>Model</code> into an object implementing the above methods for <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>. As a result, most samplers provided by Turing.jl are actually implemented to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, enabling their use both <em>within</em> Turing.jl and <em>outside</em> of Turing.jl! Morever, there exists similar conversions for Stan through BridgeStan and Stan<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, which means that a sampler supporting the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface can easily be used on both Turing.jl <em>and</em> Stan models (in addition to user-provided models, as our <code>IsotropicNormalModel</code> above)!</p>
<p>Anyways, let’s move on to actually implementing the sampler.</p>
</section>
<section id="implementing-mala-in-abstractmcmc.jl" class="level2">
<h2 class="anchored" data-anchor-id="implementing-mala-in-abstractmcmc.jl">Implementing MALA in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a></h2>
<p>Now that we’ve established that a model implementing the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface provides us with all the information we need from <span class="math inline">\(\log \gamma(x)\)</span>, we can address the question: given an object that implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, how can we define a sampler for it?</p>
<p>We’re going to do this by making our sampler a sub-type of <code>AbstractMCMC.AbstractSampler</code> in addition to implementing a few methods from <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>. Why? Because it gets us <em>a lot</em> of functionality for free, as we will see later.</p>
<p>Moreover, <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> provides a very natural interface for MCMC algorithms.</p>
<p>First, we’ll define our <code>MALA</code> type</p>
<div id="12" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">AbstractMCMC</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALA{T,A} <span class="op">&lt;:</span><span class="dt"> AbstractMCMC.AbstractSampler</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"stepsize used in the leapfrog step"</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    ϵ_init<span class="op">::</span><span class="dt">T</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"covariance matrix used for the momentum"</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    M_init<span class="op">::</span><span class="dt">A</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notice how we’ve added the suffix <code>_init</code> to both the stepsize and the covariance matrix. We’ve done this because a <code>AbstractMCMC.AbstractSampler</code> should be <em>immutable</em>. Of course there might be many scenarios where we want to allow something like the stepsize and / or the covariance matrix to vary between iterations, e.g.&nbsp;during the burn-in / adaptation phase of the sampling process we might want to adjust the parameters using statistics computed from these initial iterations. But information which can change between iterations <em>should not go in the sampler itself</em>! Instead, this information should go in the sampler <em>state</em>.</p>
<p>The sampler state should at the very least contain all the necessary information to perform the next MCMC iteration, but usually contains further information, e.g.&nbsp;quantities and statistics useful for evaluating whether the sampler has converged.</p>
<p>We will use the following sampler state for our <code>MALA</code> sampler:</p>
<div id="14" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALAState{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This might seem overly redundant: we’re defining a type <code>MALAState</code> and it only contains a simple vector of reals. In this particular case we indeed could have dropped this and simply used a <code>AbstractVector{&lt;:Real}</code> as our sampler state, but typically, as we will see later, one wants to include other quantities in the sampler state. For example, if we also wanted to adapt the parameters of our <code>MALA</code>, e.g.&nbsp;alter the stepsize depending on acceptance rates, in which case we should also put <code>ϵ</code> in the state, but for now we’ll keep things simple.</p>
<p>Moreover, we also want a <em>sample</em> type, which is a type meant for “public consumption”, i.e.&nbsp;the end-user. This is generally going to contain a subset of the information present in the state. But in such a simple scenario as this, we similarly only have a <code>AbstractVector{&lt;:Real}</code>:</p>
<div id="16" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALASample{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We currently have three things:</p>
<ol type="1">
<li>A <code>AbstractMCMC.AbstractSampler</code> implementation called <code>MALA</code>.</li>
<li>A state <code>MALAState</code> for our sampler <code>MALA</code>.</li>
<li>A sample <code>MALASample</code> for our sampler <code>MALA</code>.</li>
</ol>
<p>That means that we’re ready to implement the only thing that really matters: <code>AbstractMCMC.step</code>.</p>
<p><code>AbstractMCMC.step</code> defines the MCMC iteration of our <code>MALA</code> given the current <code>MALAState</code>. Specifically, the signature of the function is as follows:</p>
<div id="18" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The RNG to ensure reproducibility.</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The model that defines our target.</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.AbstractModel</span>,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The sampler for which we're taking a `step`.</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">AbstractMCMC.AbstractSampler</span>,</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The current sampler `state`.</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    state;</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Additional keyword arguments that we may or may not need.</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Moreover, there is a specific <code>AbstractMCMC.AbstractModel</code> which is used to indicate that the model that is provided implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface: <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Since, as we discussed earlier, in our case we’re indeed going to work with types that support the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, we’ll define <code>AbstractMCMC.step</code> for such a <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Note that <code>AbstractMCMC.LogDensityModel</code> has no other purpose; it has a single field called <code>logdensity</code>, and it does nothing else. But by wrapping the model in <code>AbstractMCMC.LogDensityModel</code>, it allows samplers that want to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> to define their <code>AbstractMCMC.step</code> on this type without running into method ambiguities.</p>
<p>All in all, that means that the signature for our <code>AbstractMCMC.step</code> is going to be the following:</p>
<div id="20" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># `LogDensityModel` so we know we're working with LogDensityProblems.jl model.</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler.</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler state.</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Great! Now let’s actually implement the full <code>AbstractMCMC.step</code> for our <code>MALA</code>.</p>
<p>Let’s remind ourselves what we’re going to do:</p>
<ol type="1">
<li>Sample a new momentum <span class="math inline">\(p\)</span>.</li>
<li>Compute the log-density of the extended target <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>Take a single leapfrog step <span class="math inline">\((\tilde{x}, \tilde{p}) = L_{\epsilon}(x, p)\)</span>.</li>
<li>Accept or reject the proposed <span class="math inline">\((\tilde{x}, \tilde{p})\)</span>.</li>
</ol>
<p>All in all, this results in the following:</p>
<div id="22" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>: Random</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Distributions</span>  <span class="co"># so we get the `MvNormal`</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the wrapped model which implements LogDensityProblems.jl.</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just extract the sampler parameters to make our lives easier.</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    ϵ <span class="op">=</span> sampler.ϵ_init</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    M <span class="op">=</span> sampler.M_init</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the current parameters.</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> state.x</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sample the momentum.</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>    p_dist <span class="op">=</span> <span class="fu">MvNormal</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)), M)</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> <span class="fu">rand</span>(rng, p_dist)</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Propose using a single leapfrog step.</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>    x̃, p̃ <span class="op">=</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Accept or reject proposal.</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>    logp <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p)</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>    logp̃ <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x̃) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p̃)</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>    logα <span class="op">=</span> logp̃ <span class="op">-</span> logp</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>    state_new <span class="op">=</span> <span class="cf">if</span> <span class="fu">log</span>(<span class="fu">rand</span>(rng)) <span class="op">&lt;</span> logα</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Accept.</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x̃)</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Reject.</span></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x)</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return the "sample" and the sampler state.</span></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(state_new.x), state_new</span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Fairly straight-forward.</p>
<p>Of course, we haven’t defined the <code>leapfrog_step</code> method yet, so let’s do that:</p>
<div id="24" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p` using "position" `x`.</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x))</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    p1 <span class="op">=</span> p <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update the "position" `x` using momentum `p1`.</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    x̃ <span class="op">=</span> x <span class="op">+</span> ϵ <span class="op">.*</span> (M <span class="op">\</span> p1)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p1` using position `x̃`</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x̃ <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x̃))</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    p2 <span class="op">=</span> p1 <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x̃</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Flip momentum `p2`.</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    p̃ <span class="op">=</span> <span class="op">-</span>p2</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x̃, p̃</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>leapfrog_step (generic function with 1 method)</code></pre>
</div>
</div>
<p>With all of this, we’re technically ready to sample!</p>
<div id="26" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>, <span class="bu">LinearAlgebra</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>rng <span class="op">=</span> <span class="bu">Random</span>.<span class="fu">default_rng</span>()</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>sampler <span class="op">=</span> <span class="fu">MALA</span>(<span class="fl">1</span>, I)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>state <span class="op">=</span> <span class="fu">MALAState</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)))</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>x_next, state_next <span class="op">=</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    rng,</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    AbstractMCMC.<span class="fu">LogDensityModel</span>(model),</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    state</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>(MALASample{Vector{Float64}}([0.0, 0.0, 0.0]), MALAState{Vector{Float64}}([0.0, 0.0, 0.0]))</code></pre>
</div>
</div>
<p>Great, it works!</p>
<p>And I promised we would get quite some functionality for free if we implemented <code>AbstractMCMC.step</code>, and so we can now simply call <code>sample</code> to perform standard MCMC sampling:</p>
<div id="28" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform 1000 iterations with our `MALA` sampler.</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; initial_state<span class="op">=</span>state, progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Concatenate into a matrix.</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000 Matrix{Float64}:
 -3.35376    -2.15564   -2.70943   …  -5.63546   -5.07697  -5.45123
  0.0142713   0.159303  -0.791867     -0.541621   1.74274   1.87659
  1.21734     3.21212    5.61868       3.66243    4.641     5.31047</code></pre>
</div>
</div>
<div id="30" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the marginal means and standard deviations.</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -4.98405    1.00378
  0.0187077  1.00238
  5.00618    0.982604</code></pre>
</div>
</div>
<p>Let’s visualize the samples</p>
<div id="32" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">StatsPlots</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">transpose</span>(samples_matrix[<span class="op">:</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">:</span><span class="kw">end</span>]), alpha<span class="op">=</span><span class="fl">0.5</span>, legend<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<!--?xml version="1.0" encoding="utf-8"?-->
<svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" width="672" height="480" viewbox="0 0 2688 1920">
<defs>
  <clippath id="clip670">
    <rect x="0" y="0" width="2688" height="1920"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip670)" d="M0 1920 L2688 1920 L2688 0 L0 0  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip671">
    <rect x="537" y="0" width="1883" height="1883"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip670)" d="M196.816 1800.78 L2640.76 1800.78 L2640.76 47.2441 L196.816 47.2441  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip672">
    <rect x="196" y="47" width="2445" height="1755"></rect>
  </clippath>
</defs>
<polyline clip-path="url(#clip672)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="263.676,1800.78 263.676,47.2441 "></polyline>
<polyline clip-path="url(#clip672)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="840.654,1800.78 840.654,47.2441 "></polyline>
<polyline clip-path="url(#clip672)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1417.63,1800.78 1417.63,47.2441 "></polyline>
<polyline clip-path="url(#clip672)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1994.61,1800.78 1994.61,47.2441 "></polyline>
<polyline clip-path="url(#clip672)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="2571.59,1800.78 2571.59,47.2441 "></polyline>
<polyline clip-path="url(#clip672)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,1599.18 2640.76,1599.18 "></polyline>
<polyline clip-path="url(#clip672)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,1368.22 2640.76,1368.22 "></polyline>
<polyline clip-path="url(#clip672)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,1137.25 2640.76,1137.25 "></polyline>
<polyline clip-path="url(#clip672)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,906.285 2640.76,906.285 "></polyline>
<polyline clip-path="url(#clip672)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,675.32 2640.76,675.32 "></polyline>
<polyline clip-path="url(#clip672)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,444.355 2640.76,444.355 "></polyline>
<polyline clip-path="url(#clip672)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,213.39 2640.76,213.39 "></polyline>
<polyline clip-path="url(#clip670)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1800.78 2640.76,1800.78 "></polyline>
<polyline clip-path="url(#clip670)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="263.676,1800.78 263.676,1781.88 "></polyline>
<polyline clip-path="url(#clip670)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="840.654,1800.78 840.654,1781.88 "></polyline>
<polyline clip-path="url(#clip670)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1417.63,1800.78 1417.63,1781.88 "></polyline>
<polyline clip-path="url(#clip670)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1994.61,1800.78 1994.61,1781.88 "></polyline>
<polyline clip-path="url(#clip670)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="2571.59,1800.78 2571.59,1781.88 "></polyline>
<path clip-path="url(#clip670)" d="M263.676 1834 Q260.065 1834 258.236 1837.57 Q256.431 1841.11 256.431 1848.24 Q256.431 1855.34 258.236 1858.91 Q260.065 1862.45 263.676 1862.45 Q267.31 1862.45 269.116 1858.91 Q270.945 1855.34 270.945 1848.24 Q270.945 1841.11 269.116 1837.57 Q267.31 1834 263.676 1834 M263.676 1830.3 Q269.486 1830.3 272.542 1834.9 Q275.621 1839.49 275.621 1848.24 Q275.621 1856.96 272.542 1861.57 Q269.486 1866.15 263.676 1866.15 Q257.866 1866.15 254.787 1861.57 Q251.732 1856.96 251.732 1848.24 Q251.732 1839.49 254.787 1834.9 Q257.866 1830.3 263.676 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip670)" d="M804.346 1861.55 L820.666 1861.55 L820.666 1865.48 L798.721 1865.48 L798.721 1861.55 Q801.383 1858.79 805.967 1854.16 Q810.573 1849.51 811.754 1848.17 Q813.999 1845.65 814.879 1843.91 Q815.782 1842.15 815.782 1840.46 Q815.782 1837.71 813.837 1835.97 Q811.916 1834.23 808.814 1834.23 Q806.615 1834.23 804.161 1835 Q801.731 1835.76 798.953 1837.31 L798.953 1832.59 Q801.777 1831.46 804.231 1830.88 Q806.684 1830.3 808.721 1830.3 Q814.092 1830.3 817.286 1832.98 Q820.481 1835.67 820.481 1840.16 Q820.481 1842.29 819.67 1844.21 Q818.883 1846.11 816.777 1848.7 Q816.198 1849.37 813.096 1852.59 Q809.995 1855.78 804.346 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip670)" d="M830.527 1830.92 L848.883 1830.92 L848.883 1834.86 L834.809 1834.86 L834.809 1843.33 Q835.828 1842.98 836.846 1842.82 Q837.865 1842.64 838.883 1842.64 Q844.67 1842.64 848.05 1845.81 Q851.43 1848.98 851.43 1854.4 Q851.43 1859.97 847.957 1863.08 Q844.485 1866.15 838.166 1866.15 Q835.99 1866.15 833.721 1865.78 Q831.476 1865.41 829.069 1864.67 L829.069 1859.97 Q831.152 1861.11 833.374 1861.66 Q835.596 1862.22 838.073 1862.22 Q842.078 1862.22 844.416 1860.11 Q846.754 1858.01 846.754 1854.4 Q846.754 1850.78 844.416 1848.68 Q842.078 1846.57 838.073 1846.57 Q836.198 1846.57 834.323 1846.99 Q832.471 1847.4 830.527 1848.28 L830.527 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip670)" d="M870.642 1834 Q867.031 1834 865.203 1837.57 Q863.397 1841.11 863.397 1848.24 Q863.397 1855.34 865.203 1858.91 Q867.031 1862.45 870.642 1862.45 Q874.277 1862.45 876.082 1858.91 Q877.911 1855.34 877.911 1848.24 Q877.911 1841.11 876.082 1837.57 Q874.277 1834 870.642 1834 M870.642 1830.3 Q876.453 1830.3 879.508 1834.9 Q882.587 1839.49 882.587 1848.24 Q882.587 1856.96 879.508 1861.57 Q876.453 1866.15 870.642 1866.15 Q864.832 1866.15 861.754 1861.57 Q858.698 1856.96 858.698 1848.24 Q858.698 1839.49 861.754 1834.9 Q864.832 1830.3 870.642 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip670)" d="M1377.25 1830.92 L1395.61 1830.92 L1395.61 1834.86 L1381.53 1834.86 L1381.53 1843.33 Q1382.55 1842.98 1383.57 1842.82 Q1384.59 1842.64 1385.61 1842.64 Q1391.39 1842.64 1394.77 1845.81 Q1398.15 1848.98 1398.15 1854.4 Q1398.15 1859.97 1394.68 1863.08 Q1391.21 1866.15 1384.89 1866.15 Q1382.71 1866.15 1380.44 1865.78 Q1378.2 1865.41 1375.79 1864.67 L1375.79 1859.97 Q1377.88 1861.11 1380.1 1861.66 Q1382.32 1862.22 1384.8 1862.22 Q1388.8 1862.22 1391.14 1860.11 Q1393.48 1858.01 1393.48 1854.4 Q1393.48 1850.78 1391.14 1848.68 Q1388.8 1846.57 1384.8 1846.57 Q1382.92 1846.57 1381.05 1846.99 Q1379.19 1847.4 1377.25 1848.28 L1377.25 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip670)" d="M1417.37 1834 Q1413.75 1834 1411.93 1837.57 Q1410.12 1841.11 1410.12 1848.24 Q1410.12 1855.34 1411.93 1858.91 Q1413.75 1862.45 1417.37 1862.45 Q1421 1862.45 1422.81 1858.91 Q1424.63 1855.34 1424.63 1848.24 Q1424.63 1841.11 1422.81 1837.57 Q1421 1834 1417.37 1834 M1417.37 1830.3 Q1423.18 1830.3 1426.23 1834.9 Q1429.31 1839.49 1429.31 1848.24 Q1429.31 1856.96 1426.23 1861.57 Q1423.18 1866.15 1417.37 1866.15 Q1411.56 1866.15 1408.48 1861.57 Q1405.42 1856.96 1405.42 1848.24 Q1405.42 1839.49 1408.48 1834.9 Q1411.56 1830.3 1417.37 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip670)" d="M1447.53 1834 Q1443.92 1834 1442.09 1837.57 Q1440.28 1841.11 1440.28 1848.24 Q1440.28 1855.34 1442.09 1858.91 Q1443.92 1862.45 1447.53 1862.45 Q1451.16 1862.45 1452.97 1858.91 Q1454.8 1855.34 1454.8 1848.24 Q1454.8 1841.11 1452.97 1837.57 Q1451.16 1834 1447.53 1834 M1447.53 1830.3 Q1453.34 1830.3 1456.39 1834.9 Q1459.47 1839.49 1459.47 1848.24 Q1459.47 1856.96 1456.39 1861.57 Q1453.34 1866.15 1447.53 1866.15 Q1441.72 1866.15 1438.64 1861.57 Q1435.58 1856.96 1435.58 1848.24 Q1435.58 1839.49 1438.64 1834.9 Q1441.72 1830.3 1447.53 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip670)" d="M1952.89 1830.92 L1975.11 1830.92 L1975.11 1832.91 L1962.56 1865.48 L1957.68 1865.48 L1969.48 1834.86 L1952.89 1834.86 L1952.89 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip670)" d="M1984.27 1830.92 L2002.63 1830.92 L2002.63 1834.86 L1988.56 1834.86 L1988.56 1843.33 Q1989.58 1842.98 1990.59 1842.82 Q1991.61 1842.64 1992.63 1842.64 Q1998.42 1842.64 2001.8 1845.81 Q2005.18 1848.98 2005.18 1854.4 Q2005.18 1859.97 2001.7 1863.08 Q1998.23 1866.15 1991.91 1866.15 Q1989.74 1866.15 1987.47 1865.78 Q1985.22 1865.41 1982.82 1864.67 L1982.82 1859.97 Q1984.9 1861.11 1987.12 1861.66 Q1989.34 1862.22 1991.82 1862.22 Q1995.83 1862.22 1998.16 1860.11 Q2000.5 1858.01 2000.5 1854.4 Q2000.5 1850.78 1998.16 1848.68 Q1995.83 1846.57 1991.82 1846.57 Q1989.95 1846.57 1988.07 1846.99 Q1986.22 1847.4 1984.27 1848.28 L1984.27 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip670)" d="M2024.39 1834 Q2020.78 1834 2018.95 1837.57 Q2017.14 1841.11 2017.14 1848.24 Q2017.14 1855.34 2018.95 1858.91 Q2020.78 1862.45 2024.39 1862.45 Q2028.02 1862.45 2029.83 1858.91 Q2031.66 1855.34 2031.66 1848.24 Q2031.66 1841.11 2029.83 1837.57 Q2028.02 1834 2024.39 1834 M2024.39 1830.3 Q2030.2 1830.3 2033.26 1834.9 Q2036.33 1839.49 2036.33 1848.24 Q2036.33 1856.96 2033.26 1861.57 Q2030.2 1866.15 2024.39 1866.15 Q2018.58 1866.15 2015.5 1861.57 Q2012.45 1856.96 2012.45 1848.24 Q2012.45 1839.49 2015.5 1834.9 Q2018.58 1830.3 2024.39 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip670)" d="M2516.11 1861.55 L2523.75 1861.55 L2523.75 1835.18 L2515.44 1836.85 L2515.44 1832.59 L2523.71 1830.92 L2528.38 1830.92 L2528.38 1861.55 L2536.02 1861.55 L2536.02 1865.48 L2516.11 1865.48 L2516.11 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip670)" d="M2555.47 1834 Q2551.85 1834 2550.03 1837.57 Q2548.22 1841.11 2548.22 1848.24 Q2548.22 1855.34 2550.03 1858.91 Q2551.85 1862.45 2555.47 1862.45 Q2559.1 1862.45 2560.9 1858.91 Q2562.73 1855.34 2562.73 1848.24 Q2562.73 1841.11 2560.9 1837.57 Q2559.1 1834 2555.47 1834 M2555.47 1830.3 Q2561.28 1830.3 2564.33 1834.9 Q2567.41 1839.49 2567.41 1848.24 Q2567.41 1856.96 2564.33 1861.57 Q2561.28 1866.15 2555.47 1866.15 Q2549.66 1866.15 2546.58 1861.57 Q2543.52 1856.96 2543.52 1848.24 Q2543.52 1839.49 2546.58 1834.9 Q2549.66 1830.3 2555.47 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip670)" d="M2585.63 1834 Q2582.02 1834 2580.19 1837.57 Q2578.38 1841.11 2578.38 1848.24 Q2578.38 1855.34 2580.19 1858.91 Q2582.02 1862.45 2585.63 1862.45 Q2589.26 1862.45 2591.07 1858.91 Q2592.9 1855.34 2592.9 1848.24 Q2592.9 1841.11 2591.07 1837.57 Q2589.26 1834 2585.63 1834 M2585.63 1830.3 Q2591.44 1830.3 2594.49 1834.9 Q2597.57 1839.49 2597.57 1848.24 Q2597.57 1856.96 2594.49 1861.57 Q2591.44 1866.15 2585.63 1866.15 Q2579.82 1866.15 2576.74 1861.57 Q2573.68 1856.96 2573.68 1848.24 Q2573.68 1839.49 2576.74 1834.9 Q2579.82 1830.3 2585.63 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip670)" d="M2615.79 1834 Q2612.18 1834 2610.35 1837.57 Q2608.54 1841.11 2608.54 1848.24 Q2608.54 1855.34 2610.35 1858.91 Q2612.18 1862.45 2615.79 1862.45 Q2619.42 1862.45 2621.23 1858.91 Q2623.06 1855.34 2623.06 1848.24 Q2623.06 1841.11 2621.23 1837.57 Q2619.42 1834 2615.79 1834 M2615.79 1830.3 Q2621.6 1830.3 2624.65 1834.9 Q2627.73 1839.49 2627.73 1848.24 Q2627.73 1856.96 2624.65 1861.57 Q2621.6 1866.15 2615.79 1866.15 Q2609.98 1866.15 2606.9 1861.57 Q2603.84 1856.96 2603.84 1848.24 Q2603.84 1839.49 2606.9 1834.9 Q2609.98 1830.3 2615.79 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip670)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1800.78 196.816,47.2441 "></polyline>
<polyline clip-path="url(#clip670)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1599.18 215.714,1599.18 "></polyline>
<polyline clip-path="url(#clip670)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1368.22 215.714,1368.22 "></polyline>
<polyline clip-path="url(#clip670)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1137.25 215.714,1137.25 "></polyline>
<polyline clip-path="url(#clip670)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,906.285 215.714,906.285 "></polyline>
<polyline clip-path="url(#clip670)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,675.32 215.714,675.32 "></polyline>
<polyline clip-path="url(#clip670)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,444.355 215.714,444.355 "></polyline>
<polyline clip-path="url(#clip670)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,213.39 215.714,213.39 "></polyline>
<path clip-path="url(#clip670)" d="M50.5475 1599.63 L80.2233 1599.63 L80.2233 1603.57 L50.5475 1603.57 L50.5475 1599.63 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip670)" d="M89.1352 1581.9 L111.357 1581.9 L111.357 1583.89 L98.8111 1616.46 L93.9269 1616.46 L105.732 1585.84 L89.1352 1585.84 L89.1352 1581.9 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip670)" d="M120.478 1610.58 L125.362 1610.58 L125.362 1616.46 L120.478 1616.46 L120.478 1610.58 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip670)" d="M135.593 1581.9 L153.95 1581.9 L153.95 1585.84 L139.876 1585.84 L139.876 1594.31 Q140.894 1593.96 141.913 1593.8 Q142.931 1593.61 143.95 1593.61 Q149.737 1593.61 153.116 1596.78 Q156.496 1599.96 156.496 1605.37 Q156.496 1610.95 153.024 1614.05 Q149.552 1617.13 143.232 1617.13 Q141.056 1617.13 138.788 1616.76 Q136.542 1616.39 134.135 1615.65 L134.135 1610.95 Q136.218 1612.09 138.441 1612.64 Q140.663 1613.2 143.14 1613.2 Q147.144 1613.2 149.482 1611.09 Q151.82 1608.98 151.82 1605.37 Q151.82 1601.76 149.482 1599.66 Q147.144 1597.55 143.14 1597.55 Q141.265 1597.55 139.39 1597.97 Q137.538 1598.38 135.593 1599.26 L135.593 1581.9 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip670)" d="M49.5521 1368.67 L79.2279 1368.67 L79.2279 1372.6 L49.5521 1372.6 L49.5521 1368.67 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip670)" d="M89.3667 1350.94 L107.723 1350.94 L107.723 1354.87 L93.6491 1354.87 L93.6491 1363.34 Q94.6676 1363 95.6861 1362.83 Q96.7047 1362.65 97.7232 1362.65 Q103.51 1362.65 106.89 1365.82 Q110.269 1368.99 110.269 1374.41 Q110.269 1379.99 106.797 1383.09 Q103.325 1386.17 97.0056 1386.17 Q94.8297 1386.17 92.5612 1385.8 Q90.3158 1385.43 87.9084 1384.69 L87.9084 1379.99 Q89.9917 1381.12 92.2139 1381.68 Q94.4361 1382.23 96.913 1382.23 Q100.918 1382.23 103.256 1380.13 Q105.593 1378.02 105.593 1374.41 Q105.593 1370.8 103.256 1368.69 Q100.918 1366.58 96.913 1366.58 Q95.038 1366.58 93.163 1367 Q91.3112 1367.42 89.3667 1368.3 L89.3667 1350.94 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip670)" d="M119.482 1379.62 L124.367 1379.62 L124.367 1385.5 L119.482 1385.5 L119.482 1379.62 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip670)" d="M144.552 1354.01 Q140.941 1354.01 139.112 1357.58 Q137.306 1361.12 137.306 1368.25 Q137.306 1375.36 139.112 1378.92 Q140.941 1382.46 144.552 1382.46 Q148.186 1382.46 149.991 1378.92 Q151.82 1375.36 151.82 1368.25 Q151.82 1361.12 149.991 1357.58 Q148.186 1354.01 144.552 1354.01 M144.552 1350.31 Q150.362 1350.31 153.417 1354.92 Q156.496 1359.5 156.496 1368.25 Q156.496 1376.98 153.417 1381.58 Q150.362 1386.17 144.552 1386.17 Q138.741 1386.17 135.663 1381.58 Q132.607 1376.98 132.607 1368.25 Q132.607 1359.5 135.663 1354.92 Q138.741 1350.31 144.552 1350.31 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip670)" d="M50.5475 1137.7 L80.2233 1137.7 L80.2233 1141.64 L50.5475 1141.64 L50.5475 1137.7 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip670)" d="M94.3436 1150.6 L110.663 1150.6 L110.663 1154.53 L88.7186 1154.53 L88.7186 1150.6 Q91.3806 1147.84 95.9639 1143.21 Q100.57 1138.56 101.751 1137.22 Q103.996 1134.69 104.876 1132.96 Q105.779 1131.2 105.779 1129.51 Q105.779 1126.75 103.834 1125.02 Q101.913 1123.28 98.8111 1123.28 Q96.6121 1123.28 94.1584 1124.04 Q91.7278 1124.81 88.9501 1126.36 L88.9501 1121.64 Q91.7741 1120.5 94.2278 1119.92 Q96.6815 1119.35 98.7185 1119.35 Q104.089 1119.35 107.283 1122.03 Q110.478 1124.72 110.478 1129.21 Q110.478 1131.34 109.668 1133.26 Q108.881 1135.16 106.774 1137.75 Q106.195 1138.42 103.094 1141.64 Q99.9917 1144.83 94.3436 1150.6 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip670)" d="M120.478 1148.65 L125.362 1148.65 L125.362 1154.53 L120.478 1154.53 L120.478 1148.65 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip670)" d="M135.593 1119.97 L153.95 1119.97 L153.95 1123.91 L139.876 1123.91 L139.876 1132.38 Q140.894 1132.03 141.913 1131.87 Q142.931 1131.68 143.95 1131.68 Q149.737 1131.68 153.116 1134.85 Q156.496 1138.03 156.496 1143.44 Q156.496 1149.02 153.024 1152.12 Q149.552 1155.2 143.232 1155.2 Q141.056 1155.2 138.788 1154.83 Q136.542 1154.46 134.135 1153.72 L134.135 1149.02 Q136.218 1150.16 138.441 1150.71 Q140.663 1151.27 143.14 1151.27 Q147.144 1151.27 149.482 1149.16 Q151.82 1147.05 151.82 1143.44 Q151.82 1139.83 149.482 1137.73 Q147.144 1135.62 143.14 1135.62 Q141.265 1135.62 139.39 1136.04 Q137.538 1136.45 135.593 1137.33 L135.593 1119.97 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip670)" d="M99.3204 892.084 Q95.7093 892.084 93.8806 895.649 Q92.075 899.191 92.075 906.32 Q92.075 913.427 93.8806 916.991 Q95.7093 920.533 99.3204 920.533 Q102.955 920.533 104.76 916.991 Q106.589 913.427 106.589 906.32 Q106.589 899.191 104.76 895.649 Q102.955 892.084 99.3204 892.084 M99.3204 888.38 Q105.131 888.38 108.186 892.987 Q111.265 897.57 111.265 906.32 Q111.265 915.047 108.186 919.653 Q105.131 924.237 99.3204 924.237 Q93.5102 924.237 90.4315 919.653 Q87.376 915.047 87.376 906.32 Q87.376 897.57 90.4315 892.987 Q93.5102 888.38 99.3204 888.38 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip670)" d="M119.482 917.686 L124.367 917.686 L124.367 923.565 L119.482 923.565 L119.482 917.686 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip670)" d="M144.552 892.084 Q140.941 892.084 139.112 895.649 Q137.306 899.191 137.306 906.32 Q137.306 913.427 139.112 916.991 Q140.941 920.533 144.552 920.533 Q148.186 920.533 149.991 916.991 Q151.82 913.427 151.82 906.32 Q151.82 899.191 149.991 895.649 Q148.186 892.084 144.552 892.084 M144.552 888.38 Q150.362 888.38 153.417 892.987 Q156.496 897.57 156.496 906.32 Q156.496 915.047 153.417 919.653 Q150.362 924.237 144.552 924.237 Q138.741 924.237 135.663 919.653 Q132.607 915.047 132.607 906.32 Q132.607 897.57 135.663 892.987 Q138.741 888.38 144.552 888.38 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip670)" d="M94.3436 688.665 L110.663 688.665 L110.663 692.6 L88.7186 692.6 L88.7186 688.665 Q91.3806 685.911 95.9639 681.281 Q100.57 676.628 101.751 675.286 Q103.996 672.763 104.876 671.026 Q105.779 669.267 105.779 667.577 Q105.779 664.823 103.834 663.087 Q101.913 661.351 98.8111 661.351 Q96.6121 661.351 94.1584 662.114 Q91.7278 662.878 88.9501 664.429 L88.9501 659.707 Q91.7741 658.573 94.2278 657.994 Q96.6815 657.415 98.7185 657.415 Q104.089 657.415 107.283 660.101 Q110.478 662.786 110.478 667.277 Q110.478 669.406 109.668 671.327 Q108.881 673.226 106.774 675.818 Q106.195 676.489 103.094 679.707 Q99.9917 682.901 94.3436 688.665 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip670)" d="M120.478 686.721 L125.362 686.721 L125.362 692.6 L120.478 692.6 L120.478 686.721 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip670)" d="M135.593 658.04 L153.95 658.04 L153.95 661.976 L139.876 661.976 L139.876 670.448 Q140.894 670.101 141.913 669.939 Q142.931 669.753 143.95 669.753 Q149.737 669.753 153.116 672.925 Q156.496 676.096 156.496 681.513 Q156.496 687.091 153.024 690.193 Q149.552 693.272 143.232 693.272 Q141.056 693.272 138.788 692.901 Q136.542 692.531 134.135 691.79 L134.135 687.091 Q136.218 688.225 138.441 688.781 Q140.663 689.337 143.14 689.337 Q147.144 689.337 149.482 687.23 Q151.82 685.124 151.82 681.513 Q151.82 677.901 149.482 675.795 Q147.144 673.689 143.14 673.689 Q141.265 673.689 139.39 674.105 Q137.538 674.522 135.593 675.401 L135.593 658.04 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip670)" d="M89.3667 427.075 L107.723 427.075 L107.723 431.011 L93.6491 431.011 L93.6491 439.483 Q94.6676 439.136 95.6861 438.973 Q96.7047 438.788 97.7232 438.788 Q103.51 438.788 106.89 441.96 Q110.269 445.131 110.269 450.547 Q110.269 456.126 106.797 459.228 Q103.325 462.307 97.0056 462.307 Q94.8297 462.307 92.5612 461.936 Q90.3158 461.566 87.9084 460.825 L87.9084 456.126 Q89.9917 457.26 92.2139 457.816 Q94.4361 458.372 96.913 458.372 Q100.918 458.372 103.256 456.265 Q105.593 454.159 105.593 450.547 Q105.593 446.936 103.256 444.83 Q100.918 442.723 96.913 442.723 Q95.038 442.723 93.163 443.14 Q91.3112 443.557 89.3667 444.436 L89.3667 427.075 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip670)" d="M119.482 455.756 L124.367 455.756 L124.367 461.635 L119.482 461.635 L119.482 455.756 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip670)" d="M144.552 430.154 Q140.941 430.154 139.112 433.719 Q137.306 437.261 137.306 444.39 Q137.306 451.497 139.112 455.061 Q140.941 458.603 144.552 458.603 Q148.186 458.603 149.991 455.061 Q151.82 451.497 151.82 444.39 Q151.82 437.261 149.991 433.719 Q148.186 430.154 144.552 430.154 M144.552 426.45 Q150.362 426.45 153.417 431.057 Q156.496 435.64 156.496 444.39 Q156.496 453.117 153.417 457.723 Q150.362 462.307 144.552 462.307 Q138.741 462.307 135.663 457.723 Q132.607 453.117 132.607 444.39 Q132.607 435.64 135.663 431.057 Q138.741 426.45 144.552 426.45 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip670)" d="M89.1352 196.11 L111.357 196.11 L111.357 198.101 L98.8111 230.67 L93.9269 230.67 L105.732 200.046 L89.1352 200.046 L89.1352 196.11 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip670)" d="M120.478 224.791 L125.362 224.791 L125.362 230.67 L120.478 230.67 L120.478 224.791 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip670)" d="M135.593 196.11 L153.95 196.11 L153.95 200.046 L139.876 200.046 L139.876 208.518 Q140.894 208.17 141.913 208.008 Q142.931 207.823 143.95 207.823 Q149.737 207.823 153.116 210.995 Q156.496 214.166 156.496 219.582 Q156.496 225.161 153.024 228.263 Q149.552 231.342 143.232 231.342 Q141.056 231.342 138.788 230.971 Q136.542 230.601 134.135 229.86 L134.135 225.161 Q136.218 226.295 138.441 226.851 Q140.663 227.406 143.14 227.406 Q147.144 227.406 149.482 225.3 Q151.82 223.194 151.82 219.582 Q151.82 215.971 149.482 213.865 Q147.144 211.758 143.14 211.758 Q141.265 211.758 139.39 212.175 Q137.538 212.592 135.593 213.471 L135.593 196.11 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip672)" style="stroke:#009af9; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="265.984,1216.13 268.292,1347.45 270.6,1398.37 272.908,1469.88 275.216,1394.41 277.524,1550.41 279.832,1344.49 282.139,1380.93 284.447,1271.13 286.755,1291.06 289.063,1332.19 291.371,1341.03 293.679,1328.39 295.987,1413.63 298.295,1391.02 300.603,1446.96 302.911,1391.97 305.219,1410.7 307.527,1409.77 309.834,1412.65 312.142,1201.68 314.45,1373.18 316.758,1265.37 319.066,1423.75 321.374,1497.05 323.682,1417.77 325.99,1463.23 328.298,1508.65 330.606,1294.11 332.914,1285.76 335.221,1404.25 337.529,1443.94 339.837,1233.04 342.145,1354.44 344.453,1366.31 346.761,1162.38 349.069,1177.73 351.377,1456.96 353.685,1405.97 355.993,1363.62 358.301,1309.64 360.608,1424.69 362.916,1369.07 365.224,1270.09 367.532,1494 369.84,1395.71 372.148,1395.92 374.456,1404.42 376.764,1462.22 379.072,1388.72 381.38,1376.88 383.688,1447.63 385.996,1449.24 388.303,1428.42 390.611,1335.24 392.919,1381.34 395.227,1382.28 397.535,1253.51 399.843,1400.48 402.151,1192.41 404.459,1164.73 406.767,1494.47 409.075,1468.62 411.383,1170.14 413.69,1299.52 415.998,1482.71 418.306,1344.31 420.614,1243.33 422.922,1345.48 425.23,1527.2 427.538,1290.84 429.846,1380.88 432.154,1154.69 434.462,1446.89 436.77,1227.64 439.077,1347.47 441.385,1273.45 443.693,1332.78 446.001,1234.84 448.309,1314.68 450.617,1333.65 452.925,1210.39 455.233,1234.06 457.541,1450.68 459.849,1360.82 462.157,1303.53 464.465,1348.78 466.772,1382.2 469.08,1516.67 471.388,1342.56 473.696,1418.08 476.004,1307.01 478.312,1261.39 480.62,1418.86 482.928,1373.66 485.236,1425.65 487.544,1445.5 489.852,1305.75 492.159,1539.73 494.467,1323.37 496.775,1314.94 499.083,1445.65 501.391,1407.2 503.699,1355.63 506.007,1356.09 508.315,1428.31 510.623,1287.28 512.931,1537.78 515.239,1336.68 517.546,1335.85 519.854,1340.14 522.162,1298.2 524.47,1416.1 526.778,1363.83 529.086,1231.63 531.394,1458.75 533.702,1529.81 536.01,1364.12 538.318,1358.69 540.626,1330.64 542.933,1441.91 545.241,1355.3 547.549,1314.3 549.857,1315.16 552.165,1348.28 554.473,1346.25 556.781,1296.02 559.089,1458.71 561.397,1356.83 563.705,1345.52 566.013,1287.45 568.321,1295.16 570.628,1313.12 572.936,1516.27 575.244,1336.53 577.552,1354.46 579.86,1412.89 582.168,1424.69 584.476,1378.84 586.784,1488.46 589.092,1395.77 591.4,1263.54 593.708,1463.51 596.015,1427.71 598.323,1325.58 600.631,1264.03 602.939,1331.77 605.247,1326.32 607.555,1605.42 609.863,1211.03 612.171,1180.66 614.479,1286.9 616.787,1507.33 619.095,1429.12 621.402,1571.64 623.71,1390.52 626.018,1323.36 628.326,1414.89 630.634,1498.98 632.942,1366.16 635.25,1402.38 637.558,1247.24 639.866,1228.95 642.174,1213.24 644.482,1371.2 646.79,1293.47 649.097,1413.03 651.405,1416.29 653.713,1422.92 656.021,1440.97 658.329,1401.45 660.637,1316.57 662.945,1479.01 665.253,1383.41 667.561,1288.57 669.869,1260.96 672.177,1278.19 674.484,1270.93 676.792,1227.1 679.1,1663.03 681.408,1378.84 683.716,1309.06 686.024,1297.42 688.332,1471.97 690.64,1354.92 692.948,1490.44 695.256,1223.17 697.564,1354.34 699.871,1348.92 702.179,1484.87 704.487,1444.26 706.795,1257.47 709.103,1349.39 711.411,1527.04 713.719,1329.54 716.027,1343.9 718.335,1331.97 720.643,1290.92 722.951,1409.08 725.259,1488.08 727.566,1390.5 729.874,1417.54 732.182,1197.14 734.49,1292.13 736.798,1357.3 739.106,1354.08 741.414,1501.47 743.722,1409.06 746.03,1342.6 748.338,1379.02 750.646,1304.59 752.953,1422.19 755.261,1437.88 757.569,1390.58 759.877,1500.63 762.185,1390.04 764.493,1514.95 766.801,1493.29 769.109,1510.83 771.417,1233.55 773.725,1264.22 776.033,1288.1 778.34,1466.6 780.648,1301.93 782.956,1399 785.264,1307.65 787.572,1298.92 789.88,1269.71 792.188,1329.49 794.496,1352.85 796.804,1465.57 799.112,1308.11 801.42,1428.47 803.728,1393.54 806.035,1343.84 808.343,1475.07 810.651,1359.02 812.959,1415.2 815.267,1394.66 817.575,1494.73 819.883,1430.51 822.191,1256.2 824.499,1265.29 826.807,1360.53 829.115,1423.68 831.422,1282.06 833.73,1408.74 836.038,1412.59 838.346,1331.43 840.654,1370.72 842.962,1467.84 845.27,1389.99 847.578,1339.73 849.886,1520.54 852.194,1307.75 854.502,1232.11 856.809,1270.16 859.117,1496.33 861.425,1241.1 863.733,1550.96 866.041,1217.87 868.349,1406.48 870.657,1363.07 872.965,1342.27 875.273,1450.72 877.581,1356.6 879.889,1420.13 882.197,1413.91 884.504,1293.67 886.812,1370.21 889.12,1461.08 891.428,1334.68 893.736,1387.61 896.044,1297.91 898.352,1203.32 900.66,1358.62 902.968,1478.09 905.276,1303.47 907.584,1337.11 909.891,1331.91 912.199,1430.57 914.507,1257.11 916.815,1385.58 919.123,1270.24 921.431,1329.36 923.739,1438.15 926.047,1335.37 928.355,1443.53 930.663,1398.47 932.971,1460.46 935.278,1349.99 937.586,1435.4 939.894,1303.12 942.202,1449.49 944.51,1442.97 946.818,1404.08 949.126,1439.47 951.434,1374.44 953.742,1373.71 956.05,1437.71 958.358,1352.96 960.665,1386.23 962.973,1448.83 965.281,1198.31 967.589,1353.15 969.897,1188.65 972.205,1213.72 974.513,1205.17 976.821,1281.1 979.129,1453.59 981.437,1478.26 983.745,1286.46 986.053,1391.26 988.36,1250.17 990.668,1471.03 992.976,1293.3 995.284,1329.16 997.592,1398.71 999.9,1201.92 1002.21,1264.11 1004.52,1514.3 1006.82,1419.03 1009.13,1259.34 1011.44,1329.11 1013.75,1365.49 1016.06,1311.14 1018.36,1284.48 1020.67,1275.71 1022.98,1389.89 1025.29,1460.78 1027.59,1389.88 1029.9,1474.6 1032.21,1268.63 1034.52,1259.05 1036.83,1255.47 1039.13,1429.83 1041.44,1430.04 1043.75,1403.5 1046.06,1273.25 1048.37,1259.6 1050.67,1257.05 1052.98,1391.44 1055.29,1392.41 1057.6,1307.74 1059.91,1384.76 1062.21,1376.08 1064.52,1330.29 1066.83,1338.54 1069.14,1341.76 1071.45,1381.09 1073.75,1255.76 1076.06,1420.14 1078.37,1252.07 1080.68,1493.09 1082.98,1390.5 1085.29,1208.9 1087.6,1257.46 1089.91,1241.43 1092.22,1325.69 1094.52,1361.65 1096.83,1403.88 1099.14,1365.54 1101.45,1299.81 1103.76,1372.46 1106.06,1497.12 1108.37,1425.94 1110.68,1346.89 1112.99,1400.49 1115.3,1574.87 1117.6,1150.38 1119.91,1518.11 1122.22,1371.2 1124.53,1565.66 1126.84,1385.57 1129.14,1406.44 1131.45,1332.55 1133.76,1419.9 1136.07,1361.7 1138.37,1370.95 1140.68,1367.34 1142.99,1446.72 1145.3,1323.43 1147.61,1236.68 1149.91,1346.62 1152.22,1523.9 1154.53,1300.63 1156.84,1238.09 1159.15,1270.62 1161.45,1475.32 1163.76,1422.33 1166.07,1515.45 1168.38,1379.31 1170.69,1545.9 1172.99,1639.53 1175.3,1387.28 1177.61,1342.67 1179.92,1341.01 1182.23,1384.23 1184.53,1577.18 1186.84,1288.04 1189.15,1249.52 1191.46,1374.58 1193.76,1274.79 1196.07,1237.72 1198.38,1395.68 1200.69,1345.11 1203,1264.54 1205.3,1403.71 1207.61,1390.84 1209.92,1396.56 1212.23,1410.61 1214.54,1354.73 1216.84,1359.7 1219.15,1270.82 1221.46,1486.54 1223.77,1309.88 1226.08,1529.29 1228.38,1479.26 1230.69,1366.86 1233,1497.27 1235.31,1330.42 1237.61,1374.06 1239.92,1382.37 1242.23,1236.58 1244.54,1297.66 1246.85,1201.89 1249.15,1330.59 1251.46,1418.6 1253.77,1377.78 1256.08,1462.61 1258.39,1276.84 1260.69,1390.68 1263,1363.94 1265.31,1302.99 1267.62,1401.45 1269.93,1520.79 1272.23,1367.65 1274.54,1363.23 1276.85,1400.35 1279.16,1314.77 1281.47,1508.43 1283.77,1422.08 1286.08,1200.91 1288.39,1354.82 1290.7,1444.24 1293,1328.34 1295.31,1363.13 1297.62,1453.93 1299.93,1379.84 1302.24,1126.77 1304.54,1432.82 1306.85,1289.11 1309.16,1361.55 1311.47,1398.51 1313.78,1462.4 1316.08,1243.98 1318.39,1356.44 1320.7,1235.31 1323.01,1301.74 1325.32,1258.32 1327.62,1425.72 1329.93,1333.49 1332.24,1278.2 1334.55,1464.66 1336.86,1264.02 1339.16,1375.27 1341.47,1274.56 1343.78,1388.09 1346.09,1311.32 1348.39,1332.86 1350.7,1478.44 1353.01,1347.04 1355.32,1295.53 1357.63,1345.71 1359.93,1448.97 1362.24,1430.51 1364.55,1355.47 1366.86,1389.73 1369.17,1625.85 1371.47,1483.82 1373.78,1459.11 1376.09,1227.64 1378.4,1358.89 1380.71,1354.35 1383.01,1509.74 1385.32,1383.51 1387.63,1371.06 1389.94,1409.69 1392.24,1276.78 1394.55,1348.79 1396.86,1690.6 1399.17,1408.65 1401.48,1454.82 1403.78,1501.67 1406.09,1449.87 1408.4,1209.81 1410.71,1358.84 1413.02,1248.86 1415.32,1433.88 1417.63,1263.47 1419.94,1394.69 1422.25,1523.98 1424.56,1449.87 1426.86,1515.47 1429.17,1362.43 1431.48,1296.41 1433.79,1498.78 1436.1,1436.26 1438.4,1287.28 1440.71,1331.19 1443.02,1400.94 1445.33,1373.51 1447.63,1288.76 1449.94,1351.41 1452.25,1347.47 1454.56,1325.5 1456.87,1416.61 1459.17,1388.13 1461.48,1364.35 1463.79,1500.34 1466.1,1396.61 1468.41,1371.23 1470.71,1391.89 1473.02,1454.42 1475.33,1434.41 1477.64,1194.68 1479.95,1449 1482.25,1428.66 1484.56,1228.23 1486.87,1332.03 1489.18,1390.07 1491.49,1392.68 1493.79,1379.54 1496.1,1256.37 1498.41,1366.45 1500.72,1466.54 1503.02,1497.54 1505.33,1433.27 1507.64,1371.55 1509.95,1307.9 1512.26,1296.74 1514.56,1362.38 1516.87,1440.82 1519.18,1373.66 1521.49,1379.86 1523.8,1345.18 1526.1,1246.94 1528.41,1516.72 1530.72,1294.37 1533.03,1301.73 1535.34,1420.13 1537.64,1293.56 1539.95,1440.16 1542.26,1214.4 1544.57,1315.31 1546.88,1400.12 1549.18,1448.41 1551.49,1347.96 1553.8,1435.93 1556.11,1497.43 1558.41,1374.28 1560.72,1482.56 1563.03,1443.07 1565.34,1342.37 1567.65,1398 1569.95,1365.8 1572.26,1381.01 1574.57,1387.32 1576.88,1295.34 1579.19,1507.7 1581.49,1432.47 1583.8,1290.87 1586.11,1499.55 1588.42,1300.24 1590.73,1272.35 1593.03,1384.57 1595.34,1250.63 1597.65,1358.41 1599.96,1399.08 1602.26,1307.81 1604.57,1475.73 1606.88,1341.99 1609.19,1403.91 1611.5,1211.72 1613.8,1432.39 1616.11,1295.72 1618.42,1345.34 1620.73,1446.07 1623.04,1459 1625.34,1214.76 1627.65,1404.54 1629.96,1446.92 1632.27,1367.43 1634.58,1498.72 1636.88,1379.31 1639.19,1373.34 1641.5,1389.06 1643.81,1424.36 1646.12,1344.54 1648.42,1437.57 1650.73,1384.56 1653.04,1417.99 1655.35,1388.62 1657.65,1382.45 1659.96,1400.64 1662.27,1275.14 1664.58,1371.66 1666.89,1192.21 1669.19,1295.39 1671.5,1358.89 1673.81,1243.69 1676.12,1393.98 1678.43,1233.88 1680.73,1357.9 1683.04,1431.22 1685.35,1388.92 1687.66,1337.42 1689.97,1232.29 1692.27,1388.53 1694.58,1308.31 1696.89,1176.91 1699.2,1345.5 1701.51,1468.67 1703.81,1393.31 1706.12,1347.6 1708.43,1420.53 1710.74,1168.09 1713.04,1193.59 1715.35,1351.38 1717.66,1161.28 1719.97,1324.64 1722.28,1326.43 1724.58,1279.31 1726.89,1367.46 1729.2,1284.1 1731.51,1455.14 1733.82,1328.81 1736.12,1203.3 1738.43,1358.8 1740.74,1227.16 1743.05,1267.94 1745.36,1288.2 1747.66,1171.59 1749.97,1561.63 1752.28,1486.77 1754.59,1376.46 1756.9,1431.9 1759.2,1282.74 1761.51,1323.32 1763.82,1381.79 1766.13,1364.9 1768.43,1313.26 1770.74,1539.79 1773.05,1394.6 1775.36,1424.52 1777.67,1363.8 1779.97,1253.16 1782.28,1353.1 1784.59,1325.14 1786.9,1298.62 1789.21,1242.52 1791.51,1460.81 1793.82,1292.69 1796.13,1352.94 1798.44,1364.64 1800.75,1559.2 1803.05,1411.74 1805.36,1611.98 1807.67,1247.49 1809.98,1332.81 1812.28,1496.36 1814.59,1462.52 1816.9,1381.04 1819.21,1383.2 1821.52,1431.62 1823.82,1594.38 1826.13,1355.72 1828.44,1389.75 1830.75,1482.57 1833.06,1348.42 1835.36,1427.63 1837.67,1479.09 1839.98,1490.12 1842.29,1412.33 1844.6,1414.38 1846.9,1481.77 1849.21,1299.47 1851.52,1296.75 1853.83,1325.47 1856.14,1288.92 1858.44,1293.55 1860.75,1390.83 1863.06,1287.65 1865.37,1365.58 1867.67,1364.94 1869.98,1331.56 1872.29,1531.7 1874.6,1348.4 1876.91,1310.05 1879.21,1384.76 1881.52,1377.34 1883.83,1751.15 1886.14,1367.91 1888.45,1459.74 1890.75,1305.03 1893.06,1451.45 1895.37,1348.26 1897.68,1264.35 1899.99,1404.96 1902.29,1362.92 1904.6,1402.36 1906.91,1251.82 1909.22,1390.7 1911.53,1411.03 1913.83,1160.01 1916.14,1362.15 1918.45,1215.92 1920.76,1287.86 1923.06,1412.02 1925.37,1532.87 1927.68,1429.54 1929.99,1413.55 1932.3,1452.15 1934.6,1419.85 1936.91,1409.01 1939.22,1373.27 1941.53,1494.62 1943.84,1468.16 1946.14,1335.5 1948.45,1341.79 1950.76,1244.38 1953.07,1424.49 1955.38,1466.27 1957.68,1403.21 1959.99,1384.74 1962.3,1147.18 1964.61,1435.34 1966.91,1331.23 1969.22,1303.86 1971.53,1455.3 1973.84,1333.17 1976.15,1517.25 1978.45,1205.17 1980.76,1365.12 1983.07,1424.39 1985.38,1334.34 1987.69,1259.1 1989.99,1460.32 1992.3,1374.56 1994.61,1274.72 1996.92,1383.48 1999.23,1221.11 2001.53,1375.14 2003.84,1322.52 2006.15,1314.87 2008.46,1337.21 2010.77,1251.3 2013.07,1289.79 2015.38,1413.3 2017.69,1433.19 2020,1391.95 2022.3,1361.31 2024.61,1452.78 2026.92,1549.7 2029.23,1476.36 2031.54,1335.57 2033.84,1453.76 2036.15,1386.17 2038.46,1228.4 2040.77,1442.45 2043.08,1340.06 2045.38,1472.63 2047.69,1198.49 2050,1350.77 2052.31,1490.21 2054.62,1344.63 2056.92,1523.28 2059.23,1370.69 2061.54,1457.62 2063.85,1303.2 2066.16,1341.69 2068.46,1403.21 2070.77,1323.96 2073.08,1352.55 2075.39,1181.33 2077.69,1414.73 2080,1560.8 2082.31,1340.91 2084.62,1432 2086.93,1358.19 2089.23,1443.62 2091.54,1373.57 2093.85,1371.18 2096.16,1334.27 2098.47,1361.2 2100.77,1227.3 2103.08,1422.47 2105.39,1431.36 2107.7,1319.11 2110.01,1223.66 2112.31,1416.09 2114.62,1374.59 2116.93,1287.3 2119.24,1396.21 2121.55,1409.71 2123.85,1400.15 2126.16,1406.6 2128.47,1335.01 2130.78,1420.84 2133.08,1327.11 2135.39,1434.74 2137.7,1497.66 2140.01,1523.89 2142.32,1260.82 2144.62,1270.42 2146.93,1298.33 2149.24,1482.78 2151.55,1330.91 2153.86,1184.32 2156.16,1426.48 2158.47,1653.44 2160.78,1289.46 2163.09,1331.89 2165.4,1551.49 2167.7,1463.65 2170.01,1376.37 2172.32,1369.49 2174.63,1302.19 2176.93,1485.45 2179.24,1391.4 2181.55,1462.5 2183.86,1215 2186.17,1396 2188.47,1322.42 2190.78,1250.19 2193.09,1395.23 2195.4,1412.47 2197.71,1214.5 2200.01,1350.37 2202.32,1408.37 2204.63,1357.66 2206.94,1332.44 2209.25,1329.68 2211.55,1186.91 2213.86,1322.85 2216.17,1437.13 2218.48,1385.81 2220.79,1426.9 2223.09,1510.64 2225.4,1333.19 2227.71,1431.53 2230.02,1298.72 2232.32,1403.96 2234.63,1404.26 2236.94,1474.68 2239.25,1344.07 2241.56,1302.29 2243.86,1347.95 2246.17,1402.71 2248.48,1379.93 2250.79,1474.05 2253.1,1454.01 2255.4,1404.24 2257.71,1428.03 2260.02,1302.76 2262.33,1331.5 2264.64,1255.64 2266.94,1138.94 2269.25,1475.32 2271.56,1295.19 2273.87,1269.96 2276.18,1237.48 2278.48,1476.24 2280.79,1407.77 2283.1,1306.08 2285.41,1392.29 2287.71,1406.86 2290.02,1432.23 2292.33,1246.15 2294.64,1449.33 2296.95,1180.23 2299.25,1524.56 2301.56,1363.79 2303.87,1404.95 2306.18,1326.43 2308.49,1371.83 2310.79,1294.51 2313.1,1443.83 2315.41,1298.49 2317.72,1227.78 2320.03,1451.98 2322.33,1380.29 2324.64,1300.71 2326.95,1429.96 2329.26,1281.34 2331.56,1235.97 2333.87,1331.78 2336.18,1366.67 2338.49,1490.91 2340.8,1520.08 2343.1,1282.24 2345.41,1288.23 2347.72,1300.28 2350.03,1257.62 2352.34,1355.18 2354.64,1431.36 2356.95,1182.64 2359.26,1273.81 2361.57,1657.02 2363.88,1421.28 2366.18,1189.46 2368.49,1440.96 2370.8,1341.61 2373.11,1399.76 2375.42,1346.19 2377.72,1330.28 2380.03,1506.47 2382.34,1448.71 2384.65,1250.32 2386.95,1499.45 2389.26,1391.66 2391.57,1333.04 2393.88,1463.94 2396.19,1195.01 2398.49,1235.32 2400.8,1322.24 2403.11,1276.6 2405.42,1204.45 2407.73,1341.23 2410.03,1403.76 2412.34,1305.38 2414.65,1264.21 2416.96,1314.96 2419.27,1293.73 2421.57,1247.24 2423.88,1259.85 2426.19,1318.53 2428.5,1403.68 2430.81,1332.64 2433.11,1479.28 2435.42,1486.26 2437.73,1536.47 2440.04,1319.31 2442.34,1383.67 2444.65,1339.1 2446.96,1299.83 2449.27,1400.5 2451.58,1280.2 2453.88,1289.61 2456.19,1482.32 2458.5,1471.06 2460.81,1195.92 2463.12,1180.47 2465.42,1335.6 2467.73,1469.04 2470.04,1456.47 2472.35,1259.72 2474.66,1395.54 2476.96,1403.76 2479.27,1439.19 2481.58,1429.94 2483.89,1302.83 2486.2,1291.18 2488.5,1303.3 2490.81,1451.6 2493.12,1406.67 2495.43,1460.6 2497.73,1460.53 2500.04,1479.95 2502.35,1228.19 2504.66,1399.45 2506.97,1402.45 2509.27,1266.45 2511.58,1388.12 2513.89,1360.02 2516.2,1495.27 2518.51,1447.04 2520.81,1361.8 2523.12,1358.31 2525.43,1231.54 2527.74,1467 2530.05,1291.5 2532.35,1288.24 2534.66,1494.64 2536.97,1341.07 2539.28,1434.74 2541.58,1347.47 2543.89,1618.78 2546.2,1415.45 2548.51,1204.16 2550.82,1324.11 2553.12,1493.16 2555.43,1279.93 2557.74,1325.79 2560.05,1375.5 2562.36,1562.05 2564.66,1419.07 2566.97,1316.99 2569.28,1600.82 2571.59,1379.72 "></polyline>
<polyline clip-path="url(#clip672)" style="stroke:#e26f46; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="265.984,904.967 268.292,811.293 270.6,872.812 272.908,933.17 275.216,911.732 277.524,813.89 279.832,1019.92 282.139,914.88 284.447,865.664 286.755,903.466 289.063,868.915 291.371,976.966 293.679,1098.34 295.987,734.989 298.295,1016.98 300.603,867.88 302.911,916.904 305.219,906.794 307.527,825.839 309.834,942.467 312.142,931.849 314.45,982.357 316.758,927.671 319.066,926.466 321.374,925.138 323.682,887.874 325.99,853.367 328.298,876.646 330.606,965.783 332.914,911.153 335.221,840.771 337.529,1022.53 339.837,983.023 342.145,943.947 344.453,836.142 346.761,1061.79 349.069,990.193 351.377,947.599 353.685,847.447 355.993,797.906 358.301,984.944 360.608,962.987 362.916,837.832 365.224,813.102 367.532,1097.68 369.84,779.265 372.148,754.158 374.456,778.34 376.764,788.353 379.072,872.741 381.38,894.454 383.688,792.299 385.996,859.869 388.303,824.878 390.611,882.117 392.919,849.086 395.227,1007.91 397.535,993.427 399.843,1002.97 402.151,876.841 404.459,952.515 406.767,886.48 409.075,695.78 411.383,886.205 413.69,888.659 415.998,870.024 418.306,875.32 420.614,850.563 422.922,985.934 425.23,829.005 427.538,979.444 429.846,906.299 432.154,886.263 434.462,1008.92 436.77,870.582 439.077,919.25 441.385,1041.85 443.693,854.636 446.001,983.9 448.309,887.706 450.617,872.284 452.925,858.044 455.233,843.713 457.541,1062.31 459.849,981.152 462.157,903.3 464.465,913.631 466.772,794.027 469.08,899.393 471.388,826.05 473.696,793.358 476.004,829.461 478.312,825.592 480.62,954.568 482.928,681.742 485.236,837.732 487.544,880.972 489.852,775.384 492.159,1065.19 494.467,909.145 496.775,730.515 499.083,906.421 501.391,864.623 503.699,1021.46 506.007,853.099 508.315,1099.07 510.623,821.791 512.931,904.013 515.239,1009.5 517.546,935.636 519.854,1073.47 522.162,912.636 524.47,974.694 526.778,846.587 529.086,996.841 531.394,836.43 533.702,849.851 536.01,875.392 538.318,977.581 540.626,867.675 542.933,872.373 545.241,818.569 547.549,829.96 549.857,1086.03 552.165,905.597 554.473,1052.42 556.781,963.137 559.089,774.228 561.397,904.509 563.705,828.325 566.013,836.584 568.321,711.944 570.628,965.081 572.936,1037.11 575.244,1081.23 577.552,982.897 579.86,1030.85 582.168,949.355 584.476,940.924 586.784,828.412 589.092,1081.52 591.4,779.87 593.708,948.115 596.015,892.758 598.323,979.362 600.631,1141.59 602.939,731.034 605.247,872.216 607.555,615.868 609.863,889.626 612.171,1118.92 614.479,1142.63 616.787,811.002 619.095,1119.12 621.402,890.575 623.71,1014.26 626.018,937.61 628.326,1045.64 630.634,1100.33 632.942,823.659 635.25,882.525 637.558,972.466 639.866,646.079 642.174,865.775 644.482,866.4 646.79,830.384 649.097,886.584 651.405,971.916 653.713,892.909 656.021,904.718 658.329,894.81 660.637,1049.21 662.945,851.809 665.253,835.834 667.561,1026.02 669.869,781.688 672.177,892.404 674.484,875.738 676.792,996.552 679.1,967.755 681.408,898.082 683.716,965.569 686.024,903.296 688.332,752.67 690.64,828.442 692.948,932.798 695.256,954.36 697.564,1068.18 699.871,1045.61 702.179,924.311 704.487,839.316 706.795,1021.06 709.103,807.934 711.411,988.597 713.719,788.365 716.027,1069.9 718.335,800.326 720.643,943.155 722.951,948.022 725.259,823.241 727.566,862.035 729.874,822.087 732.182,795.993 734.49,814.211 736.798,891.979 739.106,878.281 741.414,868.846 743.722,954.653 746.03,992.962 748.338,917.251 750.646,984.344 752.953,1000.34 755.261,869.359 757.569,925.097 759.877,937.874 762.185,988.321 764.493,940.708 766.801,987.36 769.109,857.95 771.417,822.803 773.725,812.93 776.033,800.003 778.34,742.701 780.648,1037.14 782.956,857.309 785.264,978.395 787.572,882.728 789.88,888.238 792.188,951.988 794.496,921.822 796.804,902.671 799.112,1014.84 801.42,820.527 803.728,893.583 806.035,866.126 808.343,909.531 810.651,1061.77 812.959,826.421 815.267,1070.26 817.575,991.045 819.883,836.625 822.191,1010.3 824.499,804.683 826.807,942.195 829.115,743.024 831.422,814.48 833.73,831.719 836.038,994.593 838.346,953.365 840.654,1054.27 842.962,890.023 845.27,864.046 847.578,827.572 849.886,882.835 852.194,1038.59 854.502,996.508 856.809,1037.93 859.117,833.648 861.425,873.11 863.733,820.08 866.041,894.982 868.349,805.553 870.657,803.715 872.965,966.784 875.273,930.197 877.581,1011.92 879.889,1025.96 882.197,860.86 884.504,851.917 886.812,821.316 889.12,1058.55 891.428,894.257 893.736,1004.19 896.044,956.622 898.352,824.422 900.66,894.988 902.968,923.368 905.276,782.382 907.584,794.305 909.891,885.222 912.199,811.18 914.507,827.743 916.815,989.394 919.123,864.62 921.431,921.809 923.739,865.466 926.047,916.513 928.355,773.806 930.663,814.818 932.971,867.236 935.278,914.549 937.586,914.288 939.894,1118.96 942.202,718.248 944.51,973.352 946.818,945.036 949.126,981.821 951.434,782.276 953.742,924.884 956.05,801.127 958.358,907.341 960.665,855.457 962.973,854.454 965.281,902.634 967.589,832.511 969.897,820.574 972.205,830.229 974.513,1060.38 976.821,866.347 979.129,999.306 981.437,825.529 983.745,914.619 986.053,837.496 988.36,1002.92 990.668,1121.41 992.976,995.868 995.284,783.898 997.592,970.319 999.9,899.576 1002.21,1002.94 1004.52,1101.39 1006.82,973.455 1009.13,940.223 1011.44,811.793 1013.75,902.392 1016.06,869.337 1018.36,862.389 1020.67,1036.8 1022.98,1140.45 1025.29,958.2 1027.59,1011.62 1029.9,997.223 1032.21,911.018 1034.52,978.73 1036.83,1155.88 1039.13,821.478 1041.44,881.888 1043.75,853.073 1046.06,862.105 1048.37,799.469 1050.67,761.325 1052.98,861.579 1055.29,1041.43 1057.6,800.305 1059.91,660.69 1062.21,856.147 1064.52,814.218 1066.83,912.431 1069.14,850.422 1071.45,957.705 1073.75,952.028 1076.06,850.988 1078.37,993.697 1080.68,915.766 1082.98,984.254 1085.29,868.747 1087.6,959.752 1089.91,829.699 1092.22,1007.27 1094.52,798.143 1096.83,894.006 1099.14,1017.5 1101.45,871.397 1103.76,852.001 1106.06,946.414 1108.37,959.933 1110.68,960.611 1112.99,833.856 1115.3,1011.29 1117.6,962.788 1119.91,810.995 1122.22,968.046 1124.53,927.1 1126.84,892.243 1129.14,871.591 1131.45,862.639 1133.76,709.736 1136.07,822.222 1138.37,884.909 1140.68,896.217 1142.99,825.744 1145.3,819.583 1147.61,880.625 1149.91,945.282 1152.22,1049.7 1154.53,1006.86 1156.84,777.884 1159.15,745.783 1161.45,766.75 1163.76,914.771 1166.07,890.128 1168.38,1143.99 1170.69,913.552 1172.99,897.136 1175.3,870.301 1177.61,732.152 1179.92,732.755 1182.23,775.892 1184.53,748.518 1186.84,967.217 1189.15,932.375 1191.46,830.223 1193.76,974.94 1196.07,988.342 1198.38,975.361 1200.69,696.032 1203,974.863 1205.3,847.206 1207.61,923.341 1209.92,967.629 1212.23,1042.7 1214.54,797.8 1216.84,906.136 1219.15,1120.42 1221.46,884.188 1223.77,771.797 1226.08,872.99 1228.38,1091.57 1230.69,969.564 1233,758.867 1235.31,879.651 1237.61,978.847 1239.92,936.199 1242.23,885.944 1244.54,1026.18 1246.85,973.994 1249.15,914.137 1251.46,788.026 1253.77,1140.33 1256.08,933.821 1258.39,890.874 1260.69,850.618 1263,984.58 1265.31,900.088 1267.62,758.783 1269.93,974.454 1272.23,876.835 1274.54,852.304 1276.85,1078.03 1279.16,900.844 1281.47,970.015 1283.77,1032.25 1286.08,886.372 1288.39,923.69 1290.7,921.731 1293,909.718 1295.31,875.305 1297.62,918.202 1299.93,917.667 1302.24,1117.05 1304.54,844.473 1306.85,961.513 1309.16,880.956 1311.47,885.257 1313.78,895.87 1316.08,1061.96 1318.39,843.82 1320.7,1004.24 1323.01,991.735 1325.32,1031.35 1327.62,1043 1329.93,883.177 1332.24,977.552 1334.55,842.051 1336.86,847.879 1339.16,930.731 1341.47,970.267 1343.78,914.603 1346.09,886.888 1348.39,769.66 1350.7,896.817 1353.01,796.341 1355.32,861.832 1357.63,848.215 1359.93,820.794 1362.24,1015.01 1364.55,936.028 1366.86,779.542 1369.17,1016.06 1371.47,746.315 1373.78,827.042 1376.09,952.306 1378.4,837.107 1380.71,818.401 1383.01,936.604 1385.32,885.39 1387.63,967.842 1389.94,935.195 1392.24,868.493 1394.55,965.415 1396.86,990.135 1399.17,865.775 1401.48,1002.71 1403.78,801.813 1406.09,940.355 1408.4,1053.47 1410.71,823.791 1413.02,913.992 1415.32,907.499 1417.63,839.069 1419.94,792.497 1422.25,828.347 1424.56,749.742 1426.86,828.739 1429.17,899.178 1431.48,936.774 1433.79,1025.21 1436.1,1026.84 1438.4,1043.43 1440.71,890.179 1443.02,872.683 1445.33,965.012 1447.63,1017.54 1449.94,791.628 1452.25,769.001 1454.56,880.536 1456.87,1021.47 1459.17,1040.38 1461.48,974.479 1463.79,898.48 1466.1,834.031 1468.41,965.237 1470.71,944.68 1473.02,777.432 1475.33,794.781 1477.64,885.51 1479.95,915.576 1482.25,921.462 1484.56,895.536 1486.87,829.977 1489.18,1063.16 1491.49,983.352 1493.79,940.617 1496.1,860.955 1498.41,982.808 1500.72,727.734 1503.02,879.852 1505.33,989.791 1507.64,860.944 1509.95,973.72 1512.26,891.109 1514.56,928.548 1516.87,982.358 1519.18,941.489 1521.49,893.432 1523.8,941.242 1526.1,945.056 1528.41,809.171 1530.72,909.65 1533.03,955.988 1535.34,734.258 1537.64,851.12 1539.95,901.061 1542.26,837.399 1544.57,854.652 1546.88,789.146 1549.18,954.553 1551.49,950.097 1553.8,1054.94 1556.11,844.889 1558.41,926.763 1560.72,930.1 1563.03,858.244 1565.34,876.47 1567.65,863.696 1569.95,958.167 1572.26,829.678 1574.57,964.024 1576.88,893.581 1579.19,932.046 1581.49,836.982 1583.8,914.209 1586.11,902.319 1588.42,995.75 1590.73,877.889 1593.03,866.674 1595.34,935.56 1597.65,888.958 1599.96,846.859 1602.26,711.748 1604.57,1082.45 1606.88,664.513 1609.19,793.335 1611.5,795.013 1613.8,788.565 1616.11,827.304 1618.42,944.578 1620.73,809.238 1623.04,1003.92 1625.34,776.064 1627.65,962.215 1629.96,947.162 1632.27,982.062 1634.58,960.986 1636.88,824.811 1639.19,843.325 1641.5,1054.97 1643.81,878.797 1646.12,886.834 1648.42,985.875 1650.73,684.178 1653.04,1022.77 1655.35,939.945 1657.65,813.888 1659.96,906.332 1662.27,737.507 1664.58,971.426 1666.89,862.878 1669.19,959.448 1671.5,948.44 1673.81,936.742 1676.12,1002.06 1678.43,805.05 1680.73,865.457 1683.04,942.109 1685.35,906.651 1687.66,1029.24 1689.97,961.568 1692.27,819.821 1694.58,717.279 1696.89,940.77 1699.2,947.779 1701.51,883.832 1703.81,937.089 1706.12,880.854 1708.43,853.979 1710.74,897.396 1713.04,951.495 1715.35,880.321 1717.66,984.032 1719.97,768.655 1722.28,1034.21 1724.58,1017.68 1726.89,937.268 1729.2,814.181 1731.51,870.63 1733.82,720.897 1736.12,921.617 1738.43,1078.63 1740.74,959.342 1743.05,879.702 1745.36,926.097 1747.66,998.257 1749.97,949.011 1752.28,885.059 1754.59,841.719 1756.9,906.599 1759.2,857.648 1761.51,884.354 1763.82,805.82 1766.13,870.581 1768.43,829.703 1770.74,871.932 1773.05,798.777 1775.36,878.497 1777.67,850.419 1779.97,934.602 1782.28,1025.16 1784.59,716.707 1786.9,847.08 1789.21,974.018 1791.51,1000.38 1793.82,1015.18 1796.13,771.535 1798.44,987.2 1800.75,822.737 1803.05,900.731 1805.36,1084.91 1807.67,999.884 1809.98,918.827 1812.28,1075.74 1814.59,888.038 1816.9,856.74 1819.21,1044.78 1821.52,788.404 1823.82,877.45 1826.13,921.543 1828.44,798.965 1830.75,877.195 1833.06,913.951 1835.36,1027.76 1837.67,793.481 1839.98,857.194 1842.29,940.179 1844.6,862.632 1846.9,1113.31 1849.21,892.193 1851.52,808.788 1853.83,713.855 1856.14,754.58 1858.44,805.137 1860.75,875.023 1863.06,826.514 1865.37,846.982 1867.67,801.966 1869.98,895.584 1872.29,804.362 1874.6,815.353 1876.91,973.997 1879.21,1030.83 1881.52,840.881 1883.83,738.059 1886.14,819.068 1888.45,820.045 1890.75,849.713 1893.06,1089.3 1895.37,954.773 1897.68,889.081 1899.99,760.867 1902.29,911.534 1904.6,822.397 1906.91,862.478 1909.22,921.642 1911.53,816.207 1913.83,869.619 1916.14,838.125 1918.45,862.444 1920.76,890.205 1923.06,979.941 1925.37,802.803 1927.68,835.199 1929.99,928.691 1932.3,765.09 1934.6,847.129 1936.91,804.383 1939.22,1018.66 1941.53,1038.75 1943.84,988.562 1946.14,944.506 1948.45,795.425 1950.76,959.607 1953.07,978.647 1955.38,819.262 1957.68,854.747 1959.99,704.817 1962.3,899.811 1964.61,1016.74 1966.91,905.854 1969.22,824.223 1971.53,1006.69 1973.84,844.009 1976.15,936.382 1978.45,1116.81 1980.76,837.492 1983.07,973.852 1985.38,897.715 1987.69,844.36 1989.99,934.955 1992.3,999.046 1994.61,902.049 1996.92,900.126 1999.23,806.751 2001.53,809.515 2003.84,868.206 2006.15,892.331 2008.46,823.272 2010.77,768.799 2013.07,808.507 2015.38,1003.65 2017.69,781.284 2020,906.83 2022.3,922.173 2024.61,947.757 2026.92,1072.79 2029.23,820.708 2031.54,901.861 2033.84,723.748 2036.15,850.819 2038.46,1091.98 2040.77,996.781 2043.08,931.703 2045.38,943.619 2047.69,1052.63 2050,949.573 2052.31,1151.98 2054.62,1029.29 2056.92,949.485 2059.23,939.681 2061.54,1005.45 2063.85,719.047 2066.16,782.532 2068.46,969.983 2070.77,858.421 2073.08,867.601 2075.39,823.934 2077.69,946.941 2080,1031.9 2082.31,951.637 2084.62,953.402 2086.93,778.708 2089.23,921.985 2091.54,1119.97 2093.85,783.488 2096.16,840.311 2098.47,684.485 2100.77,985.466 2103.08,781.597 2105.39,852.928 2107.7,982.693 2110.01,950.111 2112.31,852.516 2114.62,910.618 2116.93,745.466 2119.24,902.553 2121.55,785.666 2123.85,1021.98 2126.16,915.804 2128.47,883.279 2130.78,764.615 2133.08,812.632 2135.39,1038.68 2137.7,733.752 2140.01,978.911 2142.32,970.679 2144.62,886.177 2146.93,960.886 2149.24,978.771 2151.55,1037.86 2153.86,948.284 2156.16,963.707 2158.47,989.842 2160.78,907.772 2163.09,729.939 2165.4,984.15 2167.7,964.977 2170.01,892.278 2172.32,977.902 2174.63,836.62 2176.93,910.645 2179.24,797.929 2181.55,962.771 2183.86,915.887 2186.17,920.445 2188.47,723.017 2190.78,910.636 2193.09,895.547 2195.4,827.391 2197.71,896 2200.01,979.249 2202.32,887.532 2204.63,968.553 2206.94,856.308 2209.25,926.643 2211.55,796.502 2213.86,833.982 2216.17,940.428 2218.48,857.034 2220.79,797.26 2223.09,927.392 2225.4,749.728 2227.71,957.283 2230.02,794.122 2232.32,995.707 2234.63,983.938 2236.94,888.747 2239.25,879.499 2241.56,853.085 2243.86,1024.01 2246.17,912.109 2248.48,944.851 2250.79,976.762 2253.1,791.959 2255.4,1006.23 2257.71,676.611 2260.02,829.413 2262.33,754.472 2264.64,1042.47 2266.94,950.242 2269.25,853.687 2271.56,894.773 2273.87,1104.25 2276.18,909.492 2278.48,832.459 2280.79,1021.74 2283.1,1022.97 2285.41,893.894 2287.71,889.647 2290.02,1031.29 2292.33,965.605 2294.64,926.214 2296.95,914.975 2299.25,780.51 2301.56,965.511 2303.87,803.517 2306.18,850.5 2308.49,884.221 2310.79,894.284 2313.1,891.888 2315.41,890.64 2317.72,827.504 2320.03,1060.64 2322.33,808.385 2324.64,858.092 2326.95,836.87 2329.26,911.905 2331.56,846.363 2333.87,856.9 2336.18,888.841 2338.49,1005.41 2340.8,907.937 2343.1,789.686 2345.41,892.421 2347.72,983.728 2350.03,913.612 2352.34,827.888 2354.64,843.489 2356.95,787.532 2359.26,985.053 2361.57,963.294 2363.88,846.723 2366.18,923.527 2368.49,908.757 2370.8,1063.93 2373.11,843.583 2375.42,855.104 2377.72,811.997 2380.03,861.634 2382.34,838.136 2384.65,791.102 2386.95,911.859 2389.26,774.112 2391.57,906.347 2393.88,980.711 2396.19,881.804 2398.49,972.164 2400.8,650.16 2403.11,876.659 2405.42,929.842 2407.73,1112.9 2410.03,869.489 2412.34,905.792 2414.65,846.02 2416.96,1033.71 2419.27,811.664 2421.57,1045.5 2423.88,849.887 2426.19,840.445 2428.5,885.005 2430.81,937.564 2433.11,835.016 2435.42,822.576 2437.73,932.858 2440.04,893.101 2442.34,774.035 2444.65,874 2446.96,974.857 2449.27,926.718 2451.58,978.52 2453.88,850.994 2456.19,916.992 2458.5,983.979 2460.81,1010.67 2463.12,992.716 2465.42,1081.79 2467.73,875.744 2470.04,910.406 2472.35,889.968 2474.66,930.787 2476.96,1010.11 2479.27,875.63 2481.58,931.398 2483.89,969.534 2486.2,800.037 2488.5,938.821 2490.81,829.909 2493.12,897.289 2495.43,780.468 2497.73,753.708 2500.04,743.226 2502.35,955.772 2504.66,798.674 2506.97,947.641 2509.27,1043.16 2511.58,933.075 2513.89,965.484 2516.2,962.084 2518.51,869.005 2520.81,751.539 2523.12,916.161 2525.43,859.121 2527.74,695.87 2530.05,740.893 2532.35,908.566 2534.66,997.857 2536.97,909.403 2539.28,1079.72 2541.58,839.02 2543.89,763.587 2546.2,1066.69 2548.51,885.015 2550.82,1095.5 2553.12,878.67 2555.43,886.022 2557.74,728.776 2560.05,701.087 2562.36,860.64 2564.66,827.288 2566.97,779.951 2569.28,1095.82 2571.59,943.895 "></polyline>
<polyline clip-path="url(#clip672)" style="stroke:#3da44d; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="265.984,793.821 268.292,500.33 270.6,635.014 272.908,483.087 275.216,405.417 277.524,361.511 279.832,340.495 282.139,347.734 284.447,331.895 286.755,395.433 289.063,406.347 291.371,429.229 293.679,579.671 295.987,306.871 298.295,467.374 300.603,482.395 302.911,454.312 305.219,495.486 307.527,373.753 309.834,481.641 312.142,183.267 314.45,595.262 316.758,465.367 319.066,441.93 321.374,569.316 323.682,309.077 325.99,457.189 328.298,577.164 330.606,351.645 332.914,460.25 335.221,642.563 337.529,584.178 339.837,508.667 342.145,500.459 344.453,376.798 346.761,478.094 349.069,475.259 351.377,507.285 353.685,451.755 355.993,431.517 358.301,592.09 360.608,323.331 362.916,330.107 365.224,360.122 367.532,575.346 369.84,335.594 372.148,600.214 374.456,293.662 376.764,478.662 379.072,510.504 381.38,536.284 383.688,570.796 385.996,325.672 388.303,273.491 390.611,559.764 392.919,325.39 395.227,445.267 397.535,304.568 399.843,253.621 402.151,619.528 404.459,441.342 406.767,495.583 409.075,592.608 411.383,408.475 413.69,385.86 415.998,394.576 418.306,467.447 420.614,311.282 422.922,477.127 425.23,368.634 427.538,299.801 429.846,428.023 432.154,418.457 434.462,417.753 436.77,358.485 439.077,538.513 441.385,402.29 443.693,358.336 446.001,403.638 448.309,366.196 450.617,396.277 452.925,320.823 455.233,425.896 457.541,429.786 459.849,567.097 462.157,381.682 464.465,365.937 466.772,495.467 469.08,296.886 471.388,420.353 473.696,543.263 476.004,463.967 478.312,462.158 480.62,409.607 482.928,424.428 485.236,401.726 487.544,460.135 489.852,466.712 492.159,423.108 494.467,431.935 496.775,537.613 499.083,460.688 501.391,467.108 503.699,395.174 506.007,485.296 508.315,420.333 510.623,504.024 512.931,345.072 515.239,553.499 517.546,403.182 519.854,494.833 522.162,438.003 524.47,453.425 526.778,432.119 529.086,366.838 531.394,373.964 533.702,504.037 536.01,418.87 538.318,484.789 540.626,545.894 542.933,373.181 545.241,401.6 547.549,481.007 549.857,615.104 552.165,760.041 554.473,376.805 556.781,619.097 559.089,519.367 561.397,435.925 563.705,431.35 566.013,428.163 568.321,479.902 570.628,528.774 572.936,329.356 575.244,567.746 577.552,568.464 579.86,309.894 582.168,431.586 584.476,483.482 586.784,390.107 589.092,396.052 591.4,389.188 593.708,590.644 596.015,486.751 598.323,589.157 600.631,378.651 602.939,570.148 605.247,497.176 607.555,368.432 609.863,454.108 612.171,455.707 614.479,558.716 616.787,376.845 619.095,448.056 621.402,566.088 623.71,405.183 626.018,444.427 628.326,406.735 630.634,361.008 632.942,432.938 635.25,453.721 637.558,578.687 639.866,476.446 642.174,401.316 644.482,329.592 646.79,314.509 649.097,480.691 651.405,502.736 653.713,379.927 656.021,437.365 658.329,511.687 660.637,365.153 662.945,384.399 665.253,418.639 667.561,529.923 669.869,456.585 672.177,520.092 674.484,518.015 676.792,524.674 679.1,501.673 681.408,522.008 683.716,374.578 686.024,401.468 688.332,430.321 690.64,396.625 692.948,423.579 695.256,537.675 697.564,424.459 699.871,434.935 702.179,453.225 704.487,426.357 706.795,342.274 709.103,397.719 711.411,347.25 713.719,470.681 716.027,490.701 718.335,495.055 720.643,521.914 722.951,474.176 725.259,510.397 727.566,399.324 729.874,362.402 732.182,535.678 734.49,444.014 736.798,623.918 739.106,331.845 741.414,448.975 743.722,559.794 746.03,396.732 748.338,374.889 750.646,540.563 752.953,466.782 755.261,538.001 757.569,617.8 759.877,439.718 762.185,401.831 764.493,295.034 766.801,340.21 769.109,354.79 771.417,443.689 773.725,376.075 776.033,487.425 778.34,426.361 780.648,387.242 782.956,346.134 785.264,495.74 787.572,569.564 789.88,509.017 792.188,389.736 794.496,572.359 796.804,410.987 799.112,308.967 801.42,436.597 803.728,440.223 806.035,446.394 808.343,385.482 810.651,379.991 812.959,351.549 815.267,487.912 817.575,425.235 819.883,407.054 822.191,532.897 824.499,591.28 826.807,349.863 829.115,465.012 831.422,388.155 833.73,412.143 836.038,565.985 838.346,463.344 840.654,548.14 842.962,511.137 845.27,476.08 847.578,306.583 849.886,447.992 852.194,439.154 854.502,466.453 856.809,452.395 859.117,434.854 861.425,504.001 863.733,419.402 866.041,489.865 868.349,461.838 870.657,483.18 872.965,309.459 875.273,470.925 877.581,310.251 879.889,406.409 882.197,463.482 884.504,447.638 886.812,466.308 889.12,357.067 891.428,364.32 893.736,452.365 896.044,383.304 898.352,401.129 900.66,422.866 902.968,439.889 905.276,538.846 907.584,374.335 909.891,392.902 912.199,590.385 914.507,496.607 916.815,413.908 919.123,586.619 921.431,518.422 923.739,547.562 926.047,522.575 928.355,359.656 930.663,461.345 932.971,361.012 935.278,410.517 937.586,464.21 939.894,510.999 942.202,416.213 944.51,502.118 946.818,434.59 949.126,389.725 951.434,514.585 953.742,529.951 956.05,366.291 958.358,626.177 960.665,486.508 962.973,440.366 965.281,302.764 967.589,488.423 969.897,493.781 972.205,462.868 974.513,358.427 976.821,516.429 979.129,441.897 981.437,611.788 983.745,308.897 986.053,456.349 988.36,399.879 990.668,501.445 992.976,317.875 995.284,406.918 997.592,465.541 999.9,494.303 1002.21,425.916 1004.52,536.806 1006.82,315.12 1009.13,415.79 1011.44,436.626 1013.75,518.975 1016.06,491.47 1018.36,567.706 1020.67,590.353 1022.98,494.412 1025.29,533.869 1027.59,353.22 1029.9,383.434 1032.21,578.591 1034.52,516.221 1036.83,593.59 1039.13,313.659 1041.44,433.555 1043.75,246.853 1046.06,433.47 1048.37,494.62 1050.67,309.915 1052.98,444.615 1055.29,398.547 1057.6,431.331 1059.91,346.192 1062.21,488.924 1064.52,464.111 1066.83,533.2 1069.14,540.954 1071.45,394.604 1073.75,502.168 1076.06,555.086 1078.37,412.774 1080.68,424.157 1082.98,377.322 1085.29,470.617 1087.6,341.648 1089.91,514.7 1092.22,388.523 1094.52,355.827 1096.83,518.428 1099.14,545.113 1101.45,539.129 1103.76,358.947 1106.06,324.579 1108.37,551.58 1110.68,410.836 1112.99,542.347 1115.3,638.932 1117.6,406.521 1119.91,293.404 1122.22,351.028 1124.53,361.389 1126.84,459.376 1129.14,490.033 1131.45,470.153 1133.76,300.536 1136.07,400.551 1138.37,439.41 1140.68,327.057 1142.99,459.932 1145.3,410.388 1147.61,445.878 1149.91,391.919 1152.22,592.64 1154.53,471.229 1156.84,381.571 1159.15,412.134 1161.45,400.497 1163.76,369.306 1166.07,424.697 1168.38,422.777 1170.69,456.288 1172.99,363.709 1175.3,464.489 1177.61,472.43 1179.92,337.578 1182.23,625.892 1184.53,468.351 1186.84,457.23 1189.15,337.121 1191.46,495.414 1193.76,410.873 1196.07,626.096 1198.38,692.646 1200.69,270.47 1203,512.833 1205.3,473.431 1207.61,370.631 1209.92,487.646 1212.23,460.852 1214.54,461.278 1216.84,400.131 1219.15,400.868 1221.46,535.966 1223.77,473.65 1226.08,426.596 1228.38,261.188 1230.69,502.844 1233,365.413 1235.31,332.439 1237.61,506.824 1239.92,542.815 1242.23,416.876 1244.54,351.572 1246.85,507.786 1249.15,439.568 1251.46,455.691 1253.77,307.763 1256.08,311.63 1258.39,426.555 1260.69,510.812 1263,354.184 1265.31,409.195 1267.62,414.495 1269.93,355.548 1272.23,530.592 1274.54,349.71 1276.85,352.229 1279.16,582.958 1281.47,268.465 1283.77,500.073 1286.08,392.919 1288.39,465.55 1290.7,370.813 1293,541.74 1295.31,440.319 1297.62,161.504 1299.93,265.329 1302.24,477.202 1304.54,411.114 1306.85,351.1 1309.16,509.903 1311.47,516.298 1313.78,427.163 1316.08,430.523 1318.39,428.695 1320.7,352.64 1323.01,524.045 1325.32,538.662 1327.62,238.752 1329.93,303.482 1332.24,445.835 1334.55,354.643 1336.86,359.173 1339.16,401.598 1341.47,407.048 1343.78,571.519 1346.09,522.455 1348.39,269.011 1350.7,445.955 1353.01,564.386 1355.32,451.855 1357.63,470.651 1359.93,548.116 1362.24,431.821 1364.55,377.713 1366.86,546.793 1369.17,536.62 1371.47,472.111 1373.78,471.977 1376.09,444.699 1378.4,545.737 1380.71,459.285 1383.01,467.29 1385.32,541.773 1387.63,361.173 1389.94,338.387 1392.24,340.702 1394.55,338.795 1396.86,410.846 1399.17,434.502 1401.48,527.009 1403.78,571.18 1406.09,574.929 1408.4,355.597 1410.71,458.719 1413.02,565.841 1415.32,265.454 1417.63,500.069 1419.94,366.751 1422.25,433.836 1424.56,375.486 1426.86,358.59 1429.17,369.743 1431.48,505.824 1433.79,352.543 1436.1,445.642 1438.4,417.906 1440.71,537.65 1443.02,524.867 1445.33,498.721 1447.63,418.235 1449.94,467.31 1452.25,471.875 1454.56,569.042 1456.87,469.295 1459.17,442.786 1461.48,451.752 1463.79,467.437 1466.1,254.066 1468.41,463.341 1470.71,413.381 1473.02,492.831 1475.33,457.44 1477.64,519.529 1479.95,322.056 1482.25,491.224 1484.56,426.359 1486.87,456.812 1489.18,650.775 1491.49,374.234 1493.79,373.476 1496.1,606.375 1498.41,553.449 1500.72,469.85 1503.02,603.297 1505.33,271.61 1507.64,669.434 1509.95,477.425 1512.26,467.96 1514.56,478.476 1516.87,638.665 1519.18,435.325 1521.49,403.865 1523.8,309.033 1526.1,468.942 1528.41,436.373 1530.72,516.877 1533.03,524.702 1535.34,523.403 1537.64,320.949 1539.95,534.887 1542.26,498.456 1544.57,288.127 1546.88,472.81 1549.18,387.996 1551.49,387.645 1553.8,563.434 1556.11,423.915 1558.41,555.654 1560.72,327.542 1563.03,359.302 1565.34,503.886 1567.65,622.069 1569.95,306.279 1572.26,666.403 1574.57,710.163 1576.88,556.042 1579.19,389.428 1581.49,509.565 1583.8,610.663 1586.11,600.315 1588.42,442.757 1590.73,353.615 1593.03,390.771 1595.34,507.718 1597.65,404.97 1599.96,380.338 1602.26,436.272 1604.57,427.966 1606.88,316.576 1609.19,450.962 1611.5,447.847 1613.8,470.801 1616.11,337.945 1618.42,387.583 1620.73,476.937 1623.04,404.166 1625.34,474.924 1627.65,470.124 1629.96,498.776 1632.27,405.051 1634.58,321.878 1636.88,395.954 1639.19,539.741 1641.5,412.537 1643.81,605.85 1646.12,494.482 1648.42,689.249 1650.73,319.975 1653.04,514.577 1655.35,444.595 1657.65,375.85 1659.96,522.185 1662.27,408.182 1664.58,436.522 1666.89,503.724 1669.19,534.056 1671.5,378.621 1673.81,295.325 1676.12,494.844 1678.43,390.254 1680.73,536.414 1683.04,477.772 1685.35,583.789 1687.66,522.637 1689.97,606.328 1692.27,453.179 1694.58,423.853 1696.89,328.966 1699.2,332.323 1701.51,429.202 1703.81,356.52 1706.12,660.54 1708.43,280.366 1710.74,448.697 1713.04,393.72 1715.35,356.981 1717.66,481.363 1719.97,449.988 1722.28,503.896 1724.58,402.875 1726.89,329.314 1729.2,557.715 1731.51,375.817 1733.82,323.428 1736.12,574.59 1738.43,358.346 1740.74,516.58 1743.05,430.997 1745.36,566.125 1747.66,375.464 1749.97,513.203 1752.28,562.133 1754.59,374.794 1756.9,373.786 1759.2,371.447 1761.51,410.992 1763.82,401.735 1766.13,460.413 1768.43,441.63 1770.74,462.295 1773.05,395.502 1775.36,356.57 1777.67,502.435 1779.97,403.582 1782.28,473.678 1784.59,529.233 1786.9,478.917 1789.21,380.747 1791.51,351.745 1793.82,121.815 1796.13,421.645 1798.44,290.623 1800.75,400.35 1803.05,468.454 1805.36,569.718 1807.67,362.121 1809.98,464.049 1812.28,443.351 1814.59,342.661 1816.9,554.736 1819.21,474.182 1821.52,419.289 1823.82,248.781 1826.13,410.24 1828.44,468.134 1830.75,391.541 1833.06,450.288 1835.36,438.75 1837.67,348.098 1839.98,410.732 1842.29,553.629 1844.6,500.424 1846.9,397.938 1849.21,519.911 1851.52,610.835 1853.83,513.751 1856.14,168.929 1858.44,458.949 1860.75,351.812 1863.06,422.618 1865.37,258.228 1867.67,388.225 1869.98,348.536 1872.29,257.338 1874.6,338.075 1876.91,552.847 1879.21,561.518 1881.52,484.499 1883.83,408.377 1886.14,406.884 1888.45,236.266 1890.75,346.956 1893.06,577.042 1895.37,498.41 1897.68,546.414 1899.99,440.045 1902.29,351.505 1904.6,618.686 1906.91,547.347 1909.22,393.623 1911.53,321.779 1913.83,374.776 1916.14,556.952 1918.45,654.623 1920.76,339.797 1923.06,519.287 1925.37,486.619 1927.68,191.857 1929.99,281.245 1932.3,601.022 1934.6,404.102 1936.91,477.154 1939.22,333.123 1941.53,566.03 1943.84,316.307 1946.14,692.17 1948.45,516.48 1950.76,602.748 1953.07,400.383 1955.38,464.602 1957.68,501.538 1959.99,438.606 1962.3,365.259 1964.61,305.61 1966.91,478.615 1969.22,349.122 1971.53,476.26 1973.84,388.844 1976.15,312.001 1978.45,475.939 1980.76,482.981 1983.07,312.665 1985.38,648.532 1987.69,491.893 1989.99,456.821 1992.3,383.597 1994.61,454.905 1996.92,361.039 1999.23,418.282 2001.53,491.437 2003.84,531.52 2006.15,443.236 2008.46,536.665 2010.77,556.057 2013.07,269.799 2015.38,480.528 2017.69,344.807 2020,374.399 2022.3,431.449 2024.61,225.198 2026.92,423.276 2029.23,281.617 2031.54,366.752 2033.84,552.508 2036.15,427.183 2038.46,455.034 2040.77,353.211 2043.08,259.735 2045.38,321.764 2047.69,369.437 2050,434.173 2052.31,312.243 2054.62,568.49 2056.92,575.092 2059.23,475.076 2061.54,269.97 2063.85,464.248 2066.16,382.042 2068.46,524.813 2070.77,231.041 2073.08,343.272 2075.39,606.59 2077.69,464.34 2080,225.641 2082.31,419.808 2084.62,518.505 2086.93,587.045 2089.23,402.67 2091.54,469.404 2093.85,473.625 2096.16,550.035 2098.47,508.931 2100.77,440.388 2103.08,296.803 2105.39,428.81 2107.7,491.334 2110.01,396.113 2112.31,446.753 2114.62,348.758 2116.93,406.525 2119.24,583.841 2121.55,483.37 2123.85,390.945 2126.16,396.943 2128.47,335.763 2130.78,565.197 2133.08,575.673 2135.39,455.586 2137.7,478.207 2140.01,334.596 2142.32,422.894 2144.62,363.487 2146.93,525.684 2149.24,521.918 2151.55,639.248 2153.86,415.176 2156.16,452.446 2158.47,458.35 2160.78,378.38 2163.09,481.344 2165.4,448.649 2167.7,368.046 2170.01,381.699 2172.32,402.262 2174.63,499.35 2176.93,620.219 2179.24,460.821 2181.55,427.64 2183.86,475.521 2186.17,407.873 2188.47,403.529 2190.78,243.319 2193.09,499.998 2195.4,382.385 2197.71,346.707 2200.01,524.58 2202.32,528.444 2204.63,671.729 2206.94,427.602 2209.25,379.779 2211.55,564.98 2213.86,437.542 2216.17,447.274 2218.48,438.35 2220.79,364.378 2223.09,396.187 2225.4,502.683 2227.71,267.668 2230.02,327.025 2232.32,403.571 2234.63,292.772 2236.94,419.457 2239.25,284.412 2241.56,659.133 2243.86,631.296 2246.17,379.382 2248.48,416.619 2250.79,392.702 2253.1,519.352 2255.4,396.125 2257.71,429.349 2260.02,520.166 2262.33,390.173 2264.64,624.443 2266.94,500.954 2269.25,414.51 2271.56,448.701 2273.87,471.317 2276.18,518.626 2278.48,454.342 2280.79,384.468 2283.1,410.939 2285.41,500.318 2287.71,591.032 2290.02,534.771 2292.33,469.996 2294.64,525.677 2296.95,505.642 2299.25,442.838 2301.56,531.53 2303.87,398.591 2306.18,210.749 2308.49,356.403 2310.79,609.783 2313.1,421.631 2315.41,412.597 2317.72,257.198 2320.03,363.484 2322.33,392.678 2324.64,512.069 2326.95,391.612 2329.26,671.867 2331.56,419.411 2333.87,351.425 2336.18,331.272 2338.49,469.498 2340.8,556.481 2343.1,528.785 2345.41,405.424 2347.72,494.231 2350.03,382.457 2352.34,475.591 2354.64,443.294 2356.95,353.012 2359.26,426.383 2361.57,392.185 2363.88,359.926 2366.18,328.329 2368.49,495.658 2370.8,455.478 2373.11,533.676 2375.42,471.972 2377.72,485.192 2380.03,578.735 2382.34,409.547 2384.65,462.419 2386.95,315.803 2389.26,241.865 2391.57,588.169 2393.88,465.576 2396.19,480.381 2398.49,412.402 2400.8,96.8724 2403.11,502.49 2405.42,368.885 2407.73,568.579 2410.03,470.869 2412.34,383.676 2414.65,413.264 2416.96,407.151 2419.27,408.154 2421.57,292.253 2423.88,478.132 2426.19,470.435 2428.5,389.75 2430.81,419.939 2433.11,309.382 2435.42,506.089 2437.73,464.226 2440.04,327.71 2442.34,276.921 2444.65,515.872 2446.96,528.544 2449.27,551.342 2451.58,458.981 2453.88,535.308 2456.19,538.995 2458.5,310.092 2460.81,444.159 2463.12,557.864 2465.42,433.95 2467.73,671.875 2470.04,353.545 2472.35,416.106 2474.66,386.466 2476.96,443.11 2479.27,390.455 2481.58,352.974 2483.89,383.584 2486.2,423.592 2488.5,321.396 2490.81,446.622 2493.12,534.639 2495.43,488.153 2497.73,524.418 2500.04,360.358 2502.35,537.928 2504.66,484.487 2506.97,381.775 2509.27,447.23 2511.58,529.243 2513.89,280.744 2516.2,459.059 2518.51,361.176 2520.81,442.838 2523.12,404.017 2525.43,352.873 2527.74,458.73 2530.05,426.478 2532.35,284.454 2534.66,500.481 2536.97,327.399 2539.28,477.402 2541.58,397.04 2543.89,429.665 2546.2,577.696 2548.51,627.157 2550.82,378.635 2553.12,387.098 2555.43,557.324 2557.74,611.821 2560.05,496.189 2562.36,363.184 2564.66,588.584 2566.97,338.203 2569.28,428.168 2571.59,222.433 "></polyline>
</svg>
</div>
</div>
<p>Look at that! Things are working; amazin’.</p>
<p>We can also exploit <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>’s parallel sampling capabilities:</p>
<div id="34" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run separate 4 chains for 10 000 iterations using threads to parallelize.</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>num_chains <span class="op">=</span> <span class="fl">4</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    model_with_grad,</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">MCMCThreads</span>(),</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>,</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    num_chains;</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Note we need to provide an initial state for every chain.</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>    initial_state<span class="op">=</span><span class="fu">fill</span>(state, num_chains),</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>samples_array <span class="op">=</span> <span class="fu">stack</span>(<span class="fu">map</span>(<span class="bu">Base</span>.<span class="fu">Fix1</span>(stack, sample <span class="op">-&gt;</span> sample.x), samples))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000×4 Array{Float64, 3}:
[:, :, 1] =
 -2.04288  -3.61526   -2.43321  -5.23706   …  -5.23387   -4.38512   -4.38512
 -1.03361  -0.315018  -1.10967   0.804839      0.876145   0.404424   0.404424
  2.41217   3.79695    5.52614   6.2375        6.04846    6.47847    6.47847

[:, :, 2] =
 -1.29543   -4.04296  -4.1274     …  -5.23169  -5.30849    -5.37487
 -0.966736  -0.91746   0.0557627      0.15341   0.0931381  -0.308716
  2.5878     2.62515   3.18817        4.0911    4.64233     4.55562

[:, :, 3] =
 -1.53873   -2.26028  -1.52848  -3.53229  …  -8.27466   -6.07927   -4.49892
 -0.707746  -1.14845   1.27827   1.01637      0.188548   0.713698   2.01531
  1.80831    4.28042   4.24333   5.88892      4.56757    4.35797    4.42012

[:, :, 4] =
 -3.50186    -6.50005   -4.9285   -4.02128   …  -4.77515   -4.11405  -5.48964
 -0.0770284  -0.237681   1.05983  -0.126066      0.709195   2.14389  -1.14576
  1.23501     3.46458    4.46806   3.95151       5.3945     4.55826   4.92574</code></pre>
</div>
</div>
<p>But the fact that we have to provide the <code>AbstractMCMC.sample</code> call, etc. with an <code>initial_state</code> to get started is a bit annoying. We can avoid this by also defining a <code>AbstractMCMC.step</code> <em>without</em> the <code>state</code> argument:</p>
<div id="36" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">::</span><span class="dt">MALA</span>;</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># </span><span class="al">NOTE</span><span class="co">: No state provided!</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just create the initial state by sampling using  a Gaussian.</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="fu">randn</span>(rng, LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(x), <span class="fu">MALAState</span>(x)</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Equipped with this, we no longer need to provide the <code>initial_state</code> everywhere:</p>
<div id="38" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -4.99968    1.00698
  0.0102134  0.99267
  4.97451    1.00274</code></pre>
</div>
</div>
</section>
<section id="using-our-sampler-with-turing.jl" class="level2">
<h2 class="anchored" data-anchor-id="using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</h2>
<p>As we promised, all of this hassle of implementing our <code>MALA</code> sampler in a way that uses <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> and <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> gets us something more than <em>just</em> an “automatic” implementation of <code>AbstractMCMC.sample</code>.</p>
<p>It also enables use with Turing.jl through the <code>externalsampler</code>, but we need to do one final thing first: we need to tell Turing.jl how to extract a vector of parameters from the “sample” returned in our implementation of <code>AbstractMCMC.step</code>. In our case, the “sample” is a <code>MALASample</code>, so we just need the following line:</p>
<div id="40" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load Turing.jl.</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Turing</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Overload the `getparams` method for our "sample" type, which is just a vector.</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>Turing.Inference.<span class="fu">getparams</span>(<span class="op">::</span><span class="dt">Turing.Model</span>, sample<span class="op">::</span><span class="dt">MALASample</span>) <span class="op">=</span> sample.x</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And with that, we’re good to go!</p>
<div id="42" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Our previous model defined as a Turing.jl model.</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">mvnormal_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">MvNormal</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.], I)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate our model.</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">mvnormal_model</span>()</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Call `sample` but now we're passing in a Turing.jl `model` and wrapping</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co"># our `MALA` sampler in the `externalsampler` to tell Turing.jl that the sampler</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co"># expects something that implements LogDensityProblems.jl.</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×4×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 3.3 seconds
Compute duration  = 3.3 seconds
parameters        = x[1], x[2], x[3]
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters  </span><span class="ansi-bold">    mean  </span><span class="ansi-bold">     std  </span><span class="ansi-bold">    mcse  </span><span class="ansi-bold">  ess_bulk  </span><span class="ansi-bold">  ess_tail  </span><span class="ansi-bold">    rhat  </span><span class="ansi-bold"> ⋯
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">   Float64  </span><span class="ansi-bright-black-fg ansi-bold">   Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> ⋯

        x[1]   -5.0074    1.0020    0.0178   3160.4987   5695.9007    1.0002   ⋯
        x[2]   -0.0226    0.9981    0.0176   3221.3388   5609.2446    1.0003   ⋯
        x[3]    5.0447    0.9978    0.0174   3305.1903   5205.8393    1.0000   ⋯
</span><span class="ansi-cyan-fg ansi-bold">                                                                1 column omitted

Quantiles
 </span><span class="ansi-cyan-fg ansi-bold"> parameters  </span><span class="ansi-cyan-fg ansi-bold">    2.5%  </span><span class="ansi-cyan-fg ansi-bold">   25.0%  </span><span class="ansi-cyan-fg ansi-bold">   50.0%  </span><span class="ansi-cyan-fg ansi-bold">   75.0%  </span><span class="ansi-cyan-fg ansi-bold">   97.5%
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64

        x[1]   -6.9663   -5.6909   -5.0008   -4.3238   -3.0369
        x[2]   -1.9643   -0.7061   -0.0298    0.6398    1.9310
        x[3]    3.1023    4.3743    5.0433    5.7300    7.0195
</span></pre>
</div>
</div>
</div>
<p>Pretty neat, eh?</p>
<section id="models-with-constrained-parameters" class="level3">
<h3 class="anchored" data-anchor-id="models-with-constrained-parameters">Models with constrained parameters</h3>
<p>One thing we’ve sort of glossed over in all of the above is that MALA, at least how we’ve implemented it, requires <span class="math inline">\(x\)</span> to live in <span class="math inline">\(\mathbb{R}^d\)</span> for some <span class="math inline">\(d &gt; 0\)</span>. If some of the parameters were in fact constrained, e.g.&nbsp;we were working with a <code>Beta</code> distribution which has support on the interval <span class="math inline">\((0, 1)\)</span>, <em>not</em> on <span class="math inline">\(\mathbb{R}^d\)</span>, we could easily end up outside of the valid range <span class="math inline">\((0, 1)\)</span>.</p>
<div id="44" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">beta_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">beta_model</span>()</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 2.0 seconds
Compute duration  = 2.0 seconds
parameters        = x
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters  </span><span class="ansi-bold">    mean  </span><span class="ansi-bold">     std  </span><span class="ansi-bold">    mcse  </span><span class="ansi-bold">  ess_bulk  </span><span class="ansi-bold">  ess_tail  </span><span class="ansi-bold">    rhat  </span><span class="ansi-bold"> ⋯
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">   Float64  </span><span class="ansi-bright-black-fg ansi-bold">   Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> ⋯

           x    0.4963    0.1881    0.0029   4126.8497   5441.8278    1.0002   ⋯
</span><span class="ansi-cyan-fg ansi-bold">                                                                1 column omitted

Quantiles
 </span><span class="ansi-cyan-fg ansi-bold"> parameters  </span><span class="ansi-cyan-fg ansi-bold">    2.5%  </span><span class="ansi-cyan-fg ansi-bold">   25.0%  </span><span class="ansi-cyan-fg ansi-bold">   50.0%  </span><span class="ansi-cyan-fg ansi-bold">   75.0%  </span><span class="ansi-cyan-fg ansi-bold">   97.5%
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64

           x    0.1441    0.3593    0.4935    0.6348    0.8485
</span></pre>
</div>
</div>
</div>
<p>Yep, that still works, but only because Turing.jl actually <em>transforms</em> the <code>turing_model</code> from constrained to unconstrained, so that the <code>sampler</code> provided to <code>externalsampler</code> is actually always working in unconstrained space! This is not always desirable, so we can turn this off:</p>
<div id="46" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 0.18 seconds
Compute duration  = 0.18 seconds
parameters        = x
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters  </span><span class="ansi-bold">    mean  </span><span class="ansi-bold">     std  </span><span class="ansi-bold">    mcse  </span><span class="ansi-bold"> ess_bulk  </span><span class="ansi-bold"> ess_tail  </span><span class="ansi-bold">    rhat  </span><span class="ansi-bold"> e ⋯
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">  Float64  </span><span class="ansi-bright-black-fg ansi-bold">  Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">   ⋯

           x    0.0343    0.0000    0.0000        NaN        NaN       NaN     ⋯
</span><span class="ansi-cyan-fg ansi-bold">                                                                1 column omitted

Quantiles
 </span><span class="ansi-cyan-fg ansi-bold"> parameters  </span><span class="ansi-cyan-fg ansi-bold">    2.5%  </span><span class="ansi-cyan-fg ansi-bold">   25.0%  </span><span class="ansi-cyan-fg ansi-bold">   50.0%  </span><span class="ansi-cyan-fg ansi-bold">   75.0%  </span><span class="ansi-cyan-fg ansi-bold">   97.5%
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64

           x    0.0343    0.0343    0.0343    0.0343    0.0343
</span></pre>
</div>
</div>
</div>
<p>The fun thing is that this still sort of works because</p>
<div id="48" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">logpdf</span>(<span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>), <span class="fl">10.0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-Inf</code></pre>
</div>
</div>
<p>and so the samples that fall outside of the range are always rejected. But do notice how much worse all the diagnostics are, e.g.&nbsp;<code>ess_tail</code> is very poor compared to when we use <code>unconstrained=true</code>. Moreover, in more complex cases this won’t just result in a “nice” <code>-Inf</code> log-density value, but instead will error:</p>
<div id="50" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="kw">function</span> <span class="fu">demo</span>()</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>    σ² <span class="op">~</span> <span class="fu">truncated</span>(<span class="fu">Normal</span>(), lower<span class="op">=</span><span class="fl">0</span>)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If we end up with negative values for `σ²`, the `Normal` will error.</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>    x <span class="op">~</span> <span class="fu">Normal</span>(<span class="fl">0</span>, σ²)</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 2.77 seconds
Compute duration  = 2.77 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters  </span><span class="ansi-bold">    mean  </span><span class="ansi-bold">     std  </span><span class="ansi-bold">    mcse  </span><span class="ansi-bold"> ess_bulk  </span><span class="ansi-bold"> ess_tail  </span><span class="ansi-bold">    rhat  </span><span class="ansi-bold"> e ⋯
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">  Float64  </span><span class="ansi-bright-black-fg ansi-bold">  Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">   ⋯

          σ²    0.0060    0.0000    0.0000        NaN        NaN       NaN     ⋯
           x    0.3490    0.0000    0.0000        NaN        NaN       NaN     ⋯
</span><span class="ansi-cyan-fg ansi-bold">                                                                1 column omitted

Quantiles
 </span><span class="ansi-cyan-fg ansi-bold"> parameters  </span><span class="ansi-cyan-fg ansi-bold">    2.5%  </span><span class="ansi-cyan-fg ansi-bold">   25.0%  </span><span class="ansi-cyan-fg ansi-bold">   50.0%  </span><span class="ansi-cyan-fg ansi-bold">   75.0%  </span><span class="ansi-cyan-fg ansi-bold">   97.5%
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64

          σ²    0.0060    0.0060    0.0060    0.0060    0.0060
           x    0.3490    0.3490    0.3490    0.3490    0.3490
</span></pre>
</div>
</div>
</div>
<p>As expected, we run into a <code>DomainError</code> at some point, while if we set <code>unconstrained=true</code>, letting Turing.jl transform the model to a unconstrained form behind the scenes, everything works as expected:</p>
<div id="52" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 0.59 seconds
Compute duration  = 0.59 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters  </span><span class="ansi-bold">    mean  </span><span class="ansi-bold">     std  </span><span class="ansi-bold">    mcse  </span><span class="ansi-bold"> ess_bulk  </span><span class="ansi-bold"> ess_tail  </span><span class="ansi-bold">    rhat  </span><span class="ansi-bold"> e ⋯
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">  Float64  </span><span class="ansi-bright-black-fg ansi-bold">  Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">   ⋯

          σ²    0.4152    0.5160    0.0929    23.4162    20.6033    1.7870     ⋯
           x   -0.0649    0.6847    0.0453   267.3704   120.6016    1.7884     ⋯
</span><span class="ansi-cyan-fg ansi-bold">                                                                1 column omitted

Quantiles
 </span><span class="ansi-cyan-fg ansi-bold"> parameters  </span><span class="ansi-cyan-fg ansi-bold">    2.5%  </span><span class="ansi-cyan-fg ansi-bold">   25.0%  </span><span class="ansi-cyan-fg ansi-bold">   50.0%  </span><span class="ansi-cyan-fg ansi-bold">   75.0%  </span><span class="ansi-cyan-fg ansi-bold">   97.5%
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64

          σ²    0.1073    0.1073    0.1073    0.5856    1.9905
           x   -1.5358   -0.1276   -0.1276   -0.1276    1.6392
</span></pre>
</div>
</div>
</div>
<p>Neat!</p>
<p>Similarly, which automatic differentiation backend one should use can be specified through the <code>adtype</code> keyword argument too. For example, if we want to use <a href="https://github.com/JuliaDiff/ReverseDiff.jl">ReverseDiff.jl</a> instead of the default <a href="https://github.com/JuliaDiff/ForwardDiff.jl">ForwardDiff.jl</a>:</p>
<div id="54" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">ReverseDiff</span>: ReverseDiff</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify that we want to use `AutoReverseDiff`.</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">demo</span>(),</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>, adtype<span class="op">=</span><span class="fu">AutoReverseDiff</span>()),</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>;</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 3.04 seconds
Compute duration  = 3.04 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters  </span><span class="ansi-bold">    mean  </span><span class="ansi-bold">     std  </span><span class="ansi-bold">    mcse  </span><span class="ansi-bold"> ess_bulk  </span><span class="ansi-bold"> ess_tail  </span><span class="ansi-bold">    rhat  </span><span class="ansi-bold"> e ⋯
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">  Float64  </span><span class="ansi-bright-black-fg ansi-bold">  Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">   ⋯

          σ²    0.8570    0.5557    0.0241   426.5379   206.4491    1.0013     ⋯
           x    0.0442    1.0442    0.0576   491.9760   248.3417    1.0008     ⋯
</span><span class="ansi-cyan-fg ansi-bold">                                                                1 column omitted

Quantiles
 </span><span class="ansi-cyan-fg ansi-bold"> parameters  </span><span class="ansi-cyan-fg ansi-bold">    2.5%  </span><span class="ansi-cyan-fg ansi-bold">   25.0%  </span><span class="ansi-cyan-fg ansi-bold">   50.0%  </span><span class="ansi-cyan-fg ansi-bold">   75.0%  </span><span class="ansi-cyan-fg ansi-bold">   97.5%
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64

          σ²    0.1217    0.4127    0.7587    1.1726    2.1728
           x   -2.0987   -0.4204   -0.0136    0.4246    2.6348
</span></pre>
</div>
</div>
</div>
<p>Double-neat.</p>
</section>
</section>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<p>At this point it’s worth maybe reminding ourselves what we did and also <em>why</em> we did it:</p>
<ol type="1">
<li>We define our models in the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface because it makes the sampler agnostic to how the underlying model is implemented.</li>
<li>We implement our sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> interface, which just means that our sampler is a subtype of <code>AbstractMCMC.AbstractSampler</code> and we implement the MCMC transition in <code>AbstractMCMC.step</code>.</li>
<li>Points 1 and 2 makes it so our sampler can be used with a wide range of model implementations, amongst them being models implemented in both Turing.jl and Stan. This gives you, the inference implementer, a large collection of models to test your inference method on, in addition to allowing users of Turing.jl and Stan to try out your inference method with minimal effort.</li>
</ol>


</section>


<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a><div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>We’re going with the leapfrog formulation because in a future version of this tutorial we’ll add a section extending this simple “baseline” MALA sampler to more complex versions. See <a href="https://github.com/TuringLang/docs/issues/479">issue #479</a> for progress on this.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>There is no such thing as a proper interface in Julia (at least not officially), and so we use the word “interface” here to mean a few minimal methods that needs to be implemented by any type that we treat as a target model.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    // Ensure there is a toggle, if there isn't float one in the top right
    if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
      const a = window.document.createElement('a');
      a.classList.add('top-right');
      a.classList.add('quarto-color-scheme-toggle');
      a.href = "";
      a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
      const i = window.document.createElement("i");
      i.classList.add('bi');
      a.appendChild(i);
      window.document.body.appendChild(a);
    }
    setColorSchemeToggle(hasAlternateSentinel())
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/turinglang\.org\/docs\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../../developers/inference/variational-inference/index.html" class="pagination-link" aria-label="Variational Inference">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Variational Inference</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Turing is created by <a href="http://mlg.eng.cam.ac.uk/hong/" target="_blank">Hong Ge</a>, and maintained by the <a href="../../../team" target="_blank">core team of developers</a>. <br> © 2025 under the terms of the <a href="https://github.com/TuringLang/Turing.jl/blob/master/LICENCE" target="_blank">MIT License</a>.</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/TuringLang/docs/edit/main/developers/inference/implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/docs/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://x.com/TuringLang">
      <i class="bi bi-twitter" role="img" aria-label="Turing Twitter">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/TuringLang/Turing.jl">
      <i class="bi bi-github" role="img" aria-label="Turing GitHub">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




<script src="../../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>