<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Implementing samplers – Turing.jl</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../tutorials/docs-07-for-developers-variational-inference/index.html" rel="prev">
<link href="../../assets/favicon.ico" rel="icon">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<style>
  a {
    text-decoration: none;
  }
  a:hover {
    text-decoration: underline;
  }
</style>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../theming/styles.css">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="https://turinglang.org/" class="navbar-brand navbar-brand-logo">
    <img src="../../assets/images/turing-logo.svg" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="https://turinglang.org/">
    <span class="navbar-title">Turing.jl</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../tutorials/docs-00-getting-started/"> 
<span class="menu-text">Get Started</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../tutorials/00-introduction/"> 
<span class="menu-text">Tutorials</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/library/"> 
<span class="menu-text">Libraries</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/news/"> 
<span class="menu-text">News</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/team/"> 
<span class="menu-text">Team</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-v0.34" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">v0.34</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-v0.34">    
        <li>
    <a class="dropdown-item" href="https://turinglang.org/docs/changelog.html">
 <span class="dropdown-text">Changelog</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://turinglang.org/docs/versions.html">
 <span class="dropdown-text">All Versions</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
    <a href="https://x.com/TuringLang" title="Turing Twitter" class="quarto-navigation-tool px-1" aria-label="Turing Twitter"><i class="bi bi-twitter"></i></a>
    <a href="https://github.com/TuringLang/Turing.jl" title="Turing GitHub" class="quarto-navigation-tool px-1" aria-label="Turing GitHub"><i class="bi bi-github"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Documentation</li><li class="breadcrumb-item"><a href="../../tutorials/docs-04-for-developers-abstractmcmc-turing/index.html">Developers: Inference</a></li><li class="breadcrumb-item"><a href="../../tutorials/docs-17-implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Documentation</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false">
 <span class="menu-text">Using Turing - Modelling Syntax and Interface</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-00-getting-started/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Getting Started</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-14-using-turing-quick-start/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Quick Start</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-12-using-turing-guide/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Guide</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-17-mode-estimation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Mode Estimation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-09-using-turing-advanced/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Advanced Usage</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-10-using-turing-autodiff/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Automatic Differentiation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-13-using-turing-performance-tips/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Performance Tips</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-11-using-turing-dynamichmc/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using DynamicHMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-15-using-turing-sampler-viz/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Sampler Visualization</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-16-using-turing-external-samplers/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">External Samplers</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false">
 <span class="menu-text">Using Turing - Tutorials</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/00-introduction/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction to Turing</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/01-gaussian-mixture-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Mixture Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/02-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/03-bayesian-neural-network/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Neural Networks</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/04-hidden-markov-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Hidden Markov Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/05-linear-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Linear Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/06-infinite-mixture-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Infinite Mixture Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/07-poisson-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Poisson Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/08-multinomial-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Multinomial Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/09-variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/10-bayesian-differential-equations/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Differential Equations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/11-probabilistic-pca/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Probabilistic PCA</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/13-seasonal-time-series/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Time Series Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/15-gaussian-processes/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction to Gaussian Processes</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/12-gplvm/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Process Latent Variable Models</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false">
 <span class="menu-text">Developers: Contributing</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-01-contributing-guide/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">How to Contribute</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false">
 <span class="menu-text">Developers: PPL</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-05-for-developers-compiler/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Turing Compiler Design</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/14-minituring/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation I: Compiler</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/16-contexts/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation II: Contexts</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-06-for-developers-interface/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Interface Guide</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true">
 <span class="menu-text">Developers: Inference</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-04-for-developers-abstractmcmc-turing/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">How Turing implements AbstractMCMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-07-for-developers-variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-17-implementing-samplers/index.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Implementing Samplers</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of Contents</h2>
   
  <ul>
  <li><a href="#quick-overview-of-mala" id="toc-quick-overview-of-mala" class="nav-link active" data-scroll-target="#quick-overview-of-mala">Quick overview of MALA</a></li>
  <li><a href="#what-we-need-from-a-model-logdensityproblems.jl" id="toc-what-we-need-from-a-model-logdensityproblems.jl" class="nav-link" data-scroll-target="#what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: LogDensityProblems.jl</a></li>
  <li><a href="#implementing-mala-in-abstractmcmc.jl" id="toc-implementing-mala-in-abstractmcmc.jl" class="nav-link" data-scroll-target="#implementing-mala-in-abstractmcmc.jl">Implementing MALA in AbstractMCMC.jl</a></li>
  <li><a href="#using-our-sampler-with-turing.jl" id="toc-using-our-sampler-with-turing.jl" class="nav-link" data-scroll-target="#using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</a>
  <ul class="collapse">
  <li><a href="#models-with-constrained-parameters" id="toc-models-with-constrained-parameters" class="nav-link" data-scroll-target="#models-with-constrained-parameters">Models with constrained parameters</a></li>
  </ul></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/TuringLang/docs/edit/master/tutorials/docs-17-implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/docs/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Documentation</li><li class="breadcrumb-item"><a href="../../tutorials/docs-04-for-developers-abstractmcmc-turing/index.html">Developers: Inference</a></li><li class="breadcrumb-item"><a href="../../tutorials/docs-17-implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Implementing samplers</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>In this tutorial, we’ll go through step-by-step how to implement a “simple” sampler in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> in such a way that it can be easily applied to Turing.jl models.</p>
<p>In particular, we’re going to implement a version of <strong>Metropolis-adjusted Langevin (MALA)</strong>.</p>
<p>Note that we will implement this sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> framework, completely “ignoring” Turing.jl until the very end of the tutorial, at which point we’ll use a single line of code to make the resulting sampler available to Turing.jl. This is to really drive home the point that one can implement samplers in a way that is accessible to all of Turing.jl’s users without having to use Turing.jl yourself.</p>
<section id="quick-overview-of-mala" class="level2">
<h2 class="anchored" data-anchor-id="quick-overview-of-mala">Quick overview of MALA</h2>
<p>We can view MALA as a single step of the leapfrog intergrator with resampling of momentum <span class="math inline">\(p\)</span> at every step.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> To make that statement a bit more concrete, we first define the <em>extended</em> target <span class="math inline">\(\bar{\gamma}(x, p)\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\log \bar{\gamma}(x, p) \propto \log \gamma(x) + \log \gamma_{\mathcal{N}(0, M)}(p)
\end{equation*}\]</span></p>
<p>where <span class="math inline">\(\gamma_{\mathcal{N}(0, M)}\)</span> denotes the density for a zero-centered Gaussian with covariance matrix <span class="math inline">\(M\)</span>. We then consider targeting this joint distribution over both <span class="math inline">\(x\)</span> and <span class="math inline">\(p\)</span> as follows. First we define the map</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  L_{\epsilon}: \quad &amp; \mathbb{R}^d \times \mathbb{R}^d \to \mathbb{R}^d \times \mathbb{R}^d \\
  &amp; (x, p) \mapsto (\tilde{x}, \tilde{p}) := L_{\epsilon}(x, p)
\end{split}
\end{equation*}\]</span></p>
<p>as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p_{1 / 2} &amp;:= p + \frac{\epsilon}{2} \nabla \log \gamma(x) \\
  \tilde{x} &amp;:= x + \epsilon M^{-1} p_{1 /2 } \\
  p_1 &amp;:= p_{1 / 2} + \frac{\epsilon}{2} \nabla \log \gamma(\tilde{x}) \\
  \tilde{p} &amp;:= - p_1
\end{split}
\end{equation*}\]</span></p>
<p>This might be familiar for some readers as a single step of the Leapfrog integrator. We then define the MALA kernel as follows: given the current iterate <span class="math inline">\(x_i\)</span>, we sample the next iterate <span class="math inline">\(x_{i + 1}\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p &amp;\sim \mathcal{N}(0, M) \\
  (\tilde{x}, \tilde{p}) &amp;:= L_{\epsilon}(x_i, p) \\
  \alpha &amp;:= \min \left\{ 1, \frac{\bar{\gamma}(\tilde{x}, \tilde{p})}{\bar{\gamma}(x_i, p)} \right\} \\
  x_{i + 1} &amp;:=
  \begin{cases}
    \tilde{x} \quad &amp; \text{ with prob. } \alpha \\
    x_i       \quad &amp; \text{ with prob. } 1 - \alpha
  \end{cases}
\end{split}
\end{equation*}\]</span></p>
<p>i.e.&nbsp;we accept the proposal <span class="math inline">\(\tilde{x}\)</span> with probability <span class="math inline">\(\alpha\)</span> and reject it, thus sticking with our current iterate, with probability <span class="math inline">\(1 - \alpha\)</span>.</p>
</section>
<section id="what-we-need-from-a-model-logdensityproblems.jl" class="level2">
<h2 class="anchored" data-anchor-id="what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a></h2>
<p>There are a few things we need from the “target” / “model” / density that we want to sample from:</p>
<ol type="1">
<li>We need access to log-density <em>evaluations</em> <span class="math inline">\(\log \gamma(x)\)</span> so we can compute the acceptance ratio involving <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>We need access to log-density <em>gradients</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span> so we can compute the Leapfrog steps <span class="math inline">\(L_{\epsilon}(x, p)\)</span>.</li>
<li>We also need access to the “size” of the model so we can determine the size of <span class="math inline">\(M\)</span>.</li>
</ol>
<p>Luckily for us, there is a package called <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> which provides an interface for <em>exactly</em> this!</p>
<p>To demonstrate how one can implement the “<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface”<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> we will use a simple Gaussian model as an example:</p>
<div id="4" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblems</span>: LogDensityProblems;</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's define some type that represents the model.</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> IsotropicNormalModel{M<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"mean of the isotropic Gaussian"</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    mean<span class="op">::</span><span class="dt">M</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Specifies what input length the model expects.</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">dimension</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> <span class="fu">length</span>(model.mean)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Implementation of the log-density evaluation of the model.</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x<span class="op">::</span><span class="dt">AbstractVector{&lt;:Real}</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">-</span> <span class="fu">sum</span>(abs2, x <span class="op">.-</span> model.mean) <span class="op">/</span> <span class="fl">2</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This gives us all of the properties we want for our MALA sampler with the exception of the computation of the <em>gradient</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span>. There is the method <code>LogDensityProblems.logdensity_and_gradient</code> which should return a 2-tuple where the first entry is the evaluation of the logdensity <span class="math inline">\(\log \gamma(x)\)</span> and the second entry is the gradient <span class="math inline">\(\nabla \log \gamma(x)\)</span>.</p>
<p>There are two ways to “implement” this method: 1) we implement it by hand, which is feasible in the case of our <code>IsotropicNormalModel</code>, or b) we defer the implementation of this to a automatic differentiation backend.</p>
<p>To implement it by hand we can simply do</p>
<div id="6" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl that first-order, i.e. gradient information, is available.</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{1}</span>()</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Implement `logdensity_and_gradient`.</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    logγ_x <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="op">-</span>x <span class="op">.*</span> (x <span class="op">-</span> model.mean)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> logγ_x, ∇logγ_x</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s just try it out:</p>
<div id="8" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate the problem.</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> <span class="fu">IsotropicNormalModel</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.])</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create some example input that we can test on.</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>x_example <span class="op">=</span> <span class="fu">randn</span>(LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate!</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-37.52222562536879</code></pre>
</div>
</div>
<p>To defer it to an automatic differentiation backend, we can do</p>
<div id="10" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl we only have access to 0-th order information.</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{0}</span>()</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Use `LogDensityProblemsAD`'s `ADgradient` in combination with some AD backend to implement `logdensity_and_gradient`.</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblemsAD</span>, <span class="bu">ADTypes</span>, <span class="bu">ForwardDiff</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>model_with_grad <span class="op">=</span> <span class="fu">ADgradient</span>(<span class="fu">AutoForwardDiff</span>(), model)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model_with_grad, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-37.52222562536879</code></pre>
</div>
</div>
<p>We’ll continue with the second approach in this tutorial since this is typically what one does in practice, because there are better hobbies to spend time on than deriving gradients by hand.</p>
<p>At this point, one might wonder how we’re going to tie this back to Turing.jl in the end. Effectively, when working with inference methods that only require log-density evaluations and / or higher-order information of the log-density, Turing.jl actually converts the user-provided <code>Model</code> into an object implementing the above methods for <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>. As a result, most samplers provided by Turing.jl are actually implemented to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, enabling their use both <em>within</em> Turing.jl and <em>outside</em> of Turing.jl! Morever, there exists similar conversions for Stan through BridgeStan and Stan<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, which means that a sampler supporting the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface can easily be used on both Turing.jl <em>and</em> Stan models (in addition to user-provided models, as our <code>IsotropicNormalModel</code> above)!</p>
<p>Anyways, let’s move on to actually implementing the sampler.</p>
</section>
<section id="implementing-mala-in-abstractmcmc.jl" class="level2">
<h2 class="anchored" data-anchor-id="implementing-mala-in-abstractmcmc.jl">Implementing MALA in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a></h2>
<p>Now that we’ve established that a model implementing the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface provides us with all the information we need from <span class="math inline">\(\log \gamma(x)\)</span>, we can address the question: given an object that implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, how can we define a sampler for it?</p>
<p>We’re going to do this by making our sampler a sub-type of <code>AbstractMCMC.AbstractSampler</code> in addition to implementing a few methods from <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>. Why? Because it gets us <em>a lot</em> of functionality for free, as we will see later.</p>
<p>Moreover, <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> provides a very natural interface for MCMC algorithms.</p>
<p>First, we’ll define our <code>MALA</code> type</p>
<div id="12" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">AbstractMCMC</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALA{T,A} <span class="op">&lt;:</span><span class="dt"> AbstractMCMC.AbstractSampler</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"stepsize used in the leapfrog step"</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    ϵ_init<span class="op">::</span><span class="dt">T</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"covariance matrix used for the momentum"</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    M_init<span class="op">::</span><span class="dt">A</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notice how we’ve added the suffix <code>_init</code> to both the stepsize and the covariance matrix. We’ve done this because a <code>AbstractMCMC.AbstractSampler</code> should be <em>immutable</em>. Of course there might be many scenarios where we want to allow something like the stepsize and / or the covariance matrix to vary between iterations, e.g.&nbsp;during the burn-in / adaptation phase of the sampling process we might want to adjust the parameters using statistics computed from these initial iterations. But information which can change between iterations <em>should not go in the sampler itself</em>! Instead, this information should go in the sampler <em>state</em>.</p>
<p>The sampler state should at the very least contain all the necessary information to perform the next MCMC iteration, but usually contains further information, e.g.&nbsp;quantities and statistics useful for evaluating whether the sampler has converged.</p>
<p>We will use the following sampler state for our <code>MALA</code> sampler:</p>
<div id="14" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALAState{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This might seem overly redundant: we’re defining a type <code>MALAState</code> and it only contains a simple vector of reals. In this particular case we indeed could have dropped this and simply used a <code>AbstractVector{&lt;:Real}</code> as our sampler state, but typically, as we will see later, one wants to include other quantities in the sampler state. For example, if we also wanted to adapt the parameters of our <code>MALA</code>, e.g.&nbsp;alter the stepsize depending on acceptance rates, in which case we should also put <code>ϵ</code> in the state, but for now we’ll keep things simple.</p>
<p>Moreover, we also want a <em>sample</em> type, which is a type meant for “public consumption”, i.e.&nbsp;the end-user. This is generally going to contain a subset of the information present in the state. But in such a simple scenario as this, we similarly only have a <code>AbstractVector{&lt;:Real}</code>:</p>
<div id="16" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALASample{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We currently have three things:</p>
<ol type="1">
<li>A <code>AbstractMCMC.AbstractSampler</code> implementation called <code>MALA</code>.</li>
<li>A state <code>MALAState</code> for our sampler <code>MALA</code>.</li>
<li>A sample <code>MALASample</code> for our sampler <code>MALA</code>.</li>
</ol>
<p>That means that we’re ready to implement the only thing that really matters: <code>AbstractMCMC.step</code>.</p>
<p><code>AbstractMCMC.step</code> defines the MCMC iteration of our <code>MALA</code> given the current <code>MALAState</code>. Specifically, the signature of the function is as follows:</p>
<div id="18" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The RNG to ensure reproducibility.</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The model that defines our target.</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.AbstractModel</span>,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The sampler for which we're taking a `step`.</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">AbstractMCMC.AbstractSampler</span>,</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The current sampler `state`.</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    state;</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Additional keyword arguments that we may or may not need.</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Moreover, there is a specific <code>AbstractMCMC.AbstractModel</code> which is used to indicate that the model that is provided implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface: <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Since, as we discussed earlier, in our case we’re indeed going to work with types that support the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, we’ll define <code>AbstractMCMC.step</code> for such a <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Note that <code>AbstractMCMC.LogDensityModel</code> has no other purpose; it has a single field called <code>logdensity</code>, and it does nothing else. But by wrapping the model in <code>AbstractMCMC.LogDensityModel</code>, it allows samplers that want to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> to define their <code>AbstractMCMC.step</code> on this type without running into method ambiguities.</p>
<p>All in all, that means that the signature for our <code>AbstractMCMC.step</code> is going to be the following:</p>
<div id="20" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># `LogDensityModel` so we know we're working with LogDensityProblems.jl model.</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler.</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler state.</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Great! Now let’s actually implement the full <code>AbstractMCMC.step</code> for our <code>MALA</code>.</p>
<p>Let’s remind ourselves what we’re going to do:</p>
<ol type="1">
<li>Sample a new momentum <span class="math inline">\(p\)</span>.</li>
<li>Compute the log-density of the extended target <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>Take a single leapfrog step <span class="math inline">\((\tilde{x}, \tilde{p}) = L_{\epsilon}(x, p)\)</span>.</li>
<li>Accept or reject the proposed <span class="math inline">\((\tilde{x}, \tilde{p})\)</span>.</li>
</ol>
<p>All in all, this results in the following:</p>
<div id="22" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>: Random</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Distributions</span>  <span class="co"># so we get the `MvNormal`</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the wrapped model which implements LogDensityProblems.jl.</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just extract the sampler parameters to make our lives easier.</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    ϵ <span class="op">=</span> sampler.ϵ_init</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    M <span class="op">=</span> sampler.M_init</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the current parameters.</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> state.x</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sample the momentum.</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>    p_dist <span class="op">=</span> <span class="fu">MvNormal</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)), M)</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> <span class="fu">rand</span>(rng, p_dist)</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Propose using a single leapfrog step.</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>    x̃, p̃ <span class="op">=</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Accept or reject proposal.</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>    logp <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p)</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>    logp̃ <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x̃) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p̃)</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>    logα <span class="op">=</span> logp̃ <span class="op">-</span> logp</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>    state_new <span class="op">=</span> <span class="cf">if</span> <span class="fu">log</span>(<span class="fu">rand</span>(rng)) <span class="op">&lt;</span> logα</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Accept.</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x̃)</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Reject.</span></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x)</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return the "sample" and the sampler state.</span></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(state_new.x), state_new</span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Fairly straight-forward.</p>
<p>Of course, we haven’t defined the <code>leapfrog_step</code> method yet, so let’s do that:</p>
<div id="24" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p` using "position" `x`.</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x))</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    p1 <span class="op">=</span> p <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update the "position" `x` using momentum `p1`.</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    x̃ <span class="op">=</span> x <span class="op">+</span> ϵ <span class="op">.*</span> (M <span class="op">\</span> p1)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p1` using position `x̃`</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x̃ <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x̃))</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    p2 <span class="op">=</span> p1 <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x̃</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Flip momentum `p2`.</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    p̃ <span class="op">=</span> <span class="op">-</span>p2</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x̃, p̃</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>leapfrog_step (generic function with 1 method)</code></pre>
</div>
</div>
<p>With all of this, we’re technically ready to sample!</p>
<div id="26" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>, <span class="bu">LinearAlgebra</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>rng <span class="op">=</span> <span class="bu">Random</span>.<span class="fu">default_rng</span>()</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>sampler <span class="op">=</span> <span class="fu">MALA</span>(<span class="fl">1</span>, I)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>state <span class="op">=</span> <span class="fu">MALAState</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)))</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>x_next, state_next <span class="op">=</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    rng,</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    AbstractMCMC.<span class="fu">LogDensityModel</span>(model),</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    state</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>(MALASample{Vector{Float64}}([0.0, 0.0, 0.0]), MALAState{Vector{Float64}}([0.0, 0.0, 0.0]))</code></pre>
</div>
</div>
<p>Great, it works!</p>
<p>And I promised we would get quite some functionality for free if we implemented <code>AbstractMCMC.step</code>, and so we can now simply call <code>sample</code> to perform standard MCMC sampling:</p>
<div id="28" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform 1000 iterations with our `MALA` sampler.</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; initial_state<span class="op">=</span>state, progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Concatenate into a matrix.</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000 Matrix{Float64}:
 -2.36828  -3.88575   -3.86068   -4.34712  …  -4.31477   -4.40705  -5.11883
  1.00871   0.992928  -0.351478   1.19052     -0.465177  -1.15582  -1.78237
  3.47304   4.37395    5.80442    5.76174      4.94438    3.77044   4.66868</code></pre>
</div>
</div>
<div id="30" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the marginal means and standard deviations.</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -5.00825    0.986315
  0.0265949  0.997595
  4.98692    1.01362</code></pre>
</div>
</div>
<p>Let’s visualize the samples</p>
<div id="32" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">StatsPlots</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">transpose</span>(samples_matrix[<span class="op">:</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">:</span><span class="kw">end</span>]), alpha<span class="op">=</span><span class="fl">0.5</span>, legend<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<!--?xml version="1.0" encoding="utf-8"?-->
<svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" width="672" height="480" viewbox="0 0 2688 1920">
<defs>
  <clippath id="clip190">
    <rect x="0" y="0" width="2688" height="1920"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip190)" d="M0 1920 L2688 1920 L2688 0 L0 0  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip191">
    <rect x="537" y="0" width="1883" height="1883"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip190)" d="M151.747 1800.78 L2640.76 1800.78 L2640.76 47.2441 L151.747 47.2441  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip192">
    <rect x="151" y="47" width="2490" height="1755"></rect>
  </clippath>
</defs>
<polyline clip-path="url(#clip192)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="219.84,1800.78 219.84,47.2441 "></polyline>
<polyline clip-path="url(#clip192)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="807.458,1800.78 807.458,47.2441 "></polyline>
<polyline clip-path="url(#clip192)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1395.08,1800.78 1395.08,47.2441 "></polyline>
<polyline clip-path="url(#clip192)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1982.69,1800.78 1982.69,47.2441 "></polyline>
<polyline clip-path="url(#clip192)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="2570.31,1800.78 2570.31,47.2441 "></polyline>
<polyline clip-path="url(#clip192)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,1519.26 2640.76,1519.26 "></polyline>
<polyline clip-path="url(#clip192)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,1211.62 2640.76,1211.62 "></polyline>
<polyline clip-path="url(#clip192)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,903.988 2640.76,903.988 "></polyline>
<polyline clip-path="url(#clip192)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,596.353 2640.76,596.353 "></polyline>
<polyline clip-path="url(#clip192)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,288.717 2640.76,288.717 "></polyline>
<polyline clip-path="url(#clip190)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1800.78 2640.76,1800.78 "></polyline>
<polyline clip-path="url(#clip190)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="219.84,1800.78 219.84,1781.88 "></polyline>
<polyline clip-path="url(#clip190)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="807.458,1800.78 807.458,1781.88 "></polyline>
<polyline clip-path="url(#clip190)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1395.08,1800.78 1395.08,1781.88 "></polyline>
<polyline clip-path="url(#clip190)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1982.69,1800.78 1982.69,1781.88 "></polyline>
<polyline clip-path="url(#clip190)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="2570.31,1800.78 2570.31,1781.88 "></polyline>
<path clip-path="url(#clip190)" d="M219.84 1834 Q216.229 1834 214.4 1837.57 Q212.595 1841.11 212.595 1848.24 Q212.595 1855.34 214.4 1858.91 Q216.229 1862.45 219.84 1862.45 Q223.474 1862.45 225.28 1858.91 Q227.108 1855.34 227.108 1848.24 Q227.108 1841.11 225.28 1837.57 Q223.474 1834 219.84 1834 M219.84 1830.3 Q225.65 1830.3 228.706 1834.9 Q231.784 1839.49 231.784 1848.24 Q231.784 1856.96 228.706 1861.57 Q225.65 1866.15 219.84 1866.15 Q214.03 1866.15 210.951 1861.57 Q207.896 1856.96 207.896 1848.24 Q207.896 1839.49 210.951 1834.9 Q214.03 1830.3 219.84 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip190)" d="M771.15 1861.55 L787.47 1861.55 L787.47 1865.48 L765.525 1865.48 L765.525 1861.55 Q768.187 1858.79 772.771 1854.16 Q777.377 1849.51 778.558 1848.17 Q780.803 1845.65 781.683 1843.91 Q782.585 1842.15 782.585 1840.46 Q782.585 1837.71 780.641 1835.97 Q778.72 1834.23 775.618 1834.23 Q773.419 1834.23 770.965 1835 Q768.535 1835.76 765.757 1837.31 L765.757 1832.59 Q768.581 1831.46 771.035 1830.88 Q773.488 1830.3 775.525 1830.3 Q780.896 1830.3 784.09 1832.98 Q787.285 1835.67 787.285 1840.16 Q787.285 1842.29 786.474 1844.21 Q785.687 1846.11 783.581 1848.7 Q783.002 1849.37 779.9 1852.59 Q776.798 1855.78 771.15 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip190)" d="M797.331 1830.92 L815.687 1830.92 L815.687 1834.86 L801.613 1834.86 L801.613 1843.33 Q802.632 1842.98 803.65 1842.82 Q804.669 1842.64 805.687 1842.64 Q811.474 1842.64 814.854 1845.81 Q818.233 1848.98 818.233 1854.4 Q818.233 1859.97 814.761 1863.08 Q811.289 1866.15 804.97 1866.15 Q802.794 1866.15 800.525 1865.78 Q798.28 1865.41 795.872 1864.67 L795.872 1859.97 Q797.956 1861.11 800.178 1861.66 Q802.4 1862.22 804.877 1862.22 Q808.882 1862.22 811.22 1860.11 Q813.558 1858.01 813.558 1854.4 Q813.558 1850.78 811.22 1848.68 Q808.882 1846.57 804.877 1846.57 Q803.002 1846.57 801.127 1846.99 Q799.275 1847.4 797.331 1848.28 L797.331 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip190)" d="M837.446 1834 Q833.835 1834 832.007 1837.57 Q830.201 1841.11 830.201 1848.24 Q830.201 1855.34 832.007 1858.91 Q833.835 1862.45 837.446 1862.45 Q841.081 1862.45 842.886 1858.91 Q844.715 1855.34 844.715 1848.24 Q844.715 1841.11 842.886 1837.57 Q841.081 1834 837.446 1834 M837.446 1830.3 Q843.256 1830.3 846.312 1834.9 Q849.391 1839.49 849.391 1848.24 Q849.391 1856.96 846.312 1861.57 Q843.256 1866.15 837.446 1866.15 Q831.636 1866.15 828.557 1861.57 Q825.502 1856.96 825.502 1848.24 Q825.502 1839.49 828.557 1834.9 Q831.636 1830.3 837.446 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip190)" d="M1354.69 1830.92 L1373.05 1830.92 L1373.05 1834.86 L1358.98 1834.86 L1358.98 1843.33 Q1360 1842.98 1361.01 1842.82 Q1362.03 1842.64 1363.05 1842.64 Q1368.84 1842.64 1372.22 1845.81 Q1375.6 1848.98 1375.6 1854.4 Q1375.6 1859.97 1372.12 1863.08 Q1368.65 1866.15 1362.33 1866.15 Q1360.16 1866.15 1357.89 1865.78 Q1355.64 1865.41 1353.24 1864.67 L1353.24 1859.97 Q1355.32 1861.11 1357.54 1861.66 Q1359.76 1862.22 1362.24 1862.22 Q1366.25 1862.22 1368.58 1860.11 Q1370.92 1858.01 1370.92 1854.4 Q1370.92 1850.78 1368.58 1848.68 Q1366.25 1846.57 1362.24 1846.57 Q1360.37 1846.57 1358.49 1846.99 Q1356.64 1847.4 1354.69 1848.28 L1354.69 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip190)" d="M1394.81 1834 Q1391.2 1834 1389.37 1837.57 Q1387.56 1841.11 1387.56 1848.24 Q1387.56 1855.34 1389.37 1858.91 Q1391.2 1862.45 1394.81 1862.45 Q1398.44 1862.45 1400.25 1858.91 Q1402.08 1855.34 1402.08 1848.24 Q1402.08 1841.11 1400.25 1837.57 Q1398.44 1834 1394.81 1834 M1394.81 1830.3 Q1400.62 1830.3 1403.68 1834.9 Q1406.75 1839.49 1406.75 1848.24 Q1406.75 1856.96 1403.68 1861.57 Q1400.62 1866.15 1394.81 1866.15 Q1389 1866.15 1385.92 1861.57 Q1382.87 1856.96 1382.87 1848.24 Q1382.87 1839.49 1385.92 1834.9 Q1389 1830.3 1394.81 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip190)" d="M1424.97 1834 Q1421.36 1834 1419.53 1837.57 Q1417.73 1841.11 1417.73 1848.24 Q1417.73 1855.34 1419.53 1858.91 Q1421.36 1862.45 1424.97 1862.45 Q1428.61 1862.45 1430.41 1858.91 Q1432.24 1855.34 1432.24 1848.24 Q1432.24 1841.11 1430.41 1837.57 Q1428.61 1834 1424.97 1834 M1424.97 1830.3 Q1430.78 1830.3 1433.84 1834.9 Q1436.92 1839.49 1436.92 1848.24 Q1436.92 1856.96 1433.84 1861.57 Q1430.78 1866.15 1424.97 1866.15 Q1419.16 1866.15 1416.08 1861.57 Q1413.03 1856.96 1413.03 1848.24 Q1413.03 1839.49 1416.08 1834.9 Q1419.16 1830.3 1424.97 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip190)" d="M1940.97 1830.92 L1963.19 1830.92 L1963.19 1832.91 L1950.65 1865.48 L1945.76 1865.48 L1957.57 1834.86 L1940.97 1834.86 L1940.97 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip190)" d="M1972.36 1830.92 L1990.71 1830.92 L1990.71 1834.86 L1976.64 1834.86 L1976.64 1843.33 Q1977.66 1842.98 1978.68 1842.82 Q1979.7 1842.64 1980.72 1842.64 Q1986.5 1842.64 1989.88 1845.81 Q1993.26 1848.98 1993.26 1854.4 Q1993.26 1859.97 1989.79 1863.08 Q1986.32 1866.15 1980 1866.15 Q1977.82 1866.15 1975.55 1865.78 Q1973.31 1865.41 1970.9 1864.67 L1970.9 1859.97 Q1972.98 1861.11 1975.21 1861.66 Q1977.43 1862.22 1979.9 1862.22 Q1983.91 1862.22 1986.25 1860.11 Q1988.59 1858.01 1988.59 1854.4 Q1988.59 1850.78 1986.25 1848.68 Q1983.91 1846.57 1979.9 1846.57 Q1978.03 1846.57 1976.15 1846.99 Q1974.3 1847.4 1972.36 1848.28 L1972.36 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip190)" d="M2012.47 1834 Q2008.86 1834 2007.03 1837.57 Q2005.23 1841.11 2005.23 1848.24 Q2005.23 1855.34 2007.03 1858.91 Q2008.86 1862.45 2012.47 1862.45 Q2016.11 1862.45 2017.91 1858.91 Q2019.74 1855.34 2019.74 1848.24 Q2019.74 1841.11 2017.91 1837.57 Q2016.11 1834 2012.47 1834 M2012.47 1830.3 Q2018.28 1830.3 2021.34 1834.9 Q2024.42 1839.49 2024.42 1848.24 Q2024.42 1856.96 2021.34 1861.57 Q2018.28 1866.15 2012.47 1866.15 Q2006.66 1866.15 2003.59 1861.57 Q2000.53 1856.96 2000.53 1848.24 Q2000.53 1839.49 2003.59 1834.9 Q2006.66 1830.3 2012.47 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip190)" d="M2514.84 1861.55 L2522.48 1861.55 L2522.48 1835.18 L2514.17 1836.85 L2514.17 1832.59 L2522.43 1830.92 L2527.11 1830.92 L2527.11 1861.55 L2534.75 1861.55 L2534.75 1865.48 L2514.84 1865.48 L2514.84 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip190)" d="M2554.19 1834 Q2550.58 1834 2548.75 1837.57 Q2546.94 1841.11 2546.94 1848.24 Q2546.94 1855.34 2548.75 1858.91 Q2550.58 1862.45 2554.19 1862.45 Q2557.82 1862.45 2559.63 1858.91 Q2561.46 1855.34 2561.46 1848.24 Q2561.46 1841.11 2559.63 1837.57 Q2557.82 1834 2554.19 1834 M2554.19 1830.3 Q2560 1830.3 2563.06 1834.9 Q2566.13 1839.49 2566.13 1848.24 Q2566.13 1856.96 2563.06 1861.57 Q2560 1866.15 2554.19 1866.15 Q2548.38 1866.15 2545.3 1861.57 Q2542.25 1856.96 2542.25 1848.24 Q2542.25 1839.49 2545.3 1834.9 Q2548.38 1830.3 2554.19 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip190)" d="M2584.35 1834 Q2580.74 1834 2578.91 1837.57 Q2577.11 1841.11 2577.11 1848.24 Q2577.11 1855.34 2578.91 1858.91 Q2580.74 1862.45 2584.35 1862.45 Q2587.99 1862.45 2589.79 1858.91 Q2591.62 1855.34 2591.62 1848.24 Q2591.62 1841.11 2589.79 1837.57 Q2587.99 1834 2584.35 1834 M2584.35 1830.3 Q2590.16 1830.3 2593.22 1834.9 Q2596.3 1839.49 2596.3 1848.24 Q2596.3 1856.96 2593.22 1861.57 Q2590.16 1866.15 2584.35 1866.15 Q2578.54 1866.15 2575.46 1861.57 Q2572.41 1856.96 2572.41 1848.24 Q2572.41 1839.49 2575.46 1834.9 Q2578.54 1830.3 2584.35 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip190)" d="M2614.51 1834 Q2610.9 1834 2609.07 1837.57 Q2607.27 1841.11 2607.27 1848.24 Q2607.27 1855.34 2609.07 1858.91 Q2610.9 1862.45 2614.51 1862.45 Q2618.15 1862.45 2619.95 1858.91 Q2621.78 1855.34 2621.78 1848.24 Q2621.78 1841.11 2619.95 1837.57 Q2618.15 1834 2614.51 1834 M2614.51 1830.3 Q2620.32 1830.3 2623.38 1834.9 Q2626.46 1839.49 2626.46 1848.24 Q2626.46 1856.96 2623.38 1861.57 Q2620.32 1866.15 2614.51 1866.15 Q2608.7 1866.15 2605.62 1861.57 Q2602.57 1856.96 2602.57 1848.24 Q2602.57 1839.49 2605.62 1834.9 Q2608.7 1830.3 2614.51 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip190)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1800.78 151.747,47.2441 "></polyline>
<polyline clip-path="url(#clip190)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1519.26 170.644,1519.26 "></polyline>
<polyline clip-path="url(#clip190)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1211.62 170.644,1211.62 "></polyline>
<polyline clip-path="url(#clip190)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,903.988 170.644,903.988 "></polyline>
<polyline clip-path="url(#clip190)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,596.353 170.644,596.353 "></polyline>
<polyline clip-path="url(#clip190)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,288.717 170.644,288.717 "></polyline>
<path clip-path="url(#clip190)" d="M49.5521 1519.71 L79.2279 1519.71 L79.2279 1523.65 L49.5521 1523.65 L49.5521 1519.71 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip190)" d="M99.8991 1517.4 Q96.7509 1517.4 94.8991 1519.55 Q93.0704 1521.7 93.0704 1525.45 Q93.0704 1529.18 94.8991 1531.35 Q96.7509 1533.51 99.8991 1533.51 Q103.047 1533.51 104.876 1531.35 Q106.728 1529.18 106.728 1525.45 Q106.728 1521.7 104.876 1519.55 Q103.047 1517.4 99.8991 1517.4 M109.181 1502.74 L109.181 1507 Q107.422 1506.17 105.617 1505.73 Q103.834 1505.29 102.075 1505.29 Q97.4454 1505.29 94.9917 1508.41 Q92.5612 1511.54 92.2139 1517.86 Q93.5797 1515.85 95.6398 1514.78 Q97.7 1513.69 100.177 1513.69 Q105.385 1513.69 108.394 1516.86 Q111.427 1520.01 111.427 1525.45 Q111.427 1530.78 108.279 1533.99 Q105.131 1537.21 99.8991 1537.21 Q93.9037 1537.21 90.7325 1532.63 Q87.5612 1528.02 87.5612 1519.29 Q87.5612 1511.1 91.45 1506.24 Q95.3389 1501.35 101.89 1501.35 Q103.649 1501.35 105.431 1501.7 Q107.237 1502.05 109.181 1502.74 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip190)" d="M50.3623 1212.08 L80.0381 1212.08 L80.0381 1216.01 L50.3623 1216.01 L50.3623 1212.08 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip190)" d="M104.297 1210.27 Q107.654 1210.99 109.529 1213.26 Q111.427 1215.52 111.427 1218.86 Q111.427 1223.97 107.908 1226.77 Q104.39 1229.58 97.9083 1229.58 Q95.7324 1229.58 93.4176 1229.14 Q91.126 1228.72 88.6723 1227.86 L88.6723 1223.35 Q90.6167 1224.48 92.9315 1225.06 Q95.2463 1225.64 97.7695 1225.64 Q102.168 1225.64 104.459 1223.9 Q106.774 1222.17 106.774 1218.86 Q106.774 1215.8 104.621 1214.09 Q102.492 1212.35 98.6722 1212.35 L94.6445 1212.35 L94.6445 1208.51 L98.8574 1208.51 Q102.306 1208.51 104.135 1207.14 Q105.964 1205.76 105.964 1203.16 Q105.964 1200.5 104.066 1199.09 Q102.191 1197.65 98.6722 1197.65 Q96.7509 1197.65 94.5519 1198.07 Q92.3528 1198.49 89.7139 1199.37 L89.7139 1195.2 Q92.376 1194.46 94.6908 1194.09 Q97.0287 1193.72 99.0889 1193.72 Q104.413 1193.72 107.515 1196.15 Q110.617 1198.56 110.617 1202.68 Q110.617 1205.55 108.973 1207.54 Q107.33 1209.51 104.297 1210.27 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip190)" d="M99.4824 889.787 Q95.8713 889.787 94.0426 893.352 Q92.2371 896.894 92.2371 904.023 Q92.2371 911.13 94.0426 914.694 Q95.8713 918.236 99.4824 918.236 Q103.117 918.236 104.922 914.694 Q106.751 911.13 106.751 904.023 Q106.751 896.894 104.922 893.352 Q103.117 889.787 99.4824 889.787 M99.4824 886.083 Q105.293 886.083 108.348 890.69 Q111.427 895.273 111.427 904.023 Q111.427 912.75 108.348 917.356 Q105.293 921.94 99.4824 921.94 Q93.6723 921.94 90.5936 917.356 Q87.538 912.75 87.538 904.023 Q87.538 895.273 90.5936 890.69 Q93.6723 886.083 99.4824 886.083 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip190)" d="M104.297 594.999 Q107.654 595.716 109.529 597.985 Q111.427 600.253 111.427 603.587 Q111.427 608.702 107.908 611.503 Q104.39 614.304 97.9083 614.304 Q95.7324 614.304 93.4176 613.864 Q91.126 613.448 88.6723 612.591 L88.6723 608.077 Q90.6167 609.212 92.9315 609.79 Q95.2463 610.369 97.7695 610.369 Q102.168 610.369 104.459 608.633 Q106.774 606.897 106.774 603.587 Q106.774 600.531 104.621 598.818 Q102.492 597.082 98.6722 597.082 L94.6445 597.082 L94.6445 593.239 L98.8574 593.239 Q102.306 593.239 104.135 591.874 Q105.964 590.485 105.964 587.892 Q105.964 585.23 104.066 583.818 Q102.191 582.383 98.6722 582.383 Q96.7509 582.383 94.5519 582.8 Q92.3528 583.216 89.7139 584.096 L89.7139 579.929 Q92.376 579.189 94.6908 578.818 Q97.0287 578.448 99.0889 578.448 Q104.413 578.448 107.515 580.878 Q110.617 583.286 110.617 587.406 Q110.617 590.276 108.973 592.267 Q107.33 594.235 104.297 594.999 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip190)" d="M99.8991 286.854 Q96.7509 286.854 94.8991 289.007 Q93.0704 291.159 93.0704 294.909 Q93.0704 298.636 94.8991 300.812 Q96.7509 302.965 99.8991 302.965 Q103.047 302.965 104.876 300.812 Q106.728 298.636 106.728 294.909 Q106.728 291.159 104.876 289.007 Q103.047 286.854 99.8991 286.854 M109.181 272.201 L109.181 276.46 Q107.422 275.627 105.617 275.187 Q103.834 274.747 102.075 274.747 Q97.4454 274.747 94.9917 277.872 Q92.5612 280.997 92.2139 287.317 Q93.5797 285.303 95.6398 284.238 Q97.7 283.15 100.177 283.15 Q105.385 283.15 108.394 286.321 Q111.427 289.47 111.427 294.909 Q111.427 300.233 108.279 303.451 Q105.131 306.669 99.8991 306.669 Q93.9037 306.669 90.7325 302.085 Q87.5612 297.479 87.5612 288.752 Q87.5612 280.558 91.45 275.696 Q95.3389 270.812 101.89 270.812 Q103.649 270.812 105.431 271.159 Q107.237 271.507 109.181 272.201 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip192)" style="stroke:#009af9; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,1146.84 224.541,1530.72 226.891,1365.93 229.242,1395.21 231.592,1630.64 233.943,1179.79 236.293,1582.76 238.644,1424.55 240.994,1414.06 243.345,1313.65 245.695,1488.35 248.046,1417.43 250.396,1491.53 252.747,1497.45 255.097,1381.18 257.448,1501.1 259.798,1240.8 262.148,1470.05 264.499,1394.57 266.849,1396.59 269.2,1462.91 271.55,1593.67 273.901,1462.04 276.251,1382.27 278.602,1425.77 280.952,1314.13 283.303,1314.87 285.653,1379.54 288.004,1631.64 290.354,1511.95 292.705,1357.36 295.055,1407.31 297.406,1491.79 299.756,1365.34 302.107,1532.06 304.457,1351.15 306.807,1217.25 309.158,1453.3 311.508,1370.84 313.859,1420.52 316.209,1453.98 318.56,1354.04 320.91,1393.17 323.261,1380.35 325.611,1522.18 327.962,1330.66 330.312,1421.52 332.663,1420.36 335.013,1319.55 337.364,1449.84 339.714,1472.04 342.065,1524.74 344.415,1221.25 346.765,1384.5 349.116,1267.61 351.466,1602.14 353.817,1342.25 356.167,1312.58 358.518,1460.22 360.868,1312.14 363.219,1324.45 365.569,1355.28 367.92,1438.53 370.27,1384.26 372.621,1392.9 374.971,1497.99 377.322,1355.4 379.672,1510.23 382.023,1509.41 384.373,1517.21 386.724,1306.62 389.074,1436.19 391.424,1429.63 393.775,1383.36 396.125,1515.87 398.476,1351.31 400.826,1535.62 403.177,1440.65 405.527,1401.17 407.878,1298.47 410.228,1401.96 412.579,1379.25 414.929,1473.83 417.28,1633.53 419.63,1385.14 421.981,1313.32 424.331,1307.29 426.682,1322.81 429.032,1449.04 431.382,1312.28 433.733,1293.87 436.083,1456.73 438.434,1592.26 440.784,1320.75 443.135,1425.53 445.485,1489.4 447.836,1384.57 450.186,1448.56 452.537,1349.6 454.887,1443.03 457.238,1416.46 459.588,1409.29 461.939,1569.44 464.289,1451.1 466.64,1672.49 468.99,1425.15 471.341,1254.51 473.691,1112.21 476.041,1383.81 478.392,1356.99 480.742,1422.24 483.093,1505.85 485.443,1439.47 487.794,1400.89 490.144,1368 492.495,1620.89 494.845,1358.92 497.196,1415.66 499.546,1357.04 501.897,1434.58 504.247,1335.55 506.598,1452.11 508.948,1563.07 511.299,1373.81 513.649,1546.34 515.999,1425.44 518.35,1602.93 520.7,1330.7 523.051,1466.95 525.401,1436.59 527.752,1318.16 530.102,1462.85 532.453,1402.95 534.803,1530.55 537.154,1496.81 539.504,1414.49 541.855,1425.13 544.205,1343.11 546.556,1582.28 548.906,1510.92 551.257,1496.58 553.607,1396.22 555.958,1477.33 558.308,1453.49 560.658,1568.78 563.009,1241.25 565.359,1281.1 567.71,1371.21 570.06,1368.61 572.411,1449.91 574.761,1330.47 577.112,1344.27 579.462,1411.97 581.813,1557.4 584.163,1291.83 586.514,1375.28 588.864,1457 591.215,1486.63 593.565,1516.07 595.916,1491.2 598.266,1397.8 600.616,1390.79 602.967,1474.59 605.317,1450.76 607.668,1421.05 610.018,1387.25 612.369,1436.24 614.719,1327.73 617.07,1568.26 619.42,1484 621.771,1422.68 624.121,1341.01 626.472,1259.74 628.822,1514.77 631.173,1548.97 633.523,1519.82 635.874,1354.78 638.224,1483.76 640.575,1351.1 642.925,1436.09 645.275,1251.3 647.626,1334.66 649.976,1439.83 652.327,1471.67 654.677,1439.19 657.028,1606.82 659.378,1328.93 661.729,1355.16 664.079,1585.72 666.43,1397.27 668.78,1407.04 671.131,1535.26 673.481,1452.8 675.832,1394.73 678.182,1461.03 680.533,1396.46 682.883,1556.62 685.233,1401.79 687.584,1522.63 689.934,1377.03 692.285,1402.46 694.635,1487.91 696.986,1364.11 699.336,1358.2 701.687,1420.5 704.037,1426.94 706.388,1342.8 708.738,1501 711.089,1416.76 713.439,1473.96 715.79,1515.63 718.14,1537.63 720.491,1559.89 722.841,1468.66 725.192,1343.01 727.542,1593.45 729.892,1492.75 732.243,1340.27 734.593,1369.13 736.944,1266.61 739.294,1331.12 741.645,1418.65 743.995,1302.65 746.346,1557.08 748.696,1200.71 751.047,1491.02 753.397,1600.15 755.748,1506.19 758.098,1466.68 760.449,1307.23 762.799,1367 765.15,1608.31 767.5,1502.02 769.85,1703.67 772.201,1454.48 774.551,1511.33 776.902,1297.88 779.252,1312.64 781.603,1394.96 783.953,1448.55 786.304,1467.94 788.654,1496.15 791.005,1422.29 793.355,1454.42 795.706,1550.27 798.056,1113.88 800.407,1506.23 802.757,1408.68 805.108,1376.36 807.458,1341.27 809.809,1616.43 812.159,1327.83 814.509,1276.83 816.86,1432.4 819.21,1552.17 821.561,1403.69 823.911,1361.25 826.262,1278.55 828.612,1314.71 830.963,1364.12 833.313,1508.32 835.664,1394.75 838.014,1430.77 840.365,1438.94 842.715,1336.58 845.066,1531.45 847.416,1531.39 849.767,1473.31 852.117,1394.16 854.467,1389.01 856.818,1398.28 859.168,1363.89 861.519,1262.42 863.869,1570.26 866.22,1457.88 868.57,1475.84 870.921,1293.67 873.271,1346.46 875.622,1258.65 877.972,1440.07 880.323,1592.15 882.673,1439.31 885.024,1496.55 887.374,1362.34 889.725,1373.65 892.075,1621.17 894.426,1450.54 896.776,1378.68 899.126,1261.83 901.477,1333.2 903.827,1380.71 906.178,1261.99 908.528,1377.65 910.879,1299.28 913.229,1290.3 915.58,1416.74 917.93,1459.47 920.281,1541.18 922.631,1390.48 924.982,1401.74 927.332,1554.83 929.683,1566.04 932.033,1366.91 934.384,1546.86 936.734,1443.01 939.084,1453.39 941.435,1573.27 943.785,1506.94 946.136,1474.29 948.486,1477.46 950.837,1401.86 953.187,1261.42 955.538,1178.62 957.888,1403.95 960.239,1392.64 962.589,1368.52 964.94,1367.03 967.29,1363.84 969.641,1495.59 971.991,1315.45 974.342,1548.41 976.692,1449.91 979.043,1270.85 981.393,1358.12 983.743,1436.36 986.094,1412.73 988.444,1519.19 990.795,1345.9 993.145,1502.23 995.496,1431.92 997.846,1555.95 1000.2,1466.97 1002.55,1493.52 1004.9,1452.55 1007.25,1373.5 1009.6,1521.83 1011.95,1341.33 1014.3,1357.23 1016.65,1538.72 1019,1315.85 1021.35,1469.73 1023.7,1295.32 1026.05,1341.14 1028.4,1521.09 1030.75,1424.75 1033.1,1398.7 1035.45,1266.67 1037.8,1420.99 1040.15,1414.08 1042.51,1318.37 1044.86,1426.23 1047.21,1309.99 1049.56,1458.38 1051.91,1517.75 1054.26,1400.73 1056.61,1345.15 1058.96,1371.29 1061.31,1291.21 1063.66,1409.11 1066.01,1380.68 1068.36,1389.52 1070.71,1391.88 1073.06,1680.14 1075.41,1350.21 1077.76,1367.96 1080.11,1490.4 1082.46,1556.78 1084.81,1306.13 1087.16,1323.38 1089.51,1488.15 1091.87,1399.21 1094.22,1321.53 1096.57,1491.63 1098.92,1357.11 1101.27,1314.97 1103.62,1537.18 1105.97,1435.69 1108.32,1448.6 1110.67,1498.37 1113.02,1606.66 1115.37,1619.38 1117.72,1372.35 1120.07,1445.45 1122.42,1465.11 1124.77,1611.15 1127.12,1544.93 1129.47,1413.38 1131.82,1570.51 1134.17,1422.59 1136.52,1425.31 1138.87,1391.63 1141.23,1297.83 1143.58,1292.09 1145.93,1667.51 1148.28,1459.53 1150.63,1475.31 1152.98,1433.69 1155.33,1422.08 1157.68,1577.92 1160.03,1408.06 1162.38,1429.87 1164.73,1330.74 1167.08,1454.54 1169.43,1449.07 1171.78,1163.68 1174.13,1471.91 1176.48,1466.84 1178.83,1397.91 1181.18,1373.36 1183.53,1267.62 1185.88,1441.27 1188.23,1402.69 1190.59,1347.03 1192.94,1411.07 1195.29,1401.97 1197.64,1485.14 1199.99,1467.55 1202.34,1448.53 1204.69,1401.41 1207.04,1349.18 1209.39,1399.68 1211.74,1378.55 1214.09,1315.88 1216.44,1437.5 1218.79,1468.15 1221.14,1504.55 1223.49,1535.8 1225.84,1395.54 1228.19,1374.85 1230.54,1331.45 1232.89,1259.05 1235.24,1452.57 1237.59,1559.58 1239.94,1521.54 1242.3,1544.53 1244.65,1474.65 1247,1456.79 1249.35,1343.65 1251.7,1474.49 1254.05,1259.67 1256.4,1384 1258.75,1487.33 1261.1,1469.54 1263.45,1300.36 1265.8,1458.02 1268.15,1554.89 1270.5,1462.48 1272.85,1345.85 1275.2,1449.51 1277.55,1377.33 1279.9,1338.44 1282.25,1344.2 1284.6,1589.78 1286.95,1384.64 1289.3,1451.69 1291.66,1478.13 1294.01,1477.67 1296.36,1323.99 1298.71,1637.27 1301.06,1527.1 1303.41,1386.7 1305.76,1176.22 1308.11,1436.72 1310.46,1492.81 1312.81,1308.47 1315.16,1393.45 1317.51,1365.48 1319.86,1334.67 1322.21,1394.04 1324.56,1404.63 1326.91,1423.5 1329.26,1617.7 1331.61,1466.84 1333.96,1444.32 1336.31,1301.37 1338.66,1514.43 1341.02,1520.49 1343.37,1461.22 1345.72,1509 1348.07,1484.66 1350.42,1501.12 1352.77,1474.39 1355.12,1275.69 1357.47,1396.39 1359.82,1380.49 1362.17,1293.16 1364.52,1509.38 1366.87,1383.16 1369.22,1415.57 1371.57,1295.05 1373.92,1455.21 1376.27,1605.86 1378.62,1481.32 1380.97,1512.68 1383.32,1425.29 1385.67,1312.75 1388.02,1510.25 1390.38,1390.64 1392.73,1316.63 1395.08,1436.35 1397.43,1416.3 1399.78,1446.57 1402.13,1404.15 1404.48,1341.77 1406.83,1380.44 1409.18,1319.74 1411.53,1339.5 1413.88,1419.08 1416.23,1500.38 1418.58,1547.47 1420.93,1456.87 1423.28,1416.8 1425.63,1562.07 1427.98,1582.44 1430.33,1414.56 1432.68,1254.96 1435.03,1382.36 1437.38,1433.6 1439.74,1415.39 1442.09,1312.95 1444.44,1460.4 1446.79,1416.8 1449.14,1301.24 1451.49,1402.56 1453.84,1395.68 1456.19,1342.82 1458.54,1355.98 1460.89,1392.38 1463.24,1346.13 1465.59,1417.85 1467.94,1409.04 1470.29,1427.32 1472.64,1450.65 1474.99,1373.61 1477.34,1535.71 1479.69,1494.72 1482.04,1339.54 1484.39,1256.51 1486.74,1444.36 1489.1,1390.14 1491.45,1390.51 1493.8,1543.42 1496.15,1425.91 1498.5,1307.32 1500.85,1427.02 1503.2,1348.8 1505.55,1289.17 1507.9,1308.89 1510.25,1571.81 1512.6,1545.72 1514.95,1261.18 1517.3,1498.72 1519.65,1333.41 1522,1469.35 1524.35,1339.49 1526.7,1371.12 1529.05,1477.55 1531.4,1367.07 1533.75,1341.35 1536.1,1562.72 1538.45,1478.16 1540.81,1453.45 1543.16,1403.29 1545.51,1477.5 1547.86,1532.31 1550.21,1514.64 1552.56,1180.87 1554.91,1542.83 1557.26,1468.98 1559.61,1421.97 1561.96,1165.1 1564.31,1332.84 1566.66,1498.19 1569.01,1452.05 1571.36,1566.36 1573.71,1425.31 1576.06,1299.91 1578.41,1316.98 1580.76,1452.6 1583.11,1272.5 1585.46,1443.68 1587.81,1278.72 1590.17,1357.27 1592.52,1479.56 1594.87,1545.47 1597.22,1408.58 1599.57,1349.69 1601.92,1294.5 1604.27,1448.55 1606.62,1262.45 1608.97,1346.21 1611.32,1480.31 1613.67,1479 1616.02,1361.14 1618.37,1497.46 1620.72,1573.59 1623.07,1433.07 1625.42,1465.46 1627.77,1652.26 1630.12,1486.78 1632.47,1386.35 1634.82,1396.22 1637.17,1373.3 1639.53,1277.27 1641.88,1487.95 1644.23,1136.79 1646.58,1429.83 1648.93,1466.13 1651.28,1323.69 1653.63,1479.65 1655.98,1337.51 1658.33,1529.62 1660.68,1577.42 1663.03,1575.62 1665.38,1196.89 1667.73,1406.5 1670.08,1402.86 1672.43,1353.6 1674.78,1244.3 1677.13,1330.03 1679.48,1428.63 1681.83,1387.24 1684.18,1449.5 1686.53,1404.38 1688.89,1418.53 1691.24,1478.92 1693.59,1421.72 1695.94,1338.97 1698.29,1123.19 1700.64,1385.31 1702.99,1506.13 1705.34,1342.88 1707.69,1339.49 1710.04,1449.08 1712.39,1419.76 1714.74,1260.15 1717.09,1169.48 1719.44,1489.82 1721.79,1230.83 1724.14,1628.85 1726.49,1502.96 1728.84,1509.31 1731.19,1684.57 1733.54,1397.37 1735.89,1505.59 1738.25,1647.29 1740.6,1491.96 1742.95,1391.5 1745.3,1343.78 1747.65,1385.85 1750,1516.57 1752.35,1628.89 1754.7,1351.71 1757.05,1478.02 1759.4,1342.62 1761.75,1316.47 1764.1,1350.86 1766.45,1463.11 1768.8,1327.1 1771.15,1374.19 1773.5,1400.09 1775.85,1360.3 1778.2,1380.84 1780.55,1515.64 1782.9,1204.79 1785.25,1483.61 1787.6,1195.25 1789.96,1320.45 1792.31,1263.36 1794.66,1429.65 1797.01,1478.78 1799.36,1488.97 1801.71,1387.96 1804.06,1349.8 1806.41,1571.43 1808.76,1360.21 1811.11,1445.31 1813.46,1540.78 1815.81,1443.61 1818.16,1511.62 1820.51,1496.52 1822.86,1364.19 1825.21,1485.58 1827.56,1473.79 1829.91,1456.35 1832.26,1234.69 1834.61,1377.74 1836.96,1411.34 1839.32,1234.6 1841.67,1426.19 1844.02,1195.98 1846.37,1650.24 1848.72,1348.71 1851.07,1510.69 1853.42,1370.62 1855.77,1458.13 1858.12,1509.22 1860.47,1571.33 1862.82,1519.27 1865.17,1464.54 1867.52,1498.89 1869.87,1489 1872.22,1480.55 1874.57,1409.76 1876.92,1546.73 1879.27,1320.04 1881.62,1334.46 1883.97,1438.45 1886.32,1280.85 1888.68,1368.32 1891.03,1421.9 1893.38,1470.16 1895.73,1490.64 1898.08,1313.77 1900.43,1238.15 1902.78,1289.72 1905.13,1386.41 1907.48,1532.16 1909.83,1339.8 1912.18,1294.18 1914.53,1362.82 1916.88,1331.18 1919.23,1367.71 1921.58,1719.12 1923.93,1406.26 1926.28,1647.48 1928.63,1524.41 1930.98,1259.7 1933.33,1369.27 1935.68,1439.8 1938.04,1396.92 1940.39,1256.14 1942.74,1215.84 1945.09,1440.18 1947.44,1504.35 1949.79,1298.86 1952.14,1325.79 1954.49,1340.11 1956.84,1359.17 1959.19,1354.59 1961.54,1389.3 1963.89,1571.01 1966.24,1398.78 1968.59,1504.31 1970.94,1319.79 1973.29,1537.9 1975.64,1361.58 1977.99,1462.47 1980.34,1418.64 1982.69,1513.17 1985.04,1426.72 1987.4,1364.74 1989.75,1409.88 1992.1,1344.3 1994.45,1298.39 1996.8,1443.35 1999.15,1494.12 2001.5,1318.22 2003.85,1275.65 2006.2,1530.05 2008.55,1347.2 2010.9,1510.73 2013.25,1386.69 2015.6,1258.91 2017.95,1532.23 2020.3,1387.22 2022.65,1295.72 2025,1412.91 2027.35,1548.28 2029.7,1357.37 2032.05,1307.05 2034.4,1258.75 2036.76,1523.88 2039.11,1470.15 2041.46,1302.42 2043.81,1397.57 2046.16,1520.68 2048.51,1346.98 2050.86,1315.87 2053.21,1255.98 2055.56,1252.85 2057.91,1470.87 2060.26,1408.22 2062.61,1511.01 2064.96,1509.88 2067.31,1447.24 2069.66,1393.83 2072.01,1302.6 2074.36,1210.97 2076.71,1398.45 2079.06,1400.06 2081.41,1537.23 2083.76,1441.09 2086.11,1460.04 2088.47,1480.69 2090.82,1345.91 2093.17,1407.13 2095.52,1559.64 2097.87,1454.9 2100.22,1326.53 2102.57,1411.37 2104.92,1528.82 2107.27,1438.7 2109.62,1436.88 2111.97,1463.48 2114.32,1397.12 2116.67,1751.15 2119.02,1367.42 2121.37,1503.99 2123.72,1468.11 2126.07,1405.27 2128.42,1274.62 2130.77,1386.5 2133.12,1531.98 2135.47,1506.57 2137.83,1447.06 2140.18,1315.43 2142.53,1453.12 2144.88,1368.77 2147.23,1219.26 2149.58,1537.14 2151.93,1379.42 2154.28,1469.18 2156.63,1452 2158.98,1414.66 2161.33,1426.51 2163.68,1300.9 2166.03,1390.25 2168.38,1521.26 2170.73,1380.51 2173.08,1524.31 2175.43,1554.11 2177.78,1408.03 2180.13,1413.85 2182.48,1248.11 2184.83,1479.51 2187.19,1569.24 2189.54,1461.84 2191.89,1408.72 2194.24,1515.65 2196.59,1348.15 2198.94,1346.09 2201.29,1447.98 2203.64,1400.79 2205.99,1473.54 2208.34,1425.5 2210.69,1366.72 2213.04,1476.26 2215.39,1284.66 2217.74,1223.13 2220.09,1273.59 2222.44,1440.96 2224.79,1428.56 2227.14,1450.95 2229.49,1397.19 2231.84,1750.22 2234.19,1321.4 2236.55,1558.91 2238.9,1394.65 2241.25,1518.74 2243.6,1354.14 2245.95,1357.56 2248.3,1320.33 2250.65,1536.66 2253,1297.95 2255.35,1450.78 2257.7,1488.59 2260.05,1460.64 2262.4,1441.1 2264.75,1395.57 2267.1,1329.54 2269.45,1396.66 2271.8,1295.15 2274.15,1385.4 2276.5,1401.25 2278.85,1374.52 2281.2,1491.3 2283.55,1436.26 2285.91,1287.2 2288.26,1425.19 2290.61,1434.18 2292.96,1378.42 2295.31,1280.76 2297.66,1466.98 2300.01,1448.02 2302.36,1346.48 2304.71,1391.32 2307.06,1413.54 2309.41,1497.68 2311.76,1646.8 2314.11,1404.84 2316.46,1531.75 2318.81,1293.29 2321.16,1447.82 2323.51,1666.98 2325.86,1246.58 2328.21,1312.9 2330.56,1580.62 2332.91,1381.47 2335.27,1576.56 2337.62,1496.14 2339.97,1352.2 2342.32,1418.65 2344.67,1316.41 2347.02,1567.24 2349.37,1581.49 2351.72,1275.26 2354.07,1544.56 2356.42,1462.58 2358.77,1459.7 2361.12,1390.99 2363.47,1452.49 2365.82,1427.08 2368.17,1235.04 2370.52,1372.2 2372.87,1517.15 2375.22,1405.21 2377.57,1486.96 2379.92,1418.09 2382.27,1261.04 2384.62,1311.52 2386.98,1446.78 2389.33,1367.3 2391.68,1620.16 2394.03,1466.82 2396.38,1336.5 2398.73,1496.54 2401.08,1376.68 2403.43,1350.39 2405.78,1531.05 2408.13,1282.37 2410.48,1270.36 2412.83,1433.11 2415.18,1516.94 2417.53,1425.25 2419.88,1312.72 2422.23,1223.79 2424.58,1344.93 2426.93,1558.67 2429.28,1364.8 2431.63,1581.72 2433.98,1513.67 2436.34,1319.94 2438.69,1576.17 2441.04,1457.19 2443.39,1578.36 2445.74,1406.22 2448.09,1539.92 2450.44,1297.16 2452.79,1378.44 2455.14,1443.75 2457.49,1412.17 2459.84,1446.19 2462.19,1364.63 2464.54,1637.57 2466.89,1292.93 2469.24,1382.3 2471.59,1371.89 2473.94,1481.86 2476.29,1499.66 2478.64,1336.02 2480.99,1521.85 2483.34,1382.74 2485.7,1442.54 2488.05,1343.69 2490.4,1279.51 2492.75,1407.27 2495.1,1465.75 2497.45,1499.03 2499.8,1125.09 2502.15,1399.77 2504.5,1623.74 2506.85,1409.18 2509.2,1440.52 2511.55,1387.09 2513.9,1412.98 2516.25,1207.46 2518.6,1395.62 2520.95,1216.03 2523.3,1398.58 2525.65,1341.26 2528,1225.29 2530.35,1529.64 2532.7,1333.2 2535.06,1166.58 2537.41,1504.62 2539.76,1385.81 2542.11,1474.04 2544.46,1657.29 2546.81,1673.21 2549.16,1481.17 2551.51,1448.03 2553.86,1637.59 2556.21,1296.14 2558.56,1334.84 2560.91,1435.6 2563.26,1331.75 2565.61,1449.54 2567.96,1350.82 2570.31,1377.56 "></polyline>
<polyline clip-path="url(#clip192)" style="stroke:#e26f46; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,800.55 224.541,829.081 226.891,955.062 229.242,820.968 231.592,743.509 233.943,864.451 236.293,674.869 238.644,954.404 240.994,970.669 243.345,1038.25 245.695,816.427 248.046,840.928 250.396,733.293 252.747,801.885 255.097,995.458 257.448,718.982 259.798,705.25 262.148,908.749 264.499,1012.65 266.849,792.851 269.2,764.7 271.55,921.874 273.901,957.501 276.251,834.566 278.602,836.698 280.952,1018.85 283.303,838.402 285.653,848.981 288.004,904.907 290.354,988.932 292.705,964.803 295.055,825.154 297.406,971.302 299.756,945.224 302.107,833.594 304.457,908.019 306.807,1079.9 309.158,1036.5 311.508,880.842 313.859,1069.71 316.209,823.293 318.56,741.024 320.91,971.595 323.261,803.367 325.611,1025.64 327.962,898.344 330.312,983.566 332.663,830.551 335.013,804.427 337.364,866.857 339.714,796.237 342.065,763.758 344.415,905.565 346.765,926.595 349.116,1003.09 351.466,849.975 353.817,1003.81 356.167,852.166 358.518,788.595 360.868,1051.35 363.219,988.537 365.569,893.044 367.92,810.574 370.27,963.655 372.621,747.563 374.971,783.175 377.322,851.498 379.672,867.454 382.023,1086.3 384.373,942.954 386.724,1050.17 389.074,1069.03 391.424,926.013 393.775,1086.6 396.125,1046.98 398.476,909.963 400.826,746.545 403.177,989.672 405.527,774.061 407.878,798.837 410.228,865.396 412.579,972.806 414.929,962.676 417.28,956.527 419.63,790.973 421.981,861.583 424.331,897.341 426.682,877.735 429.032,928.519 431.382,931.254 433.733,784.762 436.083,948.149 438.434,942.887 440.784,869.109 443.135,796.929 445.485,932.437 447.836,1020.91 450.186,919.49 452.537,808.791 454.887,778.996 457.238,921.231 459.588,826.425 461.939,1093.51 464.289,1092.98 466.64,865.429 468.99,932.082 471.341,766.63 473.691,805.477 476.041,824.435 478.392,788.461 480.742,929.776 483.093,1124.11 485.443,790.054 487.794,943.884 490.144,1050.16 492.495,924.491 494.845,917.604 497.196,924.075 499.546,934.401 501.897,931.504 504.247,943.592 506.598,906.052 508.948,888.14 511.299,958.341 513.649,935.11 515.999,829.419 518.35,921.142 520.7,881.06 523.051,963.02 525.401,932.461 527.752,948.514 530.102,860.79 532.453,1083.33 534.803,1066.94 537.154,950.64 539.504,745.961 541.855,910.753 544.205,783.434 546.556,926.2 548.906,1062.08 551.257,950.437 553.607,875.471 555.958,784.049 558.308,873.629 560.658,1197.16 563.009,753.516 565.359,937.59 567.71,810.032 570.06,909.579 572.411,960.248 574.761,950.488 577.112,1003 579.462,751.209 581.813,792.91 584.163,1074.76 586.514,842.047 588.864,690.552 591.215,1115.72 593.565,855.106 595.916,884.075 598.266,955.921 600.616,944.532 602.967,803.865 605.317,933.455 607.668,800.758 610.018,1057.15 612.369,802.397 614.719,974.906 617.07,946.904 619.42,986.751 621.771,944.582 624.121,773.986 626.472,878.606 628.822,879.674 631.173,921.656 633.523,895.91 635.874,957.735 638.224,886.764 640.575,861.345 642.925,1026.37 645.275,941.454 647.626,1058.01 649.976,821.909 652.327,874.06 654.677,914.029 657.028,973.729 659.378,743.187 661.729,995.343 664.079,1076.64 666.43,1004.84 668.78,878.341 671.131,891.918 673.481,983.698 675.832,954.339 678.182,852.687 680.533,829.045 682.883,949.007 685.233,874.472 687.584,758.279 689.934,866.146 692.285,786.959 694.635,931.58 696.986,863.027 699.336,1057.03 701.687,770.288 704.037,839.477 706.388,866.16 708.738,828.331 711.089,910.844 713.439,972.146 715.79,1024.86 718.14,1063.09 720.491,840.425 722.841,784.555 725.192,1087.1 727.542,844.777 729.892,888.28 732.243,1010.37 734.593,920.449 736.944,969.892 739.294,910.812 741.645,867.243 743.995,858.117 746.346,871.878 748.696,985.942 751.047,1023.32 753.397,833.564 755.748,1096.02 758.098,892.909 760.449,818.507 762.799,845.248 765.15,981.372 767.5,967.963 769.85,1065.99 772.201,810.843 774.551,1055.05 776.902,1034.14 779.252,1063.76 781.603,904.141 783.953,879.542 786.304,885.635 788.654,945.843 791.005,993.142 793.355,957.65 795.706,836.204 798.056,1046.21 800.407,917.855 802.757,970.04 805.108,814.446 807.458,849.014 809.809,972.301 812.159,1007.77 814.509,853.322 816.86,887.508 819.21,1046.94 821.561,959.974 823.911,804.343 826.262,857.019 828.612,1029.88 830.963,839.388 833.313,697.957 835.664,922.819 838.014,1055.18 840.365,765.627 842.715,938.476 845.066,759.425 847.416,810.926 849.767,1045.32 852.117,961.218 854.467,947.172 856.818,857.329 859.168,783.181 861.519,782.242 863.869,983.953 866.22,1032.83 868.57,932.689 870.921,985.996 873.271,706.828 875.622,1099.21 877.972,805.297 880.323,1034.4 882.673,904.946 885.024,954.903 887.374,774.67 889.725,897.472 892.075,880.98 894.426,690.201 896.776,663.148 899.126,811.912 901.477,851.676 903.827,870.733 906.178,984.009 908.528,974.466 910.879,963.981 913.229,810.102 915.58,985.721 917.93,791.077 920.281,880.991 922.631,884.492 924.982,970.275 927.332,832.741 929.683,630.023 932.033,966.439 934.384,918.413 936.734,1018.99 939.084,1080.73 941.435,983.479 943.785,980.664 946.136,850.066 948.486,793.825 950.837,844.157 953.187,649.697 955.538,690.013 957.888,912.809 960.239,900.923 962.589,908.649 964.94,1163.12 967.29,1154.84 969.641,759.026 971.991,962.512 974.342,877.944 976.692,915.724 979.043,744.966 981.393,858.543 983.743,973.921 986.094,880.485 988.444,906.933 990.795,942.275 993.145,828.005 995.496,1176.73 997.846,959.278 1000.2,894.826 1002.55,857.834 1004.9,876.242 1007.25,788.054 1009.6,948.411 1011.95,741.589 1014.3,955.823 1016.65,853.889 1019,904.165 1021.35,810.089 1023.7,1100.32 1026.05,858.24 1028.4,791.185 1030.75,987.126 1033.1,721.968 1035.45,868.108 1037.8,812.727 1040.15,848.097 1042.51,738.99 1044.86,925.212 1047.21,836.624 1049.56,829.155 1051.91,954.125 1054.26,919.687 1056.61,869.26 1058.96,1173.81 1061.31,944.382 1063.66,828.111 1066.01,950.466 1068.36,988.224 1070.71,838.539 1073.06,999.424 1075.41,880.664 1077.76,1047.92 1080.11,762.886 1082.46,1113.57 1084.81,836.164 1087.16,965.375 1089.51,975.734 1091.87,970.126 1094.22,973.437 1096.57,634.314 1098.92,1044.06 1101.27,659.512 1103.62,967.884 1105.97,924.896 1108.32,941.734 1110.67,845.844 1113.02,911.551 1115.37,1001.7 1117.72,1062.37 1120.07,915.989 1122.42,1026.89 1124.77,842.451 1127.12,767.462 1129.47,873.644 1131.82,773.933 1134.17,783.626 1136.52,1014.48 1138.87,962.979 1141.23,1065.54 1143.58,1058.43 1145.93,933.842 1148.28,802.894 1150.63,829.887 1152.98,1005.83 1155.33,949.855 1157.68,829.774 1160.03,820.653 1162.38,800.968 1164.73,977.519 1167.08,1012.36 1169.43,993.167 1171.78,1099.77 1174.13,1004.99 1176.48,825.714 1178.83,998.608 1181.18,1049.17 1183.53,890.416 1185.88,936.626 1188.23,1019.14 1190.59,853.924 1192.94,888.553 1195.29,864.04 1197.64,969.644 1199.99,788.906 1202.34,808.096 1204.69,942.696 1207.04,1067.89 1209.39,892.29 1211.74,868.599 1214.09,809.017 1216.44,879.32 1218.79,954.968 1221.14,885.17 1223.49,751.409 1225.84,738.95 1228.19,996.89 1230.54,777.052 1232.89,900.15 1235.24,843.074 1237.59,976.365 1239.94,1037.54 1242.3,902.416 1244.65,905.279 1247,824.69 1249.35,1000.63 1251.7,884.371 1254.05,831.852 1256.4,907.845 1258.75,971.182 1261.1,972.113 1263.45,771.838 1265.8,894.393 1268.15,850.795 1270.5,899.737 1272.85,797.579 1275.2,857.433 1277.55,1060.44 1279.9,866.815 1282.25,735.063 1284.6,992.392 1286.95,1064.58 1289.3,1002.18 1291.66,826.816 1294.01,1122.56 1296.36,1039.79 1298.71,774.794 1301.06,903.984 1303.41,860.986 1305.76,956.075 1308.11,981.923 1310.46,969.295 1312.81,776.914 1315.16,905.326 1317.51,895.532 1319.86,1019.14 1322.21,740.186 1324.56,736.039 1326.91,928.844 1329.26,812.003 1331.61,909.732 1333.96,860.446 1336.31,996.068 1338.66,989.42 1341.02,768.964 1343.37,1066.94 1345.72,1110.01 1348.07,921.837 1350.42,878.962 1352.77,908.31 1355.12,804.786 1357.47,927.08 1359.82,978.769 1362.17,782.801 1364.52,776.311 1366.87,913.008 1369.22,780.422 1371.57,782.577 1373.92,1081.77 1376.27,880.318 1378.62,1147.75 1380.97,835.286 1383.32,955.391 1385.67,705.71 1388.02,684.826 1390.38,873.09 1392.73,1097.49 1395.08,955.818 1397.43,861.573 1399.78,819.456 1402.13,886.135 1404.48,693.22 1406.83,752.129 1409.18,995.114 1411.53,825.465 1413.88,881.762 1416.23,777.166 1418.58,919.594 1420.93,1000.62 1423.28,958.292 1425.63,822.524 1427.98,793.745 1430.33,863.226 1432.68,927.704 1435.03,854.057 1437.38,912 1439.74,849.219 1442.09,799.116 1444.44,746.26 1446.79,1040.46 1449.14,965.083 1451.49,1044.34 1453.84,878.626 1456.19,897.84 1458.54,889.296 1460.89,860.296 1463.24,966.748 1465.59,613.351 1467.94,846.738 1470.29,819.832 1472.64,1053.22 1474.99,922.522 1477.34,846.392 1479.69,982.069 1482.04,1026.25 1484.39,894.719 1486.74,934.992 1489.1,865.37 1491.45,1005.08 1493.8,760.156 1496.15,1000.65 1498.5,863.537 1500.85,961.44 1503.2,992.114 1505.55,1073.61 1507.9,905.942 1510.25,862.796 1512.6,1032.86 1514.95,805.059 1517.3,1030.34 1519.65,741.699 1522,802.811 1524.35,790.58 1526.7,977.978 1529.05,1107.37 1531.4,1055.73 1533.75,827.928 1536.1,889.194 1538.45,1022.95 1540.81,1126.96 1543.16,854.058 1545.51,795.129 1547.86,822.829 1550.21,772.059 1552.56,835.133 1554.91,1025.61 1557.26,909.183 1559.61,926.999 1561.96,940.856 1564.31,1018.43 1566.66,814.695 1569.01,798.79 1571.36,851.871 1573.71,967.382 1576.06,917.759 1578.41,756.227 1580.76,847.82 1583.11,788.88 1585.46,892.582 1587.81,750.347 1590.17,828.594 1592.52,1007.95 1594.87,967.516 1597.22,969.773 1599.57,799.938 1601.92,930.767 1604.27,855.993 1606.62,898.433 1608.97,675.989 1611.32,958.611 1613.67,1042.88 1616.02,959.211 1618.37,893.455 1620.72,1090.15 1623.07,777.635 1625.42,931.196 1627.77,983.75 1630.12,715.043 1632.47,810.373 1634.82,858.896 1637.17,1059.91 1639.53,1082.24 1641.88,1001.63 1644.23,801.072 1646.58,941.411 1648.93,841.772 1651.28,933.027 1653.63,1041.52 1655.98,869.532 1658.33,926.421 1660.68,809.761 1663.03,878.358 1665.38,878.935 1667.73,969.958 1670.08,960.046 1672.43,795.94 1674.78,949.603 1677.13,718.812 1679.48,902.679 1681.83,1006.87 1684.18,796.032 1686.53,824.904 1688.89,855.966 1691.24,801.562 1693.59,901.726 1695.94,920.285 1698.29,999.152 1700.64,1119.52 1702.99,942.272 1705.34,1034.59 1707.69,903.429 1710.04,881.193 1712.39,953.069 1714.74,1144.15 1717.09,863.711 1719.44,770.418 1721.79,839.248 1724.14,958.831 1726.49,965.839 1728.84,1151.84 1731.19,917.206 1733.54,944.015 1735.89,730.669 1738.25,813.221 1740.6,852.541 1742.95,851.072 1745.3,958.036 1747.65,894.014 1750,1111.32 1752.35,1109.69 1754.7,1239.83 1757.05,912.18 1759.4,845.824 1761.75,825.453 1764.1,852.816 1766.45,843.445 1768.8,867.003 1771.15,926.472 1773.5,1062.13 1775.85,749.753 1778.2,967.999 1780.55,1064.89 1782.9,781.224 1785.25,858.132 1787.6,717.492 1789.96,894.033 1792.31,957.582 1794.66,955.421 1797.01,965.929 1799.36,975.965 1801.71,843.324 1804.06,1014.5 1806.41,869.174 1808.76,872.014 1811.11,972.278 1813.46,905.497 1815.81,872.404 1818.16,791.779 1820.51,908.626 1822.86,876.992 1825.21,751.197 1827.56,916.324 1829.91,941.857 1832.26,943.625 1834.61,917.661 1836.96,803.672 1839.32,800.06 1841.67,879.091 1844.02,837.414 1846.37,932.66 1848.72,948.502 1851.07,855.276 1853.42,892.318 1855.77,1077.84 1858.12,1031.91 1860.47,766.558 1862.82,717.395 1865.17,1097.01 1867.52,787.59 1869.87,941.093 1872.22,830.658 1874.57,795.738 1876.92,894.24 1879.27,983.857 1881.62,936.543 1883.97,1092.22 1886.32,805.167 1888.68,948.793 1891.03,874.373 1893.38,711.413 1895.73,785.059 1898.08,1043.88 1900.43,930.552 1902.78,831.051 1905.13,960.415 1907.48,802.159 1909.83,887.884 1912.18,889.882 1914.53,825.496 1916.88,865.365 1919.23,819.506 1921.58,713.642 1923.93,921.79 1926.28,1010.88 1928.63,915.869 1930.98,968.127 1933.33,854.703 1935.68,1059.18 1938.04,1057.06 1940.39,879.195 1942.74,968.422 1945.09,979.394 1947.44,828.875 1949.79,957.609 1952.14,876.451 1954.49,963.872 1956.84,1002.56 1959.19,987.089 1961.54,914.991 1963.89,781.671 1966.24,889.703 1968.59,901.605 1970.94,879.828 1973.29,1073.49 1975.64,850.211 1977.99,859.119 1980.34,990.082 1982.69,1002.3 1985.04,920.415 1987.4,1052.19 1989.75,989.55 1992.1,987.303 1994.45,961.462 1996.8,877.424 1999.15,909.092 2001.5,1235.7 2003.85,945.036 2006.2,728.851 2008.55,925.259 2010.9,862.825 2013.25,942.203 2015.6,824.218 2017.95,893.626 2020.3,848.358 2022.65,978.977 2025,852.481 2027.35,781.825 2029.7,753.25 2032.05,757.791 2034.4,1146.82 2036.76,898.684 2039.11,881.099 2041.46,973.042 2043.81,908.561 2046.16,945.414 2048.51,1046.14 2050.86,1036.72 2053.21,915.486 2055.56,885.077 2057.91,928.035 2060.26,971.073 2062.61,819.919 2064.96,889.025 2067.31,1107.79 2069.66,921.837 2072.01,799.5 2074.36,892.584 2076.71,933.381 2079.06,967.884 2081.41,1005.28 2083.76,913.994 2086.11,943.267 2088.47,958.269 2090.82,951.853 2093.17,888.003 2095.52,1035.96 2097.87,1013.66 2100.22,956.397 2102.57,896.737 2104.92,1009.15 2107.27,790.443 2109.62,837.934 2111.97,1006.23 2114.32,935.462 2116.67,839.234 2119.02,923.511 2121.37,1043.77 2123.72,972.36 2126.07,908.568 2128.42,969.339 2130.77,1022.52 2133.12,777.548 2135.47,852.971 2137.83,833.808 2140.18,753.681 2142.53,976.495 2144.88,826.615 2147.23,1064.69 2149.58,1033.46 2151.93,709.703 2154.28,950.297 2156.63,908.773 2158.98,906.1 2161.33,810.167 2163.68,862.139 2166.03,1063.13 2168.38,610.585 2170.73,973.888 2173.08,986.588 2175.43,979.686 2177.78,820.594 2180.13,863.696 2182.48,903.149 2184.83,1056.6 2187.19,996.502 2189.54,774.2 2191.89,792.987 2194.24,1067.3 2196.59,903.526 2198.94,879.375 2201.29,849.501 2203.64,1176.71 2205.99,862.639 2208.34,867.037 2210.69,994.593 2213.04,894.906 2215.39,954.004 2217.74,841.329 2220.09,810.867 2222.44,966.251 2224.79,903.901 2227.14,985.198 2229.49,807.184 2231.84,936.346 2234.19,789.306 2236.55,884.704 2238.9,859.8 2241.25,848.934 2243.6,970.771 2245.95,806.985 2248.3,787.46 2250.65,1041.28 2253,1040.15 2255.35,926.433 2257.7,790.809 2260.05,961.084 2262.4,908.549 2264.75,1005.38 2267.1,880.118 2269.45,837.7 2271.8,978.368 2274.15,807.832 2276.5,603.63 2278.85,958.118 2281.2,1048.34 2283.55,762.592 2285.91,916.462 2288.26,991.291 2290.61,912.864 2292.96,957.951 2295.31,935.406 2297.66,901.055 2300.01,851.539 2302.36,792.376 2304.71,1048.93 2307.06,766.483 2309.41,911.574 2311.76,991.229 2314.11,924.03 2316.46,1061.96 2318.81,812.199 2321.16,1027.17 2323.51,852.882 2325.86,1048.36 2328.21,947.095 2330.56,969.886 2332.91,753.634 2335.27,876.439 2337.62,906.846 2339.97,861.485 2342.32,979.308 2344.67,768.675 2347.02,626.722 2349.37,1067.27 2351.72,891.288 2354.07,990.193 2356.42,723.797 2358.77,959.803 2361.12,1025.47 2363.47,941.948 2365.82,903.884 2368.17,976.727 2370.52,852.648 2372.87,856.638 2375.22,680.951 2377.57,915.774 2379.92,1037.82 2382.27,993.98 2384.62,890.847 2386.98,865.93 2389.33,949.467 2391.68,651.411 2394.03,1121.71 2396.38,909.118 2398.73,819.233 2401.08,1033.32 2403.43,897.092 2405.78,863.085 2408.13,804.987 2410.48,796.8 2412.83,735.241 2415.18,812.286 2417.53,989.751 2419.88,873.377 2422.23,857.361 2424.58,863.945 2426.93,885.492 2429.28,1119.32 2431.63,951.869 2433.98,783.126 2436.34,934.908 2438.69,767.068 2441.04,1048.51 2443.39,923.582 2445.74,619.247 2448.09,938.973 2450.44,1074.28 2452.79,1040.21 2455.14,1023.15 2457.49,1070.92 2459.84,797.4 2462.19,793.126 2464.54,1000.96 2466.89,720.842 2469.24,1001.36 2471.59,699.602 2473.94,832.404 2476.29,930.671 2478.64,935.844 2480.99,822.328 2483.34,898.133 2485.7,1099.14 2488.05,825.612 2490.4,852.765 2492.75,786.272 2495.1,792.894 2497.45,898.297 2499.8,1003.91 2502.15,896.657 2504.5,783.792 2506.85,807.932 2509.2,982.609 2511.55,778.25 2513.9,904.514 2516.25,836.966 2518.6,939.826 2520.95,1183.21 2523.3,754.608 2525.65,715.871 2528,584.736 2530.35,990.245 2532.7,999.842 2535.06,824.829 2537.41,974.537 2539.76,809.716 2542.11,946.067 2544.46,920.847 2546.81,975.085 2549.16,837.134 2551.51,814.762 2553.86,865.555 2556.21,844.251 2558.56,881.527 2560.91,836.386 2563.26,1035.63 2565.61,933.014 2567.96,811.28 2570.31,1066.59 "></polyline>
<polyline clip-path="url(#clip192)" style="stroke:#3da44d; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,547.844 224.541,354.68 226.891,384.505 229.242,330.191 231.592,292.48 233.943,482.205 236.293,507.917 238.644,564.512 240.994,418.891 243.345,480.333 245.695,344.523 248.046,365.175 250.396,278.07 252.747,317.259 255.097,344.906 257.448,318.73 259.798,319.609 262.148,464.314 264.499,203.087 266.849,203.958 269.2,357.713 271.55,422.84 273.901,446.845 276.251,286.921 278.602,380.52 280.952,500.879 283.303,273.516 285.653,321.255 288.004,375.914 290.354,406.011 292.705,370.885 295.055,424.821 297.406,348.912 299.756,428.338 302.107,466.12 304.457,618.525 306.807,482.597 309.158,397.374 311.508,212.244 313.859,505.996 316.209,399.832 318.56,465.419 320.91,354.66 323.261,521.411 325.611,475.734 327.962,275.811 330.312,391.434 332.663,347.991 335.013,325.534 337.364,444.154 339.714,448.529 342.065,345.485 344.415,282.17 346.765,579.787 349.116,358.495 351.466,348.732 353.817,444.781 356.167,492.632 358.518,405.312 360.868,434.1 363.219,525.036 365.569,459.47 367.92,392.61 370.27,552.797 372.621,498.826 374.971,526.59 377.322,279.185 379.672,355.059 382.023,269.222 384.373,320.385 386.724,459.349 389.074,437.404 391.424,373.962 393.775,375.752 396.125,468.687 398.476,479.16 400.826,527.73 403.177,345.547 405.527,257.019 407.878,332.015 410.228,439.793 412.579,412.061 414.929,339.998 417.28,550.261 419.63,499.764 421.981,264.422 424.331,504.222 426.682,425.401 429.032,341.756 431.382,349.222 433.733,451.63 436.083,333.599 438.434,328.949 440.784,272.635 443.135,395.246 445.485,421.644 447.836,383.667 450.186,340.202 452.537,308.604 454.887,448.044 457.238,458.955 459.588,514.216 461.939,397.767 464.289,353.806 466.64,325.998 468.99,204.699 471.341,549.574 473.691,437.982 476.041,403.18 478.392,516.295 480.742,421.405 483.093,436.846 485.443,504.296 487.794,354.85 490.144,389.755 492.495,327.635 494.845,444.134 497.196,439.063 499.546,353.302 501.897,409.952 504.247,281.561 506.598,291.427 508.948,272.754 511.299,333.761 513.649,341.89 515.999,471.239 518.35,389.7 520.7,387.026 523.051,318.129 525.401,505.8 527.752,544.857 530.102,342.931 532.453,346.465 534.803,616.394 537.154,355.847 539.504,334.157 541.855,465.813 544.205,273.075 546.556,257.648 548.906,259.302 551.257,471.597 553.607,288.844 555.958,518.203 558.308,311.194 560.658,233.86 563.009,448.474 565.359,339.197 567.71,636.276 570.06,379.158 572.411,429.092 574.761,183.622 577.112,396.628 579.462,370.796 581.813,274.214 584.163,416.531 586.514,240.997 588.864,481.772 591.215,323.901 593.565,297.293 595.916,191.33 598.266,352.606 600.616,493.693 602.967,425.089 605.317,516.194 607.668,568.026 610.018,339.854 612.369,370.55 614.719,421.745 617.07,470.973 619.42,322.487 621.771,237.21 624.121,478.951 626.472,357.859 628.822,467.768 631.173,405.753 633.523,318.899 635.874,416.575 638.224,423.133 640.575,348.474 642.925,279.142 645.275,393.665 647.626,510.776 649.976,442.01 652.327,290.929 654.677,459.642 657.028,406.138 659.378,325.552 661.729,407.744 664.079,285.485 666.43,211.97 668.78,548.497 671.131,585.409 673.481,267.626 675.832,432.301 678.182,380.105 680.533,267.071 682.883,266.672 685.233,159.337 687.584,277.401 689.934,356.54 692.285,286.31 694.635,204.001 696.986,340.593 699.336,345.345 701.687,259.705 704.037,413.323 706.388,547.555 708.738,471.383 711.089,238.503 713.439,218.367 715.79,623.538 718.14,473.379 720.491,371.799 722.841,185.226 725.192,566.402 727.542,338.911 729.892,140.196 732.243,183.616 734.593,492.213 736.944,387.026 739.294,458.9 741.645,327.224 743.995,346.618 746.346,306.219 748.696,372.932 751.047,280.691 753.397,273.878 755.748,409.58 758.098,483.293 760.449,191.96 762.799,512.767 765.15,526.274 767.5,387.468 769.85,457.088 772.201,550.078 774.551,388.279 776.902,429.675 779.252,350.653 781.603,276.69 783.953,365.615 786.304,274.319 788.654,317.623 791.005,471.086 793.355,408.757 795.706,368.424 798.056,414.615 800.407,357.889 802.757,411.166 805.108,435.677 807.458,349.699 809.809,330.943 812.159,298.362 814.509,380.249 816.86,416.979 819.21,346.646 821.561,441.513 823.911,518.958 826.262,364.988 828.612,327.95 830.963,168.073 833.313,335.87 835.664,458.42 838.014,309.6 840.365,284.018 842.715,386.827 845.066,349.406 847.416,197.412 849.767,331.102 852.117,470.331 854.467,559.681 856.818,332.447 859.168,285.775 861.519,445.602 863.869,454.407 866.22,470.118 868.57,403.88 870.921,409.179 873.271,296.438 875.622,298.23 877.972,563.309 880.323,314.628 882.673,408.997 885.024,424.442 887.374,447.151 889.725,395.437 892.075,268.004 894.426,278.373 896.776,272.1 899.126,254.942 901.477,378.944 903.827,437.313 906.178,470.011 908.528,425.908 910.879,523.012 913.229,364.176 915.58,542.426 917.93,562.746 920.281,108.849 922.631,519.503 924.982,393.426 927.332,441.71 929.683,391.603 932.033,360.048 934.384,411.954 936.734,454.108 939.084,444.336 941.435,356.353 943.785,407.847 946.136,432.148 948.486,170.812 950.837,166.192 953.187,384.591 955.538,405.203 957.888,626.178 960.239,296.9 962.589,244.595 964.94,380.441 967.29,340.693 969.641,255.802 971.991,389.631 974.342,324.895 976.692,379.868 979.043,450.909 981.393,609.972 983.743,353.381 986.094,439.085 988.444,253.792 990.795,362.802 993.145,255.323 995.496,406.918 997.846,450.822 1000.2,447.362 1002.55,349.313 1004.9,287.833 1007.25,436.013 1009.6,430.973 1011.95,329.045 1014.3,421.014 1016.65,451.727 1019,642.691 1021.35,326.394 1023.7,313.541 1026.05,415.69 1028.4,443.274 1030.75,370.055 1033.1,311.301 1035.45,419.902 1037.8,375.916 1040.15,353.984 1042.51,409.637 1044.86,422.586 1047.21,303.604 1049.56,438.615 1051.91,209.006 1054.26,469.166 1056.61,452.269 1058.96,358.302 1061.31,385.752 1063.66,564.593 1066.01,621.853 1068.36,416.949 1070.71,385.618 1073.06,214.236 1075.41,295.23 1077.76,273.604 1080.11,455.979 1082.46,417.692 1084.81,376.534 1087.16,366.553 1089.51,543.85 1091.87,317.532 1094.22,375.384 1096.57,487.143 1098.92,226.032 1101.27,339.787 1103.62,280.183 1105.97,150.638 1108.32,378.752 1110.67,195.986 1113.02,318.704 1115.37,419.947 1117.72,463.418 1120.07,407.091 1122.42,482.793 1124.77,392.384 1127.12,558.766 1129.47,498.82 1131.82,451.087 1134.17,249.504 1136.52,429.082 1138.87,157.487 1141.23,473.428 1143.58,331.675 1145.93,385.182 1148.28,473.909 1150.63,403.071 1152.98,375.156 1155.33,404.287 1157.68,304.376 1160.03,357.456 1162.38,96.8724 1164.73,578.254 1167.08,345.515 1169.43,444.106 1171.78,386.246 1174.13,454.849 1176.48,470.656 1178.83,186.545 1181.18,435.158 1183.53,412.501 1185.88,341.498 1188.23,407.046 1190.59,118.122 1192.94,381.736 1195.29,611.234 1197.64,463.199 1199.99,268.466 1202.34,512.737 1204.69,695.798 1207.04,293.369 1209.39,330.396 1211.74,440.149 1214.09,327.455 1216.44,401.823 1218.79,230.245 1221.14,521.752 1223.49,317.969 1225.84,464.65 1228.19,546.032 1230.54,490.656 1232.89,453.882 1235.24,356.408 1237.59,383.542 1239.94,368.945 1242.3,494.371 1244.65,413.994 1247,282.798 1249.35,441.506 1251.7,432.305 1254.05,395.547 1256.4,591.569 1258.75,272.114 1261.1,375.131 1263.45,345.007 1265.8,497.181 1268.15,409.939 1270.5,483.304 1272.85,288.863 1275.2,554.231 1277.55,403.757 1279.9,417.918 1282.25,350.794 1284.6,436.951 1286.95,309.223 1289.3,319.311 1291.66,476.136 1294.01,480.262 1296.36,238.665 1298.71,197.711 1301.06,433.342 1303.41,387.438 1305.76,377.446 1308.11,375.418 1310.46,277.066 1312.81,375.902 1315.16,525.032 1317.51,219.535 1319.86,464.871 1322.21,470.771 1324.56,363.447 1326.91,350.819 1329.26,414.808 1331.61,352.021 1333.96,516.491 1336.31,430.29 1338.66,245.278 1341.02,490.162 1343.37,371.61 1345.72,364.527 1348.07,354.158 1350.42,616.271 1352.77,236.411 1355.12,429.173 1357.47,454.901 1359.82,239.131 1362.17,515.167 1364.52,243.81 1366.87,412.256 1369.22,363.429 1371.57,400.544 1373.92,447.412 1376.27,304.425 1378.62,350.286 1380.97,273.376 1383.32,309.478 1385.67,271.238 1388.02,428.744 1390.38,388.013 1392.73,565.676 1395.08,437.333 1397.43,363.031 1399.78,456.33 1402.13,315.992 1404.48,291.999 1406.83,271.164 1409.18,342.666 1411.53,356.386 1413.88,400.399 1416.23,348.157 1418.58,483.481 1420.93,405.097 1423.28,384.771 1425.63,243.591 1427.98,241.308 1430.33,340.687 1432.68,419.234 1435.03,302.019 1437.38,223.985 1439.74,475.963 1442.09,432.438 1444.44,105.777 1446.79,368.43 1449.14,389.277 1451.49,414.571 1453.84,369.593 1456.19,262.065 1458.54,622.177 1460.89,394.545 1463.24,419.826 1465.59,435.816 1467.94,320.028 1470.29,392.67 1472.64,305.589 1474.99,499.086 1477.34,457.072 1479.69,424.685 1482.04,529.646 1484.39,282.489 1486.74,442.368 1489.1,573.231 1491.45,456.594 1493.8,534.951 1496.15,348.22 1498.5,440.796 1500.85,338.488 1503.2,324.432 1505.55,519.82 1507.9,379.795 1510.25,277.537 1512.6,335.613 1514.95,491.779 1517.3,342.245 1519.65,249.174 1522,339.903 1524.35,336.337 1526.7,519.798 1529.05,399.704 1531.4,362.954 1533.75,484.306 1536.1,403.08 1538.45,289.185 1540.81,463.246 1543.16,380.005 1545.51,195.964 1547.86,447.847 1550.21,459.25 1552.56,283.876 1554.91,376.185 1557.26,529.113 1559.61,499.031 1561.96,380.467 1564.31,269.448 1566.66,227.215 1569.01,321.104 1571.36,362.83 1573.71,270.78 1576.06,478.729 1578.41,462.367 1580.76,378.365 1583.11,511.671 1585.46,424.258 1587.81,292.745 1590.17,524.503 1592.52,333.407 1594.87,370.357 1597.22,473.547 1599.57,467.036 1601.92,324.393 1604.27,456.924 1606.62,282.325 1608.97,352.682 1611.32,544.525 1613.67,480.932 1616.02,288.068 1618.37,219.789 1620.72,105.062 1623.07,324.803 1625.42,274.072 1627.77,346.797 1630.12,337.988 1632.47,382.391 1634.82,142.968 1637.17,350.811 1639.53,494.841 1641.88,339.749 1644.23,384.387 1646.58,381.067 1648.93,307.214 1651.28,395.628 1653.63,333.241 1655.98,366.354 1658.33,154.661 1660.68,370.922 1663.03,169.999 1665.38,319.012 1667.73,455.706 1670.08,558.664 1672.43,555.068 1674.78,451.945 1677.13,350.39 1679.48,393.186 1681.83,257.039 1684.18,370.753 1686.53,313.877 1688.89,304.692 1691.24,274.351 1693.59,486.368 1695.94,318.608 1698.29,446.025 1700.64,642.675 1702.99,376.474 1705.34,496.172 1707.69,502.404 1710.04,382.433 1712.39,208.272 1714.74,267.631 1717.09,459.136 1719.44,497.188 1721.79,241.775 1724.14,366.79 1726.49,356.753 1728.84,234.008 1731.19,389.127 1733.54,251.884 1735.89,404.468 1738.25,501.428 1740.6,247.831 1742.95,429.557 1745.3,403.877 1747.65,405.821 1750,303.838 1752.35,273.904 1754.7,552.273 1757.05,431.263 1759.4,375.728 1761.75,302.046 1764.1,429.139 1766.45,340.729 1768.8,437.223 1771.15,462.371 1773.5,261.115 1775.85,175.1 1778.2,358.169 1780.55,370.355 1782.9,318.626 1785.25,355.238 1787.6,566.784 1789.96,311.081 1792.31,325.974 1794.66,338.739 1797.01,493.604 1799.36,371.035 1801.71,425.792 1804.06,312.456 1806.41,353.07 1808.76,468.618 1811.11,278.105 1813.46,362.118 1815.81,610.555 1818.16,519.42 1820.51,332.57 1822.86,392.325 1825.21,419.436 1827.56,237.513 1829.91,305.276 1832.26,430.91 1834.61,314.724 1836.96,159.711 1839.32,524.528 1841.67,491.324 1844.02,562.111 1846.37,447.16 1848.72,188.588 1851.07,365.297 1853.42,443.008 1855.77,431.886 1858.12,458.703 1860.47,560.697 1862.82,376.879 1865.17,216.507 1867.52,372.175 1869.87,473.01 1872.22,433.601 1874.57,388.629 1876.92,329.239 1879.27,578.298 1881.62,431.096 1883.97,458.033 1886.32,458.297 1888.68,300.143 1891.03,390.319 1893.38,504.98 1895.73,174.942 1898.08,397.432 1900.43,482.089 1902.78,430.967 1905.13,290.308 1907.48,313.285 1909.83,390.305 1912.18,360.713 1914.53,488.023 1916.88,439.21 1919.23,315.851 1921.58,696.91 1923.93,450.661 1926.28,297.187 1928.63,516.623 1930.98,280.124 1933.33,478.9 1935.68,246.702 1938.04,505.547 1940.39,528.562 1942.74,116.011 1945.09,226.666 1947.44,571.469 1949.79,261.165 1952.14,397.363 1954.49,566.787 1956.84,557.07 1959.19,314.086 1961.54,471.183 1963.89,555.892 1966.24,375.092 1968.59,498.615 1970.94,436.103 1973.29,462.085 1975.64,109.601 1977.99,478.588 1980.34,273.505 1982.69,401.924 1985.04,612.315 1987.4,350.617 1989.75,442.832 1992.1,493.418 1994.45,409.669 1996.8,303.02 1999.15,441.664 2001.5,361.87 2003.85,416.396 2006.2,272.623 2008.55,314.241 2010.9,489.564 2013.25,370.408 2015.6,433.253 2017.95,265.115 2020.3,365.429 2022.65,465.706 2025,467.07 2027.35,287.85 2029.7,349.595 2032.05,226.415 2034.4,388.475 2036.76,310.633 2039.11,212.575 2041.46,619.475 2043.81,319.832 2046.16,366.303 2048.51,330.791 2050.86,257.639 2053.21,342.893 2055.56,259.341 2057.91,355.677 2060.26,345.125 2062.61,353.718 2064.96,259.003 2067.31,373.887 2069.66,404.081 2072.01,237.196 2074.36,395.07 2076.71,511.19 2079.06,413.265 2081.41,408.2 2083.76,473.581 2086.11,281.112 2088.47,417.023 2090.82,312.681 2093.17,354.67 2095.52,390.41 2097.87,330.469 2100.22,501.392 2102.57,539.705 2104.92,265.05 2107.27,338.433 2109.62,299.995 2111.97,268.337 2114.32,343.505 2116.67,434.155 2119.02,387.512 2121.37,602.32 2123.72,354.862 2126.07,675.306 2128.42,381.26 2130.77,341.276 2133.12,357.244 2135.47,293.972 2137.83,491.453 2140.18,530.679 2142.53,234.776 2144.88,328.775 2147.23,571.932 2149.58,509.34 2151.93,338.027 2154.28,545.853 2156.63,324.651 2158.98,612.385 2161.33,293.423 2163.68,401.312 2166.03,472.162 2168.38,499.854 2170.73,521.916 2173.08,205.055 2175.43,323.497 2177.78,391.56 2180.13,440 2182.48,339.96 2184.83,551.376 2187.19,291.759 2189.54,302.509 2191.89,493.471 2194.24,398.942 2196.59,372.565 2198.94,416.128 2201.29,450.636 2203.64,470.289 2205.99,370.682 2208.34,471.737 2210.69,419.491 2213.04,296.702 2215.39,448.593 2217.74,370.783 2220.09,353.154 2222.44,403.444 2224.79,478.821 2227.14,325.474 2229.49,541.671 2231.84,603.236 2234.19,375.015 2236.55,667.214 2238.9,209.069 2241.25,259.029 2243.6,108.98 2245.95,579.021 2248.3,346.687 2250.65,539.977 2253,385.796 2255.35,167.191 2257.7,356.242 2260.05,510.021 2262.4,473.851 2264.75,387.59 2267.1,345.404 2269.45,216.291 2271.8,353.238 2274.15,170.592 2276.5,478.99 2278.85,432.87 2281.2,402.87 2283.55,555.145 2285.91,383.533 2288.26,373.959 2290.61,331.8 2292.96,492.799 2295.31,403.267 2297.66,408.544 2300.01,401.131 2302.36,389.676 2304.71,340.374 2307.06,391.688 2309.41,637.606 2311.76,413.216 2314.11,474.605 2316.46,392.626 2318.81,425.735 2321.16,379.228 2323.51,400.137 2325.86,324.41 2328.21,466.972 2330.56,478.353 2332.91,384.678 2335.27,371.281 2337.62,470.413 2339.97,526.161 2342.32,378.645 2344.67,324.013 2347.02,326.457 2349.37,458.438 2351.72,433.198 2354.07,313.88 2356.42,351.678 2358.77,373.017 2361.12,323.428 2363.47,345.54 2365.82,423.068 2368.17,338.976 2370.52,307.146 2372.87,275.071 2375.22,366.83 2377.57,247.705 2379.92,583.148 2382.27,414.148 2384.62,441.124 2386.98,372.821 2389.33,244.543 2391.68,583.033 2394.03,264.463 2396.38,553.363 2398.73,396.964 2401.08,389.566 2403.43,513.364 2405.78,395.904 2408.13,370.254 2410.48,357.741 2412.83,526.68 2415.18,576.534 2417.53,646.216 2419.88,247.972 2422.23,245.442 2424.58,395.596 2426.93,207.792 2429.28,186.153 2431.63,396.245 2433.98,404.915 2436.34,428.696 2438.69,297.867 2441.04,505.253 2443.39,427.59 2445.74,368.208 2448.09,399.127 2450.44,489.775 2452.79,446.78 2455.14,445.08 2457.49,294.012 2459.84,338.548 2462.19,289.904 2464.54,462.959 2466.89,434.125 2469.24,519.891 2471.59,322.517 2473.94,414.851 2476.29,609.51 2478.64,157.64 2480.99,267.254 2483.34,444.886 2485.7,350.65 2488.05,208.907 2490.4,391.519 2492.75,397.549 2495.1,343.556 2497.45,432.994 2499.8,354.209 2502.15,232.299 2504.5,268.957 2506.85,497.432 2509.2,513.205 2511.55,346.172 2513.9,490.93 2516.25,422.469 2518.6,176.217 2520.95,462.78 2523.3,407.262 2525.65,505.023 2528,252.869 2530.35,331.862 2532.7,503.388 2535.06,369.136 2537.41,498.65 2539.76,448.482 2542.11,261.363 2544.46,203.027 2546.81,361.53 2549.16,661.554 2551.51,380.948 2553.86,455.218 2556.21,324.353 2558.56,463.889 2560.91,492.959 2563.26,312.165 2565.61,533.025 2567.96,501.305 2570.31,406.067 "></polyline>
</svg>
</div>
</div>
<p>Look at that! Things are working; amazin’.</p>
<p>We can also exploit <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>’s parallel sampling capabilities:</p>
<div id="34" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run separate 4 chains for 10 000 iterations using threads to parallelize.</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>num_chains <span class="op">=</span> <span class="fl">4</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    model_with_grad,</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">MCMCThreads</span>(),</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>,</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    num_chains;</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Note we need to provide an initial state for every chain.</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>    initial_state<span class="op">=</span><span class="fu">fill</span>(state, num_chains),</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>samples_array <span class="op">=</span> <span class="fu">stack</span>(<span class="fu">map</span>(<span class="bu">Base</span>.<span class="fu">Fix1</span>(stack, sample <span class="op">-&gt;</span> sample.x), samples))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000×4 Array{Float64, 3}:
[:, :, 1] =
 -2.36956   -4.51731   -6.28775    …  -5.55511  -5.55511  -4.70248
 -1.01396   -0.698561  -0.0594101     -1.35998  -1.35998  -2.33408
  0.647776   3.2992     6.029          3.50087   3.50087   3.66054

[:, :, 2] =
 -3.74295   -4.98732  -5.1717    -4.38842   …  -4.64772  -4.64772  -6.25305
 -0.417976  -1.26177   0.424118   0.741223     -1.39882  -1.39882  -1.37603
  2.39321    3.261     2.93745    3.84398       4.92857   4.92857   4.78574

[:, :, 3] =
 -3.38832  -4.37604   -2.84637   -3.78488  …  -4.76781   -3.96491  -4.1691
  1.06433  -0.656016  -0.332162  -2.0811      -0.406822  -1.68345  -0.484931
  2.9244    4.10706    5.3749     4.10138      7.17909    4.36718   3.79013

[:, :, 4] =
 -1.09066  -1.64651   -1.64651   -2.51977   …  -3.93941   -4.4991   -6.85537
  1.32964   0.962848   0.962848  -0.975786     -0.213985  -1.30922  -1.83734
  2.38148   5.12379    5.12379    6.49862       5.66171    5.35378   5.18575</code></pre>
</div>
</div>
<p>But the fact that we have to provide the <code>AbstractMCMC.sample</code> call, etc. with an <code>initial_state</code> to get started is a bit annoying. We can avoid this by also defining a <code>AbstractMCMC.step</code> <em>without</em> the <code>state</code> argument:</p>
<div id="36" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">::</span><span class="dt">MALA</span>;</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># </span><span class="al">NOTE</span><span class="co">: No state provided!</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just create the initial state by sampling using  a Gaussian.</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="fu">randn</span>(rng, LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(x), <span class="fu">MALAState</span>(x)</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Equipped with this, we no longer need to provide the <code>initial_state</code> everywhere:</p>
<div id="38" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -5.00888    1.01076
 -0.0192107  1.00086
  4.97569    0.986568</code></pre>
</div>
</div>
</section>
<section id="using-our-sampler-with-turing.jl" class="level2">
<h2 class="anchored" data-anchor-id="using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</h2>
<p>As we promised, all of this hassle of implementing our <code>MALA</code> sampler in a way that uses <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> and <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> gets us something more than <em>just</em> an “automatic” implementation of <code>AbstractMCMC.sample</code>.</p>
<p>It also enables use with Turing.jl through the <code>externalsampler</code>, but we need to do one final thing first: we need to tell Turing.jl how to extract a vector of parameters from the “sample” returned in our implementation of <code>AbstractMCMC.step</code>. In our case, the “sample” is a <code>MALASample</code>, so we just need the following line:</p>
<div id="40" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load Turing.jl.</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Turing</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Overload the `getparams` method for our "sample" type, which is just a vector.</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>Turing.Inference.<span class="fu">getparams</span>(<span class="op">::</span><span class="dt">Turing.Model</span>, sample<span class="op">::</span><span class="dt">MALASample</span>) <span class="op">=</span> sample.x</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And with that, we’re good to go!</p>
<div id="42" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Our previous model defined as a Turing.jl model.</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">mvnormal_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">MvNormal</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.], I)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate our model.</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">mvnormal_model</span>()</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Call `sample` but now we're passing in a Turing.jl `model` and wrapping</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co"># our `MALA` sampler in the `externalsampler` to tell Turing.jl that the sampler</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co"># expects something that implements LogDensityProblems.jl.</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×4×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 2.56 seconds
Compute duration  = 2.56 seconds
parameters        = x[1], x[2], x[3]
internals         = lp

Summary Statistics
  parameters      mean       std      mcse    ess_bulk    ess_tail      rhat   ⋯
      Symbol   Float64   Float64   Float64     Float64     Float64   Float64   ⋯

        x[1]   -5.0090    1.0113    0.0185   2993.4007   4901.5415    1.0003   ⋯
        x[2]    0.0106    0.9941    0.0176   3193.5208   5386.1693    1.0013   ⋯
        x[3]    5.0134    1.0104    0.0178   3205.5575   5185.5454    1.0000   ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

        x[1]   -6.9640   -5.6961   -5.0062   -4.3250   -2.9933
        x[2]   -1.9294   -0.6684    0.0252    0.6714    1.9596
        x[3]    3.0387    4.3398    5.0153    5.7023    6.9552</code></pre>
</div>
</div>
<p>Pretty neat, eh?</p>
<section id="models-with-constrained-parameters" class="level3">
<h3 class="anchored" data-anchor-id="models-with-constrained-parameters">Models with constrained parameters</h3>
<p>One thing we’ve sort of glossed over in all of the above is that MALA, at least how we’ve implemented it, requires <span class="math inline">\(x\)</span> to live in <span class="math inline">\(\mathbb{R}^d\)</span> for some <span class="math inline">\(d &gt; 0\)</span>. If some of the parameters were in fact constrained, e.g.&nbsp;we were working with a <code>Beta</code> distribution which has support on the interval <span class="math inline">\((0, 1)\)</span>, <em>not</em> on <span class="math inline">\(\mathbb{R}^d\)</span>, we could easily end up outside of the valid range <span class="math inline">\((0, 1)\)</span>.</p>
<div id="44" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">beta_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">beta_model</span>()</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 1.51 seconds
Compute duration  = 1.51 seconds
parameters        = x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse    ess_bulk    ess_tail      rhat   ⋯
      Symbol   Float64   Float64   Float64     Float64     Float64   Float64   ⋯

           x    0.4980    0.1899    0.0028   4625.8076   5426.1555    1.0003   ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

           x    0.1428    0.3559    0.4976    0.6395    0.8531</code></pre>
</div>
</div>
<p>Yep, that still works, but only because Turing.jl actually <em>transforms</em> the <code>turing_model</code> from constrained to unconstrained, so that the <code>sampler</code> provided to <code>externalsampler</code> is actually always working in unconstrained space! This is not always desirable, so we can turn this off:</p>
<div id="46" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 0.24 seconds
Compute duration  = 0.24 seconds
parameters        = x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse   ess_bulk   ess_tail      rhat   e ⋯
      Symbol   Float64   Float64   Float64    Float64    Float64   Float64     ⋯

           x    0.5168    0.1579    0.0191    67.9499   192.4236    1.0024     ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

           x    0.2510    0.3862    0.5152    0.6391    0.7860</code></pre>
</div>
</div>
<p>The fun thing is that this still sort of works because</p>
<div id="48" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">logpdf</span>(<span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>), <span class="fl">10.0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-Inf</code></pre>
</div>
</div>
<p>and so the samples that fall outside of the range are always rejected. But do notice how much worse all the diagnostics are, e.g.&nbsp;<code>ess_tail</code> is very poor compared to when we use <code>unconstrained=true</code>. Moreover, in more complex cases this won’t just result in a “nice” <code>-Inf</code> log-density value, but instead will error:</p>
<div id="50" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="kw">function</span> <span class="fu">demo</span>()</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>    σ² <span class="op">~</span> <span class="fu">truncated</span>(<span class="fu">Normal</span>(), lower<span class="op">=</span><span class="fl">0</span>)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If we end up with negative values for `σ²`, the `Normal` will error.</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>    x <span class="op">~</span> <span class="fu">Normal</span>(<span class="fl">0</span>, σ²)</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>DomainError: DomainError(Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}}(-0.08201515621363298,1.0,0.0), "Normal: the condition σ &gt;= zero(σ) is not satisfied.")
DomainError with Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}}(-0.08201515621363298,1.0,0.0):
Normal: the condition σ &gt;= zero(σ) is not satisfied.
Stacktrace:
  [1] #371
    @ ~/.julia/packages/Distributions/nmUhn/src/univariate/continuous/normal.jl:37 [inlined]
  [2] check_args
    @ ~/.julia/packages/Distributions/nmUhn/src/utils.jl:89 [inlined]
  [3] #Normal#370
    @ ~/.julia/packages/Distributions/nmUhn/src/univariate/continuous/normal.jl:37 [inlined]
  [4] Normal
    @ ~/.julia/packages/Distributions/nmUhn/src/univariate/continuous/normal.jl:36 [inlined]
  [5] Normal
    @ ~/.julia/packages/Distributions/nmUhn/src/univariate/continuous/normal.jl:42 [inlined]
  [6] macro expansion
    @ ~/.julia/packages/DynamicPPL/MjWTB/src/compiler.jl:579 [inlined]
  [7] demo(__model__::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, __varinfo__::DynamicPPL.ThreadSafeVarInfo{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}, Vector{Set{DynamicPPL.Selector}}}}, ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}, Vector{Base.RefValue{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}, __context__::DynamicPPL.DefaultContext)
    @ Main.Notebook ~/work/docs/docs/tutorials/docs-17-implementing-samplers/index.qmd:592
  [8] _evaluate!!
    @ ~/.julia/packages/DynamicPPL/MjWTB/src/model.jl:973 [inlined]
  [9] evaluate_threadsafe!!(model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, varinfo::DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}, Vector{Set{DynamicPPL.Selector}}}}, ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}, context::DynamicPPL.DefaultContext)
    @ DynamicPPL ~/.julia/packages/DynamicPPL/MjWTB/src/model.jl:962
 [10] evaluate!!
    @ ~/.julia/packages/DynamicPPL/MjWTB/src/model.jl:892 [inlined]
 [11] logdensity
    @ ~/.julia/packages/DynamicPPL/MjWTB/src/logdensityfunction.jl:140 [inlined]
 [12] Fix1
    @ ./operators.jl:1118 [inlined]
 [13] vector_mode_dual_eval!(f::Base.Fix1{typeof(LogDensityProblems.logdensity), LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, Nothing}}, cfg::ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}, x::Vector{Float64})
    @ ForwardDiff ~/.julia/packages/ForwardDiff/PcZ48/src/apiutils.jl:24
 [14] vector_mode_gradient!(result::DiffResults.MutableDiffResult{1, Float64, Tuple{Vector{Float64}}}, f::Base.Fix1{typeof(LogDensityProblems.logdensity), LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, Nothing}}, x::Vector{Float64}, cfg::ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}})
    @ ForwardDiff ~/.julia/packages/ForwardDiff/PcZ48/src/gradient.jl:96
 [15] gradient!
    @ ~/.julia/packages/ForwardDiff/PcZ48/src/gradient.jl:37 [inlined]
 [16] gradient!
    @ ~/.julia/packages/ForwardDiff/PcZ48/src/gradient.jl:35 [inlined]
 [17] logdensity_and_gradient
    @ ~/.julia/packages/LogDensityProblemsAD/rBlLq/ext/LogDensityProblemsADForwardDiffExt.jl:118 [inlined]
 [18] leapfrog_step(model::LogDensityProblemsADForwardDiffExt.ForwardDiffLogDensity{LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, Nothing}, ForwardDiff.Chunk{2}, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}, x::Vector{Float64}, p::Vector{Float64}, ϵ::Int64, M::UniformScaling{Bool})
    @ Main.Notebook ~/work/docs/docs/tutorials/docs-17-implementing-samplers/index.qmd:369
 [19] step(rng::TaskLocalRNG, model_wrapper::AbstractMCMC.LogDensityModel{LogDensityProblemsADForwardDiffExt.ForwardDiffLogDensity{LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, Nothing}, ForwardDiff.Chunk{2}, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}}, sampler::MALA{Int64, UniformScaling{Bool}}, state::MALAState{Vector{Float64}}; kwargs::@Kwargs{})
    @ Main.Notebook ~/work/docs/docs/tutorials/docs-17-implementing-samplers/index.qmd:334
 [20] step
    @ ~/work/docs/docs/tutorials/docs-17-implementing-samplers/index.qmd:316 [inlined]
 [21] #step#107
    @ ~/.julia/packages/Turing/Bv30p/src/mcmc/abstractmcmc.jl:155 [inlined]
 [22] step(rng::TaskLocalRNG, model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, sampler_wrapper::DynamicPPL.Sampler{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}, state::Turing.Inference.TuringState{MALAState{Vector{Float64}}, LogDensityProblemsADForwardDiffExt.ForwardDiffLogDensity{LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, Nothing}, ForwardDiff.Chunk{2}, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}})
    @ Turing.Inference ~/.julia/packages/Turing/Bv30p/src/mcmc/abstractmcmc.jl:144
 [23] macro expansion
    @ ~/.julia/packages/AbstractMCMC/YrmkI/src/sample.jl:176 [inlined]
 [24] macro expansion
    @ ~/.julia/packages/AbstractMCMC/YrmkI/src/logging.jl:16 [inlined]
 [25] mcmcsample(rng::TaskLocalRNG, model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, sampler::DynamicPPL.Sampler{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}, N::Int64; progress::Bool, progressname::String, callback::Nothing, discard_initial::Int64, thinning::Int64, chain_type::Type, initial_state::Nothing, kwargs::@Kwargs{})
    @ AbstractMCMC ~/.julia/packages/AbstractMCMC/YrmkI/src/sample.jl:120
 [26] sample(rng::TaskLocalRNG, model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, sampler::DynamicPPL.Sampler{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}, N::Int64; chain_type::Type, resume_from::Nothing, initial_state::Nothing, kwargs::@Kwargs{progress::Bool})
    @ DynamicPPL ~/.julia/packages/DynamicPPL/MjWTB/src/sampler.jl:93
 [27] sample
    @ ~/.julia/packages/DynamicPPL/MjWTB/src/sampler.jl:83 [inlined]
 [28] #sample#4
    @ ~/.julia/packages/Turing/Bv30p/src/mcmc/Inference.jl:276 [inlined]
 [29] sample
    @ ~/.julia/packages/Turing/Bv30p/src/mcmc/Inference.jl:267 [inlined]
 [30] #sample#3
    @ ~/.julia/packages/Turing/Bv30p/src/mcmc/Inference.jl:264 [inlined]
 [31] top-level scope
    @ ~/work/docs/docs/tutorials/docs-17-implementing-samplers/index.qmd:594</code></pre>
</div>
</div>
<p>As expected, we run into a <code>DomainError</code> at some point, while if we set <code>unconstrained=true</code>, letting Turing.jl transform the model to a unconstrained form behind the scenes, everything works as expected:</p>
<div id="52" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 0.54 seconds
Compute duration  = 0.54 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse   ess_bulk   ess_tail      rhat   e ⋯
      Symbol   Float64   Float64   Float64    Float64    Float64   Float64     ⋯

          σ²    0.2049    0.0000    0.0000        NaN        NaN       NaN     ⋯
           x   -0.9264    0.0000    0.0000        NaN        NaN       NaN     ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

          σ²    0.2049    0.2049    0.2049    0.2049    0.2049
           x   -0.9264   -0.9264   -0.9264   -0.9264   -0.9264</code></pre>
</div>
</div>
<p>Neat!</p>
<p>Similarly, which automatic differentiation backend one should use can be specified through the <code>adtype</code> keyword argument too. For example, if we want to use <a href="https://github.com/JuliaDiff/ReverseDiff.jl">ReverseDiff.jl</a> instead of the default <a href="https://github.com/JuliaDiff/ForwardDiff.jl">ForwardDiff.jl</a>:</p>
<div id="54" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">ReverseDiff</span>: ReverseDiff</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify that we want to use `AutoReverseDiff`.</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">demo</span>(),</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>, adtype<span class="op">=</span><span class="fu">AutoReverseDiff</span>()),</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>;</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 2.98 seconds
Compute duration  = 2.98 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse   ess_bulk   ess_tail      rhat   e ⋯
      Symbol   Float64   Float64   Float64    Float64    Float64   Float64     ⋯

          σ²    0.8849    0.5753    0.0210   602.2014   288.6656    1.0021     ⋯
           x    0.0824    1.0113    0.0479   536.7517   536.4314    1.0026     ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

          σ²    0.1466    0.4230    0.7610    1.2427    2.3166
           x   -2.0004   -0.3852    0.0070    0.5197    2.7179</code></pre>
</div>
</div>
<p>Double-neat.</p>
</section>
</section>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<p>At this point it’s worth maybe reminding ourselves what we did and also <em>why</em> we did it:</p>
<ol type="1">
<li>We define our models in the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface because it makes the sampler agnostic to how the underlying model is implemented.</li>
<li>We implement our sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> interface, which just means that our sampler is a subtype of <code>AbstractMCMC.AbstractSampler</code> and we implement the MCMC transition in <code>AbstractMCMC.step</code>.</li>
<li>Points 1 and 2 makes it so our sampler can be used with a wide range of model implementations, amongst them being models implemented in both Turing.jl and Stan. This gives you, the inference implementer, a large collection of models to test your inference method on, in addition to allowing users of Turing.jl and Stan to try out your inference method with minimal effort.</li>
</ol>


</section>


<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a><div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>We’re going with the leapfrog formulation because in a future version of this tutorial we’ll add a section extending this simple “baseline” MALA sampler to more complex versions. See <a href="https://github.com/TuringLang/docs/issues/479">issue #479</a> for progress on this.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>There is no such thing as a proper interface in Julia (at least not officially), and so we use the word “interface” here to mean a few minimal methods that needs to be implemented by any type that we treat as a target model.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/turinglang\.org\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../tutorials/docs-07-for-developers-variational-inference/index.html" class="pagination-link" aria-label="Variational Inference">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Variational Inference</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Turing is created by <a href="http://mlg.eng.cam.ac.uk/hong/" target="_blank">Hong Ge</a>, and lovingly maintained by the <a href="https://github.com/TuringLang/Turing.jl/graphs/contributors" target="_blank">core team</a> of volunteers. <br> The contents of this website are © 2024 under the terms of the <a href="https://github.com/TuringLang/Turing.jl/blob/master/LICENCE" target="_blank">MIT License</a>.</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/TuringLang/docs/edit/master/tutorials/docs-17-implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/docs/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://x.com/TuringLang">
      <i class="bi bi-twitter" role="img" aria-label="Turing Twitter">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/TuringLang/Turing.jl">
      <i class="bi bi-github" role="img" aria-label="Turing GitHub">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




<script src="../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>