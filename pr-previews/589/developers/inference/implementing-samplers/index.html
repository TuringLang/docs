<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Implementing Samplers – Turing.jl</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<link href="../../../developers/inference/variational-inference/index.html" rel="prev">
<link href="../../../assets/favicon.ico" rel="icon">
<script src="../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-dark-b53751a350365c71b6c909e95f209ed1.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap-34237cea2e2cc12c7515d5a9baa4807c.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../../site_libs/bootstrap/bootstrap-dark-2ce616a69abdabb5d8b1d1ad44f632cf.min.css" rel="prefetch" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<style>
  a {
    text-decoration: none;
  }
  a:hover {
    text-decoration: underline;
  }
</style>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../../theming/styles.css">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="https://turinglang.org/" class="navbar-brand navbar-brand-logo">
    <img src="../../../assets/images/turing-logo.svg" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="https://turinglang.org/">
    <span class="navbar-title">Turing.jl</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../getting-started/"> 
<span class="menu-text">Get Started</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../tutorials/coin-flipping/"> 
<span class="menu-text">Tutorials</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/library/"> 
<span class="menu-text">Libraries</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/news/"> 
<span class="menu-text">News</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/team/"> 
<span class="menu-text">Team</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-v0.37" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">v0.37</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-v0.37">    
        <li>
    <a class="dropdown-item" href="https://turinglang.org/docs/changelog.html">
 <span class="dropdown-text">Changelog</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://turinglang.org/docs/versions.html">
 <span class="dropdown-text">All Versions</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools tools-wide">
    <a href="https://x.com/TuringLang" title="Turing Twitter" class="quarto-navigation-tool px-1" aria-label="Turing Twitter"><i class="bi bi-twitter"></i></a>
    <a href="https://github.com/TuringLang/Turing.jl" title="Turing GitHub" class="quarto-navigation-tool px-1" aria-label="Turing GitHub"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../../developers/contributing/index.html">Developers</a></li><li class="breadcrumb-item"><a href="../../../developers/inference/abstractmcmc-interface/index.html">Inference (note: outdated)</a></li><li class="breadcrumb-item"><a href="../../../developers/inference/implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../getting-started/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Getting Started</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../core-functionality/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Core Functionality</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false">
 <span class="menu-text">User Guide</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/automatic-differentiation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Automatic Differentiation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/custom-distribution/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Custom Distributions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/probability-interface/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Querying Model Probabilities</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/modifying-logprob/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Modifying the Log Probability</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/generated-quantities/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Generated Quantities</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/mode-estimation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Mode Estimation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/performance-tips/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Performance Tips</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/sampler-visualisation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Sampler Visualization</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/dynamichmc/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using DynamicHMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/external-samplers/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using External Samplers</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false">
 <span class="menu-text">Tutorials</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/coin-flipping/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction: Coin Flipping</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/gaussian-mixture-models/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Mixture Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-neural-networks/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Neural Networks</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/hidden-markov-models/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Hidden Markov Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-linear-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Linear Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/infinite-mixture-models/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Infinite Mixture Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-poisson-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Poisson Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/multinomial-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Multinomial Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-differential-equations/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Differential Equations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/probabilistic-pca/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Probabilistic PCA</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-time-series-analysis/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Time Series Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/gaussian-processes-introduction/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Processes: Introduction</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/gaussian-process-latent-variable-models/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Process Latent Variable Models</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Developers</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/contributing/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Contributing</span></a>
  </div>
</li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false">
 <span class="menu-text">DynamicPPL’s Compiler</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/compiler/model-manual/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Manually Defining a Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/compiler/minituring-compiler/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation I: Compiler</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/compiler/minituring-contexts/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation II: Contexts</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/compiler/design-overview/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Turing Compiler Design (Outdated)</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false">
 <span class="menu-text">Variable Transformations</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/transforms/distributions/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Distributions and the Jacobian</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/transforms/bijectors/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bijectors in MCMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/transforms/dynamicppl/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variable transformations in DynamicPPL</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true">
 <span class="menu-text">Inference (note: outdated)</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/inference/abstractmcmc-interface/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Interface Guide</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/inference/abstractmcmc-turing/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">How Turing Implements AbstractMCMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/inference/variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/inference/implementing-samplers/index.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Implementing Samplers</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of Contents</h2>
   
  <ul>
  <li><a href="#quick-overview-of-mala" id="toc-quick-overview-of-mala" class="nav-link active" data-scroll-target="#quick-overview-of-mala">Quick overview of MALA</a></li>
  <li><a href="#what-we-need-from-a-model-logdensityproblems.jl" id="toc-what-we-need-from-a-model-logdensityproblems.jl" class="nav-link" data-scroll-target="#what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: LogDensityProblems.jl</a></li>
  <li><a href="#implementing-mala-in-abstractmcmc.jl" id="toc-implementing-mala-in-abstractmcmc.jl" class="nav-link" data-scroll-target="#implementing-mala-in-abstractmcmc.jl">Implementing MALA in AbstractMCMC.jl</a></li>
  <li><a href="#using-our-sampler-with-turing.jl" id="toc-using-our-sampler-with-turing.jl" class="nav-link" data-scroll-target="#using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</a>
  <ul class="collapse">
  <li><a href="#models-with-constrained-parameters" id="toc-models-with-constrained-parameters" class="nav-link" data-scroll-target="#models-with-constrained-parameters">Models with constrained parameters</a></li>
  </ul></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/TuringLang/docs/edit/main/developers/inference/implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/docs/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../../developers/contributing/index.html">Developers</a></li><li class="breadcrumb-item"><a href="../../../developers/inference/abstractmcmc-interface/index.html">Inference (note: outdated)</a></li><li class="breadcrumb-item"><a href="../../../developers/inference/implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Implementing Samplers</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>In this tutorial, we’ll go through step-by-step how to implement a “simple” sampler in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> in such a way that it can be easily applied to Turing.jl models.</p>
<p>In particular, we’re going to implement a version of <strong>Metropolis-adjusted Langevin (MALA)</strong>.</p>
<p>Note that we will implement this sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> framework, completely “ignoring” Turing.jl until the very end of the tutorial, at which point we’ll use a single line of code to make the resulting sampler available to Turing.jl. This is to really drive home the point that one can implement samplers in a way that is accessible to all of Turing.jl’s users without having to use Turing.jl yourself.</p>
<section id="quick-overview-of-mala" class="level2">
<h2 class="anchored" data-anchor-id="quick-overview-of-mala">Quick overview of MALA</h2>
<p>We can view MALA as a single step of the leapfrog intergrator with resampling of momentum <span class="math inline">\(p\)</span> at every step.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> To make that statement a bit more concrete, we first define the <em>extended</em> target <span class="math inline">\(\bar{\gamma}(x, p)\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\log \bar{\gamma}(x, p) \propto \log \gamma(x) + \log \gamma_{\mathcal{N}(0, M)}(p)
\end{equation*}\]</span></p>
<p>where <span class="math inline">\(\gamma_{\mathcal{N}(0, M)}\)</span> denotes the density for a zero-centered Gaussian with covariance matrix <span class="math inline">\(M\)</span>. We then consider targeting this joint distribution over both <span class="math inline">\(x\)</span> and <span class="math inline">\(p\)</span> as follows. First we define the map</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  L_{\epsilon}: \quad &amp; \mathbb{R}^d \times \mathbb{R}^d \to \mathbb{R}^d \times \mathbb{R}^d \\
  &amp; (x, p) \mapsto (\tilde{x}, \tilde{p}) := L_{\epsilon}(x, p)
\end{split}
\end{equation*}\]</span></p>
<p>as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p_{1 / 2} &amp;:= p + \frac{\epsilon}{2} \nabla \log \gamma(x) \\
  \tilde{x} &amp;:= x + \epsilon M^{-1} p_{1 /2 } \\
  p_1 &amp;:= p_{1 / 2} + \frac{\epsilon}{2} \nabla \log \gamma(\tilde{x}) \\
  \tilde{p} &amp;:= - p_1
\end{split}
\end{equation*}\]</span></p>
<p>This might be familiar for some readers as a single step of the Leapfrog integrator. We then define the MALA kernel as follows: given the current iterate <span class="math inline">\(x_i\)</span>, we sample the next iterate <span class="math inline">\(x_{i + 1}\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p &amp;\sim \mathcal{N}(0, M) \\
  (\tilde{x}, \tilde{p}) &amp;:= L_{\epsilon}(x_i, p) \\
  \alpha &amp;:= \min \left\{ 1, \frac{\bar{\gamma}(\tilde{x}, \tilde{p})}{\bar{\gamma}(x_i, p)} \right\} \\
  x_{i + 1} &amp;:=
  \begin{cases}
    \tilde{x} \quad &amp; \text{ with prob. } \alpha \\
    x_i       \quad &amp; \text{ with prob. } 1 - \alpha
  \end{cases}
\end{split}
\end{equation*}\]</span></p>
<p>i.e.&nbsp;we accept the proposal <span class="math inline">\(\tilde{x}\)</span> with probability <span class="math inline">\(\alpha\)</span> and reject it, thus sticking with our current iterate, with probability <span class="math inline">\(1 - \alpha\)</span>.</p>
</section>
<section id="what-we-need-from-a-model-logdensityproblems.jl" class="level2">
<h2 class="anchored" data-anchor-id="what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a></h2>
<p>There are a few things we need from the “target” / “model” / density that we want to sample from:</p>
<ol type="1">
<li>We need access to log-density <em>evaluations</em> <span class="math inline">\(\log \gamma(x)\)</span> so we can compute the acceptance ratio involving <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>We need access to log-density <em>gradients</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span> so we can compute the Leapfrog steps <span class="math inline">\(L_{\epsilon}(x, p)\)</span>.</li>
<li>We also need access to the “size” of the model so we can determine the size of <span class="math inline">\(M\)</span>.</li>
</ol>
<p>Luckily for us, there is a package called <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> which provides an interface for <em>exactly</em> this!</p>
<p>To demonstrate how one can implement the “<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface”<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> we will use a simple Gaussian model as an example:</p>
<div id="4" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblems</span>: LogDensityProblems;</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's define some type that represents the model.</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> IsotropicNormalModel{M<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"mean of the isotropic Gaussian"</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    mean<span class="op">::</span><span class="dt">M</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Specifies what input length the model expects.</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">dimension</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> <span class="fu">length</span>(model.mean)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Implementation of the log-density evaluation of the model.</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x<span class="op">::</span><span class="dt">AbstractVector{&lt;:Real}</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">-</span> <span class="fu">sum</span>(abs2, x <span class="op">.-</span> model.mean) <span class="op">/</span> <span class="fl">2</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This gives us all of the properties we want for our MALA sampler with the exception of the computation of the <em>gradient</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span>. There is the method <code>LogDensityProblems.logdensity_and_gradient</code> which should return a 2-tuple where the first entry is the evaluation of the logdensity <span class="math inline">\(\log \gamma(x)\)</span> and the second entry is the gradient <span class="math inline">\(\nabla \log \gamma(x)\)</span>.</p>
<p>There are two ways to “implement” this method: 1) we implement it by hand, which is feasible in the case of our <code>IsotropicNormalModel</code>, or b) we defer the implementation of this to a automatic differentiation backend.</p>
<p>To implement it by hand we can simply do</p>
<div id="6" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl that first-order, i.e. gradient information, is available.</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{1}</span>()</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Implement `logdensity_and_gradient`.</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    logγ_x <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="op">-</span>x <span class="op">.*</span> (x <span class="op">-</span> model.mean)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> logγ_x, ∇logγ_x</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s just try it out:</p>
<div id="8" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate the problem.</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> <span class="fu">IsotropicNormalModel</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.])</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create some example input that we can test on.</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>x_example <span class="op">=</span> <span class="fu">randn</span>(LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate!</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-32.60350811065796</code></pre>
</div>
</div>
<p>To defer it to an automatic differentiation backend, we can do</p>
<div id="10" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl we only have access to 0-th order information.</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{0}</span>()</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Use `LogDensityProblemsAD`'s `ADgradient` in combination with some AD backend to implement `logdensity_and_gradient`.</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblemsAD</span>, <span class="bu">ADTypes</span>, <span class="bu">ForwardDiff</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>model_with_grad <span class="op">=</span> <span class="fu">ADgradient</span>(<span class="fu">AutoForwardDiff</span>(), model)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model_with_grad, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-32.60350811065796</code></pre>
</div>
</div>
<p>We’ll continue with the second approach in this tutorial since this is typically what one does in practice, because there are better hobbies to spend time on than deriving gradients by hand.</p>
<p>At this point, one might wonder how we’re going to tie this back to Turing.jl in the end. Effectively, when working with inference methods that only require log-density evaluations and / or higher-order information of the log-density, Turing.jl actually converts the user-provided <code>Model</code> into an object implementing the above methods for <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>. As a result, most samplers provided by Turing.jl are actually implemented to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, enabling their use both <em>within</em> Turing.jl and <em>outside</em> of Turing.jl! Morever, there exists similar conversions for Stan through BridgeStan and Stan<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, which means that a sampler supporting the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface can easily be used on both Turing.jl <em>and</em> Stan models (in addition to user-provided models, as our <code>IsotropicNormalModel</code> above)!</p>
<p>Anyways, let’s move on to actually implementing the sampler.</p>
</section>
<section id="implementing-mala-in-abstractmcmc.jl" class="level2">
<h2 class="anchored" data-anchor-id="implementing-mala-in-abstractmcmc.jl">Implementing MALA in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a></h2>
<p>Now that we’ve established that a model implementing the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface provides us with all the information we need from <span class="math inline">\(\log \gamma(x)\)</span>, we can address the question: given an object that implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, how can we define a sampler for it?</p>
<p>We’re going to do this by making our sampler a sub-type of <code>AbstractMCMC.AbstractSampler</code> in addition to implementing a few methods from <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>. Why? Because it gets us <em>a lot</em> of functionality for free, as we will see later.</p>
<p>Moreover, <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> provides a very natural interface for MCMC algorithms.</p>
<p>First, we’ll define our <code>MALA</code> type</p>
<div id="12" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">AbstractMCMC</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALA{T,A} <span class="op">&lt;:</span><span class="dt"> AbstractMCMC.AbstractSampler</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"stepsize used in the leapfrog step"</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    ϵ_init<span class="op">::</span><span class="dt">T</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"covariance matrix used for the momentum"</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    M_init<span class="op">::</span><span class="dt">A</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notice how we’ve added the suffix <code>_init</code> to both the stepsize and the covariance matrix. We’ve done this because a <code>AbstractMCMC.AbstractSampler</code> should be <em>immutable</em>. Of course there might be many scenarios where we want to allow something like the stepsize and / or the covariance matrix to vary between iterations, e.g.&nbsp;during the burn-in / adaptation phase of the sampling process we might want to adjust the parameters using statistics computed from these initial iterations. But information which can change between iterations <em>should not go in the sampler itself</em>! Instead, this information should go in the sampler <em>state</em>.</p>
<p>The sampler state should at the very least contain all the necessary information to perform the next MCMC iteration, but usually contains further information, e.g.&nbsp;quantities and statistics useful for evaluating whether the sampler has converged.</p>
<p>We will use the following sampler state for our <code>MALA</code> sampler:</p>
<div id="14" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALAState{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This might seem overly redundant: we’re defining a type <code>MALAState</code> and it only contains a simple vector of reals. In this particular case we indeed could have dropped this and simply used a <code>AbstractVector{&lt;:Real}</code> as our sampler state, but typically, as we will see later, one wants to include other quantities in the sampler state. For example, if we also wanted to adapt the parameters of our <code>MALA</code>, e.g.&nbsp;alter the stepsize depending on acceptance rates, in which case we should also put <code>ϵ</code> in the state, but for now we’ll keep things simple.</p>
<p>Moreover, we also want a <em>sample</em> type, which is a type meant for “public consumption”, i.e.&nbsp;the end-user. This is generally going to contain a subset of the information present in the state. But in such a simple scenario as this, we similarly only have a <code>AbstractVector{&lt;:Real}</code>:</p>
<div id="16" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALASample{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We currently have three things:</p>
<ol type="1">
<li>A <code>AbstractMCMC.AbstractSampler</code> implementation called <code>MALA</code>.</li>
<li>A state <code>MALAState</code> for our sampler <code>MALA</code>.</li>
<li>A sample <code>MALASample</code> for our sampler <code>MALA</code>.</li>
</ol>
<p>That means that we’re ready to implement the only thing that really matters: <code>AbstractMCMC.step</code>.</p>
<p><code>AbstractMCMC.step</code> defines the MCMC iteration of our <code>MALA</code> given the current <code>MALAState</code>. Specifically, the signature of the function is as follows:</p>
<div id="18" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The RNG to ensure reproducibility.</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The model that defines our target.</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.AbstractModel</span>,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The sampler for which we're taking a `step`.</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">AbstractMCMC.AbstractSampler</span>,</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The current sampler `state`.</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    state;</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Additional keyword arguments that we may or may not need.</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Moreover, there is a specific <code>AbstractMCMC.AbstractModel</code> which is used to indicate that the model that is provided implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface: <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Since, as we discussed earlier, in our case we’re indeed going to work with types that support the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, we’ll define <code>AbstractMCMC.step</code> for such a <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Note that <code>AbstractMCMC.LogDensityModel</code> has no other purpose; it has a single field called <code>logdensity</code>, and it does nothing else. But by wrapping the model in <code>AbstractMCMC.LogDensityModel</code>, it allows samplers that want to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> to define their <code>AbstractMCMC.step</code> on this type without running into method ambiguities.</p>
<p>All in all, that means that the signature for our <code>AbstractMCMC.step</code> is going to be the following:</p>
<div id="20" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># `LogDensityModel` so we know we're working with LogDensityProblems.jl model.</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler.</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler state.</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Great! Now let’s actually implement the full <code>AbstractMCMC.step</code> for our <code>MALA</code>.</p>
<p>Let’s remind ourselves what we’re going to do:</p>
<ol type="1">
<li>Sample a new momentum <span class="math inline">\(p\)</span>.</li>
<li>Compute the log-density of the extended target <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>Take a single leapfrog step <span class="math inline">\((\tilde{x}, \tilde{p}) = L_{\epsilon}(x, p)\)</span>.</li>
<li>Accept or reject the proposed <span class="math inline">\((\tilde{x}, \tilde{p})\)</span>.</li>
</ol>
<p>All in all, this results in the following:</p>
<div id="22" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>: Random</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Distributions</span>  <span class="co"># so we get the `MvNormal`</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the wrapped model which implements LogDensityProblems.jl.</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just extract the sampler parameters to make our lives easier.</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    ϵ <span class="op">=</span> sampler.ϵ_init</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    M <span class="op">=</span> sampler.M_init</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the current parameters.</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> state.x</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sample the momentum.</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>    p_dist <span class="op">=</span> <span class="fu">MvNormal</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)), M)</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> <span class="fu">rand</span>(rng, p_dist)</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Propose using a single leapfrog step.</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>    x̃, p̃ <span class="op">=</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Accept or reject proposal.</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>    logp <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p)</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>    logp̃ <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x̃) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p̃)</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>    logα <span class="op">=</span> logp̃ <span class="op">-</span> logp</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>    state_new <span class="op">=</span> <span class="cf">if</span> <span class="fu">log</span>(<span class="fu">rand</span>(rng)) <span class="op">&lt;</span> logα</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Accept.</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x̃)</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Reject.</span></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x)</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return the "sample" and the sampler state.</span></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(state_new.x), state_new</span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Fairly straight-forward.</p>
<p>Of course, we haven’t defined the <code>leapfrog_step</code> method yet, so let’s do that:</p>
<div id="24" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p` using "position" `x`.</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x))</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    p1 <span class="op">=</span> p <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update the "position" `x` using momentum `p1`.</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    x̃ <span class="op">=</span> x <span class="op">+</span> ϵ <span class="op">.*</span> (M <span class="op">\</span> p1)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p1` using position `x̃`</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x̃ <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x̃))</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    p2 <span class="op">=</span> p1 <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x̃</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Flip momentum `p2`.</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    p̃ <span class="op">=</span> <span class="op">-</span>p2</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x̃, p̃</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>leapfrog_step (generic function with 1 method)</code></pre>
</div>
</div>
<p>With all of this, we’re technically ready to sample!</p>
<div id="26" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>, <span class="bu">LinearAlgebra</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>rng <span class="op">=</span> <span class="bu">Random</span>.<span class="fu">default_rng</span>()</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>sampler <span class="op">=</span> <span class="fu">MALA</span>(<span class="fl">1</span>, I)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>state <span class="op">=</span> <span class="fu">MALAState</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)))</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>x_next, state_next <span class="op">=</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    rng,</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    AbstractMCMC.<span class="fu">LogDensityModel</span>(model),</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    state</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>(MALASample{Vector{Float64}}([0.0, 0.0, 0.0]), MALAState{Vector{Float64}}([0.0, 0.0, 0.0]))</code></pre>
</div>
</div>
<p>Great, it works!</p>
<p>And I promised we would get quite some functionality for free if we implemented <code>AbstractMCMC.step</code>, and so we can now simply call <code>sample</code> to perform standard MCMC sampling:</p>
<div id="28" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform 1000 iterations with our `MALA` sampler.</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; initial_state<span class="op">=</span>state, progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Concatenate into a matrix.</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000 Matrix{Float64}:
 -0.254313  -1.17363  -2.77218  -4.4811    …  -7.5287   -5.08982   -5.08982
  0.101125  -1.01921  -1.17907  -0.503441      1.43933   0.317184   0.317184
  1.53319    3.07937   3.48719   4.65494       3.61345   3.34864    3.34864</code></pre>
</div>
</div>
<div id="30" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the marginal means and standard deviations.</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -5.00993     1.00575
  0.00950322  1.01533
  5.01821     1.00456</code></pre>
</div>
</div>
<p>Let’s visualize the samples</p>
<div id="32" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">StatsPlots</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">transpose</span>(samples_matrix[<span class="op">:</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">:</span><span class="kw">end</span>]), alpha<span class="op">=</span><span class="fl">0.5</span>, legend<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<!--?xml version="1.0" encoding="utf-8"?-->
<svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" width="672" height="480" viewbox="0 0 2688 1920">
<defs>
  <clippath id="clip460">
    <rect x="0" y="0" width="2688" height="1920"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip460)" d="M0 1920 L2688 1920 L2688 0 L0 0  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip461">
    <rect x="537" y="0" width="1883" height="1883"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip460)" d="M151.747 1800.78 L2640.76 1800.78 L2640.76 47.2441 L151.747 47.2441  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip462">
    <rect x="151" y="47" width="2490" height="1755"></rect>
  </clippath>
</defs>
<polyline clip-path="url(#clip462)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="219.84,1800.78 219.84,47.2441 "></polyline>
<polyline clip-path="url(#clip462)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="807.458,1800.78 807.458,47.2441 "></polyline>
<polyline clip-path="url(#clip462)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1395.08,1800.78 1395.08,47.2441 "></polyline>
<polyline clip-path="url(#clip462)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1982.69,1800.78 1982.69,47.2441 "></polyline>
<polyline clip-path="url(#clip462)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="2570.31,1800.78 2570.31,47.2441 "></polyline>
<polyline clip-path="url(#clip462)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,1519.55 2640.76,1519.55 "></polyline>
<polyline clip-path="url(#clip462)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,1221.62 2640.76,1221.62 "></polyline>
<polyline clip-path="url(#clip462)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,923.695 2640.76,923.695 "></polyline>
<polyline clip-path="url(#clip462)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,625.767 2640.76,625.767 "></polyline>
<polyline clip-path="url(#clip462)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,327.839 2640.76,327.839 "></polyline>
<polyline clip-path="url(#clip460)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1800.78 2640.76,1800.78 "></polyline>
<polyline clip-path="url(#clip460)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="219.84,1800.78 219.84,1781.88 "></polyline>
<polyline clip-path="url(#clip460)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="807.458,1800.78 807.458,1781.88 "></polyline>
<polyline clip-path="url(#clip460)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1395.08,1800.78 1395.08,1781.88 "></polyline>
<polyline clip-path="url(#clip460)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1982.69,1800.78 1982.69,1781.88 "></polyline>
<polyline clip-path="url(#clip460)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="2570.31,1800.78 2570.31,1781.88 "></polyline>
<path clip-path="url(#clip460)" d="M219.84 1834 Q216.229 1834 214.4 1837.57 Q212.595 1841.11 212.595 1848.24 Q212.595 1855.34 214.4 1858.91 Q216.229 1862.45 219.84 1862.45 Q223.474 1862.45 225.28 1858.91 Q227.108 1855.34 227.108 1848.24 Q227.108 1841.11 225.28 1837.57 Q223.474 1834 219.84 1834 M219.84 1830.3 Q225.65 1830.3 228.706 1834.9 Q231.784 1839.49 231.784 1848.24 Q231.784 1856.96 228.706 1861.57 Q225.65 1866.15 219.84 1866.15 Q214.03 1866.15 210.951 1861.57 Q207.896 1856.96 207.896 1848.24 Q207.896 1839.49 210.951 1834.9 Q214.03 1830.3 219.84 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip460)" d="M771.15 1861.55 L787.47 1861.55 L787.47 1865.48 L765.525 1865.48 L765.525 1861.55 Q768.187 1858.79 772.771 1854.16 Q777.377 1849.51 778.558 1848.17 Q780.803 1845.65 781.683 1843.91 Q782.585 1842.15 782.585 1840.46 Q782.585 1837.71 780.641 1835.97 Q778.72 1834.23 775.618 1834.23 Q773.419 1834.23 770.965 1835 Q768.535 1835.76 765.757 1837.31 L765.757 1832.59 Q768.581 1831.46 771.035 1830.88 Q773.488 1830.3 775.525 1830.3 Q780.896 1830.3 784.09 1832.98 Q787.285 1835.67 787.285 1840.16 Q787.285 1842.29 786.474 1844.21 Q785.687 1846.11 783.581 1848.7 Q783.002 1849.37 779.9 1852.59 Q776.798 1855.78 771.15 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip460)" d="M797.331 1830.92 L815.687 1830.92 L815.687 1834.86 L801.613 1834.86 L801.613 1843.33 Q802.632 1842.98 803.65 1842.82 Q804.669 1842.64 805.687 1842.64 Q811.474 1842.64 814.854 1845.81 Q818.233 1848.98 818.233 1854.4 Q818.233 1859.97 814.761 1863.08 Q811.289 1866.15 804.97 1866.15 Q802.794 1866.15 800.525 1865.78 Q798.28 1865.41 795.872 1864.67 L795.872 1859.97 Q797.956 1861.11 800.178 1861.66 Q802.4 1862.22 804.877 1862.22 Q808.882 1862.22 811.22 1860.11 Q813.558 1858.01 813.558 1854.4 Q813.558 1850.78 811.22 1848.68 Q808.882 1846.57 804.877 1846.57 Q803.002 1846.57 801.127 1846.99 Q799.275 1847.4 797.331 1848.28 L797.331 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip460)" d="M837.446 1834 Q833.835 1834 832.007 1837.57 Q830.201 1841.11 830.201 1848.24 Q830.201 1855.34 832.007 1858.91 Q833.835 1862.45 837.446 1862.45 Q841.081 1862.45 842.886 1858.91 Q844.715 1855.34 844.715 1848.24 Q844.715 1841.11 842.886 1837.57 Q841.081 1834 837.446 1834 M837.446 1830.3 Q843.256 1830.3 846.312 1834.9 Q849.391 1839.49 849.391 1848.24 Q849.391 1856.96 846.312 1861.57 Q843.256 1866.15 837.446 1866.15 Q831.636 1866.15 828.557 1861.57 Q825.502 1856.96 825.502 1848.24 Q825.502 1839.49 828.557 1834.9 Q831.636 1830.3 837.446 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip460)" d="M1354.69 1830.92 L1373.05 1830.92 L1373.05 1834.86 L1358.98 1834.86 L1358.98 1843.33 Q1360 1842.98 1361.01 1842.82 Q1362.03 1842.64 1363.05 1842.64 Q1368.84 1842.64 1372.22 1845.81 Q1375.6 1848.98 1375.6 1854.4 Q1375.6 1859.97 1372.12 1863.08 Q1368.65 1866.15 1362.33 1866.15 Q1360.16 1866.15 1357.89 1865.78 Q1355.64 1865.41 1353.24 1864.67 L1353.24 1859.97 Q1355.32 1861.11 1357.54 1861.66 Q1359.76 1862.22 1362.24 1862.22 Q1366.25 1862.22 1368.58 1860.11 Q1370.92 1858.01 1370.92 1854.4 Q1370.92 1850.78 1368.58 1848.68 Q1366.25 1846.57 1362.24 1846.57 Q1360.37 1846.57 1358.49 1846.99 Q1356.64 1847.4 1354.69 1848.28 L1354.69 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip460)" d="M1394.81 1834 Q1391.2 1834 1389.37 1837.57 Q1387.56 1841.11 1387.56 1848.24 Q1387.56 1855.34 1389.37 1858.91 Q1391.2 1862.45 1394.81 1862.45 Q1398.44 1862.45 1400.25 1858.91 Q1402.08 1855.34 1402.08 1848.24 Q1402.08 1841.11 1400.25 1837.57 Q1398.44 1834 1394.81 1834 M1394.81 1830.3 Q1400.62 1830.3 1403.68 1834.9 Q1406.75 1839.49 1406.75 1848.24 Q1406.75 1856.96 1403.68 1861.57 Q1400.62 1866.15 1394.81 1866.15 Q1389 1866.15 1385.92 1861.57 Q1382.87 1856.96 1382.87 1848.24 Q1382.87 1839.49 1385.92 1834.9 Q1389 1830.3 1394.81 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip460)" d="M1424.97 1834 Q1421.36 1834 1419.53 1837.57 Q1417.73 1841.11 1417.73 1848.24 Q1417.73 1855.34 1419.53 1858.91 Q1421.36 1862.45 1424.97 1862.45 Q1428.61 1862.45 1430.41 1858.91 Q1432.24 1855.34 1432.24 1848.24 Q1432.24 1841.11 1430.41 1837.57 Q1428.61 1834 1424.97 1834 M1424.97 1830.3 Q1430.78 1830.3 1433.84 1834.9 Q1436.92 1839.49 1436.92 1848.24 Q1436.92 1856.96 1433.84 1861.57 Q1430.78 1866.15 1424.97 1866.15 Q1419.16 1866.15 1416.08 1861.57 Q1413.03 1856.96 1413.03 1848.24 Q1413.03 1839.49 1416.08 1834.9 Q1419.16 1830.3 1424.97 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip460)" d="M1940.97 1830.92 L1963.19 1830.92 L1963.19 1832.91 L1950.65 1865.48 L1945.76 1865.48 L1957.57 1834.86 L1940.97 1834.86 L1940.97 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip460)" d="M1972.36 1830.92 L1990.71 1830.92 L1990.71 1834.86 L1976.64 1834.86 L1976.64 1843.33 Q1977.66 1842.98 1978.68 1842.82 Q1979.7 1842.64 1980.72 1842.64 Q1986.5 1842.64 1989.88 1845.81 Q1993.26 1848.98 1993.26 1854.4 Q1993.26 1859.97 1989.79 1863.08 Q1986.32 1866.15 1980 1866.15 Q1977.82 1866.15 1975.55 1865.78 Q1973.31 1865.41 1970.9 1864.67 L1970.9 1859.97 Q1972.98 1861.11 1975.21 1861.66 Q1977.43 1862.22 1979.9 1862.22 Q1983.91 1862.22 1986.25 1860.11 Q1988.59 1858.01 1988.59 1854.4 Q1988.59 1850.78 1986.25 1848.68 Q1983.91 1846.57 1979.9 1846.57 Q1978.03 1846.57 1976.15 1846.99 Q1974.3 1847.4 1972.36 1848.28 L1972.36 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip460)" d="M2012.47 1834 Q2008.86 1834 2007.03 1837.57 Q2005.23 1841.11 2005.23 1848.24 Q2005.23 1855.34 2007.03 1858.91 Q2008.86 1862.45 2012.47 1862.45 Q2016.11 1862.45 2017.91 1858.91 Q2019.74 1855.34 2019.74 1848.24 Q2019.74 1841.11 2017.91 1837.57 Q2016.11 1834 2012.47 1834 M2012.47 1830.3 Q2018.28 1830.3 2021.34 1834.9 Q2024.42 1839.49 2024.42 1848.24 Q2024.42 1856.96 2021.34 1861.57 Q2018.28 1866.15 2012.47 1866.15 Q2006.66 1866.15 2003.59 1861.57 Q2000.53 1856.96 2000.53 1848.24 Q2000.53 1839.49 2003.59 1834.9 Q2006.66 1830.3 2012.47 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip460)" d="M2514.84 1861.55 L2522.48 1861.55 L2522.48 1835.18 L2514.17 1836.85 L2514.17 1832.59 L2522.43 1830.92 L2527.11 1830.92 L2527.11 1861.55 L2534.75 1861.55 L2534.75 1865.48 L2514.84 1865.48 L2514.84 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip460)" d="M2554.19 1834 Q2550.58 1834 2548.75 1837.57 Q2546.94 1841.11 2546.94 1848.24 Q2546.94 1855.34 2548.75 1858.91 Q2550.58 1862.45 2554.19 1862.45 Q2557.82 1862.45 2559.63 1858.91 Q2561.46 1855.34 2561.46 1848.24 Q2561.46 1841.11 2559.63 1837.57 Q2557.82 1834 2554.19 1834 M2554.19 1830.3 Q2560 1830.3 2563.06 1834.9 Q2566.13 1839.49 2566.13 1848.24 Q2566.13 1856.96 2563.06 1861.57 Q2560 1866.15 2554.19 1866.15 Q2548.38 1866.15 2545.3 1861.57 Q2542.25 1856.96 2542.25 1848.24 Q2542.25 1839.49 2545.3 1834.9 Q2548.38 1830.3 2554.19 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip460)" d="M2584.35 1834 Q2580.74 1834 2578.91 1837.57 Q2577.11 1841.11 2577.11 1848.24 Q2577.11 1855.34 2578.91 1858.91 Q2580.74 1862.45 2584.35 1862.45 Q2587.99 1862.45 2589.79 1858.91 Q2591.62 1855.34 2591.62 1848.24 Q2591.62 1841.11 2589.79 1837.57 Q2587.99 1834 2584.35 1834 M2584.35 1830.3 Q2590.16 1830.3 2593.22 1834.9 Q2596.3 1839.49 2596.3 1848.24 Q2596.3 1856.96 2593.22 1861.57 Q2590.16 1866.15 2584.35 1866.15 Q2578.54 1866.15 2575.46 1861.57 Q2572.41 1856.96 2572.41 1848.24 Q2572.41 1839.49 2575.46 1834.9 Q2578.54 1830.3 2584.35 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip460)" d="M2614.51 1834 Q2610.9 1834 2609.07 1837.57 Q2607.27 1841.11 2607.27 1848.24 Q2607.27 1855.34 2609.07 1858.91 Q2610.9 1862.45 2614.51 1862.45 Q2618.15 1862.45 2619.95 1858.91 Q2621.78 1855.34 2621.78 1848.24 Q2621.78 1841.11 2619.95 1837.57 Q2618.15 1834 2614.51 1834 M2614.51 1830.3 Q2620.32 1830.3 2623.38 1834.9 Q2626.46 1839.49 2626.46 1848.24 Q2626.46 1856.96 2623.38 1861.57 Q2620.32 1866.15 2614.51 1866.15 Q2608.7 1866.15 2605.62 1861.57 Q2602.57 1856.96 2602.57 1848.24 Q2602.57 1839.49 2605.62 1834.9 Q2608.7 1830.3 2614.51 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip460)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1800.78 151.747,47.2441 "></polyline>
<polyline clip-path="url(#clip460)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1519.55 170.644,1519.55 "></polyline>
<polyline clip-path="url(#clip460)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1221.62 170.644,1221.62 "></polyline>
<polyline clip-path="url(#clip460)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,923.695 170.644,923.695 "></polyline>
<polyline clip-path="url(#clip460)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,625.767 170.644,625.767 "></polyline>
<polyline clip-path="url(#clip460)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,327.839 170.644,327.839 "></polyline>
<path clip-path="url(#clip460)" d="M49.5521 1520 L79.2279 1520 L79.2279 1523.94 L49.5521 1523.94 L49.5521 1520 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip460)" d="M99.8991 1517.69 Q96.7509 1517.69 94.8991 1519.84 Q93.0704 1521.99 93.0704 1525.74 Q93.0704 1529.47 94.8991 1531.65 Q96.7509 1533.8 99.8991 1533.8 Q103.047 1533.8 104.876 1531.65 Q106.728 1529.47 106.728 1525.74 Q106.728 1521.99 104.876 1519.84 Q103.047 1517.69 99.8991 1517.69 M109.181 1503.04 L109.181 1507.3 Q107.422 1506.46 105.617 1506.02 Q103.834 1505.58 102.075 1505.58 Q97.4454 1505.58 94.9917 1508.71 Q92.5612 1511.83 92.2139 1518.15 Q93.5797 1516.14 95.6398 1515.07 Q97.7 1513.99 100.177 1513.99 Q105.385 1513.99 108.394 1517.16 Q111.427 1520.3 111.427 1525.74 Q111.427 1531.07 108.279 1534.29 Q105.131 1537.5 99.8991 1537.5 Q93.9037 1537.5 90.7325 1532.92 Q87.5612 1528.31 87.5612 1519.59 Q87.5612 1511.39 91.45 1506.53 Q95.3389 1501.65 101.89 1501.65 Q103.649 1501.65 105.431 1501.99 Q107.237 1502.34 109.181 1503.04 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip460)" d="M50.3623 1222.08 L80.0381 1222.08 L80.0381 1226.01 L50.3623 1226.01 L50.3623 1222.08 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip460)" d="M104.297 1220.27 Q107.654 1220.99 109.529 1223.26 Q111.427 1225.52 111.427 1228.86 Q111.427 1233.97 107.908 1236.77 Q104.39 1239.58 97.9083 1239.58 Q95.7324 1239.58 93.4176 1239.14 Q91.126 1238.72 88.6723 1237.86 L88.6723 1233.35 Q90.6167 1234.48 92.9315 1235.06 Q95.2463 1235.64 97.7695 1235.64 Q102.168 1235.64 104.459 1233.9 Q106.774 1232.17 106.774 1228.86 Q106.774 1225.8 104.621 1224.09 Q102.492 1222.35 98.6722 1222.35 L94.6445 1222.35 L94.6445 1218.51 L98.8574 1218.51 Q102.306 1218.51 104.135 1217.14 Q105.964 1215.76 105.964 1213.16 Q105.964 1210.5 104.066 1209.09 Q102.191 1207.65 98.6722 1207.65 Q96.7509 1207.65 94.5519 1208.07 Q92.3528 1208.49 89.7139 1209.37 L89.7139 1205.2 Q92.376 1204.46 94.6908 1204.09 Q97.0287 1203.72 99.0889 1203.72 Q104.413 1203.72 107.515 1206.15 Q110.617 1208.56 110.617 1212.68 Q110.617 1215.55 108.973 1217.54 Q107.33 1219.51 104.297 1220.27 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip460)" d="M99.4824 909.494 Q95.8713 909.494 94.0426 913.059 Q92.2371 916.601 92.2371 923.73 Q92.2371 930.837 94.0426 934.401 Q95.8713 937.943 99.4824 937.943 Q103.117 937.943 104.922 934.401 Q106.751 930.837 106.751 923.73 Q106.751 916.601 104.922 913.059 Q103.117 909.494 99.4824 909.494 M99.4824 905.79 Q105.293 905.79 108.348 910.397 Q111.427 914.98 111.427 923.73 Q111.427 932.457 108.348 937.063 Q105.293 941.647 99.4824 941.647 Q93.6723 941.647 90.5936 937.063 Q87.538 932.457 87.538 923.73 Q87.538 914.98 90.5936 910.397 Q93.6723 905.79 99.4824 905.79 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip460)" d="M104.297 624.413 Q107.654 625.131 109.529 627.399 Q111.427 629.668 111.427 633.001 Q111.427 638.117 107.908 640.918 Q104.39 643.718 97.9083 643.718 Q95.7324 643.718 93.4176 643.279 Q91.126 642.862 88.6723 642.005 L88.6723 637.492 Q90.6167 638.626 92.9315 639.205 Q95.2463 639.783 97.7695 639.783 Q102.168 639.783 104.459 638.047 Q106.774 636.311 106.774 633.001 Q106.774 629.945 104.621 628.232 Q102.492 626.496 98.6722 626.496 L94.6445 626.496 L94.6445 622.654 L98.8574 622.654 Q102.306 622.654 104.135 621.288 Q105.964 619.899 105.964 617.307 Q105.964 614.644 104.066 613.232 Q102.191 611.797 98.6722 611.797 Q96.7509 611.797 94.5519 612.214 Q92.3528 612.631 89.7139 613.51 L89.7139 609.344 Q92.376 608.603 94.6908 608.232 Q97.0287 607.862 99.0889 607.862 Q104.413 607.862 107.515 610.293 Q110.617 612.7 110.617 616.82 Q110.617 619.691 108.973 621.681 Q107.33 623.649 104.297 624.413 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip460)" d="M99.8991 325.975 Q96.7509 325.975 94.8991 328.128 Q93.0704 330.281 93.0704 334.031 Q93.0704 337.758 94.8991 339.934 Q96.7509 342.086 99.8991 342.086 Q103.047 342.086 104.876 339.934 Q106.728 337.758 106.728 334.031 Q106.728 330.281 104.876 328.128 Q103.047 325.975 99.8991 325.975 M109.181 311.323 L109.181 315.582 Q107.422 314.749 105.617 314.309 Q103.834 313.869 102.075 313.869 Q97.4454 313.869 94.9917 316.994 Q92.5612 320.119 92.2139 326.438 Q93.5797 324.424 95.6398 323.36 Q97.7 322.272 100.177 322.272 Q105.385 322.272 108.394 325.443 Q111.427 328.591 111.427 334.031 Q111.427 339.355 108.279 342.572 Q105.131 345.79 99.8991 345.79 Q93.9037 345.79 90.7325 341.207 Q87.5612 336.6 87.5612 327.873 Q87.5612 319.679 91.45 314.818 Q95.3389 309.934 101.89 309.934 Q103.649 309.934 105.431 310.281 Q107.237 310.628 109.181 311.323 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip462)" style="stroke:#009af9; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,948.951 224.541,1282.82 226.891,1505.33 229.242,1318.15 231.592,1463.18 233.943,1491.44 236.293,1532.52 238.644,1524.65 240.994,1443.62 243.345,1408.86 245.695,1213.4 248.046,1462.94 250.396,1206.89 252.747,1327.72 255.097,1513.25 257.448,1359.56 259.798,1552.87 262.148,1657.03 264.499,1391.07 266.849,1430.29 269.2,1376.76 271.55,1380.32 273.901,1534.32 276.251,1615.64 278.602,1434.34 280.952,1363.96 283.303,1375.86 285.653,1360.63 288.004,1270.9 290.354,1482.44 292.705,1503.44 295.055,1499.31 297.406,1357.99 299.756,1272.3 302.107,1322.7 304.457,1377.88 306.807,1440.04 309.158,1529.7 311.508,1375.76 313.859,1618.92 316.209,1364.34 318.56,1438.61 320.91,1454.2 323.261,1337.06 325.611,1312.82 327.962,1421.54 330.312,1492.22 332.663,1336.7 335.013,1419.24 337.364,1471.29 339.714,1462.45 342.065,1723.15 344.415,1461.82 346.765,1485.85 349.116,1382.44 351.466,1408.03 353.817,1460.68 356.167,1521.31 358.518,1450.86 360.868,1432.99 363.219,1444.72 365.569,1324.34 367.92,1450.5 370.27,1406.61 372.621,1377.98 374.971,1528.57 377.322,1483.76 379.672,1457.76 382.023,1401.08 384.373,1381.2 386.724,1349.89 389.074,1404.43 391.424,1392.48 393.775,1390.25 396.125,1486.83 398.476,1420.97 400.826,1515.82 403.177,1466.66 405.527,1491.44 407.878,1489.82 410.228,1462.35 412.579,1514.07 414.929,1512.56 417.28,1450.56 419.63,1499.24 421.981,1276.27 424.331,1653.89 426.682,1384.89 429.032,1594.32 431.382,1538.67 433.733,1361.33 436.083,1373.71 438.434,1384.52 440.784,1390.36 443.135,1251.23 445.485,1504.8 447.836,1502.12 450.186,1465.11 452.537,1458.12 454.887,1496.29 457.238,1468.38 459.588,1607.64 461.939,1391.35 464.289,1507.51 466.64,1505.54 468.99,1432.4 471.341,1500.48 473.691,1563.93 476.041,1514.91 478.392,1550.87 480.742,1436.71 483.093,1349.77 485.443,1329.04 487.794,1470.97 490.144,1455.31 492.495,1558.49 494.845,1393.2 497.196,1561.72 499.546,1336.84 501.897,1443.27 504.247,1367.84 506.598,1318.7 508.948,1660.21 511.299,1381.73 513.649,1394.6 515.999,1537.13 518.35,1329.29 520.7,1452.53 523.051,1500.34 525.401,1492.36 527.752,1304.5 530.102,1364.03 532.453,1385.37 534.803,1526.35 537.154,1572.45 539.504,1491.13 541.855,1366.43 544.205,1546.84 546.556,1247 548.906,1517.87 551.257,1558.75 553.607,1456.6 555.958,1348.37 558.308,1313.87 560.658,1159.8 563.009,1422.29 565.359,1595.98 567.71,1575.8 570.06,1400.93 572.411,1231.18 574.761,1448.3 577.112,1536.02 579.462,1457.9 581.813,1439.47 584.163,1451.02 586.514,1505.98 588.864,1357.15 591.215,1388.41 593.565,1217.08 595.916,1328.14 598.266,1422.23 600.616,1442.01 602.967,1284.78 605.317,1565.86 607.668,1583.12 610.018,1442.18 612.369,1512.39 614.719,1355.22 617.07,1327.24 619.42,1402.19 621.771,1481.84 624.121,1396.27 626.472,1460.03 628.822,1352.08 631.173,1252.02 633.523,1270.46 635.874,1440.88 638.224,1541.53 640.575,1457.2 642.925,1514.14 645.275,1429.15 647.626,1495.74 649.976,1298.34 652.327,1510.44 654.677,1406.01 657.028,1198.28 659.378,1161.96 661.729,1398.49 664.079,1524.72 666.43,1328.99 668.78,1499.09 671.131,1184.38 673.481,1179 675.832,1612.17 678.182,1335.65 680.533,1415.27 682.883,1452.82 685.233,1348.32 687.584,1545.98 689.934,1416.67 692.285,1384.88 694.635,1373.07 696.986,1394.95 699.336,1350.52 701.687,1381.2 704.037,1163.72 706.388,1406.15 708.738,1308.78 711.089,1385 713.439,1397.22 715.79,1350.7 718.14,1409.04 720.491,1398.77 722.841,1312.18 725.192,1538.23 727.542,1357.18 729.892,1438.81 732.243,1504.66 734.593,1446.77 736.944,1395.02 739.294,1378 741.645,1341.57 743.995,1482.71 746.346,1460.61 748.696,1334.27 751.047,1391.27 753.397,1255.91 755.748,1342.67 758.098,1370.52 760.449,1492.22 762.799,1606.21 765.15,1464.16 767.5,1439.52 769.85,1423.36 772.201,1310.34 774.551,1434.62 776.902,1318.82 779.252,1517.76 781.603,1479.27 783.953,1407.35 786.304,1317.04 788.654,1438.12 791.005,1211.81 793.355,1525.81 795.706,1183.31 798.056,1464.26 800.407,1385.02 802.757,1450.36 805.108,1443.44 807.458,1264.8 809.809,1476.7 812.159,1413.75 814.509,1414.81 816.86,1314.02 819.21,1442.09 821.561,1517.37 823.911,1292 826.262,1396.9 828.612,1477.49 830.963,1336.56 833.313,1356.86 835.664,1308.35 838.014,1538.24 840.365,1369.66 842.715,1571.08 845.066,1285.83 847.416,1388.94 849.767,1446.55 852.117,1352.51 854.467,1393.9 856.818,1359.11 859.168,1357.35 861.519,1621.74 863.869,1409.14 866.22,1179.68 868.57,1423.37 870.921,1341.74 873.271,1404.61 875.622,1353.29 877.972,1550.38 880.323,1272.26 882.673,1578.89 885.024,1340.31 887.374,1491.09 889.725,1452.48 892.075,1502.06 894.426,1574.29 896.776,1467.79 899.126,1375.74 901.477,1392.94 903.827,1468.62 906.178,1342.33 908.528,1499.02 910.879,1357.22 913.229,1509.35 915.58,1189.07 917.93,1361.85 920.281,1354.66 922.631,1484.9 924.982,1191.77 927.332,1549.24 929.683,1449.73 932.033,1365.62 934.384,1382.86 936.734,1494.48 939.084,1462.13 941.435,1509.86 943.785,1328.5 946.136,1325.61 948.486,1546.83 950.837,1751.15 953.187,1317.53 955.538,1418.88 957.888,1531.77 960.239,1479.89 962.589,1350.09 964.94,1396.04 967.29,1296.03 969.641,1384.82 971.991,1383.27 974.342,1527.55 976.692,1236.43 979.043,1550.77 981.393,1396.64 983.743,1567.38 986.094,1268.43 988.444,1435.63 990.795,1473.08 993.145,1516.62 995.496,1351.97 997.846,1480.47 1000.2,1284.05 1002.55,1505.63 1004.9,1519.36 1007.25,1474.1 1009.6,1418.56 1011.95,1503.7 1014.3,1505.44 1016.65,1483.83 1019,1365.66 1021.35,1378.81 1023.7,1330.7 1026.05,1404.79 1028.4,1474.25 1030.75,1585.5 1033.1,1410.97 1035.45,1463.28 1037.8,1395.59 1040.15,1404.8 1042.51,1520.91 1044.86,1327.28 1047.21,1492.45 1049.56,1408.18 1051.91,1327.6 1054.26,1501.8 1056.61,1622.5 1058.96,1518.33 1061.31,1530.41 1063.66,1253.26 1066.01,1497.5 1068.36,1415.55 1070.71,1449.13 1073.06,1592.91 1075.41,1480.72 1077.76,1278.92 1080.11,1495.48 1082.46,1222.34 1084.81,1326.66 1087.16,1291.9 1089.51,1418.19 1091.87,1173.24 1094.22,1271.63 1096.57,1387.97 1098.92,1212.13 1101.27,1500.05 1103.62,1528.65 1105.97,1325.64 1108.32,1390.18 1110.67,1329.93 1113.02,1509.59 1115.37,1493.7 1117.72,1252.09 1120.07,1313.76 1122.42,1265.29 1124.77,1343.18 1127.12,1393.57 1129.47,1287.35 1131.82,1419.31 1134.17,1324.22 1136.52,1226.6 1138.87,1483.89 1141.23,1317.36 1143.58,1450.54 1145.93,1243.12 1148.28,1416.43 1150.63,1379.44 1152.98,1451.5 1155.33,1433.73 1157.68,1519.43 1160.03,1332.74 1162.38,1495.67 1164.73,1365.43 1167.08,1397.29 1169.43,1282.51 1171.78,1272.92 1174.13,1551.19 1176.48,1305.66 1178.83,1408.66 1181.18,1492.35 1183.53,1178.24 1185.88,1381.3 1188.23,1475.39 1190.59,1266.22 1192.94,1363.64 1195.29,1533.03 1197.64,1392.69 1199.99,1251.87 1202.34,1227.79 1204.69,1334.5 1207.04,1383.84 1209.39,1492.28 1211.74,1355.81 1214.09,1285.94 1216.44,1409.94 1218.79,1459.86 1221.14,1230.68 1223.49,1326.96 1225.84,1653.88 1228.19,1440.81 1230.54,1278.96 1232.89,1433.6 1235.24,1557.55 1237.59,1361.92 1239.94,1503.13 1242.3,1462.58 1244.65,1144.71 1247,1442.71 1249.35,1393.52 1251.7,1318.16 1254.05,1416.36 1256.4,1530.71 1258.75,1468.23 1261.1,1501.62 1263.45,1487.43 1265.8,1497.7 1268.15,1398.48 1270.5,1271.76 1272.85,1295.69 1275.2,1466.93 1277.55,1448.58 1279.9,1414.15 1282.25,1545.18 1284.6,1273.61 1286.95,1517.49 1289.3,1409.22 1291.66,1445.84 1294.01,1598.68 1296.36,1371.04 1298.71,1516.55 1301.06,1456.24 1303.41,1478.73 1305.76,1288.01 1308.11,1409.27 1310.46,1580.87 1312.81,1539.83 1315.16,1357.35 1317.51,1383.28 1319.86,1648.54 1322.21,1325.83 1324.56,1524.85 1326.91,1584.38 1329.26,1466.16 1331.61,1465.56 1333.96,1495.61 1336.31,1386.13 1338.66,1348.76 1341.02,1399.66 1343.37,1402.88 1345.72,1466.91 1348.07,1400.8 1350.42,1584.13 1352.77,1532.23 1355.12,1539.18 1357.47,1564.04 1359.82,1371.95 1362.17,1520.86 1364.52,1450.07 1366.87,1398.81 1369.22,1484.19 1371.57,1338.43 1373.92,1456.23 1376.27,1352.45 1378.62,1492.49 1380.97,1445.72 1383.32,1489.06 1385.67,1597.47 1388.02,1656.7 1390.38,1462.13 1392.73,1285.29 1395.08,1337.39 1397.43,1395.96 1399.78,1421.66 1402.13,1477.7 1404.48,1456.49 1406.83,1351.63 1409.18,1284.66 1411.53,1350.44 1413.88,1529.24 1416.23,1366.37 1418.58,1408.55 1420.93,1282.95 1423.28,1294.47 1425.63,1412.54 1427.98,1514.92 1430.33,1373.47 1432.68,1402.22 1435.03,1253.98 1437.38,1352.26 1439.74,1448.45 1442.09,1274.1 1444.44,1407.91 1446.79,1396.19 1449.14,1406.72 1451.49,1385.33 1453.84,1242 1456.19,1408.36 1458.54,1421.92 1460.89,1290.41 1463.24,1461.41 1465.59,1508.18 1467.94,1375.67 1470.29,1522.81 1472.64,1466.81 1474.99,1141.32 1477.34,1440.91 1479.69,1292.95 1482.04,1343.33 1484.39,1374.84 1486.74,1203.28 1489.1,1448.96 1491.45,1466.8 1493.8,1253.71 1496.15,1468.01 1498.5,1398.92 1500.85,1374.95 1503.2,1315.2 1505.55,1313.75 1507.9,1212.95 1510.25,1332.49 1512.6,1482.35 1514.95,1274.65 1517.3,1448.97 1519.65,1456.24 1522,1284.28 1524.35,1334.77 1526.7,1408.59 1529.05,1477.47 1531.4,1522.61 1533.75,1508.74 1536.1,1290.99 1538.45,1323.68 1540.81,1401.04 1543.16,1345.17 1545.51,1390.07 1547.86,1314.49 1550.21,1339.67 1552.56,1453.28 1554.91,1303.65 1557.26,1171.18 1559.61,1283.42 1561.96,1383.48 1564.31,1613.7 1566.66,1558.13 1569.01,1404.02 1571.36,1573.61 1573.71,1356.69 1576.06,1427.73 1578.41,1409.68 1580.76,1486.71 1583.11,1233.6 1585.46,1481.45 1587.81,1328.98 1590.17,1324.52 1592.52,1464.39 1594.87,1274.14 1597.22,1353.09 1599.57,1465.38 1601.92,1469.27 1604.27,1233.65 1606.62,1267.41 1608.97,1499.54 1611.32,1384.08 1613.67,1336.02 1616.02,1436.74 1618.37,1344.08 1620.72,1402.15 1623.07,1354 1625.42,1467.87 1627.77,1408.5 1630.12,1334.51 1632.47,1331.49 1634.82,1407.63 1637.17,1503.01 1639.53,1565.54 1641.88,1455.75 1644.23,1365.79 1646.58,1395.71 1648.93,1213.02 1651.28,1445.05 1653.63,1301.13 1655.98,1323.67 1658.33,1504.96 1660.68,1433.47 1663.03,1339.33 1665.38,1268.08 1667.73,1407.62 1670.08,1335.79 1672.43,1457.38 1674.78,1530.73 1677.13,1381.76 1679.48,1524.1 1681.83,1376 1684.18,1314.22 1686.53,1662.35 1688.89,1416.47 1691.24,1451.81 1693.59,1435.82 1695.94,1415.29 1698.29,1552.36 1700.64,1578.69 1702.99,1381.84 1705.34,1317.87 1707.69,1494.18 1710.04,1342.07 1712.39,1518.49 1714.74,1366.15 1717.09,1468.47 1719.44,1623.35 1721.79,1370.76 1724.14,1651.45 1726.49,1485.17 1728.84,1234.87 1731.19,1287.45 1733.54,1418.2 1735.89,1331.89 1738.25,1455.24 1740.6,1370.92 1742.95,1477.43 1745.3,1341.66 1747.65,1489.04 1750,1273.04 1752.35,1538.85 1754.7,1451.03 1757.05,1394.39 1759.4,1388.14 1761.75,1365.66 1764.1,1354.33 1766.45,1529.34 1768.8,1341.71 1771.15,1464.55 1773.5,1406.87 1775.85,1370.29 1778.2,1485.68 1780.55,1307.79 1782.9,1450.61 1785.25,1439.96 1787.6,1410.1 1789.96,1486.25 1792.31,1149.21 1794.66,1355.1 1797.01,1517.79 1799.36,1389.7 1801.71,1511.63 1804.06,1449.4 1806.41,1433.17 1808.76,1237.18 1811.11,1567.38 1813.46,1572.7 1815.81,1349.93 1818.16,1342.47 1820.51,1467.71 1822.86,1329.66 1825.21,1614.55 1827.56,1245.59 1829.91,1298.23 1832.26,1321.36 1834.61,1372.58 1836.96,1325.14 1839.32,1489.43 1841.67,1440.13 1844.02,1466.11 1846.37,1222.74 1848.72,1427.07 1851.07,1397.3 1853.42,1260.36 1855.77,1416.18 1858.12,1470.64 1860.47,1383.13 1862.82,1371.02 1865.17,1473.21 1867.52,1561.2 1869.87,1445.44 1872.22,1449.95 1874.57,1411.62 1876.92,1525.71 1879.27,1521.58 1881.62,1408.43 1883.97,1352.11 1886.32,1193.29 1888.68,1359.01 1891.03,1406.78 1893.38,1531.31 1895.73,1552.02 1898.08,1395.1 1900.43,1264.49 1902.78,1552.76 1905.13,1530.29 1907.48,1371.92 1909.83,1455.31 1912.18,1290.86 1914.53,1433.57 1916.88,1172.72 1919.23,1530.45 1921.58,1507.01 1923.93,1245.51 1926.28,1543.3 1928.63,1375.91 1930.98,1523.93 1933.33,1480.77 1935.68,1442.2 1938.04,1385.68 1940.39,1343.77 1942.74,1685.8 1945.09,1370.62 1947.44,1479.09 1949.79,1349.57 1952.14,1310.66 1954.49,1331.65 1956.84,1596.04 1959.19,1336.82 1961.54,1353.79 1963.89,1372.77 1966.24,1405.3 1968.59,1448.35 1970.94,1318.31 1973.29,1388.02 1975.64,1300.03 1977.99,1638.55 1980.34,1344.58 1982.69,1234.33 1985.04,1549.05 1987.4,1376.2 1989.75,1439.5 1992.1,1427.76 1994.45,1494.6 1996.8,1417.63 1999.15,1535.97 2001.5,1565.26 2003.85,1274.95 2006.2,1416.7 2008.55,1493.1 2010.9,1307.99 2013.25,1423.11 2015.6,1392.7 2017.95,1421.46 2020.3,1379.82 2022.65,1445.58 2025,1544.25 2027.35,1462.48 2029.7,1392.9 2032.05,1330.29 2034.4,1590.8 2036.76,1370.71 2039.11,1309.4 2041.46,1370.25 2043.81,1443.03 2046.16,1503.98 2048.51,1433.32 2050.86,1551.2 2053.21,1654.26 2055.56,1450.31 2057.91,1371.45 2060.26,1481.16 2062.61,1505.19 2064.96,1486.44 2067.31,1518.97 2069.66,1316.16 2072.01,1537.2 2074.36,1412.73 2076.71,1265.84 2079.06,1311 2081.41,1218.86 2083.76,1503.73 2086.11,1482.96 2088.47,1481.49 2090.82,1533.02 2093.17,1291.25 2095.52,1373.9 2097.87,1398.62 2100.22,1395.21 2102.57,1371.97 2104.92,1336.3 2107.27,1315.69 2109.62,1359.06 2111.97,1494.7 2114.32,1512.6 2116.67,1331.54 2119.02,1248.6 2121.37,1368.65 2123.72,1197.57 2126.07,1285.19 2128.42,1531.46 2130.77,1612.48 2133.12,1342.76 2135.47,1423.12 2137.83,1367.37 2140.18,1270.11 2142.53,1460.51 2144.88,1354.38 2147.23,1349.09 2149.58,1349.31 2151.93,1465.11 2154.28,1277.54 2156.63,1411.11 2158.98,1318.94 2161.33,1314.55 2163.68,1365.92 2166.03,1403.61 2168.38,1243.81 2170.73,1376.4 2173.08,1347.55 2175.43,1453.92 2177.78,1388.95 2180.13,1439.13 2182.48,1558.75 2184.83,1303.34 2187.19,1420.49 2189.54,1506.97 2191.89,1438.13 2194.24,1454.52 2196.59,1327.74 2198.94,1298.81 2201.29,1451.56 2203.64,1517.22 2205.99,1296.73 2208.34,1455.92 2210.69,1405.75 2213.04,1415.12 2215.39,1555.73 2217.74,1357.76 2220.09,1586.24 2222.44,1442.93 2224.79,1386.29 2227.14,1214.46 2229.49,1340.48 2231.84,1377.74 2234.19,1236.34 2236.55,1405.8 2238.9,1282.38 2241.25,1430.99 2243.6,1616.99 2245.95,1472.22 2248.3,1369.41 2250.65,1486.54 2253,1488.64 2255.35,1675.54 2257.7,1424.29 2260.05,1461.61 2262.4,1403.45 2264.75,1337.83 2267.1,1268.73 2269.45,1429.87 2271.8,1495.04 2274.15,1489.78 2276.5,1367.05 2278.85,1323.95 2281.2,1206.76 2283.55,1494.03 2285.91,1325.14 2288.26,1335.76 2290.61,1445.11 2292.96,1364.51 2295.31,1561.06 2297.66,1452.48 2300.01,1267.87 2302.36,1412.93 2304.71,1316.06 2307.06,1439 2309.41,1265.95 2311.76,1408.28 2314.11,1553.75 2316.46,1421.32 2318.81,1498.1 2321.16,1598 2323.51,1371.61 2325.86,1514.95 2328.21,1455.87 2330.56,1328.92 2332.91,1362.01 2335.27,1463.3 2337.62,1589.16 2339.97,1563.67 2342.32,1520.33 2344.67,1481.77 2347.02,1384.41 2349.37,1322.04 2351.72,1326.01 2354.07,1512.29 2356.42,1440.78 2358.77,1546.41 2361.12,1483.16 2363.47,1327.15 2365.82,1405.66 2368.17,1449.3 2370.52,1425.99 2372.87,1449.57 2375.22,1355.97 2377.57,1331.75 2379.92,1366.39 2382.27,1456.23 2384.62,1312.68 2386.98,1325.19 2389.33,1529.73 2391.68,1425.25 2394.03,1365.76 2396.38,1584.74 2398.73,1521.64 2401.08,1338.35 2403.43,1368.01 2405.78,1416.84 2408.13,1461.18 2410.48,1512.53 2412.83,1418.59 2415.18,1485.37 2417.53,1327.81 2419.88,1532.94 2422.23,1353.79 2424.58,1491.12 2426.93,1394.1 2429.28,1230.79 2431.63,1271.04 2433.98,1406.76 2436.34,1502.92 2438.69,1356.12 2441.04,1461.86 2443.39,1401.19 2445.74,1449.76 2448.09,1452.51 2450.44,1387.64 2452.79,1514.14 2455.14,1500.18 2457.49,1368.72 2459.84,1420.58 2462.19,1397.29 2464.54,1365.33 2466.89,1308 2469.24,1403.09 2471.59,1495.5 2473.94,1569.08 2476.29,1457.79 2478.64,1387.99 2480.99,1528.56 2483.34,1409.82 2485.7,1292.36 2488.05,1417.01 2490.4,1475.45 2492.75,1269.71 2495.1,1248.36 2497.45,1492.98 2499.8,1397.67 2502.15,1560.08 2504.5,1402.12 2506.85,1413.78 2509.2,1435.81 2511.55,1506.97 2513.9,1690.57 2516.25,1389.51 2518.6,1466.48 2520.95,1501.04 2523.3,1572.35 2525.65,1273.4 2528,1214.05 2530.35,1528.44 2532.7,1587.16 2535.06,1424.75 2537.41,1251.56 2539.76,1458.59 2542.11,1489.62 2544.46,1276.93 2546.81,1448.04 2549.16,1247.09 2551.51,1440.11 2553.86,1535.24 2556.21,1572.75 2558.56,1511.8 2560.91,1542.13 2563.26,1311.74 2565.61,1367.15 2567.96,1519.99 2570.31,1319.11 "></polyline>
<polyline clip-path="url(#clip462)" style="stroke:#e26f46; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,913.653 224.541,1033.39 226.891,983.935 229.242,979.136 231.592,956.833 233.943,820.122 236.293,1013.74 238.644,817.363 240.994,1042.72 243.345,975.327 245.695,929.57 248.046,853.996 250.396,812.345 252.747,1032.46 255.097,994.519 257.448,1126.07 259.798,860.814 262.148,890.043 264.499,1043.51 266.849,851.818 269.2,842.376 271.55,871.953 273.901,958.365 276.251,951.978 278.602,854.185 280.952,916.999 283.303,876.198 285.653,1019.42 288.004,754.184 290.354,810.842 292.705,736.723 295.055,893.553 297.406,866.51 299.756,990.346 302.107,1051.6 304.457,735.427 306.807,1054.87 309.158,1054.52 311.508,1041.55 313.859,912.625 316.209,850.282 318.56,802.576 320.91,1068.14 323.261,1002.88 325.611,988.597 327.962,1110.94 330.312,652.362 332.663,942.358 335.013,796.706 337.364,883.167 339.714,895.679 342.065,1074.6 344.415,1037.06 346.765,802.529 349.116,739.358 351.466,987 353.817,860.547 356.167,814.668 358.518,1003.45 360.868,1078.3 363.219,921.597 365.569,834.144 367.92,843.34 370.27,900.282 372.621,914.408 374.971,835.035 377.322,1070.59 379.672,994.185 382.023,956.606 384.373,790.109 386.724,987.851 389.074,980.746 391.424,912.226 393.775,1088.39 396.125,861.549 398.476,958.829 400.826,790.49 403.177,1059.26 405.527,791.259 407.878,825.916 410.228,900.263 412.579,1021.49 414.929,1020.09 417.28,933.122 419.63,828.782 421.981,767.951 424.331,999.334 426.682,948.586 429.032,986.156 431.382,872.672 433.733,1059.51 436.083,877.666 438.434,1080.26 440.784,805.325 443.135,798.272 445.485,1005.82 447.836,765.066 450.186,834.157 452.537,887.703 454.887,769.078 457.238,968.864 459.588,960.878 461.939,697.237 464.289,999.001 466.64,819.643 468.99,1089.52 471.341,786.952 473.691,939.544 476.041,906.161 478.392,964.849 480.742,940.643 483.093,1005.85 485.443,969.323 487.794,969.746 490.144,956.088 492.495,826.628 494.845,945.075 497.196,1017.8 499.546,1120.4 501.897,994.244 504.247,947.667 506.598,771.432 508.948,711.164 511.299,1006.35 513.649,1077.98 515.999,864.211 518.35,915.769 520.7,790.498 523.051,772.859 525.401,925.841 527.752,1118.1 530.102,884.542 532.453,853.894 534.803,929.079 537.154,923.764 539.504,908.065 541.855,623.367 544.205,917.958 546.556,844.038 548.906,796.797 551.257,1090.23 553.607,1028.38 555.958,909.514 558.308,1171.41 560.658,1141.77 563.009,830.464 565.359,907.824 567.71,925.363 570.06,985.391 572.411,848.123 574.761,866.127 577.112,821.531 579.462,985.808 581.813,1178.43 584.163,838.517 586.514,971.716 588.864,853.637 591.215,824.323 593.565,856.664 595.916,1032.03 598.266,786.36 600.616,859.674 602.967,1019.73 605.317,1005.33 607.668,901.267 610.018,982.909 612.369,929.418 614.719,871.971 617.07,845.731 619.42,829.731 621.771,871.691 624.121,923.666 626.472,766.879 628.822,927.683 631.173,817.946 633.523,1105.08 635.874,921.533 638.224,860.284 640.575,911.594 642.925,888.192 645.275,877.876 647.626,984.345 649.976,1013.58 652.327,921.446 654.677,900.531 657.028,1017.11 659.378,1050.9 661.729,927.723 664.079,991.159 666.43,745.144 668.78,842.253 671.131,899.038 673.481,1140.5 675.832,793.923 678.182,907.315 680.533,930.126 682.883,883.028 685.233,836.973 687.584,766.251 689.934,943.394 692.285,1133.04 694.635,1011.95 696.986,1014.11 699.336,1060.01 701.687,960.642 704.037,984.823 706.388,1016.25 708.738,828.479 711.089,777.72 713.439,954.893 715.79,1073.27 718.14,704.335 720.491,929.872 722.841,1075.42 725.192,1017.31 727.542,853.031 729.892,954.629 732.243,924.502 734.593,935.654 736.944,1038.87 739.294,903.609 741.645,743.818 743.995,1075.29 746.346,1040.04 748.696,989.726 751.047,743.798 753.397,1050.87 755.748,1171.06 758.098,1033.19 760.449,827.556 762.799,930.965 765.15,805.279 767.5,958.908 769.85,933.941 772.201,788.163 774.551,897.817 776.902,975.948 779.252,863.933 781.603,999.064 783.953,965.388 786.304,837.095 788.654,870.623 791.005,782.674 793.355,877.936 795.706,1011.2 798.056,927.842 800.407,1038.55 802.757,1103.12 805.108,943.404 807.458,901.938 809.809,1001.68 812.159,1096.25 814.509,776.98 816.86,859.256 819.21,847.889 821.561,970.71 823.911,816.214 826.262,903.393 828.612,837.828 830.963,1044.77 833.313,888.661 835.664,801.593 838.014,784.244 840.365,785.859 842.715,796.92 845.066,850.114 847.416,948.233 849.767,992.853 852.117,1004.65 854.467,903.541 856.818,1006.54 859.168,888.203 861.519,901.064 863.869,936.681 866.22,902.884 868.57,974.549 870.921,1021.63 873.271,833.527 875.622,960.669 877.972,1094.27 880.323,985.08 882.673,930.222 885.024,961.362 887.374,1018.26 889.725,911.998 892.075,1010.76 894.426,974.707 896.776,921.421 899.126,972.138 901.477,956.16 903.827,923.857 906.178,864.252 908.528,998.766 910.879,912.447 913.229,1010.8 915.58,790.449 917.93,926.993 920.281,965.709 922.631,669.606 924.982,1051.38 927.332,773.771 929.683,871.186 932.033,931.019 934.384,1000.71 936.734,804.358 939.084,953.443 941.435,964.396 943.785,881.434 946.136,846.691 948.486,937.132 950.837,844.155 953.187,1091.96 955.538,743.927 957.888,867.338 960.239,713.803 962.589,1190.26 964.94,767.763 967.29,1037.7 969.641,967.457 971.991,1044.36 974.342,908.732 976.692,971.666 979.043,825.287 981.393,765.417 983.743,948.304 986.094,915.373 988.444,827.471 990.795,925.887 993.145,939.681 995.496,851.85 997.846,1034.07 1000.2,812.195 1002.55,936.39 1004.9,1024.07 1007.25,873.992 1009.6,958.399 1011.95,1003.78 1014.3,1074.01 1016.65,817.088 1019,1117.76 1021.35,616.929 1023.7,1106.69 1026.05,1030.75 1028.4,796.428 1030.75,901.632 1033.1,1056.01 1035.45,897.919 1037.8,983.949 1040.15,811.4 1042.51,769.386 1044.86,824.836 1047.21,969.762 1049.56,859.591 1051.91,895.002 1054.26,822.222 1056.61,1039.4 1058.96,993.538 1061.31,828.243 1063.66,843.16 1066.01,853.297 1068.36,775.258 1070.71,1022.92 1073.06,976.432 1075.41,929.234 1077.76,954.924 1080.11,1227.35 1082.46,836.383 1084.81,836.954 1087.16,785.468 1089.51,887.553 1091.87,1000.28 1094.22,793.019 1096.57,957.678 1098.92,1021.8 1101.27,795.809 1103.62,905.452 1105.97,833.179 1108.32,873.77 1110.67,952.813 1113.02,742.335 1115.37,1004.96 1117.72,1033.24 1120.07,916.887 1122.42,863.865 1124.77,864.496 1127.12,879.756 1129.47,826.078 1131.82,911.107 1134.17,908.9 1136.52,887.975 1138.87,910.061 1141.23,898.794 1143.58,810.356 1145.93,897.989 1148.28,987.517 1150.63,1020.97 1152.98,853.012 1155.33,895.233 1157.68,687.783 1160.03,1132.57 1162.38,783.588 1164.73,782.861 1167.08,888.489 1169.43,969.766 1171.78,817.587 1174.13,969.802 1176.48,974.875 1178.83,687.682 1181.18,1003.4 1183.53,963.468 1185.88,919.779 1188.23,778.869 1190.59,1001 1192.94,1015.66 1195.29,968.226 1197.64,1007.63 1199.99,865.727 1202.34,829.865 1204.69,861.94 1207.04,757.058 1209.39,1070.32 1211.74,830.587 1214.09,889.113 1216.44,739.18 1218.79,916.705 1221.14,1040.67 1223.49,843.481 1225.84,1050.6 1228.19,938.665 1230.54,772.169 1232.89,993.967 1235.24,968.827 1237.59,1019.56 1239.94,867.814 1242.3,945.697 1244.65,878.393 1247,904.123 1249.35,948.589 1251.7,960.928 1254.05,937.967 1256.4,800.384 1258.75,912.636 1261.1,783.024 1263.45,918.476 1265.8,1022.19 1268.15,801.863 1270.5,864.229 1272.85,780.011 1275.2,884.469 1277.55,1160.33 1279.9,1215.71 1282.25,910.698 1284.6,913.645 1286.95,1027.69 1289.3,818.847 1291.66,777.852 1294.01,1001.08 1296.36,971.05 1298.71,1053.97 1301.06,880.839 1303.41,957.91 1305.76,847.244 1308.11,914.522 1310.46,865.45 1312.81,712.646 1315.16,1020.8 1317.51,1034.91 1319.86,967.06 1322.21,843.046 1324.56,1049.36 1326.91,1000.04 1329.26,906.719 1331.61,995.53 1333.96,988.932 1336.31,977.356 1338.66,1038.14 1341.02,1024.37 1343.37,939.018 1345.72,861.262 1348.07,850.923 1350.42,955.895 1352.77,911.826 1355.12,1034.16 1357.47,1004.28 1359.82,946.746 1362.17,848.166 1364.52,883.218 1366.87,1030.27 1369.22,984.603 1371.57,902.418 1373.92,902.294 1376.27,862.465 1378.62,989.593 1380.97,1212.01 1383.32,872.05 1385.67,980.102 1388.02,903.425 1390.38,889.54 1392.73,778.675 1395.08,991.621 1397.43,947.443 1399.78,858.264 1402.13,796.417 1404.48,1020.89 1406.83,912.969 1409.18,903.99 1411.53,841.791 1413.88,752.724 1416.23,1000.58 1418.58,950.046 1420.93,937.795 1423.28,996.323 1425.63,943.487 1427.98,817.546 1430.33,894.642 1432.68,893.127 1435.03,847.042 1437.38,986.566 1439.74,924.071 1442.09,999.002 1444.44,887.679 1446.79,893.514 1449.14,942.015 1451.49,890.5 1453.84,701.555 1456.19,981.528 1458.54,870.134 1460.89,1058.64 1463.24,917.99 1465.59,846.989 1467.94,1102.88 1470.29,740.395 1472.64,830.317 1474.99,891.328 1477.34,905.998 1479.69,990.803 1482.04,976.979 1484.39,1019.46 1486.74,1121.88 1489.1,977.634 1491.45,794.556 1493.8,911.592 1496.15,854.334 1498.5,908.39 1500.85,852.804 1503.2,951.995 1505.55,842.101 1507.9,894.881 1510.25,965.402 1512.6,1167.58 1514.95,929.238 1517.3,1187.27 1519.65,931.419 1522,920.343 1524.35,883.259 1526.7,958.072 1529.05,1037.44 1531.4,1080.17 1533.75,962.457 1536.1,920.038 1538.45,954.09 1540.81,948.912 1543.16,1127.52 1545.51,821.924 1547.86,874.223 1550.21,861.526 1552.56,1044.4 1554.91,1014.94 1557.26,906.575 1559.61,764.66 1561.96,978.345 1564.31,951.138 1566.66,858.708 1569.01,1047.84 1571.36,920.585 1573.71,953.278 1576.06,1019.61 1578.41,985.165 1580.76,936.438 1583.11,860.071 1585.46,967.403 1587.81,981.926 1590.17,965.067 1592.52,751.354 1594.87,760.23 1597.22,908.3 1599.57,922.746 1601.92,918.507 1604.27,998.512 1606.62,914.178 1608.97,923.249 1611.32,974.126 1613.67,917.747 1616.02,1049.12 1618.37,1129.04 1620.72,883.772 1623.07,989.464 1625.42,897.584 1627.77,861.213 1630.12,1048.06 1632.47,994.694 1634.82,817.66 1637.17,1013.1 1639.53,980.858 1641.88,846.336 1644.23,961.869 1646.58,933.674 1648.93,829.273 1651.28,851.434 1653.63,942.899 1655.98,811.274 1658.33,944.968 1660.68,933.381 1663.03,850.474 1665.38,821.259 1667.73,879.634 1670.08,882.666 1672.43,858.795 1674.78,804.847 1677.13,912.73 1679.48,889.958 1681.83,1035.83 1684.18,794.321 1686.53,902.978 1688.89,829.906 1691.24,829.549 1693.59,1113.67 1695.94,918.173 1698.29,817.864 1700.64,848.584 1702.99,963.35 1705.34,856.273 1707.69,1051.62 1710.04,923.651 1712.39,884.75 1714.74,890.498 1717.09,1000.39 1719.44,831.36 1721.79,998.14 1724.14,952.017 1726.49,915.742 1728.84,884.908 1731.19,936.517 1733.54,908.607 1735.89,958.766 1738.25,958.738 1740.6,943.603 1742.95,919.788 1745.3,831.005 1747.65,1038.85 1750,887.853 1752.35,1110.97 1754.7,1066.83 1757.05,906.455 1759.4,943.185 1761.75,971.124 1764.1,884.878 1766.45,1028.44 1768.8,955.67 1771.15,1090.63 1773.5,968.161 1775.85,933.839 1778.2,832.231 1780.55,875.453 1782.9,1013.12 1785.25,954.88 1787.6,806.488 1789.96,838.044 1792.31,964.061 1794.66,927.167 1797.01,1079.07 1799.36,963.262 1801.71,765.345 1804.06,932.4 1806.41,676.004 1808.76,946.573 1811.11,989.774 1813.46,816.356 1815.81,949.614 1818.16,898.322 1820.51,873.937 1822.86,934.604 1825.21,818.932 1827.56,808.062 1829.91,1016.23 1832.26,956.244 1834.61,944.842 1836.96,924.176 1839.32,894.658 1841.67,1216.92 1844.02,805.738 1846.37,971.667 1848.72,801.413 1851.07,942.064 1853.42,829.562 1855.77,956.83 1858.12,728.647 1860.47,897.53 1862.82,1088.37 1865.17,915.316 1867.52,893.586 1869.87,879.831 1872.22,897.83 1874.57,1011.8 1876.92,1031.37 1879.27,895.754 1881.62,862.101 1883.97,1020.86 1886.32,879.158 1888.68,1007.62 1891.03,934.981 1893.38,758.399 1895.73,1037.73 1898.08,919.502 1900.43,960.659 1902.78,851.706 1905.13,940.779 1907.48,886.696 1909.83,924.884 1912.18,929.417 1914.53,795.276 1916.88,909.785 1919.23,955.479 1921.58,873.003 1923.93,761.086 1926.28,922.142 1928.63,775.018 1930.98,973.93 1933.33,950.971 1935.68,866.012 1938.04,929.85 1940.39,810.743 1942.74,1024.92 1945.09,1130.48 1947.44,1017.94 1949.79,798.678 1952.14,961.718 1954.49,991.155 1956.84,959.507 1959.19,987.367 1961.54,1054.85 1963.89,1023.23 1966.24,983.548 1968.59,1074.72 1970.94,933.303 1973.29,973.809 1975.64,1017.15 1977.99,988.191 1980.34,814.663 1982.69,1020.88 1985.04,1069.57 1987.4,1115.14 1989.75,1001.49 1992.1,879.217 1994.45,963.505 1996.8,783.626 1999.15,945.522 2001.5,869.017 2003.85,861.584 2006.2,988.409 2008.55,901.877 2010.9,919.897 2013.25,907.357 2015.6,1027.41 2017.95,966.575 2020.3,792.688 2022.65,806.95 2025,936.608 2027.35,984.577 2029.7,805.268 2032.05,926.636 2034.4,869.737 2036.76,853.157 2039.11,906.233 2041.46,1012.63 2043.81,938.211 2046.16,763.659 2048.51,877.673 2050.86,985.35 2053.21,881.43 2055.56,1021.94 2057.91,808.147 2060.26,792.656 2062.61,826.508 2064.96,1043.83 2067.31,832.561 2069.66,808.465 2072.01,936.444 2074.36,1079.03 2076.71,930.902 2079.06,768.806 2081.41,712.344 2083.76,1035.82 2086.11,847.5 2088.47,910.937 2090.82,931.287 2093.17,895.191 2095.52,934.711 2097.87,772.81 2100.22,803.675 2102.57,920.209 2104.92,849.223 2107.27,1083.6 2109.62,1037.98 2111.97,923.207 2114.32,997.609 2116.67,1073.29 2119.02,985.748 2121.37,999.219 2123.72,940.443 2126.07,874.006 2128.42,670.165 2130.77,905.623 2133.12,906.493 2135.47,1005.83 2137.83,824.63 2140.18,1030.42 2142.53,929.371 2144.88,1082.44 2147.23,849.674 2149.58,954.319 2151.93,957.532 2154.28,948.919 2156.63,863.262 2158.98,916.905 2161.33,950.971 2163.68,938.12 2166.03,1131.06 2168.38,1015.32 2170.73,895.263 2173.08,930.494 2175.43,804.134 2177.78,888.422 2180.13,723.791 2182.48,945.036 2184.83,959.179 2187.19,976.903 2189.54,822.73 2191.89,1026.06 2194.24,867.496 2196.59,949.496 2198.94,994.602 2201.29,800.971 2203.64,919.794 2205.99,805.693 2208.34,992.479 2210.69,749.604 2213.04,873.073 2215.39,1019.13 2217.74,866.947 2220.09,859.14 2222.44,791.805 2224.79,1032.37 2227.14,759.019 2229.49,718.31 2231.84,955.253 2234.19,1089.94 2236.55,905.965 2238.9,934.666 2241.25,894.91 2243.6,988.95 2245.95,721.071 2248.3,1146.92 2250.65,825.89 2253,984.96 2255.35,861.158 2257.7,1064.47 2260.05,1002.79 2262.4,1005.37 2264.75,787.231 2267.1,929.826 2269.45,907.182 2271.8,668.831 2274.15,1017.43 2276.5,996.206 2278.85,912.432 2281.2,1057.39 2283.55,840.674 2285.91,813.665 2288.26,922.608 2290.61,1087.96 2292.96,979.395 2295.31,716.459 2297.66,945.66 2300.01,1005.9 2302.36,947.355 2304.71,670.175 2307.06,717.951 2309.41,1050.4 2311.76,923.421 2314.11,934.932 2316.46,901.608 2318.81,917.52 2321.16,962.156 2323.51,732.637 2325.86,966.698 2328.21,1042.01 2330.56,1020.63 2332.91,818.358 2335.27,932.261 2337.62,1224 2339.97,785.902 2342.32,983.476 2344.67,824.353 2347.02,866.238 2349.37,931.145 2351.72,745.656 2354.07,899.938 2356.42,1040.18 2358.77,1057.08 2361.12,943.506 2363.47,839.119 2365.82,855.882 2368.17,965.265 2370.52,988.347 2372.87,978.576 2375.22,726.637 2377.57,663.912 2379.92,964.6 2382.27,923.998 2384.62,819.948 2386.98,991.155 2389.33,887.757 2391.68,970.601 2394.03,1043.44 2396.38,1006.95 2398.73,1086.57 2401.08,627.263 2403.43,910.283 2405.78,885.31 2408.13,808.082 2410.48,890.117 2412.83,981.538 2415.18,958.128 2417.53,1026.86 2419.88,770.845 2422.23,993.61 2424.58,824.423 2426.93,903.82 2429.28,976.796 2431.63,1060.15 2433.98,1054.66 2436.34,964.235 2438.69,1063.43 2441.04,932.08 2443.39,1035.58 2445.74,872.639 2448.09,819.697 2450.44,777.903 2452.79,827.692 2455.14,1066.75 2457.49,892.002 2459.84,881.894 2462.19,875.349 2464.54,645.638 2466.89,745.256 2469.24,1014.81 2471.59,1119.01 2473.94,1011.31 2476.29,865.19 2478.64,893.065 2480.99,903.387 2483.34,910.93 2485.7,955.029 2488.05,948.601 2490.4,964.355 2492.75,900.465 2495.1,1194.11 2497.45,884.971 2499.8,927.445 2502.15,882.7 2504.5,948.696 2506.85,898.626 2509.2,851.646 2511.55,987.723 2513.9,945.888 2516.25,891.668 2518.6,851.184 2520.95,767.269 2523.3,785.845 2525.65,953.756 2528,981.043 2530.35,867.348 2532.7,734.726 2535.06,853.928 2537.41,1134.52 2539.76,904.571 2542.11,880.978 2544.46,807.689 2546.81,1048.29 2549.16,963.663 2551.51,986.674 2553.86,835.416 2556.21,1021.5 2558.56,785.682 2560.91,1103.41 2563.26,923.721 2565.61,944.627 2567.96,737.052 2570.31,1029.74 "></polyline>
<polyline clip-path="url(#clip462)" style="stroke:#3da44d; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,771.435 224.541,483.483 226.891,402.073 229.242,582.204 231.592,367.044 233.943,389.764 236.293,603.907 238.644,526.6 240.994,425.797 243.345,357.105 245.695,382.116 248.046,382.395 250.396,585.409 252.747,383.578 255.097,371.221 257.448,385.241 259.798,626.031 262.148,124.391 264.499,387.163 266.849,323.842 269.2,478.698 271.55,225.035 273.901,544.005 276.251,526.226 278.602,614.353 280.952,276.513 283.303,366.066 285.653,397.024 288.004,302.126 290.354,176.978 292.705,602.22 295.055,235.331 297.406,478.217 299.756,397.569 302.107,205.893 304.457,310.661 306.807,402.733 309.158,504.268 311.508,453.511 313.859,264.963 316.209,522.807 318.56,335.308 320.91,488.651 323.261,331.849 325.611,644.402 327.962,391.047 330.312,364.093 332.663,670.757 335.013,369.8 337.364,373.193 339.714,384.507 342.065,419.797 344.415,422.125 346.765,407.695 349.116,400.039 351.466,425.553 353.817,375.142 356.167,382.286 358.518,216.237 360.868,518.772 363.219,400.18 365.569,511.226 367.92,456.869 370.27,368.329 372.621,400.356 374.971,256.435 377.322,342.213 379.672,480.851 382.023,452.092 384.373,556.513 386.724,584.94 389.074,387.608 391.424,518.521 393.775,475.533 396.125,393.617 398.476,471.453 400.826,429.21 403.177,379.442 405.527,456.334 407.878,453.721 410.228,297.179 412.579,467.977 414.929,338.444 417.28,430.016 419.63,390.489 421.981,452.185 424.331,470.031 426.682,247.379 429.032,391.173 431.382,450.587 433.733,342.27 436.083,165.858 438.434,559.22 440.784,473.384 443.135,548.953 445.485,548.181 447.836,597.33 450.186,541.646 452.537,401.39 454.887,439.062 457.238,270.849 459.588,528.084 461.939,236.178 464.289,374.809 466.64,325.749 468.99,472.865 471.341,328.601 473.691,345.53 476.041,317.207 478.392,550.206 480.742,348.47 483.093,372.447 485.443,295.697 487.794,377.821 490.144,396.155 492.495,526.74 494.845,424.133 497.196,401.261 499.546,479.714 501.897,463.284 504.247,281.661 506.598,318.733 508.948,596.886 511.299,360.975 513.649,440.991 515.999,428.742 518.35,309.72 520.7,559.292 523.051,301.901 525.401,445.677 527.752,354.634 530.102,408.183 532.453,527.743 534.803,514.041 537.154,375.867 539.504,374.237 541.855,472.064 544.205,492.343 546.556,327.096 548.906,428.215 551.257,442.829 553.607,247.256 555.958,420.993 558.308,542.317 560.658,360.472 563.009,389.888 565.359,385.442 567.71,386.446 570.06,259.247 572.411,467.231 574.761,431.216 577.112,538.964 579.462,463.505 581.813,378.738 584.163,341.814 586.514,478.147 588.864,600.043 591.215,650.885 593.565,566.234 595.916,552.188 598.266,619.016 600.616,518.215 602.967,395.879 605.317,299.94 607.668,582.54 610.018,306.95 612.369,358.041 614.719,441.473 617.07,404.781 619.42,384.05 621.771,389.918 624.121,418.624 626.472,142.978 628.822,388.945 631.173,431.244 633.523,459.175 635.874,366.636 638.224,512.634 640.575,649.089 642.925,414.48 645.275,298.537 647.626,466.156 649.976,452.544 652.327,452.852 654.677,387.007 657.028,536.606 659.378,434.724 661.729,379.589 664.079,466.942 666.43,524.667 668.78,361.66 671.131,506.734 673.481,452.008 675.832,303.48 678.182,555.227 680.533,593.296 682.883,488.851 685.233,373.068 687.584,508.531 689.934,324.31 692.285,427.637 694.635,353.741 696.986,462.371 699.336,383.808 701.687,665.327 704.037,329.885 706.388,369.122 708.738,490.465 711.089,371.4 713.439,310.171 715.79,389.435 718.14,295.294 720.491,380.725 722.841,302.893 725.192,307.145 727.542,418.637 729.892,286.05 732.243,358.238 734.593,392.705 736.944,487.996 739.294,373.454 741.645,449.003 743.995,345.829 746.346,412.768 748.696,605.091 751.047,510.55 753.397,445.513 755.748,324.229 758.098,448.445 760.449,478.579 762.799,333.642 765.15,457.691 767.5,566.38 769.85,544.171 772.201,538.978 774.551,506.9 776.902,394.636 779.252,408.878 781.603,486.519 783.953,382.96 786.304,282.564 788.654,580.606 791.005,683.106 793.355,200.26 795.706,406.556 798.056,373.776 800.407,292.971 802.757,425.167 805.108,436.435 807.458,685.305 809.809,370.67 812.159,199.419 814.509,468.434 816.86,452 819.21,299.52 821.561,371.415 823.911,321.477 826.262,485.861 828.612,477.224 830.963,409.261 833.313,431.286 835.664,461.066 838.014,329.248 840.365,354.403 842.715,425.162 845.066,465.065 847.416,586.624 849.767,436.583 852.117,459.561 854.467,422.515 856.818,364.859 859.168,452.177 861.519,469.943 863.869,609.77 866.22,434.722 868.57,426.874 870.921,523.087 873.271,470.336 875.622,462.331 877.972,253.826 880.323,506.577 882.673,441.599 885.024,323.948 887.374,588.69 889.725,471.932 892.075,241.541 894.426,424.432 896.776,488.746 899.126,530.358 901.477,368.165 903.827,362.879 906.178,456.888 908.528,404.031 910.879,221.857 913.229,525.276 915.58,356.746 917.93,554.674 920.281,307.359 922.631,550.241 924.982,441.512 927.332,680.066 929.683,664.357 932.033,335.523 934.384,625.463 936.734,354.467 939.084,380.327 941.435,349.732 943.785,390.901 946.136,404.748 948.486,555.921 950.837,402.44 953.187,484.092 955.538,588.797 957.888,336.915 960.239,299.433 962.589,350.972 964.94,558.309 967.29,227.383 969.641,249.144 971.991,517.139 974.342,444.547 976.692,614.59 979.043,447.794 981.393,298.81 983.743,360.684 986.094,436.607 988.444,327.189 990.795,468.71 993.145,593.484 995.496,425.936 997.846,436.242 1000.2,417.8 1002.55,363.386 1004.9,379.228 1007.25,474.162 1009.6,635.624 1011.95,419.086 1014.3,469.674 1016.65,321.997 1019,380.215 1021.35,411.858 1023.7,519.459 1026.05,409.773 1028.4,585.474 1030.75,380.842 1033.1,440.222 1035.45,346.869 1037.8,421.719 1040.15,370.751 1042.51,469.929 1044.86,326.895 1047.21,599.621 1049.56,507.746 1051.91,506.056 1054.26,493.98 1056.61,322.661 1058.96,538.055 1061.31,373.923 1063.66,472.071 1066.01,613.944 1068.36,322.854 1070.71,365.7 1073.06,501.805 1075.41,565.812 1077.76,444.751 1080.11,395.914 1082.46,465.304 1084.81,523.36 1087.16,293.608 1089.51,356.441 1091.87,282.047 1094.22,455.604 1096.57,503.6 1098.92,423.843 1101.27,294.646 1103.62,260.094 1105.97,603.645 1108.32,209.993 1110.67,384.5 1113.02,512.378 1115.37,422.938 1117.72,327.498 1120.07,358.574 1122.42,461.28 1124.77,462.104 1127.12,364.092 1129.47,432.859 1131.82,486.692 1134.17,481.682 1136.52,340.064 1138.87,543.547 1141.23,409.992 1143.58,414.05 1145.93,476.097 1148.28,554.894 1150.63,386.534 1152.98,317.995 1155.33,327.838 1157.68,449.012 1160.03,559.766 1162.38,321.712 1164.73,516.838 1167.08,433.803 1169.43,96.8724 1171.78,329.533 1174.13,392.114 1176.48,560.615 1178.83,356.836 1181.18,572.444 1183.53,498.452 1185.88,365.55 1188.23,575.628 1190.59,272.298 1192.94,419.5 1195.29,240.819 1197.64,499.312 1199.99,221.128 1202.34,406.439 1204.69,325.814 1207.04,570.693 1209.39,448.409 1211.74,351.218 1214.09,195.16 1216.44,480.93 1218.79,466.784 1221.14,347.202 1223.49,358.825 1225.84,398.199 1228.19,642.92 1230.54,433.366 1232.89,253.891 1235.24,362.732 1237.59,478.567 1239.94,595.356 1242.3,563.225 1244.65,322.526 1247,516.567 1249.35,278.897 1251.7,443.068 1254.05,654.425 1256.4,114.33 1258.75,392.298 1261.1,327.66 1263.45,388.651 1265.8,446.78 1268.15,504.836 1270.5,293.516 1272.85,531.388 1275.2,317.307 1277.55,645.652 1279.9,633.971 1282.25,448.528 1284.6,417.106 1286.95,604.55 1289.3,441.777 1291.66,421.361 1294.01,311.128 1296.36,580.987 1298.71,308.275 1301.06,556.201 1303.41,282.155 1305.76,455.284 1308.11,530.983 1310.46,448.29 1312.81,434.23 1315.16,453.303 1317.51,510.781 1319.86,618.178 1322.21,349.656 1324.56,335.472 1326.91,552.739 1329.26,348.946 1331.61,351.487 1333.96,470.516 1336.31,524.427 1338.66,538.023 1341.02,467.636 1343.37,216.419 1345.72,548.202 1348.07,444.765 1350.42,515.271 1352.77,463.65 1355.12,414.826 1357.47,468.215 1359.82,507.366 1362.17,439.649 1364.52,540.075 1366.87,356.678 1369.22,413.786 1371.57,489.477 1373.92,725.925 1376.27,374.419 1378.62,444.271 1380.97,463.594 1383.32,472.956 1385.67,462.611 1388.02,322.334 1390.38,479.511 1392.73,401.809 1395.08,437.578 1397.43,465.171 1399.78,467.524 1402.13,347.952 1404.48,424.357 1406.83,424.777 1409.18,356.422 1411.53,414.872 1413.88,513.181 1416.23,429.587 1418.58,343.658 1420.93,417.596 1423.28,543.33 1425.63,526.74 1427.98,453.319 1430.33,357.624 1432.68,409.905 1435.03,473.859 1437.38,415.008 1439.74,356.587 1442.09,424.819 1444.44,359.741 1446.79,442.357 1449.14,370.253 1451.49,470.34 1453.84,347.796 1456.19,372.122 1458.54,454.282 1460.89,319.953 1463.24,471.509 1465.59,390.937 1467.94,361.045 1470.29,478.231 1472.64,409.216 1474.99,545.844 1477.34,293.609 1479.69,480.177 1482.04,422.651 1484.39,302.007 1486.74,542.629 1489.1,404.352 1491.45,319.317 1493.8,600.063 1496.15,501.717 1498.5,414.716 1500.85,436.315 1503.2,468.775 1505.55,423.432 1507.9,537.977 1510.25,330.629 1512.6,198.005 1514.95,540.536 1517.3,435.334 1519.65,389.609 1522,431.857 1524.35,380.138 1526.7,308.83 1529.05,404.091 1531.4,416.004 1533.75,493.877 1536.1,309.171 1538.45,450.713 1540.81,587.979 1543.16,343.349 1545.51,577.251 1547.86,509.946 1550.21,493.046 1552.56,494.691 1554.91,332.652 1557.26,463.149 1559.61,399.238 1561.96,376.379 1564.31,554.934 1566.66,418.426 1569.01,336.402 1571.36,380.219 1573.71,429.347 1576.06,366.524 1578.41,459.419 1580.76,379.132 1583.11,395.967 1585.46,375.661 1587.81,364.959 1590.17,405.401 1592.52,487.172 1594.87,150.174 1597.22,387.548 1599.57,429.624 1601.92,419.928 1604.27,526.564 1606.62,539.64 1608.97,428.149 1611.32,303.734 1613.67,509.442 1616.02,222.987 1618.37,327.675 1620.72,329.335 1623.07,433.899 1625.42,421.213 1627.77,326.419 1630.12,423.285 1632.47,580.735 1634.82,575.422 1637.17,604.763 1639.53,404.169 1641.88,462.84 1644.23,459.881 1646.58,431.938 1648.93,464.772 1651.28,175.047 1653.63,431.942 1655.98,493.89 1658.33,407.295 1660.68,410.616 1663.03,282.691 1665.38,410.36 1667.73,564.174 1670.08,538.014 1672.43,481.45 1674.78,248.712 1677.13,433.013 1679.48,404.128 1681.83,203.358 1684.18,421.09 1686.53,611.158 1688.89,541.445 1691.24,556.184 1693.59,471.419 1695.94,462.357 1698.29,457.243 1700.64,509.67 1702.99,414.884 1705.34,132.014 1707.69,441.339 1710.04,360.514 1712.39,543.945 1714.74,349.874 1717.09,423.704 1719.44,589.054 1721.79,147.587 1724.14,424.713 1726.49,454.56 1728.84,612.25 1731.19,472.64 1733.54,625.735 1735.89,484.418 1738.25,542.789 1740.6,326.722 1742.95,620.544 1745.3,268.239 1747.65,408.337 1750,470.177 1752.35,494.404 1754.7,539.65 1757.05,610.98 1759.4,215.66 1761.75,394.175 1764.1,450.457 1766.45,540.584 1768.8,503.058 1771.15,527.616 1773.5,445.887 1775.85,320.095 1778.2,500.66 1780.55,319.006 1782.9,554.217 1785.25,573.723 1787.6,421.068 1789.96,357.699 1792.31,447.83 1794.66,392.94 1797.01,435.445 1799.36,454.219 1801.71,308.12 1804.06,370.768 1806.41,585.39 1808.76,430.978 1811.11,474.713 1813.46,209.606 1815.81,466.35 1818.16,470.24 1820.51,430.445 1822.86,454.365 1825.21,350.565 1827.56,365.96 1829.91,593.845 1832.26,387.83 1834.61,355.298 1836.96,370.545 1839.32,404.691 1841.67,424.671 1844.02,561.944 1846.37,237.19 1848.72,567.747 1851.07,409.907 1853.42,388.709 1855.77,556.862 1858.12,269.729 1860.47,394.185 1862.82,316.586 1865.17,578.86 1867.52,424.383 1869.87,495.43 1872.22,352.887 1874.57,459.172 1876.92,450.543 1879.27,387.489 1881.62,468.572 1883.97,272.352 1886.32,331.013 1888.68,590.426 1891.03,408.99 1893.38,398.54 1895.73,401.148 1898.08,499.631 1900.43,375.302 1902.78,453.603 1905.13,538.641 1907.48,446.648 1909.83,374.86 1912.18,418.943 1914.53,392.667 1916.88,557.991 1919.23,429.584 1921.58,297.182 1923.93,502.797 1926.28,317.415 1928.63,583.782 1930.98,376.972 1933.33,449.812 1935.68,404.783 1938.04,394.852 1940.39,334.902 1942.74,298.793 1945.09,478.884 1947.44,390.73 1949.79,433.547 1952.14,427.448 1954.49,173.377 1956.84,369.976 1959.19,543.009 1961.54,429.859 1963.89,395.6 1966.24,449.442 1968.59,637.141 1970.94,483.7 1973.29,288.69 1975.64,455.678 1977.99,504.918 1980.34,563.836 1982.69,403.232 1985.04,594.137 1987.4,179.393 1989.75,496.825 1992.1,536.809 1994.45,432.497 1996.8,418.121 1999.15,340.953 2001.5,293.358 2003.85,401.396 2006.2,520.332 2008.55,271.081 2010.9,361.568 2013.25,359.238 2015.6,355.188 2017.95,409.99 2020.3,447.526 2022.65,594.208 2025,294.739 2027.35,422.819 2029.7,391.22 2032.05,351.457 2034.4,384.286 2036.76,477.774 2039.11,353.368 2041.46,597.641 2043.81,360.762 2046.16,433.037 2048.51,485.169 2050.86,549.493 2053.21,436.926 2055.56,346.013 2057.91,262.357 2060.26,366.252 2062.61,519.557 2064.96,416.251 2067.31,412.682 2069.66,305.303 2072.01,544.789 2074.36,335.733 2076.71,436.832 2079.06,407.588 2081.41,246.902 2083.76,704.391 2086.11,529.071 2088.47,383.646 2090.82,609.575 2093.17,566.549 2095.52,600.633 2097.87,294.61 2100.22,595.623 2102.57,436.593 2104.92,353.618 2107.27,371.265 2109.62,432.145 2111.97,540.988 2114.32,411.48 2116.67,439.789 2119.02,369.346 2121.37,492.13 2123.72,427.747 2126.07,294.998 2128.42,349.219 2130.77,443.045 2133.12,520.522 2135.47,374.547 2137.83,541.556 2140.18,579.205 2142.53,485.739 2144.88,291.091 2147.23,374.108 2149.58,518.504 2151.93,418.127 2154.28,367.788 2156.63,425.823 2158.98,504.373 2161.33,327.291 2163.68,290.456 2166.03,399.942 2168.38,297.488 2170.73,381.355 2173.08,351.363 2175.43,502.692 2177.78,559.065 2180.13,314.578 2182.48,401.126 2184.83,451.14 2187.19,495.917 2189.54,403.363 2191.89,352.995 2194.24,451.471 2196.59,349.848 2198.94,263.803 2201.29,505.634 2203.64,311.945 2205.99,470.528 2208.34,328.98 2210.69,400.675 2213.04,486.786 2215.39,327.325 2217.74,433.48 2220.09,529.427 2222.44,339.506 2224.79,314.305 2227.14,540.565 2229.49,286.741 2231.84,446.035 2234.19,418.746 2236.55,329.546 2238.9,365.801 2241.25,382.744 2243.6,412.411 2245.95,323.102 2248.3,437.346 2250.65,401.142 2253,410.117 2255.35,552.722 2257.7,487.655 2260.05,338.359 2262.4,421.929 2264.75,314.028 2267.1,470.879 2269.45,384.139 2271.8,408.248 2274.15,403.001 2276.5,330.44 2278.85,458.998 2281.2,275.774 2283.55,356.96 2285.91,405.459 2288.26,207.147 2290.61,486.448 2292.96,475.028 2295.31,373.046 2297.66,411.363 2300.01,341.848 2302.36,369.316 2304.71,429 2307.06,528.388 2309.41,435.72 2311.76,402.659 2314.11,455.783 2316.46,476.191 2318.81,491.936 2321.16,544.07 2323.51,399.506 2325.86,540.553 2328.21,294.343 2330.56,188.041 2332.91,317.272 2335.27,459.699 2337.62,465.002 2339.97,578.82 2342.32,351.47 2344.67,393.242 2347.02,356.829 2349.37,446.479 2351.72,286.56 2354.07,379.048 2356.42,361.738 2358.77,449.304 2361.12,392.064 2363.47,351.585 2365.82,532.479 2368.17,532.147 2370.52,294.631 2372.87,398.96 2375.22,514.047 2377.57,571.7 2379.92,523.12 2382.27,417.012 2384.62,315.519 2386.98,423.665 2389.33,328.98 2391.68,306.537 2394.03,567.54 2396.38,372.355 2398.73,369.244 2401.08,448.807 2403.43,312.221 2405.78,276.429 2408.13,522.449 2410.48,359.51 2412.83,584.962 2415.18,446.357 2417.53,337.598 2419.88,385.769 2422.23,442.788 2424.58,510.766 2426.93,544.807 2429.28,370.266 2431.63,334.193 2433.98,356.001 2436.34,351.756 2438.69,349.514 2441.04,609.382 2443.39,307.444 2445.74,405.407 2448.09,480.943 2450.44,310.369 2452.79,320.31 2455.14,376.295 2457.49,545.883 2459.84,577.663 2462.19,377.83 2464.54,468.626 2466.89,202.738 2469.24,630.117 2471.59,345.622 2473.94,366.426 2476.29,425.857 2478.64,614.204 2480.99,526.778 2483.34,712.98 2485.7,427.625 2488.05,362.409 2490.4,250.764 2492.75,423.914 2495.1,582.429 2497.45,439.966 2499.8,458.868 2502.15,431.148 2504.5,562.838 2506.85,395.361 2509.2,393.351 2511.55,413.97 2513.9,363.096 2516.25,419.715 2518.6,402.553 2520.95,306.322 2523.3,455.126 2525.65,383.015 2528,423.468 2530.35,422.171 2532.7,459.243 2535.06,481.296 2537.41,374.505 2539.76,427.167 2542.11,358.652 2544.46,495.251 2546.81,473.968 2549.16,363.141 2551.51,257.07 2553.86,412.095 2556.21,515.022 2558.56,592.661 2560.91,422.412 2563.26,405.038 2565.61,449.844 2567.96,403.324 2570.31,359.845 "></polyline>
</svg>
</div>
</div>
<p>Look at that! Things are working; amazin’.</p>
<p>We can also exploit <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>’s parallel sampling capabilities:</p>
<div id="34" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run separate 4 chains for 10 000 iterations using threads to parallelize.</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>num_chains <span class="op">=</span> <span class="fl">4</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    model_with_grad,</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">MCMCThreads</span>(),</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>,</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    num_chains;</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Note we need to provide an initial state for every chain.</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>    initial_state<span class="op">=</span><span class="fu">fill</span>(state, num_chains),</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>samples_array <span class="op">=</span> <span class="fu">stack</span>(<span class="fu">map</span>(<span class="bu">Base</span>.<span class="fu">Fix1</span>(stack, sample <span class="op">-&gt;</span> sample.x), samples))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000×4 Array{Float64, 3}:
[:, :, 1] =
 -0.862015    -3.00774  -2.977     …  -6.18143   -4.3522     -4.50145
  0.00898914   1.61409  -0.822482      0.235315   0.0802455   0.233274
  1.58887      2.77448   2.00414       4.95074    3.9523      5.02821

[:, :, 2] =
 -0.645756  -2.24514   -2.59477   -4.91043   …  -4.04425  -4.13148   -3.05648
  1.2169     0.954497   0.444072  -0.289856     -1.09831  -0.968884  -1.23174
  3.18457    5.56126    4.52924    4.84487       4.45804   5.38926    5.68084

[:, :, 3] =
 -3.29308  -3.09344  -3.67387   -4.08272  …  -6.18577   -5.48594  -5.82764
  0.54787   1.31051   0.224424   1.2155      -0.364309  -1.03831  -1.82987
  3.33356   4.49294   4.65271    6.00405      4.23526    3.74327   4.32256

[:, :, 4] =
 -2.63449   -5.10598  -3.01389  -3.26609  …  -5.20293  -6.56357  -6.56357
 -0.767378  -1.53051   1.76722   1.1082       1.10794   1.45575   1.45575
  1.56578    3.50835   3.25486   4.71727      6.99388   5.00144   5.00144</code></pre>
</div>
</div>
<p>But the fact that we have to provide the <code>AbstractMCMC.sample</code> call, etc. with an <code>initial_state</code> to get started is a bit annoying. We can avoid this by also defining a <code>AbstractMCMC.step</code> <em>without</em> the <code>state</code> argument:</p>
<div id="36" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">::</span><span class="dt">MALA</span>;</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># </span><span class="al">NOTE</span><span class="co">: No state provided!</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just create the initial state by sampling using  a Gaussian.</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="fu">randn</span>(rng, LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(x), <span class="fu">MALAState</span>(x)</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Equipped with this, we no longer need to provide the <code>initial_state</code> everywhere:</p>
<div id="38" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -4.99408    1.00201
 -0.0100298  1.00181
  4.99952    0.98684</code></pre>
</div>
</div>
</section>
<section id="using-our-sampler-with-turing.jl" class="level2">
<h2 class="anchored" data-anchor-id="using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</h2>
<p>As we promised, all of this hassle of implementing our <code>MALA</code> sampler in a way that uses <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> and <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> gets us something more than <em>just</em> an “automatic” implementation of <code>AbstractMCMC.sample</code>.</p>
<p>It also enables use with Turing.jl through the <code>externalsampler</code>, but we need to do one final thing first: we need to tell Turing.jl how to extract a vector of parameters from the “sample” returned in our implementation of <code>AbstractMCMC.step</code>. In our case, the “sample” is a <code>MALASample</code>, so we just need the following line:</p>
<div id="40" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load Turing.jl.</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Turing</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Overload the `getparams` method for our "sample" type, which is just a vector.</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>Turing.Inference.<span class="fu">getparams</span>(<span class="op">::</span><span class="dt">Turing.Model</span>, sample<span class="op">::</span><span class="dt">MALASample</span>) <span class="op">=</span> sample.x</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And with that, we’re good to go!</p>
<div id="42" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Our previous model defined as a Turing.jl model.</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">mvnormal_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">MvNormal</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.], I)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate our model.</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">mvnormal_model</span>()</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Call `sample` but now we're passing in a Turing.jl `model` and wrapping</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co"># our `MALA` sampler in the `externalsampler` to tell Turing.jl that the sampler</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co"># expects something that implements LogDensityProblems.jl.</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×4×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 2.87 seconds
Compute duration  = 2.87 seconds
parameters        = x[1], x[2], x[3]
internals         = lp

Summary Statistics
  parameters      mean       std      mcse    ess_bulk    ess_tail      rhat   ⋯
      Symbol   Float64   Float64   Float64     Float64     Float64   Float64   ⋯

        x[1]   -4.9834    0.9948    0.0170   3426.9346   5220.2320    1.0005   ⋯
        x[2]   -0.0001    1.0010    0.0174   3310.0527   4945.4985    1.0000   ⋯
        x[3]    5.0024    1.0054    0.0176   3251.8014   5435.2741    1.0004   ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

        x[1]   -6.9618   -5.6275   -4.9853   -4.3160   -3.0401
        x[2]   -1.9623   -0.6783    0.0035    0.6873    1.9195
        x[3]    3.0539    4.3197    5.0240    5.6781    6.9799</code></pre>
</div>
</div>
<p>Pretty neat, eh?</p>
<section id="models-with-constrained-parameters" class="level3">
<h3 class="anchored" data-anchor-id="models-with-constrained-parameters">Models with constrained parameters</h3>
<p>One thing we’ve sort of glossed over in all of the above is that MALA, at least how we’ve implemented it, requires <span class="math inline">\(x\)</span> to live in <span class="math inline">\(\mathbb{R}^d\)</span> for some <span class="math inline">\(d &gt; 0\)</span>. If some of the parameters were in fact constrained, e.g.&nbsp;we were working with a <code>Beta</code> distribution which has support on the interval <span class="math inline">\((0, 1)\)</span>, <em>not</em> on <span class="math inline">\(\mathbb{R}^d\)</span>, we could easily end up outside of the valid range <span class="math inline">\((0, 1)\)</span>.</p>
<div id="44" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">beta_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">beta_model</span>()</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 1.84 seconds
Compute duration  = 1.84 seconds
parameters        = x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse    ess_bulk    ess_tail      rhat   ⋯
      Symbol   Float64   Float64   Float64     Float64     Float64   Float64   ⋯

           x    0.4959    0.1893    0.0028   4572.6520   5892.5004    1.0003   ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

           x    0.1481    0.3518    0.4970    0.6365    0.8503</code></pre>
</div>
</div>
<p>Yep, that still works, but only because Turing.jl actually <em>transforms</em> the <code>turing_model</code> from constrained to unconstrained, so that the <code>sampler</code> provided to <code>externalsampler</code> is actually always working in unconstrained space! This is not always desirable, so we can turn this off:</p>
<div id="46" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 0.16 seconds
Compute duration  = 0.16 seconds
parameters        = x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse   ess_bulk   ess_tail      rhat   e ⋯
      Symbol   Float64   Float64   Float64    Float64    Float64   Float64     ⋯

           x    0.5055    0.1596    0.0135   116.9905    36.9581    1.0060     ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

           x    0.2133    0.3763    0.5096    0.6304    0.7949</code></pre>
</div>
</div>
<p>The fun thing is that this still sort of works because</p>
<div id="48" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">logpdf</span>(<span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>), <span class="fl">10.0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-Inf</code></pre>
</div>
</div>
<p>and so the samples that fall outside of the range are always rejected. But do notice how much worse all the diagnostics are, e.g.&nbsp;<code>ess_tail</code> is very poor compared to when we use <code>unconstrained=true</code>. Moreover, in more complex cases this won’t just result in a “nice” <code>-Inf</code> log-density value, but instead will error:</p>
<div id="50" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="kw">function</span> <span class="fu">demo</span>()</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>    σ² <span class="op">~</span> <span class="fu">truncated</span>(<span class="fu">Normal</span>(), lower<span class="op">=</span><span class="fl">0</span>)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If we end up with negative values for `σ²`, the `Normal` will error.</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>    x <span class="op">~</span> <span class="fu">Normal</span>(<span class="fl">0</span>, σ²)</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>DomainError: DomainError(-0.14828442145685672, "Normal: the condition σ &gt;= zero(σ) is not satisfied.")
DomainError with -0.14828442145685672:
Normal: the condition σ &gt;= zero(σ) is not satisfied.
Stacktrace:
  [1] #371
    @ ~/.julia/packages/Distributions/fi8Qd/src/univariate/continuous/normal.jl:37 [inlined]
  [2] check_args
    @ ~/.julia/packages/Distributions/fi8Qd/src/utils.jl:89 [inlined]
  [3] #Normal#370
    @ ~/.julia/packages/Distributions/fi8Qd/src/univariate/continuous/normal.jl:37 [inlined]
  [4] Normal
    @ ~/.julia/packages/Distributions/fi8Qd/src/univariate/continuous/normal.jl:36 [inlined]
  [5] Normal
    @ ~/.julia/packages/Distributions/fi8Qd/src/univariate/continuous/normal.jl:42 [inlined]
  [6] macro expansion
    @ ~/.julia/packages/DynamicPPL/DxBhI/src/compiler.jl:574 [inlined]
  [7] demo(__model__::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, __varinfo__::DynamicPPL.ThreadSafeVarInfo{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}, Vector{Base.RefValue{Float64}}}, __context__::DynamicPPL.ValuesAsInModelContext{DynamicPPL.DefaultContext})
    @ Main.Notebook ~/work/docs/docs/developers/inference/implementing-samplers/index.qmd:595
  [8] _evaluate!!
    @ ~/.julia/packages/DynamicPPL/DxBhI/src/model.jl:936 [inlined]
  [9] evaluate_threadsafe!!(model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, varinfo::DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}, context::DynamicPPL.ValuesAsInModelContext{DynamicPPL.DefaultContext})
    @ DynamicPPL ~/.julia/packages/DynamicPPL/DxBhI/src/model.jl:925
 [10] evaluate!!
    @ ~/.julia/packages/DynamicPPL/DxBhI/src/model.jl:855 [inlined]
 [11] values_as_in_model
    @ ~/.julia/packages/DynamicPPL/DxBhI/src/values_as_in_model.jl:173 [inlined]
 [12] values_as_in_model
    @ ~/.julia/packages/DynamicPPL/DxBhI/src/values_as_in_model.jl:172 [inlined]
 [13] getparams(model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, vi::DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64})
    @ Turing.Inference ~/.julia/packages/Turing/IXycm/src/mcmc/Inference.jl:354
 [14] Turing.Inference.Transition(model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, vi::DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}, t::MALASample{Vector{Float64}})
    @ Turing.Inference ~/.julia/packages/Turing/IXycm/src/mcmc/Inference.jl:231
 [15] transition_to_turing(f::LogDensityFunction{DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}, DynamicPPL.DefaultContext, AutoForwardDiff{2, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}}}, transition::MALASample{Vector{Float64}})
    @ Turing.Inference ~/.julia/packages/Turing/IXycm/src/mcmc/abstractmcmc.jl:12
 [16] step(rng::TaskLocalRNG, model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, sampler_wrapper::DynamicPPL.Sampler{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}; initial_state::Nothing, initial_params::Nothing, kwargs::@Kwargs{})
    @ Turing.Inference ~/.julia/packages/Turing/IXycm/src/mcmc/abstractmcmc.jl:77
 [17] macro expansion
    @ ~/.julia/packages/AbstractMCMC/FSyVk/src/sample.jl:0 [inlined]
 [18] macro expansion
    @ ~/.julia/packages/AbstractMCMC/FSyVk/src/logging.jl:16 [inlined]
 [19] mcmcsample(rng::TaskLocalRNG, model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, sampler::DynamicPPL.Sampler{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}, N::Int64; progress::Bool, progressname::String, callback::Nothing, num_warmup::Int64, discard_initial::Int64, thinning::Int64, chain_type::Type, initial_state::Nothing, kwargs::@Kwargs{})
    @ AbstractMCMC ~/.julia/packages/AbstractMCMC/FSyVk/src/sample.jl:142
 [20] sample(rng::TaskLocalRNG, model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, sampler::DynamicPPL.Sampler{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}, N::Int64; chain_type::Type, resume_from::Nothing, initial_state::Nothing, kwargs::@Kwargs{progress::Bool})
    @ DynamicPPL ~/.julia/packages/DynamicPPL/DxBhI/src/sampler.jl:102
 [21] sample
    @ ~/.julia/packages/DynamicPPL/DxBhI/src/sampler.jl:92 [inlined]
 [22] #sample#8
    @ ~/.julia/packages/Turing/IXycm/src/mcmc/Inference.jl:278 [inlined]
 [23] sample
    @ ~/.julia/packages/Turing/IXycm/src/mcmc/Inference.jl:269 [inlined]
 [24] #sample#7
    @ ~/.julia/packages/Turing/IXycm/src/mcmc/Inference.jl:266 [inlined]
 [25] top-level scope
    @ ~/work/docs/docs/developers/inference/implementing-samplers/index.qmd:597</code></pre>
</div>
</div>
<p>As expected, we run into a <code>DomainError</code> at some point, while if we set <code>unconstrained=true</code>, letting Turing.jl transform the model to a unconstrained form behind the scenes, everything works as expected:</p>
<div id="52" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 1.93 seconds
Compute duration  = 1.93 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse   ess_bulk   ess_tail      rhat   e ⋯
      Symbol   Float64   Float64   Float64    Float64    Float64   Float64     ⋯

          σ²    0.3001    0.0000    0.0000        NaN        NaN       NaN     ⋯
           x    1.0775    0.0000    0.0000        NaN        NaN       NaN     ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

          σ²    0.3001    0.3001    0.3001    0.3001    0.3001
           x    1.0775    1.0775    1.0775    1.0775    1.0775</code></pre>
</div>
</div>
<p>Neat!</p>
<p>Similarly, which automatic differentiation backend one should use can be specified through the <code>adtype</code> keyword argument too. For example, if we want to use <a href="https://github.com/JuliaDiff/ReverseDiff.jl">ReverseDiff.jl</a> instead of the default <a href="https://github.com/JuliaDiff/ForwardDiff.jl">ForwardDiff.jl</a>:</p>
<div id="54" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">ReverseDiff</span>: ReverseDiff</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify that we want to use `AutoReverseDiff`.</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">demo</span>(),</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>, adtype<span class="op">=</span><span class="fu">AutoReverseDiff</span>()),</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>;</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 2.71 seconds
Compute duration  = 2.71 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse   ess_bulk   ess_tail      rhat   e ⋯
      Symbol   Float64   Float64   Float64    Float64    Float64   Float64     ⋯

          σ²    0.8311    0.5669    0.0262   291.4327   100.0488    1.0021     ⋯
           x   -0.0356    0.9673    0.0431   610.1546   563.8516    1.0031     ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

          σ²    0.1209    0.3621    0.7081    1.1935    2.2091
           x   -2.2219   -0.4190   -0.0151    0.4165    1.9223</code></pre>
</div>
</div>
<p>Double-neat.</p>
</section>
</section>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<p>At this point it’s worth maybe reminding ourselves what we did and also <em>why</em> we did it:</p>
<ol type="1">
<li>We define our models in the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface because it makes the sampler agnostic to how the underlying model is implemented.</li>
<li>We implement our sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> interface, which just means that our sampler is a subtype of <code>AbstractMCMC.AbstractSampler</code> and we implement the MCMC transition in <code>AbstractMCMC.step</code>.</li>
<li>Points 1 and 2 makes it so our sampler can be used with a wide range of model implementations, amongst them being models implemented in both Turing.jl and Stan. This gives you, the inference implementer, a large collection of models to test your inference method on, in addition to allowing users of Turing.jl and Stan to try out your inference method with minimal effort.</li>
</ol>


</section>


<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a><div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>We’re going with the leapfrog formulation because in a future version of this tutorial we’ll add a section extending this simple “baseline” MALA sampler to more complex versions. See <a href="https://github.com/TuringLang/docs/issues/479">issue #479</a> for progress on this.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>There is no such thing as a proper interface in Julia (at least not officially), and so we use the word “interface” here to mean a few minimal methods that needs to be implemented by any type that we treat as a target model.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/turinglang\.org\/docs\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../../developers/inference/variational-inference/index.html" class="pagination-link" aria-label="Variational Inference">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Variational Inference</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Turing is created by <a href="http://mlg.eng.cam.ac.uk/hong/" target="_blank">Hong Ge</a>, and lovingly maintained by the <a href="https://github.com/TuringLang/Turing.jl/graphs/contributors" target="_blank">core team</a> of volunteers. <br> The contents of this website are © 2024 under the terms of the <a href="https://github.com/TuringLang/Turing.jl/blob/main/LICENCE" target="_blank">MIT License</a>.</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/TuringLang/docs/edit/main/developers/inference/implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/docs/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://x.com/TuringLang">
      <i class="bi bi-twitter" role="img" aria-label="Turing Twitter">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/TuringLang/Turing.jl">
      <i class="bi bi-github" role="img" aria-label="Turing GitHub">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




<script src="../../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>