<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.31">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Implementing Samplers – Turing.jl</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<link href="../../../developers/inference/variational-inference/index.html" rel="prev">
<link href="../../../assets/favicon.ico" rel="icon">
<script src="../../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-e1a5c8363afafaef2c763b6775fbf3ca.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-dark-8ef56b68f8fa1e9d2ba328e99e439f80.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-e1a5c8363afafaef2c763b6775fbf3ca.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap-adfd425b459c6192e2aaf302ef6f29d8.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../../site_libs/bootstrap/bootstrap-dark-0c340ff1686979d72b89a501eb484056.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="../../../site_libs/bootstrap/bootstrap-adfd425b459c6192e2aaf302ef6f29d8.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<style>
  a {
    text-decoration: none;
  }
  a:hover {
    text-decoration: underline;
  }
</style>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../../theming/styles.css">
</head>

<body class="nav-sidebar floating nav-fixed quarto-light"><script id="quarto-html-before-body" type="application/javascript">
    const toggleBodyColorMode = (bsSheetEl) => {
      const mode = bsSheetEl.getAttribute("data-mode");
      const bodyEl = window.document.querySelector("body");
      if (mode === "dark") {
        bodyEl.classList.add("quarto-dark");
        bodyEl.classList.remove("quarto-light");
      } else {
        bodyEl.classList.add("quarto-light");
        bodyEl.classList.remove("quarto-dark");
      }
    }
    const toggleBodyColorPrimary = () => {
      const bsSheetEl = window.document.querySelector("link#quarto-bootstrap:not([rel=disabled-stylesheet])");
      if (bsSheetEl) {
        toggleBodyColorMode(bsSheetEl);
      }
    }
    const setColorSchemeToggle = (alternate) => {
      const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
      for (let i=0; i < toggles.length; i++) {
        const toggle = toggles[i];
        if (toggle) {
          if (alternate) {
            toggle.classList.add("alternate");
          } else {
            toggle.classList.remove("alternate");
          }
        }
      }
    };
    const toggleColorMode = (alternate) => {
      // Switch the stylesheets
      const primaryStylesheets = window.document.querySelectorAll('link.quarto-color-scheme:not(.quarto-color-alternate)');
      const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
      manageTransitions('#quarto-margin-sidebar .nav-link', false);
      if (alternate) {
        // note: dark is layered on light, we don't disable primary!
        enableStylesheet(alternateStylesheets);
        for (const sheetNode of alternateStylesheets) {
          if (sheetNode.id === "quarto-bootstrap") {
            toggleBodyColorMode(sheetNode);
          }
        }
      } else {
        disableStylesheet(alternateStylesheets);
        enableStylesheet(primaryStylesheets)
        toggleBodyColorPrimary();
      }
      manageTransitions('#quarto-margin-sidebar .nav-link', true);
      // Switch the toggles
      setColorSchemeToggle(alternate)
      // Hack to workaround the fact that safari doesn't
      // properly recolor the scrollbar when toggling (#1455)
      if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
        manageTransitions("body", false);
        window.scrollTo(0, 1);
        setTimeout(() => {
          window.scrollTo(0, 0);
          manageTransitions("body", true);
        }, 40);
      }
    }
    const disableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        stylesheet.rel = 'disabled-stylesheet';
      }
    }
    const enableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        if(stylesheet.rel !== 'stylesheet') { // for Chrome, which will still FOUC without this check
          stylesheet.rel = 'stylesheet';
        }
      }
    }
    const manageTransitions = (selector, allowTransitions) => {
      const els = window.document.querySelectorAll(selector);
      for (let i=0; i < els.length; i++) {
        const el = els[i];
        if (allowTransitions) {
          el.classList.remove('notransition');
        } else {
          el.classList.add('notransition');
        }
      }
    }
    const isFileUrl = () => {
      return window.location.protocol === 'file:';
    }
    const hasAlternateSentinel = () => {
      let styleSentinel = getColorSchemeSentinel();
      if (styleSentinel !== null) {
        return styleSentinel === "alternate";
      } else {
        return false;
      }
    }
    const setStyleSentinel = (alternate) => {
      const value = alternate ? "alternate" : "default";
      if (!isFileUrl()) {
        window.localStorage.setItem("quarto-color-scheme", value);
      } else {
        localAlternateSentinel = value;
      }
    }
    const getColorSchemeSentinel = () => {
      if (!isFileUrl()) {
        const storageValue = window.localStorage.getItem("quarto-color-scheme");
        return storageValue != null ? storageValue : localAlternateSentinel;
      } else {
        return localAlternateSentinel;
      }
    }
    const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
      const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
      const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
      let newTheme = '';
      if(authorPrefersDark) {
        newTheme = isAlternate ? baseTheme : alternateTheme;
      } else {
        newTheme = isAlternate ? alternateTheme : baseTheme;
      }
      const changeGiscusTheme = () => {
        // From: https://github.com/giscus/giscus/issues/336
        const sendMessage = (message) => {
          const iframe = document.querySelector('iframe.giscus-frame');
          if (!iframe) return;
          iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
        }
        sendMessage({
          setConfig: {
            theme: newTheme
          }
        });
      }
      const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
      if (isGiscussLoaded) {
        changeGiscusTheme();
      }
    };
    const authorPrefersDark = false;
    const darkModeDefault = authorPrefersDark;
      document.querySelector('link#quarto-text-highlighting-styles.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
      document.querySelector('link#quarto-bootstrap.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
    let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
    // Dark / light mode switch
    window.quartoToggleColorScheme = () => {
      // Read the current dark / light value
      let toAlternate = !hasAlternateSentinel();
      toggleColorMode(toAlternate);
      setStyleSentinel(toAlternate);
      toggleGiscusIfUsed(toAlternate, darkModeDefault);
      window.dispatchEvent(new Event('resize'));
    };
    // Switch to dark mode if need be
    if (hasAlternateSentinel()) {
      toggleColorMode(true);
    } else {
      toggleColorMode(false);
    }
  </script>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="https://turinglang.org/" class="navbar-brand navbar-brand-logo">
    <img src="../../../assets/images/turing-logo.svg" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="https://turinglang.org/">
    <span class="navbar-title">Turing.jl</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../getting-started/"> 
<span class="menu-text">Get Started</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../tutorials/coin-flipping/"> 
<span class="menu-text">Tutorials</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/library/"> 
<span class="menu-text">Libraries</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/news/"> 
<span class="menu-text">News</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/team/"> 
<span class="menu-text">Team</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-v0.38" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">v0.38</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-v0.38">    
        <li>
    <a class="dropdown-item" href="https://turinglang.org/docs/changelog.html">
 <span class="dropdown-text">Changelog</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://turinglang.org/docs/versions.html">
 <span class="dropdown-text">All Versions</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools tools-wide">
    <a href="https://x.com/TuringLang" title="Turing Twitter" class="quarto-navigation-tool px-1" aria-label="Turing Twitter"><i class="bi bi-twitter"></i></a>
    <a href="https://github.com/TuringLang/Turing.jl" title="Turing GitHub" class="quarto-navigation-tool px-1" aria-label="Turing GitHub"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../../developers/contributing/index.html">Developers</a></li><li class="breadcrumb-item"><a href="../../../developers/inference/abstractmcmc-interface/index.html">Inference (note: outdated)</a></li><li class="breadcrumb-item"><a href="../../../developers/inference/implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../getting-started/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Getting Started</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../core-functionality/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Core Functionality</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false">
 <span class="menu-text">User Guide</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/automatic-differentiation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Automatic Differentiation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/custom-distribution/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Custom Distributions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/probability-interface/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Querying Model Probabilities</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/modifying-logprob/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Modifying the Log Probability</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/tracking-extra-quantities/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Tracking Extra Quantities</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/mode-estimation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Mode Estimation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/performance-tips/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Performance Tips</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/sampler-visualisation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Sampler Visualization</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/dynamichmc/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using DynamicHMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/external-samplers/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using External Samplers</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false">
 <span class="menu-text">Tutorials</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/coin-flipping/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction: Coin Flipping</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/gaussian-mixture-models/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Mixture Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-neural-networks/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Neural Networks</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/hidden-markov-models/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Hidden Markov Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-linear-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Linear Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/infinite-mixture-models/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Infinite Mixture Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-poisson-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Poisson Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/multinomial-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Multinomial Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-differential-equations/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Differential Equations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/probabilistic-pca/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Probabilistic PCA</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-time-series-analysis/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Time Series Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/gaussian-processes-introduction/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Processes: Introduction</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/gaussian-process-latent-variable-models/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Process Latent Variable Models</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Developers</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/contributing/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Contributing</span></a>
  </div>
</li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false">
 <span class="menu-text">DynamicPPL’s Compiler</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/compiler/model-manual/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Manually Defining a Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/compiler/minituring-compiler/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation I: Compiler</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/compiler/minituring-contexts/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation II: Contexts</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/compiler/design-overview/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Turing Compiler Design (Outdated)</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false">
 <span class="menu-text">Variable Transformations</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/transforms/distributions/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Distributions and the Jacobian</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/transforms/bijectors/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bijectors in MCMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/transforms/dynamicppl/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variable transformations in DynamicPPL</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true">
 <span class="menu-text">Inference (note: outdated)</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/inference/abstractmcmc-interface/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Interface Guide</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/inference/abstractmcmc-turing/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">How Turing Implements AbstractMCMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/inference/variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/inference/implementing-samplers/index.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Implementing Samplers</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of Contents</h2>
   
  <ul>
  <li><a href="#quick-overview-of-mala" id="toc-quick-overview-of-mala" class="nav-link active" data-scroll-target="#quick-overview-of-mala">Quick overview of MALA</a></li>
  <li><a href="#what-we-need-from-a-model-logdensityproblems.jl" id="toc-what-we-need-from-a-model-logdensityproblems.jl" class="nav-link" data-scroll-target="#what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: LogDensityProblems.jl</a></li>
  <li><a href="#implementing-mala-in-abstractmcmc.jl" id="toc-implementing-mala-in-abstractmcmc.jl" class="nav-link" data-scroll-target="#implementing-mala-in-abstractmcmc.jl">Implementing MALA in AbstractMCMC.jl</a></li>
  <li><a href="#using-our-sampler-with-turing.jl" id="toc-using-our-sampler-with-turing.jl" class="nav-link" data-scroll-target="#using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</a>
  <ul class="collapse">
  <li><a href="#models-with-constrained-parameters" id="toc-models-with-constrained-parameters" class="nav-link" data-scroll-target="#models-with-constrained-parameters">Models with constrained parameters</a></li>
  </ul></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/TuringLang/docs/edit/main/developers/inference/implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/docs/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">


<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../../developers/contributing/index.html">Developers</a></li><li class="breadcrumb-item"><a href="../../../developers/inference/abstractmcmc-interface/index.html">Inference (note: outdated)</a></li><li class="breadcrumb-item"><a href="../../../developers/inference/implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Implementing Samplers</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>In this tutorial, we’ll go through step-by-step how to implement a “simple” sampler in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> in such a way that it can be easily applied to Turing.jl models.</p>
<p>In particular, we’re going to implement a version of <strong>Metropolis-adjusted Langevin (MALA)</strong>.</p>
<p>Note that we will implement this sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> framework, completely “ignoring” Turing.jl until the very end of the tutorial, at which point we’ll use a single line of code to make the resulting sampler available to Turing.jl. This is to really drive home the point that one can implement samplers in a way that is accessible to all of Turing.jl’s users without having to use Turing.jl yourself.</p>
<section id="quick-overview-of-mala" class="level2">
<h2 class="anchored" data-anchor-id="quick-overview-of-mala">Quick overview of MALA</h2>
<p>We can view MALA as a single step of the leapfrog intergrator with resampling of momentum <span class="math inline">\(p\)</span> at every step.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> To make that statement a bit more concrete, we first define the <em>extended</em> target <span class="math inline">\(\bar{\gamma}(x, p)\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\log \bar{\gamma}(x, p) \propto \log \gamma(x) + \log \gamma_{\mathcal{N}(0, M)}(p)
\end{equation*}\]</span></p>
<p>where <span class="math inline">\(\gamma_{\mathcal{N}(0, M)}\)</span> denotes the density for a zero-centered Gaussian with covariance matrix <span class="math inline">\(M\)</span>. We then consider targeting this joint distribution over both <span class="math inline">\(x\)</span> and <span class="math inline">\(p\)</span> as follows. First we define the map</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  L_{\epsilon}: \quad &amp; \mathbb{R}^d \times \mathbb{R}^d \to \mathbb{R}^d \times \mathbb{R}^d \\
  &amp; (x, p) \mapsto (\tilde{x}, \tilde{p}) := L_{\epsilon}(x, p)
\end{split}
\end{equation*}\]</span></p>
<p>as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p_{1 / 2} &amp;:= p + \frac{\epsilon}{2} \nabla \log \gamma(x) \\
  \tilde{x} &amp;:= x + \epsilon M^{-1} p_{1 /2 } \\
  p_1 &amp;:= p_{1 / 2} + \frac{\epsilon}{2} \nabla \log \gamma(\tilde{x}) \\
  \tilde{p} &amp;:= - p_1
\end{split}
\end{equation*}\]</span></p>
<p>This might be familiar for some readers as a single step of the Leapfrog integrator. We then define the MALA kernel as follows: given the current iterate <span class="math inline">\(x_i\)</span>, we sample the next iterate <span class="math inline">\(x_{i + 1}\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p &amp;\sim \mathcal{N}(0, M) \\
  (\tilde{x}, \tilde{p}) &amp;:= L_{\epsilon}(x_i, p) \\
  \alpha &amp;:= \min \left\{ 1, \frac{\bar{\gamma}(\tilde{x}, \tilde{p})}{\bar{\gamma}(x_i, p)} \right\} \\
  x_{i + 1} &amp;:=
  \begin{cases}
    \tilde{x} \quad &amp; \text{ with prob. } \alpha \\
    x_i       \quad &amp; \text{ with prob. } 1 - \alpha
  \end{cases}
\end{split}
\end{equation*}\]</span></p>
<p>i.e.&nbsp;we accept the proposal <span class="math inline">\(\tilde{x}\)</span> with probability <span class="math inline">\(\alpha\)</span> and reject it, thus sticking with our current iterate, with probability <span class="math inline">\(1 - \alpha\)</span>.</p>
</section>
<section id="what-we-need-from-a-model-logdensityproblems.jl" class="level2">
<h2 class="anchored" data-anchor-id="what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a></h2>
<p>There are a few things we need from the “target” / “model” / density that we want to sample from:</p>
<ol type="1">
<li>We need access to log-density <em>evaluations</em> <span class="math inline">\(\log \gamma(x)\)</span> so we can compute the acceptance ratio involving <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>We need access to log-density <em>gradients</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span> so we can compute the Leapfrog steps <span class="math inline">\(L_{\epsilon}(x, p)\)</span>.</li>
<li>We also need access to the “size” of the model so we can determine the size of <span class="math inline">\(M\)</span>.</li>
</ol>
<p>Luckily for us, there is a package called <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> which provides an interface for <em>exactly</em> this!</p>
<p>To demonstrate how one can implement the “<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface”<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> we will use a simple Gaussian model as an example:</p>
<div id="4" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblems</span>: LogDensityProblems;</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's define some type that represents the model.</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> IsotropicNormalModel{M<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"mean of the isotropic Gaussian"</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    mean<span class="op">::</span><span class="dt">M</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Specifies what input length the model expects.</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">dimension</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> <span class="fu">length</span>(model.mean)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Implementation of the log-density evaluation of the model.</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x<span class="op">::</span><span class="dt">AbstractVector{&lt;:Real}</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">-</span> <span class="fu">sum</span>(abs2, x <span class="op">.-</span> model.mean) <span class="op">/</span> <span class="fl">2</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This gives us all of the properties we want for our MALA sampler with the exception of the computation of the <em>gradient</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span>. There is the method <code>LogDensityProblems.logdensity_and_gradient</code> which should return a 2-tuple where the first entry is the evaluation of the logdensity <span class="math inline">\(\log \gamma(x)\)</span> and the second entry is the gradient <span class="math inline">\(\nabla \log \gamma(x)\)</span>.</p>
<p>There are two ways to “implement” this method: 1) we implement it by hand, which is feasible in the case of our <code>IsotropicNormalModel</code>, or b) we defer the implementation of this to a automatic differentiation backend.</p>
<p>To implement it by hand we can simply do</p>
<div id="6" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl that first-order, i.e. gradient information, is available.</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{1}</span>()</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Implement `logdensity_and_gradient`.</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    logγ_x <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="op">-</span>x <span class="op">.*</span> (x <span class="op">-</span> model.mean)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> logγ_x, ∇logγ_x</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s just try it out:</p>
<div id="8" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate the problem.</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> <span class="fu">IsotropicNormalModel</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.])</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create some example input that we can test on.</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>x_example <span class="op">=</span> <span class="fu">randn</span>(LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate!</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-28.505656472582732</code></pre>
</div>
</div>
<p>To defer it to an automatic differentiation backend, we can do</p>
<div id="10" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl we only have access to 0-th order information.</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{0}</span>()</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Use `LogDensityProblemsAD`'s `ADgradient` in combination with some AD backend to implement `logdensity_and_gradient`.</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblemsAD</span>, <span class="bu">ADTypes</span>, <span class="bu">ForwardDiff</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>model_with_grad <span class="op">=</span> <span class="fu">ADgradient</span>(<span class="fu">AutoForwardDiff</span>(), model)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model_with_grad, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-28.505656472582732</code></pre>
</div>
</div>
<p>We’ll continue with the second approach in this tutorial since this is typically what one does in practice, because there are better hobbies to spend time on than deriving gradients by hand.</p>
<p>At this point, one might wonder how we’re going to tie this back to Turing.jl in the end. Effectively, when working with inference methods that only require log-density evaluations and / or higher-order information of the log-density, Turing.jl actually converts the user-provided <code>Model</code> into an object implementing the above methods for <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>. As a result, most samplers provided by Turing.jl are actually implemented to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, enabling their use both <em>within</em> Turing.jl and <em>outside</em> of Turing.jl! Morever, there exists similar conversions for Stan through BridgeStan and Stan<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, which means that a sampler supporting the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface can easily be used on both Turing.jl <em>and</em> Stan models (in addition to user-provided models, as our <code>IsotropicNormalModel</code> above)!</p>
<p>Anyways, let’s move on to actually implementing the sampler.</p>
</section>
<section id="implementing-mala-in-abstractmcmc.jl" class="level2">
<h2 class="anchored" data-anchor-id="implementing-mala-in-abstractmcmc.jl">Implementing MALA in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a></h2>
<p>Now that we’ve established that a model implementing the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface provides us with all the information we need from <span class="math inline">\(\log \gamma(x)\)</span>, we can address the question: given an object that implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, how can we define a sampler for it?</p>
<p>We’re going to do this by making our sampler a sub-type of <code>AbstractMCMC.AbstractSampler</code> in addition to implementing a few methods from <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>. Why? Because it gets us <em>a lot</em> of functionality for free, as we will see later.</p>
<p>Moreover, <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> provides a very natural interface for MCMC algorithms.</p>
<p>First, we’ll define our <code>MALA</code> type</p>
<div id="12" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">AbstractMCMC</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALA{T,A} <span class="op">&lt;:</span><span class="dt"> AbstractMCMC.AbstractSampler</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"stepsize used in the leapfrog step"</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    ϵ_init<span class="op">::</span><span class="dt">T</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"covariance matrix used for the momentum"</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    M_init<span class="op">::</span><span class="dt">A</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notice how we’ve added the suffix <code>_init</code> to both the stepsize and the covariance matrix. We’ve done this because a <code>AbstractMCMC.AbstractSampler</code> should be <em>immutable</em>. Of course there might be many scenarios where we want to allow something like the stepsize and / or the covariance matrix to vary between iterations, e.g.&nbsp;during the burn-in / adaptation phase of the sampling process we might want to adjust the parameters using statistics computed from these initial iterations. But information which can change between iterations <em>should not go in the sampler itself</em>! Instead, this information should go in the sampler <em>state</em>.</p>
<p>The sampler state should at the very least contain all the necessary information to perform the next MCMC iteration, but usually contains further information, e.g.&nbsp;quantities and statistics useful for evaluating whether the sampler has converged.</p>
<p>We will use the following sampler state for our <code>MALA</code> sampler:</p>
<div id="14" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALAState{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This might seem overly redundant: we’re defining a type <code>MALAState</code> and it only contains a simple vector of reals. In this particular case we indeed could have dropped this and simply used a <code>AbstractVector{&lt;:Real}</code> as our sampler state, but typically, as we will see later, one wants to include other quantities in the sampler state. For example, if we also wanted to adapt the parameters of our <code>MALA</code>, e.g.&nbsp;alter the stepsize depending on acceptance rates, in which case we should also put <code>ϵ</code> in the state, but for now we’ll keep things simple.</p>
<p>Moreover, we also want a <em>sample</em> type, which is a type meant for “public consumption”, i.e.&nbsp;the end-user. This is generally going to contain a subset of the information present in the state. But in such a simple scenario as this, we similarly only have a <code>AbstractVector{&lt;:Real}</code>:</p>
<div id="16" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALASample{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We currently have three things:</p>
<ol type="1">
<li>A <code>AbstractMCMC.AbstractSampler</code> implementation called <code>MALA</code>.</li>
<li>A state <code>MALAState</code> for our sampler <code>MALA</code>.</li>
<li>A sample <code>MALASample</code> for our sampler <code>MALA</code>.</li>
</ol>
<p>That means that we’re ready to implement the only thing that really matters: <code>AbstractMCMC.step</code>.</p>
<p><code>AbstractMCMC.step</code> defines the MCMC iteration of our <code>MALA</code> given the current <code>MALAState</code>. Specifically, the signature of the function is as follows:</p>
<div id="18" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The RNG to ensure reproducibility.</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The model that defines our target.</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.AbstractModel</span>,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The sampler for which we're taking a `step`.</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">AbstractMCMC.AbstractSampler</span>,</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The current sampler `state`.</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    state;</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Additional keyword arguments that we may or may not need.</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Moreover, there is a specific <code>AbstractMCMC.AbstractModel</code> which is used to indicate that the model that is provided implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface: <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Since, as we discussed earlier, in our case we’re indeed going to work with types that support the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, we’ll define <code>AbstractMCMC.step</code> for such a <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Note that <code>AbstractMCMC.LogDensityModel</code> has no other purpose; it has a single field called <code>logdensity</code>, and it does nothing else. But by wrapping the model in <code>AbstractMCMC.LogDensityModel</code>, it allows samplers that want to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> to define their <code>AbstractMCMC.step</code> on this type without running into method ambiguities.</p>
<p>All in all, that means that the signature for our <code>AbstractMCMC.step</code> is going to be the following:</p>
<div id="20" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># `LogDensityModel` so we know we're working with LogDensityProblems.jl model.</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler.</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler state.</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Great! Now let’s actually implement the full <code>AbstractMCMC.step</code> for our <code>MALA</code>.</p>
<p>Let’s remind ourselves what we’re going to do:</p>
<ol type="1">
<li>Sample a new momentum <span class="math inline">\(p\)</span>.</li>
<li>Compute the log-density of the extended target <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>Take a single leapfrog step <span class="math inline">\((\tilde{x}, \tilde{p}) = L_{\epsilon}(x, p)\)</span>.</li>
<li>Accept or reject the proposed <span class="math inline">\((\tilde{x}, \tilde{p})\)</span>.</li>
</ol>
<p>All in all, this results in the following:</p>
<div id="22" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>: Random</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Distributions</span>  <span class="co"># so we get the `MvNormal`</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the wrapped model which implements LogDensityProblems.jl.</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just extract the sampler parameters to make our lives easier.</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    ϵ <span class="op">=</span> sampler.ϵ_init</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    M <span class="op">=</span> sampler.M_init</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the current parameters.</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> state.x</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sample the momentum.</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>    p_dist <span class="op">=</span> <span class="fu">MvNormal</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)), M)</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> <span class="fu">rand</span>(rng, p_dist)</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Propose using a single leapfrog step.</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>    x̃, p̃ <span class="op">=</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Accept or reject proposal.</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>    logp <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p)</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>    logp̃ <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x̃) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p̃)</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>    logα <span class="op">=</span> logp̃ <span class="op">-</span> logp</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>    state_new <span class="op">=</span> <span class="cf">if</span> <span class="fu">log</span>(<span class="fu">rand</span>(rng)) <span class="op">&lt;</span> logα</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Accept.</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x̃)</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Reject.</span></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x)</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return the "sample" and the sampler state.</span></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(state_new.x), state_new</span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Fairly straight-forward.</p>
<p>Of course, we haven’t defined the <code>leapfrog_step</code> method yet, so let’s do that:</p>
<div id="24" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p` using "position" `x`.</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x))</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    p1 <span class="op">=</span> p <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update the "position" `x` using momentum `p1`.</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    x̃ <span class="op">=</span> x <span class="op">+</span> ϵ <span class="op">.*</span> (M <span class="op">\</span> p1)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p1` using position `x̃`</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x̃ <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x̃))</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    p2 <span class="op">=</span> p1 <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x̃</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Flip momentum `p2`.</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    p̃ <span class="op">=</span> <span class="op">-</span>p2</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x̃, p̃</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>leapfrog_step (generic function with 1 method)</code></pre>
</div>
</div>
<p>With all of this, we’re technically ready to sample!</p>
<div id="26" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>, <span class="bu">LinearAlgebra</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>rng <span class="op">=</span> <span class="bu">Random</span>.<span class="fu">default_rng</span>()</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>sampler <span class="op">=</span> <span class="fu">MALA</span>(<span class="fl">1</span>, I)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>state <span class="op">=</span> <span class="fu">MALAState</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)))</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>x_next, state_next <span class="op">=</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    rng,</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    AbstractMCMC.<span class="fu">LogDensityModel</span>(model),</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    state</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>(MALASample{Vector{Float64}}([0.0, 0.0, 0.0]), MALAState{Vector{Float64}}([0.0, 0.0, 0.0]))</code></pre>
</div>
</div>
<p>Great, it works!</p>
<p>And I promised we would get quite some functionality for free if we implemented <code>AbstractMCMC.step</code>, and so we can now simply call <code>sample</code> to perform standard MCMC sampling:</p>
<div id="28" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform 1000 iterations with our `MALA` sampler.</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; initial_state<span class="op">=</span>state, progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Concatenate into a matrix.</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000 Matrix{Float64}:
 -3.9337   -2.71391   -4.28741   -4.28741   …  -5.21552   -3.59967   -6.41772
 -0.39055  -0.429891  -0.868584  -0.868584      0.777783   0.329352   1.09237
  4.02229   4.5167     5.87087    5.87087       6.18105    5.63094    5.52994</code></pre>
</div>
</div>
<div id="30" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the marginal means and standard deviations.</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -4.99046    0.999236
  0.0320416  0.990931
  4.99721    1.00408</code></pre>
</div>
</div>
<p>Let’s visualize the samples</p>
<div id="32" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">StatsPlots</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">transpose</span>(samples_matrix[<span class="op">:</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">:</span><span class="kw">end</span>]), alpha<span class="op">=</span><span class="fl">0.5</span>, legend<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<!--?xml version="1.0" encoding="utf-8"?-->
<svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" width="672" height="480" viewbox="0 0 2688 1920">
<defs>
  <clippath id="clip120">
    <rect x="0" y="0" width="2688" height="1920"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip120)" d="M0 1920 L2688 1920 L2688 0 L0 0  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip121">
    <rect x="537" y="0" width="1883" height="1883"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip120)" d="M196.816 1800.78 L2640.76 1800.78 L2640.76 47.2441 L196.816 47.2441  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip122">
    <rect x="196" y="47" width="2445" height="1755"></rect>
  </clippath>
</defs>
<polyline clip-path="url(#clip122)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="263.676,1800.78 263.676,47.2441 "></polyline>
<polyline clip-path="url(#clip122)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="840.654,1800.78 840.654,47.2441 "></polyline>
<polyline clip-path="url(#clip122)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1417.63,1800.78 1417.63,47.2441 "></polyline>
<polyline clip-path="url(#clip122)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1994.61,1800.78 1994.61,47.2441 "></polyline>
<polyline clip-path="url(#clip122)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="2571.59,1800.78 2571.59,47.2441 "></polyline>
<polyline clip-path="url(#clip122)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,1663.78 2640.76,1663.78 "></polyline>
<polyline clip-path="url(#clip122)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,1422.42 2640.76,1422.42 "></polyline>
<polyline clip-path="url(#clip122)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,1181.06 2640.76,1181.06 "></polyline>
<polyline clip-path="url(#clip122)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,939.705 2640.76,939.705 "></polyline>
<polyline clip-path="url(#clip122)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,698.348 2640.76,698.348 "></polyline>
<polyline clip-path="url(#clip122)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,456.992 2640.76,456.992 "></polyline>
<polyline clip-path="url(#clip122)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,215.635 2640.76,215.635 "></polyline>
<polyline clip-path="url(#clip120)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1800.78 2640.76,1800.78 "></polyline>
<polyline clip-path="url(#clip120)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="263.676,1800.78 263.676,1781.88 "></polyline>
<polyline clip-path="url(#clip120)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="840.654,1800.78 840.654,1781.88 "></polyline>
<polyline clip-path="url(#clip120)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1417.63,1800.78 1417.63,1781.88 "></polyline>
<polyline clip-path="url(#clip120)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1994.61,1800.78 1994.61,1781.88 "></polyline>
<polyline clip-path="url(#clip120)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="2571.59,1800.78 2571.59,1781.88 "></polyline>
<path clip-path="url(#clip120)" d="M263.676 1834 Q260.065 1834 258.236 1837.57 Q256.431 1841.11 256.431 1848.24 Q256.431 1855.34 258.236 1858.91 Q260.065 1862.45 263.676 1862.45 Q267.31 1862.45 269.116 1858.91 Q270.945 1855.34 270.945 1848.24 Q270.945 1841.11 269.116 1837.57 Q267.31 1834 263.676 1834 M263.676 1830.3 Q269.486 1830.3 272.542 1834.9 Q275.621 1839.49 275.621 1848.24 Q275.621 1856.96 272.542 1861.57 Q269.486 1866.15 263.676 1866.15 Q257.866 1866.15 254.787 1861.57 Q251.732 1856.96 251.732 1848.24 Q251.732 1839.49 254.787 1834.9 Q257.866 1830.3 263.676 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip120)" d="M804.346 1861.55 L820.666 1861.55 L820.666 1865.48 L798.721 1865.48 L798.721 1861.55 Q801.383 1858.79 805.967 1854.16 Q810.573 1849.51 811.754 1848.17 Q813.999 1845.65 814.879 1843.91 Q815.782 1842.15 815.782 1840.46 Q815.782 1837.71 813.837 1835.97 Q811.916 1834.23 808.814 1834.23 Q806.615 1834.23 804.161 1835 Q801.731 1835.76 798.953 1837.31 L798.953 1832.59 Q801.777 1831.46 804.231 1830.88 Q806.684 1830.3 808.721 1830.3 Q814.092 1830.3 817.286 1832.98 Q820.481 1835.67 820.481 1840.16 Q820.481 1842.29 819.67 1844.21 Q818.883 1846.11 816.777 1848.7 Q816.198 1849.37 813.096 1852.59 Q809.995 1855.78 804.346 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip120)" d="M830.527 1830.92 L848.883 1830.92 L848.883 1834.86 L834.809 1834.86 L834.809 1843.33 Q835.828 1842.98 836.846 1842.82 Q837.865 1842.64 838.883 1842.64 Q844.67 1842.64 848.05 1845.81 Q851.43 1848.98 851.43 1854.4 Q851.43 1859.97 847.957 1863.08 Q844.485 1866.15 838.166 1866.15 Q835.99 1866.15 833.721 1865.78 Q831.476 1865.41 829.069 1864.67 L829.069 1859.97 Q831.152 1861.11 833.374 1861.66 Q835.596 1862.22 838.073 1862.22 Q842.078 1862.22 844.416 1860.11 Q846.754 1858.01 846.754 1854.4 Q846.754 1850.78 844.416 1848.68 Q842.078 1846.57 838.073 1846.57 Q836.198 1846.57 834.323 1846.99 Q832.471 1847.4 830.527 1848.28 L830.527 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip120)" d="M870.642 1834 Q867.031 1834 865.203 1837.57 Q863.397 1841.11 863.397 1848.24 Q863.397 1855.34 865.203 1858.91 Q867.031 1862.45 870.642 1862.45 Q874.277 1862.45 876.082 1858.91 Q877.911 1855.34 877.911 1848.24 Q877.911 1841.11 876.082 1837.57 Q874.277 1834 870.642 1834 M870.642 1830.3 Q876.453 1830.3 879.508 1834.9 Q882.587 1839.49 882.587 1848.24 Q882.587 1856.96 879.508 1861.57 Q876.453 1866.15 870.642 1866.15 Q864.832 1866.15 861.754 1861.57 Q858.698 1856.96 858.698 1848.24 Q858.698 1839.49 861.754 1834.9 Q864.832 1830.3 870.642 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip120)" d="M1377.25 1830.92 L1395.61 1830.92 L1395.61 1834.86 L1381.53 1834.86 L1381.53 1843.33 Q1382.55 1842.98 1383.57 1842.82 Q1384.59 1842.64 1385.61 1842.64 Q1391.39 1842.64 1394.77 1845.81 Q1398.15 1848.98 1398.15 1854.4 Q1398.15 1859.97 1394.68 1863.08 Q1391.21 1866.15 1384.89 1866.15 Q1382.71 1866.15 1380.44 1865.78 Q1378.2 1865.41 1375.79 1864.67 L1375.79 1859.97 Q1377.88 1861.11 1380.1 1861.66 Q1382.32 1862.22 1384.8 1862.22 Q1388.8 1862.22 1391.14 1860.11 Q1393.48 1858.01 1393.48 1854.4 Q1393.48 1850.78 1391.14 1848.68 Q1388.8 1846.57 1384.8 1846.57 Q1382.92 1846.57 1381.05 1846.99 Q1379.19 1847.4 1377.25 1848.28 L1377.25 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip120)" d="M1417.37 1834 Q1413.75 1834 1411.93 1837.57 Q1410.12 1841.11 1410.12 1848.24 Q1410.12 1855.34 1411.93 1858.91 Q1413.75 1862.45 1417.37 1862.45 Q1421 1862.45 1422.81 1858.91 Q1424.63 1855.34 1424.63 1848.24 Q1424.63 1841.11 1422.81 1837.57 Q1421 1834 1417.37 1834 M1417.37 1830.3 Q1423.18 1830.3 1426.23 1834.9 Q1429.31 1839.49 1429.31 1848.24 Q1429.31 1856.96 1426.23 1861.57 Q1423.18 1866.15 1417.37 1866.15 Q1411.56 1866.15 1408.48 1861.57 Q1405.42 1856.96 1405.42 1848.24 Q1405.42 1839.49 1408.48 1834.9 Q1411.56 1830.3 1417.37 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip120)" d="M1447.53 1834 Q1443.92 1834 1442.09 1837.57 Q1440.28 1841.11 1440.28 1848.24 Q1440.28 1855.34 1442.09 1858.91 Q1443.92 1862.45 1447.53 1862.45 Q1451.16 1862.45 1452.97 1858.91 Q1454.8 1855.34 1454.8 1848.24 Q1454.8 1841.11 1452.97 1837.57 Q1451.16 1834 1447.53 1834 M1447.53 1830.3 Q1453.34 1830.3 1456.39 1834.9 Q1459.47 1839.49 1459.47 1848.24 Q1459.47 1856.96 1456.39 1861.57 Q1453.34 1866.15 1447.53 1866.15 Q1441.72 1866.15 1438.64 1861.57 Q1435.58 1856.96 1435.58 1848.24 Q1435.58 1839.49 1438.64 1834.9 Q1441.72 1830.3 1447.53 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip120)" d="M1952.89 1830.92 L1975.11 1830.92 L1975.11 1832.91 L1962.56 1865.48 L1957.68 1865.48 L1969.48 1834.86 L1952.89 1834.86 L1952.89 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip120)" d="M1984.27 1830.92 L2002.63 1830.92 L2002.63 1834.86 L1988.56 1834.86 L1988.56 1843.33 Q1989.58 1842.98 1990.59 1842.82 Q1991.61 1842.64 1992.63 1842.64 Q1998.42 1842.64 2001.8 1845.81 Q2005.18 1848.98 2005.18 1854.4 Q2005.18 1859.97 2001.7 1863.08 Q1998.23 1866.15 1991.91 1866.15 Q1989.74 1866.15 1987.47 1865.78 Q1985.22 1865.41 1982.82 1864.67 L1982.82 1859.97 Q1984.9 1861.11 1987.12 1861.66 Q1989.34 1862.22 1991.82 1862.22 Q1995.83 1862.22 1998.16 1860.11 Q2000.5 1858.01 2000.5 1854.4 Q2000.5 1850.78 1998.16 1848.68 Q1995.83 1846.57 1991.82 1846.57 Q1989.95 1846.57 1988.07 1846.99 Q1986.22 1847.4 1984.27 1848.28 L1984.27 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip120)" d="M2024.39 1834 Q2020.78 1834 2018.95 1837.57 Q2017.14 1841.11 2017.14 1848.24 Q2017.14 1855.34 2018.95 1858.91 Q2020.78 1862.45 2024.39 1862.45 Q2028.02 1862.45 2029.83 1858.91 Q2031.66 1855.34 2031.66 1848.24 Q2031.66 1841.11 2029.83 1837.57 Q2028.02 1834 2024.39 1834 M2024.39 1830.3 Q2030.2 1830.3 2033.26 1834.9 Q2036.33 1839.49 2036.33 1848.24 Q2036.33 1856.96 2033.26 1861.57 Q2030.2 1866.15 2024.39 1866.15 Q2018.58 1866.15 2015.5 1861.57 Q2012.45 1856.96 2012.45 1848.24 Q2012.45 1839.49 2015.5 1834.9 Q2018.58 1830.3 2024.39 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip120)" d="M2516.11 1861.55 L2523.75 1861.55 L2523.75 1835.18 L2515.44 1836.85 L2515.44 1832.59 L2523.71 1830.92 L2528.38 1830.92 L2528.38 1861.55 L2536.02 1861.55 L2536.02 1865.48 L2516.11 1865.48 L2516.11 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip120)" d="M2555.47 1834 Q2551.85 1834 2550.03 1837.57 Q2548.22 1841.11 2548.22 1848.24 Q2548.22 1855.34 2550.03 1858.91 Q2551.85 1862.45 2555.47 1862.45 Q2559.1 1862.45 2560.9 1858.91 Q2562.73 1855.34 2562.73 1848.24 Q2562.73 1841.11 2560.9 1837.57 Q2559.1 1834 2555.47 1834 M2555.47 1830.3 Q2561.28 1830.3 2564.33 1834.9 Q2567.41 1839.49 2567.41 1848.24 Q2567.41 1856.96 2564.33 1861.57 Q2561.28 1866.15 2555.47 1866.15 Q2549.66 1866.15 2546.58 1861.57 Q2543.52 1856.96 2543.52 1848.24 Q2543.52 1839.49 2546.58 1834.9 Q2549.66 1830.3 2555.47 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip120)" d="M2585.63 1834 Q2582.02 1834 2580.19 1837.57 Q2578.38 1841.11 2578.38 1848.24 Q2578.38 1855.34 2580.19 1858.91 Q2582.02 1862.45 2585.63 1862.45 Q2589.26 1862.45 2591.07 1858.91 Q2592.9 1855.34 2592.9 1848.24 Q2592.9 1841.11 2591.07 1837.57 Q2589.26 1834 2585.63 1834 M2585.63 1830.3 Q2591.44 1830.3 2594.49 1834.9 Q2597.57 1839.49 2597.57 1848.24 Q2597.57 1856.96 2594.49 1861.57 Q2591.44 1866.15 2585.63 1866.15 Q2579.82 1866.15 2576.74 1861.57 Q2573.68 1856.96 2573.68 1848.24 Q2573.68 1839.49 2576.74 1834.9 Q2579.82 1830.3 2585.63 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip120)" d="M2615.79 1834 Q2612.18 1834 2610.35 1837.57 Q2608.54 1841.11 2608.54 1848.24 Q2608.54 1855.34 2610.35 1858.91 Q2612.18 1862.45 2615.79 1862.45 Q2619.42 1862.45 2621.23 1858.91 Q2623.06 1855.34 2623.06 1848.24 Q2623.06 1841.11 2621.23 1837.57 Q2619.42 1834 2615.79 1834 M2615.79 1830.3 Q2621.6 1830.3 2624.65 1834.9 Q2627.73 1839.49 2627.73 1848.24 Q2627.73 1856.96 2624.65 1861.57 Q2621.6 1866.15 2615.79 1866.15 Q2609.98 1866.15 2606.9 1861.57 Q2603.84 1856.96 2603.84 1848.24 Q2603.84 1839.49 2606.9 1834.9 Q2609.98 1830.3 2615.79 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip120)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1800.78 196.816,47.2441 "></polyline>
<polyline clip-path="url(#clip120)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1663.78 215.714,1663.78 "></polyline>
<polyline clip-path="url(#clip120)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1422.42 215.714,1422.42 "></polyline>
<polyline clip-path="url(#clip120)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1181.06 215.714,1181.06 "></polyline>
<polyline clip-path="url(#clip120)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,939.705 215.714,939.705 "></polyline>
<polyline clip-path="url(#clip120)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,698.348 215.714,698.348 "></polyline>
<polyline clip-path="url(#clip120)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,456.992 215.714,456.992 "></polyline>
<polyline clip-path="url(#clip120)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,215.635 215.714,215.635 "></polyline>
<path clip-path="url(#clip120)" d="M50.5475 1664.23 L80.2233 1664.23 L80.2233 1668.16 L50.5475 1668.16 L50.5475 1664.23 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip120)" d="M89.1352 1646.5 L111.357 1646.5 L111.357 1648.49 L98.8111 1681.06 L93.9269 1681.06 L105.732 1650.43 L89.1352 1650.43 L89.1352 1646.5 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip120)" d="M120.478 1675.18 L125.362 1675.18 L125.362 1681.06 L120.478 1681.06 L120.478 1675.18 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip120)" d="M135.593 1646.5 L153.95 1646.5 L153.95 1650.43 L139.876 1650.43 L139.876 1658.9 Q140.894 1658.56 141.913 1658.39 Q142.931 1658.21 143.95 1658.21 Q149.737 1658.21 153.116 1661.38 Q156.496 1664.55 156.496 1669.97 Q156.496 1675.55 153.024 1678.65 Q149.552 1681.73 143.232 1681.73 Q141.056 1681.73 138.788 1681.36 Q136.542 1680.99 134.135 1680.25 L134.135 1675.55 Q136.218 1676.68 138.441 1677.24 Q140.663 1677.79 143.14 1677.79 Q147.144 1677.79 149.482 1675.69 Q151.82 1673.58 151.82 1669.97 Q151.82 1666.36 149.482 1664.25 Q147.144 1662.14 143.14 1662.14 Q141.265 1662.14 139.39 1662.56 Q137.538 1662.98 135.593 1663.86 L135.593 1646.5 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip120)" d="M49.5521 1422.87 L79.2279 1422.87 L79.2279 1426.81 L49.5521 1426.81 L49.5521 1422.87 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip120)" d="M89.3667 1405.14 L107.723 1405.14 L107.723 1409.07 L93.6491 1409.07 L93.6491 1417.55 Q94.6676 1417.2 95.6861 1417.04 Q96.7047 1416.85 97.7232 1416.85 Q103.51 1416.85 106.89 1420.02 Q110.269 1423.19 110.269 1428.61 Q110.269 1434.19 106.797 1437.29 Q103.325 1440.37 97.0056 1440.37 Q94.8297 1440.37 92.5612 1440 Q90.3158 1439.63 87.9084 1438.89 L87.9084 1434.19 Q89.9917 1435.32 92.2139 1435.88 Q94.4361 1436.43 96.913 1436.43 Q100.918 1436.43 103.256 1434.33 Q105.593 1432.22 105.593 1428.61 Q105.593 1425 103.256 1422.89 Q100.918 1420.79 96.913 1420.79 Q95.038 1420.79 93.163 1421.2 Q91.3112 1421.62 89.3667 1422.5 L89.3667 1405.14 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip120)" d="M119.482 1433.82 L124.367 1433.82 L124.367 1439.7 L119.482 1439.7 L119.482 1433.82 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip120)" d="M144.552 1408.22 Q140.941 1408.22 139.112 1411.78 Q137.306 1415.32 137.306 1422.45 Q137.306 1429.56 139.112 1433.12 Q140.941 1436.67 144.552 1436.67 Q148.186 1436.67 149.991 1433.12 Q151.82 1429.56 151.82 1422.45 Q151.82 1415.32 149.991 1411.78 Q148.186 1408.22 144.552 1408.22 M144.552 1404.51 Q150.362 1404.51 153.417 1409.12 Q156.496 1413.7 156.496 1422.45 Q156.496 1431.18 153.417 1435.79 Q150.362 1440.37 144.552 1440.37 Q138.741 1440.37 135.663 1435.79 Q132.607 1431.18 132.607 1422.45 Q132.607 1413.7 135.663 1409.12 Q138.741 1404.51 144.552 1404.51 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip120)" d="M50.5475 1181.51 L80.2233 1181.51 L80.2233 1185.45 L50.5475 1185.45 L50.5475 1181.51 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip120)" d="M94.3436 1194.41 L110.663 1194.41 L110.663 1198.34 L88.7186 1198.34 L88.7186 1194.41 Q91.3806 1191.65 95.9639 1187.02 Q100.57 1182.37 101.751 1181.03 Q103.996 1178.5 104.876 1176.77 Q105.779 1175.01 105.779 1173.32 Q105.779 1170.56 103.834 1168.83 Q101.913 1167.09 98.8111 1167.09 Q96.6121 1167.09 94.1584 1167.86 Q91.7278 1168.62 88.9501 1170.17 L88.9501 1165.45 Q91.7741 1164.31 94.2278 1163.74 Q96.6815 1163.16 98.7185 1163.16 Q104.089 1163.16 107.283 1165.84 Q110.478 1168.53 110.478 1173.02 Q110.478 1175.15 109.668 1177.07 Q108.881 1178.97 106.774 1181.56 Q106.195 1182.23 103.094 1185.45 Q99.9917 1188.64 94.3436 1194.41 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip120)" d="M120.478 1192.46 L125.362 1192.46 L125.362 1198.34 L120.478 1198.34 L120.478 1192.46 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip120)" d="M135.593 1163.78 L153.95 1163.78 L153.95 1167.72 L139.876 1167.72 L139.876 1176.19 Q140.894 1175.84 141.913 1175.68 Q142.931 1175.49 143.95 1175.49 Q149.737 1175.49 153.116 1178.67 Q156.496 1181.84 156.496 1187.25 Q156.496 1192.83 153.024 1195.93 Q149.552 1199.01 143.232 1199.01 Q141.056 1199.01 138.788 1198.64 Q136.542 1198.27 134.135 1197.53 L134.135 1192.83 Q136.218 1193.97 138.441 1194.52 Q140.663 1195.08 143.14 1195.08 Q147.144 1195.08 149.482 1192.97 Q151.82 1190.87 151.82 1187.25 Q151.82 1183.64 149.482 1181.54 Q147.144 1179.43 143.14 1179.43 Q141.265 1179.43 139.39 1179.85 Q137.538 1180.26 135.593 1181.14 L135.593 1163.78 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip120)" d="M99.3204 925.504 Q95.7093 925.504 93.8806 929.069 Q92.075 932.61 92.075 939.74 Q92.075 946.846 93.8806 950.411 Q95.7093 953.953 99.3204 953.953 Q102.955 953.953 104.76 950.411 Q106.589 946.846 106.589 939.74 Q106.589 932.61 104.76 929.069 Q102.955 925.504 99.3204 925.504 M99.3204 921.8 Q105.131 921.8 108.186 926.407 Q111.265 930.99 111.265 939.74 Q111.265 948.467 108.186 953.073 Q105.131 957.657 99.3204 957.657 Q93.5102 957.657 90.4315 953.073 Q87.376 948.467 87.376 939.74 Q87.376 930.99 90.4315 926.407 Q93.5102 921.8 99.3204 921.8 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip120)" d="M119.482 951.106 L124.367 951.106 L124.367 956.985 L119.482 956.985 L119.482 951.106 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip120)" d="M144.552 925.504 Q140.941 925.504 139.112 929.069 Q137.306 932.61 137.306 939.74 Q137.306 946.846 139.112 950.411 Q140.941 953.953 144.552 953.953 Q148.186 953.953 149.991 950.411 Q151.82 946.846 151.82 939.74 Q151.82 932.61 149.991 929.069 Q148.186 925.504 144.552 925.504 M144.552 921.8 Q150.362 921.8 153.417 926.407 Q156.496 930.99 156.496 939.74 Q156.496 948.467 153.417 953.073 Q150.362 957.657 144.552 957.657 Q138.741 957.657 135.663 953.073 Q132.607 948.467 132.607 939.74 Q132.607 930.99 135.663 926.407 Q138.741 921.8 144.552 921.8 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip120)" d="M94.3436 711.693 L110.663 711.693 L110.663 715.628 L88.7186 715.628 L88.7186 711.693 Q91.3806 708.939 95.9639 704.309 Q100.57 699.656 101.751 698.314 Q103.996 695.791 104.876 694.055 Q105.779 692.295 105.779 690.605 Q105.779 687.851 103.834 686.115 Q101.913 684.379 98.8111 684.379 Q96.6121 684.379 94.1584 685.143 Q91.7278 685.906 88.9501 687.457 L88.9501 682.735 Q91.7741 681.601 94.2278 681.022 Q96.6815 680.443 98.7185 680.443 Q104.089 680.443 107.283 683.129 Q110.478 685.814 110.478 690.305 Q110.478 692.434 109.668 694.355 Q108.881 696.254 106.774 698.846 Q106.195 699.517 103.094 702.735 Q99.9917 705.929 94.3436 711.693 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip120)" d="M120.478 709.749 L125.362 709.749 L125.362 715.628 L120.478 715.628 L120.478 709.749 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip120)" d="M135.593 681.068 L153.95 681.068 L153.95 685.004 L139.876 685.004 L139.876 693.476 Q140.894 693.129 141.913 692.967 Q142.931 692.781 143.95 692.781 Q149.737 692.781 153.116 695.953 Q156.496 699.124 156.496 704.541 Q156.496 710.119 153.024 713.221 Q149.552 716.3 143.232 716.3 Q141.056 716.3 138.788 715.929 Q136.542 715.559 134.135 714.818 L134.135 710.119 Q136.218 711.254 138.441 711.809 Q140.663 712.365 143.14 712.365 Q147.144 712.365 149.482 710.258 Q151.82 708.152 151.82 704.541 Q151.82 700.929 149.482 698.823 Q147.144 696.717 143.14 696.717 Q141.265 696.717 139.39 697.133 Q137.538 697.55 135.593 698.43 L135.593 681.068 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip120)" d="M89.3667 439.712 L107.723 439.712 L107.723 443.647 L93.6491 443.647 L93.6491 452.119 Q94.6676 451.772 95.6861 451.61 Q96.7047 451.425 97.7232 451.425 Q103.51 451.425 106.89 454.596 Q110.269 457.767 110.269 463.184 Q110.269 468.763 106.797 471.864 Q103.325 474.943 97.0056 474.943 Q94.8297 474.943 92.5612 474.573 Q90.3158 474.202 87.9084 473.462 L87.9084 468.763 Q89.9917 469.897 92.2139 470.452 Q94.4361 471.008 96.913 471.008 Q100.918 471.008 103.256 468.901 Q105.593 466.795 105.593 463.184 Q105.593 459.573 103.256 457.466 Q100.918 455.36 96.913 455.36 Q95.038 455.36 93.163 455.776 Q91.3112 456.193 89.3667 457.073 L89.3667 439.712 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip120)" d="M119.482 468.392 L124.367 468.392 L124.367 474.272 L119.482 474.272 L119.482 468.392 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip120)" d="M144.552 442.79 Q140.941 442.79 139.112 446.355 Q137.306 449.897 137.306 457.026 Q137.306 464.133 139.112 467.698 Q140.941 471.239 144.552 471.239 Q148.186 471.239 149.991 467.698 Q151.82 464.133 151.82 457.026 Q151.82 449.897 149.991 446.355 Q148.186 442.79 144.552 442.79 M144.552 439.087 Q150.362 439.087 153.417 443.693 Q156.496 448.277 156.496 457.026 Q156.496 465.753 153.417 470.36 Q150.362 474.943 144.552 474.943 Q138.741 474.943 135.663 470.36 Q132.607 465.753 132.607 457.026 Q132.607 448.277 135.663 443.693 Q138.741 439.087 144.552 439.087 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip120)" d="M89.1352 198.355 L111.357 198.355 L111.357 200.346 L98.8111 232.915 L93.9269 232.915 L105.732 202.29 L89.1352 202.29 L89.1352 198.355 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip120)" d="M120.478 227.035 L125.362 227.035 L125.362 232.915 L120.478 232.915 L120.478 227.035 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip120)" d="M135.593 198.355 L153.95 198.355 L153.95 202.29 L139.876 202.29 L139.876 210.762 Q140.894 210.415 141.913 210.253 Q142.931 210.068 143.95 210.068 Q149.737 210.068 153.116 213.239 Q156.496 216.41 156.496 221.827 Q156.496 227.406 153.024 230.508 Q149.552 233.586 143.232 233.586 Q141.056 233.586 138.788 233.216 Q136.542 232.846 134.135 232.105 L134.135 227.406 Q136.218 228.54 138.441 229.096 Q140.663 229.651 143.14 229.651 Q147.144 229.651 149.482 227.545 Q151.82 225.438 151.82 221.827 Q151.82 218.216 149.482 216.11 Q147.144 214.003 143.14 214.003 Q141.265 214.003 139.39 214.42 Q137.538 214.836 135.593 215.716 L135.593 198.355 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip122)" style="stroke:#009af9; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="265.984,1319.48 268.292,1354.68 270.6,1463.64 272.908,1399.48 275.216,1460.08 277.524,1506.11 279.832,1362.58 282.139,1359.95 284.447,1462.05 286.755,1431.96 289.063,1214.4 291.371,1473.01 293.679,1475.31 295.987,1345.67 298.295,1528.3 300.603,1563.55 302.911,1567.41 305.219,1483.98 307.527,1416.08 309.834,1368.32 312.142,1506.45 314.45,1509.16 316.758,1526.19 319.066,1517.04 321.374,1460.03 323.682,1300.16 325.99,1339.3 328.298,1396.1 330.606,1495.42 332.914,1404.47 335.221,1341.48 337.529,1610.08 339.837,1509.41 342.145,1613.09 344.453,1373.19 346.761,1365.6 349.069,1360.6 351.377,1442.94 353.685,1400.38 355.993,1440.85 358.301,1326.34 360.608,1481.22 362.916,1307.96 365.224,1477.9 367.532,1437.64 369.84,1372.83 372.148,1490.79 374.456,1537.34 376.764,1218.88 379.072,1522.64 381.38,1359.73 383.688,1345.31 385.996,1379.94 388.303,1468.72 390.611,1450.54 392.919,1403.05 395.227,1199.53 397.535,1341.95 399.843,1444.77 402.151,1468.5 404.459,1408.77 406.767,1542.19 409.075,1379.25 411.383,1403.85 413.69,1542.02 415.998,1460.58 418.306,1265.81 420.614,1386.44 422.922,1403.78 425.23,1380.62 427.538,1410.15 429.846,1441.5 432.154,1398.05 434.462,1494.05 436.77,1344.84 439.077,1328.21 441.385,1346.22 443.693,1430 446.001,1358.21 448.309,1261.61 450.617,1406.82 452.925,1474.4 455.233,1432.38 457.541,1550.29 459.849,1451.92 462.157,1356 464.465,1524.99 466.772,1392.74 469.08,1620.32 471.388,1475.86 473.696,1568.21 476.004,1476.45 478.312,1326.45 480.62,1448.05 482.928,1606.39 485.236,1319.15 487.544,1380.5 489.852,1608.6 492.159,1337.12 494.467,1430.43 496.775,1490.2 499.083,1482.04 501.391,1532.2 503.699,1547.97 506.007,1290.12 508.315,1481.07 510.623,1582.53 512.931,1430.83 515.239,1429.5 517.546,1264.37 519.854,1507.76 522.162,1393.01 524.47,1464.63 526.778,1377.82 529.086,1293.72 531.394,1488.72 533.702,1329.13 536.01,1305.14 538.318,1482.04 540.626,1409.66 542.933,1555.26 545.241,1530.73 547.549,1228.55 549.857,1417.23 552.165,1309.62 554.473,1521.52 556.781,1370.04 559.089,1464.36 561.397,1553.54 563.705,1290.41 566.013,1510.46 568.321,1494.23 570.628,1402.23 572.936,1459.74 575.244,1466.28 577.552,1414.87 579.86,1290.73 582.168,1415.28 584.476,1378.29 586.784,1394.19 589.092,1364.37 591.4,1481.42 593.708,1474.87 596.015,1432.66 598.323,1360.16 600.631,1510.88 602.939,1523.63 605.247,1369.92 607.555,1387.51 609.863,1403.23 612.171,1626.55 614.479,1572.34 616.787,1613.01 619.095,1479.75 621.402,1462.44 623.71,1515.57 626.018,1241.67 628.326,1462.76 630.634,1350.27 632.942,1365.83 635.25,1291.15 637.558,1563.28 639.866,1358.62 642.174,1265.41 644.482,1323.51 646.79,1450 649.097,1481.97 651.405,1492.05 653.713,1380.87 656.021,1293.97 658.329,1400.69 660.637,1425.71 662.945,1457.89 665.253,1496.1 667.561,1425.93 669.869,1362.32 672.177,1417.2 674.484,1197.92 676.792,1477.98 679.1,1379.95 681.408,1525.93 683.716,1388.08 686.024,1458.74 688.332,1416.94 690.64,1444.09 692.948,1222.59 695.256,1447.09 697.564,1301.63 699.871,1431.54 702.179,1328.59 704.487,1382.83 706.795,1274.39 709.103,1480.23 711.411,1519.13 713.719,1433.18 716.027,1438.99 718.335,1380.26 720.643,1608.64 722.951,1493.95 725.259,1517.72 727.566,1391.24 729.874,1520.68 732.182,1279.2 734.49,1371.93 736.798,1553.79 739.106,1376.9 741.414,1367.82 743.722,1340.08 746.03,1310.82 748.338,1269.62 750.646,1404.76 752.953,1448.25 755.261,1318.79 757.569,1390.46 759.877,1396.8 762.185,1355.68 764.493,1502.89 766.801,1357.54 769.109,1302.85 771.417,1425.35 773.725,1459.2 776.033,1433.69 778.34,1531.7 780.648,1465.97 782.956,1337.89 785.264,1344.71 787.572,1582.87 789.88,1339.28 792.188,1480.54 794.496,1282.94 796.804,1559.42 799.112,1380.03 801.42,1520.01 803.728,1381.1 806.035,1546.12 808.343,1569 810.651,1267.39 812.959,1436 815.267,1266.67 817.575,1551.25 819.883,1441.12 822.191,1550.04 824.499,1601.78 826.807,1436.91 829.115,1351.93 831.422,1527.61 833.73,1498.55 836.038,1289.47 838.346,1311.71 840.654,1552.82 842.962,1397.05 845.27,1407.36 847.578,1535.15 849.886,1348.01 852.194,1447.18 854.502,1373.77 856.809,1505.3 859.117,1318.82 861.425,1522.5 863.733,1524.12 866.041,1298.86 868.349,1362.93 870.657,1460.34 872.965,1435.7 875.273,1520.37 877.581,1421.55 879.889,1463.29 882.197,1409.75 884.504,1131.97 886.812,1310.15 889.12,1435.52 891.428,1389.52 893.736,1453.09 896.044,1436.28 898.352,1368.25 900.66,1325.48 902.968,1321.04 905.276,1385.03 907.584,1423.9 909.891,1260.08 912.199,1551.07 914.507,1366.62 916.815,1751.15 919.123,1554.03 921.431,1350.51 923.739,1432.87 926.047,1311.57 928.355,1368.24 930.663,1568.62 932.971,1579.79 935.278,1378.28 937.586,1446.49 939.894,1355.69 942.202,1432.44 944.51,1461.64 946.818,1443.4 949.126,1535.06 951.434,1651.97 953.742,1281.07 956.05,1381.19 958.358,1487.81 960.665,1247.19 962.973,1371.17 965.281,1441.87 967.589,1624.43 969.897,1378.43 972.205,1326.23 974.513,1442.31 976.821,1496.19 979.129,1616.82 981.437,1420.13 983.745,1379.86 986.053,1439.35 988.36,1388.99 990.668,1548.74 992.976,1364.94 995.284,1468.59 997.592,1508.28 999.9,1445.48 1002.21,1434.71 1004.52,1477.77 1006.82,1460.6 1009.13,1493.04 1011.44,1459 1013.75,1383.85 1016.06,1399.55 1018.36,1422.9 1020.67,1273.36 1022.98,1327.09 1025.29,1552.97 1027.59,1442.09 1029.9,1358.32 1032.21,1197.09 1034.52,1579.23 1036.83,1298.86 1039.13,1574.67 1041.44,1529.02 1043.75,1298.65 1046.06,1375.19 1048.37,1446.52 1050.67,1393.44 1052.98,1374.2 1055.29,1503.61 1057.6,1473.6 1059.91,1279.82 1062.21,1339.65 1064.52,1505.38 1066.83,1365.47 1069.14,1380.85 1071.45,1465.94 1073.75,1356.39 1076.06,1346.27 1078.37,1349.73 1080.68,1290.55 1082.98,1398.09 1085.29,1537.27 1087.6,1517.23 1089.91,1497.72 1092.22,1325.84 1094.52,1597.51 1096.83,1414.58 1099.14,1176.55 1101.45,1515.77 1103.76,1306.19 1106.06,1310.79 1108.37,1440.2 1110.68,1529.65 1112.99,1293.35 1115.3,1471.5 1117.6,1357.9 1119.91,1415.97 1122.22,1610.16 1124.53,1496.55 1126.84,1278.82 1129.14,1320.8 1131.45,1256.93 1133.76,1296.84 1136.07,1563.08 1138.37,1452.29 1140.68,1548.65 1142.99,1519.58 1145.3,1456.95 1147.61,1409.8 1149.91,1614.84 1152.22,1531.27 1154.53,1362 1156.84,1171.02 1159.15,1115.76 1161.45,1334.77 1163.76,1369.46 1166.07,1545.17 1168.38,1602.54 1170.69,1521.24 1172.99,1212.52 1175.3,1416.91 1177.61,1256.67 1179.92,1559.3 1182.23,1423.99 1184.53,1598.4 1186.84,1521.98 1189.15,1307.29 1191.46,1464.64 1193.76,1428.02 1196.07,1356.62 1198.38,1616.49 1200.69,1362.74 1203,1640.91 1205.3,1519.52 1207.61,1505.47 1209.92,1418.63 1212.23,1459.21 1214.54,1454.14 1216.84,1472.86 1219.15,1501.72 1221.46,1411.06 1223.77,1224.06 1226.08,1541.77 1228.38,1441.46 1230.69,1336.42 1233,1373.89 1235.31,1458.5 1237.61,1454.07 1239.92,1523.78 1242.23,1385.01 1244.54,1386.84 1246.85,1293.64 1249.15,1466.46 1251.46,1309.98 1253.77,1216.8 1256.08,1258.87 1258.39,1421.21 1260.69,1404.97 1263,1357.7 1265.31,1505.75 1267.62,1569.39 1269.93,1272.56 1272.23,1619.52 1274.54,1502.71 1276.85,1266.21 1279.16,1339.62 1281.47,1618.99 1283.77,1686.19 1286.08,1455.84 1288.39,1406.08 1290.7,1514.13 1293,1330.17 1295.31,1475.47 1297.62,1473.08 1299.93,1415.1 1302.24,1343.7 1304.54,1503.29 1306.85,1273.49 1309.16,1459.04 1311.47,1368.64 1313.78,1375.41 1316.08,1407.61 1318.39,1504.3 1320.7,1354.55 1323.01,1606.09 1325.32,1392.3 1327.62,1450.81 1329.93,1284.55 1332.24,1553.61 1334.55,1244.05 1336.86,1344.73 1339.16,1469.28 1341.47,1441.01 1343.78,1312.36 1346.09,1450.52 1348.39,1395.64 1350.7,1592.5 1353.01,1255.61 1355.32,1433.41 1357.63,1430.23 1359.93,1347.77 1362.24,1340.39 1364.55,1379.97 1366.86,1467.33 1369.17,1384.56 1371.47,1396.2 1373.78,1454.26 1376.09,1383.5 1378.4,1401.38 1380.71,1263.11 1383.01,1255.38 1385.32,1333.52 1387.63,1415.49 1389.94,1425.84 1392.24,1595.54 1394.55,1472.43 1396.86,1481.93 1399.17,1330.42 1401.48,1538.41 1403.78,1361.81 1406.09,1438.11 1408.4,1355.22 1410.71,1405.56 1413.02,1533.18 1415.32,1352.51 1417.63,1358.25 1419.94,1335.77 1422.25,1553.53 1424.56,1397 1426.86,1433.62 1429.17,1520.81 1431.48,1464.89 1433.79,1410.18 1436.1,1671.05 1438.4,1480.9 1440.71,1500.69 1443.02,1247.43 1445.33,1401.29 1447.63,1462.83 1449.94,1350.08 1452.25,1336.12 1454.56,1321.05 1456.87,1474.93 1459.17,1287.43 1461.48,1491.33 1463.79,1386.29 1466.1,1417.07 1468.41,1202.23 1470.71,1439.33 1473.02,1416.94 1475.33,1202.53 1477.64,1347.46 1479.95,1498.1 1482.25,1442.15 1484.56,1373.91 1486.87,1293.21 1489.18,1455.54 1491.49,1290.26 1493.79,1356.03 1496.1,1424.71 1498.41,1482.62 1500.72,1496.29 1503.02,1547.78 1505.33,1453.8 1507.64,1480.68 1509.95,1350.45 1512.26,1401.26 1514.56,1380.62 1516.87,1507.39 1519.18,1450.62 1521.49,1650.27 1523.8,1435.86 1526.1,1518.42 1528.41,1488.17 1530.72,1370.84 1533.03,1500.68 1535.34,1366.64 1537.64,1406.29 1539.95,1539.32 1542.26,1455.56 1544.57,1470.47 1546.88,1330.8 1549.18,1397.46 1551.49,1374.91 1553.8,1379.3 1556.11,1334.13 1558.41,1376.41 1560.72,1539.74 1563.03,1397.84 1565.34,1472.25 1567.65,1227.58 1569.95,1414.32 1572.26,1407.59 1574.57,1391.98 1576.88,1506.17 1579.19,1440.87 1581.49,1559.92 1583.8,1499.82 1586.11,1522.65 1588.42,1549.48 1590.73,1427.48 1593.03,1395.35 1595.34,1476.44 1597.65,1304.58 1599.96,1486.1 1602.26,1396.21 1604.57,1341.44 1606.88,1537.42 1609.19,1504.86 1611.5,1347.3 1613.8,1513.62 1616.11,1447.87 1618.42,1513.68 1620.73,1393.29 1623.04,1391.45 1625.34,1450.82 1627.65,1489.71 1629.96,1592.8 1632.27,1463.06 1634.58,1594.17 1636.88,1480.39 1639.19,1491.74 1641.5,1551.45 1643.81,1563.44 1646.12,1421.34 1648.42,1321.74 1650.73,1545.84 1653.04,1532.02 1655.35,1366.87 1657.65,1524.83 1659.96,1454.92 1662.27,1570.25 1664.58,1389.93 1666.89,1428.75 1669.19,1329.4 1671.5,1517.54 1673.81,1609.05 1676.12,1404.09 1678.43,1535.02 1680.73,1425.14 1683.04,1674.13 1685.35,1405.34 1687.66,1448.8 1689.97,1345.45 1692.27,1471.95 1694.58,1567.64 1696.89,1550.04 1699.2,1428.93 1701.51,1455.19 1703.81,1508.21 1706.12,1574.64 1708.43,1219.02 1710.74,1511.65 1713.04,1499.46 1715.35,1245.68 1717.66,1259.38 1719.97,1424.15 1722.28,1299.69 1724.58,1425.64 1726.89,1426.84 1729.2,1425.31 1731.51,1360.55 1733.82,1405.97 1736.12,1498.5 1738.43,1601.75 1740.74,1509.06 1743.05,1342.51 1745.36,1451.8 1747.66,1430.61 1749.97,1449.76 1752.28,1477.07 1754.59,1337.04 1756.9,1488.76 1759.2,1407.87 1761.51,1362.5 1763.82,1649.28 1766.13,1526.02 1768.43,1341.62 1770.74,1489.83 1773.05,1542.25 1775.36,1411.39 1777.67,1517.47 1779.97,1380.38 1782.28,1421.59 1784.59,1345.13 1786.9,1406.01 1789.21,1491.43 1791.51,1607.69 1793.82,1375.78 1796.13,1381.3 1798.44,1380.4 1800.75,1423.22 1803.05,1534.34 1805.36,1389.47 1807.67,1426.97 1809.98,1359.96 1812.28,1319.29 1814.59,1466.15 1816.9,1462.95 1819.21,1360.96 1821.52,1385.13 1823.82,1549.97 1826.13,1414.95 1828.44,1426.47 1830.75,1426.97 1833.06,1362.49 1835.36,1519.45 1837.67,1505.4 1839.98,1473.04 1842.29,1438.72 1844.6,1344.81 1846.9,1538.8 1849.21,1593.1 1851.52,1402.36 1853.83,1385.8 1856.14,1492.41 1858.44,1410.55 1860.75,1318.79 1863.06,1418.34 1865.37,1477.68 1867.67,1416.55 1869.98,1411.15 1872.29,1438.63 1874.6,1453.29 1876.91,1554.91 1879.21,1689.08 1881.52,1480.6 1883.83,1414.97 1886.14,1391.19 1888.45,1601.84 1890.75,1348.65 1893.06,1535.99 1895.37,1385.49 1897.68,1396.88 1899.99,1422.4 1902.29,1530.48 1904.6,1467.07 1906.91,1427.73 1909.22,1350.28 1911.53,1368.79 1913.83,1546.82 1916.14,1319.07 1918.45,1445.16 1920.76,1294.84 1923.06,1208.44 1925.37,1455.71 1927.68,1585.47 1929.99,1472.67 1932.3,1441.4 1934.6,1301.18 1936.91,1403.35 1939.22,1365.67 1941.53,1531.48 1943.84,1200.35 1946.14,1255.09 1948.45,1470.34 1950.76,1507.68 1953.07,1578.61 1955.38,1284.59 1957.68,1304.04 1959.99,1243.37 1962.3,1362.22 1964.61,1424.93 1966.91,1321.96 1969.22,1366.41 1971.53,1496.84 1973.84,1456.07 1976.15,1365.95 1978.45,1577.77 1980.76,1215.65 1983.07,1341.74 1985.38,1469.32 1987.69,1332.19 1989.99,1463.27 1992.3,1520.26 1994.61,1474.44 1996.92,1325.88 1999.23,1355.98 2001.53,1496.4 2003.84,1415.93 2006.15,1468.92 2008.46,1470.89 2010.77,1207.84 2013.07,1528.19 2015.38,1308.01 2017.69,1435.81 2020,1240.46 2022.3,1346.8 2024.61,1499.39 2026.92,1349.41 2029.23,1327.62 2031.54,1226.69 2033.84,1496.49 2036.15,1278.87 2038.46,1332.05 2040.77,1301.54 2043.08,1547.43 2045.38,1327.53 2047.69,1489.18 2050,1402.25 2052.31,1587.3 2054.62,1426.7 2056.92,1305.11 2059.23,1391.96 2061.54,1373.33 2063.85,1430.55 2066.16,1311.14 2068.46,1458.95 2070.77,1474.7 2073.08,1407.64 2075.39,1441.36 2077.69,1441.62 2080,1317.94 2082.31,1474.74 2084.62,1434.74 2086.93,1403.69 2089.23,1426.23 2091.54,1383.36 2093.85,1371.95 2096.16,1545.86 2098.47,1489.48 2100.77,1291.68 2103.08,1451.45 2105.39,1537.55 2107.7,1410.37 2110.01,1430.32 2112.31,1609.92 2114.62,1428.18 2116.93,1406.94 2119.24,1253.02 2121.55,1430.34 2123.85,1303.61 2126.16,1437.22 2128.47,1456.94 2130.78,1458.13 2133.08,1518.6 2135.39,1440.92 2137.7,1403.18 2140.01,1424.83 2142.32,1388.93 2144.62,1330.72 2146.93,1446.68 2149.24,1371.64 2151.55,1446.85 2153.86,1577.34 2156.16,1474.02 2158.47,1451.22 2160.78,1194.43 2163.09,1220.71 2165.4,1312.15 2167.7,1323.24 2170.01,1442.34 2172.32,1431.47 2174.63,1544.53 2176.93,1546.01 2179.24,1420.84 2181.55,1130.5 2183.86,1438.97 2186.17,1366.34 2188.47,1339.03 2190.78,1450.08 2193.09,1589.4 2195.4,1434.08 2197.71,1415.45 2200.01,1444.6 2202.32,1438.3 2204.63,1447.7 2206.94,1557.03 2209.25,1536.48 2211.55,1329.61 2213.86,1347.13 2216.17,1580.81 2218.48,1386.41 2220.79,1289.75 2223.09,1365.21 2225.4,1375.25 2227.71,1312.63 2230.02,1555.03 2232.32,1566.64 2234.63,1380.43 2236.94,1397.22 2239.25,1411.77 2241.56,1569.56 2243.86,1586.55 2246.17,1466.8 2248.48,1299.68 2250.79,1557.76 2253.1,1485.04 2255.4,1328.11 2257.71,1441.91 2260.02,1488.98 2262.33,1273.15 2264.64,1463.9 2266.94,1307.3 2269.25,1509.25 2271.56,1398.26 2273.87,1337.26 2276.18,1457.45 2278.48,1313.32 2280.79,1387.46 2283.1,1657.83 2285.41,1296.6 2287.71,1305.32 2290.02,1312.08 2292.33,1386.43 2294.64,1546.85 2296.95,1367.05 2299.25,1663.99 2301.56,1524.52 2303.87,1304.61 2306.18,1552.54 2308.49,1343.12 2310.79,1327.52 2313.1,1368.8 2315.41,1151.09 2317.72,1344.99 2320.03,1476.27 2322.33,1407.82 2324.64,1214.52 2326.95,1580.16 2329.26,1424.88 2331.56,1511.02 2333.87,1259.4 2336.18,1333.02 2338.49,1549.34 2340.8,1523.96 2343.1,1355.89 2345.41,1419.06 2347.72,1400.48 2350.03,1522.81 2352.34,1286.03 2354.64,1406.19 2356.95,1457.85 2359.26,1428.58 2361.57,1324.39 2363.88,1446.51 2366.18,1370.65 2368.49,1457.23 2370.8,1477.5 2373.11,1581.49 2375.42,1359.38 2377.72,1343.74 2380.03,1432.97 2382.34,1620.58 2384.65,1385.53 2386.95,1612.63 2389.26,1356.8 2391.57,1602.53 2393.88,1339.13 2396.19,1604.85 2398.49,1610.75 2400.8,1326.55 2403.11,1423.98 2405.42,1312.38 2407.73,1368.59 2410.03,1395.35 2412.34,1414.35 2414.65,1520.15 2416.96,1419.01 2419.27,1347.68 2421.57,1316.33 2423.88,1487.73 2426.19,1409.91 2428.5,1494.81 2430.81,1439.77 2433.11,1431.4 2435.42,1621.66 2437.73,1545.77 2440.04,1630.15 2442.34,1535.68 2444.65,1485.33 2446.96,1330.46 2449.27,1340.05 2451.58,1412.41 2453.88,1429.93 2456.19,1398.42 2458.5,1616.56 2460.81,1349.55 2463.12,1306.94 2465.42,1435.03 2467.73,1263.88 2470.04,1366.65 2472.35,1526.4 2474.66,1561.81 2476.96,1426.65 2479.27,1329.63 2481.58,1361.26 2483.89,1519.43 2486.2,1576.1 2488.5,1532.66 2490.81,1444.66 2493.12,1378.94 2495.43,1337.32 2497.73,1389.91 2500.04,1452.55 2502.35,1495.98 2504.66,1443.95 2506.97,1439.75 2509.27,1484.43 2511.58,1520.76 2513.89,1335.17 2516.2,1386.01 2518.51,1335.44 2520.81,1346.56 2523.12,1265.13 2525.43,1487.26 2527.74,1373.16 2530.05,1386.75 2532.35,1594.29 2534.66,1442 2536.97,1395.19 2539.28,1466.82 2541.58,1464.32 2543.89,1437.16 2546.2,1380.19 2548.51,1439.17 2550.82,1414.78 2553.12,1509.83 2555.43,1402.93 2557.74,1525.94 2560.05,1336.69 2562.36,1441.26 2564.66,1485.39 2566.97,1388.22 2569.28,1454.81 2571.59,1267.73 "></polyline>
<polyline clip-path="url(#clip122)" style="stroke:#e26f46; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="265.984,977.41 268.292,974.955 270.6,815.733 272.908,822.799 275.216,866.82 277.524,930.318 279.832,732.058 282.139,1016.69 284.447,947.175 286.755,924.214 289.063,1125.3 291.371,983.591 293.679,827.985 295.987,830.026 298.295,913.422 300.603,1057.41 302.911,1012.24 305.219,1187.31 307.527,1079.3 309.834,956.856 312.142,613.079 314.45,874.033 316.758,792.269 319.066,1037.95 321.374,819.025 323.682,879.317 325.99,1000.65 328.298,736.38 330.606,877.397 332.914,963.685 335.221,870.041 337.529,802.59 339.837,977.524 342.145,996.786 344.453,925.428 346.761,1067.67 349.069,969.681 351.377,1062.99 353.685,1011.58 355.993,820.625 358.301,774.423 360.608,842.898 362.916,1038.56 365.224,819.758 367.532,999.06 369.84,898.881 372.148,941.674 374.456,813.819 376.764,976.827 379.072,1118.79 381.38,946.916 383.688,966.224 385.996,944.655 388.303,1022.66 390.611,922.201 392.919,976.49 395.227,966.663 397.535,785.724 399.843,1119.25 402.151,1032.09 404.459,1001.83 406.767,849.051 409.075,1004.43 411.383,997.797 413.69,948.13 415.998,1012.18 418.306,916.302 420.614,1173.41 422.922,989.508 425.23,950.791 427.538,761.651 429.846,922.475 432.154,947.805 434.462,1033.52 436.77,1029.42 439.077,983.51 441.385,953.38 443.693,857.05 446.001,818.961 448.309,828.046 450.617,975.816 452.925,966.768 455.233,836.604 457.541,1028.42 459.849,977.809 462.157,965.901 464.465,896.809 466.772,859.984 469.08,993.515 471.388,726.829 473.696,1019.5 476.004,1028.12 478.312,902.897 480.62,996.382 482.928,1013.24 485.236,912.055 487.544,999.769 489.852,865.507 492.159,1046.72 494.467,752.198 496.775,919.294 499.083,956.647 501.391,761.781 503.699,906.778 506.007,1072.12 508.315,961.679 510.623,918.297 512.931,975.699 515.239,899.288 517.546,995.24 519.854,1162.97 522.162,931.471 524.47,954.408 526.778,939.865 529.086,1023.55 531.394,1080.67 533.702,917.449 536.01,1013.51 538.318,804.503 540.626,997.94 542.933,979.207 545.241,1077.69 547.549,982.475 549.857,842.598 552.165,883.883 554.473,1036.75 556.781,928.207 559.089,756.467 561.397,986.937 563.705,949.058 566.013,917 568.321,928.714 570.628,900.88 572.936,802.583 575.244,909.896 577.552,751.433 579.86,1138.12 582.168,926.167 584.476,986.93 586.784,932.246 589.092,879.615 591.4,946.103 593.708,863.697 596.015,853.847 598.323,950.701 600.631,897.619 602.939,765.862 605.247,892.102 607.555,1085.68 609.863,924.356 612.171,973.115 614.479,784.578 616.787,892.534 619.095,1026.28 621.402,887.323 623.71,863.696 626.018,819.945 628.326,990.766 630.634,899.313 632.942,1000.98 635.25,757.005 637.558,932.494 639.866,1039.94 642.174,952.331 644.482,806.252 646.79,950.388 649.097,947.714 651.405,993.258 653.713,944.971 656.021,1099.8 658.329,933.619 660.637,1009.68 662.945,892.929 665.253,1145.29 667.561,984.395 669.869,1110.85 672.177,885.299 674.484,984.885 676.792,980.722 679.1,1070.86 681.408,846.093 683.716,993.183 686.024,1016.79 688.332,956.258 690.64,961.629 692.948,990.214 695.256,921.048 697.564,990.405 699.871,860.439 702.179,867.397 704.487,812.291 706.795,864.87 709.103,903.792 711.411,851.301 713.719,820.813 716.027,828.206 718.335,917.668 720.643,889.467 722.951,856.902 725.259,1005.67 727.566,850.113 729.874,852.247 732.182,979.632 734.49,878.202 736.798,878.145 739.106,756.205 741.414,963.054 743.722,873.115 746.03,985.013 748.338,902.496 750.646,1118.87 752.953,962.752 755.261,1011.22 757.569,1011.1 759.877,1016.04 762.185,891.994 764.493,865.934 766.801,846.674 769.109,885.84 771.417,889.08 773.725,938.08 776.033,926.065 778.34,637.979 780.648,912.312 782.956,826.39 785.264,1070.94 787.572,1096.55 789.88,903.619 792.188,1051.74 794.496,849.953 796.804,917.683 799.112,1075.83 801.42,809.947 803.728,981.571 806.035,1058.07 808.343,953.465 810.651,882.558 812.959,975.492 815.267,817.537 817.575,870.099 819.883,945.781 822.191,857.923 824.499,887.027 826.807,1056.2 829.115,959.671 831.422,1124.77 833.73,1116.48 836.038,890.471 838.346,910.269 840.654,823.641 842.962,845.537 845.27,1048.07 847.578,831.942 849.886,901.207 852.194,991.661 854.502,871.952 856.809,1110.46 859.117,763.604 861.425,969.077 863.733,941.864 866.041,968.846 868.349,798.716 870.657,769.593 872.965,906.718 875.273,1036.96 877.581,848.77 879.889,1031.46 882.197,1047.22 884.504,986.94 886.812,883.147 889.12,892.116 891.428,838.826 893.736,888.214 896.044,894.832 898.352,711.005 900.66,818.541 902.968,875.948 905.276,913.464 907.584,894.178 909.891,906.287 912.199,958.027 914.507,922.753 916.815,888.853 919.123,923.441 921.431,779.819 923.739,914.347 926.047,973.836 928.355,918.627 930.663,987.78 932.971,998.715 935.278,712.559 937.586,955.181 939.894,889.979 942.202,1109.83 944.51,892.628 946.818,951.322 949.126,932.522 951.434,1048.65 953.742,935.22 956.05,953.135 958.358,945.529 960.665,960.953 962.973,811.237 965.281,849.04 967.589,813.725 969.897,1080.89 972.205,827.85 974.513,898.069 976.821,965.787 979.129,956.18 981.437,838.578 983.745,887.53 986.053,1030.01 988.36,746.475 990.668,936.852 992.976,1003.17 995.284,789.499 997.592,1017.43 999.9,986.476 1002.21,928.786 1004.52,899.455 1006.82,994.137 1009.13,1051.05 1011.44,808.715 1013.75,907.145 1016.06,1092.04 1018.36,1000.19 1020.67,894.468 1022.98,933.923 1025.29,925.531 1027.59,834.736 1029.9,931.534 1032.21,946.911 1034.52,889.324 1036.83,1072.66 1039.13,947.993 1041.44,826.908 1043.75,798.2 1046.06,913.379 1048.37,771.529 1050.67,886.532 1052.98,1071.46 1055.29,893.957 1057.6,859.973 1059.91,836.927 1062.21,703.1 1064.52,1023.43 1066.83,1034.71 1069.14,1200.1 1071.45,857.592 1073.75,1027.41 1076.06,1082.77 1078.37,1222.88 1080.68,1035.03 1082.98,877.765 1085.29,867.641 1087.6,1033.59 1089.91,878.602 1092.22,829.029 1094.52,901.43 1096.83,819.428 1099.14,625.558 1101.45,1022.33 1103.76,841.56 1106.06,972.474 1108.37,907.996 1110.68,791.829 1112.99,848.07 1115.3,1082.44 1117.6,966.088 1119.91,994.9 1122.22,785.626 1124.53,903.155 1126.84,931.359 1129.14,806.147 1131.45,1106.48 1133.76,1094.93 1136.07,927.679 1138.37,786.119 1140.68,982.863 1142.99,1007.21 1145.3,1132.97 1147.61,1054.3 1149.91,892.396 1152.22,914.704 1154.53,934.943 1156.84,816.5 1159.15,923.27 1161.45,975.085 1163.76,1080.68 1166.07,819.45 1168.38,1111.4 1170.69,1063.39 1172.99,934.344 1175.3,861.721 1177.61,923.902 1179.92,777.181 1182.23,821.832 1184.53,890.455 1186.84,1126.34 1189.15,915.472 1191.46,880.673 1193.76,1015.11 1196.07,895.175 1198.38,1008.32 1200.69,983.135 1203,818.969 1205.3,623.883 1207.61,1029.64 1209.92,927.976 1212.23,893.794 1214.54,784.279 1216.84,977.15 1219.15,1036.69 1221.46,906.17 1223.77,1013.83 1226.08,1000.49 1228.38,937.514 1230.69,910.74 1233,918.679 1235.31,912.479 1237.61,1144.24 1239.92,1025.17 1242.23,867.853 1244.54,1018.2 1246.85,1061.52 1249.15,1149.28 1251.46,819.856 1253.77,939.153 1256.08,907.852 1258.39,942.668 1260.69,981.777 1263,996.486 1265.31,932.364 1267.62,1014.21 1269.93,780.43 1272.23,938.505 1274.54,839.129 1276.85,930.625 1279.16,948.423 1281.47,860.068 1283.77,1010.13 1286.08,1133.17 1288.39,1015.04 1290.7,975.364 1293,963.466 1295.31,897.804 1297.62,1047.83 1299.93,903.381 1302.24,968.896 1304.54,1057.45 1306.85,1012.2 1309.16,989.642 1311.47,845.495 1313.78,954.906 1316.08,784.089 1318.39,804.946 1320.7,936.727 1323.01,986.767 1325.32,918.71 1327.62,767.463 1329.93,802.184 1332.24,999.243 1334.55,740.257 1336.86,1059.82 1339.16,956.948 1341.47,951.189 1343.78,849.592 1346.09,1181.89 1348.39,842.102 1350.7,901.022 1353.01,909.198 1355.32,925.034 1357.63,1024.44 1359.93,1090.23 1362.24,999.055 1364.55,909.204 1366.86,1034.32 1369.17,938.466 1371.47,906.801 1373.78,806.754 1376.09,1190.71 1378.4,921.177 1380.71,996.8 1383.01,999.726 1385.32,967.308 1387.63,1040.98 1389.94,755.604 1392.24,1112.58 1394.55,884.45 1396.86,904.753 1399.17,745.454 1401.48,900.878 1403.78,1064.03 1406.09,922.628 1408.4,828.416 1410.71,1157.74 1413.02,788.982 1415.32,970.365 1417.63,975.062 1419.94,1003.02 1422.25,947.463 1424.56,863.006 1426.86,928.674 1429.17,910.881 1431.48,1106.04 1433.79,882.901 1436.1,1151.77 1438.4,932.315 1440.71,1064.21 1443.02,949.323 1445.33,848.684 1447.63,932.85 1449.94,947.833 1452.25,851.382 1454.56,819.347 1456.87,987.336 1459.17,974.975 1461.48,1007.03 1463.79,878.686 1466.1,1009.19 1468.41,1053.67 1470.71,934.076 1473.02,1015.1 1475.33,983.833 1477.64,694.466 1479.95,824.47 1482.25,1030.35 1484.56,1074.8 1486.87,920.705 1489.18,989.276 1491.49,956.612 1493.79,964.975 1496.1,967.948 1498.41,867.111 1500.72,990.771 1503.02,982.98 1505.33,1138.85 1507.64,928.148 1509.95,878.185 1512.26,830.068 1514.56,999.582 1516.87,941.136 1519.18,908.65 1521.49,884.816 1523.8,1029.22 1526.1,888.694 1528.41,983.58 1530.72,1092.98 1533.03,993.226 1535.34,842.441 1537.64,798.447 1539.95,764.462 1542.26,917.958 1544.57,883.63 1546.88,1004.96 1549.18,1043.06 1551.49,903.838 1553.8,853.59 1556.11,827.071 1558.41,962.256 1560.72,878.217 1563.03,958.652 1565.34,968.729 1567.65,988.228 1569.95,877.307 1572.26,989.343 1574.57,960.496 1576.88,799.874 1579.19,983.203 1581.49,880.291 1583.8,852.226 1586.11,936.524 1588.42,846.05 1590.73,856.973 1593.03,1077.76 1595.34,817.513 1597.65,842.651 1599.96,986.822 1602.26,971.54 1604.57,1022.94 1606.88,909.324 1609.19,951.729 1611.5,938.795 1613.8,924.007 1616.11,1094.95 1618.42,1015.3 1620.73,902.062 1623.04,836.687 1625.34,1038.92 1627.65,1024.01 1629.96,789.664 1632.27,1104.8 1634.58,852.086 1636.88,1006.73 1639.19,967.762 1641.5,1012.1 1643.81,1046.91 1646.12,828.533 1648.42,1022.71 1650.73,1063.48 1653.04,973.6 1655.35,800.086 1657.65,755.565 1659.96,1123.46 1662.27,899.863 1664.58,963.909 1666.89,991.686 1669.19,923.827 1671.5,1099.76 1673.81,1137.86 1676.12,997.262 1678.43,928.4 1680.73,887.043 1683.04,760.631 1685.35,949.468 1687.66,913.37 1689.97,1053.12 1692.27,878.719 1694.58,883.301 1696.89,979.12 1699.2,948.625 1701.51,1081.42 1703.81,985.713 1706.12,951.921 1708.43,1200.73 1710.74,978.631 1713.04,848.019 1715.35,979.225 1717.66,1044.2 1719.97,991.187 1722.28,892.588 1724.58,875.124 1726.89,866.53 1729.2,951.18 1731.51,826.668 1733.82,877.77 1736.12,1084.16 1738.43,799.663 1740.74,1019.6 1743.05,912.13 1745.36,952.718 1747.66,968.204 1749.97,804.875 1752.28,838.942 1754.59,1069.59 1756.9,1071.78 1759.2,878.868 1761.51,809.617 1763.82,1053.93 1766.13,780.141 1768.43,835.942 1770.74,843.813 1773.05,1028.62 1775.36,1010.18 1777.67,959.933 1779.97,940.773 1782.28,955.03 1784.59,881.021 1786.9,961.559 1789.21,941.634 1791.51,912.925 1793.82,956.431 1796.13,830.493 1798.44,846.862 1800.75,918.215 1803.05,867.917 1805.36,877.756 1807.67,976.78 1809.98,1060.53 1812.28,960.135 1814.59,923.407 1816.9,949.71 1819.21,1026.17 1821.52,1044.72 1823.82,871.279 1826.13,1023.65 1828.44,1154.39 1830.75,1033.22 1833.06,738.993 1835.36,702.084 1837.67,878.822 1839.98,822.616 1842.29,888.371 1844.6,947.24 1846.9,986.764 1849.21,890.046 1851.52,968.119 1853.83,816.864 1856.14,1064.12 1858.44,866.725 1860.75,903.584 1863.06,977.472 1865.37,993.457 1867.67,863.13 1869.98,831.64 1872.29,939.066 1874.6,860.896 1876.91,1038.47 1879.21,898.293 1881.52,828.731 1883.83,930.617 1886.14,830.354 1888.45,1169.61 1890.75,984.323 1893.06,904.107 1895.37,821.191 1897.68,924.916 1899.99,882.347 1902.29,852.332 1904.6,924.581 1906.91,914.156 1909.22,910.307 1911.53,906.92 1913.83,891.986 1916.14,1030.31 1918.45,1025.48 1920.76,813.816 1923.06,943.107 1925.37,1035.35 1927.68,901.929 1929.99,901.683 1932.3,976.459 1934.6,896.84 1936.91,754.248 1939.22,843.196 1941.53,946.327 1943.84,981.921 1946.14,792.399 1948.45,968.983 1950.76,1005.12 1953.07,884.462 1955.38,1151.88 1957.68,999.184 1959.99,956.799 1962.3,768.251 1964.61,941.467 1966.91,941.645 1969.22,1022.69 1971.53,1035.39 1973.84,989.711 1976.15,860.95 1978.45,982.049 1980.76,1012.22 1983.07,965.078 1985.38,1009.35 1987.69,872.718 1989.99,1002.47 1992.3,924.635 1994.61,784.542 1996.92,997.743 1999.23,996.633 2001.53,952.888 2003.84,807.797 2006.15,1069.9 2008.46,764.04 2010.77,786.74 2013.07,1030.75 2015.38,891.713 2017.69,881.172 2020,994.208 2022.3,1026.19 2024.61,1046.82 2026.92,821.376 2029.23,996.299 2031.54,853.013 2033.84,937.301 2036.15,990.312 2038.46,1105.68 2040.77,880.945 2043.08,1025.47 2045.38,899.622 2047.69,952.947 2050,941.298 2052.31,945.385 2054.62,957.66 2056.92,868.693 2059.23,922.699 2061.54,970.521 2063.85,1069.58 2066.16,1085.71 2068.46,771.669 2070.77,832.933 2073.08,929.041 2075.39,842.129 2077.69,952.881 2080,897.866 2082.31,913.342 2084.62,794.254 2086.93,1078.45 2089.23,869.888 2091.54,1003.03 2093.85,1043.28 2096.16,930.782 2098.47,1019.96 2100.77,908.657 2103.08,924.476 2105.39,948.577 2107.7,897.838 2110.01,864.492 2112.31,904.785 2114.62,1151.42 2116.93,930.575 2119.24,992.639 2121.55,981.304 2123.85,928.186 2126.16,1077.79 2128.47,959.078 2130.78,953.483 2133.08,834.515 2135.39,1096.51 2137.7,1123.46 2140.01,899.382 2142.32,1032.45 2144.62,947.406 2146.93,1050.95 2149.24,927.575 2151.55,842.667 2153.86,893.41 2156.16,934.39 2158.47,888.406 2160.78,892.979 2163.09,921.645 2165.4,821.469 2167.7,825.738 2170.01,874.708 2172.32,776.11 2174.63,866.191 2176.93,798.569 2179.24,1043.94 2181.55,902.123 2183.86,1033.38 2186.17,1013.22 2188.47,899.649 2190.78,860.929 2193.09,957.434 2195.4,1011.07 2197.71,796.448 2200.01,1003.36 2202.32,1030.03 2204.63,968.868 2206.94,845.563 2209.25,943.471 2211.55,827.968 2213.86,983.997 2216.17,847.926 2218.48,721.628 2220.79,851.897 2223.09,899.412 2225.4,1087.91 2227.71,855.878 2230.02,1015.02 2232.32,914.19 2234.63,963.055 2236.94,743.821 2239.25,926.81 2241.56,1074.57 2243.86,876.944 2246.17,909.95 2248.48,935.079 2250.79,1133.64 2253.1,1017.44 2255.4,879.746 2257.71,936.692 2260.02,1071.71 2262.33,753.238 2264.64,714.324 2266.94,840.638 2269.25,1042.48 2271.56,1038.01 2273.87,810.32 2276.18,906.956 2278.48,964.3 2280.79,828.479 2283.1,1111.4 2285.41,846.487 2287.71,803.871 2290.02,941.975 2292.33,913.896 2294.64,887.798 2296.95,963.363 2299.25,836.997 2301.56,944.407 2303.87,764.014 2306.18,866.044 2308.49,983.594 2310.79,960.197 2313.1,992.762 2315.41,902.042 2317.72,858.378 2320.03,975.003 2322.33,1096.52 2324.64,972.211 2326.95,1023.46 2329.26,1014.73 2331.56,966.028 2333.87,1012.45 2336.18,885.598 2338.49,934.242 2340.8,876.08 2343.1,908.63 2345.41,1033.51 2347.72,1075.54 2350.03,853.282 2352.34,837.432 2354.64,776.061 2356.95,914.908 2359.26,959.854 2361.57,928.624 2363.88,998.757 2366.18,1034.55 2368.49,899.254 2370.8,853.079 2373.11,932.331 2375.42,965.584 2377.72,933.217 2380.03,928.686 2382.34,853.564 2384.65,990.655 2386.95,775.489 2389.26,976.964 2391.57,951.72 2393.88,1054.84 2396.19,1017.8 2398.49,1020.01 2400.8,950.856 2403.11,863.06 2405.42,1018.13 2407.73,652.199 2410.03,868.645 2412.34,912.26 2414.65,964.057 2416.96,1136.21 2419.27,841.687 2421.57,971.634 2423.88,909.628 2426.19,944.626 2428.5,957.789 2430.81,844.38 2433.11,846.543 2435.42,823.658 2437.73,832.139 2440.04,926.916 2442.34,1006.4 2444.65,792.633 2446.96,849.31 2449.27,1090.39 2451.58,924.383 2453.88,850.832 2456.19,935.493 2458.5,959.355 2460.81,923.842 2463.12,845.169 2465.42,913.538 2467.73,991.449 2470.04,811.064 2472.35,926.867 2474.66,859.232 2476.96,1015.21 2479.27,1102.08 2481.58,978.711 2483.89,875.902 2486.2,1046.41 2488.5,818.216 2490.81,960.232 2493.12,1138.14 2495.43,841.124 2497.73,692.307 2500.04,999.784 2502.35,864.986 2504.66,984.757 2506.97,857.474 2509.27,898.016 2511.58,909.47 2513.89,1051.36 2516.2,990.209 2518.51,652.05 2520.81,1067.75 2523.12,962.372 2525.43,923.231 2527.74,788.508 2530.05,775.541 2532.35,952.702 2534.66,877.453 2536.97,1093.7 2539.28,1065.19 2541.58,935.101 2543.89,790.124 2546.2,912.581 2548.51,812.351 2550.82,1070.85 2553.12,801.092 2555.43,978.201 2557.74,1123.55 2560.05,1013.31 2562.36,829.744 2564.66,895.353 2566.97,909.546 2569.28,1108.66 2571.59,1029.91 "></polyline>
<polyline clip-path="url(#clip122)" style="stroke:#3da44d; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="265.984,551.382 268.292,385.522 270.6,458.051 272.908,421.027 275.216,475.506 277.524,361.326 279.832,240.169 282.139,560.705 284.447,461.181 286.755,418.526 289.063,363.165 291.371,481.029 293.679,526.361 295.987,550.127 298.295,508.083 300.603,241.993 302.911,479.717 305.219,478.587 307.527,512.695 309.834,527.487 312.142,423.184 314.45,354.837 316.758,409.804 319.066,260.843 321.374,382.573 323.682,573.395 325.99,471.181 328.298,555.78 330.606,506.246 332.914,408.926 335.221,459.522 337.529,370.354 339.837,533.978 342.145,514.257 344.453,370.639 346.761,406.814 349.069,448.876 351.377,290.881 353.685,414.345 355.993,305.161 358.301,481.995 360.608,541.792 362.916,626.316 365.224,450.962 367.532,486.759 369.84,446.834 372.148,346.403 374.456,530.338 376.764,492.505 379.072,435.135 381.38,456.521 383.688,607.213 385.996,470.591 388.303,478.154 390.611,641.822 392.919,510.585 395.227,558.047 397.535,255.485 399.843,420.706 402.151,549.88 404.459,398.141 406.767,421.918 409.075,475.489 411.383,405.688 413.69,601.034 415.998,501.309 418.306,297.564 420.614,489.875 422.922,404.927 425.23,477.109 427.538,368.563 429.846,674.187 432.154,387.781 434.462,635.53 436.77,588.853 439.077,474.148 441.385,574.818 443.693,584.111 446.001,469.305 448.309,550.847 450.617,540.486 452.925,553.225 455.233,387.602 457.541,417.969 459.849,474.6 462.157,664.35 464.465,385.261 466.772,421.979 469.08,376.29 471.388,390.384 473.696,468.043 476.004,497.541 478.312,413.795 480.62,505.86 482.928,331.448 485.236,563.668 487.544,581.076 489.852,528.459 492.159,459.178 494.467,420.307 496.775,342.959 499.083,491.649 501.391,432.968 503.699,385.682 506.007,566.697 508.315,356.564 510.623,515.773 512.931,294.026 515.239,540.895 517.546,434.284 519.854,473.467 522.162,627.291 524.47,462.633 526.778,534.744 529.086,446.997 531.394,398.915 533.702,410.176 536.01,426.269 538.318,535.505 540.626,287.916 542.933,486.494 545.241,404.681 547.549,457.796 549.857,477.62 552.165,458.467 554.473,649.037 556.781,545.216 559.089,481.773 561.397,573.594 563.705,574.561 566.013,500.926 568.321,435.484 570.628,382.183 572.936,481.952 575.244,393.515 577.552,357.717 579.86,393.413 582.168,634.678 584.476,417.642 586.784,549.453 589.092,556.088 591.4,496.245 593.708,382.114 596.015,550.469 598.323,310.365 600.631,530.519 602.939,547.287 605.247,608.009 607.555,521.047 609.863,474.203 612.171,564.085 614.479,344.4 616.787,555.745 619.095,317.445 621.402,412.53 623.71,461.104 626.018,407.041 628.326,423.275 630.634,406.043 632.942,468.83 635.25,327.949 637.558,366.676 639.866,449.24 642.174,549.963 644.482,541.669 646.79,410.175 649.097,458.663 651.405,420.888 653.713,435.987 656.021,481.273 658.329,267.223 660.637,470.888 662.945,474.483 665.253,469.265 667.561,398.582 669.869,435.742 672.177,508.335 674.484,354.456 676.792,697.792 679.1,419.711 681.408,537.069 683.716,489.314 686.024,355.579 688.332,353.824 690.64,442.541 692.948,527.591 695.256,379.233 697.564,348.556 699.871,486.346 702.179,544.098 704.487,418.363 706.795,505.266 709.103,320.412 711.411,480.352 713.719,303.543 716.027,428.173 718.335,456.958 720.643,644.875 722.951,341.527 725.259,597.133 727.566,427.364 729.874,369.173 732.182,233.016 734.49,501.952 736.798,428.74 739.106,432.659 741.414,201.189 743.722,404.905 746.03,468.116 748.338,522.4 750.646,627.419 752.953,375.983 755.261,345.104 757.569,565.929 759.877,436.975 762.185,354.716 764.493,615.211 766.801,399.647 769.109,512.628 771.417,331.367 773.725,462.214 776.033,502.738 778.34,438.9 780.648,417.921 782.956,491.303 785.264,575.306 787.572,469.651 789.88,407.222 792.188,567.11 794.496,420.755 796.804,540.827 799.112,544.323 801.42,96.8724 803.728,542.01 806.035,625.537 808.343,415.942 810.651,438.659 812.959,464.615 815.267,474.766 817.575,516.804 819.883,538.627 822.191,317.451 824.499,387.694 826.807,505.124 829.115,405.144 831.422,544.328 833.73,484.196 836.038,371.51 838.346,499.512 840.654,483.53 842.962,339.361 845.27,463.03 847.578,497.024 849.886,524.814 852.194,439.69 854.502,471.127 856.809,219.362 859.117,430.284 861.425,560.249 863.733,370.373 866.041,486.525 868.349,584.853 870.657,480.848 872.965,399.165 875.273,714.403 877.581,356.095 879.889,390.093 882.197,520.93 884.504,422.938 886.812,509.48 889.12,509.385 891.428,462.575 893.736,573.693 896.044,526.935 898.352,342.503 900.66,477.139 902.968,364.518 905.276,597.607 907.584,452.679 909.891,395.833 912.199,388.636 914.507,492.23 916.815,406.583 919.123,410.854 921.431,328.447 923.739,429.618 926.047,620.795 928.355,511.696 930.663,574.236 932.971,370.041 935.278,504.772 937.586,302.72 939.894,606.698 942.202,528.015 944.51,567.421 946.818,273.011 949.126,350.193 951.434,500.813 953.742,335.117 956.05,521.706 958.358,504.532 960.665,486.931 962.973,603.548 965.281,386.69 967.589,345.689 969.897,381.441 972.205,642.958 974.513,507.448 976.821,412.937 979.129,656.39 981.437,286.857 983.745,338.563 986.053,491.994 988.36,480.68 990.668,301.32 992.976,463.358 995.284,524.162 997.592,316.438 999.9,360.372 1002.21,436.075 1004.52,445.183 1006.82,450.547 1009.13,494.872 1011.44,465.157 1013.75,531.337 1016.06,329.687 1018.36,471.745 1020.67,379.92 1022.98,459.06 1025.29,457.781 1027.59,404.358 1029.9,656.297 1032.21,572.695 1034.52,467.483 1036.83,683.762 1039.13,582.801 1041.44,380.61 1043.75,363.461 1046.06,345.459 1048.37,509.632 1050.67,420.409 1052.98,519.835 1055.29,740.517 1057.6,356.998 1059.91,394.209 1062.21,312.709 1064.52,484.891 1066.83,618.568 1069.14,355.132 1071.45,529.246 1073.75,564.738 1076.06,479.607 1078.37,492.513 1080.68,681.46 1082.98,593.16 1085.29,590.938 1087.6,432.529 1089.91,402.489 1092.22,411.469 1094.52,388.213 1096.83,487.381 1099.14,443.609 1101.45,378.974 1103.76,371.315 1106.06,490.525 1108.37,428.134 1110.68,526.566 1112.99,518.86 1115.3,464.458 1117.6,327.118 1119.91,393.188 1122.22,460.058 1124.53,412.303 1126.84,496.642 1129.14,421.457 1131.45,547.409 1133.76,550.644 1136.07,507.929 1138.37,461.347 1140.68,469.811 1142.99,434.937 1145.3,250.012 1147.61,460.102 1149.91,414.358 1152.22,315.502 1154.53,468.271 1156.84,591.901 1159.15,478.729 1161.45,387.448 1163.76,581.525 1166.07,386.547 1168.38,411.447 1170.69,462.979 1172.99,200.531 1175.3,470.168 1177.61,494.865 1179.92,408.376 1182.23,201.378 1184.53,501.626 1186.84,498.55 1189.15,482.81 1191.46,488.216 1193.76,552.55 1196.07,366.932 1198.38,471.954 1200.69,449.339 1203,459.675 1205.3,410.77 1207.61,556.743 1209.92,508.59 1212.23,349.836 1214.54,378.312 1216.84,503.935 1219.15,401.238 1221.46,479.1 1223.77,588.835 1226.08,367.041 1228.38,569.051 1230.69,503.361 1233,468.03 1235.31,515.719 1237.61,614.193 1239.92,442.782 1242.23,406.732 1244.54,353.148 1246.85,451.353 1249.15,377.699 1251.46,524.042 1253.77,386.195 1256.08,567.001 1258.39,489.502 1260.69,442.639 1263,379.198 1265.31,424.383 1267.62,494.63 1269.93,481.151 1272.23,535.643 1274.54,519.082 1276.85,508.826 1279.16,649.089 1281.47,419.875 1283.77,500.941 1286.08,369.706 1288.39,520.477 1290.7,565.84 1293,491.507 1295.31,421.748 1297.62,497.936 1299.93,451.487 1302.24,300.735 1304.54,384.427 1306.85,562.391 1309.16,488.876 1311.47,470.303 1313.78,462.518 1316.08,325.761 1318.39,489.593 1320.7,634.998 1323.01,388.124 1325.32,477.9 1327.62,435.259 1329.93,565.422 1332.24,496.934 1334.55,423.102 1336.86,521.075 1339.16,467.776 1341.47,466.342 1343.78,282.847 1346.09,428.747 1348.39,390.615 1350.7,470.697 1353.01,408.972 1355.32,378.088 1357.63,359.202 1359.93,542.131 1362.24,365.87 1364.55,521.469 1366.86,375.253 1369.17,423.059 1371.47,328.214 1373.78,517.088 1376.09,399.64 1378.4,460.893 1380.71,528.919 1383.01,533.411 1385.32,384.123 1387.63,406.637 1389.94,446.18 1392.24,565.174 1394.55,457.407 1396.86,522.912 1399.17,540.443 1401.48,451.82 1403.78,275.141 1406.09,476.526 1408.4,391.536 1410.71,415.742 1413.02,529.185 1415.32,410.197 1417.63,374.834 1419.94,482.948 1422.25,402.232 1424.56,362.925 1426.86,264.175 1429.17,435.69 1431.48,282.399 1433.79,574.448 1436.1,515.143 1438.4,501.203 1440.71,292.063 1443.02,441.27 1445.33,412.149 1447.63,436.703 1449.94,298.714 1452.25,451.156 1454.56,555.352 1456.87,536.454 1459.17,419.708 1461.48,499.797 1463.79,475.032 1466.1,406.569 1468.41,486.144 1470.71,498.947 1473.02,350.733 1475.33,465.233 1477.64,518.096 1479.95,384.194 1482.25,274.293 1484.56,408.216 1486.87,506.949 1489.18,476.454 1491.49,425.939 1493.79,544.279 1496.1,500.312 1498.41,520.732 1500.72,450.229 1503.02,513.212 1505.33,495.985 1507.64,482.252 1509.95,504.075 1512.26,285.5 1514.56,435.748 1516.87,413.858 1519.18,475.021 1521.49,352.018 1523.8,377.528 1526.1,488.128 1528.41,520.28 1530.72,315.262 1533.03,366.74 1535.34,484.778 1537.64,457.411 1539.95,627.93 1542.26,414.716 1544.57,623.412 1546.88,642.807 1549.18,589.709 1551.49,362.998 1553.8,431.863 1556.11,488.572 1558.41,594.349 1560.72,513.878 1563.03,604.6 1565.34,483.819 1567.65,506.219 1569.95,501.983 1572.26,425.6 1574.57,564.278 1576.88,253.041 1579.19,500.825 1581.49,323.025 1583.8,455.673 1586.11,421.968 1588.42,452.363 1590.73,366.985 1593.03,463.695 1595.34,406.013 1597.65,500.768 1599.96,438.595 1602.26,582.23 1604.57,712.198 1606.88,305.588 1609.19,483.458 1611.5,496.548 1613.8,581.675 1616.11,505.646 1618.42,350.028 1620.73,479.326 1623.04,706.198 1625.34,503.266 1627.65,421.334 1629.96,327.982 1632.27,514.695 1634.58,512.358 1636.88,365.781 1639.19,648.146 1641.5,532.459 1643.81,568.088 1646.12,389.562 1648.42,352.686 1650.73,571.859 1653.04,488.679 1655.35,623.577 1657.65,491.83 1659.96,382.735 1662.27,477.741 1664.58,545.275 1666.89,313.761 1669.19,419.005 1671.5,511.512 1673.81,388.833 1676.12,590.804 1678.43,558.171 1680.73,613.668 1683.04,468.668 1685.35,514.165 1687.66,410.271 1689.97,621.934 1692.27,617.89 1694.58,558.665 1696.89,278.654 1699.2,399.359 1701.51,500.378 1703.81,403.845 1706.12,518.915 1708.43,317.82 1710.74,512.353 1713.04,530.494 1715.35,375.942 1717.66,487.269 1719.97,510.352 1722.28,335.728 1724.58,482.411 1726.89,386.771 1729.2,496.969 1731.51,449.289 1733.82,372.002 1736.12,674.475 1738.43,588.168 1740.74,577.599 1743.05,461.733 1745.36,270.864 1747.66,378.436 1749.97,381.262 1752.28,500.113 1754.59,494.694 1756.9,434.595 1759.2,520.919 1761.51,446 1763.82,578.832 1766.13,412.406 1768.43,436.843 1770.74,460.013 1773.05,411.66 1775.36,380.224 1777.67,338.849 1779.97,567.308 1782.28,426.359 1784.59,579.17 1786.9,393.007 1789.21,278.498 1791.51,528.349 1793.82,461.135 1796.13,430.492 1798.44,463.165 1800.75,518.906 1803.05,526.385 1805.36,428.885 1807.67,325.801 1809.98,462.556 1812.28,612.674 1814.59,399.28 1816.9,322.543 1819.21,660.872 1821.52,428.604 1823.82,430.506 1826.13,473.217 1828.44,649.436 1830.75,564.726 1833.06,493.308 1835.36,676.498 1837.67,344.714 1839.98,423.367 1842.29,395.842 1844.6,276.297 1846.9,483.229 1849.21,438.197 1851.52,551.729 1853.83,403.108 1856.14,618.616 1858.44,501.738 1860.75,391.982 1863.06,481.614 1865.37,518.631 1867.67,650.271 1869.98,426.217 1872.29,427.954 1874.6,489.08 1876.91,510.961 1879.21,493.151 1881.52,455.574 1883.83,339.205 1886.14,317.11 1888.45,386.975 1890.75,583.969 1893.06,531.777 1895.37,361.109 1897.68,364.496 1899.99,408.107 1902.29,469.531 1904.6,481.453 1906.91,471.179 1909.22,531.565 1911.53,430.049 1913.83,221.845 1916.14,549.163 1918.45,345.475 1920.76,472.588 1923.06,361.901 1925.37,495.619 1927.68,602.359 1929.99,564.395 1932.3,430.022 1934.6,533.233 1936.91,490.437 1939.22,364.836 1941.53,494.447 1943.84,560.271 1946.14,463.274 1948.45,446.723 1950.76,314.382 1953.07,445.089 1955.38,352.444 1957.68,353.744 1959.99,388.648 1962.3,384.106 1964.61,445.741 1966.91,462.241 1969.22,588.315 1971.53,435.73 1973.84,468.529 1976.15,434.745 1978.45,289.306 1980.76,582.309 1983.07,387.98 1985.38,250.281 1987.69,377.436 1989.99,477.013 1992.3,381.254 1994.61,451.262 1996.92,445.342 1999.23,355.534 2001.53,416.428 2003.84,499.601 2006.15,346.303 2008.46,260.901 2010.77,320.046 2013.07,479.022 2015.38,418.282 2017.69,437.265 2020,543.532 2022.3,540.294 2024.61,487.779 2026.92,531.132 2029.23,477.338 2031.54,398.228 2033.84,498.753 2036.15,474.024 2038.46,592.34 2040.77,437.291 2043.08,444.289 2045.38,420.834 2047.69,324.107 2050,558.239 2052.31,567.013 2054.62,496.092 2056.92,405.55 2059.23,538.046 2061.54,483.894 2063.85,561.248 2066.16,519.337 2068.46,431.433 2070.77,529.39 2073.08,478.423 2075.39,739.703 2077.69,481.867 2080,480.042 2082.31,412.692 2084.62,493.653 2086.93,495.846 2089.23,577.001 2091.54,376.807 2093.85,639.163 2096.16,535.05 2098.47,401.86 2100.77,371.406 2103.08,438.392 2105.39,338.621 2107.7,450.505 2110.01,361.279 2112.31,624.53 2114.62,529.786 2116.93,414.532 2119.24,395.551 2121.55,364.351 2123.85,458.619 2126.16,428.826 2128.47,460.763 2130.78,499.289 2133.08,483.37 2135.39,429.21 2137.7,637.634 2140.01,441.779 2142.32,446.664 2144.62,654.601 2146.93,423.453 2149.24,556.501 2151.55,573.042 2153.86,515.885 2156.16,375.164 2158.47,508.926 2160.78,556.613 2163.09,477.546 2165.4,518.533 2167.7,343.395 2170.01,346.22 2172.32,381.046 2174.63,559.948 2176.93,461.435 2179.24,461.292 2181.55,400.168 2183.86,571.23 2186.17,541.786 2188.47,288.888 2190.78,427.476 2193.09,456.777 2195.4,508.189 2197.71,362.429 2200.01,465.759 2202.32,414.189 2204.63,637.207 2206.94,544.916 2209.25,638.131 2211.55,459.212 2213.86,512.238 2216.17,376.646 2218.48,226.113 2220.79,554.975 2223.09,429.692 2225.4,303.257 2227.71,481.718 2230.02,626.549 2232.32,361.141 2234.63,459.663 2236.94,377.984 2239.25,425.284 2241.56,442.151 2243.86,430.741 2246.17,310.812 2248.48,590.707 2250.79,531.218 2253.1,349.834 2255.4,272.276 2257.71,452.773 2260.02,439.392 2262.33,396.711 2264.64,389.385 2266.94,460.03 2269.25,460.226 2271.56,578.585 2273.87,467.24 2276.18,702.466 2278.48,220.251 2280.79,605.53 2283.1,376.261 2285.41,529.095 2287.71,206.74 2290.02,358.271 2292.33,451.301 2294.64,369.342 2296.95,490.876 2299.25,364.67 2301.56,392.07 2303.87,340.056 2306.18,457.266 2308.49,317.627 2310.79,486.825 2313.1,587.967 2315.41,412.78 2317.72,317.088 2320.03,514.005 2322.33,349.821 2324.64,475.353 2326.95,677.403 2329.26,477.388 2331.56,596.403 2333.87,449.096 2336.18,109.493 2338.49,399.522 2340.8,475.035 2343.1,457.903 2345.41,586.976 2347.72,468.455 2350.03,356.39 2352.34,468.052 2354.64,419.978 2356.95,530.62 2359.26,576.514 2361.57,565.319 2363.88,587.154 2366.18,560.71 2368.49,607.429 2370.8,402.898 2373.11,482.874 2375.42,279.309 2377.72,339.34 2380.03,561.849 2382.34,293.985 2384.65,309.28 2386.95,407.094 2389.26,541.315 2391.57,437.883 2393.88,365.615 2396.19,432.081 2398.49,401.447 2400.8,334.737 2403.11,411.902 2405.42,351.545 2407.73,418.885 2410.03,310.352 2412.34,335.116 2414.65,502.792 2416.96,538.181 2419.27,301.767 2421.57,396.712 2423.88,641.167 2426.19,605.397 2428.5,375.792 2430.81,545.692 2433.11,512.595 2435.42,434.608 2437.73,489.264 2440.04,527.304 2442.34,440.753 2444.65,504.602 2446.96,406.319 2449.27,460.625 2451.58,498.638 2453.88,438.523 2456.19,625.744 2458.5,355.537 2460.81,318.438 2463.12,522.383 2465.42,574.903 2467.73,381.03 2470.04,471.233 2472.35,390.127 2474.66,441.316 2476.96,264.812 2479.27,599.237 2481.58,406.251 2483.89,446.002 2486.2,432.971 2488.5,509.966 2490.81,420.273 2493.12,359.904 2495.43,344.095 2497.73,366.816 2500.04,445.038 2502.35,516.444 2504.66,322.994 2506.97,621.194 2509.27,411.854 2511.58,530.176 2513.89,303.562 2516.2,536.34 2518.51,304.837 2520.81,531.084 2523.12,488.557 2525.43,416.899 2527.74,374.033 2530.05,494.112 2532.35,474.364 2534.66,492.355 2536.97,573.006 2539.28,361.065 2541.58,484.631 2543.89,268.936 2546.2,496.128 2548.51,400.391 2550.82,475.878 2553.12,535.992 2555.43,526.725 2557.74,442.258 2560.05,354.351 2562.36,374.224 2564.66,489.062 2566.97,511.426 2569.28,428.986 2571.59,469.836 "></polyline>
</svg>
</div>
</div>
<p>Look at that! Things are working; amazin’.</p>
<p>We can also exploit <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>’s parallel sampling capabilities:</p>
<div id="34" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run separate 4 chains for 10 000 iterations using threads to parallelize.</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>num_chains <span class="op">=</span> <span class="fl">4</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    model_with_grad,</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">MCMCThreads</span>(),</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>,</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    num_chains;</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Note we need to provide an initial state for every chain.</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>    initial_state<span class="op">=</span><span class="fu">fill</span>(state, num_chains),</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>samples_array <span class="op">=</span> <span class="fu">stack</span>(<span class="fu">map</span>(<span class="bu">Base</span>.<span class="fu">Fix1</span>(stack, sample <span class="op">-&gt;</span> sample.x), samples))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000×4 Array{Float64, 3}:
[:, :, 1] =
 -1.91263  -2.80625  -3.02692     …  -4.31274   -4.90404   -4.90404
  1.586     2.62021   0.00625945      0.336532   0.455804   0.455804
  1.90886   2.56623   5.98394         4.38291    5.15978    5.15978

[:, :, 2] =
 -3.13067   -4.11679   -5.44087  …  -4.62047    -3.86839    -5.94457
 -0.479225   0.398675  -1.05334     -0.0857605  -0.0398706   0.57022
  2.00672    4.40882    5.42839      4.71559     5.19623     3.46447

[:, :, 3] =
 -2.90554  -5.45285   -3.21067  -3.94336  …  -5.16569   -6.34031   -6.67015
  1.26861   0.181485   2.03533   1.06376      0.716585  -0.326297   0.552621
  1.69022   2.4151     3.8201    4.51821      4.9442     5.32492    5.12441

[:, :, 4] =
 -2.87839  -2.81406  -3.6787   -3.99501  …  -3.21769   -3.21769   -4.64289
  1.08544   1.26646   0.49018   1.00682     -0.746906  -0.746906  -0.727544
  2.59565   6.7604    5.8586    5.95934      5.0398     5.0398     5.89486</code></pre>
</div>
</div>
<p>But the fact that we have to provide the <code>AbstractMCMC.sample</code> call, etc. with an <code>initial_state</code> to get started is a bit annoying. We can avoid this by also defining a <code>AbstractMCMC.step</code> <em>without</em> the <code>state</code> argument:</p>
<div id="36" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">::</span><span class="dt">MALA</span>;</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># </span><span class="al">NOTE</span><span class="co">: No state provided!</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just create the initial state by sampling using  a Gaussian.</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="fu">randn</span>(rng, LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(x), <span class="fu">MALAState</span>(x)</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Equipped with this, we no longer need to provide the <code>initial_state</code> everywhere:</p>
<div id="38" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -4.99343     1.00601
 -0.00730932  1.00666
  5.00716     0.994191</code></pre>
</div>
</div>
</section>
<section id="using-our-sampler-with-turing.jl" class="level2">
<h2 class="anchored" data-anchor-id="using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</h2>
<p>As we promised, all of this hassle of implementing our <code>MALA</code> sampler in a way that uses <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> and <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> gets us something more than <em>just</em> an “automatic” implementation of <code>AbstractMCMC.sample</code>.</p>
<p>It also enables use with Turing.jl through the <code>externalsampler</code>, but we need to do one final thing first: we need to tell Turing.jl how to extract a vector of parameters from the “sample” returned in our implementation of <code>AbstractMCMC.step</code>. In our case, the “sample” is a <code>MALASample</code>, so we just need the following line:</p>
<div id="40" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load Turing.jl.</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Turing</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Overload the `getparams` method for our "sample" type, which is just a vector.</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>Turing.Inference.<span class="fu">getparams</span>(<span class="op">::</span><span class="dt">Turing.Model</span>, sample<span class="op">::</span><span class="dt">MALASample</span>) <span class="op">=</span> sample.x</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And with that, we’re good to go!</p>
<div id="42" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Our previous model defined as a Turing.jl model.</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">mvnormal_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">MvNormal</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.], I)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate our model.</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">mvnormal_model</span>()</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Call `sample` but now we're passing in a Turing.jl `model` and wrapping</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co"># our `MALA` sampler in the `externalsampler` to tell Turing.jl that the sampler</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co"># expects something that implements LogDensityProblems.jl.</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×4×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 2.96 seconds
Compute duration  = 2.96 seconds
parameters        = x[1], x[2], x[3]
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters  </span><span class="ansi-bold">    mean  </span><span class="ansi-bold">     std  </span><span class="ansi-bold">    mcse  </span><span class="ansi-bold">  ess_bulk  </span><span class="ansi-bold">  ess_tail  </span><span class="ansi-bold">    rhat  </span><span class="ansi-bold"> ⋯
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">   Float64  </span><span class="ansi-bright-black-fg ansi-bold">   Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> ⋯

        x[1]   -5.0035    1.0000    0.0171   3439.0728   5395.5891    1.0003   ⋯
        x[2]   -0.0033    0.9958    0.0175   3257.1017   5075.5482    0.9999   ⋯
        x[3]    5.0027    1.0098    0.0178   3221.6422   5128.9710    1.0020   ⋯
</span><span class="ansi-cyan-fg ansi-bold">                                                                1 column omitted

Quantiles
 </span><span class="ansi-cyan-fg ansi-bold"> parameters  </span><span class="ansi-cyan-fg ansi-bold">    2.5%  </span><span class="ansi-cyan-fg ansi-bold">   25.0%  </span><span class="ansi-cyan-fg ansi-bold">   50.0%  </span><span class="ansi-cyan-fg ansi-bold">   75.0%  </span><span class="ansi-cyan-fg ansi-bold">   97.5%
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64

        x[1]   -6.9521   -5.6661   -5.0032   -4.3333   -3.0371
        x[2]   -1.9370   -0.6763   -0.0106    0.6731    2.0010
        x[3]    3.0053    4.3375    4.9960    5.6773    6.9820
</span></pre>
</div>
</div>
</div>
<p>Pretty neat, eh?</p>
<section id="models-with-constrained-parameters" class="level3">
<h3 class="anchored" data-anchor-id="models-with-constrained-parameters">Models with constrained parameters</h3>
<p>One thing we’ve sort of glossed over in all of the above is that MALA, at least how we’ve implemented it, requires <span class="math inline">\(x\)</span> to live in <span class="math inline">\(\mathbb{R}^d\)</span> for some <span class="math inline">\(d &gt; 0\)</span>. If some of the parameters were in fact constrained, e.g.&nbsp;we were working with a <code>Beta</code> distribution which has support on the interval <span class="math inline">\((0, 1)\)</span>, <em>not</em> on <span class="math inline">\(\mathbb{R}^d\)</span>, we could easily end up outside of the valid range <span class="math inline">\((0, 1)\)</span>.</p>
<div id="44" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">beta_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">beta_model</span>()</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 1.94 seconds
Compute duration  = 1.94 seconds
parameters        = x
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters  </span><span class="ansi-bold">    mean  </span><span class="ansi-bold">     std  </span><span class="ansi-bold">    mcse  </span><span class="ansi-bold">  ess_bulk  </span><span class="ansi-bold">  ess_tail  </span><span class="ansi-bold">    rhat  </span><span class="ansi-bold"> ⋯
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">   Float64  </span><span class="ansi-bright-black-fg ansi-bold">   Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> ⋯

           x    0.4997    0.1889    0.0029   4053.2233   5644.3050    0.9999   ⋯
</span><span class="ansi-cyan-fg ansi-bold">                                                                1 column omitted

Quantiles
 </span><span class="ansi-cyan-fg ansi-bold"> parameters  </span><span class="ansi-cyan-fg ansi-bold">    2.5%  </span><span class="ansi-cyan-fg ansi-bold">   25.0%  </span><span class="ansi-cyan-fg ansi-bold">   50.0%  </span><span class="ansi-cyan-fg ansi-bold">   75.0%  </span><span class="ansi-cyan-fg ansi-bold">   97.5%
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64

           x    0.1439    0.3617    0.4987    0.6396    0.8531
</span></pre>
</div>
</div>
</div>
<p>Yep, that still works, but only because Turing.jl actually <em>transforms</em> the <code>turing_model</code> from constrained to unconstrained, so that the <code>sampler</code> provided to <code>externalsampler</code> is actually always working in unconstrained space! This is not always desirable, so we can turn this off:</p>
<div id="46" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 0.19 seconds
Compute duration  = 0.19 seconds
parameters        = x
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters  </span><span class="ansi-bold">    mean  </span><span class="ansi-bold">     std  </span><span class="ansi-bold">    mcse  </span><span class="ansi-bold"> ess_bulk  </span><span class="ansi-bold"> ess_tail  </span><span class="ansi-bold">    rhat  </span><span class="ansi-bold"> e ⋯
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">  Float64  </span><span class="ansi-bright-black-fg ansi-bold">  Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">   ⋯

           x    0.4668    0.2127    0.0198    73.9530    35.4134    1.0894     ⋯
</span><span class="ansi-cyan-fg ansi-bold">                                                                1 column omitted

Quantiles
 </span><span class="ansi-cyan-fg ansi-bold"> parameters  </span><span class="ansi-cyan-fg ansi-bold">    2.5%  </span><span class="ansi-cyan-fg ansi-bold">   25.0%  </span><span class="ansi-cyan-fg ansi-bold">   50.0%  </span><span class="ansi-cyan-fg ansi-bold">   75.0%  </span><span class="ansi-cyan-fg ansi-bold">   97.5%
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64

           x    0.2330    0.3497    0.4765    0.5933    0.7409
</span></pre>
</div>
</div>
</div>
<p>The fun thing is that this still sort of works because</p>
<div id="48" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">logpdf</span>(<span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>), <span class="fl">10.0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-Inf</code></pre>
</div>
</div>
<p>and so the samples that fall outside of the range are always rejected. But do notice how much worse all the diagnostics are, e.g.&nbsp;<code>ess_tail</code> is very poor compared to when we use <code>unconstrained=true</code>. Moreover, in more complex cases this won’t just result in a “nice” <code>-Inf</code> log-density value, but instead will error:</p>
<div id="50" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="kw">function</span> <span class="fu">demo</span>()</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>    σ² <span class="op">~</span> <span class="fu">truncated</span>(<span class="fu">Normal</span>(), lower<span class="op">=</span><span class="fl">0</span>)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If we end up with negative values for `σ²`, the `Normal` will error.</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>    x <span class="op">~</span> <span class="fu">Normal</span>(<span class="fl">0</span>, σ²)</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 2.73 seconds
Compute duration  = 2.73 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters  </span><span class="ansi-bold">    mean  </span><span class="ansi-bold">     std  </span><span class="ansi-bold">    mcse  </span><span class="ansi-bold"> ess_bulk  </span><span class="ansi-bold"> ess_tail  </span><span class="ansi-bold">    rhat  </span><span class="ansi-bold"> e ⋯
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">  Float64  </span><span class="ansi-bright-black-fg ansi-bold">  Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">   ⋯

          σ²    0.0729    0.0000    0.0000        NaN        NaN       NaN     ⋯
           x    0.5319    0.0000    0.0000        NaN        NaN       NaN     ⋯
</span><span class="ansi-cyan-fg ansi-bold">                                                                1 column omitted

Quantiles
 </span><span class="ansi-cyan-fg ansi-bold"> parameters  </span><span class="ansi-cyan-fg ansi-bold">    2.5%  </span><span class="ansi-cyan-fg ansi-bold">   25.0%  </span><span class="ansi-cyan-fg ansi-bold">   50.0%  </span><span class="ansi-cyan-fg ansi-bold">   75.0%  </span><span class="ansi-cyan-fg ansi-bold">   97.5%
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64

          σ²    0.0729    0.0729    0.0729    0.0729    0.0729
           x    0.5319    0.5319    0.5319    0.5319    0.5319
</span></pre>
</div>
</div>
</div>
<p>As expected, we run into a <code>DomainError</code> at some point, while if we set <code>unconstrained=true</code>, letting Turing.jl transform the model to a unconstrained form behind the scenes, everything works as expected:</p>
<div id="52" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 0.65 seconds
Compute duration  = 0.65 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters  </span><span class="ansi-bold">    mean  </span><span class="ansi-bold">     std  </span><span class="ansi-bold">    mcse  </span><span class="ansi-bold"> ess_bulk  </span><span class="ansi-bold"> ess_tail  </span><span class="ansi-bold">    rhat  </span><span class="ansi-bold"> e ⋯
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">  Float64  </span><span class="ansi-bright-black-fg ansi-bold">  Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">   ⋯

          σ²    0.8376    0.5387    0.0211   489.7406   233.4683    1.0035     ⋯
           x    0.0515    0.8964    0.0392   639.3774   601.9468    1.0077     ⋯
</span><span class="ansi-cyan-fg ansi-bold">                                                                1 column omitted

Quantiles
 </span><span class="ansi-cyan-fg ansi-bold"> parameters  </span><span class="ansi-cyan-fg ansi-bold">    2.5%  </span><span class="ansi-cyan-fg ansi-bold">   25.0%  </span><span class="ansi-cyan-fg ansi-bold">   50.0%  </span><span class="ansi-cyan-fg ansi-bold">   75.0%  </span><span class="ansi-cyan-fg ansi-bold">   97.5%
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64

          σ²    0.1540    0.4025    0.7253    1.1606    2.1132
           x   -1.7318   -0.3704    0.0259    0.4715    2.0716
</span></pre>
</div>
</div>
</div>
<p>Neat!</p>
<p>Similarly, which automatic differentiation backend one should use can be specified through the <code>adtype</code> keyword argument too. For example, if we want to use <a href="https://github.com/JuliaDiff/ReverseDiff.jl">ReverseDiff.jl</a> instead of the default <a href="https://github.com/JuliaDiff/ForwardDiff.jl">ForwardDiff.jl</a>:</p>
<div id="54" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">ReverseDiff</span>: ReverseDiff</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify that we want to use `AutoReverseDiff`.</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">demo</span>(),</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>, adtype<span class="op">=</span><span class="fu">AutoReverseDiff</span>()),</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>;</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 2.91 seconds
Compute duration  = 2.91 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters  </span><span class="ansi-bold">    mean  </span><span class="ansi-bold">     std  </span><span class="ansi-bold">    mcse  </span><span class="ansi-bold"> ess_bulk  </span><span class="ansi-bold"> ess_tail  </span><span class="ansi-bold">    rhat  </span><span class="ansi-bold"> e ⋯
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">  Float64  </span><span class="ansi-bright-black-fg ansi-bold">  Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">   ⋯

          σ²    0.8234    0.5447    0.0301   144.7387    33.4366    1.0020     ⋯
           x   -0.0639    0.8810    0.0362   724.1466   197.1824    1.0034     ⋯
</span><span class="ansi-cyan-fg ansi-bold">                                                                1 column omitted

Quantiles
 </span><span class="ansi-cyan-fg ansi-bold"> parameters  </span><span class="ansi-cyan-fg ansi-bold">    2.5%  </span><span class="ansi-cyan-fg ansi-bold">   25.0%  </span><span class="ansi-cyan-fg ansi-bold">   50.0%  </span><span class="ansi-cyan-fg ansi-bold">   75.0%  </span><span class="ansi-cyan-fg ansi-bold">   97.5%
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64

          σ²    0.1136    0.3869    0.7223    1.1402    2.0791
           x   -2.1249   -0.4525   -0.0731    0.3395    1.7985
</span></pre>
</div>
</div>
</div>
<p>Double-neat.</p>
</section>
</section>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<p>At this point it’s worth maybe reminding ourselves what we did and also <em>why</em> we did it:</p>
<ol type="1">
<li>We define our models in the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface because it makes the sampler agnostic to how the underlying model is implemented.</li>
<li>We implement our sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> interface, which just means that our sampler is a subtype of <code>AbstractMCMC.AbstractSampler</code> and we implement the MCMC transition in <code>AbstractMCMC.step</code>.</li>
<li>Points 1 and 2 makes it so our sampler can be used with a wide range of model implementations, amongst them being models implemented in both Turing.jl and Stan. This gives you, the inference implementer, a large collection of models to test your inference method on, in addition to allowing users of Turing.jl and Stan to try out your inference method with minimal effort.</li>
</ol>


</section>


<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a><div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>We’re going with the leapfrog formulation because in a future version of this tutorial we’ll add a section extending this simple “baseline” MALA sampler to more complex versions. See <a href="https://github.com/TuringLang/docs/issues/479">issue #479</a> for progress on this.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>There is no such thing as a proper interface in Julia (at least not officially), and so we use the word “interface” here to mean a few minimal methods that needs to be implemented by any type that we treat as a target model.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    // Ensure there is a toggle, if there isn't float one in the top right
    if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
      const a = window.document.createElement('a');
      a.classList.add('top-right');
      a.classList.add('quarto-color-scheme-toggle');
      a.href = "";
      a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
      const i = window.document.createElement("i");
      i.classList.add('bi');
      a.appendChild(i);
      window.document.body.appendChild(a);
    }
    setColorSchemeToggle(hasAlternateSentinel())
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/turinglang\.org\/docs\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../../developers/inference/variational-inference/index.html" class="pagination-link" aria-label="Variational Inference">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Variational Inference</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Turing is created by <a href="http://mlg.eng.cam.ac.uk/hong/" target="_blank">Hong Ge</a>, and lovingly maintained by the <a href="https://github.com/TuringLang/Turing.jl/graphs/contributors" target="_blank">core team</a> of volunteers. <br> The contents of this website are © 2024 under the terms of the <a href="https://github.com/TuringLang/Turing.jl/blob/main/LICENCE" target="_blank">MIT License</a>.</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/TuringLang/docs/edit/main/developers/inference/implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/docs/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://x.com/TuringLang">
      <i class="bi bi-twitter" role="img" aria-label="Turing Twitter">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/TuringLang/Turing.jl">
      <i class="bi bi-github" role="img" aria-label="Turing GitHub">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




<script src="../../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>