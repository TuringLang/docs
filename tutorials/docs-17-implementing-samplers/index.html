<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Implementing samplers – Turing.jl</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../tutorials/docs-07-for-developers-variational-inference/index.html" rel="prev">
<link href="../../assets/favicon.ico" rel="icon">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<style>
  a {
    text-decoration: none;
  }
  a:hover {
    text-decoration: underline;
  }
</style>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../theming/styles.css">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="https://turinglang.org/" class="navbar-brand navbar-brand-logo">
    <img src="../../assets/images/turing-logo.svg" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="https://turinglang.org/">
    <span class="navbar-title">Turing.jl</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../tutorials/docs-00-getting-started/"> 
<span class="menu-text">Get Started</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../tutorials/00-introduction/"> 
<span class="menu-text">Tutorials</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/library/"> 
<span class="menu-text">Libraries</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/news/"> 
<span class="menu-text">News</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/team/"> 
<span class="menu-text">Team</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-v0.34" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">v0.34</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-v0.34">    
        <li>
    <a class="dropdown-item" href="https://turinglang.org/docs/changelog.html">
 <span class="dropdown-text">Changelog</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://turinglang.org/docs/versions.html">
 <span class="dropdown-text">All Versions</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools tools-wide">
    <a href="https://x.com/TuringLang" title="Turing Twitter" class="quarto-navigation-tool px-1" aria-label="Turing Twitter"><i class="bi bi-twitter"></i></a>
    <a href="https://github.com/TuringLang/Turing.jl" title="Turing GitHub" class="quarto-navigation-tool px-1" aria-label="Turing GitHub"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Developers</li><li class="breadcrumb-item"><a href="../../tutorials/docs-06-for-developers-interface/index.html">Inference (note: outdated)</a></li><li class="breadcrumb-item"><a href="../../tutorials/docs-17-implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false">
 <span class="menu-text">Users</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-00-getting-started/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Getting Started</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-12-using-turing-guide/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Core Functionality</span></a>
  </div>
</li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false">
 <span class="menu-text">Usage Tips</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-10-using-turing-autodiff/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Automatic Differentiation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/usage-custom-distribution/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Custom Distributions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/usage-modifying-logprob/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Modifying the Log Probability</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/usage-generated-quantities/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Generated Quantities</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-17-mode-estimation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Mode Estimation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-13-using-turing-performance-tips/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Performance Tips</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-15-using-turing-sampler-viz/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Sampler Visualization</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-11-using-turing-dynamichmc/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using DynamicHMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-16-using-turing-external-samplers/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using External Samplers</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false">
 <span class="menu-text">Tutorials</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/00-introduction/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction: Coin Flipping</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/01-gaussian-mixture-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Mixture Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/02-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/03-bayesian-neural-network/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Neural Networks</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/04-hidden-markov-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Hidden Markov Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/05-linear-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Linear Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/06-infinite-mixture-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Infinite Mixture Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/07-poisson-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Poisson Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/08-multinomial-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Multinomial Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/09-variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/10-bayesian-differential-equations/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Differential Equations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/11-probabilistic-pca/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Probabilistic PCA</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/13-seasonal-time-series/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Time Series Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/15-gaussian-processes/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction to Gaussian Processes</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/12-gplvm/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Process Latent Variable Models</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Developers</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false">
 <span class="menu-text">Contributing</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-01-contributing-guide/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">How to Contribute</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="false">
 <span class="menu-text">DynamicPPL in Depth</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/dev-model-manual/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Manually Defining a Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-05-for-developers-compiler/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Turing Compiler Design</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/14-minituring/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation I: Compiler</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/16-contexts/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation II: Contexts</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true">
 <span class="menu-text">Inference (note: outdated)</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-06-for-developers-interface/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Interface Guide</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-04-for-developers-abstractmcmc-turing/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">How Turing implements AbstractMCMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-07-for-developers-variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-17-implementing-samplers/index.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Implementing Samplers</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of Contents</h2>
   
  <ul>
  <li><a href="#quick-overview-of-mala" id="toc-quick-overview-of-mala" class="nav-link active" data-scroll-target="#quick-overview-of-mala">Quick overview of MALA</a></li>
  <li><a href="#what-we-need-from-a-model-logdensityproblems.jl" id="toc-what-we-need-from-a-model-logdensityproblems.jl" class="nav-link" data-scroll-target="#what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: LogDensityProblems.jl</a></li>
  <li><a href="#implementing-mala-in-abstractmcmc.jl" id="toc-implementing-mala-in-abstractmcmc.jl" class="nav-link" data-scroll-target="#implementing-mala-in-abstractmcmc.jl">Implementing MALA in AbstractMCMC.jl</a></li>
  <li><a href="#using-our-sampler-with-turing.jl" id="toc-using-our-sampler-with-turing.jl" class="nav-link" data-scroll-target="#using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</a>
  <ul class="collapse">
  <li><a href="#models-with-constrained-parameters" id="toc-models-with-constrained-parameters" class="nav-link" data-scroll-target="#models-with-constrained-parameters">Models with constrained parameters</a></li>
  </ul></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/TuringLang/docs/edit/master/tutorials/docs-17-implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/docs/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Developers</li><li class="breadcrumb-item"><a href="../../tutorials/docs-06-for-developers-interface/index.html">Inference (note: outdated)</a></li><li class="breadcrumb-item"><a href="../../tutorials/docs-17-implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Implementing samplers</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>In this tutorial, we’ll go through step-by-step how to implement a “simple” sampler in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> in such a way that it can be easily applied to Turing.jl models.</p>
<p>In particular, we’re going to implement a version of <strong>Metropolis-adjusted Langevin (MALA)</strong>.</p>
<p>Note that we will implement this sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> framework, completely “ignoring” Turing.jl until the very end of the tutorial, at which point we’ll use a single line of code to make the resulting sampler available to Turing.jl. This is to really drive home the point that one can implement samplers in a way that is accessible to all of Turing.jl’s users without having to use Turing.jl yourself.</p>
<section id="quick-overview-of-mala" class="level2">
<h2 class="anchored" data-anchor-id="quick-overview-of-mala">Quick overview of MALA</h2>
<p>We can view MALA as a single step of the leapfrog intergrator with resampling of momentum <span class="math inline">\(p\)</span> at every step.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> To make that statement a bit more concrete, we first define the <em>extended</em> target <span class="math inline">\(\bar{\gamma}(x, p)\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\log \bar{\gamma}(x, p) \propto \log \gamma(x) + \log \gamma_{\mathcal{N}(0, M)}(p)
\end{equation*}\]</span></p>
<p>where <span class="math inline">\(\gamma_{\mathcal{N}(0, M)}\)</span> denotes the density for a zero-centered Gaussian with covariance matrix <span class="math inline">\(M\)</span>. We then consider targeting this joint distribution over both <span class="math inline">\(x\)</span> and <span class="math inline">\(p\)</span> as follows. First we define the map</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  L_{\epsilon}: \quad &amp; \mathbb{R}^d \times \mathbb{R}^d \to \mathbb{R}^d \times \mathbb{R}^d \\
  &amp; (x, p) \mapsto (\tilde{x}, \tilde{p}) := L_{\epsilon}(x, p)
\end{split}
\end{equation*}\]</span></p>
<p>as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p_{1 / 2} &amp;:= p + \frac{\epsilon}{2} \nabla \log \gamma(x) \\
  \tilde{x} &amp;:= x + \epsilon M^{-1} p_{1 /2 } \\
  p_1 &amp;:= p_{1 / 2} + \frac{\epsilon}{2} \nabla \log \gamma(\tilde{x}) \\
  \tilde{p} &amp;:= - p_1
\end{split}
\end{equation*}\]</span></p>
<p>This might be familiar for some readers as a single step of the Leapfrog integrator. We then define the MALA kernel as follows: given the current iterate <span class="math inline">\(x_i\)</span>, we sample the next iterate <span class="math inline">\(x_{i + 1}\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p &amp;\sim \mathcal{N}(0, M) \\
  (\tilde{x}, \tilde{p}) &amp;:= L_{\epsilon}(x_i, p) \\
  \alpha &amp;:= \min \left\{ 1, \frac{\bar{\gamma}(\tilde{x}, \tilde{p})}{\bar{\gamma}(x_i, p)} \right\} \\
  x_{i + 1} &amp;:=
  \begin{cases}
    \tilde{x} \quad &amp; \text{ with prob. } \alpha \\
    x_i       \quad &amp; \text{ with prob. } 1 - \alpha
  \end{cases}
\end{split}
\end{equation*}\]</span></p>
<p>i.e.&nbsp;we accept the proposal <span class="math inline">\(\tilde{x}\)</span> with probability <span class="math inline">\(\alpha\)</span> and reject it, thus sticking with our current iterate, with probability <span class="math inline">\(1 - \alpha\)</span>.</p>
</section>
<section id="what-we-need-from-a-model-logdensityproblems.jl" class="level2">
<h2 class="anchored" data-anchor-id="what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a></h2>
<p>There are a few things we need from the “target” / “model” / density that we want to sample from:</p>
<ol type="1">
<li>We need access to log-density <em>evaluations</em> <span class="math inline">\(\log \gamma(x)\)</span> so we can compute the acceptance ratio involving <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>We need access to log-density <em>gradients</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span> so we can compute the Leapfrog steps <span class="math inline">\(L_{\epsilon}(x, p)\)</span>.</li>
<li>We also need access to the “size” of the model so we can determine the size of <span class="math inline">\(M\)</span>.</li>
</ol>
<p>Luckily for us, there is a package called <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> which provides an interface for <em>exactly</em> this!</p>
<p>To demonstrate how one can implement the “<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface”<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> we will use a simple Gaussian model as an example:</p>
<div id="4" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblems</span>: LogDensityProblems;</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's define some type that represents the model.</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> IsotropicNormalModel{M<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"mean of the isotropic Gaussian"</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    mean<span class="op">::</span><span class="dt">M</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Specifies what input length the model expects.</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">dimension</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> <span class="fu">length</span>(model.mean)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Implementation of the log-density evaluation of the model.</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x<span class="op">::</span><span class="dt">AbstractVector{&lt;:Real}</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">-</span> <span class="fu">sum</span>(abs2, x <span class="op">.-</span> model.mean) <span class="op">/</span> <span class="fl">2</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This gives us all of the properties we want for our MALA sampler with the exception of the computation of the <em>gradient</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span>. There is the method <code>LogDensityProblems.logdensity_and_gradient</code> which should return a 2-tuple where the first entry is the evaluation of the logdensity <span class="math inline">\(\log \gamma(x)\)</span> and the second entry is the gradient <span class="math inline">\(\nabla \log \gamma(x)\)</span>.</p>
<p>There are two ways to “implement” this method: 1) we implement it by hand, which is feasible in the case of our <code>IsotropicNormalModel</code>, or b) we defer the implementation of this to a automatic differentiation backend.</p>
<p>To implement it by hand we can simply do</p>
<div id="6" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl that first-order, i.e. gradient information, is available.</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{1}</span>()</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Implement `logdensity_and_gradient`.</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    logγ_x <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="op">-</span>x <span class="op">.*</span> (x <span class="op">-</span> model.mean)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> logγ_x, ∇logγ_x</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s just try it out:</p>
<div id="8" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate the problem.</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> <span class="fu">IsotropicNormalModel</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.])</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create some example input that we can test on.</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>x_example <span class="op">=</span> <span class="fu">randn</span>(LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate!</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-34.49751246867245</code></pre>
</div>
</div>
<p>To defer it to an automatic differentiation backend, we can do</p>
<div id="10" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl we only have access to 0-th order information.</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{0}</span>()</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Use `LogDensityProblemsAD`'s `ADgradient` in combination with some AD backend to implement `logdensity_and_gradient`.</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblemsAD</span>, <span class="bu">ADTypes</span>, <span class="bu">ForwardDiff</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>model_with_grad <span class="op">=</span> <span class="fu">ADgradient</span>(<span class="fu">AutoForwardDiff</span>(), model)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model_with_grad, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-34.49751246867245</code></pre>
</div>
</div>
<p>We’ll continue with the second approach in this tutorial since this is typically what one does in practice, because there are better hobbies to spend time on than deriving gradients by hand.</p>
<p>At this point, one might wonder how we’re going to tie this back to Turing.jl in the end. Effectively, when working with inference methods that only require log-density evaluations and / or higher-order information of the log-density, Turing.jl actually converts the user-provided <code>Model</code> into an object implementing the above methods for <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>. As a result, most samplers provided by Turing.jl are actually implemented to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, enabling their use both <em>within</em> Turing.jl and <em>outside</em> of Turing.jl! Morever, there exists similar conversions for Stan through BridgeStan and Stan<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, which means that a sampler supporting the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface can easily be used on both Turing.jl <em>and</em> Stan models (in addition to user-provided models, as our <code>IsotropicNormalModel</code> above)!</p>
<p>Anyways, let’s move on to actually implementing the sampler.</p>
</section>
<section id="implementing-mala-in-abstractmcmc.jl" class="level2">
<h2 class="anchored" data-anchor-id="implementing-mala-in-abstractmcmc.jl">Implementing MALA in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a></h2>
<p>Now that we’ve established that a model implementing the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface provides us with all the information we need from <span class="math inline">\(\log \gamma(x)\)</span>, we can address the question: given an object that implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, how can we define a sampler for it?</p>
<p>We’re going to do this by making our sampler a sub-type of <code>AbstractMCMC.AbstractSampler</code> in addition to implementing a few methods from <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>. Why? Because it gets us <em>a lot</em> of functionality for free, as we will see later.</p>
<p>Moreover, <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> provides a very natural interface for MCMC algorithms.</p>
<p>First, we’ll define our <code>MALA</code> type</p>
<div id="12" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">AbstractMCMC</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALA{T,A} <span class="op">&lt;:</span><span class="dt"> AbstractMCMC.AbstractSampler</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"stepsize used in the leapfrog step"</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    ϵ_init<span class="op">::</span><span class="dt">T</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"covariance matrix used for the momentum"</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    M_init<span class="op">::</span><span class="dt">A</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notice how we’ve added the suffix <code>_init</code> to both the stepsize and the covariance matrix. We’ve done this because a <code>AbstractMCMC.AbstractSampler</code> should be <em>immutable</em>. Of course there might be many scenarios where we want to allow something like the stepsize and / or the covariance matrix to vary between iterations, e.g.&nbsp;during the burn-in / adaptation phase of the sampling process we might want to adjust the parameters using statistics computed from these initial iterations. But information which can change between iterations <em>should not go in the sampler itself</em>! Instead, this information should go in the sampler <em>state</em>.</p>
<p>The sampler state should at the very least contain all the necessary information to perform the next MCMC iteration, but usually contains further information, e.g.&nbsp;quantities and statistics useful for evaluating whether the sampler has converged.</p>
<p>We will use the following sampler state for our <code>MALA</code> sampler:</p>
<div id="14" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALAState{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This might seem overly redundant: we’re defining a type <code>MALAState</code> and it only contains a simple vector of reals. In this particular case we indeed could have dropped this and simply used a <code>AbstractVector{&lt;:Real}</code> as our sampler state, but typically, as we will see later, one wants to include other quantities in the sampler state. For example, if we also wanted to adapt the parameters of our <code>MALA</code>, e.g.&nbsp;alter the stepsize depending on acceptance rates, in which case we should also put <code>ϵ</code> in the state, but for now we’ll keep things simple.</p>
<p>Moreover, we also want a <em>sample</em> type, which is a type meant for “public consumption”, i.e.&nbsp;the end-user. This is generally going to contain a subset of the information present in the state. But in such a simple scenario as this, we similarly only have a <code>AbstractVector{&lt;:Real}</code>:</p>
<div id="16" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALASample{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We currently have three things:</p>
<ol type="1">
<li>A <code>AbstractMCMC.AbstractSampler</code> implementation called <code>MALA</code>.</li>
<li>A state <code>MALAState</code> for our sampler <code>MALA</code>.</li>
<li>A sample <code>MALASample</code> for our sampler <code>MALA</code>.</li>
</ol>
<p>That means that we’re ready to implement the only thing that really matters: <code>AbstractMCMC.step</code>.</p>
<p><code>AbstractMCMC.step</code> defines the MCMC iteration of our <code>MALA</code> given the current <code>MALAState</code>. Specifically, the signature of the function is as follows:</p>
<div id="18" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The RNG to ensure reproducibility.</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The model that defines our target.</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.AbstractModel</span>,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The sampler for which we're taking a `step`.</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">AbstractMCMC.AbstractSampler</span>,</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The current sampler `state`.</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    state;</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Additional keyword arguments that we may or may not need.</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Moreover, there is a specific <code>AbstractMCMC.AbstractModel</code> which is used to indicate that the model that is provided implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface: <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Since, as we discussed earlier, in our case we’re indeed going to work with types that support the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, we’ll define <code>AbstractMCMC.step</code> for such a <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Note that <code>AbstractMCMC.LogDensityModel</code> has no other purpose; it has a single field called <code>logdensity</code>, and it does nothing else. But by wrapping the model in <code>AbstractMCMC.LogDensityModel</code>, it allows samplers that want to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> to define their <code>AbstractMCMC.step</code> on this type without running into method ambiguities.</p>
<p>All in all, that means that the signature for our <code>AbstractMCMC.step</code> is going to be the following:</p>
<div id="20" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># `LogDensityModel` so we know we're working with LogDensityProblems.jl model.</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler.</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler state.</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Great! Now let’s actually implement the full <code>AbstractMCMC.step</code> for our <code>MALA</code>.</p>
<p>Let’s remind ourselves what we’re going to do:</p>
<ol type="1">
<li>Sample a new momentum <span class="math inline">\(p\)</span>.</li>
<li>Compute the log-density of the extended target <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>Take a single leapfrog step <span class="math inline">\((\tilde{x}, \tilde{p}) = L_{\epsilon}(x, p)\)</span>.</li>
<li>Accept or reject the proposed <span class="math inline">\((\tilde{x}, \tilde{p})\)</span>.</li>
</ol>
<p>All in all, this results in the following:</p>
<div id="22" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>: Random</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Distributions</span>  <span class="co"># so we get the `MvNormal`</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the wrapped model which implements LogDensityProblems.jl.</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just extract the sampler parameters to make our lives easier.</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    ϵ <span class="op">=</span> sampler.ϵ_init</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    M <span class="op">=</span> sampler.M_init</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the current parameters.</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> state.x</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sample the momentum.</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>    p_dist <span class="op">=</span> <span class="fu">MvNormal</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)), M)</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> <span class="fu">rand</span>(rng, p_dist)</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Propose using a single leapfrog step.</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>    x̃, p̃ <span class="op">=</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Accept or reject proposal.</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>    logp <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p)</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>    logp̃ <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x̃) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p̃)</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>    logα <span class="op">=</span> logp̃ <span class="op">-</span> logp</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>    state_new <span class="op">=</span> <span class="cf">if</span> <span class="fu">log</span>(<span class="fu">rand</span>(rng)) <span class="op">&lt;</span> logα</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Accept.</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x̃)</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Reject.</span></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x)</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return the "sample" and the sampler state.</span></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(state_new.x), state_new</span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Fairly straight-forward.</p>
<p>Of course, we haven’t defined the <code>leapfrog_step</code> method yet, so let’s do that:</p>
<div id="24" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p` using "position" `x`.</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x))</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    p1 <span class="op">=</span> p <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update the "position" `x` using momentum `p1`.</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    x̃ <span class="op">=</span> x <span class="op">+</span> ϵ <span class="op">.*</span> (M <span class="op">\</span> p1)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p1` using position `x̃`</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x̃ <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x̃))</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    p2 <span class="op">=</span> p1 <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x̃</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Flip momentum `p2`.</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    p̃ <span class="op">=</span> <span class="op">-</span>p2</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x̃, p̃</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>leapfrog_step (generic function with 1 method)</code></pre>
</div>
</div>
<p>With all of this, we’re technically ready to sample!</p>
<div id="26" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>, <span class="bu">LinearAlgebra</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>rng <span class="op">=</span> <span class="bu">Random</span>.<span class="fu">default_rng</span>()</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>sampler <span class="op">=</span> <span class="fu">MALA</span>(<span class="fl">1</span>, I)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>state <span class="op">=</span> <span class="fu">MALAState</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)))</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>x_next, state_next <span class="op">=</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    rng,</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    AbstractMCMC.<span class="fu">LogDensityModel</span>(model),</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    state</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>(MALASample{Vector{Float64}}([-1.270621481812781, 0.6699287453025501, 0.1565272822155228]), MALAState{Vector{Float64}}([-1.270621481812781, 0.6699287453025501, 0.1565272822155228]))</code></pre>
</div>
</div>
<p>Great, it works!</p>
<p>And I promised we would get quite some functionality for free if we implemented <code>AbstractMCMC.step</code>, and so we can now simply call <code>sample</code> to perform standard MCMC sampling:</p>
<div id="28" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform 1000 iterations with our `MALA` sampler.</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; initial_state<span class="op">=</span>state, progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Concatenate into a matrix.</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000 Matrix{Float64}:
 -2.0596    -6.2472   -5.8747   -4.40313  …  -5.04622  -5.0811    -4.72194
  0.655327  -1.58775  -1.31059  -1.91741      1.66632  -0.920784  -0.814119
  2.91367    3.82113   3.34893   2.91008      4.98994   5.05034    5.21824</code></pre>
</div>
</div>
<div id="30" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the marginal means and standard deviations.</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -4.96953    1.00675
 -0.0125145  0.994771
  4.9968     0.989009</code></pre>
</div>
</div>
<p>Let’s visualize the samples</p>
<div id="32" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">StatsPlots</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">transpose</span>(samples_matrix[<span class="op">:</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">:</span><span class="kw">end</span>]), alpha<span class="op">=</span><span class="fl">0.5</span>, legend<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<!--?xml version="1.0" encoding="utf-8"?-->
<svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" width="672" height="480" viewbox="0 0 2688 1920">
<defs>
  <clippath id="clip280">
    <rect x="0" y="0" width="2688" height="1920"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip280)" d="M0 1920 L2688 1920 L2688 0 L0 0  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip281">
    <rect x="537" y="0" width="1883" height="1883"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip280)" d="M151.747 1800.78 L2640.76 1800.78 L2640.76 47.2441 L151.747 47.2441  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip282">
    <rect x="151" y="47" width="2490" height="1755"></rect>
  </clippath>
</defs>
<polyline clip-path="url(#clip282)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="219.84,1800.78 219.84,47.2441 "></polyline>
<polyline clip-path="url(#clip282)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="807.458,1800.78 807.458,47.2441 "></polyline>
<polyline clip-path="url(#clip282)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1395.08,1800.78 1395.08,47.2441 "></polyline>
<polyline clip-path="url(#clip282)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1982.69,1800.78 1982.69,47.2441 "></polyline>
<polyline clip-path="url(#clip282)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="2570.31,1800.78 2570.31,47.2441 "></polyline>
<polyline clip-path="url(#clip282)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,1553.53 2640.76,1553.53 "></polyline>
<polyline clip-path="url(#clip282)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,1243.47 2640.76,1243.47 "></polyline>
<polyline clip-path="url(#clip282)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,933.415 2640.76,933.415 "></polyline>
<polyline clip-path="url(#clip282)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,623.355 2640.76,623.355 "></polyline>
<polyline clip-path="url(#clip282)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,313.295 2640.76,313.295 "></polyline>
<polyline clip-path="url(#clip280)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1800.78 2640.76,1800.78 "></polyline>
<polyline clip-path="url(#clip280)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="219.84,1800.78 219.84,1781.88 "></polyline>
<polyline clip-path="url(#clip280)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="807.458,1800.78 807.458,1781.88 "></polyline>
<polyline clip-path="url(#clip280)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1395.08,1800.78 1395.08,1781.88 "></polyline>
<polyline clip-path="url(#clip280)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1982.69,1800.78 1982.69,1781.88 "></polyline>
<polyline clip-path="url(#clip280)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="2570.31,1800.78 2570.31,1781.88 "></polyline>
<path clip-path="url(#clip280)" d="M219.84 1834 Q216.229 1834 214.4 1837.57 Q212.595 1841.11 212.595 1848.24 Q212.595 1855.34 214.4 1858.91 Q216.229 1862.45 219.84 1862.45 Q223.474 1862.45 225.28 1858.91 Q227.108 1855.34 227.108 1848.24 Q227.108 1841.11 225.28 1837.57 Q223.474 1834 219.84 1834 M219.84 1830.3 Q225.65 1830.3 228.706 1834.9 Q231.784 1839.49 231.784 1848.24 Q231.784 1856.96 228.706 1861.57 Q225.65 1866.15 219.84 1866.15 Q214.03 1866.15 210.951 1861.57 Q207.896 1856.96 207.896 1848.24 Q207.896 1839.49 210.951 1834.9 Q214.03 1830.3 219.84 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip280)" d="M771.15 1861.55 L787.47 1861.55 L787.47 1865.48 L765.525 1865.48 L765.525 1861.55 Q768.187 1858.79 772.771 1854.16 Q777.377 1849.51 778.558 1848.17 Q780.803 1845.65 781.683 1843.91 Q782.585 1842.15 782.585 1840.46 Q782.585 1837.71 780.641 1835.97 Q778.72 1834.23 775.618 1834.23 Q773.419 1834.23 770.965 1835 Q768.535 1835.76 765.757 1837.31 L765.757 1832.59 Q768.581 1831.46 771.035 1830.88 Q773.488 1830.3 775.525 1830.3 Q780.896 1830.3 784.09 1832.98 Q787.285 1835.67 787.285 1840.16 Q787.285 1842.29 786.474 1844.21 Q785.687 1846.11 783.581 1848.7 Q783.002 1849.37 779.9 1852.59 Q776.798 1855.78 771.15 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip280)" d="M797.331 1830.92 L815.687 1830.92 L815.687 1834.86 L801.613 1834.86 L801.613 1843.33 Q802.632 1842.98 803.65 1842.82 Q804.669 1842.64 805.687 1842.64 Q811.474 1842.64 814.854 1845.81 Q818.233 1848.98 818.233 1854.4 Q818.233 1859.97 814.761 1863.08 Q811.289 1866.15 804.97 1866.15 Q802.794 1866.15 800.525 1865.78 Q798.28 1865.41 795.872 1864.67 L795.872 1859.97 Q797.956 1861.11 800.178 1861.66 Q802.4 1862.22 804.877 1862.22 Q808.882 1862.22 811.22 1860.11 Q813.558 1858.01 813.558 1854.4 Q813.558 1850.78 811.22 1848.68 Q808.882 1846.57 804.877 1846.57 Q803.002 1846.57 801.127 1846.99 Q799.275 1847.4 797.331 1848.28 L797.331 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip280)" d="M837.446 1834 Q833.835 1834 832.007 1837.57 Q830.201 1841.11 830.201 1848.24 Q830.201 1855.34 832.007 1858.91 Q833.835 1862.45 837.446 1862.45 Q841.081 1862.45 842.886 1858.91 Q844.715 1855.34 844.715 1848.24 Q844.715 1841.11 842.886 1837.57 Q841.081 1834 837.446 1834 M837.446 1830.3 Q843.256 1830.3 846.312 1834.9 Q849.391 1839.49 849.391 1848.24 Q849.391 1856.96 846.312 1861.57 Q843.256 1866.15 837.446 1866.15 Q831.636 1866.15 828.557 1861.57 Q825.502 1856.96 825.502 1848.24 Q825.502 1839.49 828.557 1834.9 Q831.636 1830.3 837.446 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip280)" d="M1354.69 1830.92 L1373.05 1830.92 L1373.05 1834.86 L1358.98 1834.86 L1358.98 1843.33 Q1360 1842.98 1361.01 1842.82 Q1362.03 1842.64 1363.05 1842.64 Q1368.84 1842.64 1372.22 1845.81 Q1375.6 1848.98 1375.6 1854.4 Q1375.6 1859.97 1372.12 1863.08 Q1368.65 1866.15 1362.33 1866.15 Q1360.16 1866.15 1357.89 1865.78 Q1355.64 1865.41 1353.24 1864.67 L1353.24 1859.97 Q1355.32 1861.11 1357.54 1861.66 Q1359.76 1862.22 1362.24 1862.22 Q1366.25 1862.22 1368.58 1860.11 Q1370.92 1858.01 1370.92 1854.4 Q1370.92 1850.78 1368.58 1848.68 Q1366.25 1846.57 1362.24 1846.57 Q1360.37 1846.57 1358.49 1846.99 Q1356.64 1847.4 1354.69 1848.28 L1354.69 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip280)" d="M1394.81 1834 Q1391.2 1834 1389.37 1837.57 Q1387.56 1841.11 1387.56 1848.24 Q1387.56 1855.34 1389.37 1858.91 Q1391.2 1862.45 1394.81 1862.45 Q1398.44 1862.45 1400.25 1858.91 Q1402.08 1855.34 1402.08 1848.24 Q1402.08 1841.11 1400.25 1837.57 Q1398.44 1834 1394.81 1834 M1394.81 1830.3 Q1400.62 1830.3 1403.68 1834.9 Q1406.75 1839.49 1406.75 1848.24 Q1406.75 1856.96 1403.68 1861.57 Q1400.62 1866.15 1394.81 1866.15 Q1389 1866.15 1385.92 1861.57 Q1382.87 1856.96 1382.87 1848.24 Q1382.87 1839.49 1385.92 1834.9 Q1389 1830.3 1394.81 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip280)" d="M1424.97 1834 Q1421.36 1834 1419.53 1837.57 Q1417.73 1841.11 1417.73 1848.24 Q1417.73 1855.34 1419.53 1858.91 Q1421.36 1862.45 1424.97 1862.45 Q1428.61 1862.45 1430.41 1858.91 Q1432.24 1855.34 1432.24 1848.24 Q1432.24 1841.11 1430.41 1837.57 Q1428.61 1834 1424.97 1834 M1424.97 1830.3 Q1430.78 1830.3 1433.84 1834.9 Q1436.92 1839.49 1436.92 1848.24 Q1436.92 1856.96 1433.84 1861.57 Q1430.78 1866.15 1424.97 1866.15 Q1419.16 1866.15 1416.08 1861.57 Q1413.03 1856.96 1413.03 1848.24 Q1413.03 1839.49 1416.08 1834.9 Q1419.16 1830.3 1424.97 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip280)" d="M1940.97 1830.92 L1963.19 1830.92 L1963.19 1832.91 L1950.65 1865.48 L1945.76 1865.48 L1957.57 1834.86 L1940.97 1834.86 L1940.97 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip280)" d="M1972.36 1830.92 L1990.71 1830.92 L1990.71 1834.86 L1976.64 1834.86 L1976.64 1843.33 Q1977.66 1842.98 1978.68 1842.82 Q1979.7 1842.64 1980.72 1842.64 Q1986.5 1842.64 1989.88 1845.81 Q1993.26 1848.98 1993.26 1854.4 Q1993.26 1859.97 1989.79 1863.08 Q1986.32 1866.15 1980 1866.15 Q1977.82 1866.15 1975.55 1865.78 Q1973.31 1865.41 1970.9 1864.67 L1970.9 1859.97 Q1972.98 1861.11 1975.21 1861.66 Q1977.43 1862.22 1979.9 1862.22 Q1983.91 1862.22 1986.25 1860.11 Q1988.59 1858.01 1988.59 1854.4 Q1988.59 1850.78 1986.25 1848.68 Q1983.91 1846.57 1979.9 1846.57 Q1978.03 1846.57 1976.15 1846.99 Q1974.3 1847.4 1972.36 1848.28 L1972.36 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip280)" d="M2012.47 1834 Q2008.86 1834 2007.03 1837.57 Q2005.23 1841.11 2005.23 1848.24 Q2005.23 1855.34 2007.03 1858.91 Q2008.86 1862.45 2012.47 1862.45 Q2016.11 1862.45 2017.91 1858.91 Q2019.74 1855.34 2019.74 1848.24 Q2019.74 1841.11 2017.91 1837.57 Q2016.11 1834 2012.47 1834 M2012.47 1830.3 Q2018.28 1830.3 2021.34 1834.9 Q2024.42 1839.49 2024.42 1848.24 Q2024.42 1856.96 2021.34 1861.57 Q2018.28 1866.15 2012.47 1866.15 Q2006.66 1866.15 2003.59 1861.57 Q2000.53 1856.96 2000.53 1848.24 Q2000.53 1839.49 2003.59 1834.9 Q2006.66 1830.3 2012.47 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip280)" d="M2514.84 1861.55 L2522.48 1861.55 L2522.48 1835.18 L2514.17 1836.85 L2514.17 1832.59 L2522.43 1830.92 L2527.11 1830.92 L2527.11 1861.55 L2534.75 1861.55 L2534.75 1865.48 L2514.84 1865.48 L2514.84 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip280)" d="M2554.19 1834 Q2550.58 1834 2548.75 1837.57 Q2546.94 1841.11 2546.94 1848.24 Q2546.94 1855.34 2548.75 1858.91 Q2550.58 1862.45 2554.19 1862.45 Q2557.82 1862.45 2559.63 1858.91 Q2561.46 1855.34 2561.46 1848.24 Q2561.46 1841.11 2559.63 1837.57 Q2557.82 1834 2554.19 1834 M2554.19 1830.3 Q2560 1830.3 2563.06 1834.9 Q2566.13 1839.49 2566.13 1848.24 Q2566.13 1856.96 2563.06 1861.57 Q2560 1866.15 2554.19 1866.15 Q2548.38 1866.15 2545.3 1861.57 Q2542.25 1856.96 2542.25 1848.24 Q2542.25 1839.49 2545.3 1834.9 Q2548.38 1830.3 2554.19 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip280)" d="M2584.35 1834 Q2580.74 1834 2578.91 1837.57 Q2577.11 1841.11 2577.11 1848.24 Q2577.11 1855.34 2578.91 1858.91 Q2580.74 1862.45 2584.35 1862.45 Q2587.99 1862.45 2589.79 1858.91 Q2591.62 1855.34 2591.62 1848.24 Q2591.62 1841.11 2589.79 1837.57 Q2587.99 1834 2584.35 1834 M2584.35 1830.3 Q2590.16 1830.3 2593.22 1834.9 Q2596.3 1839.49 2596.3 1848.24 Q2596.3 1856.96 2593.22 1861.57 Q2590.16 1866.15 2584.35 1866.15 Q2578.54 1866.15 2575.46 1861.57 Q2572.41 1856.96 2572.41 1848.24 Q2572.41 1839.49 2575.46 1834.9 Q2578.54 1830.3 2584.35 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip280)" d="M2614.51 1834 Q2610.9 1834 2609.07 1837.57 Q2607.27 1841.11 2607.27 1848.24 Q2607.27 1855.34 2609.07 1858.91 Q2610.9 1862.45 2614.51 1862.45 Q2618.15 1862.45 2619.95 1858.91 Q2621.78 1855.34 2621.78 1848.24 Q2621.78 1841.11 2619.95 1837.57 Q2618.15 1834 2614.51 1834 M2614.51 1830.3 Q2620.32 1830.3 2623.38 1834.9 Q2626.46 1839.49 2626.46 1848.24 Q2626.46 1856.96 2623.38 1861.57 Q2620.32 1866.15 2614.51 1866.15 Q2608.7 1866.15 2605.62 1861.57 Q2602.57 1856.96 2602.57 1848.24 Q2602.57 1839.49 2605.62 1834.9 Q2608.7 1830.3 2614.51 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip280)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1800.78 151.747,47.2441 "></polyline>
<polyline clip-path="url(#clip280)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1553.53 170.644,1553.53 "></polyline>
<polyline clip-path="url(#clip280)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1243.47 170.644,1243.47 "></polyline>
<polyline clip-path="url(#clip280)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,933.415 170.644,933.415 "></polyline>
<polyline clip-path="url(#clip280)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,623.355 170.644,623.355 "></polyline>
<polyline clip-path="url(#clip280)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,313.295 170.644,313.295 "></polyline>
<path clip-path="url(#clip280)" d="M49.5521 1553.99 L79.2279 1553.99 L79.2279 1557.92 L49.5521 1557.92 L49.5521 1553.99 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip280)" d="M99.8991 1551.67 Q96.7509 1551.67 94.8991 1553.82 Q93.0704 1555.98 93.0704 1559.73 Q93.0704 1563.45 94.8991 1565.63 Q96.7509 1567.78 99.8991 1567.78 Q103.047 1567.78 104.876 1565.63 Q106.728 1563.45 106.728 1559.73 Q106.728 1555.98 104.876 1553.82 Q103.047 1551.67 99.8991 1551.67 M109.181 1537.02 L109.181 1541.28 Q107.422 1540.44 105.617 1540 Q103.834 1539.56 102.075 1539.56 Q97.4454 1539.56 94.9917 1542.69 Q92.5612 1545.81 92.2139 1552.13 Q93.5797 1550.12 95.6398 1549.06 Q97.7 1547.97 100.177 1547.97 Q105.385 1547.97 108.394 1551.14 Q111.427 1554.29 111.427 1559.73 Q111.427 1565.05 108.279 1568.27 Q105.131 1571.49 99.8991 1571.49 Q93.9037 1571.49 90.7325 1566.9 Q87.5612 1562.3 87.5612 1553.57 Q87.5612 1545.37 91.45 1540.51 Q95.3389 1535.63 101.89 1535.63 Q103.649 1535.63 105.431 1535.98 Q107.237 1536.32 109.181 1537.02 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip280)" d="M50.3623 1243.93 L80.0381 1243.93 L80.0381 1247.86 L50.3623 1247.86 L50.3623 1243.93 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip280)" d="M104.297 1242.12 Q107.654 1242.84 109.529 1245.11 Q111.427 1247.37 111.427 1250.71 Q111.427 1255.82 107.908 1258.62 Q104.39 1261.43 97.9083 1261.43 Q95.7324 1261.43 93.4176 1260.99 Q91.126 1260.57 88.6723 1259.71 L88.6723 1255.2 Q90.6167 1256.33 92.9315 1256.91 Q95.2463 1257.49 97.7695 1257.49 Q102.168 1257.49 104.459 1255.75 Q106.774 1254.02 106.774 1250.71 Q106.774 1247.65 104.621 1245.94 Q102.492 1244.2 98.6722 1244.2 L94.6445 1244.2 L94.6445 1240.36 L98.8574 1240.36 Q102.306 1240.36 104.135 1239 Q105.964 1237.61 105.964 1235.01 Q105.964 1232.35 104.066 1230.94 Q102.191 1229.5 98.6722 1229.5 Q96.7509 1229.5 94.5519 1229.92 Q92.3528 1230.34 89.7139 1231.22 L89.7139 1227.05 Q92.376 1226.31 94.6908 1225.94 Q97.0287 1225.57 99.0889 1225.57 Q104.413 1225.57 107.515 1228 Q110.617 1230.41 110.617 1234.53 Q110.617 1237.4 108.973 1239.39 Q107.33 1241.36 104.297 1242.12 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip280)" d="M99.4824 919.213 Q95.8713 919.213 94.0426 922.778 Q92.2371 926.32 92.2371 933.449 Q92.2371 940.556 94.0426 944.121 Q95.8713 947.662 99.4824 947.662 Q103.117 947.662 104.922 944.121 Q106.751 940.556 106.751 933.449 Q106.751 926.32 104.922 922.778 Q103.117 919.213 99.4824 919.213 M99.4824 915.51 Q105.293 915.51 108.348 920.116 Q111.427 924.699 111.427 933.449 Q111.427 942.176 108.348 946.783 Q105.293 951.366 99.4824 951.366 Q93.6723 951.366 90.5936 946.783 Q87.538 942.176 87.538 933.449 Q87.538 924.699 90.5936 920.116 Q93.6723 915.51 99.4824 915.51 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip280)" d="M104.297 622.001 Q107.654 622.718 109.529 624.987 Q111.427 627.255 111.427 630.589 Q111.427 635.704 107.908 638.505 Q104.39 641.306 97.9083 641.306 Q95.7324 641.306 93.4176 640.866 Q91.126 640.45 88.6723 639.593 L88.6723 635.079 Q90.6167 636.214 92.9315 636.792 Q95.2463 637.371 97.7695 637.371 Q102.168 637.371 104.459 635.635 Q106.774 633.899 106.774 630.589 Q106.774 627.533 104.621 625.82 Q102.492 624.084 98.6722 624.084 L94.6445 624.084 L94.6445 620.241 L98.8574 620.241 Q102.306 620.241 104.135 618.876 Q105.964 617.487 105.964 614.894 Q105.964 612.232 104.066 610.82 Q102.191 609.385 98.6722 609.385 Q96.7509 609.385 94.5519 609.802 Q92.3528 610.218 89.7139 611.098 L89.7139 606.931 Q92.376 606.191 94.6908 605.82 Q97.0287 605.45 99.0889 605.45 Q104.413 605.45 107.515 607.88 Q110.617 610.288 110.617 614.408 Q110.617 617.279 108.973 619.269 Q107.33 621.237 104.297 622.001 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip280)" d="M99.8991 311.432 Q96.7509 311.432 94.8991 313.584 Q93.0704 315.737 93.0704 319.487 Q93.0704 323.214 94.8991 325.39 Q96.7509 327.543 99.8991 327.543 Q103.047 327.543 104.876 325.39 Q106.728 323.214 106.728 319.487 Q106.728 315.737 104.876 313.584 Q103.047 311.432 99.8991 311.432 M109.181 296.779 L109.181 301.038 Q107.422 300.205 105.617 299.765 Q103.834 299.325 102.075 299.325 Q97.4454 299.325 94.9917 302.45 Q92.5612 305.575 92.2139 311.895 Q93.5797 309.881 95.6398 308.816 Q97.7 307.728 100.177 307.728 Q105.385 307.728 108.394 310.899 Q111.427 314.047 111.427 319.487 Q111.427 324.811 108.279 328.029 Q105.131 331.246 99.8991 331.246 Q93.9037 331.246 90.7325 326.663 Q87.5612 322.057 87.5612 313.33 Q87.5612 305.135 91.45 300.274 Q95.3389 295.39 101.89 295.39 Q103.649 295.39 105.431 295.737 Q107.237 296.085 109.181 296.779 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip282)" style="stroke:#009af9; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,1146.28 224.541,1597.91 226.891,1455.17 229.242,1278.82 231.592,1406.04 233.943,1604.01 236.293,1314.06 238.644,1356.21 240.994,1609.79 243.345,1516.95 245.695,1561.14 248.046,1536.3 250.396,1487.55 252.747,1440.54 255.097,1432.63 257.448,1302.35 259.798,1347.99 262.148,1410.86 264.499,1526.62 266.849,1491.29 269.2,1507.97 271.55,1410.23 273.901,1323.62 276.251,1357.66 278.602,1377.66 280.952,1521.17 283.303,1544.16 285.653,1608.59 288.004,1488.02 290.354,1376.36 292.705,1493.42 295.055,1524.62 297.406,1496.3 299.756,1370.72 302.107,1346.02 304.457,1479.74 306.807,1391.98 309.158,1376.95 311.508,1607.93 313.859,1477.77 316.209,1490.18 318.56,1532.36 320.91,1553.49 323.261,1399.79 325.611,1536.62 327.962,1438.29 330.312,1602.75 332.663,1363.27 335.013,1415.86 337.364,1478.56 339.714,1416.03 342.065,1350.92 344.415,1435.75 346.765,1505.67 349.116,1515.32 351.466,1557.05 353.817,1303.25 356.167,1617.89 358.518,1568.61 360.868,1610.64 363.219,1325.81 365.569,1426.87 367.92,1324.41 370.27,1375.01 372.621,1587.7 374.971,1475.68 377.322,1414.19 379.672,1505.29 382.023,1453.33 384.373,1343.52 386.724,1593.57 389.074,1405.64 391.424,1555.97 393.775,1388.55 396.125,1389.68 398.476,1231.87 400.826,1605.8 403.177,1583.27 405.527,1315.72 407.878,1393.94 410.228,1540.49 412.579,1271.95 414.929,1548.57 417.28,1307.09 419.63,1469.13 421.981,1507.65 424.331,1622.94 426.682,1707.3 429.032,1372.3 431.382,1538.06 433.733,1308.76 436.083,1528.96 438.434,1387.97 440.784,1400.65 443.135,1470.1 445.485,1419.57 447.836,1124.41 450.186,1457.66 452.537,1492.18 454.887,1429.62 457.238,1326.13 459.588,1471.99 461.939,1513.92 464.289,1374.33 466.64,1469.29 468.99,1518.07 471.341,1621.2 473.691,1400.43 476.041,1480.06 478.392,1619.86 480.742,1558.44 483.093,1468.66 485.443,1469.28 487.794,1439.19 490.144,1407.69 492.495,1452.09 494.845,1532.11 497.196,1407.75 499.546,1242.35 501.897,1335.47 504.247,1377.83 506.598,1536.52 508.948,1259.34 511.299,1323.12 513.649,1397.47 515.999,1473.62 518.35,1336.6 520.7,1450.94 523.051,1469.77 525.401,1491.45 527.752,1344.45 530.102,1382.92 532.453,1469.02 534.803,1588.4 537.154,1653.24 539.504,1468.55 541.855,1559.38 544.205,1315 546.556,1498.36 548.906,1382.18 551.257,1513.54 553.607,1247.4 555.958,1459.66 558.308,1471.89 560.658,1594.89 563.009,1362.99 565.359,1388.72 567.71,1429.49 570.06,1555.17 572.411,1219.98 574.761,1478.78 577.112,1594.11 579.462,1409.14 581.813,1545.92 584.163,1442.83 586.514,1462.17 588.864,1426.22 591.215,1352.73 593.565,1396.18 595.916,1505.66 598.266,1377.68 600.616,1545.29 602.967,1553.11 605.317,1575.91 607.668,1406.45 610.018,1591.37 612.369,1382.57 614.719,1669.22 617.07,1482.3 619.42,1516.13 621.771,1662.29 624.121,1416.17 626.472,1653.03 628.822,1432.27 631.173,1517.65 633.523,1400.36 635.874,1444.11 638.224,1479.4 640.575,1517.9 642.925,1303.16 645.275,1384.96 647.626,1701.85 649.976,1558.59 652.327,1470.66 654.677,1348.49 657.028,1344.08 659.378,1524.01 661.729,1394.79 664.079,1471.19 666.43,1319.84 668.78,1413.73 671.131,1542.39 673.481,1574.11 675.832,1426.58 678.182,1466.45 680.533,1632.63 682.883,1352.12 685.233,1454.34 687.584,1424.56 689.934,1218.33 692.285,1267.33 694.635,1521.34 696.986,1521.62 699.336,1437.02 701.687,1354.66 704.037,1362.09 706.388,1324.67 708.738,1529.69 711.089,1526.62 713.439,1447.29 715.79,1379.9 718.14,1529.13 720.491,1349.76 722.841,1414.98 725.192,1313.64 727.542,1286.96 729.892,1411.17 732.243,1427.22 734.593,1606.75 736.944,1621.52 739.294,1510.09 741.645,1709.68 743.995,1545.22 746.346,1445.75 748.696,1463.78 751.047,1569.25 753.397,1371.29 755.748,1505.46 758.098,1587.17 760.449,1502.34 762.799,1449.85 765.15,1432.62 767.5,1397.12 769.85,1503.23 772.201,1331.39 774.551,1479.92 776.902,1540.22 779.252,1426.52 781.603,1608.92 783.953,1501.47 786.304,1499.58 788.654,1557.65 791.005,1353.88 793.355,1407.18 795.706,1548 798.056,1539.73 800.407,1360.54 802.757,1522.24 805.108,1438.34 807.458,1460.49 809.809,1295.01 812.159,1453.95 814.509,1369.25 816.86,1401.21 819.21,1380.8 821.561,1663.33 823.911,1395.8 826.262,1458.87 828.612,1564.34 830.963,1419.62 833.313,1552.15 835.664,1384.28 838.014,1564.48 840.365,1328.42 842.715,1362.82 845.066,1643.18 847.416,1321.36 849.767,1427.42 852.117,1389.76 854.467,1397.11 856.818,1328.25 859.168,1318.67 861.519,1487.16 863.869,1434.2 866.22,1459.53 868.57,1624.97 870.921,1443.99 873.271,1450.85 875.622,1480.94 877.972,1506.67 880.323,1365.27 882.673,1485.59 885.024,1553.35 887.374,1386.06 889.725,1552.08 892.075,1398.31 894.426,1498.48 896.776,1439.57 899.126,1488.17 901.477,1570.63 903.827,1447.14 906.178,1513.95 908.528,1537.49 910.879,1510.34 913.229,1525.39 915.58,1458.12 917.93,1565.95 920.281,1418.81 922.631,1577.44 924.982,1423.44 927.332,1660.62 929.683,1418.96 932.033,1344.88 934.384,1465.51 936.734,1352.28 939.084,1304.66 941.435,1409.36 943.785,1402.25 946.136,1551.23 948.486,1216.81 950.837,1494.49 953.187,1463.59 955.538,1407.77 957.888,1568.09 960.239,1666.63 962.589,1347.74 964.94,1433.16 967.29,1380.08 969.641,1378.85 971.991,1424.77 974.342,1456.2 976.692,1579.32 979.043,1645.47 981.393,1313.32 983.743,1386.83 986.094,1455.46 988.444,1742.78 990.795,1307.67 993.145,1553.38 995.496,1515.76 997.846,1399.67 1000.2,1458.91 1002.55,1496.33 1004.9,1569.84 1007.25,1260.37 1009.6,1432.58 1011.95,1366.3 1014.3,1489.61 1016.65,1251.94 1019,1558.94 1021.35,1384.38 1023.7,1526.72 1026.05,1565.86 1028.4,1610.7 1030.75,1342.61 1033.1,1559.1 1035.45,1418.75 1037.8,1540.84 1040.15,1356.11 1042.51,1372.29 1044.86,1491.38 1047.21,1437.39 1049.56,1287.16 1051.91,1322.91 1054.26,1536.98 1056.61,1271.09 1058.96,1400.6 1061.31,1552.89 1063.66,1492.1 1066.01,1417.32 1068.36,1479.35 1070.71,1454.82 1073.06,1577.95 1075.41,1454.97 1077.76,1471.16 1080.11,1450.64 1082.46,1517.7 1084.81,1459.9 1087.16,1533.61 1089.51,1457.89 1091.87,1522.95 1094.22,1291.32 1096.57,1437.17 1098.92,1453.08 1101.27,1633.35 1103.62,1351.48 1105.97,1522.4 1108.32,1497.41 1110.67,1478.75 1113.02,1275.51 1115.37,1432.22 1117.72,1443.73 1120.07,1277.13 1122.42,1416.35 1124.77,1436.36 1127.12,1420.4 1129.47,1462.17 1131.82,1447.93 1134.17,1456.61 1136.52,1474.26 1138.87,1414.23 1141.23,1542.39 1143.58,1543.01 1145.93,1457.62 1148.28,1465.52 1150.63,1620.72 1152.98,1487.76 1155.33,1500.85 1157.68,1518.38 1160.03,1259 1162.38,1480.69 1164.73,1453.23 1167.08,1409.09 1169.43,1564.84 1171.78,1435.41 1174.13,1531.88 1176.48,1347.09 1178.83,1299.27 1181.18,1523.72 1183.53,1480.33 1185.88,1606.66 1188.23,1418.47 1190.59,1717.47 1192.94,1400.49 1195.29,1393.03 1197.64,1422.34 1199.99,1508.37 1202.34,1420.56 1204.69,1304.68 1207.04,1377.78 1209.39,1458.39 1211.74,1598.79 1214.09,1274.41 1216.44,1436.22 1218.79,1349.33 1221.14,1611.31 1223.49,1340.15 1225.84,1462.51 1228.19,1206.59 1230.54,1365.35 1232.89,1527.15 1235.24,1439.9 1237.59,1401.4 1239.94,1418.91 1242.3,1216.05 1244.65,1516.74 1247,1349.5 1249.35,1368.72 1251.7,1510.88 1254.05,1421.45 1256.4,1360.05 1258.75,1451.51 1261.1,1617.36 1263.45,1633.31 1265.8,1465.53 1268.15,1407.86 1270.5,1293.96 1272.85,1383.9 1275.2,1491.89 1277.55,1515.43 1279.9,1470.12 1282.25,1381.05 1284.6,1461.87 1286.95,1245.24 1289.3,1535.12 1291.66,1678.45 1294.01,1490.15 1296.36,1331.15 1298.71,1524.63 1301.06,1505.94 1303.41,1361.47 1305.76,1424.3 1308.11,1378.48 1310.46,1571.76 1312.81,1374.98 1315.16,1447.74 1317.51,1561.81 1319.86,1519.57 1322.21,1415.2 1324.56,1410.61 1326.91,1427.47 1329.26,1310.41 1331.61,1428.96 1333.96,1493.87 1336.31,1633.77 1338.66,1437.98 1341.02,1471.14 1343.37,1391.44 1345.72,1669.4 1348.07,1428.92 1350.42,1288.03 1352.77,1383.32 1355.12,1578.39 1357.47,1591.43 1359.82,1310.49 1362.17,1267.38 1364.52,1511.73 1366.87,1566.76 1369.22,1483.32 1371.57,1487.01 1373.92,1389.46 1376.27,1341.19 1378.62,1427.04 1380.97,1378.4 1383.32,1543.81 1385.67,1560.97 1388.02,1236.64 1390.38,1528.08 1392.73,1408.9 1395.08,1280.67 1397.43,1677.96 1399.78,1527.28 1402.13,1280.67 1404.48,1702.92 1406.83,1571.38 1409.18,1595.07 1411.53,1463.21 1413.88,1406.28 1416.23,1507.46 1418.58,1407.75 1420.93,1284.86 1423.28,1547.65 1425.63,1557.98 1427.98,1503.25 1430.33,1420.28 1432.68,1638.91 1435.03,1585.23 1437.38,1481.43 1439.74,1491.47 1442.09,1418.43 1444.44,1455.68 1446.79,1502.25 1449.14,1461.02 1451.49,1595.39 1453.84,1354.56 1456.19,1421.12 1458.54,1485.11 1460.89,1411.85 1463.24,1430.16 1465.59,1492.81 1467.94,1402.46 1470.29,1567.51 1472.64,1486.83 1474.99,1452.37 1477.34,1405.49 1479.69,1389.88 1482.04,1470 1484.39,1589.3 1486.74,1612.44 1489.1,1256.31 1491.45,1499.34 1493.8,1297.28 1496.15,1509.01 1498.5,1680.28 1500.85,1500.1 1503.2,1506.94 1505.55,1384.07 1507.9,1506.05 1510.25,1487.27 1512.6,1328.09 1514.95,1562.62 1517.3,1406.23 1519.65,1444.68 1522,1500.02 1524.35,1258.24 1526.7,1481.27 1529.05,1384.22 1531.4,1573.9 1533.75,1407.94 1536.1,1527.31 1538.45,1384.27 1540.81,1469.28 1543.16,1501.07 1545.51,1483.87 1547.86,1485.83 1550.21,1393.17 1552.56,1485.7 1554.91,1433.33 1557.26,1495.59 1559.61,1318.47 1561.96,1480.78 1564.31,1356.58 1566.66,1282.58 1569.01,1538.55 1571.36,1473.31 1573.71,1235.77 1576.06,1485.87 1578.41,1366.85 1580.76,1384.3 1583.11,1570.67 1585.46,1273.41 1587.81,1379.54 1590.17,1452.63 1592.52,1563.39 1594.87,1462.96 1597.22,1332.1 1599.57,1353.87 1601.92,1507 1604.27,1480.74 1606.62,1668.6 1608.97,1641.87 1611.32,1446.54 1613.67,1392.56 1616.02,1574.5 1618.37,1420.19 1620.72,1385.48 1623.07,1555.58 1625.42,1365.63 1627.77,1324.11 1630.12,1518.84 1632.47,1596.15 1634.82,1546.65 1637.17,1235.13 1639.53,1676.63 1641.88,1421.36 1644.23,1397.87 1646.58,1350.27 1648.93,1462.82 1651.28,1557.43 1653.63,1442.7 1655.98,1315.49 1658.33,1474.55 1660.68,1542.1 1663.03,1435.65 1665.38,1433.16 1667.73,1533.5 1670.08,1459.38 1672.43,1383.56 1674.78,1459.5 1677.13,1308 1679.48,1293.5 1681.83,1515.3 1684.18,1214.39 1686.53,1420.88 1688.89,1349 1691.24,1427.19 1693.59,1439.81 1695.94,1494.06 1698.29,1374.08 1700.64,1203.5 1702.99,1507.97 1705.34,1408.93 1707.69,1256.12 1710.04,1465.48 1712.39,1509.32 1714.74,1578.97 1717.09,1386.14 1719.44,1201.51 1721.79,1441.42 1724.14,1527.42 1726.49,1486.75 1728.84,1626.89 1731.19,1283.61 1733.54,1625.4 1735.89,1296.33 1738.25,1479.12 1740.6,1382.78 1742.95,1424.16 1745.3,1421.37 1747.65,1428.77 1750,1368.84 1752.35,1446.83 1754.7,1218.49 1757.05,1610.7 1759.4,1183.59 1761.75,1509.5 1764.1,1321.93 1766.45,1599.28 1768.8,1433.73 1771.15,1367.75 1773.5,1556.19 1775.85,1460.7 1778.2,1541.74 1780.55,1511.2 1782.9,1453.1 1785.25,1643.09 1787.6,1524.48 1789.96,1550.23 1792.31,1396.03 1794.66,1627.8 1797.01,1405.05 1799.36,1493.03 1801.71,1300.9 1804.06,1442.94 1806.41,1450.05 1808.76,1527.03 1811.11,1178.1 1813.46,1496.9 1815.81,1565.11 1818.16,1493.78 1820.51,1573.95 1822.86,1706.68 1825.21,1582.65 1827.56,1347.3 1829.91,1408.34 1832.26,1489.71 1834.61,1249.47 1836.96,1448.51 1839.32,1378.59 1841.67,1333.45 1844.02,1378.58 1846.37,1502.51 1848.72,1563.27 1851.07,1440.92 1853.42,1555.02 1855.77,1402.96 1858.12,1395.81 1860.47,1352.84 1862.82,1575.63 1865.17,1313.55 1867.52,1458.93 1869.87,1462.06 1872.22,1441.39 1874.57,1500.53 1876.92,1327.56 1879.27,1533.78 1881.62,1452.54 1883.97,1700.16 1886.32,1465.69 1888.68,1579.19 1891.03,1357.82 1893.38,1476.9 1895.73,1421.94 1898.08,1382.32 1900.43,1288.51 1902.78,1320.25 1905.13,1639.45 1907.48,1255.72 1909.83,1345.16 1912.18,1300.58 1914.53,1577.69 1916.88,1346.31 1919.23,1518.32 1921.58,1490.58 1923.93,1483.69 1926.28,1619.6 1928.63,1534.58 1930.98,1388.17 1933.33,1528.74 1935.68,1751.15 1938.04,1724.04 1940.39,1349.82 1942.74,1347.32 1945.09,1451.99 1947.44,1328.97 1949.79,1426.12 1952.14,1339.65 1954.49,1367.44 1956.84,1356.9 1959.19,1478.71 1961.54,1366.51 1963.89,1358.91 1966.24,1497.14 1968.59,1526.07 1970.94,1594.51 1973.29,1395.59 1975.64,1257.23 1977.99,1538.4 1980.34,1523.18 1982.69,1396.4 1985.04,1490.68 1987.4,1637.15 1989.75,1580.28 1992.1,1386.6 1994.45,1459.31 1996.8,1350.13 1999.15,1499.39 2001.5,1385.19 2003.85,1442.7 2006.2,1313.74 2008.55,1509.36 2010.9,1432.93 2013.25,1381.8 2015.6,1380.9 2017.95,1480.81 2020.3,1272.46 2022.65,1317.26 2025,1420.02 2027.35,1608.94 2029.7,1536.9 2032.05,1377.65 2034.4,1471.34 2036.76,1431.61 2039.11,1348.46 2041.46,1349.07 2043.81,1529.41 2046.16,1449.79 2048.51,1521.41 2050.86,1540.47 2053.21,1589.7 2055.56,1431.25 2057.91,1480.66 2060.26,1413.81 2062.61,1536.32 2064.96,1615.66 2067.31,1282.11 2069.66,1436.03 2072.01,1437.24 2074.36,1365.13 2076.71,1408.56 2079.06,1329.4 2081.41,1479.24 2083.76,1276.91 2086.11,1485.18 2088.47,1428.1 2090.82,1462.59 2093.17,1371.28 2095.52,1528.22 2097.87,1422.37 2100.22,1395.07 2102.57,1573.97 2104.92,1343.19 2107.27,1505.56 2109.62,1286.02 2111.97,1492.84 2114.32,1285.58 2116.67,1313.43 2119.02,1378.47 2121.37,1369.2 2123.72,1317.81 2126.07,1713.31 2128.42,1492.21 2130.77,1493.33 2133.12,1403.08 2135.47,1626.4 2137.83,1409.17 2140.18,1371.85 2142.53,1306.25 2144.88,1466.67 2147.23,1539.58 2149.58,1536.63 2151.93,1377.39 2154.28,1364.66 2156.63,1473.42 2158.98,1636.13 2161.33,1261.03 2163.68,1566.33 2166.03,1550.69 2168.38,1479.18 2170.73,1446.95 2173.08,1506.58 2175.43,1316.83 2177.78,1441.23 2180.13,1478.71 2182.48,1400.67 2184.83,1356.43 2187.19,1299.38 2189.54,1254.03 2191.89,1406.56 2194.24,1576.48 2196.59,1590.43 2198.94,1294.65 2201.29,1381.14 2203.64,1295.24 2205.99,1582.14 2208.34,1435.73 2210.69,1464.76 2213.04,1505.74 2215.39,1409.59 2217.74,1582.6 2220.09,1333.48 2222.44,1372.16 2224.79,1509.69 2227.14,1348.49 2229.49,1559.02 2231.84,1602.72 2234.19,1583.48 2236.55,1211.17 2238.9,1582.93 2241.25,1413.9 2243.6,1387.14 2245.95,1390.14 2248.3,1474.45 2250.65,1385.11 2253,1368.9 2255.35,1381.95 2257.7,1501.92 2260.05,1633.25 2262.4,1526.93 2264.75,1688.04 2267.1,1439.56 2269.45,1478.2 2271.8,1428.97 2274.15,1501.05 2276.5,1624.8 2278.85,1336.47 2281.2,1569.35 2283.55,1195.71 2285.91,1521.79 2288.26,1599.7 2290.61,1318.64 2292.96,1492.64 2295.31,1519.82 2297.66,1519.34 2300.01,1440.83 2302.36,1421.69 2304.71,1503.21 2307.06,1298.76 2309.41,1395.94 2311.76,1375.08 2314.11,1362.27 2316.46,1420.32 2318.81,1490.34 2321.16,1447.87 2323.51,1407.13 2325.86,1611.75 2328.21,1578.02 2330.56,1567.3 2332.91,1661.84 2335.27,1636.58 2337.62,1413.8 2339.97,1404.01 2342.32,1317.71 2344.67,1550.34 2347.02,1358.4 2349.37,1320.93 2351.72,1430.32 2354.07,1298.9 2356.42,1575.11 2358.77,1587.58 2361.12,1399.74 2363.47,1556.89 2365.82,1531.32 2368.17,1549.33 2370.52,1332.28 2372.87,1400.27 2375.22,1572.14 2377.57,1432.37 2379.92,1538.62 2382.27,1483.38 2384.62,1597.16 2386.98,1401.22 2389.33,1380.12 2391.68,1596.1 2394.03,1572.92 2396.38,1571.77 2398.73,1423.24 2401.08,1293.27 2403.43,1150.77 2405.78,1348.28 2408.13,1503.73 2410.48,1602.45 2412.83,1491.28 2415.18,1367.35 2417.53,1349.33 2419.88,1506.67 2422.23,1408.74 2424.58,1391.31 2426.93,1311.84 2429.28,1511.43 2431.63,1454.02 2433.98,1421.47 2436.34,1572.86 2438.69,1495.04 2441.04,1485.33 2443.39,1434.78 2445.74,1251.14 2448.09,1160.97 2450.44,1402.25 2452.79,1347.38 2455.14,1519.01 2457.49,1304.84 2459.84,1516.76 2462.19,1638.9 2464.54,1634.3 2466.89,1627.02 2469.24,1291.92 2471.59,1557.93 2473.94,1442 2476.29,1352.57 2478.64,1224.54 2480.99,1306.72 2483.34,1548.15 2485.7,1474 2488.05,1380.38 2490.4,1495.42 2492.75,1362.87 2495.1,1480.66 2497.45,1565.54 2499.8,1495.39 2502.15,1448.15 2504.5,1443.1 2506.85,1443.7 2509.2,1466.03 2511.55,1475.26 2513.9,1527.23 2516.25,1407.03 2518.6,1447.15 2520.95,1425.53 2523.3,1414.69 2525.65,1390.5 2528,1351.04 2530.35,1449.51 2532.7,1336.77 2535.06,1513.48 2537.41,1475.34 2539.76,1408.08 2542.11,1537.88 2544.46,1564.64 2546.81,1323.46 2549.16,1464.41 2551.51,1426.05 2553.86,1396.45 2556.21,1334.36 2558.56,1467.42 2560.91,1544.25 2563.26,1159.52 2565.61,1291.19 2567.96,1557.96 2570.31,1231.52 "></polyline>
<polyline clip-path="url(#clip282)" style="stroke:#e26f46; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,865.684 224.541,995.323 226.891,885.338 229.242,975.219 231.592,1038.66 233.943,1060.77 236.293,847.534 238.644,915.725 240.994,911.16 243.345,812.116 245.695,1160.54 248.046,1085.91 250.396,1054.02 252.747,945.099 255.097,1053.82 257.448,854.951 259.798,992.046 262.148,954.229 264.499,842.366 266.849,1156.96 269.2,817.634 271.55,991.872 273.901,1037.96 276.251,886.576 278.602,1051.57 280.952,1008.42 283.303,792.559 285.653,992.642 288.004,922.355 290.354,1057.17 292.705,896.5 295.055,852.551 297.406,1092.86 299.756,1031.11 302.107,1041.15 304.457,919.19 306.807,998.74 309.158,938.435 311.508,932.233 313.859,965.157 316.209,842.766 318.56,1011.8 320.91,966.555 323.261,874.454 325.611,808.746 327.962,686.037 330.312,976.929 332.663,758.928 335.013,1006.53 337.364,963.406 339.714,834.266 342.065,1077.71 344.415,1150.84 346.765,1006.59 349.116,883.808 351.466,955.168 353.817,1023.02 356.167,963.363 358.518,829.121 360.868,933.098 363.219,1022.65 365.569,1051.1 367.92,869.729 370.27,720.132 372.621,777.811 374.971,889.975 377.322,852.262 379.672,834.609 382.023,783.919 384.373,1010.54 386.724,914.968 389.074,909.771 391.424,875.742 393.775,881.803 396.125,887.997 398.476,1101.53 400.826,1029.02 403.177,956.519 405.527,1161 407.878,786.042 410.228,797.427 412.579,844.353 414.929,1022.64 417.28,1056.86 419.63,1071.01 421.981,876.125 424.331,822.96 426.682,942.735 429.032,1101.2 431.382,895.102 433.733,836.531 436.083,964.194 438.434,989.884 440.784,924.542 443.135,988.398 445.485,993.378 447.836,807.754 450.186,880.375 452.537,966.197 454.887,794.568 457.238,985.266 459.588,942.74 461.939,959.281 464.289,919.111 466.64,988.408 468.99,755.74 471.341,910.501 473.691,912.662 476.041,1075.96 478.392,996.938 480.742,1031.12 483.093,941.855 485.443,1077.47 487.794,763.096 490.144,821.222 492.495,1105.66 494.845,842.588 497.196,800.575 499.546,984.035 501.897,1167.36 504.247,1074.73 506.598,958.348 508.948,818.74 511.299,982.46 513.649,945.023 515.999,817.508 518.35,966.893 520.7,1135.81 523.051,930.248 525.401,815.483 527.752,1016.99 530.102,1077.09 532.453,1077.46 534.803,952.266 537.154,923.794 539.504,915.062 541.855,909.001 544.205,921.51 546.556,1010.68 548.906,1100.93 551.257,1006.33 553.607,938.245 555.958,948.312 558.308,933.357 560.658,877.256 563.009,901.316 565.359,944.012 567.71,821.859 570.06,1008.78 572.411,1092.88 574.761,931.659 577.112,947.081 579.462,918.829 581.813,1059.06 584.163,1113.77 586.514,1020.48 588.864,715.523 591.215,887.092 593.565,1000.85 595.916,1160.25 598.266,884.226 600.616,936.188 602.967,792.701 605.317,993.732 607.668,857.14 610.018,946.698 612.369,1151.4 614.719,893.114 617.07,1008.19 619.42,683.469 621.771,1078.73 624.121,976.327 626.472,1048.42 628.822,997.288 631.173,945.536 633.523,897.674 635.874,988.564 638.224,931.697 640.575,1001.98 642.925,936.656 645.275,930.857 647.626,890.687 649.976,923.563 652.327,896.421 654.677,692.575 657.028,1001.68 659.378,992.767 661.729,907.248 664.079,938.069 666.43,811.153 668.78,902.787 671.131,1008.31 673.481,840.297 675.832,978.077 678.182,912.019 680.533,1014.16 682.883,1020.83 685.233,957.003 687.584,1049.52 689.934,918.628 692.285,821.103 694.635,1043.16 696.986,809.593 699.336,989.902 701.687,1049.29 704.037,965.815 706.388,1021.9 708.738,982.717 711.089,924.846 713.439,902.959 715.79,978.075 718.14,875.746 720.491,984.551 722.841,787.58 725.192,971.843 727.542,978.068 729.892,972.076 732.243,989.683 734.593,1075.41 736.944,1074.86 739.294,746.513 741.645,841.451 743.995,784.863 746.346,885.427 748.696,864.41 751.047,856.627 753.397,1044.58 755.748,887.4 758.098,1028.86 760.449,940.634 762.799,1105.52 765.15,782.306 767.5,932.909 769.85,853.361 772.201,814.824 774.551,1070.1 776.902,1071.9 779.252,1009.2 781.603,1023.79 783.953,859.955 786.304,947.348 788.654,886.402 791.005,1035.05 793.355,1002.74 795.706,803.746 798.056,906.689 800.407,781.673 802.757,1076.41 805.108,941.605 807.458,908.686 809.809,976.497 812.159,778.771 814.509,951.161 816.86,942.064 819.21,871.09 821.561,786.474 823.911,884.696 826.262,812.409 828.612,862.26 830.963,822.389 833.313,903.801 835.664,974.425 838.014,952.472 840.365,874.707 842.715,919.591 845.066,887.319 847.416,626.838 849.767,1010.18 852.117,1039.13 854.467,819.623 856.818,906.658 859.168,996.089 861.519,710.574 863.869,913.113 866.22,893.318 868.57,933.769 870.921,965.025 873.271,915.194 875.622,839.539 877.972,876.104 880.323,941.016 882.673,889.853 885.024,839.502 887.374,960.064 889.725,907.399 892.075,984.455 894.426,839.036 896.776,851.598 899.126,634.88 901.477,943.612 903.827,865.604 906.178,902.747 908.528,1016.75 910.879,942.661 913.229,974.771 915.58,1048.09 917.93,1048.69 920.281,919.994 922.631,871.773 924.982,990.257 927.332,877.455 929.683,855.247 932.033,1015.6 934.384,809.536 936.734,942.343 939.084,1101.53 941.435,881.369 943.785,848.209 946.136,937.572 948.486,977.954 950.837,904.092 953.187,1051.68 955.538,1052.8 957.888,766.73 960.239,965.593 962.589,964.903 964.94,935.988 967.29,811.289 969.641,986.076 971.991,933.808 974.342,835.377 976.692,922.137 979.043,1095.99 981.393,1015.65 983.743,1027.92 986.094,1001.69 988.444,900.498 990.795,898.034 993.145,1007.93 995.496,965.454 997.846,811.692 1000.2,861.669 1002.55,635.428 1004.9,811.631 1007.25,1095.06 1009.6,1072.36 1011.95,1050.62 1014.3,978.797 1016.65,962.233 1019,1049.75 1021.35,933.71 1023.7,981.271 1026.05,994.56 1028.4,1143.71 1030.75,814.798 1033.1,905.735 1035.45,861.894 1037.8,977.492 1040.15,947.601 1042.51,1010.53 1044.86,888.273 1047.21,914.034 1049.56,855.997 1051.91,920.044 1054.26,849.949 1056.61,872.662 1058.96,849.046 1061.31,843.267 1063.66,1009.97 1066.01,1016.1 1068.36,738.209 1070.71,1025.94 1073.06,891.257 1075.41,1035.87 1077.76,649.523 1080.11,998.022 1082.46,857.756 1084.81,935.005 1087.16,1022.73 1089.51,803.742 1091.87,1020.23 1094.22,820.074 1096.57,951.113 1098.92,895.448 1101.27,933.779 1103.62,1042.62 1105.97,995.563 1108.32,1013.71 1110.67,1004.25 1113.02,815.262 1115.37,861.474 1117.72,802.394 1120.07,766.86 1122.42,1086.46 1124.77,1044.39 1127.12,887.376 1129.47,985.931 1131.82,833.236 1134.17,778.596 1136.52,908.042 1138.87,1017.08 1141.23,761.839 1143.58,880.599 1145.93,711.859 1148.28,1063.77 1150.63,897.136 1152.98,768.508 1155.33,1010.1 1157.68,1010.96 1160.03,965.325 1162.38,783.952 1164.73,1010.78 1167.08,958.542 1169.43,898.231 1171.78,892.585 1174.13,879.315 1176.48,864.888 1178.83,688.405 1181.18,1048.26 1183.53,1008.8 1185.88,775.773 1188.23,817.442 1190.59,1036.68 1192.94,932.776 1195.29,1059.12 1197.64,1018.01 1199.99,977.966 1202.34,967.793 1204.69,957.899 1207.04,982.733 1209.39,1117.64 1211.74,1082.54 1214.09,893.796 1216.44,861.302 1218.79,755.85 1221.14,942.899 1223.49,892.546 1225.84,1137.98 1228.19,1087.18 1230.54,1038.7 1232.89,928.235 1235.24,852.939 1237.59,968.527 1239.94,987.355 1242.3,898.543 1244.65,907.783 1247,1001.83 1249.35,902.197 1251.7,980.092 1254.05,903.746 1256.4,795.421 1258.75,954.823 1261.1,997.206 1263.45,988.811 1265.8,928.145 1268.15,921.209 1270.5,945.403 1272.85,803.73 1275.2,800.571 1277.55,1029.85 1279.9,696.714 1282.25,979.447 1284.6,851.111 1286.95,867.719 1289.3,1107.99 1291.66,1062.36 1294.01,1134 1296.36,885.511 1298.71,740.586 1301.06,1056.28 1303.41,1049.31 1305.76,830.593 1308.11,887.365 1310.46,936.228 1312.81,908.812 1315.16,904.97 1317.51,1050.66 1319.86,851.899 1322.21,831.009 1324.56,1081.33 1326.91,841.497 1329.26,1076.89 1331.61,1025.03 1333.96,969.906 1336.31,939.249 1338.66,980.73 1341.02,874.241 1343.37,910.55 1345.72,1047.22 1348.07,990.287 1350.42,990.917 1352.77,945.068 1355.12,813.925 1357.47,904.687 1359.82,901.753 1362.17,888.642 1364.52,853.471 1366.87,990.053 1369.22,924.23 1371.57,925.475 1373.92,834.785 1376.27,759.266 1378.62,976.857 1380.97,934.777 1383.32,977.758 1385.67,851.765 1388.02,1029.85 1390.38,710.415 1392.73,889.522 1395.08,912.835 1397.43,911.497 1399.78,935.24 1402.13,980.137 1404.48,882.512 1406.83,836.198 1409.18,815.95 1411.53,881.382 1413.88,980.676 1416.23,889.146 1418.58,1043.25 1420.93,902.842 1423.28,1128.28 1425.63,806.114 1427.98,939.022 1430.33,710.084 1432.68,1073.67 1435.03,955.342 1437.38,932.666 1439.74,986.605 1442.09,931.204 1444.44,842.032 1446.79,974.699 1449.14,871.614 1451.49,908.254 1453.84,934.169 1456.19,860.855 1458.54,828.21 1460.89,1129.32 1463.24,656.581 1465.59,983.801 1467.94,1010.66 1470.29,964.579 1472.64,857.594 1474.99,1007.93 1477.34,1129.82 1479.69,962.252 1482.04,904.917 1484.39,938.362 1486.74,954.511 1489.1,1004.35 1491.45,1093.55 1493.8,1015.12 1496.15,1140.62 1498.5,886.581 1500.85,1014.35 1503.2,986.955 1505.55,973.555 1507.9,789.224 1510.25,877.766 1512.6,997.755 1514.95,1010.09 1517.3,890.254 1519.65,853.121 1522,874.875 1524.35,1006.49 1526.7,852.246 1529.05,879.361 1531.4,822.356 1533.75,1014.36 1536.1,852.468 1538.45,1019.85 1540.81,965.412 1543.16,885.218 1545.51,1122.69 1547.86,864.275 1550.21,873.571 1552.56,1073.93 1554.91,890.812 1557.26,963.495 1559.61,769.02 1561.96,1071.2 1564.31,1053.86 1566.66,1028.06 1569.01,867.68 1571.36,865.515 1573.71,998.972 1576.06,1095.15 1578.41,907.505 1580.76,1012.01 1583.11,898.229 1585.46,916.296 1587.81,936.884 1590.17,983.371 1592.52,923.621 1594.87,873.984 1597.22,956.629 1599.57,823.431 1601.92,797.752 1604.27,871.07 1606.62,829.144 1608.97,883.154 1611.32,929.053 1613.67,940.427 1616.02,985.234 1618.37,954.652 1620.72,892.749 1623.07,1002.37 1625.42,1045.44 1627.77,992.886 1630.12,1061.65 1632.47,899.422 1634.82,946.262 1637.17,875.072 1639.53,970.705 1641.88,1136.14 1644.23,779.331 1646.58,1103.01 1648.93,897.709 1651.28,1232.64 1653.63,1045.49 1655.98,754.264 1658.33,839.005 1660.68,887.342 1663.03,907.498 1665.38,880.954 1667.73,963.713 1670.08,977.991 1672.43,1005.05 1674.78,884.988 1677.13,894.692 1679.48,936.734 1681.83,1271.58 1684.18,741.418 1686.53,1060.33 1688.89,938.254 1691.24,956.176 1693.59,970.701 1695.94,808.377 1698.29,895.129 1700.64,893.611 1702.99,928.317 1705.34,844.128 1707.69,909.464 1710.04,984.059 1712.39,1204.43 1714.74,907.937 1717.09,792.96 1719.44,879.903 1721.79,863.711 1724.14,906.093 1726.49,1031.17 1728.84,809.529 1731.19,998.217 1733.54,888.971 1735.89,1029.11 1738.25,1057.33 1740.6,857.076 1742.95,1143.71 1745.3,950.42 1747.65,923.456 1750,994.913 1752.35,1000.74 1754.7,953.114 1757.05,925.068 1759.4,1046.77 1761.75,947.174 1764.1,976.756 1766.45,914.94 1768.8,965.063 1771.15,940.122 1773.5,977.196 1775.85,1051.18 1778.2,900.307 1780.55,971.045 1782.9,883.5 1785.25,831.741 1787.6,977.565 1789.96,804.829 1792.31,961.164 1794.66,941.502 1797.01,1057.09 1799.36,877.944 1801.71,966.477 1804.06,838.132 1806.41,1089.48 1808.76,1003.99 1811.11,1004.86 1813.46,926.554 1815.81,1052.56 1818.16,843.539 1820.51,880.23 1822.86,804.743 1825.21,958.199 1827.56,875.042 1829.91,876.207 1832.26,955.479 1834.61,947.355 1836.96,873.037 1839.32,931.434 1841.67,880.726 1844.02,803.52 1846.37,830.78 1848.72,1104.4 1851.07,857.9 1853.42,951.385 1855.77,1105.45 1858.12,846.101 1860.47,1004.26 1862.82,1045.82 1865.17,880.688 1867.52,887.953 1869.87,984.363 1872.22,811.582 1874.57,773.274 1876.92,713.15 1879.27,919.432 1881.62,1086.32 1883.97,932.481 1886.32,954.018 1888.68,768.882 1891.03,919.71 1893.38,907.21 1895.73,954.42 1898.08,1100.86 1900.43,881.432 1902.78,890.569 1905.13,779.215 1907.48,974.414 1909.83,897.349 1912.18,1075.56 1914.53,945.566 1916.88,1011.85 1919.23,784.128 1921.58,923.264 1923.93,955.73 1926.28,1024.12 1928.63,880.307 1930.98,966.83 1933.33,782.156 1935.68,777.445 1938.04,828.137 1940.39,898.844 1942.74,1066.95 1945.09,843.058 1947.44,880.631 1949.79,761.224 1952.14,905.555 1954.49,1097.73 1956.84,914.715 1959.19,841.167 1961.54,1010.09 1963.89,825.549 1966.24,836.195 1968.59,775.135 1970.94,951.187 1973.29,1081.5 1975.64,1057.94 1977.99,843.31 1980.34,1262.04 1982.69,958.341 1985.04,1003.36 1987.4,716.853 1989.75,900.741 1992.1,858.197 1994.45,1029.16 1996.8,1215.65 1999.15,641.358 2001.5,966.928 2003.85,873.72 2006.2,840.417 2008.55,1036.02 2010.9,920.972 2013.25,881.557 2015.6,1175.88 2017.95,835.386 2020.3,691.807 2022.65,857.231 2025,999.314 2027.35,767.091 2029.7,761.61 2032.05,992.987 2034.4,867.92 2036.76,787.868 2039.11,1015.77 2041.46,792.591 2043.81,747.993 2046.16,806.405 2048.51,816.403 2050.86,868.784 2053.21,892.177 2055.56,833.032 2057.91,806.813 2060.26,967.425 2062.61,1032.91 2064.96,1084.44 2067.31,941.213 2069.66,868.818 2072.01,1021.94 2074.36,1040.32 2076.71,882.106 2079.06,856.504 2081.41,847.411 2083.76,860.83 2086.11,842.28 2088.47,803.06 2090.82,825.927 2093.17,899.543 2095.52,808.721 2097.87,786.556 2100.22,1014.2 2102.57,813.035 2104.92,1051.03 2107.27,821.624 2109.62,832.788 2111.97,806.055 2114.32,1016.41 2116.67,816.657 2119.02,925.026 2121.37,1139.18 2123.72,839.008 2126.07,845.787 2128.42,963.124 2130.77,986.635 2133.12,922.374 2135.47,769.811 2137.83,884.664 2140.18,896.398 2142.53,1002.11 2144.88,870.622 2147.23,923.949 2149.58,767.846 2151.93,996.925 2154.28,1009.02 2156.63,859.24 2158.98,1148.98 2161.33,836.788 2163.68,899.115 2166.03,1036.75 2168.38,779.918 2170.73,866.78 2173.08,799.661 2175.43,801.771 2177.78,883.019 2180.13,682.994 2182.48,920.182 2184.83,1090.71 2187.19,894.358 2189.54,844.1 2191.89,835.973 2194.24,804.128 2196.59,893.918 2198.94,985.473 2201.29,846.275 2203.64,658.855 2205.99,984.668 2208.34,898.406 2210.69,1045.31 2213.04,894.475 2215.39,948.436 2217.74,961.933 2220.09,973.614 2222.44,743.427 2224.79,827.645 2227.14,991.493 2229.49,877.335 2231.84,898.172 2234.19,932.043 2236.55,935.489 2238.9,959.567 2241.25,1088.73 2243.6,962.596 2245.95,950.246 2248.3,834.19 2250.65,995.291 2253,875.705 2255.35,926.147 2257.7,763.512 2260.05,921.519 2262.4,777.87 2264.75,907.557 2267.1,982.617 2269.45,800.602 2271.8,1044.88 2274.15,863.808 2276.5,912.891 2278.85,855.821 2281.2,955.116 2283.55,905.535 2285.91,875.404 2288.26,1035.54 2290.61,990.231 2292.96,819.087 2295.31,792.861 2297.66,858.112 2300.01,822.005 2302.36,1039.54 2304.71,826.638 2307.06,791.256 2309.41,936.953 2311.76,934.046 2314.11,886.572 2316.46,1084.06 2318.81,1023.53 2321.16,933.411 2323.51,1065.43 2325.86,970.745 2328.21,894.22 2330.56,915.825 2332.91,898.594 2335.27,892.115 2337.62,1031.01 2339.97,1201.77 2342.32,1003.88 2344.67,1003.82 2347.02,778.469 2349.37,961.226 2351.72,824.928 2354.07,859.662 2356.42,995.262 2358.77,750.332 2361.12,975.906 2363.47,945.338 2365.82,1066.94 2368.17,1003.44 2370.52,1044 2372.87,1015.91 2375.22,1097.34 2377.57,807.401 2379.92,1098.41 2382.27,1106.57 2384.62,997.772 2386.98,1083.51 2389.33,901.794 2391.68,929.206 2394.03,767.195 2396.38,1171.23 2398.73,1129.78 2401.08,717.919 2403.43,720.585 2405.78,919.741 2408.13,946.23 2410.48,851.692 2412.83,763.297 2415.18,909.599 2417.53,906.871 2419.88,1001.53 2422.23,892.42 2424.58,879.007 2426.93,955.949 2429.28,1008.16 2431.63,943.267 2433.98,890.368 2436.34,921.282 2438.69,975.133 2441.04,862.66 2443.39,877.62 2445.74,926.357 2448.09,819.403 2450.44,984.666 2452.79,992.623 2455.14,1001.91 2457.49,933.423 2459.84,806.927 2462.19,1086.8 2464.54,1111.61 2466.89,732.071 2469.24,840.451 2471.59,1047.26 2473.94,980.904 2476.29,819.276 2478.64,927.558 2480.99,978.544 2483.34,905.76 2485.7,865.461 2488.05,834.408 2490.4,980.595 2492.75,1060.23 2495.1,970.063 2497.45,958.075 2499.8,924.463 2502.15,946.33 2504.5,988.196 2506.85,949.09 2509.2,964.506 2511.55,929.877 2513.9,953.762 2516.25,843.465 2518.6,1023.81 2520.95,1032.48 2523.3,862.105 2525.65,903.209 2528,979.498 2530.35,944.814 2532.7,835.734 2535.06,1115.27 2537.41,1074.79 2539.76,984.498 2542.11,827.296 2544.46,899.132 2546.81,968.791 2549.16,1026.17 2551.51,987.963 2553.86,847.702 2556.21,993.605 2558.56,1029.97 2560.91,1029.6 2563.26,828.159 2565.61,741.007 2567.96,1004.71 2570.31,909.871 "></polyline>
<polyline clip-path="url(#clip282)" style="stroke:#3da44d; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,632.277 224.541,403.489 226.891,543.081 229.242,360.303 231.592,345.26 233.943,486.733 236.293,358.401 238.644,384.561 240.994,276.165 243.345,423.746 245.695,372.575 248.046,479.837 250.396,258.244 252.747,469.586 255.097,321.069 257.448,361.598 259.798,446.346 262.148,362.489 264.499,454.875 266.849,427.761 269.2,269.97 271.55,443.731 273.901,268.558 276.251,498.734 278.602,395.405 280.952,321.655 283.303,417.487 285.653,501.88 288.004,336.069 290.354,124.22 292.705,330.401 295.055,472.06 297.406,465.439 299.756,309.85 302.107,411.596 304.457,530.324 306.807,354.307 309.158,433.773 311.508,352.93 313.859,329.779 316.209,578.519 318.56,545.01 320.91,354.695 323.261,377.605 325.611,540.367 327.962,378.625 330.312,319.919 332.663,261.653 335.013,435.089 337.364,309.684 339.714,378.775 342.065,699.104 344.415,565.37 346.765,516.631 349.116,338.161 351.466,391.391 353.817,463.646 356.167,396.151 358.518,489.763 360.868,421.675 363.219,388.084 365.569,481.945 367.92,434.646 370.27,581.993 372.621,499.005 374.971,560.42 377.322,466.985 379.672,342.955 382.023,295.791 384.373,553.052 386.724,344.661 389.074,360.907 391.424,454.189 393.775,473.513 396.125,182.839 398.476,322.735 400.826,445.723 403.177,505.792 405.527,383.971 407.878,363.276 410.228,479.049 412.579,424.038 414.929,433.042 417.28,349.724 419.63,512.598 421.981,421.087 424.331,361.805 426.682,370.564 429.032,389.046 431.382,448.938 433.733,448.846 436.083,376.388 438.434,556.056 440.784,304.247 443.135,391.389 445.485,468.661 447.836,360.414 450.186,335.845 452.537,438.366 454.887,494.507 457.238,411.612 459.588,389.727 461.939,271.372 464.289,338.092 466.64,552.876 468.99,223.25 471.341,504.913 473.691,470.005 476.041,338.68 478.392,324.209 480.742,573.546 483.093,500.197 485.443,458.39 487.794,330.447 490.144,390.494 492.495,314.452 494.845,474.436 497.196,632.468 499.546,328.833 501.897,430.781 504.247,284.63 506.598,291.951 508.948,413.318 511.299,374.628 513.649,497.215 515.999,397.56 518.35,431.318 520.7,328.406 523.051,498.39 525.401,281.779 527.752,622.798 530.102,614.195 532.453,412.642 534.803,438.609 537.154,460.521 539.504,337.642 541.855,492.628 544.205,477.431 546.556,445.681 548.906,413.265 551.257,333.788 553.607,353.756 555.958,601.711 558.308,462.153 560.658,588.433 563.009,258.802 565.359,579.624 567.71,516.237 570.06,416.382 572.411,290.526 574.761,354.874 577.112,258.846 579.462,347.639 581.813,296.781 584.163,403.388 586.514,524.496 588.864,473.281 591.215,475.91 593.565,560.645 595.916,342.723 598.266,505.991 600.616,485.75 602.967,270.488 605.317,323.868 607.668,398.56 610.018,428.612 612.369,735.599 614.719,393.243 617.07,359.176 619.42,441.415 621.771,355.429 624.121,486.551 626.472,433.883 628.822,430.118 631.173,264.209 633.523,412.095 635.874,573.164 638.224,269.611 640.575,383.735 642.925,529.596 645.275,562.653 647.626,302.464 649.976,462.024 652.327,478.276 654.677,567.476 657.028,261.192 659.378,492.251 661.729,603.194 664.079,336.813 666.43,522.449 668.78,311.146 671.131,387.484 673.481,390.852 675.832,381.128 678.182,448.417 680.533,502.7 682.883,392.071 685.233,446.651 687.584,455.132 689.934,386.775 692.285,313.378 694.635,409.176 696.986,373.422 699.336,334.217 701.687,312.938 704.037,487.83 706.388,503.561 708.738,214.551 711.089,431.024 713.439,683.382 715.79,411.72 718.14,450.149 720.491,295.855 722.841,605.258 725.192,309.94 727.542,343.617 729.892,361.205 732.243,279.046 734.593,415.778 736.944,292.385 739.294,316.583 741.645,662.395 743.995,462.126 746.346,343.26 748.696,444.208 751.047,614.086 753.397,471.914 755.748,389.376 758.098,467.807 760.449,406.756 762.799,455.454 765.15,475.713 767.5,333.876 769.85,493.904 772.201,531.655 774.551,387.752 776.902,361.184 779.252,516.863 781.603,269.131 783.953,426.95 786.304,475.581 788.654,449.732 791.005,480.645 793.355,371.753 795.706,518.484 798.056,451.115 800.407,334.477 802.757,426.994 805.108,370.809 807.458,452.3 809.809,540.817 812.159,386.428 814.509,336.036 816.86,326.068 819.21,532.659 821.561,477.383 823.911,312.063 826.262,447.178 828.612,486.342 830.963,308.099 833.313,356.596 835.664,485.908 838.014,431.743 840.365,488.137 842.715,482.432 845.066,165.548 847.416,376.027 849.767,548.216 852.117,415.728 854.467,379.325 856.818,460.783 859.168,438.237 861.519,598.798 863.869,398.958 866.22,449.478 868.57,273.669 870.921,439.053 873.271,361.241 875.622,277.95 877.972,527.306 880.323,385.003 882.673,566.982 885.024,406.62 887.374,250.855 889.725,505.009 892.075,553.113 894.426,460.063 896.776,513.155 899.126,548.956 901.477,604.108 903.827,435.681 906.178,472.897 908.528,558.409 910.879,407.826 913.229,662.445 915.58,394.664 917.93,501.583 920.281,340.711 922.631,217.529 924.982,486.052 927.332,506.877 929.683,472.433 932.033,343.641 934.384,517.994 936.734,475.222 939.084,457.731 941.435,375.015 943.785,343.802 946.136,568.419 948.486,447.378 950.837,669.486 953.187,528.217 955.538,442.188 957.888,383.042 960.239,590.52 962.589,328.905 964.94,349.822 967.29,454.302 969.641,199.496 971.991,363.259 974.342,348.512 976.692,512.701 979.043,452.363 981.393,454.675 983.743,381.228 986.094,292.168 988.444,281.13 990.795,464.93 993.145,519.944 995.496,393.549 997.846,302.827 1000.2,581.897 1002.55,522.183 1004.9,492.551 1007.25,356.262 1009.6,354.623 1011.95,524.678 1014.3,439.229 1016.65,422.975 1019,440.087 1021.35,328.237 1023.7,219.711 1026.05,424.598 1028.4,136.429 1030.75,491.828 1033.1,427.104 1035.45,331.283 1037.8,484.389 1040.15,567.456 1042.51,457.067 1044.86,463.161 1047.21,353.245 1049.56,124.803 1051.91,244.059 1054.26,402.874 1056.61,699.595 1058.96,225.888 1061.31,205.008 1063.66,468.088 1066.01,430.126 1068.36,491.727 1070.71,494.552 1073.06,347.231 1075.41,438.449 1077.76,423.272 1080.11,486.313 1082.46,362.327 1084.81,323.603 1087.16,391.835 1089.51,437.639 1091.87,392.141 1094.22,345.74 1096.57,305.096 1098.92,497.35 1101.27,402.182 1103.62,487.529 1105.97,224.521 1108.32,397.774 1110.67,495.275 1113.02,430.92 1115.37,440.309 1117.72,267.45 1120.07,412.493 1122.42,445.982 1124.77,541.743 1127.12,362.225 1129.47,381.015 1131.82,352.33 1134.17,499.879 1136.52,383.566 1138.87,490.863 1141.23,375.928 1143.58,519.411 1145.93,499.522 1148.28,271.852 1150.63,216.083 1152.98,540.251 1155.33,454.981 1157.68,512.433 1160.03,550.023 1162.38,557.557 1164.73,238.465 1167.08,244.102 1169.43,581.044 1171.78,299.05 1174.13,274.908 1176.48,602.939 1178.83,424.367 1181.18,297.415 1183.53,382.055 1185.88,422.493 1188.23,438.89 1190.59,409.554 1192.94,422.765 1195.29,534.498 1197.64,458.929 1199.99,387.14 1202.34,466.27 1204.69,463.962 1207.04,538.356 1209.39,388.096 1211.74,468.886 1214.09,474.527 1216.44,590.677 1218.79,391.626 1221.14,409.186 1223.49,459.134 1225.84,436.864 1228.19,616.352 1230.54,352.531 1232.89,422.705 1235.24,466.039 1237.59,517.855 1239.94,200.954 1242.3,288.775 1244.65,265.497 1247,351.479 1249.35,455.493 1251.7,373.362 1254.05,310.843 1256.4,352.404 1258.75,452.97 1261.1,514.251 1263.45,499.529 1265.8,420.52 1268.15,293.077 1270.5,407.739 1272.85,321.551 1275.2,434 1277.55,231.373 1279.9,523.095 1282.25,341.218 1284.6,293.182 1286.95,407.762 1289.3,509.729 1291.66,342.696 1294.01,469.346 1296.36,537.307 1298.71,447.233 1301.06,405.421 1303.41,362.682 1305.76,525.947 1308.11,239.796 1310.46,260.312 1312.81,408.812 1315.16,512.663 1317.51,626.747 1319.86,393.379 1322.21,552.007 1324.56,320.024 1326.91,404.92 1329.26,392.584 1331.61,468.001 1333.96,354.38 1336.31,486.277 1338.66,445.435 1341.02,654.033 1343.37,285.116 1345.72,452.731 1348.07,382.012 1350.42,475.034 1352.77,309.15 1355.12,357.495 1357.47,442.115 1359.82,390.95 1362.17,286.645 1364.52,404.96 1366.87,347.754 1369.22,479.82 1371.57,514.001 1373.92,600.288 1376.27,391.121 1378.62,616.562 1380.97,249.863 1383.32,462.364 1385.67,397.167 1388.02,521.587 1390.38,380.906 1392.73,566.448 1395.08,324.591 1397.43,230.038 1399.78,352.4 1402.13,627.72 1404.48,432.061 1406.83,385.868 1409.18,363.689 1411.53,441.313 1413.88,492.986 1416.23,414.901 1418.58,512.771 1420.93,354.847 1423.28,460.671 1425.63,249.35 1427.98,482.64 1430.33,562.326 1432.68,487.526 1435.03,316.278 1437.38,483.963 1439.74,308.462 1442.09,295.676 1444.44,502.503 1446.79,566.654 1449.14,355.578 1451.49,359.567 1453.84,370.583 1456.19,469.842 1458.54,538.652 1460.89,638.464 1463.24,510.746 1465.59,379.171 1467.94,336.177 1470.29,388.699 1472.64,468.698 1474.99,512.259 1477.34,405.378 1479.69,489.774 1482.04,676.659 1484.39,334.028 1486.74,292.944 1489.1,477.737 1491.45,490.981 1493.8,403.184 1496.15,246.605 1498.5,327.065 1500.85,428.114 1503.2,408.212 1505.55,362.705 1507.9,420.626 1510.25,430.085 1512.6,467.05 1514.95,365.349 1517.3,364.151 1519.65,578.954 1522,384.539 1524.35,213.718 1526.7,471.64 1529.05,496.42 1531.4,310.884 1533.75,277.165 1536.1,320.573 1538.45,433.156 1540.81,558.943 1543.16,419.671 1545.51,309.844 1547.86,443.694 1550.21,231.489 1552.56,343.772 1554.91,671.588 1557.26,391.256 1559.61,412.187 1561.96,222.049 1564.31,456.531 1566.66,422.084 1569.01,501.097 1571.36,316.384 1573.71,240.855 1576.06,323.084 1578.41,356.575 1580.76,360.169 1583.11,223.054 1585.46,536.847 1587.81,594.704 1590.17,323.761 1592.52,277.671 1594.87,409.432 1597.22,405.34 1599.57,555.438 1601.92,375.726 1604.27,369.483 1606.62,465.601 1608.97,423.936 1611.32,425.919 1613.67,483.742 1616.02,561.65 1618.37,549.25 1620.72,571.738 1623.07,539.869 1625.42,566.28 1627.77,571.486 1630.12,465.396 1632.47,551.356 1634.82,465.773 1637.17,480.61 1639.53,250.348 1641.88,471.888 1644.23,486.142 1646.58,153.982 1648.93,345.966 1651.28,449.661 1653.63,504.501 1655.98,382.009 1658.33,506.314 1660.68,341.255 1663.03,367.901 1665.38,427.477 1667.73,499.562 1670.08,434.907 1672.43,375.289 1674.78,399.652 1677.13,524.035 1679.48,430.604 1681.83,448.149 1684.18,430.543 1686.53,565.845 1688.89,503.113 1691.24,271.033 1693.59,361.143 1695.94,454.313 1698.29,477.006 1700.64,375.831 1702.99,350.681 1705.34,420.17 1707.69,470.707 1710.04,485.682 1712.39,465.812 1714.74,401.741 1717.09,543.214 1719.44,568.63 1721.79,355.957 1724.14,478.629 1726.49,440.876 1728.84,235.656 1731.19,404.063 1733.54,191.647 1735.89,491.388 1738.25,472.164 1740.6,296.896 1742.95,381.768 1745.3,340.793 1747.65,252.995 1750,453.243 1752.35,517.521 1754.7,447.225 1757.05,573.166 1759.4,560.429 1761.75,329.049 1764.1,477.476 1766.45,369.406 1768.8,396.544 1771.15,459.268 1773.5,317.947 1775.85,417.671 1778.2,268.64 1780.55,347.616 1782.9,458.818 1785.25,500.353 1787.6,374.185 1789.96,319.423 1792.31,526.804 1794.66,387.617 1797.01,284.582 1799.36,281.933 1801.71,530.899 1804.06,326.557 1806.41,604.856 1808.76,398.931 1811.11,512.809 1813.46,425.602 1815.81,363.447 1818.16,501.559 1820.51,344.207 1822.86,465.739 1825.21,293.466 1827.56,269.172 1829.91,406.115 1832.26,337.637 1834.61,205.007 1836.96,487.303 1839.32,587.081 1841.67,448.78 1844.02,400.8 1846.37,474.795 1848.72,582.21 1851.07,423.859 1853.42,509.174 1855.77,616.566 1858.12,449.662 1860.47,616.154 1862.82,332.159 1865.17,581.023 1867.52,527.363 1869.87,600.616 1872.22,436.481 1874.57,520.32 1876.92,460.609 1879.27,334.041 1881.62,368.707 1883.97,561.491 1886.32,363.625 1888.68,248.063 1891.03,377.122 1893.38,444.887 1895.73,385.344 1898.08,416.398 1900.43,264.781 1902.78,449.014 1905.13,497.911 1907.48,509.464 1909.83,410.614 1912.18,442.101 1914.53,413.686 1916.88,412.852 1919.23,457.151 1921.58,413.133 1923.93,330.886 1926.28,370.452 1928.63,575.43 1930.98,190.809 1933.33,336.601 1935.68,353.967 1938.04,307.001 1940.39,397.982 1942.74,382.976 1945.09,283.873 1947.44,455.321 1949.79,227.279 1952.14,445.582 1954.49,247.349 1956.84,370.385 1959.19,426.108 1961.54,406.898 1963.89,426.225 1966.24,493.31 1968.59,512.612 1970.94,424.004 1973.29,349.237 1975.64,444.036 1977.99,357.023 1980.34,360.693 1982.69,459.01 1985.04,602.565 1987.4,309.104 1989.75,333.644 1992.1,96.8724 1994.45,556.051 1996.8,441.184 1999.15,165.357 2001.5,308.629 2003.85,309.196 2006.2,420.019 2008.55,431.341 2010.9,397.373 2013.25,589.589 2015.6,462.096 2017.95,401.123 2020.3,463.192 2022.65,381.396 2025,294.753 2027.35,450.438 2029.7,288.517 2032.05,414.837 2034.4,476.243 2036.76,373.262 2039.11,488.072 2041.46,395.236 2043.81,456.645 2046.16,406.317 2048.51,360.494 2050.86,304.16 2053.21,232.581 2055.56,473.758 2057.91,426.266 2060.26,345.571 2062.61,467.797 2064.96,323.306 2067.31,184.98 2069.66,433.641 2072.01,527.016 2074.36,343.47 2076.71,347.272 2079.06,545.643 2081.41,338.869 2083.76,310.209 2086.11,228.237 2088.47,550.443 2090.82,364.341 2093.17,517.962 2095.52,296.899 2097.87,415.223 2100.22,341.641 2102.57,349.662 2104.92,383.116 2107.27,269.93 2109.62,199.412 2111.97,486.712 2114.32,517.924 2116.67,368.438 2119.02,431.912 2121.37,288.737 2123.72,534.615 2126.07,385.201 2128.42,486.57 2130.77,365.129 2133.12,637.389 2135.47,415.74 2137.83,543.835 2140.18,491.792 2142.53,593.945 2144.88,416.208 2147.23,494.593 2149.58,559.201 2151.93,406.983 2154.28,342.893 2156.63,496.222 2158.98,350.55 2161.33,271.015 2163.68,502.375 2166.03,324.801 2168.38,492.523 2170.73,315.384 2173.08,417.901 2175.43,629.885 2177.78,371.21 2180.13,537.67 2182.48,401.817 2184.83,384.296 2187.19,445.15 2189.54,473.682 2191.89,277.223 2194.24,547.613 2196.59,233.111 2198.94,324.844 2201.29,380.746 2203.64,330.564 2205.99,373.976 2208.34,432.251 2210.69,391.973 2213.04,441.28 2215.39,477.024 2217.74,486.882 2220.09,417.154 2222.44,487.42 2224.79,510.374 2227.14,389.951 2229.49,387.535 2231.84,426.15 2234.19,390.413 2236.55,331.67 2238.9,411.784 2241.25,415.332 2243.6,305.947 2245.95,461.539 2248.3,423.34 2250.65,330.603 2253,438.093 2255.35,418.699 2257.7,345.312 2260.05,473.436 2262.4,689.143 2264.75,332.202 2267.1,569.462 2269.45,468.166 2271.8,419.567 2274.15,343.131 2276.5,475.574 2278.85,281.674 2281.2,336.672 2283.55,379.231 2285.91,380.323 2288.26,249.195 2290.61,292.481 2292.96,334.37 2295.31,442.982 2297.66,477.35 2300.01,469.75 2302.36,364.844 2304.71,308.288 2307.06,363.171 2309.41,295.619 2311.76,557.922 2314.11,180.795 2316.46,333.899 2318.81,522.476 2321.16,418.444 2323.51,572.59 2325.86,342.113 2328.21,607.919 2330.56,384.639 2332.91,237.495 2335.27,290.341 2337.62,359.195 2339.97,229.57 2342.32,323.14 2344.67,509.408 2347.02,313.088 2349.37,362.362 2351.72,400.445 2354.07,407.589 2356.42,254.571 2358.77,399.738 2361.12,476.845 2363.47,425.409 2365.82,440.284 2368.17,446.781 2370.52,351.186 2372.87,503.612 2375.22,472.174 2377.57,548.94 2379.92,565.316 2382.27,448.657 2384.62,470.51 2386.98,520.87 2389.33,585.65 2391.68,458.254 2394.03,207.313 2396.38,474.803 2398.73,400.648 2401.08,529.945 2403.43,382.01 2405.78,416.642 2408.13,363.483 2410.48,232.903 2412.83,509.404 2415.18,573.182 2417.53,424.299 2419.88,683.741 2422.23,525.953 2424.58,450.97 2426.93,524.2 2429.28,353.979 2431.63,261.031 2433.98,621.674 2436.34,398.703 2438.69,483.949 2441.04,457.491 2443.39,356.374 2445.74,610.551 2448.09,305.885 2450.44,566.186 2452.79,337.659 2455.14,581.187 2457.49,362.84 2459.84,388.801 2462.19,494.415 2464.54,474.379 2466.89,432.363 2469.24,536.692 2471.59,564.319 2473.94,299.279 2476.29,523.813 2478.64,455.494 2480.99,249.107 2483.34,512.321 2485.7,400.169 2488.05,302.916 2490.4,410.468 2492.75,392.669 2495.1,455.284 2497.45,586.985 2499.8,430.857 2502.15,475.102 2504.5,384.067 2506.85,511.674 2509.2,438.977 2511.55,298.905 2513.9,411.893 2516.25,349.797 2518.6,487.948 2520.95,278.669 2523.3,457.816 2525.65,313.613 2528,282.826 2530.35,461.875 2532.7,167.532 2535.06,443.722 2537.41,544.292 2539.76,478.083 2542.11,341.558 2544.46,401.968 2546.81,524.748 2549.16,310.992 2551.51,429.176 2553.86,402.978 2556.21,445.685 2558.56,388.198 2560.91,467.649 2563.26,363.068 2565.61,553.028 2567.96,503.884 2570.31,380.329 "></polyline>
</svg>
</div>
</div>
<p>Look at that! Things are working; amazin’.</p>
<p>We can also exploit <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>’s parallel sampling capabilities:</p>
<div id="34" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run separate 4 chains for 10 000 iterations using threads to parallelize.</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>num_chains <span class="op">=</span> <span class="fl">4</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    model_with_grad,</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">MCMCThreads</span>(),</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>,</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    num_chains;</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Note we need to provide an initial state for every chain.</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>    initial_state<span class="op">=</span><span class="fu">fill</span>(state, num_chains),</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>samples_array <span class="op">=</span> <span class="fu">stack</span>(<span class="fu">map</span>(<span class="bu">Base</span>.<span class="fu">Fix1</span>(stack, sample <span class="op">-&gt;</span> sample.x), samples))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000×4 Array{Float64, 3}:
[:, :, 1] =
 -1.51832  -2.7934    -3.83752   …  -4.8896   -4.65255   -4.65255
 -1.2272   -0.963588   0.454172     -1.585    -0.895877  -0.895877
  3.29242   4.76009    5.70958       2.66503   2.71374    2.71374

[:, :, 2] =
 -1.73986  -3.52168  -3.52168  -4.79942  …  -5.34104   -4.50703   -4.57622
  1.63128   1.10466   1.10466  -0.48492      0.571391   0.290941   2.25035
  1.22202   2.88512   2.88512   5.38529      3.73616    4.14858    6.13333

[:, :, 3] =
 -2.69841   -4.11287    -3.55109  …  -5.21374   -3.90058   -4.27903
  0.599118  -0.0862528  -1.20161     -0.285337  -0.616022   0.825948
  2.50817    3.85448     4.73486      4.59087    4.76416    6.41979

[:, :, 4] =
 -2.07711   -4.62735  -4.99575   -3.65463  …  -5.69347   -6.06901  -4.83689
 -0.252406   1.43288   0.450218  -1.10308      0.544235   1.29556   1.74143
  3.13116    3.77752   4.53756    4.34838      3.62714    3.76891   4.61707</code></pre>
</div>
</div>
<p>But the fact that we have to provide the <code>AbstractMCMC.sample</code> call, etc. with an <code>initial_state</code> to get started is a bit annoying. We can avoid this by also defining a <code>AbstractMCMC.step</code> <em>without</em> the <code>state</code> argument:</p>
<div id="36" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">::</span><span class="dt">MALA</span>;</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># </span><span class="al">NOTE</span><span class="co">: No state provided!</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just create the initial state by sampling using  a Gaussian.</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="fu">randn</span>(rng, LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(x), <span class="fu">MALAState</span>(x)</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Equipped with this, we no longer need to provide the <code>initial_state</code> everywhere:</p>
<div id="38" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -4.97433     0.97882
  0.00757414  1.01991
  5.03135     1.01609</code></pre>
</div>
</div>
</section>
<section id="using-our-sampler-with-turing.jl" class="level2">
<h2 class="anchored" data-anchor-id="using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</h2>
<p>As we promised, all of this hassle of implementing our <code>MALA</code> sampler in a way that uses <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> and <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> gets us something more than <em>just</em> an “automatic” implementation of <code>AbstractMCMC.sample</code>.</p>
<p>It also enables use with Turing.jl through the <code>externalsampler</code>, but we need to do one final thing first: we need to tell Turing.jl how to extract a vector of parameters from the “sample” returned in our implementation of <code>AbstractMCMC.step</code>. In our case, the “sample” is a <code>MALASample</code>, so we just need the following line:</p>
<div id="40" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load Turing.jl.</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Turing</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Overload the `getparams` method for our "sample" type, which is just a vector.</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>Turing.Inference.<span class="fu">getparams</span>(<span class="op">::</span><span class="dt">Turing.Model</span>, sample<span class="op">::</span><span class="dt">MALASample</span>) <span class="op">=</span> sample.x</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And with that, we’re good to go!</p>
<div id="42" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Our previous model defined as a Turing.jl model.</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">mvnormal_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">MvNormal</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.], I)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate our model.</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">mvnormal_model</span>()</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Call `sample` but now we're passing in a Turing.jl `model` and wrapping</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co"># our `MALA` sampler in the `externalsampler` to tell Turing.jl that the sampler</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co"># expects something that implements LogDensityProblems.jl.</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×4×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 2.7 seconds
Compute duration  = 2.7 seconds
parameters        = x[1], x[2], x[3]
internals         = lp

Summary Statistics
  parameters      mean       std      mcse    ess_bulk    ess_tail      rhat   ⋯
      Symbol   Float64   Float64   Float64     Float64     Float64   Float64   ⋯

        x[1]   -4.9882    1.0032    0.0175   3275.7305   4858.1246    0.9999   ⋯
        x[2]   -0.0022    1.0084    0.0183   3019.7740   4581.2508    1.0000   ⋯
        x[3]    4.9826    1.0176    0.0171   3543.0910   5639.6500    1.0011   ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

        x[1]   -6.9544   -5.6661   -4.9997   -4.2999   -3.0047
        x[2]   -2.0301   -0.6810    0.0002    0.6744    1.9800
        x[3]    3.0089    4.2843    4.9876    5.6626    6.9536</code></pre>
</div>
</div>
<p>Pretty neat, eh?</p>
<section id="models-with-constrained-parameters" class="level3">
<h3 class="anchored" data-anchor-id="models-with-constrained-parameters">Models with constrained parameters</h3>
<p>One thing we’ve sort of glossed over in all of the above is that MALA, at least how we’ve implemented it, requires <span class="math inline">\(x\)</span> to live in <span class="math inline">\(\mathbb{R}^d\)</span> for some <span class="math inline">\(d &gt; 0\)</span>. If some of the parameters were in fact constrained, e.g.&nbsp;we were working with a <code>Beta</code> distribution which has support on the interval <span class="math inline">\((0, 1)\)</span>, <em>not</em> on <span class="math inline">\(\mathbb{R}^d\)</span>, we could easily end up outside of the valid range <span class="math inline">\((0, 1)\)</span>.</p>
<div id="44" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">beta_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">beta_model</span>()</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 1.56 seconds
Compute duration  = 1.56 seconds
parameters        = x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse    ess_bulk    ess_tail      rhat   ⋯
      Symbol   Float64   Float64   Float64     Float64     Float64   Float64   ⋯

           x    0.5010    0.1888    0.0029   4269.1401   5801.2346    0.9999   ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

           x    0.1456    0.3619    0.5007    0.6422    0.8558</code></pre>
</div>
</div>
<p>Yep, that still works, but only because Turing.jl actually <em>transforms</em> the <code>turing_model</code> from constrained to unconstrained, so that the <code>sampler</code> provided to <code>externalsampler</code> is actually always working in unconstrained space! This is not always desirable, so we can turn this off:</p>
<div id="46" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 0.24 seconds
Compute duration  = 0.24 seconds
parameters        = x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse   ess_bulk   ess_tail      rhat   e ⋯
      Symbol   Float64   Float64   Float64    Float64    Float64   Float64     ⋯

           x    0.5146    0.1666    0.0206    55.0337    28.2364    1.0083     ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

           x    0.2260    0.3822    0.5187    0.6442    0.7813</code></pre>
</div>
</div>
<p>The fun thing is that this still sort of works because</p>
<div id="48" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">logpdf</span>(<span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>), <span class="fl">10.0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-Inf</code></pre>
</div>
</div>
<p>and so the samples that fall outside of the range are always rejected. But do notice how much worse all the diagnostics are, e.g.&nbsp;<code>ess_tail</code> is very poor compared to when we use <code>unconstrained=true</code>. Moreover, in more complex cases this won’t just result in a “nice” <code>-Inf</code> log-density value, but instead will error:</p>
<div id="50" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="kw">function</span> <span class="fu">demo</span>()</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>    σ² <span class="op">~</span> <span class="fu">truncated</span>(<span class="fu">Normal</span>(), lower<span class="op">=</span><span class="fl">0</span>)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If we end up with negative values for `σ²`, the `Normal` will error.</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>    x <span class="op">~</span> <span class="fu">Normal</span>(<span class="fl">0</span>, σ²)</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>DomainError: DomainError(-2.520710520157504, "Normal: the condition σ &gt;= zero(σ) is not satisfied.")
DomainError with -2.520710520157504:
Normal: the condition σ &gt;= zero(σ) is not satisfied.
Stacktrace:
  [1] #371
    @ ~/.julia/packages/Distributions/nmUhn/src/univariate/continuous/normal.jl:37 [inlined]
  [2] check_args
    @ ~/.julia/packages/Distributions/nmUhn/src/utils.jl:89 [inlined]
  [3] #Normal#370
    @ ~/.julia/packages/Distributions/nmUhn/src/univariate/continuous/normal.jl:37 [inlined]
  [4] Normal
    @ ~/.julia/packages/Distributions/nmUhn/src/univariate/continuous/normal.jl:36 [inlined]
  [5] Normal
    @ ~/.julia/packages/Distributions/nmUhn/src/univariate/continuous/normal.jl:42 [inlined]
  [6] macro expansion
    @ ~/.julia/packages/DynamicPPL/MjWTB/src/compiler.jl:579 [inlined]
  [7] demo(__model__::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, __varinfo__::DynamicPPL.ThreadSafeVarInfo{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, Vector{Base.RefValue{Float64}}}, __context__::DynamicPPL.ValuesAsInModelContext{OrderedDict{Any, Any}, DynamicPPL.DefaultContext})
    @ Main.Notebook ~/work/docs/docs/tutorials/docs-17-implementing-samplers/index.qmd:592
  [8] _evaluate!!
    @ ~/.julia/packages/DynamicPPL/MjWTB/src/model.jl:973 [inlined]
  [9] evaluate_threadsafe!!(model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, varinfo::DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, context::DynamicPPL.ValuesAsInModelContext{OrderedDict{Any, Any}, DynamicPPL.DefaultContext})
    @ DynamicPPL ~/.julia/packages/DynamicPPL/MjWTB/src/model.jl:962
 [10] evaluate!!
    @ ~/.julia/packages/DynamicPPL/MjWTB/src/model.jl:892 [inlined]
 [11] values_as_in_model
    @ ~/.julia/packages/DynamicPPL/MjWTB/src/values_as_in_model.jl:196 [inlined]
 [12] values_as_in_model
    @ ~/.julia/packages/DynamicPPL/MjWTB/src/values_as_in_model.jl:195 [inlined]
 [13] getparams(model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, vi::DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64})
    @ Turing.Inference ~/.julia/packages/Turing/Bv30p/src/mcmc/Inference.jl:343
 [14] Turing.Inference.Transition(model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, vi::DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, t::MALASample{Vector{Float64}})
    @ Turing.Inference ~/.julia/packages/Turing/Bv30p/src/mcmc/Inference.jl:226
 [15] transition_to_turing
    @ ~/.julia/packages/Turing/Bv30p/src/mcmc/abstractmcmc.jl:12 [inlined]
 [16] transition_to_turing(f::LogDensityProblemsADForwardDiffExt.ForwardDiffLogDensity{LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, Nothing}, ForwardDiff.Chunk{2}, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}, transition::MALASample{Vector{Float64}})
    @ Turing.Inference ~/.julia/packages/Turing/Bv30p/src/mcmc/abstractmcmc.jl:17
 [17] step(rng::TaskLocalRNG, model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, sampler_wrapper::DynamicPPL.Sampler{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}; initial_state::Nothing, initial_params::Nothing, kwargs::@Kwargs{})
    @ Turing.Inference ~/.julia/packages/Turing/Bv30p/src/mcmc/abstractmcmc.jl:141
 [18] step
    @ ~/.julia/packages/Turing/Bv30p/src/mcmc/abstractmcmc.jl:96 [inlined]
 [19] macro expansion
    @ ~/.julia/packages/AbstractMCMC/YrmkI/src/sample.jl:130 [inlined]
 [20] macro expansion
    @ ~/.julia/packages/AbstractMCMC/YrmkI/src/logging.jl:16 [inlined]
 [21] mcmcsample(rng::TaskLocalRNG, model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, sampler::DynamicPPL.Sampler{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}, N::Int64; progress::Bool, progressname::String, callback::Nothing, discard_initial::Int64, thinning::Int64, chain_type::Type, initial_state::Nothing, kwargs::@Kwargs{})
    @ AbstractMCMC ~/.julia/packages/AbstractMCMC/YrmkI/src/sample.jl:120
 [22] sample(rng::TaskLocalRNG, model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, sampler::DynamicPPL.Sampler{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}, N::Int64; chain_type::Type, resume_from::Nothing, initial_state::Nothing, kwargs::@Kwargs{progress::Bool})
    @ DynamicPPL ~/.julia/packages/DynamicPPL/MjWTB/src/sampler.jl:93
 [23] sample
    @ ~/.julia/packages/DynamicPPL/MjWTB/src/sampler.jl:83 [inlined]
 [24] #sample#4
    @ ~/.julia/packages/Turing/Bv30p/src/mcmc/Inference.jl:276 [inlined]
 [25] sample
    @ ~/.julia/packages/Turing/Bv30p/src/mcmc/Inference.jl:267 [inlined]
 [26] #sample#3
    @ ~/.julia/packages/Turing/Bv30p/src/mcmc/Inference.jl:264 [inlined]
 [27] top-level scope
    @ ~/work/docs/docs/tutorials/docs-17-implementing-samplers/index.qmd:594</code></pre>
</div>
</div>
<p>As expected, we run into a <code>DomainError</code> at some point, while if we set <code>unconstrained=true</code>, letting Turing.jl transform the model to a unconstrained form behind the scenes, everything works as expected:</p>
<div id="52" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 1.7 seconds
Compute duration  = 1.7 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse   ess_bulk   ess_tail      rhat   e ⋯
      Symbol   Float64   Float64   Float64    Float64    Float64   Float64     ⋯

          σ²    0.8390    0.5452    0.0252   328.0919   123.6615    1.0002     ⋯
           x   -0.0492    0.9701    0.0539   481.7051   287.1264    1.0000     ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

          σ²    0.1190    0.3983    0.7316    1.1717    2.1026
           x   -2.4037   -0.4286    0.0070    0.4260    1.8049</code></pre>
</div>
</div>
<p>Neat!</p>
<p>Similarly, which automatic differentiation backend one should use can be specified through the <code>adtype</code> keyword argument too. For example, if we want to use <a href="https://github.com/JuliaDiff/ReverseDiff.jl">ReverseDiff.jl</a> instead of the default <a href="https://github.com/JuliaDiff/ForwardDiff.jl">ForwardDiff.jl</a>:</p>
<div id="54" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">ReverseDiff</span>: ReverseDiff</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify that we want to use `AutoReverseDiff`.</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">demo</span>(),</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>, adtype<span class="op">=</span><span class="fu">AutoReverseDiff</span>()),</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>;</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 3.14 seconds
Compute duration  = 3.14 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse   ess_bulk   ess_tail      rhat   e ⋯
      Symbol   Float64   Float64   Float64    Float64    Float64   Float64     ⋯

          σ²    0.8407    0.5792    0.0294   252.0957    59.0366    1.0094     ⋯
           x    0.0564    1.0841    0.0710   356.2762   174.7654    1.0063     ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

          σ²    0.1173    0.3746    0.7319    1.1818    2.1846
           x   -2.1361   -0.4329    0.0350    0.4349    2.8435</code></pre>
</div>
</div>
<p>Double-neat.</p>
</section>
</section>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<p>At this point it’s worth maybe reminding ourselves what we did and also <em>why</em> we did it:</p>
<ol type="1">
<li>We define our models in the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface because it makes the sampler agnostic to how the underlying model is implemented.</li>
<li>We implement our sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> interface, which just means that our sampler is a subtype of <code>AbstractMCMC.AbstractSampler</code> and we implement the MCMC transition in <code>AbstractMCMC.step</code>.</li>
<li>Points 1 and 2 makes it so our sampler can be used with a wide range of model implementations, amongst them being models implemented in both Turing.jl and Stan. This gives you, the inference implementer, a large collection of models to test your inference method on, in addition to allowing users of Turing.jl and Stan to try out your inference method with minimal effort.</li>
</ol>


</section>


<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a><div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>We’re going with the leapfrog formulation because in a future version of this tutorial we’ll add a section extending this simple “baseline” MALA sampler to more complex versions. See <a href="https://github.com/TuringLang/docs/issues/479">issue #479</a> for progress on this.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>There is no such thing as a proper interface in Julia (at least not officially), and so we use the word “interface” here to mean a few minimal methods that needs to be implemented by any type that we treat as a target model.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/turinglang\.org\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../tutorials/docs-07-for-developers-variational-inference/index.html" class="pagination-link" aria-label="Variational Inference">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Variational Inference</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Turing is created by <a href="http://mlg.eng.cam.ac.uk/hong/" target="_blank">Hong Ge</a>, and lovingly maintained by the <a href="https://github.com/TuringLang/Turing.jl/graphs/contributors" target="_blank">core team</a> of volunteers. <br> The contents of this website are © 2024 under the terms of the <a href="https://github.com/TuringLang/Turing.jl/blob/master/LICENCE" target="_blank">MIT License</a>.</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/TuringLang/docs/edit/master/tutorials/docs-17-implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/docs/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://x.com/TuringLang">
      <i class="bi bi-twitter" role="img" aria-label="Turing Twitter">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/TuringLang/Turing.jl">
      <i class="bi bi-github" role="img" aria-label="Turing GitHub">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




<script src="../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>