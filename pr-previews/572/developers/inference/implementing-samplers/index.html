<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.10">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Implementing Samplers – Turing.jl</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<link href="../../../developers/inference/variational-inference/index.html" rel="prev">
<link href="../../../assets/favicon.ico" rel="icon">
<script src="../../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-0f20262f3ac6b624a8f572cb0795ac9a.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-dark-ab571cb649e658061f5e385b10ec0c93.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap-f7d47109ef0af74e1bd0de52084fb680.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../../site_libs/bootstrap/bootstrap-dark-4c7375df407d0d76fbc1fbce61ba2e1c.min.css" rel="prefetch" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../../theming/styles.css">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="https://turinglang.org/" class="navbar-brand navbar-brand-logo">
    <img src="../../../assets/images/turing-logo.svg" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="https://turinglang.org/">
    <span class="navbar-title">Turing.jl</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../tutorials/docs-00-getting-started/"> 
<span class="menu-text">Get Started</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../tutorials/00-introduction/"> 
<span class="menu-text">Tutorials</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/library/"> 
<span class="menu-text">Libraries</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/news/"> 
<span class="menu-text">News</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/team/"> 
<span class="menu-text">Team</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-v0.35" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">v0.35</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-v0.35">    
        <li>
    <a class="dropdown-item" href="https://turinglang.org/docs/changelog.html">
 <span class="dropdown-text">Changelog</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://turinglang.org/docs/versions.html">
 <span class="dropdown-text">All Versions</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools tools-wide">
    <a href="https://x.com/TuringLang" title="Turing Twitter" class="quarto-navigation-tool px-1" aria-label="Turing Twitter"><i class="bi bi-twitter"></i></a>
    <a href="https://github.com/TuringLang/Turing.jl" title="Turing GitHub" class="quarto-navigation-tool px-1" aria-label="Turing GitHub"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../../developers/contributing/index.html">Developers</a></li><li class="breadcrumb-item"><a href="../../../developers/inference/abstractmcmc-interface/index.html">Inference (note: outdated)</a></li><li class="breadcrumb-item"><a href="../../../developers/inference/implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false">
 <span class="menu-text">Users</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/docs-00-getting-started/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Getting Started</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/docs-12-using-turing-guide/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Core Functionality</span></a>
  </div>
</li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false">
 <span class="menu-text">Usage Tips</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/docs-10-using-turing-autodiff/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Automatic Differentiation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/usage-custom-distribution/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Custom Distributions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/usage-probability-interface/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Querying Model Probabilities</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/usage-modifying-logprob/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Modifying the Log Probability</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/usage-generated-quantities/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Generated Quantities</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/docs-17-mode-estimation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Mode Estimation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/docs-13-using-turing-performance-tips/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Performance Tips</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/docs-15-using-turing-sampler-viz/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Sampler Visualization</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/docs-11-using-turing-dynamichmc/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using DynamicHMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/docs-16-using-turing-external-samplers/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using External Samplers</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false">
 <span class="menu-text">Tutorials</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/00-introduction/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction: Coin Flipping</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/01-gaussian-mixture-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Mixture Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/02-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/03-bayesian-neural-network/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Neural Networks</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/04-hidden-markov-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Hidden Markov Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/05-linear-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Linear Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/06-infinite-mixture-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Infinite Mixture Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/07-poisson-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Poisson Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/08-multinomial-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Multinomial Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/09-variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/10-bayesian-differential-equations/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Differential Equations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/11-probabilistic-pca/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Probabilistic PCA</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/13-seasonal-time-series/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Time Series Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/15-gaussian-processes/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction to Gaussian Processes</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/12-gplvm/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Process Latent Variable Models</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Developers</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/contributing/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Contributing</span></a>
  </div>
</li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false">
 <span class="menu-text">DynamicPPL’s Compiler</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/compiler/model-manual/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Manually Defining a Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/compiler/minituring-compiler/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation I: Compiler</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/compiler/minituring-contexts/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation II: Contexts</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/compiler/design-overview/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Turing Compiler Design (Outdated)</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true">
 <span class="menu-text">Inference (note: outdated)</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/inference/abstractmcmc-interface/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Interface Guide</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/inference/abstractmcmc-turing/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">How Turing Implements AbstractMCMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/inference/variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/inference/implementing-samplers/index.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Implementing Samplers</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#quick-overview-of-mala" id="toc-quick-overview-of-mala" class="nav-link active" data-scroll-target="#quick-overview-of-mala">Quick overview of MALA</a></li>
  <li><a href="#what-we-need-from-a-model-logdensityproblems.jl" id="toc-what-we-need-from-a-model-logdensityproblems.jl" class="nav-link" data-scroll-target="#what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: LogDensityProblems.jl</a></li>
  <li><a href="#implementing-mala-in-abstractmcmc.jl" id="toc-implementing-mala-in-abstractmcmc.jl" class="nav-link" data-scroll-target="#implementing-mala-in-abstractmcmc.jl">Implementing MALA in AbstractMCMC.jl</a></li>
  <li><a href="#using-our-sampler-with-turing.jl" id="toc-using-our-sampler-with-turing.jl" class="nav-link" data-scroll-target="#using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</a>
  <ul class="collapse">
  <li><a href="#models-with-constrained-parameters" id="toc-models-with-constrained-parameters" class="nav-link" data-scroll-target="#models-with-constrained-parameters">Models with constrained parameters</a></li>
  </ul></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/TuringLang/docs/edit/master/developers/inference/implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/docs/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../../developers/contributing/index.html">Developers</a></li><li class="breadcrumb-item"><a href="../../../developers/inference/abstractmcmc-interface/index.html">Inference (note: outdated)</a></li><li class="breadcrumb-item"><a href="../../../developers/inference/implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Implementing Samplers</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>In this tutorial, we’ll go through step-by-step how to implement a “simple” sampler in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> in such a way that it can be easily applied to Turing.jl models.</p>
<p>In particular, we’re going to implement a version of <strong>Metropolis-adjusted Langevin (MALA)</strong>.</p>
<p>Note that we will implement this sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> framework, completely “ignoring” Turing.jl until the very end of the tutorial, at which point we’ll use a single line of code to make the resulting sampler available to Turing.jl. This is to really drive home the point that one can implement samplers in a way that is accessible to all of Turing.jl’s users without having to use Turing.jl yourself.</p>
<section id="quick-overview-of-mala" class="level2">
<h2 class="anchored" data-anchor-id="quick-overview-of-mala">Quick overview of MALA</h2>
<p>We can view MALA as a single step of the leapfrog intergrator with resampling of momentum <span class="math inline">\(p\)</span> at every step.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> To make that statement a bit more concrete, we first define the <em>extended</em> target <span class="math inline">\(\bar{\gamma}(x, p)\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\log \bar{\gamma}(x, p) \propto \log \gamma(x) + \log \gamma_{\mathcal{N}(0, M)}(p)
\end{equation*}\]</span></p>
<p>where <span class="math inline">\(\gamma_{\mathcal{N}(0, M)}\)</span> denotes the density for a zero-centered Gaussian with covariance matrix <span class="math inline">\(M\)</span>. We then consider targeting this joint distribution over both <span class="math inline">\(x\)</span> and <span class="math inline">\(p\)</span> as follows. First we define the map</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  L_{\epsilon}: \quad &amp; \mathbb{R}^d \times \mathbb{R}^d \to \mathbb{R}^d \times \mathbb{R}^d \\
  &amp; (x, p) \mapsto (\tilde{x}, \tilde{p}) := L_{\epsilon}(x, p)
\end{split}
\end{equation*}\]</span></p>
<p>as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p_{1 / 2} &amp;:= p + \frac{\epsilon}{2} \nabla \log \gamma(x) \\
  \tilde{x} &amp;:= x + \epsilon M^{-1} p_{1 /2 } \\
  p_1 &amp;:= p_{1 / 2} + \frac{\epsilon}{2} \nabla \log \gamma(\tilde{x}) \\
  \tilde{p} &amp;:= - p_1
\end{split}
\end{equation*}\]</span></p>
<p>This might be familiar for some readers as a single step of the Leapfrog integrator. We then define the MALA kernel as follows: given the current iterate <span class="math inline">\(x_i\)</span>, we sample the next iterate <span class="math inline">\(x_{i + 1}\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p &amp;\sim \mathcal{N}(0, M) \\
  (\tilde{x}, \tilde{p}) &amp;:= L_{\epsilon}(x_i, p) \\
  \alpha &amp;:= \min \left\{ 1, \frac{\bar{\gamma}(\tilde{x}, \tilde{p})}{\bar{\gamma}(x_i, p)} \right\} \\
  x_{i + 1} &amp;:=
  \begin{cases}
    \tilde{x} \quad &amp; \text{ with prob. } \alpha \\
    x_i       \quad &amp; \text{ with prob. } 1 - \alpha
  \end{cases}
\end{split}
\end{equation*}\]</span></p>
<p>i.e.&nbsp;we accept the proposal <span class="math inline">\(\tilde{x}\)</span> with probability <span class="math inline">\(\alpha\)</span> and reject it, thus sticking with our current iterate, with probability <span class="math inline">\(1 - \alpha\)</span>.</p>
</section>
<section id="what-we-need-from-a-model-logdensityproblems.jl" class="level2">
<h2 class="anchored" data-anchor-id="what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a></h2>
<p>There are a few things we need from the “target” / “model” / density that we want to sample from:</p>
<ol type="1">
<li>We need access to log-density <em>evaluations</em> <span class="math inline">\(\log \gamma(x)\)</span> so we can compute the acceptance ratio involving <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>We need access to log-density <em>gradients</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span> so we can compute the Leapfrog steps <span class="math inline">\(L_{\epsilon}(x, p)\)</span>.</li>
<li>We also need access to the “size” of the model so we can determine the size of <span class="math inline">\(M\)</span>.</li>
</ol>
<p>Luckily for us, there is a package called <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> which provides an interface for <em>exactly</em> this!</p>
<p>To demonstrate how one can implement the “<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface”<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> we will use a simple Gaussian model as an example:</p>
<div id="4" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblems</span>: LogDensityProblems;</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's define some type that represents the model.</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> IsotropicNormalModel{M<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"mean of the isotropic Gaussian"</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    mean<span class="op">::</span><span class="dt">M</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Specifies what input length the model expects.</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">dimension</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> <span class="fu">length</span>(model.mean)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Implementation of the log-density evaluation of the model.</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x<span class="op">::</span><span class="dt">AbstractVector{&lt;:Real}</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">-</span> <span class="fu">sum</span>(abs2, x <span class="op">.-</span> model.mean) <span class="op">/</span> <span class="fl">2</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This gives us all of the properties we want for our MALA sampler with the exception of the computation of the <em>gradient</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span>. There is the method <code>LogDensityProblems.logdensity_and_gradient</code> which should return a 2-tuple where the first entry is the evaluation of the logdensity <span class="math inline">\(\log \gamma(x)\)</span> and the second entry is the gradient <span class="math inline">\(\nabla \log \gamma(x)\)</span>.</p>
<p>There are two ways to “implement” this method: 1) we implement it by hand, which is feasible in the case of our <code>IsotropicNormalModel</code>, or b) we defer the implementation of this to a automatic differentiation backend.</p>
<p>To implement it by hand we can simply do</p>
<div id="6" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl that first-order, i.e. gradient information, is available.</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{1}</span>()</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Implement `logdensity_and_gradient`.</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    logγ_x <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="op">-</span>x <span class="op">.*</span> (x <span class="op">-</span> model.mean)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> logγ_x, ∇logγ_x</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s just try it out:</p>
<div id="8" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate the problem.</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> <span class="fu">IsotropicNormalModel</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.])</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create some example input that we can test on.</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>x_example <span class="op">=</span> <span class="fu">randn</span>(LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate!</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-30.785764258106045</code></pre>
</div>
</div>
<p>To defer it to an automatic differentiation backend, we can do</p>
<div id="10" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl we only have access to 0-th order information.</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{0}</span>()</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Use `LogDensityProblemsAD`'s `ADgradient` in combination with some AD backend to implement `logdensity_and_gradient`.</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblemsAD</span>, <span class="bu">ADTypes</span>, <span class="bu">ForwardDiff</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>model_with_grad <span class="op">=</span> <span class="fu">ADgradient</span>(<span class="fu">AutoForwardDiff</span>(), model)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model_with_grad, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-30.785764258106045</code></pre>
</div>
</div>
<p>We’ll continue with the second approach in this tutorial since this is typically what one does in practice, because there are better hobbies to spend time on than deriving gradients by hand.</p>
<p>At this point, one might wonder how we’re going to tie this back to Turing.jl in the end. Effectively, when working with inference methods that only require log-density evaluations and / or higher-order information of the log-density, Turing.jl actually converts the user-provided <code>Model</code> into an object implementing the above methods for <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>. As a result, most samplers provided by Turing.jl are actually implemented to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, enabling their use both <em>within</em> Turing.jl and <em>outside</em> of Turing.jl! Morever, there exists similar conversions for Stan through BridgeStan and Stan<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, which means that a sampler supporting the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface can easily be used on both Turing.jl <em>and</em> Stan models (in addition to user-provided models, as our <code>IsotropicNormalModel</code> above)!</p>
<p>Anyways, let’s move on to actually implementing the sampler.</p>
</section>
<section id="implementing-mala-in-abstractmcmc.jl" class="level2">
<h2 class="anchored" data-anchor-id="implementing-mala-in-abstractmcmc.jl">Implementing MALA in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a></h2>
<p>Now that we’ve established that a model implementing the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface provides us with all the information we need from <span class="math inline">\(\log \gamma(x)\)</span>, we can address the question: given an object that implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, how can we define a sampler for it?</p>
<p>We’re going to do this by making our sampler a sub-type of <code>AbstractMCMC.AbstractSampler</code> in addition to implementing a few methods from <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>. Why? Because it gets us <em>a lot</em> of functionality for free, as we will see later.</p>
<p>Moreover, <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> provides a very natural interface for MCMC algorithms.</p>
<p>First, we’ll define our <code>MALA</code> type</p>
<div id="12" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">AbstractMCMC</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALA{T,A} <span class="op">&lt;:</span><span class="dt"> AbstractMCMC.AbstractSampler</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"stepsize used in the leapfrog step"</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    ϵ_init<span class="op">::</span><span class="dt">T</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"covariance matrix used for the momentum"</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    M_init<span class="op">::</span><span class="dt">A</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notice how we’ve added the suffix <code>_init</code> to both the stepsize and the covariance matrix. We’ve done this because a <code>AbstractMCMC.AbstractSampler</code> should be <em>immutable</em>. Of course there might be many scenarios where we want to allow something like the stepsize and / or the covariance matrix to vary between iterations, e.g.&nbsp;during the burn-in / adaptation phase of the sampling process we might want to adjust the parameters using statistics computed from these initial iterations. But information which can change between iterations <em>should not go in the sampler itself</em>! Instead, this information should go in the sampler <em>state</em>.</p>
<p>The sampler state should at the very least contain all the necessary information to perform the next MCMC iteration, but usually contains further information, e.g.&nbsp;quantities and statistics useful for evaluating whether the sampler has converged.</p>
<p>We will use the following sampler state for our <code>MALA</code> sampler:</p>
<div id="14" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALAState{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This might seem overly redundant: we’re defining a type <code>MALAState</code> and it only contains a simple vector of reals. In this particular case we indeed could have dropped this and simply used a <code>AbstractVector{&lt;:Real}</code> as our sampler state, but typically, as we will see later, one wants to include other quantities in the sampler state. For example, if we also wanted to adapt the parameters of our <code>MALA</code>, e.g.&nbsp;alter the stepsize depending on acceptance rates, in which case we should also put <code>ϵ</code> in the state, but for now we’ll keep things simple.</p>
<p>Moreover, we also want a <em>sample</em> type, which is a type meant for “public consumption”, i.e.&nbsp;the end-user. This is generally going to contain a subset of the information present in the state. But in such a simple scenario as this, we similarly only have a <code>AbstractVector{&lt;:Real}</code>:</p>
<div id="16" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALASample{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We currently have three things:</p>
<ol type="1">
<li>A <code>AbstractMCMC.AbstractSampler</code> implementation called <code>MALA</code>.</li>
<li>A state <code>MALAState</code> for our sampler <code>MALA</code>.</li>
<li>A sample <code>MALASample</code> for our sampler <code>MALA</code>.</li>
</ol>
<p>That means that we’re ready to implement the only thing that really matters: <code>AbstractMCMC.step</code>.</p>
<p><code>AbstractMCMC.step</code> defines the MCMC iteration of our <code>MALA</code> given the current <code>MALAState</code>. Specifically, the signature of the function is as follows:</p>
<div id="18" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The RNG to ensure reproducibility.</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The model that defines our target.</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.AbstractModel</span>,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The sampler for which we're taking a `step`.</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">AbstractMCMC.AbstractSampler</span>,</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The current sampler `state`.</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    state;</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Additional keyword arguments that we may or may not need.</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Moreover, there is a specific <code>AbstractMCMC.AbstractModel</code> which is used to indicate that the model that is provided implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface: <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Since, as we discussed earlier, in our case we’re indeed going to work with types that support the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, we’ll define <code>AbstractMCMC.step</code> for such a <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Note that <code>AbstractMCMC.LogDensityModel</code> has no other purpose; it has a single field called <code>logdensity</code>, and it does nothing else. But by wrapping the model in <code>AbstractMCMC.LogDensityModel</code>, it allows samplers that want to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> to define their <code>AbstractMCMC.step</code> on this type without running into method ambiguities.</p>
<p>All in all, that means that the signature for our <code>AbstractMCMC.step</code> is going to be the following:</p>
<div id="20" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># `LogDensityModel` so we know we're working with LogDensityProblems.jl model.</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler.</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler state.</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Great! Now let’s actually implement the full <code>AbstractMCMC.step</code> for our <code>MALA</code>.</p>
<p>Let’s remind ourselves what we’re going to do:</p>
<ol type="1">
<li>Sample a new momentum <span class="math inline">\(p\)</span>.</li>
<li>Compute the log-density of the extended target <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>Take a single leapfrog step <span class="math inline">\((\tilde{x}, \tilde{p}) = L_{\epsilon}(x, p)\)</span>.</li>
<li>Accept or reject the proposed <span class="math inline">\((\tilde{x}, \tilde{p})\)</span>.</li>
</ol>
<p>All in all, this results in the following:</p>
<div id="22" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>: Random</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Distributions</span>  <span class="co"># so we get the `MvNormal`</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the wrapped model which implements LogDensityProblems.jl.</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just extract the sampler parameters to make our lives easier.</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    ϵ <span class="op">=</span> sampler.ϵ_init</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    M <span class="op">=</span> sampler.M_init</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the current parameters.</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> state.x</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sample the momentum.</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>    p_dist <span class="op">=</span> <span class="fu">MvNormal</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)), M)</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> <span class="fu">rand</span>(rng, p_dist)</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Propose using a single leapfrog step.</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>    x̃, p̃ <span class="op">=</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Accept or reject proposal.</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>    logp <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p)</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>    logp̃ <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x̃) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p̃)</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>    logα <span class="op">=</span> logp̃ <span class="op">-</span> logp</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>    state_new <span class="op">=</span> <span class="cf">if</span> <span class="fu">log</span>(<span class="fu">rand</span>(rng)) <span class="op">&lt;</span> logα</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Accept.</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x̃)</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Reject.</span></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x)</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return the "sample" and the sampler state.</span></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(state_new.x), state_new</span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Fairly straight-forward.</p>
<p>Of course, we haven’t defined the <code>leapfrog_step</code> method yet, so let’s do that:</p>
<div id="24" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p` using "position" `x`.</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x))</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    p1 <span class="op">=</span> p <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update the "position" `x` using momentum `p1`.</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    x̃ <span class="op">=</span> x <span class="op">+</span> ϵ <span class="op">.*</span> (M <span class="op">\</span> p1)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p1` using position `x̃`</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x̃ <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x̃))</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    p2 <span class="op">=</span> p1 <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x̃</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Flip momentum `p2`.</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    p̃ <span class="op">=</span> <span class="op">-</span>p2</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x̃, p̃</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>leapfrog_step (generic function with 1 method)</code></pre>
</div>
</div>
<p>With all of this, we’re technically ready to sample!</p>
<div id="26" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>, <span class="bu">LinearAlgebra</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>rng <span class="op">=</span> <span class="bu">Random</span>.<span class="fu">default_rng</span>()</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>sampler <span class="op">=</span> <span class="fu">MALA</span>(<span class="fl">1</span>, I)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>state <span class="op">=</span> <span class="fu">MALAState</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)))</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>x_next, state_next <span class="op">=</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    rng,</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    AbstractMCMC.<span class="fu">LogDensityModel</span>(model),</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    state</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>(MALASample{Vector{Float64}}([0.0, 0.0, 0.0]), MALAState{Vector{Float64}}([0.0, 0.0, 0.0]))</code></pre>
</div>
</div>
<p>Great, it works!</p>
<p>And I promised we would get quite some functionality for free if we implemented <code>AbstractMCMC.step</code>, and so we can now simply call <code>sample</code> to perform standard MCMC sampling:</p>
<div id="28" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform 1000 iterations with our `MALA` sampler.</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; initial_state<span class="op">=</span>state, progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Concatenate into a matrix.</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000 Matrix{Float64}:
 -3.00892  -3.00892  -4.05164  -4.05164  …  -6.09058   -3.91328   -4.77144
 -1.8039   -1.8039   -1.26381  -1.26381     -0.954175  -0.560634   0.0996433
  4.53122   4.53122   6.31278   6.31278      5.06316    5.74518    5.66471</code></pre>
</div>
</div>
<div id="30" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the marginal means and standard deviations.</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -4.99407    0.996739
  0.0277761  0.988044
  4.9972     0.997733</code></pre>
</div>
</div>
<p>Let’s visualize the samples</p>
<div id="32" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">StatsPlots</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">transpose</span>(samples_matrix[<span class="op">:</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">:</span><span class="kw">end</span>]), alpha<span class="op">=</span><span class="fl">0.5</span>, legend<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<!--?xml version="1.0" encoding="utf-8"?-->
<svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" width="672" height="480" viewbox="0 0 2688 1920">
<defs>
  <clippath id="clip080">
    <rect x="0" y="0" width="2688" height="1920"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip080)" d="M0 1920 L2688 1920 L2688 0 L0 0  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip081">
    <rect x="537" y="0" width="1883" height="1883"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip080)" d="M151.747 1800.78 L2640.76 1800.78 L2640.76 47.2441 L151.747 47.2441  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip082">
    <rect x="151" y="47" width="2490" height="1755"></rect>
  </clippath>
</defs>
<polyline clip-path="url(#clip082)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="219.84,1800.78 219.84,47.2441 "></polyline>
<polyline clip-path="url(#clip082)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="807.458,1800.78 807.458,47.2441 "></polyline>
<polyline clip-path="url(#clip082)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1395.08,1800.78 1395.08,47.2441 "></polyline>
<polyline clip-path="url(#clip082)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1982.69,1800.78 1982.69,47.2441 "></polyline>
<polyline clip-path="url(#clip082)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="2570.31,1800.78 2570.31,47.2441 "></polyline>
<polyline clip-path="url(#clip082)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,1508.77 2640.76,1508.77 "></polyline>
<polyline clip-path="url(#clip082)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,1204.24 2640.76,1204.24 "></polyline>
<polyline clip-path="url(#clip082)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,899.722 2640.76,899.722 "></polyline>
<polyline clip-path="url(#clip082)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,595.201 2640.76,595.201 "></polyline>
<polyline clip-path="url(#clip082)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,290.679 2640.76,290.679 "></polyline>
<polyline clip-path="url(#clip080)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1800.78 2640.76,1800.78 "></polyline>
<polyline clip-path="url(#clip080)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="219.84,1800.78 219.84,1781.88 "></polyline>
<polyline clip-path="url(#clip080)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="807.458,1800.78 807.458,1781.88 "></polyline>
<polyline clip-path="url(#clip080)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1395.08,1800.78 1395.08,1781.88 "></polyline>
<polyline clip-path="url(#clip080)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1982.69,1800.78 1982.69,1781.88 "></polyline>
<polyline clip-path="url(#clip080)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="2570.31,1800.78 2570.31,1781.88 "></polyline>
<path clip-path="url(#clip080)" d="M219.84 1834 Q216.229 1834 214.4 1837.57 Q212.595 1841.11 212.595 1848.24 Q212.595 1855.34 214.4 1858.91 Q216.229 1862.45 219.84 1862.45 Q223.474 1862.45 225.28 1858.91 Q227.108 1855.34 227.108 1848.24 Q227.108 1841.11 225.28 1837.57 Q223.474 1834 219.84 1834 M219.84 1830.3 Q225.65 1830.3 228.706 1834.9 Q231.784 1839.49 231.784 1848.24 Q231.784 1856.96 228.706 1861.57 Q225.65 1866.15 219.84 1866.15 Q214.03 1866.15 210.951 1861.57 Q207.896 1856.96 207.896 1848.24 Q207.896 1839.49 210.951 1834.9 Q214.03 1830.3 219.84 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip080)" d="M771.15 1861.55 L787.47 1861.55 L787.47 1865.48 L765.525 1865.48 L765.525 1861.55 Q768.187 1858.79 772.771 1854.16 Q777.377 1849.51 778.558 1848.17 Q780.803 1845.65 781.683 1843.91 Q782.585 1842.15 782.585 1840.46 Q782.585 1837.71 780.641 1835.97 Q778.72 1834.23 775.618 1834.23 Q773.419 1834.23 770.965 1835 Q768.535 1835.76 765.757 1837.31 L765.757 1832.59 Q768.581 1831.46 771.035 1830.88 Q773.488 1830.3 775.525 1830.3 Q780.896 1830.3 784.09 1832.98 Q787.285 1835.67 787.285 1840.16 Q787.285 1842.29 786.474 1844.21 Q785.687 1846.11 783.581 1848.7 Q783.002 1849.37 779.9 1852.59 Q776.798 1855.78 771.15 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip080)" d="M797.331 1830.92 L815.687 1830.92 L815.687 1834.86 L801.613 1834.86 L801.613 1843.33 Q802.632 1842.98 803.65 1842.82 Q804.669 1842.64 805.687 1842.64 Q811.474 1842.64 814.854 1845.81 Q818.233 1848.98 818.233 1854.4 Q818.233 1859.97 814.761 1863.08 Q811.289 1866.15 804.97 1866.15 Q802.794 1866.15 800.525 1865.78 Q798.28 1865.41 795.872 1864.67 L795.872 1859.97 Q797.956 1861.11 800.178 1861.66 Q802.4 1862.22 804.877 1862.22 Q808.882 1862.22 811.22 1860.11 Q813.558 1858.01 813.558 1854.4 Q813.558 1850.78 811.22 1848.68 Q808.882 1846.57 804.877 1846.57 Q803.002 1846.57 801.127 1846.99 Q799.275 1847.4 797.331 1848.28 L797.331 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip080)" d="M837.446 1834 Q833.835 1834 832.007 1837.57 Q830.201 1841.11 830.201 1848.24 Q830.201 1855.34 832.007 1858.91 Q833.835 1862.45 837.446 1862.45 Q841.081 1862.45 842.886 1858.91 Q844.715 1855.34 844.715 1848.24 Q844.715 1841.11 842.886 1837.57 Q841.081 1834 837.446 1834 M837.446 1830.3 Q843.256 1830.3 846.312 1834.9 Q849.391 1839.49 849.391 1848.24 Q849.391 1856.96 846.312 1861.57 Q843.256 1866.15 837.446 1866.15 Q831.636 1866.15 828.557 1861.57 Q825.502 1856.96 825.502 1848.24 Q825.502 1839.49 828.557 1834.9 Q831.636 1830.3 837.446 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip080)" d="M1354.69 1830.92 L1373.05 1830.92 L1373.05 1834.86 L1358.98 1834.86 L1358.98 1843.33 Q1360 1842.98 1361.01 1842.82 Q1362.03 1842.64 1363.05 1842.64 Q1368.84 1842.64 1372.22 1845.81 Q1375.6 1848.98 1375.6 1854.4 Q1375.6 1859.97 1372.12 1863.08 Q1368.65 1866.15 1362.33 1866.15 Q1360.16 1866.15 1357.89 1865.78 Q1355.64 1865.41 1353.24 1864.67 L1353.24 1859.97 Q1355.32 1861.11 1357.54 1861.66 Q1359.76 1862.22 1362.24 1862.22 Q1366.25 1862.22 1368.58 1860.11 Q1370.92 1858.01 1370.92 1854.4 Q1370.92 1850.78 1368.58 1848.68 Q1366.25 1846.57 1362.24 1846.57 Q1360.37 1846.57 1358.49 1846.99 Q1356.64 1847.4 1354.69 1848.28 L1354.69 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip080)" d="M1394.81 1834 Q1391.2 1834 1389.37 1837.57 Q1387.56 1841.11 1387.56 1848.24 Q1387.56 1855.34 1389.37 1858.91 Q1391.2 1862.45 1394.81 1862.45 Q1398.44 1862.45 1400.25 1858.91 Q1402.08 1855.34 1402.08 1848.24 Q1402.08 1841.11 1400.25 1837.57 Q1398.44 1834 1394.81 1834 M1394.81 1830.3 Q1400.62 1830.3 1403.68 1834.9 Q1406.75 1839.49 1406.75 1848.24 Q1406.75 1856.96 1403.68 1861.57 Q1400.62 1866.15 1394.81 1866.15 Q1389 1866.15 1385.92 1861.57 Q1382.87 1856.96 1382.87 1848.24 Q1382.87 1839.49 1385.92 1834.9 Q1389 1830.3 1394.81 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip080)" d="M1424.97 1834 Q1421.36 1834 1419.53 1837.57 Q1417.73 1841.11 1417.73 1848.24 Q1417.73 1855.34 1419.53 1858.91 Q1421.36 1862.45 1424.97 1862.45 Q1428.61 1862.45 1430.41 1858.91 Q1432.24 1855.34 1432.24 1848.24 Q1432.24 1841.11 1430.41 1837.57 Q1428.61 1834 1424.97 1834 M1424.97 1830.3 Q1430.78 1830.3 1433.84 1834.9 Q1436.92 1839.49 1436.92 1848.24 Q1436.92 1856.96 1433.84 1861.57 Q1430.78 1866.15 1424.97 1866.15 Q1419.16 1866.15 1416.08 1861.57 Q1413.03 1856.96 1413.03 1848.24 Q1413.03 1839.49 1416.08 1834.9 Q1419.16 1830.3 1424.97 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip080)" d="M1940.97 1830.92 L1963.19 1830.92 L1963.19 1832.91 L1950.65 1865.48 L1945.76 1865.48 L1957.57 1834.86 L1940.97 1834.86 L1940.97 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip080)" d="M1972.36 1830.92 L1990.71 1830.92 L1990.71 1834.86 L1976.64 1834.86 L1976.64 1843.33 Q1977.66 1842.98 1978.68 1842.82 Q1979.7 1842.64 1980.72 1842.64 Q1986.5 1842.64 1989.88 1845.81 Q1993.26 1848.98 1993.26 1854.4 Q1993.26 1859.97 1989.79 1863.08 Q1986.32 1866.15 1980 1866.15 Q1977.82 1866.15 1975.55 1865.78 Q1973.31 1865.41 1970.9 1864.67 L1970.9 1859.97 Q1972.98 1861.11 1975.21 1861.66 Q1977.43 1862.22 1979.9 1862.22 Q1983.91 1862.22 1986.25 1860.11 Q1988.59 1858.01 1988.59 1854.4 Q1988.59 1850.78 1986.25 1848.68 Q1983.91 1846.57 1979.9 1846.57 Q1978.03 1846.57 1976.15 1846.99 Q1974.3 1847.4 1972.36 1848.28 L1972.36 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip080)" d="M2012.47 1834 Q2008.86 1834 2007.03 1837.57 Q2005.23 1841.11 2005.23 1848.24 Q2005.23 1855.34 2007.03 1858.91 Q2008.86 1862.45 2012.47 1862.45 Q2016.11 1862.45 2017.91 1858.91 Q2019.74 1855.34 2019.74 1848.24 Q2019.74 1841.11 2017.91 1837.57 Q2016.11 1834 2012.47 1834 M2012.47 1830.3 Q2018.28 1830.3 2021.34 1834.9 Q2024.42 1839.49 2024.42 1848.24 Q2024.42 1856.96 2021.34 1861.57 Q2018.28 1866.15 2012.47 1866.15 Q2006.66 1866.15 2003.59 1861.57 Q2000.53 1856.96 2000.53 1848.24 Q2000.53 1839.49 2003.59 1834.9 Q2006.66 1830.3 2012.47 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip080)" d="M2514.84 1861.55 L2522.48 1861.55 L2522.48 1835.18 L2514.17 1836.85 L2514.17 1832.59 L2522.43 1830.92 L2527.11 1830.92 L2527.11 1861.55 L2534.75 1861.55 L2534.75 1865.48 L2514.84 1865.48 L2514.84 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip080)" d="M2554.19 1834 Q2550.58 1834 2548.75 1837.57 Q2546.94 1841.11 2546.94 1848.24 Q2546.94 1855.34 2548.75 1858.91 Q2550.58 1862.45 2554.19 1862.45 Q2557.82 1862.45 2559.63 1858.91 Q2561.46 1855.34 2561.46 1848.24 Q2561.46 1841.11 2559.63 1837.57 Q2557.82 1834 2554.19 1834 M2554.19 1830.3 Q2560 1830.3 2563.06 1834.9 Q2566.13 1839.49 2566.13 1848.24 Q2566.13 1856.96 2563.06 1861.57 Q2560 1866.15 2554.19 1866.15 Q2548.38 1866.15 2545.3 1861.57 Q2542.25 1856.96 2542.25 1848.24 Q2542.25 1839.49 2545.3 1834.9 Q2548.38 1830.3 2554.19 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip080)" d="M2584.35 1834 Q2580.74 1834 2578.91 1837.57 Q2577.11 1841.11 2577.11 1848.24 Q2577.11 1855.34 2578.91 1858.91 Q2580.74 1862.45 2584.35 1862.45 Q2587.99 1862.45 2589.79 1858.91 Q2591.62 1855.34 2591.62 1848.24 Q2591.62 1841.11 2589.79 1837.57 Q2587.99 1834 2584.35 1834 M2584.35 1830.3 Q2590.16 1830.3 2593.22 1834.9 Q2596.3 1839.49 2596.3 1848.24 Q2596.3 1856.96 2593.22 1861.57 Q2590.16 1866.15 2584.35 1866.15 Q2578.54 1866.15 2575.46 1861.57 Q2572.41 1856.96 2572.41 1848.24 Q2572.41 1839.49 2575.46 1834.9 Q2578.54 1830.3 2584.35 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip080)" d="M2614.51 1834 Q2610.9 1834 2609.07 1837.57 Q2607.27 1841.11 2607.27 1848.24 Q2607.27 1855.34 2609.07 1858.91 Q2610.9 1862.45 2614.51 1862.45 Q2618.15 1862.45 2619.95 1858.91 Q2621.78 1855.34 2621.78 1848.24 Q2621.78 1841.11 2619.95 1837.57 Q2618.15 1834 2614.51 1834 M2614.51 1830.3 Q2620.32 1830.3 2623.38 1834.9 Q2626.46 1839.49 2626.46 1848.24 Q2626.46 1856.96 2623.38 1861.57 Q2620.32 1866.15 2614.51 1866.15 Q2608.7 1866.15 2605.62 1861.57 Q2602.57 1856.96 2602.57 1848.24 Q2602.57 1839.49 2605.62 1834.9 Q2608.7 1830.3 2614.51 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip080)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1800.78 151.747,47.2441 "></polyline>
<polyline clip-path="url(#clip080)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1508.77 170.644,1508.77 "></polyline>
<polyline clip-path="url(#clip080)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1204.24 170.644,1204.24 "></polyline>
<polyline clip-path="url(#clip080)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,899.722 170.644,899.722 "></polyline>
<polyline clip-path="url(#clip080)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,595.201 170.644,595.201 "></polyline>
<polyline clip-path="url(#clip080)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,290.679 170.644,290.679 "></polyline>
<path clip-path="url(#clip080)" d="M49.5521 1509.22 L79.2279 1509.22 L79.2279 1513.15 L49.5521 1513.15 L49.5521 1509.22 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip080)" d="M99.8991 1506.9 Q96.7509 1506.9 94.8991 1509.05 Q93.0704 1511.21 93.0704 1514.96 Q93.0704 1518.68 94.8991 1520.86 Q96.7509 1523.01 99.8991 1523.01 Q103.047 1523.01 104.876 1520.86 Q106.728 1518.68 106.728 1514.96 Q106.728 1511.21 104.876 1509.05 Q103.047 1506.9 99.8991 1506.9 M109.181 1492.25 L109.181 1496.51 Q107.422 1495.67 105.617 1495.24 Q103.834 1494.8 102.075 1494.8 Q97.4454 1494.8 94.9917 1497.92 Q92.5612 1501.05 92.2139 1507.36 Q93.5797 1505.35 95.6398 1504.29 Q97.7 1503.2 100.177 1503.2 Q105.385 1503.2 108.394 1506.37 Q111.427 1509.52 111.427 1514.96 Q111.427 1520.28 108.279 1523.5 Q105.131 1526.72 99.8991 1526.72 Q93.9037 1526.72 90.7325 1522.13 Q87.5612 1517.53 87.5612 1508.8 Q87.5612 1500.61 91.45 1495.74 Q95.3389 1490.86 101.89 1490.86 Q103.649 1490.86 105.431 1491.21 Q107.237 1491.55 109.181 1492.25 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip080)" d="M50.3623 1204.69 L80.0381 1204.69 L80.0381 1208.63 L50.3623 1208.63 L50.3623 1204.69 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip080)" d="M104.297 1202.89 Q107.654 1203.61 109.529 1205.88 Q111.427 1208.14 111.427 1211.48 Q111.427 1216.59 107.908 1219.39 Q104.39 1222.19 97.9083 1222.19 Q95.7324 1222.19 93.4176 1221.76 Q91.126 1221.34 88.6723 1220.48 L88.6723 1215.97 Q90.6167 1217.1 92.9315 1217.68 Q95.2463 1218.26 97.7695 1218.26 Q102.168 1218.26 104.459 1216.52 Q106.774 1214.79 106.774 1211.48 Q106.774 1208.42 104.621 1206.71 Q102.492 1204.97 98.6722 1204.97 L94.6445 1204.97 L94.6445 1201.13 L98.8574 1201.13 Q102.306 1201.13 104.135 1199.76 Q105.964 1198.38 105.964 1195.78 Q105.964 1193.12 104.066 1191.71 Q102.191 1190.27 98.6722 1190.27 Q96.7509 1190.27 94.5519 1190.69 Q92.3528 1191.11 89.7139 1191.99 L89.7139 1187.82 Q92.376 1187.08 94.6908 1186.71 Q97.0287 1186.34 99.0889 1186.34 Q104.413 1186.34 107.515 1188.77 Q110.617 1191.18 110.617 1195.3 Q110.617 1198.17 108.973 1200.16 Q107.33 1202.13 104.297 1202.89 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip080)" d="M99.4824 885.521 Q95.8713 885.521 94.0426 889.086 Q92.2371 892.627 92.2371 899.757 Q92.2371 906.863 94.0426 910.428 Q95.8713 913.97 99.4824 913.97 Q103.117 913.97 104.922 910.428 Q106.751 906.863 106.751 899.757 Q106.751 892.627 104.922 889.086 Q103.117 885.521 99.4824 885.521 M99.4824 881.817 Q105.293 881.817 108.348 886.424 Q111.427 891.007 111.427 899.757 Q111.427 908.484 108.348 913.09 Q105.293 917.673 99.4824 917.673 Q93.6723 917.673 90.5936 913.09 Q87.538 908.484 87.538 899.757 Q87.538 891.007 90.5936 886.424 Q93.6723 881.817 99.4824 881.817 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip080)" d="M104.297 593.846 Q107.654 594.564 109.529 596.833 Q111.427 599.101 111.427 602.434 Q111.427 607.55 107.908 610.351 Q104.39 613.152 97.9083 613.152 Q95.7324 613.152 93.4176 612.712 Q91.126 612.295 88.6723 611.439 L88.6723 606.925 Q90.6167 608.059 92.9315 608.638 Q95.2463 609.217 97.7695 609.217 Q102.168 609.217 104.459 607.481 Q106.774 605.745 106.774 602.434 Q106.774 599.379 104.621 597.666 Q102.492 595.93 98.6722 595.93 L94.6445 595.93 L94.6445 592.087 L98.8574 592.087 Q102.306 592.087 104.135 590.721 Q105.964 589.333 105.964 586.74 Q105.964 584.078 104.066 582.666 Q102.191 581.231 98.6722 581.231 Q96.7509 581.231 94.5519 581.647 Q92.3528 582.064 89.7139 582.944 L89.7139 578.777 Q92.376 578.036 94.6908 577.666 Q97.0287 577.296 99.0889 577.296 Q104.413 577.296 107.515 579.726 Q110.617 582.134 110.617 586.254 Q110.617 589.124 108.973 591.115 Q107.33 593.083 104.297 593.846 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip080)" d="M99.8991 288.816 Q96.7509 288.816 94.8991 290.969 Q93.0704 293.121 93.0704 296.871 Q93.0704 300.598 94.8991 302.774 Q96.7509 304.927 99.8991 304.927 Q103.047 304.927 104.876 302.774 Q106.728 300.598 106.728 296.871 Q106.728 293.121 104.876 290.969 Q103.047 288.816 99.8991 288.816 M109.181 274.163 L109.181 278.422 Q107.422 277.589 105.617 277.149 Q103.834 276.709 102.075 276.709 Q97.4454 276.709 94.9917 279.834 Q92.5612 282.959 92.2139 289.279 Q93.5797 287.265 95.6398 286.2 Q97.7 285.112 100.177 285.112 Q105.385 285.112 108.394 288.283 Q111.427 291.431 111.427 296.871 Q111.427 302.195 108.279 305.413 Q105.131 308.63 99.8991 308.63 Q93.9037 308.63 90.7325 304.047 Q87.5612 299.441 87.5612 290.714 Q87.5612 282.519 91.45 277.658 Q95.3389 272.774 101.89 272.774 Q103.649 272.774 105.431 273.121 Q107.237 273.469 109.181 274.163 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip082)" style="stroke:#009af9; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,1205.15 224.541,1331.21 226.891,1459.02 229.242,1385.33 231.592,1539.64 233.943,1483.24 236.293,1171.54 238.644,1231.88 240.994,1440.28 243.345,1416.64 245.695,1399.61 248.046,1262.68 250.396,1423.24 252.747,1404.93 255.097,1400.72 257.448,1455.69 259.798,1442.31 262.148,1332.9 264.499,1254.02 266.849,1401.19 269.2,1528.04 271.55,1422.76 273.901,1270.31 276.251,1279.5 278.602,1323.49 280.952,1388.95 283.303,1286.38 285.653,1244.49 288.004,1237.08 290.354,1398.53 292.705,1655.74 295.055,1353.92 297.406,1444.57 299.756,1386.29 302.107,1369.84 304.457,1525.56 306.807,1345.72 309.158,1255.61 311.508,1473.14 313.859,1271 316.209,1347.34 318.56,1313.76 320.91,1286.38 323.261,1357.57 325.611,1385.49 327.962,1294.44 330.312,1408.25 332.663,1486.84 335.013,1289.64 337.364,1472.59 339.714,1243.48 342.065,1578.62 344.415,1366.71 346.765,1329.49 349.116,1132.08 351.466,1312.95 353.817,1467.34 356.167,1344.9 358.518,1407.52 360.868,1550.62 363.219,1308.72 365.569,1332.58 367.92,1501.4 370.27,1422.28 372.621,1524.93 374.971,1439.8 377.322,1434.66 379.672,1300.83 382.023,1499.77 384.373,1376.37 386.724,1436.19 389.074,1243.46 391.424,1439.46 393.775,1580.8 396.125,1496.9 398.476,1543 400.826,1360.51 403.177,1266.33 405.527,1368.52 407.878,1308.32 410.228,1341.72 412.579,1565.73 414.929,1458.41 417.28,1539.17 419.63,1366.81 421.981,1459.85 424.331,1377.27 426.682,1320.43 429.032,1278.09 431.382,1421.72 433.733,1358.29 436.083,1518.1 438.434,1391.44 440.784,1381.25 443.135,1497.67 445.485,1424.04 447.836,1408.8 450.186,1346.5 452.537,1361.28 454.887,1249.79 457.238,1396.27 459.588,1332.88 461.939,1317.81 464.289,1238.72 466.64,1407.87 468.99,1508.89 471.341,1201.8 473.691,1457.55 476.041,1434.28 478.392,1608.44 480.742,1398.63 483.093,1348.43 485.443,1494.48 487.794,1495.45 490.144,1308.07 492.495,1177.08 494.845,1491.78 497.196,1435.36 499.546,1484.21 501.897,1301.89 504.247,1516.24 506.598,1322.83 508.948,1559.61 511.299,1492.43 513.649,1403.11 515.999,1455.45 518.35,1265.39 520.7,1385.15 523.051,1546.46 525.401,1499.36 527.752,1495.33 530.102,1303.48 532.453,1359.07 534.803,1445.78 537.154,1328.49 539.504,1443.53 541.855,1373.72 544.205,1438.68 546.556,1266.15 548.906,1432.92 551.257,1369.07 553.607,1444.8 555.958,1454.11 558.308,1482.07 560.658,1557.49 563.009,1466.47 565.359,1296.5 567.71,1284.01 570.06,1393.93 572.411,1400.45 574.761,1307.43 577.112,1354.83 579.462,1449.4 581.813,1390.98 584.163,1400.35 586.514,1412.3 588.864,1356.5 591.215,1370.77 593.565,1509.7 595.916,1383.68 598.266,1303.63 600.616,1394.03 602.967,1398.9 605.317,1350.49 607.668,1337.86 610.018,1338.12 612.369,1282.93 614.719,1365.88 617.07,1419.57 619.42,1316.05 621.771,1324.98 624.121,1277.24 626.472,1427.54 628.822,1525.71 631.173,1554.62 633.523,1524.5 635.874,1495.49 638.224,1514.68 640.575,1128.62 642.925,1435.83 645.275,1422.01 647.626,1425.85 649.976,1502.41 652.327,1224.82 654.677,1458 657.028,1387.58 659.378,1349.12 661.729,1462.84 664.079,1415.25 666.43,1579.74 668.78,1538.52 671.131,1307.15 673.481,1489.66 675.832,1400.4 678.182,1396.85 680.533,1288.1 682.883,1252.3 685.233,1220.13 687.584,1270.4 689.934,1403.26 692.285,1470.46 694.635,1200.36 696.986,1481.74 699.336,1244.51 701.687,1585.7 704.037,1380.31 706.388,1328.73 708.738,1396.8 711.089,1506.09 713.439,1486.09 715.79,1390.25 718.14,1523.75 720.491,1572.11 722.841,1432.83 725.192,1471.36 727.542,1244.42 729.892,1432.96 732.243,1472.81 734.593,1341.8 736.944,1350.72 739.294,1152.5 741.645,1331.68 743.995,1345.14 746.346,1276.62 748.696,1371.32 751.047,1454.56 753.397,1277.89 755.748,1560.22 758.098,1573.3 760.449,1622.21 762.799,1273.85 765.15,1576.92 767.5,1336.05 769.85,1350.89 772.201,1406.64 774.551,1465.75 776.902,1382.55 779.252,1598.74 781.603,1368.26 783.953,1391.24 786.304,1465.56 788.654,1241.61 791.005,1343.48 793.355,1524.86 795.706,1296.34 798.056,1366.09 800.407,1417.92 802.757,1491.97 805.108,1382.73 807.458,1355.48 809.809,1378.59 812.159,1451.76 814.509,1303.96 816.86,1499.94 819.21,1353.57 821.561,1480.75 823.911,1420.2 826.262,1362.45 828.612,1372.28 830.963,1384.76 833.313,1499.59 835.664,1352.57 838.014,1429.86 840.365,1467.56 842.715,1363.39 845.066,1312.22 847.416,1260.58 849.767,1547.47 852.117,1465.34 854.467,1469.67 856.818,1256.24 859.168,1510.41 861.519,1404.19 863.869,1492.89 866.22,1266.48 868.57,1394.38 870.921,1339.45 873.271,1463.83 875.622,1331.33 877.972,1373.39 880.323,1527.35 882.673,1355.78 885.024,1360.58 887.374,1298.58 889.725,1422.03 892.075,1486.67 894.426,1346.91 896.776,1251.72 899.126,1363.54 901.477,1469.54 903.827,1345.71 906.178,1397.46 908.528,1528.08 910.879,1416.55 913.229,1366.99 915.58,1316.85 917.93,1466.77 920.281,1420.44 922.631,1347.16 924.982,1452.56 927.332,1159.24 929.683,1329.98 932.033,1373.31 934.384,1559.62 936.734,1632.28 939.084,1506.94 941.435,1300.51 943.785,1277.07 946.136,1273.59 948.486,1384.64 950.837,1375.73 953.187,1458.69 955.538,1636.12 957.888,1429.74 960.239,1372.91 962.589,1530.89 964.94,1431.1 967.29,1452.74 969.641,1376.47 971.991,1295.34 974.342,1275.96 976.692,1456.92 979.043,1332.66 981.393,1297.36 983.743,1483.91 986.094,1556.42 988.444,1574.18 990.795,1541.87 993.145,1304.06 995.496,1592.44 997.846,1221.06 1000.2,1271.26 1002.55,1373.55 1004.9,1534.19 1007.25,1197.79 1009.6,1340.36 1011.95,1492.76 1014.3,1468.63 1016.65,1520.6 1019,1466.71 1021.35,1423.17 1023.7,1458.38 1026.05,1308.14 1028.4,1429.35 1030.75,1358.17 1033.1,1465.74 1035.45,1478.44 1037.8,1400.26 1040.15,1665.15 1042.51,1276.83 1044.86,1403.2 1047.21,1483.88 1049.56,1265.14 1051.91,1445.19 1054.26,1465.96 1056.61,1561.25 1058.96,1253.32 1061.31,1594.74 1063.66,1561.14 1066.01,1565.54 1068.36,1397.09 1070.71,1400.4 1073.06,1369.32 1075.41,1386.39 1077.76,1374.79 1080.11,1487.86 1082.46,1486.03 1084.81,1328.38 1087.16,1353.56 1089.51,1294.44 1091.87,1483.09 1094.22,1343.45 1096.57,1368.51 1098.92,1316.34 1101.27,1397.61 1103.62,1346.37 1105.97,1423.81 1108.32,1494.27 1110.67,1369.38 1113.02,1211.41 1115.37,1295.04 1117.72,1508.14 1120.07,1328.6 1122.42,1329.65 1124.77,1411.76 1127.12,1416.18 1129.47,1362.18 1131.82,1472.62 1134.17,1512.23 1136.52,1347.7 1138.87,1332.6 1141.23,1397.13 1143.58,1601.49 1145.93,1476.42 1148.28,1499.34 1150.63,1405.61 1152.98,1345.99 1155.33,1360.05 1157.68,1400.85 1160.03,1486.48 1162.38,1606.92 1164.73,1399.83 1167.08,1547.51 1169.43,1404.44 1171.78,1398.8 1174.13,1500.11 1176.48,1496.19 1178.83,1291.09 1181.18,1423.34 1183.53,1492.91 1185.88,1347.46 1188.23,1568.64 1190.59,1366.46 1192.94,1509.31 1195.29,1429.79 1197.64,1285.2 1199.99,1372.44 1202.34,1458.35 1204.69,1619.12 1207.04,1261.05 1209.39,1535.09 1211.74,1580.52 1214.09,1597.58 1216.44,1272.08 1218.79,1285.7 1221.14,1540.12 1223.49,1285.2 1225.84,1621.35 1228.19,1636.88 1230.54,1417.24 1232.89,1468.59 1235.24,1454.16 1237.59,1486.06 1239.94,1418.72 1242.3,1220.6 1244.65,1456.17 1247,1333.48 1249.35,1312.02 1251.7,1450.61 1254.05,1285.33 1256.4,1284.95 1258.75,1292.99 1261.1,1547.11 1263.45,1329.92 1265.8,1437.35 1268.15,1262.15 1270.5,1270.05 1272.85,1479.67 1275.2,1521.74 1277.55,1484.19 1279.9,1289.71 1282.25,1319.56 1284.6,1370.05 1286.95,1450.91 1289.3,1400.08 1291.66,1503.96 1294.01,1204.2 1296.36,1433.67 1298.71,1379.48 1301.06,1332.06 1303.41,1264.57 1305.76,1312.93 1308.11,1451.15 1310.46,1402.45 1312.81,1512.62 1315.16,1409.63 1317.51,1509.95 1319.86,1595.74 1322.21,1242.26 1324.56,1424.56 1326.91,1360.39 1329.26,1292.5 1331.61,1288.93 1333.96,1437.42 1336.31,1626.76 1338.66,1488.05 1341.02,1337.3 1343.37,1386.52 1345.72,1379.97 1348.07,1472.59 1350.42,1306.92 1352.77,1511.48 1355.12,1326.63 1357.47,1440.77 1359.82,1573.46 1362.17,1397.02 1364.52,1403.36 1366.87,1414.3 1369.22,1389.61 1371.57,1394.69 1373.92,1339.37 1376.27,1409.87 1378.62,1525.59 1380.97,1297.28 1383.32,1394.31 1385.67,1426.8 1388.02,1446.98 1390.38,1402.41 1392.73,1347.16 1395.08,1397.05 1397.43,1367.24 1399.78,1340.9 1402.13,1276.34 1404.48,1751.15 1406.83,1521.17 1409.18,1344.24 1411.53,1366.59 1413.88,1430.32 1416.23,1468.33 1418.58,1304.09 1420.93,1383.1 1423.28,1655.81 1425.63,1408.13 1427.98,1512.57 1430.33,1523 1432.68,1295.75 1435.03,1471.39 1437.38,1398.95 1439.74,1416.22 1442.09,1564.47 1444.44,1451.83 1446.79,1335.73 1449.14,1202.32 1451.49,1583.62 1453.84,1302.89 1456.19,1416.4 1458.54,1491.88 1460.89,1471.68 1463.24,1513.84 1465.59,1512.99 1467.94,1569.79 1470.29,1562.17 1472.64,1520.32 1474.99,1620.37 1477.34,1557.31 1479.69,1390.7 1482.04,1615.71 1484.39,1409.69 1486.74,1365.52 1489.1,1451.13 1491.45,1395.88 1493.8,1331.7 1496.15,1417.94 1498.5,1406.32 1500.85,1557.96 1503.2,1218.96 1505.55,1514.23 1507.9,1500.26 1510.25,1503.14 1512.6,1150.86 1514.95,1524.32 1517.3,1510.59 1519.65,1395.34 1522,1565.09 1524.35,1267.57 1526.7,1540.2 1529.05,1469.13 1531.4,1314.51 1533.75,1379.62 1536.1,1396.3 1538.45,1482.36 1540.81,1464.83 1543.16,1497.64 1545.51,1412.63 1547.86,1456.95 1550.21,1413.85 1552.56,1423.22 1554.91,1284.21 1557.26,1426.31 1559.61,1420.9 1561.96,1400.84 1564.31,1566.67 1566.66,1376.16 1569.01,1428.25 1571.36,1479.22 1573.71,1272.66 1576.06,1371.67 1578.41,1506.78 1580.76,1369.78 1583.11,1410.24 1585.46,1216.74 1587.81,1414.84 1590.17,1550.29 1592.52,1452.32 1594.87,1357.59 1597.22,1708.44 1599.57,1464.77 1601.92,1465.38 1604.27,1500.54 1606.62,1361.47 1608.97,1479.3 1611.32,1325.38 1613.67,1486.73 1616.02,1478.5 1618.37,1515.28 1620.72,1331.35 1623.07,1468.24 1625.42,1461.65 1627.77,1394.15 1630.12,1467.2 1632.47,1382.32 1634.82,1467.11 1637.17,1322.09 1639.53,1385.98 1641.88,1402.69 1644.23,1267.47 1646.58,1460.93 1648.93,1554.46 1651.28,1407.12 1653.63,1518.62 1655.98,1447.5 1658.33,1585.7 1660.68,1380.03 1663.03,1446.63 1665.38,1226.67 1667.73,1521.22 1670.08,1564.8 1672.43,1259.3 1674.78,1443.76 1677.13,1293.28 1679.48,1451.37 1681.83,1522.29 1684.18,1405.24 1686.53,1452.77 1688.89,1331.92 1691.24,1400.78 1693.59,1339.87 1695.94,1458.06 1698.29,1422.84 1700.64,1458.47 1702.99,1272.33 1705.34,1319.82 1707.69,1274.75 1710.04,1374.61 1712.39,1500.57 1714.74,1464.62 1717.09,1553.95 1719.44,1392.89 1721.79,1233.5 1724.14,1462.47 1726.49,1431.36 1728.84,1337.67 1731.19,1461.25 1733.54,1490.95 1735.89,1527.27 1738.25,1294.7 1740.6,1500.53 1742.95,1143.67 1745.3,1545.31 1747.65,1381.27 1750,1446.32 1752.35,1427.2 1754.7,1336.41 1757.05,1321 1759.4,1496.9 1761.75,1308.82 1764.1,1474.08 1766.45,1522.93 1768.8,1270.12 1771.15,1581.36 1773.5,1575.97 1775.85,1472.81 1778.2,1486.21 1780.55,1459.82 1782.9,1416.8 1785.25,1442.62 1787.6,1407.72 1789.96,1507.22 1792.31,1512.89 1794.66,1472.84 1797.01,1447.12 1799.36,1260.56 1801.71,1354.31 1804.06,1277.2 1806.41,1344.04 1808.76,1545.79 1811.11,1691.12 1813.46,1477.29 1815.81,1317.88 1818.16,1294.17 1820.51,1363.29 1822.86,1487.85 1825.21,1381.78 1827.56,1430.6 1829.91,1283.49 1832.26,1238.33 1834.61,1390.12 1836.96,1391.05 1839.32,1464.62 1841.67,1530.63 1844.02,1346.86 1846.37,1584.28 1848.72,1315.46 1851.07,1311.25 1853.42,1226.56 1855.77,1530.3 1858.12,1443.58 1860.47,1480.78 1862.82,1421.51 1865.17,1662.95 1867.52,1325.36 1869.87,1163.39 1872.22,1344.45 1874.57,1429.27 1876.92,1285.27 1879.27,1420.42 1881.62,1544.72 1883.97,1291.09 1886.32,1418.25 1888.68,1537.49 1891.03,1379.24 1893.38,1247.96 1895.73,1441.67 1898.08,1385.7 1900.43,1461.43 1902.78,1437.13 1905.13,1301.54 1907.48,1379.33 1909.83,1531.89 1912.18,1444.51 1914.53,1411.19 1916.88,1458.04 1919.23,1389.77 1921.58,1602.21 1923.93,1375.09 1926.28,1450.1 1928.63,1434.55 1930.98,1381.9 1933.33,1280.74 1935.68,1427.28 1938.04,1392.12 1940.39,1386.58 1942.74,1280.28 1945.09,1519.79 1947.44,1440.85 1949.79,1417.25 1952.14,1421.83 1954.49,1419.3 1956.84,1415.4 1959.19,1321.03 1961.54,1256.26 1963.89,1350.25 1966.24,1426.23 1968.59,1425.63 1970.94,1404.46 1973.29,1466.24 1975.64,1314.28 1977.99,1296.52 1980.34,1614.27 1982.69,1219.44 1985.04,1503.04 1987.4,1404.61 1989.75,1453.97 1992.1,1440.68 1994.45,1435.17 1996.8,1366.19 1999.15,1467.45 2001.5,1582.38 2003.85,1470.19 2006.2,1305.17 2008.55,1335.43 2010.9,1464.27 2013.25,1433.46 2015.6,1540.91 2017.95,1187.63 2020.3,1519.01 2022.65,1472.91 2025,1429.12 2027.35,1574.2 2029.7,1680.88 2032.05,1390.11 2034.4,1442.72 2036.76,1330.84 2039.11,1406.62 2041.46,1434.67 2043.81,1432.09 2046.16,1431.03 2048.51,1438.98 2050.86,1466.06 2053.21,1531.72 2055.56,1304.6 2057.91,1268.68 2060.26,1351.63 2062.61,1340.09 2064.96,1536.64 2067.31,1348.5 2069.66,1704.75 2072.01,1417.82 2074.36,1283.13 2076.71,1538.97 2079.06,1381.98 2081.41,1493.38 2083.76,1363.46 2086.11,1467.09 2088.47,1429.49 2090.82,1449.35 2093.17,1367.67 2095.52,1458.9 2097.87,1512.75 2100.22,1311.92 2102.57,1468.53 2104.92,1602.29 2107.27,1399.39 2109.62,1523.47 2111.97,1288.29 2114.32,1293.01 2116.67,1281.9 2119.02,1461.64 2121.37,1469 2123.72,1495.47 2126.07,1393.37 2128.42,1524.37 2130.77,1442.4 2133.12,1261.59 2135.47,1450.31 2137.83,1477.41 2140.18,1426.35 2142.53,1410.43 2144.88,1530.13 2147.23,1522.36 2149.58,1394.31 2151.93,1437.91 2154.28,1353.43 2156.63,1552.24 2158.98,1443 2161.33,1575.25 2163.68,1468.21 2166.03,1470.12 2168.38,1336.05 2170.73,1420.89 2173.08,1271.58 2175.43,1298.88 2177.78,1262.85 2180.13,1363.95 2182.48,1397.55 2184.83,1411.06 2187.19,1281.25 2189.54,1379.34 2191.89,1294 2194.24,1490.3 2196.59,1301.65 2198.94,1337.25 2201.29,1222.67 2203.64,1357.7 2205.99,1255.11 2208.34,1473.42 2210.69,1475.58 2213.04,1508.56 2215.39,1371.03 2217.74,1417.47 2220.09,1372.63 2222.44,1484.93 2224.79,1414.7 2227.14,1531.91 2229.49,1433.4 2231.84,1563.06 2234.19,1614.28 2236.55,1558.59 2238.9,1450.35 2241.25,1451.01 2243.6,1353.45 2245.95,1522.25 2248.3,1265.41 2250.65,1234.93 2253,1551.12 2255.35,1406.98 2257.7,1286.68 2260.05,1569.37 2262.4,1456.8 2264.75,1372.69 2267.1,1463.17 2269.45,1448.4 2271.8,1472.32 2274.15,1507.97 2276.5,1345.13 2278.85,1474.99 2281.2,1492.13 2283.55,1457.76 2285.91,1511.73 2288.26,1365.73 2290.61,1465.2 2292.96,1324.56 2295.31,1420.75 2297.66,1384.69 2300.01,1422.11 2302.36,1527.62 2304.71,1328.22 2307.06,1440.68 2309.41,1362.44 2311.76,1556.76 2314.11,1370.95 2316.46,1448.3 2318.81,1260.4 2321.16,1392.66 2323.51,1468.8 2325.86,1549.78 2328.21,1421.97 2330.56,1417.91 2332.91,1491.92 2335.27,1414.63 2337.62,1608.85 2339.97,1323.17 2342.32,1288.37 2344.67,1297.86 2347.02,1362.8 2349.37,1514.4 2351.72,1357.08 2354.07,1425.89 2356.42,1356.52 2358.77,1544.45 2361.12,1396.12 2363.47,1308.95 2365.82,1473.61 2368.17,1413.9 2370.52,1396.2 2372.87,1531.95 2375.22,1410.72 2377.57,1258.45 2379.92,1219.98 2382.27,1337.49 2384.62,1342.99 2386.98,1506.77 2389.33,1496.64 2391.68,1499.95 2394.03,1423.38 2396.38,1382.47 2398.73,1247.22 2401.08,1314.11 2403.43,1376.53 2405.78,1447.82 2408.13,1243.37 2410.48,1376.73 2412.83,1369.79 2415.18,1357.14 2417.53,1470.72 2419.88,1315.61 2422.23,1445.37 2424.58,1346.86 2426.93,1653.78 2429.28,1441.64 2431.63,1405.77 2433.98,1571.69 2436.34,1373.54 2438.69,1400.57 2441.04,1628.29 2443.39,1390.27 2445.74,1516.97 2448.09,1517.66 2450.44,1524.77 2452.79,1550.78 2455.14,1502.11 2457.49,1308.89 2459.84,1512.2 2462.19,1411.88 2464.54,1295.71 2466.89,1407.26 2469.24,1399.82 2471.59,1399.37 2473.94,1409.56 2476.29,1195.58 2478.64,1283.91 2480.99,1530.92 2483.34,1327.79 2485.7,1307.74 2488.05,1469.37 2490.4,1441.64 2492.75,1506.18 2495.1,1478.52 2497.45,1377.77 2499.8,1261.4 2502.15,1573.97 2504.5,1497.07 2506.85,1252.28 2509.2,1278.15 2511.55,1157.54 2513.9,1204.67 2516.25,1391.77 2518.6,1448.89 2520.95,1388.64 2523.3,1480.59 2525.65,1446.32 2528,1323.1 2530.35,1413.99 2532.7,1492.36 2535.06,1371.18 2537.41,1522.6 2539.76,1397.34 2542.11,1345.51 2544.46,1371.22 2546.81,1413.49 2549.16,1145.89 2551.51,1320.2 2553.86,1354.94 2556.21,1348.71 2558.56,1383.64 2560.91,1464.01 2563.26,1291.92 2565.61,1450.64 2567.96,1506.48 2570.31,1569.27 "></polyline>
<polyline clip-path="url(#clip082)" style="stroke:#e26f46; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,1082.83 224.541,1102.49 226.891,880.674 229.242,1071.45 231.592,896.131 233.943,900.771 236.293,803.684 238.644,927.953 240.994,759.097 243.345,976.586 245.695,993.725 248.046,897.271 250.396,818.206 252.747,1028.34 255.097,819.151 257.448,828.636 259.798,999.858 262.148,941.691 264.499,1003.93 266.849,962.037 269.2,909.619 271.55,985.219 273.901,981.609 276.251,769.78 278.602,701.009 280.952,916.403 283.303,827.483 285.653,883.514 288.004,940.437 290.354,847.738 292.705,1028.73 295.055,850.727 297.406,958.452 299.756,844.444 302.107,866.822 304.457,804.617 306.807,818.731 309.158,1119.01 311.508,946.678 313.859,860.176 316.209,1146.5 318.56,879.695 320.91,1015.65 323.261,700.98 325.611,967.211 327.962,833.334 330.312,791.265 332.663,835.399 335.013,982.028 337.364,831.216 339.714,903.72 342.065,1074.63 344.415,970.945 346.765,895.3 349.116,1107.99 351.466,728.766 353.817,949.609 356.167,781.5 358.518,913.666 360.868,1081.86 363.219,973.07 365.569,974.178 367.92,792.412 370.27,932.28 372.621,809.31 374.971,1022.27 377.322,800.525 379.672,822.46 382.023,682.02 384.373,894.964 386.724,897.079 389.074,899.303 391.424,781.687 393.775,1090.56 396.125,935.64 398.476,743.778 400.826,938.862 403.177,862.766 405.527,970.931 407.878,986.738 410.228,908.706 412.579,857.25 414.929,1012.87 417.28,806.825 419.63,1178.01 421.981,914.813 424.331,1070.42 426.682,883.782 429.032,829.461 431.382,896.708 433.733,764.378 436.083,831.471 438.434,917.482 440.784,973.92 443.135,854.365 445.485,836.972 447.836,859.684 450.186,889.493 452.537,862.904 454.887,959.322 457.238,1111.48 459.588,795.057 461.939,922.448 464.289,1063.76 466.64,949.362 468.99,894.432 471.341,984.528 473.691,815.284 476.041,930.74 478.392,902.244 480.742,970.335 483.093,933.288 485.443,649.213 487.794,919.544 490.144,836.474 492.495,834.191 494.845,1032.8 497.196,1160.07 499.546,896.61 501.897,968.584 504.247,842.948 506.598,1078.63 508.948,936.717 511.299,941.549 513.649,814.675 515.999,748.617 518.35,844.335 520.7,905.687 523.051,865.166 525.401,971.842 527.752,951.057 530.102,861.455 532.453,822.927 534.803,858.514 537.154,775.881 539.504,902.172 541.855,1002 544.205,1024.75 546.556,874.771 548.906,923.121 551.257,917.189 553.607,839.219 555.958,948.021 558.308,882.97 560.658,867.124 563.009,775.654 565.359,958.374 567.71,1118.19 570.06,673.618 572.411,770.225 574.761,746.053 577.112,829.599 579.462,872.096 581.813,1024.01 584.163,1005.51 586.514,832.781 588.864,766.215 591.215,835.801 593.565,649.183 595.916,885.651 598.266,766.099 600.616,740.191 602.967,896.493 605.317,904.851 607.668,897.73 610.018,923.45 612.369,825.092 614.719,930.462 617.07,958.01 619.42,978.664 621.771,965.773 624.121,832.549 626.472,783.282 628.822,881.883 631.173,822.248 633.523,788.259 635.874,992.28 638.224,962.768 640.575,928.728 642.925,880.471 645.275,1012.86 647.626,913.856 649.976,884.414 652.327,788.057 654.677,941.013 657.028,938.729 659.378,883.468 661.729,960.47 664.079,910.342 666.43,788.825 668.78,822.827 671.131,794.293 673.481,932.253 675.832,987.51 678.182,935.688 680.533,948.766 682.883,894.695 685.233,973.609 687.584,799.855 689.934,814.614 692.285,888.875 694.635,828.674 696.986,913.002 699.336,972.345 701.687,809.983 704.037,779.179 706.388,952.521 708.738,906.067 711.089,872.217 713.439,695.695 715.79,720.766 718.14,757.769 720.491,904.662 722.841,771.099 725.192,997.484 727.542,944.602 729.892,798.95 732.243,627.587 734.593,1012.06 736.944,846.391 739.294,1049.6 741.645,820.783 743.995,1026.06 746.346,928.469 748.696,817.371 751.047,961.098 753.397,881.341 755.748,675.358 758.098,888.091 760.449,933.733 762.799,677.89 765.15,789.98 767.5,901.958 769.85,858.228 772.201,768.132 774.551,1033.98 776.902,958.948 779.252,1118.27 781.603,929.752 783.953,928.824 786.304,870.372 788.654,689.18 791.005,976.97 793.355,886.507 795.706,958.93 798.056,737.533 800.407,830.878 802.757,882.938 805.108,885.635 807.458,1121.61 809.809,836.549 812.159,968.201 814.509,1036.35 816.86,800.727 819.21,949.54 821.561,876.204 823.911,857.227 826.262,785.187 828.612,1054.14 830.963,1016.72 833.313,1039.86 835.664,1038.08 838.014,886.36 840.365,812.457 842.715,948.164 845.066,877.698 847.416,874.667 849.767,725.124 852.117,966.708 854.467,862.206 856.818,997.685 859.168,1039.79 861.519,779.402 863.869,716.232 866.22,801.655 868.57,785.433 870.921,898.726 873.271,1035.79 875.622,808.274 877.972,945.744 880.323,921.846 882.673,958.629 885.024,1065.82 887.374,1133.6 889.725,961.534 892.075,689.834 894.426,948.806 896.776,909.524 899.126,976.163 901.477,851.967 903.827,856.341 906.178,894.927 908.528,943.7 910.879,896.985 913.229,696.313 915.58,822.512 917.93,998.437 920.281,938.844 922.631,867.396 924.982,871.049 927.332,1043.76 929.683,973.585 932.033,937.549 934.384,1154.68 936.734,974.788 939.084,863.405 941.435,878.673 943.785,997.506 946.136,727.795 948.486,789.374 950.837,973.501 953.187,1028.44 955.538,1009.5 957.888,1044.43 960.239,720.658 962.589,862.298 964.94,867.687 967.29,892.843 969.641,959.324 971.991,932.507 974.342,769.64 976.692,919.496 979.043,727.234 981.393,969.738 983.743,1110.59 986.094,721.639 988.444,892.183 990.795,887.313 993.145,933.701 995.496,1147.76 997.846,769.639 1000.2,845.76 1002.55,848.82 1004.9,788.245 1007.25,785.752 1009.6,1065.22 1011.95,676.616 1014.3,896.579 1016.65,907.16 1019,807.64 1021.35,1001.74 1023.7,916.695 1026.05,690.078 1028.4,985.356 1030.75,918.869 1033.1,1074.7 1035.45,851.311 1037.8,981.721 1040.15,829.72 1042.51,1009.43 1044.86,838.225 1047.21,918.607 1049.56,781.066 1051.91,758.395 1054.26,858.057 1056.61,946.121 1058.96,989.864 1061.31,892.191 1063.66,1106.57 1066.01,943.004 1068.36,1104.18 1070.71,970.041 1073.06,1061.13 1075.41,1017.66 1077.76,924.928 1080.11,841.436 1082.46,980.88 1084.81,952.245 1087.16,915.782 1089.51,865.406 1091.87,990.883 1094.22,1049.59 1096.57,974.715 1098.92,965.945 1101.27,875.068 1103.62,728.463 1105.97,905.633 1108.32,957.79 1110.67,665.057 1113.02,905.722 1115.37,1000.35 1117.72,814.669 1120.07,952.595 1122.42,1021.15 1124.77,715.807 1127.12,894.042 1129.47,502.02 1131.82,1057.11 1134.17,869.357 1136.52,709.112 1138.87,1015.05 1141.23,808.19 1143.58,897.548 1145.93,874.544 1148.28,1032.48 1150.63,796.105 1152.98,945.835 1155.33,1020.89 1157.68,904.93 1160.03,1087.08 1162.38,1020.54 1164.73,742.249 1167.08,938.906 1169.43,796.892 1171.78,821.41 1174.13,905.956 1176.48,937.597 1178.83,905.396 1181.18,775.247 1183.53,766.531 1185.88,1020.47 1188.23,937.522 1190.59,854.204 1192.94,994.671 1195.29,957.388 1197.64,980.816 1199.99,913.557 1202.34,829.245 1204.69,754.432 1207.04,937.921 1209.39,838.465 1211.74,983.243 1214.09,891.925 1216.44,852.225 1218.79,1110.56 1221.14,784.418 1223.49,800.006 1225.84,916.715 1228.19,850.548 1230.54,898.876 1232.89,768.893 1235.24,904.049 1237.59,824.002 1239.94,904.573 1242.3,911.145 1244.65,920.56 1247,972.981 1249.35,750.517 1251.7,831.743 1254.05,889.945 1256.4,1053.12 1258.75,904.61 1261.1,802.928 1263.45,946.93 1265.8,1018.34 1268.15,893.512 1270.5,780.498 1272.85,778.471 1275.2,1009.92 1277.55,782.754 1279.9,730.079 1282.25,920.849 1284.6,934.856 1286.95,848.658 1289.3,807.888 1291.66,1047.43 1294.01,839.825 1296.36,736.431 1298.71,1108.86 1301.06,792.015 1303.41,891.724 1305.76,841.006 1308.11,811.32 1310.46,905.814 1312.81,899.699 1315.16,984.351 1317.51,868.737 1319.86,862.666 1322.21,944.162 1324.56,877.777 1326.91,834.288 1329.26,876.575 1331.61,1033.51 1333.96,1000.68 1336.31,861.081 1338.66,1062.75 1341.02,1107.15 1343.37,754.241 1345.72,935.891 1348.07,793.603 1350.42,1117.3 1352.77,837.078 1355.12,949.413 1357.47,960.596 1359.82,903.072 1362.17,906.036 1364.52,842.415 1366.87,958.611 1369.22,806.747 1371.57,910.525 1373.92,824.416 1376.27,859.657 1378.62,771.125 1380.97,901.828 1383.32,769.734 1385.67,1018.87 1388.02,1056.62 1390.38,1003.45 1392.73,903.697 1395.08,911.148 1397.43,720.978 1399.78,847.018 1402.13,766.824 1404.48,858.791 1406.83,814.648 1409.18,879.188 1411.53,808.549 1413.88,861.721 1416.23,756.467 1418.58,842.734 1420.93,1054.26 1423.28,881.248 1425.63,962.941 1427.98,877.732 1430.33,865.478 1432.68,1004.1 1435.03,957.539 1437.38,893.014 1439.74,957.218 1442.09,992.3 1444.44,1030.94 1446.79,948.559 1449.14,975.647 1451.49,817.477 1453.84,875.606 1456.19,984.398 1458.54,1076.27 1460.89,938.512 1463.24,899.898 1465.59,961.645 1467.94,808.231 1470.29,762.396 1472.64,849.863 1474.99,744.217 1477.34,1012.94 1479.69,982.751 1482.04,855.388 1484.39,956.266 1486.74,1066.14 1489.1,940.969 1491.45,905.119 1493.8,752.113 1496.15,899.473 1498.5,917.03 1500.85,1062.47 1503.2,778.454 1505.55,978.344 1507.9,1108.82 1510.25,933.857 1512.6,935.917 1514.95,780.094 1517.3,966.205 1519.65,981.588 1522,1026.7 1524.35,976.239 1526.7,822.639 1529.05,877.261 1531.4,1031.5 1533.75,936.073 1536.1,700.903 1538.45,877.329 1540.81,955.109 1543.16,882.8 1545.51,762.916 1547.86,773.618 1550.21,840.896 1552.56,967.779 1554.91,659.726 1557.26,870.316 1559.61,1004.75 1561.96,937.026 1564.31,896.36 1566.66,974.324 1569.01,757.918 1571.36,1031.58 1573.71,912.964 1576.06,882.263 1578.41,789.443 1580.76,825.923 1583.11,1089.98 1585.46,991.052 1587.81,818.149 1590.17,987.409 1592.52,662.29 1594.87,1100.85 1597.22,944.792 1599.57,909.104 1601.92,818.615 1604.27,774.599 1606.62,785.38 1608.97,1035.33 1611.32,804.119 1613.67,891.992 1616.02,873.105 1618.37,956.809 1620.72,1163.6 1623.07,861.104 1625.42,931.559 1627.77,826.615 1630.12,872.489 1632.47,742.475 1634.82,728.524 1637.17,889.243 1639.53,979.54 1641.88,895.051 1644.23,868.791 1646.58,885.745 1648.93,1012.23 1651.28,854.566 1653.63,906.672 1655.98,994.543 1658.33,849.689 1660.68,937.674 1663.03,997.747 1665.38,917.137 1667.73,923.924 1670.08,879.618 1672.43,790.138 1674.78,905.186 1677.13,887.034 1679.48,897.119 1681.83,881.733 1684.18,980.715 1686.53,862.871 1688.89,831.573 1691.24,872.807 1693.59,986.523 1695.94,804.205 1698.29,827.448 1700.64,1066.23 1702.99,985.898 1705.34,1048.1 1707.69,928.435 1710.04,729.705 1712.39,955.284 1714.74,948.362 1717.09,958.048 1719.44,908.746 1721.79,903.841 1724.14,860.513 1726.49,901.01 1728.84,794.004 1731.19,897.336 1733.54,1061.9 1735.89,1002.79 1738.25,1006.11 1740.6,897.795 1742.95,794.854 1745.3,853.53 1747.65,945.876 1750,879.139 1752.35,1009.66 1754.7,950.99 1757.05,936.413 1759.4,1039.91 1761.75,889.353 1764.1,723.911 1766.45,892.095 1768.8,714.649 1771.15,915.355 1773.5,671.151 1775.85,812.134 1778.2,754.185 1780.55,843.871 1782.9,1034.1 1785.25,936.73 1787.6,854.643 1789.96,1068.75 1792.31,879.519 1794.66,958.894 1797.01,785.925 1799.36,1041.15 1801.71,935.893 1804.06,849.368 1806.41,688.196 1808.76,864.338 1811.11,1071.13 1813.46,751.456 1815.81,902.762 1818.16,1032.33 1820.51,826.039 1822.86,943.388 1825.21,1024.16 1827.56,966.548 1829.91,760.779 1832.26,942.46 1834.61,1026.62 1836.96,830.405 1839.32,787.736 1841.67,940.061 1844.02,773.12 1846.37,1011.74 1848.72,944.68 1851.07,953.885 1853.42,763.813 1855.77,1073.27 1858.12,876.588 1860.47,676.546 1862.82,878.983 1865.17,978.439 1867.52,766.298 1869.87,930.466 1872.22,962.32 1874.57,1006.36 1876.92,860.66 1879.27,811.514 1881.62,919.869 1883.97,1136.05 1886.32,727.333 1888.68,1003.01 1891.03,933.538 1893.38,818.455 1895.73,774.286 1898.08,842.936 1900.43,778.559 1902.78,1007.77 1905.13,964.381 1907.48,869.67 1909.83,744.538 1912.18,783.327 1914.53,818.156 1916.88,985.485 1919.23,886.589 1921.58,947.758 1923.93,964.161 1926.28,760.44 1928.63,987.731 1930.98,759.165 1933.33,731.045 1935.68,968.547 1938.04,883.563 1940.39,883.284 1942.74,933.57 1945.09,873.899 1947.44,761.844 1949.79,956.8 1952.14,824.602 1954.49,846.527 1956.84,747.918 1959.19,811.917 1961.54,887.952 1963.89,749.198 1966.24,872.844 1968.59,876.247 1970.94,969.699 1973.29,839.592 1975.64,700.706 1977.99,778.693 1980.34,949.909 1982.69,785.155 1985.04,960.243 1987.4,866.823 1989.75,1032.77 1992.1,944.319 1994.45,917.284 1996.8,859.854 1999.15,697.427 2001.5,615.521 2003.85,892.8 2006.2,997.688 2008.55,712.173 2010.9,842.07 2013.25,874.906 2015.6,1084.23 2017.95,776.618 2020.3,885.909 2022.65,1060.5 2025,882.569 2027.35,836.136 2029.7,881.328 2032.05,897.695 2034.4,815.268 2036.76,975.389 2039.11,958.942 2041.46,952.526 2043.81,829.091 2046.16,836.957 2048.51,858.637 2050.86,971.921 2053.21,857.674 2055.56,976.727 2057.91,857.636 2060.26,974.344 2062.61,1030.8 2064.96,953.16 2067.31,760.755 2069.66,1061.9 2072.01,975.818 2074.36,879.475 2076.71,1054.13 2079.06,1002.05 2081.41,836.5 2083.76,898.352 2086.11,877.478 2088.47,973.035 2090.82,990.652 2093.17,870.459 2095.52,1018.72 2097.87,895.778 2100.22,956.574 2102.57,842.53 2104.92,901.246 2107.27,875.768 2109.62,986.84 2111.97,875.165 2114.32,799.777 2116.67,799.893 2119.02,802.881 2121.37,895.999 2123.72,823.33 2126.07,785.778 2128.42,851.377 2130.77,924.732 2133.12,889.203 2135.47,913.219 2137.83,855.108 2140.18,709.028 2142.53,1001.22 2144.88,879.573 2147.23,1132.4 2149.58,807.672 2151.93,805.728 2154.28,873.311 2156.63,903.032 2158.98,925.368 2161.33,747.938 2163.68,881.824 2166.03,935.547 2168.38,866.238 2170.73,859.169 2173.08,1027.46 2175.43,834.591 2177.78,939.297 2180.13,865.923 2182.48,923.581 2184.83,899.451 2187.19,953.264 2189.54,855.413 2191.89,963.162 2194.24,903.173 2196.59,1074.8 2198.94,852.18 2201.29,773.865 2203.64,883.333 2205.99,893.752 2208.34,680.399 2210.69,911.829 2213.04,944.937 2215.39,1063.79 2217.74,860.332 2220.09,845.148 2222.44,850.133 2224.79,911.603 2227.14,921.56 2229.49,924.696 2231.84,896.394 2234.19,891.284 2236.55,1095.49 2238.9,927.225 2241.25,1060.64 2243.6,821.981 2245.95,886.607 2248.3,806.381 2250.65,876.79 2253,1069.39 2255.35,938.947 2257.7,1063.87 2260.05,901.846 2262.4,883.61 2264.75,1006.48 2267.1,1065.45 2269.45,947.38 2271.8,977.563 2274.15,976.142 2276.5,797.128 2278.85,1047.57 2281.2,781.448 2283.55,859.715 2285.91,721.949 2288.26,861.624 2290.61,932.535 2292.96,851.349 2295.31,867.869 2297.66,855.756 2300.01,923.291 2302.36,981.892 2304.71,996.027 2307.06,1086.82 2309.41,871.008 2311.76,897.118 2314.11,942.386 2316.46,779.847 2318.81,714.129 2321.16,738.85 2323.51,928.428 2325.86,841.284 2328.21,850.58 2330.56,1001.99 2332.91,1001.05 2335.27,856.269 2337.62,844.932 2339.97,611.548 2342.32,890.243 2344.67,922.047 2347.02,929.143 2349.37,847.145 2351.72,1049.59 2354.07,1122.55 2356.42,799.2 2358.77,882.154 2361.12,931.369 2363.47,678.99 2365.82,732.891 2368.17,829.58 2370.52,820.779 2372.87,952.455 2375.22,970.904 2377.57,922.865 2379.92,921.434 2382.27,893.56 2384.62,989.872 2386.98,892.714 2389.33,823.528 2391.68,839.762 2394.03,906.222 2396.38,849.937 2398.73,1013.18 2401.08,760.143 2403.43,924.658 2405.78,976.615 2408.13,1050.2 2410.48,859.338 2412.83,889.838 2415.18,1041.21 2417.53,783.942 2419.88,762.052 2422.23,1026.04 2424.58,1033.83 2426.93,1005.9 2429.28,824.295 2431.63,928.69 2433.98,826.264 2436.34,727.433 2438.69,777.071 2441.04,829.838 2443.39,933.577 2445.74,1023.81 2448.09,941.911 2450.44,1037.98 2452.79,824.63 2455.14,891.91 2457.49,906.433 2459.84,949.101 2462.19,932.802 2464.54,819.036 2466.89,947.084 2469.24,919.159 2471.59,768.634 2473.94,1092.96 2476.29,989.866 2478.64,753.601 2480.99,938.423 2483.34,979.156 2485.7,927.313 2488.05,915.452 2490.4,908.785 2492.75,956.47 2495.1,833.622 2497.45,986.917 2499.8,1056.84 2502.15,896.25 2504.5,830.399 2506.85,923.123 2509.2,922.904 2511.55,785.522 2513.9,882.41 2516.25,824.088 2518.6,964.005 2520.95,946.843 2523.3,1010.64 2525.65,903.343 2528,966.292 2530.35,756.504 2532.7,969.588 2535.06,1020.4 2537.41,891.936 2539.76,936.586 2542.11,698.767 2544.46,1038.6 2546.81,1052.75 2549.16,787.742 2551.51,1013.39 2553.86,849.662 2556.21,898.538 2558.56,997.534 2560.91,827.029 2563.26,747.69 2565.61,1022.61 2567.96,895.444 2570.31,850.056 "></polyline>
<polyline clip-path="url(#clip082)" style="stroke:#3da44d; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,439.771 224.541,416.311 226.891,486.275 229.242,240.161 231.592,388.29 233.943,511.82 236.293,394.55 238.644,407.233 240.994,365.564 243.345,282.944 245.695,237.632 248.046,212.561 250.396,316.238 252.747,302.976 255.097,249.221 257.448,400.083 259.798,501.297 262.148,352.775 264.499,478.011 266.849,438.104 269.2,574.52 271.55,280.122 273.901,458.604 276.251,467.226 278.602,492.398 280.952,512.987 283.303,216.774 285.653,335.736 288.004,423.674 290.354,224.028 292.705,369.295 295.055,414.694 297.406,427.603 299.756,488.369 302.107,289.141 304.457,399.267 306.807,517.869 309.158,295.097 311.508,262.695 313.859,289.679 316.209,404.373 318.56,405.669 320.91,371.128 323.261,248.543 325.611,396.497 327.962,423.016 330.312,402.981 332.663,413.432 335.013,472.055 337.364,297.349 339.714,446.505 342.065,475.439 344.415,386.065 346.765,296.291 349.116,642.464 351.466,366.568 353.817,276.713 356.167,293.054 358.518,190.767 360.868,384.254 363.219,387.136 365.569,629.86 367.92,519.116 370.27,399.443 372.621,365.453 374.971,256.803 377.322,410.276 379.672,355.005 382.023,370.393 384.373,356.127 386.724,428.246 389.074,483.215 391.424,432.754 393.775,487.499 396.125,450.217 398.476,346.185 400.826,547.572 403.177,421.038 405.527,399.179 407.878,310.695 410.228,155.633 412.579,362.499 414.929,445.304 417.28,475.79 419.63,412.008 421.981,474.097 424.331,521.262 426.682,315.804 429.032,430.933 431.382,364.519 433.733,299.644 436.083,501.053 438.434,381.182 440.784,289.143 443.135,371.908 445.485,314.951 447.836,421.535 450.186,476.522 452.537,614.24 454.887,467.978 457.238,321.57 459.588,544.953 461.939,275.977 464.289,401.85 466.64,502.618 468.99,285.29 471.341,375.419 473.691,387.038 476.041,262.707 478.392,369.62 480.742,154.83 483.093,235.62 485.443,282.462 487.794,434.453 490.144,273.514 492.495,378.476 494.845,318.622 497.196,207.12 499.546,234.875 501.897,396.404 504.247,454.66 506.598,525.599 508.948,344.796 511.299,420.031 513.649,382.628 515.999,436.056 518.35,264.776 520.7,164.058 523.051,430.924 525.401,408.574 527.752,316.368 530.102,322.047 532.453,590.671 534.803,450.55 537.154,455.521 539.504,271.554 541.855,321.238 544.205,406.939 546.556,296.178 548.906,420.784 551.257,161.63 553.607,330.893 555.958,362.55 558.308,374.935 560.658,448.826 563.009,614.666 565.359,552.243 567.71,338.988 570.06,380.046 572.411,365.993 574.761,361.572 577.112,464.141 579.462,309.567 581.813,346.801 584.163,439.077 586.514,477.026 588.864,258.788 591.215,542.02 593.565,319.247 595.916,366.887 598.266,463.186 600.616,446.706 602.967,341.55 605.317,364.143 607.668,292.089 610.018,544.274 612.369,263.808 614.719,365.125 617.07,294.989 619.42,466.729 621.771,320.468 624.121,274.581 626.472,583.206 628.822,335.052 631.173,494.157 633.523,463.218 635.874,344.983 638.224,304.506 640.575,501.978 642.925,428.883 645.275,388.149 647.626,418.015 649.976,280.308 652.327,322.94 654.677,499.333 657.028,454.035 659.378,450.981 661.729,362.776 664.079,490.254 666.43,380.441 668.78,459.414 671.131,376.746 673.481,368.803 675.832,428.97 678.182,513.607 680.533,386.366 682.883,322.698 685.233,494.173 687.584,335.678 689.934,487.639 692.285,480.125 694.635,517.82 696.986,448.841 699.336,443.86 701.687,524.469 704.037,328.765 706.388,206.782 708.738,344.296 711.089,338.66 713.439,408.563 715.79,479.692 718.14,550.586 720.491,454.024 722.841,386.752 725.192,550.557 727.542,253.472 729.892,366.81 732.243,459.991 734.593,332.056 736.944,372.613 739.294,332.346 741.645,326.211 743.995,294.167 746.346,561.291 748.696,439.503 751.047,385.71 753.397,523.795 755.748,377.811 758.098,385.832 760.449,398.303 762.799,496.748 765.15,323.284 767.5,462.641 769.85,146.017 772.201,414.047 774.551,359.519 776.902,452.421 779.252,467.548 781.603,311.722 783.953,372.789 786.304,360.174 788.654,528.715 791.005,380.515 793.355,437.474 795.706,410.525 798.056,329.922 800.407,322.751 802.757,523.993 805.108,338.376 807.458,518.633 809.809,477.287 812.159,408.556 814.509,534.269 816.86,326.128 819.21,382.308 821.561,281.861 823.911,471.456 826.262,421.597 828.612,458.155 830.963,420.997 833.313,393.564 835.664,372.642 838.014,360.761 840.365,354.887 842.715,318.187 845.066,307.338 847.416,412.673 849.767,287.654 852.117,511.846 854.467,300.984 856.818,517.187 859.168,285.017 861.519,544.059 863.869,375.34 866.22,522.453 868.57,503.245 870.921,379.013 873.271,360.765 875.622,325.011 877.972,460.991 880.323,506.215 882.673,479.787 885.024,337.319 887.374,393.378 889.725,490.731 892.075,296.982 894.426,490.136 896.776,332.646 899.126,571.261 901.477,445.322 903.827,447.593 906.178,393.19 908.528,338.784 910.879,255.634 913.229,246.553 915.58,366.107 917.93,435.284 920.281,378.712 922.631,282.717 924.982,378.923 927.332,300.133 929.683,399.207 932.033,504.3 934.384,271.48 936.734,436.515 939.084,442.419 941.435,528.888 943.785,277.575 946.136,295.265 948.486,372.224 950.837,407.788 953.187,403.353 955.538,223.837 957.888,537.844 960.239,539.817 962.589,454.725 964.94,447.065 967.29,194.451 969.641,441.248 971.991,364.052 974.342,474.132 976.692,285.908 979.043,421.478 981.393,415.624 983.743,385.379 986.094,264.741 988.444,506.831 990.795,544.601 993.145,247.933 995.496,379.671 997.846,452.072 1000.2,296.64 1002.55,580.523 1004.9,434.665 1007.25,365.199 1009.6,574.849 1011.95,366.856 1014.3,415.68 1016.65,187.237 1019,206.087 1021.35,268.632 1023.7,358.028 1026.05,412.014 1028.4,349.888 1030.75,341.191 1033.1,496.058 1035.45,579.467 1037.8,497.332 1040.15,312.193 1042.51,497.173 1044.86,308.665 1047.21,367.039 1049.56,473.547 1051.91,483.473 1054.26,272.876 1056.61,387.523 1058.96,285.035 1061.31,331.432 1063.66,441.97 1066.01,423.584 1068.36,321.809 1070.71,324.402 1073.06,523.397 1075.41,370.262 1077.76,323.793 1080.11,285.969 1082.46,333.558 1084.81,157.876 1087.16,265.135 1089.51,320.9 1091.87,444.599 1094.22,382.721 1096.57,487.24 1098.92,403.172 1101.27,287.909 1103.62,401.509 1105.97,300.764 1108.32,327.84 1110.67,562.329 1113.02,311.155 1115.37,368.547 1117.72,431.401 1120.07,421.106 1122.42,236.381 1124.77,316.343 1127.12,342.198 1129.47,263.991 1131.82,385.464 1134.17,426.434 1136.52,614.581 1138.87,612.203 1141.23,508.152 1143.58,219.916 1145.93,313.932 1148.28,349.559 1150.63,385.789 1152.98,372.513 1155.33,515.956 1157.68,292.098 1160.03,333.452 1162.38,380.321 1164.73,320.097 1167.08,449.268 1169.43,300.679 1171.78,229.136 1174.13,432.63 1176.48,291.489 1178.83,483.968 1181.18,227.865 1183.53,402.886 1185.88,418.562 1188.23,491.053 1190.59,564.807 1192.94,263.705 1195.29,368.333 1197.64,333.268 1199.99,356.715 1202.34,405.296 1204.69,508.097 1207.04,465.966 1209.39,480.33 1211.74,316.782 1214.09,359.357 1216.44,384.866 1218.79,314.615 1221.14,342.946 1223.49,192.866 1225.84,511.492 1228.19,314.097 1230.54,242.939 1232.89,541.502 1235.24,452.563 1237.59,436.906 1239.94,238.402 1242.3,333.745 1244.65,550.527 1247,362.413 1249.35,529.035 1251.7,455.063 1254.05,563.937 1256.4,661.213 1258.75,367.207 1261.1,264.61 1263.45,263.123 1265.8,557.561 1268.15,320.748 1270.5,353.198 1272.85,517.093 1275.2,302.405 1277.55,537.3 1279.9,534.43 1282.25,353.721 1284.6,320.541 1286.95,423.325 1289.3,392.913 1291.66,335.534 1294.01,398.47 1296.36,427.644 1298.71,272.296 1301.06,399.797 1303.41,344.286 1305.76,458.92 1308.11,287.003 1310.46,387.953 1312.81,233.156 1315.16,519.595 1317.51,361.901 1319.86,442.929 1322.21,303.662 1324.56,234.556 1326.91,293.914 1329.26,426.107 1331.61,616.91 1333.96,466.749 1336.31,398.854 1338.66,300.911 1341.02,492.745 1343.37,506.985 1345.72,171.353 1348.07,511.165 1350.42,540.847 1352.77,526.131 1355.12,340.71 1357.47,339.915 1359.82,486.909 1362.17,262.685 1364.52,420.073 1366.87,209.497 1369.22,399.366 1371.57,565.429 1373.92,594.141 1376.27,287.632 1378.62,585.892 1380.97,283.182 1383.32,547.551 1385.67,370.562 1388.02,399.556 1390.38,396.197 1392.73,313.092 1395.08,220.027 1397.43,493.192 1399.78,475.5 1402.13,473.923 1404.48,219.053 1406.83,214.035 1409.18,345.858 1411.53,649.225 1413.88,264.842 1416.23,340.945 1418.58,369.095 1420.93,359.337 1423.28,393.569 1425.63,471.171 1427.98,394.01 1430.33,394.934 1432.68,286.825 1435.03,358.959 1437.38,340.921 1439.74,445.281 1442.09,512.797 1444.44,381.474 1446.79,258.136 1449.14,337.389 1451.49,329.82 1453.84,360.261 1456.19,507.55 1458.54,363.833 1460.89,483.441 1463.24,338.114 1465.59,224.545 1467.94,243.704 1470.29,335.982 1472.64,214.495 1474.99,362.447 1477.34,318.186 1479.69,300.85 1482.04,364.276 1484.39,381.88 1486.74,467.752 1489.1,361.138 1491.45,443.373 1493.8,368.605 1496.15,411.558 1498.5,300.624 1500.85,283.553 1503.2,320.528 1505.55,427.481 1507.9,205.841 1510.25,357.103 1512.6,299.322 1514.95,471.942 1517.3,487.264 1519.65,565.198 1522,578.156 1524.35,634.583 1526.7,391.387 1529.05,335.932 1531.4,269.534 1533.75,303.326 1536.1,518.452 1538.45,428.845 1540.81,319.16 1543.16,307.848 1545.51,490.761 1547.86,158.311 1550.21,418.767 1552.56,488.133 1554.91,251.679 1557.26,423.251 1559.61,244.157 1561.96,366.175 1564.31,420.172 1566.66,438.152 1569.01,206.045 1571.36,383.837 1573.71,486.02 1576.06,303.525 1578.41,579.599 1580.76,343.759 1583.11,553.829 1585.46,305.24 1587.81,387.217 1590.17,426.6 1592.52,328.043 1594.87,524.977 1597.22,501.035 1599.57,271.226 1601.92,314.595 1604.27,266.225 1606.62,506.711 1608.97,291.264 1611.32,218.235 1613.67,309.236 1616.02,374.648 1618.37,360.24 1620.72,299.756 1623.07,574.042 1625.42,275.657 1627.77,459.573 1630.12,492.272 1632.47,435.206 1634.82,222.37 1637.17,270.243 1639.53,330.032 1641.88,440.784 1644.23,523.771 1646.58,439.187 1648.93,356.501 1651.28,197.391 1653.63,549.202 1655.98,395.674 1658.33,559.822 1660.68,465.706 1663.03,244.085 1665.38,464.189 1667.73,412.252 1670.08,470.226 1672.43,182.328 1674.78,535.401 1677.13,306.003 1679.48,278.38 1681.83,491.058 1684.18,381.353 1686.53,384.084 1688.89,226.411 1691.24,266.883 1693.59,285.036 1695.94,125.026 1698.29,393.496 1700.64,504.397 1702.99,383.667 1705.34,354.038 1707.69,228.139 1710.04,342.762 1712.39,402.604 1714.74,455.985 1717.09,374.863 1719.44,419.827 1721.79,230.578 1724.14,430.866 1726.49,372.305 1728.84,381.383 1731.19,410.819 1733.54,335.484 1735.89,486.884 1738.25,443.062 1740.6,351.574 1742.95,598.405 1745.3,287.425 1747.65,567.213 1750,397.137 1752.35,314.805 1754.7,459.172 1757.05,444.799 1759.4,343.908 1761.75,400.962 1764.1,448.464 1766.45,360.579 1768.8,407.61 1771.15,320.053 1773.5,532.356 1775.85,323.52 1778.2,396.083 1780.55,524.85 1782.9,391.15 1785.25,615.183 1787.6,369.367 1789.96,409.011 1792.31,523.026 1794.66,345.788 1797.01,315.368 1799.36,413.954 1801.71,257.553 1804.06,600.333 1806.41,292.598 1808.76,493.209 1811.11,409.191 1813.46,353.221 1815.81,423.813 1818.16,399.989 1820.51,349.571 1822.86,425.655 1825.21,328.669 1827.56,322.14 1829.91,428.572 1832.26,315.037 1834.61,418.77 1836.96,359.019 1839.32,258.452 1841.67,213.275 1844.02,378.885 1846.37,294.111 1848.72,344.278 1851.07,413.701 1853.42,514.042 1855.77,366.582 1858.12,581.23 1860.47,365.297 1862.82,367.923 1865.17,484.563 1867.52,371.576 1869.87,498.711 1872.22,501.296 1874.57,498.396 1876.92,307.481 1879.27,178.292 1881.62,380.23 1883.97,533.182 1886.32,421.126 1888.68,372.65 1891.03,480.534 1893.38,493.382 1895.73,570.161 1898.08,473.438 1900.43,419.567 1902.78,288.843 1905.13,268.442 1907.48,459.882 1909.83,414.451 1912.18,374.189 1914.53,439.167 1916.88,366.122 1919.23,322.788 1921.58,268.542 1923.93,456.321 1926.28,377.514 1928.63,482.614 1930.98,365.37 1933.33,423.638 1935.68,324.936 1938.04,96.8724 1940.39,294.171 1942.74,258.84 1945.09,385.167 1947.44,256.777 1949.79,495.096 1952.14,366.824 1954.49,343.929 1956.84,528.778 1959.19,292.796 1961.54,472.929 1963.89,347.192 1966.24,359.313 1968.59,310.329 1970.94,528.295 1973.29,356.574 1975.64,392.844 1977.99,292.997 1980.34,384.581 1982.69,495.939 1985.04,294.988 1987.4,350.207 1989.75,492.551 1992.1,473.169 1994.45,391.742 1996.8,472.694 1999.15,418.409 2001.5,243.027 2003.85,371.152 2006.2,415.321 2008.55,461.283 2010.9,482.651 2013.25,393.173 2015.6,555.21 2017.95,394.467 2020.3,336.965 2022.65,485.623 2025,435.912 2027.35,387.95 2029.7,377.194 2032.05,457.186 2034.4,403.95 2036.76,478.347 2039.11,351.328 2041.46,292.944 2043.81,268.786 2046.16,458.775 2048.51,363.017 2050.86,517.804 2053.21,310.436 2055.56,318.752 2057.91,360.105 2060.26,385.046 2062.61,264.496 2064.96,353.253 2067.31,469.396 2069.66,550.169 2072.01,328.724 2074.36,396.867 2076.71,506.956 2079.06,454.367 2081.41,360.063 2083.76,401.129 2086.11,429.669 2088.47,272.196 2090.82,436.515 2093.17,396.384 2095.52,368.638 2097.87,422.732 2100.22,646.276 2102.57,431.797 2104.92,433.107 2107.27,277.517 2109.62,402.619 2111.97,339.663 2114.32,241.363 2116.67,413.404 2119.02,479.438 2121.37,455.296 2123.72,553.438 2126.07,452.14 2128.42,433.135 2130.77,145.037 2133.12,432.522 2135.47,357.256 2137.83,420.526 2140.18,270.286 2142.53,480.833 2144.88,569.379 2147.23,403.026 2149.58,336.17 2151.93,448.231 2154.28,326.668 2156.63,441.963 2158.98,419.187 2161.33,654.473 2163.68,412.573 2166.03,411.774 2168.38,433.757 2170.73,344.076 2173.08,475.482 2175.43,326.652 2177.78,460.792 2180.13,394.814 2182.48,431.984 2184.83,447.164 2187.19,533.032 2189.54,331.145 2191.89,498.026 2194.24,384.025 2196.59,407.205 2198.94,491.837 2201.29,546.279 2203.64,429.165 2205.99,346.669 2208.34,335.983 2210.69,400.498 2213.04,355.135 2215.39,424.481 2217.74,447.18 2220.09,608.632 2222.44,221.608 2224.79,353.247 2227.14,373.871 2229.49,338.468 2231.84,372.698 2234.19,468.627 2236.55,391.931 2238.9,354.784 2241.25,546.169 2243.6,453.349 2245.95,316.581 2248.3,326.445 2250.65,298.333 2253,505.284 2255.35,387.243 2257.7,530.192 2260.05,178.412 2262.4,372.988 2264.75,402.921 2267.1,365.494 2269.45,458.611 2271.8,380.126 2274.15,445.294 2276.5,511.594 2278.85,192.112 2281.2,367.872 2283.55,342.965 2285.91,289.36 2288.26,308.956 2290.61,389.106 2292.96,486.132 2295.31,482.483 2297.66,156.54 2300.01,308.783 2302.36,343.016 2304.71,437.729 2307.06,281.694 2309.41,228.71 2311.76,302.565 2314.11,252.004 2316.46,424.9 2318.81,436.723 2321.16,421.081 2323.51,357.441 2325.86,304.824 2328.21,411.286 2330.56,516.071 2332.91,440.043 2335.27,343.679 2337.62,422.663 2339.97,466.753 2342.32,417.72 2344.67,438.6 2347.02,381.701 2349.37,278.503 2351.72,191.528 2354.07,439.487 2356.42,375.099 2358.77,205.297 2361.12,329.464 2363.47,430.094 2365.82,371.792 2368.17,475.223 2370.52,496.059 2372.87,455.154 2375.22,384.208 2377.57,570.754 2379.92,334.381 2382.27,385.2 2384.62,374.66 2386.98,472.363 2389.33,336.328 2391.68,583.208 2394.03,362.564 2396.38,267.586 2398.73,341.316 2401.08,453.643 2403.43,217.716 2405.78,474.238 2408.13,228.016 2410.48,491.651 2412.83,404.341 2415.18,264.767 2417.53,247.191 2419.88,356.189 2422.23,295.933 2424.58,362.887 2426.93,472.085 2429.28,439.648 2431.63,335.304 2433.98,337.063 2436.34,158.287 2438.69,380.841 2441.04,359.357 2443.39,395.547 2445.74,321.244 2448.09,468.351 2450.44,436.166 2452.79,362.018 2455.14,228.428 2457.49,393.978 2459.84,329.665 2462.19,426.991 2464.54,273.981 2466.89,333.946 2469.24,274.634 2471.59,220.77 2473.94,436.736 2476.29,380.791 2478.64,389.606 2480.99,377.196 2483.34,603.944 2485.7,415.401 2488.05,678.602 2490.4,243.639 2492.75,438.868 2495.1,353.773 2497.45,434.351 2499.8,320.687 2502.15,250.197 2504.5,337.528 2506.85,370.09 2509.2,489.712 2511.55,444.598 2513.9,395.125 2516.25,395.601 2518.6,109.115 2520.95,367.285 2523.3,479.122 2525.65,420.452 2528,441.55 2530.35,467.288 2532.7,495.646 2535.06,527.114 2537.41,494.522 2539.76,415.193 2542.11,406.577 2544.46,392.054 2546.81,457.581 2549.16,309.67 2551.51,406.979 2553.86,456.299 2556.21,359.181 2558.56,324.857 2560.91,358.734 2563.26,424.482 2565.61,464.998 2567.96,401.275 2570.31,352.544 "></polyline>
</svg>
</div>
</div>
<p>Look at that! Things are working; amazin’.</p>
<p>We can also exploit <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>’s parallel sampling capabilities:</p>
<div id="34" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run separate 4 chains for 10 000 iterations using threads to parallelize.</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>num_chains <span class="op">=</span> <span class="fl">4</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    model_with_grad,</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">MCMCThreads</span>(),</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>,</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    num_chains;</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Note we need to provide an initial state for every chain.</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>    initial_state<span class="op">=</span><span class="fu">fill</span>(state, num_chains),</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>samples_array <span class="op">=</span> <span class="fu">stack</span>(<span class="fu">map</span>(<span class="bu">Base</span>.<span class="fu">Fix1</span>(stack, sample <span class="op">-&gt;</span> sample.x), samples))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000×4 Array{Float64, 3}:
[:, :, 1] =
 -2.49836   -3.94708  -4.47216  -5.61219   …  -5.03694   -5.84335   -6.09986
 -0.297221  -1.05365   0.10223   0.578225     -0.604906  -0.985076  -0.686701
  2.54865    3.99706   4.05771   3.41034       4.50998    4.66012    4.09255

[:, :, 2] =
 -3.5044   -3.84116   -4.97271  -5.87547   …  -4.69361  -4.17961   -4.3098
 -1.62312  -0.103303   1.14964  -0.925573     -0.93879  -0.691979  -0.0182576
  1.74272   3.24415    4.21079   4.48588       7.16788   7.01475    5.84989

[:, :, 3] =
 -3.67761   -4.11795   -3.81946   -6.5098    …  -6.53868  -5.34736  -5.86887
  0.335469  -0.247191  -0.526081  -0.321907     -0.39162   1.10765   1.28177
  2.78063    2.34289    3.9757     5.44904       4.6177    4.70496   2.86679

[:, :, 4] =
 -3.10924   -4.55641  -4.34327   -5.77546   …  -5.93857  -5.7451   -5.10775
 -0.267267  -0.7334   -0.952094  -0.913194     -1.21396  -2.00687  -0.897531
  2.02044    3.44701   5.27522    3.03006       4.94702   4.54915   5.3183</code></pre>
</div>
</div>
<p>But the fact that we have to provide the <code>AbstractMCMC.sample</code> call, etc. with an <code>initial_state</code> to get started is a bit annoying. We can avoid this by also defining a <code>AbstractMCMC.step</code> <em>without</em> the <code>state</code> argument:</p>
<div id="36" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">::</span><span class="dt">MALA</span>;</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># </span><span class="al">NOTE</span><span class="co">: No state provided!</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just create the initial state by sampling using  a Gaussian.</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="fu">randn</span>(rng, LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(x), <span class="fu">MALAState</span>(x)</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Equipped with this, we no longer need to provide the <code>initial_state</code> everywhere:</p>
<div id="38" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -5.01058    1.00288
  0.0244633  1.01111
  4.97449    1.01431</code></pre>
</div>
</div>
</section>
<section id="using-our-sampler-with-turing.jl" class="level2">
<h2 class="anchored" data-anchor-id="using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</h2>
<p>As we promised, all of this hassle of implementing our <code>MALA</code> sampler in a way that uses <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> and <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> gets us something more than <em>just</em> an “automatic” implementation of <code>AbstractMCMC.sample</code>.</p>
<p>It also enables use with Turing.jl through the <code>externalsampler</code>, but we need to do one final thing first: we need to tell Turing.jl how to extract a vector of parameters from the “sample” returned in our implementation of <code>AbstractMCMC.step</code>. In our case, the “sample” is a <code>MALASample</code>, so we just need the following line:</p>
<div id="40" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load Turing.jl.</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Turing</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Overload the `getparams` method for our "sample" type, which is just a vector.</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>Turing.Inference.<span class="fu">getparams</span>(<span class="op">::</span><span class="dt">Turing.Model</span>, sample<span class="op">::</span><span class="dt">MALASample</span>) <span class="op">=</span> sample.x</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And with that, we’re good to go!</p>
<div id="42" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Our previous model defined as a Turing.jl model.</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">mvnormal_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">MvNormal</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.], I)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate our model.</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">mvnormal_model</span>()</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Call `sample` but now we're passing in a Turing.jl `model` and wrapping</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co"># our `MALA` sampler in the `externalsampler` to tell Turing.jl that the sampler</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co"># expects something that implements LogDensityProblems.jl.</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×4×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 2.76 seconds
Compute duration  = 2.76 seconds
parameters        = x[1], x[2], x[3]
internals         = lp

Summary Statistics
  parameters      mean       std      mcse    ess_bulk    ess_tail      rhat   ⋯
      Symbol   Float64   Float64   Float64     Float64     Float64   Float64   ⋯

        x[1]   -4.9871    0.9915    0.0172   3341.2758   5148.4798    1.0005   ⋯
        x[2]   -0.0123    1.0082    0.0183   3033.4560   5316.2429    1.0006   ⋯
        x[3]    5.0096    1.0132    0.0180   3171.8178   5157.7860    1.0005   ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

        x[1]   -6.9282   -5.6636   -4.9689   -4.3377   -3.0581
        x[2]   -1.9820   -0.6966   -0.0242    0.6702    1.9623
        x[3]    3.0369    4.3338    5.0017    5.6921    6.9980</code></pre>
</div>
</div>
<p>Pretty neat, eh?</p>
<section id="models-with-constrained-parameters" class="level3">
<h3 class="anchored" data-anchor-id="models-with-constrained-parameters">Models with constrained parameters</h3>
<p>One thing we’ve sort of glossed over in all of the above is that MALA, at least how we’ve implemented it, requires <span class="math inline">\(x\)</span> to live in <span class="math inline">\(\mathbb{R}^d\)</span> for some <span class="math inline">\(d &gt; 0\)</span>. If some of the parameters were in fact constrained, e.g.&nbsp;we were working with a <code>Beta</code> distribution which has support on the interval <span class="math inline">\((0, 1)\)</span>, <em>not</em> on <span class="math inline">\(\mathbb{R}^d\)</span>, we could easily end up outside of the valid range <span class="math inline">\((0, 1)\)</span>.</p>
<div id="44" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">beta_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">beta_model</span>()</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 1.86 seconds
Compute duration  = 1.86 seconds
parameters        = x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse    ess_bulk    ess_tail      rhat   ⋯
      Symbol   Float64   Float64   Float64     Float64     Float64   Float64   ⋯

           x    0.5030    0.1900    0.0031   3754.3387   5767.7170    1.0009   ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

           x    0.1460    0.3602    0.5033    0.6457    0.8579</code></pre>
</div>
</div>
<p>Yep, that still works, but only because Turing.jl actually <em>transforms</em> the <code>turing_model</code> from constrained to unconstrained, so that the <code>sampler</code> provided to <code>externalsampler</code> is actually always working in unconstrained space! This is not always desirable, so we can turn this off:</p>
<div id="46" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 0.14 seconds
Compute duration  = 0.14 seconds
parameters        = x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse    ess_bulk   ess_tail      rhat    ⋯
      Symbol   Float64   Float64   Float64     Float64    Float64   Float64    ⋯

           x    0.1602    0.0117    0.0003   1857.7761        NaN    1.0004    ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

           x    0.1605    0.1605    0.1605    0.1605    0.1605</code></pre>
</div>
</div>
<p>The fun thing is that this still sort of works because</p>
<div id="48" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">logpdf</span>(<span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>), <span class="fl">10.0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-Inf</code></pre>
</div>
</div>
<p>and so the samples that fall outside of the range are always rejected. But do notice how much worse all the diagnostics are, e.g.&nbsp;<code>ess_tail</code> is very poor compared to when we use <code>unconstrained=true</code>. Moreover, in more complex cases this won’t just result in a “nice” <code>-Inf</code> log-density value, but instead will error:</p>
<div id="50" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="kw">function</span> <span class="fu">demo</span>()</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>    σ² <span class="op">~</span> <span class="fu">truncated</span>(<span class="fu">Normal</span>(), lower<span class="op">=</span><span class="fl">0</span>)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If we end up with negative values for `σ²`, the `Normal` will error.</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>    x <span class="op">~</span> <span class="fu">Normal</span>(<span class="fl">0</span>, σ²)</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>DomainError: DomainError(-0.5026544286524408, "Normal: the condition σ &gt;= zero(σ) is not satisfied.")
DomainError with -0.5026544286524408:
Normal: the condition σ &gt;= zero(σ) is not satisfied.
Stacktrace:
  [1] #371
    @ ~/.julia/packages/Distributions/j0ZcJ/src/univariate/continuous/normal.jl:37 [inlined]
  [2] check_args
    @ ~/.julia/packages/Distributions/j0ZcJ/src/utils.jl:89 [inlined]
  [3] #Normal#370
    @ ~/.julia/packages/Distributions/j0ZcJ/src/univariate/continuous/normal.jl:37 [inlined]
  [4] Normal
    @ ~/.julia/packages/Distributions/j0ZcJ/src/univariate/continuous/normal.jl:36 [inlined]
  [5] Normal
    @ ~/.julia/packages/Distributions/j0ZcJ/src/univariate/continuous/normal.jl:42 [inlined]
  [6] macro expansion
    @ ~/.julia/packages/DynamicPPL/cvlfK/src/compiler.jl:584 [inlined]
  [7] demo
    @ ~/work/docs/docs/developers/inference/implementing-samplers/index.qmd:457 [inlined]
  [8] _evaluate!!
    @ ~/.julia/packages/DynamicPPL/cvlfK/src/model.jl:914 [inlined]
  [9] evaluate_threadsafe!!(model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, varinfo::DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, context::DynamicPPL.ValuesAsInModelContext{OrderedDict{Any, Any}, DynamicPPL.DefaultContext})
    @ DynamicPPL ~/.julia/packages/DynamicPPL/cvlfK/src/model.jl:903
 [10] evaluate!!
    @ ~/.julia/packages/DynamicPPL/cvlfK/src/model.jl:833 [inlined]
 [11] values_as_in_model
    @ ~/.julia/packages/DynamicPPL/cvlfK/src/values_as_in_model.jl:196 [inlined]
 [12] values_as_in_model
    @ ~/.julia/packages/DynamicPPL/cvlfK/src/values_as_in_model.jl:195 [inlined]
 [13] getparams(model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, vi::DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64})
    @ Turing.Inference ~/.julia/packages/Turing/NQDYt/src/mcmc/Inference.jl:381
 [14] Turing.Inference.Transition(model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, vi::DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, t::MALASample{Vector{Float64}})
    @ Turing.Inference ~/.julia/packages/Turing/NQDYt/src/mcmc/Inference.jl:256
 [15] transition_to_turing
    @ ~/.julia/packages/Turing/NQDYt/src/mcmc/abstractmcmc.jl:12 [inlined]
 [16] transition_to_turing(f::LogDensityProblemsADForwardDiffExt.ForwardDiffLogDensity{LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, Nothing}, ForwardDiff.Chunk{2}, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}, transition::MALASample{Vector{Float64}})
    @ Turing.Inference ~/.julia/packages/Turing/NQDYt/src/mcmc/abstractmcmc.jl:17
 [17] step(rng::TaskLocalRNG, model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, sampler_wrapper::DynamicPPL.Sampler{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}; initial_state::Nothing, initial_params::Nothing, kwargs::@Kwargs{})
    @ Turing.Inference ~/.julia/packages/Turing/NQDYt/src/mcmc/abstractmcmc.jl:147
 [18] macro expansion
    @ ~/.julia/packages/AbstractMCMC/FSyVk/src/sample.jl:0 [inlined]
 [19] macro expansion
    @ ~/.julia/packages/AbstractMCMC/FSyVk/src/logging.jl:16 [inlined]
 [20] mcmcsample(rng::TaskLocalRNG, model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, sampler::DynamicPPL.Sampler{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}, N::Int64; progress::Bool, progressname::String, callback::Nothing, num_warmup::Int64, discard_initial::Int64, thinning::Int64, chain_type::Type, initial_state::Nothing, kwargs::@Kwargs{})
    @ AbstractMCMC ~/.julia/packages/AbstractMCMC/FSyVk/src/sample.jl:142
 [21] sample(rng::TaskLocalRNG, model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, sampler::DynamicPPL.Sampler{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}, N::Int64; chain_type::Type, resume_from::Nothing, initial_state::Nothing, kwargs::@Kwargs{progress::Bool})
    @ DynamicPPL ~/.julia/packages/DynamicPPL/cvlfK/src/sampler.jl:107
 [22] sample
    @ ~/.julia/packages/DynamicPPL/cvlfK/src/sampler.jl:97 [inlined]
 [23] #sample#4
    @ ~/.julia/packages/Turing/NQDYt/src/mcmc/Inference.jl:303 [inlined]
 [24] sample
    @ ~/.julia/packages/Turing/NQDYt/src/mcmc/Inference.jl:294 [inlined]
 [25] #sample#3
    @ ~/.julia/packages/Turing/NQDYt/src/mcmc/Inference.jl:291 [inlined]
 [26] top-level scope
    @ ~/work/docs/docs/developers/inference/implementing-samplers/index.qmd:459</code></pre>
</div>
</div>
<p>As expected, we run into a <code>DomainError</code> at some point, while if we set <code>unconstrained=true</code>, letting Turing.jl transform the model to a unconstrained form behind the scenes, everything works as expected:</p>
<div id="52" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 1.94 seconds
Compute duration  = 1.94 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse   ess_bulk   ess_tail      rhat   e ⋯
      Symbol   Float64   Float64   Float64    Float64    Float64   Float64     ⋯

          σ²    0.8586    0.5449    0.0220   477.3045   245.9922    1.0013     ⋯
           x   -0.0023    0.9482    0.0439   628.8821   317.2783    1.0011     ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

          σ²    0.1374    0.4235    0.7436    1.1941    2.1776
           x   -2.0733   -0.4225    0.0193    0.4257    2.0531</code></pre>
</div>
</div>
<p>Neat!</p>
<p>Similarly, which automatic differentiation backend one should use can be specified through the <code>adtype</code> keyword argument too. For example, if we want to use <a href="https://github.com/JuliaDiff/ReverseDiff.jl">ReverseDiff.jl</a> instead of the default <a href="https://github.com/JuliaDiff/ForwardDiff.jl">ForwardDiff.jl</a>:</p>
<div id="54" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">ReverseDiff</span>: ReverseDiff</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify that we want to use `AutoReverseDiff`.</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">demo</span>(),</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>, adtype<span class="op">=</span><span class="fu">AutoReverseDiff</span>()),</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>;</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 3.73 seconds
Compute duration  = 3.73 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse   ess_bulk   ess_tail      rhat   e ⋯
      Symbol   Float64   Float64   Float64    Float64    Float64   Float64     ⋯

          σ²    0.8389    0.5506    0.0327   179.5118    57.6071    1.0054     ⋯
           x    0.0669    0.9715    0.0453   553.9991   456.1999    1.0026     ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

          σ²    0.1347    0.3832    0.7319    1.1939    2.1083
           x   -1.9220   -0.3987    0.0149    0.4423    2.3390</code></pre>
</div>
</div>
<p>Double-neat.</p>
</section>
</section>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<p>At this point it’s worth maybe reminding ourselves what we did and also <em>why</em> we did it:</p>
<ol type="1">
<li>We define our models in the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface because it makes the sampler agnostic to how the underlying model is implemented.</li>
<li>We implement our sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> interface, which just means that our sampler is a subtype of <code>AbstractMCMC.AbstractSampler</code> and we implement the MCMC transition in <code>AbstractMCMC.step</code>.</li>
<li>Points 1 and 2 makes it so our sampler can be used with a wide range of model implementations, amongst them being models implemented in both Turing.jl and Stan. This gives you, the inference implementer, a large collection of models to test your inference method on, in addition to allowing users of Turing.jl and Stan to try out your inference method with minimal effort.</li>
</ol>


</section>


<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a><div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>We’re going with the leapfrog formulation because in a future version of this tutorial we’ll add a section extending this simple “baseline” MALA sampler to more complex versions. See <a href="https://github.com/TuringLang/docs/issues/479">issue #479</a> for progress on this.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>There is no such thing as a proper interface in Julia (at least not officially), and so we use the word “interface” here to mean a few minimal methods that needs to be implemented by any type that we treat as a target model.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/turinglang\.org\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../../developers/inference/variational-inference/index.html" class="pagination-link" aria-label="Variational Inference">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Variational Inference</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Turing is created by <a href="http://mlg.eng.cam.ac.uk/hong/" target="_blank">Hong Ge</a>, and lovingly maintained by the <a href="https://github.com/TuringLang/Turing.jl/graphs/contributors" target="_blank">core team</a> of volunteers. <br> The contents of this website are © 2024 under the terms of the <a href="https://github.com/TuringLang/Turing.jl/blob/master/LICENCE" target="_blank">MIT License</a>.</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/TuringLang/docs/edit/master/developers/inference/implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/docs/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://x.com/TuringLang">
      <i class="bi bi-twitter" role="img" aria-label="Turing Twitter">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/TuringLang/Turing.jl">
      <i class="bi bi-github" role="img" aria-label="Turing GitHub">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




<script src="../../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>