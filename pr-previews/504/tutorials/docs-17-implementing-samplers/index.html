<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.56">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Implementing samplers – Turing.jl</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../tutorials/docs-07-for-developers-variational-inference/index.html" rel="prev">
<link href="../../assets/favicon.ico" rel="icon">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<style>
  a {
    text-decoration: none;
  }
  a:hover {
    text-decoration: underline;
  }
</style>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../theming/styles.css">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="https://turinglang.org/" class="navbar-brand navbar-brand-logo">
    <img src="../../assets/images/turing-logo.svg" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="https://turinglang.org/">
    <span class="navbar-title">Turing.jl</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../tutorials/docs-00-getting-started/"> 
<span class="menu-text">Get Started</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../tutorials/00-introduction/"> 
<span class="menu-text">Tutorials</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/library/"> 
<span class="menu-text">Libraries</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/news/"> 
<span class="menu-text">News</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/team/"> 
<span class="menu-text">Team</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-v0.33" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">v0.33</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-v0.33">    
        <li>
    <a class="dropdown-item" href="https://turinglang.org/docs/changelog.html">
 <span class="dropdown-text">Changelog</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://turinglang.org/docs/versions.html">
 <span class="dropdown-text">All Versions</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
    <a href="https://x.com/TuringLang" title="Turing Twitter" class="quarto-navigation-tool px-1" aria-label="Turing Twitter"><i class="bi bi-twitter"></i></a>
    <a href="https://github.com/TuringLang/Turing.jl" title="Turing GitHub" class="quarto-navigation-tool px-1" aria-label="Turing GitHub"><i class="bi bi-github"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Documentation</li><li class="breadcrumb-item"><a href="../../tutorials/docs-04-for-developers-abstractmcmc-turing/index.html">For Developers (Inference)</a></li><li class="breadcrumb-item"><a href="../../tutorials/docs-17-implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Documentation</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false">
 <span class="menu-text">Using Turing - Modelling Syntax and Interface</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-00-getting-started/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Getting Started</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-14-using-turing-quick-start/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Quick Start</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-12-using-turing-guide/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Guide</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-17-mode-estimation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Mode Estimation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-09-using-turing-advanced/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Advanced Usage</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-10-using-turing-autodiff/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Automatic Differentiation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-13-using-turing-performance-tips/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Performance Tips</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-11-using-turing-dynamichmc/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using DynamicHMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-15-using-turing-sampler-viz/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Sampler Visualization</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-16-using-turing-external-samplers/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">External Samplers</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false">
 <span class="menu-text">Using Turing - Tutorials</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/00-introduction/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction to Turing</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/01-gaussian-mixture-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Mixture Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/02-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/03-bayesian-neural-network/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Neural Networks</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/04-hidden-markov-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Hidden Markov Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/05-linear-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Linear Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/06-infinite-mixture-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Infinite Mixture Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/07-poisson-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Poisson Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/08-multinomial-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Multinomial Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/09-variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/10-bayesian-differential-equations/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Differential Equations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/11-probabilistic-pca/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Probabilistic PCA</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/13-seasonal-time-series/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Time Series Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/15-gaussian-processes/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction to Gaussian Processes</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/12-gplvm/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Process Latent Variable Models</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false">
 <span class="menu-text">For Developers (PPL)</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-01-contributing-guide/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">How to Contribute</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-05-for-developers-compiler/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Turing Compiler Design</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/14-minituring/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation I: Compiler</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/16-contexts/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation II: Contexts</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-06-for-developers-interface/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Interface Guide</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">For Developers (Inference)</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-04-for-developers-abstractmcmc-turing/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">How Turing implements AbstractMCMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-07-for-developers-variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-17-implementing-samplers/index.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Implementing Samplers</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of Contents</h2>
   
  <ul>
  <li><a href="#quick-overview-of-mala" id="toc-quick-overview-of-mala" class="nav-link active" data-scroll-target="#quick-overview-of-mala">Quick overview of MALA</a></li>
  <li><a href="#what-we-need-from-a-model-logdensityproblems.jl" id="toc-what-we-need-from-a-model-logdensityproblems.jl" class="nav-link" data-scroll-target="#what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: LogDensityProblems.jl</a></li>
  <li><a href="#implementing-mala-in-abstractmcmc.jl" id="toc-implementing-mala-in-abstractmcmc.jl" class="nav-link" data-scroll-target="#implementing-mala-in-abstractmcmc.jl">Implementing MALA in AbstractMCMC.jl</a></li>
  <li><a href="#using-our-sampler-with-turing.jl" id="toc-using-our-sampler-with-turing.jl" class="nav-link" data-scroll-target="#using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</a>
  <ul class="collapse">
  <li><a href="#models-with-constrained-parameters" id="toc-models-with-constrained-parameters" class="nav-link" data-scroll-target="#models-with-constrained-parameters">Models with constrained parameters</a></li>
  </ul></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/TuringLang/docs/edit/master/tutorials/docs-17-implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/docs/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Documentation</li><li class="breadcrumb-item"><a href="../../tutorials/docs-04-for-developers-abstractmcmc-turing/index.html">For Developers (Inference)</a></li><li class="breadcrumb-item"><a href="../../tutorials/docs-17-implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Implementing samplers</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>In this tutorial, we’ll go through step-by-step how to implement a “simple” sampler in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> in such a way that it can be easily applied to Turing.jl models.</p>
<p>In particular, we’re going to implement a version of <strong>Metropolis-adjusted Langevin (MALA)</strong>.</p>
<p>Note that we will implement this sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> framework, completely “ignoring” Turing.jl until the very end of the tutorial, at which point we’ll use a single line of code to make the resulting sampler available to Turing.jl. This is to really drive home the point that one can implement samplers in a way that is accessible to all of Turing.jl’s users without having to use Turing.jl yourself.</p>
<section id="quick-overview-of-mala" class="level2">
<h2 class="anchored" data-anchor-id="quick-overview-of-mala">Quick overview of MALA</h2>
<p>We can view MALA as a single step of the leapfrog intergrator with resampling of momentum <span class="math inline">\(p\)</span> at every step.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> To make that statement a bit more concrete, we first define the <em>extended</em> target <span class="math inline">\(\bar{\gamma}(x, p)\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\log \bar{\gamma}(x, p) \propto \log \gamma(x) + \log \gamma_{\mathcal{N}(0, M)}(p)
\end{equation*}\]</span></p>
<p>where <span class="math inline">\(\gamma_{\mathcal{N}(0, M)}\)</span> denotes the density for a zero-centered Gaussian with covariance matrix <span class="math inline">\(M\)</span>. We then consider targeting this joint distribution over both <span class="math inline">\(x\)</span> and <span class="math inline">\(p\)</span> as follows. First we define the map</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  L_{\epsilon}: \quad &amp; \mathbb{R}^d \times \mathbb{R}^d \to \mathbb{R}^d \times \mathbb{R}^d \\
  &amp; (x, p) \mapsto (\tilde{x}, \tilde{p}) := L_{\epsilon}(x, p)
\end{split}
\end{equation*}\]</span></p>
<p>as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p_{1 / 2} &amp;:= p + \frac{\epsilon}{2} \nabla \log \gamma(x) \\
  \tilde{x} &amp;:= x + \epsilon M^{-1} p_{1 /2 } \\
  p_1 &amp;:= p_{1 / 2} + \frac{\epsilon}{2} \nabla \log \gamma(\tilde{x}) \\
  \tilde{p} &amp;:= - p_1
\end{split}
\end{equation*}\]</span></p>
<p>This might be familiar for some readers as a single step of the Leapfrog integrator. We then define the MALA kernel as follows: given the current iterate <span class="math inline">\(x_i\)</span>, we sample the next iterate <span class="math inline">\(x_{i + 1}\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p &amp;\sim \mathcal{N}(0, M) \\
  (\tilde{x}, \tilde{p}) &amp;:= L_{\epsilon}(x_i, p) \\
  \alpha &amp;:= \min \left\{ 1, \frac{\bar{\gamma}(\tilde{x}, \tilde{p})}{\bar{\gamma}(x_i, p)} \right\} \\
  x_{i + 1} &amp;:=
  \begin{cases}
    \tilde{x} \quad &amp; \text{ with prob. } \alpha \\
    x_i       \quad &amp; \text{ with prob. } 1 - \alpha
  \end{cases}
\end{split}
\end{equation*}\]</span></p>
<p>i.e.&nbsp;we accept the proposal <span class="math inline">\(\tilde{x}\)</span> with probability <span class="math inline">\(\alpha\)</span> and reject it, thus sticking with our current iterate, with probability <span class="math inline">\(1 - \alpha\)</span>.</p>
</section>
<section id="what-we-need-from-a-model-logdensityproblems.jl" class="level2">
<h2 class="anchored" data-anchor-id="what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a></h2>
<p>There are a few things we need from the “target” / “model” / density that we want to sample from:</p>
<ol type="1">
<li>We need access to log-density <em>evaluations</em> <span class="math inline">\(\log \gamma(x)\)</span> so we can compute the acceptance ratio involving <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>We need access to log-density <em>gradients</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span> so we can compute the Leapfrog steps <span class="math inline">\(L_{\epsilon}(x, p)\)</span>.</li>
<li>We also need access to the “size” of the model so we can determine the size of <span class="math inline">\(M\)</span>.</li>
</ol>
<p>Luckily for us, there is a package called <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> which provides an interface for <em>exactly</em> this!</p>
<p>To demonstrate how one can implement the “<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface”<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> we will use a simple Gaussian model as an example:</p>
<div id="4" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblems</span>: LogDensityProblems;</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's define some type that represents the model.</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> IsotropicNormalModel{M<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"mean of the isotropic Gaussian"</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    mean<span class="op">::</span><span class="dt">M</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Specifies what input length the model expects.</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">dimension</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> <span class="fu">length</span>(model.mean)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Implementation of the log-density evaluation of the model.</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x<span class="op">::</span><span class="dt">AbstractVector{&lt;:Real}</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">-</span> <span class="fu">sum</span>(abs2, x <span class="op">.-</span> model.mean) <span class="op">/</span> <span class="fl">2</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This gives us all of the properties we want for our MALA sampler with the exception of the computation of the <em>gradient</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span>. There is the method <code>LogDensityProblems.logdensity_and_gradient</code> which should return a 2-tuple where the first entry is the evaluation of the logdensity <span class="math inline">\(\log \gamma(x)\)</span> and the second entry is the gradient <span class="math inline">\(\nabla \log \gamma(x)\)</span>.</p>
<p>There are two ways to “implement” this method: 1) we implement it by hand, which is feasible in the case of our <code>IsotropicNormalModel</code>, or b) we defer the implementation of this to a automatic differentiation backend.</p>
<p>To implement it by hand we can simply do</p>
<div id="6" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl that first-order, i.e. gradient information, is available.</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{1}</span>()</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Implement `logdensity_and_gradient`.</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    logγ_x <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="op">-</span>x <span class="op">.*</span> (x <span class="op">-</span> model.mean)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> logγ_x, ∇logγ_x</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s just try it out:</p>
<div id="8" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate the problem.</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> <span class="fu">IsotropicNormalModel</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.])</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create some example input that we can test on.</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>x_example <span class="op">=</span> <span class="fu">randn</span>(LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate!</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-26.614281184965897</code></pre>
</div>
</div>
<p>To defer it to an automatic differentiation backend, we can do</p>
<div id="10" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl we only have access to 0-th order information.</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{0}</span>()</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Use `LogDensityProblemsAD`'s `ADgradient` in combination with some AD backend to implement `logdensity_and_gradient`.</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblemsAD</span>, <span class="bu">ADTypes</span>, <span class="bu">ForwardDiff</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>model_with_grad <span class="op">=</span> <span class="fu">ADgradient</span>(<span class="fu">AutoForwardDiff</span>(), model)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model_with_grad, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-26.614281184965897</code></pre>
</div>
</div>
<p>We’ll continue with the second approach in this tutorial since this is typically what one does in practice, because there are better hobbies to spend time on than deriving gradients by hand.</p>
<p>At this point, one might wonder how we’re going to tie this back to Turing.jl in the end. Effectively, when working with inference methods that only require log-density evaluations and / or higher-order information of the log-density, Turing.jl actually converts the user-provided <code>Model</code> into an object implementing the above methods for <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>. As a result, most samplers provided by Turing.jl are actually implemented to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, enabling their use both <em>within</em> Turing.jl and <em>outside</em> of Turing.jl! Morever, there exists similar conversions for Stan through BridgeStan and Stan<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, which means that a sampler supporting the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface can easily be used on both Turing.jl <em>and</em> Stan models (in addition to user-provided models, as our <code>IsotropicNormalModel</code> above)!</p>
<p>Anyways, let’s move on to actually implementing the sampler.</p>
</section>
<section id="implementing-mala-in-abstractmcmc.jl" class="level2">
<h2 class="anchored" data-anchor-id="implementing-mala-in-abstractmcmc.jl">Implementing MALA in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a></h2>
<p>Now that we’ve established that a model implementing the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface provides us with all the information we need from <span class="math inline">\(\log \gamma(x)\)</span>, we can address the question: given an object that implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, how can we define a sampler for it?</p>
<p>We’re going to do this by making our sampler a sub-type of <code>AbstractMCMC.AbstractSampler</code> in addition to implementing a few methods from <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>. Why? Because it gets us <em>a lot</em> of functionality for free, as we will see later.</p>
<p>Moreover, <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> provides a very natural interface for MCMC algorithms.</p>
<p>First, we’ll define our <code>MALA</code> type</p>
<div id="12" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">AbstractMCMC</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALA{T,A} <span class="op">&lt;:</span><span class="dt"> AbstractMCMC.AbstractSampler</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"stepsize used in the leapfrog step"</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    ϵ_init<span class="op">::</span><span class="dt">T</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"covariance matrix used for the momentum"</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    M_init<span class="op">::</span><span class="dt">A</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notice how we’ve added the suffix <code>_init</code> to both the stepsize and the covariance matrix. We’ve done this because a <code>AbstractMCMC.AbstractSampler</code> should be <em>immutable</em>. Of course there might be many scenarios where we want to allow something like the stepsize and / or the covariance matrix to vary between iterations, e.g.&nbsp;during the burn-in / adaptation phase of the sampling process we might want to adjust the parameters using statistics computed from these initial iterations. But information which can change between iterations <em>should not go in the sampler itself</em>! Instead, this information should go in the sampler <em>state</em>.</p>
<p>The sampler state should at the very least contain all the necessary information to perform the next MCMC iteration, but usually contains further information, e.g.&nbsp;quantities and statistics useful for evaluating whether the sampler has converged.</p>
<p>We will use the following sampler state for our <code>MALA</code> sampler:</p>
<div id="14" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALAState{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This might seem overly redundant: we’re defining a type <code>MALAState</code> and it only contains a simple vector of reals. In this particular case we indeed could have dropped this and simply used a <code>AbstractVector{&lt;:Real}</code> as our sampler state, but typically, as we will see later, one wants to include other quantities in the sampler state. For example, if we also wanted to adapt the parameters of our <code>MALA</code>, e.g.&nbsp;alter the stepsize depending on acceptance rates, in which case we should also put <code>ϵ</code> in the state, but for now we’ll keep things simple.</p>
<p>Moreover, we also want a <em>sample</em> type, which is a type meant for “public consumption”, i.e.&nbsp;the end-user. This is generally going to contain a subset of the information present in the state. But in such a simple scenario as this, we similarly only have a <code>AbstractVector{&lt;:Real}</code>:</p>
<div id="16" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALASample{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We currently have three things:</p>
<ol type="1">
<li>A <code>AbstractMCMC.AbstractSampler</code> implementation called <code>MALA</code>.</li>
<li>A state <code>MALAState</code> for our sampler <code>MALA</code>.</li>
<li>A sample <code>MALASample</code> for our sampler <code>MALA</code>.</li>
</ol>
<p>That means that we’re ready to implement the only thing that really matters: <code>AbstractMCMC.step</code>.</p>
<p><code>AbstractMCMC.step</code> defines the MCMC iteration of our <code>MALA</code> given the current <code>MALAState</code>. Specifically, the signature of the function is as follows:</p>
<div id="18" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The RNG to ensure reproducibility.</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The model that defines our target.</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.AbstractModel</span>,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The sampler for which we're taking a `step`.</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">AbstractMCMC.AbstractSampler</span>,</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The current sampler `state`.</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    state;</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Additional keyword arguments that we may or may not need.</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Moreover, there is a specific <code>AbstractMCMC.AbstractModel</code> which is used to indicate that the model that is provided implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface: <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Since, as we discussed earlier, in our case we’re indeed going to work with types that support the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, we’ll define <code>AbstractMCMC.step</code> for such a <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Note that <code>AbstractMCMC.LogDensityModel</code> has no other purpose; it has a single field called <code>logdensity</code>, and it does nothing else. But by wrapping the model in <code>AbstractMCMC.LogDensityModel</code>, it allows samplers that want to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> to define their <code>AbstractMCMC.step</code> on this type without running into method ambiguities.</p>
<p>All in all, that means that the signature for our <code>AbstractMCMC.step</code> is going to be the following:</p>
<div id="20" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># `LogDensityModel` so we know we're working with LogDensityProblems.jl model.</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler.</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler state.</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Great! Now let’s actually implement the full <code>AbstractMCMC.step</code> for our <code>MALA</code>.</p>
<p>Let’s remind ourselves what we’re going to do:</p>
<ol type="1">
<li>Sample a new momentum <span class="math inline">\(p\)</span>.</li>
<li>Compute the log-density of the extended target <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>Take a single leapfrog step <span class="math inline">\((\tilde{x}, \tilde{p}) = L_{\epsilon}(x, p)\)</span>.</li>
<li>Accept or reject the proposed <span class="math inline">\((\tilde{x}, \tilde{p})\)</span>.</li>
</ol>
<p>All in all, this results in the following:</p>
<div id="22" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>: Random</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Distributions</span>  <span class="co"># so we get the `MvNormal`</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the wrapped model which implements LogDensityProblems.jl.</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just extract the sampler parameters to make our lives easier.</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    ϵ <span class="op">=</span> sampler.ϵ_init</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    M <span class="op">=</span> sampler.M_init</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the current parameters.</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> state.x</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sample the momentum.</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>    p_dist <span class="op">=</span> <span class="fu">MvNormal</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)), M)</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> <span class="fu">rand</span>(rng, p_dist)</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Propose using a single leapfrog step.</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>    x̃, p̃ <span class="op">=</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Accept or reject proposal.</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>    logp <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p)</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>    logp̃ <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x̃) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p̃)</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>    logα <span class="op">=</span> logp̃ <span class="op">-</span> logp</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>    state_new <span class="op">=</span> <span class="cf">if</span> <span class="fu">log</span>(<span class="fu">rand</span>(rng)) <span class="op">&lt;</span> logα</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Accept.</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x̃)</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Reject.</span></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x)</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return the "sample" and the sampler state.</span></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(state_new.x), state_new</span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Fairly straight-forward.</p>
<p>Of course, we haven’t defined the <code>leapfrog_step</code> method yet, so let’s do that:</p>
<div id="24" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p` using "position" `x`.</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x))</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    p1 <span class="op">=</span> p <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update the "position" `x` using momentum `p1`.</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    x̃ <span class="op">=</span> x <span class="op">+</span> ϵ <span class="op">.*</span> (M <span class="op">\</span> p1)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p1` using position `x̃`</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x̃ <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x̃))</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    p2 <span class="op">=</span> p1 <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x̃</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Flip momentum `p2`.</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    p̃ <span class="op">=</span> <span class="op">-</span>p2</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x̃, p̃</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>leapfrog_step (generic function with 1 method)</code></pre>
</div>
</div>
<p>With all of this, we’re technically ready to sample!</p>
<div id="26" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>, <span class="bu">LinearAlgebra</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>rng <span class="op">=</span> <span class="bu">Random</span>.<span class="fu">default_rng</span>()</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>sampler <span class="op">=</span> <span class="fu">MALA</span>(<span class="fl">1</span>, I)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>state <span class="op">=</span> <span class="fu">MALAState</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)))</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>x_next, state_next <span class="op">=</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    rng,</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    AbstractMCMC.<span class="fu">LogDensityModel</span>(model),</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    state</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>(MALASample{Vector{Float64}}([0.0, 0.0, 0.0]), MALAState{Vector{Float64}}([0.0, 0.0, 0.0]))</code></pre>
</div>
</div>
<p>Great, it works!</p>
<p>And I promised we would get quite some functionality for free if we implemented <code>AbstractMCMC.step</code>, and so we can now simply call <code>sample</code> to perform standard MCMC sampling:</p>
<div id="28" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform 1000 iterations with our `MALA` sampler.</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; initial_state<span class="op">=</span>state, progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Concatenate into a matrix.</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000 Matrix{Float64}:
 -2.33116   -3.84543   -4.55851  …  -5.74915  -4.475     -6.08815
  0.285976  -0.222158   1.04759      1.65966   0.600756   0.0724397
  1.05301    3.23694    4.37503      6.04709   6.0142     5.46055</code></pre>
</div>
</div>
<div id="30" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the marginal means and standard deviations.</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -4.99761    1.01167
  0.0115773  0.999075
  5.01066    1.01792</code></pre>
</div>
</div>
<p>Let’s visualize the samples</p>
<div id="32" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">StatsPlots</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">transpose</span>(samples_matrix[<span class="op">:</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">:</span><span class="kw">end</span>]), alpha<span class="op">=</span><span class="fl">0.5</span>, legend<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<!--?xml version="1.0" encoding="utf-8"?-->
<svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" width="672" height="480" viewbox="0 0 2688 1920">
<defs>
  <clippath id="clip950">
    <rect x="0" y="0" width="2688" height="1920"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip950)" d="M0 1920 L2688 1920 L2688 0 L0 0  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip951">
    <rect x="537" y="0" width="1883" height="1883"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip950)" d="M196.816 1800.78 L2640.76 1800.78 L2640.76 47.2441 L196.816 47.2441  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip952">
    <rect x="196" y="47" width="2445" height="1755"></rect>
  </clippath>
</defs>
<polyline clip-path="url(#clip952)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="263.676,1800.78 263.676,47.2441 "></polyline>
<polyline clip-path="url(#clip952)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="840.654,1800.78 840.654,47.2441 "></polyline>
<polyline clip-path="url(#clip952)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1417.63,1800.78 1417.63,47.2441 "></polyline>
<polyline clip-path="url(#clip952)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1994.61,1800.78 1994.61,47.2441 "></polyline>
<polyline clip-path="url(#clip952)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="2571.59,1800.78 2571.59,47.2441 "></polyline>
<polyline clip-path="url(#clip950)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1800.78 2640.76,1800.78 "></polyline>
<polyline clip-path="url(#clip950)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="263.676,1800.78 263.676,1781.88 "></polyline>
<polyline clip-path="url(#clip950)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="840.654,1800.78 840.654,1781.88 "></polyline>
<polyline clip-path="url(#clip950)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1417.63,1800.78 1417.63,1781.88 "></polyline>
<polyline clip-path="url(#clip950)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1994.61,1800.78 1994.61,1781.88 "></polyline>
<polyline clip-path="url(#clip950)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="2571.59,1800.78 2571.59,1781.88 "></polyline>
<path clip-path="url(#clip950)" d="M263.676 1834 Q260.065 1834 258.236 1837.57 Q256.431 1841.11 256.431 1848.24 Q256.431 1855.34 258.236 1858.91 Q260.065 1862.45 263.676 1862.45 Q267.31 1862.45 269.116 1858.91 Q270.945 1855.34 270.945 1848.24 Q270.945 1841.11 269.116 1837.57 Q267.31 1834 263.676 1834 M263.676 1830.3 Q269.486 1830.3 272.542 1834.9 Q275.621 1839.49 275.621 1848.24 Q275.621 1856.96 272.542 1861.57 Q269.486 1866.15 263.676 1866.15 Q257.866 1866.15 254.787 1861.57 Q251.732 1856.96 251.732 1848.24 Q251.732 1839.49 254.787 1834.9 Q257.866 1830.3 263.676 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip950)" d="M804.346 1861.55 L820.666 1861.55 L820.666 1865.48 L798.721 1865.48 L798.721 1861.55 Q801.383 1858.79 805.967 1854.16 Q810.573 1849.51 811.754 1848.17 Q813.999 1845.65 814.879 1843.91 Q815.782 1842.15 815.782 1840.46 Q815.782 1837.71 813.837 1835.97 Q811.916 1834.23 808.814 1834.23 Q806.615 1834.23 804.161 1835 Q801.731 1835.76 798.953 1837.31 L798.953 1832.59 Q801.777 1831.46 804.231 1830.88 Q806.684 1830.3 808.721 1830.3 Q814.092 1830.3 817.286 1832.98 Q820.481 1835.67 820.481 1840.16 Q820.481 1842.29 819.67 1844.21 Q818.883 1846.11 816.777 1848.7 Q816.198 1849.37 813.096 1852.59 Q809.995 1855.78 804.346 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip950)" d="M830.527 1830.92 L848.883 1830.92 L848.883 1834.86 L834.809 1834.86 L834.809 1843.33 Q835.828 1842.98 836.846 1842.82 Q837.865 1842.64 838.883 1842.64 Q844.67 1842.64 848.05 1845.81 Q851.43 1848.98 851.43 1854.4 Q851.43 1859.97 847.957 1863.08 Q844.485 1866.15 838.166 1866.15 Q835.99 1866.15 833.721 1865.78 Q831.476 1865.41 829.069 1864.67 L829.069 1859.97 Q831.152 1861.11 833.374 1861.66 Q835.596 1862.22 838.073 1862.22 Q842.078 1862.22 844.416 1860.11 Q846.754 1858.01 846.754 1854.4 Q846.754 1850.78 844.416 1848.68 Q842.078 1846.57 838.073 1846.57 Q836.198 1846.57 834.323 1846.99 Q832.471 1847.4 830.527 1848.28 L830.527 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip950)" d="M870.642 1834 Q867.031 1834 865.203 1837.57 Q863.397 1841.11 863.397 1848.24 Q863.397 1855.34 865.203 1858.91 Q867.031 1862.45 870.642 1862.45 Q874.277 1862.45 876.082 1858.91 Q877.911 1855.34 877.911 1848.24 Q877.911 1841.11 876.082 1837.57 Q874.277 1834 870.642 1834 M870.642 1830.3 Q876.453 1830.3 879.508 1834.9 Q882.587 1839.49 882.587 1848.24 Q882.587 1856.96 879.508 1861.57 Q876.453 1866.15 870.642 1866.15 Q864.832 1866.15 861.754 1861.57 Q858.698 1856.96 858.698 1848.24 Q858.698 1839.49 861.754 1834.9 Q864.832 1830.3 870.642 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip950)" d="M1377.25 1830.92 L1395.61 1830.92 L1395.61 1834.86 L1381.53 1834.86 L1381.53 1843.33 Q1382.55 1842.98 1383.57 1842.82 Q1384.59 1842.64 1385.61 1842.64 Q1391.39 1842.64 1394.77 1845.81 Q1398.15 1848.98 1398.15 1854.4 Q1398.15 1859.97 1394.68 1863.08 Q1391.21 1866.15 1384.89 1866.15 Q1382.71 1866.15 1380.44 1865.78 Q1378.2 1865.41 1375.79 1864.67 L1375.79 1859.97 Q1377.88 1861.11 1380.1 1861.66 Q1382.32 1862.22 1384.8 1862.22 Q1388.8 1862.22 1391.14 1860.11 Q1393.48 1858.01 1393.48 1854.4 Q1393.48 1850.78 1391.14 1848.68 Q1388.8 1846.57 1384.8 1846.57 Q1382.92 1846.57 1381.05 1846.99 Q1379.19 1847.4 1377.25 1848.28 L1377.25 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip950)" d="M1417.37 1834 Q1413.75 1834 1411.93 1837.57 Q1410.12 1841.11 1410.12 1848.24 Q1410.12 1855.34 1411.93 1858.91 Q1413.75 1862.45 1417.37 1862.45 Q1421 1862.45 1422.81 1858.91 Q1424.63 1855.34 1424.63 1848.24 Q1424.63 1841.11 1422.81 1837.57 Q1421 1834 1417.37 1834 M1417.37 1830.3 Q1423.18 1830.3 1426.23 1834.9 Q1429.31 1839.49 1429.31 1848.24 Q1429.31 1856.96 1426.23 1861.57 Q1423.18 1866.15 1417.37 1866.15 Q1411.56 1866.15 1408.48 1861.57 Q1405.42 1856.96 1405.42 1848.24 Q1405.42 1839.49 1408.48 1834.9 Q1411.56 1830.3 1417.37 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip950)" d="M1447.53 1834 Q1443.92 1834 1442.09 1837.57 Q1440.28 1841.11 1440.28 1848.24 Q1440.28 1855.34 1442.09 1858.91 Q1443.92 1862.45 1447.53 1862.45 Q1451.16 1862.45 1452.97 1858.91 Q1454.8 1855.34 1454.8 1848.24 Q1454.8 1841.11 1452.97 1837.57 Q1451.16 1834 1447.53 1834 M1447.53 1830.3 Q1453.34 1830.3 1456.39 1834.9 Q1459.47 1839.49 1459.47 1848.24 Q1459.47 1856.96 1456.39 1861.57 Q1453.34 1866.15 1447.53 1866.15 Q1441.72 1866.15 1438.64 1861.57 Q1435.58 1856.96 1435.58 1848.24 Q1435.58 1839.49 1438.64 1834.9 Q1441.72 1830.3 1447.53 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip950)" d="M1952.89 1830.92 L1975.11 1830.92 L1975.11 1832.91 L1962.56 1865.48 L1957.68 1865.48 L1969.48 1834.86 L1952.89 1834.86 L1952.89 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip950)" d="M1984.27 1830.92 L2002.63 1830.92 L2002.63 1834.86 L1988.56 1834.86 L1988.56 1843.33 Q1989.58 1842.98 1990.59 1842.82 Q1991.61 1842.64 1992.63 1842.64 Q1998.42 1842.64 2001.8 1845.81 Q2005.18 1848.98 2005.18 1854.4 Q2005.18 1859.97 2001.7 1863.08 Q1998.23 1866.15 1991.91 1866.15 Q1989.74 1866.15 1987.47 1865.78 Q1985.22 1865.41 1982.82 1864.67 L1982.82 1859.97 Q1984.9 1861.11 1987.12 1861.66 Q1989.34 1862.22 1991.82 1862.22 Q1995.83 1862.22 1998.16 1860.11 Q2000.5 1858.01 2000.5 1854.4 Q2000.5 1850.78 1998.16 1848.68 Q1995.83 1846.57 1991.82 1846.57 Q1989.95 1846.57 1988.07 1846.99 Q1986.22 1847.4 1984.27 1848.28 L1984.27 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip950)" d="M2024.39 1834 Q2020.78 1834 2018.95 1837.57 Q2017.14 1841.11 2017.14 1848.24 Q2017.14 1855.34 2018.95 1858.91 Q2020.78 1862.45 2024.39 1862.45 Q2028.02 1862.45 2029.83 1858.91 Q2031.66 1855.34 2031.66 1848.24 Q2031.66 1841.11 2029.83 1837.57 Q2028.02 1834 2024.39 1834 M2024.39 1830.3 Q2030.2 1830.3 2033.26 1834.9 Q2036.33 1839.49 2036.33 1848.24 Q2036.33 1856.96 2033.26 1861.57 Q2030.2 1866.15 2024.39 1866.15 Q2018.58 1866.15 2015.5 1861.57 Q2012.45 1856.96 2012.45 1848.24 Q2012.45 1839.49 2015.5 1834.9 Q2018.58 1830.3 2024.39 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip950)" d="M2516.11 1861.55 L2523.75 1861.55 L2523.75 1835.18 L2515.44 1836.85 L2515.44 1832.59 L2523.71 1830.92 L2528.38 1830.92 L2528.38 1861.55 L2536.02 1861.55 L2536.02 1865.48 L2516.11 1865.48 L2516.11 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip950)" d="M2555.47 1834 Q2551.85 1834 2550.03 1837.57 Q2548.22 1841.11 2548.22 1848.24 Q2548.22 1855.34 2550.03 1858.91 Q2551.85 1862.45 2555.47 1862.45 Q2559.1 1862.45 2560.9 1858.91 Q2562.73 1855.34 2562.73 1848.24 Q2562.73 1841.11 2560.9 1837.57 Q2559.1 1834 2555.47 1834 M2555.47 1830.3 Q2561.28 1830.3 2564.33 1834.9 Q2567.41 1839.49 2567.41 1848.24 Q2567.41 1856.96 2564.33 1861.57 Q2561.28 1866.15 2555.47 1866.15 Q2549.66 1866.15 2546.58 1861.57 Q2543.52 1856.96 2543.52 1848.24 Q2543.52 1839.49 2546.58 1834.9 Q2549.66 1830.3 2555.47 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip950)" d="M2585.63 1834 Q2582.02 1834 2580.19 1837.57 Q2578.38 1841.11 2578.38 1848.24 Q2578.38 1855.34 2580.19 1858.91 Q2582.02 1862.45 2585.63 1862.45 Q2589.26 1862.45 2591.07 1858.91 Q2592.9 1855.34 2592.9 1848.24 Q2592.9 1841.11 2591.07 1837.57 Q2589.26 1834 2585.63 1834 M2585.63 1830.3 Q2591.44 1830.3 2594.49 1834.9 Q2597.57 1839.49 2597.57 1848.24 Q2597.57 1856.96 2594.49 1861.57 Q2591.44 1866.15 2585.63 1866.15 Q2579.82 1866.15 2576.74 1861.57 Q2573.68 1856.96 2573.68 1848.24 Q2573.68 1839.49 2576.74 1834.9 Q2579.82 1830.3 2585.63 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip950)" d="M2615.79 1834 Q2612.18 1834 2610.35 1837.57 Q2608.54 1841.11 2608.54 1848.24 Q2608.54 1855.34 2610.35 1858.91 Q2612.18 1862.45 2615.79 1862.45 Q2619.42 1862.45 2621.23 1858.91 Q2623.06 1855.34 2623.06 1848.24 Q2623.06 1841.11 2621.23 1837.57 Q2619.42 1834 2615.79 1834 M2615.79 1830.3 Q2621.6 1830.3 2624.65 1834.9 Q2627.73 1839.49 2627.73 1848.24 Q2627.73 1856.96 2624.65 1861.57 Q2621.6 1866.15 2615.79 1866.15 Q2609.98 1866.15 2606.9 1861.57 Q2603.84 1856.96 2603.84 1848.24 Q2603.84 1839.49 2606.9 1834.9 Q2609.98 1830.3 2615.79 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip952)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,1715.21 2640.76,1715.21 "></polyline>
<polyline clip-path="url(#clip952)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,1475.86 2640.76,1475.86 "></polyline>
<polyline clip-path="url(#clip952)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,1236.5 2640.76,1236.5 "></polyline>
<polyline clip-path="url(#clip952)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,997.146 2640.76,997.146 "></polyline>
<polyline clip-path="url(#clip952)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,757.791 2640.76,757.791 "></polyline>
<polyline clip-path="url(#clip952)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,518.436 2640.76,518.436 "></polyline>
<polyline clip-path="url(#clip952)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,279.08 2640.76,279.08 "></polyline>
<polyline clip-path="url(#clip950)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1800.78 196.816,47.2441 "></polyline>
<polyline clip-path="url(#clip950)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1715.21 215.714,1715.21 "></polyline>
<polyline clip-path="url(#clip950)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1475.86 215.714,1475.86 "></polyline>
<polyline clip-path="url(#clip950)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1236.5 215.714,1236.5 "></polyline>
<polyline clip-path="url(#clip950)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,997.146 215.714,997.146 "></polyline>
<polyline clip-path="url(#clip950)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,757.791 215.714,757.791 "></polyline>
<polyline clip-path="url(#clip950)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,518.436 215.714,518.436 "></polyline>
<polyline clip-path="url(#clip950)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,279.08 215.714,279.08 "></polyline>
<path clip-path="url(#clip950)" d="M50.5475 1715.66 L80.2233 1715.66 L80.2233 1719.6 L50.5475 1719.6 L50.5475 1715.66 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip950)" d="M89.1352 1697.93 L111.357 1697.93 L111.357 1699.92 L98.8111 1732.49 L93.9269 1732.49 L105.732 1701.87 L89.1352 1701.87 L89.1352 1697.93 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip950)" d="M120.478 1726.61 L125.362 1726.61 L125.362 1732.49 L120.478 1732.49 L120.478 1726.61 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip950)" d="M135.593 1697.93 L153.95 1697.93 L153.95 1701.87 L139.876 1701.87 L139.876 1710.34 Q140.894 1709.99 141.913 1709.83 Q142.931 1709.65 143.95 1709.65 Q149.737 1709.65 153.116 1712.82 Q156.496 1715.99 156.496 1721.4 Q156.496 1726.98 153.024 1730.09 Q149.552 1733.16 143.232 1733.16 Q141.056 1733.16 138.788 1732.79 Q136.542 1732.42 134.135 1731.68 L134.135 1726.98 Q136.218 1728.12 138.441 1728.67 Q140.663 1729.23 143.14 1729.23 Q147.144 1729.23 149.482 1727.12 Q151.82 1725.02 151.82 1721.4 Q151.82 1717.79 149.482 1715.69 Q147.144 1713.58 143.14 1713.58 Q141.265 1713.58 139.39 1714 Q137.538 1714.41 135.593 1715.29 L135.593 1697.93 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip950)" d="M49.5521 1476.31 L79.2279 1476.31 L79.2279 1480.24 L49.5521 1480.24 L49.5521 1476.31 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip950)" d="M89.3667 1458.58 L107.723 1458.58 L107.723 1462.51 L93.6491 1462.51 L93.6491 1470.98 Q94.6676 1470.64 95.6861 1470.48 Q96.7047 1470.29 97.7232 1470.29 Q103.51 1470.29 106.89 1473.46 Q110.269 1476.63 110.269 1482.05 Q110.269 1487.63 106.797 1490.73 Q103.325 1493.81 97.0056 1493.81 Q94.8297 1493.81 92.5612 1493.44 Q90.3158 1493.07 87.9084 1492.33 L87.9084 1487.63 Q89.9917 1488.76 92.2139 1489.32 Q94.4361 1489.87 96.913 1489.87 Q100.918 1489.87 103.256 1487.77 Q105.593 1485.66 105.593 1482.05 Q105.593 1478.44 103.256 1476.33 Q100.918 1474.23 96.913 1474.23 Q95.038 1474.23 93.163 1474.64 Q91.3112 1475.06 89.3667 1475.94 L89.3667 1458.58 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip950)" d="M119.482 1487.26 L124.367 1487.26 L124.367 1493.14 L119.482 1493.14 L119.482 1487.26 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip950)" d="M144.552 1461.66 Q140.941 1461.66 139.112 1465.22 Q137.306 1468.76 137.306 1475.89 Q137.306 1483 139.112 1486.56 Q140.941 1490.1 144.552 1490.1 Q148.186 1490.1 149.991 1486.56 Q151.82 1483 151.82 1475.89 Q151.82 1468.76 149.991 1465.22 Q148.186 1461.66 144.552 1461.66 M144.552 1457.95 Q150.362 1457.95 153.417 1462.56 Q156.496 1467.14 156.496 1475.89 Q156.496 1484.62 153.417 1489.23 Q150.362 1493.81 144.552 1493.81 Q138.741 1493.81 135.663 1489.23 Q132.607 1484.62 132.607 1475.89 Q132.607 1467.14 135.663 1462.56 Q138.741 1457.95 144.552 1457.95 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip950)" d="M50.5475 1236.95 L80.2233 1236.95 L80.2233 1240.89 L50.5475 1240.89 L50.5475 1236.95 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip950)" d="M94.3436 1249.85 L110.663 1249.85 L110.663 1253.78 L88.7186 1253.78 L88.7186 1249.85 Q91.3806 1247.09 95.9639 1242.46 Q100.57 1237.81 101.751 1236.47 Q103.996 1233.94 104.876 1232.21 Q105.779 1230.45 105.779 1228.76 Q105.779 1226 103.834 1224.27 Q101.913 1222.53 98.8111 1222.53 Q96.6121 1222.53 94.1584 1223.3 Q91.7278 1224.06 88.9501 1225.61 L88.9501 1220.89 Q91.7741 1219.75 94.2278 1219.18 Q96.6815 1218.6 98.7185 1218.6 Q104.089 1218.6 107.283 1221.28 Q110.478 1223.97 110.478 1228.46 Q110.478 1230.59 109.668 1232.51 Q108.881 1234.41 106.774 1237 Q106.195 1237.67 103.094 1240.89 Q99.9917 1244.08 94.3436 1249.85 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip950)" d="M120.478 1247.9 L125.362 1247.9 L125.362 1253.78 L120.478 1253.78 L120.478 1247.9 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip950)" d="M135.593 1219.22 L153.95 1219.22 L153.95 1223.16 L139.876 1223.16 L139.876 1231.63 Q140.894 1231.28 141.913 1231.12 Q142.931 1230.93 143.95 1230.93 Q149.737 1230.93 153.116 1234.11 Q156.496 1237.28 156.496 1242.69 Q156.496 1248.27 153.024 1251.37 Q149.552 1254.45 143.232 1254.45 Q141.056 1254.45 138.788 1254.08 Q136.542 1253.71 134.135 1252.97 L134.135 1248.27 Q136.218 1249.41 138.441 1249.96 Q140.663 1250.52 143.14 1250.52 Q147.144 1250.52 149.482 1248.41 Q151.82 1246.3 151.82 1242.69 Q151.82 1239.08 149.482 1236.98 Q147.144 1234.87 143.14 1234.87 Q141.265 1234.87 139.39 1235.29 Q137.538 1235.7 135.593 1236.58 L135.593 1219.22 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip950)" d="M99.3204 982.945 Q95.7093 982.945 93.8806 986.51 Q92.075 990.051 92.075 997.181 Q92.075 1004.29 93.8806 1007.85 Q95.7093 1011.39 99.3204 1011.39 Q102.955 1011.39 104.76 1007.85 Q106.589 1004.29 106.589 997.181 Q106.589 990.051 104.76 986.51 Q102.955 982.945 99.3204 982.945 M99.3204 979.241 Q105.131 979.241 108.186 983.848 Q111.265 988.431 111.265 997.181 Q111.265 1005.91 108.186 1010.51 Q105.131 1015.1 99.3204 1015.1 Q93.5102 1015.1 90.4315 1010.51 Q87.376 1005.91 87.376 997.181 Q87.376 988.431 90.4315 983.848 Q93.5102 979.241 99.3204 979.241 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip950)" d="M119.482 1008.55 L124.367 1008.55 L124.367 1014.43 L119.482 1014.43 L119.482 1008.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip950)" d="M144.552 982.945 Q140.941 982.945 139.112 986.51 Q137.306 990.051 137.306 997.181 Q137.306 1004.29 139.112 1007.85 Q140.941 1011.39 144.552 1011.39 Q148.186 1011.39 149.991 1007.85 Q151.82 1004.29 151.82 997.181 Q151.82 990.051 149.991 986.51 Q148.186 982.945 144.552 982.945 M144.552 979.241 Q150.362 979.241 153.417 983.848 Q156.496 988.431 156.496 997.181 Q156.496 1005.91 153.417 1010.51 Q150.362 1015.1 144.552 1015.1 Q138.741 1015.1 135.663 1010.51 Q132.607 1005.91 132.607 997.181 Q132.607 988.431 135.663 983.848 Q138.741 979.241 144.552 979.241 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip950)" d="M94.3436 771.136 L110.663 771.136 L110.663 775.071 L88.7186 775.071 L88.7186 771.136 Q91.3806 768.381 95.9639 763.752 Q100.57 759.099 101.751 757.756 Q103.996 755.233 104.876 753.497 Q105.779 751.738 105.779 750.048 Q105.779 747.293 103.834 745.557 Q101.913 743.821 98.8111 743.821 Q96.6121 743.821 94.1584 744.585 Q91.7278 745.349 88.9501 746.9 L88.9501 742.178 Q91.7741 741.043 94.2278 740.465 Q96.6815 739.886 98.7185 739.886 Q104.089 739.886 107.283 742.571 Q110.478 745.256 110.478 749.747 Q110.478 751.877 109.668 753.798 Q108.881 755.696 106.774 758.289 Q106.195 758.96 103.094 762.177 Q99.9917 765.372 94.3436 771.136 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip950)" d="M120.478 769.191 L125.362 769.191 L125.362 775.071 L120.478 775.071 L120.478 769.191 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip950)" d="M135.593 740.511 L153.95 740.511 L153.95 744.446 L139.876 744.446 L139.876 752.918 Q140.894 752.571 141.913 752.409 Q142.931 752.224 143.95 752.224 Q149.737 752.224 153.116 755.395 Q156.496 758.566 156.496 763.983 Q156.496 769.562 153.024 772.664 Q149.552 775.742 143.232 775.742 Q141.056 775.742 138.788 775.372 Q136.542 775.002 134.135 774.261 L134.135 769.562 Q136.218 770.696 138.441 771.252 Q140.663 771.807 143.14 771.807 Q147.144 771.807 149.482 769.701 Q151.82 767.594 151.82 763.983 Q151.82 760.372 149.482 758.265 Q147.144 756.159 143.14 756.159 Q141.265 756.159 139.39 756.576 Q137.538 756.992 135.593 757.872 L135.593 740.511 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip950)" d="M89.3667 501.156 L107.723 501.156 L107.723 505.091 L93.6491 505.091 L93.6491 513.563 Q94.6676 513.216 95.6861 513.054 Q96.7047 512.868 97.7232 512.868 Q103.51 512.868 106.89 516.04 Q110.269 519.211 110.269 524.628 Q110.269 530.206 106.797 533.308 Q103.325 536.387 97.0056 536.387 Q94.8297 536.387 92.5612 536.016 Q90.3158 535.646 87.9084 534.905 L87.9084 530.206 Q89.9917 531.341 92.2139 531.896 Q94.4361 532.452 96.913 532.452 Q100.918 532.452 103.256 530.345 Q105.593 528.239 105.593 524.628 Q105.593 521.017 103.256 518.91 Q100.918 516.804 96.913 516.804 Q95.038 516.804 93.163 517.22 Q91.3112 517.637 89.3667 518.517 L89.3667 501.156 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip950)" d="M119.482 529.836 L124.367 529.836 L124.367 535.716 L119.482 535.716 L119.482 529.836 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip950)" d="M144.552 504.234 Q140.941 504.234 139.112 507.799 Q137.306 511.341 137.306 518.47 Q137.306 525.577 139.112 529.142 Q140.941 532.683 144.552 532.683 Q148.186 532.683 149.991 529.142 Q151.82 525.577 151.82 518.47 Q151.82 511.341 149.991 507.799 Q148.186 504.234 144.552 504.234 M144.552 500.531 Q150.362 500.531 153.417 505.137 Q156.496 509.72 156.496 518.47 Q156.496 527.197 153.417 531.804 Q150.362 536.387 144.552 536.387 Q138.741 536.387 135.663 531.804 Q132.607 527.197 132.607 518.47 Q132.607 509.72 135.663 505.137 Q138.741 500.531 144.552 500.531 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip950)" d="M89.1352 261.8 L111.357 261.8 L111.357 263.791 L98.8111 296.36 L93.9269 296.36 L105.732 265.735 L89.1352 265.735 L89.1352 261.8 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip950)" d="M120.478 290.481 L125.362 290.481 L125.362 296.36 L120.478 296.36 L120.478 290.481 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip950)" d="M135.593 261.8 L153.95 261.8 L153.95 265.735 L139.876 265.735 L139.876 274.207 Q140.894 273.86 141.913 273.698 Q142.931 273.513 143.95 273.513 Q149.737 273.513 153.116 276.684 Q156.496 279.856 156.496 285.272 Q156.496 290.851 153.024 293.953 Q149.552 297.031 143.232 297.031 Q141.056 297.031 138.788 296.661 Q136.542 296.291 134.135 295.55 L134.135 290.851 Q136.218 291.985 138.441 292.541 Q140.663 293.096 143.14 293.096 Q147.144 293.096 149.482 290.99 Q151.82 288.883 151.82 285.272 Q151.82 281.661 149.482 279.555 Q147.144 277.448 143.14 277.448 Q141.265 277.448 139.39 277.865 Q137.538 278.282 135.593 279.161 L135.593 261.8 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip952)" style="stroke:#009af9; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="265.984,1220.34 268.292,1595.18 270.6,1477.51 272.908,1410.13 275.216,1672.51 277.524,1526.24 279.832,1450.29 282.139,1450.85 284.447,1655.99 286.755,1457.47 289.063,1398.6 291.371,1565.27 293.679,1602.55 295.987,1574.74 298.295,1314.52 300.603,1531.76 302.911,1399.39 305.219,1441.81 307.527,1494.62 309.834,1481.72 312.142,1294.97 314.45,1595.32 316.758,1569.9 319.066,1420.45 321.374,1501.34 323.682,1549.35 325.99,1412.39 328.298,1499.96 330.606,1440.65 332.914,1227.07 335.221,1453.09 337.529,1277.25 339.837,1389.92 342.145,1539.59 344.453,1527.8 346.761,1464.75 349.069,1448.69 351.377,1393.75 353.685,1592.83 355.993,1355.96 358.301,1506.23 360.608,1395.42 362.916,1697.78 365.224,1567.5 367.532,1523.58 369.84,1388.82 372.148,1669.79 374.456,1422.92 376.764,1533.05 379.072,1452.26 381.38,1444.68 383.688,1389.09 385.996,1578.72 388.303,1314.14 390.611,1471.93 392.919,1597.37 395.227,1489.13 397.535,1368.92 399.843,1480.17 402.151,1356.03 404.459,1533.35 406.767,1628.75 409.075,1493.74 411.383,1457.98 413.69,1489.73 415.998,1457.25 418.306,1522.64 420.614,1336.58 422.922,1540.73 425.23,1481.04 427.538,1609.71 429.846,1426.19 432.154,1404.52 434.462,1287.19 436.77,1402.55 439.077,1410.33 441.385,1504.73 443.693,1390.23 446.001,1569.92 448.309,1686.49 450.617,1221.15 452.925,1364.16 455.233,1384.59 457.541,1525.34 459.849,1405.47 462.157,1398.34 464.465,1623.04 466.772,1463.99 469.08,1296.61 471.388,1697.7 473.696,1269.46 476.004,1448.07 478.312,1417.85 480.62,1339.1 482.928,1380.23 485.236,1505.16 487.544,1457.66 489.852,1462.69 492.159,1520.84 494.467,1416.99 496.775,1365.54 499.083,1451.28 501.391,1557.93 503.699,1427.51 506.007,1554.94 508.315,1554.82 510.623,1449.61 512.931,1495.92 515.239,1344.1 517.546,1684.96 519.854,1512.33 522.162,1534.05 524.47,1414.39 526.778,1530.21 529.086,1484.71 531.394,1606.95 533.702,1486.56 536.01,1607.51 538.318,1475.2 540.626,1509.9 542.933,1496.36 545.241,1480.16 547.549,1492.97 549.857,1462.85 552.165,1376.5 554.473,1289.84 556.781,1293.62 559.089,1536.62 561.397,1404.82 563.705,1620.74 566.013,1353.17 568.321,1545.08 570.628,1393.97 572.936,1301.13 575.244,1428.45 577.552,1258.22 579.86,1453.26 582.168,1597.91 584.476,1504.81 586.784,1449.06 589.092,1601.49 591.4,1562.6 593.708,1477.1 596.015,1353.68 598.323,1502.17 600.631,1395.07 602.939,1399.89 605.247,1476.14 607.555,1500.05 609.863,1502.39 612.171,1488.31 614.479,1467.52 616.787,1594.43 619.095,1548.96 621.402,1496.03 623.71,1312.09 626.018,1674.9 628.326,1314.36 630.634,1509.54 632.942,1431.55 635.25,1639.94 637.558,1331.86 639.866,1486.23 642.174,1511.75 644.482,1259.77 646.79,1402.72 649.097,1343.69 651.405,1433.38 653.713,1408.29 656.021,1419.02 658.329,1557.06 660.637,1372.47 662.945,1555.15 665.253,1539.09 667.561,1551.48 669.869,1592.44 672.177,1343.82 674.484,1389.74 676.792,1314.98 679.1,1309.39 681.408,1400.6 683.716,1543.41 686.024,1485.2 688.332,1604.25 690.64,1579.04 692.948,1556.65 695.256,1363.17 697.564,1511.36 699.871,1538.68 702.179,1607.89 704.487,1410.07 706.795,1393.36 709.103,1262.23 711.411,1558.78 713.719,1584.54 716.027,1420.63 718.335,1405.95 720.643,1653.33 722.951,1498.72 725.259,1579.01 727.566,1378.76 729.874,1413.76 732.182,1400.86 734.49,1378.44 736.798,1491.2 739.106,1167.86 741.414,1404.1 743.722,1531.8 746.03,1526.56 748.338,1578.49 750.646,1685.84 752.953,1373.28 755.261,1573.29 757.569,1561.27 759.877,1558.38 762.185,1451.11 764.493,1612.71 766.801,1348.72 769.109,1623.43 771.417,1545.9 773.725,1539.28 776.033,1279.06 778.34,1518.84 780.648,1186.29 782.956,1388.22 785.264,1521.85 787.572,1733.95 789.88,1376.31 792.188,1470.83 794.496,1437.71 796.804,1364.06 799.112,1229.68 801.42,1515.12 803.728,1472.72 806.035,1605.63 808.343,1468.62 810.651,1527.04 812.959,1559.01 815.267,1286.98 817.575,1648.26 819.883,1525.72 822.191,1457.02 824.499,1439.15 826.807,1371.14 829.115,1558.71 831.422,1374.64 833.73,1453.79 836.038,1472.75 838.346,1494.86 840.654,1546.99 842.962,1413.93 845.27,1498.54 847.578,1494.87 849.886,1597.23 852.194,1479.78 854.502,1351.99 856.809,1407.89 859.117,1409.83 861.425,1512.71 863.733,1427.54 866.041,1582.93 868.349,1547.82 870.657,1534.89 872.965,1553.58 875.273,1483.81 877.581,1434.57 879.889,1559.75 882.197,1544.5 884.504,1669.31 886.812,1459.58 889.12,1240.45 891.428,1394.73 893.736,1386.6 896.044,1473.32 898.352,1391.32 900.66,1540.65 902.968,1270.79 905.276,1335.93 907.584,1528.12 909.891,1397.16 912.199,1318.43 914.507,1569.47 916.815,1610.24 919.123,1555.67 921.431,1471.59 923.739,1355.11 926.047,1751.15 928.355,1372.33 930.663,1628.46 932.971,1436.73 935.278,1434.61 937.586,1514.68 939.894,1419.12 942.202,1619.25 944.51,1468.97 946.818,1338.19 949.126,1280.22 951.434,1387.53 953.742,1481.28 956.05,1314.16 958.358,1363.67 960.665,1547.46 962.973,1606.47 965.281,1640.74 967.589,1451.27 969.897,1469.01 972.205,1483.91 974.513,1491.51 976.821,1516.14 979.129,1473 981.437,1406.65 983.745,1299.33 986.053,1422.34 988.36,1431.21 990.668,1440.44 992.976,1526.67 995.284,1360.68 997.592,1485.96 999.9,1588.97 1002.21,1524.8 1004.52,1474.31 1006.82,1463.36 1009.13,1418.05 1011.44,1405.91 1013.75,1477.07 1016.06,1295.92 1018.36,1498.4 1020.67,1434.54 1022.98,1446.38 1025.29,1468.98 1027.59,1486.14 1029.9,1365.63 1032.21,1429.01 1034.52,1665.82 1036.83,1517.09 1039.13,1354.57 1041.44,1575.56 1043.75,1525.14 1046.06,1553.77 1048.37,1412.25 1050.67,1335.7 1052.98,1604.78 1055.29,1455.52 1057.6,1535.11 1059.91,1521.95 1062.21,1529.8 1064.52,1552.34 1066.83,1329.28 1069.14,1541.99 1071.45,1557.9 1073.75,1492.53 1076.06,1471.75 1078.37,1526.71 1080.68,1536.31 1082.98,1706.66 1085.29,1443.83 1087.6,1679.94 1089.91,1519.02 1092.22,1514.13 1094.52,1379.38 1096.83,1368.71 1099.14,1536.58 1101.45,1502.98 1103.76,1549.42 1106.06,1557.06 1108.37,1352.73 1110.68,1477.28 1112.99,1539.93 1115.3,1558.7 1117.6,1470.88 1119.91,1584.55 1122.22,1476.03 1124.53,1334.27 1126.84,1387.88 1129.14,1296.14 1131.45,1566.85 1133.76,1333.83 1136.07,1443.78 1138.37,1404.75 1140.68,1547.57 1142.99,1497.04 1145.3,1474.77 1147.61,1473.71 1149.91,1472.97 1152.22,1397.67 1154.53,1541.01 1156.84,1423.77 1159.15,1479.61 1161.45,1489.61 1163.76,1381.13 1166.07,1423.42 1168.38,1529.19 1170.69,1560.51 1172.99,1388.43 1175.3,1511.43 1177.61,1407.4 1179.92,1565.56 1182.23,1406.28 1184.53,1477.44 1186.84,1287.18 1189.15,1385.74 1191.46,1343.13 1193.76,1487.72 1196.07,1507.23 1198.38,1509.63 1200.69,1521.02 1203,1395.03 1205.3,1440.46 1207.61,1465.78 1209.92,1514.59 1212.23,1437.36 1214.54,1538.02 1216.84,1477.79 1219.15,1545.72 1221.46,1541.47 1223.77,1479.49 1226.08,1501.7 1228.38,1487.71 1230.69,1492.86 1233,1518.82 1235.31,1482.2 1237.61,1511.59 1239.92,1529.22 1242.23,1562.89 1244.54,1336 1246.85,1716.56 1249.15,1554.88 1251.46,1471.85 1253.77,1357.13 1256.08,1575.3 1258.39,1378.82 1260.69,1548.21 1263,1640.66 1265.31,1491.72 1267.62,1549.42 1269.93,1358.42 1272.23,1434.97 1274.54,1514.1 1276.85,1362.62 1279.16,1372.89 1281.47,1471.61 1283.77,1661 1286.08,1613.13 1288.39,1411.96 1290.7,1463.84 1293,1390.38 1295.31,1573.03 1297.62,1359.82 1299.93,1463.36 1302.24,1390.97 1304.54,1529.14 1306.85,1440.42 1309.16,1408.07 1311.47,1351.67 1313.78,1635.63 1316.08,1361.83 1318.39,1476 1320.7,1340.51 1323.01,1451.11 1325.32,1385.88 1327.62,1485.39 1329.93,1521.08 1332.24,1493.78 1334.55,1412.55 1336.86,1549.52 1339.16,1548.97 1341.47,1509.26 1343.78,1587.56 1346.09,1448.96 1348.39,1338.22 1350.7,1328.76 1353.01,1472.18 1355.32,1405.29 1357.63,1533.96 1359.93,1440.07 1362.24,1618.18 1364.55,1421.31 1366.86,1544.83 1369.17,1448.28 1371.47,1606.54 1373.78,1370.71 1376.09,1478.53 1378.4,1463.44 1380.71,1482.4 1383.01,1497.67 1385.32,1221.42 1387.63,1403.72 1389.94,1314.31 1392.24,1722.08 1394.55,1350.54 1396.86,1190.61 1399.17,1585.73 1401.48,1352.18 1403.78,1330.12 1406.09,1493.77 1408.4,1303.51 1410.71,1435.51 1413.02,1582.98 1415.32,1429.54 1417.63,1488.64 1419.94,1392.38 1422.25,1633.05 1424.56,1385.13 1426.86,1436.92 1429.17,1507.79 1431.48,1438.34 1433.79,1359.12 1436.1,1706.02 1438.4,1241.24 1440.71,1427.32 1443.02,1429.76 1445.33,1474.06 1447.63,1357.72 1449.94,1384.82 1452.25,1576.7 1454.56,1413.33 1456.87,1487.11 1459.17,1495.12 1461.48,1478.52 1463.79,1507.01 1466.1,1476.39 1468.41,1576.08 1470.71,1540.12 1473.02,1480.02 1475.33,1543.2 1477.64,1412.17 1479.95,1484.85 1482.25,1349.32 1484.56,1533.58 1486.87,1375.04 1489.18,1492.98 1491.49,1471.28 1493.79,1442.07 1496.1,1496.8 1498.41,1414.24 1500.72,1404.97 1503.02,1475.39 1505.33,1518.37 1507.64,1409.01 1509.95,1509.7 1512.26,1395.46 1514.56,1554.04 1516.87,1317.67 1519.18,1507.54 1521.49,1370.36 1523.8,1388.39 1526.1,1387 1528.41,1461.85 1530.72,1533.56 1533.03,1454.88 1535.34,1426.73 1537.64,1418.4 1539.95,1360.88 1542.26,1400.36 1544.57,1333.11 1546.88,1535.27 1549.18,1487.23 1551.49,1554.08 1553.8,1551.05 1556.11,1376.08 1558.41,1330.87 1560.72,1462.49 1563.03,1523.29 1565.34,1461.53 1567.65,1611.37 1569.95,1554.23 1572.26,1326.53 1574.57,1376.03 1576.88,1548.93 1579.19,1552.46 1581.49,1498.71 1583.8,1490.91 1586.11,1515.17 1588.42,1540.64 1590.73,1464.26 1593.03,1336.03 1595.34,1405.59 1597.65,1465.37 1599.96,1541.95 1602.26,1419.53 1604.57,1516.02 1606.88,1396.76 1609.19,1484.11 1611.5,1414.8 1613.8,1486.81 1616.11,1440.44 1618.42,1448.92 1620.73,1606.8 1623.04,1539.48 1625.34,1539.07 1627.65,1401.77 1629.96,1421.66 1632.27,1528.85 1634.58,1460.9 1636.88,1632.65 1639.19,1488.26 1641.5,1515.96 1643.81,1500.98 1646.12,1458.66 1648.42,1463.1 1650.73,1472.89 1653.04,1503.08 1655.35,1252.59 1657.65,1479.08 1659.96,1446.54 1662.27,1523.96 1664.58,1470.02 1666.89,1263.05 1669.19,1493.09 1671.5,1306.76 1673.81,1447.71 1676.12,1529.66 1678.43,1607.7 1680.73,1355.27 1683.04,1512.76 1685.35,1687.41 1687.66,1407.76 1689.97,1472.67 1692.27,1456.81 1694.58,1399.36 1696.89,1602.68 1699.2,1397.29 1701.51,1518.05 1703.81,1352.4 1706.12,1275.37 1708.43,1491.5 1710.74,1447.21 1713.04,1427.91 1715.35,1379.32 1717.66,1545.52 1719.97,1585.78 1722.28,1554.97 1724.58,1541.32 1726.89,1539.59 1729.2,1522.05 1731.51,1618.4 1733.82,1461.29 1736.12,1577.1 1738.43,1347.9 1740.74,1444.9 1743.05,1504.12 1745.36,1468.65 1747.66,1458.92 1749.97,1319.65 1752.28,1492.55 1754.59,1429.11 1756.9,1607.8 1759.2,1356.28 1761.51,1450.46 1763.82,1238.18 1766.13,1386.14 1768.43,1396.85 1770.74,1492.17 1773.05,1534.16 1775.36,1386.55 1777.67,1480.24 1779.97,1610.75 1782.28,1445.18 1784.59,1511.07 1786.9,1369.69 1789.21,1435.75 1791.51,1702.89 1793.82,1594.75 1796.13,1478.22 1798.44,1543.82 1800.75,1398.62 1803.05,1367.07 1805.36,1489.6 1807.67,1459.38 1809.98,1455.46 1812.28,1506.18 1814.59,1631.96 1816.9,1449.17 1819.21,1410.92 1821.52,1309.92 1823.82,1453.86 1826.13,1393.87 1828.44,1439.25 1830.75,1429.37 1833.06,1456.56 1835.36,1546.44 1837.67,1491.8 1839.98,1403.73 1842.29,1397.28 1844.6,1544.71 1846.9,1436.08 1849.21,1451.89 1851.52,1540.7 1853.83,1286.41 1856.14,1483.17 1858.44,1704.75 1860.75,1540.88 1863.06,1334.86 1865.37,1259.87 1867.67,1517.53 1869.98,1479.1 1872.29,1589.6 1874.6,1449.58 1876.91,1444.58 1879.21,1414.75 1881.52,1418.54 1883.83,1509.3 1886.14,1443.16 1888.45,1491.3 1890.75,1403.98 1893.06,1473.11 1895.37,1467.37 1897.68,1312.13 1899.99,1385.07 1902.29,1492.01 1904.6,1585.75 1906.91,1316.1 1909.22,1265.5 1911.53,1493.79 1913.83,1576.05 1916.14,1407.81 1918.45,1493.17 1920.76,1381.57 1923.06,1521.2 1925.37,1425.78 1927.68,1385.99 1929.99,1396 1932.3,1298.42 1934.6,1547.58 1936.91,1615.35 1939.22,1610.06 1941.53,1471.68 1943.84,1498.05 1946.14,1420.79 1948.45,1426.32 1950.76,1275.12 1953.07,1299.93 1955.38,1466.75 1957.68,1338.66 1959.99,1374.53 1962.3,1405.89 1964.61,1340.11 1966.91,1573.86 1969.22,1444.1 1971.53,1492.49 1973.84,1439.99 1976.15,1523.25 1978.45,1553.83 1980.76,1462.17 1983.07,1490.41 1985.38,1372.16 1987.69,1612.83 1989.99,1574.19 1992.3,1540.45 1994.61,1457.19 1996.92,1506.44 1999.23,1481.09 2001.53,1448.92 2003.84,1565.82 2006.15,1567.93 2008.46,1325.15 2010.77,1658.2 2013.07,1501.72 2015.38,1578.26 2017.69,1371.91 2020,1451.55 2022.3,1504.36 2024.61,1441.92 2026.92,1486.96 2029.23,1319.4 2031.54,1530.21 2033.84,1389.12 2036.15,1293.86 2038.46,1511.41 2040.77,1444.25 2043.08,1476.5 2045.38,1621.87 2047.69,1649.77 2050,1361.2 2052.31,1524.27 2054.62,1502.46 2056.92,1442.04 2059.23,1412.43 2061.54,1329.11 2063.85,1311.9 2066.16,1660.46 2068.46,1408.24 2070.77,1461.04 2073.08,1543.18 2075.39,1531.65 2077.69,1475.73 2080,1481.05 2082.31,1378.09 2084.62,1615.12 2086.93,1466.18 2089.23,1451.24 2091.54,1390.62 2093.85,1529.17 2096.16,1382.84 2098.47,1480.48 2100.77,1526.4 2103.08,1318.33 2105.39,1352.41 2107.7,1532.36 2110.01,1414.91 2112.31,1460.89 2114.62,1476.06 2116.93,1587.29 2119.24,1387.92 2121.55,1473.36 2123.85,1457.96 2126.16,1443.85 2128.47,1524.75 2130.78,1475.12 2133.08,1483.88 2135.39,1482.46 2137.7,1529.56 2140.01,1492.21 2142.32,1487.61 2144.62,1494.57 2146.93,1550.74 2149.24,1498.3 2151.55,1514.59 2153.86,1496.55 2156.16,1330.1 2158.47,1514.84 2160.78,1504.46 2163.09,1339.51 2165.4,1380.58 2167.7,1514.98 2170.01,1456.36 2172.32,1557.93 2174.63,1375.85 2176.93,1368.51 2179.24,1590.86 2181.55,1520.75 2183.86,1512.64 2186.17,1331.76 2188.47,1463.07 2190.78,1517.27 2193.09,1465.01 2195.4,1456.55 2197.71,1567.82 2200.01,1504.84 2202.32,1552.34 2204.63,1381.28 2206.94,1486.7 2209.25,1505.63 2211.55,1492.31 2213.86,1500.5 2216.17,1607.23 2218.48,1555.47 2220.79,1436.7 2223.09,1423.18 2225.4,1368.4 2227.71,1525.39 2230.02,1245.76 2232.32,1382.45 2234.63,1454.76 2236.94,1415.51 2239.25,1429.37 2241.56,1484.92 2243.86,1457.23 2246.17,1578.35 2248.48,1456.83 2250.79,1458.97 2253.1,1265.1 2255.4,1406.21 2257.71,1400.9 2260.02,1439.39 2262.33,1465.99 2264.64,1625.29 2266.94,1311.52 2269.25,1455.84 2271.56,1460.88 2273.87,1496.21 2276.18,1399.63 2278.48,1548.43 2280.79,1350.88 2283.1,1487.37 2285.41,1381.58 2287.71,1547.89 2290.02,1467.39 2292.33,1484.19 2294.64,1455.33 2296.95,1570.31 2299.25,1480.16 2301.56,1551.96 2303.87,1328.83 2306.18,1476.64 2308.49,1484.49 2310.79,1351.58 2313.1,1458.27 2315.41,1423.56 2317.72,1486.01 2320.03,1399.84 2322.33,1536.49 2324.64,1662.33 2326.95,1402.73 2329.26,1440.49 2331.56,1235.26 2333.87,1534.5 2336.18,1580.81 2338.49,1451.35 2340.8,1533.31 2343.1,1461.1 2345.41,1750.9 2347.72,1412.26 2350.03,1552.49 2352.34,1316.33 2354.64,1668.35 2356.95,1510.27 2359.26,1523.14 2361.57,1523.96 2363.88,1548.14 2366.18,1509.01 2368.49,1459.02 2370.8,1351.35 2373.11,1527.78 2375.42,1557.56 2377.72,1432.51 2380.03,1428.48 2382.34,1474.42 2384.65,1562.6 2386.95,1635.11 2389.26,1389.44 2391.57,1581.66 2393.88,1531.41 2396.19,1549.45 2398.49,1356.48 2400.8,1360.16 2403.11,1458.16 2405.42,1593.88 2407.73,1524.53 2410.03,1486.14 2412.34,1626.06 2414.65,1594 2416.96,1493.69 2419.27,1501.31 2421.57,1451.21 2423.88,1450.05 2426.19,1408.58 2428.5,1340.43 2430.81,1432.72 2433.11,1543.14 2435.42,1580.74 2437.73,1598.44 2440.04,1455.27 2442.34,1483.62 2444.65,1496.64 2446.96,1518.61 2449.27,1554.58 2451.58,1510.06 2453.88,1303.97 2456.19,1422.14 2458.5,1337.57 2460.81,1535.85 2463.12,1356.8 2465.42,1379.09 2467.73,1475.58 2470.04,1583.52 2472.35,1367.26 2474.66,1635.64 2476.96,1418.01 2479.27,1376.5 2481.58,1605.88 2483.89,1388.53 2486.2,1539.44 2488.5,1592.69 2490.81,1486.07 2493.12,1533.19 2495.43,1516.6 2497.73,1539.51 2500.04,1576.97 2502.35,1570.35 2504.66,1454.6 2506.97,1592.8 2509.27,1371.23 2511.58,1522.66 2513.89,1509.05 2516.2,1388.43 2518.51,1346.74 2520.81,1553.56 2523.12,1488.66 2525.43,1572.02 2527.74,1230.7 2530.05,1504.52 2532.35,1418.04 2534.66,1493.67 2536.97,1374.91 2539.28,1639.87 2541.58,1521.79 2543.89,1559.68 2546.2,1462.98 2548.51,1371.32 2550.82,1565.97 2553.12,1420.56 2555.43,1392.47 2557.74,1393.43 2560.05,1213.82 2562.36,1334.29 2564.66,1522 2566.97,1348.51 2569.28,1545.81 2571.59,1631.85 "></polyline>
<polyline clip-path="url(#clip952)" style="stroke:#e26f46; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="265.984,969.766 268.292,859.414 270.6,857.181 272.908,1102.5 275.216,989.662 277.524,1032.43 279.832,1026 282.139,880.279 284.447,1183.32 286.755,932.158 289.063,772.047 291.371,1184.01 293.679,1018.45 295.987,926.923 298.295,1135.17 300.603,1166.29 302.911,988.729 305.219,906.129 307.527,866.372 309.834,1030.48 312.142,1027.33 314.45,888.595 316.758,1128.81 319.066,996.05 321.374,1089.73 323.682,927.528 325.99,916.184 328.298,1047.49 330.606,943.869 332.914,1009.42 335.221,1022.51 337.529,1025.35 339.837,940.985 342.145,1093.73 344.453,1020.26 346.761,957.764 349.069,917.311 351.377,926.612 353.685,965.774 355.993,982.367 358.301,1139.56 360.608,998.428 362.916,1003.72 365.224,1055.99 367.532,1018.16 369.84,1049.83 372.148,1010.12 374.456,973.509 376.764,890.664 379.072,926.138 381.38,912.392 383.688,924.487 385.996,1037.84 388.303,784.631 390.611,944.655 392.919,1101.44 395.227,1184.56 397.535,911.046 399.843,1106.49 402.151,1020.84 404.459,1033.78 406.767,990.728 409.075,1037.36 411.383,1131.64 413.69,1136.07 415.998,869.518 418.306,1003.72 420.614,1069.2 422.922,1104.75 425.23,937.118 427.538,1108.13 429.846,1128.81 432.154,970.213 434.462,930.065 436.77,950.427 439.077,937.224 441.385,670.856 443.693,1037.37 446.001,1069.58 448.309,1069.84 450.617,1055.66 452.925,1016.92 455.233,863.356 457.541,1074.83 459.849,1013.83 462.157,1094.59 464.465,1000.01 466.772,1025.02 469.08,1032.26 471.388,1069.24 473.696,944.043 476.004,914.213 478.312,1017.75 480.62,987.465 482.928,918.898 485.236,1154.67 487.544,998.393 489.852,1097 492.159,925.713 494.467,1050.46 496.775,1133.45 499.083,1003.09 501.391,892.395 503.699,1072.09 506.007,1096.88 508.315,844.225 510.623,1065.9 512.931,777.376 515.239,966.598 517.546,1208.08 519.854,919.509 522.162,1004.59 524.47,907.585 526.778,1077.2 529.086,1014.08 531.394,1027.29 533.702,1022 536.01,880.526 538.318,1079.32 540.626,941.407 542.933,945.893 545.241,1084.68 547.549,829.819 549.857,967.299 552.165,804.539 554.473,1144.23 556.781,850.352 559.089,1018.8 561.397,1065.99 563.705,1065.35 566.013,1037.53 568.321,1035.65 570.628,921.977 572.936,1046.13 575.244,1055.41 577.552,878.053 579.86,1032.44 582.168,1207.77 584.476,929.452 586.784,1019.3 589.092,1048.93 591.4,1025.87 593.708,938.692 596.015,950.925 598.323,1020.92 600.631,1154.9 602.939,964.442 605.247,946.771 607.555,1098.58 609.863,827.39 612.171,1002 614.479,946.472 616.787,964.151 619.095,954.954 621.402,1071.79 623.71,926.838 626.018,885.786 628.326,962.822 630.634,1016.02 632.942,1018.03 635.25,889.721 637.558,1030.3 639.866,980.885 642.174,929.981 644.482,1003.24 646.79,932.416 649.097,1056.31 651.405,1036.57 653.713,1044.51 656.021,751.361 658.329,930.219 660.637,814.597 662.945,960.404 665.253,911.078 667.561,1052.78 669.869,993.259 672.177,1029.4 674.484,773.894 676.792,1058.2 679.1,1253.03 681.408,982.774 683.716,1054.52 686.024,817.802 688.332,1024.45 690.64,1166.73 692.948,956.86 695.256,1028.89 697.564,1142.87 699.871,978.889 702.179,1108.84 704.487,1132.09 706.795,1073.86 709.103,1099.64 711.411,999.434 713.719,890.308 716.027,1126.53 718.335,997.057 720.643,1123.51 722.951,896.505 725.259,817.536 727.566,846.831 729.874,942.042 732.182,989.07 734.49,1201.34 736.798,1021.04 739.106,1124.92 741.414,1028.13 743.722,1003.5 746.03,961.226 748.338,995.006 750.646,1003.07 752.953,962.764 755.261,890.811 757.569,1251.64 759.877,1084.83 762.185,871.1 764.493,859.91 766.801,869.828 769.109,1092.27 771.417,956.833 773.725,987.205 776.033,1103.53 778.34,1046.25 780.648,1040.88 782.956,918.903 785.264,886.311 787.572,957.441 789.88,935.519 792.188,968.387 794.496,1079.91 796.804,890.536 799.112,1205.55 801.42,1018.52 803.728,870.806 806.035,845.042 808.343,1162.29 810.651,1058.28 812.959,902.549 815.267,999.669 817.575,964.58 819.883,819.991 822.191,989.318 824.499,983.049 826.807,1014.49 829.115,1035.14 831.422,831.497 833.73,811.778 836.038,991.218 838.346,1128.92 840.654,1110.3 842.962,987.731 845.27,936.049 847.578,996.133 849.886,900.91 852.194,996.575 854.502,972.447 856.809,988.369 859.117,877.414 861.425,941.541 863.733,990.886 866.041,994.802 868.349,1017.08 870.657,1008.37 872.965,1064.5 875.273,956.389 877.581,973.428 879.889,1012.68 882.197,1067.5 884.504,943.885 886.812,971.982 889.12,918.853 891.428,958.545 893.736,1087.93 896.044,1026.27 898.352,850.826 900.66,731.445 902.968,933.69 905.276,949.566 907.584,1115.4 909.891,944.434 912.199,1161.71 914.507,964.594 916.815,942.936 919.123,921.041 921.431,946.588 923.739,1001.24 926.047,1053.08 928.355,1040.51 930.663,1034.02 932.971,972.167 935.278,1149.28 937.586,1116.92 939.894,921.307 942.202,1050.56 944.51,1149.35 946.818,954.954 949.126,980.564 951.434,967.773 953.742,912.253 956.05,932.437 958.358,1031.29 960.665,896.593 962.973,1049.2 965.281,1042.02 967.589,902.919 969.897,956.341 972.205,907.019 974.513,870.348 976.821,1085.64 979.129,984.832 981.437,1012.71 983.745,1099.3 986.053,962.541 988.36,984.204 990.668,963.903 992.976,1085.23 995.284,1089.26 997.592,831.693 999.9,1086.78 1002.21,1090.47 1004.52,1089.76 1006.82,1043.45 1009.13,836.959 1011.44,994.078 1013.75,1129.42 1016.06,922.297 1018.36,1021.57 1020.67,1066.18 1022.98,1092.6 1025.29,1077.8 1027.59,1122.16 1029.9,996.351 1032.21,984.614 1034.52,952.98 1036.83,972.593 1039.13,890.109 1041.44,1114.2 1043.75,936.187 1046.06,1037.1 1048.37,1081.69 1050.67,1055.36 1052.98,1004.56 1055.29,925.918 1057.6,876.678 1059.91,1040.84 1062.21,967.189 1064.52,1097.89 1066.83,1134.39 1069.14,943.062 1071.45,1019.18 1073.75,1055.5 1076.06,1088.27 1078.37,859.803 1080.68,1171.01 1082.98,968.772 1085.29,1022.47 1087.6,933.235 1089.91,1097.5 1092.22,766.466 1094.52,1045.61 1096.83,909.104 1099.14,1142.92 1101.45,936.368 1103.76,924.554 1106.06,941.243 1108.37,941.257 1110.68,939.57 1112.99,951.021 1115.3,978.815 1117.6,992.137 1119.91,1057.26 1122.22,926.509 1124.53,1101.71 1126.84,853.526 1129.14,989.682 1131.45,949.37 1133.76,893.914 1136.07,957.033 1138.37,1017.19 1140.68,1070.1 1142.99,853.51 1145.3,964.102 1147.61,872.212 1149.91,1181.56 1152.22,1107.78 1154.53,964.464 1156.84,898.056 1159.15,898.217 1161.45,1054.09 1163.76,1088.31 1166.07,1005.95 1168.38,963.206 1170.69,952.417 1172.99,898.865 1175.3,1003.61 1177.61,1028.85 1179.92,942.404 1182.23,949.971 1184.53,1086.34 1186.84,978.166 1189.15,884.598 1191.46,1005.32 1193.76,936.318 1196.07,1154.82 1198.38,1069.16 1200.69,911.161 1203,1027.54 1205.3,1129.47 1207.61,823.642 1209.92,997.232 1212.23,975.577 1214.54,933.906 1216.84,1060.07 1219.15,1004.98 1221.46,869.303 1223.77,953.952 1226.08,1109.76 1228.38,913.194 1230.69,1167.97 1233,914.535 1235.31,990.826 1237.61,786.516 1239.92,936.442 1242.23,908.958 1244.54,1028.23 1246.85,918.983 1249.15,1024.21 1251.46,900.407 1253.77,853.05 1256.08,1000.41 1258.39,926.272 1260.69,1074.26 1263,1072.11 1265.31,995.242 1267.62,979.9 1269.93,1106.6 1272.23,940.296 1274.54,1049.59 1276.85,863.662 1279.16,1050.83 1281.47,1020.38 1283.77,1035.48 1286.08,915.074 1288.39,1051.66 1290.7,962.62 1293,1048.91 1295.31,1043.05 1297.62,1003.71 1299.93,1007.67 1302.24,1027.1 1304.54,1158.72 1306.85,975.45 1309.16,1061.94 1311.47,1025.53 1313.78,877.5 1316.08,1014.68 1318.39,918.324 1320.7,849.727 1323.01,946.77 1325.32,1123.12 1327.62,891.837 1329.93,1038.15 1332.24,970.191 1334.55,722.605 1336.86,926.306 1339.16,1133.07 1341.47,986.516 1343.78,1120.65 1346.09,1065.74 1348.39,1117.51 1350.7,1085.97 1353.01,1030.84 1355.32,882.821 1357.63,985.185 1359.93,903.055 1362.24,1213.64 1364.55,1072.09 1366.86,1042.6 1369.17,1034.04 1371.47,1092.01 1373.78,1038.43 1376.09,990.529 1378.4,943.365 1380.71,1093.51 1383.01,914.41 1385.32,1025.53 1387.63,967.007 1389.94,1059 1392.24,1165.93 1394.55,1024.83 1396.86,1051.83 1399.17,966.228 1401.48,929.158 1403.78,952.913 1406.09,1018.7 1408.4,986.054 1410.71,942.117 1413.02,983.352 1415.32,1104.35 1417.63,1104.26 1419.94,1044.03 1422.25,1095.45 1424.56,1095.34 1426.86,1066.6 1429.17,1094.54 1431.48,1006.22 1433.79,1021.97 1436.1,883.711 1438.4,1021.6 1440.71,842.5 1443.02,1061.06 1445.33,1003.95 1447.63,1023.3 1449.94,1105.87 1452.25,1102.19 1454.56,1015.22 1456.87,1009.74 1459.17,845.098 1461.48,1080.33 1463.79,959.652 1466.1,986.686 1468.41,920.59 1470.71,1006.78 1473.02,1092.71 1475.33,880.989 1477.64,1066.13 1479.95,1113.56 1482.25,1023.79 1484.56,1055.77 1486.87,1068.08 1489.18,995.706 1491.49,972.282 1493.79,953.787 1496.1,913.933 1498.41,980.596 1500.72,997.906 1503.02,1125.18 1505.33,1203.4 1507.64,903.042 1509.95,821.304 1512.26,819.566 1514.56,1077.13 1516.87,1093.66 1519.18,1086.8 1521.49,1020.01 1523.8,736.122 1526.1,960.43 1528.41,1105.49 1530.72,939.55 1533.03,998.564 1535.34,853.923 1537.64,1029.26 1539.95,1152.99 1542.26,947.619 1544.57,917.44 1546.88,917.203 1549.18,1043.17 1551.49,924.986 1553.8,1077.66 1556.11,974.956 1558.41,876.061 1560.72,945.72 1563.03,1232.22 1565.34,1138.27 1567.65,932.256 1569.95,1123.23 1572.26,1087.96 1574.57,940.645 1576.88,1084.17 1579.19,1057.08 1581.49,1044.23 1583.8,1001.35 1586.11,809.213 1588.42,939.506 1590.73,1112.83 1593.03,1017.21 1595.34,940.869 1597.65,1096.91 1599.96,1009.09 1602.26,1109.44 1604.57,1031.25 1606.88,971.18 1609.19,738.085 1611.5,1092.7 1613.8,1004.58 1616.11,1051.16 1618.42,963.282 1620.73,1031.18 1623.04,1068.7 1625.34,924.989 1627.65,1145.79 1629.96,1005.63 1632.27,886.222 1634.58,1147.55 1636.88,1104.09 1639.19,792.141 1641.5,1094.48 1643.81,895.224 1646.12,921.874 1648.42,1098.59 1650.73,804.197 1653.04,1068.53 1655.35,894.196 1657.65,1222.25 1659.96,1018.97 1662.27,1026.2 1664.58,919.533 1666.89,1105.29 1669.19,984.484 1671.5,899.71 1673.81,1098.1 1676.12,954.803 1678.43,954.385 1680.73,1061.01 1683.04,994.852 1685.35,1067.13 1687.66,1080.75 1689.97,891.525 1692.27,974.555 1694.58,1078.67 1696.89,717.596 1699.2,1066.93 1701.51,1155.25 1703.81,988.605 1706.12,876.826 1708.43,895.472 1710.74,1137.34 1713.04,1105.37 1715.35,937.158 1717.66,911.008 1719.97,1000.25 1722.28,1032.13 1724.58,968.208 1726.89,971.066 1729.2,986.506 1731.51,1144.13 1733.82,1077.4 1736.12,1063.69 1738.43,976.82 1740.74,938.073 1743.05,925.593 1745.36,947.925 1747.66,907.266 1749.97,1105.49 1752.28,983.511 1754.59,953.295 1756.9,860.751 1759.2,982.872 1761.51,858.654 1763.82,1041.64 1766.13,862.687 1768.43,1052.7 1770.74,993.832 1773.05,886.289 1775.36,961.629 1777.67,1061.53 1779.97,1028.91 1782.28,872.253 1784.59,1128.08 1786.9,941.326 1789.21,1119.35 1791.51,1005.61 1793.82,1033.09 1796.13,974.223 1798.44,914.641 1800.75,1051.92 1803.05,989.995 1805.36,1015.81 1807.67,1021.77 1809.98,1040.67 1812.28,979.217 1814.59,813.595 1816.9,1055.65 1819.21,880.548 1821.52,996.111 1823.82,1093.13 1826.13,1048.2 1828.44,1065.1 1830.75,1092.89 1833.06,940.48 1835.36,1007.85 1837.67,1023.44 1839.98,977.01 1842.29,1077.49 1844.6,1135.72 1846.9,1088.22 1849.21,959.623 1851.52,1033.83 1853.83,948.529 1856.14,1172.35 1858.44,1021.14 1860.75,787.139 1863.06,1018.41 1865.37,1088.81 1867.67,988.66 1869.98,929.989 1872.29,1009.45 1874.6,1035.66 1876.91,1019.58 1879.21,1105.02 1881.52,1046.35 1883.83,1039.63 1886.14,1057.54 1888.45,949.807 1890.75,1201.87 1893.06,821.08 1895.37,1024.82 1897.68,956.22 1899.99,1112.49 1902.29,1046.67 1904.6,1028.56 1906.91,1327.59 1909.22,805.645 1911.53,1086.14 1913.83,958.472 1916.14,1045.47 1918.45,1013.03 1920.76,1076.6 1923.06,1082.74 1925.37,850.251 1927.68,825.724 1929.99,860.992 1932.3,857.688 1934.6,959.309 1936.91,1057.81 1939.22,1093.75 1941.53,787.75 1943.84,1033.25 1946.14,941.601 1948.45,1008.09 1950.76,959.404 1953.07,1128.7 1955.38,860.56 1957.68,898.31 1959.99,945.844 1962.3,1001.48 1964.61,1042.42 1966.91,1122.32 1969.22,936.44 1971.53,932.1 1973.84,1096.93 1976.15,1169.81 1978.45,954.284 1980.76,1122.26 1983.07,990.381 1985.38,1086.75 1987.69,932.722 1989.99,753.337 1992.3,927.418 1994.61,1023.74 1996.92,1112.04 1999.23,1079.17 2001.53,821.076 2003.84,1076.53 2006.15,1214.5 2008.46,1140.17 2010.77,1083.87 2013.07,901.562 2015.38,1027.25 2017.69,1150.17 2020,852.294 2022.3,1072.45 2024.61,979.394 2026.92,1179.58 2029.23,1020.54 2031.54,1029.91 2033.84,969.616 2036.15,884.924 2038.46,829.782 2040.77,1006.06 2043.08,1110.44 2045.38,983.11 2047.69,1065.15 2050,969.062 2052.31,996.909 2054.62,1082.15 2056.92,1017.68 2059.23,980.2 2061.54,1149.96 2063.85,1034.42 2066.16,1069.24 2068.46,923.251 2070.77,990.046 2073.08,1053.86 2075.39,1037.46 2077.69,1004.44 2080,992.263 2082.31,920.16 2084.62,1030.31 2086.93,955.451 2089.23,988.199 2091.54,990.511 2093.85,920.405 2096.16,1104.8 2098.47,1097.44 2100.77,1082.76 2103.08,970.611 2105.39,1068.27 2107.7,1036.84 2110.01,988.238 2112.31,936.167 2114.62,876.139 2116.93,994.622 2119.24,1000.23 2121.55,1048.09 2123.85,963.083 2126.16,1024.63 2128.47,843.124 2130.78,957.884 2133.08,917.097 2135.39,1027.87 2137.7,866.068 2140.01,964.032 2142.32,835.012 2144.62,903.987 2146.93,888.159 2149.24,1056.65 2151.55,909.893 2153.86,932.464 2156.16,1016.1 2158.47,1116.18 2160.78,1107.79 2163.09,1026.55 2165.4,1052.83 2167.7,946.198 2170.01,835.207 2172.32,1126.4 2174.63,1039.8 2176.93,1072.38 2179.24,1257.03 2181.55,1071.37 2183.86,1022.25 2186.17,908.669 2188.47,1158.17 2190.78,898.484 2193.09,1053.23 2195.4,939.013 2197.71,968.206 2200.01,1034.8 2202.32,937.417 2204.63,998.524 2206.94,1033.34 2209.25,1051.7 2211.55,854.596 2213.86,1011.29 2216.17,964.477 2218.48,1037.53 2220.79,1046.81 2223.09,1222.28 2225.4,874.044 2227.71,959.663 2230.02,1004.14 2232.32,931.38 2234.63,906.703 2236.94,1208.75 2239.25,1005.54 2241.56,984.598 2243.86,984.347 2246.17,851.323 2248.48,1024.3 2250.79,1092.82 2253.1,1249.87 2255.4,1079.79 2257.71,954.289 2260.02,962.775 2262.33,974.25 2264.64,1042.89 2266.94,954.656 2269.25,991.125 2271.56,942.124 2273.87,1061 2276.18,1045.25 2278.48,1036.45 2280.79,990.995 2283.1,944.962 2285.41,999.474 2287.71,996.151 2290.02,1083.46 2292.33,918.464 2294.64,793.16 2296.95,1044 2299.25,1151.52 2301.56,923.617 2303.87,1032.03 2306.18,902.898 2308.49,1007.72 2310.79,1089.77 2313.1,1140.18 2315.41,1102.82 2317.72,1058.86 2320.03,1032.65 2322.33,1107.7 2324.64,851.619 2326.95,1025.45 2329.26,875.181 2331.56,1042.87 2333.87,906.392 2336.18,971.052 2338.49,1011.44 2340.8,1047.88 2343.1,764.209 2345.41,1069.95 2347.72,1060.37 2350.03,1038.57 2352.34,974.327 2354.64,926.254 2356.95,896.131 2359.26,878.387 2361.57,1040.24 2363.88,888.585 2366.18,851.714 2368.49,982.597 2370.8,918.251 2373.11,1008.24 2375.42,953.599 2377.72,959.601 2380.03,964.579 2382.34,833.508 2384.65,952.447 2386.95,922.71 2389.26,1037.77 2391.57,949.294 2393.88,764.784 2396.19,850.901 2398.49,994.616 2400.8,1024.35 2403.11,967.824 2405.42,1015.87 2407.73,1127.9 2410.03,973.52 2412.34,928.483 2414.65,985.187 2416.96,1048.58 2419.27,955.209 2421.57,1039.18 2423.88,988.055 2426.19,966.042 2428.5,946.696 2430.81,1050.5 2433.11,933.531 2435.42,845.918 2437.73,934.792 2440.04,1119.42 2442.34,938.252 2444.65,869.049 2446.96,822.039 2449.27,1096.42 2451.58,923.506 2453.88,1065.86 2456.19,1034.59 2458.5,680.907 2460.81,974.722 2463.12,1114.08 2465.42,1000.63 2467.73,1085.52 2470.04,978.826 2472.35,838.428 2474.66,996.402 2476.96,1002.31 2479.27,1003.54 2481.58,1138.91 2483.89,981.312 2486.2,1024.94 2488.5,907.598 2490.81,902.705 2493.12,892.991 2495.43,809.764 2497.73,1191.74 2500.04,972.503 2502.35,1087.85 2504.66,1072.72 2506.97,998.686 2509.27,826.922 2511.58,1017.65 2513.89,1041.1 2516.2,962.729 2518.51,951.025 2520.81,1023.18 2523.12,936.854 2525.43,983.692 2527.74,986.635 2530.05,1128.22 2532.35,1037.2 2534.66,1016.32 2536.97,946.313 2539.28,1188.96 2541.58,1056.26 2543.89,1005.39 2546.2,1020.3 2548.51,1088.54 2550.82,1015.92 2553.12,1002.7 2555.43,1083.7 2557.74,1086.87 2560.05,1021.01 2562.36,935.977 2564.66,936.776 2566.97,957.213 2569.28,1045.51 2571.59,1028.65 "></polyline>
<polyline clip-path="url(#clip952)" style="stroke:#3da44d; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="265.984,896.329 268.292,520.405 270.6,595.432 272.908,494.181 275.216,475.823 277.524,468.01 279.832,518.318 282.139,490.892 284.447,619.803 286.755,447.146 289.063,476.476 291.371,456.976 293.679,366.051 295.987,515.521 298.295,483.118 300.603,421.882 302.911,555.404 305.219,547.488 307.527,565.247 309.834,560.35 312.142,386.288 314.45,630.577 316.758,615.1 319.066,473.343 321.374,611.147 323.682,416.63 325.99,578.767 328.298,582.442 330.606,487.775 332.914,533.641 335.221,571.069 337.529,665.569 339.837,528.34 342.145,612.57 344.453,492.218 346.761,671.644 349.069,539.031 351.377,534.226 353.685,645.948 355.993,544.221 358.301,379.3 360.608,552.897 362.916,571.506 365.224,578.682 367.532,610.374 369.84,475.367 372.148,428.222 374.456,611.888 376.764,633.659 379.072,447.596 381.38,390.799 383.688,397.439 385.996,627.155 388.303,596.619 390.611,563.457 392.919,530.15 395.227,533.355 397.535,699.244 399.843,555.469 402.151,464.038 404.459,457.235 406.767,337.414 409.075,459.079 411.383,455.575 413.69,711.612 415.998,711.055 418.306,400.553 420.614,424.967 422.922,638.5 425.23,457.355 427.538,548.684 429.846,428.371 432.154,576.558 434.462,378.407 436.77,627.48 439.077,531.029 441.385,594.583 443.693,405.251 446.001,531.74 448.309,484.932 450.617,550.845 452.925,330.739 455.233,485.435 457.541,657.737 459.849,658.842 462.157,496.111 464.465,420.165 466.772,515.92 469.08,568.782 471.388,459.705 473.696,457.418 476.004,340.96 478.312,343.647 480.62,530.816 482.928,452.979 485.236,515.852 487.544,540.44 489.852,314.548 492.159,544.393 494.467,562.377 496.775,565.87 499.083,388.026 501.391,484.245 503.699,468.633 506.007,516.898 508.315,547.674 510.623,520.821 512.931,543.887 515.239,481.951 517.546,616.724 519.854,642.401 522.162,415.868 524.47,471.965 526.778,676.708 529.086,543.961 531.394,646.796 533.702,430.562 536.01,332.068 538.318,440.615 540.626,564.052 542.933,491.582 545.241,707.81 547.549,585.671 549.857,503.245 552.165,602.773 554.473,517.347 556.781,507.101 559.089,323.775 561.397,557.338 563.705,491.67 566.013,375.082 568.321,496.879 570.628,768.007 572.936,334.661 575.244,552.128 577.552,738.15 579.86,631.994 582.168,522.995 584.476,522.184 586.784,526.35 589.092,213.074 591.4,382.944 593.708,576.297 596.015,473.513 598.323,706.947 600.631,395.143 602.939,458.097 605.247,569.163 607.555,498.331 609.863,559.317 612.171,443.487 614.479,555.408 616.787,556.156 619.095,474.78 621.402,485.233 623.71,395.912 626.018,714.471 628.326,515.451 630.634,496.366 632.942,459.802 635.25,539.948 637.558,464.544 639.866,408.285 642.174,394.947 644.482,594.534 646.79,491.7 649.097,503.753 651.405,217.164 653.713,583.918 656.021,435.872 658.329,529.759 660.637,551.599 662.945,377.191 665.253,549.433 667.561,237.616 669.869,465.134 672.177,475.656 674.484,439.601 676.792,542.853 679.1,559.952 681.408,447.609 683.716,474.167 686.024,615.06 688.332,562.253 690.64,564.167 692.948,544.581 695.256,505.21 697.564,598.698 699.871,539.673 702.179,634.057 704.487,374.556 706.795,348.321 709.103,544.503 711.411,411.161 713.719,504.733 716.027,694.973 718.335,485.903 720.643,586.057 722.951,578.6 725.259,683.486 727.566,527.457 729.874,414.09 732.182,388.564 734.49,520.721 736.798,552.693 739.106,486.396 741.414,374.439 743.722,476.437 746.03,696.787 748.338,631.305 750.646,477.054 752.953,706.095 755.261,565.45 757.569,380.578 759.877,667.613 762.185,318.775 764.493,341.197 766.801,392.522 769.109,591.916 771.417,342.381 773.725,483.213 776.033,523.518 778.34,562.307 780.648,526.342 782.956,642.533 785.264,527.202 787.572,436.036 789.88,384.291 792.188,477.225 794.496,547.785 796.804,606.636 799.112,401.454 801.42,406.662 803.728,540.726 806.035,492.992 808.343,489.538 810.651,593.424 812.959,449.947 815.267,445.537 817.575,227.511 819.883,610.613 822.191,355.367 824.499,640.032 826.807,487.261 829.115,525.327 831.422,423.85 833.73,370.912 836.038,546.712 838.346,483.086 840.654,567.177 842.962,355.687 845.27,432.394 847.578,658.296 849.886,529.76 852.194,322.795 854.502,522.09 856.809,562.876 859.117,508.392 861.425,380.73 863.733,567.835 866.041,451.526 868.349,578.182 870.657,594.848 872.965,528.667 875.273,436.418 877.581,478.761 879.889,411.589 882.197,473.706 884.504,530.342 886.812,528.078 889.12,574.523 891.428,643.108 893.736,486.757 896.044,435.864 898.352,605.92 900.66,517.495 902.968,692.417 905.276,744.608 907.584,384.965 909.891,563.679 912.199,583.113 914.507,582.693 916.815,504.808 919.123,544.578 921.431,692.574 923.739,498.511 926.047,355.547 928.355,382.539 930.663,706.875 932.971,549.121 935.278,623.241 937.586,649.824 939.894,443.131 942.202,403.856 944.51,476.578 946.818,634.2 949.126,545.881 951.434,573.876 953.742,425.395 956.05,548.375 958.358,320.192 960.665,481.749 962.973,382.726 965.281,582.117 967.589,524.866 969.897,555.547 972.205,507.622 974.513,576.32 976.821,394.308 979.129,572.722 981.437,749.025 983.745,782.21 986.053,593.14 988.36,409.775 990.668,522.658 992.976,498.22 995.284,598.487 997.592,623.432 999.9,447.174 1002.21,467.563 1004.52,410.276 1006.82,465.739 1009.13,442.733 1011.44,626.295 1013.75,526.977 1016.06,819.106 1018.36,591.288 1020.67,404.852 1022.98,645.372 1025.29,422.586 1027.59,538.167 1029.9,708.881 1032.21,708.027 1034.52,639.776 1036.83,495.718 1039.13,478.361 1041.44,496.314 1043.75,536.167 1046.06,603.078 1048.37,473.663 1050.67,680.527 1052.98,512.989 1055.29,649.357 1057.6,499.05 1059.91,624.28 1062.21,614.12 1064.52,458.751 1066.83,451.442 1069.14,581.42 1071.45,464.675 1073.75,516.806 1076.06,484.804 1078.37,429.282 1080.68,554.067 1082.98,505.388 1085.29,463.885 1087.6,784.329 1089.91,588.409 1092.22,429.455 1094.52,579.774 1096.83,434.496 1099.14,578.069 1101.45,335.585 1103.76,414.238 1106.06,626.264 1108.37,515.559 1110.68,485.608 1112.99,580.12 1115.3,714.132 1117.6,776.416 1119.91,564.609 1122.22,700.079 1124.53,332.958 1126.84,712.254 1129.14,465.935 1131.45,514.293 1133.76,706.648 1136.07,422.063 1138.37,466.412 1140.68,564.013 1142.99,476.21 1145.3,524.389 1147.61,614.168 1149.91,642.832 1152.22,458.417 1154.53,554.361 1156.84,474.844 1159.15,457.203 1161.45,568.244 1163.76,458.659 1166.07,712.52 1168.38,558.941 1170.69,396.625 1172.99,620.54 1175.3,487.514 1177.61,631.735 1179.92,569.88 1182.23,462.111 1184.53,683.428 1186.84,505.145 1189.15,461.896 1191.46,400.496 1193.76,537.118 1196.07,578.527 1198.38,546.427 1200.69,550.241 1203,455.382 1205.3,538.635 1207.61,565.092 1209.92,545.524 1212.23,528.854 1214.54,540.991 1216.84,383.523 1219.15,326.244 1221.46,465.807 1223.77,434.873 1226.08,414.213 1228.38,584.956 1230.69,578.531 1233,358.294 1235.31,559.972 1237.61,429.805 1239.92,592.734 1242.23,501.68 1244.54,515.599 1246.85,479.34 1249.15,363.099 1251.46,359.358 1253.77,448.993 1256.08,498.156 1258.39,578.913 1260.69,565.686 1263,591.574 1265.31,532.774 1267.62,299.512 1269.93,538.293 1272.23,582.201 1274.54,524.335 1276.85,608.372 1279.16,554.619 1281.47,576.184 1283.77,696.593 1286.08,497.294 1288.39,515.094 1290.7,633.101 1293,395.504 1295.31,450.909 1297.62,551.965 1299.93,502.127 1302.24,521.137 1304.54,572.788 1306.85,488.989 1309.16,450.869 1311.47,656.516 1313.78,595.477 1316.08,494.814 1318.39,457.556 1320.7,705.035 1323.01,590.892 1325.32,598.041 1327.62,583.053 1329.93,444.601 1332.24,409.24 1334.55,588.204 1336.86,378.78 1339.16,506.388 1341.47,420.789 1343.78,442.032 1346.09,569.272 1348.39,562.406 1350.7,731.447 1353.01,788.515 1355.32,501.5 1357.63,570.697 1359.93,545.976 1362.24,96.8724 1364.55,395.56 1366.86,586.947 1369.17,620.138 1371.47,586.091 1373.78,462.786 1376.09,696.914 1378.4,545.412 1380.71,498.663 1383.01,578.195 1385.32,461.627 1387.63,545.702 1389.94,616.326 1392.24,724.208 1394.55,629.729 1396.86,680.281 1399.17,381.8 1401.48,313.758 1403.78,598.518 1406.09,346.068 1408.4,432.945 1410.71,503.939 1413.02,467.199 1415.32,458.476 1417.63,700.702 1419.94,509.721 1422.25,518.362 1424.56,569.599 1426.86,509.379 1429.17,442.22 1431.48,429.745 1433.79,524.073 1436.1,616.372 1438.4,619.252 1440.71,684.755 1443.02,641.416 1445.33,402.503 1447.63,523.364 1449.94,395.855 1452.25,504.609 1454.56,710.883 1456.87,623.91 1459.17,294.17 1461.48,568.928 1463.79,519.757 1466.1,473.791 1468.41,578.037 1470.71,601.171 1473.02,413.473 1475.33,641.909 1477.64,467.278 1479.95,478.62 1482.25,527.346 1484.56,384.291 1486.87,485.286 1489.18,586.393 1491.49,494.733 1493.79,522.592 1496.1,721.999 1498.41,472.441 1500.72,544.588 1503.02,521.98 1505.33,670.106 1507.64,560.32 1509.95,383.846 1512.26,514.002 1514.56,550.644 1516.87,434.186 1519.18,416.991 1521.49,652.022 1523.8,793.417 1526.1,557.242 1528.41,435.445 1530.72,490.056 1533.03,458.881 1535.34,535.45 1537.64,427.986 1539.95,440.895 1542.26,534.841 1544.57,494.881 1546.88,582.571 1549.18,308.22 1551.49,597.763 1553.8,588.346 1556.11,386.955 1558.41,349.2 1560.72,514.241 1563.03,560.257 1565.34,437.41 1567.65,402.384 1569.95,500.548 1572.26,616.425 1574.57,319.522 1576.88,494.688 1579.19,479.459 1581.49,528.224 1583.8,507.348 1586.11,759.386 1588.42,672.063 1590.73,564.428 1593.03,318.417 1595.34,488.604 1597.65,454.902 1599.96,560.733 1602.26,423.661 1604.57,643.851 1606.88,357.607 1609.19,458.133 1611.5,455.274 1613.8,429.882 1616.11,556.078 1618.42,573.254 1620.73,459.42 1623.04,446.351 1625.34,493.222 1627.65,545.23 1629.96,529.793 1632.27,463.906 1634.58,482.13 1636.88,437.303 1639.19,567.633 1641.5,641.854 1643.81,580.346 1646.12,429.715 1648.42,511.516 1650.73,533.659 1653.04,643.374 1655.35,498.545 1657.65,601.251 1659.96,566.271 1662.27,663.222 1664.58,432.03 1666.89,570.638 1669.19,593.408 1671.5,518.607 1673.81,549.586 1676.12,558.468 1678.43,542.554 1680.73,608.997 1683.04,556.039 1685.35,460.988 1687.66,651.246 1689.97,469.147 1692.27,422.874 1694.58,325.646 1696.89,420.581 1699.2,527.099 1701.51,490.054 1703.81,660.171 1706.12,336.56 1708.43,637.325 1710.74,408.239 1713.04,516.472 1715.35,386.237 1717.66,492.329 1719.97,745.448 1722.28,558.175 1724.58,717.915 1726.89,657.059 1729.2,545.523 1731.51,468.846 1733.82,553.291 1736.12,465.192 1738.43,478.843 1740.74,696.955 1743.05,573.523 1745.36,572.706 1747.66,646.965 1749.97,473.535 1752.28,391.773 1754.59,664.322 1756.9,308.542 1759.2,486 1761.51,523.054 1763.82,377.841 1766.13,510.971 1768.43,536.659 1770.74,561.307 1773.05,593.679 1775.36,532.062 1777.67,573.875 1779.97,478.176 1782.28,481.244 1784.59,497.616 1786.9,529.307 1789.21,493.243 1791.51,549.867 1793.82,336.02 1796.13,509.631 1798.44,722.219 1800.75,621.967 1803.05,434.966 1805.36,465.515 1807.67,597.185 1809.98,425.804 1812.28,518.048 1814.59,708.189 1816.9,425.861 1819.21,520.416 1821.52,576.82 1823.82,742.395 1826.13,477.349 1828.44,446.737 1830.75,503.065 1833.06,488.351 1835.36,478.812 1837.67,392.663 1839.98,662.809 1842.29,647.809 1844.6,606.317 1846.9,349.884 1849.21,702.016 1851.52,667.843 1853.83,442.576 1856.14,532.943 1858.44,439.105 1860.75,502.972 1863.06,356.207 1865.37,576.262 1867.67,540.227 1869.98,531.489 1872.29,548.491 1874.6,593.041 1876.91,349.349 1879.21,541.07 1881.52,508.345 1883.83,565.014 1886.14,646.174 1888.45,522.464 1890.75,444.41 1893.06,566.707 1895.37,484.952 1897.68,603.592 1899.99,519.965 1902.29,641.228 1904.6,573.473 1906.91,558.02 1909.22,611.934 1911.53,435.226 1913.83,557.841 1916.14,464.96 1918.45,586.558 1920.76,580.821 1923.06,433.753 1925.37,530.023 1927.68,642.056 1929.99,557.275 1932.3,489.598 1934.6,481.111 1936.91,445.205 1939.22,522.638 1941.53,641.003 1943.84,641.648 1946.14,380.786 1948.45,519.762 1950.76,498.525 1953.07,632.275 1955.38,654.123 1957.68,463.247 1959.99,557.412 1962.3,528.378 1964.61,448.956 1966.91,421.935 1969.22,529.63 1971.53,436.623 1973.84,462.683 1976.15,475.002 1978.45,514.831 1980.76,542.302 1983.07,525.176 1985.38,505.013 1987.69,614.644 1989.99,574.811 1992.3,511.891 1994.61,529.439 1996.92,569.869 1999.23,487.291 2001.53,378.313 2003.84,566.208 2006.15,630.449 2008.46,532.031 2010.77,675.313 2013.07,433.871 2015.38,547.547 2017.69,694.055 2020,394.55 2022.3,385.309 2024.61,391.133 2026.92,445.437 2029.23,565.843 2031.54,604.318 2033.84,566.605 2036.15,532.834 2038.46,576.846 2040.77,541.529 2043.08,691.922 2045.38,395.952 2047.69,530.658 2050,536.697 2052.31,463.381 2054.62,552.777 2056.92,593.573 2059.23,413.716 2061.54,680.413 2063.85,538.654 2066.16,631.306 2068.46,392.207 2070.77,449.612 2073.08,430.884 2075.39,428.262 2077.69,491.858 2080,548.411 2082.31,532.118 2084.62,489.79 2086.93,573.137 2089.23,612.794 2091.54,746.2 2093.85,521.172 2096.16,635.385 2098.47,323.579 2100.77,646.817 2103.08,737.401 2105.39,478.526 2107.7,517.076 2110.01,510.047 2112.31,572.641 2114.62,525.574 2116.93,602.247 2119.24,600.531 2121.55,421.912 2123.85,430.396 2126.16,430.452 2128.47,529.51 2130.78,439.123 2133.08,506.4 2135.39,557.331 2137.7,555.826 2140.01,484.101 2142.32,538.066 2144.62,639.88 2146.93,359.44 2149.24,608.791 2151.55,415.579 2153.86,482.182 2156.16,574.826 2158.47,562.8 2160.78,503.741 2163.09,471.447 2165.4,458.608 2167.7,595.044 2170.01,426.355 2172.32,474.393 2174.63,510.75 2176.93,459.735 2179.24,457.483 2181.55,370.035 2183.86,556.252 2186.17,388.164 2188.47,373.283 2190.78,457.834 2193.09,572.407 2195.4,594.403 2197.71,465.335 2200.01,543.587 2202.32,451.769 2204.63,537.145 2206.94,484.096 2209.25,576.205 2211.55,504.089 2213.86,528.679 2216.17,437.725 2218.48,256.204 2220.79,394.246 2223.09,482.153 2225.4,527.043 2227.71,732.467 2230.02,561.102 2232.32,540.876 2234.63,449.664 2236.94,360.576 2239.25,501.846 2241.56,447.599 2243.86,434.504 2246.17,535.795 2248.48,522.317 2250.79,652.435 2253.1,541.13 2255.4,368.978 2257.71,407.139 2260.02,384.039 2262.33,432.285 2264.64,833.663 2266.94,531.29 2269.25,454.594 2271.56,449.897 2273.87,410.217 2276.18,559.797 2278.48,568.308 2280.79,508.855 2283.1,566.092 2285.41,424.859 2287.71,466.821 2290.02,598.064 2292.33,626.038 2294.64,301.815 2296.95,374.474 2299.25,515.806 2301.56,540.592 2303.87,419.926 2306.18,517.94 2308.49,526.796 2310.79,543.452 2313.1,631.595 2315.41,431.393 2317.72,675.294 2320.03,639.148 2322.33,444.758 2324.64,594.135 2326.95,615.218 2329.26,635.893 2331.56,370.241 2333.87,521.278 2336.18,529.858 2338.49,444.565 2340.8,559.582 2343.1,589.519 2345.41,461.958 2347.72,521.452 2350.03,343.212 2352.34,450.426 2354.64,451.261 2356.95,481.301 2359.26,482.788 2361.57,555.597 2363.88,519.663 2366.18,482.218 2368.49,537.242 2370.8,505.754 2373.11,669.18 2375.42,512.074 2377.72,626.823 2380.03,360.528 2382.34,540.638 2384.65,348.259 2386.95,465.186 2389.26,533.102 2391.57,559.154 2393.88,510.311 2396.19,352.159 2398.49,527.68 2400.8,423.041 2403.11,536.894 2405.42,489.17 2407.73,355.584 2410.03,628.731 2412.34,525.866 2414.65,674.766 2416.96,355.501 2419.27,624.494 2421.57,512.731 2423.88,493.115 2426.19,480.295 2428.5,362.294 2430.81,448.732 2433.11,555.338 2435.42,614.175 2437.73,617.037 2440.04,550.289 2442.34,424.213 2444.65,595.248 2446.96,503.576 2449.27,539.406 2451.58,522.265 2453.88,547.949 2456.19,391.668 2458.5,544.526 2460.81,513.927 2463.12,502.864 2465.42,512.054 2467.73,216.961 2470.04,543.74 2472.35,582.969 2474.66,482.001 2476.96,569.101 2479.27,508.293 2481.58,532.591 2483.89,510.639 2486.2,551.454 2488.5,477.35 2490.81,618.279 2493.12,637.979 2495.43,435.933 2497.73,543.2 2500.04,548.48 2502.35,359.468 2504.66,598.044 2506.97,443.354 2509.27,375.716 2511.58,409.163 2513.89,444.28 2516.2,510.672 2518.51,459.608 2520.81,453.616 2523.12,589.575 2525.43,493.881 2527.74,530.756 2530.05,466.425 2532.35,587.823 2534.66,467.158 2536.97,439.122 2539.28,543.204 2541.58,596.413 2543.89,506.445 2546.2,427.579 2548.51,441.086 2550.82,681.201 2553.12,321.235 2555.43,396.314 2557.74,460.967 2560.05,440.643 2562.36,621.359 2564.66,575.06 2566.97,357.74 2569.28,482 2571.59,414.972 "></polyline>
</svg>
</div>
</div>
<p>Look at that! Things are working; amazin’.</p>
<p>We can also exploit <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>’s parallel sampling capabilities:</p>
<div id="34" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run separate 4 chains for 10 000 iterations using threads to parallelize.</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>num_chains <span class="op">=</span> <span class="fl">4</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    model_with_grad,</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">MCMCThreads</span>(),</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>,</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    num_chains;</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Note we need to provide an initial state for every chain.</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>    initial_state<span class="op">=</span><span class="fu">fill</span>(state, num_chains),</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>samples_array <span class="op">=</span> <span class="fu">stack</span>(<span class="fu">map</span>(<span class="bu">Base</span>.<span class="fu">Fix1</span>(stack, sample <span class="op">-&gt;</span> sample.x), samples))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000×4 Array{Float64, 3}:
[:, :, 1] =
 -1.67278   -2.03673  -3.3053   -3.90117  …  -3.23905    -5.52309  -6.66796
 -0.939101  -1.62185  -2.22773  -0.47597      0.0680116   0.57226  -0.396843
  3.43218    4.52495   6.17463   6.39701      3.96202     3.73542   3.35342

[:, :, 2] =
 -2.0048    -2.56781  -5.34916  -4.55652   …  -5.01479  -3.73181  -4.71654
  0.907861  -1.1578   -0.35876  -0.506507      0.53297   1.04987  -0.779679
  3.58882    3.85895   3.44088   5.19486       3.69104   4.81345   4.89989

[:, :, 3] =
 -2.54278   -4.06991   -5.21343   -4.80522  …  -5.1879   -6.87636  -5.71463
  0.135564  -0.401057  -0.268598   1.53247     -1.77875  -1.54095   0.0886393
  2.3377     4.37093    4.46782    6.04937      5.82237   6.3687    5.61233

[:, :, 4] =
 -3.35023   -4.16104   -5.05873   …  -5.44055   -5.44055   -5.0562
  0.699725   0.872818   0.659798      0.270597   0.270597   0.64184
  3.06385    4.22666    5.81963       3.37921    3.37921    5.20194</code></pre>
</div>
</div>
<p>But the fact that we have to provide the <code>AbstractMCMC.sample</code> call, etc. with an <code>initial_state</code> to get started is a bit annoying. We can avoid this by also defining a <code>AbstractMCMC.step</code> <em>without</em> the <code>state</code> argument:</p>
<div id="36" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">::</span><span class="dt">MALA</span>;</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># </span><span class="al">NOTE</span><span class="co">: No state provided!</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just create the initial state by sampling using  a Gaussian.</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="fu">randn</span>(rng, LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(x), <span class="fu">MALAState</span>(x)</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Equipped with this, we no longer need to provide the <code>initial_state</code> everywhere:</p>
<div id="38" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -4.9923      1.00739
 -0.00710863  0.991773
  4.98588     0.993212</code></pre>
</div>
</div>
</section>
<section id="using-our-sampler-with-turing.jl" class="level2">
<h2 class="anchored" data-anchor-id="using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</h2>
<p>As we promised, all of this hassle of implementing our <code>MALA</code> sampler in a way that uses <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> and <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> gets us something more than <em>just</em> an “automatic” implementation of <code>AbstractMCMC.sample</code>.</p>
<p>It also enables use with Turing.jl through the <code>externalsampler</code>, but we need to do one final thing first: we need to tell Turing.jl how to extract a vector of parameters from the “sample” returned in our implementation of <code>AbstractMCMC.step</code>. In our case, the “sample” is a <code>MALASample</code>, so we just need the following line:</p>
<div id="40" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load Turing.jl.</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Turing</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Overload the `getparams` method for our "sample" type, which is just a vector.</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>Turing.Inference.<span class="fu">getparams</span>(<span class="op">::</span><span class="dt">Turing.Model</span>, sample<span class="op">::</span><span class="dt">MALASample</span>) <span class="op">=</span> sample.x</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And with that, we’re good to go!</p>
<div id="42" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Our previous model defined as a Turing.jl model.</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">mvnormal_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">MvNormal</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.], I)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate our model.</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">mvnormal_model</span>()</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Call `sample` but now we're passing in a Turing.jl `model` and wrapping</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co"># our `MALA` sampler in the `externalsampler` to tell Turing.jl that the sampler</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co"># expects something that implements LogDensityProblems.jl.</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×4×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 2.73 seconds
Compute duration  = 2.73 seconds
parameters        = x[1], x[2], x[3]
internals         = lp

Summary Statistics
  parameters      mean       std      mcse    ess_bulk    ess_tail      rhat   ⋯
      Symbol   Float64   Float64   Float64     Float64     Float64   Float64   ⋯

        x[1]   -5.0056    1.0225    0.0176   3365.3966   5341.3747    1.0001   ⋯
        x[2]    0.0045    0.9996    0.0170   3451.3628   5277.3193    1.0002   ⋯
        x[3]    4.9932    1.0122    0.0173   3403.4821   5058.1929    1.0004   ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

        x[1]   -7.0591   -5.7047   -4.9984   -4.3159   -3.0433
        x[2]   -1.9545   -0.6580   -0.0028    0.6758    1.9593
        x[3]    3.0365    4.3154    4.9804    5.6585    7.0167</code></pre>
</div>
</div>
<p>Pretty neat, eh?</p>
<section id="models-with-constrained-parameters" class="level3">
<h3 class="anchored" data-anchor-id="models-with-constrained-parameters">Models with constrained parameters</h3>
<p>One thing we’ve sort of glossed over in all of the above is that MALA, at least how we’ve implemented it, requires <span class="math inline">\(x\)</span> to live in <span class="math inline">\(\mathbb{R}^d\)</span> for some <span class="math inline">\(d &gt; 0\)</span>. If some of the parameters were in fact constrained, e.g.&nbsp;we were working with a <code>Beta</code> distribution which has support on the interval <span class="math inline">\((0, 1)\)</span>, <em>not</em> on <span class="math inline">\(\mathbb{R}^d\)</span>, we could easily end up outside of the valid range <span class="math inline">\((0, 1)\)</span>.</p>
<div id="44" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">beta_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">beta_model</span>()</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 1.62 seconds
Compute duration  = 1.62 seconds
parameters        = x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse    ess_bulk    ess_tail      rhat   ⋯
      Symbol   Float64   Float64   Float64     Float64     Float64   Float64   ⋯

           x    0.4988    0.1884    0.0030   4013.1313   5835.8596    1.0000   ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

           x    0.1428    0.3624    0.4954    0.6405    0.8534</code></pre>
</div>
</div>
<p>Yep, that still works, but only because Turing.jl actually <em>transforms</em> the <code>turing_model</code> from constrained to unconstrained, so that the <code>sampler</code> provided to <code>externalsampler</code> is actually always working in unconstrained space! This is not always desirable, so we can turn this off:</p>
<div id="46" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 0.24 seconds
Compute duration  = 0.24 seconds
parameters        = x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse   ess_bulk   ess_tail      rhat   e ⋯
      Symbol   Float64   Float64   Float64    Float64    Float64   Float64     ⋯

           x    0.8498    0.0000    0.0000        NaN        NaN       NaN     ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

           x    0.8498    0.8498    0.8498    0.8498    0.8498</code></pre>
</div>
</div>
<p>The fun thing is that this still sort of works because</p>
<div id="48" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">logpdf</span>(<span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>), <span class="fl">10.0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-Inf</code></pre>
</div>
</div>
<p>and so the samples that fall outside of the range are always rejected. But do notice how much worse all the diagnostics are, e.g.&nbsp;<code>ess_tail</code> is very poor compared to when we use <code>unconstrained=true</code>. Moreover, in more complex cases this won’t just result in a “nice” <code>-Inf</code> log-density value, but instead will error:</p>
<div id="50" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="kw">function</span> <span class="fu">demo</span>()</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>    σ² <span class="op">~</span> <span class="fu">truncated</span>(<span class="fu">Normal</span>(), lower<span class="op">=</span><span class="fl">0</span>)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If we end up with negative values for `σ²`, the `Normal` will error.</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>    x <span class="op">~</span> <span class="fu">Normal</span>(<span class="fl">0</span>, σ²)</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>DomainError: DomainError(Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}}(-2.8168757739903305,1.0,0.0), "Normal: the condition σ &gt;= zero(σ) is not satisfied.")
DomainError with Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}}(-2.8168757739903305,1.0,0.0):
Normal: the condition σ &gt;= zero(σ) is not satisfied.
Stacktrace:
  [1] #371
    @ ~/.julia/packages/Distributions/oGEEM/src/univariate/continuous/normal.jl:37 [inlined]
  [2] check_args
    @ ~/.julia/packages/Distributions/oGEEM/src/utils.jl:89 [inlined]
  [3] #Normal#370
    @ ~/.julia/packages/Distributions/oGEEM/src/univariate/continuous/normal.jl:37 [inlined]
  [4] Normal
    @ ~/.julia/packages/Distributions/oGEEM/src/univariate/continuous/normal.jl:36 [inlined]
  [5] Normal
    @ ~/.julia/packages/Distributions/oGEEM/src/univariate/continuous/normal.jl:42 [inlined]
  [6] macro expansion
    @ ~/.julia/packages/DynamicPPL/93t4P/src/compiler.jl:579 [inlined]
  [7] demo(__model__::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, __varinfo__::DynamicPPL.ThreadSafeVarInfo{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}, Vector{Set{DynamicPPL.Selector}}}}, ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}, Vector{Base.RefValue{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}, __context__::DynamicPPL.DefaultContext)
    @ Main.Notebook ~/work/docs/docs/tutorials/docs-17-implementing-samplers/index.qmd:592
  [8] _evaluate!!
    @ ~/.julia/packages/DynamicPPL/93t4P/src/model.jl:973 [inlined]
  [9] evaluate_threadsafe!!(model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, varinfo::DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}, Vector{Set{DynamicPPL.Selector}}}}, ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}, context::DynamicPPL.DefaultContext)
    @ DynamicPPL ~/.julia/packages/DynamicPPL/93t4P/src/model.jl:962
 [10] evaluate!!
    @ ~/.julia/packages/DynamicPPL/93t4P/src/model.jl:892 [inlined]
 [11] logdensity
    @ ~/.julia/packages/DynamicPPL/93t4P/src/logdensityfunction.jl:140 [inlined]
 [12] Fix1
    @ ./operators.jl:1118 [inlined]
 [13] vector_mode_dual_eval!(f::Base.Fix1{typeof(LogDensityProblems.logdensity), LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, Nothing}}, cfg::ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}, x::Vector{Float64})
    @ ForwardDiff ~/.julia/packages/ForwardDiff/PcZ48/src/apiutils.jl:24
 [14] vector_mode_gradient!(result::DiffResults.MutableDiffResult{1, Float64, Tuple{Vector{Float64}}}, f::Base.Fix1{typeof(LogDensityProblems.logdensity), LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, Nothing}}, x::Vector{Float64}, cfg::ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}})
    @ ForwardDiff ~/.julia/packages/ForwardDiff/PcZ48/src/gradient.jl:96
 [15] gradient!
    @ ~/.julia/packages/ForwardDiff/PcZ48/src/gradient.jl:37 [inlined]
 [16] gradient!
    @ ~/.julia/packages/ForwardDiff/PcZ48/src/gradient.jl:35 [inlined]
 [17] logdensity_and_gradient
    @ ~/.julia/packages/LogDensityProblemsAD/rBlLq/ext/LogDensityProblemsADForwardDiffExt.jl:118 [inlined]
 [18] leapfrog_step(model::LogDensityProblemsADForwardDiffExt.ForwardDiffLogDensity{LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, Nothing}, ForwardDiff.Chunk{2}, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}, x::Vector{Float64}, p::Vector{Float64}, ϵ::Int64, M::UniformScaling{Bool})
    @ Main.Notebook ~/work/docs/docs/tutorials/docs-17-implementing-samplers/index.qmd:369
 [19] step(rng::TaskLocalRNG, model_wrapper::AbstractMCMC.LogDensityModel{LogDensityProblemsADForwardDiffExt.ForwardDiffLogDensity{LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, Nothing}, ForwardDiff.Chunk{2}, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}}, sampler::MALA{Int64, UniformScaling{Bool}}, state::MALAState{Vector{Float64}}; kwargs::@Kwargs{})
    @ Main.Notebook ~/work/docs/docs/tutorials/docs-17-implementing-samplers/index.qmd:334
 [20] step
    @ ~/work/docs/docs/tutorials/docs-17-implementing-samplers/index.qmd:316 [inlined]
 [21] #step#108
    @ ~/.julia/packages/Turing/r3Hmj/src/mcmc/abstractmcmc.jl:155 [inlined]
 [22] step(rng::TaskLocalRNG, model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, sampler_wrapper::DynamicPPL.Sampler{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}, state::Turing.Inference.TuringState{MALAState{Vector{Float64}}, LogDensityProblemsADForwardDiffExt.ForwardDiffLogDensity{LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, Nothing}, ForwardDiff.Chunk{2}, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}})
    @ Turing.Inference ~/.julia/packages/Turing/r3Hmj/src/mcmc/abstractmcmc.jl:144
 [23] macro expansion
    @ ~/.julia/packages/AbstractMCMC/YrmkI/src/sample.jl:176 [inlined]
 [24] macro expansion
    @ ~/.julia/packages/AbstractMCMC/YrmkI/src/logging.jl:16 [inlined]
 [25] mcmcsample(rng::TaskLocalRNG, model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, sampler::DynamicPPL.Sampler{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}, N::Int64; progress::Bool, progressname::String, callback::Nothing, discard_initial::Int64, thinning::Int64, chain_type::Type, initial_state::Nothing, kwargs::@Kwargs{})
    @ AbstractMCMC ~/.julia/packages/AbstractMCMC/YrmkI/src/sample.jl:120
 [26] sample(rng::TaskLocalRNG, model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, sampler::DynamicPPL.Sampler{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}, N::Int64; chain_type::Type, resume_from::Nothing, initial_state::Nothing, kwargs::@Kwargs{progress::Bool})
    @ DynamicPPL ~/.julia/packages/DynamicPPL/93t4P/src/sampler.jl:93
 [27] sample
    @ ~/.julia/packages/DynamicPPL/93t4P/src/sampler.jl:83 [inlined]
 [28] #sample#4
    @ ~/.julia/packages/Turing/r3Hmj/src/mcmc/Inference.jl:274 [inlined]
 [29] sample
    @ ~/.julia/packages/Turing/r3Hmj/src/mcmc/Inference.jl:265 [inlined]
 [30] #sample#3
    @ ~/.julia/packages/Turing/r3Hmj/src/mcmc/Inference.jl:262 [inlined]
 [31] top-level scope
    @ ~/work/docs/docs/tutorials/docs-17-implementing-samplers/index.qmd:594</code></pre>
</div>
</div>
<p>As expected, we run into a <code>DomainError</code> at some point, while if we set <code>unconstrained=true</code>, letting Turing.jl transform the model to a unconstrained form behind the scenes, everything works as expected:</p>
<div id="52" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 0.57 seconds
Compute duration  = 0.57 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse   ess_bulk   ess_tail      rhat   e ⋯
      Symbol   Float64   Float64   Float64    Float64    Float64   Float64     ⋯

          σ²    0.7414    0.5233    0.0298   159.2335    43.3282    1.0098     ⋯
           x   -0.0301    0.7970    0.0321   614.8680   877.4710    1.0148     ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

          σ²    0.0850    0.3314    0.6372    1.0471    2.0179
           x   -1.8724   -0.3900   -0.0051    0.3385    1.6704</code></pre>
</div>
</div>
<p>Neat!</p>
<p>Similarly, which automatic differentiation backend one should use can be specified through the <code>adtype</code> keyword argument too. For example, if we want to use <a href="https://github.com/JuliaDiff/ReverseDiff.jl">ReverseDiff.jl</a> instead of the default <a href="https://github.com/JuliaDiff/ForwardDiff.jl">ForwardDiff.jl</a>:</p>
<div id="54" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">ReverseDiff</span>: ReverseDiff</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify that we want to use `AutoReverseDiff`.</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">demo</span>(),</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>, adtype<span class="op">=</span><span class="fu">AutoReverseDiff</span>()),</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>;</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 3.12 seconds
Compute duration  = 3.12 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse   ess_bulk   ess_tail      rhat   e ⋯
      Symbol   Float64   Float64   Float64    Float64    Float64   Float64     ⋯

          σ²    8.3081    0.0000    0.0000        NaN        NaN       NaN     ⋯
           x    0.1261    0.0000    0.0000        NaN        NaN       NaN     ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

          σ²    8.3081    8.3081    8.3081    8.3081    8.3081
           x    0.1261    0.1261    0.1261    0.1261    0.1261</code></pre>
</div>
</div>
<p>Double-neat.</p>
</section>
</section>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<p>At this point it’s worth maybe reminding ourselves what we did and also <em>why</em> we did it:</p>
<ol type="1">
<li>We define our models in the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface because it makes the sampler agnostic to how the underlying model is implemented.</li>
<li>We implement our sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> interface, which just means that our sampler is a subtype of <code>AbstractMCMC.AbstractSampler</code> and we implement the MCMC transition in <code>AbstractMCMC.step</code>.</li>
<li>Points 1 and 2 makes it so our sampler can be used with a wide range of model implementations, amongst them being models implemented in both Turing.jl and Stan. This gives you, the inference implementer, a large collection of models to test your inference method on, in addition to allowing users of Turing.jl and Stan to try out your inference method with minimal effort.</li>
</ol>


</section>


<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a><div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>We’re going with the leapfrog formulation because in a future version of this tutorial we’ll add a section extending this simple “baseline” MALA sampler to more complex versions. See <a href="https://github.com/TuringLang/docs/issues/479">issue #479</a> for progress on this.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>There is no such thing as a proper interface in Julia (at least not officially), and so we use the word “interface” here to mean a few minimal methods that needs to be implemented by any type that we treat as a target model.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/turinglang\.org\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../tutorials/docs-07-for-developers-variational-inference/index.html" class="pagination-link" aria-label="Variational Inference">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Variational Inference</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Turing is created by <a href="http://mlg.eng.cam.ac.uk/hong/" target="_blank">Hong Ge</a>, and lovingly maintained by the <a href="https://github.com/TuringLang/Turing.jl/graphs/contributors" target="_blank">core team</a> of volunteers. <br> The contents of this website are © 2024 under the terms of the <a href="https://github.com/TuringLang/Turing.jl/blob/master/LICENCE" target="_blank">MIT License</a>.</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/TuringLang/docs/edit/master/tutorials/docs-17-implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/docs/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://x.com/TuringLang">
      <i class="bi bi-twitter" role="img" aria-label="Turing Twitter">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/TuringLang/Turing.jl">
      <i class="bi bi-github" role="img" aria-label="Turing GitHub">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




<script src="../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>