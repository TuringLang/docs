<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Implementing samplers – Turing.jl</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../tutorials/docs-07-for-developers-variational-inference/index.html" rel="prev">
<link href="../../assets/favicon.ico" rel="icon">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<style>
  a {
    text-decoration: none;
  }
  a:hover {
    text-decoration: underline;
  }
</style>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../theming/styles.css">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="https://turinglang.org/" class="navbar-brand navbar-brand-logo">
    <img src="../../assets/images/turing-logo.svg" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="https://turinglang.org/">
    <span class="navbar-title">Turing.jl</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../tutorials/docs-00-getting-started/"> 
<span class="menu-text">Get Started</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../tutorials/00-introduction/"> 
<span class="menu-text">Tutorials</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/library/"> 
<span class="menu-text">Libraries</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/news/"> 
<span class="menu-text">News</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/team/"> 
<span class="menu-text">Team</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-v0.34" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">v0.34</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-v0.34">    
        <li>
    <a class="dropdown-item" href="https://turinglang.org/docs/changelog.html">
 <span class="dropdown-text">Changelog</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://turinglang.org/docs/versions.html">
 <span class="dropdown-text">All Versions</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
    <a href="https://x.com/TuringLang" title="Turing Twitter" class="quarto-navigation-tool px-1" aria-label="Turing Twitter"><i class="bi bi-twitter"></i></a>
    <a href="https://github.com/TuringLang/Turing.jl" title="Turing GitHub" class="quarto-navigation-tool px-1" aria-label="Turing GitHub"><i class="bi bi-github"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Documentation</li><li class="breadcrumb-item"><a href="../../tutorials/docs-04-for-developers-abstractmcmc-turing/index.html">For Developers (Inference)</a></li><li class="breadcrumb-item"><a href="../../tutorials/docs-17-implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Documentation</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false">
 <span class="menu-text">Using Turing - Modelling Syntax and Interface</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-00-getting-started/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Getting Started</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-14-using-turing-quick-start/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Quick Start</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-12-using-turing-guide/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Guide</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-17-mode-estimation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Mode Estimation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-09-using-turing-advanced/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Advanced Usage</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-10-using-turing-autodiff/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Automatic Differentiation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-13-using-turing-performance-tips/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Performance Tips</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-11-using-turing-dynamichmc/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using DynamicHMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-15-using-turing-sampler-viz/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Sampler Visualization</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-16-using-turing-external-samplers/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">External Samplers</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false">
 <span class="menu-text">Using Turing - Tutorials</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/00-introduction/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction to Turing</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/01-gaussian-mixture-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Mixture Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/02-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/03-bayesian-neural-network/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Neural Networks</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/04-hidden-markov-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Hidden Markov Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/05-linear-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Linear Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/06-infinite-mixture-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Infinite Mixture Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/07-poisson-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Poisson Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/08-multinomial-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Multinomial Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/09-variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/10-bayesian-differential-equations/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Differential Equations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/11-probabilistic-pca/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Probabilistic PCA</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/13-seasonal-time-series/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Time Series Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/15-gaussian-processes/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction to Gaussian Processes</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/12-gplvm/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Process Latent Variable Models</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false">
 <span class="menu-text">For Developers (PPL)</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-01-contributing-guide/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">How to Contribute</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-05-for-developers-compiler/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Turing Compiler Design</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/14-minituring/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation I: Compiler</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/16-contexts/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation II: Contexts</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-06-for-developers-interface/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Interface Guide</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">For Developers (Inference)</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-04-for-developers-abstractmcmc-turing/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">How Turing implements AbstractMCMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-07-for-developers-variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-17-implementing-samplers/index.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Implementing Samplers</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of Contents</h2>
   
  <ul>
  <li><a href="#quick-overview-of-mala" id="toc-quick-overview-of-mala" class="nav-link active" data-scroll-target="#quick-overview-of-mala">Quick overview of MALA</a></li>
  <li><a href="#what-we-need-from-a-model-logdensityproblems.jl" id="toc-what-we-need-from-a-model-logdensityproblems.jl" class="nav-link" data-scroll-target="#what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: LogDensityProblems.jl</a></li>
  <li><a href="#implementing-mala-in-abstractmcmc.jl" id="toc-implementing-mala-in-abstractmcmc.jl" class="nav-link" data-scroll-target="#implementing-mala-in-abstractmcmc.jl">Implementing MALA in AbstractMCMC.jl</a></li>
  <li><a href="#using-our-sampler-with-turing.jl" id="toc-using-our-sampler-with-turing.jl" class="nav-link" data-scroll-target="#using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</a>
  <ul class="collapse">
  <li><a href="#models-with-constrained-parameters" id="toc-models-with-constrained-parameters" class="nav-link" data-scroll-target="#models-with-constrained-parameters">Models with constrained parameters</a></li>
  </ul></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/TuringLang/docs/edit/master/tutorials/docs-17-implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/docs/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Documentation</li><li class="breadcrumb-item"><a href="../../tutorials/docs-04-for-developers-abstractmcmc-turing/index.html">For Developers (Inference)</a></li><li class="breadcrumb-item"><a href="../../tutorials/docs-17-implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Implementing samplers</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>In this tutorial, we’ll go through step-by-step how to implement a “simple” sampler in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> in such a way that it can be easily applied to Turing.jl models.</p>
<p>In particular, we’re going to implement a version of <strong>Metropolis-adjusted Langevin (MALA)</strong>.</p>
<p>Note that we will implement this sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> framework, completely “ignoring” Turing.jl until the very end of the tutorial, at which point we’ll use a single line of code to make the resulting sampler available to Turing.jl. This is to really drive home the point that one can implement samplers in a way that is accessible to all of Turing.jl’s users without having to use Turing.jl yourself.</p>
<section id="quick-overview-of-mala" class="level2">
<h2 class="anchored" data-anchor-id="quick-overview-of-mala">Quick overview of MALA</h2>
<p>We can view MALA as a single step of the leapfrog intergrator with resampling of momentum <span class="math inline">\(p\)</span> at every step.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> To make that statement a bit more concrete, we first define the <em>extended</em> target <span class="math inline">\(\bar{\gamma}(x, p)\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\log \bar{\gamma}(x, p) \propto \log \gamma(x) + \log \gamma_{\mathcal{N}(0, M)}(p)
\end{equation*}\]</span></p>
<p>where <span class="math inline">\(\gamma_{\mathcal{N}(0, M)}\)</span> denotes the density for a zero-centered Gaussian with covariance matrix <span class="math inline">\(M\)</span>. We then consider targeting this joint distribution over both <span class="math inline">\(x\)</span> and <span class="math inline">\(p\)</span> as follows. First we define the map</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  L_{\epsilon}: \quad &amp; \mathbb{R}^d \times \mathbb{R}^d \to \mathbb{R}^d \times \mathbb{R}^d \\
  &amp; (x, p) \mapsto (\tilde{x}, \tilde{p}) := L_{\epsilon}(x, p)
\end{split}
\end{equation*}\]</span></p>
<p>as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p_{1 / 2} &amp;:= p + \frac{\epsilon}{2} \nabla \log \gamma(x) \\
  \tilde{x} &amp;:= x + \epsilon M^{-1} p_{1 /2 } \\
  p_1 &amp;:= p_{1 / 2} + \frac{\epsilon}{2} \nabla \log \gamma(\tilde{x}) \\
  \tilde{p} &amp;:= - p_1
\end{split}
\end{equation*}\]</span></p>
<p>This might be familiar for some readers as a single step of the Leapfrog integrator. We then define the MALA kernel as follows: given the current iterate <span class="math inline">\(x_i\)</span>, we sample the next iterate <span class="math inline">\(x_{i + 1}\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p &amp;\sim \mathcal{N}(0, M) \\
  (\tilde{x}, \tilde{p}) &amp;:= L_{\epsilon}(x_i, p) \\
  \alpha &amp;:= \min \left\{ 1, \frac{\bar{\gamma}(\tilde{x}, \tilde{p})}{\bar{\gamma}(x_i, p)} \right\} \\
  x_{i + 1} &amp;:=
  \begin{cases}
    \tilde{x} \quad &amp; \text{ with prob. } \alpha \\
    x_i       \quad &amp; \text{ with prob. } 1 - \alpha
  \end{cases}
\end{split}
\end{equation*}\]</span></p>
<p>i.e.&nbsp;we accept the proposal <span class="math inline">\(\tilde{x}\)</span> with probability <span class="math inline">\(\alpha\)</span> and reject it, thus sticking with our current iterate, with probability <span class="math inline">\(1 - \alpha\)</span>.</p>
</section>
<section id="what-we-need-from-a-model-logdensityproblems.jl" class="level2">
<h2 class="anchored" data-anchor-id="what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a></h2>
<p>There are a few things we need from the “target” / “model” / density that we want to sample from:</p>
<ol type="1">
<li>We need access to log-density <em>evaluations</em> <span class="math inline">\(\log \gamma(x)\)</span> so we can compute the acceptance ratio involving <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>We need access to log-density <em>gradients</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span> so we can compute the Leapfrog steps <span class="math inline">\(L_{\epsilon}(x, p)\)</span>.</li>
<li>We also need access to the “size” of the model so we can determine the size of <span class="math inline">\(M\)</span>.</li>
</ol>
<p>Luckily for us, there is a package called <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> which provides an interface for <em>exactly</em> this!</p>
<p>To demonstrate how one can implement the “<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface”<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> we will use a simple Gaussian model as an example:</p>
<div id="4" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblems</span>: LogDensityProblems;</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's define some type that represents the model.</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> IsotropicNormalModel{M<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"mean of the isotropic Gaussian"</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    mean<span class="op">::</span><span class="dt">M</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Specifies what input length the model expects.</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">dimension</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> <span class="fu">length</span>(model.mean)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Implementation of the log-density evaluation of the model.</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x<span class="op">::</span><span class="dt">AbstractVector{&lt;:Real}</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">-</span> <span class="fu">sum</span>(abs2, x <span class="op">.-</span> model.mean) <span class="op">/</span> <span class="fl">2</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This gives us all of the properties we want for our MALA sampler with the exception of the computation of the <em>gradient</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span>. There is the method <code>LogDensityProblems.logdensity_and_gradient</code> which should return a 2-tuple where the first entry is the evaluation of the logdensity <span class="math inline">\(\log \gamma(x)\)</span> and the second entry is the gradient <span class="math inline">\(\nabla \log \gamma(x)\)</span>.</p>
<p>There are two ways to “implement” this method: 1) we implement it by hand, which is feasible in the case of our <code>IsotropicNormalModel</code>, or b) we defer the implementation of this to a automatic differentiation backend.</p>
<p>To implement it by hand we can simply do</p>
<div id="6" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl that first-order, i.e. gradient information, is available.</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{1}</span>()</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Implement `logdensity_and_gradient`.</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    logγ_x <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="op">-</span>x <span class="op">.*</span> (x <span class="op">-</span> model.mean)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> logγ_x, ∇logγ_x</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s just try it out:</p>
<div id="8" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate the problem.</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> <span class="fu">IsotropicNormalModel</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.])</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create some example input that we can test on.</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>x_example <span class="op">=</span> <span class="fu">randn</span>(LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate!</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-25.029560988709292</code></pre>
</div>
</div>
<p>To defer it to an automatic differentiation backend, we can do</p>
<div id="10" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl we only have access to 0-th order information.</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{0}</span>()</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Use `LogDensityProblemsAD`'s `ADgradient` in combination with some AD backend to implement `logdensity_and_gradient`.</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblemsAD</span>, <span class="bu">ADTypes</span>, <span class="bu">ForwardDiff</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>model_with_grad <span class="op">=</span> <span class="fu">ADgradient</span>(<span class="fu">AutoForwardDiff</span>(), model)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model_with_grad, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-25.029560988709292</code></pre>
</div>
</div>
<p>We’ll continue with the second approach in this tutorial since this is typically what one does in practice, because there are better hobbies to spend time on than deriving gradients by hand.</p>
<p>At this point, one might wonder how we’re going to tie this back to Turing.jl in the end. Effectively, when working with inference methods that only require log-density evaluations and / or higher-order information of the log-density, Turing.jl actually converts the user-provided <code>Model</code> into an object implementing the above methods for <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>. As a result, most samplers provided by Turing.jl are actually implemented to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, enabling their use both <em>within</em> Turing.jl and <em>outside</em> of Turing.jl! Morever, there exists similar conversions for Stan through BridgeStan and Stan<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, which means that a sampler supporting the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface can easily be used on both Turing.jl <em>and</em> Stan models (in addition to user-provided models, as our <code>IsotropicNormalModel</code> above)!</p>
<p>Anyways, let’s move on to actually implementing the sampler.</p>
</section>
<section id="implementing-mala-in-abstractmcmc.jl" class="level2">
<h2 class="anchored" data-anchor-id="implementing-mala-in-abstractmcmc.jl">Implementing MALA in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a></h2>
<p>Now that we’ve established that a model implementing the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface provides us with all the information we need from <span class="math inline">\(\log \gamma(x)\)</span>, we can address the question: given an object that implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, how can we define a sampler for it?</p>
<p>We’re going to do this by making our sampler a sub-type of <code>AbstractMCMC.AbstractSampler</code> in addition to implementing a few methods from <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>. Why? Because it gets us <em>a lot</em> of functionality for free, as we will see later.</p>
<p>Moreover, <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> provides a very natural interface for MCMC algorithms.</p>
<p>First, we’ll define our <code>MALA</code> type</p>
<div id="12" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">AbstractMCMC</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALA{T,A} <span class="op">&lt;:</span><span class="dt"> AbstractMCMC.AbstractSampler</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"stepsize used in the leapfrog step"</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    ϵ_init<span class="op">::</span><span class="dt">T</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"covariance matrix used for the momentum"</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    M_init<span class="op">::</span><span class="dt">A</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notice how we’ve added the suffix <code>_init</code> to both the stepsize and the covariance matrix. We’ve done this because a <code>AbstractMCMC.AbstractSampler</code> should be <em>immutable</em>. Of course there might be many scenarios where we want to allow something like the stepsize and / or the covariance matrix to vary between iterations, e.g.&nbsp;during the burn-in / adaptation phase of the sampling process we might want to adjust the parameters using statistics computed from these initial iterations. But information which can change between iterations <em>should not go in the sampler itself</em>! Instead, this information should go in the sampler <em>state</em>.</p>
<p>The sampler state should at the very least contain all the necessary information to perform the next MCMC iteration, but usually contains further information, e.g.&nbsp;quantities and statistics useful for evaluating whether the sampler has converged.</p>
<p>We will use the following sampler state for our <code>MALA</code> sampler:</p>
<div id="14" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALAState{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This might seem overly redundant: we’re defining a type <code>MALAState</code> and it only contains a simple vector of reals. In this particular case we indeed could have dropped this and simply used a <code>AbstractVector{&lt;:Real}</code> as our sampler state, but typically, as we will see later, one wants to include other quantities in the sampler state. For example, if we also wanted to adapt the parameters of our <code>MALA</code>, e.g.&nbsp;alter the stepsize depending on acceptance rates, in which case we should also put <code>ϵ</code> in the state, but for now we’ll keep things simple.</p>
<p>Moreover, we also want a <em>sample</em> type, which is a type meant for “public consumption”, i.e.&nbsp;the end-user. This is generally going to contain a subset of the information present in the state. But in such a simple scenario as this, we similarly only have a <code>AbstractVector{&lt;:Real}</code>:</p>
<div id="16" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALASample{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We currently have three things:</p>
<ol type="1">
<li>A <code>AbstractMCMC.AbstractSampler</code> implementation called <code>MALA</code>.</li>
<li>A state <code>MALAState</code> for our sampler <code>MALA</code>.</li>
<li>A sample <code>MALASample</code> for our sampler <code>MALA</code>.</li>
</ol>
<p>That means that we’re ready to implement the only thing that really matters: <code>AbstractMCMC.step</code>.</p>
<p><code>AbstractMCMC.step</code> defines the MCMC iteration of our <code>MALA</code> given the current <code>MALAState</code>. Specifically, the signature of the function is as follows:</p>
<div id="18" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The RNG to ensure reproducibility.</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The model that defines our target.</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.AbstractModel</span>,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The sampler for which we're taking a `step`.</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">AbstractMCMC.AbstractSampler</span>,</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The current sampler `state`.</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    state;</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Additional keyword arguments that we may or may not need.</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Moreover, there is a specific <code>AbstractMCMC.AbstractModel</code> which is used to indicate that the model that is provided implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface: <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Since, as we discussed earlier, in our case we’re indeed going to work with types that support the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, we’ll define <code>AbstractMCMC.step</code> for such a <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Note that <code>AbstractMCMC.LogDensityModel</code> has no other purpose; it has a single field called <code>logdensity</code>, and it does nothing else. But by wrapping the model in <code>AbstractMCMC.LogDensityModel</code>, it allows samplers that want to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> to define their <code>AbstractMCMC.step</code> on this type without running into method ambiguities.</p>
<p>All in all, that means that the signature for our <code>AbstractMCMC.step</code> is going to be the following:</p>
<div id="20" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># `LogDensityModel` so we know we're working with LogDensityProblems.jl model.</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler.</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler state.</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Great! Now let’s actually implement the full <code>AbstractMCMC.step</code> for our <code>MALA</code>.</p>
<p>Let’s remind ourselves what we’re going to do:</p>
<ol type="1">
<li>Sample a new momentum <span class="math inline">\(p\)</span>.</li>
<li>Compute the log-density of the extended target <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>Take a single leapfrog step <span class="math inline">\((\tilde{x}, \tilde{p}) = L_{\epsilon}(x, p)\)</span>.</li>
<li>Accept or reject the proposed <span class="math inline">\((\tilde{x}, \tilde{p})\)</span>.</li>
</ol>
<p>All in all, this results in the following:</p>
<div id="22" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>: Random</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Distributions</span>  <span class="co"># so we get the `MvNormal`</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the wrapped model which implements LogDensityProblems.jl.</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just extract the sampler parameters to make our lives easier.</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    ϵ <span class="op">=</span> sampler.ϵ_init</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    M <span class="op">=</span> sampler.M_init</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the current parameters.</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> state.x</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sample the momentum.</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>    p_dist <span class="op">=</span> <span class="fu">MvNormal</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)), M)</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> <span class="fu">rand</span>(rng, p_dist)</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Propose using a single leapfrog step.</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>    x̃, p̃ <span class="op">=</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Accept or reject proposal.</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>    logp <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p)</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>    logp̃ <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x̃) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p̃)</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>    logα <span class="op">=</span> logp̃ <span class="op">-</span> logp</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>    state_new <span class="op">=</span> <span class="cf">if</span> <span class="fu">log</span>(<span class="fu">rand</span>(rng)) <span class="op">&lt;</span> logα</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Accept.</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x̃)</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Reject.</span></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x)</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return the "sample" and the sampler state.</span></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(state_new.x), state_new</span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Fairly straight-forward.</p>
<p>Of course, we haven’t defined the <code>leapfrog_step</code> method yet, so let’s do that:</p>
<div id="24" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p` using "position" `x`.</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x))</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    p1 <span class="op">=</span> p <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update the "position" `x` using momentum `p1`.</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    x̃ <span class="op">=</span> x <span class="op">+</span> ϵ <span class="op">.*</span> (M <span class="op">\</span> p1)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p1` using position `x̃`</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x̃ <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x̃))</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    p2 <span class="op">=</span> p1 <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x̃</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Flip momentum `p2`.</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    p̃ <span class="op">=</span> <span class="op">-</span>p2</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x̃, p̃</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>leapfrog_step (generic function with 1 method)</code></pre>
</div>
</div>
<p>With all of this, we’re technically ready to sample!</p>
<div id="26" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>, <span class="bu">LinearAlgebra</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>rng <span class="op">=</span> <span class="bu">Random</span>.<span class="fu">default_rng</span>()</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>sampler <span class="op">=</span> <span class="fu">MALA</span>(<span class="fl">1</span>, I)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>state <span class="op">=</span> <span class="fu">MALAState</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)))</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>x_next, state_next <span class="op">=</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    rng,</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    AbstractMCMC.<span class="fu">LogDensityModel</span>(model),</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    state</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>(MALASample{Vector{Float64}}([0.0, 0.0, 0.0]), MALAState{Vector{Float64}}([0.0, 0.0, 0.0]))</code></pre>
</div>
</div>
<p>Great, it works!</p>
<p>And I promised we would get quite some functionality for free if we implemented <code>AbstractMCMC.step</code>, and so we can now simply call <code>sample</code> to perform standard MCMC sampling:</p>
<div id="28" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform 1000 iterations with our `MALA` sampler.</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; initial_state<span class="op">=</span>state, progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Concatenate into a matrix.</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000 Matrix{Float64}:
 -2.33758  -3.17407   -5.88388   -5.49622   …  -2.83289   -4.23971  -5.24906
  2.05308   0.979023   0.653164   0.553034      0.331061  -1.1356    1.31238
  2.41667   4.75678    2.24458    4.01429       6.25971    6.78684   5.5656</code></pre>
</div>
</div>
<div id="30" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the marginal means and standard deviations.</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -5.01028     0.999991
  0.00262525  1.01342
  5.03911     0.995449</code></pre>
</div>
</div>
<p>Let’s visualize the samples</p>
<div id="32" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">StatsPlots</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">transpose</span>(samples_matrix[<span class="op">:</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">:</span><span class="kw">end</span>]), alpha<span class="op">=</span><span class="fl">0.5</span>, legend<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<!--?xml version="1.0" encoding="utf-8"?-->
<svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" width="672" height="480" viewbox="0 0 2688 1920">
<defs>
  <clippath id="clip860">
    <rect x="0" y="0" width="2688" height="1920"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip860)" d="M0 1920 L2688 1920 L2688 0 L0 0  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip861">
    <rect x="537" y="0" width="1883" height="1883"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip860)" d="M151.747 1800.78 L2640.76 1800.78 L2640.76 47.2441 L151.747 47.2441  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip862">
    <rect x="151" y="47" width="2490" height="1755"></rect>
  </clippath>
</defs>
<polyline clip-path="url(#clip862)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="219.84,1800.78 219.84,47.2441 "></polyline>
<polyline clip-path="url(#clip862)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="807.458,1800.78 807.458,47.2441 "></polyline>
<polyline clip-path="url(#clip862)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1395.08,1800.78 1395.08,47.2441 "></polyline>
<polyline clip-path="url(#clip862)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1982.69,1800.78 1982.69,47.2441 "></polyline>
<polyline clip-path="url(#clip862)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="2570.31,1800.78 2570.31,47.2441 "></polyline>
<polyline clip-path="url(#clip862)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,1548 2640.76,1548 "></polyline>
<polyline clip-path="url(#clip862)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,1240.12 2640.76,1240.12 "></polyline>
<polyline clip-path="url(#clip862)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,932.245 2640.76,932.245 "></polyline>
<polyline clip-path="url(#clip862)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,624.37 2640.76,624.37 "></polyline>
<polyline clip-path="url(#clip862)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,316.494 2640.76,316.494 "></polyline>
<polyline clip-path="url(#clip860)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1800.78 2640.76,1800.78 "></polyline>
<polyline clip-path="url(#clip860)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="219.84,1800.78 219.84,1781.88 "></polyline>
<polyline clip-path="url(#clip860)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="807.458,1800.78 807.458,1781.88 "></polyline>
<polyline clip-path="url(#clip860)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1395.08,1800.78 1395.08,1781.88 "></polyline>
<polyline clip-path="url(#clip860)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1982.69,1800.78 1982.69,1781.88 "></polyline>
<polyline clip-path="url(#clip860)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="2570.31,1800.78 2570.31,1781.88 "></polyline>
<path clip-path="url(#clip860)" d="M219.84 1834 Q216.229 1834 214.4 1837.57 Q212.595 1841.11 212.595 1848.24 Q212.595 1855.34 214.4 1858.91 Q216.229 1862.45 219.84 1862.45 Q223.474 1862.45 225.28 1858.91 Q227.108 1855.34 227.108 1848.24 Q227.108 1841.11 225.28 1837.57 Q223.474 1834 219.84 1834 M219.84 1830.3 Q225.65 1830.3 228.706 1834.9 Q231.784 1839.49 231.784 1848.24 Q231.784 1856.96 228.706 1861.57 Q225.65 1866.15 219.84 1866.15 Q214.03 1866.15 210.951 1861.57 Q207.896 1856.96 207.896 1848.24 Q207.896 1839.49 210.951 1834.9 Q214.03 1830.3 219.84 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip860)" d="M771.15 1861.55 L787.47 1861.55 L787.47 1865.48 L765.525 1865.48 L765.525 1861.55 Q768.187 1858.79 772.771 1854.16 Q777.377 1849.51 778.558 1848.17 Q780.803 1845.65 781.683 1843.91 Q782.585 1842.15 782.585 1840.46 Q782.585 1837.71 780.641 1835.97 Q778.72 1834.23 775.618 1834.23 Q773.419 1834.23 770.965 1835 Q768.535 1835.76 765.757 1837.31 L765.757 1832.59 Q768.581 1831.46 771.035 1830.88 Q773.488 1830.3 775.525 1830.3 Q780.896 1830.3 784.09 1832.98 Q787.285 1835.67 787.285 1840.16 Q787.285 1842.29 786.474 1844.21 Q785.687 1846.11 783.581 1848.7 Q783.002 1849.37 779.9 1852.59 Q776.798 1855.78 771.15 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip860)" d="M797.331 1830.92 L815.687 1830.92 L815.687 1834.86 L801.613 1834.86 L801.613 1843.33 Q802.632 1842.98 803.65 1842.82 Q804.669 1842.64 805.687 1842.64 Q811.474 1842.64 814.854 1845.81 Q818.233 1848.98 818.233 1854.4 Q818.233 1859.97 814.761 1863.08 Q811.289 1866.15 804.97 1866.15 Q802.794 1866.15 800.525 1865.78 Q798.28 1865.41 795.872 1864.67 L795.872 1859.97 Q797.956 1861.11 800.178 1861.66 Q802.4 1862.22 804.877 1862.22 Q808.882 1862.22 811.22 1860.11 Q813.558 1858.01 813.558 1854.4 Q813.558 1850.78 811.22 1848.68 Q808.882 1846.57 804.877 1846.57 Q803.002 1846.57 801.127 1846.99 Q799.275 1847.4 797.331 1848.28 L797.331 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip860)" d="M837.446 1834 Q833.835 1834 832.007 1837.57 Q830.201 1841.11 830.201 1848.24 Q830.201 1855.34 832.007 1858.91 Q833.835 1862.45 837.446 1862.45 Q841.081 1862.45 842.886 1858.91 Q844.715 1855.34 844.715 1848.24 Q844.715 1841.11 842.886 1837.57 Q841.081 1834 837.446 1834 M837.446 1830.3 Q843.256 1830.3 846.312 1834.9 Q849.391 1839.49 849.391 1848.24 Q849.391 1856.96 846.312 1861.57 Q843.256 1866.15 837.446 1866.15 Q831.636 1866.15 828.557 1861.57 Q825.502 1856.96 825.502 1848.24 Q825.502 1839.49 828.557 1834.9 Q831.636 1830.3 837.446 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip860)" d="M1354.69 1830.92 L1373.05 1830.92 L1373.05 1834.86 L1358.98 1834.86 L1358.98 1843.33 Q1360 1842.98 1361.01 1842.82 Q1362.03 1842.64 1363.05 1842.64 Q1368.84 1842.64 1372.22 1845.81 Q1375.6 1848.98 1375.6 1854.4 Q1375.6 1859.97 1372.12 1863.08 Q1368.65 1866.15 1362.33 1866.15 Q1360.16 1866.15 1357.89 1865.78 Q1355.64 1865.41 1353.24 1864.67 L1353.24 1859.97 Q1355.32 1861.11 1357.54 1861.66 Q1359.76 1862.22 1362.24 1862.22 Q1366.25 1862.22 1368.58 1860.11 Q1370.92 1858.01 1370.92 1854.4 Q1370.92 1850.78 1368.58 1848.68 Q1366.25 1846.57 1362.24 1846.57 Q1360.37 1846.57 1358.49 1846.99 Q1356.64 1847.4 1354.69 1848.28 L1354.69 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip860)" d="M1394.81 1834 Q1391.2 1834 1389.37 1837.57 Q1387.56 1841.11 1387.56 1848.24 Q1387.56 1855.34 1389.37 1858.91 Q1391.2 1862.45 1394.81 1862.45 Q1398.44 1862.45 1400.25 1858.91 Q1402.08 1855.34 1402.08 1848.24 Q1402.08 1841.11 1400.25 1837.57 Q1398.44 1834 1394.81 1834 M1394.81 1830.3 Q1400.62 1830.3 1403.68 1834.9 Q1406.75 1839.49 1406.75 1848.24 Q1406.75 1856.96 1403.68 1861.57 Q1400.62 1866.15 1394.81 1866.15 Q1389 1866.15 1385.92 1861.57 Q1382.87 1856.96 1382.87 1848.24 Q1382.87 1839.49 1385.92 1834.9 Q1389 1830.3 1394.81 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip860)" d="M1424.97 1834 Q1421.36 1834 1419.53 1837.57 Q1417.73 1841.11 1417.73 1848.24 Q1417.73 1855.34 1419.53 1858.91 Q1421.36 1862.45 1424.97 1862.45 Q1428.61 1862.45 1430.41 1858.91 Q1432.24 1855.34 1432.24 1848.24 Q1432.24 1841.11 1430.41 1837.57 Q1428.61 1834 1424.97 1834 M1424.97 1830.3 Q1430.78 1830.3 1433.84 1834.9 Q1436.92 1839.49 1436.92 1848.24 Q1436.92 1856.96 1433.84 1861.57 Q1430.78 1866.15 1424.97 1866.15 Q1419.16 1866.15 1416.08 1861.57 Q1413.03 1856.96 1413.03 1848.24 Q1413.03 1839.49 1416.08 1834.9 Q1419.16 1830.3 1424.97 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip860)" d="M1940.97 1830.92 L1963.19 1830.92 L1963.19 1832.91 L1950.65 1865.48 L1945.76 1865.48 L1957.57 1834.86 L1940.97 1834.86 L1940.97 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip860)" d="M1972.36 1830.92 L1990.71 1830.92 L1990.71 1834.86 L1976.64 1834.86 L1976.64 1843.33 Q1977.66 1842.98 1978.68 1842.82 Q1979.7 1842.64 1980.72 1842.64 Q1986.5 1842.64 1989.88 1845.81 Q1993.26 1848.98 1993.26 1854.4 Q1993.26 1859.97 1989.79 1863.08 Q1986.32 1866.15 1980 1866.15 Q1977.82 1866.15 1975.55 1865.78 Q1973.31 1865.41 1970.9 1864.67 L1970.9 1859.97 Q1972.98 1861.11 1975.21 1861.66 Q1977.43 1862.22 1979.9 1862.22 Q1983.91 1862.22 1986.25 1860.11 Q1988.59 1858.01 1988.59 1854.4 Q1988.59 1850.78 1986.25 1848.68 Q1983.91 1846.57 1979.9 1846.57 Q1978.03 1846.57 1976.15 1846.99 Q1974.3 1847.4 1972.36 1848.28 L1972.36 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip860)" d="M2012.47 1834 Q2008.86 1834 2007.03 1837.57 Q2005.23 1841.11 2005.23 1848.24 Q2005.23 1855.34 2007.03 1858.91 Q2008.86 1862.45 2012.47 1862.45 Q2016.11 1862.45 2017.91 1858.91 Q2019.74 1855.34 2019.74 1848.24 Q2019.74 1841.11 2017.91 1837.57 Q2016.11 1834 2012.47 1834 M2012.47 1830.3 Q2018.28 1830.3 2021.34 1834.9 Q2024.42 1839.49 2024.42 1848.24 Q2024.42 1856.96 2021.34 1861.57 Q2018.28 1866.15 2012.47 1866.15 Q2006.66 1866.15 2003.59 1861.57 Q2000.53 1856.96 2000.53 1848.24 Q2000.53 1839.49 2003.59 1834.9 Q2006.66 1830.3 2012.47 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip860)" d="M2514.84 1861.55 L2522.48 1861.55 L2522.48 1835.18 L2514.17 1836.85 L2514.17 1832.59 L2522.43 1830.92 L2527.11 1830.92 L2527.11 1861.55 L2534.75 1861.55 L2534.75 1865.48 L2514.84 1865.48 L2514.84 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip860)" d="M2554.19 1834 Q2550.58 1834 2548.75 1837.57 Q2546.94 1841.11 2546.94 1848.24 Q2546.94 1855.34 2548.75 1858.91 Q2550.58 1862.45 2554.19 1862.45 Q2557.82 1862.45 2559.63 1858.91 Q2561.46 1855.34 2561.46 1848.24 Q2561.46 1841.11 2559.63 1837.57 Q2557.82 1834 2554.19 1834 M2554.19 1830.3 Q2560 1830.3 2563.06 1834.9 Q2566.13 1839.49 2566.13 1848.24 Q2566.13 1856.96 2563.06 1861.57 Q2560 1866.15 2554.19 1866.15 Q2548.38 1866.15 2545.3 1861.57 Q2542.25 1856.96 2542.25 1848.24 Q2542.25 1839.49 2545.3 1834.9 Q2548.38 1830.3 2554.19 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip860)" d="M2584.35 1834 Q2580.74 1834 2578.91 1837.57 Q2577.11 1841.11 2577.11 1848.24 Q2577.11 1855.34 2578.91 1858.91 Q2580.74 1862.45 2584.35 1862.45 Q2587.99 1862.45 2589.79 1858.91 Q2591.62 1855.34 2591.62 1848.24 Q2591.62 1841.11 2589.79 1837.57 Q2587.99 1834 2584.35 1834 M2584.35 1830.3 Q2590.16 1830.3 2593.22 1834.9 Q2596.3 1839.49 2596.3 1848.24 Q2596.3 1856.96 2593.22 1861.57 Q2590.16 1866.15 2584.35 1866.15 Q2578.54 1866.15 2575.46 1861.57 Q2572.41 1856.96 2572.41 1848.24 Q2572.41 1839.49 2575.46 1834.9 Q2578.54 1830.3 2584.35 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip860)" d="M2614.51 1834 Q2610.9 1834 2609.07 1837.57 Q2607.27 1841.11 2607.27 1848.24 Q2607.27 1855.34 2609.07 1858.91 Q2610.9 1862.45 2614.51 1862.45 Q2618.15 1862.45 2619.95 1858.91 Q2621.78 1855.34 2621.78 1848.24 Q2621.78 1841.11 2619.95 1837.57 Q2618.15 1834 2614.51 1834 M2614.51 1830.3 Q2620.32 1830.3 2623.38 1834.9 Q2626.46 1839.49 2626.46 1848.24 Q2626.46 1856.96 2623.38 1861.57 Q2620.32 1866.15 2614.51 1866.15 Q2608.7 1866.15 2605.62 1861.57 Q2602.57 1856.96 2602.57 1848.24 Q2602.57 1839.49 2605.62 1834.9 Q2608.7 1830.3 2614.51 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip860)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1800.78 151.747,47.2441 "></polyline>
<polyline clip-path="url(#clip860)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1548 170.644,1548 "></polyline>
<polyline clip-path="url(#clip860)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1240.12 170.644,1240.12 "></polyline>
<polyline clip-path="url(#clip860)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,932.245 170.644,932.245 "></polyline>
<polyline clip-path="url(#clip860)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,624.37 170.644,624.37 "></polyline>
<polyline clip-path="url(#clip860)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,316.494 170.644,316.494 "></polyline>
<path clip-path="url(#clip860)" d="M49.5521 1548.45 L79.2279 1548.45 L79.2279 1552.38 L49.5521 1552.38 L49.5521 1548.45 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip860)" d="M99.8991 1546.13 Q96.7509 1546.13 94.8991 1548.29 Q93.0704 1550.44 93.0704 1554.19 Q93.0704 1557.92 94.8991 1560.09 Q96.7509 1562.24 99.8991 1562.24 Q103.047 1562.24 104.876 1560.09 Q106.728 1557.92 106.728 1554.19 Q106.728 1550.44 104.876 1548.29 Q103.047 1546.13 99.8991 1546.13 M109.181 1531.48 L109.181 1535.74 Q107.422 1534.91 105.617 1534.47 Q103.834 1534.03 102.075 1534.03 Q97.4454 1534.03 94.9917 1537.15 Q92.5612 1540.28 92.2139 1546.6 Q93.5797 1544.58 95.6398 1543.52 Q97.7 1542.43 100.177 1542.43 Q105.385 1542.43 108.394 1545.6 Q111.427 1548.75 111.427 1554.19 Q111.427 1559.51 108.279 1562.73 Q105.131 1565.95 99.8991 1565.95 Q93.9037 1565.95 90.7325 1561.36 Q87.5612 1556.76 87.5612 1548.03 Q87.5612 1539.84 91.45 1534.98 Q95.3389 1530.09 101.89 1530.09 Q103.649 1530.09 105.431 1530.44 Q107.237 1530.79 109.181 1531.48 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip860)" d="M50.3623 1240.57 L80.0381 1240.57 L80.0381 1244.51 L50.3623 1244.51 L50.3623 1240.57 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip860)" d="M104.297 1238.77 Q107.654 1239.48 109.529 1241.75 Q111.427 1244.02 111.427 1247.35 Q111.427 1252.47 107.908 1255.27 Q104.39 1258.07 97.9083 1258.07 Q95.7324 1258.07 93.4176 1257.63 Q91.126 1257.22 88.6723 1256.36 L88.6723 1251.85 Q90.6167 1252.98 92.9315 1253.56 Q95.2463 1254.14 97.7695 1254.14 Q102.168 1254.14 104.459 1252.4 Q106.774 1250.66 106.774 1247.35 Q106.774 1244.3 104.621 1242.59 Q102.492 1240.85 98.6722 1240.85 L94.6445 1240.85 L94.6445 1237.01 L98.8574 1237.01 Q102.306 1237.01 104.135 1235.64 Q105.964 1234.25 105.964 1231.66 Q105.964 1229 104.066 1227.59 Q102.191 1226.15 98.6722 1226.15 Q96.7509 1226.15 94.5519 1226.57 Q92.3528 1226.98 89.7139 1227.86 L89.7139 1223.7 Q92.376 1222.96 94.6908 1222.59 Q97.0287 1222.22 99.0889 1222.22 Q104.413 1222.22 107.515 1224.65 Q110.617 1227.05 110.617 1231.17 Q110.617 1234.04 108.973 1236.04 Q107.33 1238 104.297 1238.77 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip860)" d="M99.4824 918.044 Q95.8713 918.044 94.0426 921.609 Q92.2371 925.15 92.2371 932.28 Q92.2371 939.386 94.0426 942.951 Q95.8713 946.493 99.4824 946.493 Q103.117 946.493 104.922 942.951 Q106.751 939.386 106.751 932.28 Q106.751 925.15 104.922 921.609 Q103.117 918.044 99.4824 918.044 M99.4824 914.34 Q105.293 914.34 108.348 918.947 Q111.427 923.53 111.427 932.28 Q111.427 941.007 108.348 945.613 Q105.293 950.197 99.4824 950.197 Q93.6723 950.197 90.5936 945.613 Q87.538 941.007 87.538 932.28 Q87.538 923.53 90.5936 918.947 Q93.6723 914.34 99.4824 914.34 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip860)" d="M104.297 623.015 Q107.654 623.733 109.529 626.001 Q111.427 628.27 111.427 631.603 Q111.427 636.719 107.908 639.52 Q104.39 642.321 97.9083 642.321 Q95.7324 642.321 93.4176 641.881 Q91.126 641.464 88.6723 640.608 L88.6723 636.094 Q90.6167 637.228 92.9315 637.807 Q95.2463 638.386 97.7695 638.386 Q102.168 638.386 104.459 636.65 Q106.774 634.913 106.774 631.603 Q106.774 628.548 104.621 626.835 Q102.492 625.099 98.6722 625.099 L94.6445 625.099 L94.6445 621.256 L98.8574 621.256 Q102.306 621.256 104.135 619.89 Q105.964 618.501 105.964 615.909 Q105.964 613.247 104.066 611.835 Q102.191 610.4 98.6722 610.4 Q96.7509 610.4 94.5519 610.816 Q92.3528 611.233 89.7139 612.113 L89.7139 607.946 Q92.376 607.205 94.6908 606.835 Q97.0287 606.465 99.0889 606.465 Q104.413 606.465 107.515 608.895 Q110.617 611.302 110.617 615.423 Q110.617 618.293 108.973 620.284 Q107.33 622.251 104.297 623.015 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip860)" d="M99.8991 314.63 Q96.7509 314.63 94.8991 316.783 Q93.0704 318.936 93.0704 322.686 Q93.0704 326.413 94.8991 328.589 Q96.7509 330.741 99.8991 330.741 Q103.047 330.741 104.876 328.589 Q106.728 326.413 106.728 322.686 Q106.728 318.936 104.876 316.783 Q103.047 314.63 99.8991 314.63 M109.181 299.978 L109.181 304.237 Q107.422 303.404 105.617 302.964 Q103.834 302.524 102.075 302.524 Q97.4454 302.524 94.9917 305.649 Q92.5612 308.774 92.2139 315.093 Q93.5797 313.079 95.6398 312.015 Q97.7 310.927 100.177 310.927 Q105.385 310.927 108.394 314.098 Q111.427 317.246 111.427 322.686 Q111.427 328.01 108.279 331.228 Q105.131 334.445 99.8991 334.445 Q93.9037 334.445 90.7325 329.862 Q87.5612 325.255 87.5612 316.529 Q87.5612 308.334 91.45 303.473 Q95.3389 298.589 101.89 298.589 Q103.649 298.589 105.431 298.936 Q107.237 299.283 109.181 299.978 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip862)" style="stroke:#009af9; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,1172.14 224.541,1479.97 226.891,1379.48 229.242,1550.43 231.592,1480.04 233.943,1423.9 236.293,1588.79 238.644,1452.62 240.994,1393.63 243.345,1412.72 245.695,1484.92 248.046,1508.09 250.396,1504.5 252.747,1445.3 255.097,1380.1 257.448,1447.34 259.798,1246.05 262.148,1544.54 264.499,1476.17 266.849,1394.59 269.2,1483.91 271.55,1273.29 273.901,1437.29 276.251,1569.68 278.602,1393.16 280.952,1530.42 283.303,1416.7 285.653,1534.16 288.004,1285.06 290.354,1639.54 292.705,1535.45 295.055,1331.22 297.406,1245.45 299.756,1558.58 302.107,1678.64 304.457,1471.39 306.807,1392.51 309.158,1444.07 311.508,1345.62 313.859,1472.29 316.209,1433.06 318.56,1360.3 320.91,1404.28 323.261,1341.42 325.611,1364.13 327.962,1413.59 330.312,1540.93 332.663,1511.15 335.013,1474.37 337.364,1217.17 339.714,1545.92 342.065,1519.72 344.415,1373.17 346.765,1504.7 349.116,1317.99 351.466,1407.5 353.817,1530.43 356.167,1362.8 358.518,1373.48 360.868,1339.68 363.219,1403.35 365.569,1577.02 367.92,1674.71 370.27,1443.99 372.621,1351.23 374.971,1399.08 377.322,1359.35 379.672,1269.97 382.023,1381.41 384.373,1451.57 386.724,1653.82 389.074,1559.9 391.424,1416.79 393.775,1546.16 396.125,1603.44 398.476,1435.79 400.826,1376.11 403.177,1478.07 405.527,1447.06 407.878,1368.77 410.228,1533.09 412.579,1490.31 414.929,1592.63 417.28,1330.07 419.63,1500.93 421.981,1551.44 424.331,1573.53 426.682,1281.79 429.032,1400.22 431.382,1495.79 433.733,1250.6 436.083,1468.13 438.434,1384.64 440.784,1360.87 443.135,1480.87 445.485,1399.62 447.836,1485.42 450.186,1381.27 452.537,1456.69 454.887,1466 457.238,1458.85 459.588,1319.27 461.939,1490.77 464.289,1453.04 466.64,1284.56 468.99,1490.48 471.341,1453.23 473.691,1439.58 476.041,1371.11 478.392,1455.68 480.742,1364.32 483.093,1592.71 485.443,1488 487.794,1532.47 490.144,1524.45 492.495,1524.39 494.845,1414.59 497.196,1540.9 499.546,1615.4 501.897,1354 504.247,1553.26 506.598,1428.94 508.948,1351.2 511.299,1518.89 513.649,1314.41 515.999,1284.93 518.35,1554.24 520.7,1523.32 523.051,1615.85 525.401,1411.01 527.752,1396.3 530.102,1325.77 532.453,1463.62 534.803,1436.32 537.154,1334.9 539.504,1576.36 541.855,1588.93 544.205,1560.81 546.556,1597.45 548.906,1453.39 551.257,1536.22 553.607,1440.65 555.958,1380.26 558.308,1381.36 560.658,1452.28 563.009,1296.36 565.359,1420.5 567.71,1501.68 570.06,1332.49 572.411,1403.08 574.761,1321.77 577.112,1397.04 579.462,1469.36 581.813,1514.87 584.163,1426.55 586.514,1552.39 588.864,1374.49 591.215,1390.11 593.565,1601.5 595.916,1465.25 598.266,1445.55 600.616,1505.44 602.967,1335.22 605.317,1457.24 607.668,1617.9 610.018,1228.96 612.369,1464.76 614.719,1405.98 617.07,1477.99 619.42,1419.38 621.771,1485.66 624.121,1435.97 626.472,1423.67 628.822,1321.21 631.173,1564.35 633.523,1504.88 635.874,1607.99 638.224,1350.52 640.575,1556.6 642.925,1457.07 645.275,1355.66 647.626,1360.87 649.976,1468.78 652.327,1413.83 654.677,1232.24 657.028,1388.14 659.378,1433.59 661.729,1349.64 664.079,1349.66 666.43,1751.15 668.78,1464.12 671.131,1402.73 673.481,1390.35 675.832,1504.42 678.182,1371.13 680.533,1458.99 682.883,1647.09 685.233,1483.44 687.584,1421.4 689.934,1444.28 692.285,1446.08 694.635,1420.09 696.986,1586.07 699.336,1396.09 701.687,1379.07 704.037,1256 706.388,1657.52 708.738,1430.51 711.089,1470.81 713.439,1226.04 715.79,1451.19 718.14,1450.65 720.491,1278.46 722.841,1320.06 725.192,1407.8 727.542,1433.81 729.892,1367.77 732.243,1389.08 734.593,1446 736.944,1483.38 739.294,1382.96 741.645,1534.89 743.995,1393.31 746.346,1354.16 748.696,1273.79 751.047,1270.39 753.397,1268.64 755.748,1536.87 758.098,1402.61 760.449,1380.72 762.799,1553.99 765.15,1289.44 767.5,1281.52 769.85,1327.36 772.201,1555.99 774.551,1493.46 776.902,1459.77 779.252,1504.21 781.603,1638.47 783.953,1457.21 786.304,1571.39 788.654,1377.57 791.005,1614.51 793.355,1487.4 795.706,1498.58 798.056,1400.12 800.407,1593.77 802.757,1473.26 805.108,1182.13 807.458,1433.69 809.809,1223.12 812.159,1536.62 814.509,1514.65 816.86,1291 819.21,1345.42 821.561,1407.03 823.911,1428.16 826.262,1393.72 828.612,1357.66 830.963,1262.61 833.313,1370.16 835.664,1329.46 838.014,1530.15 840.365,1678.71 842.715,1306.71 845.066,1418.85 847.416,1526.47 849.767,1419.03 852.117,1290.37 854.467,1642.27 856.818,1539.99 859.168,1485.42 861.519,1340.02 863.869,1323.55 866.22,1409.59 868.57,1370.66 870.921,1434.59 873.271,1274.21 875.622,1575.07 877.972,1244.53 880.323,1535.62 882.673,1357.88 885.024,1319.98 887.374,1384.86 889.725,1434.13 892.075,1353.34 894.426,1310.27 896.776,1104.73 899.126,1492.67 901.477,1559.78 903.827,1412.01 906.178,1202.62 908.528,1336.93 910.879,1549.94 913.229,1498.26 915.58,1452.87 917.93,1652.16 920.281,1251.46 922.631,1461.11 924.982,1648.41 927.332,1440.87 929.683,1545.88 932.033,1364.17 934.384,1533.32 936.734,1455.52 939.084,1490.97 941.435,1499.29 943.785,1280.95 946.136,1485.8 948.486,1388.36 950.837,1467.02 953.187,1501.4 955.538,1510.09 957.888,1428.34 960.239,1530.41 962.589,1508.43 964.94,1457.79 967.29,1535.97 969.641,1360.37 971.991,1509.38 974.342,1372.3 976.692,1476.22 979.043,1522.98 981.393,1396.95 983.743,1478.33 986.094,1327.9 988.444,1584.67 990.795,1471.1 993.145,1310.55 995.496,1428.58 997.846,1312.71 1000.2,1633.12 1002.55,1342.29 1004.9,1405.23 1007.25,1250.55 1009.6,1323.17 1011.95,1469.3 1014.3,1337.97 1016.65,1234.21 1019,1385.33 1021.35,1437.08 1023.7,1396.91 1026.05,1287.06 1028.4,1464.02 1030.75,1595.54 1033.1,1153.61 1035.45,1408.01 1037.8,1526.46 1040.15,1376.28 1042.51,1499.55 1044.86,1588.73 1047.21,1399.55 1049.56,1404.06 1051.91,1381.24 1054.26,1523.26 1056.61,1487.93 1058.96,1431.78 1061.31,1618.32 1063.66,1512.36 1066.01,1352.48 1068.36,1457.84 1070.71,1357.83 1073.06,1362.62 1075.41,1432.2 1077.76,1404.6 1080.11,1491.31 1082.46,1417.3 1084.81,1633.56 1087.16,1449.2 1089.51,1385.75 1091.87,1452.74 1094.22,1479.72 1096.57,1356.64 1098.92,1416.01 1101.27,1541.42 1103.62,1304.16 1105.97,1570.54 1108.32,1749.17 1110.67,1532.55 1113.02,1536.06 1115.37,1564.76 1117.72,1348.54 1120.07,1457.67 1122.42,1385.78 1124.77,1481.23 1127.12,1396.05 1129.47,1454.23 1131.82,1490.84 1134.17,1538.41 1136.52,1627.56 1138.87,1347.01 1141.23,1425.02 1143.58,1502.14 1145.93,1377.78 1148.28,1288.97 1150.63,1497.36 1152.98,1288.93 1155.33,1273.22 1157.68,1440.22 1160.03,1564.44 1162.38,1645.38 1164.73,1427.27 1167.08,1504.66 1169.43,1398.46 1171.78,1510.3 1174.13,1333.29 1176.48,1497.98 1178.83,1426.69 1181.18,1418.09 1183.53,1472.52 1185.88,1425.44 1188.23,1610.92 1190.59,1448.94 1192.94,1172.87 1195.29,1493.38 1197.64,1569.92 1199.99,1547.88 1202.34,1384.09 1204.69,1441.48 1207.04,1562.57 1209.39,1546.64 1211.74,1273.67 1214.09,1600.05 1216.44,1573.86 1218.79,1411.74 1221.14,1430.35 1223.49,1392.69 1225.84,1328.43 1228.19,1462.82 1230.54,1475.46 1232.89,1456.2 1235.24,1493.53 1237.59,1468.79 1239.94,1325.35 1242.3,1539.02 1244.65,1430.39 1247,1522.99 1249.35,1334.69 1251.7,1380.47 1254.05,1336.3 1256.4,1366.11 1258.75,1358.36 1261.1,1515.93 1263.45,1381.5 1265.8,1432.33 1268.15,1400.17 1270.5,1255.13 1272.85,1356.17 1275.2,1357.99 1277.55,1494.53 1279.9,1593.2 1282.25,1437.88 1284.6,1408.2 1286.95,1368.55 1289.3,1487.46 1291.66,1408.8 1294.01,1550.59 1296.36,1574.2 1298.71,1590.77 1301.06,1429.58 1303.41,1318.78 1305.76,1362.69 1308.11,1490.92 1310.46,1315.49 1312.81,1538.44 1315.16,1242.12 1317.51,1601.92 1319.86,1564.37 1322.21,1502.4 1324.56,1602.01 1326.91,1370.64 1329.26,1432.4 1331.61,1449.31 1333.96,1519.45 1336.31,1481.76 1338.66,1234.07 1341.02,1541.32 1343.37,1414.94 1345.72,1287.12 1348.07,1617.41 1350.42,1288.19 1352.77,1542.42 1355.12,1304.75 1357.47,1428.53 1359.82,1472.98 1362.17,1493.97 1364.52,1358.4 1366.87,1534.49 1369.22,1353.84 1371.57,1429.11 1373.92,1445.57 1376.27,1713.42 1378.62,1528.71 1380.97,1494.01 1383.32,1450.11 1385.67,1547.62 1388.02,1415.81 1390.38,1302.06 1392.73,1394.69 1395.08,1476.32 1397.43,1475.09 1399.78,1549.55 1402.13,1410.03 1404.48,1447.96 1406.83,1376.95 1409.18,1440.05 1411.53,1376.17 1413.88,1514.43 1416.23,1517.47 1418.58,1376.47 1420.93,1596.54 1423.28,1334.23 1425.63,1222.64 1427.98,1601.79 1430.33,1560.42 1432.68,1570.47 1435.03,1399.17 1437.38,1390.14 1439.74,1334.66 1442.09,1451.21 1444.44,1457.31 1446.79,1498.16 1449.14,1373.32 1451.49,1359.83 1453.84,1438.49 1456.19,1328.75 1458.54,1350.9 1460.89,1357.28 1463.24,1412.54 1465.59,1545.2 1467.94,1362.98 1470.29,1484.26 1472.64,1522.3 1474.99,1487.67 1477.34,1534.32 1479.69,1292.35 1482.04,1373.04 1484.39,1495.65 1486.74,1259.84 1489.1,1456.48 1491.45,1399.36 1493.8,1348.27 1496.15,1392.57 1498.5,1367.73 1500.85,1578.21 1503.2,1324.57 1505.55,1556.05 1507.9,1378.43 1510.25,1473.69 1512.6,1407.71 1514.95,1416.3 1517.3,1421.03 1519.65,1664.25 1522,1639.55 1524.35,1497.9 1526.7,1354.85 1529.05,1366.9 1531.4,1371.69 1533.75,1390.56 1536.1,1391.25 1538.45,1475 1540.81,1460.83 1543.16,1385.11 1545.51,1450.35 1547.86,1589.62 1550.21,1350.79 1552.56,1547.44 1554.91,1495.17 1557.26,1297.36 1559.61,1412.88 1561.96,1388.29 1564.31,1615.95 1566.66,1550.41 1569.01,1398.52 1571.36,1585.6 1573.71,1710.6 1576.06,1537.08 1578.41,1492.31 1580.76,1395.92 1583.11,1325.71 1585.46,1261.14 1587.81,1447.11 1590.17,1407.57 1592.52,1417.76 1594.87,1343.58 1597.22,1548.09 1599.57,1486.4 1601.92,1542.04 1604.27,1300.46 1606.62,1566.72 1608.97,1326.68 1611.32,1581.8 1613.67,1435.9 1616.02,1513.56 1618.37,1469.28 1620.72,1412.91 1623.07,1549.95 1625.42,1460.82 1627.77,1214.49 1630.12,1513.26 1632.47,1275.62 1634.82,1421.03 1637.17,1451.8 1639.53,1420.98 1641.88,1448.83 1644.23,1539.73 1646.58,1412.45 1648.93,1378.6 1651.28,1390.39 1653.63,1605.33 1655.98,1505.13 1658.33,1468.73 1660.68,1404.71 1663.03,1456.48 1665.38,1409.29 1667.73,1494.76 1670.08,1465.57 1672.43,1602.19 1674.78,1604.43 1677.13,1470.66 1679.48,1191.03 1681.83,1453.74 1684.18,1318.8 1686.53,1541.45 1688.89,1351.54 1691.24,1377.7 1693.59,1603.7 1695.94,1575.46 1698.29,1441.15 1700.64,1304.67 1702.99,1340.27 1705.34,1501.69 1707.69,1426.64 1710.04,1551.55 1712.39,1309.33 1714.74,1271.99 1717.09,1597.5 1719.44,1357.96 1721.79,1534.49 1724.14,1566.37 1726.49,1232.11 1728.84,1331.12 1731.19,1362.66 1733.54,1342.06 1735.89,1428.25 1738.25,1480.36 1740.6,1583.24 1742.95,1484.53 1745.3,1543.71 1747.65,1526.46 1750,1555.78 1752.35,1261.04 1754.7,1434.31 1757.05,1494.81 1759.4,1491.58 1761.75,1269.88 1764.1,1459.27 1766.45,1486.04 1768.8,1467.76 1771.15,1486.65 1773.5,1402.01 1775.85,1604.32 1778.2,1361.07 1780.55,1697.12 1782.9,1382.21 1785.25,1673.39 1787.6,1478.56 1789.96,1454.71 1792.31,1537.93 1794.66,1494.95 1797.01,1460.7 1799.36,1497.88 1801.71,1435.18 1804.06,1286.02 1806.41,1303.84 1808.76,1265.15 1811.11,1322.54 1813.46,1594.93 1815.81,1319.97 1818.16,1488.71 1820.51,1508.28 1822.86,1439.48 1825.21,1510.5 1827.56,1439.45 1829.91,1490.37 1832.26,1438.28 1834.61,1388.66 1836.96,1604.09 1839.32,1406.54 1841.67,1297.47 1844.02,1495.57 1846.37,1527.56 1848.72,1556.93 1851.07,1179.26 1853.42,1450.07 1855.77,1344.11 1858.12,1460.23 1860.47,1603.64 1862.82,1522.93 1865.17,1505.82 1867.52,1496.75 1869.87,1549 1872.22,1424.04 1874.57,1348.82 1876.92,1247.34 1879.27,1514.93 1881.62,1419.96 1883.97,1498.54 1886.32,1536.01 1888.68,1249.05 1891.03,1356.18 1893.38,1373.69 1895.73,1477.54 1898.08,1639.6 1900.43,1256.54 1902.78,1320.02 1905.13,1392.39 1907.48,1551.9 1909.83,1286.03 1912.18,1452.69 1914.53,1490.02 1916.88,1477.82 1919.23,1505.92 1921.58,1553.77 1923.93,1534.65 1926.28,1513.61 1928.63,1535.75 1930.98,1442.11 1933.33,1493.64 1935.68,1171.81 1938.04,1409.47 1940.39,1515.16 1942.74,1595.4 1945.09,1582.1 1947.44,1339.24 1949.79,1494.9 1952.14,1656.74 1954.49,1443.24 1956.84,1474.5 1959.19,1461.68 1961.54,1312.1 1963.89,1476.65 1966.24,1382.85 1968.59,1451.69 1970.94,1283.81 1973.29,1463.64 1975.64,1539.93 1977.99,1424.84 1980.34,1440.33 1982.69,1411.42 1985.04,1385.17 1987.4,1387.7 1989.75,1643.5 1992.1,1365.63 1994.45,1451.21 1996.8,1253.85 1999.15,1557.38 2001.5,1507.73 2003.85,1292.13 2006.2,1402.12 2008.55,1463.86 2010.9,1525.72 2013.25,1534.29 2015.6,1385.34 2017.95,1405.47 2020.3,1439.81 2022.65,1251.4 2025,1288.11 2027.35,1399.54 2029.7,1393.79 2032.05,1411.63 2034.4,1597.86 2036.76,1390.58 2039.11,1417.78 2041.46,1551.07 2043.81,1288.2 2046.16,1358.52 2048.51,1507.68 2050.86,1271.04 2053.21,1401.23 2055.56,1356.72 2057.91,1664.22 2060.26,1310.8 2062.61,1354.32 2064.96,1391.53 2067.31,1544.28 2069.66,1132.92 2072.01,1568.82 2074.36,1494.92 2076.71,1295.97 2079.06,1326.51 2081.41,1494.21 2083.76,1319.66 2086.11,1377.75 2088.47,1421.77 2090.82,1372.39 2093.17,1515.23 2095.52,1200.48 2097.87,1306.29 2100.22,1395.61 2102.57,1365.7 2104.92,1243.22 2107.27,1444.67 2109.62,1451.1 2111.97,1332.71 2114.32,1366.82 2116.67,1382.73 2119.02,1198.61 2121.37,1501.94 2123.72,1418.12 2126.07,1532.17 2128.42,1579.79 2130.77,1551.76 2133.12,1427.17 2135.47,1519.52 2137.83,1356.2 2140.18,1260.62 2142.53,1441.77 2144.88,1380.78 2147.23,1236.43 2149.58,1393.98 2151.93,1600.23 2154.28,1526.26 2156.63,1351.77 2158.98,1331.99 2161.33,1506.11 2163.68,1433.18 2166.03,1373.02 2168.38,1406.11 2170.73,1506.78 2173.08,1460.58 2175.43,1411.13 2177.78,1515.26 2180.13,1468.28 2182.48,1293.79 2184.83,1597.62 2187.19,1653.38 2189.54,1405.95 2191.89,1336.46 2194.24,1526.53 2196.59,1468.75 2198.94,1310.82 2201.29,1529.23 2203.64,1572.12 2205.99,1490.83 2208.34,1551.92 2210.69,1395.84 2213.04,1319.31 2215.39,1589.58 2217.74,1616.01 2220.09,1370.07 2222.44,1506.82 2224.79,1409.58 2227.14,1433.43 2229.49,1566.59 2231.84,1432.31 2234.19,1492.79 2236.55,1456.22 2238.9,1397.78 2241.25,1483.63 2243.6,1474.37 2245.95,1391.12 2248.3,1463.33 2250.65,1475.83 2253,1394.43 2255.35,1523.23 2257.7,1273.58 2260.05,1398.6 2262.4,1591.09 2264.75,1523.07 2267.1,1406.68 2269.45,1625.08 2271.8,1493.31 2274.15,1506.66 2276.5,1451.86 2278.85,1551.7 2281.2,1557.74 2283.55,1418.11 2285.91,1458.82 2288.26,1385.94 2290.61,1441.71 2292.96,1497.43 2295.31,1638.78 2297.66,1375.37 2300.01,1493.41 2302.36,1560.66 2304.71,1459.35 2307.06,1289.51 2309.41,1551.27 2311.76,1556.13 2314.11,1485.06 2316.46,1281.63 2318.81,1416.54 2321.16,1490.63 2323.51,1468.37 2325.86,1305.85 2328.21,1623.33 2330.56,1380.09 2332.91,1348.32 2335.27,1439.67 2337.62,1376.61 2339.97,1329.12 2342.32,1413.77 2344.67,1594.28 2347.02,1358.42 2349.37,1615.93 2351.72,1515.93 2354.07,1352.99 2356.42,1574.15 2358.77,1452.54 2361.12,1571.61 2363.47,1357.85 2365.82,1439.74 2368.17,1158.49 2370.52,1319.93 2372.87,1538.38 2375.22,1457.51 2377.57,1440.09 2379.92,1400.12 2382.27,1404.58 2384.62,1348.9 2386.98,1290.98 2389.33,1490.03 2391.68,1268.68 2394.03,1469.65 2396.38,1300.61 2398.73,1433.93 2401.08,1390.11 2403.43,1473.94 2405.78,1465.01 2408.13,1392.33 2410.48,1454.38 2412.83,1467.88 2415.18,1414.08 2417.53,1239.67 2419.88,1387.56 2422.23,1557.37 2424.58,1557.88 2426.93,1549.75 2429.28,1433.97 2431.63,1209.16 2433.98,1419.51 2436.34,1359.01 2438.69,1373.08 2441.04,1432.59 2443.39,1364.33 2445.74,1515.47 2448.09,1385.84 2450.44,1385.37 2452.79,1512.11 2455.14,1517.6 2457.49,1484.7 2459.84,1402.35 2462.19,1476.22 2464.54,1504.86 2466.89,1453.56 2469.24,1465.27 2471.59,1595.39 2473.94,1471.09 2476.29,1518.79 2478.64,1446.22 2480.99,1431.77 2483.34,1295.71 2485.7,1415.5 2488.05,1414.7 2490.4,1535.75 2492.75,1557.96 2495.1,1613.59 2497.45,1551.2 2499.8,1200.54 2502.15,1576.96 2504.5,1314.6 2506.85,1495.18 2509.2,1451.19 2511.55,1292.41 2513.9,1451.69 2516.25,1449.35 2518.6,1538.18 2520.95,1469.96 2523.3,1209.47 2525.65,1397.26 2528,1408.45 2530.35,1619.8 2532.7,1481.85 2535.06,1461.32 2537.41,1459.15 2539.76,1520.06 2542.11,1400.79 2544.46,1410.02 2546.81,1526.46 2549.16,1484.9 2551.51,1500.91 2553.86,1579.62 2556.21,1495.46 2558.56,1530.9 2560.91,1623.96 2563.26,1354.72 2565.61,1499.07 2567.96,1494.67 2570.31,1500.16 "></polyline>
<polyline clip-path="url(#clip862)" style="stroke:#e26f46; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,721.547 224.541,1012.27 226.891,905.284 229.242,1112.23 231.592,845.046 233.943,983.568 236.293,1032.49 238.644,1008.11 240.994,804.486 243.345,910.253 245.695,969.27 248.046,974.785 250.396,935.627 252.747,947.675 255.097,923.285 257.448,887.61 259.798,967.257 262.148,1011.45 264.499,917.323 266.849,1004.66 269.2,858.896 271.55,755.311 273.901,798.002 276.251,944.67 278.602,825.102 280.952,870.369 283.303,802.644 285.653,1120.07 288.004,867.713 290.354,989.868 292.705,859.694 295.055,981.645 297.406,807.794 299.756,833.15 302.107,903.993 304.457,719.37 306.807,928.739 309.158,1137.19 311.508,1016.13 313.859,893.859 316.209,673.285 318.56,967.368 320.91,929.651 323.261,933.602 325.611,840.869 327.962,881.655 330.312,967.366 332.663,1038.26 335.013,1016.44 337.364,913.313 339.714,878.344 342.065,1039.3 344.415,953.371 346.765,784.607 349.116,1052.45 351.466,974.051 353.817,984.798 356.167,707.864 358.518,1002.72 360.868,1007.52 363.219,921.002 365.569,775.454 367.92,962.453 370.27,913.214 372.621,888.477 374.971,940.165 377.322,982.22 379.672,967.666 382.023,1156.12 384.373,800.388 386.724,920.607 389.074,825.328 391.424,1128.39 393.775,1029.83 396.125,1063.61 398.476,1020.62 400.826,930.036 403.177,1017.05 405.527,849.682 407.878,1046.93 410.228,852.799 412.579,1026.35 414.929,953.817 417.28,1118.83 419.63,912.225 421.981,891.309 424.331,827.29 426.682,1014.25 429.032,840.401 431.382,846.339 433.733,924.146 436.083,921.362 438.434,746.126 440.784,803.456 443.135,816.38 445.485,810.768 447.836,883.675 450.186,993.63 452.537,1061.06 454.887,883.708 457.238,961.322 459.588,1004.95 461.939,984.08 464.289,944.408 466.64,978.378 468.99,911.771 471.341,888.985 473.691,936.367 476.041,868.688 478.392,846.332 480.742,966.721 483.093,931.101 485.443,905.434 487.794,840.914 490.144,777.158 492.495,1083.72 494.845,890.865 497.196,866.991 499.546,846.884 501.897,872.62 504.247,884.314 506.598,981.858 508.948,986.444 511.299,929.663 513.649,1068.3 515.999,1246.05 518.35,898.467 520.7,806.127 523.051,936.005 525.401,892.296 527.752,696.236 530.102,971.014 532.453,945.041 534.803,867.013 537.154,923.385 539.504,847.165 541.855,1047.17 544.205,940.484 546.556,857.576 548.906,1189.23 551.257,885.213 553.607,997.473 555.958,850.488 558.308,919.633 560.658,1187.98 563.009,943.118 565.359,1002.39 567.71,1087.16 570.06,981.168 572.411,960.061 574.761,869.731 577.112,905.845 579.462,853.642 581.813,974.059 584.163,973.418 586.514,957.358 588.864,817.792 591.215,1032.53 593.565,877.284 595.916,1071.22 598.266,966.218 600.616,937.828 602.967,884.148 605.317,920.828 607.668,1114.58 610.018,1108.37 612.369,818.792 614.719,718.413 617.07,850.693 619.42,818.781 621.771,874.586 624.121,910.748 626.472,947.092 628.822,945.346 631.173,938.487 633.523,936.962 635.874,799.47 638.224,967.115 640.575,1090.65 642.925,948.322 645.275,968.704 647.626,989.494 649.976,997.791 652.327,1089.08 654.677,956.796 657.028,1101.61 659.378,1182.68 661.729,874.676 664.079,1006.4 666.43,1035.25 668.78,886.591 671.131,977.737 673.481,946.814 675.832,1060.04 678.182,921.971 680.533,831.611 682.883,870.462 685.233,928.578 687.584,876.262 689.934,983.999 692.285,976.933 694.635,1139.68 696.986,885.467 699.336,1000.8 701.687,1045.24 704.037,1126.15 706.388,892.897 708.738,932.717 711.089,733.185 713.439,813.993 715.79,764.757 718.14,1030.5 720.491,1035.35 722.841,745.898 725.192,958.289 727.542,1017.62 729.892,1069.97 732.243,1040.7 734.593,1157.72 736.944,891.522 739.294,972.019 741.645,781.333 743.995,989.076 746.346,978.308 748.696,935.066 751.047,847.141 753.397,807.22 755.748,920.651 758.098,788.001 760.449,956.701 762.799,1066.39 765.15,942.128 767.5,947.959 769.85,774.672 772.201,1028.9 774.551,1006.24 776.902,1140.25 779.252,952.448 781.603,1168.84 783.953,984.271 786.304,977.406 788.654,1013.46 791.005,1222.26 793.355,951.399 795.706,796.711 798.056,930.888 800.407,910.548 802.757,960.226 805.108,958.404 807.458,802.997 809.809,931.625 812.159,890.879 814.509,820.479 816.86,1065 819.21,983.197 821.561,937.302 823.911,762.911 826.262,1045.94 828.612,960.912 830.963,1093.57 833.313,782.14 835.664,953.558 838.014,922.248 840.365,923.521 842.715,878.653 845.066,845.692 847.416,1001.72 849.767,820.51 852.117,930.01 854.467,975.06 856.818,1059.29 859.168,940.762 861.519,821.034 863.869,733.092 866.22,924.91 868.57,942.67 870.921,1082.83 873.271,1033.67 875.622,937.214 877.972,864.785 880.323,897.821 882.673,1076.68 885.024,950.877 887.374,1025.79 889.725,1023.35 892.075,1016.64 894.426,1215.58 896.776,832.253 899.126,807.849 901.477,860.955 903.827,732.562 906.178,921.183 908.528,910.149 910.879,863.872 913.229,830.971 915.58,942.566 917.93,1031.8 920.281,1001.48 922.631,1050.18 924.982,776.536 927.332,821.814 929.683,940.929 932.033,921.514 934.384,834.46 936.734,784.127 939.084,945.372 941.435,954.045 943.785,987.661 946.136,1010.82 948.486,854.974 950.837,1009.97 953.187,722.635 955.538,870.066 957.888,849.714 960.239,827.79 962.589,916.459 964.94,1100.48 967.29,1107.52 969.641,855.385 971.991,667.015 974.342,685.232 976.692,927.247 979.043,1023.46 981.393,995.932 983.743,905.665 986.094,853.462 988.444,926.652 990.795,1031.86 993.145,805.13 995.496,1125.55 997.846,910.653 1000.2,878.954 1002.55,1062.24 1004.9,922.832 1007.25,1029.27 1009.6,909.706 1011.95,824.779 1014.3,1006.06 1016.65,1020.01 1019,826.335 1021.35,796.094 1023.7,1126.5 1026.05,883.649 1028.4,780.165 1030.75,1069.18 1033.1,887.523 1035.45,993.658 1037.8,1077.17 1040.15,911.128 1042.51,1103.93 1044.86,847.986 1047.21,935.893 1049.56,920.633 1051.91,907.238 1054.26,968.766 1056.61,949.897 1058.96,828.45 1061.31,818.306 1063.66,933.941 1066.01,961.391 1068.36,895.683 1070.71,857.456 1073.06,883.642 1075.41,954.624 1077.76,806.156 1080.11,819.049 1082.46,958.28 1084.81,960.016 1087.16,845.67 1089.51,877.203 1091.87,1020.57 1094.22,987.445 1096.57,1048.79 1098.92,1037.19 1101.27,977.202 1103.62,729.604 1105.97,902.355 1108.32,774.078 1110.67,854.176 1113.02,937.175 1115.37,889.202 1117.72,1018.88 1120.07,804.678 1122.42,1028.29 1124.77,1046.81 1127.12,791.246 1129.47,865.876 1131.82,887.256 1134.17,854.349 1136.52,831.292 1138.87,1031.82 1141.23,1066.17 1143.58,846.72 1145.93,831.563 1148.28,838.938 1150.63,981.951 1152.98,866.351 1155.33,994.852 1157.68,897.866 1160.03,1043.53 1162.38,913.298 1164.73,993.911 1167.08,1061.52 1169.43,1064.25 1171.78,852.913 1174.13,911.013 1176.48,627.635 1178.83,746.109 1181.18,872.452 1183.53,879.173 1185.88,1018 1188.23,964.949 1190.59,811.655 1192.94,1061.32 1195.29,1054.84 1197.64,941.398 1199.99,938.595 1202.34,1011.29 1204.69,857.015 1207.04,968.295 1209.39,870.638 1211.74,944.919 1214.09,1093.97 1216.44,1078.35 1218.79,829.629 1221.14,1040.18 1223.49,752.472 1225.84,819.363 1228.19,978.887 1230.54,791.545 1232.89,1142.32 1235.24,900.204 1237.59,1015.63 1239.94,972.558 1242.3,1069.96 1244.65,1002.4 1247,884.685 1249.35,865.566 1251.7,902.728 1254.05,875.695 1256.4,1016.33 1258.75,983.57 1261.1,807.237 1263.45,968.11 1265.8,1071.88 1268.15,897.961 1270.5,857.653 1272.85,861.998 1275.2,980.331 1277.55,976.658 1279.9,874.112 1282.25,889.197 1284.6,852.71 1286.95,799.277 1289.3,892.37 1291.66,864.512 1294.01,1026.93 1296.36,881.582 1298.71,992.71 1301.06,863.731 1303.41,903.391 1305.76,974.759 1308.11,963.713 1310.46,906.985 1312.81,901.93 1315.16,838.104 1317.51,753.084 1319.86,906.975 1322.21,990.421 1324.56,991.518 1326.91,826.645 1329.26,905.794 1331.61,924.017 1333.96,993.626 1336.31,776.692 1338.66,935.542 1341.02,1020.89 1343.37,1077.99 1345.72,1070.32 1348.07,858.549 1350.42,878.261 1352.77,924.559 1355.12,539.304 1357.47,1039.38 1359.82,893.399 1362.17,668.554 1364.52,981.028 1366.87,1055.8 1369.22,1050.48 1371.57,875.483 1373.92,980.377 1376.27,987.667 1378.62,964.909 1380.97,876.948 1383.32,1028.48 1385.67,921.775 1388.02,778.035 1390.38,885.772 1392.73,923.589 1395.08,922.591 1397.43,867.087 1399.78,890.759 1402.13,892.217 1404.48,925.002 1406.83,1003.93 1409.18,1056.86 1411.53,1029.04 1413.88,1034.73 1416.23,1141.13 1418.58,1030.47 1420.93,1006.71 1423.28,1048.53 1425.63,966.278 1427.98,1088.45 1430.33,903.923 1432.68,940.745 1435.03,998.491 1437.38,927.549 1439.74,854.098 1442.09,888.536 1444.44,999.594 1446.79,908.611 1449.14,831.379 1451.49,789.854 1453.84,983.612 1456.19,920.843 1458.54,789.824 1460.89,865.266 1463.24,853.959 1465.59,1029.63 1467.94,810.241 1470.29,953.858 1472.64,927.517 1474.99,835.287 1477.34,1024.77 1479.69,882.805 1482.04,955.464 1484.39,997.808 1486.74,888.913 1489.1,921.283 1491.45,665.186 1493.8,910.628 1496.15,986.303 1498.5,779.687 1500.85,1042.5 1503.2,851.993 1505.55,938.841 1507.9,929.029 1510.25,986.107 1512.6,1051.22 1514.95,1090.18 1517.3,716.602 1519.65,1010.95 1522,930.187 1524.35,967.558 1526.7,833.057 1529.05,1102.22 1531.4,867.918 1533.75,837.471 1536.1,966.692 1538.45,1002.19 1540.81,1127.9 1543.16,847.218 1545.51,833.331 1547.86,948.074 1550.21,872.74 1552.56,1072.22 1554.91,1021.58 1557.26,1070.9 1559.61,1014.67 1561.96,952.575 1564.31,860.001 1566.66,988.129 1569.01,990.562 1571.36,1015.69 1573.71,896.377 1576.06,1162.01 1578.41,888.762 1580.76,847.344 1583.11,931.572 1585.46,983.736 1587.81,847.916 1590.17,838.2 1592.52,1073.88 1594.87,1021.79 1597.22,877.596 1599.57,920.292 1601.92,920.666 1604.27,886.275 1606.62,843.207 1608.97,970.912 1611.32,1010.37 1613.67,1004.48 1616.02,1091.99 1618.37,1024.18 1620.72,912.529 1623.07,821.581 1625.42,1026.9 1627.77,1032.36 1630.12,893.474 1632.47,902.837 1634.82,1026.35 1637.17,914.744 1639.53,1030.2 1641.88,948.335 1644.23,1048.8 1646.58,870.829 1648.93,769.271 1651.28,918.718 1653.63,1018.81 1655.98,904.879 1658.33,860.295 1660.68,868.906 1663.03,850.609 1665.38,990.99 1667.73,1018.29 1670.08,1016.25 1672.43,843.709 1674.78,1131.23 1677.13,994.307 1679.48,1032.01 1681.83,941.447 1684.18,1032.71 1686.53,804.4 1688.89,1041.38 1691.24,989.713 1693.59,904.127 1695.94,1016.11 1698.29,1036.1 1700.64,822.908 1702.99,877.427 1705.34,941.369 1707.69,704.285 1710.04,953.117 1712.39,791.04 1714.74,954.884 1717.09,1013.6 1719.44,965.959 1721.79,911.104 1724.14,820.21 1726.49,930.728 1728.84,1094.87 1731.19,852.848 1733.54,906.697 1735.89,857.085 1738.25,992.329 1740.6,812.094 1742.95,954.217 1745.3,902.496 1747.65,948.148 1750,1067.61 1752.35,901 1754.7,775.796 1757.05,1016.2 1759.4,679.44 1761.75,796.487 1764.1,839.372 1766.45,702.899 1768.8,767.586 1771.15,906.045 1773.5,780.158 1775.85,968.564 1778.2,987.484 1780.55,911.318 1782.9,928.696 1785.25,884.668 1787.6,944.648 1789.96,869.085 1792.31,852.175 1794.66,828.406 1797.01,945.438 1799.36,865.354 1801.71,1095.39 1804.06,880.52 1806.41,895.333 1808.76,972.558 1811.11,881.63 1813.46,965.644 1815.81,1026.34 1818.16,1059.77 1820.51,909.556 1822.86,969.225 1825.21,911.334 1827.56,1029.45 1829.91,1039.42 1832.26,905.086 1834.61,981.229 1836.96,990.673 1839.32,798.948 1841.67,860.365 1844.02,1050.23 1846.37,1026.73 1848.72,884.687 1851.07,949.443 1853.42,1040.85 1855.77,984.811 1858.12,1251.4 1860.47,742.943 1862.82,1101.14 1865.17,1143.87 1867.52,875.285 1869.87,881.077 1872.22,893.03 1874.57,1009.95 1876.92,751.541 1879.27,1090.59 1881.62,801.819 1883.97,998.547 1886.32,891.697 1888.68,760.186 1891.03,828.979 1893.38,867.837 1895.73,1017.81 1898.08,966.988 1900.43,1038.99 1902.78,1101.83 1905.13,1125.1 1907.48,908.845 1909.83,1059.91 1912.18,1023.84 1914.53,950.412 1916.88,827.969 1919.23,948.695 1921.58,938.434 1923.93,913.376 1926.28,824.106 1928.63,997.808 1930.98,987.613 1933.33,872.349 1935.68,969.089 1938.04,959.475 1940.39,1046.52 1942.74,911.245 1945.09,862.415 1947.44,903.382 1949.79,929.447 1952.14,996.836 1954.49,865.205 1956.84,850.908 1959.19,1046.03 1961.54,894.738 1963.89,961.115 1966.24,1081.92 1968.59,972.791 1970.94,887.409 1973.29,705.857 1975.64,826.441 1977.99,974.832 1980.34,798.866 1982.69,859.468 1985.04,951.218 1987.4,964.497 1989.75,1033.56 1992.1,718.358 1994.45,823.712 1996.8,747.476 1999.15,1028.46 2001.5,980.044 2003.85,1056.91 2006.2,827.319 2008.55,809.672 2010.9,1009.98 2013.25,1020.99 2015.6,758.229 2017.95,933.67 2020.3,1129.64 2022.65,683.573 2025,1130.92 2027.35,996.982 2029.7,881.828 2032.05,1194.68 2034.4,886.268 2036.76,1055.08 2039.11,1150.74 2041.46,1019.61 2043.81,951.22 2046.16,888.602 2048.51,1132.4 2050.86,985.794 2053.21,1080.4 2055.56,934.971 2057.91,886.639 2060.26,958.928 2062.61,764.888 2064.96,923.809 2067.31,891.243 2069.66,1060.97 2072.01,1022.38 2074.36,1038.72 2076.71,936.83 2079.06,665.274 2081.41,1052.84 2083.76,1028.63 2086.11,753.915 2088.47,941.749 2090.82,1018.38 2093.17,1082.95 2095.52,850.112 2097.87,1002.36 2100.22,1072.83 2102.57,1067.2 2104.92,1126.41 2107.27,955.815 2109.62,1012.25 2111.97,800.119 2114.32,968.562 2116.67,802.541 2119.02,719.883 2121.37,967.85 2123.72,829.819 2126.07,1036.33 2128.42,871.964 2130.77,1014.64 2133.12,763.939 2135.47,893.807 2137.83,976.051 2140.18,1089.61 2142.53,836.82 2144.88,1047.2 2147.23,864.915 2149.58,799.369 2151.93,874.427 2154.28,990.005 2156.63,899.86 2158.98,976.93 2161.33,1075.26 2163.68,984.412 2166.03,815.99 2168.38,967.404 2170.73,787.069 2173.08,688.828 2175.43,1125.74 2177.78,965.164 2180.13,954.883 2182.48,893.253 2184.83,1035.29 2187.19,930.798 2189.54,871.424 2191.89,889.996 2194.24,958.865 2196.59,942.925 2198.94,973.01 2201.29,962.974 2203.64,889.76 2205.99,894.23 2208.34,916.135 2210.69,901.761 2213.04,896.042 2215.39,737.219 2217.74,974.927 2220.09,930.49 2222.44,1294.45 2224.79,738.248 2227.14,886.117 2229.49,985.559 2231.84,871.312 2234.19,880.988 2236.55,880.48 2238.9,977.909 2241.25,992.771 2243.6,1054.5 2245.95,1028.47 2248.3,1027.34 2250.65,869.685 2253,816.005 2255.35,1033.02 2257.7,889.49 2260.05,1012.2 2262.4,944.232 2264.75,971.774 2267.1,712.882 2269.45,974.636 2271.8,789.533 2274.15,836.807 2276.5,928.899 2278.85,938.556 2281.2,837.492 2283.55,745.247 2285.91,839.296 2288.26,1146.06 2290.61,983.84 2292.96,1020.04 2295.31,791.502 2297.66,746.851 2300.01,978.739 2302.36,1029.6 2304.71,1094.26 2307.06,1179.88 2309.41,939.503 2311.76,933.931 2314.11,871.147 2316.46,851.413 2318.81,1207.67 2321.16,901.418 2323.51,835.062 2325.86,938.725 2328.21,1033.82 2330.56,950.854 2332.91,1046.81 2335.27,858.683 2337.62,994.166 2339.97,922.134 2342.32,994.012 2344.67,800.283 2347.02,981.627 2349.37,943.782 2351.72,913.573 2354.07,877.057 2356.42,1035.32 2358.77,863.649 2361.12,956.146 2363.47,992.343 2365.82,899.111 2368.17,1024.23 2370.52,794.485 2372.87,897.484 2375.22,795.234 2377.57,1078.64 2379.92,954.082 2382.27,857.657 2384.62,854.575 2386.98,1145.83 2389.33,1056.65 2391.68,1041.69 2394.03,833.99 2396.38,905.69 2398.73,862.523 2401.08,863.519 2403.43,979.065 2405.78,994.967 2408.13,993.889 2410.48,863.21 2412.83,865.133 2415.18,976.416 2417.53,880.543 2419.88,912.48 2422.23,1039.71 2424.58,673.703 2426.93,808.582 2429.28,850.984 2431.63,743.923 2433.98,828.79 2436.34,1086.16 2438.69,731.647 2441.04,994.535 2443.39,848.328 2445.74,816.286 2448.09,961.763 2450.44,908.906 2452.79,951.712 2455.14,1002.95 2457.49,966.358 2459.84,1036.49 2462.19,984.61 2464.54,808.54 2466.89,1069.14 2469.24,1087.29 2471.59,940.908 2473.94,716.091 2476.29,862.182 2478.64,849.625 2480.99,904.742 2483.34,903.504 2485.7,740.167 2488.05,896.221 2490.4,946.642 2492.75,1039.48 2495.1,958.932 2497.45,728.694 2499.8,899.355 2502.15,1007.68 2504.5,976.307 2506.85,981.447 2509.2,807.398 2511.55,977.998 2513.9,1039.86 2516.25,837.099 2518.6,991.732 2520.95,1038.52 2523.3,936.58 2525.65,993.084 2528,1034.82 2530.35,748.942 2532.7,1173.75 2535.06,925.74 2537.41,1002.73 2539.76,1001.1 2542.11,911.487 2544.46,951.662 2546.81,887.279 2549.16,861.777 2551.51,754.038 2553.86,979.768 2556.21,1129.27 2558.56,984.512 2560.91,929.204 2563.26,893.914 2565.61,751.948 2567.96,936.922 2570.31,779.919 "></polyline>
<polyline clip-path="url(#clip862)" style="stroke:#3da44d; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,684.234 224.541,568.399 226.891,282.482 229.242,394.904 231.592,452.028 233.943,318.778 236.293,313.458 238.644,504.649 240.994,465.074 243.345,410.251 245.695,516.76 248.046,253.327 250.396,408.462 252.747,252.758 255.097,458.362 257.448,500.517 259.798,571.571 262.148,427.822 264.499,246.607 266.849,484.179 269.2,628.216 271.55,523.048 273.901,351.144 276.251,555.189 278.602,237.77 280.952,446.11 283.303,317.87 285.653,410.855 288.004,311.337 290.354,290.436 292.705,585.851 295.055,269.771 297.406,423.978 299.756,434.596 302.107,437.533 304.457,340.849 306.807,412.778 309.158,508.478 311.508,445.571 313.859,452.856 316.209,350.794 318.56,464.476 320.91,315.826 323.261,482.215 325.611,429.207 327.962,386.569 330.312,317.786 332.663,460.135 335.013,400.895 337.364,552.968 339.714,418.863 342.065,412.14 344.415,419.198 346.765,374.49 349.116,308.763 351.466,190.998 353.817,438.352 356.167,477.445 358.518,357.669 360.868,552.384 363.219,262.295 365.569,428.294 367.92,331.465 370.27,309.167 372.621,462.121 374.971,568.641 377.322,443.649 379.672,556.804 382.023,303.844 384.373,473.837 386.724,320.502 389.074,448.396 391.424,434.268 393.775,368.651 396.125,428.028 398.476,407.448 400.826,469.257 403.177,487.68 405.527,275.261 407.878,496.548 410.228,307.869 412.579,415.745 414.929,275.715 417.28,394.513 419.63,547.233 421.981,583.4 424.331,511.902 426.682,303.675 429.032,497.639 431.382,568.669 433.733,426.554 436.083,366.032 438.434,421.189 440.784,354.465 443.135,295.571 445.485,311.226 447.836,473.241 450.186,536.037 452.537,509.969 454.887,480.131 457.238,351.572 459.588,346.807 461.939,315.796 464.289,515.799 466.64,501.514 468.99,407.3 471.341,377.551 473.691,423.296 476.041,453.261 478.392,362.939 480.742,367.112 483.093,419.635 485.443,417.902 487.794,584.605 490.144,310.357 492.495,347.068 494.845,341.017 497.196,370.995 499.546,348.441 501.897,290.981 504.247,454.111 506.598,439.781 508.948,148.731 511.299,333.588 513.649,456.993 515.999,445.657 518.35,318.314 520.7,568.379 523.051,228.515 525.401,479.091 527.752,245.459 530.102,302.581 532.453,364.542 534.803,284.353 537.154,210.16 539.504,475.751 541.855,595.576 544.205,377.638 546.556,361.151 548.906,461.715 551.257,580.279 553.607,560.41 555.958,424.432 558.308,294.928 560.658,440.465 563.009,599.41 565.359,383.225 567.71,471.186 570.06,359.009 572.411,434.511 574.761,377.873 577.112,474.512 579.462,538.211 581.813,392.998 584.163,512.71 586.514,365.504 588.864,485.096 591.215,401.773 593.565,348.821 595.916,321.625 598.266,375.784 600.616,366.179 602.967,430.357 605.317,471.415 607.668,506.813 610.018,291.064 612.369,379.864 614.719,190.037 617.07,420.919 619.42,431.022 621.771,350.393 624.121,202.607 626.472,521.842 628.822,410.566 631.173,509.333 633.523,254.429 635.874,378.206 638.224,424.488 640.575,374.556 642.925,340.154 645.275,370.559 647.626,566.806 649.976,573.238 652.327,420.55 654.677,257.143 657.028,419.478 659.378,433.539 661.729,461.873 664.079,434.252 666.43,441.371 668.78,563.801 671.131,414.414 673.481,297.965 675.832,358.334 678.182,429.445 680.533,322.729 682.883,294.82 685.233,484.351 687.584,593.765 689.934,521.327 692.285,399.036 694.635,362.012 696.986,342.972 699.336,399.697 701.687,132.31 704.037,338.455 706.388,546.585 708.738,142.294 711.089,375.82 713.439,291.392 715.79,570.926 718.14,433.345 720.491,471.496 722.841,431.896 725.192,541.056 727.542,446.913 729.892,283.544 732.243,509.146 734.593,507.698 736.944,463.419 739.294,484.245 741.645,448.765 743.995,544.946 746.346,444.067 748.696,361.424 751.047,477.701 753.397,297.738 755.748,443.613 758.098,316.068 760.449,334.295 762.799,404.129 765.15,329.906 767.5,518.06 769.85,439.719 772.201,424.477 774.551,579.892 776.902,184.805 779.252,560.407 781.603,205.383 783.953,351.01 786.304,486.067 788.654,523.491 791.005,295.542 793.355,435.108 795.706,354.617 798.056,457.47 800.407,591.098 802.757,260.607 805.108,238.88 807.458,410.072 809.809,301.935 812.159,460.545 814.509,465.713 816.86,601.315 819.21,446.254 821.561,430.51 823.911,484.223 826.262,583.097 828.612,222.383 830.963,543.552 833.313,305.566 835.664,550.886 838.014,428.259 840.365,613.342 842.715,531.272 845.066,548.108 847.416,321.743 849.767,343.784 852.117,471.979 854.467,541.944 856.818,489.909 859.168,333.574 861.519,385.036 863.869,415.172 866.22,579.662 868.57,433.851 870.921,249.794 873.271,537.457 875.622,658.015 877.972,367.22 880.323,450.087 882.673,285.399 885.024,368.427 887.374,452.138 889.725,286.845 892.075,646.021 894.426,506.012 896.776,404.471 899.126,353.425 901.477,309.673 903.827,581.342 906.178,437.513 908.528,228.853 910.879,369.794 913.229,460.644 915.58,457.636 917.93,422.763 920.281,488.443 922.631,465.769 924.982,309.47 927.332,466.118 929.683,553.772 932.033,265.562 934.384,521.937 936.734,550.594 939.084,491.352 941.435,394.758 943.785,397.01 946.136,346.99 948.486,366.645 950.837,274.753 953.187,521.656 955.538,462.474 957.888,477.542 960.239,436.25 962.589,557.153 964.94,533.422 967.29,377.331 969.641,221.891 971.991,359.194 974.342,314.552 976.692,635.997 979.043,484.677 981.393,395.195 983.743,354.004 986.094,449.899 988.444,236.328 990.795,336.504 993.145,276.836 995.496,447.065 997.846,309.839 1000.2,464.796 1002.55,491.547 1004.9,263.881 1007.25,476.605 1009.6,382.735 1011.95,418.376 1014.3,413.365 1016.65,332.906 1019,440.116 1021.35,345.135 1023.7,382.155 1026.05,414.89 1028.4,440.91 1030.75,329.506 1033.1,437.445 1035.45,356.212 1037.8,399.892 1040.15,142.585 1042.51,698.169 1044.86,385.206 1047.21,480.101 1049.56,411.227 1051.91,440.678 1054.26,428.396 1056.61,497.171 1058.96,413.541 1061.31,465.912 1063.66,421.471 1066.01,485.399 1068.36,693.509 1070.71,468.689 1073.06,403.48 1075.41,351.663 1077.76,409.167 1080.11,302.696 1082.46,600.184 1084.81,407.963 1087.16,321.051 1089.51,379.086 1091.87,556.75 1094.22,383.947 1096.57,552.547 1098.92,438.923 1101.27,450.502 1103.62,388.703 1105.97,549.486 1108.32,360.427 1110.67,481.061 1113.02,100.187 1115.37,554.315 1117.72,376.397 1120.07,540.207 1122.42,467.064 1124.77,498.882 1127.12,329.039 1129.47,647.54 1131.82,510.809 1134.17,374.968 1136.52,372.503 1138.87,288.237 1141.23,459.932 1143.58,369.397 1145.93,280.538 1148.28,450.536 1150.63,359.938 1152.98,328.581 1155.33,366.74 1157.68,487.516 1160.03,465.671 1162.38,452.414 1164.73,468.155 1167.08,294.515 1169.43,442.478 1171.78,372.419 1174.13,408.399 1176.48,263.109 1178.83,357.4 1181.18,471.035 1183.53,452.472 1185.88,481.061 1188.23,433.389 1190.59,450.019 1192.94,290.71 1195.29,698.265 1197.64,255.142 1199.99,525.729 1202.34,413.63 1204.69,512.565 1207.04,418.134 1209.39,444.939 1211.74,295.81 1214.09,346.253 1216.44,441.182 1218.79,429.883 1221.14,426.201 1223.49,488.141 1225.84,354.581 1228.19,350.506 1230.54,595.42 1232.89,477.844 1235.24,545.345 1237.59,330.861 1239.94,594.446 1242.3,431.885 1244.65,452.094 1247,211.192 1249.35,601.047 1251.7,324.494 1254.05,667.476 1256.4,523.24 1258.75,390.557 1261.1,560.775 1263.45,316.59 1265.8,491.933 1268.15,400.847 1270.5,409.367 1272.85,426.717 1275.2,648.829 1277.55,315.281 1279.9,540.304 1282.25,497.021 1284.6,292.995 1286.95,502.746 1289.3,189.382 1291.66,339.854 1294.01,188.731 1296.36,334.384 1298.71,516.337 1301.06,525.503 1303.41,499.08 1305.76,291.976 1308.11,390.809 1310.46,490.097 1312.81,449.672 1315.16,435.304 1317.51,248.503 1319.86,436.569 1322.21,325.314 1324.56,374.221 1326.91,338.793 1329.26,608.49 1331.61,415.118 1333.96,607.542 1336.31,461.422 1338.66,298.988 1341.02,425.396 1343.37,290.168 1345.72,470.182 1348.07,337.671 1350.42,516.047 1352.77,499.993 1355.12,267.971 1357.47,400.132 1359.82,327.533 1362.17,360.284 1364.52,594.979 1366.87,390.21 1369.22,395.589 1371.57,505.378 1373.92,387.957 1376.27,365.042 1378.62,515.421 1380.97,315.629 1383.32,192.928 1385.67,493.156 1388.02,373.783 1390.38,339.186 1392.73,278.725 1395.08,534.837 1397.43,273.046 1399.78,464.987 1402.13,438.005 1404.48,352.752 1406.83,460.886 1409.18,534.746 1411.53,441.578 1413.88,456.524 1416.23,423.066 1418.58,581.258 1420.93,352.49 1423.28,445.09 1425.63,259.961 1427.98,354.089 1430.33,363.793 1432.68,457.19 1435.03,462.981 1437.38,493.586 1439.74,363.402 1442.09,296.971 1444.44,535.036 1446.79,402.768 1449.14,342.96 1451.49,421.749 1453.84,270.048 1456.19,379.258 1458.54,511.672 1460.89,341.394 1463.24,546.692 1465.59,420.11 1467.94,576.915 1470.29,319.031 1472.64,373.903 1474.99,478.523 1477.34,452.967 1479.69,338.444 1482.04,438.232 1484.39,444.05 1486.74,430.113 1489.1,399.075 1491.45,276.347 1493.8,417.397 1496.15,175.066 1498.5,451.637 1500.85,382.295 1503.2,588.651 1505.55,234.914 1507.9,303.379 1510.25,615.656 1512.6,397.258 1514.95,338.756 1517.3,311.55 1519.65,417.695 1522,398.768 1524.35,332.666 1526.7,151.218 1529.05,480.142 1531.4,360.212 1533.75,339.346 1536.1,248.768 1538.45,404.297 1540.81,408.122 1543.16,367.92 1545.51,418.831 1547.86,504.92 1550.21,281.728 1552.56,418.802 1554.91,458.445 1557.26,587.101 1559.61,491.12 1561.96,582.939 1564.31,551.616 1566.66,333.907 1569.01,453.482 1571.36,465.412 1573.71,157.697 1576.06,340.324 1578.41,532.214 1580.76,309.903 1583.11,513.482 1585.46,364.387 1587.81,413.789 1590.17,424.621 1592.52,494.911 1594.87,334.13 1597.22,398.091 1599.57,424.902 1601.92,295.073 1604.27,360.066 1606.62,315.077 1608.97,534.586 1611.32,443.09 1613.67,255.033 1616.02,281.085 1618.37,261.625 1620.72,468.453 1623.07,448.491 1625.42,466.868 1627.77,334.965 1630.12,439.934 1632.47,304.226 1634.82,414.748 1637.17,581.652 1639.53,543.875 1641.88,398.456 1644.23,561.108 1646.58,445.419 1648.93,324.477 1651.28,433.117 1653.63,239.61 1655.98,263.554 1658.33,318.53 1660.68,512.395 1663.03,522.95 1665.38,374.945 1667.73,388.304 1670.08,377.473 1672.43,508.058 1674.78,430.16 1677.13,517.11 1679.48,538.804 1681.83,410.303 1684.18,348.169 1686.53,336.184 1688.89,492.264 1691.24,234.619 1693.59,493.366 1695.94,350.44 1698.29,438.812 1700.64,516.697 1702.99,419.664 1705.34,244.76 1707.69,485.39 1710.04,408.011 1712.39,342.681 1714.74,431.698 1717.09,476.957 1719.44,611.611 1721.79,357.957 1724.14,458.378 1726.49,270.164 1728.84,429.022 1731.19,533.46 1733.54,317.685 1735.89,320.957 1738.25,720.097 1740.6,391.358 1742.95,337.073 1745.3,333.583 1747.65,465.548 1750,387.465 1752.35,464.661 1754.7,597.609 1757.05,230.434 1759.4,550.536 1761.75,452.349 1764.1,400.089 1766.45,262.499 1768.8,434.185 1771.15,393.289 1773.5,96.8724 1775.85,570.18 1778.2,296.844 1780.55,474.451 1782.9,313.308 1785.25,606.502 1787.6,317.98 1789.96,494.545 1792.31,541.357 1794.66,403.408 1797.01,421.273 1799.36,392.652 1801.71,308.929 1804.06,514.847 1806.41,465.153 1808.76,368.705 1811.11,527.135 1813.46,454.263 1815.81,471.519 1818.16,460.069 1820.51,248.546 1822.86,427.463 1825.21,366.253 1827.56,476.145 1829.91,463.125 1832.26,499.211 1834.61,590.36 1836.96,390.389 1839.32,300.322 1841.67,479.94 1844.02,482.23 1846.37,456.845 1848.72,433.687 1851.07,564.716 1853.42,397.621 1855.77,339.482 1858.12,353.57 1860.47,399.427 1862.82,458.108 1865.17,412.214 1867.52,505.902 1869.87,570.342 1872.22,550.005 1874.57,406.025 1876.92,522.709 1879.27,532.54 1881.62,425.888 1883.97,416.247 1886.32,365.05 1888.68,463.096 1891.03,320.044 1893.38,222.16 1895.73,257.43 1898.08,532.338 1900.43,382.268 1902.78,227.861 1905.13,493.073 1907.48,535.447 1909.83,259.757 1912.18,403.111 1914.53,542.82 1916.88,369.484 1919.23,478.197 1921.58,318.558 1923.93,439.435 1926.28,328.321 1928.63,412.767 1930.98,430.762 1933.33,511.688 1935.68,272.915 1938.04,333.453 1940.39,338.411 1942.74,428.685 1945.09,396.741 1947.44,368.56 1949.79,384.653 1952.14,297.017 1954.49,381.831 1956.84,556.977 1959.19,279.498 1961.54,412.208 1963.89,409.505 1966.24,468.722 1968.59,268.699 1970.94,441.077 1973.29,244.774 1975.64,321.105 1977.99,477.773 1980.34,386.662 1982.69,274.007 1985.04,294.761 1987.4,285.538 1989.75,379.311 1992.1,495.781 1994.45,581.824 1996.8,488.335 1999.15,492.8 2001.5,515.864 2003.85,662.379 2006.2,460.441 2008.55,394.796 2010.9,267.141 2013.25,452.931 2015.6,548.941 2017.95,542.91 2020.3,369.384 2022.65,137.188 2025,513.41 2027.35,340.186 2029.7,544.712 2032.05,521.788 2034.4,402.201 2036.76,339.273 2039.11,467.208 2041.46,429.892 2043.81,262.375 2046.16,414.622 2048.51,540.28 2050.86,571.399 2053.21,285.985 2055.56,362.699 2057.91,536.987 2060.26,328.702 2062.61,488.344 2064.96,419.674 2067.31,599.383 2069.66,318.945 2072.01,459.033 2074.36,665.33 2076.71,457.83 2079.06,239.502 2081.41,454.169 2083.76,399.864 2086.11,430.632 2088.47,434.219 2090.82,487.452 2093.17,543.4 2095.52,577.669 2097.87,476.739 2100.22,373.706 2102.57,488.779 2104.92,402.439 2107.27,520.329 2109.62,268.511 2111.97,362.672 2114.32,446.527 2116.67,175.426 2119.02,551.626 2121.37,515.296 2123.72,326.478 2126.07,323.864 2128.42,404.958 2130.77,382.707 2133.12,362.554 2135.47,626.058 2137.83,436.649 2140.18,360.909 2142.53,445.553 2144.88,292.987 2147.23,604.433 2149.58,251.438 2151.93,343.488 2154.28,381.165 2156.63,446.815 2158.98,336.203 2161.33,395.587 2163.68,532.878 2166.03,273.882 2168.38,667.482 2170.73,262.222 2173.08,328.004 2175.43,480.429 2177.78,430.375 2180.13,392.661 2182.48,309.914 2184.83,450.775 2187.19,305.621 2189.54,365.053 2191.89,295.842 2194.24,307.035 2196.59,361.844 2198.94,432.183 2201.29,400.659 2203.64,440.42 2205.99,724.504 2208.34,490.12 2210.69,447.267 2213.04,336.539 2215.39,362.238 2217.74,403.547 2220.09,365.829 2222.44,336.537 2224.79,508.759 2227.14,337.035 2229.49,465.57 2231.84,528.866 2234.19,397.726 2236.55,410.035 2238.9,588.596 2241.25,306.421 2243.6,534.204 2245.95,330.15 2248.3,480.223 2250.65,301.996 2253,505.562 2255.35,472.492 2257.7,545.439 2260.05,282.243 2262.4,548.291 2264.75,528.38 2267.1,480.232 2269.45,236.421 2271.8,315.252 2274.15,256.533 2276.5,591.305 2278.85,450.21 2281.2,265.209 2283.55,349.841 2285.91,394.52 2288.26,466.584 2290.61,449.716 2292.96,365.888 2295.31,308.545 2297.66,378.293 2300.01,376.401 2302.36,321.12 2304.71,301.281 2307.06,490.43 2309.41,483.662 2311.76,275.37 2314.11,277.126 2316.46,260.808 2318.81,404.193 2321.16,450.471 2323.51,320.327 2325.86,323.846 2328.21,451.407 2330.56,237.23 2332.91,583.392 2335.27,346.434 2337.62,500.079 2339.97,504.021 2342.32,286.293 2344.67,494.639 2347.02,438.743 2349.37,425.875 2351.72,547.291 2354.07,243.475 2356.42,321.382 2358.77,329.512 2361.12,366.384 2363.47,301.995 2365.82,467.371 2368.17,424.114 2370.52,350.443 2372.87,460.778 2375.22,322.688 2377.57,384.428 2379.92,412.219 2382.27,447.172 2384.62,538.489 2386.98,520.314 2389.33,307.208 2391.68,205.517 2394.03,564.348 2396.38,371.806 2398.73,587.432 2401.08,304.89 2403.43,551.786 2405.78,306.499 2408.13,435.34 2410.48,270.676 2412.83,381.637 2415.18,421.028 2417.53,373.83 2419.88,446.562 2422.23,403.416 2424.58,259.463 2426.93,345.119 2429.28,312.447 2431.63,284.168 2433.98,296.768 2436.34,332.983 2438.69,549.22 2441.04,346.055 2443.39,505.599 2445.74,305.434 2448.09,254.183 2450.44,328.881 2452.79,269.525 2455.14,443.083 2457.49,594.51 2459.84,401.925 2462.19,603.05 2464.54,523.403 2466.89,448.144 2469.24,594.277 2471.59,196.538 2473.94,517.185 2476.29,379.611 2478.64,469.157 2480.99,461.241 2483.34,416.214 2485.7,527.256 2488.05,379.454 2490.4,408.889 2492.75,470.382 2495.1,407.87 2497.45,409.94 2499.8,466.485 2502.15,468.366 2504.5,442.538 2506.85,354.26 2509.2,384.968 2511.55,434.764 2513.9,401.573 2516.25,508.5 2518.6,424.642 2520.95,316.888 2523.3,580.184 2525.65,305.088 2528,552.458 2530.35,536.358 2532.7,308.705 2535.06,472.95 2537.41,393.573 2539.76,596.575 2542.11,446.4 2544.46,315.581 2546.81,427.043 2549.16,326.288 2551.51,230.61 2553.86,546.067 2556.21,606.045 2558.56,373.275 2560.91,598 2563.26,573.001 2565.61,232.657 2567.96,532.174 2570.31,452.812 "></polyline>
</svg>
</div>
</div>
<p>Look at that! Things are working; amazin’.</p>
<p>We can also exploit <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>’s parallel sampling capabilities:</p>
<div id="34" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run separate 4 chains for 10 000 iterations using threads to parallelize.</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>num_chains <span class="op">=</span> <span class="fl">4</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    model_with_grad,</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">MCMCThreads</span>(),</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>,</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    num_chains;</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Note we need to provide an initial state for every chain.</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>    initial_state<span class="op">=</span><span class="fu">fill</span>(state, num_chains),</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>samples_array <span class="op">=</span> <span class="fu">stack</span>(<span class="fu">map</span>(<span class="bu">Base</span>.<span class="fu">Fix1</span>(stack, sample <span class="op">-&gt;</span> sample.x), samples))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000×4 Array{Float64, 3}:
[:, :, 1] =
 -4.12134  -3.79863    -3.80462   …  -6.20551   -5.47374   -5.05595
 -1.40898   0.0705239  -0.466379      0.457676   0.682416  -0.18436
  0.95321   1.1832      1.46052       6.28378    6.63627    5.9647

[:, :, 2] =
 -2.37198   -3.53665  -4.45711  -5.19597  …  -4.44179   -4.98354   -4.91571
 -0.829757  -1.21984  -2.17472  -2.72684     -0.576083  -0.157942  -0.536348
  2.41285    2.78503   3.26532   4.36252      4.80186    4.00547    3.16785

[:, :, 3] =
 -1.76915    -4.87928   -4.87928   …  -4.85799  -5.94734   -5.94734
 -0.0872939  -0.161556  -0.161556     -0.47188  -0.281537  -0.281537
  2.74111     3.36085    3.36085       3.6502    4.87324    4.87324

[:, :, 4] =
 -4.03849   -4.63281   -4.29821  …  -5.31907    -5.31907    -5.89518
  0.939606  -0.142742   1.03367     -0.0587266  -0.0587266  -1.05478
  2.25281    5.08194    5.20596      5.06898     5.06898     3.83855</code></pre>
</div>
</div>
<p>But the fact that we have to provide the <code>AbstractMCMC.sample</code> call, etc. with an <code>initial_state</code> to get started is a bit annoying. We can avoid this by also defining a <code>AbstractMCMC.step</code> <em>without</em> the <code>state</code> argument:</p>
<div id="36" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">::</span><span class="dt">MALA</span>;</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># </span><span class="al">NOTE</span><span class="co">: No state provided!</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just create the initial state by sampling using  a Gaussian.</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="fu">randn</span>(rng, LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(x), <span class="fu">MALAState</span>(x)</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Equipped with this, we no longer need to provide the <code>initial_state</code> everywhere:</p>
<div id="38" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -5.02188     1.00839
 -0.00805526  0.994884
  5.00011     1.00818</code></pre>
</div>
</div>
</section>
<section id="using-our-sampler-with-turing.jl" class="level2">
<h2 class="anchored" data-anchor-id="using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</h2>
<p>As we promised, all of this hassle of implementing our <code>MALA</code> sampler in a way that uses <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> and <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> gets us something more than <em>just</em> an “automatic” implementation of <code>AbstractMCMC.sample</code>.</p>
<p>It also enables use with Turing.jl through the <code>externalsampler</code>, but we need to do one final thing first: we need to tell Turing.jl how to extract a vector of parameters from the “sample” returned in our implementation of <code>AbstractMCMC.step</code>. In our case, the “sample” is a <code>MALASample</code>, so we just need the following line:</p>
<div id="40" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load Turing.jl.</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Turing</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Overload the `getparams` method for our "sample" type, which is just a vector.</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>Turing.Inference.<span class="fu">getparams</span>(<span class="op">::</span><span class="dt">Turing.Model</span>, sample<span class="op">::</span><span class="dt">MALASample</span>) <span class="op">=</span> sample.x</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And with that, we’re good to go!</p>
<div id="42" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Our previous model defined as a Turing.jl model.</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">mvnormal_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">MvNormal</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.], I)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate our model.</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">mvnormal_model</span>()</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Call `sample` but now we're passing in a Turing.jl `model` and wrapping</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co"># our `MALA` sampler in the `externalsampler` to tell Turing.jl that the sampler</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co"># expects something that implements LogDensityProblems.jl.</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×4×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 2.6 seconds
Compute duration  = 2.6 seconds
parameters        = x[1], x[2], x[3]
internals         = lp

Summary Statistics
  parameters      mean       std      mcse    ess_bulk    ess_tail      rhat   ⋯
      Symbol   Float64   Float64   Float64     Float64     Float64   Float64   ⋯

        x[1]   -4.9664    1.0051    0.0176   3257.6452   5156.5983    1.0004   ⋯
        x[2]   -0.0247    1.0089    0.0183   3024.6201   5219.1824    0.9999   ⋯
        x[3]    4.9959    0.9914    0.0171   3349.7739   5591.6940    1.0001   ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

        x[1]   -6.9359   -5.6464   -4.9793   -4.2749   -3.0312
        x[2]   -1.9746   -0.7063   -0.0233    0.6502    1.9733
        x[3]    3.0434    4.3231    5.0094    5.6631    6.9409</code></pre>
</div>
</div>
<p>Pretty neat, eh?</p>
<section id="models-with-constrained-parameters" class="level3">
<h3 class="anchored" data-anchor-id="models-with-constrained-parameters">Models with constrained parameters</h3>
<p>One thing we’ve sort of glossed over in all of the above is that MALA, at least how we’ve implemented it, requires <span class="math inline">\(x\)</span> to live in <span class="math inline">\(\mathbb{R}^d\)</span> for some <span class="math inline">\(d &gt; 0\)</span>. If some of the parameters were in fact constrained, e.g.&nbsp;we were working with a <code>Beta</code> distribution which has support on the interval <span class="math inline">\((0, 1)\)</span>, <em>not</em> on <span class="math inline">\(\mathbb{R}^d\)</span>, we could easily end up outside of the valid range <span class="math inline">\((0, 1)\)</span>.</p>
<div id="44" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">beta_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">beta_model</span>()</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 1.44 seconds
Compute duration  = 1.44 seconds
parameters        = x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse    ess_bulk    ess_tail      rhat   ⋯
      Symbol   Float64   Float64   Float64     Float64     Float64   Float64   ⋯

           x    0.4951    0.1894    0.0028   4412.4958   5379.2955    1.0000   ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

           x    0.1408    0.3519    0.4954    0.6361    0.8485</code></pre>
</div>
</div>
<p>Yep, that still works, but only because Turing.jl actually <em>transforms</em> the <code>turing_model</code> from constrained to unconstrained, so that the <code>sampler</code> provided to <code>externalsampler</code> is actually always working in unconstrained space! This is not always desirable, so we can turn this off:</p>
<div id="46" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 0.26 seconds
Compute duration  = 0.26 seconds
parameters        = x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse   ess_bulk   ess_tail      rhat   e ⋯
      Symbol   Float64   Float64   Float64    Float64    Float64   Float64     ⋯

           x    0.5111    0.1718    0.0224    50.4857    25.8168    1.0737     ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

           x    0.1952    0.3748    0.5118    0.6520    0.7761</code></pre>
</div>
</div>
<p>The fun thing is that this still sort of works because</p>
<div id="48" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">logpdf</span>(<span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>), <span class="fl">10.0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-Inf</code></pre>
</div>
</div>
<p>and so the samples that fall outside of the range are always rejected. But do notice how much worse all the diagnostics are, e.g.&nbsp;<code>ess_tail</code> is very poor compared to when we use <code>unconstrained=true</code>. Moreover, in more complex cases this won’t just result in a “nice” <code>-Inf</code> log-density value, but instead will error:</p>
<div id="50" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="kw">function</span> <span class="fu">demo</span>()</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>    σ² <span class="op">~</span> <span class="fu">truncated</span>(<span class="fu">Normal</span>(), lower<span class="op">=</span><span class="fl">0</span>)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If we end up with negative values for `σ²`, the `Normal` will error.</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>    x <span class="op">~</span> <span class="fu">Normal</span>(<span class="fl">0</span>, σ²)</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>DomainError: DomainError(Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}}(-0.9838295126820702,1.0,0.0), "Normal: the condition σ &gt;= zero(σ) is not satisfied.")
DomainError with Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}}(-0.9838295126820702,1.0,0.0):
Normal: the condition σ &gt;= zero(σ) is not satisfied.
Stacktrace:
  [1] #371
    @ ~/.julia/packages/Distributions/nmUhn/src/univariate/continuous/normal.jl:37 [inlined]
  [2] check_args
    @ ~/.julia/packages/Distributions/nmUhn/src/utils.jl:89 [inlined]
  [3] #Normal#370
    @ ~/.julia/packages/Distributions/nmUhn/src/univariate/continuous/normal.jl:37 [inlined]
  [4] Normal
    @ ~/.julia/packages/Distributions/nmUhn/src/univariate/continuous/normal.jl:36 [inlined]
  [5] Normal
    @ ~/.julia/packages/Distributions/nmUhn/src/univariate/continuous/normal.jl:42 [inlined]
  [6] macro expansion
    @ ~/.julia/packages/DynamicPPL/MjWTB/src/compiler.jl:579 [inlined]
  [7] demo(__model__::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, __varinfo__::DynamicPPL.ThreadSafeVarInfo{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}, Vector{Set{DynamicPPL.Selector}}}}, ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}, Vector{Base.RefValue{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}, __context__::DynamicPPL.DefaultContext)
    @ Main.Notebook ~/work/docs/docs/tutorials/docs-17-implementing-samplers/index.qmd:592
  [8] _evaluate!!
    @ ~/.julia/packages/DynamicPPL/MjWTB/src/model.jl:973 [inlined]
  [9] evaluate_threadsafe!!(model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, varinfo::DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}, Vector{Set{DynamicPPL.Selector}}}}, ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}, context::DynamicPPL.DefaultContext)
    @ DynamicPPL ~/.julia/packages/DynamicPPL/MjWTB/src/model.jl:962
 [10] evaluate!!
    @ ~/.julia/packages/DynamicPPL/MjWTB/src/model.jl:892 [inlined]
 [11] logdensity
    @ ~/.julia/packages/DynamicPPL/MjWTB/src/logdensityfunction.jl:140 [inlined]
 [12] Fix1
    @ ./operators.jl:1118 [inlined]
 [13] vector_mode_dual_eval!(f::Base.Fix1{typeof(LogDensityProblems.logdensity), LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, Nothing}}, cfg::ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}, x::Vector{Float64})
    @ ForwardDiff ~/.julia/packages/ForwardDiff/PcZ48/src/apiutils.jl:24
 [14] vector_mode_gradient!(result::DiffResults.MutableDiffResult{1, Float64, Tuple{Vector{Float64}}}, f::Base.Fix1{typeof(LogDensityProblems.logdensity), LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, Nothing}}, x::Vector{Float64}, cfg::ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}})
    @ ForwardDiff ~/.julia/packages/ForwardDiff/PcZ48/src/gradient.jl:96
 [15] gradient!
    @ ~/.julia/packages/ForwardDiff/PcZ48/src/gradient.jl:37 [inlined]
 [16] gradient!
    @ ~/.julia/packages/ForwardDiff/PcZ48/src/gradient.jl:35 [inlined]
 [17] logdensity_and_gradient
    @ ~/.julia/packages/LogDensityProblemsAD/rBlLq/ext/LogDensityProblemsADForwardDiffExt.jl:118 [inlined]
 [18] leapfrog_step(model::LogDensityProblemsADForwardDiffExt.ForwardDiffLogDensity{LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, Nothing}, ForwardDiff.Chunk{2}, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}, x::Vector{Float64}, p::Vector{Float64}, ϵ::Int64, M::UniformScaling{Bool})
    @ Main.Notebook ~/work/docs/docs/tutorials/docs-17-implementing-samplers/index.qmd:369
 [19] step(rng::TaskLocalRNG, model_wrapper::AbstractMCMC.LogDensityModel{LogDensityProblemsADForwardDiffExt.ForwardDiffLogDensity{LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, Nothing}, ForwardDiff.Chunk{2}, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}}, sampler::MALA{Int64, UniformScaling{Bool}}, state::MALAState{Vector{Float64}}; kwargs::@Kwargs{})
    @ Main.Notebook ~/work/docs/docs/tutorials/docs-17-implementing-samplers/index.qmd:334
 [20] step
    @ ~/work/docs/docs/tutorials/docs-17-implementing-samplers/index.qmd:316 [inlined]
 [21] #step#107
    @ ~/.julia/packages/Turing/Bv30p/src/mcmc/abstractmcmc.jl:155 [inlined]
 [22] step(rng::TaskLocalRNG, model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, sampler_wrapper::DynamicPPL.Sampler{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}, state::Turing.Inference.TuringState{MALAState{Vector{Float64}}, LogDensityProblemsADForwardDiffExt.ForwardDiffLogDensity{LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, Nothing}, ForwardDiff.Chunk{2}, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}})
    @ Turing.Inference ~/.julia/packages/Turing/Bv30p/src/mcmc/abstractmcmc.jl:144
 [23] macro expansion
    @ ~/.julia/packages/AbstractMCMC/YrmkI/src/sample.jl:176 [inlined]
 [24] macro expansion
    @ ~/.julia/packages/AbstractMCMC/YrmkI/src/logging.jl:16 [inlined]
 [25] mcmcsample(rng::TaskLocalRNG, model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, sampler::DynamicPPL.Sampler{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}, N::Int64; progress::Bool, progressname::String, callback::Nothing, discard_initial::Int64, thinning::Int64, chain_type::Type, initial_state::Nothing, kwargs::@Kwargs{})
    @ AbstractMCMC ~/.julia/packages/AbstractMCMC/YrmkI/src/sample.jl:120
 [26] sample(rng::TaskLocalRNG, model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, sampler::DynamicPPL.Sampler{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}, N::Int64; chain_type::Type, resume_from::Nothing, initial_state::Nothing, kwargs::@Kwargs{progress::Bool})
    @ DynamicPPL ~/.julia/packages/DynamicPPL/MjWTB/src/sampler.jl:93
 [27] sample
    @ ~/.julia/packages/DynamicPPL/MjWTB/src/sampler.jl:83 [inlined]
 [28] #sample#4
    @ ~/.julia/packages/Turing/Bv30p/src/mcmc/Inference.jl:276 [inlined]
 [29] sample
    @ ~/.julia/packages/Turing/Bv30p/src/mcmc/Inference.jl:267 [inlined]
 [30] #sample#3
    @ ~/.julia/packages/Turing/Bv30p/src/mcmc/Inference.jl:264 [inlined]
 [31] top-level scope
    @ ~/work/docs/docs/tutorials/docs-17-implementing-samplers/index.qmd:594</code></pre>
</div>
</div>
<p>As expected, we run into a <code>DomainError</code> at some point, while if we set <code>unconstrained=true</code>, letting Turing.jl transform the model to a unconstrained form behind the scenes, everything works as expected:</p>
<div id="52" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 0.6 seconds
Compute duration  = 0.6 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse   ess_bulk   ess_tail      rhat   e ⋯
      Symbol   Float64   Float64   Float64    Float64    Float64   Float64     ⋯

          σ²    0.8237    0.5760    0.0395   132.3750    37.6459    1.0028     ⋯
           x   -0.0114    1.1141    0.0754   406.8379   279.2534    1.0030     ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

          σ²    0.0955    0.3624    0.7012    1.1960    2.0915
           x   -2.2739   -0.4190    0.0230    0.3730    2.2705</code></pre>
</div>
</div>
<p>Neat!</p>
<p>Similarly, which automatic differentiation backend one should use can be specified through the <code>adtype</code> keyword argument too. For example, if we want to use <a href="https://github.com/JuliaDiff/ReverseDiff.jl">ReverseDiff.jl</a> instead of the default <a href="https://github.com/JuliaDiff/ForwardDiff.jl">ForwardDiff.jl</a>:</p>
<div id="54" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">ReverseDiff</span>: ReverseDiff</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify that we want to use `AutoReverseDiff`.</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">demo</span>(),</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>, adtype<span class="op">=</span><span class="fu">AutoReverseDiff</span>()),</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>;</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 3.09 seconds
Compute duration  = 3.09 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse   ess_bulk   ess_tail      rhat   e ⋯
      Symbol   Float64   Float64   Float64    Float64    Float64   Float64     ⋯

          σ²    0.1717    0.0000    0.0000        NaN        NaN       NaN     ⋯
           x    0.4341    0.0000    0.0000        NaN        NaN       NaN     ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

          σ²    0.1717    0.1717    0.1717    0.1717    0.1717
           x    0.4341    0.4341    0.4341    0.4341    0.4341</code></pre>
</div>
</div>
<p>Double-neat.</p>
</section>
</section>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<p>At this point it’s worth maybe reminding ourselves what we did and also <em>why</em> we did it:</p>
<ol type="1">
<li>We define our models in the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface because it makes the sampler agnostic to how the underlying model is implemented.</li>
<li>We implement our sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> interface, which just means that our sampler is a subtype of <code>AbstractMCMC.AbstractSampler</code> and we implement the MCMC transition in <code>AbstractMCMC.step</code>.</li>
<li>Points 1 and 2 makes it so our sampler can be used with a wide range of model implementations, amongst them being models implemented in both Turing.jl and Stan. This gives you, the inference implementer, a large collection of models to test your inference method on, in addition to allowing users of Turing.jl and Stan to try out your inference method with minimal effort.</li>
</ol>


</section>


<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a><div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>We’re going with the leapfrog formulation because in a future version of this tutorial we’ll add a section extending this simple “baseline” MALA sampler to more complex versions. See <a href="https://github.com/TuringLang/docs/issues/479">issue #479</a> for progress on this.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>There is no such thing as a proper interface in Julia (at least not officially), and so we use the word “interface” here to mean a few minimal methods that needs to be implemented by any type that we treat as a target model.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/turinglang\.org\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../tutorials/docs-07-for-developers-variational-inference/index.html" class="pagination-link" aria-label="Variational Inference">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Variational Inference</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Turing is created by <a href="http://mlg.eng.cam.ac.uk/hong/" target="_blank">Hong Ge</a>, and lovingly maintained by the <a href="https://github.com/TuringLang/Turing.jl/graphs/contributors" target="_blank">core team</a> of volunteers. <br> The contents of this website are © 2024 under the terms of the <a href="https://github.com/TuringLang/Turing.jl/blob/master/LICENCE" target="_blank">MIT License</a>.</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/TuringLang/docs/edit/master/tutorials/docs-17-implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/docs/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://x.com/TuringLang">
      <i class="bi bi-twitter" role="img" aria-label="Turing Twitter">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/TuringLang/Turing.jl">
      <i class="bi bi-github" role="img" aria-label="Turing GitHub">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




<script src="../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>