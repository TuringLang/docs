<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Implementing samplers – Turing.jl</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../tutorials/docs-07-for-developers-variational-inference/index.html" rel="prev">
<link href="../../assets/favicon.ico" rel="icon">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<style>
  a {
    text-decoration: none;
  }
  a:hover {
    text-decoration: underline;
  }
</style>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../theming/styles.css">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="https://turinglang.org/" class="navbar-brand navbar-brand-logo">
    <img src="../../assets/images/turing-logo.svg" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="https://turinglang.org/">
    <span class="navbar-title">Turing.jl</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../tutorials/docs-00-getting-started/"> 
<span class="menu-text">Get Started</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../tutorials/00-introduction/"> 
<span class="menu-text">Tutorials</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/library/"> 
<span class="menu-text">Libraries</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/news/"> 
<span class="menu-text">News</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/team/"> 
<span class="menu-text">Team</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-v0.32" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">v0.32</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-v0.32">    
        <li>
    <a class="dropdown-item" href="https://turinglang.org/docs/changelog.html">
 <span class="dropdown-text">Changelog</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://turinglang.org/docs/versions.html">
 <span class="dropdown-text">All Versions</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
    <a href="https://x.com/TuringLang" title="Turing Twitter" class="quarto-navigation-tool px-1" aria-label="Turing Twitter"><i class="bi bi-twitter"></i></a>
    <a href="https://github.com/TuringLang/Turing.jl" title="Turing GitHub" class="quarto-navigation-tool px-1" aria-label="Turing GitHub"><i class="bi bi-github"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Documentation</li><li class="breadcrumb-item"><a href="../../tutorials/docs-04-for-developers-abstractmcmc-turing/index.html">For Developers (Inference)</a></li><li class="breadcrumb-item"><a href="../../tutorials/docs-17-implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Documentation</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false">
 <span class="menu-text">Using Turing - Modelling Syntax and Interface</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-00-getting-started/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Getting Started</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-14-using-turing-quick-start/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Quick Start</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-12-using-turing-guide/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Guide</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-17-mode-estimation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Mode Estimation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-09-using-turing-advanced/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Advanced Usage</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-10-using-turing-autodiff/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Automatic Differentiation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-13-using-turing-performance-tips/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Performance Tips</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-11-using-turing-dynamichmc/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using DynamicHMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-15-using-turing-sampler-viz/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Sampler Visualization</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-16-using-turing-external-samplers/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">External Samplers</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false">
 <span class="menu-text">Using Turing - Tutorials</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/00-introduction/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction to Turing</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/01-gaussian-mixture-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Mixture Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/02-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/03-bayesian-neural-network/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Neural Networks</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/04-hidden-markov-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Hidden Markov Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/05-linear-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Linear Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/06-infinite-mixture-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Infinite Mixture Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/07-poisson-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Poisson Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/08-multinomial-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Multinomial Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/09-variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/10-bayesian-differential-equations/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Differential Equations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/11-probabilistic-pca/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Probabilistic PCA</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/13-seasonal-time-series/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Time Series Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/15-gaussian-processes/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction to Gaussian Processes</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/12-gplvm/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Process Latent Variable Models</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false">
 <span class="menu-text">For Developers (PPL)</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-01-contributing-guide/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">How to Contribute</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-05-for-developers-compiler/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Turing Compiler Design</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/14-minituring/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation I: Compiler</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/16-contexts/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation II: Contexts</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-06-for-developers-interface/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Interface Guide</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">For Developers (Inference)</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-04-for-developers-abstractmcmc-turing/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">How Turing implements AbstractMCMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-07-for-developers-variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-17-implementing-samplers/index.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Implementing Samplers</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of Contents</h2>
   
  <ul>
  <li><a href="#quick-overview-of-mala" id="toc-quick-overview-of-mala" class="nav-link active" data-scroll-target="#quick-overview-of-mala">Quick overview of MALA</a></li>
  <li><a href="#what-we-need-from-a-model-logdensityproblems.jl" id="toc-what-we-need-from-a-model-logdensityproblems.jl" class="nav-link" data-scroll-target="#what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: LogDensityProblems.jl</a></li>
  <li><a href="#implementing-mala-in-abstractmcmc.jl" id="toc-implementing-mala-in-abstractmcmc.jl" class="nav-link" data-scroll-target="#implementing-mala-in-abstractmcmc.jl">Implementing MALA in AbstractMCMC.jl</a></li>
  <li><a href="#using-our-sampler-with-turing.jl" id="toc-using-our-sampler-with-turing.jl" class="nav-link" data-scroll-target="#using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</a>
  <ul class="collapse">
  <li><a href="#models-with-constrained-parameters" id="toc-models-with-constrained-parameters" class="nav-link" data-scroll-target="#models-with-constrained-parameters">Models with constrained parameters</a></li>
  </ul></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/TuringLang/docs/edit/master/tutorials/docs-17-implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/docs/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Documentation</li><li class="breadcrumb-item"><a href="../../tutorials/docs-04-for-developers-abstractmcmc-turing/index.html">For Developers (Inference)</a></li><li class="breadcrumb-item"><a href="../../tutorials/docs-17-implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Implementing samplers</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>In this tutorial, we’ll go through step-by-step how to implement a “simple” sampler in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> in such a way that it can be easily applied to Turing.jl models.</p>
<p>In particular, we’re going to implement a version of <strong>Metropolis-adjusted Langevin (MALA)</strong>.</p>
<p>Note that we will implement this sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> framework, completely “ignoring” Turing.jl until the very end of the tutorial, at which point we’ll use a single line of code to make the resulting sampler available to Turing.jl. This is to really drive home the point that one can implement samplers in a way that is accessible to all of Turing.jl’s users without having to use Turing.jl yourself.</p>
<section id="quick-overview-of-mala" class="level2">
<h2 class="anchored" data-anchor-id="quick-overview-of-mala">Quick overview of MALA</h2>
<p>We can view MALA as a single step of the leapfrog intergrator with resampling of momentum <span class="math inline">\(p\)</span> at every step.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> To make that statement a bit more concrete, we first define the <em>extended</em> target <span class="math inline">\(\bar{\gamma}(x, p)\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\log \bar{\gamma}(x, p) \propto \log \gamma(x) + \log \gamma_{\mathcal{N}(0, M)}(p)
\end{equation*}\]</span></p>
<p>where <span class="math inline">\(\gamma_{\mathcal{N}(0, M)}\)</span> denotes the density for a zero-centered Gaussian with covariance matrix <span class="math inline">\(M\)</span>. We then consider targeting this joint distribution over both <span class="math inline">\(x\)</span> and <span class="math inline">\(p\)</span> as follows. First we define the map</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  L_{\epsilon}: \quad &amp; \mathbb{R}^d \times \mathbb{R}^d \to \mathbb{R}^d \times \mathbb{R}^d \\
  &amp; (x, p) \mapsto (\tilde{x}, \tilde{p}) := L_{\epsilon}(x, p)
\end{split}
\end{equation*}\]</span></p>
<p>as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p_{1 / 2} &amp;:= p + \frac{\epsilon}{2} \nabla \log \gamma(x) \\
  \tilde{x} &amp;:= x + \epsilon M^{-1} p_{1 /2 } \\
  p_1 &amp;:= p_{1 / 2} + \frac{\epsilon}{2} \nabla \log \gamma(\tilde{x}) \\
  \tilde{p} &amp;:= - p_1
\end{split}
\end{equation*}\]</span></p>
<p>This might be familiar for some readers as a single step of the Leapfrog integrator. We then define the MALA kernel as follows: given the current iterate <span class="math inline">\(x_i\)</span>, we sample the next iterate <span class="math inline">\(x_{i + 1}\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p &amp;\sim \mathcal{N}(0, M) \\
  (\tilde{x}, \tilde{p}) &amp;:= L_{\epsilon}(x_i, p) \\
  \alpha &amp;:= \min \left\{ 1, \frac{\bar{\gamma}(\tilde{x}, \tilde{p})}{\bar{\gamma}(x_i, p)} \right\} \\
  x_{i + 1} &amp;:=
  \begin{cases}
    \tilde{x} \quad &amp; \text{ with prob. } \alpha \\
    x_i       \quad &amp; \text{ with prob. } 1 - \alpha
  \end{cases}
\end{split}
\end{equation*}\]</span></p>
<p>i.e.&nbsp;we accept the proposal <span class="math inline">\(\tilde{x}\)</span> with probability <span class="math inline">\(\alpha\)</span> and reject it, thus sticking with our current iterate, with probability <span class="math inline">\(1 - \alpha\)</span>.</p>
</section>
<section id="what-we-need-from-a-model-logdensityproblems.jl" class="level2">
<h2 class="anchored" data-anchor-id="what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a></h2>
<p>There are a few things we need from the “target” / “model” / density that we want to sample from:</p>
<ol type="1">
<li>We need access to log-density <em>evaluations</em> <span class="math inline">\(\log \gamma(x)\)</span> so we can compute the acceptance ratio involving <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>We need access to log-density <em>gradients</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span> so we can compute the Leapfrog steps <span class="math inline">\(L_{\epsilon}(x, p)\)</span>.</li>
<li>We also need access to the “size” of the model so we can determine the size of <span class="math inline">\(M\)</span>.</li>
</ol>
<p>Luckily for us, there is a package called <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> which provides an interface for <em>exactly</em> this!</p>
<p>To demonstrate how one can implement the “<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface”<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> we will use a simple Gaussian model as an example:</p>
<div id="4" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblems</span>: LogDensityProblems;</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's define some type that represents the model.</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> IsotropicNormalModel{M<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"mean of the isotropic Gaussian"</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    mean<span class="op">::</span><span class="dt">M</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Specifies what input length the model expects.</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">dimension</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> <span class="fu">length</span>(model.mean)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Implementation of the log-density evaluation of the model.</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x<span class="op">::</span><span class="dt">AbstractVector{&lt;:Real}</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">-</span> <span class="fu">sum</span>(abs2, x <span class="op">.-</span> model.mean) <span class="op">/</span> <span class="fl">2</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This gives us all of the properties we want for our MALA sampler with the exception of the computation of the <em>gradient</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span>. There is the method <code>LogDensityProblems.logdensity_and_gradient</code> which should return a 2-tuple where the first entry is the evaluation of the logdensity <span class="math inline">\(\log \gamma(x)\)</span> and the second entry is the gradient <span class="math inline">\(\nabla \log \gamma(x)\)</span>.</p>
<p>There are two ways to “implement” this method: 1) we implement it by hand, which is feasible in the case of our <code>IsotropicNormalModel</code>, or b) we defer the implementation of this to a automatic differentiation backend.</p>
<p>To implement it by hand we can simply do</p>
<div id="6" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl that first-order, i.e. gradient information, is available.</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{1}</span>()</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Implement `logdensity_and_gradient`.</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    logγ_x <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="op">-</span>x <span class="op">.*</span> (x <span class="op">-</span> model.mean)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> logγ_x, ∇logγ_x</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s just try it out:</p>
<div id="8" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate the problem.</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> <span class="fu">IsotropicNormalModel</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.])</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create some example input that we can test on.</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>x_example <span class="op">=</span> <span class="fu">randn</span>(LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate!</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-34.63892641304505</code></pre>
</div>
</div>
<p>To defer it to an automatic differentiation backend, we can do</p>
<div id="10" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl we only have access to 0-th order information.</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{0}</span>()</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Use `LogDensityProblemsAD`'s `ADgradient` in combination with some AD backend to implement `logdensity_and_gradient`.</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblemsAD</span>, <span class="bu">ADTypes</span>, <span class="bu">ForwardDiff</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>model_with_grad <span class="op">=</span> <span class="fu">ADgradient</span>(<span class="fu">AutoForwardDiff</span>(), model)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model_with_grad, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-34.63892641304505</code></pre>
</div>
</div>
<p>We’ll continue with the second approach in this tutorial since this is typically what one does in practice, because there are better hobbies to spend time on than deriving gradients by hand.</p>
<p>At this point, one might wonder how we’re going to tie this back to Turing.jl in the end. Effectively, when working with inference methods that only require log-density evaluations and / or higher-order information of the log-density, Turing.jl actually converts the user-provided <code>Model</code> into an object implementing the above methods for <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>. As a result, most samplers provided by Turing.jl are actually implemented to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, enabling their use both <em>within</em> Turing.jl and <em>outside</em> of Turing.jl! Morever, there exists similar conversions for Stan through BridgeStan and Stan<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, which means that a sampler supporting the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface can easily be used on both Turing.jl <em>and</em> Stan models (in addition to user-provided models, as our <code>IsotropicNormalModel</code> above)!</p>
<p>Anyways, let’s move on to actually implementing the sampler.</p>
</section>
<section id="implementing-mala-in-abstractmcmc.jl" class="level2">
<h2 class="anchored" data-anchor-id="implementing-mala-in-abstractmcmc.jl">Implementing MALA in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a></h2>
<p>Now that we’ve established that a model implementing the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface provides us with all the information we need from <span class="math inline">\(\log \gamma(x)\)</span>, we can address the question: given an object that implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, how can we define a sampler for it?</p>
<p>We’re going to do this by making our sampler a sub-type of <code>AbstractMCMC.AbstractSampler</code> in addition to implementing a few methods from <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>. Why? Because it gets us <em>a lot</em> of functionality for free, as we will see later.</p>
<p>Moreover, <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> provides a very natural interface for MCMC algorithms.</p>
<p>First, we’ll define our <code>MALA</code> type</p>
<div id="12" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">AbstractMCMC</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALA{T,A} <span class="op">&lt;:</span><span class="dt"> AbstractMCMC.AbstractSampler</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"stepsize used in the leapfrog step"</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    ϵ_init<span class="op">::</span><span class="dt">T</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"covariance matrix used for the momentum"</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    M_init<span class="op">::</span><span class="dt">A</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notice how we’ve added the suffix <code>_init</code> to both the stepsize and the covariance matrix. We’ve done this because a <code>AbstractMCMC.AbstractSampler</code> should be <em>immutable</em>. Of course there might be many scenarios where we want to allow something like the stepsize and / or the covariance matrix to vary between iterations, e.g.&nbsp;during the burn-in / adaptation phase of the sampling process we might want to adjust the parameters using statistics computed from these initial iterations. But information which can change between iterations <em>should not go in the sampler itself</em>! Instead, this information should go in the sampler <em>state</em>.</p>
<p>The sampler state should at the very least contain all the necessary information to perform the next MCMC iteration, but usually contains further information, e.g.&nbsp;quantities and statistics useful for evaluating whether the sampler has converged.</p>
<p>We will use the following sampler state for our <code>MALA</code> sampler:</p>
<div id="14" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALAState{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This might seem overly redundant: we’re defining a type <code>MALAState</code> and it only contains a simple vector of reals. In this particular case we indeed could have dropped this and simply used a <code>AbstractVector{&lt;:Real}</code> as our sampler state, but typically, as we will see later, one wants to include other quantities in the sampler state. For example, if we also wanted to adapt the parameters of our <code>MALA</code>, e.g.&nbsp;alter the stepsize depending on acceptance rates, in which case we should also put <code>ϵ</code> in the state, but for now we’ll keep things simple.</p>
<p>Moreover, we also want a <em>sample</em> type, which is a type meant for “public consumption”, i.e.&nbsp;the end-user. This is generally going to contain a subset of the information present in the state. But in such a simple scenario as this, we similarly only have a <code>AbstractVector{&lt;:Real}</code>:</p>
<div id="16" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALASample{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We currently have three things:</p>
<ol type="1">
<li>A <code>AbstractMCMC.AbstractSampler</code> implementation called <code>MALA</code>.</li>
<li>A state <code>MALAState</code> for our sampler <code>MALA</code>.</li>
<li>A sample <code>MALASample</code> for our sampler <code>MALA</code>.</li>
</ol>
<p>That means that we’re ready to implement the only thing that really matters: <code>AbstractMCMC.step</code>.</p>
<p><code>AbstractMCMC.step</code> defines the MCMC iteration of our <code>MALA</code> given the current <code>MALAState</code>. Specifically, the signature of the function is as follows:</p>
<div id="18" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The RNG to ensure reproducibility.</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The model that defines our target.</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.AbstractModel</span>,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The sampler for which we're taking a `step`.</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">AbstractMCMC.AbstractSampler</span>,</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The current sampler `state`.</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    state;</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Additional keyword arguments that we may or may not need.</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Moreover, there is a specific <code>AbstractMCMC.AbstractModel</code> which is used to indicate that the model that is provided implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface: <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Since, as we discussed earlier, in our case we’re indeed going to work with types that support the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, we’ll define <code>AbstractMCMC.step</code> for such a <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Note that <code>AbstractMCMC.LogDensityModel</code> has no other purpose; it has a single field called <code>logdensity</code>, and it does nothing else. But by wrapping the model in <code>AbstractMCMC.LogDensityModel</code>, it allows samplers that want to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> to define their <code>AbstractMCMC.step</code> on this type without running into method ambiguities.</p>
<p>All in all, that means that the signature for our <code>AbstractMCMC.step</code> is going to be the following:</p>
<div id="20" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># `LogDensityModel` so we know we're working with LogDensityProblems.jl model.</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler.</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler state.</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Great! Now let’s actually implement the full <code>AbstractMCMC.step</code> for our <code>MALA</code>.</p>
<p>Let’s remind ourselves what we’re going to do:</p>
<ol type="1">
<li>Sample a new momentum <span class="math inline">\(p\)</span>.</li>
<li>Compute the log-density of the extended target <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>Take a single leapfrog step <span class="math inline">\((\tilde{x}, \tilde{p}) = L_{\epsilon}(x, p)\)</span>.</li>
<li>Accept or reject the proposed <span class="math inline">\((\tilde{x}, \tilde{p})\)</span>.</li>
</ol>
<p>All in all, this results in the following:</p>
<div id="22" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>: Random</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Distributions</span>  <span class="co"># so we get the `MvNormal`</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the wrapped model which implements LogDensityProblems.jl.</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just extract the sampler parameters to make our lives easier.</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    ϵ <span class="op">=</span> sampler.ϵ_init</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    M <span class="op">=</span> sampler.M_init</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the current parameters.</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> state.x</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sample the momentum.</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>    p_dist <span class="op">=</span> <span class="fu">MvNormal</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)), M)</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> <span class="fu">rand</span>(rng, p_dist)</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Propose using a single leapfrog step.</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>    x̃, p̃ <span class="op">=</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Accept or reject proposal.</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>    logp <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p)</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>    logp̃ <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x̃) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p̃)</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>    logα <span class="op">=</span> logp̃ <span class="op">-</span> logp</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>    state_new <span class="op">=</span> <span class="cf">if</span> <span class="fu">log</span>(<span class="fu">rand</span>(rng)) <span class="op">&lt;</span> logα</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Accept.</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x̃)</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Reject.</span></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x)</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return the "sample" and the sampler state.</span></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(state_new.x), state_new</span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Fairly straight-forward.</p>
<p>Of course, we haven’t defined the <code>leapfrog_step</code> method yet, so let’s do that:</p>
<div id="24" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p` using "position" `x`.</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x))</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    p1 <span class="op">=</span> p <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update the "position" `x` using momentum `p1`.</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    x̃ <span class="op">=</span> x <span class="op">+</span> ϵ <span class="op">.*</span> (M <span class="op">\</span> p1)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p1` using position `x̃`</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x̃ <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x̃))</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    p2 <span class="op">=</span> p1 <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x̃</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Flip momentum `p2`.</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    p̃ <span class="op">=</span> <span class="op">-</span>p2</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x̃, p̃</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>leapfrog_step (generic function with 1 method)</code></pre>
</div>
</div>
<p>With all of this, we’re technically ready to sample!</p>
<div id="26" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>, <span class="bu">LinearAlgebra</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>rng <span class="op">=</span> <span class="bu">Random</span>.<span class="fu">default_rng</span>()</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>sampler <span class="op">=</span> <span class="fu">MALA</span>(<span class="fl">1</span>, I)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>state <span class="op">=</span> <span class="fu">MALAState</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)))</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>x_next, state_next <span class="op">=</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    rng,</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    AbstractMCMC.<span class="fu">LogDensityModel</span>(model),</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    state</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>(MALASample{Vector{Float64}}([-1.0526186223043403, -1.0998356384467278, 0.7991138802426934]), MALAState{Vector{Float64}}([-1.0526186223043403, -1.0998356384467278, 0.7991138802426934]))</code></pre>
</div>
</div>
<p>Great, it works!</p>
<p>And I promised we would get quite some functionality for free if we implemented <code>AbstractMCMC.step</code>, and so we can now simply call <code>sample</code> to perform standard MCMC sampling:</p>
<div id="28" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform 1000 iterations with our `MALA` sampler.</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; initial_state<span class="op">=</span>state, progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Concatenate into a matrix.</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000 Matrix{Float64}:
 -1.49564  -1.98893  -3.42298  -3.42298  …  -6.71111  -6.71111  -6.96633
  1.004     0.76728   1.63414   1.63414      1.34073   1.34073   0.911024
  1.41416   2.59508   3.64002   3.64002      4.31931   4.31931   5.23965</code></pre>
</div>
</div>
<div id="30" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the marginal means and standard deviations.</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -5.03661    1.0036
 -0.0083672  0.99563
  4.97863    1.00915</code></pre>
</div>
</div>
<p>Let’s visualize the samples</p>
<div id="32" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">StatsPlots</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">transpose</span>(samples_matrix[<span class="op">:</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">:</span><span class="kw">end</span>]), alpha<span class="op">=</span><span class="fl">0.5</span>, legend<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<!--?xml version="1.0" encoding="utf-8"?-->
<svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" width="672" height="480" viewbox="0 0 2688 1920">
<defs>
  <clippath id="clip920">
    <rect x="0" y="0" width="2688" height="1920"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip920)" d="M0 1920 L2688 1920 L2688 0 L0 0  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip921">
    <rect x="537" y="0" width="1883" height="1883"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip920)" d="M196.816 1800.78 L2640.76 1800.78 L2640.76 47.2441 L196.816 47.2441  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip922">
    <rect x="196" y="47" width="2445" height="1755"></rect>
  </clippath>
</defs>
<polyline clip-path="url(#clip922)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="263.676,1800.78 263.676,47.2441 "></polyline>
<polyline clip-path="url(#clip922)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="840.654,1800.78 840.654,47.2441 "></polyline>
<polyline clip-path="url(#clip922)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1417.63,1800.78 1417.63,47.2441 "></polyline>
<polyline clip-path="url(#clip922)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1994.61,1800.78 1994.61,47.2441 "></polyline>
<polyline clip-path="url(#clip922)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="2571.59,1800.78 2571.59,47.2441 "></polyline>
<polyline clip-path="url(#clip920)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1800.78 2640.76,1800.78 "></polyline>
<polyline clip-path="url(#clip920)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="263.676,1800.78 263.676,1781.88 "></polyline>
<polyline clip-path="url(#clip920)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="840.654,1800.78 840.654,1781.88 "></polyline>
<polyline clip-path="url(#clip920)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1417.63,1800.78 1417.63,1781.88 "></polyline>
<polyline clip-path="url(#clip920)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1994.61,1800.78 1994.61,1781.88 "></polyline>
<polyline clip-path="url(#clip920)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="2571.59,1800.78 2571.59,1781.88 "></polyline>
<path clip-path="url(#clip920)" d="M263.676 1834 Q260.065 1834 258.236 1837.57 Q256.431 1841.11 256.431 1848.24 Q256.431 1855.34 258.236 1858.91 Q260.065 1862.45 263.676 1862.45 Q267.31 1862.45 269.116 1858.91 Q270.945 1855.34 270.945 1848.24 Q270.945 1841.11 269.116 1837.57 Q267.31 1834 263.676 1834 M263.676 1830.3 Q269.486 1830.3 272.542 1834.9 Q275.621 1839.49 275.621 1848.24 Q275.621 1856.96 272.542 1861.57 Q269.486 1866.15 263.676 1866.15 Q257.866 1866.15 254.787 1861.57 Q251.732 1856.96 251.732 1848.24 Q251.732 1839.49 254.787 1834.9 Q257.866 1830.3 263.676 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip920)" d="M804.346 1861.55 L820.666 1861.55 L820.666 1865.48 L798.721 1865.48 L798.721 1861.55 Q801.383 1858.79 805.967 1854.16 Q810.573 1849.51 811.754 1848.17 Q813.999 1845.65 814.879 1843.91 Q815.782 1842.15 815.782 1840.46 Q815.782 1837.71 813.837 1835.97 Q811.916 1834.23 808.814 1834.23 Q806.615 1834.23 804.161 1835 Q801.731 1835.76 798.953 1837.31 L798.953 1832.59 Q801.777 1831.46 804.231 1830.88 Q806.684 1830.3 808.721 1830.3 Q814.092 1830.3 817.286 1832.98 Q820.481 1835.67 820.481 1840.16 Q820.481 1842.29 819.67 1844.21 Q818.883 1846.11 816.777 1848.7 Q816.198 1849.37 813.096 1852.59 Q809.995 1855.78 804.346 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip920)" d="M830.527 1830.92 L848.883 1830.92 L848.883 1834.86 L834.809 1834.86 L834.809 1843.33 Q835.828 1842.98 836.846 1842.82 Q837.865 1842.64 838.883 1842.64 Q844.67 1842.64 848.05 1845.81 Q851.43 1848.98 851.43 1854.4 Q851.43 1859.97 847.957 1863.08 Q844.485 1866.15 838.166 1866.15 Q835.99 1866.15 833.721 1865.78 Q831.476 1865.41 829.069 1864.67 L829.069 1859.97 Q831.152 1861.11 833.374 1861.66 Q835.596 1862.22 838.073 1862.22 Q842.078 1862.22 844.416 1860.11 Q846.754 1858.01 846.754 1854.4 Q846.754 1850.78 844.416 1848.68 Q842.078 1846.57 838.073 1846.57 Q836.198 1846.57 834.323 1846.99 Q832.471 1847.4 830.527 1848.28 L830.527 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip920)" d="M870.642 1834 Q867.031 1834 865.203 1837.57 Q863.397 1841.11 863.397 1848.24 Q863.397 1855.34 865.203 1858.91 Q867.031 1862.45 870.642 1862.45 Q874.277 1862.45 876.082 1858.91 Q877.911 1855.34 877.911 1848.24 Q877.911 1841.11 876.082 1837.57 Q874.277 1834 870.642 1834 M870.642 1830.3 Q876.453 1830.3 879.508 1834.9 Q882.587 1839.49 882.587 1848.24 Q882.587 1856.96 879.508 1861.57 Q876.453 1866.15 870.642 1866.15 Q864.832 1866.15 861.754 1861.57 Q858.698 1856.96 858.698 1848.24 Q858.698 1839.49 861.754 1834.9 Q864.832 1830.3 870.642 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip920)" d="M1377.25 1830.92 L1395.61 1830.92 L1395.61 1834.86 L1381.53 1834.86 L1381.53 1843.33 Q1382.55 1842.98 1383.57 1842.82 Q1384.59 1842.64 1385.61 1842.64 Q1391.39 1842.64 1394.77 1845.81 Q1398.15 1848.98 1398.15 1854.4 Q1398.15 1859.97 1394.68 1863.08 Q1391.21 1866.15 1384.89 1866.15 Q1382.71 1866.15 1380.44 1865.78 Q1378.2 1865.41 1375.79 1864.67 L1375.79 1859.97 Q1377.88 1861.11 1380.1 1861.66 Q1382.32 1862.22 1384.8 1862.22 Q1388.8 1862.22 1391.14 1860.11 Q1393.48 1858.01 1393.48 1854.4 Q1393.48 1850.78 1391.14 1848.68 Q1388.8 1846.57 1384.8 1846.57 Q1382.92 1846.57 1381.05 1846.99 Q1379.19 1847.4 1377.25 1848.28 L1377.25 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip920)" d="M1417.37 1834 Q1413.75 1834 1411.93 1837.57 Q1410.12 1841.11 1410.12 1848.24 Q1410.12 1855.34 1411.93 1858.91 Q1413.75 1862.45 1417.37 1862.45 Q1421 1862.45 1422.81 1858.91 Q1424.63 1855.34 1424.63 1848.24 Q1424.63 1841.11 1422.81 1837.57 Q1421 1834 1417.37 1834 M1417.37 1830.3 Q1423.18 1830.3 1426.23 1834.9 Q1429.31 1839.49 1429.31 1848.24 Q1429.31 1856.96 1426.23 1861.57 Q1423.18 1866.15 1417.37 1866.15 Q1411.56 1866.15 1408.48 1861.57 Q1405.42 1856.96 1405.42 1848.24 Q1405.42 1839.49 1408.48 1834.9 Q1411.56 1830.3 1417.37 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip920)" d="M1447.53 1834 Q1443.92 1834 1442.09 1837.57 Q1440.28 1841.11 1440.28 1848.24 Q1440.28 1855.34 1442.09 1858.91 Q1443.92 1862.45 1447.53 1862.45 Q1451.16 1862.45 1452.97 1858.91 Q1454.8 1855.34 1454.8 1848.24 Q1454.8 1841.11 1452.97 1837.57 Q1451.16 1834 1447.53 1834 M1447.53 1830.3 Q1453.34 1830.3 1456.39 1834.9 Q1459.47 1839.49 1459.47 1848.24 Q1459.47 1856.96 1456.39 1861.57 Q1453.34 1866.15 1447.53 1866.15 Q1441.72 1866.15 1438.64 1861.57 Q1435.58 1856.96 1435.58 1848.24 Q1435.58 1839.49 1438.64 1834.9 Q1441.72 1830.3 1447.53 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip920)" d="M1952.89 1830.92 L1975.11 1830.92 L1975.11 1832.91 L1962.56 1865.48 L1957.68 1865.48 L1969.48 1834.86 L1952.89 1834.86 L1952.89 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip920)" d="M1984.27 1830.92 L2002.63 1830.92 L2002.63 1834.86 L1988.56 1834.86 L1988.56 1843.33 Q1989.58 1842.98 1990.59 1842.82 Q1991.61 1842.64 1992.63 1842.64 Q1998.42 1842.64 2001.8 1845.81 Q2005.18 1848.98 2005.18 1854.4 Q2005.18 1859.97 2001.7 1863.08 Q1998.23 1866.15 1991.91 1866.15 Q1989.74 1866.15 1987.47 1865.78 Q1985.22 1865.41 1982.82 1864.67 L1982.82 1859.97 Q1984.9 1861.11 1987.12 1861.66 Q1989.34 1862.22 1991.82 1862.22 Q1995.83 1862.22 1998.16 1860.11 Q2000.5 1858.01 2000.5 1854.4 Q2000.5 1850.78 1998.16 1848.68 Q1995.83 1846.57 1991.82 1846.57 Q1989.95 1846.57 1988.07 1846.99 Q1986.22 1847.4 1984.27 1848.28 L1984.27 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip920)" d="M2024.39 1834 Q2020.78 1834 2018.95 1837.57 Q2017.14 1841.11 2017.14 1848.24 Q2017.14 1855.34 2018.95 1858.91 Q2020.78 1862.45 2024.39 1862.45 Q2028.02 1862.45 2029.83 1858.91 Q2031.66 1855.34 2031.66 1848.24 Q2031.66 1841.11 2029.83 1837.57 Q2028.02 1834 2024.39 1834 M2024.39 1830.3 Q2030.2 1830.3 2033.26 1834.9 Q2036.33 1839.49 2036.33 1848.24 Q2036.33 1856.96 2033.26 1861.57 Q2030.2 1866.15 2024.39 1866.15 Q2018.58 1866.15 2015.5 1861.57 Q2012.45 1856.96 2012.45 1848.24 Q2012.45 1839.49 2015.5 1834.9 Q2018.58 1830.3 2024.39 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip920)" d="M2516.11 1861.55 L2523.75 1861.55 L2523.75 1835.18 L2515.44 1836.85 L2515.44 1832.59 L2523.71 1830.92 L2528.38 1830.92 L2528.38 1861.55 L2536.02 1861.55 L2536.02 1865.48 L2516.11 1865.48 L2516.11 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip920)" d="M2555.47 1834 Q2551.85 1834 2550.03 1837.57 Q2548.22 1841.11 2548.22 1848.24 Q2548.22 1855.34 2550.03 1858.91 Q2551.85 1862.45 2555.47 1862.45 Q2559.1 1862.45 2560.9 1858.91 Q2562.73 1855.34 2562.73 1848.24 Q2562.73 1841.11 2560.9 1837.57 Q2559.1 1834 2555.47 1834 M2555.47 1830.3 Q2561.28 1830.3 2564.33 1834.9 Q2567.41 1839.49 2567.41 1848.24 Q2567.41 1856.96 2564.33 1861.57 Q2561.28 1866.15 2555.47 1866.15 Q2549.66 1866.15 2546.58 1861.57 Q2543.52 1856.96 2543.52 1848.24 Q2543.52 1839.49 2546.58 1834.9 Q2549.66 1830.3 2555.47 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip920)" d="M2585.63 1834 Q2582.02 1834 2580.19 1837.57 Q2578.38 1841.11 2578.38 1848.24 Q2578.38 1855.34 2580.19 1858.91 Q2582.02 1862.45 2585.63 1862.45 Q2589.26 1862.45 2591.07 1858.91 Q2592.9 1855.34 2592.9 1848.24 Q2592.9 1841.11 2591.07 1837.57 Q2589.26 1834 2585.63 1834 M2585.63 1830.3 Q2591.44 1830.3 2594.49 1834.9 Q2597.57 1839.49 2597.57 1848.24 Q2597.57 1856.96 2594.49 1861.57 Q2591.44 1866.15 2585.63 1866.15 Q2579.82 1866.15 2576.74 1861.57 Q2573.68 1856.96 2573.68 1848.24 Q2573.68 1839.49 2576.74 1834.9 Q2579.82 1830.3 2585.63 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip920)" d="M2615.79 1834 Q2612.18 1834 2610.35 1837.57 Q2608.54 1841.11 2608.54 1848.24 Q2608.54 1855.34 2610.35 1858.91 Q2612.18 1862.45 2615.79 1862.45 Q2619.42 1862.45 2621.23 1858.91 Q2623.06 1855.34 2623.06 1848.24 Q2623.06 1841.11 2621.23 1837.57 Q2619.42 1834 2615.79 1834 M2615.79 1830.3 Q2621.6 1830.3 2624.65 1834.9 Q2627.73 1839.49 2627.73 1848.24 Q2627.73 1856.96 2624.65 1861.57 Q2621.6 1866.15 2615.79 1866.15 Q2609.98 1866.15 2606.9 1861.57 Q2603.84 1856.96 2603.84 1848.24 Q2603.84 1839.49 2606.9 1834.9 Q2609.98 1830.3 2615.79 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip922)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,1648.97 2640.76,1648.97 "></polyline>
<polyline clip-path="url(#clip922)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,1402.87 2640.76,1402.87 "></polyline>
<polyline clip-path="url(#clip922)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,1156.76 2640.76,1156.76 "></polyline>
<polyline clip-path="url(#clip922)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,910.661 2640.76,910.661 "></polyline>
<polyline clip-path="url(#clip922)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,664.558 2640.76,664.558 "></polyline>
<polyline clip-path="url(#clip922)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,418.454 2640.76,418.454 "></polyline>
<polyline clip-path="url(#clip922)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,172.351 2640.76,172.351 "></polyline>
<polyline clip-path="url(#clip920)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1800.78 196.816,47.2441 "></polyline>
<polyline clip-path="url(#clip920)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1648.97 215.714,1648.97 "></polyline>
<polyline clip-path="url(#clip920)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1402.87 215.714,1402.87 "></polyline>
<polyline clip-path="url(#clip920)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1156.76 215.714,1156.76 "></polyline>
<polyline clip-path="url(#clip920)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,910.661 215.714,910.661 "></polyline>
<polyline clip-path="url(#clip920)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,664.558 215.714,664.558 "></polyline>
<polyline clip-path="url(#clip920)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,418.454 215.714,418.454 "></polyline>
<polyline clip-path="url(#clip920)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,172.351 215.714,172.351 "></polyline>
<path clip-path="url(#clip920)" d="M50.5475 1649.42 L80.2233 1649.42 L80.2233 1653.36 L50.5475 1653.36 L50.5475 1649.42 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip920)" d="M89.1352 1631.69 L111.357 1631.69 L111.357 1633.68 L98.8111 1666.25 L93.9269 1666.25 L105.732 1635.63 L89.1352 1635.63 L89.1352 1631.69 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip920)" d="M120.478 1660.37 L125.362 1660.37 L125.362 1666.25 L120.478 1666.25 L120.478 1660.37 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip920)" d="M135.593 1631.69 L153.95 1631.69 L153.95 1635.63 L139.876 1635.63 L139.876 1644.1 Q140.894 1643.75 141.913 1643.59 Q142.931 1643.4 143.95 1643.4 Q149.737 1643.4 153.116 1646.58 Q156.496 1649.75 156.496 1655.16 Q156.496 1660.74 153.024 1663.84 Q149.552 1666.92 143.232 1666.92 Q141.056 1666.92 138.788 1666.55 Q136.542 1666.18 134.135 1665.44 L134.135 1660.74 Q136.218 1661.88 138.441 1662.43 Q140.663 1662.99 143.14 1662.99 Q147.144 1662.99 149.482 1660.88 Q151.82 1658.77 151.82 1655.16 Q151.82 1651.55 149.482 1649.45 Q147.144 1647.34 143.14 1647.34 Q141.265 1647.34 139.39 1647.76 Q137.538 1648.17 135.593 1649.05 L135.593 1631.69 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip920)" d="M49.5521 1403.32 L79.2279 1403.32 L79.2279 1407.25 L49.5521 1407.25 L49.5521 1403.32 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip920)" d="M89.3667 1385.59 L107.723 1385.59 L107.723 1389.52 L93.6491 1389.52 L93.6491 1398 Q94.6676 1397.65 95.6861 1397.49 Q96.7047 1397.3 97.7232 1397.3 Q103.51 1397.3 106.89 1400.47 Q110.269 1403.64 110.269 1409.06 Q110.269 1414.64 106.797 1417.74 Q103.325 1420.82 97.0056 1420.82 Q94.8297 1420.82 92.5612 1420.45 Q90.3158 1420.08 87.9084 1419.34 L87.9084 1414.64 Q89.9917 1415.77 92.2139 1416.33 Q94.4361 1416.88 96.913 1416.88 Q100.918 1416.88 103.256 1414.78 Q105.593 1412.67 105.593 1409.06 Q105.593 1405.45 103.256 1403.34 Q100.918 1401.24 96.913 1401.24 Q95.038 1401.24 93.163 1401.65 Q91.3112 1402.07 89.3667 1402.95 L89.3667 1385.59 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip920)" d="M119.482 1414.27 L124.367 1414.27 L124.367 1420.15 L119.482 1420.15 L119.482 1414.27 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip920)" d="M144.552 1388.67 Q140.941 1388.67 139.112 1392.23 Q137.306 1395.77 137.306 1402.9 Q137.306 1410.01 139.112 1413.57 Q140.941 1417.12 144.552 1417.12 Q148.186 1417.12 149.991 1413.57 Q151.82 1410.01 151.82 1402.9 Q151.82 1395.77 149.991 1392.23 Q148.186 1388.67 144.552 1388.67 M144.552 1384.96 Q150.362 1384.96 153.417 1389.57 Q156.496 1394.15 156.496 1402.9 Q156.496 1411.63 153.417 1416.24 Q150.362 1420.82 144.552 1420.82 Q138.741 1420.82 135.663 1416.24 Q132.607 1411.63 132.607 1402.9 Q132.607 1394.15 135.663 1389.57 Q138.741 1384.96 144.552 1384.96 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip920)" d="M50.5475 1157.22 L80.2233 1157.22 L80.2233 1161.15 L50.5475 1161.15 L50.5475 1157.22 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip920)" d="M94.3436 1170.11 L110.663 1170.11 L110.663 1174.04 L88.7186 1174.04 L88.7186 1170.11 Q91.3806 1167.35 95.9639 1162.73 Q100.57 1158.07 101.751 1156.73 Q103.996 1154.21 104.876 1152.47 Q105.779 1150.71 105.779 1149.02 Q105.779 1146.27 103.834 1144.53 Q101.913 1142.79 98.8111 1142.79 Q96.6121 1142.79 94.1584 1143.56 Q91.7278 1144.32 88.9501 1145.87 L88.9501 1141.15 Q91.7741 1140.02 94.2278 1139.44 Q96.6815 1138.86 98.7185 1138.86 Q104.089 1138.86 107.283 1141.54 Q110.478 1144.23 110.478 1148.72 Q110.478 1150.85 109.668 1152.77 Q108.881 1154.67 106.774 1157.26 Q106.195 1157.93 103.094 1161.15 Q99.9917 1164.35 94.3436 1170.11 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip920)" d="M120.478 1168.16 L125.362 1168.16 L125.362 1174.04 L120.478 1174.04 L120.478 1168.16 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip920)" d="M135.593 1139.48 L153.95 1139.48 L153.95 1143.42 L139.876 1143.42 L139.876 1151.89 Q140.894 1151.54 141.913 1151.38 Q142.931 1151.2 143.95 1151.2 Q149.737 1151.2 153.116 1154.37 Q156.496 1157.54 156.496 1162.96 Q156.496 1168.54 153.024 1171.64 Q149.552 1174.72 143.232 1174.72 Q141.056 1174.72 138.788 1174.35 Q136.542 1173.98 134.135 1173.23 L134.135 1168.54 Q136.218 1169.67 138.441 1170.23 Q140.663 1170.78 143.14 1170.78 Q147.144 1170.78 149.482 1168.67 Q151.82 1166.57 151.82 1162.96 Q151.82 1159.35 149.482 1157.24 Q147.144 1155.13 143.14 1155.13 Q141.265 1155.13 139.39 1155.55 Q137.538 1155.97 135.593 1156.85 L135.593 1139.48 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip920)" d="M99.3204 896.46 Q95.7093 896.46 93.8806 900.025 Q92.075 903.566 92.075 910.696 Q92.075 917.802 93.8806 921.367 Q95.7093 924.909 99.3204 924.909 Q102.955 924.909 104.76 921.367 Q106.589 917.802 106.589 910.696 Q106.589 903.566 104.76 900.025 Q102.955 896.46 99.3204 896.46 M99.3204 892.756 Q105.131 892.756 108.186 897.363 Q111.265 901.946 111.265 910.696 Q111.265 919.423 108.186 924.029 Q105.131 928.612 99.3204 928.612 Q93.5102 928.612 90.4315 924.029 Q87.376 919.423 87.376 910.696 Q87.376 901.946 90.4315 897.363 Q93.5102 892.756 99.3204 892.756 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip920)" d="M119.482 922.062 L124.367 922.062 L124.367 927.941 L119.482 927.941 L119.482 922.062 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip920)" d="M144.552 896.46 Q140.941 896.46 139.112 900.025 Q137.306 903.566 137.306 910.696 Q137.306 917.802 139.112 921.367 Q140.941 924.909 144.552 924.909 Q148.186 924.909 149.991 921.367 Q151.82 917.802 151.82 910.696 Q151.82 903.566 149.991 900.025 Q148.186 896.46 144.552 896.46 M144.552 892.756 Q150.362 892.756 153.417 897.363 Q156.496 901.946 156.496 910.696 Q156.496 919.423 153.417 924.029 Q150.362 928.612 144.552 928.612 Q138.741 928.612 135.663 924.029 Q132.607 919.423 132.607 910.696 Q132.607 901.946 135.663 897.363 Q138.741 892.756 144.552 892.756 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip920)" d="M94.3436 677.903 L110.663 677.903 L110.663 681.838 L88.7186 681.838 L88.7186 677.903 Q91.3806 675.148 95.9639 670.518 Q100.57 665.866 101.751 664.523 Q103.996 662 104.876 660.264 Q105.779 658.505 105.779 656.815 Q105.779 654.06 103.834 652.324 Q101.913 650.588 98.8111 650.588 Q96.6121 650.588 94.1584 651.352 Q91.7278 652.116 88.9501 653.667 L88.9501 648.944 Q91.7741 647.81 94.2278 647.231 Q96.6815 646.653 98.7185 646.653 Q104.089 646.653 107.283 649.338 Q110.478 652.023 110.478 656.514 Q110.478 658.643 109.668 660.565 Q108.881 662.463 106.774 665.055 Q106.195 665.727 103.094 668.944 Q99.9917 672.139 94.3436 677.903 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip920)" d="M120.478 675.958 L125.362 675.958 L125.362 681.838 L120.478 681.838 L120.478 675.958 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip920)" d="M135.593 647.278 L153.95 647.278 L153.95 651.213 L139.876 651.213 L139.876 659.685 Q140.894 659.338 141.913 659.176 Q142.931 658.991 143.95 658.991 Q149.737 658.991 153.116 662.162 Q156.496 665.333 156.496 670.75 Q156.496 676.329 153.024 679.43 Q149.552 682.509 143.232 682.509 Q141.056 682.509 138.788 682.139 Q136.542 681.768 134.135 681.028 L134.135 676.329 Q136.218 677.463 138.441 678.018 Q140.663 678.574 143.14 678.574 Q147.144 678.574 149.482 676.467 Q151.82 674.361 151.82 670.75 Q151.82 667.139 149.482 665.032 Q147.144 662.926 143.14 662.926 Q141.265 662.926 139.39 663.343 Q137.538 663.759 135.593 664.639 L135.593 647.278 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip920)" d="M89.3667 401.174 L107.723 401.174 L107.723 405.11 L93.6491 405.11 L93.6491 413.582 Q94.6676 413.235 95.6861 413.073 Q96.7047 412.887 97.7232 412.887 Q103.51 412.887 106.89 416.059 Q110.269 419.23 110.269 424.647 Q110.269 430.225 106.797 433.327 Q103.325 436.406 97.0056 436.406 Q94.8297 436.406 92.5612 436.035 Q90.3158 435.665 87.9084 434.924 L87.9084 430.225 Q89.9917 431.359 92.2139 431.915 Q94.4361 432.471 96.913 432.471 Q100.918 432.471 103.256 430.364 Q105.593 428.258 105.593 424.647 Q105.593 421.035 103.256 418.929 Q100.918 416.822 96.913 416.822 Q95.038 416.822 93.163 417.239 Q91.3112 417.656 89.3667 418.535 L89.3667 401.174 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip920)" d="M119.482 429.855 L124.367 429.855 L124.367 435.734 L119.482 435.734 L119.482 429.855 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip920)" d="M144.552 404.253 Q140.941 404.253 139.112 407.818 Q137.306 411.36 137.306 418.489 Q137.306 425.596 139.112 429.16 Q140.941 432.702 144.552 432.702 Q148.186 432.702 149.991 429.16 Q151.82 425.596 151.82 418.489 Q151.82 411.36 149.991 407.818 Q148.186 404.253 144.552 404.253 M144.552 400.549 Q150.362 400.549 153.417 405.156 Q156.496 409.739 156.496 418.489 Q156.496 427.216 153.417 431.822 Q150.362 436.406 144.552 436.406 Q138.741 436.406 135.663 431.822 Q132.607 427.216 132.607 418.489 Q132.607 409.739 135.663 405.156 Q138.741 400.549 144.552 400.549 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip920)" d="M89.1352 155.071 L111.357 155.071 L111.357 157.062 L98.8111 189.631 L93.9269 189.631 L105.732 159.006 L89.1352 159.006 L89.1352 155.071 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip920)" d="M120.478 183.751 L125.362 183.751 L125.362 189.631 L120.478 189.631 L120.478 183.751 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip920)" d="M135.593 155.071 L153.95 155.071 L153.95 159.006 L139.876 159.006 L139.876 167.478 Q140.894 167.131 141.913 166.969 Q142.931 166.784 143.95 166.784 Q149.737 166.784 153.116 169.955 Q156.496 173.127 156.496 178.543 Q156.496 184.122 153.024 187.224 Q149.552 190.302 143.232 190.302 Q141.056 190.302 138.788 189.932 Q136.542 189.562 134.135 188.821 L134.135 184.122 Q136.218 185.256 138.441 185.812 Q140.663 186.367 143.14 186.367 Q147.144 186.367 149.482 184.261 Q151.82 182.154 151.82 178.543 Q151.82 174.932 149.482 172.826 Q147.144 170.719 143.14 170.719 Q141.265 170.719 139.39 171.136 Q137.538 171.552 135.593 172.432 L135.593 155.071 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip922)" style="stroke:#009af9; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="265.984,1057.89 268.292,1414.18 270.6,1384.29 272.908,1323.04 275.216,1448.67 277.524,1207.29 279.832,1393.34 282.139,1477.34 284.447,1392.31 286.755,1326.51 289.063,1352.11 291.371,1645.87 293.679,1243.85 295.987,1563.89 298.295,1264.78 300.603,1336.04 302.911,1374.3 305.219,1541.17 307.527,1440.31 309.834,1508.6 312.142,1208.94 314.45,1332.59 316.758,1321.56 319.066,1373.16 321.374,1435.45 323.682,1410.75 325.99,1471.04 328.298,1424.25 330.606,1387.96 332.914,1302.55 335.221,1387.13 337.529,1313.48 339.837,1378.65 342.145,1370.77 344.453,1530.51 346.761,1312.69 349.069,1371.02 351.377,1377.7 353.685,1370.06 355.993,1426.79 358.301,1343.63 360.608,1260.79 362.916,1303.13 365.224,1572.16 367.532,1307.01 369.84,1397.66 372.148,1531.01 374.456,1450.39 376.764,1473.6 379.072,1401.5 381.38,1366.2 383.688,1419.92 385.996,1357.1 388.303,1392.66 390.611,1340.12 392.919,1498.58 395.227,1321.63 397.535,1273.2 399.843,1316.38 402.151,1445.16 404.459,1306.08 406.767,1247.95 409.075,1413.12 411.383,1576.95 413.69,1506.77 415.998,1459.15 418.306,1266.17 420.614,1576.09 422.922,1312.21 425.23,1312.29 427.538,1476.68 429.846,1404.46 432.154,1523.45 434.462,1450.06 436.77,1451.46 439.077,1405.15 441.385,1395.64 443.693,1697.43 446.001,1272.32 448.309,1354.01 450.617,1478.33 452.925,1450.42 455.233,1306.01 457.541,1434.95 459.849,1360.56 462.157,1489.42 464.465,1300.3 466.772,1390.09 469.08,1386.84 471.388,1473.98 473.696,1425.8 476.004,1424.71 478.312,1314.05 480.62,1439.34 482.928,1399.82 485.236,1263.24 487.544,1457.89 489.852,1285.59 492.159,1576.74 494.467,1404.33 496.775,1492.14 499.083,1420.4 501.391,1264.06 503.699,1500.15 506.007,1339.9 508.315,1404.45 510.623,1578.47 512.931,1511.23 515.239,1592.07 517.546,1525.72 519.854,1336.92 522.162,1542.68 524.47,1510.89 526.778,1495.18 529.086,1331.29 531.394,1204.64 533.702,1277.52 536.01,1433.62 538.318,1506.6 540.626,1523.64 542.933,1529.84 545.241,1436.53 547.549,1424.94 549.857,1387.23 552.165,1510.22 554.473,1428.6 556.781,1464.27 559.089,1272.59 561.397,1334.26 563.705,1557.82 566.013,1345.03 568.321,1495.46 570.628,1485.91 572.936,1369.63 575.244,1568.57 577.552,1482.54 579.86,1497.95 582.168,1398.47 584.476,1259.65 586.784,1398.77 589.092,1390.11 591.4,1488.65 593.708,1427.39 596.015,1518.77 598.323,1286.03 600.631,1436.61 602.939,1287.65 605.247,1339.2 607.555,1403.21 609.863,1513.91 612.171,1424.61 614.479,1402.31 616.787,1366.37 619.095,1375.98 621.402,1365.59 623.71,1387.85 626.018,1396.1 628.326,1586.55 630.634,1308.83 632.942,1435.56 635.25,1377.84 637.558,1440.26 639.866,1388.98 642.174,1338.06 644.482,1408.07 646.79,1373.94 649.097,1334.02 651.405,1444.46 653.713,1343.6 656.021,1446.54 658.329,1335.35 660.637,1414.45 662.945,1286.79 665.253,1396.72 667.561,1392.09 669.869,1450.83 672.177,1473 674.484,1597.27 676.792,1693.08 679.1,1470.61 681.408,1438.31 683.716,1289.94 686.024,1357 688.332,1307.29 690.64,1473.18 692.948,1458.98 695.256,1519.87 697.564,1256.95 699.871,1416.48 702.179,1283.13 704.487,1432.65 706.795,1453.89 709.103,1366.78 711.411,1401.99 713.719,1321.86 716.027,1425.04 718.335,1306.8 720.643,1559.13 722.951,1259.14 725.259,1426.55 727.566,1421.45 729.874,1472.6 732.182,1415.57 734.49,1178.5 736.798,1510.03 739.106,1178.51 741.414,1425.17 743.722,1543.42 746.03,1399.7 748.338,1194.94 750.646,1459.73 752.953,1449.13 755.261,1526.31 757.569,1538.14 759.877,1482.38 762.185,1459.92 764.493,1123.39 766.801,1283.27 769.109,1613.19 771.417,1292.46 773.725,1467.38 776.033,1386.57 778.34,1332.06 780.648,1455.96 782.956,1449.82 785.264,1398.17 787.572,1543.82 789.88,1348.65 792.188,1264.62 794.496,1303.91 796.804,1488.5 799.112,1350.1 801.42,1381.66 803.728,1288.01 806.035,1592.27 808.343,1503.02 810.651,1462.96 812.959,1604.63 815.267,1467.03 817.575,1332.43 819.883,1554.39 822.191,1431.77 824.499,1751.15 826.807,1332.53 829.115,1381.43 831.422,1318.9 833.73,1437.61 836.038,1553.81 838.346,1463.8 840.654,1487.41 842.962,1462.44 845.27,1357.77 847.578,1288.71 849.886,1320.59 852.194,1312.16 854.502,1276.21 856.809,1503.54 859.117,1435.53 861.425,1359.27 863.733,1366 866.041,1405.76 868.349,1355.57 870.657,1386.28 872.965,1431.55 875.273,1359.97 877.581,1474.26 879.889,1620.46 882.197,1474.29 884.504,1464.07 886.812,1502.22 889.12,1391.1 891.428,1481.6 893.736,1309.88 896.044,1352.65 898.352,1297.51 900.66,1540.55 902.968,1321.99 905.276,1416.86 907.584,1541.07 909.891,1454.57 912.199,1171.03 914.507,1457.61 916.815,1162.38 919.123,1488.44 921.431,1430.9 923.739,1296.44 926.047,1463.96 928.355,1558.39 930.663,1385.16 932.971,1508.19 935.278,1347.36 937.586,1375.88 939.894,1499.12 942.202,1313.2 944.51,1440.69 946.818,1296.48 949.126,1301.41 951.434,1427.61 953.742,1351.12 956.05,1262.71 958.358,1381.87 960.665,1442.64 962.973,1315.02 965.281,1386.53 967.589,1455.68 969.897,1399.53 972.205,1560.66 974.513,1420.33 976.821,1532.54 979.129,1312.27 981.437,1203.88 983.745,1564.91 986.053,1537.78 988.36,1357.27 990.668,1296.87 992.976,1506.27 995.284,1346.92 997.592,1559.5 999.9,1234.04 1002.21,1411.6 1004.52,1446.66 1006.82,1390.42 1009.13,1401.48 1011.44,1485.38 1013.75,1330.14 1016.06,1363.97 1018.36,1387.71 1020.67,1285.84 1022.98,1420.08 1025.29,1324.34 1027.59,1458.72 1029.9,1235.65 1032.21,1268.27 1034.52,1566.84 1036.83,1431.94 1039.13,1551.89 1041.44,1274.5 1043.75,1286.37 1046.06,1407.57 1048.37,1274.37 1050.67,1435.36 1052.98,1420.36 1055.29,1383.3 1057.6,1445.9 1059.91,1588.37 1062.21,1372.33 1064.52,1333.92 1066.83,1499.59 1069.14,1527 1071.45,1529.63 1073.75,1516.23 1076.06,1442.77 1078.37,1347.39 1080.68,1278.49 1082.98,1400.04 1085.29,1391.53 1087.6,1513.18 1089.91,1529.58 1092.22,1508.9 1094.52,1376.42 1096.83,1310.55 1099.14,1432.76 1101.45,1443.35 1103.76,1441.34 1106.06,1354.14 1108.37,1361.31 1110.68,1250.66 1112.99,1528.67 1115.3,1408.47 1117.6,1340.35 1119.91,1407.84 1122.22,1259.98 1124.53,1500.78 1126.84,1610.56 1129.14,1208.15 1131.45,1327.36 1133.76,1463.38 1136.07,1323.88 1138.37,1524.91 1140.68,1493.25 1142.99,1497.72 1145.3,1502.19 1147.61,1284.78 1149.91,1438.3 1152.22,1212.83 1154.53,1342.98 1156.84,1537.65 1159.15,1174.37 1161.45,1465.88 1163.76,1389.59 1166.07,1372.45 1168.38,1416.86 1170.69,1613.31 1172.99,1360.82 1175.3,1409.95 1177.61,1350.33 1179.92,1365.79 1182.23,1502.03 1184.53,1399.89 1186.84,1466.22 1189.15,1407.41 1191.46,1409.78 1193.76,1275.32 1196.07,1480.37 1198.38,1300.54 1200.69,1461.04 1203,1412.3 1205.3,1309.5 1207.61,1440.18 1209.92,1463.35 1212.23,1537.87 1214.54,1384.52 1216.84,1287.57 1219.15,1207.12 1221.46,1411.76 1223.77,1196.25 1226.08,1269.46 1228.38,1491.47 1230.69,1307.91 1233,1277.06 1235.31,1241.39 1237.61,1353.04 1239.92,1362.33 1242.23,1417.29 1244.54,1285.52 1246.85,1298.18 1249.15,1383.79 1251.46,1395.46 1253.77,1388.95 1256.08,1472.6 1258.39,1300.26 1260.69,1484.41 1263,1397.87 1265.31,1270.6 1267.62,1318.15 1269.93,1608.58 1272.23,1475.22 1274.54,1476.74 1276.85,1461.45 1279.16,1497.34 1281.47,1532.4 1283.77,1381.8 1286.08,1437.94 1288.39,1288.3 1290.7,1437 1293,1473.95 1295.31,1425.44 1297.62,1393.68 1299.93,1314.59 1302.24,1327.3 1304.54,1185.85 1306.85,1605.12 1309.16,1353.99 1311.47,1396.91 1313.78,1570.62 1316.08,1511.3 1318.39,1607.22 1320.7,1299.53 1323.01,1596.39 1325.32,1390.88 1327.62,1415.34 1329.93,1411.13 1332.24,1305.81 1334.55,1301.42 1336.86,1576.73 1339.16,1396.59 1341.47,1446.25 1343.78,1436.02 1346.09,1457.05 1348.39,1548.86 1350.7,1433.42 1353.01,1438.74 1355.32,1457.3 1357.63,1317.28 1359.93,1372.43 1362.24,1495.31 1364.55,1266 1366.86,1427.04 1369.17,1389.43 1371.47,1443.03 1373.78,1244.51 1376.09,1283.72 1378.4,1430.08 1380.71,1532.27 1383.01,1301.88 1385.32,1410.8 1387.63,1417.59 1389.94,1292.92 1392.24,1536.49 1394.55,1486.04 1396.86,1479.79 1399.17,1423.59 1401.48,1323.86 1403.78,1467.05 1406.09,1398.78 1408.4,1408.99 1410.71,1264.25 1413.02,1276.05 1415.32,1354.9 1417.63,1431.23 1419.94,1333.14 1422.25,1297.1 1424.56,1359.59 1426.86,1416.58 1429.17,1465.03 1431.48,1605.64 1433.79,1282.49 1436.1,1448.11 1438.4,1392.38 1440.71,1381.8 1443.02,1395.31 1445.33,1329.4 1447.63,1351.53 1449.94,1462.86 1452.25,1336.73 1454.56,1306.02 1456.87,1361.77 1459.17,1456.76 1461.48,1499.73 1463.79,1180.06 1466.1,1470.29 1468.41,1518.05 1470.71,1447.61 1473.02,1394.38 1475.33,1478.23 1477.64,1414.06 1479.95,1447.38 1482.25,1221.73 1484.56,1379.08 1486.87,1286.03 1489.18,1458.61 1491.49,1477 1493.79,1314.48 1496.1,1532.23 1498.41,1499.51 1500.72,1258.53 1503.02,1455.3 1505.33,1261.18 1507.64,1477.13 1509.95,1643.47 1512.26,1310.36 1514.56,1539.14 1516.87,1248.41 1519.18,1431.76 1521.49,1371.37 1523.8,1489.67 1526.1,1647.55 1528.41,1393.1 1530.72,1457.07 1533.03,1384.48 1535.34,1421.15 1537.64,1250.59 1539.95,1420.61 1542.26,1469.25 1544.57,1480.52 1546.88,1436.82 1549.18,1547.83 1551.49,1351.38 1553.8,1418.3 1556.11,1448.83 1558.41,1544.65 1560.72,1276.48 1563.03,1346.67 1565.34,1277.74 1567.65,1469.47 1569.95,1364.12 1572.26,1414.97 1574.57,1384.52 1576.88,1352.77 1579.19,1173.57 1581.49,1264.42 1583.8,1365.58 1586.11,1427.84 1588.42,1353.48 1590.73,1511.7 1593.03,1440.39 1595.34,1498.9 1597.65,1522.47 1599.96,1206.41 1602.26,1371 1604.57,1399.71 1606.88,1387.31 1609.19,1572.02 1611.5,1378.83 1613.8,1325.66 1616.11,1311.83 1618.42,1450.41 1620.73,1339.71 1623.04,1138.75 1625.34,1328.3 1627.65,1616.12 1629.96,1416.7 1632.27,1443.96 1634.58,1393.89 1636.88,1378.61 1639.19,1411.15 1641.5,1556.54 1643.81,1358.83 1646.12,1360.91 1648.42,1393.14 1650.73,1473.08 1653.04,1370.9 1655.35,1453.21 1657.65,1516.29 1659.96,1650.34 1662.27,1562.55 1664.58,1420.83 1666.89,1436.13 1669.19,1484.07 1671.5,1467.9 1673.81,1409.14 1676.12,1517.2 1678.43,1483.26 1680.73,1587.53 1683.04,1148.12 1685.35,1586.38 1687.66,1491.75 1689.97,1453.58 1692.27,1457.16 1694.58,1417.54 1696.89,1537.18 1699.2,1565.7 1701.51,1262.03 1703.81,1435.99 1706.12,1418.34 1708.43,1339.7 1710.74,1207.45 1713.04,1417.71 1715.35,1540.35 1717.66,1459.09 1719.97,1375.56 1722.28,1351.33 1724.58,1581.19 1726.89,1559.37 1729.2,1450.43 1731.51,1528.29 1733.82,1380.19 1736.12,1332.46 1738.43,1545.24 1740.74,1384.23 1743.05,1593 1745.36,1439.43 1747.66,1409.88 1749.97,1448.73 1752.28,1397.13 1754.59,1341.71 1756.9,1387.28 1759.2,1282.5 1761.51,1499.34 1763.82,1571.98 1766.13,1442.22 1768.43,1569.04 1770.74,1311.99 1773.05,1462.68 1775.36,1475.11 1777.67,1483.15 1779.97,1580.91 1782.28,1412.23 1784.59,1475.26 1786.9,1480.45 1789.21,1222.24 1791.51,1275.09 1793.82,1527.92 1796.13,1539.9 1798.44,1275 1800.75,1401.83 1803.05,1368.41 1805.36,1588.23 1807.67,1309.31 1809.98,1312.11 1812.28,1233.93 1814.59,1539.39 1816.9,1328.8 1819.21,1459.09 1821.52,1532.2 1823.82,1419.06 1826.13,1554.47 1828.44,1473.51 1830.75,1222.26 1833.06,1369.03 1835.36,1282.42 1837.67,1360.83 1839.98,1375.12 1842.29,1490.72 1844.6,1445.03 1846.9,1489.54 1849.21,1388.18 1851.52,1479.03 1853.83,1452.14 1856.14,1379.13 1858.44,1168.3 1860.75,1545.92 1863.06,1400.4 1865.37,1581.34 1867.67,1470.64 1869.98,1421.03 1872.29,1289.56 1874.6,1326.37 1876.91,1472.28 1879.21,1395.44 1881.52,1476.05 1883.83,1454.66 1886.14,1351.32 1888.45,1336.48 1890.75,1417.03 1893.06,1375.48 1895.37,1276.87 1897.68,1429.64 1899.99,1440.32 1902.29,1456.52 1904.6,1195.2 1906.91,1544 1909.22,1419.49 1911.53,1102.25 1913.83,1327.79 1916.14,1553.5 1918.45,1344.63 1920.76,1482.43 1923.06,1353.04 1925.37,1589.53 1927.68,1286.44 1929.99,1477.06 1932.3,1442.09 1934.6,1375.58 1936.91,1479.82 1939.22,1306.26 1941.53,1292.05 1943.84,1361.7 1946.14,1274.85 1948.45,1398.05 1950.76,1241.49 1953.07,1351.58 1955.38,1455.07 1957.68,1338.37 1959.99,1340.68 1962.3,1250.42 1964.61,1339.53 1966.91,1407.72 1969.22,1317.91 1971.53,1311.22 1973.84,1302.17 1976.15,1499.83 1978.45,1386.47 1980.76,1214.58 1983.07,1327.27 1985.38,1535.2 1987.69,1257.25 1989.99,1344.77 1992.3,1369.84 1994.61,1215.05 1996.92,1478.53 1999.23,1289.2 2001.53,1332.73 2003.84,1452.88 2006.15,1378.49 2008.46,1345.55 2010.77,1445.23 2013.07,1234.25 2015.38,1560.04 2017.69,1565.89 2020,1260.84 2022.3,1348.64 2024.61,1436.65 2026.92,1393.58 2029.23,1344.92 2031.54,1454.07 2033.84,1321.51 2036.15,1320.81 2038.46,1357.08 2040.77,1482.46 2043.08,1327.46 2045.38,1347.34 2047.69,1319.96 2050,1495.53 2052.31,1407.51 2054.62,1376.42 2056.92,1453.7 2059.23,1413.51 2061.54,1347.18 2063.85,1271.63 2066.16,1428.93 2068.46,1378.17 2070.77,1365.85 2073.08,1358.97 2075.39,1400.08 2077.69,1334.22 2080,1429.12 2082.31,1430.27 2084.62,1659.46 2086.93,1399.02 2089.23,1318.12 2091.54,1280.09 2093.85,1435.34 2096.16,1572.57 2098.47,1441.58 2100.77,1446.16 2103.08,1398.72 2105.39,1532.54 2107.7,1539.82 2110.01,1614.16 2112.31,1365.92 2114.62,1280.33 2116.93,1347.34 2119.24,1456.2 2121.55,1400.12 2123.85,1162.03 2126.16,1443.03 2128.47,1359.8 2130.78,1346.69 2133.08,1402.31 2135.39,1377.83 2137.7,1520.43 2140.01,1380.19 2142.32,1346.85 2144.62,1536.14 2146.93,1309.31 2149.24,1344.59 2151.55,1307.48 2153.86,1384.38 2156.16,1538.65 2158.47,1395.52 2160.78,1488.09 2163.09,1265.93 2165.4,1260.57 2167.7,1487.35 2170.01,1493.47 2172.32,1350.81 2174.63,1411.7 2176.93,1378.07 2179.24,1488.98 2181.55,1468.87 2183.86,1464.05 2186.17,1492.47 2188.47,1554.2 2190.78,1370.96 2193.09,1234.71 2195.4,1325.13 2197.71,1262.77 2200.01,1351.27 2202.32,1428.23 2204.63,1395.36 2206.94,1292.52 2209.25,1389.43 2211.55,1284.03 2213.86,1467.21 2216.17,1373.57 2218.48,1378.91 2220.79,1340.8 2223.09,1202.72 2225.4,1395.14 2227.71,1258.54 2230.02,1343.09 2232.32,1366.6 2234.63,1489.38 2236.94,1312.47 2239.25,1298.13 2241.56,1179.59 2243.86,1384.31 2246.17,1274.89 2248.48,1553.47 2250.79,1654.88 2253.1,1430.59 2255.4,1343.34 2257.71,1422.55 2260.02,1485.15 2262.33,1437.31 2264.64,1449.51 2266.94,1347.36 2269.25,1254.45 2271.56,1342.21 2273.87,1413.74 2276.18,1469.08 2278.48,1412.7 2280.79,1366.92 2283.1,1448.27 2285.41,1519.24 2287.71,1514.95 2290.02,1370.57 2292.33,1446.7 2294.64,1411.39 2296.95,1312.82 2299.25,1471.93 2301.56,1481.87 2303.87,1379.21 2306.18,1530.62 2308.49,1339.63 2310.79,1226.99 2313.1,1478.37 2315.41,1306.91 2317.72,1367.71 2320.03,1487.49 2322.33,1360.31 2324.64,1440.01 2326.95,1283.23 2329.26,1334.91 2331.56,1296.14 2333.87,1421.43 2336.18,1544.12 2338.49,1555.77 2340.8,1310.03 2343.1,1457.46 2345.41,1215.22 2347.72,1489.45 2350.03,1432.36 2352.34,1379.44 2354.64,1386.4 2356.95,1469 2359.26,1640.98 2361.57,1255.05 2363.88,1302.22 2366.18,1389.17 2368.49,1333.04 2370.8,1428.01 2373.11,1296.73 2375.42,1458.8 2377.72,1333.42 2380.03,1429.24 2382.34,1441.59 2384.65,1299.15 2386.95,1385.33 2389.26,1486.41 2391.57,1392.95 2393.88,1350.83 2396.19,1467.33 2398.49,1413.84 2400.8,1454.01 2403.11,1456.87 2405.42,1322.48 2407.73,1377.42 2410.03,1418.57 2412.34,1472.59 2414.65,1395.78 2416.96,1497.55 2419.27,1407.89 2421.57,1381.44 2423.88,1420.23 2426.19,1300.43 2428.5,1441.47 2430.81,1237.1 2433.11,1546.76 2435.42,1294.14 2437.73,1501.18 2440.04,1407.77 2442.34,1526.79 2444.65,1487.44 2446.96,1583.97 2449.27,1349.53 2451.58,1506.83 2453.88,1369.62 2456.19,1404.16 2458.5,1655.52 2460.81,1391.95 2463.12,1430.67 2465.42,1166.56 2467.73,1322.69 2470.04,1496.04 2472.35,1425.87 2474.66,1388.33 2476.96,1432.46 2479.27,1307.69 2481.58,1497.85 2483.89,1312.09 2486.2,1535.82 2488.5,1299.46 2490.81,1428 2493.12,1497.39 2495.43,1369.89 2497.73,1285.03 2500.04,1255.26 2502.35,1669.69 2504.66,1397.9 2506.97,1577.81 2509.27,1509.3 2511.58,1356.75 2513.89,1464.61 2516.2,1411.02 2518.51,1382.07 2520.81,1489.79 2523.12,1387.9 2525.43,1627.07 2527.74,1490.22 2530.05,1361.34 2532.35,1445.57 2534.66,1509.12 2536.97,1441.36 2539.28,1200.63 2541.58,1378.85 2543.89,1476.22 2546.2,1452.09 2548.51,1324.79 2550.82,1443.58 2553.12,1418.51 2555.43,1265.11 2557.74,1501.72 2560.05,1528.2 2562.36,1368.2 2564.66,1454.25 2566.97,1336.82 2569.28,1410.71 2571.59,1302.73 "></polyline>
<polyline clip-path="url(#clip922)" style="stroke:#e26f46; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="265.984,811.826 268.292,1047.87 270.6,876.65 272.908,814.044 275.216,979.886 277.524,887.965 279.832,1106.49 282.139,848.379 284.447,844.527 286.755,1110.29 289.063,892.361 291.371,921.956 293.679,982.376 295.987,605.334 298.295,808.454 300.603,884.63 302.911,970.427 305.219,828.334 307.527,1012.41 309.834,737.586 312.142,1077.12 314.45,980.568 316.758,978.449 319.066,825.673 321.374,830.645 323.682,804.314 325.99,957.299 328.298,982.983 330.606,830.141 332.914,1057.83 335.221,828.764 337.529,912.208 339.837,1001.2 342.145,798.142 344.453,877.613 346.761,947.128 349.069,840.577 351.377,909.934 353.685,801.525 355.993,936.315 358.301,886.039 360.608,959.331 362.916,1104.54 365.224,852.173 367.532,975.757 369.84,802.044 372.148,1030.93 374.456,775.522 376.764,811.389 379.072,905.162 381.38,853.686 383.688,807.122 385.996,937.347 388.303,995.59 390.611,1107.53 392.919,721.118 395.227,1179.89 397.535,881.767 399.843,894.867 402.151,698.32 404.459,902.345 406.767,818.541 409.075,907.829 411.383,805.007 413.69,779.128 415.998,791.929 418.306,1106.06 420.614,898.355 422.922,786.802 425.23,915.846 427.538,834.427 429.846,917.142 432.154,767.578 434.462,683.318 436.77,954.139 439.077,935.659 441.385,1014.35 443.693,871.364 446.001,751.919 448.309,880.748 450.617,729.323 452.925,862.708 455.233,968.204 457.541,872.969 459.849,941.247 462.157,944.539 464.465,849.744 466.772,827.154 469.08,838.292 471.388,1021.42 473.696,799.73 476.004,894.212 478.312,750.706 480.62,886.692 482.928,937.314 485.236,942.901 487.544,1024.6 489.852,879.864 492.159,963.424 494.467,971.451 496.775,796.397 499.083,920.356 501.391,992.741 503.699,862.513 506.007,995.936 508.315,852.824 510.623,847.061 512.931,890.872 515.239,999.61 517.546,822.982 519.854,704.866 522.162,1025.34 524.47,845.062 526.778,966.401 529.086,978.864 531.394,877.363 533.702,842.289 536.01,944.203 538.318,910.655 540.626,829.978 542.933,938.107 545.241,962.769 547.549,1009.1 549.857,924.73 552.165,797.375 554.473,892.8 556.781,1117.51 559.089,834.292 561.397,986.767 563.705,718.896 566.013,906.019 568.321,839.528 570.628,909.003 572.936,821.763 575.244,1032.27 577.552,899.794 579.86,997.135 582.168,1011.77 584.476,918.322 586.784,905.884 589.092,936.739 591.4,904.55 593.708,709.755 596.015,836.258 598.323,1020.47 600.631,929.958 602.939,838.033 605.247,950.035 607.555,773.642 609.863,897.872 612.171,911.647 614.479,910.33 616.787,1063.85 619.095,936.105 621.402,902.034 623.71,1139.33 626.018,881.761 628.326,847.172 630.634,839.361 632.942,896.859 635.25,776.928 637.558,971.332 639.866,747.162 642.174,901.293 644.482,838.227 646.79,927.162 649.097,932.669 651.405,877.082 653.713,875.219 656.021,855.913 658.329,918.311 660.637,872.846 662.945,936.29 665.253,942.058 667.561,898.238 669.869,1160.31 672.177,969.072 674.484,922.33 676.792,883.309 679.1,1022.72 681.408,1062.01 683.716,901.951 686.024,1064.22 688.332,844.949 690.64,926.811 692.948,752.221 695.256,1023.38 697.564,972.652 699.871,920.961 702.179,968.958 704.487,847.891 706.795,1019.21 709.103,969.855 711.411,1001.52 713.719,907.067 716.027,1018.65 718.335,825.258 720.643,946.738 722.951,979.361 725.259,939.102 727.566,1031.82 729.874,804.894 732.182,1060.75 734.49,932.313 736.798,823.263 739.106,933.529 741.414,942.458 743.722,881.018 746.03,789.188 748.338,938.644 750.646,1058.13 752.953,921.793 755.261,883.422 757.569,998.822 759.877,947.614 762.185,864.784 764.493,867.58 766.801,868.905 769.109,889.769 771.417,923.729 773.725,861.926 776.033,881.619 778.34,1051.58 780.648,799.772 782.956,1004.97 785.264,913.33 787.572,909.171 789.88,920.95 792.188,764.499 794.496,679.636 796.804,1019.82 799.112,1025.78 801.42,1046.68 803.728,843.384 806.035,910.15 808.343,1036.48 810.651,874.314 812.959,894.226 815.267,889.814 817.575,954.142 819.883,879.024 822.191,1066.57 824.499,883.621 826.807,823.442 829.115,825.837 831.422,830.75 833.73,849.838 836.038,817.535 838.346,953.198 840.654,935.216 842.962,943.943 845.27,1013.55 847.578,992.901 849.886,1104.45 852.194,1050.77 854.502,817.269 856.809,973.902 859.117,954.411 861.425,1067.29 863.733,957.323 866.041,929.978 868.349,1032.15 870.657,964.898 872.965,876.529 875.273,978.837 877.581,938.884 879.889,895.307 882.197,924.216 884.504,942.369 886.812,991.707 889.12,820.112 891.428,991.645 893.736,899.419 896.044,884.328 898.352,771.606 900.66,941.86 902.968,834.463 905.276,927.633 907.584,837.547 909.891,691.209 912.199,724.031 914.507,976.266 916.815,1045.9 919.123,1127.12 921.431,878.123 923.739,933.864 926.047,886.961 928.355,799.08 930.663,825.92 932.971,902.86 935.278,879.867 937.586,866.218 939.894,904.281 942.202,945.937 944.51,795.989 946.818,924.06 949.126,861.015 951.434,842.237 953.742,964.659 956.05,858.556 958.358,928.339 960.665,925.749 962.973,844.187 965.281,1031.67 967.589,728.857 969.897,1006.31 972.205,905.449 974.513,1006 976.821,881.128 979.129,871.211 981.437,932.786 983.745,777.912 986.053,601.283 988.36,796.306 990.668,713.065 992.976,739.407 995.284,926.917 997.592,964.946 999.9,940.367 1002.21,941.405 1004.52,888.959 1006.82,1010.72 1009.13,723.211 1011.44,887.961 1013.75,1030.52 1016.06,971.552 1018.36,869.402 1020.67,912.719 1022.98,975.749 1025.29,934.52 1027.59,943.05 1029.9,890.069 1032.21,815.069 1034.52,723.389 1036.83,810.696 1039.13,804.205 1041.44,910.36 1043.75,859.643 1046.06,1031.39 1048.37,774.419 1050.67,772.801 1052.98,890.613 1055.29,992.331 1057.6,998.72 1059.91,867.032 1062.21,890.643 1064.52,895.655 1066.83,934.583 1069.14,697.921 1071.45,604.618 1073.75,922.739 1076.06,706.958 1078.37,879.495 1080.68,772.58 1082.98,808.003 1085.29,932.356 1087.6,968.627 1089.91,889.791 1092.22,855.426 1094.52,728.099 1096.83,891.417 1099.14,995.177 1101.45,971.139 1103.76,792.585 1106.06,879.762 1108.37,899.009 1110.68,870.865 1112.99,771.774 1115.3,991.617 1117.6,895.537 1119.91,980.038 1122.22,980.841 1124.53,939.72 1126.84,1062.25 1129.14,990.176 1131.45,1055.67 1133.76,882.565 1136.07,967.179 1138.37,1026.48 1140.68,861.399 1142.99,774.534 1145.3,723.166 1147.61,959.01 1149.91,983.281 1152.22,876.58 1154.53,882.843 1156.84,843.171 1159.15,918.969 1161.45,684.374 1163.76,729.57 1166.07,1112.33 1168.38,1026.72 1170.69,814.526 1172.99,825.979 1175.3,916.228 1177.61,965.979 1179.92,1041.16 1182.23,877.707 1184.53,630.101 1186.84,891.852 1189.15,951.132 1191.46,1108.69 1193.76,944.809 1196.07,983.384 1198.38,1011.21 1200.69,812.278 1203,1076.82 1205.3,839.384 1207.61,858.499 1209.92,847.103 1212.23,865.123 1214.54,948.163 1216.84,948.824 1219.15,845.556 1221.46,847.809 1223.77,860.265 1226.08,889.17 1228.38,826.094 1230.69,839.795 1233,796.23 1235.31,844.524 1237.61,883.093 1239.92,919.224 1242.23,902.651 1244.54,781.006 1246.85,862.624 1249.15,1039.31 1251.46,989.882 1253.77,973.337 1256.08,954.428 1258.39,1005.78 1260.69,935.358 1263,1022.62 1265.31,908.19 1267.62,781.018 1269.93,1002.46 1272.23,814.366 1274.54,992.474 1276.85,919.847 1279.16,990.257 1281.47,844.003 1283.77,967.973 1286.08,857.872 1288.39,752.194 1290.7,955.407 1293,1002.92 1295.31,928.953 1297.62,930.306 1299.93,998.964 1302.24,1018.42 1304.54,1004.25 1306.85,867.737 1309.16,983.735 1311.47,1046.16 1313.78,1055.68 1316.08,738.344 1318.39,1006.46 1320.7,988.853 1323.01,794.977 1325.32,793.146 1327.62,606.155 1329.93,823.361 1332.24,869.938 1334.55,948.114 1336.86,1000.52 1339.16,845.245 1341.47,839.346 1343.78,964.423 1346.09,916.892 1348.39,1036.64 1350.7,933.41 1353.01,934.751 1355.32,921.645 1357.63,970.946 1359.93,861.754 1362.24,722.902 1364.55,885.181 1366.86,955.158 1369.17,996.727 1371.47,854.868 1373.78,839.383 1376.09,918.92 1378.4,785.946 1380.71,962.263 1383.01,761.767 1385.32,1051.36 1387.63,814.992 1389.94,955.069 1392.24,919.184 1394.55,877.51 1396.86,933.587 1399.17,798.355 1401.48,843.831 1403.78,948.913 1406.09,811.485 1408.4,790.867 1410.71,818.342 1413.02,1086.74 1415.32,821.8 1417.63,815.999 1419.94,929.617 1422.25,943.298 1424.56,953.671 1426.86,826.68 1429.17,852.272 1431.48,953.85 1433.79,1060.36 1436.1,1102.12 1438.4,1005.32 1440.71,943.286 1443.02,904.965 1445.33,812.831 1447.63,1029.02 1449.94,851.87 1452.25,917.257 1454.56,854.458 1456.87,1014.9 1459.17,990.001 1461.48,895.967 1463.79,928.377 1466.1,810.817 1468.41,900.258 1470.71,936.692 1473.02,921.319 1475.33,851.231 1477.64,975.766 1479.95,839.352 1482.25,865.686 1484.56,916.642 1486.87,990.635 1489.18,1007 1491.49,840.542 1493.79,788.033 1496.1,929.145 1498.41,1027.33 1500.72,941.897 1503.02,781.809 1505.33,947.885 1507.64,1028.05 1509.95,705.345 1512.26,849.694 1514.56,900.648 1516.87,818.116 1519.18,822.176 1521.49,753.207 1523.8,854.47 1526.1,904.375 1528.41,921.917 1530.72,814.033 1533.03,792.118 1535.34,992.366 1537.64,972.329 1539.95,902.775 1542.26,824.934 1544.57,1053.94 1546.88,874.508 1549.18,856.128 1551.49,816.828 1553.8,795.584 1556.11,923.412 1558.41,1021.44 1560.72,806.269 1563.03,1006.39 1565.34,841.969 1567.65,820.107 1569.95,899.522 1572.26,924.435 1574.57,861.8 1576.88,745.256 1579.19,984.017 1581.49,813.812 1583.8,808.246 1586.11,889.872 1588.42,935.197 1590.73,1055.86 1593.03,892.103 1595.34,879.203 1597.65,977.625 1599.96,956.876 1602.26,970.932 1604.57,974.372 1606.88,817.214 1609.19,996.198 1611.5,830.557 1613.8,990.468 1616.11,876.368 1618.42,906.546 1620.73,1057.37 1623.04,787.362 1625.34,883.621 1627.65,858.475 1629.96,1010.49 1632.27,985.809 1634.58,1085.74 1636.88,755.446 1639.19,865.13 1641.5,896.954 1643.81,889.075 1646.12,954.98 1648.42,809.473 1650.73,975.563 1653.04,836.644 1655.35,702.791 1657.65,951.953 1659.96,849.503 1662.27,1015.8 1664.58,942.249 1666.89,897.169 1669.19,854.753 1671.5,953.57 1673.81,784.588 1676.12,1230.68 1678.43,1054.53 1680.73,853.397 1683.04,924.311 1685.35,876.915 1687.66,1011.01 1689.97,1008.12 1692.27,956.923 1694.58,669.801 1696.89,1161.23 1699.2,837.039 1701.51,902.35 1703.81,921.593 1706.12,987.475 1708.43,1026.86 1710.74,832.131 1713.04,989.195 1715.35,1012.44 1717.66,991.434 1719.97,940.331 1722.28,943.957 1724.58,1002.99 1726.89,971.318 1729.2,935.738 1731.51,888.481 1733.82,1092.55 1736.12,1035.89 1738.43,747.259 1740.74,869.367 1743.05,922.328 1745.36,902.946 1747.66,952.897 1749.97,882.852 1752.28,1168.16 1754.59,885.791 1756.9,624.846 1759.2,870.29 1761.51,1097.4 1763.82,761.811 1766.13,882.767 1768.43,1006.06 1770.74,1032.97 1773.05,984.994 1775.36,835.992 1777.67,876.611 1779.97,857.475 1782.28,878.16 1784.59,852.961 1786.9,845.967 1789.21,855.698 1791.51,793.467 1793.82,1076.81 1796.13,968.865 1798.44,905.162 1800.75,1034.24 1803.05,718.289 1805.36,1090.68 1807.67,900.593 1809.98,903.963 1812.28,890.879 1814.59,1073.39 1816.9,1019.75 1819.21,908.47 1821.52,898.784 1823.82,985.312 1826.13,1021.96 1828.44,864.694 1830.75,742.3 1833.06,1124.74 1835.36,971.338 1837.67,901.54 1839.98,849.323 1842.29,869.853 1844.6,994.21 1846.9,912.167 1849.21,875.765 1851.52,955.308 1853.83,941.832 1856.14,888.451 1858.44,817.953 1860.75,849.321 1863.06,1133 1865.37,901.552 1867.67,811.009 1869.98,946.812 1872.29,1040 1874.6,871.87 1876.91,813.515 1879.21,759.25 1881.52,845.109 1883.83,807.827 1886.14,997.286 1888.45,911.052 1890.75,669.547 1893.06,942.718 1895.37,869.175 1897.68,938.54 1899.99,1078.98 1902.29,1013.03 1904.6,987.653 1906.91,826.818 1909.22,902.662 1911.53,988.788 1913.83,943.825 1916.14,915.311 1918.45,873.473 1920.76,1022.77 1923.06,809.921 1925.37,850.234 1927.68,810.979 1929.99,794.164 1932.3,846.065 1934.6,932.245 1936.91,943.245 1939.22,758.455 1941.53,1008.09 1943.84,956.402 1946.14,1009.74 1948.45,908.604 1950.76,939.737 1953.07,806.884 1955.38,1059.85 1957.68,1022.67 1959.99,826.718 1962.3,875.655 1964.61,1006 1966.91,905.182 1969.22,749.079 1971.53,1133.9 1973.84,808.32 1976.15,823.811 1978.45,781.489 1980.76,777.648 1983.07,840.509 1985.38,854.496 1987.69,937.727 1989.99,799.551 1992.3,913.148 1994.61,955.989 1996.92,982.699 1999.23,848.693 2001.53,884.628 2003.84,827.849 2006.15,1061.9 2008.46,948.419 2010.77,766.362 2013.07,923.18 2015.38,1079.53 2017.69,801.206 2020,711.718 2022.3,967.173 2024.61,917.633 2026.92,773.884 2029.23,938.69 2031.54,1093.99 2033.84,1060.15 2036.15,960.571 2038.46,1151.37 2040.77,671.494 2043.08,811.654 2045.38,895.181 2047.69,793.606 2050,875.647 2052.31,922.352 2054.62,1141.13 2056.92,780.909 2059.23,888.926 2061.54,821.113 2063.85,967.956 2066.16,929.738 2068.46,847.484 2070.77,963.077 2073.08,660.746 2075.39,893.009 2077.69,894.947 2080,946.567 2082.31,824.244 2084.62,950.235 2086.93,853.332 2089.23,954.233 2091.54,979.312 2093.85,959.689 2096.16,904.39 2098.47,868.4 2100.77,1021.57 2103.08,897.163 2105.39,771.818 2107.7,870.61 2110.01,1057.03 2112.31,953.538 2114.62,849.71 2116.93,973.782 2119.24,1070.28 2121.55,959.39 2123.85,964.351 2126.16,936.042 2128.47,851.114 2130.78,740.089 2133.08,869.784 2135.39,922.321 2137.7,779.579 2140.01,926.397 2142.32,1027.68 2144.62,897.573 2146.93,735.123 2149.24,922.345 2151.55,961.342 2153.86,961.177 2156.16,888.49 2158.47,822.815 2160.78,922.198 2163.09,881.53 2165.4,765.327 2167.7,782.176 2170.01,945.466 2172.32,920.356 2174.63,966.523 2176.93,900.165 2179.24,831.817 2181.55,1000.98 2183.86,867.692 2186.17,980.1 2188.47,991.733 2190.78,1081.2 2193.09,1013.44 2195.4,756.303 2197.71,858.502 2200.01,914.94 2202.32,905.182 2204.63,716.498 2206.94,857.444 2209.25,823.299 2211.55,768.941 2213.86,867.255 2216.17,718.821 2218.48,779.977 2220.79,813.002 2223.09,1050.36 2225.4,1051.64 2227.71,1001.35 2230.02,963.993 2232.32,899.934 2234.63,949.663 2236.94,787.88 2239.25,983.573 2241.56,896.139 2243.86,1024.63 2246.17,809.848 2248.48,966.316 2250.79,861.863 2253.1,1055.31 2255.4,891.672 2257.71,1049.17 2260.02,825.801 2262.33,1056.29 2264.64,860.449 2266.94,977.504 2269.25,963.43 2271.56,807.122 2273.87,993.312 2276.18,1028.26 2278.48,930.282 2280.79,766.146 2283.1,760.287 2285.41,835.227 2287.71,1005.69 2290.02,804.549 2292.33,1046.39 2294.64,1016.07 2296.95,693.01 2299.25,993.071 2301.56,792.77 2303.87,910.89 2306.18,854.343 2308.49,828.844 2310.79,976.421 2313.1,816.954 2315.41,859.118 2317.72,961.694 2320.03,908.337 2322.33,934.303 2324.64,1043.09 2326.95,1003.6 2329.26,812.826 2331.56,826.741 2333.87,854.622 2336.18,847.479 2338.49,711.972 2340.8,754.062 2343.1,973.197 2345.41,989.35 2347.72,1028.55 2350.03,882.857 2352.34,891.12 2354.64,878.21 2356.95,751.761 2359.26,724.191 2361.57,951.03 2363.88,899.811 2366.18,965.42 2368.49,991.896 2370.8,717.645 2373.11,848.25 2375.42,954.162 2377.72,859.99 2380.03,829.41 2382.34,812.744 2384.65,1088.62 2386.95,898.549 2389.26,838.756 2391.57,912.625 2393.88,822.658 2396.19,740.711 2398.49,906.586 2400.8,929.368 2403.11,828.629 2405.42,874.471 2407.73,732.985 2410.03,983.622 2412.34,1063.45 2414.65,951.756 2416.96,1022.44 2419.27,839.139 2421.57,911.823 2423.88,1011.73 2426.19,782.056 2428.5,872.357 2430.81,1142.75 2433.11,940.251 2435.42,811.801 2437.73,782.575 2440.04,911.756 2442.34,954.129 2444.65,924.975 2446.96,914.148 2449.27,1023.67 2451.58,939.019 2453.88,769.163 2456.19,992.419 2458.5,843.094 2460.81,1008.33 2463.12,814.452 2465.42,815.264 2467.73,921.826 2470.04,963.587 2472.35,934.044 2474.66,949.355 2476.96,917.419 2479.27,853.476 2481.58,881.187 2483.89,1066.55 2486.2,959.165 2488.5,970.571 2490.81,1063.82 2493.12,945.218 2495.43,985.047 2497.73,880.786 2500.04,871.432 2502.35,1089.45 2504.66,974.47 2506.97,924.507 2509.27,787.286 2511.58,930.316 2513.89,867.666 2516.2,870.086 2518.51,985.232 2520.81,708.899 2523.12,951.547 2525.43,921.486 2527.74,776.362 2530.05,828.11 2532.35,933.131 2534.66,871.215 2536.97,1018.31 2539.28,954.241 2541.58,901.36 2543.89,895.897 2546.2,902.813 2548.51,603.481 2550.82,1063.33 2553.12,965.132 2555.43,750.438 2557.74,974.401 2560.05,1032.34 2562.36,904.583 2564.66,990.792 2566.97,928.836 2569.28,873.692 2571.59,762.159 "></polyline>
<polyline clip-path="url(#clip922)" style="stroke:#3da44d; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="265.984,771.45 268.292,381.877 270.6,292.376 272.908,547.295 275.216,443.563 277.524,475.173 279.832,453.833 282.139,372.534 284.447,510.882 286.755,372.929 289.063,468.84 291.371,329.406 293.679,461.235 295.987,344.569 298.295,567.387 300.603,512.822 302.911,447.319 305.219,489.485 307.527,573.461 309.834,414.261 312.142,667.415 314.45,363.803 316.758,414.886 319.066,507.723 321.374,326.185 323.682,407.646 325.99,639.937 328.298,333.309 330.606,416.046 332.914,483.404 335.221,480.84 337.529,512.921 339.837,540.19 342.145,403.279 344.453,505.551 346.761,466.169 349.069,329.566 351.377,472.583 353.685,170.918 355.993,492.036 358.301,401.256 360.608,373.535 362.916,486.347 365.224,365.532 367.532,429.582 369.84,358.309 372.148,553.499 374.456,511.766 376.764,400.493 379.072,418.142 381.38,272.857 383.688,475.429 385.996,493.847 388.303,506.724 390.611,432.522 392.919,336.925 395.227,425.872 397.535,552.826 399.843,442.475 402.151,390.855 404.459,409.649 406.767,491.599 409.075,315.806 411.383,285.105 413.69,549.715 415.998,308.629 418.306,440.762 420.614,517.021 422.922,437.533 425.23,431.575 427.538,358.248 429.846,520.46 432.154,468.236 434.462,384.848 436.77,358.964 439.077,408.408 441.385,354.91 443.693,409.371 446.001,380.541 448.309,342.265 450.617,469.916 452.925,464.715 455.233,422.954 457.541,486.624 459.849,331.39 462.157,412.079 464.465,275.948 466.772,325.426 469.08,497.883 471.388,524.541 473.696,499.321 476.004,513.726 478.312,439.39 480.62,503.343 482.928,432.408 485.236,454.148 487.544,481.522 489.852,377.407 492.159,504.276 494.467,548.881 496.775,411.249 499.083,285.859 501.391,437.957 503.699,439.126 506.007,473.56 508.315,400.94 510.623,421.69 512.931,406.456 515.239,422.799 517.546,386.206 519.854,296.924 522.162,433.569 524.47,291.112 526.778,620.917 529.086,411.459 531.394,402.072 533.702,510.688 536.01,560.318 538.318,380.721 540.626,631.011 542.933,579.232 545.241,464.418 547.549,456.552 549.857,366.686 552.165,371.072 554.473,410.795 556.781,435.864 559.089,491.729 561.397,448.648 563.705,335.525 566.013,381.616 568.321,424.752 570.628,495.929 572.936,401.145 575.244,461.398 577.552,445.697 579.86,334.602 582.168,346.121 584.476,515.201 586.784,313.227 589.092,418.345 591.4,567.577 593.708,438.359 596.015,494.497 598.323,476.917 600.631,624.327 602.939,284.064 605.247,519.148 607.555,494.49 609.863,483.617 612.171,349.619 614.479,550.025 616.787,423.446 619.095,342.695 621.402,412.816 623.71,517.15 626.018,410.641 628.326,247.52 630.634,397.606 632.942,570.113 635.25,518.044 637.558,445.046 639.866,405.54 642.174,399.794 644.482,313.399 646.79,353.225 649.097,465.116 651.405,550.461 653.713,437.403 656.021,373.835 658.329,490.8 660.637,398.762 662.945,471.832 665.253,385.132 667.561,488.965 669.869,458.275 672.177,350.171 674.484,468.144 676.792,388.25 679.1,460.995 681.408,478.025 683.716,494.583 686.024,368.294 688.332,428.639 690.64,243.925 692.948,284.647 695.256,650.747 697.564,148.575 699.871,518.815 702.179,289.849 704.487,424.297 706.795,452.875 709.103,530.117 711.411,465.231 713.719,477.005 716.027,371.805 718.335,243.373 720.643,440.452 722.951,619.153 725.259,171.365 727.566,455.647 729.874,333.079 732.182,385.145 734.49,400.252 736.798,334.479 739.106,474.489 741.414,458.013 743.722,388.127 746.03,483.82 748.338,418.828 750.646,312.037 752.953,248.356 755.261,394.117 757.569,413.741 759.877,541.311 762.185,314.078 764.493,350.832 766.801,698.199 769.109,552.362 771.417,456.224 773.725,207.039 776.033,194.966 778.34,372.939 780.648,500.957 782.956,391.82 785.264,472.096 787.572,383.416 789.88,437.4 792.188,503.271 794.496,445.704 796.804,549.358 799.112,651.798 801.42,443.067 803.728,383.113 806.035,464.911 808.343,477.003 810.651,264.507 812.959,472.102 815.267,464.62 817.575,392.462 819.883,404.401 822.191,234.092 824.499,430.224 826.807,326.625 829.115,363.418 831.422,629.831 833.73,349.834 836.038,749.127 838.346,355.991 840.654,644.388 842.962,349.077 845.27,460.502 847.578,347.432 849.886,275.514 852.194,474.396 854.502,339.993 856.809,419.513 859.117,448.93 861.425,470.421 863.733,411.072 866.041,396.002 868.349,405.486 870.657,339.327 872.965,432.058 875.273,436.103 877.581,477 879.889,476.916 882.197,211.74 884.504,427.136 886.812,433.42 889.12,389.863 891.428,288.686 893.736,452.622 896.044,545.086 898.352,467.644 900.66,442.437 902.968,311.034 905.276,353.841 907.584,410.382 909.891,445.922 912.199,342.837 914.507,532.817 916.815,626.132 919.123,372.73 921.431,408.645 923.739,387.759 926.047,535.409 928.355,403.967 930.663,553.705 932.971,394.469 935.278,276.611 937.586,464.669 939.894,592.468 942.202,416.888 944.51,428.475 946.818,545.485 949.126,419.617 951.434,376.766 953.742,326.772 956.05,390.05 958.358,359.613 960.665,476.131 962.973,244.939 965.281,434.414 967.589,626.117 969.897,455.293 972.205,291.264 974.513,391.303 976.821,686.999 979.129,305.892 981.437,277.438 983.745,490.932 986.053,414.904 988.36,337.278 990.668,439.688 992.976,556.467 995.284,595.998 997.592,330.996 999.9,387.931 1002.21,436.181 1004.52,437.222 1006.82,475.054 1009.13,500.552 1011.44,344.663 1013.75,413.296 1016.06,232.039 1018.36,450.675 1020.67,287.335 1022.98,392.229 1025.29,436.549 1027.59,342.153 1029.9,445.321 1032.21,264.316 1034.52,373.863 1036.83,425.853 1039.13,306.212 1041.44,402.909 1043.75,415.947 1046.06,519.278 1048.37,358.86 1050.67,329.162 1052.98,266.428 1055.29,229.17 1057.6,369.566 1059.91,433.677 1062.21,341.387 1064.52,432.043 1066.83,268.196 1069.14,356.143 1071.45,472.531 1073.75,594.32 1076.06,426.098 1078.37,361.544 1080.68,339.249 1082.98,536.787 1085.29,383.813 1087.6,459.706 1089.91,499.729 1092.22,498.199 1094.52,350.856 1096.83,318.947 1099.14,419.426 1101.45,326.836 1103.76,342.639 1106.06,477.311 1108.37,348.827 1110.68,351.95 1112.99,625.422 1115.3,530.028 1117.6,430.291 1119.91,516.188 1122.22,439.407 1124.53,237.807 1126.84,411.219 1129.14,615.186 1131.45,324.842 1133.76,282.029 1136.07,377.866 1138.37,585.57 1140.68,451.154 1142.99,427.546 1145.3,472.626 1147.61,512.097 1149.91,511.145 1152.22,276.302 1154.53,646.506 1156.84,416.571 1159.15,394.419 1161.45,360.603 1163.76,365.825 1166.07,385.814 1168.38,457.563 1170.69,408.588 1172.99,375.73 1175.3,202.79 1177.61,584.487 1179.92,425.033 1182.23,451.945 1184.53,412.288 1186.84,545.61 1189.15,429.35 1191.46,323.104 1193.76,587.357 1196.07,311.896 1198.38,478.7 1200.69,573.989 1203,375.831 1205.3,336.904 1207.61,328.149 1209.92,363.585 1212.23,506.494 1214.54,435.701 1216.84,624.83 1219.15,620.725 1221.46,437.847 1223.77,290.023 1226.08,235.821 1228.38,576.596 1230.69,349.618 1233,245.855 1235.31,443.212 1237.61,501.595 1239.92,397.505 1242.23,387.367 1244.54,410.539 1246.85,355.954 1249.15,453.425 1251.46,422.671 1253.77,365.676 1256.08,513.412 1258.39,485.045 1260.69,440.153 1263,412.069 1265.31,139.23 1267.62,337.955 1269.93,414.539 1272.23,453.205 1274.54,309.465 1276.85,434.159 1279.16,528.796 1281.47,587.928 1283.77,349.802 1286.08,199.339 1288.39,448.005 1290.7,517.62 1293,233.844 1295.31,191.524 1297.62,440.037 1299.93,340.675 1302.24,290.69 1304.54,457.649 1306.85,473.174 1309.16,417.072 1311.47,639.824 1313.78,440.783 1316.08,435.828 1318.39,301.344 1320.7,356.347 1323.01,326.045 1325.32,433.793 1327.62,277.24 1329.93,564.668 1332.24,256.598 1334.55,495.753 1336.86,467.16 1339.16,494.321 1341.47,522.064 1343.78,409.802 1346.09,349.779 1348.39,466.619 1350.7,451.126 1353.01,415.364 1355.32,476.213 1357.63,458.663 1359.93,399.493 1362.24,670.203 1364.55,513.789 1366.86,186.116 1369.17,381.655 1371.47,414.395 1373.78,488.63 1376.09,481.135 1378.4,378.714 1380.71,337.344 1383.01,289.493 1385.32,551.756 1387.63,332.222 1389.94,398.706 1392.24,352.893 1394.55,465.93 1396.86,466.481 1399.17,463.479 1401.48,379.173 1403.78,440.41 1406.09,442.878 1408.4,403.906 1410.71,464.031 1413.02,309.281 1415.32,550.537 1417.63,554.787 1419.94,511.526 1422.25,414.601 1424.56,556.343 1426.86,608.006 1429.17,321.974 1431.48,240.313 1433.79,304.645 1436.1,315.762 1438.4,320.077 1440.71,351.724 1443.02,460.158 1445.33,370.613 1447.63,540.798 1449.94,561.785 1452.25,350.646 1454.56,575.376 1456.87,429.76 1459.17,427.709 1461.48,468.145 1463.79,407.852 1466.1,262.237 1468.41,468.654 1470.71,372.189 1473.02,489.769 1475.33,276.415 1477.64,449.335 1479.95,407.722 1482.25,452.586 1484.56,389.9 1486.87,440.475 1489.18,447.171 1491.49,143.733 1493.79,497.736 1496.1,400.668 1498.41,394.592 1500.72,438.579 1503.02,372.255 1505.33,391.296 1507.64,364.898 1509.95,483.7 1512.26,190.851 1514.56,192.072 1516.87,569.639 1519.18,446.458 1521.49,378.346 1523.8,412.707 1526.1,429.154 1528.41,271.091 1530.72,393.063 1533.03,332.619 1535.34,373.484 1537.64,508.429 1539.95,478.92 1542.26,469.585 1544.57,385.838 1546.88,461.316 1549.18,396.328 1551.49,522.819 1553.8,441.128 1556.11,398.444 1558.41,463.83 1560.72,449.914 1563.03,493.866 1565.34,467.826 1567.65,496.171 1569.95,561.576 1572.26,489.588 1574.57,548.846 1576.88,403.551 1579.19,380.307 1581.49,443.586 1583.8,301.993 1586.11,325.163 1588.42,408.628 1590.73,510.623 1593.03,454.514 1595.34,502.425 1597.65,359.408 1599.96,400.311 1602.26,274.057 1604.57,564.802 1606.88,551.702 1609.19,390.337 1611.5,597.716 1613.8,433.415 1616.11,580.487 1618.42,581.924 1620.73,476.387 1623.04,395.211 1625.34,417.907 1627.65,388.099 1629.96,294.999 1632.27,308.376 1634.58,448.585 1636.88,290.786 1639.19,353.768 1641.5,267.56 1643.81,455.2 1646.12,537.408 1648.42,373.177 1650.73,322.337 1653.04,439.454 1655.35,406.375 1657.65,558.002 1659.96,575.747 1662.27,565.199 1664.58,326.839 1666.89,530.113 1669.19,365.984 1671.5,276.802 1673.81,484.777 1676.12,494.457 1678.43,407.43 1680.73,450.981 1683.04,531.513 1685.35,506.594 1687.66,326.148 1689.97,135.244 1692.27,275.314 1694.58,310.381 1696.89,287.28 1699.2,513.242 1701.51,542.783 1703.81,406.604 1706.12,424.411 1708.43,414.692 1710.74,393.69 1713.04,273.496 1715.35,264 1717.66,369.936 1719.97,317.868 1722.28,432.969 1724.58,420.005 1726.89,347.416 1729.2,433.045 1731.51,415.48 1733.82,467.798 1736.12,404.178 1738.43,250.077 1740.74,409.754 1743.05,447.02 1745.36,502.64 1747.66,471.923 1749.97,321.432 1752.28,469.383 1754.59,453.013 1756.9,418.732 1759.2,485.121 1761.51,453.018 1763.82,295.917 1766.13,323.397 1768.43,501.818 1770.74,180.738 1773.05,520.448 1775.36,645.875 1777.67,318.655 1779.97,452.15 1782.28,298.866 1784.59,526.027 1786.9,402.093 1789.21,407.221 1791.51,510.645 1793.82,371.096 1796.13,486.05 1798.44,511.125 1800.75,666.781 1803.05,445.679 1805.36,408.671 1807.67,494.492 1809.98,290.984 1812.28,329.977 1814.59,348.387 1816.9,377.455 1819.21,501.642 1821.52,402.388 1823.82,400.604 1826.13,426.947 1828.44,351.413 1830.75,508.204 1833.06,490.321 1835.36,523.137 1837.67,495.649 1839.98,454.256 1842.29,319.842 1844.6,385.448 1846.9,380.576 1849.21,454.157 1851.52,187.339 1853.83,510.134 1856.14,489.955 1858.44,408.625 1860.75,427.471 1863.06,510.348 1865.37,525.908 1867.67,444.039 1869.98,418.022 1872.29,442.785 1874.6,467.96 1876.91,428.024 1879.21,536.214 1881.52,272.823 1883.83,376.919 1886.14,446.237 1888.45,403.608 1890.75,444.077 1893.06,429.147 1895.37,573.822 1897.68,416.549 1899.99,340.651 1902.29,411.259 1904.6,394.704 1906.91,592.688 1909.22,381.647 1911.53,455.939 1913.83,745.636 1916.14,365.674 1918.45,444.101 1920.76,417.672 1923.06,226.582 1925.37,312.808 1927.68,454.12 1929.99,464.7 1932.3,631.89 1934.6,426.06 1936.91,550.748 1939.22,239.373 1941.53,522.664 1943.84,327.834 1946.14,243.068 1948.45,477.911 1950.76,602.533 1953.07,376.752 1955.38,451.273 1957.68,416.355 1959.99,368.346 1962.3,552.142 1964.61,351.601 1966.91,96.8724 1969.22,467.262 1971.53,392.857 1973.84,351.46 1976.15,358.39 1978.45,307.721 1980.76,382.081 1983.07,437.687 1985.38,412.122 1987.69,545.973 1989.99,595.866 1992.3,462.378 1994.61,389.8 1996.92,540.332 1999.23,420.287 2001.53,361.918 2003.84,464.206 2006.15,475.576 2008.46,538.347 2010.77,429.184 2013.07,386.38 2015.38,300.366 2017.69,405.885 2020,291.775 2022.3,553.297 2024.61,435.848 2026.92,370.809 2029.23,322.024 2031.54,400.302 2033.84,398.946 2036.15,332.157 2038.46,401.077 2040.77,302.041 2043.08,475.979 2045.38,400.499 2047.69,607.817 2050,380.423 2052.31,544.891 2054.62,459.627 2056.92,347.55 2059.23,343.722 2061.54,404.694 2063.85,365.242 2066.16,384.176 2068.46,433.355 2070.77,461.663 2073.08,398.55 2075.39,330.625 2077.69,357.69 2080,212.249 2082.31,358.789 2084.62,314.975 2086.93,398.275 2089.23,307.005 2091.54,479.935 2093.85,356.004 2096.16,359.621 2098.47,454.769 2100.77,461.623 2103.08,368.797 2105.39,614.766 2107.7,632.222 2110.01,168.477 2112.31,530.836 2114.62,396.505 2116.93,559.283 2119.24,338.794 2121.55,420.598 2123.85,526.311 2126.16,301.394 2128.47,420.309 2130.78,317.234 2133.08,468 2135.39,362.561 2137.7,420.698 2140.01,525.524 2142.32,298.07 2144.62,384.216 2146.93,447.725 2149.24,424.288 2151.55,615.856 2153.86,398.441 2156.16,476.528 2158.47,352.969 2160.78,642.731 2163.09,498.56 2165.4,449.681 2167.7,241.863 2170.01,516.089 2172.32,203.509 2174.63,367.027 2176.93,371.79 2179.24,471.058 2181.55,369.203 2183.86,177.952 2186.17,419.105 2188.47,279.654 2190.78,324.195 2193.09,309.657 2195.4,398.431 2197.71,501.352 2200.01,400.23 2202.32,591.233 2204.63,412.353 2206.94,561.974 2209.25,420.717 2211.55,427.165 2213.86,391.118 2216.17,405.772 2218.48,491.693 2220.79,678.576 2223.09,530.516 2225.4,518.816 2227.71,380.75 2230.02,385 2232.32,365.799 2234.63,430.094 2236.94,207.497 2239.25,458.273 2241.56,407.464 2243.86,332.459 2246.17,451.818 2248.48,418.565 2250.79,337.618 2253.1,433.757 2255.4,416.437 2257.71,366.353 2260.02,522.724 2262.33,470.179 2264.64,245.839 2266.94,470.148 2269.25,442.89 2271.56,386.486 2273.87,550.654 2276.18,502.902 2278.48,603.46 2280.79,265.15 2283.1,311.267 2285.41,423.012 2287.71,546.012 2290.02,668.962 2292.33,520.839 2294.64,359.135 2296.95,269.669 2299.25,226.292 2301.56,574.34 2303.87,440.65 2306.18,378.111 2308.49,343.127 2310.79,475.521 2313.1,477.604 2315.41,387.119 2317.72,593.333 2320.03,343.123 2322.33,312.023 2324.64,589.612 2326.95,369.143 2329.26,382.629 2331.56,364.501 2333.87,290.741 2336.18,531.026 2338.49,359.586 2340.8,371.682 2343.1,625.19 2345.41,334.98 2347.72,383.515 2350.03,444.868 2352.34,416.127 2354.64,294.416 2356.95,453.665 2359.26,391.61 2361.57,474.007 2363.88,514.188 2366.18,416.708 2368.49,414.882 2370.8,294.261 2373.11,557.863 2375.42,635.227 2377.72,364.918 2380.03,313.067 2382.34,450.724 2384.65,381.222 2386.95,465.235 2389.26,487.638 2391.57,353.14 2393.88,357.602 2396.19,554.242 2398.49,361.157 2400.8,435.361 2403.11,275.775 2405.42,245.351 2407.73,401.629 2410.03,414.596 2412.34,381.677 2414.65,387.343 2416.96,342.368 2419.27,377.151 2421.57,404.435 2423.88,624.757 2426.19,447.381 2428.5,576.85 2430.81,359.138 2433.11,471.622 2435.42,510.95 2437.73,391.637 2440.04,456.444 2442.34,429.734 2444.65,422.75 2446.96,356.247 2449.27,327.939 2451.58,285.516 2453.88,382.35 2456.19,510.964 2458.5,474.736 2460.81,430.638 2463.12,573.238 2465.42,494.853 2467.73,330.968 2470.04,533.519 2472.35,352.253 2474.66,546.731 2476.96,360.062 2479.27,248.161 2481.58,517.034 2483.89,277.325 2486.2,548.233 2488.5,306.432 2490.81,305.582 2493.12,349.187 2495.43,313.508 2497.73,243.602 2500.04,527.66 2502.35,447.905 2504.66,407.112 2506.97,552.008 2509.27,353.396 2511.58,411.314 2513.89,298.765 2516.2,471.561 2518.51,281.932 2520.81,348.323 2523.12,568.421 2525.43,364.437 2527.74,372.153 2530.05,349.123 2532.35,556.251 2534.66,345.312 2536.97,397.93 2539.28,465.545 2541.58,343.566 2543.89,595.694 2546.2,418.416 2548.51,410.934 2550.82,211.071 2553.12,404.107 2555.43,246.949 2557.74,470.278 2560.05,478.083 2562.36,508.725 2564.66,382.401 2566.97,288.051 2569.28,534.98 2571.59,664.404 "></polyline>
</svg>
</div>
</div>
<p>Look at that! Things are working; amazin’.</p>
<p>We can also exploit <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>’s parallel sampling capabilities:</p>
<div id="34" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run separate 4 chains for 10 000 iterations using threads to parallelize.</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>num_chains <span class="op">=</span> <span class="fl">4</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    model_with_grad,</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">MCMCThreads</span>(),</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>,</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    num_chains;</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Note we need to provide an initial state for every chain.</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>    initial_state<span class="op">=</span><span class="fu">fill</span>(state, num_chains),</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>samples_array <span class="op">=</span> <span class="fu">stack</span>(<span class="fu">map</span>(<span class="bu">Base</span>.<span class="fu">Fix1</span>(stack, sample <span class="op">-&gt;</span> sample.x), samples))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000×4 Array{Float64, 3}:
[:, :, 1] =
 -2.00014   -2.05627  -2.20315  -3.48159   …  -5.94108   -4.35442   -6.30121
 -0.565121  -1.0173    1.13856   0.404837     -0.679852  -0.221495   1.98415
  3.39082    4.91209   5.44243   3.95205       6.5657     6.5131     6.65985

[:, :, 2] =
 -0.969468  -2.24711    -3.3065   …  -6.13173   -6.433     -5.04659
  0.47381   -0.0371199   1.03235     -0.767554  -0.383982   0.0278005
  1.81857    2.57547     2.45678      5.62766    5.88912    6.43046

[:, :, 3] =
 -1.93052  -3.8141    -3.64137  -4.39615   …  -4.62339  -4.81605  -4.28809
 -2.10982  -0.807133  -1.32934  -0.967729      1.13823   0.8957    0.104721
  2.68941   3.81592    5.48172   6.02654       4.39348   5.17362   4.3995

[:, :, 4] =
 -4.43262   -5.16681  -5.69711  -4.81736   …  -6.17565  -6.17565  -6.17565
  0.049533  -1.76765  -1.88417  -0.315925     -1.14181  -1.14181  -1.14181
  3.07042    2.91073   3.69687   3.58738       3.99723   3.99723   3.99723</code></pre>
</div>
</div>
<p>But the fact that we have to provide the <code>AbstractMCMC.sample</code> call, etc. with an <code>initial_state</code> to get started is a bit annoying. We can avoid this by also defining a <code>AbstractMCMC.step</code> <em>without</em> the <code>state</code> argument:</p>
<div id="36" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">::</span><span class="dt">MALA</span>;</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># </span><span class="al">NOTE</span><span class="co">: No state provided!</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just create the initial state by sampling using  a Gaussian.</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="fu">randn</span>(rng, LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(x), <span class="fu">MALAState</span>(x)</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Equipped with this, we no longer need to provide the <code>initial_state</code> everywhere:</p>
<div id="38" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -5.0122     0.982802
  0.0137138  1.00884
  4.99964    1.01297</code></pre>
</div>
</div>
</section>
<section id="using-our-sampler-with-turing.jl" class="level2">
<h2 class="anchored" data-anchor-id="using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</h2>
<p>As we promised, all of this hassle of implementing our <code>MALA</code> sampler in a way that uses <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> and <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> gets us something more than <em>just</em> an “automatic” implementation of <code>AbstractMCMC.sample</code>.</p>
<p>It also enables use with Turing.jl through the <code>externalsampler</code>, but we need to do one final thing first: we need to tell Turing.jl how to extract a vector of parameters from the “sample” returned in our implementation of <code>AbstractMCMC.step</code>. In our case, the “sample” is a <code>MALASample</code>, so we just need the following line:</p>
<div id="40" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load Turing.jl.</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Turing</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Overload the `getparams` method for our "sample" type, which is just a vector.</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>Turing.Inference.<span class="fu">getparams</span>(<span class="op">::</span><span class="dt">Turing.Model</span>, sample<span class="op">::</span><span class="dt">MALASample</span>) <span class="op">=</span> sample.x</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And with that, we’re good to go!</p>
<div id="42" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Our previous model defined as a Turing.jl model.</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">mvnormal_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">MvNormal</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.], I)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate our model.</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">mvnormal_model</span>()</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Call `sample` but now we're passing in a Turing.jl `model` and wrapping</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co"># our `MALA` sampler in the `externalsampler` to tell Turing.jl that the sampler</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co"># expects something that implements LogDensityProblems.jl.</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×4×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 2.59 seconds
Compute duration  = 2.59 seconds
parameters        = x[1], x[2], x[3]
internals         = lp

Summary Statistics
  parameters      mean       std      mcse    ess_bulk    ess_tail      rhat   ⋯
      Symbol   Float64   Float64   Float64     Float64     Float64   Float64   ⋯

        x[1]   -5.0212    0.9889    0.0173   3284.0838   5700.4684    1.0002   ⋯
        x[2]   -0.0014    0.9928    0.0177   3162.6885   4791.0423    1.0000   ⋯
        x[3]    4.9722    0.9939    0.0178   3112.0224   5406.3143    1.0005   ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

        x[1]   -6.9454   -5.6742   -5.0179   -4.3518   -3.1009
        x[2]   -1.9658   -0.6685    0.0043    0.6706    1.9240
        x[3]    3.0268    4.2971    4.9702    5.6446    6.9062</code></pre>
</div>
</div>
<p>Pretty neat, eh?</p>
<section id="models-with-constrained-parameters" class="level3">
<h3 class="anchored" data-anchor-id="models-with-constrained-parameters">Models with constrained parameters</h3>
<p>One thing we’ve sort of glossed over in all of the above is that MALA, at least how we’ve implemented it, requires <span class="math inline">\(x\)</span> to live in <span class="math inline">\(\mathbb{R}^d\)</span> for some <span class="math inline">\(d &gt; 0\)</span>. If some of the parameters were in fact constrained, e.g.&nbsp;we were working with a <code>Beta</code> distribution which has support on the interval <span class="math inline">\((0, 1)\)</span>, <em>not</em> on <span class="math inline">\(\mathbb{R}^d\)</span>, we could easily end up outside of the valid range <span class="math inline">\((0, 1)\)</span>.</p>
<div id="44" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">beta_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">beta_model</span>()</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 1.75 seconds
Compute duration  = 1.75 seconds
parameters        = x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse    ess_bulk    ess_tail      rhat   ⋯
      Symbol   Float64   Float64   Float64     Float64     Float64   Float64   ⋯

           x    0.5012    0.1889    0.0028   4491.4072   5904.9030    1.0007   ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

           x    0.1482    0.3610    0.4996    0.6414    0.8567</code></pre>
</div>
</div>
<p>Yep, that still works, but only because Turing.jl actually <em>transforms</em> the <code>turing_model</code> from constrained to unconstrained, so that the <code>sampler</code> provided to <code>externalsampler</code> is actually always working in unconstrained space! This is not always desirable, so we can turn this off:</p>
<div id="46" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 0.24 seconds
Compute duration  = 0.24 seconds
parameters        = x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse    ess_bulk    ess_tail      rhat   ⋯
      Symbol   Float64   Float64   Float64     Float64     Float64   Float64   ⋯

           x    0.8171    0.0063    0.0001   3133.8728   3133.8728    1.0002   ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

           x    0.8169    0.8169    0.8169    0.8169    0.8169</code></pre>
</div>
</div>
<p>The fun thing is that this still sort of works because</p>
<div id="48" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">logpdf</span>(<span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>), <span class="fl">10.0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-Inf</code></pre>
</div>
</div>
<p>and so the samples that fall outside of the range are always rejected. But do notice how much worse all the diagnostics are, e.g.&nbsp;<code>ess_tail</code> is very poor compared to when we use <code>unconstrained=true</code>. Moreover, in more complex cases this won’t just result in a “nice” <code>-Inf</code> log-density value, but instead will error:</p>
<div id="50" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="kw">function</span> <span class="fu">demo</span>()</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>    σ² <span class="op">~</span> <span class="fu">truncated</span>(<span class="fu">Normal</span>(), lower<span class="op">=</span><span class="fl">0</span>)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If we end up with negative values for `σ²`, the `Normal` will error.</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>    x <span class="op">~</span> <span class="fu">Normal</span>(<span class="fl">0</span>, σ²)</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>DomainError: DomainError(-1.5139407240087472, "Normal: the condition σ &gt;= zero(σ) is not satisfied.")
DomainError with -1.5139407240087472:
Normal: the condition σ &gt;= zero(σ) is not satisfied.
Stacktrace:
  [1] #371
    @ ~/.julia/packages/Distributions/ji8PW/src/univariate/continuous/normal.jl:37 [inlined]
  [2] check_args
    @ ~/.julia/packages/Distributions/ji8PW/src/utils.jl:89 [inlined]
  [3] #Normal#370
    @ ~/.julia/packages/Distributions/ji8PW/src/univariate/continuous/normal.jl:37 [inlined]
  [4] Normal
    @ ~/.julia/packages/Distributions/ji8PW/src/univariate/continuous/normal.jl:36 [inlined]
  [5] Normal
    @ ~/.julia/packages/Distributions/ji8PW/src/univariate/continuous/normal.jl:42 [inlined]
  [6] macro expansion
    @ ~/.julia/packages/DynamicPPL/E4kDs/src/compiler.jl:579 [inlined]
  [7] demo(__model__::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, __varinfo__::DynamicPPL.ThreadSafeVarInfo{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, Vector{Base.RefValue{Float64}}}, __context__::DynamicPPL.ValuesAsInModelContext{OrderedDict{Any, Any}, DynamicPPL.DefaultContext})
    @ Main.Notebook ~/work/docs/docs/tutorials/docs-17-implementing-samplers/index.qmd:592
  [8] _evaluate!!
    @ ~/.julia/packages/DynamicPPL/E4kDs/src/model.jl:963 [inlined]
  [9] evaluate_threadsafe!!(model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, varinfo::DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, context::DynamicPPL.ValuesAsInModelContext{OrderedDict{Any, Any}, DynamicPPL.DefaultContext})
    @ DynamicPPL ~/.julia/packages/DynamicPPL/E4kDs/src/model.jl:952
 [10] evaluate!!
    @ ~/.julia/packages/DynamicPPL/E4kDs/src/model.jl:887 [inlined]
 [11] values_as_in_model
    @ ~/.julia/packages/DynamicPPL/E4kDs/src/values_as_in_model.jl:196 [inlined]
 [12] values_as_in_model
    @ ~/.julia/packages/DynamicPPL/E4kDs/src/values_as_in_model.jl:195 [inlined]
 [13] getparams(model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, vi::DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64})
    @ Turing.Inference ~/.julia/packages/Turing/aAIq7/src/mcmc/Inference.jl:328
 [14] Turing.Inference.Transition(model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, vi::DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, t::MALASample{Vector{Float64}})
    @ Turing.Inference ~/.julia/packages/Turing/aAIq7/src/mcmc/Inference.jl:224
 [15] transition_to_turing
    @ ~/.julia/packages/Turing/aAIq7/src/mcmc/abstractmcmc.jl:12 [inlined]
 [16] transition_to_turing(f::LogDensityProblemsADForwardDiffExt.ForwardDiffLogDensity{LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, DynamicPPL.DefaultContext}, ForwardDiff.Chunk{2}, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}, transition::MALASample{Vector{Float64}})
    @ Turing.Inference ~/.julia/packages/Turing/aAIq7/src/mcmc/abstractmcmc.jl:17
 [17] step(rng::TaskLocalRNG, model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, sampler_wrapper::DynamicPPL.Sampler{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}; initial_state::Nothing, initial_params::Nothing, kwargs::@Kwargs{})
    @ Turing.Inference ~/.julia/packages/Turing/aAIq7/src/mcmc/abstractmcmc.jl:76
 [18] step
    @ ~/.julia/packages/Turing/aAIq7/src/mcmc/abstractmcmc.jl:36 [inlined]
 [19] macro expansion
    @ ~/.julia/packages/AbstractMCMC/YrmkI/src/sample.jl:130 [inlined]
 [20] macro expansion
    @ ~/.julia/packages/AbstractMCMC/YrmkI/src/logging.jl:16 [inlined]
 [21] mcmcsample(rng::TaskLocalRNG, model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, sampler::DynamicPPL.Sampler{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}, N::Int64; progress::Bool, progressname::String, callback::Nothing, discard_initial::Int64, thinning::Int64, chain_type::Type, initial_state::Nothing, kwargs::@Kwargs{})
    @ AbstractMCMC ~/.julia/packages/AbstractMCMC/YrmkI/src/sample.jl:120
 [22] sample(rng::TaskLocalRNG, model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, sampler::DynamicPPL.Sampler{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}, N::Int64; chain_type::Type, resume_from::Nothing, initial_state::Nothing, kwargs::@Kwargs{progress::Bool})
    @ DynamicPPL ~/.julia/packages/DynamicPPL/E4kDs/src/sampler.jl:93
 [23] sample
    @ ~/.julia/packages/DynamicPPL/E4kDs/src/sampler.jl:83 [inlined]
 [24] #sample#4
    @ ~/.julia/packages/Turing/aAIq7/src/mcmc/Inference.jl:263 [inlined]
 [25] sample
    @ ~/.julia/packages/Turing/aAIq7/src/mcmc/Inference.jl:256 [inlined]
 [26] #sample#3
    @ ~/.julia/packages/Turing/aAIq7/src/mcmc/Inference.jl:253 [inlined]
 [27] top-level scope
    @ ~/work/docs/docs/tutorials/docs-17-implementing-samplers/index.qmd:594</code></pre>
</div>
</div>
<p>As expected, we run into a <code>DomainError</code> at some point, while if we set <code>unconstrained=true</code>, letting Turing.jl transform the model to a unconstrained form behind the scenes, everything works as expected:</p>
<div id="52" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 1.65 seconds
Compute duration  = 1.65 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse   ess_bulk   ess_tail      rhat   e ⋯
      Symbol   Float64   Float64   Float64    Float64    Float64   Float64     ⋯

          σ²    0.8560    0.5426    0.0259   254.6289    83.0978    1.0003     ⋯
           x    0.0057    0.9613    0.0402   760.4680   494.9214    1.0030     ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

          σ²    0.0808    0.4284    0.7378    1.1924    2.1234
           x   -1.9261   -0.4934   -0.0009    0.4224    2.2221</code></pre>
</div>
</div>
<p>Neat!</p>
<p>Similarly, which automatic differentiation backend one should use can be specified through the <code>adtype</code> keyword argument too. For example, if we want to use <a href="https://github.com/JuliaDiff/ReverseDiff.jl">ReverseDiff.jl</a> instead of the default <a href="https://github.com/JuliaDiff/ForwardDiff.jl">ForwardDiff.jl</a>:</p>
<div id="54" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">ReverseDiff</span>: ReverseDiff</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify that we want to use `AutoReverseDiff`.</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">demo</span>(),</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>, adtype<span class="op">=</span><span class="fu">AutoReverseDiff</span>()),</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>;</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 3.09 seconds
Compute duration  = 3.09 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse   ess_bulk   ess_tail      rhat   e ⋯
      Symbol   Float64   Float64   Float64    Float64    Float64   Float64     ⋯

          σ²    0.8895    0.5884    0.0354   279.6982   164.0075    1.0128     ⋯
           x    0.1063    1.2860    0.1225   362.2725   115.1584    1.0044     ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

          σ²    0.1217    0.4141    0.7666    1.2393    2.2830
           x   -2.0835   -0.4199    0.0118    0.4733    3.3410</code></pre>
</div>
</div>
<p>Double-neat.</p>
</section>
</section>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<p>At this point it’s worth maybe reminding ourselves what we did and also <em>why</em> we did it:</p>
<ol type="1">
<li>We define our models in the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface because it makes the sampler agnostic to how the underlying model is implemented.</li>
<li>We implement our sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> interface, which just means that our sampler is a subtype of <code>AbstractMCMC.AbstractSampler</code> and we implement the MCMC transition in <code>AbstractMCMC.step</code>.</li>
<li>Points 1 and 2 makes it so our sampler can be used with a wide range of model implementations, amongst them being models implemented in both Turing.jl and Stan. This gives you, the inference implementer, a large collection of models to test your inference method on, in addition to allowing users of Turing.jl and Stan to try out your inference method with minimal effort.</li>
</ol>


</section>


<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a><div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>We’re going with the leapfrog formulation because in a future version of this tutorial we’ll add a section extending this simple “baseline” MALA sampler to more complex versions. See <a href="https://github.com/TuringLang/docs/issues/479">issue #479</a> for progress on this.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>There is no such thing as a proper interface in Julia (at least not officially), and so we use the word “interface” here to mean a few minimal methods that needs to be implemented by any type that we treat as a target model.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/turinglang\.org\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../tutorials/docs-07-for-developers-variational-inference/index.html" class="pagination-link" aria-label="Variational Inference">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Variational Inference</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Turing is created by <a href="http://mlg.eng.cam.ac.uk/hong/" target="_blank">Hong Ge</a>, and lovingly maintained by the <a href="https://github.com/TuringLang/Turing.jl/graphs/contributors" target="_blank">core team</a> of volunteers. <br> The contents of this website are © 2024 under the terms of the <a href="https://github.com/TuringLang/Turing.jl/blob/master/LICENCE" target="_blank">MIT License</a>.</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/TuringLang/docs/edit/master/tutorials/docs-17-implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/docs/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://x.com/TuringLang">
      <i class="bi bi-twitter" role="img" aria-label="Turing Twitter">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/TuringLang/Turing.jl">
      <i class="bi bi-github" role="img" aria-label="Turing GitHub">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




<script src="../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>