<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Implementing samplers – Turing.jl</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../tutorials/docs-07-for-developers-variational-inference/index.html" rel="prev">
<link href="../../assets/favicon.ico" rel="icon">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<style>
  a {
    text-decoration: none;
  }
  a:hover {
    text-decoration: underline;
  }
</style>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../theming/styles.css">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="https://turinglang.org/" class="navbar-brand navbar-brand-logo">
    <img src="../../assets/images/turing-logo.svg" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="https://turinglang.org/">
    <span class="navbar-title">Turing.jl</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../tutorials/docs-00-getting-started/"> 
<span class="menu-text">Get Started</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../tutorials/00-introduction/"> 
<span class="menu-text">Tutorials</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/library/"> 
<span class="menu-text">Libraries</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/news/"> 
<span class="menu-text">News</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/team/"> 
<span class="menu-text">Team</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-v0.34" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">v0.34</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-v0.34">    
        <li>
    <a class="dropdown-item" href="https://turinglang.org/docs/changelog.html">
 <span class="dropdown-text">Changelog</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://turinglang.org/docs/versions.html">
 <span class="dropdown-text">All Versions</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
    <a href="https://x.com/TuringLang" title="Turing Twitter" class="quarto-navigation-tool px-1" aria-label="Turing Twitter"><i class="bi bi-twitter"></i></a>
    <a href="https://github.com/TuringLang/Turing.jl" title="Turing GitHub" class="quarto-navigation-tool px-1" aria-label="Turing GitHub"><i class="bi bi-github"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Documentation</li><li class="breadcrumb-item"><a href="../../tutorials/docs-04-for-developers-abstractmcmc-turing/index.html">Developers: Inference</a></li><li class="breadcrumb-item"><a href="../../tutorials/docs-17-implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Documentation</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false">
 <span class="menu-text">Using Turing - Modelling Syntax and Interface</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-00-getting-started/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Getting Started</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-14-using-turing-quick-start/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Quick Start</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-12-using-turing-guide/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Guide</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-17-mode-estimation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Mode Estimation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-09-using-turing-advanced/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Advanced Usage</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-10-using-turing-autodiff/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Automatic Differentiation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-13-using-turing-performance-tips/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Performance Tips</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-11-using-turing-dynamichmc/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using DynamicHMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-15-using-turing-sampler-viz/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Sampler Visualization</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-16-using-turing-external-samplers/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">External Samplers</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false">
 <span class="menu-text">Using Turing - Tutorials</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/00-introduction/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction to Turing</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/01-gaussian-mixture-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Mixture Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/02-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/03-bayesian-neural-network/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Neural Networks</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/04-hidden-markov-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Hidden Markov Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/05-linear-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Linear Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/06-infinite-mixture-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Infinite Mixture Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/07-poisson-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Poisson Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/08-multinomial-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Multinomial Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/09-variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/10-bayesian-differential-equations/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Differential Equations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/11-probabilistic-pca/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Probabilistic PCA</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/13-seasonal-time-series/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Time Series Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/15-gaussian-processes/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction to Gaussian Processes</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/12-gplvm/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Process Latent Variable Models</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false">
 <span class="menu-text">Developers: Contributing</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-01-contributing-guide/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">How to Contribute</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false">
 <span class="menu-text">Developers: PPL</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-05-for-developers-compiler/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Turing Compiler Design</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/14-minituring/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation I: Compiler</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/16-contexts/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation II: Contexts</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-06-for-developers-interface/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Interface Guide</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true">
 <span class="menu-text">Developers: Inference</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-04-for-developers-abstractmcmc-turing/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">How Turing implements AbstractMCMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-07-for-developers-variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-17-implementing-samplers/index.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Implementing Samplers</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of Contents</h2>
   
  <ul>
  <li><a href="#quick-overview-of-mala" id="toc-quick-overview-of-mala" class="nav-link active" data-scroll-target="#quick-overview-of-mala">Quick overview of MALA</a></li>
  <li><a href="#what-we-need-from-a-model-logdensityproblems.jl" id="toc-what-we-need-from-a-model-logdensityproblems.jl" class="nav-link" data-scroll-target="#what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: LogDensityProblems.jl</a></li>
  <li><a href="#implementing-mala-in-abstractmcmc.jl" id="toc-implementing-mala-in-abstractmcmc.jl" class="nav-link" data-scroll-target="#implementing-mala-in-abstractmcmc.jl">Implementing MALA in AbstractMCMC.jl</a></li>
  <li><a href="#using-our-sampler-with-turing.jl" id="toc-using-our-sampler-with-turing.jl" class="nav-link" data-scroll-target="#using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</a>
  <ul class="collapse">
  <li><a href="#models-with-constrained-parameters" id="toc-models-with-constrained-parameters" class="nav-link" data-scroll-target="#models-with-constrained-parameters">Models with constrained parameters</a></li>
  </ul></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/TuringLang/docs/edit/master/tutorials/docs-17-implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/docs/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Documentation</li><li class="breadcrumb-item"><a href="../../tutorials/docs-04-for-developers-abstractmcmc-turing/index.html">Developers: Inference</a></li><li class="breadcrumb-item"><a href="../../tutorials/docs-17-implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Implementing samplers</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>In this tutorial, we’ll go through step-by-step how to implement a “simple” sampler in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> in such a way that it can be easily applied to Turing.jl models.</p>
<p>In particular, we’re going to implement a version of <strong>Metropolis-adjusted Langevin (MALA)</strong>.</p>
<p>Note that we will implement this sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> framework, completely “ignoring” Turing.jl until the very end of the tutorial, at which point we’ll use a single line of code to make the resulting sampler available to Turing.jl. This is to really drive home the point that one can implement samplers in a way that is accessible to all of Turing.jl’s users without having to use Turing.jl yourself.</p>
<section id="quick-overview-of-mala" class="level2">
<h2 class="anchored" data-anchor-id="quick-overview-of-mala">Quick overview of MALA</h2>
<p>We can view MALA as a single step of the leapfrog intergrator with resampling of momentum <span class="math inline">\(p\)</span> at every step.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> To make that statement a bit more concrete, we first define the <em>extended</em> target <span class="math inline">\(\bar{\gamma}(x, p)\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\log \bar{\gamma}(x, p) \propto \log \gamma(x) + \log \gamma_{\mathcal{N}(0, M)}(p)
\end{equation*}\]</span></p>
<p>where <span class="math inline">\(\gamma_{\mathcal{N}(0, M)}\)</span> denotes the density for a zero-centered Gaussian with covariance matrix <span class="math inline">\(M\)</span>. We then consider targeting this joint distribution over both <span class="math inline">\(x\)</span> and <span class="math inline">\(p\)</span> as follows. First we define the map</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  L_{\epsilon}: \quad &amp; \mathbb{R}^d \times \mathbb{R}^d \to \mathbb{R}^d \times \mathbb{R}^d \\
  &amp; (x, p) \mapsto (\tilde{x}, \tilde{p}) := L_{\epsilon}(x, p)
\end{split}
\end{equation*}\]</span></p>
<p>as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p_{1 / 2} &amp;:= p + \frac{\epsilon}{2} \nabla \log \gamma(x) \\
  \tilde{x} &amp;:= x + \epsilon M^{-1} p_{1 /2 } \\
  p_1 &amp;:= p_{1 / 2} + \frac{\epsilon}{2} \nabla \log \gamma(\tilde{x}) \\
  \tilde{p} &amp;:= - p_1
\end{split}
\end{equation*}\]</span></p>
<p>This might be familiar for some readers as a single step of the Leapfrog integrator. We then define the MALA kernel as follows: given the current iterate <span class="math inline">\(x_i\)</span>, we sample the next iterate <span class="math inline">\(x_{i + 1}\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p &amp;\sim \mathcal{N}(0, M) \\
  (\tilde{x}, \tilde{p}) &amp;:= L_{\epsilon}(x_i, p) \\
  \alpha &amp;:= \min \left\{ 1, \frac{\bar{\gamma}(\tilde{x}, \tilde{p})}{\bar{\gamma}(x_i, p)} \right\} \\
  x_{i + 1} &amp;:=
  \begin{cases}
    \tilde{x} \quad &amp; \text{ with prob. } \alpha \\
    x_i       \quad &amp; \text{ with prob. } 1 - \alpha
  \end{cases}
\end{split}
\end{equation*}\]</span></p>
<p>i.e.&nbsp;we accept the proposal <span class="math inline">\(\tilde{x}\)</span> with probability <span class="math inline">\(\alpha\)</span> and reject it, thus sticking with our current iterate, with probability <span class="math inline">\(1 - \alpha\)</span>.</p>
</section>
<section id="what-we-need-from-a-model-logdensityproblems.jl" class="level2">
<h2 class="anchored" data-anchor-id="what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a></h2>
<p>There are a few things we need from the “target” / “model” / density that we want to sample from:</p>
<ol type="1">
<li>We need access to log-density <em>evaluations</em> <span class="math inline">\(\log \gamma(x)\)</span> so we can compute the acceptance ratio involving <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>We need access to log-density <em>gradients</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span> so we can compute the Leapfrog steps <span class="math inline">\(L_{\epsilon}(x, p)\)</span>.</li>
<li>We also need access to the “size” of the model so we can determine the size of <span class="math inline">\(M\)</span>.</li>
</ol>
<p>Luckily for us, there is a package called <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> which provides an interface for <em>exactly</em> this!</p>
<p>To demonstrate how one can implement the “<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface”<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> we will use a simple Gaussian model as an example:</p>
<div id="4" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblems</span>: LogDensityProblems;</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's define some type that represents the model.</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> IsotropicNormalModel{M<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"mean of the isotropic Gaussian"</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    mean<span class="op">::</span><span class="dt">M</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Specifies what input length the model expects.</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">dimension</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> <span class="fu">length</span>(model.mean)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Implementation of the log-density evaluation of the model.</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x<span class="op">::</span><span class="dt">AbstractVector{&lt;:Real}</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">-</span> <span class="fu">sum</span>(abs2, x <span class="op">.-</span> model.mean) <span class="op">/</span> <span class="fl">2</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This gives us all of the properties we want for our MALA sampler with the exception of the computation of the <em>gradient</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span>. There is the method <code>LogDensityProblems.logdensity_and_gradient</code> which should return a 2-tuple where the first entry is the evaluation of the logdensity <span class="math inline">\(\log \gamma(x)\)</span> and the second entry is the gradient <span class="math inline">\(\nabla \log \gamma(x)\)</span>.</p>
<p>There are two ways to “implement” this method: 1) we implement it by hand, which is feasible in the case of our <code>IsotropicNormalModel</code>, or b) we defer the implementation of this to a automatic differentiation backend.</p>
<p>To implement it by hand we can simply do</p>
<div id="6" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl that first-order, i.e. gradient information, is available.</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{1}</span>()</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Implement `logdensity_and_gradient`.</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    logγ_x <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="op">-</span>x <span class="op">.*</span> (x <span class="op">-</span> model.mean)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> logγ_x, ∇logγ_x</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s just try it out:</p>
<div id="8" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate the problem.</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> <span class="fu">IsotropicNormalModel</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.])</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create some example input that we can test on.</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>x_example <span class="op">=</span> <span class="fu">randn</span>(LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate!</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-28.1940914199256</code></pre>
</div>
</div>
<p>To defer it to an automatic differentiation backend, we can do</p>
<div id="10" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl we only have access to 0-th order information.</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{0}</span>()</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Use `LogDensityProblemsAD`'s `ADgradient` in combination with some AD backend to implement `logdensity_and_gradient`.</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblemsAD</span>, <span class="bu">ADTypes</span>, <span class="bu">ForwardDiff</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>model_with_grad <span class="op">=</span> <span class="fu">ADgradient</span>(<span class="fu">AutoForwardDiff</span>(), model)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model_with_grad, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-28.1940914199256</code></pre>
</div>
</div>
<p>We’ll continue with the second approach in this tutorial since this is typically what one does in practice, because there are better hobbies to spend time on than deriving gradients by hand.</p>
<p>At this point, one might wonder how we’re going to tie this back to Turing.jl in the end. Effectively, when working with inference methods that only require log-density evaluations and / or higher-order information of the log-density, Turing.jl actually converts the user-provided <code>Model</code> into an object implementing the above methods for <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>. As a result, most samplers provided by Turing.jl are actually implemented to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, enabling their use both <em>within</em> Turing.jl and <em>outside</em> of Turing.jl! Morever, there exists similar conversions for Stan through BridgeStan and Stan<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, which means that a sampler supporting the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface can easily be used on both Turing.jl <em>and</em> Stan models (in addition to user-provided models, as our <code>IsotropicNormalModel</code> above)!</p>
<p>Anyways, let’s move on to actually implementing the sampler.</p>
</section>
<section id="implementing-mala-in-abstractmcmc.jl" class="level2">
<h2 class="anchored" data-anchor-id="implementing-mala-in-abstractmcmc.jl">Implementing MALA in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a></h2>
<p>Now that we’ve established that a model implementing the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface provides us with all the information we need from <span class="math inline">\(\log \gamma(x)\)</span>, we can address the question: given an object that implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, how can we define a sampler for it?</p>
<p>We’re going to do this by making our sampler a sub-type of <code>AbstractMCMC.AbstractSampler</code> in addition to implementing a few methods from <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>. Why? Because it gets us <em>a lot</em> of functionality for free, as we will see later.</p>
<p>Moreover, <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> provides a very natural interface for MCMC algorithms.</p>
<p>First, we’ll define our <code>MALA</code> type</p>
<div id="12" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">AbstractMCMC</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALA{T,A} <span class="op">&lt;:</span><span class="dt"> AbstractMCMC.AbstractSampler</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"stepsize used in the leapfrog step"</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    ϵ_init<span class="op">::</span><span class="dt">T</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"covariance matrix used for the momentum"</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    M_init<span class="op">::</span><span class="dt">A</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notice how we’ve added the suffix <code>_init</code> to both the stepsize and the covariance matrix. We’ve done this because a <code>AbstractMCMC.AbstractSampler</code> should be <em>immutable</em>. Of course there might be many scenarios where we want to allow something like the stepsize and / or the covariance matrix to vary between iterations, e.g.&nbsp;during the burn-in / adaptation phase of the sampling process we might want to adjust the parameters using statistics computed from these initial iterations. But information which can change between iterations <em>should not go in the sampler itself</em>! Instead, this information should go in the sampler <em>state</em>.</p>
<p>The sampler state should at the very least contain all the necessary information to perform the next MCMC iteration, but usually contains further information, e.g.&nbsp;quantities and statistics useful for evaluating whether the sampler has converged.</p>
<p>We will use the following sampler state for our <code>MALA</code> sampler:</p>
<div id="14" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALAState{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This might seem overly redundant: we’re defining a type <code>MALAState</code> and it only contains a simple vector of reals. In this particular case we indeed could have dropped this and simply used a <code>AbstractVector{&lt;:Real}</code> as our sampler state, but typically, as we will see later, one wants to include other quantities in the sampler state. For example, if we also wanted to adapt the parameters of our <code>MALA</code>, e.g.&nbsp;alter the stepsize depending on acceptance rates, in which case we should also put <code>ϵ</code> in the state, but for now we’ll keep things simple.</p>
<p>Moreover, we also want a <em>sample</em> type, which is a type meant for “public consumption”, i.e.&nbsp;the end-user. This is generally going to contain a subset of the information present in the state. But in such a simple scenario as this, we similarly only have a <code>AbstractVector{&lt;:Real}</code>:</p>
<div id="16" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALASample{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We currently have three things:</p>
<ol type="1">
<li>A <code>AbstractMCMC.AbstractSampler</code> implementation called <code>MALA</code>.</li>
<li>A state <code>MALAState</code> for our sampler <code>MALA</code>.</li>
<li>A sample <code>MALASample</code> for our sampler <code>MALA</code>.</li>
</ol>
<p>That means that we’re ready to implement the only thing that really matters: <code>AbstractMCMC.step</code>.</p>
<p><code>AbstractMCMC.step</code> defines the MCMC iteration of our <code>MALA</code> given the current <code>MALAState</code>. Specifically, the signature of the function is as follows:</p>
<div id="18" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The RNG to ensure reproducibility.</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The model that defines our target.</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.AbstractModel</span>,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The sampler for which we're taking a `step`.</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">AbstractMCMC.AbstractSampler</span>,</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The current sampler `state`.</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    state;</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Additional keyword arguments that we may or may not need.</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Moreover, there is a specific <code>AbstractMCMC.AbstractModel</code> which is used to indicate that the model that is provided implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface: <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Since, as we discussed earlier, in our case we’re indeed going to work with types that support the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, we’ll define <code>AbstractMCMC.step</code> for such a <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Note that <code>AbstractMCMC.LogDensityModel</code> has no other purpose; it has a single field called <code>logdensity</code>, and it does nothing else. But by wrapping the model in <code>AbstractMCMC.LogDensityModel</code>, it allows samplers that want to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> to define their <code>AbstractMCMC.step</code> on this type without running into method ambiguities.</p>
<p>All in all, that means that the signature for our <code>AbstractMCMC.step</code> is going to be the following:</p>
<div id="20" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># `LogDensityModel` so we know we're working with LogDensityProblems.jl model.</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler.</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler state.</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Great! Now let’s actually implement the full <code>AbstractMCMC.step</code> for our <code>MALA</code>.</p>
<p>Let’s remind ourselves what we’re going to do:</p>
<ol type="1">
<li>Sample a new momentum <span class="math inline">\(p\)</span>.</li>
<li>Compute the log-density of the extended target <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>Take a single leapfrog step <span class="math inline">\((\tilde{x}, \tilde{p}) = L_{\epsilon}(x, p)\)</span>.</li>
<li>Accept or reject the proposed <span class="math inline">\((\tilde{x}, \tilde{p})\)</span>.</li>
</ol>
<p>All in all, this results in the following:</p>
<div id="22" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>: Random</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Distributions</span>  <span class="co"># so we get the `MvNormal`</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the wrapped model which implements LogDensityProblems.jl.</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just extract the sampler parameters to make our lives easier.</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    ϵ <span class="op">=</span> sampler.ϵ_init</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    M <span class="op">=</span> sampler.M_init</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the current parameters.</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> state.x</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sample the momentum.</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>    p_dist <span class="op">=</span> <span class="fu">MvNormal</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)), M)</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> <span class="fu">rand</span>(rng, p_dist)</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Propose using a single leapfrog step.</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>    x̃, p̃ <span class="op">=</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Accept or reject proposal.</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>    logp <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p)</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>    logp̃ <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x̃) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p̃)</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>    logα <span class="op">=</span> logp̃ <span class="op">-</span> logp</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>    state_new <span class="op">=</span> <span class="cf">if</span> <span class="fu">log</span>(<span class="fu">rand</span>(rng)) <span class="op">&lt;</span> logα</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Accept.</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x̃)</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Reject.</span></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x)</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return the "sample" and the sampler state.</span></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(state_new.x), state_new</span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Fairly straight-forward.</p>
<p>Of course, we haven’t defined the <code>leapfrog_step</code> method yet, so let’s do that:</p>
<div id="24" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p` using "position" `x`.</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x))</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    p1 <span class="op">=</span> p <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update the "position" `x` using momentum `p1`.</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    x̃ <span class="op">=</span> x <span class="op">+</span> ϵ <span class="op">.*</span> (M <span class="op">\</span> p1)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p1` using position `x̃`</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x̃ <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x̃))</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    p2 <span class="op">=</span> p1 <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x̃</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Flip momentum `p2`.</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    p̃ <span class="op">=</span> <span class="op">-</span>p2</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x̃, p̃</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>leapfrog_step (generic function with 1 method)</code></pre>
</div>
</div>
<p>With all of this, we’re technically ready to sample!</p>
<div id="26" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>, <span class="bu">LinearAlgebra</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>rng <span class="op">=</span> <span class="bu">Random</span>.<span class="fu">default_rng</span>()</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>sampler <span class="op">=</span> <span class="fu">MALA</span>(<span class="fl">1</span>, I)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>state <span class="op">=</span> <span class="fu">MALAState</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)))</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>x_next, state_next <span class="op">=</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    rng,</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    AbstractMCMC.<span class="fu">LogDensityModel</span>(model),</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    state</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>(MALASample{Vector{Float64}}([-2.1506022880154108, -0.9048000926633682, -0.2268289974486608]), MALAState{Vector{Float64}}([-2.1506022880154108, -0.9048000926633682, -0.2268289974486608]))</code></pre>
</div>
</div>
<p>Great, it works!</p>
<p>And I promised we would get quite some functionality for free if we implemented <code>AbstractMCMC.step</code>, and so we can now simply call <code>sample</code> to perform standard MCMC sampling:</p>
<div id="28" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform 1000 iterations with our `MALA` sampler.</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; initial_state<span class="op">=</span>state, progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Concatenate into a matrix.</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000 Matrix{Float64}:
 -3.43487  -6.20968   -5.08166   …  -4.60907   -4.4764    -5.14291
  1.75347   0.428255   0.696985      0.660991  -0.818252  -0.779569
  3.03711   2.47486    3.22863       3.9512     5.74396    6.36959</code></pre>
</div>
</div>
<div id="30" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the marginal means and standard deviations.</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -4.99957     1.00686
  0.00545564  1.0108
  4.98592     1.00777</code></pre>
</div>
</div>
<p>Let’s visualize the samples</p>
<div id="32" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">StatsPlots</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">transpose</span>(samples_matrix[<span class="op">:</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">:</span><span class="kw">end</span>]), alpha<span class="op">=</span><span class="fl">0.5</span>, legend<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<!--?xml version="1.0" encoding="utf-8"?-->
<svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" width="672" height="480" viewbox="0 0 2688 1920">
<defs>
  <clippath id="clip570">
    <rect x="0" y="0" width="2688" height="1920"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip570)" d="M0 1920 L2688 1920 L2688 0 L0 0  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip571">
    <rect x="537" y="0" width="1883" height="1883"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip570)" d="M151.747 1800.78 L2640.76 1800.78 L2640.76 47.2441 L151.747 47.2441  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip572">
    <rect x="151" y="47" width="2490" height="1755"></rect>
  </clippath>
</defs>
<polyline clip-path="url(#clip572)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="219.84,1800.78 219.84,47.2441 "></polyline>
<polyline clip-path="url(#clip572)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="807.458,1800.78 807.458,47.2441 "></polyline>
<polyline clip-path="url(#clip572)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1395.08,1800.78 1395.08,47.2441 "></polyline>
<polyline clip-path="url(#clip572)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1982.69,1800.78 1982.69,47.2441 "></polyline>
<polyline clip-path="url(#clip572)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="2570.31,1800.78 2570.31,47.2441 "></polyline>
<polyline clip-path="url(#clip572)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,1548.09 2640.76,1548.09 "></polyline>
<polyline clip-path="url(#clip572)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,1225.58 2640.76,1225.58 "></polyline>
<polyline clip-path="url(#clip572)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,903.063 2640.76,903.063 "></polyline>
<polyline clip-path="url(#clip572)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,580.548 2640.76,580.548 "></polyline>
<polyline clip-path="url(#clip572)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,258.034 2640.76,258.034 "></polyline>
<polyline clip-path="url(#clip570)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1800.78 2640.76,1800.78 "></polyline>
<polyline clip-path="url(#clip570)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="219.84,1800.78 219.84,1781.88 "></polyline>
<polyline clip-path="url(#clip570)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="807.458,1800.78 807.458,1781.88 "></polyline>
<polyline clip-path="url(#clip570)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1395.08,1800.78 1395.08,1781.88 "></polyline>
<polyline clip-path="url(#clip570)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1982.69,1800.78 1982.69,1781.88 "></polyline>
<polyline clip-path="url(#clip570)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="2570.31,1800.78 2570.31,1781.88 "></polyline>
<path clip-path="url(#clip570)" d="M219.84 1834 Q216.229 1834 214.4 1837.57 Q212.595 1841.11 212.595 1848.24 Q212.595 1855.34 214.4 1858.91 Q216.229 1862.45 219.84 1862.45 Q223.474 1862.45 225.28 1858.91 Q227.108 1855.34 227.108 1848.24 Q227.108 1841.11 225.28 1837.57 Q223.474 1834 219.84 1834 M219.84 1830.3 Q225.65 1830.3 228.706 1834.9 Q231.784 1839.49 231.784 1848.24 Q231.784 1856.96 228.706 1861.57 Q225.65 1866.15 219.84 1866.15 Q214.03 1866.15 210.951 1861.57 Q207.896 1856.96 207.896 1848.24 Q207.896 1839.49 210.951 1834.9 Q214.03 1830.3 219.84 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip570)" d="M771.15 1861.55 L787.47 1861.55 L787.47 1865.48 L765.525 1865.48 L765.525 1861.55 Q768.187 1858.79 772.771 1854.16 Q777.377 1849.51 778.558 1848.17 Q780.803 1845.65 781.683 1843.91 Q782.585 1842.15 782.585 1840.46 Q782.585 1837.71 780.641 1835.97 Q778.72 1834.23 775.618 1834.23 Q773.419 1834.23 770.965 1835 Q768.535 1835.76 765.757 1837.31 L765.757 1832.59 Q768.581 1831.46 771.035 1830.88 Q773.488 1830.3 775.525 1830.3 Q780.896 1830.3 784.09 1832.98 Q787.285 1835.67 787.285 1840.16 Q787.285 1842.29 786.474 1844.21 Q785.687 1846.11 783.581 1848.7 Q783.002 1849.37 779.9 1852.59 Q776.798 1855.78 771.15 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip570)" d="M797.331 1830.92 L815.687 1830.92 L815.687 1834.86 L801.613 1834.86 L801.613 1843.33 Q802.632 1842.98 803.65 1842.82 Q804.669 1842.64 805.687 1842.64 Q811.474 1842.64 814.854 1845.81 Q818.233 1848.98 818.233 1854.4 Q818.233 1859.97 814.761 1863.08 Q811.289 1866.15 804.97 1866.15 Q802.794 1866.15 800.525 1865.78 Q798.28 1865.41 795.872 1864.67 L795.872 1859.97 Q797.956 1861.11 800.178 1861.66 Q802.4 1862.22 804.877 1862.22 Q808.882 1862.22 811.22 1860.11 Q813.558 1858.01 813.558 1854.4 Q813.558 1850.78 811.22 1848.68 Q808.882 1846.57 804.877 1846.57 Q803.002 1846.57 801.127 1846.99 Q799.275 1847.4 797.331 1848.28 L797.331 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip570)" d="M837.446 1834 Q833.835 1834 832.007 1837.57 Q830.201 1841.11 830.201 1848.24 Q830.201 1855.34 832.007 1858.91 Q833.835 1862.45 837.446 1862.45 Q841.081 1862.45 842.886 1858.91 Q844.715 1855.34 844.715 1848.24 Q844.715 1841.11 842.886 1837.57 Q841.081 1834 837.446 1834 M837.446 1830.3 Q843.256 1830.3 846.312 1834.9 Q849.391 1839.49 849.391 1848.24 Q849.391 1856.96 846.312 1861.57 Q843.256 1866.15 837.446 1866.15 Q831.636 1866.15 828.557 1861.57 Q825.502 1856.96 825.502 1848.24 Q825.502 1839.49 828.557 1834.9 Q831.636 1830.3 837.446 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip570)" d="M1354.69 1830.92 L1373.05 1830.92 L1373.05 1834.86 L1358.98 1834.86 L1358.98 1843.33 Q1360 1842.98 1361.01 1842.82 Q1362.03 1842.64 1363.05 1842.64 Q1368.84 1842.64 1372.22 1845.81 Q1375.6 1848.98 1375.6 1854.4 Q1375.6 1859.97 1372.12 1863.08 Q1368.65 1866.15 1362.33 1866.15 Q1360.16 1866.15 1357.89 1865.78 Q1355.64 1865.41 1353.24 1864.67 L1353.24 1859.97 Q1355.32 1861.11 1357.54 1861.66 Q1359.76 1862.22 1362.24 1862.22 Q1366.25 1862.22 1368.58 1860.11 Q1370.92 1858.01 1370.92 1854.4 Q1370.92 1850.78 1368.58 1848.68 Q1366.25 1846.57 1362.24 1846.57 Q1360.37 1846.57 1358.49 1846.99 Q1356.64 1847.4 1354.69 1848.28 L1354.69 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip570)" d="M1394.81 1834 Q1391.2 1834 1389.37 1837.57 Q1387.56 1841.11 1387.56 1848.24 Q1387.56 1855.34 1389.37 1858.91 Q1391.2 1862.45 1394.81 1862.45 Q1398.44 1862.45 1400.25 1858.91 Q1402.08 1855.34 1402.08 1848.24 Q1402.08 1841.11 1400.25 1837.57 Q1398.44 1834 1394.81 1834 M1394.81 1830.3 Q1400.62 1830.3 1403.68 1834.9 Q1406.75 1839.49 1406.75 1848.24 Q1406.75 1856.96 1403.68 1861.57 Q1400.62 1866.15 1394.81 1866.15 Q1389 1866.15 1385.92 1861.57 Q1382.87 1856.96 1382.87 1848.24 Q1382.87 1839.49 1385.92 1834.9 Q1389 1830.3 1394.81 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip570)" d="M1424.97 1834 Q1421.36 1834 1419.53 1837.57 Q1417.73 1841.11 1417.73 1848.24 Q1417.73 1855.34 1419.53 1858.91 Q1421.36 1862.45 1424.97 1862.45 Q1428.61 1862.45 1430.41 1858.91 Q1432.24 1855.34 1432.24 1848.24 Q1432.24 1841.11 1430.41 1837.57 Q1428.61 1834 1424.97 1834 M1424.97 1830.3 Q1430.78 1830.3 1433.84 1834.9 Q1436.92 1839.49 1436.92 1848.24 Q1436.92 1856.96 1433.84 1861.57 Q1430.78 1866.15 1424.97 1866.15 Q1419.16 1866.15 1416.08 1861.57 Q1413.03 1856.96 1413.03 1848.24 Q1413.03 1839.49 1416.08 1834.9 Q1419.16 1830.3 1424.97 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip570)" d="M1940.97 1830.92 L1963.19 1830.92 L1963.19 1832.91 L1950.65 1865.48 L1945.76 1865.48 L1957.57 1834.86 L1940.97 1834.86 L1940.97 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip570)" d="M1972.36 1830.92 L1990.71 1830.92 L1990.71 1834.86 L1976.64 1834.86 L1976.64 1843.33 Q1977.66 1842.98 1978.68 1842.82 Q1979.7 1842.64 1980.72 1842.64 Q1986.5 1842.64 1989.88 1845.81 Q1993.26 1848.98 1993.26 1854.4 Q1993.26 1859.97 1989.79 1863.08 Q1986.32 1866.15 1980 1866.15 Q1977.82 1866.15 1975.55 1865.78 Q1973.31 1865.41 1970.9 1864.67 L1970.9 1859.97 Q1972.98 1861.11 1975.21 1861.66 Q1977.43 1862.22 1979.9 1862.22 Q1983.91 1862.22 1986.25 1860.11 Q1988.59 1858.01 1988.59 1854.4 Q1988.59 1850.78 1986.25 1848.68 Q1983.91 1846.57 1979.9 1846.57 Q1978.03 1846.57 1976.15 1846.99 Q1974.3 1847.4 1972.36 1848.28 L1972.36 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip570)" d="M2012.47 1834 Q2008.86 1834 2007.03 1837.57 Q2005.23 1841.11 2005.23 1848.24 Q2005.23 1855.34 2007.03 1858.91 Q2008.86 1862.45 2012.47 1862.45 Q2016.11 1862.45 2017.91 1858.91 Q2019.74 1855.34 2019.74 1848.24 Q2019.74 1841.11 2017.91 1837.57 Q2016.11 1834 2012.47 1834 M2012.47 1830.3 Q2018.28 1830.3 2021.34 1834.9 Q2024.42 1839.49 2024.42 1848.24 Q2024.42 1856.96 2021.34 1861.57 Q2018.28 1866.15 2012.47 1866.15 Q2006.66 1866.15 2003.59 1861.57 Q2000.53 1856.96 2000.53 1848.24 Q2000.53 1839.49 2003.59 1834.9 Q2006.66 1830.3 2012.47 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip570)" d="M2514.84 1861.55 L2522.48 1861.55 L2522.48 1835.18 L2514.17 1836.85 L2514.17 1832.59 L2522.43 1830.92 L2527.11 1830.92 L2527.11 1861.55 L2534.75 1861.55 L2534.75 1865.48 L2514.84 1865.48 L2514.84 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip570)" d="M2554.19 1834 Q2550.58 1834 2548.75 1837.57 Q2546.94 1841.11 2546.94 1848.24 Q2546.94 1855.34 2548.75 1858.91 Q2550.58 1862.45 2554.19 1862.45 Q2557.82 1862.45 2559.63 1858.91 Q2561.46 1855.34 2561.46 1848.24 Q2561.46 1841.11 2559.63 1837.57 Q2557.82 1834 2554.19 1834 M2554.19 1830.3 Q2560 1830.3 2563.06 1834.9 Q2566.13 1839.49 2566.13 1848.24 Q2566.13 1856.96 2563.06 1861.57 Q2560 1866.15 2554.19 1866.15 Q2548.38 1866.15 2545.3 1861.57 Q2542.25 1856.96 2542.25 1848.24 Q2542.25 1839.49 2545.3 1834.9 Q2548.38 1830.3 2554.19 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip570)" d="M2584.35 1834 Q2580.74 1834 2578.91 1837.57 Q2577.11 1841.11 2577.11 1848.24 Q2577.11 1855.34 2578.91 1858.91 Q2580.74 1862.45 2584.35 1862.45 Q2587.99 1862.45 2589.79 1858.91 Q2591.62 1855.34 2591.62 1848.24 Q2591.62 1841.11 2589.79 1837.57 Q2587.99 1834 2584.35 1834 M2584.35 1830.3 Q2590.16 1830.3 2593.22 1834.9 Q2596.3 1839.49 2596.3 1848.24 Q2596.3 1856.96 2593.22 1861.57 Q2590.16 1866.15 2584.35 1866.15 Q2578.54 1866.15 2575.46 1861.57 Q2572.41 1856.96 2572.41 1848.24 Q2572.41 1839.49 2575.46 1834.9 Q2578.54 1830.3 2584.35 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip570)" d="M2614.51 1834 Q2610.9 1834 2609.07 1837.57 Q2607.27 1841.11 2607.27 1848.24 Q2607.27 1855.34 2609.07 1858.91 Q2610.9 1862.45 2614.51 1862.45 Q2618.15 1862.45 2619.95 1858.91 Q2621.78 1855.34 2621.78 1848.24 Q2621.78 1841.11 2619.95 1837.57 Q2618.15 1834 2614.51 1834 M2614.51 1830.3 Q2620.32 1830.3 2623.38 1834.9 Q2626.46 1839.49 2626.46 1848.24 Q2626.46 1856.96 2623.38 1861.57 Q2620.32 1866.15 2614.51 1866.15 Q2608.7 1866.15 2605.62 1861.57 Q2602.57 1856.96 2602.57 1848.24 Q2602.57 1839.49 2605.62 1834.9 Q2608.7 1830.3 2614.51 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip570)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1800.78 151.747,47.2441 "></polyline>
<polyline clip-path="url(#clip570)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1548.09 170.644,1548.09 "></polyline>
<polyline clip-path="url(#clip570)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1225.58 170.644,1225.58 "></polyline>
<polyline clip-path="url(#clip570)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,903.063 170.644,903.063 "></polyline>
<polyline clip-path="url(#clip570)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,580.548 170.644,580.548 "></polyline>
<polyline clip-path="url(#clip570)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,258.034 170.644,258.034 "></polyline>
<path clip-path="url(#clip570)" d="M49.5521 1548.54 L79.2279 1548.54 L79.2279 1552.48 L49.5521 1552.48 L49.5521 1548.54 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip570)" d="M99.8991 1546.23 Q96.7509 1546.23 94.8991 1548.38 Q93.0704 1550.53 93.0704 1554.28 Q93.0704 1558.01 94.8991 1560.19 Q96.7509 1562.34 99.8991 1562.34 Q103.047 1562.34 104.876 1560.19 Q106.728 1558.01 106.728 1554.28 Q106.728 1550.53 104.876 1548.38 Q103.047 1546.23 99.8991 1546.23 M109.181 1531.57 L109.181 1535.83 Q107.422 1535 105.617 1534.56 Q103.834 1534.12 102.075 1534.12 Q97.4454 1534.12 94.9917 1537.25 Q92.5612 1540.37 92.2139 1546.69 Q93.5797 1544.68 95.6398 1543.61 Q97.7 1542.52 100.177 1542.52 Q105.385 1542.52 108.394 1545.7 Q111.427 1548.84 111.427 1554.28 Q111.427 1559.61 108.279 1562.82 Q105.131 1566.04 99.8991 1566.04 Q93.9037 1566.04 90.7325 1561.46 Q87.5612 1556.85 87.5612 1548.13 Q87.5612 1539.93 91.45 1535.07 Q95.3389 1530.19 101.89 1530.19 Q103.649 1530.19 105.431 1530.53 Q107.237 1530.88 109.181 1531.57 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip570)" d="M50.3623 1226.03 L80.0381 1226.03 L80.0381 1229.96 L50.3623 1229.96 L50.3623 1226.03 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip570)" d="M104.297 1224.22 Q107.654 1224.94 109.529 1227.21 Q111.427 1229.48 111.427 1232.81 Q111.427 1237.93 107.908 1240.73 Q104.39 1243.53 97.9083 1243.53 Q95.7324 1243.53 93.4176 1243.09 Q91.126 1242.67 88.6723 1241.82 L88.6723 1237.3 Q90.6167 1238.44 92.9315 1239.01 Q95.2463 1239.59 97.7695 1239.59 Q102.168 1239.59 104.459 1237.86 Q106.774 1236.12 106.774 1232.81 Q106.774 1229.76 104.621 1228.04 Q102.492 1226.31 98.6722 1226.31 L94.6445 1226.31 L94.6445 1222.46 L98.8574 1222.46 Q102.306 1222.46 104.135 1221.1 Q105.964 1219.71 105.964 1217.12 Q105.964 1214.45 104.066 1213.04 Q102.191 1211.61 98.6722 1211.61 Q96.7509 1211.61 94.5519 1212.02 Q92.3528 1212.44 89.7139 1213.32 L89.7139 1209.15 Q92.376 1208.41 94.6908 1208.04 Q97.0287 1207.67 99.0889 1207.67 Q104.413 1207.67 107.515 1210.1 Q110.617 1212.51 110.617 1216.63 Q110.617 1219.5 108.973 1221.49 Q107.33 1223.46 104.297 1224.22 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip570)" d="M99.4824 888.861 Q95.8713 888.861 94.0426 892.426 Q92.2371 895.968 92.2371 903.097 Q92.2371 910.204 94.0426 913.768 Q95.8713 917.31 99.4824 917.31 Q103.117 917.31 104.922 913.768 Q106.751 910.204 106.751 903.097 Q106.751 895.968 104.922 892.426 Q103.117 888.861 99.4824 888.861 M99.4824 885.158 Q105.293 885.158 108.348 889.764 Q111.427 894.347 111.427 903.097 Q111.427 911.824 108.348 916.43 Q105.293 921.014 99.4824 921.014 Q93.6723 921.014 90.5936 916.43 Q87.538 911.824 87.538 903.097 Q87.538 894.347 90.5936 889.764 Q93.6723 885.158 99.4824 885.158 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip570)" d="M104.297 579.194 Q107.654 579.912 109.529 582.18 Q111.427 584.449 111.427 587.782 Q111.427 592.898 107.908 595.699 Q104.39 598.5 97.9083 598.5 Q95.7324 598.5 93.4176 598.06 Q91.126 597.643 88.6723 596.787 L88.6723 592.273 Q90.6167 593.407 92.9315 593.986 Q95.2463 594.564 97.7695 594.564 Q102.168 594.564 104.459 592.828 Q106.774 591.092 106.774 587.782 Q106.774 584.726 104.621 583.013 Q102.492 581.277 98.6722 581.277 L94.6445 581.277 L94.6445 577.435 L98.8574 577.435 Q102.306 577.435 104.135 576.069 Q105.964 574.68 105.964 572.088 Q105.964 569.426 104.066 568.014 Q102.191 566.578 98.6722 566.578 Q96.7509 566.578 94.5519 566.995 Q92.3528 567.412 89.7139 568.291 L89.7139 564.125 Q92.376 563.384 94.6908 563.014 Q97.0287 562.643 99.0889 562.643 Q104.413 562.643 107.515 565.074 Q110.617 567.481 110.617 571.602 Q110.617 574.472 108.973 576.463 Q107.33 578.43 104.297 579.194 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip570)" d="M99.8991 256.171 Q96.7509 256.171 94.8991 258.323 Q93.0704 260.476 93.0704 264.226 Q93.0704 267.953 94.8991 270.129 Q96.7509 272.282 99.8991 272.282 Q103.047 272.282 104.876 270.129 Q106.728 267.953 106.728 264.226 Q106.728 260.476 104.876 258.323 Q103.047 256.171 99.8991 256.171 M109.181 241.518 L109.181 245.777 Q107.422 244.944 105.617 244.504 Q103.834 244.064 102.075 244.064 Q97.4454 244.064 94.9917 247.189 Q92.5612 250.314 92.2139 256.633 Q93.5797 254.62 95.6398 253.555 Q97.7 252.467 100.177 252.467 Q105.385 252.467 108.394 255.638 Q111.427 258.786 111.427 264.226 Q111.427 269.55 108.279 272.768 Q105.131 275.985 99.8991 275.985 Q93.9037 275.985 90.7325 271.402 Q87.5612 266.795 87.5612 258.069 Q87.5612 249.874 91.45 245.013 Q95.3389 240.129 101.89 240.129 Q103.649 240.129 105.431 240.476 Q107.237 240.823 109.181 241.518 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip572)" style="stroke:#009af9; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,1272.33 224.541,1324.26 226.891,1446 229.242,1448.56 231.592,1432.23 233.943,1632.91 236.293,1502.42 238.644,1425.11 240.994,1259.98 243.345,1412.94 245.695,1464.41 248.046,1359.48 250.396,1643.92 252.747,1400.94 255.097,1350.61 257.448,1530.9 259.798,1186.54 262.148,1354.73 264.499,1589.73 266.849,1697.4 269.2,1364.56 271.55,1348.5 273.901,1317.3 276.251,1705.58 278.602,1492.82 280.952,1358.46 283.303,1367.77 285.653,1530.19 288.004,1249.44 290.354,1534.59 292.705,1350.23 295.055,1358.97 297.406,1219.81 299.756,1334.28 302.107,1357.66 304.457,1363.73 306.807,1249.58 309.158,1490.67 311.508,1414.58 313.859,1491.93 316.209,1430.63 318.56,1344.62 320.91,1375.74 323.261,1227.55 325.611,1378.55 327.962,1555.7 330.312,1387.56 332.663,1440.07 335.013,1417.67 337.364,1455.08 339.714,1410.86 342.065,1446.2 344.415,1717.83 346.765,1351.25 349.116,1393.68 351.466,1500.49 353.817,1609.09 356.167,1408.53 358.518,1679.83 360.868,1520.26 363.219,1455.95 365.569,1314.19 367.92,1259.5 370.27,1556.14 372.621,1506.68 374.971,1412.62 377.322,1372.33 379.672,1381.52 382.023,1532.99 384.373,1591.08 386.724,1414.48 389.074,1411.3 391.424,1473.38 393.775,1307.86 396.125,1588.5 398.476,1606.94 400.826,1524.39 403.177,1457.92 405.527,1521.01 407.878,1483.46 410.228,1433.1 412.579,1507.42 414.929,1614.36 417.28,1589.79 419.63,1675.43 421.981,1470.05 424.331,1439.15 426.682,1371.93 429.032,1462.54 431.382,1552.21 433.733,1480.37 436.083,1424.87 438.434,1485.56 440.784,1515.83 443.135,1585.82 445.485,1435.38 447.836,1466.02 450.186,1572.68 452.537,1486.38 454.887,1350.86 457.238,1384.09 459.588,1468.9 461.939,1531.18 464.289,1730.97 466.64,1339.76 468.99,1306.06 471.341,1389.61 473.691,1528.46 476.041,1476.03 478.392,1378.37 480.742,1471.37 483.093,1529.07 485.443,1452.27 487.794,1453.76 490.144,1236.37 492.495,1400.74 494.845,1482 497.196,1465.54 499.546,1477.31 501.897,1467.65 504.247,1346.7 506.598,1300.56 508.948,1535.16 511.299,1453.66 513.649,1445.28 515.999,1395.81 518.35,1491.18 520.7,1244.59 523.051,1622.62 525.401,1581.19 527.752,1349.93 530.102,1527.84 532.453,1562.68 534.803,1519.54 537.154,1459.78 539.504,1292.94 541.855,1374.09 544.205,1328.79 546.556,1408.92 548.906,1505.47 551.257,1388.31 553.607,1454.88 555.958,1527.5 558.308,1419.02 560.658,1473.55 563.009,1287.87 565.359,1321.15 567.71,1561.85 570.06,1296.3 572.411,1531.52 574.761,1422.78 577.112,1354.22 579.462,1403.83 581.813,1346.02 584.163,1312.81 586.514,1583.44 588.864,1423.74 591.215,1376.75 593.565,1573.61 595.916,1645.2 598.266,1412.15 600.616,1354.36 602.967,1531.76 605.317,1298.08 607.668,1271.5 610.018,1370.2 612.369,1397.71 614.719,1582.1 617.07,1323.71 619.42,1453.01 621.771,1462.83 624.121,1581.57 626.472,1438.22 628.822,1532.91 631.173,1416.61 633.523,1395.48 635.874,1323.95 638.224,1492.24 640.575,1472.96 642.925,1325.11 645.275,1490.79 647.626,1541.97 649.976,1239.13 652.327,1333.28 654.677,1423.91 657.028,1482.83 659.378,1491.28 661.729,1390.66 664.079,1432.91 666.43,1370.62 668.78,1259.02 671.131,1434.05 673.481,1379.62 675.832,1490.29 678.182,1643.43 680.533,1641.93 682.883,1411.56 685.233,1410.94 687.584,1439.52 689.934,1358.34 692.285,1516.88 694.635,1558.44 696.986,1424.71 699.336,1615.04 701.687,1487.07 704.037,1639.31 706.388,1654.75 708.738,1539.79 711.089,1454.22 713.439,1273.81 715.79,1553.64 718.14,1479.75 720.491,1355.34 722.841,1461.49 725.192,1543.07 727.542,1621.24 729.892,1455.4 732.243,1434.23 734.593,1316.34 736.944,1333.27 739.294,1407.26 741.645,1394.96 743.995,1572.46 746.346,1232.94 748.696,1506.39 751.047,1405.66 753.397,1461.66 755.748,1518.99 758.098,1249.46 760.449,1402.43 762.799,1400.17 765.15,1263.11 767.5,1490.4 769.85,1300.44 772.201,1306.7 774.551,1618.21 776.902,1434.56 779.252,1567.66 781.603,1541.28 783.953,1570.83 786.304,1509.57 788.654,1608.15 791.005,1514.85 793.355,1511.27 795.706,1356.18 798.056,1217.07 800.407,1528.08 802.757,1310.91 805.108,1340.83 807.458,1494.41 809.809,1385.49 812.159,1337.62 814.509,1499.14 816.86,1313.84 819.21,1562.33 821.561,1280.77 823.911,1520.92 826.262,1489.55 828.612,1567.94 830.963,1564.13 833.313,1429.06 835.664,1518.85 838.014,1416.53 840.365,1576.81 842.715,1488.23 845.066,1458.37 847.416,1212.4 849.767,1343.87 852.117,1303.85 854.467,1580.61 856.818,1410.08 859.168,1618.91 861.519,1437.58 863.869,1430.35 866.22,1615.32 868.57,1376.66 870.921,1486.66 873.271,1247.56 875.622,1388.94 877.972,1276.97 880.323,1421.23 882.673,1503.27 885.024,1268.95 887.374,1439.28 889.725,1416.7 892.075,1562.11 894.426,1531.5 896.776,1273.31 899.126,1455.57 901.477,1555.66 903.827,1386.22 906.178,1461.7 908.528,1269.03 910.879,1651.68 913.229,1534.18 915.58,1567.43 917.93,1580.54 920.281,1512.72 922.631,1379.88 924.982,1500.84 927.332,1421.31 929.683,1337.07 932.033,1160.95 934.384,1510.92 936.734,1297.59 939.084,1269.26 941.435,1661.16 943.785,1390.53 946.136,1337.02 948.486,1593.76 950.837,1323.04 953.187,1597.1 955.538,1387.83 957.888,1453.5 960.239,1415.58 962.589,1412.74 964.94,1375.63 967.29,1528.83 969.641,1286.97 971.991,1353.16 974.342,1425.43 976.692,1544.51 979.043,1469.16 981.393,1545.2 983.743,1544.73 986.094,1411.11 988.444,1571.56 990.795,1446.57 993.145,1449.26 995.496,1427.57 997.846,1376.97 1000.2,1494.99 1002.55,1427.36 1004.9,1668.95 1007.25,1339.19 1009.6,1677.48 1011.95,1500.47 1014.3,1536.58 1016.65,1510.78 1019,1415.54 1021.35,1455.37 1023.7,1219.42 1026.05,1258.59 1028.4,1498.44 1030.75,1330.28 1033.1,1547.2 1035.45,1713.3 1037.8,1453.83 1040.15,1437.53 1042.51,1379.79 1044.86,1326.18 1047.21,1461.56 1049.56,1644.33 1051.91,1702.46 1054.26,1287.63 1056.61,1534.7 1058.96,1439.95 1061.31,1544.81 1063.66,1505.91 1066.01,1395.35 1068.36,1458.88 1070.71,1633.69 1073.06,1663.58 1075.41,1321.26 1077.76,1647.15 1080.11,1341.21 1082.46,1698.85 1084.81,1526.16 1087.16,1515.62 1089.51,1272.37 1091.87,1567.48 1094.22,1427.96 1096.57,1354.2 1098.92,1514.5 1101.27,1465.71 1103.62,1488.38 1105.97,1422.24 1108.32,1314.57 1110.67,1434.49 1113.02,1394.42 1115.37,1281.43 1117.72,1576.08 1120.07,1463.68 1122.42,1595.89 1124.77,1235.48 1127.12,1424 1129.47,1335.64 1131.82,1578.19 1134.17,1357.02 1136.52,1434.52 1138.87,1269.87 1141.23,1419.78 1143.58,1432.44 1145.93,1455.42 1148.28,1440.78 1150.63,1541.15 1152.98,1516.57 1155.33,1339.84 1157.68,1638.44 1160.03,1514.2 1162.38,1490.38 1164.73,1274.16 1167.08,1548.18 1169.43,1751.15 1171.78,1467.96 1174.13,1306.63 1176.48,1419.82 1178.83,1427.04 1181.18,1423.37 1183.53,1470.44 1185.88,1541.53 1188.23,1454.37 1190.59,1747.94 1192.94,1621.33 1195.29,1239.37 1197.64,1440.96 1199.99,1542.53 1202.34,1315.28 1204.69,1551.1 1207.04,1412.9 1209.39,1418.62 1211.74,1590.69 1214.09,1462.62 1216.44,1352.25 1218.79,1482 1221.14,1562.59 1223.49,1322.92 1225.84,1567.01 1228.19,1507.55 1230.54,1509.06 1232.89,1499.58 1235.24,1468.39 1237.59,1616.93 1239.94,1455.71 1242.3,1465.83 1244.65,1278.87 1247,1457.52 1249.35,1539.87 1251.7,1459.52 1254.05,1679.49 1256.4,1481.31 1258.75,1477.75 1261.1,1284.19 1263.45,1389.45 1265.8,1383.16 1268.15,1436.86 1270.5,1476.86 1272.85,1595 1275.2,1485.29 1277.55,1477.7 1279.9,1241.64 1282.25,1331.06 1284.6,1387.08 1286.95,1358.04 1289.3,1621.2 1291.66,1499.87 1294.01,1379.46 1296.36,1528.19 1298.71,1357.24 1301.06,1343.1 1303.41,1569.27 1305.76,1399.59 1308.11,1441.84 1310.46,1545.19 1312.81,1560.74 1315.16,1406.7 1317.51,1570.76 1319.86,1581.13 1322.21,1395.85 1324.56,1446.12 1326.91,1419.79 1329.26,1301.2 1331.61,1343.48 1333.96,1446.55 1336.31,1553.17 1338.66,1392.49 1341.02,1394.63 1343.37,1560.97 1345.72,1312.82 1348.07,1635.31 1350.42,1400 1352.77,1401.35 1355.12,1438.62 1357.47,1261.34 1359.82,1560.77 1362.17,1247.46 1364.52,1493.16 1366.87,1540.94 1369.22,1412 1371.57,1520.98 1373.92,1298.99 1376.27,1482.82 1378.62,1313.32 1380.97,1380.03 1383.32,1357.94 1385.67,1371.46 1388.02,1236.74 1390.38,1508.04 1392.73,1463.8 1395.08,1376.22 1397.43,1379.75 1399.78,1190.07 1402.13,1546.04 1404.48,1483.22 1406.83,1517.48 1409.18,1532.59 1411.53,1429.98 1413.88,1501.31 1416.23,1374.72 1418.58,1599.24 1420.93,1450.7 1423.28,1552.42 1425.63,1499.71 1427.98,1385.24 1430.33,1505.34 1432.68,1547.16 1435.03,1277.4 1437.38,1415.01 1439.74,1361.66 1442.09,1398.07 1444.44,1598.14 1446.79,1426.95 1449.14,1405.19 1451.49,1519.65 1453.84,1429.72 1456.19,1394.76 1458.54,1325.04 1460.89,1617.29 1463.24,1488.75 1465.59,1420.3 1467.94,1381.96 1470.29,1516.66 1472.64,1487.5 1474.99,1562.79 1477.34,1397.88 1479.69,1356.61 1482.04,1413.64 1484.39,1716.4 1486.74,1692.75 1489.1,1517.71 1491.45,1460.77 1493.8,1355.19 1496.15,1575.13 1498.5,1352.95 1500.85,1408.46 1503.2,1464.42 1505.55,1429.16 1507.9,1554.99 1510.25,1576.26 1512.6,1419.54 1514.95,1507.54 1517.3,1615.79 1519.65,1480.92 1522,1379.74 1524.35,1244 1526.7,1494.22 1529.05,1454.68 1531.4,1309.82 1533.75,1445.89 1536.1,1469.57 1538.45,1516.75 1540.81,1396.88 1543.16,1591.01 1545.51,1292.05 1547.86,1466.53 1550.21,1358.23 1552.56,1512.48 1554.91,1414.76 1557.26,1397.22 1559.61,1368.05 1561.96,1494.58 1564.31,1295.35 1566.66,1439.86 1569.01,1477.3 1571.36,1400.01 1573.71,1400.5 1576.06,1314.84 1578.41,1522.32 1580.76,1344.85 1583.11,1412.85 1585.46,1492.83 1587.81,1468.58 1590.17,1529.13 1592.52,1187.15 1594.87,1545.47 1597.22,1417.6 1599.57,1360.86 1601.92,1366.1 1604.27,1368.47 1606.62,1399.46 1608.97,1465.04 1611.32,1569.02 1613.67,1641.25 1616.02,1462.55 1618.37,1476.83 1620.72,1285.62 1623.07,1553.66 1625.42,1388.1 1627.77,1450.53 1630.12,1432.76 1632.47,1422.08 1634.82,1363.35 1637.17,1571.48 1639.53,1517.98 1641.88,1449.82 1644.23,1289.64 1646.58,1529.32 1648.93,1486.76 1651.28,1639.47 1653.63,1564.33 1655.98,1334.7 1658.33,1286.15 1660.68,1444 1663.03,1398.62 1665.38,1525.32 1667.73,1405.9 1670.08,1395.76 1672.43,1549.28 1674.78,1334.56 1677.13,1481.32 1679.48,1571.63 1681.83,1521.7 1684.18,1226.89 1686.53,1527.69 1688.89,1627.42 1691.24,1393.13 1693.59,1566.72 1695.94,1326.78 1698.29,1481.23 1700.64,1404.03 1702.99,1403.85 1705.34,1731.25 1707.69,1490.42 1710.04,1458.72 1712.39,1628.21 1714.74,1615.4 1717.09,1479.1 1719.44,1307.64 1721.79,1273.86 1724.14,1461.86 1726.49,1541.25 1728.84,1268.01 1731.19,1419.76 1733.54,1454.31 1735.89,1574.3 1738.25,1470.85 1740.6,1354.95 1742.95,1214.85 1745.3,1383.54 1747.65,1503.35 1750,1340.97 1752.35,1424.94 1754.7,1500.04 1757.05,1486.12 1759.4,1450.27 1761.75,1506.73 1764.1,1368.42 1766.45,1493.33 1768.8,1548.18 1771.15,1370.91 1773.5,1283.02 1775.85,1449.6 1778.2,1365.78 1780.55,1491.6 1782.9,1351.55 1785.25,1328.52 1787.6,1419.83 1789.96,1421.74 1792.31,1195.53 1794.66,1596.45 1797.01,1433.22 1799.36,1390.51 1801.71,1418.9 1804.06,1366.42 1806.41,1344.39 1808.76,1476.03 1811.11,1529.12 1813.46,1291.63 1815.81,1726.02 1818.16,1460.89 1820.51,1580.5 1822.86,1440.03 1825.21,1485.69 1827.56,1358.92 1829.91,1567.91 1832.26,1546.93 1834.61,1601.67 1836.96,1543.65 1839.32,1343.87 1841.67,1221.13 1844.02,1348.28 1846.37,1301.1 1848.72,1610.04 1851.07,1414.91 1853.42,1480.93 1855.77,1489.11 1858.12,1608.22 1860.47,1399.83 1862.82,1467.38 1865.17,1430.69 1867.52,1336.45 1869.87,1466.17 1872.22,1426.82 1874.57,1467.48 1876.92,1354.45 1879.27,1334.35 1881.62,1400.24 1883.97,1407.65 1886.32,1471.43 1888.68,1451.73 1891.03,1322.9 1893.38,1614.8 1895.73,1474.2 1898.08,1686.69 1900.43,1422.22 1902.78,1207.09 1905.13,1309.94 1907.48,1497.82 1909.83,1234 1912.18,1437.32 1914.53,1354.88 1916.88,1549.01 1919.23,1466.52 1921.58,1311.2 1923.93,1330.9 1926.28,1485.35 1928.63,1420.04 1930.98,1321.74 1933.33,1245.48 1935.68,1535.47 1938.04,1385.22 1940.39,1424.11 1942.74,1500.49 1945.09,1508.42 1947.44,1431.74 1949.79,1329 1952.14,1462.07 1954.49,1596.49 1956.84,1318.8 1959.19,1455.66 1961.54,1622.21 1963.89,1594.74 1966.24,1378.23 1968.59,1423.69 1970.94,1392.67 1973.29,1351.23 1975.64,1555.87 1977.99,1358.53 1980.34,1525 1982.69,1432.18 1985.04,1406.72 1987.4,1347.2 1989.75,1370.19 1992.1,1405.81 1994.45,1586.13 1996.8,1436.42 1999.15,1578.09 2001.5,1521 2003.85,1416.32 2006.2,1476.89 2008.55,1579.44 2010.9,1455.43 2013.25,1551.43 2015.6,1475 2017.95,1342.76 2020.3,1446.18 2022.65,1356.46 2025,1552.36 2027.35,1344.65 2029.7,1436.45 2032.05,1549.08 2034.4,1327.81 2036.76,1523.36 2039.11,1555.84 2041.46,1481.45 2043.81,1229.17 2046.16,1409.73 2048.51,1456.13 2050.86,1576.55 2053.21,1513.49 2055.56,1274.41 2057.91,1404.23 2060.26,1250.33 2062.61,1332.44 2064.96,1429.65 2067.31,1593.09 2069.66,1561.4 2072.01,1242.54 2074.36,1321.9 2076.71,1378.07 2079.06,1326.9 2081.41,1315.83 2083.76,1539.06 2086.11,1489.61 2088.47,1452.26 2090.82,1692.11 2093.17,1387.99 2095.52,1625.41 2097.87,1336.83 2100.22,1309.92 2102.57,1445.86 2104.92,1200.85 2107.27,1354.49 2109.62,1421.56 2111.97,1498.49 2114.32,1433.36 2116.67,1285.61 2119.02,1370.62 2121.37,1518.53 2123.72,1575.08 2126.07,1548.42 2128.42,1432.47 2130.77,1469.16 2133.12,1529.09 2135.47,1500.53 2137.83,1489.03 2140.18,1407.52 2142.53,1369.5 2144.88,1488.14 2147.23,1334.26 2149.58,1495.86 2151.93,1501.97 2154.28,1149.52 2156.63,1394.45 2158.98,1393.18 2161.33,1474.78 2163.68,1435.63 2166.03,1519.08 2168.38,1371.71 2170.73,1441.43 2173.08,1250.66 2175.43,1394.43 2177.78,1532.59 2180.13,1546.52 2182.48,1444.44 2184.83,1391.33 2187.19,1580.89 2189.54,1445.21 2191.89,1405.66 2194.24,1559.12 2196.59,1390.44 2198.94,1344.74 2201.29,1478.21 2203.64,1506.44 2205.99,1440.91 2208.34,1504.01 2210.69,1432 2213.04,1432.32 2215.39,1660.41 2217.74,1318.97 2220.09,1353.28 2222.44,1239.72 2224.79,1370.05 2227.14,1540.46 2229.49,1421.62 2231.84,1403.63 2234.19,1606.66 2236.55,1379.72 2238.9,1687.01 2241.25,1406.83 2243.6,1253.2 2245.95,1508.99 2248.3,1500.82 2250.65,1450.81 2253,1426.81 2255.35,1336.15 2257.7,1564.04 2260.05,1418.69 2262.4,1607.63 2264.75,1494.14 2267.1,1481.99 2269.45,1396.98 2271.8,1601.08 2274.15,1270.48 2276.5,1621.86 2278.85,1336.24 2281.2,1490.98 2283.55,1584.34 2285.91,1643.2 2288.26,1524.13 2290.61,1327.51 2292.96,1210.23 2295.31,1581.95 2297.66,1319.9 2300.01,1485.2 2302.36,1341 2304.71,1498.17 2307.06,1563.98 2309.41,1399.36 2311.76,1327.31 2314.11,1572.12 2316.46,1489.71 2318.81,1351.33 2321.16,1447.97 2323.51,1452.66 2325.86,1393.35 2328.21,1413.83 2330.56,1509.02 2332.91,1256.57 2335.27,1450.74 2337.62,1385.7 2339.97,1491.29 2342.32,1427.06 2344.67,1459.58 2347.02,1550.91 2349.37,1647.28 2351.72,1408.91 2354.07,1314.77 2356.42,1334.48 2358.77,1381.98 2361.12,1430.29 2363.47,1302.32 2365.82,1337.17 2368.17,1436.09 2370.52,1406.44 2372.87,1570.5 2375.22,1344.62 2377.57,1326.75 2379.92,1393.99 2382.27,1315.78 2384.62,1363.1 2386.98,1384.61 2389.33,1419.77 2391.68,1360.3 2394.03,1449.19 2396.38,1539.57 2398.73,1322.85 2401.08,1393.34 2403.43,1308.26 2405.78,1438.68 2408.13,1542.99 2410.48,1445.34 2412.83,1356.87 2415.18,1394.54 2417.53,1434.93 2419.88,1323.5 2422.23,1637.32 2424.58,1486.03 2426.93,1334.29 2429.28,1336.52 2431.63,1575.16 2433.98,1616.77 2436.34,1392.93 2438.69,1535.97 2441.04,1507.83 2443.39,1340.54 2445.74,1431.77 2448.09,1189.32 2450.44,1460.86 2452.79,1469.24 2455.14,1269.64 2457.49,1508.87 2459.84,1604.77 2462.19,1381.96 2464.54,1560.11 2466.89,1272.02 2469.24,1414.81 2471.59,1381.2 2473.94,1360.63 2476.29,1512.59 2478.64,1514.93 2480.99,1547.33 2483.34,1302.55 2485.7,1536.04 2488.05,1391.92 2490.4,1261.66 2492.75,1469.24 2495.1,1699.18 2497.45,1452.53 2499.8,1281.87 2502.15,1382.33 2504.5,1531.87 2506.85,1287.19 2509.2,1342.45 2511.55,1445.3 2513.9,1227.59 2516.25,1517.72 2518.6,1425.34 2520.95,1479.03 2523.3,1458.96 2525.65,1579.34 2528,1330.76 2530.35,1313.52 2532.7,1380.47 2535.06,1490.63 2537.41,1482.15 2539.76,1535.02 2542.11,1514.78 2544.46,1701.26 2546.81,1533.21 2549.16,1500.82 2551.51,1542.38 2553.86,1511.05 2556.21,1608.59 2558.56,1465.22 2560.91,1245.68 2563.26,1421.46 2565.61,1153 2567.96,1360.71 2570.31,1423.14 "></polyline>
<polyline clip-path="url(#clip572)" style="stroke:#e26f46; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,714.556 224.541,883.639 226.891,744.178 229.242,997.196 231.592,705.687 233.943,1009 236.293,608.925 238.644,896.257 240.994,914.699 243.345,1027.02 245.695,883.59 248.046,887.25 250.396,817.051 252.747,724.225 255.097,837.19 257.448,838.085 259.798,821.316 262.148,820.893 264.499,1044.15 266.849,1063.81 269.2,927.836 271.55,851.226 273.901,1024.03 276.251,891.025 278.602,757.788 280.952,864.927 283.303,1045.86 285.653,859.088 288.004,799.324 290.354,815.298 292.705,1047.16 295.055,963.981 297.406,915.877 299.756,870.82 302.107,942.112 304.457,1055.28 306.807,818.108 309.158,1000.43 311.508,822.103 313.859,953.782 316.209,735.614 318.56,855.027 320.91,909.784 323.261,804.334 325.611,928.174 327.962,828.741 330.312,962.375 332.663,756.027 335.013,958.705 337.364,806.147 339.714,987.741 342.065,956.264 344.415,810.617 346.765,815.259 349.116,924.343 351.466,1000.48 353.817,892.732 356.167,870.208 358.518,625.686 360.868,901.108 363.219,1113.17 365.569,774.08 367.92,804.246 370.27,841.574 372.621,1011.89 374.971,850.156 377.322,942.034 379.672,1092.58 382.023,892.971 384.373,678.371 386.724,639.02 389.074,828.004 391.424,771.936 393.775,815.687 396.125,954.652 398.476,675.432 400.826,908.926 403.177,929.048 405.527,717.789 407.878,1028.6 410.228,941.311 412.579,1030.34 414.929,956.18 417.28,1084.91 419.63,959.969 421.981,1003.17 424.331,863.586 426.682,862.283 429.032,908.66 431.382,1038.8 433.733,934.137 436.083,916.344 438.434,1112.84 440.784,812.248 443.135,1071.02 445.485,882.662 447.836,1009.45 450.186,727.421 452.537,1011.53 454.887,684.895 457.238,910.354 459.588,917.55 461.939,888.196 464.289,1055.72 466.64,874.928 468.99,873.318 471.341,827.712 473.691,850.906 476.041,895.843 478.392,797.753 480.742,886.694 483.093,709.682 485.443,1071.91 487.794,1011.01 490.144,968.476 492.495,1028.97 494.845,987.626 497.196,765.765 499.546,818.594 501.897,915.156 504.247,902.265 506.598,733.215 508.948,1080.91 511.299,934.132 513.649,869.525 515.999,903.06 518.35,778.862 520.7,863.102 523.051,843 525.401,875.181 527.752,781.541 530.102,957.678 532.453,769.972 534.803,990.283 537.154,910.591 539.504,1026.79 541.855,849.004 544.205,898.494 546.556,1212.03 548.906,823.434 551.257,891.906 553.607,798.624 555.958,841.236 558.308,759.3 560.658,928.784 563.009,1057.19 565.359,837.975 567.71,806.828 570.06,849.034 572.411,926.716 574.761,941.328 577.112,815.204 579.462,894.457 581.813,1040.29 584.163,1044 586.514,818.1 588.864,853.99 591.215,758.161 593.565,912.753 595.916,960.072 598.266,878.457 600.616,915.742 602.967,1078.12 605.317,973.687 607.668,989.849 610.018,628.379 612.369,1012.92 614.719,996.212 617.07,767.493 619.42,989.899 621.771,883.226 624.121,979.118 626.472,1055.47 628.822,865.032 631.173,900.211 633.523,885.348 635.874,897.501 638.224,952.434 640.575,764.115 642.925,972.677 645.275,965.938 647.626,1055.01 649.976,965.858 652.327,884.379 654.677,992.229 657.028,801.783 659.378,830.478 661.729,917.278 664.079,560.543 666.43,946.932 668.78,837.271 671.131,721.763 673.481,883.075 675.832,812.352 678.182,976.004 680.533,848.823 682.883,685.991 685.233,856.56 687.584,811.729 689.934,903.766 692.285,924.4 694.635,924.456 696.986,964.778 699.336,933.269 701.687,1049.41 704.037,736.751 706.388,1093.03 708.738,1032.02 711.089,906.008 713.439,924.913 715.79,956.883 718.14,929.772 720.491,1020.15 722.841,810.21 725.192,717.325 727.542,926.188 729.892,880.593 732.243,1110.31 734.593,909.385 736.944,929.625 739.294,765.64 741.645,941.71 743.995,770.844 746.346,947.572 748.696,1065.14 751.047,942.075 753.397,876.894 755.748,760.271 758.098,958.296 760.449,773.327 762.799,1002.62 765.15,878.271 767.5,724.548 769.85,774.859 772.201,949.817 774.551,740.519 776.902,887.694 779.252,736.109 781.603,1063.33 783.953,845.936 786.304,975.894 788.654,1021.49 791.005,976.969 793.355,886.507 795.706,1012 798.056,975.552 800.407,928.038 802.757,906.56 805.108,773.365 807.458,967.5 809.809,823.175 812.159,948.533 814.509,819.794 816.86,793.965 819.21,836.296 821.561,1015.57 823.911,798.736 826.262,990.746 828.612,902.439 830.963,925.039 833.313,805.616 835.664,1113.86 838.014,1022.48 840.365,1122.55 842.715,1004.92 845.066,932.268 847.416,884.183 849.767,876.136 852.117,941.492 854.467,959.127 856.818,909.3 859.168,981.82 861.519,991.44 863.869,957.109 866.22,1019.5 868.57,949.424 870.921,772.666 873.271,891.234 875.622,729.49 877.972,812.927 880.323,831.402 882.673,909.098 885.024,1024.9 887.374,842.444 889.725,847.972 892.075,989.785 894.426,806.161 896.776,843.114 899.126,1015.48 901.477,738.344 903.827,783.166 906.178,792.776 908.528,1008.64 910.879,878.216 913.229,779.356 915.58,1001.34 917.93,850.514 920.281,1047.65 922.631,889.19 924.982,1024.52 927.332,1023.63 929.683,1016.81 932.033,741.279 934.384,1051.87 936.734,757.765 939.084,720.955 941.435,940.587 943.785,893.745 946.136,968.224 948.486,859.119 950.837,901.828 953.187,1068.43 955.538,926.477 957.888,979.982 960.239,757.049 962.589,884.174 964.94,815.441 967.29,1036.47 969.641,882.637 971.991,965.059 974.342,877.711 976.692,1086.02 979.043,830.51 981.393,753.78 983.743,791.876 986.094,813.066 988.444,1017.79 990.795,828.453 993.145,945.758 995.496,730.494 997.846,890.757 1000.2,742.728 1002.55,957.224 1004.9,883.307 1007.25,885.91 1009.6,847.978 1011.95,839.888 1014.3,822.8 1016.65,1059.64 1019,892.887 1021.35,718.901 1023.7,953.96 1026.05,1008.04 1028.4,935.156 1030.75,1116.58 1033.1,1036.98 1035.45,1007.97 1037.8,884.997 1040.15,911.916 1042.51,797.559 1044.86,825.551 1047.21,768.993 1049.56,1146.27 1051.91,887.608 1054.26,943.594 1056.61,701.383 1058.96,1052.66 1061.31,773.003 1063.66,927.013 1066.01,1118.25 1068.36,898.99 1070.71,896.617 1073.06,772.646 1075.41,916.857 1077.76,947.447 1080.11,877.744 1082.46,970.68 1084.81,1031.35 1087.16,929.733 1089.51,906.375 1091.87,709.947 1094.22,891.365 1096.57,1130.23 1098.92,883.216 1101.27,867.555 1103.62,721.018 1105.97,1032.47 1108.32,718.824 1110.67,822.692 1113.02,871.142 1115.37,910.277 1117.72,859.482 1120.07,940.092 1122.42,743.105 1124.77,926.037 1127.12,1030.2 1129.47,937.103 1131.82,885.957 1134.17,838.772 1136.52,997.452 1138.87,952.709 1141.23,781.598 1143.58,873.293 1145.93,983.096 1148.28,810.644 1150.63,894.104 1152.98,606.122 1155.33,842.211 1157.68,982.759 1160.03,994.927 1162.38,836.17 1164.73,1042.08 1167.08,891.511 1169.43,851.949 1171.78,846.268 1174.13,907.067 1176.48,696.134 1178.83,798.777 1181.18,883.481 1183.53,858.638 1185.88,811.153 1188.23,1048.44 1190.59,979.839 1192.94,805.647 1195.29,921.235 1197.64,931.898 1199.99,786.481 1202.34,1022.99 1204.69,856.398 1207.04,681.043 1209.39,951.438 1211.74,752.494 1214.09,857.899 1216.44,1103.17 1218.79,846.143 1221.14,832.113 1223.49,1020.24 1225.84,812.825 1228.19,997.713 1230.54,953.184 1232.89,831.459 1235.24,1090.76 1237.59,920.548 1239.94,1029.39 1242.3,855.775 1244.65,816.066 1247,926.87 1249.35,724.333 1251.7,934.733 1254.05,1155.96 1256.4,881.933 1258.75,931.227 1261.1,943.99 1263.45,1025.67 1265.8,741.16 1268.15,959.156 1270.5,809.115 1272.85,996.276 1275.2,873.181 1277.55,1017.79 1279.9,872.409 1282.25,864.651 1284.6,863.362 1286.95,889.057 1289.3,1040.13 1291.66,869.239 1294.01,836.275 1296.36,871.618 1298.71,826.6 1301.06,910.322 1303.41,923.61 1305.76,737.19 1308.11,805.655 1310.46,908.041 1312.81,1036.3 1315.16,1049.32 1317.51,866.668 1319.86,1081.16 1322.21,800.152 1324.56,936.086 1326.91,1003.29 1329.26,692.508 1331.61,927.41 1333.96,779.57 1336.31,963.579 1338.66,433.562 1341.02,942.6 1343.37,1135.59 1345.72,1100.63 1348.07,869.978 1350.42,1103.97 1352.77,862.745 1355.12,999.766 1357.47,873.71 1359.82,950.908 1362.17,1107.78 1364.52,898.406 1366.87,1002.14 1369.22,1056.3 1371.57,950.255 1373.92,690.438 1376.27,794.635 1378.62,892.466 1380.97,822.861 1383.32,891.584 1385.67,930.474 1388.02,721.843 1390.38,1012.43 1392.73,933.857 1395.08,749.14 1397.43,802.116 1399.78,1054.6 1402.13,931.396 1404.48,780.556 1406.83,891.817 1409.18,943.758 1411.53,1122.9 1413.88,864.503 1416.23,921.188 1418.58,934.216 1420.93,809.658 1423.28,934.046 1425.63,1011.28 1427.98,941.693 1430.33,912.946 1432.68,871.065 1435.03,1016.48 1437.38,896.991 1439.74,746.036 1442.09,935.696 1444.44,796.134 1446.79,690.101 1449.14,839.901 1451.49,1050.94 1453.84,858.76 1456.19,1063.21 1458.54,986.378 1460.89,1189.42 1463.24,875.994 1465.59,831.137 1467.94,966.075 1470.29,741.368 1472.64,948.495 1474.99,900.503 1477.34,864.451 1479.69,986.206 1482.04,898.477 1484.39,917.511 1486.74,806.281 1489.1,984.804 1491.45,886.985 1493.8,778.312 1496.15,938.701 1498.5,1187.31 1500.85,1115.55 1503.2,938.365 1505.55,882.398 1507.9,881.078 1510.25,1022.53 1512.6,961.927 1514.95,772.038 1517.3,844.404 1519.65,770.629 1522,995.746 1524.35,815.565 1526.7,1022.1 1529.05,962.94 1531.4,936.958 1533.75,1201.81 1536.1,783.848 1538.45,730.997 1540.81,939.378 1543.16,1071.94 1545.51,984.224 1547.86,1027.72 1550.21,975.395 1552.56,1043.53 1554.91,1146.33 1557.26,1101.06 1559.61,777.347 1561.96,690.638 1564.31,1088.12 1566.66,881.616 1569.01,897.039 1571.36,678.893 1573.71,921.103 1576.06,764.266 1578.41,1026.9 1580.76,763.254 1583.11,835.563 1585.46,813.803 1587.81,906.564 1590.17,841.498 1592.52,952.676 1594.87,966.441 1597.22,758.716 1599.57,807.245 1601.92,885.856 1604.27,883.293 1606.62,957.449 1608.97,1230.61 1611.32,882.367 1613.67,900.052 1616.02,967.733 1618.37,1003.51 1620.72,946.163 1623.07,936.44 1625.42,1077.45 1627.77,876.662 1630.12,925.093 1632.47,908.73 1634.82,853.485 1637.17,744.485 1639.53,977.404 1641.88,921.775 1644.23,1026.4 1646.58,670.703 1648.93,814.769 1651.28,760.849 1653.63,838.897 1655.98,930.862 1658.33,1087.29 1660.68,911.61 1663.03,898.182 1665.38,797.765 1667.73,806.872 1670.08,860.382 1672.43,611.807 1674.78,640.416 1677.13,991.123 1679.48,1005.91 1681.83,915.847 1684.18,957.066 1686.53,824.159 1688.89,1092.9 1691.24,927.8 1693.59,930.089 1695.94,854.188 1698.29,1032.91 1700.64,754.197 1702.99,946.004 1705.34,1060.28 1707.69,822.066 1710.04,836.204 1712.39,908.55 1714.74,863.614 1717.09,1159.92 1719.44,970.819 1721.79,879.98 1724.14,828.869 1726.49,902.456 1728.84,1082.32 1731.19,864.733 1733.54,911.066 1735.89,1008.72 1738.25,1043.54 1740.6,776.429 1742.95,809.666 1745.3,862.608 1747.65,823.701 1750,850.5 1752.35,982.96 1754.7,998.237 1757.05,991.97 1759.4,888.445 1761.75,949.416 1764.1,990.4 1766.45,977.59 1768.8,987.81 1771.15,755.565 1773.5,984.03 1775.85,804.43 1778.2,619.354 1780.55,902.999 1782.9,929.165 1785.25,876.37 1787.6,1041.14 1789.96,798.105 1792.31,871.717 1794.66,936.296 1797.01,813.713 1799.36,865.2 1801.71,834.165 1804.06,962.32 1806.41,827.988 1808.76,990.771 1811.11,1010.2 1813.46,700.839 1815.81,867.557 1818.16,849.241 1820.51,663.559 1822.86,941.05 1825.21,916.128 1827.56,833.484 1829.91,965.589 1832.26,987.705 1834.61,868.438 1836.96,896.698 1839.32,935.202 1841.67,775.048 1844.02,1013.36 1846.37,773.41 1848.72,917.617 1851.07,1012.18 1853.42,791.248 1855.77,925.505 1858.12,1089.25 1860.47,1082.95 1862.82,908.027 1865.17,852.468 1867.52,846.258 1869.87,977.595 1872.22,768.641 1874.57,973.529 1876.92,800.698 1879.27,824.99 1881.62,904.678 1883.97,832.754 1886.32,900.371 1888.68,789.719 1891.03,846.149 1893.38,1132.76 1895.73,954.504 1898.08,828.592 1900.43,857.89 1902.78,793.821 1905.13,883.172 1907.48,1099.01 1909.83,906.371 1912.18,839.522 1914.53,789.168 1916.88,750.859 1919.23,919.985 1921.58,994.989 1923.93,665.913 1926.28,847.155 1928.63,854.851 1930.98,745.521 1933.33,744.992 1935.68,888.297 1938.04,832.325 1940.39,932.732 1942.74,857.261 1945.09,802.989 1947.44,770.717 1949.79,1163.82 1952.14,847.692 1954.49,841.302 1956.84,976.494 1959.19,898.138 1961.54,1090.19 1963.89,1032.89 1966.24,1072.37 1968.59,895.915 1970.94,958.105 1973.29,842.441 1975.64,676.455 1977.99,830.834 1980.34,951.585 1982.69,977.447 1985.04,964.459 1987.4,969.559 1989.75,932.809 1992.1,888.634 1994.45,1011.81 1996.8,814.425 1999.15,971.346 2001.5,833.862 2003.85,1236.63 2006.2,824.454 2008.55,939.244 2010.9,888.75 2013.25,928.484 2015.6,757.587 2017.95,888.91 2020.3,660.82 2022.65,944.635 2025,842.661 2027.35,776.635 2029.7,900.315 2032.05,908.511 2034.4,891.464 2036.76,962.458 2039.11,837.056 2041.46,1093.65 2043.81,1064.93 2046.16,896.693 2048.51,970.577 2050.86,970.353 2053.21,821.995 2055.56,1032.55 2057.91,958.715 2060.26,948.386 2062.61,878.506 2064.96,870.459 2067.31,701.453 2069.66,955.366 2072.01,633.096 2074.36,1059.41 2076.71,891.495 2079.06,698.67 2081.41,941.833 2083.76,991.611 2086.11,893.04 2088.47,984.314 2090.82,748.922 2093.17,506.719 2095.52,731.266 2097.87,849.796 2100.22,804.175 2102.57,878.072 2104.92,828.158 2107.27,908.595 2109.62,910.264 2111.97,825.434 2114.32,1059.13 2116.67,952.086 2119.02,1006.89 2121.37,794.231 2123.72,919.634 2126.07,803.269 2128.42,792.586 2130.77,959.543 2133.12,697.901 2135.47,936.046 2137.83,910.213 2140.18,747.791 2142.53,869.318 2144.88,945.85 2147.23,735.886 2149.58,1041.46 2151.93,912.25 2154.28,826.311 2156.63,922.961 2158.98,727.288 2161.33,745.595 2163.68,845.133 2166.03,842.502 2168.38,902.714 2170.73,912.226 2173.08,817.489 2175.43,664.448 2177.78,1040.16 2180.13,741.495 2182.48,1001.36 2184.83,1049.95 2187.19,878.891 2189.54,915.663 2191.89,789.483 2194.24,971.495 2196.59,836.156 2198.94,913.515 2201.29,1054.39 2203.64,1076.68 2205.99,1028.48 2208.34,1009.95 2210.69,1069.1 2213.04,761.746 2215.39,778.347 2217.74,822.69 2220.09,1125.01 2222.44,982.464 2224.79,843.621 2227.14,716.737 2229.49,927.281 2231.84,1019.16 2234.19,1030.41 2236.55,803.528 2238.9,774.205 2241.25,908.087 2243.6,982.441 2245.95,1014.59 2248.3,842.738 2250.65,1013.39 2253,877.9 2255.35,992.738 2257.7,1101.04 2260.05,874.746 2262.4,785.907 2264.75,790.606 2267.1,1002.02 2269.45,1063.72 2271.8,905.074 2274.15,963.269 2276.5,894.515 2278.85,848.548 2281.2,1068.83 2283.55,971.116 2285.91,851.084 2288.26,799.99 2290.61,644.313 2292.96,738.825 2295.31,804.976 2297.66,909.216 2300.01,887.628 2302.36,993.561 2304.71,1177 2307.06,912.854 2309.41,987.376 2311.76,941.055 2314.11,883.336 2316.46,872.737 2318.81,974.883 2321.16,761.175 2323.51,966.075 2325.86,827.472 2328.21,909.69 2330.56,915.559 2332.91,844.457 2335.27,610.805 2337.62,962.483 2339.97,1049.82 2342.32,878.793 2344.67,786.096 2347.02,1074.71 2349.37,953.43 2351.72,957.059 2354.07,901.63 2356.42,769.391 2358.77,686.134 2361.12,920.658 2363.47,885.472 2365.82,1035.66 2368.17,798.698 2370.52,788.586 2372.87,1006.65 2375.22,855.243 2377.57,936.793 2379.92,1051.52 2382.27,701.973 2384.62,948.887 2386.98,969.335 2389.33,940.441 2391.68,952.174 2394.03,929.638 2396.38,854.006 2398.73,868.939 2401.08,885.613 2403.43,942.231 2405.78,974.108 2408.13,943.107 2410.48,855.164 2412.83,729.167 2415.18,976.35 2417.53,859.37 2419.88,841.193 2422.23,955.218 2424.58,725.113 2426.93,763.026 2429.28,885.785 2431.63,727.047 2433.98,979.696 2436.34,842.623 2438.69,1020.13 2441.04,807.529 2443.39,997.673 2445.74,911.852 2448.09,678.316 2450.44,865.023 2452.79,898.263 2455.14,974.832 2457.49,848.421 2459.84,906.595 2462.19,1007.75 2464.54,931.122 2466.89,882.367 2469.24,795.959 2471.59,814.505 2473.94,846.367 2476.29,816.484 2478.64,833.553 2480.99,989.345 2483.34,1063.99 2485.7,1034.1 2488.05,996.208 2490.4,971.53 2492.75,842.517 2495.1,1097 2497.45,547.499 2499.8,914.726 2502.15,754.208 2504.5,936.614 2506.85,915.006 2509.2,672.977 2511.55,927.768 2513.9,847.381 2516.25,743.521 2518.6,938.104 2520.95,806.268 2523.3,1010.95 2525.65,1018.94 2528,884.447 2530.35,893.659 2532.7,694.21 2535.06,931.794 2537.41,833.817 2539.76,906.774 2542.11,881.401 2544.46,990.966 2546.81,962.767 2549.16,901.334 2551.51,890.447 2553.86,796.096 2556.21,1036.39 2558.56,896.977 2560.91,1125.76 2563.26,977.175 2565.61,920.969 2567.96,1002.89 2570.31,777.179 "></polyline>
<polyline clip-path="url(#clip572)" style="stroke:#3da44d; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,576.559 224.541,428.438 226.891,273.761 229.242,448.164 231.592,419.606 233.943,329.272 236.293,573.461 238.644,369.278 240.994,296.908 243.345,398.529 245.695,491.762 248.046,361.636 250.396,396.166 252.747,453.179 255.097,339.913 257.448,300.502 259.798,532.976 262.148,379.604 264.499,278.061 266.849,368.352 269.2,222.628 271.55,261.127 273.901,478.016 276.251,370.451 278.602,413.904 280.952,465.001 283.303,414.617 285.653,389.867 288.004,243.863 290.354,386.24 292.705,478.637 295.055,402.19 297.406,455.148 299.756,507.662 302.107,112.086 304.457,485.035 306.807,388.737 309.158,493.502 311.508,397.334 313.859,403.989 316.209,364.914 318.56,397.893 320.91,288.654 323.261,379.022 325.611,275.929 327.962,498.157 330.312,223.424 332.663,343.555 335.013,497.363 337.364,257.798 339.714,495.486 342.065,111.571 344.415,204.239 346.765,424.439 349.116,397.911 351.466,372.879 353.817,440.499 356.167,148.254 358.518,244.268 360.868,360.303 363.219,478.721 365.569,474.056 367.92,401.243 370.27,323.489 372.621,446.883 374.971,453.205 377.322,275.065 379.672,269.58 382.023,481.637 384.373,355.062 386.724,309.268 389.074,316.412 391.424,388.423 393.775,377.94 396.125,345.663 398.476,369.983 400.826,170.359 403.177,412.405 405.527,344.558 407.878,336.279 410.228,280.597 412.579,369.502 414.929,113.301 417.28,391.79 419.63,492.003 421.981,536.395 424.331,337.899 426.682,122.806 429.032,511.684 431.382,558.33 433.733,223.403 436.083,463.394 438.434,420.947 440.784,354.02 443.135,293.478 445.485,423.327 447.836,215.419 450.186,526.531 452.537,386.97 454.887,454.444 457.238,427.799 459.588,253.433 461.939,159.14 464.289,402.511 466.64,572.574 468.99,343.356 471.341,311.626 473.691,386.402 476.041,202.415 478.392,490.484 480.742,321.093 483.093,265.279 485.443,535.346 487.794,429.729 490.144,404.157 492.495,485.728 494.845,168.594 497.196,285.521 499.546,463.502 501.897,593.814 504.247,457.287 506.598,286.854 508.948,386.583 511.299,378.334 513.649,205.402 515.999,279.402 518.35,259.777 520.7,261.426 523.051,177.558 525.401,383.987 527.752,293.559 530.102,305.533 532.453,289.134 534.803,344.74 537.154,472.785 539.504,436.172 541.855,419.928 544.205,416.723 546.556,430.902 548.906,373.66 551.257,186.683 553.607,268.301 555.958,282.646 558.308,348.709 560.658,289.304 563.009,363.158 565.359,214.934 567.71,482.844 570.06,316.39 572.411,319.511 574.761,472.742 577.112,509.564 579.462,407.348 581.813,362.288 584.163,417.913 586.514,597.321 588.864,323.037 591.215,501.233 593.565,512.533 595.916,453.033 598.266,306.427 600.616,273.313 602.967,317.339 605.317,260.808 607.668,300.051 610.018,119.198 612.369,325.608 614.719,447.591 617.07,270.574 619.42,133.956 621.771,451.317 624.121,518.566 626.472,506.286 628.822,391.743 631.173,494.322 633.523,315.026 635.874,448.393 638.224,391.336 640.575,303.482 642.925,233.747 645.275,261.097 647.626,405.262 649.976,274.691 652.327,407.893 654.677,381.297 657.028,272.385 659.378,475.911 661.729,325.52 664.079,314.113 666.43,162.363 668.78,461.173 671.131,371.273 673.481,490.182 675.832,498.707 678.182,448.8 680.533,473.963 682.883,225.968 685.233,378.698 687.584,439.394 689.934,373.288 692.285,576.506 694.635,404.031 696.986,276.709 699.336,469.194 701.687,169.46 704.037,276.415 706.388,242.726 708.738,321.38 711.089,277.996 713.439,391.315 715.79,312.292 718.14,312.846 720.491,359.816 722.841,430.418 725.192,164.492 727.542,381.733 729.892,228 732.243,484.18 734.593,211.38 736.944,524.103 739.294,366.493 741.645,432.493 743.995,278.614 746.346,206.411 748.696,256.15 751.047,339.84 753.397,456.981 755.748,309.531 758.098,402.752 760.449,303.834 762.799,416.838 765.15,360.063 767.5,433.5 769.85,294.939 772.201,407.074 774.551,446.203 776.902,321.711 779.252,169.166 781.603,346.948 783.953,332.016 786.304,450.298 788.654,453.863 791.005,395.723 793.355,335.993 795.706,247.392 798.056,398.187 800.407,259.614 802.757,393.783 805.108,320.474 807.458,361.77 809.809,342.363 812.159,374.615 814.509,296.183 816.86,458.146 819.21,197.349 821.561,412.271 823.911,235.217 826.262,113.471 828.612,451.448 830.963,483.644 833.313,306.007 835.664,484.078 838.014,536.079 840.365,316.679 842.715,280.555 845.066,327.401 847.416,175.063 849.767,330.577 852.117,493.714 854.467,451.949 856.818,407.237 859.168,426.927 861.519,357.374 863.869,314.647 866.22,274.413 868.57,364.047 870.921,716.479 873.271,398.027 875.622,376.603 877.972,354.677 880.323,282.893 882.673,593.094 885.024,267.406 887.374,261.703 889.725,396.29 892.075,499.521 894.426,440.462 896.776,331.421 899.126,305.174 901.477,463.121 903.827,438.571 906.178,484.392 908.528,225.932 910.879,473.322 913.229,434.294 915.58,343.305 917.93,332.107 920.281,203.097 922.631,412.928 924.982,306.123 927.332,378.144 929.683,328.739 932.033,227.558 934.384,313.451 936.734,453.997 939.084,441.344 941.435,347.761 943.785,391.187 946.136,517.331 948.486,374 950.837,487.62 953.187,177.038 955.538,404.875 957.888,749.014 960.239,296.792 962.589,474.545 964.94,173.65 967.29,347.401 969.641,456.677 971.991,358.406 974.342,263.936 976.692,542.702 979.043,364.645 981.393,294.375 983.743,553.733 986.094,515.954 988.444,240.043 990.795,433.85 993.145,501.306 995.496,568.22 997.846,280.031 1000.2,168.632 1002.55,339.206 1004.9,451.038 1007.25,543.147 1009.6,325.849 1011.95,269.872 1014.3,353.661 1016.65,429.306 1019,222.017 1021.35,329.298 1023.7,266.755 1026.05,421.885 1028.4,483.071 1030.75,582.487 1033.1,317.637 1035.45,291.266 1037.8,294.182 1040.15,423.622 1042.51,490.652 1044.86,358.904 1047.21,291.244 1049.56,327.91 1051.91,238.909 1054.26,253.426 1056.61,222.045 1058.96,418.506 1061.31,584.665 1063.66,383.256 1066.01,296.272 1068.36,242.716 1070.71,428.62 1073.06,244.891 1075.41,444.135 1077.76,321.497 1080.11,367.037 1082.46,384.954 1084.81,582.683 1087.16,355.174 1089.51,496.664 1091.87,543.127 1094.22,265.374 1096.57,275.051 1098.92,347.123 1101.27,501.266 1103.62,515.821 1105.97,569.721 1108.32,173.008 1110.67,287.034 1113.02,238.96 1115.37,341.647 1117.72,458.791 1120.07,409.297 1122.42,447.298 1124.77,296.949 1127.12,567.86 1129.47,271.157 1131.82,447.644 1134.17,476.04 1136.52,379.106 1138.87,477.623 1141.23,337.536 1143.58,207.946 1145.93,537.615 1148.28,460.841 1150.63,424.686 1152.98,386.397 1155.33,459.481 1157.68,366.308 1160.03,448.707 1162.38,195.057 1164.73,374.604 1167.08,255.067 1169.43,362.604 1171.78,204.052 1174.13,279.643 1176.48,337.727 1178.83,313.793 1181.18,530.528 1183.53,278.417 1185.88,336.123 1188.23,382.556 1190.59,313.162 1192.94,197.172 1195.29,348.26 1197.64,272.664 1199.99,362.538 1202.34,245.359 1204.69,158.824 1207.04,280.25 1209.39,334.313 1211.74,265.574 1214.09,320.414 1216.44,474.021 1218.79,328.981 1221.14,362.036 1223.49,161.901 1225.84,159.791 1228.19,613.45 1230.54,323.228 1232.89,248.408 1235.24,200.421 1237.59,601.569 1239.94,269.883 1242.3,498.191 1244.65,446.422 1247,212.803 1249.35,147.525 1251.7,399.341 1254.05,290.282 1256.4,238.159 1258.75,523.076 1261.1,478.477 1263.45,214.338 1265.8,323.206 1268.15,281.038 1270.5,365.39 1272.85,410.157 1275.2,415.497 1277.55,483.58 1279.9,277.414 1282.25,116.11 1284.6,465.904 1286.95,311.984 1289.3,407.288 1291.66,336.16 1294.01,343.112 1296.36,289.416 1298.71,440.02 1301.06,286.199 1303.41,371.357 1305.76,382.005 1308.11,452.515 1310.46,571.339 1312.81,450.214 1315.16,366.54 1317.51,551.389 1319.86,459.197 1322.21,221.945 1324.56,572.335 1326.91,302.226 1329.26,330.353 1331.61,263.91 1333.96,348.188 1336.31,428.952 1338.66,398.544 1341.02,276.544 1343.37,273.787 1345.72,242.718 1348.07,386.25 1350.42,268.469 1352.77,387.793 1355.12,333.97 1357.47,427.498 1359.82,220.069 1362.17,315.483 1364.52,389.52 1366.87,302.225 1369.22,479.824 1371.57,378.284 1373.92,550.77 1376.27,345.921 1378.62,316.539 1380.97,253.336 1383.32,166.357 1385.67,524.458 1388.02,364.517 1390.38,293.555 1392.73,472.288 1395.08,500.21 1397.43,225.831 1399.78,294.992 1402.13,390.44 1404.48,407.712 1406.83,375.687 1409.18,474.816 1411.53,562.055 1413.88,362.826 1416.23,269.132 1418.58,325.676 1420.93,169.288 1423.28,598.608 1425.63,439.275 1427.98,740.688 1430.33,466.263 1432.68,442.362 1435.03,387.075 1437.38,363.693 1439.74,258.697 1442.09,302.817 1444.44,416.807 1446.79,236.395 1449.14,282.038 1451.49,257.173 1453.84,247.703 1456.19,349.825 1458.54,217.492 1460.89,409.524 1463.24,555.514 1465.59,472.373 1467.94,502.552 1470.29,456.886 1472.64,264.98 1474.99,394.863 1477.34,220.059 1479.69,209.683 1482.04,382.457 1484.39,344.433 1486.74,462.982 1489.1,498.761 1491.45,385.115 1493.8,431.45 1496.15,323.988 1498.5,375.187 1500.85,326.675 1503.2,335.899 1505.55,367.902 1507.9,334.399 1510.25,468.79 1512.6,544.591 1514.95,275.15 1517.3,100.338 1519.65,487.137 1522,358.18 1524.35,318.087 1526.7,347.212 1529.05,341.418 1531.4,406.648 1533.75,152.336 1536.1,346.659 1538.45,465.633 1540.81,469.319 1543.16,243.554 1545.51,364.317 1547.86,589.721 1550.21,467.589 1552.56,248.729 1554.91,285.518 1557.26,282.031 1559.61,190.927 1561.96,510.986 1564.31,466.024 1566.66,361.505 1569.01,195.027 1571.36,477.103 1573.71,568.651 1576.06,325.11 1578.41,353.848 1580.76,284.632 1583.11,313.275 1585.46,341.923 1587.81,238.898 1590.17,235.623 1592.52,363.866 1594.87,378.137 1597.22,343.419 1599.57,389.128 1601.92,468.785 1604.27,632.465 1606.62,433.92 1608.97,408.088 1611.32,513.952 1613.67,349.044 1616.02,376.887 1618.37,304.983 1620.72,259.725 1623.07,139.147 1625.42,276.419 1627.77,295.181 1630.12,563.983 1632.47,124.084 1634.82,547.813 1637.17,340.011 1639.53,492.741 1641.88,362.008 1644.23,332.534 1646.58,303.249 1648.93,345.705 1651.28,397.563 1653.63,212.415 1655.98,344.771 1658.33,308.628 1660.68,299.759 1663.03,324.232 1665.38,262.512 1667.73,218.53 1670.08,425.014 1672.43,508.331 1674.78,416 1677.13,479.153 1679.48,249.548 1681.83,296.398 1684.18,270.879 1686.53,295.084 1688.89,298.315 1691.24,321.119 1693.59,407.176 1695.94,254.101 1698.29,322.766 1700.64,494.262 1702.99,346.706 1705.34,375.51 1707.69,124.82 1710.04,351.219 1712.39,187.206 1714.74,617.701 1717.09,510.045 1719.44,421.56 1721.79,378.419 1724.14,280.409 1726.49,401.213 1728.84,359.302 1731.19,460.262 1733.54,223.788 1735.89,293.335 1738.25,275.444 1740.6,392.42 1742.95,562.379 1745.3,504.934 1747.65,394.042 1750,455.161 1752.35,287.388 1754.7,366.632 1757.05,384.667 1759.4,280.234 1761.75,319.765 1764.1,359.376 1766.45,286.589 1768.8,586.662 1771.15,393.799 1773.5,331.787 1775.85,322.1 1778.2,416.407 1780.55,379.745 1782.9,461.755 1785.25,202.628 1787.6,525.84 1789.96,470.093 1792.31,255.052 1794.66,494.639 1797.01,540.371 1799.36,402.27 1801.71,427.27 1804.06,422.683 1806.41,263.067 1808.76,667.798 1811.11,330.291 1813.46,317.557 1815.81,330.806 1818.16,447.45 1820.51,444.303 1822.86,242.711 1825.21,168.384 1827.56,516.713 1829.91,420.12 1832.26,368.412 1834.61,244.224 1836.96,318.052 1839.32,339.705 1841.67,380.162 1844.02,288.863 1846.37,225.181 1848.72,525.977 1851.07,340.516 1853.42,347.885 1855.77,362.723 1858.12,484.539 1860.47,470.614 1862.82,386.214 1865.17,329.96 1867.52,338.587 1869.87,359.91 1872.22,381.505 1874.57,486.052 1876.92,372.007 1879.27,397.131 1881.62,537.021 1883.97,291.655 1886.32,451.175 1888.68,267.398 1891.03,296.013 1893.38,374.472 1895.73,492.663 1898.08,434.592 1900.43,386.483 1902.78,328.948 1905.13,180.053 1907.48,259.589 1909.83,387.772 1912.18,480.1 1914.53,173.744 1916.88,257.159 1919.23,520.228 1921.58,312.948 1923.93,162.834 1926.28,396.515 1928.63,524.992 1930.98,270.839 1933.33,346.078 1935.68,398.911 1938.04,338.021 1940.39,427.121 1942.74,352.479 1945.09,167.831 1947.44,224.006 1949.79,151.837 1952.14,118.925 1954.49,195.821 1956.84,451.139 1959.19,426.493 1961.54,520.917 1963.89,292.164 1966.24,489.342 1968.59,434.646 1970.94,384.207 1973.29,305.424 1975.64,474.983 1977.99,598.929 1980.34,259.068 1982.69,241.321 1985.04,290.809 1987.4,440.727 1989.75,303.589 1992.1,490.1 1994.45,328.662 1996.8,243.35 1999.15,504.827 2001.5,280.169 2003.85,333.835 2006.2,229.603 2008.55,528.847 2010.9,185.116 2013.25,239.211 2015.6,393.752 2017.95,372.997 2020.3,338.76 2022.65,468.089 2025,391.796 2027.35,273.576 2029.7,304.609 2032.05,201.711 2034.4,492.525 2036.76,479.551 2039.11,521.205 2041.46,283.754 2043.81,336.14 2046.16,294.592 2048.51,364.32 2050.86,607.69 2053.21,181.402 2055.56,270.626 2057.91,405.311 2060.26,242.411 2062.61,516.942 2064.96,359.33 2067.31,520.094 2069.66,447.381 2072.01,267.343 2074.36,419.976 2076.71,306.995 2079.06,464.577 2081.41,412.532 2083.76,315.891 2086.11,234.45 2088.47,191.365 2090.82,390.579 2093.17,348.871 2095.52,515.461 2097.87,415.788 2100.22,663.265 2102.57,351.831 2104.92,470.792 2107.27,313.558 2109.62,394.328 2111.97,303.109 2114.32,370.243 2116.67,245.104 2119.02,439.875 2121.37,301.195 2123.72,306.756 2126.07,349.163 2128.42,330.206 2130.77,403.508 2133.12,440.925 2135.47,424.522 2137.83,232.191 2140.18,278.654 2142.53,350.345 2144.88,468.315 2147.23,246.082 2149.58,194.168 2151.93,317.836 2154.28,446.003 2156.63,617.855 2158.98,392.323 2161.33,444.236 2163.68,263.265 2166.03,449.286 2168.38,302.941 2170.73,559.069 2173.08,363.893 2175.43,421.607 2177.78,533.742 2180.13,417.316 2182.48,327.52 2184.83,294.798 2187.19,321.082 2189.54,514.781 2191.89,166.949 2194.24,556.599 2196.59,486.698 2198.94,327.606 2201.29,179.506 2203.64,416.713 2205.99,181.845 2208.34,397.226 2210.69,386.44 2213.04,428.191 2215.39,426.552 2217.74,424.033 2220.09,453.326 2222.44,364.08 2224.79,481.24 2227.14,402.427 2229.49,619.487 2231.84,320.596 2234.19,538.517 2236.55,485.362 2238.9,235.547 2241.25,394.863 2243.6,352.163 2245.95,356.135 2248.3,303.927 2250.65,235.938 2253,328.315 2255.35,265.89 2257.7,403.767 2260.05,279.217 2262.4,412.509 2264.75,287.09 2267.1,361.128 2269.45,273.587 2271.8,420.782 2274.15,373.407 2276.5,479.924 2278.85,458.133 2281.2,349.684 2283.55,320.269 2285.91,541.269 2288.26,248.78 2290.61,390.636 2292.96,483.546 2295.31,498.415 2297.66,306.709 2300.01,245.48 2302.36,497.586 2304.71,256.152 2307.06,375.379 2309.41,279.586 2311.76,203.776 2314.11,277.361 2316.46,241.325 2318.81,295.345 2321.16,377.741 2323.51,282.459 2325.86,574.826 2328.21,304.857 2330.56,272.492 2332.91,410.725 2335.27,287.577 2337.62,585.201 2339.97,388.39 2342.32,478.635 2344.67,569.078 2347.02,396.486 2349.37,334.292 2351.72,453.691 2354.07,385.344 2356.42,316.201 2358.77,307.894 2361.12,284.02 2363.47,508.432 2365.82,166.688 2368.17,386.862 2370.52,295.781 2372.87,449.676 2375.22,202.042 2377.57,396.877 2379.92,451.126 2382.27,357.971 2384.62,492.911 2386.98,413.756 2389.33,354.684 2391.68,437.097 2394.03,298.275 2396.38,543.41 2398.73,266.534 2401.08,406.038 2403.43,298.828 2405.78,429.769 2408.13,266.925 2410.48,218.85 2412.83,103.234 2415.18,494.856 2417.53,286.848 2419.88,465.757 2422.23,399.126 2424.58,389.789 2426.93,367.389 2429.28,491.669 2431.63,354.42 2433.98,320.791 2436.34,469.433 2438.69,535.188 2441.04,393.55 2443.39,374.299 2445.74,348.09 2448.09,430.35 2450.44,348.426 2452.79,578.223 2455.14,201.799 2457.49,253.964 2459.84,399.582 2462.19,283.576 2464.54,248.548 2466.89,516.635 2469.24,202.268 2471.59,261.375 2473.94,337.896 2476.29,332.414 2478.64,528.886 2480.99,455.632 2483.34,327.361 2485.7,256.213 2488.05,284.183 2490.4,174.357 2492.75,379.466 2495.1,320.328 2497.45,379.432 2499.8,411.113 2502.15,268.26 2504.5,269.996 2506.85,376.355 2509.2,418.737 2511.55,501.59 2513.9,565.855 2516.25,508.142 2518.6,339.575 2520.95,391.972 2523.3,438.132 2525.65,96.8724 2528,310.372 2530.35,171.435 2532.7,371.347 2535.06,445.97 2537.41,527.706 2539.76,375.716 2542.11,346.257 2544.46,494.635 2546.81,407.972 2549.16,317.75 2551.51,408.505 2553.86,197.059 2556.21,299.731 2558.56,385.758 2560.91,370.507 2563.26,245.141 2565.61,392.463 2567.96,365.906 2570.31,364.256 "></polyline>
</svg>
</div>
</div>
<p>Look at that! Things are working; amazin’.</p>
<p>We can also exploit <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>’s parallel sampling capabilities:</p>
<div id="34" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run separate 4 chains for 10 000 iterations using threads to parallelize.</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>num_chains <span class="op">=</span> <span class="fl">4</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    model_with_grad,</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">MCMCThreads</span>(),</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>,</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    num_chains;</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Note we need to provide an initial state for every chain.</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>    initial_state<span class="op">=</span><span class="fu">fill</span>(state, num_chains),</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>samples_array <span class="op">=</span> <span class="fu">stack</span>(<span class="fu">map</span>(<span class="bu">Base</span>.<span class="fu">Fix1</span>(stack, sample <span class="op">-&gt;</span> sample.x), samples))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000×4 Array{Float64, 3}:
[:, :, 1] =
 -1.97977   -1.34815   -4.65749  …  -4.88425      -4.45451   -5.03139
 -0.654919   0.854943   1.27062     -0.000437477   0.762454   0.0289327
  2.34319    3.59259    6.88965      4.23164       4.03316    5.68377

[:, :, 2] =
 -1.97251    -5.07806   -6.19073   …  -5.79937  -5.66434  -4.90956
 -0.0997372   0.606817   0.742669     -1.54724  -1.10607  -0.292144
  3.69281     4.54445    3.49162       5.14493   4.8869    5.54933

[:, :, 3] =
 -2.86386   -2.41338  -3.9906     …  -4.05617   -4.74316   -5.04081
 -0.416041  -1.09196   0.0911087     -0.622473   0.452711   1.29861
  1.31322    4.49216   6.3826         5.68479    4.4499     3.04561

[:, :, 4] =
 -4.70253    -3.50066   -6.93667   …  -5.4371   -3.77187   -3.74735
 -0.0352469   0.624527   0.801962      0.93401   0.176674  -0.987198
  3.80784     4.54428    4.28976       3.90739   6.58958    6.78933</code></pre>
</div>
</div>
<p>But the fact that we have to provide the <code>AbstractMCMC.sample</code> call, etc. with an <code>initial_state</code> to get started is a bit annoying. We can avoid this by also defining a <code>AbstractMCMC.step</code> <em>without</em> the <code>state</code> argument:</p>
<div id="36" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">::</span><span class="dt">MALA</span>;</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># </span><span class="al">NOTE</span><span class="co">: No state provided!</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just create the initial state by sampling using  a Gaussian.</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="fu">randn</span>(rng, LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(x), <span class="fu">MALAState</span>(x)</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Equipped with this, we no longer need to provide the <code>initial_state</code> everywhere:</p>
<div id="38" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -5.02974    0.997457
  0.0357003  1.00661
  4.98606    1.00551</code></pre>
</div>
</div>
</section>
<section id="using-our-sampler-with-turing.jl" class="level2">
<h2 class="anchored" data-anchor-id="using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</h2>
<p>As we promised, all of this hassle of implementing our <code>MALA</code> sampler in a way that uses <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> and <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> gets us something more than <em>just</em> an “automatic” implementation of <code>AbstractMCMC.sample</code>.</p>
<p>It also enables use with Turing.jl through the <code>externalsampler</code>, but we need to do one final thing first: we need to tell Turing.jl how to extract a vector of parameters from the “sample” returned in our implementation of <code>AbstractMCMC.step</code>. In our case, the “sample” is a <code>MALASample</code>, so we just need the following line:</p>
<div id="40" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load Turing.jl.</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Turing</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Overload the `getparams` method for our "sample" type, which is just a vector.</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>Turing.Inference.<span class="fu">getparams</span>(<span class="op">::</span><span class="dt">Turing.Model</span>, sample<span class="op">::</span><span class="dt">MALASample</span>) <span class="op">=</span> sample.x</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And with that, we’re good to go!</p>
<div id="42" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Our previous model defined as a Turing.jl model.</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">mvnormal_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">MvNormal</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.], I)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate our model.</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">mvnormal_model</span>()</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Call `sample` but now we're passing in a Turing.jl `model` and wrapping</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co"># our `MALA` sampler in the `externalsampler` to tell Turing.jl that the sampler</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co"># expects something that implements LogDensityProblems.jl.</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×4×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 2.46 seconds
Compute duration  = 2.46 seconds
parameters        = x[1], x[2], x[3]
internals         = lp

Summary Statistics
  parameters      mean       std      mcse    ess_bulk    ess_tail      rhat   ⋯
      Symbol   Float64   Float64   Float64     Float64     Float64   Float64   ⋯

        x[1]   -4.9860    1.0019    0.0167   3606.1183   5851.5204    1.0002   ⋯
        x[2]   -0.0056    1.0137    0.0180   3165.3944   5233.7094    1.0006   ⋯
        x[3]    4.9947    1.0074    0.0174   3359.8262   5170.4271    1.0005   ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

        x[1]   -6.9416   -5.6583   -4.9871   -4.3145   -3.0203
        x[2]   -2.0042   -0.6846    0.0039    0.6851    1.9556
        x[3]    3.0520    4.3021    4.9994    5.6882    6.9431</code></pre>
</div>
</div>
<p>Pretty neat, eh?</p>
<section id="models-with-constrained-parameters" class="level3">
<h3 class="anchored" data-anchor-id="models-with-constrained-parameters">Models with constrained parameters</h3>
<p>One thing we’ve sort of glossed over in all of the above is that MALA, at least how we’ve implemented it, requires <span class="math inline">\(x\)</span> to live in <span class="math inline">\(\mathbb{R}^d\)</span> for some <span class="math inline">\(d &gt; 0\)</span>. If some of the parameters were in fact constrained, e.g.&nbsp;we were working with a <code>Beta</code> distribution which has support on the interval <span class="math inline">\((0, 1)\)</span>, <em>not</em> on <span class="math inline">\(\mathbb{R}^d\)</span>, we could easily end up outside of the valid range <span class="math inline">\((0, 1)\)</span>.</p>
<div id="44" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">beta_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">beta_model</span>()</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 1.46 seconds
Compute duration  = 1.46 seconds
parameters        = x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse    ess_bulk    ess_tail      rhat   ⋯
      Symbol   Float64   Float64   Float64     Float64     Float64   Float64   ⋯

           x    0.4995    0.1849    0.0028   4295.7447   5815.9652    0.9999   ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

           x    0.1547    0.3618    0.4999    0.6356    0.8470</code></pre>
</div>
</div>
<p>Yep, that still works, but only because Turing.jl actually <em>transforms</em> the <code>turing_model</code> from constrained to unconstrained, so that the <code>sampler</code> provided to <code>externalsampler</code> is actually always working in unconstrained space! This is not always desirable, so we can turn this off:</p>
<div id="46" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 0.24 seconds
Compute duration  = 0.24 seconds
parameters        = x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse   ess_bulk   ess_tail      rhat   e ⋯
      Symbol   Float64   Float64   Float64    Float64    Float64   Float64     ⋯

           x    0.4901    0.2030    0.0179    73.3021    36.3372    1.0021     ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

           x    0.2370    0.3778    0.4912    0.6172    0.7798</code></pre>
</div>
</div>
<p>The fun thing is that this still sort of works because</p>
<div id="48" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">logpdf</span>(<span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>), <span class="fl">10.0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-Inf</code></pre>
</div>
</div>
<p>and so the samples that fall outside of the range are always rejected. But do notice how much worse all the diagnostics are, e.g.&nbsp;<code>ess_tail</code> is very poor compared to when we use <code>unconstrained=true</code>. Moreover, in more complex cases this won’t just result in a “nice” <code>-Inf</code> log-density value, but instead will error:</p>
<div id="50" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="kw">function</span> <span class="fu">demo</span>()</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>    σ² <span class="op">~</span> <span class="fu">truncated</span>(<span class="fu">Normal</span>(), lower<span class="op">=</span><span class="fl">0</span>)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If we end up with negative values for `σ²`, the `Normal` will error.</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>    x <span class="op">~</span> <span class="fu">Normal</span>(<span class="fl">0</span>, σ²)</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>DomainError: DomainError(-0.1198157497041755, "Normal: the condition σ &gt;= zero(σ) is not satisfied.")
DomainError with -0.1198157497041755:
Normal: the condition σ &gt;= zero(σ) is not satisfied.
Stacktrace:
  [1] #371
    @ ~/.julia/packages/Distributions/nmUhn/src/univariate/continuous/normal.jl:37 [inlined]
  [2] check_args
    @ ~/.julia/packages/Distributions/nmUhn/src/utils.jl:89 [inlined]
  [3] #Normal#370
    @ ~/.julia/packages/Distributions/nmUhn/src/univariate/continuous/normal.jl:37 [inlined]
  [4] Normal
    @ ~/.julia/packages/Distributions/nmUhn/src/univariate/continuous/normal.jl:36 [inlined]
  [5] Normal
    @ ~/.julia/packages/Distributions/nmUhn/src/univariate/continuous/normal.jl:42 [inlined]
  [6] macro expansion
    @ ~/.julia/packages/DynamicPPL/MjWTB/src/compiler.jl:579 [inlined]
  [7] demo(__model__::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, __varinfo__::DynamicPPL.ThreadSafeVarInfo{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, Vector{Base.RefValue{Float64}}}, __context__::DynamicPPL.ValuesAsInModelContext{OrderedDict{Any, Any}, DynamicPPL.DefaultContext})
    @ Main.Notebook ~/work/docs/docs/tutorials/docs-17-implementing-samplers/index.qmd:592
  [8] _evaluate!!
    @ ~/.julia/packages/DynamicPPL/MjWTB/src/model.jl:973 [inlined]
  [9] evaluate_threadsafe!!(model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, varinfo::DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, context::DynamicPPL.ValuesAsInModelContext{OrderedDict{Any, Any}, DynamicPPL.DefaultContext})
    @ DynamicPPL ~/.julia/packages/DynamicPPL/MjWTB/src/model.jl:962
 [10] evaluate!!
    @ ~/.julia/packages/DynamicPPL/MjWTB/src/model.jl:892 [inlined]
 [11] values_as_in_model
    @ ~/.julia/packages/DynamicPPL/MjWTB/src/values_as_in_model.jl:196 [inlined]
 [12] values_as_in_model
    @ ~/.julia/packages/DynamicPPL/MjWTB/src/values_as_in_model.jl:195 [inlined]
 [13] getparams(model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, vi::DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64})
    @ Turing.Inference ~/.julia/packages/Turing/Bv30p/src/mcmc/Inference.jl:343
 [14] Turing.Inference.Transition(model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, vi::DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, t::MALASample{Vector{Float64}})
    @ Turing.Inference ~/.julia/packages/Turing/Bv30p/src/mcmc/Inference.jl:226
 [15] transition_to_turing
    @ ~/.julia/packages/Turing/Bv30p/src/mcmc/abstractmcmc.jl:12 [inlined]
 [16] transition_to_turing(f::LogDensityProblemsADForwardDiffExt.ForwardDiffLogDensity{LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, Nothing}, ForwardDiff.Chunk{2}, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}, transition::MALASample{Vector{Float64}})
    @ Turing.Inference ~/.julia/packages/Turing/Bv30p/src/mcmc/abstractmcmc.jl:17
 [17] step(rng::TaskLocalRNG, model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, sampler_wrapper::DynamicPPL.Sampler{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}; initial_state::Nothing, initial_params::Nothing, kwargs::@Kwargs{})
    @ Turing.Inference ~/.julia/packages/Turing/Bv30p/src/mcmc/abstractmcmc.jl:141
 [18] step
    @ ~/.julia/packages/Turing/Bv30p/src/mcmc/abstractmcmc.jl:96 [inlined]
 [19] macro expansion
    @ ~/.julia/packages/AbstractMCMC/YrmkI/src/sample.jl:130 [inlined]
 [20] macro expansion
    @ ~/.julia/packages/AbstractMCMC/YrmkI/src/logging.jl:16 [inlined]
 [21] mcmcsample(rng::TaskLocalRNG, model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, sampler::DynamicPPL.Sampler{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}, N::Int64; progress::Bool, progressname::String, callback::Nothing, discard_initial::Int64, thinning::Int64, chain_type::Type, initial_state::Nothing, kwargs::@Kwargs{})
    @ AbstractMCMC ~/.julia/packages/AbstractMCMC/YrmkI/src/sample.jl:120
 [22] sample(rng::TaskLocalRNG, model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, sampler::DynamicPPL.Sampler{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}, N::Int64; chain_type::Type, resume_from::Nothing, initial_state::Nothing, kwargs::@Kwargs{progress::Bool})
    @ DynamicPPL ~/.julia/packages/DynamicPPL/MjWTB/src/sampler.jl:93
 [23] sample
    @ ~/.julia/packages/DynamicPPL/MjWTB/src/sampler.jl:83 [inlined]
 [24] #sample#4
    @ ~/.julia/packages/Turing/Bv30p/src/mcmc/Inference.jl:276 [inlined]
 [25] sample
    @ ~/.julia/packages/Turing/Bv30p/src/mcmc/Inference.jl:267 [inlined]
 [26] #sample#3
    @ ~/.julia/packages/Turing/Bv30p/src/mcmc/Inference.jl:264 [inlined]
 [27] top-level scope
    @ ~/work/docs/docs/tutorials/docs-17-implementing-samplers/index.qmd:594</code></pre>
</div>
</div>
<p>As expected, we run into a <code>DomainError</code> at some point, while if we set <code>unconstrained=true</code>, letting Turing.jl transform the model to a unconstrained form behind the scenes, everything works as expected:</p>
<div id="52" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 1.6 seconds
Compute duration  = 1.6 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse   ess_bulk   ess_tail      rhat   e ⋯
      Symbol   Float64   Float64   Float64    Float64    Float64   Float64     ⋯

          σ²    0.8529    0.5979    0.0427   121.3942    38.4884    1.0116     ⋯
           x   -0.0480    1.0537    0.0618   439.9968   269.9976    1.0026     ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

          σ²    0.0880    0.3700    0.7337    1.2214    2.2392
           x   -2.5554   -0.4210   -0.0012    0.4026    2.0493</code></pre>
</div>
</div>
<p>Neat!</p>
<p>Similarly, which automatic differentiation backend one should use can be specified through the <code>adtype</code> keyword argument too. For example, if we want to use <a href="https://github.com/JuliaDiff/ReverseDiff.jl">ReverseDiff.jl</a> instead of the default <a href="https://github.com/JuliaDiff/ForwardDiff.jl">ForwardDiff.jl</a>:</p>
<div id="54" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">ReverseDiff</span>: ReverseDiff</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify that we want to use `AutoReverseDiff`.</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">demo</span>(),</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>, adtype<span class="op">=</span><span class="fu">AutoReverseDiff</span>()),</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>;</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 2.85 seconds
Compute duration  = 2.85 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse   ess_bulk   ess_tail      rhat   e ⋯
      Symbol   Float64   Float64   Float64    Float64    Float64   Float64     ⋯

          σ²    0.4428    0.5822    0.1003    25.2636    21.3638    1.4705     ⋯
           x   -0.1795    0.8846    0.1321   114.9869    36.7122    1.5010     ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

          σ²    0.0851    0.0851    0.0851    0.6779    2.2687
           x   -3.1240   -0.0677   -0.0644   -0.0644    1.4930</code></pre>
</div>
</div>
<p>Double-neat.</p>
</section>
</section>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<p>At this point it’s worth maybe reminding ourselves what we did and also <em>why</em> we did it:</p>
<ol type="1">
<li>We define our models in the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface because it makes the sampler agnostic to how the underlying model is implemented.</li>
<li>We implement our sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> interface, which just means that our sampler is a subtype of <code>AbstractMCMC.AbstractSampler</code> and we implement the MCMC transition in <code>AbstractMCMC.step</code>.</li>
<li>Points 1 and 2 makes it so our sampler can be used with a wide range of model implementations, amongst them being models implemented in both Turing.jl and Stan. This gives you, the inference implementer, a large collection of models to test your inference method on, in addition to allowing users of Turing.jl and Stan to try out your inference method with minimal effort.</li>
</ol>


</section>


<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a><div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>We’re going with the leapfrog formulation because in a future version of this tutorial we’ll add a section extending this simple “baseline” MALA sampler to more complex versions. See <a href="https://github.com/TuringLang/docs/issues/479">issue #479</a> for progress on this.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>There is no such thing as a proper interface in Julia (at least not officially), and so we use the word “interface” here to mean a few minimal methods that needs to be implemented by any type that we treat as a target model.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/turinglang\.org\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../tutorials/docs-07-for-developers-variational-inference/index.html" class="pagination-link" aria-label="Variational Inference">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Variational Inference</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Turing is created by <a href="http://mlg.eng.cam.ac.uk/hong/" target="_blank">Hong Ge</a>, and lovingly maintained by the <a href="https://github.com/TuringLang/Turing.jl/graphs/contributors" target="_blank">core team</a> of volunteers. <br> The contents of this website are © 2024 under the terms of the <a href="https://github.com/TuringLang/Turing.jl/blob/master/LICENCE" target="_blank">MIT License</a>.</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/TuringLang/docs/edit/master/tutorials/docs-17-implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/docs/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://x.com/TuringLang">
      <i class="bi bi-twitter" role="img" aria-label="Turing Twitter">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/TuringLang/Turing.jl">
      <i class="bi bi-github" role="img" aria-label="Turing GitHub">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




<script src="../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>