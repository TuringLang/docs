<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.5">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Implementing samplers – Turing.jl</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../tutorials/docs-07-for-developers-variational-inference/index.html" rel="prev">
<link href="../../assets/favicon.ico" rel="icon">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-ff4371ef257df69894857e99c6ad0d06.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark-dec4957386d03255e1655963b31d62d3.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-f80257e2a36ff81c57cea0ffaf822744.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark-3042bfe894fb86cfc239603025ade02d.min.css" rel="prefetch" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<style>
  a {
    text-decoration: none;
  }
  a:hover {
    text-decoration: underline;
  }
</style>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../theming/styles.css">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="https://turinglang.org/" class="navbar-brand navbar-brand-logo">
    <img src="../../assets/images/turing-logo.svg" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="https://turinglang.org/">
    <span class="navbar-title">Turing.jl</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../tutorials/docs-00-getting-started/"> 
<span class="menu-text">Get Started</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../tutorials/00-introduction/"> 
<span class="menu-text">Tutorials</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/library/"> 
<span class="menu-text">Libraries</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/news/"> 
<span class="menu-text">News</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/team/"> 
<span class="menu-text">Team</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-v0.35" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">v0.35</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-v0.35">    
        <li>
    <a class="dropdown-item" href="https://turinglang.org/docs/changelog.html">
 <span class="dropdown-text">Changelog</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://turinglang.org/docs/versions.html">
 <span class="dropdown-text">All Versions</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools tools-wide">
    <a href="https://x.com/TuringLang" title="Turing Twitter" class="quarto-navigation-tool px-1" aria-label="Turing Twitter"><i class="bi bi-twitter"></i></a>
    <a href="https://github.com/TuringLang/Turing.jl" title="Turing GitHub" class="quarto-navigation-tool px-1" aria-label="Turing GitHub"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Developers</li><li class="breadcrumb-item"><a href="../../tutorials/docs-06-for-developers-interface/index.html">Inference (note: outdated)</a></li><li class="breadcrumb-item"><a href="../../tutorials/docs-17-implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false">
 <span class="menu-text">Users</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-00-getting-started/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Getting Started</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-12-using-turing-guide/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Core Functionality</span></a>
  </div>
</li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false">
 <span class="menu-text">Usage Tips</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-10-using-turing-autodiff/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Automatic Differentiation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/usage-custom-distribution/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Custom Distributions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/usage-probability-interface/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Querying Model Probabilities</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/usage-modifying-logprob/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Modifying the Log Probability</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/usage-generated-quantities/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Generated Quantities</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-17-mode-estimation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Mode Estimation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-13-using-turing-performance-tips/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Performance Tips</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-15-using-turing-sampler-viz/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Sampler Visualization</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-11-using-turing-dynamichmc/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using DynamicHMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-16-using-turing-external-samplers/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using External Samplers</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false">
 <span class="menu-text">Tutorials</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/00-introduction/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction: Coin Flipping</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/01-gaussian-mixture-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Mixture Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/02-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/03-bayesian-neural-network/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Neural Networks</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/04-hidden-markov-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Hidden Markov Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/05-linear-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Linear Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/06-infinite-mixture-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Infinite Mixture Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/07-poisson-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Poisson Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/08-multinomial-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Multinomial Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/09-variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/10-bayesian-differential-equations/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Differential Equations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/11-probabilistic-pca/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Probabilistic PCA</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/13-seasonal-time-series/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Time Series Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/15-gaussian-processes/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction to Gaussian Processes</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/12-gplvm/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Process Latent Variable Models</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Developers</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false">
 <span class="menu-text">Contributing</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-01-contributing-guide/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">How to Contribute</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="false">
 <span class="menu-text">DynamicPPL in Depth</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/dev-model-manual/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Manually Defining a Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-05-for-developers-compiler/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Turing Compiler Design</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/14-minituring/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation I: Compiler</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/16-contexts/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation II: Contexts</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true">
 <span class="menu-text">Inference (note: outdated)</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-06-for-developers-interface/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Interface Guide</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-04-for-developers-abstractmcmc-turing/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">How Turing implements AbstractMCMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-07-for-developers-variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-17-implementing-samplers/index.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Implementing Samplers</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of Contents</h2>
   
  <ul>
  <li><a href="#quick-overview-of-mala" id="toc-quick-overview-of-mala" class="nav-link active" data-scroll-target="#quick-overview-of-mala">Quick overview of MALA</a></li>
  <li><a href="#what-we-need-from-a-model-logdensityproblems.jl" id="toc-what-we-need-from-a-model-logdensityproblems.jl" class="nav-link" data-scroll-target="#what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: LogDensityProblems.jl</a></li>
  <li><a href="#implementing-mala-in-abstractmcmc.jl" id="toc-implementing-mala-in-abstractmcmc.jl" class="nav-link" data-scroll-target="#implementing-mala-in-abstractmcmc.jl">Implementing MALA in AbstractMCMC.jl</a></li>
  <li><a href="#using-our-sampler-with-turing.jl" id="toc-using-our-sampler-with-turing.jl" class="nav-link" data-scroll-target="#using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</a>
  <ul class="collapse">
  <li><a href="#models-with-constrained-parameters" id="toc-models-with-constrained-parameters" class="nav-link" data-scroll-target="#models-with-constrained-parameters">Models with constrained parameters</a></li>
  </ul></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/TuringLang/docs/edit/master/tutorials/docs-17-implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/docs/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Developers</li><li class="breadcrumb-item"><a href="../../tutorials/docs-06-for-developers-interface/index.html">Inference (note: outdated)</a></li><li class="breadcrumb-item"><a href="../../tutorials/docs-17-implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Implementing samplers</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>In this tutorial, we’ll go through step-by-step how to implement a “simple” sampler in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> in such a way that it can be easily applied to Turing.jl models.</p>
<p>In particular, we’re going to implement a version of <strong>Metropolis-adjusted Langevin (MALA)</strong>.</p>
<p>Note that we will implement this sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> framework, completely “ignoring” Turing.jl until the very end of the tutorial, at which point we’ll use a single line of code to make the resulting sampler available to Turing.jl. This is to really drive home the point that one can implement samplers in a way that is accessible to all of Turing.jl’s users without having to use Turing.jl yourself.</p>
<section id="quick-overview-of-mala" class="level2">
<h2 class="anchored" data-anchor-id="quick-overview-of-mala">Quick overview of MALA</h2>
<p>We can view MALA as a single step of the leapfrog intergrator with resampling of momentum <span class="math inline">\(p\)</span> at every step.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> To make that statement a bit more concrete, we first define the <em>extended</em> target <span class="math inline">\(\bar{\gamma}(x, p)\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\log \bar{\gamma}(x, p) \propto \log \gamma(x) + \log \gamma_{\mathcal{N}(0, M)}(p)
\end{equation*}\]</span></p>
<p>where <span class="math inline">\(\gamma_{\mathcal{N}(0, M)}\)</span> denotes the density for a zero-centered Gaussian with covariance matrix <span class="math inline">\(M\)</span>. We then consider targeting this joint distribution over both <span class="math inline">\(x\)</span> and <span class="math inline">\(p\)</span> as follows. First we define the map</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  L_{\epsilon}: \quad &amp; \mathbb{R}^d \times \mathbb{R}^d \to \mathbb{R}^d \times \mathbb{R}^d \\
  &amp; (x, p) \mapsto (\tilde{x}, \tilde{p}) := L_{\epsilon}(x, p)
\end{split}
\end{equation*}\]</span></p>
<p>as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p_{1 / 2} &amp;:= p + \frac{\epsilon}{2} \nabla \log \gamma(x) \\
  \tilde{x} &amp;:= x + \epsilon M^{-1} p_{1 /2 } \\
  p_1 &amp;:= p_{1 / 2} + \frac{\epsilon}{2} \nabla \log \gamma(\tilde{x}) \\
  \tilde{p} &amp;:= - p_1
\end{split}
\end{equation*}\]</span></p>
<p>This might be familiar for some readers as a single step of the Leapfrog integrator. We then define the MALA kernel as follows: given the current iterate <span class="math inline">\(x_i\)</span>, we sample the next iterate <span class="math inline">\(x_{i + 1}\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p &amp;\sim \mathcal{N}(0, M) \\
  (\tilde{x}, \tilde{p}) &amp;:= L_{\epsilon}(x_i, p) \\
  \alpha &amp;:= \min \left\{ 1, \frac{\bar{\gamma}(\tilde{x}, \tilde{p})}{\bar{\gamma}(x_i, p)} \right\} \\
  x_{i + 1} &amp;:=
  \begin{cases}
    \tilde{x} \quad &amp; \text{ with prob. } \alpha \\
    x_i       \quad &amp; \text{ with prob. } 1 - \alpha
  \end{cases}
\end{split}
\end{equation*}\]</span></p>
<p>i.e.&nbsp;we accept the proposal <span class="math inline">\(\tilde{x}\)</span> with probability <span class="math inline">\(\alpha\)</span> and reject it, thus sticking with our current iterate, with probability <span class="math inline">\(1 - \alpha\)</span>.</p>
</section>
<section id="what-we-need-from-a-model-logdensityproblems.jl" class="level2">
<h2 class="anchored" data-anchor-id="what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a></h2>
<p>There are a few things we need from the “target” / “model” / density that we want to sample from:</p>
<ol type="1">
<li>We need access to log-density <em>evaluations</em> <span class="math inline">\(\log \gamma(x)\)</span> so we can compute the acceptance ratio involving <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>We need access to log-density <em>gradients</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span> so we can compute the Leapfrog steps <span class="math inline">\(L_{\epsilon}(x, p)\)</span>.</li>
<li>We also need access to the “size” of the model so we can determine the size of <span class="math inline">\(M\)</span>.</li>
</ol>
<p>Luckily for us, there is a package called <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> which provides an interface for <em>exactly</em> this!</p>
<p>To demonstrate how one can implement the “<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface”<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> we will use a simple Gaussian model as an example:</p>
<div id="4" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblems</span>: LogDensityProblems;</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's define some type that represents the model.</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> IsotropicNormalModel{M<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"mean of the isotropic Gaussian"</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    mean<span class="op">::</span><span class="dt">M</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Specifies what input length the model expects.</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">dimension</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> <span class="fu">length</span>(model.mean)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Implementation of the log-density evaluation of the model.</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x<span class="op">::</span><span class="dt">AbstractVector{&lt;:Real}</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">-</span> <span class="fu">sum</span>(abs2, x <span class="op">.-</span> model.mean) <span class="op">/</span> <span class="fl">2</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This gives us all of the properties we want for our MALA sampler with the exception of the computation of the <em>gradient</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span>. There is the method <code>LogDensityProblems.logdensity_and_gradient</code> which should return a 2-tuple where the first entry is the evaluation of the logdensity <span class="math inline">\(\log \gamma(x)\)</span> and the second entry is the gradient <span class="math inline">\(\nabla \log \gamma(x)\)</span>.</p>
<p>There are two ways to “implement” this method: 1) we implement it by hand, which is feasible in the case of our <code>IsotropicNormalModel</code>, or b) we defer the implementation of this to a automatic differentiation backend.</p>
<p>To implement it by hand we can simply do</p>
<div id="6" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl that first-order, i.e. gradient information, is available.</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{1}</span>()</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Implement `logdensity_and_gradient`.</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    logγ_x <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="op">-</span>x <span class="op">.*</span> (x <span class="op">-</span> model.mean)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> logγ_x, ∇logγ_x</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s just try it out:</p>
<div id="8" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate the problem.</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> <span class="fu">IsotropicNormalModel</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.])</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create some example input that we can test on.</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>x_example <span class="op">=</span> <span class="fu">randn</span>(LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate!</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-29.004462286411766</code></pre>
</div>
</div>
<p>To defer it to an automatic differentiation backend, we can do</p>
<div id="10" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl we only have access to 0-th order information.</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{0}</span>()</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Use `LogDensityProblemsAD`'s `ADgradient` in combination with some AD backend to implement `logdensity_and_gradient`.</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblemsAD</span>, <span class="bu">ADTypes</span>, <span class="bu">ForwardDiff</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>model_with_grad <span class="op">=</span> <span class="fu">ADgradient</span>(<span class="fu">AutoForwardDiff</span>(), model)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model_with_grad, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-29.004462286411766</code></pre>
</div>
</div>
<p>We’ll continue with the second approach in this tutorial since this is typically what one does in practice, because there are better hobbies to spend time on than deriving gradients by hand.</p>
<p>At this point, one might wonder how we’re going to tie this back to Turing.jl in the end. Effectively, when working with inference methods that only require log-density evaluations and / or higher-order information of the log-density, Turing.jl actually converts the user-provided <code>Model</code> into an object implementing the above methods for <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>. As a result, most samplers provided by Turing.jl are actually implemented to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, enabling their use both <em>within</em> Turing.jl and <em>outside</em> of Turing.jl! Morever, there exists similar conversions for Stan through BridgeStan and Stan<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, which means that a sampler supporting the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface can easily be used on both Turing.jl <em>and</em> Stan models (in addition to user-provided models, as our <code>IsotropicNormalModel</code> above)!</p>
<p>Anyways, let’s move on to actually implementing the sampler.</p>
</section>
<section id="implementing-mala-in-abstractmcmc.jl" class="level2">
<h2 class="anchored" data-anchor-id="implementing-mala-in-abstractmcmc.jl">Implementing MALA in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a></h2>
<p>Now that we’ve established that a model implementing the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface provides us with all the information we need from <span class="math inline">\(\log \gamma(x)\)</span>, we can address the question: given an object that implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, how can we define a sampler for it?</p>
<p>We’re going to do this by making our sampler a sub-type of <code>AbstractMCMC.AbstractSampler</code> in addition to implementing a few methods from <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>. Why? Because it gets us <em>a lot</em> of functionality for free, as we will see later.</p>
<p>Moreover, <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> provides a very natural interface for MCMC algorithms.</p>
<p>First, we’ll define our <code>MALA</code> type</p>
<div id="12" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">AbstractMCMC</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALA{T,A} <span class="op">&lt;:</span><span class="dt"> AbstractMCMC.AbstractSampler</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"stepsize used in the leapfrog step"</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    ϵ_init<span class="op">::</span><span class="dt">T</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"covariance matrix used for the momentum"</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    M_init<span class="op">::</span><span class="dt">A</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notice how we’ve added the suffix <code>_init</code> to both the stepsize and the covariance matrix. We’ve done this because a <code>AbstractMCMC.AbstractSampler</code> should be <em>immutable</em>. Of course there might be many scenarios where we want to allow something like the stepsize and / or the covariance matrix to vary between iterations, e.g.&nbsp;during the burn-in / adaptation phase of the sampling process we might want to adjust the parameters using statistics computed from these initial iterations. But information which can change between iterations <em>should not go in the sampler itself</em>! Instead, this information should go in the sampler <em>state</em>.</p>
<p>The sampler state should at the very least contain all the necessary information to perform the next MCMC iteration, but usually contains further information, e.g.&nbsp;quantities and statistics useful for evaluating whether the sampler has converged.</p>
<p>We will use the following sampler state for our <code>MALA</code> sampler:</p>
<div id="14" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALAState{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This might seem overly redundant: we’re defining a type <code>MALAState</code> and it only contains a simple vector of reals. In this particular case we indeed could have dropped this and simply used a <code>AbstractVector{&lt;:Real}</code> as our sampler state, but typically, as we will see later, one wants to include other quantities in the sampler state. For example, if we also wanted to adapt the parameters of our <code>MALA</code>, e.g.&nbsp;alter the stepsize depending on acceptance rates, in which case we should also put <code>ϵ</code> in the state, but for now we’ll keep things simple.</p>
<p>Moreover, we also want a <em>sample</em> type, which is a type meant for “public consumption”, i.e.&nbsp;the end-user. This is generally going to contain a subset of the information present in the state. But in such a simple scenario as this, we similarly only have a <code>AbstractVector{&lt;:Real}</code>:</p>
<div id="16" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALASample{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We currently have three things:</p>
<ol type="1">
<li>A <code>AbstractMCMC.AbstractSampler</code> implementation called <code>MALA</code>.</li>
<li>A state <code>MALAState</code> for our sampler <code>MALA</code>.</li>
<li>A sample <code>MALASample</code> for our sampler <code>MALA</code>.</li>
</ol>
<p>That means that we’re ready to implement the only thing that really matters: <code>AbstractMCMC.step</code>.</p>
<p><code>AbstractMCMC.step</code> defines the MCMC iteration of our <code>MALA</code> given the current <code>MALAState</code>. Specifically, the signature of the function is as follows:</p>
<div id="18" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The RNG to ensure reproducibility.</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The model that defines our target.</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.AbstractModel</span>,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The sampler for which we're taking a `step`.</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">AbstractMCMC.AbstractSampler</span>,</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The current sampler `state`.</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    state;</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Additional keyword arguments that we may or may not need.</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Moreover, there is a specific <code>AbstractMCMC.AbstractModel</code> which is used to indicate that the model that is provided implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface: <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Since, as we discussed earlier, in our case we’re indeed going to work with types that support the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, we’ll define <code>AbstractMCMC.step</code> for such a <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Note that <code>AbstractMCMC.LogDensityModel</code> has no other purpose; it has a single field called <code>logdensity</code>, and it does nothing else. But by wrapping the model in <code>AbstractMCMC.LogDensityModel</code>, it allows samplers that want to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> to define their <code>AbstractMCMC.step</code> on this type without running into method ambiguities.</p>
<p>All in all, that means that the signature for our <code>AbstractMCMC.step</code> is going to be the following:</p>
<div id="20" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># `LogDensityModel` so we know we're working with LogDensityProblems.jl model.</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler.</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler state.</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Great! Now let’s actually implement the full <code>AbstractMCMC.step</code> for our <code>MALA</code>.</p>
<p>Let’s remind ourselves what we’re going to do:</p>
<ol type="1">
<li>Sample a new momentum <span class="math inline">\(p\)</span>.</li>
<li>Compute the log-density of the extended target <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>Take a single leapfrog step <span class="math inline">\((\tilde{x}, \tilde{p}) = L_{\epsilon}(x, p)\)</span>.</li>
<li>Accept or reject the proposed <span class="math inline">\((\tilde{x}, \tilde{p})\)</span>.</li>
</ol>
<p>All in all, this results in the following:</p>
<div id="22" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>: Random</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Distributions</span>  <span class="co"># so we get the `MvNormal`</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the wrapped model which implements LogDensityProblems.jl.</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just extract the sampler parameters to make our lives easier.</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    ϵ <span class="op">=</span> sampler.ϵ_init</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    M <span class="op">=</span> sampler.M_init</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the current parameters.</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> state.x</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sample the momentum.</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>    p_dist <span class="op">=</span> <span class="fu">MvNormal</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)), M)</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> <span class="fu">rand</span>(rng, p_dist)</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Propose using a single leapfrog step.</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>    x̃, p̃ <span class="op">=</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Accept or reject proposal.</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>    logp <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p)</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>    logp̃ <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x̃) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p̃)</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>    logα <span class="op">=</span> logp̃ <span class="op">-</span> logp</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>    state_new <span class="op">=</span> <span class="cf">if</span> <span class="fu">log</span>(<span class="fu">rand</span>(rng)) <span class="op">&lt;</span> logα</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Accept.</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x̃)</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Reject.</span></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x)</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return the "sample" and the sampler state.</span></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(state_new.x), state_new</span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Fairly straight-forward.</p>
<p>Of course, we haven’t defined the <code>leapfrog_step</code> method yet, so let’s do that:</p>
<div id="24" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p` using "position" `x`.</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x))</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    p1 <span class="op">=</span> p <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update the "position" `x` using momentum `p1`.</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    x̃ <span class="op">=</span> x <span class="op">+</span> ϵ <span class="op">.*</span> (M <span class="op">\</span> p1)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p1` using position `x̃`</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x̃ <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x̃))</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    p2 <span class="op">=</span> p1 <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x̃</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Flip momentum `p2`.</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    p̃ <span class="op">=</span> <span class="op">-</span>p2</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x̃, p̃</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>leapfrog_step (generic function with 1 method)</code></pre>
</div>
</div>
<p>With all of this, we’re technically ready to sample!</p>
<div id="26" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>, <span class="bu">LinearAlgebra</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>rng <span class="op">=</span> <span class="bu">Random</span>.<span class="fu">default_rng</span>()</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>sampler <span class="op">=</span> <span class="fu">MALA</span>(<span class="fl">1</span>, I)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>state <span class="op">=</span> <span class="fu">MALAState</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)))</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>x_next, state_next <span class="op">=</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    rng,</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    AbstractMCMC.<span class="fu">LogDensityModel</span>(model),</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    state</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>(MALASample{Vector{Float64}}([0.0, 0.0, 0.0]), MALAState{Vector{Float64}}([0.0, 0.0, 0.0]))</code></pre>
</div>
</div>
<p>Great, it works!</p>
<p>And I promised we would get quite some functionality for free if we implemented <code>AbstractMCMC.step</code>, and so we can now simply call <code>sample</code> to perform standard MCMC sampling:</p>
<div id="28" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform 1000 iterations with our `MALA` sampler.</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; initial_state<span class="op">=</span>state, progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Concatenate into a matrix.</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000 Matrix{Float64}:
 -3.17767   -2.62914   -3.41283    -5.06294   …  -6.05257  -6.05257  -4.24818
  0.048018  -0.280721   0.0766346   0.316279      1.69975   1.69975   1.15642
  3.63518    4.72931    6.7454      5.26646       4.62322   4.62322   4.31014</code></pre>
</div>
</div>
<div id="30" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the marginal means and standard deviations.</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -4.95581    0.993768
 -0.0184816  0.999101
  4.99211    1.00667</code></pre>
</div>
</div>
<p>Let’s visualize the samples</p>
<div id="32" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">StatsPlots</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">transpose</span>(samples_matrix[<span class="op">:</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">:</span><span class="kw">end</span>]), alpha<span class="op">=</span><span class="fl">0.5</span>, legend<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<!--?xml version="1.0" encoding="utf-8"?-->
<svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" width="672" height="480" viewbox="0 0 2688 1920">
<defs>
  <clippath id="clip380">
    <rect x="0" y="0" width="2688" height="1920"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip380)" d="M0 1920 L2688 1920 L2688 0 L0 0  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip381">
    <rect x="537" y="0" width="1883" height="1883"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip380)" d="M151.747 1800.78 L2640.76 1800.78 L2640.76 47.2441 L151.747 47.2441  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip382">
    <rect x="151" y="47" width="2490" height="1755"></rect>
  </clippath>
</defs>
<polyline clip-path="url(#clip382)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="219.84,1800.78 219.84,47.2441 "></polyline>
<polyline clip-path="url(#clip382)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="807.458,1800.78 807.458,47.2441 "></polyline>
<polyline clip-path="url(#clip382)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1395.08,1800.78 1395.08,47.2441 "></polyline>
<polyline clip-path="url(#clip382)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1982.69,1800.78 1982.69,47.2441 "></polyline>
<polyline clip-path="url(#clip382)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="2570.31,1800.78 2570.31,47.2441 "></polyline>
<polyline clip-path="url(#clip382)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,1541.66 2640.76,1541.66 "></polyline>
<polyline clip-path="url(#clip382)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,1239.32 2640.76,1239.32 "></polyline>
<polyline clip-path="url(#clip382)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,936.979 2640.76,936.979 "></polyline>
<polyline clip-path="url(#clip382)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,634.638 2640.76,634.638 "></polyline>
<polyline clip-path="url(#clip382)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,332.297 2640.76,332.297 "></polyline>
<polyline clip-path="url(#clip380)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1800.78 2640.76,1800.78 "></polyline>
<polyline clip-path="url(#clip380)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="219.84,1800.78 219.84,1781.88 "></polyline>
<polyline clip-path="url(#clip380)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="807.458,1800.78 807.458,1781.88 "></polyline>
<polyline clip-path="url(#clip380)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1395.08,1800.78 1395.08,1781.88 "></polyline>
<polyline clip-path="url(#clip380)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1982.69,1800.78 1982.69,1781.88 "></polyline>
<polyline clip-path="url(#clip380)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="2570.31,1800.78 2570.31,1781.88 "></polyline>
<path clip-path="url(#clip380)" d="M219.84 1834 Q216.229 1834 214.4 1837.57 Q212.595 1841.11 212.595 1848.24 Q212.595 1855.34 214.4 1858.91 Q216.229 1862.45 219.84 1862.45 Q223.474 1862.45 225.28 1858.91 Q227.108 1855.34 227.108 1848.24 Q227.108 1841.11 225.28 1837.57 Q223.474 1834 219.84 1834 M219.84 1830.3 Q225.65 1830.3 228.706 1834.9 Q231.784 1839.49 231.784 1848.24 Q231.784 1856.96 228.706 1861.57 Q225.65 1866.15 219.84 1866.15 Q214.03 1866.15 210.951 1861.57 Q207.896 1856.96 207.896 1848.24 Q207.896 1839.49 210.951 1834.9 Q214.03 1830.3 219.84 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip380)" d="M771.15 1861.55 L787.47 1861.55 L787.47 1865.48 L765.525 1865.48 L765.525 1861.55 Q768.187 1858.79 772.771 1854.16 Q777.377 1849.51 778.558 1848.17 Q780.803 1845.65 781.683 1843.91 Q782.585 1842.15 782.585 1840.46 Q782.585 1837.71 780.641 1835.97 Q778.72 1834.23 775.618 1834.23 Q773.419 1834.23 770.965 1835 Q768.535 1835.76 765.757 1837.31 L765.757 1832.59 Q768.581 1831.46 771.035 1830.88 Q773.488 1830.3 775.525 1830.3 Q780.896 1830.3 784.09 1832.98 Q787.285 1835.67 787.285 1840.16 Q787.285 1842.29 786.474 1844.21 Q785.687 1846.11 783.581 1848.7 Q783.002 1849.37 779.9 1852.59 Q776.798 1855.78 771.15 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip380)" d="M797.331 1830.92 L815.687 1830.92 L815.687 1834.86 L801.613 1834.86 L801.613 1843.33 Q802.632 1842.98 803.65 1842.82 Q804.669 1842.64 805.687 1842.64 Q811.474 1842.64 814.854 1845.81 Q818.233 1848.98 818.233 1854.4 Q818.233 1859.97 814.761 1863.08 Q811.289 1866.15 804.97 1866.15 Q802.794 1866.15 800.525 1865.78 Q798.28 1865.41 795.872 1864.67 L795.872 1859.97 Q797.956 1861.11 800.178 1861.66 Q802.4 1862.22 804.877 1862.22 Q808.882 1862.22 811.22 1860.11 Q813.558 1858.01 813.558 1854.4 Q813.558 1850.78 811.22 1848.68 Q808.882 1846.57 804.877 1846.57 Q803.002 1846.57 801.127 1846.99 Q799.275 1847.4 797.331 1848.28 L797.331 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip380)" d="M837.446 1834 Q833.835 1834 832.007 1837.57 Q830.201 1841.11 830.201 1848.24 Q830.201 1855.34 832.007 1858.91 Q833.835 1862.45 837.446 1862.45 Q841.081 1862.45 842.886 1858.91 Q844.715 1855.34 844.715 1848.24 Q844.715 1841.11 842.886 1837.57 Q841.081 1834 837.446 1834 M837.446 1830.3 Q843.256 1830.3 846.312 1834.9 Q849.391 1839.49 849.391 1848.24 Q849.391 1856.96 846.312 1861.57 Q843.256 1866.15 837.446 1866.15 Q831.636 1866.15 828.557 1861.57 Q825.502 1856.96 825.502 1848.24 Q825.502 1839.49 828.557 1834.9 Q831.636 1830.3 837.446 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip380)" d="M1354.69 1830.92 L1373.05 1830.92 L1373.05 1834.86 L1358.98 1834.86 L1358.98 1843.33 Q1360 1842.98 1361.01 1842.82 Q1362.03 1842.64 1363.05 1842.64 Q1368.84 1842.64 1372.22 1845.81 Q1375.6 1848.98 1375.6 1854.4 Q1375.6 1859.97 1372.12 1863.08 Q1368.65 1866.15 1362.33 1866.15 Q1360.16 1866.15 1357.89 1865.78 Q1355.64 1865.41 1353.24 1864.67 L1353.24 1859.97 Q1355.32 1861.11 1357.54 1861.66 Q1359.76 1862.22 1362.24 1862.22 Q1366.25 1862.22 1368.58 1860.11 Q1370.92 1858.01 1370.92 1854.4 Q1370.92 1850.78 1368.58 1848.68 Q1366.25 1846.57 1362.24 1846.57 Q1360.37 1846.57 1358.49 1846.99 Q1356.64 1847.4 1354.69 1848.28 L1354.69 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip380)" d="M1394.81 1834 Q1391.2 1834 1389.37 1837.57 Q1387.56 1841.11 1387.56 1848.24 Q1387.56 1855.34 1389.37 1858.91 Q1391.2 1862.45 1394.81 1862.45 Q1398.44 1862.45 1400.25 1858.91 Q1402.08 1855.34 1402.08 1848.24 Q1402.08 1841.11 1400.25 1837.57 Q1398.44 1834 1394.81 1834 M1394.81 1830.3 Q1400.62 1830.3 1403.68 1834.9 Q1406.75 1839.49 1406.75 1848.24 Q1406.75 1856.96 1403.68 1861.57 Q1400.62 1866.15 1394.81 1866.15 Q1389 1866.15 1385.92 1861.57 Q1382.87 1856.96 1382.87 1848.24 Q1382.87 1839.49 1385.92 1834.9 Q1389 1830.3 1394.81 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip380)" d="M1424.97 1834 Q1421.36 1834 1419.53 1837.57 Q1417.73 1841.11 1417.73 1848.24 Q1417.73 1855.34 1419.53 1858.91 Q1421.36 1862.45 1424.97 1862.45 Q1428.61 1862.45 1430.41 1858.91 Q1432.24 1855.34 1432.24 1848.24 Q1432.24 1841.11 1430.41 1837.57 Q1428.61 1834 1424.97 1834 M1424.97 1830.3 Q1430.78 1830.3 1433.84 1834.9 Q1436.92 1839.49 1436.92 1848.24 Q1436.92 1856.96 1433.84 1861.57 Q1430.78 1866.15 1424.97 1866.15 Q1419.16 1866.15 1416.08 1861.57 Q1413.03 1856.96 1413.03 1848.24 Q1413.03 1839.49 1416.08 1834.9 Q1419.16 1830.3 1424.97 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip380)" d="M1940.97 1830.92 L1963.19 1830.92 L1963.19 1832.91 L1950.65 1865.48 L1945.76 1865.48 L1957.57 1834.86 L1940.97 1834.86 L1940.97 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip380)" d="M1972.36 1830.92 L1990.71 1830.92 L1990.71 1834.86 L1976.64 1834.86 L1976.64 1843.33 Q1977.66 1842.98 1978.68 1842.82 Q1979.7 1842.64 1980.72 1842.64 Q1986.5 1842.64 1989.88 1845.81 Q1993.26 1848.98 1993.26 1854.4 Q1993.26 1859.97 1989.79 1863.08 Q1986.32 1866.15 1980 1866.15 Q1977.82 1866.15 1975.55 1865.78 Q1973.31 1865.41 1970.9 1864.67 L1970.9 1859.97 Q1972.98 1861.11 1975.21 1861.66 Q1977.43 1862.22 1979.9 1862.22 Q1983.91 1862.22 1986.25 1860.11 Q1988.59 1858.01 1988.59 1854.4 Q1988.59 1850.78 1986.25 1848.68 Q1983.91 1846.57 1979.9 1846.57 Q1978.03 1846.57 1976.15 1846.99 Q1974.3 1847.4 1972.36 1848.28 L1972.36 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip380)" d="M2012.47 1834 Q2008.86 1834 2007.03 1837.57 Q2005.23 1841.11 2005.23 1848.24 Q2005.23 1855.34 2007.03 1858.91 Q2008.86 1862.45 2012.47 1862.45 Q2016.11 1862.45 2017.91 1858.91 Q2019.74 1855.34 2019.74 1848.24 Q2019.74 1841.11 2017.91 1837.57 Q2016.11 1834 2012.47 1834 M2012.47 1830.3 Q2018.28 1830.3 2021.34 1834.9 Q2024.42 1839.49 2024.42 1848.24 Q2024.42 1856.96 2021.34 1861.57 Q2018.28 1866.15 2012.47 1866.15 Q2006.66 1866.15 2003.59 1861.57 Q2000.53 1856.96 2000.53 1848.24 Q2000.53 1839.49 2003.59 1834.9 Q2006.66 1830.3 2012.47 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip380)" d="M2514.84 1861.55 L2522.48 1861.55 L2522.48 1835.18 L2514.17 1836.85 L2514.17 1832.59 L2522.43 1830.92 L2527.11 1830.92 L2527.11 1861.55 L2534.75 1861.55 L2534.75 1865.48 L2514.84 1865.48 L2514.84 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip380)" d="M2554.19 1834 Q2550.58 1834 2548.75 1837.57 Q2546.94 1841.11 2546.94 1848.24 Q2546.94 1855.34 2548.75 1858.91 Q2550.58 1862.45 2554.19 1862.45 Q2557.82 1862.45 2559.63 1858.91 Q2561.46 1855.34 2561.46 1848.24 Q2561.46 1841.11 2559.63 1837.57 Q2557.82 1834 2554.19 1834 M2554.19 1830.3 Q2560 1830.3 2563.06 1834.9 Q2566.13 1839.49 2566.13 1848.24 Q2566.13 1856.96 2563.06 1861.57 Q2560 1866.15 2554.19 1866.15 Q2548.38 1866.15 2545.3 1861.57 Q2542.25 1856.96 2542.25 1848.24 Q2542.25 1839.49 2545.3 1834.9 Q2548.38 1830.3 2554.19 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip380)" d="M2584.35 1834 Q2580.74 1834 2578.91 1837.57 Q2577.11 1841.11 2577.11 1848.24 Q2577.11 1855.34 2578.91 1858.91 Q2580.74 1862.45 2584.35 1862.45 Q2587.99 1862.45 2589.79 1858.91 Q2591.62 1855.34 2591.62 1848.24 Q2591.62 1841.11 2589.79 1837.57 Q2587.99 1834 2584.35 1834 M2584.35 1830.3 Q2590.16 1830.3 2593.22 1834.9 Q2596.3 1839.49 2596.3 1848.24 Q2596.3 1856.96 2593.22 1861.57 Q2590.16 1866.15 2584.35 1866.15 Q2578.54 1866.15 2575.46 1861.57 Q2572.41 1856.96 2572.41 1848.24 Q2572.41 1839.49 2575.46 1834.9 Q2578.54 1830.3 2584.35 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip380)" d="M2614.51 1834 Q2610.9 1834 2609.07 1837.57 Q2607.27 1841.11 2607.27 1848.24 Q2607.27 1855.34 2609.07 1858.91 Q2610.9 1862.45 2614.51 1862.45 Q2618.15 1862.45 2619.95 1858.91 Q2621.78 1855.34 2621.78 1848.24 Q2621.78 1841.11 2619.95 1837.57 Q2618.15 1834 2614.51 1834 M2614.51 1830.3 Q2620.32 1830.3 2623.38 1834.9 Q2626.46 1839.49 2626.46 1848.24 Q2626.46 1856.96 2623.38 1861.57 Q2620.32 1866.15 2614.51 1866.15 Q2608.7 1866.15 2605.62 1861.57 Q2602.57 1856.96 2602.57 1848.24 Q2602.57 1839.49 2605.62 1834.9 Q2608.7 1830.3 2614.51 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip380)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1800.78 151.747,47.2441 "></polyline>
<polyline clip-path="url(#clip380)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1541.66 170.644,1541.66 "></polyline>
<polyline clip-path="url(#clip380)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1239.32 170.644,1239.32 "></polyline>
<polyline clip-path="url(#clip380)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,936.979 170.644,936.979 "></polyline>
<polyline clip-path="url(#clip380)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,634.638 170.644,634.638 "></polyline>
<polyline clip-path="url(#clip380)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,332.297 170.644,332.297 "></polyline>
<path clip-path="url(#clip380)" d="M49.5521 1542.11 L79.2279 1542.11 L79.2279 1546.05 L49.5521 1546.05 L49.5521 1542.11 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip380)" d="M99.8991 1539.8 Q96.7509 1539.8 94.8991 1541.95 Q93.0704 1544.1 93.0704 1547.85 Q93.0704 1551.58 94.8991 1553.76 Q96.7509 1555.91 99.8991 1555.91 Q103.047 1555.91 104.876 1553.76 Q106.728 1551.58 106.728 1547.85 Q106.728 1544.1 104.876 1541.95 Q103.047 1539.8 99.8991 1539.8 M109.181 1525.15 L109.181 1529.4 Q107.422 1528.57 105.617 1528.13 Q103.834 1527.69 102.075 1527.69 Q97.4454 1527.69 94.9917 1530.82 Q92.5612 1533.94 92.2139 1540.26 Q93.5797 1538.25 95.6398 1537.18 Q97.7 1536.09 100.177 1536.09 Q105.385 1536.09 108.394 1539.27 Q111.427 1542.41 111.427 1547.85 Q111.427 1553.18 108.279 1556.4 Q105.131 1559.61 99.8991 1559.61 Q93.9037 1559.61 90.7325 1555.03 Q87.5612 1550.42 87.5612 1541.7 Q87.5612 1533.5 91.45 1528.64 Q95.3389 1523.76 101.89 1523.76 Q103.649 1523.76 105.431 1524.1 Q107.237 1524.45 109.181 1525.15 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip380)" d="M50.3623 1239.77 L80.0381 1239.77 L80.0381 1243.71 L50.3623 1243.71 L50.3623 1239.77 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip380)" d="M104.297 1237.97 Q107.654 1238.68 109.529 1240.95 Q111.427 1243.22 111.427 1246.55 Q111.427 1251.67 107.908 1254.47 Q104.39 1257.27 97.9083 1257.27 Q95.7324 1257.27 93.4176 1256.83 Q91.126 1256.42 88.6723 1255.56 L88.6723 1251.04 Q90.6167 1252.18 92.9315 1252.76 Q95.2463 1253.34 97.7695 1253.34 Q102.168 1253.34 104.459 1251.6 Q106.774 1249.86 106.774 1246.55 Q106.774 1243.5 104.621 1241.79 Q102.492 1240.05 98.6722 1240.05 L94.6445 1240.05 L94.6445 1236.21 L98.8574 1236.21 Q102.306 1236.21 104.135 1234.84 Q105.964 1233.45 105.964 1230.86 Q105.964 1228.2 104.066 1226.79 Q102.191 1225.35 98.6722 1225.35 Q96.7509 1225.35 94.5519 1225.77 Q92.3528 1226.18 89.7139 1227.06 L89.7139 1222.9 Q92.376 1222.16 94.6908 1221.79 Q97.0287 1221.42 99.0889 1221.42 Q104.413 1221.42 107.515 1223.85 Q110.617 1226.25 110.617 1230.37 Q110.617 1233.24 108.973 1235.23 Q107.33 1237.2 104.297 1237.97 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip380)" d="M99.4824 922.778 Q95.8713 922.778 94.0426 926.343 Q92.2371 929.884 92.2371 937.014 Q92.2371 944.12 94.0426 947.685 Q95.8713 951.227 99.4824 951.227 Q103.117 951.227 104.922 947.685 Q106.751 944.12 106.751 937.014 Q106.751 929.884 104.922 926.343 Q103.117 922.778 99.4824 922.778 M99.4824 919.074 Q105.293 919.074 108.348 923.681 Q111.427 928.264 111.427 937.014 Q111.427 945.741 108.348 950.347 Q105.293 954.93 99.4824 954.93 Q93.6723 954.93 90.5936 950.347 Q87.538 945.741 87.538 937.014 Q87.538 928.264 90.5936 923.681 Q93.6723 919.074 99.4824 919.074 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip380)" d="M104.297 633.284 Q107.654 634.001 109.529 636.27 Q111.427 638.538 111.427 641.872 Q111.427 646.987 107.908 649.788 Q104.39 652.589 97.9083 652.589 Q95.7324 652.589 93.4176 652.149 Q91.126 651.733 88.6723 650.876 L88.6723 646.362 Q90.6167 647.497 92.9315 648.075 Q95.2463 648.654 97.7695 648.654 Q102.168 648.654 104.459 646.918 Q106.774 645.182 106.774 641.872 Q106.774 638.816 104.621 637.103 Q102.492 635.367 98.6722 635.367 L94.6445 635.367 L94.6445 631.525 L98.8574 631.525 Q102.306 631.525 104.135 630.159 Q105.964 628.77 105.964 626.177 Q105.964 623.515 104.066 622.103 Q102.191 620.668 98.6722 620.668 Q96.7509 620.668 94.5519 621.085 Q92.3528 621.502 89.7139 622.381 L89.7139 618.214 Q92.376 617.474 94.6908 617.103 Q97.0287 616.733 99.0889 616.733 Q104.413 616.733 107.515 619.164 Q110.617 621.571 110.617 625.691 Q110.617 628.562 108.973 630.552 Q107.33 632.52 104.297 633.284 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip380)" d="M99.8991 330.434 Q96.7509 330.434 94.8991 332.586 Q93.0704 334.739 93.0704 338.489 Q93.0704 342.216 94.8991 344.392 Q96.7509 346.545 99.8991 346.545 Q103.047 346.545 104.876 344.392 Q106.728 342.216 106.728 338.489 Q106.728 334.739 104.876 332.586 Q103.047 330.434 99.8991 330.434 M109.181 315.781 L109.181 320.04 Q107.422 319.207 105.617 318.767 Q103.834 318.327 102.075 318.327 Q97.4454 318.327 94.9917 321.452 Q92.5612 324.577 92.2139 330.896 Q93.5797 328.883 95.6398 327.818 Q97.7 326.73 100.177 326.73 Q105.385 326.73 108.394 329.901 Q111.427 333.049 111.427 338.489 Q111.427 343.813 108.279 347.031 Q105.131 350.248 99.8991 350.248 Q93.9037 350.248 90.7325 345.665 Q87.5612 341.058 87.5612 332.332 Q87.5612 324.137 91.45 319.276 Q95.3389 314.392 101.89 314.392 Q103.649 314.392 105.431 314.739 Q107.237 315.086 109.181 315.781 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip382)" style="stroke:#009af9; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,1257.23 224.541,1490.25 226.891,1409.15 229.242,1388.62 231.592,1238.14 233.943,1453.8 236.293,1516.82 238.644,1288.35 240.994,1638.51 243.345,1280.22 245.695,1286.21 248.046,1608.61 250.396,1517.55 252.747,1314.88 255.097,1550.56 257.448,1462.73 259.798,1311.01 262.148,1491.53 264.499,1404.94 266.849,1617.62 269.2,1197.58 271.55,1504.11 273.901,1201.9 276.251,1417.07 278.602,1432.41 280.952,1502.83 283.303,1468.62 285.653,1444.01 288.004,1390.44 290.354,1613.06 292.705,1535.61 295.055,1444.82 297.406,1427.78 299.756,1350.04 302.107,1517.32 304.457,1351.24 306.807,1443.05 309.158,1482.12 311.508,1455.57 313.859,1428.01 316.209,1490.83 318.56,1494.12 320.91,1431.02 323.261,1521.67 325.611,1447.71 327.962,1366.29 330.312,1520.39 332.663,1405.51 335.013,1447.19 337.364,1338.4 339.714,1598.32 342.065,1584.37 344.415,1483.82 346.765,1507.7 349.116,1427.12 351.466,1263.83 353.817,1387.33 356.167,1440.62 358.518,1586.01 360.868,1278.18 363.219,1619.55 365.569,1342.96 367.92,1321.34 370.27,1528.38 372.621,1493.58 374.971,1395.67 377.322,1460.64 379.672,1360.04 382.023,1583.78 384.373,1506.19 386.724,1532.03 389.074,1501.44 391.424,1347.69 393.775,1374.13 396.125,1277.57 398.476,1416.74 400.826,1386.09 403.177,1507.75 405.527,1240.63 407.878,1344.16 410.228,1409.91 412.579,1398.97 414.929,1481.23 417.28,1322.38 419.63,1478.79 421.981,1458.92 424.331,1434.64 426.682,1354.56 429.032,1465.11 431.382,1591.16 433.733,1421.89 436.083,1350.35 438.434,1320.49 440.784,1550.99 443.135,1363.65 445.485,1598 447.836,1431.14 450.186,1303.06 452.537,1553.08 454.887,1475.23 457.238,1457.71 459.588,1463.27 461.939,1503.86 464.289,1459.49 466.64,1551.83 468.99,1451.96 471.341,1493.55 473.691,1470.99 476.041,1514.51 478.392,1520.64 480.742,1303.5 483.093,1404.16 485.443,1369.51 487.794,1412.52 490.144,1531.2 492.495,1538.24 494.845,1502.69 497.196,1459.55 499.546,1329.68 501.897,1478.08 504.247,1592.46 506.598,1536.45 508.948,1370.58 511.299,1362.51 513.649,1453.37 515.999,1532.9 518.35,1428.82 520.7,1508.59 523.051,1469.07 525.401,1382.67 527.752,1259.07 530.102,1539.17 532.453,1582.28 534.803,1513.66 537.154,1207.42 539.504,1339.13 541.855,1360.66 544.205,1437.05 546.556,1550.37 548.906,1371.86 551.257,1576.85 553.607,1485.21 555.958,1425.25 558.308,1185.38 560.658,1387.09 563.009,1312.1 565.359,1370.2 567.71,1411.62 570.06,1517.38 572.411,1446.47 574.761,1520.71 577.112,1537.53 579.462,1438.25 581.813,1258.53 584.163,1508.81 586.514,1554.6 588.864,1305.18 591.215,1378.87 593.565,1482.64 595.916,1565.27 598.266,1435.45 600.616,1579.39 602.967,1559.38 605.317,1424.8 607.668,1462.54 610.018,1259.12 612.369,1588.69 614.719,1446.24 617.07,1485.96 619.42,1485.5 621.771,1497.69 624.121,1292.98 626.472,1478.01 628.822,1293.75 631.173,1436.32 633.523,1319.44 635.874,1535.48 638.224,1592.47 640.575,1582.97 642.925,1443.89 645.275,1602.25 647.626,1505.54 649.976,1580.25 652.327,1471.53 654.677,1453.14 657.028,1443.01 659.378,1282.63 661.729,1352.48 664.079,1492.2 666.43,1561.6 668.78,1435.49 671.131,1423.9 673.481,1480.87 675.832,1484.98 678.182,1423.86 680.533,1400.67 682.883,1342.24 685.233,1491.22 687.584,1341.16 689.934,1562.21 692.285,1134.54 694.635,1525.71 696.986,1570.26 699.336,1365.95 701.687,1596.65 704.037,1301.94 706.388,1553.34 708.738,1570.78 711.089,1450.27 713.439,1403.57 715.79,1457.33 718.14,1417.1 720.491,1444.89 722.841,1433.41 725.192,1509.75 727.542,1471.27 729.892,1607.86 732.243,1463.4 734.593,1361.46 736.944,1590.12 739.294,1443.68 741.645,1562.72 743.995,1514.18 746.346,1448.44 748.696,1480.01 751.047,1359.55 753.397,1331.56 755.748,1602.35 758.098,1449.76 760.449,1275.61 762.799,1354.92 765.15,1373.63 767.5,1503.73 769.85,1427.92 772.201,1494.28 774.551,1461.71 776.902,1393.79 779.252,1387.61 781.603,1403.6 783.953,1488.9 786.304,1277.47 788.654,1347.75 791.005,1260.57 793.355,1303.24 795.706,1379.22 798.056,1499.07 800.407,1385.81 802.757,1357.39 805.108,1330.82 807.458,1603.69 809.809,1303.04 812.159,1507.3 814.509,1445.14 816.86,1469.72 819.21,1451.32 821.561,1413.83 823.911,1617.56 826.262,1498.54 828.612,1443.39 830.963,1409.18 833.313,1617.61 835.664,1522.37 838.014,1357.07 840.365,1638.67 842.715,1287.23 845.066,1433.14 847.416,1482.44 849.767,1377.81 852.117,1630.71 854.467,1478.79 856.818,1495.54 859.168,1588.09 861.519,1382.85 863.869,1275.33 866.22,1533.65 868.57,1528.73 870.921,1591.92 873.271,1506.7 875.622,1360.68 877.972,1384.44 880.323,1320.28 882.673,1660.1 885.024,1472.56 887.374,1608.45 889.725,1268.33 892.075,1492.29 894.426,1510.11 896.776,1595.78 899.126,1597.79 901.477,1364.82 903.827,1589.2 906.178,1558.82 908.528,1318.9 910.879,1235.08 913.229,1508.04 915.58,1507.82 917.93,1417.3 920.281,1519.83 922.631,1318.58 924.982,1444 927.332,1377.79 929.683,1246.23 932.033,1458.19 934.384,1334.17 936.734,1429.25 939.084,1461.75 941.435,1395.44 943.785,1403.77 946.136,1477.22 948.486,1370.49 950.837,1411.88 953.187,1380.8 955.538,1300.66 957.888,1350.34 960.239,1511.62 962.589,1381.49 964.94,1511.26 967.29,1408.47 969.641,1470.51 971.991,1194.62 974.342,1358.58 976.692,1494.57 979.043,1421.96 981.393,1488.01 983.743,1393.11 986.094,1305.95 988.444,1588.13 990.795,1423.39 993.145,1510.58 995.496,1492.88 997.846,1369.4 1000.2,1515.68 1002.55,1373.6 1004.9,1407.09 1007.25,1535.28 1009.6,1541.04 1011.95,1447.36 1014.3,1362.79 1016.65,1426.83 1019,1619.57 1021.35,1507.7 1023.7,1202.3 1026.05,1510.92 1028.4,1269.85 1030.75,1297.91 1033.1,1489.19 1035.45,1562.28 1037.8,1420.79 1040.15,1419.21 1042.51,1491.91 1044.86,1441.05 1047.21,1342.79 1049.56,1392.41 1051.91,1545.59 1054.26,1352.78 1056.61,1420.08 1058.96,1287.92 1061.31,1558.32 1063.66,1341.1 1066.01,1382.63 1068.36,1542.05 1070.71,1359.73 1073.06,1221.44 1075.41,1331.18 1077.76,1473.61 1080.11,1597.1 1082.46,1388.33 1084.81,1371.62 1087.16,1413.38 1089.51,1303.59 1091.87,1629.11 1094.22,1344.84 1096.57,1514.29 1098.92,1464.87 1101.27,1495.77 1103.62,1434.12 1105.97,1369.04 1108.32,1432.28 1110.67,1450.53 1113.02,1317.59 1115.37,1682.3 1117.72,1557.41 1120.07,1460.67 1122.42,1400.72 1124.77,1311.27 1127.12,1442.91 1129.47,1526.44 1131.82,1323.09 1134.17,1352.82 1136.52,1461.81 1138.87,1387.61 1141.23,1478.3 1143.58,1446.36 1145.93,1439.4 1148.28,1537.21 1150.63,1456.32 1152.98,1348.81 1155.33,1262.75 1157.68,1548.33 1160.03,1514.83 1162.38,1368.24 1164.73,1316.72 1167.08,1607.37 1169.43,1379.86 1171.78,1588.88 1174.13,1417.21 1176.48,1389.65 1178.83,1550.98 1181.18,1453.37 1183.53,1412.38 1185.88,1486.22 1188.23,1434.71 1190.59,1400.69 1192.94,1530.65 1195.29,1434.76 1197.64,1381.11 1199.99,1554 1202.34,1450.93 1204.69,1566.79 1207.04,1494 1209.39,1413.38 1211.74,1541.43 1214.09,1454.13 1216.44,1471.55 1218.79,1416.94 1221.14,1502.68 1223.49,1337.24 1225.84,1186.44 1228.19,1289.93 1230.54,1424.48 1232.89,1532.1 1235.24,1444.85 1237.59,1326.06 1239.94,1478.64 1242.3,1482.21 1244.65,1408.83 1247,1403.13 1249.35,1251.17 1251.7,1514.01 1254.05,1218.73 1256.4,1321.27 1258.75,1434.18 1261.1,1427.2 1263.45,1450.2 1265.8,1493.68 1268.15,1319.27 1270.5,1327.96 1272.85,1495.71 1275.2,1409.73 1277.55,1492.91 1279.9,1255.17 1282.25,1369.42 1284.6,1515.27 1286.95,1505.92 1289.3,1571.99 1291.66,1415.93 1294.01,1244.46 1296.36,1396.29 1298.71,1396.93 1301.06,1461.52 1303.41,1339.96 1305.76,1411.13 1308.11,1362.72 1310.46,1474.16 1312.81,1516.9 1315.16,1438.14 1317.51,1359.79 1319.86,1474.05 1322.21,1403.84 1324.56,1409.15 1326.91,1243.87 1329.26,1483.43 1331.61,1513.67 1333.96,1482.43 1336.31,1586.11 1338.66,1571.82 1341.02,1659.53 1343.37,1312.61 1345.72,1531.65 1348.07,1433.72 1350.42,1532.77 1352.77,1506.3 1355.12,1257.23 1357.47,1383.9 1359.82,1492.79 1362.17,1383.06 1364.52,1463.41 1366.87,1458.32 1369.22,1464.19 1371.57,1577.11 1373.92,1291.86 1376.27,1539.73 1378.62,1517.78 1380.97,1527.65 1383.32,1360.53 1385.67,1608.71 1388.02,1319.72 1390.38,1352.69 1392.73,1469.36 1395.08,1433.16 1397.43,1597.37 1399.78,1352.31 1402.13,1436.99 1404.48,1315.18 1406.83,1353.08 1409.18,1485.15 1411.53,1383.24 1413.88,1443.71 1416.23,1358.44 1418.58,1414.24 1420.93,1469.2 1423.28,1377.52 1425.63,1444.97 1427.98,1546.63 1430.33,1352.94 1432.68,1489.09 1435.03,1337.3 1437.38,1401.08 1439.74,1398.33 1442.09,1644.01 1444.44,1424.6 1446.79,1451.53 1449.14,1365.01 1451.49,1464.6 1453.84,1302.2 1456.19,1438.74 1458.54,1608.88 1460.89,1462.24 1463.24,1359.2 1465.59,1360.38 1467.94,1318.85 1470.29,1479.9 1472.64,1392.4 1474.99,1569.92 1477.34,1214.67 1479.69,1446.93 1482.04,1464.22 1484.39,1453.28 1486.74,1407.92 1489.1,1430.94 1491.45,1625.99 1493.8,1600.62 1496.15,1368.5 1498.5,1583.84 1500.85,1575.77 1503.2,1388.41 1505.55,1437.12 1507.9,1467.14 1510.25,1616.15 1512.6,1417.92 1514.95,1389.66 1517.3,1473.87 1519.65,1380.2 1522,1393.11 1524.35,1506.28 1526.7,1485.82 1529.05,1414.5 1531.4,1550.35 1533.75,1467.64 1536.1,1578.53 1538.45,1349.6 1540.81,1420.48 1543.16,1255.74 1545.51,1270.27 1547.86,1452.17 1550.21,1516.76 1552.56,1457.23 1554.91,1348.95 1557.26,1260.84 1559.61,1378.38 1561.96,1521 1564.31,1319.56 1566.66,1474.78 1569.01,1397.59 1571.36,1531.77 1573.71,1226.27 1576.06,1468.62 1578.41,1481.83 1580.76,1390.15 1583.11,1321.61 1585.46,1361.85 1587.81,1440.09 1590.17,1408.36 1592.52,1451.32 1594.87,1235.52 1597.22,1383.61 1599.57,1406.22 1601.92,1556.2 1604.27,1362.22 1606.62,1511.47 1608.97,1401.38 1611.32,1311.62 1613.67,1652.7 1616.02,1471.09 1618.37,1519 1620.72,1477.55 1623.07,1422.94 1625.42,1386.95 1627.77,1502.01 1630.12,1443.27 1632.47,1458.7 1634.82,1352.54 1637.17,1368.39 1639.53,1441.62 1641.88,1600.64 1644.23,1278.59 1646.58,1528.24 1648.93,1555.37 1651.28,1558.07 1653.63,1751.15 1655.98,1459.19 1658.33,1348.27 1660.68,1451.36 1663.03,1442.93 1665.38,1352.05 1667.73,1499.75 1670.08,1546.18 1672.43,1412.32 1674.78,1434.08 1677.13,1485.17 1679.48,1332.31 1681.83,1377.77 1684.18,1534.11 1686.53,1533.96 1688.89,1444.45 1691.24,1520.94 1693.59,1243.53 1695.94,1551.61 1698.29,1317.96 1700.64,1540.73 1702.99,1381.54 1705.34,1406.09 1707.69,1458.43 1710.04,1450.86 1712.39,1250.47 1714.74,1350.23 1717.09,1620.59 1719.44,1520.08 1721.79,1401.73 1724.14,1677.69 1726.49,1409.06 1728.84,1419.79 1731.19,1342.49 1733.54,1501.09 1735.89,1450.47 1738.25,1368.58 1740.6,1525.74 1742.95,1431.94 1745.3,1424.76 1747.65,1620.75 1750,1454.69 1752.35,1527.2 1754.7,1549.84 1757.05,1507.52 1759.4,1400.98 1761.75,1433.58 1764.1,1332.83 1766.45,1339.91 1768.8,1379.68 1771.15,1494.49 1773.5,1403.51 1775.85,1325.58 1778.2,1269.76 1780.55,1489.2 1782.9,1419.06 1785.25,1528.49 1787.6,1481.48 1789.96,1537.42 1792.31,1552.08 1794.66,1402.86 1797.01,1316.09 1799.36,1293.25 1801.71,1595.86 1804.06,1471.12 1806.41,1314.84 1808.76,1493.75 1811.11,1627.23 1813.46,1399.37 1815.81,1509.6 1818.16,1295.75 1820.51,1539.81 1822.86,1473.35 1825.21,1343.76 1827.56,1420.77 1829.91,1454.17 1832.26,1341.89 1834.61,1536.24 1836.96,1402.41 1839.32,1475.42 1841.67,1438.74 1844.02,1412.2 1846.37,1490.19 1848.72,1414.9 1851.07,1429.26 1853.42,1508.77 1855.77,1586.68 1858.12,1436.96 1860.47,1524.39 1862.82,1447.41 1865.17,1380.64 1867.52,1461.32 1869.87,1519.07 1872.22,1483.8 1874.57,1423.88 1876.92,1396.32 1879.27,1353.79 1881.62,1576.07 1883.97,1519.2 1886.32,1520.35 1888.68,1440.82 1891.03,1588.32 1893.38,1455.13 1895.73,1527.31 1898.08,1500.32 1900.43,1415.8 1902.78,1382.57 1905.13,1144.46 1907.48,1397.97 1909.83,1435.73 1912.18,1426.77 1914.53,1594.33 1916.88,1521.56 1919.23,1451.49 1921.58,1520.57 1923.93,1526.02 1926.28,1343 1928.63,1309.52 1930.98,1502.26 1933.33,1302.22 1935.68,1559.39 1938.04,1427.37 1940.39,1363.83 1942.74,1570.57 1945.09,1458.28 1947.44,1385.56 1949.79,1509.71 1952.14,1361.13 1954.49,1411.49 1956.84,1363.63 1959.19,1494.25 1961.54,1626.08 1963.89,1291.7 1966.24,1485.59 1968.59,1270.62 1970.94,1613.2 1973.29,1469.92 1975.64,1296.87 1977.99,1473.54 1980.34,1434.1 1982.69,1458.52 1985.04,1448.67 1987.4,1404.06 1989.75,1432.04 1992.1,1457.16 1994.45,1497.32 1996.8,1428.94 1999.15,1581.6 2001.5,1470.58 2003.85,1452.72 2006.2,1373.76 2008.55,1419.95 2010.9,1543.04 2013.25,1449.9 2015.6,1402.87 2017.95,1576.87 2020.3,1538.22 2022.65,1571.37 2025,1628.19 2027.35,1332.86 2029.7,1313.5 2032.05,1375.22 2034.4,1450.83 2036.76,1610.37 2039.11,1472.21 2041.46,1237.63 2043.81,1396.57 2046.16,1457.93 2048.51,1500.25 2050.86,1416.33 2053.21,1433.63 2055.56,1497.46 2057.91,1497.65 2060.26,1290.98 2062.61,1444.05 2064.96,1550.45 2067.31,1375.94 2069.66,1575.08 2072.01,1311.98 2074.36,1434.16 2076.71,1362.54 2079.06,1446.18 2081.41,1473.72 2083.76,1535.42 2086.11,1498.1 2088.47,1286.29 2090.82,1342.38 2093.17,1479.91 2095.52,1484.32 2097.87,1422.45 2100.22,1300.11 2102.57,1517.14 2104.92,1241.92 2107.27,1370.35 2109.62,1347.34 2111.97,1537.76 2114.32,1398.32 2116.67,1505.49 2119.02,1570.86 2121.37,1385.28 2123.72,1451.78 2126.07,1532.64 2128.42,1525.44 2130.77,1607.48 2133.12,1424.08 2135.47,1307.36 2137.83,1501.07 2140.18,1265.63 2142.53,1302.48 2144.88,1389.54 2147.23,1458.07 2149.58,1376.42 2151.93,1466.5 2154.28,1455.6 2156.63,1257.14 2158.98,1611.63 2161.33,1267.45 2163.68,1640.82 2166.03,1576.07 2168.38,1382.38 2170.73,1431.39 2173.08,1582.16 2175.43,1585.28 2177.78,1516.23 2180.13,1380.25 2182.48,1393.01 2184.83,1406.4 2187.19,1518.66 2189.54,1326.76 2191.89,1410.31 2194.24,1325.2 2196.59,1417.03 2198.94,1350.69 2201.29,1403.52 2203.64,1405.82 2205.99,1463.65 2208.34,1521.83 2210.69,1451.21 2213.04,1348.51 2215.39,1517.75 2217.74,1420.59 2220.09,1416.56 2222.44,1583.64 2224.79,1429.39 2227.14,1413.4 2229.49,1363.98 2231.84,1341.77 2234.19,1328.22 2236.55,1411.8 2238.9,1279.49 2241.25,1360.02 2243.6,1439.66 2245.95,1410.46 2248.3,1385.53 2250.65,1428.05 2253,1514.55 2255.35,1367.81 2257.7,1505.52 2260.05,1340.78 2262.4,1408.22 2264.75,1491.27 2267.1,1587.49 2269.45,1418.55 2271.8,1538.26 2274.15,1487.48 2276.5,1527.61 2278.85,1452.71 2281.2,1417.5 2283.55,1384.22 2285.91,1475.56 2288.26,1462.21 2290.61,1315.67 2292.96,1340.69 2295.31,1357.27 2297.66,1265.5 2300.01,1559.02 2302.36,1303.21 2304.71,1431.23 2307.06,1609.96 2309.41,1529.84 2311.76,1452.11 2314.11,1364.81 2316.46,1501.12 2318.81,1495.92 2321.16,1453.7 2323.51,1570.43 2325.86,1482.09 2328.21,1482.83 2330.56,1418.95 2332.91,1560.66 2335.27,1377.1 2337.62,1331.79 2339.97,1526.78 2342.32,1524.17 2344.67,1427.9 2347.02,1561.09 2349.37,1330.69 2351.72,1490.88 2354.07,1557.62 2356.42,1441.76 2358.77,1352.92 2361.12,1630.84 2363.47,1353.6 2365.82,1294.69 2368.17,1440.09 2370.52,1447.35 2372.87,1586.57 2375.22,1505.16 2377.57,1476.79 2379.92,1503.01 2382.27,1364.04 2384.62,1437.14 2386.98,1396.84 2389.33,1507.69 2391.68,1400.22 2394.03,1384.95 2396.38,1584.8 2398.73,1584.17 2401.08,1342.98 2403.43,1568.22 2405.78,1252.2 2408.13,1259.8 2410.48,1296.13 2412.83,1343.37 2415.18,1342.03 2417.53,1580.27 2419.88,1347.52 2422.23,1349.56 2424.58,1579.88 2426.93,1342.16 2429.28,1285.19 2431.63,1472.06 2433.98,1439.75 2436.34,1358.67 2438.69,1425.41 2441.04,1373.73 2443.39,1442.57 2445.74,1370.96 2448.09,1293.77 2450.44,1436.53 2452.79,1254.35 2455.14,1497.25 2457.49,1407.12 2459.84,1320.94 2462.19,1517.74 2464.54,1434.68 2466.89,1418.94 2469.24,1469.65 2471.59,1469.34 2473.94,1483.99 2476.29,1498.6 2478.64,1330.49 2480.99,1340.72 2483.34,1386.91 2485.7,1571.96 2488.05,1547.36 2490.4,1341.95 2492.75,1541.6 2495.1,1408.02 2497.45,1448.42 2499.8,1384.97 2502.15,1410.87 2504.5,1484.65 2506.85,1370.31 2509.2,1255.97 2511.55,1368.69 2513.9,1728.55 2516.25,1417.12 2518.6,1473.13 2520.95,1502.83 2523.3,1464.47 2525.65,1397.79 2528,1441.68 2530.35,1519.72 2532.7,1471.34 2535.06,1457.23 2537.41,1486.7 2539.76,1264.67 2542.11,1524.72 2544.46,1285.83 2546.81,1295.25 2549.16,1351.69 2551.51,1549.92 2553.86,1509.87 2556.21,1482.88 2558.56,1524.55 2560.91,1243.44 2563.26,1301.16 2565.61,1596.63 2567.96,1433.07 2570.31,1543.62 "></polyline>
<polyline clip-path="url(#clip382)" style="stroke:#e26f46; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,932.14 224.541,1003.5 226.891,1071.07 229.242,956.298 231.592,906.953 233.943,1108.17 236.293,955.693 238.644,949.046 240.994,1010.4 243.345,984.598 245.695,790.734 248.046,856.883 250.396,878.935 252.747,952.39 255.097,827.598 257.448,1052.42 259.798,984.72 262.148,910.439 264.499,904.868 266.849,955.689 269.2,816.503 271.55,961.75 273.901,1006.09 276.251,1068.53 278.602,1032.75 280.952,875.653 283.303,873.304 285.653,925.416 288.004,1154.88 290.354,928.532 292.705,805.632 295.055,791.949 297.406,996.035 299.756,964.832 302.107,948.717 304.457,780.452 306.807,955.563 309.158,925.074 311.508,861.854 313.859,1042.58 316.209,792.466 318.56,912.223 320.91,995.402 323.261,919.403 325.611,1169.1 327.962,841.643 330.312,1090.95 332.663,997.488 335.013,871.622 337.364,957.257 339.714,895.96 342.065,927.727 344.415,932.9 346.765,1040.09 349.116,876.068 351.466,799.211 353.817,1035.19 356.167,1015.31 358.518,977.807 360.868,865.956 363.219,851.823 365.569,937.895 367.92,775.473 370.27,755.881 372.621,936.742 374.971,958.093 377.322,923.19 379.672,857.822 382.023,1029.39 384.373,1002.54 386.724,1003.4 389.074,844.653 391.424,1091.74 393.775,1237.57 396.125,909.834 398.476,1000.85 400.826,979.129 403.177,804.791 405.527,1022.62 407.878,841.443 410.228,938.072 412.579,1080.14 414.929,871.332 417.28,909.491 419.63,792.273 421.981,944.684 424.331,973.373 426.682,802.283 429.032,906.56 431.382,960.117 433.733,933.558 436.083,1025.49 438.434,935.86 440.784,981.051 443.135,780.537 445.485,1034.68 447.836,1153.6 450.186,1066.87 452.537,968.418 454.887,893 457.238,995.257 459.588,997.108 461.939,990.51 464.289,709.565 466.64,979.793 468.99,841.916 471.341,883.259 473.691,870.609 476.041,876.28 478.392,855.632 480.742,889.124 483.093,1116.63 485.443,1008.98 487.794,847.796 490.144,991.619 492.495,1045.34 494.845,1083.83 497.196,715.482 499.546,795.548 501.897,943.613 504.247,1001.83 506.598,958.267 508.948,716.358 511.299,975.449 513.649,912.202 515.999,916.672 518.35,1037.65 520.7,848.728 523.051,946.582 525.401,917.687 527.752,800.081 530.102,1180.15 532.453,1025.78 534.803,817.081 537.154,932.99 539.504,1045.23 541.855,869.599 544.205,833.067 546.556,1032.49 548.906,1099.19 551.257,928.715 553.607,1027.33 555.958,1042.19 558.308,967.037 560.658,1012.21 563.009,940.814 565.359,980.674 567.71,954.994 570.06,898.053 572.411,1080.4 574.761,979.74 577.112,979.528 579.462,962.079 581.813,1040.75 584.163,858.82 586.514,1016.18 588.864,1131.82 591.215,1120.01 593.565,870.166 595.916,850.279 598.266,994.877 600.616,818.409 602.967,819.755 605.317,846.724 607.668,975.513 610.018,1021.71 612.369,1027.83 614.719,1051.62 617.07,1035.63 619.42,722.557 621.771,883.472 624.121,979.295 626.472,923.569 628.822,957.99 631.173,998.064 633.523,815.81 635.874,934.401 638.224,987.725 640.575,920.871 642.925,1026.65 645.275,979.145 647.626,950.849 649.976,1094.24 652.327,942.326 654.677,1034.09 657.028,812.939 659.378,1068.17 661.729,1068.08 664.079,1088.51 666.43,923.83 668.78,919.003 671.131,815.618 673.481,1103.57 675.832,855.366 678.182,877.02 680.533,955.699 682.883,1016 685.233,1049.78 687.584,867 689.934,975.008 692.285,921.735 694.635,866.128 696.986,986.644 699.336,1070.83 701.687,1030.93 704.037,798.512 706.388,1036.49 708.738,937.719 711.089,922.836 713.439,985.531 715.79,1117.52 718.14,858.72 720.491,1079.3 722.841,941.713 725.192,979.434 727.542,825.342 729.892,837.308 732.243,833.531 734.593,891.136 736.944,1020.55 739.294,759.284 741.645,967.113 743.995,957.89 746.346,894.709 748.696,1005.97 751.047,1030.52 753.397,1013.61 755.748,767.076 758.098,1002.75 760.449,781.286 762.799,960.827 765.15,718.129 767.5,850.358 769.85,974.804 772.201,1019.59 774.551,1161.55 776.902,843.616 779.252,975.94 781.603,899.541 783.953,859.135 786.304,962.493 788.654,1029.95 791.005,920.006 793.355,885.974 795.706,957.364 798.056,847.325 800.407,783.097 802.757,856.84 805.108,940.243 807.458,893.872 809.809,961.182 812.159,816.678 814.509,940.536 816.86,991.82 819.21,977.318 821.561,837.826 823.911,971.891 826.262,946.888 828.612,878.996 830.963,1043.47 833.313,903.895 835.664,937.004 838.014,1063.67 840.365,1066.04 842.715,973.253 845.066,981.193 847.416,767.277 849.767,927.466 852.117,801.238 854.467,846.737 856.818,904.258 859.168,756.832 861.519,979.385 863.869,1103.22 866.22,964.944 868.57,993.278 870.921,971.775 873.271,923.307 875.622,886.401 877.972,896.382 880.323,933.576 882.673,880.578 885.024,876.75 887.374,1175.9 889.725,934.342 892.075,1114.71 894.426,638.964 896.776,927.029 899.126,915.064 901.477,989.706 903.827,1047.85 906.178,1023.69 908.528,1034.69 910.879,1032.9 913.229,925.627 915.58,1031.44 917.93,997.132 920.281,938.243 922.631,921.06 924.982,1018.81 927.332,1002.19 929.683,1112.68 932.033,853.493 934.384,1086.89 936.734,888.301 939.084,860.966 941.435,744.96 943.785,943.521 946.136,746.464 948.486,975.721 950.837,1133.34 953.187,1064.14 955.538,870.486 957.888,888.799 960.239,1106.4 962.589,1001.47 964.94,831.272 967.29,884.334 969.641,834.088 971.991,845.868 974.342,853.031 976.692,861.798 979.043,721.601 981.393,979.587 983.743,1186.68 986.094,819.623 988.444,991.187 990.795,940.785 993.145,1143.03 995.496,714.139 997.846,1162.2 1000.2,916.322 1002.55,940.438 1004.9,1020.67 1007.25,1068.96 1009.6,917.171 1011.95,865.93 1014.3,1047.04 1016.65,782.452 1019,902.904 1021.35,880.782 1023.7,774.337 1026.05,852.354 1028.4,799.766 1030.75,954.142 1033.1,1134.03 1035.45,944.012 1037.8,845.966 1040.15,880.61 1042.51,992.666 1044.86,1102.7 1047.21,883.539 1049.56,947.283 1051.91,816.944 1054.26,679.72 1056.61,961.906 1058.96,909.948 1061.31,931.738 1063.66,1051.5 1066.01,883.708 1068.36,804.624 1070.71,1052.66 1073.06,911.273 1075.41,750.225 1077.76,1002.79 1080.11,1007.45 1082.46,813.827 1084.81,929.736 1087.16,1040.95 1089.51,999.073 1091.87,1070.33 1094.22,892.961 1096.57,1017.66 1098.92,1020.83 1101.27,810.31 1103.62,934.324 1105.97,795.296 1108.32,802.713 1110.67,1001.56 1113.02,1043.19 1115.37,1012.55 1117.72,871.019 1120.07,988.276 1122.42,1085.92 1124.77,1197.89 1127.12,1096.03 1129.47,908.976 1131.82,1038 1134.17,909.507 1136.52,972.569 1138.87,1106.39 1141.23,1053.13 1143.58,961.58 1145.93,1121.66 1148.28,867.495 1150.63,908.566 1152.98,958.232 1155.33,894.916 1157.68,994.236 1160.03,818.602 1162.38,1020.06 1164.73,993.475 1167.08,715.473 1169.43,877.146 1171.78,1145.77 1174.13,877.683 1176.48,944.997 1178.83,832.848 1181.18,854.109 1183.53,841.161 1185.88,888.777 1188.23,1017.49 1190.59,752.67 1192.94,1089.48 1195.29,891.91 1197.64,951.802 1199.99,943.298 1202.34,865.536 1204.69,880.6 1207.04,1084.94 1209.39,1107.15 1211.74,941.179 1214.09,980.024 1216.44,922.957 1218.79,936.587 1221.14,838.123 1223.49,1006.05 1225.84,990.513 1228.19,843.273 1230.54,982.405 1232.89,892.428 1235.24,848.694 1237.59,1128.24 1239.94,786.982 1242.3,914.923 1244.65,915.617 1247,1085.53 1249.35,929.739 1251.7,878.697 1254.05,870.111 1256.4,1100.4 1258.75,1021.14 1261.1,916.857 1263.45,901.414 1265.8,928.545 1268.15,847.94 1270.5,1126.86 1272.85,981.591 1275.2,1123.54 1277.55,939.795 1279.9,806.187 1282.25,888.294 1284.6,834.133 1286.95,1087.26 1289.3,926.591 1291.66,833.939 1294.01,959.884 1296.36,929.079 1298.71,1067.56 1301.06,933.101 1303.41,1105.63 1305.76,888.939 1308.11,986.774 1310.46,1007.29 1312.81,1117.38 1315.16,830.556 1317.51,1069.79 1319.86,791.619 1322.21,1118.84 1324.56,1056.4 1326.91,1014.32 1329.26,1061.35 1331.61,908.465 1333.96,916.121 1336.31,934.024 1338.66,948.323 1341.02,915.516 1343.37,863.452 1345.72,915.042 1348.07,965.917 1350.42,915.121 1352.77,982.832 1355.12,1055.51 1357.47,978.246 1359.82,941.697 1362.17,880.894 1364.52,984.675 1366.87,889.612 1369.22,869.12 1371.57,884.682 1373.92,892.746 1376.27,1040.27 1378.62,1067.52 1380.97,830.469 1383.32,1035.68 1385.67,1011.39 1388.02,1045.24 1390.38,828.516 1392.73,1026.89 1395.08,995.891 1397.43,1005.54 1399.78,970.99 1402.13,1023.77 1404.48,894.133 1406.83,1010.68 1409.18,834.033 1411.53,816.955 1413.88,955.401 1416.23,877.257 1418.58,968.437 1420.93,840.122 1423.28,1011.55 1425.63,926.965 1427.98,797.544 1430.33,1010.54 1432.68,960.308 1435.03,926.197 1437.38,1018.01 1439.74,871.225 1442.09,901.2 1444.44,1043.99 1446.79,1031.69 1449.14,875.793 1451.49,867.192 1453.84,775.747 1456.19,900.291 1458.54,939.716 1460.89,972.036 1463.24,1046.91 1465.59,831.287 1467.94,836.956 1470.29,701.509 1472.64,928.36 1474.99,982.228 1477.34,906.783 1479.69,902.994 1482.04,907.058 1484.39,975.448 1486.74,1002.98 1489.1,803.774 1491.45,865.683 1493.8,983.871 1496.15,841.073 1498.5,785.479 1500.85,937.48 1503.2,961.47 1505.55,901.725 1507.9,882.704 1510.25,1061.24 1512.6,853.992 1514.95,906.691 1517.3,955.205 1519.65,889.675 1522,1042.38 1524.35,909.686 1526.7,859.122 1529.05,1006.75 1531.4,890.149 1533.75,1060.65 1536.1,888.948 1538.45,841.322 1540.81,1129.67 1543.16,1009.1 1545.51,954.444 1547.86,964.912 1550.21,1113.53 1552.56,933.334 1554.91,1073.86 1557.26,819.466 1559.61,884.333 1561.96,987.973 1564.31,870.1 1566.66,942.262 1569.01,1004.08 1571.36,962.585 1573.71,923.509 1576.06,1029.19 1578.41,995.75 1580.76,833.298 1583.11,967.572 1585.46,1105.43 1587.81,1113.96 1590.17,860.568 1592.52,970.651 1594.87,928.864 1597.22,935.812 1599.57,787.726 1601.92,1029.62 1604.27,953.519 1606.62,1131.9 1608.97,888.469 1611.32,1009.41 1613.67,914.794 1616.02,1181.18 1618.37,847.212 1620.72,758.275 1623.07,1008.9 1625.42,982.904 1627.77,869.359 1630.12,960.121 1632.47,843.144 1634.82,970.249 1637.17,904.979 1639.53,916.68 1641.88,956.95 1644.23,745.012 1646.58,825.899 1648.93,749.39 1651.28,1154.94 1653.63,955.958 1655.98,708.852 1658.33,1009.91 1660.68,885.922 1663.03,870.178 1665.38,890.421 1667.73,971.96 1670.08,974.803 1672.43,786.52 1674.78,1117.44 1677.13,983.747 1679.48,841.981 1681.83,863.532 1684.18,874.911 1686.53,1039.14 1688.89,976.714 1691.24,925.751 1693.59,940.114 1695.94,847.18 1698.29,947.898 1700.64,874.658 1702.99,1005.71 1705.34,787.325 1707.69,791.555 1710.04,1029.07 1712.39,1041.82 1714.74,989.031 1717.09,920.004 1719.44,1108.82 1721.79,1042.78 1724.14,918.73 1726.49,941.5 1728.84,910.751 1731.19,785.576 1733.54,904.845 1735.89,1104.3 1738.25,1002.9 1740.6,1069.45 1742.95,964.422 1745.3,922.687 1747.65,903.247 1750,870.365 1752.35,930.918 1754.7,1266.78 1757.05,924.029 1759.4,765.442 1761.75,1093.02 1764.1,1000.72 1766.45,1053.89 1768.8,904.59 1771.15,912.511 1773.5,988.352 1775.85,959.433 1778.2,909.368 1780.55,999.867 1782.9,1026.65 1785.25,964.052 1787.6,913.191 1789.96,1016.42 1792.31,931.737 1794.66,960.41 1797.01,973.307 1799.36,976.246 1801.71,841.348 1804.06,1116.66 1806.41,967.847 1808.76,1003.42 1811.11,1085.45 1813.46,1054.65 1815.81,906.26 1818.16,1041.5 1820.51,993.529 1822.86,994.191 1825.21,848.273 1827.56,853.261 1829.91,1118.88 1832.26,991.724 1834.61,1009.56 1836.96,779.892 1839.32,832.74 1841.67,987.323 1844.02,947.568 1846.37,970.35 1848.72,984.589 1851.07,911.825 1853.42,754.214 1855.77,822.702 1858.12,922.319 1860.47,783.915 1862.82,929.046 1865.17,1037.17 1867.52,969.504 1869.87,965.648 1872.22,881.233 1874.57,841.479 1876.92,1018.34 1879.27,932.056 1881.62,842.529 1883.97,922.256 1886.32,1068.25 1888.68,723.73 1891.03,855.899 1893.38,832.764 1895.73,895.88 1898.08,810.56 1900.43,968.671 1902.78,865.315 1905.13,1082.48 1907.48,927.471 1909.83,1104.67 1912.18,805.705 1914.53,810.906 1916.88,894.863 1919.23,840.842 1921.58,970.472 1923.93,1010.07 1926.28,878.584 1928.63,910.758 1930.98,1086.99 1933.33,913.771 1935.68,991.186 1938.04,833.139 1940.39,938.897 1942.74,1049.75 1945.09,1033.36 1947.44,1002.42 1949.79,982.6 1952.14,989.916 1954.49,908.293 1956.84,913.03 1959.19,849.843 1961.54,1056.73 1963.89,992.791 1966.24,920.111 1968.59,776.51 1970.94,1106.58 1973.29,904.397 1975.64,873.721 1977.99,1174.59 1980.34,776.418 1982.69,1034.2 1985.04,950.973 1987.4,956.242 1989.75,898.187 1992.1,784.044 1994.45,800.969 1996.8,817.072 1999.15,776.506 2001.5,974.669 2003.85,1090.14 2006.2,757.575 2008.55,883.303 2010.9,1140.29 2013.25,904.779 2015.6,822.194 2017.95,1074.26 2020.3,1050.53 2022.65,838.653 2025,756.873 2027.35,945.684 2029.7,1154.16 2032.05,1028.43 2034.4,1050.09 2036.76,945.965 2039.11,1007.2 2041.46,906.271 2043.81,953.681 2046.16,967.843 2048.51,892.556 2050.86,1014.73 2053.21,876.202 2055.56,1024.36 2057.91,1013.15 2060.26,899.834 2062.61,923.216 2064.96,870.115 2067.31,1034.11 2069.66,930.945 2072.01,787.02 2074.36,1036.24 2076.71,1166.99 2079.06,855 2081.41,883.659 2083.76,1001.64 2086.11,1024.76 2088.47,1036.23 2090.82,970.923 2093.17,925.624 2095.52,1020.09 2097.87,1056.06 2100.22,1043.08 2102.57,922.401 2104.92,1012.28 2107.27,1054.94 2109.62,852.012 2111.97,944.671 2114.32,998.681 2116.67,844.691 2119.02,1110.48 2121.37,900.635 2123.72,862.717 2126.07,797.485 2128.42,1116.83 2130.77,887.42 2133.12,809.643 2135.47,992.313 2137.83,947.095 2140.18,964.329 2142.53,871.35 2144.88,918.025 2147.23,992.461 2149.58,886.397 2151.93,767.917 2154.28,864.76 2156.63,860.886 2158.98,801.763 2161.33,902.744 2163.68,743.718 2166.03,1027.03 2168.38,960.009 2170.73,1044.72 2173.08,1042.85 2175.43,1244.03 2177.78,1066.33 2180.13,951.06 2182.48,889.148 2184.83,775.362 2187.19,1025.2 2189.54,979.977 2191.89,882.874 2194.24,927.323 2196.59,996.712 2198.94,828.478 2201.29,878.847 2203.64,962.256 2205.99,935.916 2208.34,749.969 2210.69,894.589 2213.04,1073.86 2215.39,774.065 2217.74,939.142 2220.09,1023.56 2222.44,812.237 2224.79,901.239 2227.14,993.645 2229.49,837.878 2231.84,946.512 2234.19,928.658 2236.55,684.768 2238.9,1065.43 2241.25,883.473 2243.6,807.007 2245.95,1119.7 2248.3,1072.55 2250.65,862.898 2253,1060.92 2255.35,1085.03 2257.7,956.202 2260.05,896.363 2262.4,993.206 2264.75,897.971 2267.1,942.442 2269.45,1017.11 2271.8,977.299 2274.15,824.181 2276.5,942.664 2278.85,986.892 2281.2,814.352 2283.55,1095.54 2285.91,878.426 2288.26,793.07 2290.61,1016.49 2292.96,912.226 2295.31,917.09 2297.66,1015.3 2300.01,826.325 2302.36,894.178 2304.71,928.517 2307.06,894.618 2309.41,902.927 2311.76,796.321 2314.11,985.14 2316.46,786.973 2318.81,861.528 2321.16,821.28 2323.51,773.048 2325.86,874.015 2328.21,832.184 2330.56,870.206 2332.91,938.883 2335.27,813.802 2337.62,1104.88 2339.97,929.119 2342.32,970.247 2344.67,880.348 2347.02,984.319 2349.37,772.862 2351.72,936.964 2354.07,832.843 2356.42,1079.63 2358.77,997.994 2361.12,1055.94 2363.47,942.34 2365.82,760.303 2368.17,900.459 2370.52,931.144 2372.87,914.934 2375.22,1021.75 2377.57,967.531 2379.92,960.31 2382.27,976.372 2384.62,811.597 2386.98,893.794 2389.33,921.799 2391.68,1106.26 2394.03,980.897 2396.38,1137.49 2398.73,993.806 2401.08,1055.08 2403.43,1014.54 2405.78,1003.78 2408.13,1008.02 2410.48,938.357 2412.83,957.439 2415.18,913.211 2417.53,867.302 2419.88,869.023 2422.23,978.319 2424.58,905.398 2426.93,968.317 2429.28,959.234 2431.63,887.734 2433.98,1151.64 2436.34,1090.33 2438.69,919.003 2441.04,990.167 2443.39,985.6 2445.74,925.647 2448.09,857.779 2450.44,899.57 2452.79,921.481 2455.14,986.347 2457.49,959.331 2459.84,909.384 2462.19,862.698 2464.54,1051.94 2466.89,1029.77 2469.24,771.794 2471.59,917.321 2473.94,950.826 2476.29,775.328 2478.64,949.635 2480.99,775.169 2483.34,1111.91 2485.7,844.827 2488.05,1030.77 2490.4,1022.44 2492.75,985.168 2495.1,1095.18 2497.45,963.758 2499.8,998.05 2502.15,773.591 2504.5,870.964 2506.85,963.123 2509.2,926.041 2511.55,1097.34 2513.9,868.11 2516.25,967.456 2518.6,873.947 2520.95,1007.7 2523.3,835.495 2525.65,874.013 2528,1099.74 2530.35,1051.67 2532.7,966.92 2535.06,929.876 2537.41,1065.99 2539.76,1102.35 2542.11,1179.35 2544.46,862.747 2546.81,1070.85 2549.16,970.467 2551.51,944.042 2553.86,970.948 2556.21,918.003 2558.56,1051.98 2560.91,739.982 2563.26,974.979 2565.61,724.745 2567.96,801.265 2570.31,1093.42 "></polyline>
<polyline clip-path="url(#clip382)" style="stroke:#3da44d; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,570.624 224.541,493.857 226.891,417.822 229.242,398.251 231.592,446.664 233.943,236.819 236.293,456.629 238.644,482.347 240.994,356.384 243.345,320.41 245.695,515.408 248.046,507.066 250.396,392.992 252.747,375.341 255.097,308.362 257.448,480.704 259.798,388.422 262.148,403.255 264.499,431.564 266.849,451.942 269.2,590.027 271.55,406.94 273.901,453.252 276.251,402.855 278.602,460.207 280.952,580.57 283.303,346.344 285.653,448.236 288.004,379.39 290.354,666.283 292.705,542.56 295.055,530.179 297.406,568.599 299.756,390.398 302.107,496.882 304.457,501.697 306.807,547.077 309.158,494.675 311.508,337.568 313.859,463.539 316.209,402.067 318.56,506.246 320.91,484.956 323.261,459.858 325.611,411.593 327.962,396.039 330.312,431.497 332.663,444.233 335.013,574.626 337.364,346.894 339.714,434.317 342.065,414.272 344.415,433.187 346.765,375.665 349.116,315.975 351.466,495.415 353.817,654.39 356.167,531.455 358.518,334.712 360.868,266.062 363.219,515.659 365.569,579.465 367.92,423.305 370.27,227.706 372.621,398.676 374.971,480.321 377.322,328.681 379.672,436.249 382.023,358.417 384.373,473.575 386.724,535.88 389.074,380.368 391.424,399.865 393.775,531.518 396.125,401.548 398.476,602.421 400.826,334.302 403.177,395.106 405.527,254.676 407.878,430.306 410.228,551.673 412.579,334.296 414.929,345.6 417.28,455.024 419.63,362.733 421.981,536.949 424.331,475.71 426.682,413.1 429.032,273.101 431.382,582.245 433.733,465.697 436.083,427.61 438.434,392.762 440.784,488.963 443.135,445.419 445.485,273.389 447.836,479.49 450.186,422.232 452.537,634.159 454.887,480.849 457.238,561.553 459.588,478.332 461.939,415.97 464.289,177.522 466.64,409.415 468.99,440.759 471.341,670.764 473.691,437.373 476.041,389.747 478.392,421.933 480.742,490.501 483.093,383.404 485.443,481.574 487.794,405.189 490.144,366.607 492.495,424.837 494.845,477.091 497.196,439.123 499.546,408.985 501.897,296.993 504.247,566.524 506.598,366.588 508.948,218.469 511.299,332.621 513.649,464.115 515.999,360.976 518.35,435.62 520.7,611.585 523.051,442.473 525.401,528.852 527.752,253.578 530.102,406.619 532.453,234.275 534.803,425.631 537.154,363.424 539.504,515.399 541.855,497.061 544.205,356.679 546.556,444.477 548.906,389.904 551.257,405.884 553.607,425.178 555.958,421.206 558.308,304.201 560.658,369.487 563.009,563.909 565.359,529.379 567.71,466.47 570.06,422.905 572.411,332.388 574.761,394.132 577.112,480.799 579.462,449.552 581.813,431.666 584.163,415.92 586.514,494.201 588.864,511.52 591.215,547.977 593.565,515.944 595.916,400.742 598.266,381.519 600.616,276.805 602.967,437.981 605.317,530.643 607.668,614.741 610.018,506.674 612.369,479.966 614.719,305.637 617.07,397.95 619.42,441.107 621.771,351.353 624.121,280.61 626.472,460.942 628.822,481.03 631.173,595.076 633.523,311.26 635.874,557.793 638.224,307.263 640.575,653.172 642.925,447.765 645.275,555.312 647.626,349.636 649.976,457.73 652.327,509.497 654.677,476.772 657.028,483.938 659.378,404.171 661.729,279.595 664.079,435.581 666.43,265.061 668.78,524.466 671.131,374.102 673.481,601.06 675.832,333.014 678.182,454.54 680.533,505.632 682.883,579.026 685.233,554.298 687.584,650.462 689.934,514.121 692.285,460.021 694.635,188.46 696.986,440.537 699.336,606.073 701.687,495.626 704.037,382.396 706.388,474.225 708.738,397.771 711.089,317.998 713.439,380.272 715.79,391.858 718.14,527.36 720.491,569.35 722.841,456.261 725.192,345.944 727.542,264.884 729.892,546.21 732.243,312.577 734.593,444.837 736.944,347.354 739.294,319.623 741.645,484.918 743.995,390.472 746.346,401.68 748.696,544.267 751.047,411.697 753.397,578.897 755.748,471.715 758.098,465.06 760.449,423.188 762.799,619.243 765.15,717.845 767.5,483.634 769.85,373.266 772.201,424.672 774.551,551.998 776.902,486.616 779.252,253.008 781.603,358.964 783.953,558.681 786.304,626.233 788.654,463.689 791.005,194.841 793.355,461.389 795.706,533.891 798.056,495.05 800.407,460.33 802.757,428.262 805.108,456.797 807.458,455.774 809.809,610.547 812.159,344.273 814.509,331.74 816.86,262.415 819.21,484.546 821.561,396.36 823.911,380.657 826.262,392.423 828.612,471.734 830.963,467.531 833.313,223.006 835.664,462.216 838.014,479.191 840.365,579.295 842.715,506.751 845.066,362.956 847.416,507.549 849.767,493.566 852.117,386.322 854.467,438.843 856.818,415.149 859.168,334.618 861.519,570.702 863.869,397.106 866.22,433.712 868.57,450.756 870.921,470.16 873.271,554.226 875.622,306.967 877.972,520.475 880.323,453.888 882.673,559.578 885.024,536.296 887.374,522.617 889.725,453.607 892.075,372.545 894.426,228.551 896.776,363.24 899.126,587.323 901.477,486.443 903.827,588.309 906.178,212.343 908.528,400.492 910.879,485.863 913.229,519.72 915.58,443.652 917.93,498.082 920.281,499.337 922.631,504.649 924.982,508.048 927.332,436.763 929.683,583.652 932.033,280.6 934.384,387.714 936.734,447.684 939.084,358.416 941.435,428.031 943.785,403.503 946.136,410.572 948.486,353.51 950.837,557.833 953.187,326.69 955.538,370.693 957.888,511.244 960.239,618.176 962.589,474.56 964.94,599.365 967.29,464.523 969.641,405.394 971.991,369.535 974.342,571.313 976.692,305.926 979.043,373.886 981.393,435.437 983.743,435.559 986.094,363.488 988.444,729.629 990.795,519.008 993.145,464.677 995.496,519.487 997.846,334.321 1000.2,538.966 1002.55,676.715 1004.9,539.556 1007.25,457.967 1009.6,262.879 1011.95,272.416 1014.3,364.387 1016.65,505.323 1019,292.344 1021.35,328.921 1023.7,583.851 1026.05,260.252 1028.4,384.209 1030.75,402.119 1033.1,198.814 1035.45,367.908 1037.8,411.108 1040.15,310.736 1042.51,328.604 1044.86,403.176 1047.21,460.036 1049.56,340.437 1051.91,481.533 1054.26,475.202 1056.61,261.212 1058.96,517.608 1061.31,395.499 1063.66,443.058 1066.01,410.853 1068.36,397.095 1070.71,423.579 1073.06,210.332 1075.41,506.284 1077.76,408.507 1080.11,336.775 1082.46,526.197 1084.81,333.114 1087.16,348.125 1089.51,405.204 1091.87,405.195 1094.22,410.152 1096.57,435.26 1098.92,427.12 1101.27,433.207 1103.62,682.089 1105.97,421.578 1108.32,403.533 1110.67,318.796 1113.02,524.194 1115.37,309.601 1117.72,254.137 1120.07,305.942 1122.42,561.563 1124.77,393.214 1127.12,497.981 1129.47,463.262 1131.82,504.458 1134.17,305.319 1136.52,503.769 1138.87,440.261 1141.23,576.644 1143.58,431.46 1145.93,348.774 1148.28,275.142 1150.63,501.249 1152.98,339.539 1155.33,311.928 1157.68,499.994 1160.03,464.76 1162.38,374.419 1164.73,512.973 1167.08,305.423 1169.43,495.435 1171.78,464.604 1174.13,507.095 1176.48,335.525 1178.83,456.623 1181.18,462.665 1183.53,359.18 1185.88,578.728 1188.23,285.657 1190.59,429.93 1192.94,538.671 1195.29,505.943 1197.64,510.143 1199.99,541.975 1202.34,657.004 1204.69,399.735 1207.04,506.145 1209.39,240.288 1211.74,315.283 1214.09,328.387 1216.44,434.683 1218.79,437.195 1221.14,541.631 1223.49,516.119 1225.84,387.281 1228.19,457.412 1230.54,401.148 1232.89,461.499 1235.24,603.303 1237.59,447.162 1239.94,269.362 1242.3,309.146 1244.65,542.224 1247,591.313 1249.35,584.559 1251.7,512.056 1254.05,457.512 1256.4,425.096 1258.75,332.861 1261.1,510.498 1263.45,393.093 1265.8,334.363 1268.15,421.623 1270.5,454.903 1272.85,325.096 1275.2,384.831 1277.55,413.027 1279.9,501.035 1282.25,565.826 1284.6,554.364 1286.95,271.161 1289.3,437.953 1291.66,206.12 1294.01,131.053 1296.36,323.826 1298.71,402.435 1301.06,377.298 1303.41,527.043 1305.76,377.274 1308.11,378.437 1310.46,495.367 1312.81,650.715 1315.16,417.628 1317.51,245.297 1319.86,483.449 1322.21,370.726 1324.56,376.413 1326.91,391.708 1329.26,451.675 1331.61,455.827 1333.96,560.053 1336.31,274.944 1338.66,541.449 1341.02,354.311 1343.37,450.372 1345.72,537.221 1348.07,586.449 1350.42,261.313 1352.77,533.397 1355.12,449.293 1357.47,266.685 1359.82,491.276 1362.17,447.781 1364.52,433.189 1366.87,393.695 1369.22,466.632 1371.57,379.734 1373.92,636.375 1376.27,522.758 1378.62,636.265 1380.97,445.08 1383.32,396.788 1385.67,305.731 1388.02,488.188 1390.38,470.418 1392.73,360.504 1395.08,478.763 1397.43,431.731 1399.78,362.847 1402.13,418.178 1404.48,482.686 1406.83,372.274 1409.18,438.01 1411.53,443.034 1413.88,396.83 1416.23,519.899 1418.58,452.901 1420.93,631.296 1423.28,277.805 1425.63,595.858 1427.98,317.603 1430.33,476.247 1432.68,563.473 1435.03,233.828 1437.38,417.263 1439.74,516.326 1442.09,320.529 1444.44,489.516 1446.79,543.128 1449.14,492.209 1451.49,428.166 1453.84,306.59 1456.19,573.743 1458.54,477.774 1460.89,490.298 1463.24,539.116 1465.59,510.834 1467.94,451.523 1470.29,474.107 1472.64,267.734 1474.99,336.416 1477.34,489.596 1479.69,450.462 1482.04,555.592 1484.39,555.174 1486.74,410.284 1489.1,424.299 1491.45,353.204 1493.8,317.848 1496.15,471.819 1498.5,498.44 1500.85,406.694 1503.2,324.888 1505.55,465.729 1507.9,134.713 1510.25,457.411 1512.6,455.994 1514.95,568.426 1517.3,416.294 1519.65,364.619 1522,450.961 1524.35,431.571 1526.7,473.418 1529.05,303.523 1531.4,370.686 1533.75,449.553 1536.1,332.735 1538.45,570.817 1540.81,525.925 1543.16,263.486 1545.51,390.742 1547.86,552.203 1550.21,446.712 1552.56,217.517 1554.91,683.733 1557.26,534.381 1559.61,428.412 1561.96,447.834 1564.31,315.271 1566.66,427.354 1569.01,239.303 1571.36,562.054 1573.71,442.176 1576.06,617.472 1578.41,531.365 1580.76,332.917 1583.11,490.008 1585.46,365.281 1587.81,413.204 1590.17,273.156 1592.52,535.672 1594.87,354.797 1597.22,449.306 1599.57,290.615 1601.92,455.087 1604.27,313.435 1606.62,557.417 1608.97,536.391 1611.32,426.614 1613.67,550.305 1616.02,325.423 1618.37,439.823 1620.72,517.576 1623.07,325.129 1625.42,483.847 1627.77,452.661 1630.12,400.232 1632.47,454.47 1634.82,458.817 1637.17,414.106 1639.53,472.017 1641.88,482.069 1644.23,596.681 1646.58,500.404 1648.93,504.68 1651.28,367.403 1653.63,377.488 1655.98,382.604 1658.33,360.867 1660.68,399.741 1663.03,477.297 1665.38,442.083 1667.73,341.587 1670.08,325.321 1672.43,462.1 1674.78,494.601 1677.13,472.642 1679.48,523.883 1681.83,498.842 1684.18,582.169 1686.53,333.856 1688.89,690.535 1691.24,416.436 1693.59,304.289 1695.94,313.376 1698.29,322.902 1700.64,497.41 1702.99,395.953 1705.34,613.45 1707.69,457.6 1710.04,568.93 1712.39,426.387 1714.74,588.627 1717.09,390.559 1719.44,409.475 1721.79,342.396 1724.14,375.222 1726.49,350.967 1728.84,385.385 1731.19,547.795 1733.54,538.655 1735.89,502.503 1738.25,467.769 1740.6,425.446 1742.95,492.107 1745.3,472.885 1747.65,466.165 1750,460.291 1752.35,497.609 1754.7,293.581 1757.05,432.127 1759.4,532.213 1761.75,413.174 1764.1,351.812 1766.45,630.694 1768.8,451.434 1771.15,540.488 1773.5,474.537 1775.85,443.8 1778.2,372.844 1780.55,350.757 1782.9,491.26 1785.25,647.026 1787.6,464.364 1789.96,468.867 1792.31,521.462 1794.66,385.778 1797.01,451.983 1799.36,485.339 1801.71,640.758 1804.06,301.361 1806.41,577.435 1808.76,470.345 1811.11,532.472 1813.46,410.365 1815.81,434.607 1818.16,296.257 1820.51,387.904 1822.86,425.625 1825.21,405.036 1827.56,518.478 1829.91,449.194 1832.26,809.947 1834.61,420.187 1836.96,571.006 1839.32,397.055 1841.67,731.597 1844.02,442.793 1846.37,515.877 1848.72,278.241 1851.07,408.97 1853.42,466.166 1855.77,561.917 1858.12,526.951 1860.47,559.816 1862.82,493.589 1865.17,388.571 1867.52,540.087 1869.87,251.049 1872.22,495.501 1874.57,428.753 1876.92,323.173 1879.27,427.998 1881.62,420.861 1883.97,518.137 1886.32,283.141 1888.68,482.759 1891.03,323.835 1893.38,322.637 1895.73,435.684 1898.08,369.085 1900.43,575.831 1902.78,358.967 1905.13,372.584 1907.48,498.728 1909.83,431.502 1912.18,514.658 1914.53,479.054 1916.88,313.199 1919.23,488.92 1921.58,467.649 1923.93,424.537 1926.28,647.01 1928.63,422.21 1930.98,472.776 1933.33,456.011 1935.68,507.141 1938.04,276.432 1940.39,414.059 1942.74,435.264 1945.09,349.916 1947.44,372.51 1949.79,435.761 1952.14,579.067 1954.49,228.352 1956.84,425.447 1959.19,502.379 1961.54,283.777 1963.89,205.068 1966.24,400.673 1968.59,512.001 1970.94,410.941 1973.29,552.725 1975.64,362.505 1977.99,413.264 1980.34,311.5 1982.69,268.34 1985.04,386.146 1987.4,267.422 1989.75,457.724 1992.1,231.165 1994.45,371.145 1996.8,565.233 1999.15,456.54 2001.5,505.485 2003.85,234.839 2006.2,525.734 2008.55,223.238 2010.9,665.035 2013.25,377.082 2015.6,372.21 2017.95,474.991 2020.3,479.551 2022.65,340.924 2025,401.535 2027.35,298.431 2029.7,349.243 2032.05,360.079 2034.4,583.555 2036.76,380.39 2039.11,441.681 2041.46,586.706 2043.81,480.495 2046.16,344.487 2048.51,501.478 2050.86,519.353 2053.21,434.075 2055.56,447.359 2057.91,523.568 2060.26,567.658 2062.61,417.731 2064.96,547.049 2067.31,637.443 2069.66,533.831 2072.01,140.571 2074.36,401.229 2076.71,400.105 2079.06,287.767 2081.41,502.724 2083.76,474.427 2086.11,521.432 2088.47,321.039 2090.82,507.979 2093.17,319.213 2095.52,474.594 2097.87,473.575 2100.22,647.453 2102.57,283.49 2104.92,375.543 2107.27,533.806 2109.62,582.672 2111.97,534.023 2114.32,519.85 2116.67,521.957 2119.02,573.162 2121.37,606.888 2123.72,502.678 2126.07,215.812 2128.42,597.846 2130.77,208.228 2133.12,362.653 2135.47,538.049 2137.83,512.398 2140.18,532.894 2142.53,393.282 2144.88,377.716 2147.23,350.89 2149.58,388.063 2151.93,563.689 2154.28,374.078 2156.63,275.961 2158.98,524.272 2161.33,96.8724 2163.68,494.31 2166.03,468.115 2168.38,432.566 2170.73,305.834 2173.08,557.789 2175.43,505.358 2177.78,443.421 2180.13,479.916 2182.48,489.564 2184.83,596.27 2187.19,608.155 2189.54,434.26 2191.89,368.652 2194.24,269.655 2196.59,274.579 2198.94,422.059 2201.29,542.109 2203.64,609.623 2205.99,171.253 2208.34,474.76 2210.69,604.247 2213.04,414.209 2215.39,423.153 2217.74,447.758 2220.09,346.648 2222.44,499.557 2224.79,524.216 2227.14,367.607 2229.49,428.194 2231.84,431.13 2234.19,462.152 2236.55,400.191 2238.9,309.618 2241.25,365.422 2243.6,551.011 2245.95,277.824 2248.3,415.177 2250.65,656.046 2253,458.35 2255.35,413.763 2257.7,400.843 2260.05,474.249 2262.4,241.472 2264.75,344.959 2267.1,462.031 2269.45,456.726 2271.8,544.502 2274.15,464.437 2276.5,446.479 2278.85,521.142 2281.2,588.607 2283.55,670.972 2285.91,377.111 2288.26,666.912 2290.61,321.347 2292.96,288.603 2295.31,406.199 2297.66,515.787 2300.01,594.87 2302.36,435.57 2304.71,469.138 2307.06,374.791 2309.41,514.958 2311.76,367.613 2314.11,256.469 2316.46,429.741 2318.81,410.111 2321.16,663.191 2323.51,530.145 2325.86,488.549 2328.21,382.456 2330.56,480.89 2332.91,365.963 2335.27,428.766 2337.62,423.824 2339.97,486.483 2342.32,395.987 2344.67,389.339 2347.02,560.351 2349.37,457.029 2351.72,495.523 2354.07,387.724 2356.42,432.484 2358.77,470.3 2361.12,239.658 2363.47,477.849 2365.82,218.923 2368.17,557.84 2370.52,412.164 2372.87,389.264 2375.22,293.663 2377.57,410.486 2379.92,355.254 2382.27,550.672 2384.62,456.95 2386.98,472.513 2389.33,618.981 2391.68,440.719 2394.03,497.392 2396.38,537.978 2398.73,489.468 2401.08,587.121 2403.43,411.924 2405.78,280.682 2408.13,454.51 2410.48,481.3 2412.83,487.045 2415.18,324.021 2417.53,527.011 2419.88,513.807 2422.23,334.148 2424.58,354.834 2426.93,262.727 2429.28,307.661 2431.63,438.449 2433.98,401.026 2436.34,476.292 2438.69,518.597 2441.04,480.615 2443.39,427.398 2445.74,388.259 2448.09,444.075 2450.44,491.653 2452.79,300.346 2455.14,298.087 2457.49,386.472 2459.84,407.317 2462.19,315.621 2464.54,457.671 2466.89,391.958 2469.24,337.968 2471.59,556.654 2473.94,335.606 2476.29,585.422 2478.64,482.319 2480.99,213.933 2483.34,583.034 2485.7,438.92 2488.05,558.61 2490.4,239.272 2492.75,380.351 2495.1,573.888 2497.45,597.522 2499.8,352.302 2502.15,472.862 2504.5,413.736 2506.85,494.903 2509.2,560.215 2511.55,534.083 2513.9,537.46 2516.25,565.683 2518.6,421.895 2520.95,382.026 2523.3,373.87 2525.65,337.808 2528,417.242 2530.35,632.41 2532.7,354.795 2535.06,390.101 2537.41,612.997 2539.76,580.258 2542.11,572.161 2544.46,506.127 2546.81,475.768 2549.16,438.707 2551.51,561.324 2553.86,314.477 2556.21,473.275 2558.56,372.779 2560.91,434.733 2563.26,552.546 2565.61,374.209 2567.96,397.08 2570.31,442.768 "></polyline>
</svg>
</div>
</div>
<p>Look at that! Things are working; amazin’.</p>
<p>We can also exploit <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>’s parallel sampling capabilities:</p>
<div id="34" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run separate 4 chains for 10 000 iterations using threads to parallelize.</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>num_chains <span class="op">=</span> <span class="fl">4</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    model_with_grad,</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">MCMCThreads</span>(),</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>,</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    num_chains;</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Note we need to provide an initial state for every chain.</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>    initial_state<span class="op">=</span><span class="fu">fill</span>(state, num_chains),</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>samples_array <span class="op">=</span> <span class="fu">stack</span>(<span class="fu">map</span>(<span class="bu">Base</span>.<span class="fu">Fix1</span>(stack, sample <span class="op">-&gt;</span> sample.x), samples))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000×4 Array{Float64, 3}:
[:, :, 1] =
 -2.37585  -4.25622   -4.93743   …  -4.69165  -6.18423  -5.38679
 -1.10524  -0.705976  -0.472967      1.08799   1.2657    0.00193171
  1.77446   5.03641    4.37656       6.77822   5.07548   4.6944

[:, :, 2] =
 -2.60865   -4.50344   -2.46051    …  -5.4489    -4.71648  -6.22634
 -0.153148   0.127624   0.0554437     -0.401556  -2.07589  -0.262462
  4.1194     3.86143    4.83962        5.19894    5.01143   5.73931

[:, :, 3] =
 -0.725164  -1.38017  -5.31099  -5.50821    …  -6.30186   -6.7478   -4.79135
 -0.841622  -1.06817  -1.24007   0.0499901      0.602418   1.29773   0.457246
  1.36109    2.40917   4.80617   6.0696         4.87715    4.53798   5.46108

[:, :, 4] =
 -1.67405   -3.11401   -4.86046   …  -6.13446   -5.67378  -5.18917
 -0.701385  -0.416104  -0.662169      0.404531   1.1324    0.844721
  1.43097    3.15126    4.45546       5.15057    5.5194    4.7478</code></pre>
</div>
</div>
<p>But the fact that we have to provide the <code>AbstractMCMC.sample</code> call, etc. with an <code>initial_state</code> to get started is a bit annoying. We can avoid this by also defining a <code>AbstractMCMC.step</code> <em>without</em> the <code>state</code> argument:</p>
<div id="36" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">::</span><span class="dt">MALA</span>;</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># </span><span class="al">NOTE</span><span class="co">: No state provided!</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just create the initial state by sampling using  a Gaussian.</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="fu">randn</span>(rng, LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(x), <span class="fu">MALAState</span>(x)</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Equipped with this, we no longer need to provide the <code>initial_state</code> everywhere:</p>
<div id="38" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -4.98021      0.999211
 -0.000726335  1.00483
  4.97085      0.992142</code></pre>
</div>
</div>
</section>
<section id="using-our-sampler-with-turing.jl" class="level2">
<h2 class="anchored" data-anchor-id="using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</h2>
<p>As we promised, all of this hassle of implementing our <code>MALA</code> sampler in a way that uses <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> and <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> gets us something more than <em>just</em> an “automatic” implementation of <code>AbstractMCMC.sample</code>.</p>
<p>It also enables use with Turing.jl through the <code>externalsampler</code>, but we need to do one final thing first: we need to tell Turing.jl how to extract a vector of parameters from the “sample” returned in our implementation of <code>AbstractMCMC.step</code>. In our case, the “sample” is a <code>MALASample</code>, so we just need the following line:</p>
<div id="40" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load Turing.jl.</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Turing</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Overload the `getparams` method for our "sample" type, which is just a vector.</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>Turing.Inference.<span class="fu">getparams</span>(<span class="op">::</span><span class="dt">Turing.Model</span>, sample<span class="op">::</span><span class="dt">MALASample</span>) <span class="op">=</span> sample.x</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And with that, we’re good to go!</p>
<div id="42" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Our previous model defined as a Turing.jl model.</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">mvnormal_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">MvNormal</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.], I)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate our model.</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">mvnormal_model</span>()</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Call `sample` but now we're passing in a Turing.jl `model` and wrapping</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co"># our `MALA` sampler in the `externalsampler` to tell Turing.jl that the sampler</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co"># expects something that implements LogDensityProblems.jl.</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×4×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 2.74 seconds
Compute duration  = 2.74 seconds
parameters        = x[1], x[2], x[3]
internals         = lp

Summary Statistics
  parameters      mean       std      mcse    ess_bulk    ess_tail      rhat   ⋯
      Symbol   Float64   Float64   Float64     Float64     Float64   Float64   ⋯

        x[1]   -4.9738    1.0005    0.0182   3020.8444   5558.1478    1.0008   ⋯
        x[2]    0.0270    1.0156    0.0176   3336.7795   5420.0090    1.0005   ⋯
        x[3]    5.0020    0.9975    0.0187   2857.8702   4975.1915    1.0006   ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

        x[1]   -6.9200   -5.6505   -4.9751   -4.2908   -3.0408
        x[2]   -1.9297   -0.6856    0.0242    0.7251    2.0020
        x[3]    3.0758    4.3271    4.9842    5.6787    6.9753</code></pre>
</div>
</div>
<p>Pretty neat, eh?</p>
<section id="models-with-constrained-parameters" class="level3">
<h3 class="anchored" data-anchor-id="models-with-constrained-parameters">Models with constrained parameters</h3>
<p>One thing we’ve sort of glossed over in all of the above is that MALA, at least how we’ve implemented it, requires <span class="math inline">\(x\)</span> to live in <span class="math inline">\(\mathbb{R}^d\)</span> for some <span class="math inline">\(d &gt; 0\)</span>. If some of the parameters were in fact constrained, e.g.&nbsp;we were working with a <code>Beta</code> distribution which has support on the interval <span class="math inline">\((0, 1)\)</span>, <em>not</em> on <span class="math inline">\(\mathbb{R}^d\)</span>, we could easily end up outside of the valid range <span class="math inline">\((0, 1)\)</span>.</p>
<div id="44" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">beta_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">beta_model</span>()</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 1.86 seconds
Compute duration  = 1.86 seconds
parameters        = x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse    ess_bulk    ess_tail      rhat   ⋯
      Symbol   Float64   Float64   Float64     Float64     Float64   Float64   ⋯

           x    0.4978    0.1875    0.0028   4401.5286   5995.5262    1.0000   ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

           x    0.1418    0.3602    0.5000    0.6346    0.8526</code></pre>
</div>
</div>
<p>Yep, that still works, but only because Turing.jl actually <em>transforms</em> the <code>turing_model</code> from constrained to unconstrained, so that the <code>sampler</code> provided to <code>externalsampler</code> is actually always working in unconstrained space! This is not always desirable, so we can turn this off:</p>
<div id="46" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 0.14 seconds
Compute duration  = 0.14 seconds
parameters        = x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse   ess_bulk   ess_tail      rhat   e ⋯
      Symbol   Float64   Float64   Float64    Float64    Float64   Float64     ⋯

           x    0.1822    0.0000    0.0000        NaN        NaN       NaN     ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

           x    0.1822    0.1822    0.1822    0.1822    0.1822</code></pre>
</div>
</div>
<p>The fun thing is that this still sort of works because</p>
<div id="48" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">logpdf</span>(<span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>), <span class="fl">10.0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-Inf</code></pre>
</div>
</div>
<p>and so the samples that fall outside of the range are always rejected. But do notice how much worse all the diagnostics are, e.g.&nbsp;<code>ess_tail</code> is very poor compared to when we use <code>unconstrained=true</code>. Moreover, in more complex cases this won’t just result in a “nice” <code>-Inf</code> log-density value, but instead will error:</p>
<div id="50" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="kw">function</span> <span class="fu">demo</span>()</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>    σ² <span class="op">~</span> <span class="fu">truncated</span>(<span class="fu">Normal</span>(), lower<span class="op">=</span><span class="fl">0</span>)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If we end up with negative values for `σ²`, the `Normal` will error.</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>    x <span class="op">~</span> <span class="fu">Normal</span>(<span class="fl">0</span>, σ²)</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>DomainError: DomainError(-0.05942049545162304, "Normal: the condition σ &gt;= zero(σ) is not satisfied.")
DomainError with -0.05942049545162304:
Normal: the condition σ &gt;= zero(σ) is not satisfied.
Stacktrace:
  [1] #371
    @ ~/.julia/packages/Distributions/j0ZcJ/src/univariate/continuous/normal.jl:37 [inlined]
  [2] check_args
    @ ~/.julia/packages/Distributions/j0ZcJ/src/utils.jl:89 [inlined]
  [3] #Normal#370
    @ ~/.julia/packages/Distributions/j0ZcJ/src/univariate/continuous/normal.jl:37 [inlined]
  [4] Normal
    @ ~/.julia/packages/Distributions/j0ZcJ/src/univariate/continuous/normal.jl:36 [inlined]
  [5] Normal
    @ ~/.julia/packages/Distributions/j0ZcJ/src/univariate/continuous/normal.jl:42 [inlined]
  [6] macro expansion
    @ ~/.julia/packages/DynamicPPL/cvlfK/src/compiler.jl:584 [inlined]
  [7] demo
    @ ~/work/docs/docs/tutorials/docs-17-implementing-samplers/index.qmd:455 [inlined]
  [8] _evaluate!!
    @ ~/.julia/packages/DynamicPPL/cvlfK/src/model.jl:914 [inlined]
  [9] evaluate_threadsafe!!(model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, varinfo::DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, context::DynamicPPL.ValuesAsInModelContext{OrderedDict{Any, Any}, DynamicPPL.DefaultContext})
    @ DynamicPPL ~/.julia/packages/DynamicPPL/cvlfK/src/model.jl:903
 [10] evaluate!!
    @ ~/.julia/packages/DynamicPPL/cvlfK/src/model.jl:833 [inlined]
 [11] values_as_in_model
    @ ~/.julia/packages/DynamicPPL/cvlfK/src/values_as_in_model.jl:196 [inlined]
 [12] values_as_in_model
    @ ~/.julia/packages/DynamicPPL/cvlfK/src/values_as_in_model.jl:195 [inlined]
 [13] getparams(model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, vi::DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64})
    @ Turing.Inference ~/.julia/packages/Turing/NQDYt/src/mcmc/Inference.jl:381
 [14] Turing.Inference.Transition(model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, vi::DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, t::MALASample{Vector{Float64}})
    @ Turing.Inference ~/.julia/packages/Turing/NQDYt/src/mcmc/Inference.jl:256
 [15] transition_to_turing
    @ ~/.julia/packages/Turing/NQDYt/src/mcmc/abstractmcmc.jl:12 [inlined]
 [16] transition_to_turing(f::LogDensityProblemsADForwardDiffExt.ForwardDiffLogDensity{LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, Nothing}, ForwardDiff.Chunk{2}, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}, transition::MALASample{Vector{Float64}})
    @ Turing.Inference ~/.julia/packages/Turing/NQDYt/src/mcmc/abstractmcmc.jl:17
 [17] step(rng::TaskLocalRNG, model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, sampler_wrapper::DynamicPPL.Sampler{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}; initial_state::Nothing, initial_params::Nothing, kwargs::@Kwargs{})
    @ Turing.Inference ~/.julia/packages/Turing/NQDYt/src/mcmc/abstractmcmc.jl:147
 [18] macro expansion
    @ ~/.julia/packages/AbstractMCMC/FSyVk/src/sample.jl:0 [inlined]
 [19] macro expansion
    @ ~/.julia/packages/AbstractMCMC/FSyVk/src/logging.jl:16 [inlined]
 [20] mcmcsample(rng::TaskLocalRNG, model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, sampler::DynamicPPL.Sampler{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}, N::Int64; progress::Bool, progressname::String, callback::Nothing, num_warmup::Int64, discard_initial::Int64, thinning::Int64, chain_type::Type, initial_state::Nothing, kwargs::@Kwargs{})
    @ AbstractMCMC ~/.julia/packages/AbstractMCMC/FSyVk/src/sample.jl:142
 [21] sample(rng::TaskLocalRNG, model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, sampler::DynamicPPL.Sampler{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}, N::Int64; chain_type::Type, resume_from::Nothing, initial_state::Nothing, kwargs::@Kwargs{progress::Bool})
    @ DynamicPPL ~/.julia/packages/DynamicPPL/cvlfK/src/sampler.jl:107
 [22] sample
    @ ~/.julia/packages/DynamicPPL/cvlfK/src/sampler.jl:97 [inlined]
 [23] #sample#4
    @ ~/.julia/packages/Turing/NQDYt/src/mcmc/Inference.jl:303 [inlined]
 [24] sample
    @ ~/.julia/packages/Turing/NQDYt/src/mcmc/Inference.jl:294 [inlined]
 [25] #sample#3
    @ ~/.julia/packages/Turing/NQDYt/src/mcmc/Inference.jl:291 [inlined]
 [26] top-level scope
    @ ~/work/docs/docs/tutorials/docs-17-implementing-samplers/index.qmd:457</code></pre>
</div>
</div>
<p>As expected, we run into a <code>DomainError</code> at some point, while if we set <code>unconstrained=true</code>, letting Turing.jl transform the model to a unconstrained form behind the scenes, everything works as expected:</p>
<div id="52" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 1.94 seconds
Compute duration  = 1.94 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse   ess_bulk   ess_tail      rhat   e ⋯
      Symbol   Float64   Float64   Float64    Float64    Float64   Float64     ⋯

          σ²    0.4388    0.0000    0.0000        NaN        NaN       NaN     ⋯
           x    3.6326    0.0000    0.0000        NaN        NaN       NaN     ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

          σ²    0.4388    0.4388    0.4388    0.4388    0.4388
           x    3.6326    3.6326    3.6326    3.6326    3.6326</code></pre>
</div>
</div>
<p>Neat!</p>
<p>Similarly, which automatic differentiation backend one should use can be specified through the <code>adtype</code> keyword argument too. For example, if we want to use <a href="https://github.com/JuliaDiff/ReverseDiff.jl">ReverseDiff.jl</a> instead of the default <a href="https://github.com/JuliaDiff/ForwardDiff.jl">ForwardDiff.jl</a>:</p>
<div id="54" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">ReverseDiff</span>: ReverseDiff</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify that we want to use `AutoReverseDiff`.</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">demo</span>(),</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>, adtype<span class="op">=</span><span class="fu">AutoReverseDiff</span>()),</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>;</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 3.59 seconds
Compute duration  = 3.59 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse   ess_bulk   ess_tail      rhat   e ⋯
      Symbol   Float64   Float64   Float64    Float64    Float64   Float64     ⋯

          σ²    0.8547    0.5120    0.0168   752.9085   504.7980    1.0064     ⋯
           x   -0.0043    0.9168    0.0388   692.7003   412.9017    1.0036     ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

          σ²    0.1550    0.4333    0.7724    1.1950    2.0023
           x   -2.1356   -0.4317    0.0211    0.4642    1.8576</code></pre>
</div>
</div>
<p>Double-neat.</p>
</section>
</section>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<p>At this point it’s worth maybe reminding ourselves what we did and also <em>why</em> we did it:</p>
<ol type="1">
<li>We define our models in the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface because it makes the sampler agnostic to how the underlying model is implemented.</li>
<li>We implement our sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> interface, which just means that our sampler is a subtype of <code>AbstractMCMC.AbstractSampler</code> and we implement the MCMC transition in <code>AbstractMCMC.step</code>.</li>
<li>Points 1 and 2 makes it so our sampler can be used with a wide range of model implementations, amongst them being models implemented in both Turing.jl and Stan. This gives you, the inference implementer, a large collection of models to test your inference method on, in addition to allowing users of Turing.jl and Stan to try out your inference method with minimal effort.</li>
</ol>


</section>


<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a><div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>We’re going with the leapfrog formulation because in a future version of this tutorial we’ll add a section extending this simple “baseline” MALA sampler to more complex versions. See <a href="https://github.com/TuringLang/docs/issues/479">issue #479</a> for progress on this.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>There is no such thing as a proper interface in Julia (at least not officially), and so we use the word “interface” here to mean a few minimal methods that needs to be implemented by any type that we treat as a target model.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/turinglang\.org\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../tutorials/docs-07-for-developers-variational-inference/index.html" class="pagination-link" aria-label="Variational Inference">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Variational Inference</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Turing is created by <a href="http://mlg.eng.cam.ac.uk/hong/" target="_blank">Hong Ge</a>, and lovingly maintained by the <a href="https://github.com/TuringLang/Turing.jl/graphs/contributors" target="_blank">core team</a> of volunteers. <br> The contents of this website are © 2024 under the terms of the <a href="https://github.com/TuringLang/Turing.jl/blob/master/LICENCE" target="_blank">MIT License</a>.</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/TuringLang/docs/edit/master/tutorials/docs-17-implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/docs/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://x.com/TuringLang">
      <i class="bi bi-twitter" role="img" aria-label="Turing Twitter">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/TuringLang/Turing.jl">
      <i class="bi bi-github" role="img" aria-label="Turing GitHub">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




<script src="../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>