<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.33">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Implementing Samplers – Turing.jl</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<link href="../../../developers/inference/variational-inference/index.html" rel="prev">
<link href="../../..//assets/favicon.ico" rel="icon">
<script src="../../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-59898bd1c6b9d2bb783127feaa000c76.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-dark-d329e753491efaeac79c98c4b193a686.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-59898bd1c6b9d2bb783127feaa000c76.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap-4194f9562701575e5baa9af6c3668b6f.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../../site_libs/bootstrap/bootstrap-dark-c2fa6fa1a1f4e3883ea05d73102366a5.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="../../../site_libs/bootstrap/bootstrap-4194f9562701575e5baa9af6c3668b6f.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<style>
  a {
    text-decoration: none;
  }
  a:hover {
    text-decoration: underline;
  }
</style>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<meta property="og:title" content="The Turing Language">
<meta property="og:description" content="Turing.jl is a probabilistic programming language and Bayesian modelling framework for the Julia programming language.">
<meta property="og:image" content="https://turinglang.org/docs/assets/images/turing-text-logo.jpg">
<meta property="og:site_name" content="Turing.jl">
<meta property="og:image:alt" content="Turing.jl Logo">
<meta property="og:locale" content="en_GB">
<meta name="twitter:title" content="Implementing Samplers – Turing.jl">
<meta name="twitter:description" content="Turing.jl is a probabilistic programming language and Bayesian modelling framework for the Julia programming language.">
<meta name="twitter:image" content="https://turinglang.org/docs/assets/images/turing-text-logo.jpg">
<meta name="twitter:creator" content="@Hong_Ge2">
<meta name="twitter:site" content="@TuringLang">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-sidebar floating nav-fixed quarto-light"><script id="quarto-html-before-body" type="application/javascript">
    const toggleBodyColorMode = (bsSheetEl) => {
      const mode = bsSheetEl.getAttribute("data-mode");
      const bodyEl = window.document.querySelector("body");
      if (mode === "dark") {
        bodyEl.classList.add("quarto-dark");
        bodyEl.classList.remove("quarto-light");
      } else {
        bodyEl.classList.add("quarto-light");
        bodyEl.classList.remove("quarto-dark");
      }
    }
    const toggleBodyColorPrimary = () => {
      const bsSheetEl = window.document.querySelector("link#quarto-bootstrap:not([rel=disabled-stylesheet])");
      if (bsSheetEl) {
        toggleBodyColorMode(bsSheetEl);
      }
    }
    const setColorSchemeToggle = (alternate) => {
      const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
      for (let i=0; i < toggles.length; i++) {
        const toggle = toggles[i];
        if (toggle) {
          if (alternate) {
            toggle.classList.add("alternate");
          } else {
            toggle.classList.remove("alternate");
          }
        }
      }
    };
    const toggleColorMode = (alternate) => {
      // Switch the stylesheets
      const primaryStylesheets = window.document.querySelectorAll('link.quarto-color-scheme:not(.quarto-color-alternate)');
      const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
      manageTransitions('#quarto-margin-sidebar .nav-link', false);
      if (alternate) {
        // note: dark is layered on light, we don't disable primary!
        enableStylesheet(alternateStylesheets);
        for (const sheetNode of alternateStylesheets) {
          if (sheetNode.id === "quarto-bootstrap") {
            toggleBodyColorMode(sheetNode);
          }
        }
      } else {
        disableStylesheet(alternateStylesheets);
        enableStylesheet(primaryStylesheets)
        toggleBodyColorPrimary();
      }
      manageTransitions('#quarto-margin-sidebar .nav-link', true);
      // Switch the toggles
      setColorSchemeToggle(alternate)
      // Hack to workaround the fact that safari doesn't
      // properly recolor the scrollbar when toggling (#1455)
      if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
        manageTransitions("body", false);
        window.scrollTo(0, 1);
        setTimeout(() => {
          window.scrollTo(0, 0);
          manageTransitions("body", true);
        }, 40);
      }
    }
    const disableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        stylesheet.rel = 'disabled-stylesheet';
      }
    }
    const enableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        if(stylesheet.rel !== 'stylesheet') { // for Chrome, which will still FOUC without this check
          stylesheet.rel = 'stylesheet';
        }
      }
    }
    const manageTransitions = (selector, allowTransitions) => {
      const els = window.document.querySelectorAll(selector);
      for (let i=0; i < els.length; i++) {
        const el = els[i];
        if (allowTransitions) {
          el.classList.remove('notransition');
        } else {
          el.classList.add('notransition');
        }
      }
    }
    const isFileUrl = () => {
      return window.location.protocol === 'file:';
    }
    const hasAlternateSentinel = () => {
      let styleSentinel = getColorSchemeSentinel();
      if (styleSentinel !== null) {
        return styleSentinel === "alternate";
      } else {
        return false;
      }
    }
    const setStyleSentinel = (alternate) => {
      const value = alternate ? "alternate" : "default";
      if (!isFileUrl()) {
        window.localStorage.setItem("quarto-color-scheme", value);
      } else {
        localAlternateSentinel = value;
      }
    }
    const getColorSchemeSentinel = () => {
      if (!isFileUrl()) {
        const storageValue = window.localStorage.getItem("quarto-color-scheme");
        return storageValue != null ? storageValue : localAlternateSentinel;
      } else {
        return localAlternateSentinel;
      }
    }
    const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
      const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
      const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
      let newTheme = '';
      if(authorPrefersDark) {
        newTheme = isAlternate ? baseTheme : alternateTheme;
      } else {
        newTheme = isAlternate ? alternateTheme : baseTheme;
      }
      const changeGiscusTheme = () => {
        // From: https://github.com/giscus/giscus/issues/336
        const sendMessage = (message) => {
          const iframe = document.querySelector('iframe.giscus-frame');
          if (!iframe) return;
          iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
        }
        sendMessage({
          setConfig: {
            theme: newTheme
          }
        });
      }
      const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
      if (isGiscussLoaded) {
        changeGiscusTheme();
      }
    };
    const authorPrefersDark = false;
    const darkModeDefault = authorPrefersDark;
      document.querySelector('link#quarto-text-highlighting-styles.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
      document.querySelector('link#quarto-bootstrap.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
    let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
    // Dark / light mode switch
    window.quartoToggleColorScheme = () => {
      // Read the current dark / light value
      let toAlternate = !hasAlternateSentinel();
      toggleColorMode(toAlternate);
      setStyleSentinel(toAlternate);
      toggleGiscusIfUsed(toAlternate, darkModeDefault);
      window.dispatchEvent(new Event('resize'));
    };
    // Switch to dark mode if need be
    if (hasAlternateSentinel()) {
      toggleColorMode(true);
    } else {
      toggleColorMode(false);
    }
  </script>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="https://turinglang.org/" class="navbar-brand navbar-brand-logo">
    <img src="../../../assets/images/turing-logo.svg" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="https://turinglang.org/">
    <span class="navbar-title">Turing.jl</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../getting-started/"> 
<span class="menu-text">Get Started</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../tutorials/"> 
<span class="menu-text">Tutorials</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/library/"> 
<span class="menu-text">Libraries</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/news/"> 
<span class="menu-text">News</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/team/"> 
<span class="menu-text">Team</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-v0.39" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">v0.39</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-v0.39">    
        <li>
    <a class="dropdown-item" href="https://turinglang.org/docs/changelog.html">
 <span class="dropdown-text">Changelog</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://turinglang.org/docs/versions.html">
 <span class="dropdown-text">All Versions</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools tools-wide">
    <a href="https://x.com/TuringLang" title="Turing Twitter" class="quarto-navigation-tool px-1" aria-label="Turing Twitter"><i class="bi bi-twitter"></i></a>
    <a href="https://discourse.julialang.org/c/domain/probprog/48" title="Turing Discourse" class="quarto-navigation-tool px-1" aria-label="Turing Discourse"><i class="bi bi-chat-dots"></i></a>
    <a href="https://julialang.slack.com/archives/CCYDC34A0" title="Turing Slack" class="quarto-navigation-tool px-1" aria-label="Turing Slack"><i class="bi bi-slack"></i></a>
    <a href="https://github.com/TuringLang" title="Turing GitHub" class="quarto-navigation-tool px-1" aria-label="Turing GitHub"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../../developers/contributing/index.html">Developers</a></li><li class="breadcrumb-item"><a href="../../../developers/inference/variational-inference/index.html">Inference in Detail</a></li><li class="breadcrumb-item"><a href="../../../developers/inference/implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../getting-started/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Getting Started</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../core-functionality/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Core Functionality</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false">
 <span class="menu-text">User Guide</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/automatic-differentiation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Automatic Differentiation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/submodels/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Submodels</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/custom-distribution/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Custom Distributions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/probability-interface/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Querying Model Probabilities</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/modifying-logprob/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Modifying the Log Probability</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/tracking-extra-quantities/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Tracking Extra Quantities</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/mode-estimation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Mode Estimation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/performance-tips/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Performance Tips</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/sampler-visualisation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Sampler Visualization</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/dynamichmc/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using DynamicHMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/external-samplers/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using External Samplers</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/troubleshooting/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Troubleshooting</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false">
 <span class="menu-text">Tutorials</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/coin-flipping/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction: Coin Flipping</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/gaussian-mixture-models/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Mixture Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-neural-networks/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Neural Networks</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/hidden-markov-models/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Hidden Markov Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-linear-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Linear Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/infinite-mixture-models/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Infinite Mixture Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-poisson-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Poisson Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/multinomial-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Multinomial Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-differential-equations/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Differential Equations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/probabilistic-pca/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Probabilistic PCA</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-time-series-analysis/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Time Series Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/gaussian-processes-introduction/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Processes: Introduction</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/gaussian-process-latent-variable-models/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Process Latent Variable Models</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Developers</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/contributing/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Contributing</span></a>
  </div>
</li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false">
 <span class="menu-text">DynamicPPL’s Compiler</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/compiler/model-manual/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Manually Defining a Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/compiler/minituring-compiler/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation I: Compiler</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/compiler/minituring-contexts/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation II: Contexts</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/compiler/design-overview/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Turing Compiler Design (Outdated)</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false">
 <span class="menu-text">DynamicPPL Contexts</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/contexts/submodel-condition/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Conditioning and fixing in submodels</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="false">
 <span class="menu-text">Variable Transformations</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/transforms/distributions/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Distributions and the Jacobian</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/transforms/bijectors/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bijectors in MCMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/transforms/dynamicppl/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variable transformations in DynamicPPL</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true">
 <span class="menu-text">Inference in Detail</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/inference/variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/inference/implementing-samplers/index.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Implementing Samplers</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of Contents</h2>
   
  <ul>
  <li><a href="#quick-overview-of-mala" id="toc-quick-overview-of-mala" class="nav-link active" data-scroll-target="#quick-overview-of-mala">Quick overview of MALA</a></li>
  <li><a href="#what-we-need-from-a-model-logdensityproblems.jl" id="toc-what-we-need-from-a-model-logdensityproblems.jl" class="nav-link" data-scroll-target="#what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: LogDensityProblems.jl</a></li>
  <li><a href="#implementing-mala-in-abstractmcmc.jl" id="toc-implementing-mala-in-abstractmcmc.jl" class="nav-link" data-scroll-target="#implementing-mala-in-abstractmcmc.jl">Implementing MALA in AbstractMCMC.jl</a></li>
  <li><a href="#using-our-sampler-with-turing.jl" id="toc-using-our-sampler-with-turing.jl" class="nav-link" data-scroll-target="#using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</a>
  <ul class="collapse">
  <li><a href="#models-with-constrained-parameters" id="toc-models-with-constrained-parameters" class="nav-link" data-scroll-target="#models-with-constrained-parameters">Models with constrained parameters</a></li>
  </ul></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/TuringLang/docs/edit/main/developers/inference/implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/docs/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">


<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../../developers/contributing/index.html">Developers</a></li><li class="breadcrumb-item"><a href="../../../developers/inference/variational-inference/index.html">Inference in Detail</a></li><li class="breadcrumb-item"><a href="../../../developers/inference/implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Implementing Samplers</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>In this tutorial, we’ll go through step-by-step how to implement a “simple” sampler in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> in such a way that it can be easily applied to Turing.jl models.</p>
<p>In particular, we’re going to implement a version of <strong>Metropolis-adjusted Langevin (MALA)</strong>.</p>
<p>Note that we will implement this sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> framework, completely “ignoring” Turing.jl until the very end of the tutorial, at which point we’ll use a single line of code to make the resulting sampler available to Turing.jl. This is to really drive home the point that one can implement samplers in a way that is accessible to all of Turing.jl’s users without having to use Turing.jl yourself.</p>
<section id="quick-overview-of-mala" class="level2">
<h2 class="anchored" data-anchor-id="quick-overview-of-mala">Quick overview of MALA</h2>
<p>We can view MALA as a single step of the leapfrog intergrator with resampling of momentum <span class="math inline">\(p\)</span> at every step.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> To make that statement a bit more concrete, we first define the <em>extended</em> target <span class="math inline">\(\bar{\gamma}(x, p)\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\log \bar{\gamma}(x, p) \propto \log \gamma(x) + \log \gamma_{\mathcal{N}(0, M)}(p)
\end{equation*}\]</span></p>
<p>where <span class="math inline">\(\gamma_{\mathcal{N}(0, M)}\)</span> denotes the density for a zero-centered Gaussian with covariance matrix <span class="math inline">\(M\)</span>. We then consider targeting this joint distribution over both <span class="math inline">\(x\)</span> and <span class="math inline">\(p\)</span> as follows. First we define the map</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  L_{\epsilon}: \quad &amp; \mathbb{R}^d \times \mathbb{R}^d \to \mathbb{R}^d \times \mathbb{R}^d \\
  &amp; (x, p) \mapsto (\tilde{x}, \tilde{p}) := L_{\epsilon}(x, p)
\end{split}
\end{equation*}\]</span></p>
<p>as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p_{1 / 2} &amp;:= p + \frac{\epsilon}{2} \nabla \log \gamma(x) \\
  \tilde{x} &amp;:= x + \epsilon M^{-1} p_{1 /2 } \\
  p_1 &amp;:= p_{1 / 2} + \frac{\epsilon}{2} \nabla \log \gamma(\tilde{x}) \\
  \tilde{p} &amp;:= - p_1
\end{split}
\end{equation*}\]</span></p>
<p>This might be familiar for some readers as a single step of the Leapfrog integrator. We then define the MALA kernel as follows: given the current iterate <span class="math inline">\(x_i\)</span>, we sample the next iterate <span class="math inline">\(x_{i + 1}\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p &amp;\sim \mathcal{N}(0, M) \\
  (\tilde{x}, \tilde{p}) &amp;:= L_{\epsilon}(x_i, p) \\
  \alpha &amp;:= \min \left\{ 1, \frac{\bar{\gamma}(\tilde{x}, \tilde{p})}{\bar{\gamma}(x_i, p)} \right\} \\
  x_{i + 1} &amp;:=
  \begin{cases}
    \tilde{x} \quad &amp; \text{ with prob. } \alpha \\
    x_i       \quad &amp; \text{ with prob. } 1 - \alpha
  \end{cases}
\end{split}
\end{equation*}\]</span></p>
<p>i.e.&nbsp;we accept the proposal <span class="math inline">\(\tilde{x}\)</span> with probability <span class="math inline">\(\alpha\)</span> and reject it, thus sticking with our current iterate, with probability <span class="math inline">\(1 - \alpha\)</span>.</p>
</section>
<section id="what-we-need-from-a-model-logdensityproblems.jl" class="level2">
<h2 class="anchored" data-anchor-id="what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a></h2>
<p>There are a few things we need from the “target” / “model” / density that we want to sample from:</p>
<ol type="1">
<li>We need access to log-density <em>evaluations</em> <span class="math inline">\(\log \gamma(x)\)</span> so we can compute the acceptance ratio involving <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>We need access to log-density <em>gradients</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span> so we can compute the Leapfrog steps <span class="math inline">\(L_{\epsilon}(x, p)\)</span>.</li>
<li>We also need access to the “size” of the model so we can determine the size of <span class="math inline">\(M\)</span>.</li>
</ol>
<p>Luckily for us, there is a package called <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> which provides an interface for <em>exactly</em> this!</p>
<p>To demonstrate how one can implement the “<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface”<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> we will use a simple Gaussian model as an example:</p>
<div id="4" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblems</span>: LogDensityProblems;</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's define some type that represents the model.</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> IsotropicNormalModel{M<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"mean of the isotropic Gaussian"</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    mean<span class="op">::</span><span class="dt">M</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Specifies what input length the model expects.</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">dimension</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> <span class="fu">length</span>(model.mean)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Implementation of the log-density evaluation of the model.</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x<span class="op">::</span><span class="dt">AbstractVector{&lt;:Real}</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">-</span> <span class="fu">sum</span>(abs2, x <span class="op">.-</span> model.mean) <span class="op">/</span> <span class="fl">2</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This gives us all of the properties we want for our MALA sampler with the exception of the computation of the <em>gradient</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span>. There is the method <code>LogDensityProblems.logdensity_and_gradient</code> which should return a 2-tuple where the first entry is the evaluation of the logdensity <span class="math inline">\(\log \gamma(x)\)</span> and the second entry is the gradient <span class="math inline">\(\nabla \log \gamma(x)\)</span>.</p>
<p>There are two ways to “implement” this method: 1) we implement it by hand, which is feasible in the case of our <code>IsotropicNormalModel</code>, or b) we defer the implementation of this to a automatic differentiation backend.</p>
<p>To implement it by hand we can simply do</p>
<div id="6" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl that first-order, i.e. gradient information, is available.</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{1}</span>()</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Implement `logdensity_and_gradient`.</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    logγ_x <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="op">-</span>x <span class="op">.*</span> (x <span class="op">-</span> model.mean)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> logγ_x, ∇logγ_x</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s just try it out:</p>
<div id="8" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate the problem.</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> <span class="fu">IsotropicNormalModel</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.])</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create some example input that we can test on.</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>x_example <span class="op">=</span> <span class="fu">randn</span>(LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate!</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-25.259587904792937</code></pre>
</div>
</div>
<p>To defer it to an automatic differentiation backend, we can do</p>
<div id="10" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl we only have access to 0-th order information.</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{0}</span>()</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Use `LogDensityProblemsAD`'s `ADgradient` in combination with some AD backend to implement `logdensity_and_gradient`.</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblemsAD</span>, <span class="bu">ADTypes</span>, <span class="bu">ForwardDiff</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>model_with_grad <span class="op">=</span> <span class="fu">ADgradient</span>(<span class="fu">AutoForwardDiff</span>(), model)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model_with_grad, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-25.259587904792937</code></pre>
</div>
</div>
<p>We’ll continue with the second approach in this tutorial since this is typically what one does in practice, because there are better hobbies to spend time on than deriving gradients by hand.</p>
<p>At this point, one might wonder how we’re going to tie this back to Turing.jl in the end. Effectively, when working with inference methods that only require log-density evaluations and / or higher-order information of the log-density, Turing.jl actually converts the user-provided <code>Model</code> into an object implementing the above methods for <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>. As a result, most samplers provided by Turing.jl are actually implemented to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, enabling their use both <em>within</em> Turing.jl and <em>outside</em> of Turing.jl! Morever, there exists similar conversions for Stan through BridgeStan and Stan<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, which means that a sampler supporting the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface can easily be used on both Turing.jl <em>and</em> Stan models (in addition to user-provided models, as our <code>IsotropicNormalModel</code> above)!</p>
<p>Anyways, let’s move on to actually implementing the sampler.</p>
</section>
<section id="implementing-mala-in-abstractmcmc.jl" class="level2">
<h2 class="anchored" data-anchor-id="implementing-mala-in-abstractmcmc.jl">Implementing MALA in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a></h2>
<p>Now that we’ve established that a model implementing the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface provides us with all the information we need from <span class="math inline">\(\log \gamma(x)\)</span>, we can address the question: given an object that implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, how can we define a sampler for it?</p>
<p>We’re going to do this by making our sampler a sub-type of <code>AbstractMCMC.AbstractSampler</code> in addition to implementing a few methods from <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>. Why? Because it gets us <em>a lot</em> of functionality for free, as we will see later.</p>
<p>Moreover, <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> provides a very natural interface for MCMC algorithms.</p>
<p>First, we’ll define our <code>MALA</code> type</p>
<div id="12" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">AbstractMCMC</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALA{T,A} <span class="op">&lt;:</span><span class="dt"> AbstractMCMC.AbstractSampler</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"stepsize used in the leapfrog step"</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    ϵ_init<span class="op">::</span><span class="dt">T</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"covariance matrix used for the momentum"</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    M_init<span class="op">::</span><span class="dt">A</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notice how we’ve added the suffix <code>_init</code> to both the stepsize and the covariance matrix. We’ve done this because a <code>AbstractMCMC.AbstractSampler</code> should be <em>immutable</em>. Of course there might be many scenarios where we want to allow something like the stepsize and / or the covariance matrix to vary between iterations, e.g.&nbsp;during the burn-in / adaptation phase of the sampling process we might want to adjust the parameters using statistics computed from these initial iterations. But information which can change between iterations <em>should not go in the sampler itself</em>! Instead, this information should go in the sampler <em>state</em>.</p>
<p>The sampler state should at the very least contain all the necessary information to perform the next MCMC iteration, but usually contains further information, e.g.&nbsp;quantities and statistics useful for evaluating whether the sampler has converged.</p>
<p>We will use the following sampler state for our <code>MALA</code> sampler:</p>
<div id="14" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALAState{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This might seem overly redundant: we’re defining a type <code>MALAState</code> and it only contains a simple vector of reals. In this particular case we indeed could have dropped this and simply used a <code>AbstractVector{&lt;:Real}</code> as our sampler state, but typically, as we will see later, one wants to include other quantities in the sampler state. For example, if we also wanted to adapt the parameters of our <code>MALA</code>, e.g.&nbsp;alter the stepsize depending on acceptance rates, in which case we should also put <code>ϵ</code> in the state, but for now we’ll keep things simple.</p>
<p>Moreover, we also want a <em>sample</em> type, which is a type meant for “public consumption”, i.e.&nbsp;the end-user. This is generally going to contain a subset of the information present in the state. But in such a simple scenario as this, we similarly only have a <code>AbstractVector{&lt;:Real}</code>:</p>
<div id="16" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALASample{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We currently have three things:</p>
<ol type="1">
<li>A <code>AbstractMCMC.AbstractSampler</code> implementation called <code>MALA</code>.</li>
<li>A state <code>MALAState</code> for our sampler <code>MALA</code>.</li>
<li>A sample <code>MALASample</code> for our sampler <code>MALA</code>.</li>
</ol>
<p>That means that we’re ready to implement the only thing that really matters: <code>AbstractMCMC.step</code>.</p>
<p><code>AbstractMCMC.step</code> defines the MCMC iteration of our <code>MALA</code> given the current <code>MALAState</code>. Specifically, the signature of the function is as follows:</p>
<div id="18" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The RNG to ensure reproducibility.</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The model that defines our target.</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.AbstractModel</span>,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The sampler for which we're taking a `step`.</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">AbstractMCMC.AbstractSampler</span>,</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The current sampler `state`.</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    state;</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Additional keyword arguments that we may or may not need.</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Moreover, there is a specific <code>AbstractMCMC.AbstractModel</code> which is used to indicate that the model that is provided implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface: <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Since, as we discussed earlier, in our case we’re indeed going to work with types that support the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, we’ll define <code>AbstractMCMC.step</code> for such a <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Note that <code>AbstractMCMC.LogDensityModel</code> has no other purpose; it has a single field called <code>logdensity</code>, and it does nothing else. But by wrapping the model in <code>AbstractMCMC.LogDensityModel</code>, it allows samplers that want to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> to define their <code>AbstractMCMC.step</code> on this type without running into method ambiguities.</p>
<p>All in all, that means that the signature for our <code>AbstractMCMC.step</code> is going to be the following:</p>
<div id="20" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># `LogDensityModel` so we know we're working with LogDensityProblems.jl model.</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler.</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler state.</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Great! Now let’s actually implement the full <code>AbstractMCMC.step</code> for our <code>MALA</code>.</p>
<p>Let’s remind ourselves what we’re going to do:</p>
<ol type="1">
<li>Sample a new momentum <span class="math inline">\(p\)</span>.</li>
<li>Compute the log-density of the extended target <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>Take a single leapfrog step <span class="math inline">\((\tilde{x}, \tilde{p}) = L_{\epsilon}(x, p)\)</span>.</li>
<li>Accept or reject the proposed <span class="math inline">\((\tilde{x}, \tilde{p})\)</span>.</li>
</ol>
<p>All in all, this results in the following:</p>
<div id="22" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>: Random</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Distributions</span>  <span class="co"># so we get the `MvNormal`</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the wrapped model which implements LogDensityProblems.jl.</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just extract the sampler parameters to make our lives easier.</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    ϵ <span class="op">=</span> sampler.ϵ_init</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    M <span class="op">=</span> sampler.M_init</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the current parameters.</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> state.x</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sample the momentum.</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>    p_dist <span class="op">=</span> <span class="fu">MvNormal</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)), M)</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> <span class="fu">rand</span>(rng, p_dist)</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Propose using a single leapfrog step.</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>    x̃, p̃ <span class="op">=</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Accept or reject proposal.</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>    logp <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p)</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>    logp̃ <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x̃) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p̃)</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>    logα <span class="op">=</span> logp̃ <span class="op">-</span> logp</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>    state_new <span class="op">=</span> <span class="cf">if</span> <span class="fu">log</span>(<span class="fu">rand</span>(rng)) <span class="op">&lt;</span> logα</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Accept.</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x̃)</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Reject.</span></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x)</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return the "sample" and the sampler state.</span></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(state_new.x), state_new</span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Fairly straight-forward.</p>
<p>Of course, we haven’t defined the <code>leapfrog_step</code> method yet, so let’s do that:</p>
<div id="24" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p` using "position" `x`.</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x))</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    p1 <span class="op">=</span> p <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update the "position" `x` using momentum `p1`.</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    x̃ <span class="op">=</span> x <span class="op">+</span> ϵ <span class="op">.*</span> (M <span class="op">\</span> p1)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p1` using position `x̃`</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x̃ <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x̃))</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    p2 <span class="op">=</span> p1 <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x̃</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Flip momentum `p2`.</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    p̃ <span class="op">=</span> <span class="op">-</span>p2</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x̃, p̃</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>leapfrog_step (generic function with 1 method)</code></pre>
</div>
</div>
<p>With all of this, we’re technically ready to sample!</p>
<div id="26" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>, <span class="bu">LinearAlgebra</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>rng <span class="op">=</span> <span class="bu">Random</span>.<span class="fu">default_rng</span>()</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>sampler <span class="op">=</span> <span class="fu">MALA</span>(<span class="fl">1</span>, I)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>state <span class="op">=</span> <span class="fu">MALAState</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)))</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>x_next, state_next <span class="op">=</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    rng,</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    AbstractMCMC.<span class="fu">LogDensityModel</span>(model),</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    state</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>(MALASample{Vector{Float64}}([0.0, 0.0, 0.0]), MALAState{Vector{Float64}}([0.0, 0.0, 0.0]))</code></pre>
</div>
</div>
<p>Great, it works!</p>
<p>And I promised we would get quite some functionality for free if we implemented <code>AbstractMCMC.step</code>, and so we can now simply call <code>sample</code> to perform standard MCMC sampling:</p>
<div id="28" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform 1000 iterations with our `MALA` sampler.</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; initial_state<span class="op">=</span>state, progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Concatenate into a matrix.</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000 Matrix{Float64}:
 -1.77891   -3.41489   -5.02714   -5.02714   …  -5.27363   -7.70468  -4.43927
 -0.355552  -0.287021   0.115667   0.115667      0.857369   1.09203   1.14018
  3.2168     4.72054    4.49098    4.49098       5.48111    4.02516   4.76131</code></pre>
</div>
</div>
<div id="30" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the marginal means and standard deviations.</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -4.97476     1.01466
 -0.00724453  1.00065
  5.01549     0.987251</code></pre>
</div>
</div>
<p>Let’s visualize the samples</p>
<div id="32" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">StatsPlots</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">transpose</span>(samples_matrix[<span class="op">:</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">:</span><span class="kw">end</span>]), alpha<span class="op">=</span><span class="fl">0.5</span>, legend<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<!--?xml version="1.0" encoding="utf-8"?-->
<svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" width="672" height="480" viewbox="0 0 2688 1920">
<defs>
  <clippath id="clip550">
    <rect x="0" y="0" width="2688" height="1920"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip550)" d="M0 1920 L2688 1920 L2688 0 L0 0  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip551">
    <rect x="537" y="0" width="1883" height="1883"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip550)" d="M151.747 1800.78 L2640.76 1800.78 L2640.76 47.2441 L151.747 47.2441  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip552">
    <rect x="151" y="47" width="2490" height="1755"></rect>
  </clippath>
</defs>
<polyline clip-path="url(#clip552)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="219.84,1800.78 219.84,47.2441 "></polyline>
<polyline clip-path="url(#clip552)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="807.458,1800.78 807.458,47.2441 "></polyline>
<polyline clip-path="url(#clip552)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1395.08,1800.78 1395.08,47.2441 "></polyline>
<polyline clip-path="url(#clip552)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1982.69,1800.78 1982.69,47.2441 "></polyline>
<polyline clip-path="url(#clip552)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="2570.31,1800.78 2570.31,47.2441 "></polyline>
<polyline clip-path="url(#clip552)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,1559.21 2640.76,1559.21 "></polyline>
<polyline clip-path="url(#clip552)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,1253.79 2640.76,1253.79 "></polyline>
<polyline clip-path="url(#clip552)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,948.371 2640.76,948.371 "></polyline>
<polyline clip-path="url(#clip552)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,642.953 2640.76,642.953 "></polyline>
<polyline clip-path="url(#clip552)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,337.535 2640.76,337.535 "></polyline>
<polyline clip-path="url(#clip550)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1800.78 2640.76,1800.78 "></polyline>
<polyline clip-path="url(#clip550)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="219.84,1800.78 219.84,1781.88 "></polyline>
<polyline clip-path="url(#clip550)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="807.458,1800.78 807.458,1781.88 "></polyline>
<polyline clip-path="url(#clip550)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1395.08,1800.78 1395.08,1781.88 "></polyline>
<polyline clip-path="url(#clip550)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1982.69,1800.78 1982.69,1781.88 "></polyline>
<polyline clip-path="url(#clip550)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="2570.31,1800.78 2570.31,1781.88 "></polyline>
<path clip-path="url(#clip550)" d="M219.84 1834 Q216.229 1834 214.4 1837.57 Q212.595 1841.11 212.595 1848.24 Q212.595 1855.34 214.4 1858.91 Q216.229 1862.45 219.84 1862.45 Q223.474 1862.45 225.28 1858.91 Q227.108 1855.34 227.108 1848.24 Q227.108 1841.11 225.28 1837.57 Q223.474 1834 219.84 1834 M219.84 1830.3 Q225.65 1830.3 228.706 1834.9 Q231.784 1839.49 231.784 1848.24 Q231.784 1856.96 228.706 1861.57 Q225.65 1866.15 219.84 1866.15 Q214.03 1866.15 210.951 1861.57 Q207.896 1856.96 207.896 1848.24 Q207.896 1839.49 210.951 1834.9 Q214.03 1830.3 219.84 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip550)" d="M771.15 1861.55 L787.47 1861.55 L787.47 1865.48 L765.525 1865.48 L765.525 1861.55 Q768.187 1858.79 772.771 1854.16 Q777.377 1849.51 778.558 1848.17 Q780.803 1845.65 781.683 1843.91 Q782.585 1842.15 782.585 1840.46 Q782.585 1837.71 780.641 1835.97 Q778.72 1834.23 775.618 1834.23 Q773.419 1834.23 770.965 1835 Q768.535 1835.76 765.757 1837.31 L765.757 1832.59 Q768.581 1831.46 771.035 1830.88 Q773.488 1830.3 775.525 1830.3 Q780.896 1830.3 784.09 1832.98 Q787.285 1835.67 787.285 1840.16 Q787.285 1842.29 786.474 1844.21 Q785.687 1846.11 783.581 1848.7 Q783.002 1849.37 779.9 1852.59 Q776.798 1855.78 771.15 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip550)" d="M797.331 1830.92 L815.687 1830.92 L815.687 1834.86 L801.613 1834.86 L801.613 1843.33 Q802.632 1842.98 803.65 1842.82 Q804.669 1842.64 805.687 1842.64 Q811.474 1842.64 814.854 1845.81 Q818.233 1848.98 818.233 1854.4 Q818.233 1859.97 814.761 1863.08 Q811.289 1866.15 804.97 1866.15 Q802.794 1866.15 800.525 1865.78 Q798.28 1865.41 795.872 1864.67 L795.872 1859.97 Q797.956 1861.11 800.178 1861.66 Q802.4 1862.22 804.877 1862.22 Q808.882 1862.22 811.22 1860.11 Q813.558 1858.01 813.558 1854.4 Q813.558 1850.78 811.22 1848.68 Q808.882 1846.57 804.877 1846.57 Q803.002 1846.57 801.127 1846.99 Q799.275 1847.4 797.331 1848.28 L797.331 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip550)" d="M837.446 1834 Q833.835 1834 832.007 1837.57 Q830.201 1841.11 830.201 1848.24 Q830.201 1855.34 832.007 1858.91 Q833.835 1862.45 837.446 1862.45 Q841.081 1862.45 842.886 1858.91 Q844.715 1855.34 844.715 1848.24 Q844.715 1841.11 842.886 1837.57 Q841.081 1834 837.446 1834 M837.446 1830.3 Q843.256 1830.3 846.312 1834.9 Q849.391 1839.49 849.391 1848.24 Q849.391 1856.96 846.312 1861.57 Q843.256 1866.15 837.446 1866.15 Q831.636 1866.15 828.557 1861.57 Q825.502 1856.96 825.502 1848.24 Q825.502 1839.49 828.557 1834.9 Q831.636 1830.3 837.446 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip550)" d="M1354.69 1830.92 L1373.05 1830.92 L1373.05 1834.86 L1358.98 1834.86 L1358.98 1843.33 Q1360 1842.98 1361.01 1842.82 Q1362.03 1842.64 1363.05 1842.64 Q1368.84 1842.64 1372.22 1845.81 Q1375.6 1848.98 1375.6 1854.4 Q1375.6 1859.97 1372.12 1863.08 Q1368.65 1866.15 1362.33 1866.15 Q1360.16 1866.15 1357.89 1865.78 Q1355.64 1865.41 1353.24 1864.67 L1353.24 1859.97 Q1355.32 1861.11 1357.54 1861.66 Q1359.76 1862.22 1362.24 1862.22 Q1366.25 1862.22 1368.58 1860.11 Q1370.92 1858.01 1370.92 1854.4 Q1370.92 1850.78 1368.58 1848.68 Q1366.25 1846.57 1362.24 1846.57 Q1360.37 1846.57 1358.49 1846.99 Q1356.64 1847.4 1354.69 1848.28 L1354.69 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip550)" d="M1394.81 1834 Q1391.2 1834 1389.37 1837.57 Q1387.56 1841.11 1387.56 1848.24 Q1387.56 1855.34 1389.37 1858.91 Q1391.2 1862.45 1394.81 1862.45 Q1398.44 1862.45 1400.25 1858.91 Q1402.08 1855.34 1402.08 1848.24 Q1402.08 1841.11 1400.25 1837.57 Q1398.44 1834 1394.81 1834 M1394.81 1830.3 Q1400.62 1830.3 1403.68 1834.9 Q1406.75 1839.49 1406.75 1848.24 Q1406.75 1856.96 1403.68 1861.57 Q1400.62 1866.15 1394.81 1866.15 Q1389 1866.15 1385.92 1861.57 Q1382.87 1856.96 1382.87 1848.24 Q1382.87 1839.49 1385.92 1834.9 Q1389 1830.3 1394.81 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip550)" d="M1424.97 1834 Q1421.36 1834 1419.53 1837.57 Q1417.73 1841.11 1417.73 1848.24 Q1417.73 1855.34 1419.53 1858.91 Q1421.36 1862.45 1424.97 1862.45 Q1428.61 1862.45 1430.41 1858.91 Q1432.24 1855.34 1432.24 1848.24 Q1432.24 1841.11 1430.41 1837.57 Q1428.61 1834 1424.97 1834 M1424.97 1830.3 Q1430.78 1830.3 1433.84 1834.9 Q1436.92 1839.49 1436.92 1848.24 Q1436.92 1856.96 1433.84 1861.57 Q1430.78 1866.15 1424.97 1866.15 Q1419.16 1866.15 1416.08 1861.57 Q1413.03 1856.96 1413.03 1848.24 Q1413.03 1839.49 1416.08 1834.9 Q1419.16 1830.3 1424.97 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip550)" d="M1940.97 1830.92 L1963.19 1830.92 L1963.19 1832.91 L1950.65 1865.48 L1945.76 1865.48 L1957.57 1834.86 L1940.97 1834.86 L1940.97 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip550)" d="M1972.36 1830.92 L1990.71 1830.92 L1990.71 1834.86 L1976.64 1834.86 L1976.64 1843.33 Q1977.66 1842.98 1978.68 1842.82 Q1979.7 1842.64 1980.72 1842.64 Q1986.5 1842.64 1989.88 1845.81 Q1993.26 1848.98 1993.26 1854.4 Q1993.26 1859.97 1989.79 1863.08 Q1986.32 1866.15 1980 1866.15 Q1977.82 1866.15 1975.55 1865.78 Q1973.31 1865.41 1970.9 1864.67 L1970.9 1859.97 Q1972.98 1861.11 1975.21 1861.66 Q1977.43 1862.22 1979.9 1862.22 Q1983.91 1862.22 1986.25 1860.11 Q1988.59 1858.01 1988.59 1854.4 Q1988.59 1850.78 1986.25 1848.68 Q1983.91 1846.57 1979.9 1846.57 Q1978.03 1846.57 1976.15 1846.99 Q1974.3 1847.4 1972.36 1848.28 L1972.36 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip550)" d="M2012.47 1834 Q2008.86 1834 2007.03 1837.57 Q2005.23 1841.11 2005.23 1848.24 Q2005.23 1855.34 2007.03 1858.91 Q2008.86 1862.45 2012.47 1862.45 Q2016.11 1862.45 2017.91 1858.91 Q2019.74 1855.34 2019.74 1848.24 Q2019.74 1841.11 2017.91 1837.57 Q2016.11 1834 2012.47 1834 M2012.47 1830.3 Q2018.28 1830.3 2021.34 1834.9 Q2024.42 1839.49 2024.42 1848.24 Q2024.42 1856.96 2021.34 1861.57 Q2018.28 1866.15 2012.47 1866.15 Q2006.66 1866.15 2003.59 1861.57 Q2000.53 1856.96 2000.53 1848.24 Q2000.53 1839.49 2003.59 1834.9 Q2006.66 1830.3 2012.47 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip550)" d="M2514.84 1861.55 L2522.48 1861.55 L2522.48 1835.18 L2514.17 1836.85 L2514.17 1832.59 L2522.43 1830.92 L2527.11 1830.92 L2527.11 1861.55 L2534.75 1861.55 L2534.75 1865.48 L2514.84 1865.48 L2514.84 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip550)" d="M2554.19 1834 Q2550.58 1834 2548.75 1837.57 Q2546.94 1841.11 2546.94 1848.24 Q2546.94 1855.34 2548.75 1858.91 Q2550.58 1862.45 2554.19 1862.45 Q2557.82 1862.45 2559.63 1858.91 Q2561.46 1855.34 2561.46 1848.24 Q2561.46 1841.11 2559.63 1837.57 Q2557.82 1834 2554.19 1834 M2554.19 1830.3 Q2560 1830.3 2563.06 1834.9 Q2566.13 1839.49 2566.13 1848.24 Q2566.13 1856.96 2563.06 1861.57 Q2560 1866.15 2554.19 1866.15 Q2548.38 1866.15 2545.3 1861.57 Q2542.25 1856.96 2542.25 1848.24 Q2542.25 1839.49 2545.3 1834.9 Q2548.38 1830.3 2554.19 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip550)" d="M2584.35 1834 Q2580.74 1834 2578.91 1837.57 Q2577.11 1841.11 2577.11 1848.24 Q2577.11 1855.34 2578.91 1858.91 Q2580.74 1862.45 2584.35 1862.45 Q2587.99 1862.45 2589.79 1858.91 Q2591.62 1855.34 2591.62 1848.24 Q2591.62 1841.11 2589.79 1837.57 Q2587.99 1834 2584.35 1834 M2584.35 1830.3 Q2590.16 1830.3 2593.22 1834.9 Q2596.3 1839.49 2596.3 1848.24 Q2596.3 1856.96 2593.22 1861.57 Q2590.16 1866.15 2584.35 1866.15 Q2578.54 1866.15 2575.46 1861.57 Q2572.41 1856.96 2572.41 1848.24 Q2572.41 1839.49 2575.46 1834.9 Q2578.54 1830.3 2584.35 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip550)" d="M2614.51 1834 Q2610.9 1834 2609.07 1837.57 Q2607.27 1841.11 2607.27 1848.24 Q2607.27 1855.34 2609.07 1858.91 Q2610.9 1862.45 2614.51 1862.45 Q2618.15 1862.45 2619.95 1858.91 Q2621.78 1855.34 2621.78 1848.24 Q2621.78 1841.11 2619.95 1837.57 Q2618.15 1834 2614.51 1834 M2614.51 1830.3 Q2620.32 1830.3 2623.38 1834.9 Q2626.46 1839.49 2626.46 1848.24 Q2626.46 1856.96 2623.38 1861.57 Q2620.32 1866.15 2614.51 1866.15 Q2608.7 1866.15 2605.62 1861.57 Q2602.57 1856.96 2602.57 1848.24 Q2602.57 1839.49 2605.62 1834.9 Q2608.7 1830.3 2614.51 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip550)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1800.78 151.747,47.2441 "></polyline>
<polyline clip-path="url(#clip550)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1559.21 170.644,1559.21 "></polyline>
<polyline clip-path="url(#clip550)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1253.79 170.644,1253.79 "></polyline>
<polyline clip-path="url(#clip550)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,948.371 170.644,948.371 "></polyline>
<polyline clip-path="url(#clip550)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,642.953 170.644,642.953 "></polyline>
<polyline clip-path="url(#clip550)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,337.535 170.644,337.535 "></polyline>
<path clip-path="url(#clip550)" d="M49.5521 1559.66 L79.2279 1559.66 L79.2279 1563.59 L49.5521 1563.59 L49.5521 1559.66 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip550)" d="M99.8991 1557.34 Q96.7509 1557.34 94.8991 1559.5 Q93.0704 1561.65 93.0704 1565.4 Q93.0704 1569.13 94.8991 1571.3 Q96.7509 1573.45 99.8991 1573.45 Q103.047 1573.45 104.876 1571.3 Q106.728 1569.13 106.728 1565.4 Q106.728 1561.65 104.876 1559.5 Q103.047 1557.34 99.8991 1557.34 M109.181 1542.69 L109.181 1546.95 Q107.422 1546.12 105.617 1545.68 Q103.834 1545.24 102.075 1545.24 Q97.4454 1545.24 94.9917 1548.36 Q92.5612 1551.49 92.2139 1557.81 Q93.5797 1555.79 95.6398 1554.73 Q97.7 1553.64 100.177 1553.64 Q105.385 1553.64 108.394 1556.81 Q111.427 1559.96 111.427 1565.4 Q111.427 1570.72 108.279 1573.94 Q105.131 1577.16 99.8991 1577.16 Q93.9037 1577.16 90.7325 1572.57 Q87.5612 1567.97 87.5612 1559.24 Q87.5612 1551.05 91.45 1546.19 Q95.3389 1541.3 101.89 1541.3 Q103.649 1541.3 105.431 1541.65 Q107.237 1542 109.181 1542.69 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip550)" d="M50.3623 1254.24 L80.0381 1254.24 L80.0381 1258.18 L50.3623 1258.18 L50.3623 1254.24 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip550)" d="M104.297 1252.43 Q107.654 1253.15 109.529 1255.42 Q111.427 1257.69 111.427 1261.02 Q111.427 1266.14 107.908 1268.94 Q104.39 1271.74 97.9083 1271.74 Q95.7324 1271.74 93.4176 1271.3 Q91.126 1270.88 88.6723 1270.03 L88.6723 1265.51 Q90.6167 1266.65 92.9315 1267.23 Q95.2463 1267.8 97.7695 1267.8 Q102.168 1267.8 104.459 1266.07 Q106.774 1264.33 106.774 1261.02 Q106.774 1257.97 104.621 1256.25 Q102.492 1254.52 98.6722 1254.52 L94.6445 1254.52 L94.6445 1250.68 L98.8574 1250.68 Q102.306 1250.68 104.135 1249.31 Q105.964 1247.92 105.964 1245.33 Q105.964 1242.67 104.066 1241.25 Q102.191 1239.82 98.6722 1239.82 Q96.7509 1239.82 94.5519 1240.24 Q92.3528 1240.65 89.7139 1241.53 L89.7139 1237.37 Q92.376 1236.62 94.6908 1236.25 Q97.0287 1235.88 99.0889 1235.88 Q104.413 1235.88 107.515 1238.31 Q110.617 1240.72 110.617 1244.84 Q110.617 1247.71 108.973 1249.7 Q107.33 1251.67 104.297 1252.43 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip550)" d="M99.4824 934.17 Q95.8713 934.17 94.0426 937.734 Q92.2371 941.276 92.2371 948.406 Q92.2371 955.512 94.0426 959.077 Q95.8713 962.618 99.4824 962.618 Q103.117 962.618 104.922 959.077 Q106.751 955.512 106.751 948.406 Q106.751 941.276 104.922 937.734 Q103.117 934.17 99.4824 934.17 M99.4824 930.466 Q105.293 930.466 108.348 935.072 Q111.427 939.656 111.427 948.406 Q111.427 957.132 108.348 961.739 Q105.293 966.322 99.4824 966.322 Q93.6723 966.322 90.5936 961.739 Q87.538 957.132 87.538 948.406 Q87.538 939.656 90.5936 935.072 Q93.6723 930.466 99.4824 930.466 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip550)" d="M104.297 641.599 Q107.654 642.316 109.529 644.585 Q111.427 646.853 111.427 650.187 Q111.427 655.302 107.908 658.103 Q104.39 660.904 97.9083 660.904 Q95.7324 660.904 93.4176 660.464 Q91.126 660.048 88.6723 659.191 L88.6723 654.677 Q90.6167 655.812 92.9315 656.39 Q95.2463 656.969 97.7695 656.969 Q102.168 656.969 104.459 655.233 Q106.774 653.497 106.774 650.187 Q106.774 647.131 104.621 645.418 Q102.492 643.682 98.6722 643.682 L94.6445 643.682 L94.6445 639.84 L98.8574 639.84 Q102.306 639.84 104.135 638.474 Q105.964 637.085 105.964 634.492 Q105.964 631.83 104.066 630.418 Q102.191 628.983 98.6722 628.983 Q96.7509 628.983 94.5519 629.4 Q92.3528 629.816 89.7139 630.696 L89.7139 626.529 Q92.376 625.789 94.6908 625.418 Q97.0287 625.048 99.0889 625.048 Q104.413 625.048 107.515 627.479 Q110.617 629.886 110.617 634.006 Q110.617 636.877 108.973 638.867 Q107.33 640.835 104.297 641.599 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip550)" d="M99.8991 335.672 Q96.7509 335.672 94.8991 337.824 Q93.0704 339.977 93.0704 343.727 Q93.0704 347.454 94.8991 349.63 Q96.7509 351.783 99.8991 351.783 Q103.047 351.783 104.876 349.63 Q106.728 347.454 106.728 343.727 Q106.728 339.977 104.876 337.824 Q103.047 335.672 99.8991 335.672 M109.181 321.019 L109.181 325.278 Q107.422 324.445 105.617 324.005 Q103.834 323.565 102.075 323.565 Q97.4454 323.565 94.9917 326.69 Q92.5612 329.815 92.2139 336.135 Q93.5797 334.121 95.6398 333.056 Q97.7 331.968 100.177 331.968 Q105.385 331.968 108.394 335.139 Q111.427 338.287 111.427 343.727 Q111.427 349.051 108.279 352.269 Q105.131 355.486 99.8991 355.486 Q93.9037 355.486 90.7325 350.903 Q87.5612 346.297 87.5612 337.57 Q87.5612 329.375 91.45 324.514 Q95.3389 319.63 101.89 319.63 Q103.649 319.63 105.431 319.977 Q107.237 320.325 109.181 321.019 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip552)" style="stroke:#009af9; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,1129.47 224.541,1354.77 226.891,1453.98 229.242,1575.93 231.592,1429.85 233.943,1524.93 236.293,1657.12 238.644,1449.37 240.994,1483.14 243.345,1378.02 245.695,1365.84 248.046,1380.54 250.396,1603.52 252.747,1326.3 255.097,1453.08 257.448,1407.37 259.798,1384.35 262.148,1495.49 264.499,1256.13 266.849,1304.98 269.2,1290.93 271.55,1422.13 273.901,1423.31 276.251,1516.48 278.602,1403.18 280.952,1306.05 283.303,1447.56 285.653,1453.57 288.004,1583.22 290.354,1445.02 292.705,1291.98 295.055,1419.91 297.406,1483.23 299.756,1272.66 302.107,1519.02 304.457,1476.47 306.807,1476.84 309.158,1436.59 311.508,1286.76 313.859,1486.94 316.209,1454.8 318.56,1488.95 320.91,1639.45 323.261,1392.74 325.611,1302.37 327.962,1569.27 330.312,1413.73 332.663,1661.58 335.013,1625.79 337.364,1414.55 339.714,1302.84 342.065,1606.09 344.415,1387.5 346.765,1441.69 349.116,1597.69 351.466,1456.37 353.817,1637.63 356.167,1566.08 358.518,1478.23 360.868,1535.49 363.219,1251.99 365.569,1594.8 367.92,1733.73 370.27,1313.97 372.621,1365.32 374.971,1447.66 377.322,1393.79 379.672,1686.02 382.023,1372.16 384.373,1547.04 386.724,1567.97 389.074,1457.02 391.424,1488.9 393.775,1542.05 396.125,1604.59 398.476,1436.39 400.826,1517.61 403.177,1534.07 405.527,1477.24 407.878,1399.91 410.228,1269.88 412.579,1524.93 414.929,1566.81 417.28,1525.04 419.63,1492.37 421.981,1446.44 424.331,1351.37 426.682,1530.28 429.032,1651.24 431.382,1618.57 433.733,1299.81 436.083,1322.7 438.434,1482.21 440.784,1444.47 443.135,1558.31 445.485,1322.41 447.836,1373.87 450.186,1297.54 452.537,1523.71 454.887,1358.13 457.238,1508.9 459.588,1444.87 461.939,1282.12 464.289,1581.43 466.64,1577.72 468.99,1490.57 471.341,1482.74 473.691,1466.94 476.041,1414.63 478.392,1474.04 480.742,1528.34 483.093,1357.24 485.443,1501.74 487.794,1523.78 490.144,1472.42 492.495,1258.01 494.845,1395.34 497.196,1333.95 499.546,1397.5 501.897,1714.92 504.247,1466.01 506.598,1607.76 508.948,1329.31 511.299,1666.6 513.649,1671.21 515.999,1550.96 518.35,1501.52 520.7,1528.62 523.051,1559 525.401,1552.7 527.752,1461.44 530.102,1287.85 532.453,1456.04 534.803,1401.43 537.154,1364.26 539.504,1351.96 541.855,1519.59 544.205,1284.06 546.556,1545.09 548.906,1520.89 551.257,1296.07 553.607,1520.28 555.958,1469.99 558.308,1218.78 560.658,1434.61 563.009,1488.07 565.359,1446.47 567.71,1351.8 570.06,1581.68 572.411,1486.43 574.761,1405.67 577.112,1323.72 579.462,1561.59 581.813,1269.4 584.163,1374.58 586.514,1368.8 588.864,1468.17 591.215,1572.74 593.565,1494.49 595.916,1287.03 598.266,1661.11 600.616,1365.59 602.967,1410.92 605.317,1445.25 607.668,1524.54 610.018,1416.77 612.369,1586.61 614.719,1503.73 617.07,1420.26 619.42,1557.63 621.771,1317.76 624.121,1498.79 626.472,1467.43 628.822,1520.43 631.173,1385.61 633.523,1310.17 635.874,1453.76 638.224,1486.99 640.575,1438.82 642.925,1507.57 645.275,1451.95 647.626,1522.27 649.976,1418.45 652.327,1278.77 654.677,1415.12 657.028,1378.82 659.378,1224.43 661.729,1405.85 664.079,1598.86 666.43,1426.55 668.78,1460.57 671.131,1412.14 673.481,1369.68 675.832,1490.98 678.182,1703.11 680.533,1407.66 682.883,1288.05 685.233,1310.59 687.584,1485.93 689.934,1339.77 692.285,1281.69 694.635,1350.07 696.986,1506.46 699.336,1411.84 701.687,1474.62 704.037,1559.38 706.388,1523.56 708.738,1588.75 711.089,1481.67 713.439,1554.87 715.79,1686.76 718.14,1432.71 720.491,1702.67 722.841,1422.28 725.192,1355.63 727.542,1445.9 729.892,1286.02 732.243,1391.68 734.593,1422.76 736.944,1462.41 739.294,1414.09 741.645,1524.44 743.995,1387.92 746.346,1541.58 748.696,1592.55 751.047,1512.95 753.397,1495.79 755.748,1281.92 758.098,1489.8 760.449,1056.42 762.799,1502.82 765.15,1376.44 767.5,1455.08 769.85,1632.94 772.201,1290.34 774.551,1558.9 776.902,1483.23 779.252,1542.6 781.603,1588.49 783.953,1412.04 786.304,1385.37 788.654,1360.65 791.005,1412.74 793.355,1430.09 795.706,1488.41 798.056,1319.82 800.407,1391.88 802.757,1356.02 805.108,1449.41 807.458,1288.12 809.809,1225.91 812.159,1304.81 814.509,1463.94 816.86,1466.99 819.21,1305.79 821.561,1422.83 823.911,1607.76 826.262,1491.23 828.612,1530.86 830.963,1566.67 833.313,1452.2 835.664,1505.55 838.014,1612.75 840.365,1461.11 842.715,1560.22 845.066,1408.08 847.416,1638.14 849.767,1523.36 852.117,1411.58 854.467,1427.96 856.818,1403.89 859.168,1672.98 861.519,1441.63 863.869,1600.86 866.22,1399.42 868.57,1417.16 870.921,1400.36 873.271,1696.03 875.622,1425.55 877.972,1378.6 880.323,1373 882.673,1512.15 885.024,1485.4 887.374,1468.96 889.725,1479.34 892.075,1529.37 894.426,1367.48 896.776,1488.85 899.126,1347.77 901.477,1505.53 903.827,1689.03 906.178,1388.13 908.528,1394.58 910.879,1387.17 913.229,1465.93 915.58,1400.24 917.93,1487.6 920.281,1465.32 922.631,1442.85 924.982,1454.64 927.332,1410.83 929.683,1329.83 932.033,1504.92 934.384,1583.36 936.734,1650.61 939.084,1312.47 941.435,1415 943.785,1302.08 946.136,1575.1 948.486,1436.01 950.837,1505.57 953.187,1636.01 955.538,1307.01 957.888,1356.51 960.239,1448.97 962.589,1331.51 964.94,1443.78 967.29,1237.85 969.641,1479.22 971.991,1482.06 974.342,1472.17 976.692,1274.98 979.043,1353.52 981.393,1231.6 983.743,1527.11 986.094,1298.45 988.444,1559.57 990.795,1352.16 993.145,1473.29 995.496,1444.15 997.846,1511.26 1000.2,1573.4 1002.55,1506.36 1004.9,1596.52 1007.25,1415.77 1009.6,1566.32 1011.95,1633.66 1014.3,1220.67 1016.65,1544.13 1019,1440.97 1021.35,1742.97 1023.7,1605.93 1026.05,1377.63 1028.4,1392.36 1030.75,1562.41 1033.1,1474.11 1035.45,1420.27 1037.8,1409.33 1040.15,1301.38 1042.51,1420.11 1044.86,1371.45 1047.21,1582.45 1049.56,1528.25 1051.91,1330.6 1054.26,1556.91 1056.61,1417.32 1058.96,1345.03 1061.31,1550.75 1063.66,1488.36 1066.01,1338.1 1068.36,1507.06 1070.71,1578.16 1073.06,1585.88 1075.41,1252.57 1077.76,1487.39 1080.11,1406.85 1082.46,1329.6 1084.81,1449.49 1087.16,1514.91 1089.51,1512.06 1091.87,1374.7 1094.22,1440.45 1096.57,1211.05 1098.92,1510.39 1101.27,1597.54 1103.62,1571.29 1105.97,1511.49 1108.32,1438.21 1110.67,1356.55 1113.02,1656.45 1115.37,1319.33 1117.72,1525.38 1120.07,1262.54 1122.42,1419.77 1124.77,1481.85 1127.12,1262.75 1129.47,1479.71 1131.82,1354.37 1134.17,1431.86 1136.52,1544.03 1138.87,1583.03 1141.23,1543.81 1143.58,1529.32 1145.93,1522.68 1148.28,1366.99 1150.63,1558.88 1152.98,1285 1155.33,1397.59 1157.68,1267.55 1160.03,1513.47 1162.38,1541.62 1164.73,1556.47 1167.08,1437.19 1169.43,1412.1 1171.78,1366.87 1174.13,1301.56 1176.48,1458.37 1178.83,1459.75 1181.18,1330.84 1183.53,1622.62 1185.88,1612.01 1188.23,1471.74 1190.59,1297.56 1192.94,1549 1195.29,1326.59 1197.64,1377.42 1199.99,1422.02 1202.34,1419.48 1204.69,1670.52 1207.04,1481.45 1209.39,1651.18 1211.74,1430.3 1214.09,1270.26 1216.44,1643.22 1218.79,1641.03 1221.14,1433.66 1223.49,1437.25 1225.84,1494.84 1228.19,1465.14 1230.54,1287.64 1232.89,1475.05 1235.24,1588.04 1237.59,1346.1 1239.94,1646.93 1242.3,1499.72 1244.65,1319.22 1247,1455.68 1249.35,1354.7 1251.7,1351.55 1254.05,1451.8 1256.4,1541.77 1258.75,1373.11 1261.1,1449.88 1263.45,1327.26 1265.8,1614.68 1268.15,1517.6 1270.5,1706.48 1272.85,1414.46 1275.2,1395.86 1277.55,1317.05 1279.9,1465.79 1282.25,1432.55 1284.6,1252.91 1286.95,1581.64 1289.3,1261.87 1291.66,1503.79 1294.01,1379.08 1296.36,1536.08 1298.71,1519.36 1301.06,1601.13 1303.41,1370.34 1305.76,1429.83 1308.11,1406.5 1310.46,1546.41 1312.81,1474.24 1315.16,1489.55 1317.51,1463.02 1319.86,1618.29 1322.21,1387.55 1324.56,1428.41 1326.91,1557.89 1329.26,1410.99 1331.61,1607.7 1333.96,1522.24 1336.31,1378.07 1338.66,1321.84 1341.02,1439.23 1343.37,1426.15 1345.72,1570.71 1348.07,1359.15 1350.42,1571.82 1352.77,1481.96 1355.12,1431.49 1357.47,1634.01 1359.82,1359.89 1362.17,1361.79 1364.52,1537.18 1366.87,1544.13 1369.22,1452.79 1371.57,1620.12 1373.92,1722.74 1376.27,1538.6 1378.62,1534.09 1380.97,1276.73 1383.32,1393.52 1385.67,1426.12 1388.02,1627.69 1390.38,1675.05 1392.73,1484.25 1395.08,1485.85 1397.43,1304.11 1399.78,1600.61 1402.13,1381.29 1404.48,1414.88 1406.83,1617.04 1409.18,1141.73 1411.53,1646.74 1413.88,1425.27 1416.23,1521.62 1418.58,1419.84 1420.93,1633.43 1423.28,1544.28 1425.63,1385.19 1427.98,1271.78 1430.33,1353.96 1432.68,1678.1 1435.03,1427.35 1437.38,1629.08 1439.74,1502.28 1442.09,1579.32 1444.44,1348.35 1446.79,1458.31 1449.14,1386.73 1451.49,1577.95 1453.84,1553.41 1456.19,1416 1458.54,1536.45 1460.89,1579.14 1463.24,1421.71 1465.59,1441.1 1467.94,1360.4 1470.29,1378.78 1472.64,1421.27 1474.99,1468.48 1477.34,1502.59 1479.69,1487.22 1482.04,1355.41 1484.39,1465 1486.74,1600.81 1489.1,1337.68 1491.45,1507.82 1493.8,1538.85 1496.15,1398.7 1498.5,1524.32 1500.85,1490.85 1503.2,1340.88 1505.55,1329.14 1507.9,1310.15 1510.25,1436.98 1512.6,1502.49 1514.95,1520.48 1517.3,1568.86 1519.65,1472.95 1522,1478.08 1524.35,1524.68 1526.7,1397.82 1529.05,1430.44 1531.4,1504.28 1533.75,1318.51 1536.1,1398.25 1538.45,1290.44 1540.81,1363.66 1543.16,1299.26 1545.51,1388.81 1547.86,1338.39 1550.21,1428.66 1552.56,1418.31 1554.91,1515.21 1557.26,1382.18 1559.61,1497.84 1561.96,1214.61 1564.31,1439.13 1566.66,1536.26 1569.01,1545.64 1571.36,1294.75 1573.71,1575.79 1576.06,1521.53 1578.41,1291.13 1580.76,1371.84 1583.11,1522.49 1585.46,1449.3 1587.81,1432.89 1590.17,1339.05 1592.52,1365.77 1594.87,1503.15 1597.22,1446.64 1599.57,1532.21 1601.92,1377.66 1604.27,1556.13 1606.62,1640.38 1608.97,1410.99 1611.32,1356.15 1613.67,1495.19 1616.02,1466.29 1618.37,1403.77 1620.72,1477.55 1623.07,1429.33 1625.42,1452.09 1627.77,1449.12 1630.12,1499.4 1632.47,1396.51 1634.82,1469.21 1637.17,1524.02 1639.53,1579.34 1641.88,1477.41 1644.23,1435.56 1646.58,1516.94 1648.93,1278.9 1651.28,1450.74 1653.63,1513.19 1655.98,1233.37 1658.33,1218.31 1660.68,1491.24 1663.03,1283.42 1665.38,1541.6 1667.73,1449.96 1670.08,1573.32 1672.43,1328.06 1674.78,1365.2 1677.13,1367.23 1679.48,1464.24 1681.83,1438.34 1684.18,1449.36 1686.53,1438.01 1688.89,1552.65 1691.24,1316.01 1693.59,1516.99 1695.94,1539.42 1698.29,1608.28 1700.64,1490.53 1702.99,1439.08 1705.34,1532.92 1707.69,1450.87 1710.04,1359.94 1712.39,1436.44 1714.74,1495.81 1717.09,1515.95 1719.44,1412.47 1721.79,1598.64 1724.14,1424.04 1726.49,1611.55 1728.84,1405.62 1731.19,1421.72 1733.54,1475.08 1735.89,1521.55 1738.25,1496.88 1740.6,1392.56 1742.95,1374.43 1745.3,1529.97 1747.65,1482.67 1750,1583.7 1752.35,1287.56 1754.7,1360.85 1757.05,1460.61 1759.4,1391.24 1761.75,1410.01 1764.1,1448.39 1766.45,1338.31 1768.8,1390.12 1771.15,1248.04 1773.5,1419.85 1775.85,1430.96 1778.2,1469.73 1780.55,1531.87 1782.9,1553.23 1785.25,1423.47 1787.6,1604.03 1789.96,1484.67 1792.31,1464.69 1794.66,1511.51 1797.01,1326.37 1799.36,1373.87 1801.71,1300.4 1804.06,1337.32 1806.41,1384.1 1808.76,1397.75 1811.11,1492.15 1813.46,1411.94 1815.81,1462.38 1818.16,1362.08 1820.51,1522.59 1822.86,1490.29 1825.21,1503.16 1827.56,1289.08 1829.91,1276.12 1832.26,1554 1834.61,1419.51 1836.96,1569.88 1839.32,1580.46 1841.67,1564.34 1844.02,1632.65 1846.37,1459.27 1848.72,1472.08 1851.07,1594.3 1853.42,1500.54 1855.77,1507.4 1858.12,1497.29 1860.47,1597.79 1862.82,1564.18 1865.17,1521.25 1867.52,1498.05 1869.87,1664.11 1872.22,1522.08 1874.57,1342.28 1876.92,1494.74 1879.27,1365.85 1881.62,1204.93 1883.97,1479.43 1886.32,1511.89 1888.68,1551.95 1891.03,1402.03 1893.38,1505.16 1895.73,1333.19 1898.08,1277.75 1900.43,1651.54 1902.78,1431.79 1905.13,1500.35 1907.48,1458.02 1909.83,1440.48 1912.18,1457.74 1914.53,1355.25 1916.88,1350.57 1919.23,1419.26 1921.58,1282.49 1923.93,1330.63 1926.28,1461.51 1928.63,1350.54 1930.98,1357.88 1933.33,1490.06 1935.68,1387.52 1938.04,1369.12 1940.39,1624.88 1942.74,1545.54 1945.09,1358.9 1947.44,1394.95 1949.79,1417.52 1952.14,1425.57 1954.49,1596.78 1956.84,1533.71 1959.19,1540.7 1961.54,1448.28 1963.89,1556.48 1966.24,1301.57 1968.59,1424.03 1970.94,1496.12 1973.29,1398.49 1975.64,1219.02 1977.99,1435.85 1980.34,1522.35 1982.69,1315.76 1985.04,1419.85 1987.4,1402.49 1989.75,1369.07 1992.1,1371.46 1994.45,1408.93 1996.8,1574.86 1999.15,1353.91 2001.5,1471.6 2003.85,1544.06 2006.2,1444.07 2008.55,1477.89 2010.9,1697.26 2013.25,1557.22 2015.6,1512.58 2017.95,1595.14 2020.3,1644.3 2022.65,1451.69 2025,1689.58 2027.35,1341.91 2029.7,1352.75 2032.05,1235.63 2034.4,1492.14 2036.76,1466.15 2039.11,1539.32 2041.46,1454.27 2043.81,1382.45 2046.16,1436.47 2048.51,1490.97 2050.86,1356.87 2053.21,1363.57 2055.56,1406.52 2057.91,1477.36 2060.26,1402.6 2062.61,1573.47 2064.96,1333.03 2067.31,1456.87 2069.66,1388.63 2072.01,1563.26 2074.36,1720.72 2076.71,1472 2079.06,1598.16 2081.41,1260.26 2083.76,1418.84 2086.11,1236.1 2088.47,1431.56 2090.82,1337.74 2093.17,1457.19 2095.52,1613.91 2097.87,1394.9 2100.22,1487.01 2102.57,1608.31 2104.92,1676.46 2107.27,1407.38 2109.62,1285.75 2111.97,1528.53 2114.32,1431.81 2116.67,1456.26 2119.02,1325.02 2121.37,1373.57 2123.72,1434.35 2126.07,1615.8 2128.42,1414.4 2130.77,1566.32 2133.12,1508.64 2135.47,1382.91 2137.83,1391.05 2140.18,1356.96 2142.53,1276.08 2144.88,1306.19 2147.23,1433.64 2149.58,1489.73 2151.93,1329.58 2154.28,1599.91 2156.63,1335.77 2158.98,1435.87 2161.33,1538.88 2163.68,1661.82 2166.03,1693.04 2168.38,1394.58 2170.73,1407.62 2173.08,1339.13 2175.43,1286.69 2177.78,1408.74 2180.13,1363.78 2182.48,1422.93 2184.83,1378.28 2187.19,1510.4 2189.54,1518.8 2191.89,1496.53 2194.24,1400.13 2196.59,1599.81 2198.94,1532.14 2201.29,1366.3 2203.64,1424.34 2205.99,1461.9 2208.34,1433.47 2210.69,1447.35 2213.04,1418.44 2215.39,1409.98 2217.74,1585.24 2220.09,1414.3 2222.44,1558.42 2224.79,1446.59 2227.14,1498.78 2229.49,1529.39 2231.84,1475.08 2234.19,1536 2236.55,1591.83 2238.9,1550.13 2241.25,1460.15 2243.6,1359.83 2245.95,1331.45 2248.3,1460.15 2250.65,1581.53 2253,1524.67 2255.35,1420.93 2257.7,1455.09 2260.05,1638.86 2262.4,1521.06 2264.75,1468.2 2267.1,1439.98 2269.45,1362.96 2271.8,1502.31 2274.15,1368.62 2276.5,1365.21 2278.85,1695.6 2281.2,1503.96 2283.55,1508.14 2285.91,1458.47 2288.26,1357.14 2290.61,1535.39 2292.96,1225.86 2295.31,1294.7 2297.66,1244.05 2300.01,1367.22 2302.36,1617.66 2304.71,1445.51 2307.06,1659.9 2309.41,1406.01 2311.76,1357.66 2314.11,1500.24 2316.46,1524.02 2318.81,1388.22 2321.16,1379.31 2323.51,1681.01 2325.86,1515.05 2328.21,1411.53 2330.56,1543.25 2332.91,1260.97 2335.27,1582.59 2337.62,1751.15 2339.97,1400.29 2342.32,1477.64 2344.67,1667.16 2347.02,1546.64 2349.37,1408.64 2351.72,1560.07 2354.07,1394.49 2356.42,1240.38 2358.77,1475.35 2361.12,1370.82 2363.47,1516.95 2365.82,1541.15 2368.17,1416.75 2370.52,1354.73 2372.87,1248.05 2375.22,1430.33 2377.57,1515.17 2379.92,1445.89 2382.27,1462.13 2384.62,1315.82 2386.98,1445.06 2389.33,1406.03 2391.68,1676.32 2394.03,1260.09 2396.38,1374.72 2398.73,1385.36 2401.08,1476.77 2403.43,1296.71 2405.78,1465.7 2408.13,1414.51 2410.48,1555.68 2412.83,1508.84 2415.18,1504.79 2417.53,1338.93 2419.88,1653.48 2422.23,1336.65 2424.58,1388.5 2426.93,1401.67 2429.28,1302.78 2431.63,1331.77 2433.98,1537.76 2436.34,1344.69 2438.69,1494.51 2441.04,1514.57 2443.39,1482.63 2445.74,1262.97 2448.09,1438.67 2450.44,1415.61 2452.79,1417.83 2455.14,1404.66 2457.49,1642.26 2459.84,1456.74 2462.19,1358.31 2464.54,1344.04 2466.89,1483.28 2469.24,1269.15 2471.59,1508.02 2473.94,1266.93 2476.29,1406.01 2478.64,1487.71 2480.99,1492.42 2483.34,1629.2 2485.7,1601.78 2488.05,1613.15 2490.4,1585.45 2492.75,1234.74 2495.1,1550.7 2497.45,1354.46 2499.8,1436.54 2502.15,1379.95 2504.5,1460.44 2506.85,1453.95 2509.2,1465.56 2511.55,1440.79 2513.9,1539.99 2516.25,1625.01 2518.6,1458.7 2520.95,1535.85 2523.3,1367.92 2525.65,1428.81 2528,1474.42 2530.35,1413.17 2532.7,1452.16 2535.06,1404.58 2537.41,1428.56 2539.76,1302.2 2542.11,1534.39 2544.46,1359.76 2546.81,1473.63 2549.16,1552.98 2551.51,1567.09 2553.86,1452.06 2556.21,1488.13 2558.56,1564.69 2560.91,1289.24 2563.26,1540.74 2565.61,1435.67 2567.96,1369.3 2570.31,1558.7 "></polyline>
<polyline clip-path="url(#clip552)" style="stroke:#e26f46; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,984.568 224.541,1002.81 226.891,876.176 229.242,865.11 231.592,954.4 233.943,1012.26 236.293,867.589 238.644,838.956 240.994,962.171 243.345,1019.54 245.695,917.063 248.046,1116.81 250.396,896.471 252.747,1051.21 255.097,1050.46 257.448,909.23 259.798,955.974 262.148,918.174 264.499,791.029 266.849,1024.76 269.2,955.738 271.55,634.36 273.901,922.793 276.251,999.988 278.602,837.802 280.952,934.459 283.303,946.548 285.653,1125.31 288.004,648.698 290.354,829.353 292.705,940.957 295.055,1127.86 297.406,845.659 299.756,1051.47 302.107,1073.8 304.457,948.025 306.807,682.966 309.158,1011.12 311.508,1042.73 313.859,815.638 316.209,1028.79 318.56,673.38 320.91,1081.99 323.261,898.072 325.611,1050.52 327.962,957.94 330.312,1112.38 332.663,861.179 335.013,931.259 337.364,999.335 339.714,782.126 342.065,945.803 344.415,996.861 346.765,1053.99 349.116,899.163 351.466,1008.9 353.817,756.004 356.167,879.96 358.518,1039.71 360.868,880.948 363.219,1187.98 365.569,1018.91 367.92,1067.84 370.27,810.224 372.621,988.411 374.971,935.496 377.322,1099.44 379.672,946.6 382.023,1007.52 384.373,1238.75 386.724,954.394 389.074,918.994 391.424,999.278 393.775,1064.21 396.125,932.109 398.476,1028.69 400.826,927.075 403.177,808.186 405.527,855.728 407.878,899.56 410.228,1131.46 412.579,1074.09 414.929,1078.2 417.28,765.437 419.63,1116 421.981,965.31 424.331,925.019 426.682,982.134 429.032,984.682 431.382,981.254 433.733,1079.32 436.083,828.467 438.434,1151.63 440.784,825.528 443.135,1112.21 445.485,858.875 447.836,1073.69 450.186,946.386 452.537,978.286 454.887,973.611 457.238,1019.07 459.588,1046.36 461.939,949.093 464.289,852.579 466.64,1062.73 468.99,1059.64 471.341,884.355 473.691,1072.08 476.041,891.35 478.392,727.599 480.742,937.896 483.093,941.918 485.443,879.96 487.794,745.477 490.144,948.547 492.495,1083.11 494.845,747.769 497.196,787.848 499.546,961.639 501.897,1013.87 504.247,960.513 506.598,1106.97 508.948,1059.29 511.299,959.923 513.649,813.394 515.999,828.37 518.35,1038.28 520.7,961.473 523.051,783.875 525.401,1034.74 527.752,848.271 530.102,1250.12 532.453,1107.68 534.803,887.873 537.154,999.375 539.504,1002.53 541.855,1010.59 544.205,929.973 546.556,820.443 548.906,909.307 551.257,874.333 553.607,898.807 555.958,843.468 558.308,1014.95 560.658,1036.6 563.009,925.822 565.359,1129.06 567.71,935.735 570.06,873.853 572.411,881.925 574.761,960.672 577.112,840.249 579.462,1093.33 581.813,765.055 584.163,753.32 586.514,1017.17 588.864,894.701 591.215,965.255 593.565,1017.8 595.916,949.196 598.266,1022.58 600.616,761.184 602.967,866.857 605.317,948.658 607.668,1050.44 610.018,1112.42 612.369,939.553 614.719,912.869 617.07,1020.85 619.42,1129.19 621.771,1178.44 624.121,1098.3 626.472,1016.08 628.822,859.367 631.173,1040.61 633.523,913.282 635.874,902.909 638.224,948.36 640.575,968.688 642.925,930.459 645.275,896.13 647.626,992.1 649.976,1109.08 652.327,901.215 654.677,874.047 657.028,1106.1 659.378,963.193 661.729,1001.88 664.079,1104.94 666.43,910.466 668.78,1152.98 671.131,790.914 673.481,1008.35 675.832,961.919 678.182,873.03 680.533,818.802 682.883,853.25 685.233,1009.19 687.584,949.913 689.934,1078.83 692.285,961.127 694.635,790.981 696.986,937.865 699.336,746.176 701.687,851.471 704.037,1041.5 706.388,795.404 708.738,939.77 711.089,1138.4 713.439,985.58 715.79,945.091 718.14,865.379 720.491,965.127 722.841,945.435 725.192,1060.47 727.542,797.427 729.892,948.133 732.243,933.683 734.593,947.955 736.944,941.163 739.294,989.865 741.645,888.499 743.995,915.408 746.346,963.649 748.696,981.343 751.047,1060.58 753.397,1122.8 755.748,990.9 758.098,845.282 760.449,922.589 762.799,922.03 765.15,885.908 767.5,1028.93 769.85,962.954 772.201,1031.89 774.551,820.084 776.902,994.066 779.252,774.945 781.603,1234.58 783.953,970.488 786.304,865.333 788.654,940.663 791.005,960.106 793.355,942.728 795.706,1124.08 798.056,917.132 800.407,897.324 802.757,744.523 805.108,951.432 807.458,924.19 809.809,916.862 812.159,715.685 814.509,907.546 816.86,940.595 819.21,969.847 821.561,1071.58 823.911,962.848 826.262,1083.86 828.612,843.746 830.963,923.24 833.313,905.126 835.664,902.424 838.014,781.723 840.365,870.037 842.715,1033.01 845.066,1010.55 847.416,922.361 849.767,855.891 852.117,951.387 854.467,951.025 856.818,926.655 859.168,869.588 861.519,1138.79 863.869,1093.14 866.22,869.364 868.57,946.461 870.921,978.147 873.271,1163.62 875.622,738.164 877.972,989.048 880.323,886.025 882.673,945.514 885.024,829.197 887.374,964.521 889.725,929.113 892.075,1040.56 894.426,1203.57 896.776,955.588 899.126,1064.34 901.477,818.718 903.827,1060.09 906.178,832.257 908.528,1096.02 910.879,1006.56 913.229,977.402 915.58,1137.42 917.93,881.65 920.281,938.969 922.631,891.346 924.982,859.904 927.332,799.925 929.683,1126.45 932.033,1020.1 934.384,837.557 936.734,1132.98 939.084,973.335 941.435,1087.17 943.785,965.892 946.136,924.521 948.486,979.276 950.837,892.171 953.187,1018.08 955.538,1034.96 957.888,1055.2 960.239,854.969 962.589,1018.58 964.94,928.791 967.29,948.05 969.641,840.615 971.991,970.346 974.342,841.286 976.692,943.614 979.043,805.352 981.393,1192.38 983.743,876.886 986.094,966.025 988.444,863.896 990.795,1037.26 993.145,907.484 995.496,855.955 997.846,1087.84 1000.2,959.992 1002.55,910.928 1004.9,927.401 1007.25,894.296 1009.6,749.186 1011.95,1046.46 1014.3,1148.11 1016.65,980.938 1019,850.66 1021.35,1046.24 1023.7,974.24 1026.05,1085.88 1028.4,853.652 1030.75,859.226 1033.1,834.297 1035.45,922.724 1037.8,1060.14 1040.15,1272.49 1042.51,904.821 1044.86,905.156 1047.21,885.94 1049.56,810.288 1051.91,902.558 1054.26,1164.62 1056.61,986.256 1058.96,888.938 1061.31,982.366 1063.66,790.877 1066.01,844.064 1068.36,1057.21 1070.71,904.746 1073.06,1005.85 1075.41,941.325 1077.76,804.761 1080.11,997.735 1082.46,970.63 1084.81,937.371 1087.16,1041.52 1089.51,753.194 1091.87,1027.86 1094.22,965.626 1096.57,924.014 1098.92,926.835 1101.27,767.996 1103.62,975.03 1105.97,989.516 1108.32,962.468 1110.67,844.314 1113.02,754.972 1115.37,999.701 1117.72,857.28 1120.07,1026.2 1122.42,996.674 1124.77,1077.89 1127.12,726.012 1129.47,824.365 1131.82,1012.63 1134.17,1009.15 1136.52,1008.13 1138.87,866.534 1141.23,1089.75 1143.58,909.63 1145.93,1100.63 1148.28,1049.92 1150.63,790.362 1152.98,1037.94 1155.33,1087.05 1157.68,867.727 1160.03,927.28 1162.38,923.361 1164.73,1000.56 1167.08,921.195 1169.43,1072.29 1171.78,1010.15 1174.13,884.656 1176.48,1109.83 1178.83,1023.15 1181.18,897.02 1183.53,871.222 1185.88,918.366 1188.23,989.285 1190.59,774.692 1192.94,954.938 1195.29,903.741 1197.64,1017.61 1199.99,1087.51 1202.34,1006.28 1204.69,1106.1 1207.04,995.062 1209.39,870.713 1211.74,934.08 1214.09,1090.8 1216.44,910.431 1218.79,1024.69 1221.14,891.933 1223.49,759.669 1225.84,983.751 1228.19,1031.49 1230.54,965.276 1232.89,792.139 1235.24,897.155 1237.59,902.497 1239.94,924.3 1242.3,783.143 1244.65,890.408 1247,880.583 1249.35,835.803 1251.7,1024.94 1254.05,1060.86 1256.4,1019.61 1258.75,1064.8 1261.1,908.435 1263.45,947.749 1265.8,1057.63 1268.15,859.863 1270.5,1063.51 1272.85,949.962 1275.2,944.679 1277.55,1040.87 1279.9,1030.08 1282.25,977.035 1284.6,818.897 1286.95,1027.06 1289.3,960.606 1291.66,873.639 1294.01,965.98 1296.36,940.3 1298.71,926.621 1301.06,895.413 1303.41,980.564 1305.76,888.571 1308.11,832.259 1310.46,1028.23 1312.81,941.477 1315.16,985.597 1317.51,1029.03 1319.86,936.657 1322.21,921.235 1324.56,913.536 1326.91,958.562 1329.26,924.872 1331.61,977.939 1333.96,860.456 1336.31,1030.7 1338.66,838.068 1341.02,913.234 1343.37,917.653 1345.72,947.938 1348.07,995.159 1350.42,999.738 1352.77,1235.37 1355.12,1034.41 1357.47,851.151 1359.82,766.056 1362.17,1055.04 1364.52,967.846 1366.87,1073.91 1369.22,738.688 1371.57,929.908 1373.92,1122.47 1376.27,805.866 1378.62,968.993 1380.97,821.138 1383.32,1065.04 1385.67,972.933 1388.02,1027.74 1390.38,892.822 1392.73,950.82 1395.08,748.795 1397.43,745.205 1399.78,1033.81 1402.13,945.511 1404.48,1023.55 1406.83,801.39 1409.18,752.492 1411.53,844.146 1413.88,1019.85 1416.23,850.965 1418.58,1127.51 1420.93,1018.58 1423.28,967.954 1425.63,1102.83 1427.98,1087.15 1430.33,1095.46 1432.68,905.341 1435.03,1088.99 1437.38,1100.94 1439.74,689.426 1442.09,867.831 1444.44,828.208 1446.79,725.798 1449.14,979.631 1451.49,1130.14 1453.84,835.263 1456.19,1042.3 1458.54,902.489 1460.89,827.481 1463.24,1037.88 1465.59,844.324 1467.94,1013.81 1470.29,886.568 1472.64,1083.48 1474.99,1156.92 1477.34,946.153 1479.69,891.686 1482.04,931.424 1484.39,1004.43 1486.74,950.085 1489.1,1092.98 1491.45,843.78 1493.8,1072.6 1496.15,741.166 1498.5,979.942 1500.85,1067.99 1503.2,998.926 1505.55,1042.95 1507.9,1072.11 1510.25,973.743 1512.6,915.839 1514.95,998.295 1517.3,1018.46 1519.65,1060.04 1522,813.618 1524.35,852.02 1526.7,753.147 1529.05,899.884 1531.4,821.287 1533.75,853.963 1536.1,978.636 1538.45,1016.28 1540.81,778.436 1543.16,1064.59 1545.51,909.913 1547.86,884.017 1550.21,1089.87 1552.56,1011.65 1554.91,981.898 1557.26,1084.9 1559.61,821.587 1561.96,942.72 1564.31,919.978 1566.66,830.949 1569.01,838.323 1571.36,870.363 1573.71,1014.34 1576.06,996.022 1578.41,797.772 1580.76,1046.31 1583.11,911.357 1585.46,1027.93 1587.81,705.482 1590.17,874.825 1592.52,898.302 1594.87,1036.49 1597.22,969.449 1599.57,551.575 1601.92,968.773 1604.27,1070.78 1606.62,988.918 1608.97,969.444 1611.32,916.584 1613.67,948.74 1616.02,896.754 1618.37,707.099 1620.72,816.889 1623.07,1006.98 1625.42,1056.08 1627.77,995.984 1630.12,1017.25 1632.47,927.939 1634.82,886.642 1637.17,1182.65 1639.53,1095.87 1641.88,854.684 1644.23,1040.8 1646.58,917.465 1648.93,967.737 1651.28,744.628 1653.63,947.835 1655.98,829.154 1658.33,1015.16 1660.68,996.201 1663.03,893.688 1665.38,935.212 1667.73,923.688 1670.08,1051.01 1672.43,958.876 1674.78,1095.18 1677.13,938.301 1679.48,961.199 1681.83,929.165 1684.18,1143.11 1686.53,1058.9 1688.89,949.861 1691.24,835.222 1693.59,885.728 1695.94,1026.19 1698.29,870.245 1700.64,914.235 1702.99,836.261 1705.34,796.087 1707.69,1002.06 1710.04,834.316 1712.39,1074.25 1714.74,1026.16 1717.09,1021.56 1719.44,1036.4 1721.79,727.945 1724.14,833.506 1726.49,1048.23 1728.84,1037.64 1731.19,974.88 1733.54,834.044 1735.89,1133.65 1738.25,937.189 1740.6,865.854 1742.95,1020.15 1745.3,869.237 1747.65,787.645 1750,1118.66 1752.35,914.576 1754.7,1046.88 1757.05,980.082 1759.4,988.365 1761.75,1045.22 1764.1,1191.99 1766.45,845.501 1768.8,822.685 1771.15,976.1 1773.5,971.076 1775.85,1003.38 1778.2,939.735 1780.55,842.057 1782.9,815.634 1785.25,1152.89 1787.6,952.875 1789.96,843.593 1792.31,987.226 1794.66,955.07 1797.01,937.888 1799.36,685.68 1801.71,809.619 1804.06,1023.12 1806.41,914.1 1808.76,976.935 1811.11,963.709 1813.46,960.779 1815.81,984.117 1818.16,982.365 1820.51,960.988 1822.86,966.952 1825.21,919.155 1827.56,942.505 1829.91,791.238 1832.26,1095.48 1834.61,930.009 1836.96,1115.29 1839.32,912.482 1841.67,828.277 1844.02,1118.33 1846.37,815.268 1848.72,978.097 1851.07,1199.77 1853.42,895.271 1855.77,965.155 1858.12,971.546 1860.47,993.079 1862.82,1101.18 1865.17,729.159 1867.52,997.21 1869.87,1005.55 1872.22,1062.6 1874.57,1106.53 1876.92,1079 1879.27,683.526 1881.62,883.576 1883.97,871.11 1886.32,914.218 1888.68,1068.31 1891.03,1023.98 1893.38,825.538 1895.73,1090.56 1898.08,897.045 1900.43,873.587 1902.78,1018.37 1905.13,897.1 1907.48,949.548 1909.83,974.603 1912.18,798.798 1914.53,954.811 1916.88,1026.85 1919.23,978.147 1921.58,1113.44 1923.93,861.056 1926.28,1023.99 1928.63,1034.67 1930.98,896.574 1933.33,782.135 1935.68,1070.27 1938.04,937.129 1940.39,819.301 1942.74,965.991 1945.09,1089.05 1947.44,903.73 1949.79,892.759 1952.14,832.803 1954.49,1007.9 1956.84,900.266 1959.19,971 1961.54,962.345 1963.89,863.789 1966.24,960.878 1968.59,995.027 1970.94,891.082 1973.29,922.125 1975.64,890.624 1977.99,1052.6 1980.34,695.152 1982.69,1129.09 1985.04,894.951 1987.4,838.319 1989.75,940.34 1992.1,1003.05 1994.45,1022.68 1996.8,1100.7 1999.15,832.336 2001.5,1049.66 2003.85,673.799 2006.2,814.534 2008.55,895.678 2010.9,945.002 2013.25,891.967 2015.6,910.66 2017.95,928.275 2020.3,840.361 2022.65,869.053 2025,917.165 2027.35,799.131 2029.7,922.132 2032.05,990.433 2034.4,640.906 2036.76,906.399 2039.11,1160.83 2041.46,915.825 2043.81,948.207 2046.16,1109.82 2048.51,915.325 2050.86,973.269 2053.21,978.549 2055.56,1006.96 2057.91,937.45 2060.26,1024.06 2062.61,906.902 2064.96,987.094 2067.31,1148.54 2069.66,985.265 2072.01,939.613 2074.36,913.919 2076.71,1029.56 2079.06,873.764 2081.41,755.029 2083.76,1005.09 2086.11,1095.78 2088.47,914.44 2090.82,903.902 2093.17,966.108 2095.52,845.77 2097.87,978.824 2100.22,955.834 2102.57,1007.87 2104.92,772.981 2107.27,969.455 2109.62,995.697 2111.97,980.69 2114.32,1017.3 2116.67,954.69 2119.02,961.964 2121.37,991.088 2123.72,912.966 2126.07,946.7 2128.42,847.664 2130.77,960.379 2133.12,991.956 2135.47,960.254 2137.83,933.241 2140.18,1014.12 2142.53,883.372 2144.88,987.211 2147.23,790.87 2149.58,931.815 2151.93,798.302 2154.28,924.556 2156.63,1018.93 2158.98,823.476 2161.33,949.974 2163.68,1164.57 2166.03,849.101 2168.38,987.654 2170.73,933.544 2173.08,875.239 2175.43,1069.38 2177.78,889.927 2180.13,953.589 2182.48,847.021 2184.83,718.363 2187.19,1193.25 2189.54,864.105 2191.89,900.627 2194.24,758.437 2196.59,1028.58 2198.94,842.899 2201.29,1070.86 2203.64,880.028 2205.99,922.305 2208.34,1071.68 2210.69,903.291 2213.04,1077.12 2215.39,1134.3 2217.74,1016.13 2220.09,944.276 2222.44,930.2 2224.79,940.382 2227.14,795.769 2229.49,906.255 2231.84,946.474 2234.19,645.82 2236.55,951.74 2238.9,972.713 2241.25,797.892 2243.6,981.667 2245.95,872.559 2248.3,850.098 2250.65,785.198 2253,1046.39 2255.35,987.486 2257.7,891.815 2260.05,924.639 2262.4,1061.9 2264.75,922.953 2267.1,893.227 2269.45,1009.56 2271.8,933.897 2274.15,734.414 2276.5,759.135 2278.85,873.099 2281.2,909.95 2283.55,1245.99 2285.91,805.73 2288.26,861.237 2290.61,920.664 2292.96,1034.13 2295.31,1005.58 2297.66,964.712 2300.01,832.006 2302.36,1053.91 2304.71,963.495 2307.06,680.199 2309.41,769.016 2311.76,1037.49 2314.11,1019.02 2316.46,856.537 2318.81,993.136 2321.16,1131.69 2323.51,958.931 2325.86,966.631 2328.21,890.057 2330.56,936.039 2332.91,1044 2335.27,953.61 2337.62,895.217 2339.97,806.532 2342.32,983.057 2344.67,959.308 2347.02,921.377 2349.37,944.045 2351.72,955.917 2354.07,938.632 2356.42,1056.6 2358.77,943.808 2361.12,827.59 2363.47,991.084 2365.82,940.277 2368.17,892.354 2370.52,989.583 2372.87,786.557 2375.22,1000.38 2377.57,924.681 2379.92,841.083 2382.27,921.682 2384.62,989.874 2386.98,1050.67 2389.33,1071.42 2391.68,966.309 2394.03,773.354 2396.38,1038.69 2398.73,1112.55 2401.08,993.471 2403.43,1118.94 2405.78,807.685 2408.13,976.404 2410.48,953.266 2412.83,1010.71 2415.18,918.766 2417.53,802.868 2419.88,970.337 2422.23,860.153 2424.58,810.327 2426.93,1000.8 2429.28,991.606 2431.63,1126.09 2433.98,945.245 2436.34,1165.38 2438.69,999.84 2441.04,957.805 2443.39,899.134 2445.74,972.503 2448.09,982.37 2450.44,946.986 2452.79,860.992 2455.14,863.745 2457.49,846.725 2459.84,831.882 2462.19,1045.47 2464.54,833.906 2466.89,800.797 2469.24,985.828 2471.59,948.048 2473.94,858.907 2476.29,941.937 2478.64,1042.74 2480.99,836.127 2483.34,1078.02 2485.7,975.873 2488.05,858.779 2490.4,1060.38 2492.75,843.345 2495.1,973.18 2497.45,1077.43 2499.8,1078.31 2502.15,867.117 2504.5,826.686 2506.85,919.583 2509.2,837.261 2511.55,976.175 2513.9,934.476 2516.25,841.233 2518.6,887.23 2520.95,1035.57 2523.3,860.447 2525.65,966.656 2528,1031.31 2530.35,872.582 2532.7,956.763 2535.06,965.552 2537.41,981.506 2539.76,1071.98 2542.11,876.593 2544.46,1141.63 2546.81,830.574 2549.16,850.843 2551.51,835.818 2553.86,911.021 2556.21,982.73 2558.56,817.603 2560.91,774.166 2563.26,941.208 2565.61,1081.29 2567.96,1001.78 2570.31,1030.76 "></polyline>
<polyline clip-path="url(#clip552)" style="stroke:#3da44d; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,620.882 224.541,456.638 226.891,155.254 229.242,544.884 231.592,452.214 233.943,637.55 236.293,283.664 238.644,615.848 240.994,460.282 243.345,452.702 245.695,435.58 248.046,275.727 250.396,599.757 252.747,408.991 255.097,473.618 257.448,548.219 259.798,514.276 262.148,371.217 264.499,614.618 266.849,595.911 269.2,355.046 271.55,608.745 273.901,269.211 276.251,544.019 278.602,275.274 280.952,476.416 283.303,341.968 285.653,386.63 288.004,427.735 290.354,187.6 292.705,429.451 295.055,508.496 297.406,414.448 299.756,524.907 302.107,511.06 304.457,613.699 306.807,464.136 309.158,671.991 311.508,636.479 313.859,526.679 316.209,399.122 318.56,386.874 320.91,548.411 323.261,444.255 325.611,426.354 327.962,445.823 330.312,541.154 332.663,346.002 335.013,419.235 337.364,467.21 339.714,378.924 342.065,243.189 344.415,309.315 346.765,491.675 349.116,427.539 351.466,334.353 353.817,390.82 356.167,465.942 358.518,254.042 360.868,540.808 363.219,604.766 365.569,387.313 367.92,431.002 370.27,609.682 372.621,549.422 374.971,382.4 377.322,466.683 379.672,366.825 382.023,605.351 384.373,320.845 386.724,292.35 389.074,355.783 391.424,328.288 393.775,390.825 396.125,518.529 398.476,412.878 400.826,377.341 403.177,240.62 405.527,621.34 407.878,433.274 410.228,559.48 412.579,382.081 414.929,488.986 417.28,429.605 419.63,245.905 421.981,600.491 424.331,517.675 426.682,413.121 429.032,546.56 431.382,555.992 433.733,487.404 436.083,316.487 438.434,512.442 440.784,462.313 443.135,468.596 445.485,350.973 447.836,386.823 450.186,430.843 452.537,465.076 454.887,362.494 457.238,456.548 459.588,345.155 461.939,381.457 464.289,421.73 466.64,485.889 468.99,528.968 471.341,530.813 473.691,536.749 476.041,233.745 478.392,540.02 480.742,416.744 483.093,355.94 485.443,278.181 487.794,454.038 490.144,356.404 492.495,430.52 494.845,427.649 497.196,450.005 499.546,397.045 501.897,523.571 504.247,618.818 506.598,442.533 508.948,486.639 511.299,423.271 513.649,562.8 515.999,442.565 518.35,369.298 520.7,392.653 523.051,410.767 525.401,428.596 527.752,399.092 530.102,417.282 532.453,675.448 534.803,421.809 537.154,394.865 539.504,446.613 541.855,377.832 544.205,651.644 546.556,534.039 548.906,473.258 551.257,421.379 553.607,441.893 555.958,414.159 558.308,493.43 560.658,555.334 563.009,329.809 565.359,535.205 567.71,564.779 570.06,550.329 572.411,583.338 574.761,133.012 577.112,335.923 579.462,388.101 581.813,298.851 584.163,462.533 586.514,555.215 588.864,537.707 591.215,421.921 593.565,440.376 595.916,444.946 598.266,295.408 600.616,485.438 602.967,333.2 605.317,482.313 607.668,444.023 610.018,319.755 612.369,343.493 614.719,464.686 617.07,349.846 619.42,504.57 621.771,535.239 624.121,466.059 626.472,554.516 628.822,445.721 631.173,547.823 633.523,478.89 635.874,447.26 638.224,570.277 640.575,433.948 642.925,324.571 645.275,277.398 647.626,495.468 649.976,225.555 652.327,394.099 654.677,612.808 657.028,470.999 659.378,530.01 661.729,312.495 664.079,550.161 666.43,465.876 668.78,414.527 671.131,98.7753 673.481,529.805 675.832,559.863 678.182,379.845 680.533,648.734 682.883,224.152 685.233,407.345 687.584,212.881 689.934,443.902 692.285,474.202 694.635,320.991 696.986,430.192 699.336,325.048 701.687,258.034 704.037,443.4 706.388,513.147 708.738,579.308 711.089,602.578 713.439,318.246 715.79,434.598 718.14,626.526 720.491,613.495 722.841,344.09 725.192,474.488 727.542,420.375 729.892,453.157 732.243,410.117 734.593,463.77 736.944,352.298 739.294,629.804 741.645,409.645 743.995,341.714 746.346,620.251 748.696,459.259 751.047,333.059 753.397,365.846 755.748,398.244 758.098,593.456 760.449,477.128 762.799,519.399 765.15,419.595 767.5,735.087 769.85,451.231 772.201,415.745 774.551,331.555 776.902,475.158 779.252,354.025 781.603,573.837 783.953,268.261 786.304,345.012 788.654,414.351 791.005,445.798 793.355,358.4 795.706,641.895 798.056,511.08 800.407,337.558 802.757,507.819 805.108,551.648 807.458,384.996 809.809,269.09 812.159,507.438 814.509,562.062 816.86,447.697 819.21,553.499 821.561,355.185 823.911,547.757 826.262,461.331 828.612,461.573 830.963,376.775 833.313,364.744 835.664,239.344 838.014,342.126 840.365,444.145 842.715,520.947 845.066,545.881 847.416,537.052 849.767,413.544 852.117,335.218 854.467,534.018 856.818,448.172 859.168,434.025 861.519,638.943 863.869,509.863 866.22,455.98 868.57,494.979 870.921,614.291 873.271,411.089 875.622,569.708 877.972,338.064 880.323,482.049 882.673,389.377 885.024,553.786 887.374,476.806 889.725,365.67 892.075,384.246 894.426,472.99 896.776,406.9 899.126,471.133 901.477,431.376 903.827,386.013 906.178,499.932 908.528,511.503 910.879,371.118 913.229,417.378 915.58,339.333 917.93,451.077 920.281,466.203 922.631,514.652 924.982,519.061 927.332,369.751 929.683,471.973 932.033,621.667 934.384,347.315 936.734,358.512 939.084,547.662 941.435,321.638 943.785,428.501 946.136,415.085 948.486,612.609 950.837,579.665 953.187,404.379 955.538,386.431 957.888,490.801 960.239,300.77 962.589,517.345 964.94,435.134 967.29,328.858 969.641,304.221 971.991,465.174 974.342,399.345 976.692,366.502 979.043,635.325 981.393,279.6 983.743,394.496 986.094,414.345 988.444,370.29 990.795,478.161 993.145,409.258 995.496,324.929 997.846,444.249 1000.2,556.39 1002.55,236.717 1004.9,456.606 1007.25,367.005 1009.6,323.242 1011.95,342.37 1014.3,661.34 1016.65,479.973 1019,519.083 1021.35,502.673 1023.7,400.383 1026.05,543.683 1028.4,345.117 1030.75,435.551 1033.1,290.341 1035.45,359.969 1037.8,327.666 1040.15,554.294 1042.51,595.662 1044.86,306.367 1047.21,308.678 1049.56,333.775 1051.91,471.864 1054.26,608.972 1056.61,391.489 1058.96,593.138 1061.31,499.254 1063.66,301.504 1066.01,520.113 1068.36,636.337 1070.71,504.193 1073.06,385.901 1075.41,346.511 1077.76,303.727 1080.11,348.493 1082.46,445.95 1084.81,536.884 1087.16,399.23 1089.51,349.038 1091.87,532.551 1094.22,305.539 1096.57,425.104 1098.92,465.181 1101.27,466.303 1103.62,329.448 1105.97,457.514 1108.32,494.059 1110.67,529.532 1113.02,407.483 1115.37,411.614 1117.72,420.759 1120.07,544.479 1122.42,274.621 1124.77,496.188 1127.12,386.143 1129.47,367.702 1131.82,313.448 1134.17,441.143 1136.52,674.466 1138.87,565.088 1141.23,481.212 1143.58,446.895 1145.93,451.564 1148.28,623.548 1150.63,441.024 1152.98,343.566 1155.33,381.591 1157.68,215.803 1160.03,494.351 1162.38,488.255 1164.73,291.644 1167.08,555.345 1169.43,382.853 1171.78,270.987 1174.13,504.35 1176.48,416.519 1178.83,308.824 1181.18,560.886 1183.53,505.687 1185.88,436.762 1188.23,310.869 1190.59,440.529 1192.94,515.414 1195.29,462.947 1197.64,463.057 1199.99,420.194 1202.34,435.382 1204.69,565.773 1207.04,432.208 1209.39,538.9 1211.74,457.17 1214.09,464.459 1216.44,427.443 1218.79,354.353 1221.14,348.113 1223.49,261.115 1225.84,362.392 1228.19,412.547 1230.54,495.679 1232.89,574.565 1235.24,462.148 1237.59,388.601 1239.94,374.464 1242.3,383.833 1244.65,462.457 1247,391.275 1249.35,461.497 1251.7,444.546 1254.05,480.843 1256.4,429.316 1258.75,261.124 1261.1,445.546 1263.45,270.054 1265.8,275.728 1268.15,250.608 1270.5,346.115 1272.85,444.637 1275.2,501.794 1277.55,368.861 1279.9,227.308 1282.25,435.535 1284.6,401.836 1286.95,489.484 1289.3,348.778 1291.66,549.081 1294.01,651.749 1296.36,410.655 1298.71,489.306 1301.06,224.04 1303.41,406.071 1305.76,415.607 1308.11,351.163 1310.46,474.071 1312.81,601.102 1315.16,368.975 1317.51,634.369 1319.86,489.819 1322.21,369.38 1324.56,424.059 1326.91,326.232 1329.26,209.247 1331.61,502.501 1333.96,259.169 1336.31,464.458 1338.66,386.217 1341.02,336.555 1343.37,627.773 1345.72,451.069 1348.07,560.442 1350.42,293.903 1352.77,511.16 1355.12,466.099 1357.47,311.248 1359.82,433.905 1362.17,383.451 1364.52,324.066 1366.87,343.884 1369.22,391.695 1371.57,351.867 1373.92,404.395 1376.27,531.381 1378.62,572.947 1380.97,483.284 1383.32,340.77 1385.67,470.732 1388.02,406.575 1390.38,382.989 1392.73,363.877 1395.08,442.179 1397.43,285.014 1399.78,537.56 1402.13,96.8724 1404.48,466.647 1406.83,441.926 1409.18,547.709 1411.53,544.165 1413.88,455.924 1416.23,378.946 1418.58,585.353 1420.93,402.851 1423.28,480.207 1425.63,374.046 1427.98,578.819 1430.33,451.511 1432.68,455.93 1435.03,397.446 1437.38,620.632 1439.74,266.039 1442.09,525.464 1444.44,539.767 1446.79,500.863 1449.14,633.982 1451.49,555.652 1453.84,614.946 1456.19,319.315 1458.54,323.516 1460.89,316.712 1463.24,499.358 1465.59,415.18 1467.94,413.105 1470.29,385.019 1472.64,384.308 1474.99,479.758 1477.34,550.27 1479.69,495.294 1482.04,374.165 1484.39,365.515 1486.74,565.65 1489.1,379.279 1491.45,353.023 1493.8,507.862 1496.15,462.204 1498.5,399.148 1500.85,356.806 1503.2,421.701 1505.55,468.586 1507.9,476.923 1510.25,282.677 1512.6,314.694 1514.95,429.656 1517.3,433.174 1519.65,633.271 1522,337.226 1524.35,297.152 1526.7,604.165 1529.05,400.275 1531.4,580.827 1533.75,327.721 1536.1,396.463 1538.45,412.914 1540.81,621.773 1543.16,207.472 1545.51,588.918 1547.86,446.523 1550.21,481.949 1552.56,553.837 1554.91,518.722 1557.26,475.662 1559.61,590.034 1561.96,422.111 1564.31,521.063 1566.66,512.614 1569.01,502.508 1571.36,612.568 1573.71,352.807 1576.06,481.647 1578.41,426.025 1580.76,286.551 1583.11,412.779 1585.46,600.142 1587.81,424.057 1590.17,563.514 1592.52,598.059 1594.87,466.962 1597.22,511.148 1599.57,395.844 1601.92,256.712 1604.27,534.133 1606.62,433.018 1608.97,353.573 1611.32,318.749 1613.67,228.69 1616.02,520.656 1618.37,364.992 1620.72,498.306 1623.07,543.426 1625.42,319.992 1627.77,679.918 1630.12,277.068 1632.47,446.382 1634.82,349.563 1637.17,498.434 1639.53,341.187 1641.88,558.415 1644.23,417.751 1646.58,403.516 1648.93,522.243 1651.28,403.949 1653.63,557.507 1655.98,393.364 1658.33,291.583 1660.68,397.897 1663.03,476.417 1665.38,518.452 1667.73,382.136 1670.08,540.608 1672.43,429.911 1674.78,456.62 1677.13,335.986 1679.48,483.42 1681.83,327.435 1684.18,180.548 1686.53,471.703 1688.89,404.431 1691.24,500.592 1693.59,429.29 1695.94,361.136 1698.29,578.861 1700.64,355.08 1702.99,322.189 1705.34,295.138 1707.69,308.433 1710.04,236.201 1712.39,440.696 1714.74,646.152 1717.09,327.896 1719.44,419.637 1721.79,385.114 1724.14,303.142 1726.49,501.78 1728.84,403.934 1731.19,393.15 1733.54,398.768 1735.89,537.617 1738.25,483.746 1740.6,281.666 1742.95,476.364 1745.3,365.104 1747.65,309.775 1750,273.905 1752.35,575.65 1754.7,184.178 1757.05,548.908 1759.4,370.87 1761.75,554.583 1764.1,499.021 1766.45,475.912 1768.8,458.421 1771.15,395.709 1773.5,492.679 1775.85,488.53 1778.2,493.801 1780.55,392.427 1782.9,467.69 1785.25,575.644 1787.6,352.175 1789.96,473.173 1792.31,460.304 1794.66,478.271 1797.01,532.73 1799.36,432.567 1801.71,516.192 1804.06,413.125 1806.41,398.704 1808.76,307.157 1811.11,488.264 1813.46,406.48 1815.81,546.521 1818.16,477.65 1820.51,341.648 1822.86,462.764 1825.21,466.981 1827.56,417.175 1829.91,602.517 1832.26,461.895 1834.61,495.429 1836.96,454.897 1839.32,399.667 1841.67,642.475 1844.02,588.361 1846.37,217.818 1848.72,581.899 1851.07,509.288 1853.42,426.113 1855.77,219.811 1858.12,365.152 1860.47,387.974 1862.82,438.807 1865.17,652.591 1867.52,325.56 1869.87,494.472 1872.22,363.886 1874.57,329.166 1876.92,452.689 1879.27,424.987 1881.62,455.767 1883.97,343.812 1886.32,503.829 1888.68,373.304 1891.03,520.972 1893.38,378.792 1895.73,401.058 1898.08,371.088 1900.43,496.568 1902.78,441.184 1905.13,260.76 1907.48,588.389 1909.83,586.535 1912.18,396.521 1914.53,628.677 1916.88,491.317 1919.23,451.148 1921.58,522.639 1923.93,473.19 1926.28,355.707 1928.63,394.961 1930.98,459.588 1933.33,572.49 1935.68,464.931 1938.04,406.022 1940.39,487.908 1942.74,586.983 1945.09,453.754 1947.44,526.843 1949.79,445.015 1952.14,422.249 1954.49,617.623 1956.84,230.799 1959.19,360.52 1961.54,411.24 1963.89,432.774 1966.24,245.303 1968.59,332.905 1970.94,364.213 1973.29,257.564 1975.64,360.262 1977.99,301.669 1980.34,132.855 1982.69,405.548 1985.04,402.151 1987.4,483.459 1989.75,519.977 1992.1,355.344 1994.45,327.148 1996.8,444.911 1999.15,298.264 2001.5,392.411 2003.85,507.58 2006.2,522.293 2008.55,216.7 2010.9,514.127 2013.25,430.399 2015.6,454.583 2017.95,510.842 2020.3,480.737 2022.65,615.474 2025,438.994 2027.35,471.745 2029.7,544.967 2032.05,289.75 2034.4,299.314 2036.76,442.854 2039.11,282.407 2041.46,554.491 2043.81,427.482 2046.16,446.94 2048.51,355.469 2050.86,532.689 2053.21,372.671 2055.56,421.865 2057.91,384.093 2060.26,247.217 2062.61,286.298 2064.96,433.459 2067.31,656.888 2069.66,399.68 2072.01,375.662 2074.36,408.043 2076.71,394.863 2079.06,602.348 2081.41,499.879 2083.76,427.475 2086.11,359.01 2088.47,401.828 2090.82,487.138 2093.17,336.684 2095.52,430.033 2097.87,464.502 2100.22,444.628 2102.57,350.653 2104.92,278.489 2107.27,595.489 2109.62,567.699 2111.97,460.082 2114.32,577.057 2116.67,433.731 2119.02,597.873 2121.37,491.861 2123.72,431.075 2126.07,305.67 2128.42,191.626 2130.77,486.29 2133.12,587.915 2135.47,499.026 2137.83,477.489 2140.18,347.414 2142.53,419.483 2144.88,373.494 2147.23,523.919 2149.58,431.795 2151.93,606.794 2154.28,615.106 2156.63,503.354 2158.98,456.617 2161.33,448.455 2163.68,295.435 2166.03,370.411 2168.38,321.922 2170.73,439.472 2173.08,470.539 2175.43,488.625 2177.78,301.205 2180.13,445.134 2182.48,489.702 2184.83,426.059 2187.19,501.93 2189.54,546.297 2191.89,372.189 2194.24,524.101 2196.59,515.793 2198.94,456.974 2201.29,484.656 2203.64,361.125 2205.99,330.374 2208.34,385.496 2210.69,266.58 2213.04,549.417 2215.39,426.275 2217.74,484.362 2220.09,493.947 2222.44,512.398 2224.79,319.555 2227.14,576.467 2229.49,368.86 2231.84,369.434 2234.19,567.742 2236.55,430.767 2238.9,284.195 2241.25,373.247 2243.6,379.141 2245.95,491.009 2248.3,310.971 2250.65,448.012 2253,448.677 2255.35,473.649 2257.7,352.418 2260.05,422.807 2262.4,369.362 2264.75,346.849 2267.1,546.861 2269.45,464.547 2271.8,316.152 2274.15,396.178 2276.5,434.378 2278.85,401.169 2281.2,217.125 2283.55,285.449 2285.91,323.449 2288.26,375.091 2290.61,511.891 2292.96,571.232 2295.31,360.898 2297.66,410.133 2300.01,407.711 2302.36,383.475 2304.71,461.548 2307.06,264.094 2309.41,604.094 2311.76,449.489 2314.11,314.783 2316.46,311.367 2318.81,484.559 2321.16,434.294 2323.51,335.989 2325.86,511.123 2328.21,431.433 2330.56,339.495 2332.91,463.134 2335.27,446.712 2337.62,512.508 2339.97,396.844 2342.32,219.099 2344.67,602.976 2347.02,538.309 2349.37,331.63 2351.72,646.582 2354.07,492.067 2356.42,388.979 2358.77,489.772 2361.12,282.482 2363.47,412.552 2365.82,388.614 2368.17,347.48 2370.52,363.511 2372.87,553.585 2375.22,289.415 2377.57,429.596 2379.92,484.451 2382.27,415.68 2384.62,308.1 2386.98,338.785 2389.33,266.913 2391.68,363.703 2394.03,432.405 2396.38,507.389 2398.73,755.668 2401.08,386.453 2403.43,439.788 2405.78,524 2408.13,403.169 2410.48,495.231 2412.83,549.186 2415.18,462.61 2417.53,292.656 2419.88,587.171 2422.23,388.882 2424.58,473.441 2426.93,336.033 2429.28,305.085 2431.63,260.513 2433.98,343.308 2436.34,416.389 2438.69,383.907 2441.04,435.308 2443.39,424.074 2445.74,603.026 2448.09,503.156 2450.44,618.714 2452.79,604.819 2455.14,390.663 2457.49,496.303 2459.84,456.543 2462.19,459.881 2464.54,388.745 2466.89,460.555 2469.24,475.05 2471.59,577.253 2473.94,479.45 2476.29,481.714 2478.64,434.451 2480.99,598.598 2483.34,399.541 2485.7,263.582 2488.05,484.991 2490.4,301.712 2492.75,532.249 2495.1,452.426 2497.45,424.646 2499.8,340.916 2502.15,499.015 2504.5,472.039 2506.85,383.28 2509.2,558.68 2511.55,532.625 2513.9,275.531 2516.25,362.438 2518.6,595.674 2520.95,565.751 2523.3,382.767 2525.65,377.346 2528,413.451 2530.35,335.247 2532.7,348.413 2535.06,602.102 2537.41,362.478 2539.76,481.806 2542.11,483.586 2544.46,442.463 2546.81,371.079 2549.16,495.335 2551.51,709.742 2553.86,360.779 2556.21,359.688 2558.56,371.495 2560.91,726.927 2563.26,625.3 2565.61,322.237 2567.96,375.76 2570.31,631.038 "></polyline>
</svg>
</div>
</div>
<p>Look at that! Things are working; amazin’.</p>
<p>We can also exploit <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>’s parallel sampling capabilities:</p>
<div id="34" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run separate 4 chains for 10 000 iterations using threads to parallelize.</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>num_chains <span class="op">=</span> <span class="fl">4</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    model_with_grad,</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">MCMCThreads</span>(),</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>,</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    num_chains;</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Note we need to provide an initial state for every chain.</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>    initial_state<span class="op">=</span><span class="fu">fill</span>(state, num_chains),</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>samples_array <span class="op">=</span> <span class="fu">stack</span>(<span class="fu">map</span>(<span class="bu">Base</span>.<span class="fu">Fix1</span>(stack, sample <span class="op">-&gt;</span> sample.x), samples))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000×4 Array{Float64, 3}:
[:, :, 1] =
 -3.33739   -3.51072  -3.73779   -4.64434   …  -6.38305  -5.86292  -4.24109
  0.70444    2.40681   0.824239   0.537041     -1.10109  -1.00411  -0.0456332
 -0.745073   1.84598   3.96444    5.23158       5.2751    3.49768   4.19109

[:, :, 2] =
 -3.72518    -5.06388   -5.06388   …  -3.63736  -5.09145   -4.27774
 -0.0242701  -0.461347  -0.461347     -1.05561  -0.430424   0.000830431
  4.40192     5.66201    5.66201       4.74915   3.66739    4.7011

[:, :, 3] =
 -1.66158   -1.57001   -2.46177   -3.97236    …  -3.79834  -4.235    -6.2158
  1.13113    0.305091  -0.325677   0.0197669     -1.1212   -1.7814   -1.64455
  0.636982   1.55       1.8514     3.36482        4.29463   5.52057   5.25065

[:, :, 4] =
 -2.4393    -3.68554  -4.90532   …  -5.33666   -6.08362    -6.72079
  1.50492    1.75617  -0.370992      0.462932  -0.0853343  -0.325278
  0.692931   1.56682   1.84846       6.66784    5.9862      5.24326</code></pre>
</div>
</div>
<p>But the fact that we have to provide the <code>AbstractMCMC.sample</code> call, etc. with an <code>initial_state</code> to get started is a bit annoying. We can avoid this by also defining a <code>AbstractMCMC.step</code> <em>without</em> the <code>state</code> argument:</p>
<div id="36" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">::</span><span class="dt">MALA</span>;</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># </span><span class="al">NOTE</span><span class="co">: No state provided!</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just create the initial state by sampling using  a Gaussian.</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="fu">randn</span>(rng, LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(x), <span class="fu">MALAState</span>(x)</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Equipped with this, we no longer need to provide the <code>initial_state</code> everywhere:</p>
<div id="38" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -5.00762     0.992436
  0.00282506  0.998398
  4.98656     1.00176</code></pre>
</div>
</div>
</section>
<section id="using-our-sampler-with-turing.jl" class="level2">
<h2 class="anchored" data-anchor-id="using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</h2>
<p>As we promised, all of this hassle of implementing our <code>MALA</code> sampler in a way that uses <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> and <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> gets us something more than <em>just</em> an “automatic” implementation of <code>AbstractMCMC.sample</code>.</p>
<p>It also enables use with Turing.jl through the <code>externalsampler</code>, but we need to do one final thing first: we need to tell Turing.jl how to extract a vector of parameters from the “sample” returned in our implementation of <code>AbstractMCMC.step</code>. In our case, the “sample” is a <code>MALASample</code>, so we just need the following line:</p>
<div id="40" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Turing</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">DynamicPPL</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Overload the `getparams` method for our "sample" type, which is just a vector.</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>Turing.Inference.<span class="fu">getparams</span>(<span class="op">::</span><span class="dt">DynamicPPL.Model</span>, sample<span class="op">::</span><span class="dt">MALASample</span>) <span class="op">=</span> sample.x</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And with that, we’re good to go!</p>
<div id="42" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Our previous model defined as a Turing.jl model.</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">mvnormal_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">MvNormal</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.], I)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate our model.</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">mvnormal_model</span>()</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Call `sample` but now we're passing in a Turing.jl `model` and wrapping</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co"># our `MALA` sampler in the `externalsampler` to tell Turing.jl that the sampler</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co"># expects something that implements LogDensityProblems.jl.</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×4×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 2.61 seconds
Compute duration  = 2.61 seconds
parameters        = x[1], x[2], x[3]
internals         = lp

Use `describe(chains)` for summary statistics and quantiles.</code></pre>
</div>
</div>
<p>Pretty neat, eh?</p>
<section id="models-with-constrained-parameters" class="level3">
<h3 class="anchored" data-anchor-id="models-with-constrained-parameters">Models with constrained parameters</h3>
<p>One thing we’ve sort of glossed over in all of the above is that MALA, at least how we’ve implemented it, requires <span class="math inline">\(x\)</span> to live in <span class="math inline">\(\mathbb{R}^d\)</span> for some <span class="math inline">\(d &gt; 0\)</span>. If some of the parameters were in fact constrained, e.g.&nbsp;we were working with a <code>Beta</code> distribution which has support on the interval <span class="math inline">\((0, 1)\)</span>, <em>not</em> on <span class="math inline">\(\mathbb{R}^d\)</span>, we could easily end up outside of the valid range <span class="math inline">\((0, 1)\)</span>.</p>
<div id="44" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">beta_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">beta_model</span>()</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 1.44 seconds
Compute duration  = 1.44 seconds
parameters        = x
internals         = lp

Use `describe(chains)` for summary statistics and quantiles.</code></pre>
</div>
</div>
<p>Yep, that still works, but only because Turing.jl actually <em>transforms</em> the <code>turing_model</code> from constrained to unconstrained, so that the <code>sampler</code> provided to <code>externalsampler</code> is actually always working in unconstrained space! This is not always desirable, so we can turn this off:</p>
<div id="46" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 0.26 seconds
Compute duration  = 0.26 seconds
parameters        = x
internals         = lp

Use `describe(chains)` for summary statistics and quantiles.</code></pre>
</div>
</div>
<p>The fun thing is that this still sort of works because</p>
<div id="48" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">logpdf</span>(<span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>), <span class="fl">10.0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-Inf</code></pre>
</div>
</div>
<p>and so the samples that fall outside of the range are always rejected. But do notice how much worse all the diagnostics are, e.g.&nbsp;<code>ess_tail</code> is very poor compared to when we use <code>unconstrained=true</code>. Moreover, in more complex cases this won’t just result in a “nice” <code>-Inf</code> log-density value, but instead will error:</p>
<div id="50" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="kw">function</span> <span class="fu">demo</span>()</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>    σ² <span class="op">~</span> <span class="fu">truncated</span>(<span class="fu">Normal</span>(), lower<span class="op">=</span><span class="fl">0</span>)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If we end up with negative values for `σ²`, the `Normal` will error.</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>    x <span class="op">~</span> <span class="fu">Normal</span>(<span class="fl">0</span>, σ²)</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre>DomainError with -0.5821864436241689:
Normal: the condition σ &gt;= zero(σ) is not satisfied.
Stacktrace:
  [1] <span class="ansi-bold">#371</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/YQSrn/src/univariate/continuous/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">normal.jl:37</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [2] <span class="ansi-bold">check_args</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/YQSrn/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">utils.jl:89</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [3] <span class="ansi-bold">#Normal#370</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/YQSrn/src/univariate/continuous/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">normal.jl:37</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [4] <span class="ansi-bold">Normal</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/YQSrn/src/univariate/continuous/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">normal.jl:36</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [5] <span class="ansi-bold">Normal</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/YQSrn/src/univariate/continuous/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">normal.jl:42</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [6] <span class="ansi-bold">macro expansion</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/nxcz4/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">compiler.jl:558</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [7] <span class="ansi-bold">demo</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">__model__</span>::Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DefaultContext}</span>, <span class="ansi-bright-black-fg">__varinfo__</span>::DynamicPPL.ThreadSafeVarInfo<span class="ansi-bright-black-fg">{VarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}, Vector{Base.RefValue{Float64}}}</span>, <span class="ansi-bright-black-fg">__context__</span>::DefaultContext<span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-magenta-fg">Main.Notebook</span> <span class="ansi-bright-black-fg">~/work/docs/docs/developers/inference/implementing-samplers/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">index.qmd:457</span>
  [8] <span class="ansi-bold">_evaluate!!</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/nxcz4/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">model.jl:913</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [9] <span class="ansi-bold">evaluate_threadsafe!!</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">model</span>::Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DefaultContext}</span>, <span class="ansi-bright-black-fg">varinfo</span>::VarInfo<span class="ansi-bright-black-fg">{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}</span>, <span class="ansi-bright-black-fg">context</span>::DefaultContext<span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-cyan-fg">DynamicPPL</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/nxcz4/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">model.jl:902</span>
 [10] <span class="ansi-bold">evaluate!!</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/nxcz4/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">model.jl:832</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [11] <span class="ansi-bold">make_updated_varinfo</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">f</span>::LogDensityFunction<span class="ansi-bright-black-fg">{Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DefaultContext}, VarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}, DefaultContext, AutoForwardDiff{2, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}}}</span>, <span class="ansi-bright-black-fg">external_transition</span>::MALASample<span class="ansi-bright-black-fg">{Vector{Float64}}</span>, <span class="ansi-bright-black-fg">external_state</span>::MALAState<span class="ansi-bright-black-fg">{Vector{Float64}}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-green-fg">Turing.Inference</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/V6zn0/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">external_sampler.jl:134</span>
 [12] <span class="ansi-bold">step</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">rng</span>::TaskLocalRNG, <span class="ansi-bright-black-fg">model</span>::Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DefaultContext}</span>, <span class="ansi-bright-black-fg">sampler_wrapper</span>::Sampler<span class="ansi-bright-black-fg">{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}</span>; <span class="ansi-bright-black-fg">initial_state</span>::Nothing, <span class="ansi-bright-black-fg">initial_params</span>::Nothing, <span class="ansi-bright-black-fg">kwargs</span>::@Kwargs<span class="ansi-bright-black-fg">{}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-green-fg">Turing.Inference</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/V6zn0/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">external_sampler.jl:185</span>
 [13] <span class="ansi-bold">macro expansion</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/AbstractMCMC/7f1oY/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">sample.jl:0</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [14] <span class="ansi-bold">(::AbstractMCMC.var"#25#26"{Nothing, Int64, Int64, Int64, UnionAll, Nothing, @Kwargs{}, TaskLocalRNG, Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DefaultContext}, Sampler{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}, Int64, Float64, Int64, Int64})</span><span class="ansi-bold">(</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-yellow-fg">AbstractMCMC</span> <span class="ansi-bright-black-fg">~/.julia/packages/AbstractMCMC/7f1oY/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">logging.jl:134</span>
 [15] <span class="ansi-bold">with_logstate</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">f</span>::AbstractMCMC.var"#25#26"<span class="ansi-bright-black-fg">{Nothing, Int64, Int64, Int64, UnionAll, Nothing, @Kwargs{}, TaskLocalRNG, Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DefaultContext}, Sampler{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}, Int64, Float64, Int64, Int64}</span>, <span class="ansi-bright-black-fg">logstate</span>::Base.CoreLogging.LogState<span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">Base.CoreLogging</span> <span class="ansi-bright-black-fg">./logging/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">logging.jl:524</span>
 [16] <span class="ansi-bold">with_logger</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">f</span>::Function, <span class="ansi-bright-black-fg">logger</span>::LoggingExtras.TeeLogger<span class="ansi-bright-black-fg">{Tuple{LoggingExtras.EarlyFilteredLogger{TerminalLoggers.TerminalLogger, AbstractMCMC.var"#1#3"{Module}}, LoggingExtras.EarlyFilteredLogger{Base.CoreLogging.ConsoleLogger, AbstractMCMC.var"#2#4"{Module}}}}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">Base.CoreLogging</span> <span class="ansi-bright-black-fg">./logging/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">logging.jl:635</span>
 [17] <span class="ansi-bold">with_progresslogger</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">f</span>::Function, <span class="ansi-bright-black-fg">_module</span>::Module, <span class="ansi-bright-black-fg">logger</span>::Base.CoreLogging.ConsoleLogger<span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-yellow-fg">AbstractMCMC</span> <span class="ansi-bright-black-fg">~/.julia/packages/AbstractMCMC/7f1oY/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">logging.jl:157</span>
 [18] <span class="ansi-bold">macro expansion</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/AbstractMCMC/7f1oY/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">logging.jl:133</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [19] <span class="ansi-bold">mcmcsample</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">rng</span>::TaskLocalRNG, <span class="ansi-bright-black-fg">model</span>::Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DefaultContext}</span>, <span class="ansi-bright-black-fg">sampler</span>::Sampler<span class="ansi-bright-black-fg">{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}</span>, <span class="ansi-bright-black-fg">N</span>::Int64; <span class="ansi-bright-black-fg">progress</span>::Bool, <span class="ansi-bright-black-fg">progressname</span>::String, <span class="ansi-bright-black-fg">callback</span>::Nothing, <span class="ansi-bright-black-fg">num_warmup</span>::Int64, <span class="ansi-bright-black-fg">discard_initial</span>::Int64, <span class="ansi-bright-black-fg">thinning</span>::Int64, <span class="ansi-bright-black-fg">chain_type</span>::Type, <span class="ansi-bright-black-fg">initial_state</span>::Nothing, <span class="ansi-bright-black-fg">kwargs</span>::@Kwargs<span class="ansi-bright-black-fg">{}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-yellow-fg">AbstractMCMC</span> <span class="ansi-bright-black-fg">~/.julia/packages/AbstractMCMC/7f1oY/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">sample.jl:151</span>
 [20] <span class="ansi-bold">sample</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">rng</span>::TaskLocalRNG, <span class="ansi-bright-black-fg">model</span>::Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DefaultContext}</span>, <span class="ansi-bright-black-fg">sampler</span>::Sampler<span class="ansi-bright-black-fg">{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}</span>, <span class="ansi-bright-black-fg">N</span>::Int64; <span class="ansi-bright-black-fg">chain_type</span>::Type, <span class="ansi-bright-black-fg">resume_from</span>::Nothing, <span class="ansi-bright-black-fg">initial_state</span>::Nothing, <span class="ansi-bright-black-fg">kwargs</span>::@Kwargs<span class="ansi-bright-black-fg">{progress::Bool}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-cyan-fg">DynamicPPL</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/nxcz4/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">sampler.jl:102</span>
 [21] <span class="ansi-bold">sample</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/nxcz4/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">sampler.jl:92</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [22] <span class="ansi-bold">#sample#101</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/V6zn0/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">abstractmcmc.jl:29</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [23] <span class="ansi-bold">sample</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/V6zn0/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">abstractmcmc.jl:20</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [24] <span class="ansi-bold">#sample#100</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/V6zn0/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">abstractmcmc.jl:17</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [25] top-level scope
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/work/docs/docs/developers/inference/implementing-samplers/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">index.qmd:459</span></pre>
</div>
</div>
</div>
<p>As expected, we run into a <code>DomainError</code> at some point, while if we set <code>unconstrained=true</code>, letting Turing.jl transform the model to a unconstrained form behind the scenes, everything works as expected:</p>
<div id="52" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 1.71 seconds
Compute duration  = 1.71 seconds
parameters        = σ², x
internals         = lp

Use `describe(chains)` for summary statistics and quantiles.</code></pre>
</div>
</div>
<p>Neat!</p>
<p>Similarly, which automatic differentiation backend one should use can be specified through the <code>adtype</code> keyword argument too. For example, if we want to use <a href="https://github.com/JuliaDiff/ReverseDiff.jl">ReverseDiff.jl</a> instead of the default <a href="https://github.com/JuliaDiff/ForwardDiff.jl">ForwardDiff.jl</a>:</p>
<div id="54" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">ReverseDiff</span>: ReverseDiff</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify that we want to use `AutoReverseDiff`.</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">demo</span>(),</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>, adtype<span class="op">=</span><span class="fu">AutoReverseDiff</span>()),</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>;</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 2.89 seconds
Compute duration  = 2.89 seconds
parameters        = σ², x
internals         = lp

Use `describe(chains)` for summary statistics and quantiles.</code></pre>
</div>
</div>
<p>Double-neat.</p>
</section>
</section>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<p>At this point it’s worth maybe reminding ourselves what we did and also <em>why</em> we did it:</p>
<ol type="1">
<li>We define our models in the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface because it makes the sampler agnostic to how the underlying model is implemented.</li>
<li>We implement our sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> interface, which just means that our sampler is a subtype of <code>AbstractMCMC.AbstractSampler</code> and we implement the MCMC transition in <code>AbstractMCMC.step</code>.</li>
<li>Points 1 and 2 makes it so our sampler can be used with a wide range of model implementations, amongst them being models implemented in both Turing.jl and Stan. This gives you, the inference implementer, a large collection of models to test your inference method on, in addition to allowing users of Turing.jl and Stan to try out your inference method with minimal effort.</li>
</ol>


</section>


<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a><div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>We’re going with the leapfrog formulation because in a future version of this tutorial we’ll add a section extending this simple “baseline” MALA sampler to more complex versions. See <a href="https://github.com/TuringLang/docs/issues/479">issue #479</a> for progress on this.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>There is no such thing as a proper interface in Julia (at least not officially), and so we use the word “interface” here to mean a few minimal methods that needs to be implemented by any type that we treat as a target model.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    // Ensure there is a toggle, if there isn't float one in the top right
    if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
      const a = window.document.createElement('a');
      a.classList.add('top-right');
      a.classList.add('quarto-color-scheme-toggle');
      a.href = "";
      a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
      const i = window.document.createElement("i");
      i.classList.add('bi');
      a.appendChild(i);
      window.document.body.appendChild(a);
    }
    setColorSchemeToggle(hasAlternateSentinel())
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/turinglang\.org\/docs");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../../developers/inference/variational-inference/index.html" class="pagination-link" aria-label="Variational Inference">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Variational Inference</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/TuringLang/docs/edit/main/developers/inference/implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/docs/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div></div></footer><footer class="custom-footer">
  <div class="footer-container">
    <div class="footer-grid">
      <div class="footer-links-wrapper">
        <div class="footer-column footer-explore">
          <h5>Explore</h5>
          <a href="https://turinglang.org/docs/getting-started/">Get Started</a>
          <a href="https://turinglang.org/docs/tutorials/">Tutorials</a>
          <a href="https://turinglang.org/library/">Libraries</a>
          <a href="https://turinglang.org/news/">News</a>
          <a href="https://turinglang.org/team/">Team</a>
        </div>

        <div class="footer-column footer-connect">
          <h5>Connect</h5>
          <a href="https://github.com/TuringLang" target="_blank" rel="noopener"><i class="bi bi-github"></i> GitHub</a>
          <a href="https://x.com/TuringLang" target="_blank" rel="noopener"><i class="bi bi-twitter"></i> Twitter</a>
          <a href="https://julialang.slack.com/archives/CCYDC34A0" target="_blank" rel="noopener"><i class="bi bi-slack"></i> Slack</a>
          <a href="https://discourse.julialang.org/c/domain/probprog/48" target="_blank" rel="noopener"><i class="bi bi-chat-dots"></i> Discourse</a>
        </div>
      </div>

      <div class="footer-column footer-brands">
        <h5>Supported by leading researchers</h5>
        <p>Turing.jl is developed by researchers and engineers at the following research institutions.</p>
        <div class="logo-grid">
          <a href="https://mlg.eng.cam.ac.uk/" class="partner-logo" target="_blank" rel="noopener">
            <img src="../../../assets/images/brands/university-cambridge-logo-black-example-640x132.png" alt="University of Cambridge Logo" class="brands-light-mode-logo">
            <img src="../../../assets/images/brands/university-cambridge-logo-white-example-640x133.png" alt="University of Cambridge Logo Dark" class="brands-dark-mode-logo">
          </a>
          <a href="https://www.turing.ac.uk/" class="partner-logo" target="_blank" rel="noopener">
            <img src="../../../assets/images/brands/Turing_Logo_1000x400px_Black.webp" alt="The Alan Turing Institute Logo" class="brands-light-mode-logo">
            <img src="../../../assets/images/brands/Turing_Logo_1000x400px_White.webp" alt="The Alan Turing Institute Logo Dark" class="brands-dark-mode-logo">
          </a>
        </div>
      </div>

    </div>
    <div class="footer-bottom">
      <p>Turing is created by <a href="https://mlg.eng.cam.ac.uk/hong/" target="_blank" rel="noopener">Hong Ge</a>, and maintained by the core <a href="https://turinglang.org/team/" target="_blank" rel="noopener">team</a> of developers and <a href="https://github.com/TuringLang/Turing.jl/graphs/contributors" target="_blank" rel="noopener">contributors</a>.<br>© 2025 The Turing Project Contributors. <a href="https://github.com/TuringLang/Turing.jl/blob/master/LICENCE" target="_blank" rel="noopener">MIT License</a>.</p>
      <a href="https://github.com/TuringLang/docs/" target="_blank" rel="noopener" class="footer-source-link"><i class="bi bi-github"></i> Website Source</a>
    </div>
  </div>
</footer>




<script src="../../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>