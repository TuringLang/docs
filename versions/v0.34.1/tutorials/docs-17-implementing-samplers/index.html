<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.1">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Implementing samplers – Turing.jl</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../tutorials/docs-07-for-developers-variational-inference/index.html" rel="prev">
<link href="../../assets/favicon.ico" rel="icon">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-2bb0ec5e928ee8c40b12725cb7836c35.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark-31d8df3fb4b3ebd213a509f950828e75.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-5a965d03c83b9a52a3a52c83f34fadca.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark-03f81fcb35c69179f531195cac5ac726.min.css" rel="prefetch" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<style>
  a {
    text-decoration: none;
  }
  a:hover {
    text-decoration: underline;
  }
</style>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../theming/styles.css">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="https://turinglang.org/" class="navbar-brand navbar-brand-logo">
    <img src="../../assets/images/turing-logo.svg" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="https://turinglang.org/">
    <span class="navbar-title">Turing.jl</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../tutorials/docs-00-getting-started/"> 
<span class="menu-text">Get Started</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../tutorials/00-introduction/"> 
<span class="menu-text">Tutorials</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/library/"> 
<span class="menu-text">Libraries</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/news/"> 
<span class="menu-text">News</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/team/"> 
<span class="menu-text">Team</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-v0.34" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">v0.34</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-v0.34">    
        <li>
    <a class="dropdown-item" href="https://turinglang.org/docs/changelog.html">
 <span class="dropdown-text">Changelog</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://turinglang.org/docs/versions.html">
 <span class="dropdown-text">All Versions</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools tools-wide">
    <a href="https://x.com/TuringLang" title="Turing Twitter" class="quarto-navigation-tool px-1" aria-label="Turing Twitter"><i class="bi bi-twitter"></i></a>
    <a href="https://github.com/TuringLang/Turing.jl" title="Turing GitHub" class="quarto-navigation-tool px-1" aria-label="Turing GitHub"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Developers</li><li class="breadcrumb-item"><a href="../../tutorials/docs-06-for-developers-interface/index.html">Inference (note: outdated)</a></li><li class="breadcrumb-item"><a href="../../tutorials/docs-17-implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false">
 <span class="menu-text">Users</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-00-getting-started/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Getting Started</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-12-using-turing-guide/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Core Functionality</span></a>
  </div>
</li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false">
 <span class="menu-text">Usage Tips</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-10-using-turing-autodiff/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Automatic Differentiation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/usage-custom-distribution/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Custom Distributions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/usage-probability-interface/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Querying Model Probabilities</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/usage-modifying-logprob/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Modifying the Log Probability</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/usage-generated-quantities/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Generated Quantities</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-17-mode-estimation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Mode Estimation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-13-using-turing-performance-tips/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Performance Tips</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-15-using-turing-sampler-viz/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Sampler Visualization</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-11-using-turing-dynamichmc/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using DynamicHMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-16-using-turing-external-samplers/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using External Samplers</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false">
 <span class="menu-text">Tutorials</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/00-introduction/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction: Coin Flipping</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/01-gaussian-mixture-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Mixture Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/02-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/03-bayesian-neural-network/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Neural Networks</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/04-hidden-markov-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Hidden Markov Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/05-linear-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Linear Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/06-infinite-mixture-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Infinite Mixture Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/07-poisson-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Poisson Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/08-multinomial-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Multinomial Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/09-variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/10-bayesian-differential-equations/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Differential Equations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/11-probabilistic-pca/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Probabilistic PCA</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/13-seasonal-time-series/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Time Series Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/15-gaussian-processes/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction to Gaussian Processes</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/12-gplvm/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Process Latent Variable Models</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Developers</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false">
 <span class="menu-text">Contributing</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-01-contributing-guide/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">How to Contribute</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="false">
 <span class="menu-text">DynamicPPL in Depth</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/dev-model-manual/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Manually Defining a Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-05-for-developers-compiler/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Turing Compiler Design</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/14-minituring/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation I: Compiler</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/16-contexts/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation II: Contexts</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true">
 <span class="menu-text">Inference (note: outdated)</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-06-for-developers-interface/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Interface Guide</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-04-for-developers-abstractmcmc-turing/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">How Turing implements AbstractMCMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-07-for-developers-variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-17-implementing-samplers/index.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Implementing Samplers</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of Contents</h2>
   
  <ul>
  <li><a href="#quick-overview-of-mala" id="toc-quick-overview-of-mala" class="nav-link active" data-scroll-target="#quick-overview-of-mala">Quick overview of MALA</a></li>
  <li><a href="#what-we-need-from-a-model-logdensityproblems.jl" id="toc-what-we-need-from-a-model-logdensityproblems.jl" class="nav-link" data-scroll-target="#what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: LogDensityProblems.jl</a></li>
  <li><a href="#implementing-mala-in-abstractmcmc.jl" id="toc-implementing-mala-in-abstractmcmc.jl" class="nav-link" data-scroll-target="#implementing-mala-in-abstractmcmc.jl">Implementing MALA in AbstractMCMC.jl</a></li>
  <li><a href="#using-our-sampler-with-turing.jl" id="toc-using-our-sampler-with-turing.jl" class="nav-link" data-scroll-target="#using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</a>
  <ul class="collapse">
  <li><a href="#models-with-constrained-parameters" id="toc-models-with-constrained-parameters" class="nav-link" data-scroll-target="#models-with-constrained-parameters">Models with constrained parameters</a></li>
  </ul></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/TuringLang/docs/edit/master/tutorials/docs-17-implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/docs/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Developers</li><li class="breadcrumb-item"><a href="../../tutorials/docs-06-for-developers-interface/index.html">Inference (note: outdated)</a></li><li class="breadcrumb-item"><a href="../../tutorials/docs-17-implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Implementing samplers</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>In this tutorial, we’ll go through step-by-step how to implement a “simple” sampler in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> in such a way that it can be easily applied to Turing.jl models.</p>
<p>In particular, we’re going to implement a version of <strong>Metropolis-adjusted Langevin (MALA)</strong>.</p>
<p>Note that we will implement this sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> framework, completely “ignoring” Turing.jl until the very end of the tutorial, at which point we’ll use a single line of code to make the resulting sampler available to Turing.jl. This is to really drive home the point that one can implement samplers in a way that is accessible to all of Turing.jl’s users without having to use Turing.jl yourself.</p>
<section id="quick-overview-of-mala" class="level2">
<h2 class="anchored" data-anchor-id="quick-overview-of-mala">Quick overview of MALA</h2>
<p>We can view MALA as a single step of the leapfrog intergrator with resampling of momentum <span class="math inline">\(p\)</span> at every step.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> To make that statement a bit more concrete, we first define the <em>extended</em> target <span class="math inline">\(\bar{\gamma}(x, p)\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\log \bar{\gamma}(x, p) \propto \log \gamma(x) + \log \gamma_{\mathcal{N}(0, M)}(p)
\end{equation*}\]</span></p>
<p>where <span class="math inline">\(\gamma_{\mathcal{N}(0, M)}\)</span> denotes the density for a zero-centered Gaussian with covariance matrix <span class="math inline">\(M\)</span>. We then consider targeting this joint distribution over both <span class="math inline">\(x\)</span> and <span class="math inline">\(p\)</span> as follows. First we define the map</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  L_{\epsilon}: \quad &amp; \mathbb{R}^d \times \mathbb{R}^d \to \mathbb{R}^d \times \mathbb{R}^d \\
  &amp; (x, p) \mapsto (\tilde{x}, \tilde{p}) := L_{\epsilon}(x, p)
\end{split}
\end{equation*}\]</span></p>
<p>as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p_{1 / 2} &amp;:= p + \frac{\epsilon}{2} \nabla \log \gamma(x) \\
  \tilde{x} &amp;:= x + \epsilon M^{-1} p_{1 /2 } \\
  p_1 &amp;:= p_{1 / 2} + \frac{\epsilon}{2} \nabla \log \gamma(\tilde{x}) \\
  \tilde{p} &amp;:= - p_1
\end{split}
\end{equation*}\]</span></p>
<p>This might be familiar for some readers as a single step of the Leapfrog integrator. We then define the MALA kernel as follows: given the current iterate <span class="math inline">\(x_i\)</span>, we sample the next iterate <span class="math inline">\(x_{i + 1}\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p &amp;\sim \mathcal{N}(0, M) \\
  (\tilde{x}, \tilde{p}) &amp;:= L_{\epsilon}(x_i, p) \\
  \alpha &amp;:= \min \left\{ 1, \frac{\bar{\gamma}(\tilde{x}, \tilde{p})}{\bar{\gamma}(x_i, p)} \right\} \\
  x_{i + 1} &amp;:=
  \begin{cases}
    \tilde{x} \quad &amp; \text{ with prob. } \alpha \\
    x_i       \quad &amp; \text{ with prob. } 1 - \alpha
  \end{cases}
\end{split}
\end{equation*}\]</span></p>
<p>i.e.&nbsp;we accept the proposal <span class="math inline">\(\tilde{x}\)</span> with probability <span class="math inline">\(\alpha\)</span> and reject it, thus sticking with our current iterate, with probability <span class="math inline">\(1 - \alpha\)</span>.</p>
</section>
<section id="what-we-need-from-a-model-logdensityproblems.jl" class="level2">
<h2 class="anchored" data-anchor-id="what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a></h2>
<p>There are a few things we need from the “target” / “model” / density that we want to sample from:</p>
<ol type="1">
<li>We need access to log-density <em>evaluations</em> <span class="math inline">\(\log \gamma(x)\)</span> so we can compute the acceptance ratio involving <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>We need access to log-density <em>gradients</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span> so we can compute the Leapfrog steps <span class="math inline">\(L_{\epsilon}(x, p)\)</span>.</li>
<li>We also need access to the “size” of the model so we can determine the size of <span class="math inline">\(M\)</span>.</li>
</ol>
<p>Luckily for us, there is a package called <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> which provides an interface for <em>exactly</em> this!</p>
<p>To demonstrate how one can implement the “<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface”<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> we will use a simple Gaussian model as an example:</p>
<div id="4" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblems</span>: LogDensityProblems;</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's define some type that represents the model.</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> IsotropicNormalModel{M<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"mean of the isotropic Gaussian"</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    mean<span class="op">::</span><span class="dt">M</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Specifies what input length the model expects.</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">dimension</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> <span class="fu">length</span>(model.mean)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Implementation of the log-density evaluation of the model.</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x<span class="op">::</span><span class="dt">AbstractVector{&lt;:Real}</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">-</span> <span class="fu">sum</span>(abs2, x <span class="op">.-</span> model.mean) <span class="op">/</span> <span class="fl">2</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This gives us all of the properties we want for our MALA sampler with the exception of the computation of the <em>gradient</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span>. There is the method <code>LogDensityProblems.logdensity_and_gradient</code> which should return a 2-tuple where the first entry is the evaluation of the logdensity <span class="math inline">\(\log \gamma(x)\)</span> and the second entry is the gradient <span class="math inline">\(\nabla \log \gamma(x)\)</span>.</p>
<p>There are two ways to “implement” this method: 1) we implement it by hand, which is feasible in the case of our <code>IsotropicNormalModel</code>, or b) we defer the implementation of this to a automatic differentiation backend.</p>
<p>To implement it by hand we can simply do</p>
<div id="6" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl that first-order, i.e. gradient information, is available.</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{1}</span>()</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Implement `logdensity_and_gradient`.</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    logγ_x <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="op">-</span>x <span class="op">.*</span> (x <span class="op">-</span> model.mean)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> logγ_x, ∇logγ_x</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s just try it out:</p>
<div id="8" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate the problem.</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> <span class="fu">IsotropicNormalModel</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.])</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create some example input that we can test on.</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>x_example <span class="op">=</span> <span class="fu">randn</span>(LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate!</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-23.282439919335527</code></pre>
</div>
</div>
<p>To defer it to an automatic differentiation backend, we can do</p>
<div id="10" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl we only have access to 0-th order information.</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{0}</span>()</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Use `LogDensityProblemsAD`'s `ADgradient` in combination with some AD backend to implement `logdensity_and_gradient`.</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblemsAD</span>, <span class="bu">ADTypes</span>, <span class="bu">ForwardDiff</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>model_with_grad <span class="op">=</span> <span class="fu">ADgradient</span>(<span class="fu">AutoForwardDiff</span>(), model)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model_with_grad, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-23.282439919335527</code></pre>
</div>
</div>
<p>We’ll continue with the second approach in this tutorial since this is typically what one does in practice, because there are better hobbies to spend time on than deriving gradients by hand.</p>
<p>At this point, one might wonder how we’re going to tie this back to Turing.jl in the end. Effectively, when working with inference methods that only require log-density evaluations and / or higher-order information of the log-density, Turing.jl actually converts the user-provided <code>Model</code> into an object implementing the above methods for <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>. As a result, most samplers provided by Turing.jl are actually implemented to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, enabling their use both <em>within</em> Turing.jl and <em>outside</em> of Turing.jl! Morever, there exists similar conversions for Stan through BridgeStan and Stan<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, which means that a sampler supporting the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface can easily be used on both Turing.jl <em>and</em> Stan models (in addition to user-provided models, as our <code>IsotropicNormalModel</code> above)!</p>
<p>Anyways, let’s move on to actually implementing the sampler.</p>
</section>
<section id="implementing-mala-in-abstractmcmc.jl" class="level2">
<h2 class="anchored" data-anchor-id="implementing-mala-in-abstractmcmc.jl">Implementing MALA in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a></h2>
<p>Now that we’ve established that a model implementing the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface provides us with all the information we need from <span class="math inline">\(\log \gamma(x)\)</span>, we can address the question: given an object that implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, how can we define a sampler for it?</p>
<p>We’re going to do this by making our sampler a sub-type of <code>AbstractMCMC.AbstractSampler</code> in addition to implementing a few methods from <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>. Why? Because it gets us <em>a lot</em> of functionality for free, as we will see later.</p>
<p>Moreover, <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> provides a very natural interface for MCMC algorithms.</p>
<p>First, we’ll define our <code>MALA</code> type</p>
<div id="12" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">AbstractMCMC</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALA{T,A} <span class="op">&lt;:</span><span class="dt"> AbstractMCMC.AbstractSampler</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"stepsize used in the leapfrog step"</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    ϵ_init<span class="op">::</span><span class="dt">T</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"covariance matrix used for the momentum"</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    M_init<span class="op">::</span><span class="dt">A</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notice how we’ve added the suffix <code>_init</code> to both the stepsize and the covariance matrix. We’ve done this because a <code>AbstractMCMC.AbstractSampler</code> should be <em>immutable</em>. Of course there might be many scenarios where we want to allow something like the stepsize and / or the covariance matrix to vary between iterations, e.g.&nbsp;during the burn-in / adaptation phase of the sampling process we might want to adjust the parameters using statistics computed from these initial iterations. But information which can change between iterations <em>should not go in the sampler itself</em>! Instead, this information should go in the sampler <em>state</em>.</p>
<p>The sampler state should at the very least contain all the necessary information to perform the next MCMC iteration, but usually contains further information, e.g.&nbsp;quantities and statistics useful for evaluating whether the sampler has converged.</p>
<p>We will use the following sampler state for our <code>MALA</code> sampler:</p>
<div id="14" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALAState{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This might seem overly redundant: we’re defining a type <code>MALAState</code> and it only contains a simple vector of reals. In this particular case we indeed could have dropped this and simply used a <code>AbstractVector{&lt;:Real}</code> as our sampler state, but typically, as we will see later, one wants to include other quantities in the sampler state. For example, if we also wanted to adapt the parameters of our <code>MALA</code>, e.g.&nbsp;alter the stepsize depending on acceptance rates, in which case we should also put <code>ϵ</code> in the state, but for now we’ll keep things simple.</p>
<p>Moreover, we also want a <em>sample</em> type, which is a type meant for “public consumption”, i.e.&nbsp;the end-user. This is generally going to contain a subset of the information present in the state. But in such a simple scenario as this, we similarly only have a <code>AbstractVector{&lt;:Real}</code>:</p>
<div id="16" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALASample{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We currently have three things:</p>
<ol type="1">
<li>A <code>AbstractMCMC.AbstractSampler</code> implementation called <code>MALA</code>.</li>
<li>A state <code>MALAState</code> for our sampler <code>MALA</code>.</li>
<li>A sample <code>MALASample</code> for our sampler <code>MALA</code>.</li>
</ol>
<p>That means that we’re ready to implement the only thing that really matters: <code>AbstractMCMC.step</code>.</p>
<p><code>AbstractMCMC.step</code> defines the MCMC iteration of our <code>MALA</code> given the current <code>MALAState</code>. Specifically, the signature of the function is as follows:</p>
<div id="18" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The RNG to ensure reproducibility.</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The model that defines our target.</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.AbstractModel</span>,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The sampler for which we're taking a `step`.</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">AbstractMCMC.AbstractSampler</span>,</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The current sampler `state`.</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    state;</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Additional keyword arguments that we may or may not need.</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Moreover, there is a specific <code>AbstractMCMC.AbstractModel</code> which is used to indicate that the model that is provided implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface: <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Since, as we discussed earlier, in our case we’re indeed going to work with types that support the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, we’ll define <code>AbstractMCMC.step</code> for such a <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Note that <code>AbstractMCMC.LogDensityModel</code> has no other purpose; it has a single field called <code>logdensity</code>, and it does nothing else. But by wrapping the model in <code>AbstractMCMC.LogDensityModel</code>, it allows samplers that want to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> to define their <code>AbstractMCMC.step</code> on this type without running into method ambiguities.</p>
<p>All in all, that means that the signature for our <code>AbstractMCMC.step</code> is going to be the following:</p>
<div id="20" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># `LogDensityModel` so we know we're working with LogDensityProblems.jl model.</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler.</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler state.</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Great! Now let’s actually implement the full <code>AbstractMCMC.step</code> for our <code>MALA</code>.</p>
<p>Let’s remind ourselves what we’re going to do:</p>
<ol type="1">
<li>Sample a new momentum <span class="math inline">\(p\)</span>.</li>
<li>Compute the log-density of the extended target <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>Take a single leapfrog step <span class="math inline">\((\tilde{x}, \tilde{p}) = L_{\epsilon}(x, p)\)</span>.</li>
<li>Accept or reject the proposed <span class="math inline">\((\tilde{x}, \tilde{p})\)</span>.</li>
</ol>
<p>All in all, this results in the following:</p>
<div id="22" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>: Random</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Distributions</span>  <span class="co"># so we get the `MvNormal`</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the wrapped model which implements LogDensityProblems.jl.</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just extract the sampler parameters to make our lives easier.</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    ϵ <span class="op">=</span> sampler.ϵ_init</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    M <span class="op">=</span> sampler.M_init</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the current parameters.</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> state.x</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sample the momentum.</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>    p_dist <span class="op">=</span> <span class="fu">MvNormal</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)), M)</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> <span class="fu">rand</span>(rng, p_dist)</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Propose using a single leapfrog step.</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>    x̃, p̃ <span class="op">=</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Accept or reject proposal.</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>    logp <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p)</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>    logp̃ <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x̃) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p̃)</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>    logα <span class="op">=</span> logp̃ <span class="op">-</span> logp</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>    state_new <span class="op">=</span> <span class="cf">if</span> <span class="fu">log</span>(<span class="fu">rand</span>(rng)) <span class="op">&lt;</span> logα</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Accept.</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x̃)</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Reject.</span></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x)</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return the "sample" and the sampler state.</span></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(state_new.x), state_new</span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Fairly straight-forward.</p>
<p>Of course, we haven’t defined the <code>leapfrog_step</code> method yet, so let’s do that:</p>
<div id="24" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p` using "position" `x`.</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x))</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    p1 <span class="op">=</span> p <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update the "position" `x` using momentum `p1`.</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    x̃ <span class="op">=</span> x <span class="op">+</span> ϵ <span class="op">.*</span> (M <span class="op">\</span> p1)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p1` using position `x̃`</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x̃ <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x̃))</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    p2 <span class="op">=</span> p1 <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x̃</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Flip momentum `p2`.</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    p̃ <span class="op">=</span> <span class="op">-</span>p2</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x̃, p̃</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>leapfrog_step (generic function with 1 method)</code></pre>
</div>
</div>
<p>With all of this, we’re technically ready to sample!</p>
<div id="26" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>, <span class="bu">LinearAlgebra</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>rng <span class="op">=</span> <span class="bu">Random</span>.<span class="fu">default_rng</span>()</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>sampler <span class="op">=</span> <span class="fu">MALA</span>(<span class="fl">1</span>, I)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>state <span class="op">=</span> <span class="fu">MALAState</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)))</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>x_next, state_next <span class="op">=</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    rng,</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    AbstractMCMC.<span class="fu">LogDensityModel</span>(model),</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    state</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>(MALASample{Vector{Float64}}([0.0, 0.0, 0.0]), MALAState{Vector{Float64}}([0.0, 0.0, 0.0]))</code></pre>
</div>
</div>
<p>Great, it works!</p>
<p>And I promised we would get quite some functionality for free if we implemented <code>AbstractMCMC.step</code>, and so we can now simply call <code>sample</code> to perform standard MCMC sampling:</p>
<div id="28" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform 1000 iterations with our `MALA` sampler.</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; initial_state<span class="op">=</span>state, progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Concatenate into a matrix.</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000 Matrix{Float64}:
 -3.49295   -5.54924   -6.57497  -6.36609  …  -6.23077   -4.87423  -5.00279
  0.514974   0.262555   1.60546   1.54616     -0.777994   1.18448  -0.668538
  2.78608    4.03637    6.19686   6.81642      5.11287    3.36137   4.59887</code></pre>
</div>
</div>
<div id="30" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the marginal means and standard deviations.</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -5.00468      1.01394
  0.000659363  1.01075
  4.98842      1.01103</code></pre>
</div>
</div>
<p>Let’s visualize the samples</p>
<div id="32" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">StatsPlots</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">transpose</span>(samples_matrix[<span class="op">:</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">:</span><span class="kw">end</span>]), alpha<span class="op">=</span><span class="fl">0.5</span>, legend<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<!--?xml version="1.0" encoding="utf-8"?-->
<svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" width="672" height="480" viewbox="0 0 2688 1920">
<defs>
  <clippath id="clip720">
    <rect x="0" y="0" width="2688" height="1920"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip720)" d="M0 1920 L2688 1920 L2688 0 L0 0  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip721">
    <rect x="537" y="0" width="1883" height="1883"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip720)" d="M151.747 1800.78 L2640.76 1800.78 L2640.76 47.2441 L151.747 47.2441  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip722">
    <rect x="151" y="47" width="2490" height="1755"></rect>
  </clippath>
</defs>
<polyline clip-path="url(#clip722)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="219.84,1800.78 219.84,47.2441 "></polyline>
<polyline clip-path="url(#clip722)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="807.458,1800.78 807.458,47.2441 "></polyline>
<polyline clip-path="url(#clip722)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1395.08,1800.78 1395.08,47.2441 "></polyline>
<polyline clip-path="url(#clip722)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1982.69,1800.78 1982.69,47.2441 "></polyline>
<polyline clip-path="url(#clip722)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="2570.31,1800.78 2570.31,47.2441 "></polyline>
<polyline clip-path="url(#clip722)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,1524.36 2640.76,1524.36 "></polyline>
<polyline clip-path="url(#clip722)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,1227.49 2640.76,1227.49 "></polyline>
<polyline clip-path="url(#clip722)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,930.627 2640.76,930.627 "></polyline>
<polyline clip-path="url(#clip722)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,633.761 2640.76,633.761 "></polyline>
<polyline clip-path="url(#clip722)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,336.896 2640.76,336.896 "></polyline>
<polyline clip-path="url(#clip720)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1800.78 2640.76,1800.78 "></polyline>
<polyline clip-path="url(#clip720)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="219.84,1800.78 219.84,1781.88 "></polyline>
<polyline clip-path="url(#clip720)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="807.458,1800.78 807.458,1781.88 "></polyline>
<polyline clip-path="url(#clip720)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1395.08,1800.78 1395.08,1781.88 "></polyline>
<polyline clip-path="url(#clip720)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1982.69,1800.78 1982.69,1781.88 "></polyline>
<polyline clip-path="url(#clip720)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="2570.31,1800.78 2570.31,1781.88 "></polyline>
<path clip-path="url(#clip720)" d="M219.84 1834 Q216.229 1834 214.4 1837.57 Q212.595 1841.11 212.595 1848.24 Q212.595 1855.34 214.4 1858.91 Q216.229 1862.45 219.84 1862.45 Q223.474 1862.45 225.28 1858.91 Q227.108 1855.34 227.108 1848.24 Q227.108 1841.11 225.28 1837.57 Q223.474 1834 219.84 1834 M219.84 1830.3 Q225.65 1830.3 228.706 1834.9 Q231.784 1839.49 231.784 1848.24 Q231.784 1856.96 228.706 1861.57 Q225.65 1866.15 219.84 1866.15 Q214.03 1866.15 210.951 1861.57 Q207.896 1856.96 207.896 1848.24 Q207.896 1839.49 210.951 1834.9 Q214.03 1830.3 219.84 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip720)" d="M771.15 1861.55 L787.47 1861.55 L787.47 1865.48 L765.525 1865.48 L765.525 1861.55 Q768.187 1858.79 772.771 1854.16 Q777.377 1849.51 778.558 1848.17 Q780.803 1845.65 781.683 1843.91 Q782.585 1842.15 782.585 1840.46 Q782.585 1837.71 780.641 1835.97 Q778.72 1834.23 775.618 1834.23 Q773.419 1834.23 770.965 1835 Q768.535 1835.76 765.757 1837.31 L765.757 1832.59 Q768.581 1831.46 771.035 1830.88 Q773.488 1830.3 775.525 1830.3 Q780.896 1830.3 784.09 1832.98 Q787.285 1835.67 787.285 1840.16 Q787.285 1842.29 786.474 1844.21 Q785.687 1846.11 783.581 1848.7 Q783.002 1849.37 779.9 1852.59 Q776.798 1855.78 771.15 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip720)" d="M797.331 1830.92 L815.687 1830.92 L815.687 1834.86 L801.613 1834.86 L801.613 1843.33 Q802.632 1842.98 803.65 1842.82 Q804.669 1842.64 805.687 1842.64 Q811.474 1842.64 814.854 1845.81 Q818.233 1848.98 818.233 1854.4 Q818.233 1859.97 814.761 1863.08 Q811.289 1866.15 804.97 1866.15 Q802.794 1866.15 800.525 1865.78 Q798.28 1865.41 795.872 1864.67 L795.872 1859.97 Q797.956 1861.11 800.178 1861.66 Q802.4 1862.22 804.877 1862.22 Q808.882 1862.22 811.22 1860.11 Q813.558 1858.01 813.558 1854.4 Q813.558 1850.78 811.22 1848.68 Q808.882 1846.57 804.877 1846.57 Q803.002 1846.57 801.127 1846.99 Q799.275 1847.4 797.331 1848.28 L797.331 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip720)" d="M837.446 1834 Q833.835 1834 832.007 1837.57 Q830.201 1841.11 830.201 1848.24 Q830.201 1855.34 832.007 1858.91 Q833.835 1862.45 837.446 1862.45 Q841.081 1862.45 842.886 1858.91 Q844.715 1855.34 844.715 1848.24 Q844.715 1841.11 842.886 1837.57 Q841.081 1834 837.446 1834 M837.446 1830.3 Q843.256 1830.3 846.312 1834.9 Q849.391 1839.49 849.391 1848.24 Q849.391 1856.96 846.312 1861.57 Q843.256 1866.15 837.446 1866.15 Q831.636 1866.15 828.557 1861.57 Q825.502 1856.96 825.502 1848.24 Q825.502 1839.49 828.557 1834.9 Q831.636 1830.3 837.446 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip720)" d="M1354.69 1830.92 L1373.05 1830.92 L1373.05 1834.86 L1358.98 1834.86 L1358.98 1843.33 Q1360 1842.98 1361.01 1842.82 Q1362.03 1842.64 1363.05 1842.64 Q1368.84 1842.64 1372.22 1845.81 Q1375.6 1848.98 1375.6 1854.4 Q1375.6 1859.97 1372.12 1863.08 Q1368.65 1866.15 1362.33 1866.15 Q1360.16 1866.15 1357.89 1865.78 Q1355.64 1865.41 1353.24 1864.67 L1353.24 1859.97 Q1355.32 1861.11 1357.54 1861.66 Q1359.76 1862.22 1362.24 1862.22 Q1366.25 1862.22 1368.58 1860.11 Q1370.92 1858.01 1370.92 1854.4 Q1370.92 1850.78 1368.58 1848.68 Q1366.25 1846.57 1362.24 1846.57 Q1360.37 1846.57 1358.49 1846.99 Q1356.64 1847.4 1354.69 1848.28 L1354.69 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip720)" d="M1394.81 1834 Q1391.2 1834 1389.37 1837.57 Q1387.56 1841.11 1387.56 1848.24 Q1387.56 1855.34 1389.37 1858.91 Q1391.2 1862.45 1394.81 1862.45 Q1398.44 1862.45 1400.25 1858.91 Q1402.08 1855.34 1402.08 1848.24 Q1402.08 1841.11 1400.25 1837.57 Q1398.44 1834 1394.81 1834 M1394.81 1830.3 Q1400.62 1830.3 1403.68 1834.9 Q1406.75 1839.49 1406.75 1848.24 Q1406.75 1856.96 1403.68 1861.57 Q1400.62 1866.15 1394.81 1866.15 Q1389 1866.15 1385.92 1861.57 Q1382.87 1856.96 1382.87 1848.24 Q1382.87 1839.49 1385.92 1834.9 Q1389 1830.3 1394.81 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip720)" d="M1424.97 1834 Q1421.36 1834 1419.53 1837.57 Q1417.73 1841.11 1417.73 1848.24 Q1417.73 1855.34 1419.53 1858.91 Q1421.36 1862.45 1424.97 1862.45 Q1428.61 1862.45 1430.41 1858.91 Q1432.24 1855.34 1432.24 1848.24 Q1432.24 1841.11 1430.41 1837.57 Q1428.61 1834 1424.97 1834 M1424.97 1830.3 Q1430.78 1830.3 1433.84 1834.9 Q1436.92 1839.49 1436.92 1848.24 Q1436.92 1856.96 1433.84 1861.57 Q1430.78 1866.15 1424.97 1866.15 Q1419.16 1866.15 1416.08 1861.57 Q1413.03 1856.96 1413.03 1848.24 Q1413.03 1839.49 1416.08 1834.9 Q1419.16 1830.3 1424.97 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip720)" d="M1940.97 1830.92 L1963.19 1830.92 L1963.19 1832.91 L1950.65 1865.48 L1945.76 1865.48 L1957.57 1834.86 L1940.97 1834.86 L1940.97 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip720)" d="M1972.36 1830.92 L1990.71 1830.92 L1990.71 1834.86 L1976.64 1834.86 L1976.64 1843.33 Q1977.66 1842.98 1978.68 1842.82 Q1979.7 1842.64 1980.72 1842.64 Q1986.5 1842.64 1989.88 1845.81 Q1993.26 1848.98 1993.26 1854.4 Q1993.26 1859.97 1989.79 1863.08 Q1986.32 1866.15 1980 1866.15 Q1977.82 1866.15 1975.55 1865.78 Q1973.31 1865.41 1970.9 1864.67 L1970.9 1859.97 Q1972.98 1861.11 1975.21 1861.66 Q1977.43 1862.22 1979.9 1862.22 Q1983.91 1862.22 1986.25 1860.11 Q1988.59 1858.01 1988.59 1854.4 Q1988.59 1850.78 1986.25 1848.68 Q1983.91 1846.57 1979.9 1846.57 Q1978.03 1846.57 1976.15 1846.99 Q1974.3 1847.4 1972.36 1848.28 L1972.36 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip720)" d="M2012.47 1834 Q2008.86 1834 2007.03 1837.57 Q2005.23 1841.11 2005.23 1848.24 Q2005.23 1855.34 2007.03 1858.91 Q2008.86 1862.45 2012.47 1862.45 Q2016.11 1862.45 2017.91 1858.91 Q2019.74 1855.34 2019.74 1848.24 Q2019.74 1841.11 2017.91 1837.57 Q2016.11 1834 2012.47 1834 M2012.47 1830.3 Q2018.28 1830.3 2021.34 1834.9 Q2024.42 1839.49 2024.42 1848.24 Q2024.42 1856.96 2021.34 1861.57 Q2018.28 1866.15 2012.47 1866.15 Q2006.66 1866.15 2003.59 1861.57 Q2000.53 1856.96 2000.53 1848.24 Q2000.53 1839.49 2003.59 1834.9 Q2006.66 1830.3 2012.47 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip720)" d="M2514.84 1861.55 L2522.48 1861.55 L2522.48 1835.18 L2514.17 1836.85 L2514.17 1832.59 L2522.43 1830.92 L2527.11 1830.92 L2527.11 1861.55 L2534.75 1861.55 L2534.75 1865.48 L2514.84 1865.48 L2514.84 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip720)" d="M2554.19 1834 Q2550.58 1834 2548.75 1837.57 Q2546.94 1841.11 2546.94 1848.24 Q2546.94 1855.34 2548.75 1858.91 Q2550.58 1862.45 2554.19 1862.45 Q2557.82 1862.45 2559.63 1858.91 Q2561.46 1855.34 2561.46 1848.24 Q2561.46 1841.11 2559.63 1837.57 Q2557.82 1834 2554.19 1834 M2554.19 1830.3 Q2560 1830.3 2563.06 1834.9 Q2566.13 1839.49 2566.13 1848.24 Q2566.13 1856.96 2563.06 1861.57 Q2560 1866.15 2554.19 1866.15 Q2548.38 1866.15 2545.3 1861.57 Q2542.25 1856.96 2542.25 1848.24 Q2542.25 1839.49 2545.3 1834.9 Q2548.38 1830.3 2554.19 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip720)" d="M2584.35 1834 Q2580.74 1834 2578.91 1837.57 Q2577.11 1841.11 2577.11 1848.24 Q2577.11 1855.34 2578.91 1858.91 Q2580.74 1862.45 2584.35 1862.45 Q2587.99 1862.45 2589.79 1858.91 Q2591.62 1855.34 2591.62 1848.24 Q2591.62 1841.11 2589.79 1837.57 Q2587.99 1834 2584.35 1834 M2584.35 1830.3 Q2590.16 1830.3 2593.22 1834.9 Q2596.3 1839.49 2596.3 1848.24 Q2596.3 1856.96 2593.22 1861.57 Q2590.16 1866.15 2584.35 1866.15 Q2578.54 1866.15 2575.46 1861.57 Q2572.41 1856.96 2572.41 1848.24 Q2572.41 1839.49 2575.46 1834.9 Q2578.54 1830.3 2584.35 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip720)" d="M2614.51 1834 Q2610.9 1834 2609.07 1837.57 Q2607.27 1841.11 2607.27 1848.24 Q2607.27 1855.34 2609.07 1858.91 Q2610.9 1862.45 2614.51 1862.45 Q2618.15 1862.45 2619.95 1858.91 Q2621.78 1855.34 2621.78 1848.24 Q2621.78 1841.11 2619.95 1837.57 Q2618.15 1834 2614.51 1834 M2614.51 1830.3 Q2620.32 1830.3 2623.38 1834.9 Q2626.46 1839.49 2626.46 1848.24 Q2626.46 1856.96 2623.38 1861.57 Q2620.32 1866.15 2614.51 1866.15 Q2608.7 1866.15 2605.62 1861.57 Q2602.57 1856.96 2602.57 1848.24 Q2602.57 1839.49 2605.62 1834.9 Q2608.7 1830.3 2614.51 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip720)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1800.78 151.747,47.2441 "></polyline>
<polyline clip-path="url(#clip720)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1524.36 170.644,1524.36 "></polyline>
<polyline clip-path="url(#clip720)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1227.49 170.644,1227.49 "></polyline>
<polyline clip-path="url(#clip720)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,930.627 170.644,930.627 "></polyline>
<polyline clip-path="url(#clip720)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,633.761 170.644,633.761 "></polyline>
<polyline clip-path="url(#clip720)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,336.896 170.644,336.896 "></polyline>
<path clip-path="url(#clip720)" d="M49.5521 1524.81 L79.2279 1524.81 L79.2279 1528.74 L49.5521 1528.74 L49.5521 1524.81 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip720)" d="M99.8991 1522.49 Q96.7509 1522.49 94.8991 1524.65 Q93.0704 1526.8 93.0704 1530.55 Q93.0704 1534.28 94.8991 1536.45 Q96.7509 1538.6 99.8991 1538.6 Q103.047 1538.6 104.876 1536.45 Q106.728 1534.28 106.728 1530.55 Q106.728 1526.8 104.876 1524.65 Q103.047 1522.49 99.8991 1522.49 M109.181 1507.84 L109.181 1512.1 Q107.422 1511.27 105.617 1510.83 Q103.834 1510.39 102.075 1510.39 Q97.4454 1510.39 94.9917 1513.51 Q92.5612 1516.64 92.2139 1522.96 Q93.5797 1520.94 95.6398 1519.88 Q97.7 1518.79 100.177 1518.79 Q105.385 1518.79 108.394 1521.96 Q111.427 1525.11 111.427 1530.55 Q111.427 1535.87 108.279 1539.09 Q105.131 1542.31 99.8991 1542.31 Q93.9037 1542.31 90.7325 1537.73 Q87.5612 1533.12 87.5612 1524.39 Q87.5612 1516.2 91.45 1511.34 Q95.3389 1506.45 101.89 1506.45 Q103.649 1506.45 105.431 1506.8 Q107.237 1507.15 109.181 1507.84 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip720)" d="M50.3623 1227.94 L80.0381 1227.94 L80.0381 1231.88 L50.3623 1231.88 L50.3623 1227.94 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip720)" d="M104.297 1226.14 Q107.654 1226.86 109.529 1229.12 Q111.427 1231.39 111.427 1234.73 Q111.427 1239.84 107.908 1242.64 Q104.39 1245.44 97.9083 1245.44 Q95.7324 1245.44 93.4176 1245 Q91.126 1244.59 88.6723 1243.73 L88.6723 1239.22 Q90.6167 1240.35 92.9315 1240.93 Q95.2463 1241.51 97.7695 1241.51 Q102.168 1241.51 104.459 1239.77 Q106.774 1238.04 106.774 1234.73 Q106.774 1231.67 104.621 1229.96 Q102.492 1228.22 98.6722 1228.22 L94.6445 1228.22 L94.6445 1224.38 L98.8574 1224.38 Q102.306 1224.38 104.135 1223.01 Q105.964 1221.62 105.964 1219.03 Q105.964 1216.37 104.066 1214.96 Q102.191 1213.52 98.6722 1213.52 Q96.7509 1213.52 94.5519 1213.94 Q92.3528 1214.36 89.7139 1215.24 L89.7139 1211.07 Q92.376 1210.33 94.6908 1209.96 Q97.0287 1209.59 99.0889 1209.59 Q104.413 1209.59 107.515 1212.02 Q110.617 1214.42 110.617 1218.55 Q110.617 1221.42 108.973 1223.41 Q107.33 1225.37 104.297 1226.14 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip720)" d="M99.4824 916.425 Q95.8713 916.425 94.0426 919.99 Q92.2371 923.532 92.2371 930.661 Q92.2371 937.768 94.0426 941.333 Q95.8713 944.874 99.4824 944.874 Q103.117 944.874 104.922 941.333 Q106.751 937.768 106.751 930.661 Q106.751 923.532 104.922 919.99 Q103.117 916.425 99.4824 916.425 M99.4824 912.722 Q105.293 912.722 108.348 917.328 Q111.427 921.911 111.427 930.661 Q111.427 939.388 108.348 943.995 Q105.293 948.578 99.4824 948.578 Q93.6723 948.578 90.5936 943.995 Q87.538 939.388 87.538 930.661 Q87.538 921.911 90.5936 917.328 Q93.6723 912.722 99.4824 912.722 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip720)" d="M104.297 632.407 Q107.654 633.125 109.529 635.393 Q111.427 637.662 111.427 640.995 Q111.427 646.111 107.908 648.912 Q104.39 651.713 97.9083 651.713 Q95.7324 651.713 93.4176 651.273 Q91.126 650.856 88.6723 650 L88.6723 645.486 Q90.6167 646.62 92.9315 647.199 Q95.2463 647.778 97.7695 647.778 Q102.168 647.778 104.459 646.041 Q106.774 644.305 106.774 640.995 Q106.774 637.94 104.621 636.227 Q102.492 634.491 98.6722 634.491 L94.6445 634.491 L94.6445 630.648 L98.8574 630.648 Q102.306 630.648 104.135 629.282 Q105.964 627.893 105.964 625.301 Q105.964 622.639 104.066 621.227 Q102.191 619.792 98.6722 619.792 Q96.7509 619.792 94.5519 620.208 Q92.3528 620.625 89.7139 621.505 L89.7139 617.338 Q92.376 616.597 94.6908 616.227 Q97.0287 615.856 99.0889 615.856 Q104.413 615.856 107.515 618.287 Q110.617 620.694 110.617 624.815 Q110.617 627.685 108.973 629.676 Q107.33 631.643 104.297 632.407 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip720)" d="M99.8991 335.033 Q96.7509 335.033 94.8991 337.185 Q93.0704 339.338 93.0704 343.088 Q93.0704 346.815 94.8991 348.991 Q96.7509 351.144 99.8991 351.144 Q103.047 351.144 104.876 348.991 Q106.728 346.815 106.728 343.088 Q106.728 339.338 104.876 337.185 Q103.047 335.033 99.8991 335.033 M109.181 320.38 L109.181 324.639 Q107.422 323.806 105.617 323.366 Q103.834 322.926 102.075 322.926 Q97.4454 322.926 94.9917 326.051 Q92.5612 329.176 92.2139 335.496 Q93.5797 333.482 95.6398 332.417 Q97.7 331.329 100.177 331.329 Q105.385 331.329 108.394 334.5 Q111.427 337.648 111.427 343.088 Q111.427 348.412 108.279 351.63 Q105.131 354.847 99.8991 354.847 Q93.9037 354.847 90.7325 350.264 Q87.5612 345.658 87.5612 336.931 Q87.5612 328.736 91.45 323.875 Q95.3389 318.991 101.89 318.991 Q103.649 318.991 105.431 319.338 Q107.237 319.686 109.181 320.38 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip722)" style="stroke:#009af9; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,1276.27 224.541,1551.35 226.891,1366.87 229.242,1431.52 231.592,1312.96 233.943,1508.18 236.293,1526.76 238.644,1430.27 240.994,1447.6 243.345,1443.3 245.695,1506.06 248.046,1431.26 250.396,1470.72 252.747,1462.62 255.097,1509.36 257.448,1505.86 259.798,1334.49 262.148,1545.63 264.499,1440.88 266.849,1448.43 269.2,1386.43 271.55,1443.28 273.901,1534.34 276.251,1496.13 278.602,1339.79 280.952,1348.41 283.303,1490.28 285.653,1540.15 288.004,1383.45 290.354,1256.32 292.705,1591.79 295.055,1582.86 297.406,1365.74 299.756,1411.16 302.107,1485.54 304.457,1352.03 306.807,1399.83 309.158,1527.34 311.508,1485.69 313.859,1607.67 316.209,1600.53 318.56,1411.51 320.91,1265.56 323.261,1359.17 325.611,1545.83 327.962,1491.17 330.312,1342.21 332.663,1444.91 335.013,1454.81 337.364,1368.63 339.714,1367.74 342.065,1548.49 344.415,1414.37 346.765,1334.95 349.116,1569.34 351.466,1421.16 353.817,1580.09 356.167,1481.25 358.518,1425.01 360.868,1646.53 363.219,1351.26 365.569,1460.12 367.92,1236.66 370.27,1569.7 372.621,1396.38 374.971,1359.71 377.322,1324.56 379.672,1414.95 382.023,1446.11 384.373,1552.64 386.724,1373.84 389.074,1614.65 391.424,1598.1 393.775,1598.12 396.125,1292.56 398.476,1569.1 400.826,1236.05 403.177,1347.81 405.527,1584.56 407.878,1314.49 410.228,1572.04 412.579,1544.9 414.929,1453.85 417.28,1396.79 419.63,1434.6 421.981,1474.98 424.331,1512.67 426.682,1287.81 429.032,1426.29 431.382,1363.58 433.733,1259.2 436.083,1349.06 438.434,1259.7 440.784,1504.82 443.135,1548.68 445.485,1387.15 447.836,1540.28 450.186,1487.61 452.537,1487.6 454.887,1311.74 457.238,1293.5 459.588,1322.15 461.939,1554.62 464.289,1516.44 466.64,1287.2 468.99,1450.78 471.341,1398.58 473.691,1522.1 476.041,1459.03 478.392,1608.27 480.742,1466.02 483.093,1502.85 485.443,1411.17 487.794,1549.72 490.144,1558.41 492.495,1523.24 494.845,1337.96 497.196,1559.79 499.546,1487.58 501.897,1342.88 504.247,1337.9 506.598,1428.59 508.948,1566.51 511.299,1451.88 513.649,1460.29 515.999,1525.97 518.35,1355.85 520.7,1458.27 523.051,1360.51 525.401,1304.2 527.752,1492.74 530.102,1480.02 532.453,1561.87 534.803,1491.1 537.154,1447.71 539.504,1449.56 541.855,1401.73 544.205,1384.24 546.556,1315.97 548.906,1478.18 551.257,1536.19 553.607,1320.76 555.958,1456.23 558.308,1362.38 560.658,1257.07 563.009,1542.85 565.359,1478.42 567.71,1453.3 570.06,1567.87 572.411,1281.93 574.761,1370.92 577.112,1416.83 579.462,1296.35 581.813,1309.6 584.163,1173.09 586.514,1442.42 588.864,1475.6 591.215,1512.36 593.565,1385.49 595.916,1385.43 598.266,1553.14 600.616,1558.76 602.967,1529.76 605.317,1453.06 607.668,1536.24 610.018,1444.63 612.369,1604.7 614.719,1658.19 617.07,1400.72 619.42,1411.18 621.771,1611.32 624.121,1411.38 626.472,1513.77 628.822,1503.52 631.173,1487.55 633.523,1488.81 635.874,1177.16 638.224,1375.36 640.575,1538.45 642.925,1418.88 645.275,1478.21 647.626,1380.93 649.976,1462.84 652.327,1542.73 654.677,1519.28 657.028,1469.18 659.378,1283.62 661.729,1511.56 664.079,1399.19 666.43,1311.54 668.78,1447.02 671.131,1482.06 673.481,1484.56 675.832,1449.7 678.182,1405.85 680.533,1451.41 682.883,1589.38 685.233,1326.49 687.584,1603.36 689.934,1371.5 692.285,1429.52 694.635,1584.75 696.986,1435.46 699.336,1330.74 701.687,1391.79 704.037,1271.44 706.388,1333.72 708.738,1388.45 711.089,1494.36 713.439,1179.18 715.79,1388.42 718.14,1337.1 720.491,1329.19 722.841,1266.87 725.192,1590.23 727.542,1356.4 729.892,1309.96 732.243,1387.36 734.593,1419.21 736.944,1487.64 739.294,1440.02 741.645,1343.11 743.995,1416.77 746.346,1418.4 748.696,1396.99 751.047,1615.41 753.397,1144.49 755.748,1456.2 758.098,1294.24 760.449,1480.82 762.799,1304.79 765.15,1395.7 767.5,1468.92 769.85,1382.3 772.201,1451.99 774.551,1436.64 776.902,1494.07 779.252,1291.61 781.603,1501.39 783.953,1396.5 786.304,1469.19 788.654,1528.51 791.005,1393.98 793.355,1253.54 795.706,1487 798.056,1293.94 800.407,1262.32 802.757,1425.76 805.108,1506.32 807.458,1271.28 809.809,1538.47 812.159,1473.22 814.509,1472.34 816.86,1359.63 819.21,1523.32 821.561,1367.43 823.911,1404.16 826.262,1348.48 828.612,1382.97 830.963,1365.91 833.313,1408.36 835.664,1406.22 838.014,1320.58 840.365,1603.91 842.715,1465.24 845.066,1526.75 847.416,1257.98 849.767,1291.98 852.117,1498.22 854.467,1485.03 856.818,1554.77 859.168,1434.37 861.519,1486.63 863.869,1616.05 866.22,1278.32 868.57,1371.37 870.921,1578.36 873.271,1415.14 875.622,1362.23 877.972,1485.34 880.323,1328 882.673,1575.95 885.024,1469.42 887.374,1388.43 889.725,1435.58 892.075,1577.31 894.426,1280.54 896.776,1329.15 899.126,1437.77 901.477,1507.88 903.827,1384.25 906.178,1533.83 908.528,1501.89 910.879,1560.06 913.229,1348.49 915.58,1346.08 917.93,1607.21 920.281,1391.66 922.631,1364.45 924.982,1489.02 927.332,1269.14 929.683,1389.98 932.033,1360.29 934.384,1384.22 936.734,1431.78 939.084,1396.6 941.435,1300.8 943.785,1365.65 946.136,1405.21 948.486,1341.42 950.837,1486.73 953.187,1471.09 955.538,1339.79 957.888,1381.45 960.239,1468.68 962.589,1411.3 964.94,1432.82 967.29,1362.88 969.641,1504.2 971.991,1388.44 974.342,1456.96 976.692,1384.78 979.043,1333.7 981.393,1395.89 983.743,1628.63 986.094,1459.79 988.444,1540.29 990.795,1330.76 993.145,1509.8 995.496,1300.98 997.846,1545.32 1000.2,1348.86 1002.55,1323.5 1004.9,1439.1 1007.25,1424.55 1009.6,1553.49 1011.95,1485.09 1014.3,1434.93 1016.65,1396.42 1019,1507.82 1021.35,1448.09 1023.7,1587.7 1026.05,1364.72 1028.4,1391.53 1030.75,1585.09 1033.1,1412.04 1035.45,1299.68 1037.8,1185.11 1040.15,1444.53 1042.51,1397.04 1044.86,1396.71 1047.21,1452.45 1049.56,1465.87 1051.91,1436.66 1054.26,1443.86 1056.61,1546.78 1058.96,1587.3 1061.31,1543.21 1063.66,1517.32 1066.01,1348.12 1068.36,1365.54 1070.71,1422.74 1073.06,1454.82 1075.41,1275.94 1077.76,1380.3 1080.11,1429.77 1082.46,1492.28 1084.81,1587.45 1087.16,1523.31 1089.51,1499.6 1091.87,1294.57 1094.22,1249.4 1096.57,1391.81 1098.92,1323.74 1101.27,1361.92 1103.62,1540.21 1105.97,1751.15 1108.32,1405.76 1110.67,1405.99 1113.02,1383.65 1115.37,1393.67 1117.72,1341.98 1120.07,1633.19 1122.42,1437.53 1124.77,1194.99 1127.12,1377.47 1129.47,1416.34 1131.82,1417.65 1134.17,1539.2 1136.52,1293.09 1138.87,1710.12 1141.23,1415.33 1143.58,1515.88 1145.93,1577.73 1148.28,1400.64 1150.63,1566.63 1152.98,1599.38 1155.33,1162.94 1157.68,1443.38 1160.03,1327.8 1162.38,1432.43 1164.73,1448.97 1167.08,1278.63 1169.43,1452.1 1171.78,1493.18 1174.13,1427.86 1176.48,1519.63 1178.83,1427.19 1181.18,1503.03 1183.53,1466.34 1185.88,1489.12 1188.23,1584.32 1190.59,1353.89 1192.94,1478.28 1195.29,1536.19 1197.64,1473.11 1199.99,1476.69 1202.34,1383 1204.69,1461.78 1207.04,1339.47 1209.39,1128.8 1211.74,1340.77 1214.09,1428.14 1216.44,1501.91 1218.79,1359.91 1221.14,1477.28 1223.49,1379.07 1225.84,1423.91 1228.19,1459.48 1230.54,1315.8 1232.89,1276.85 1235.24,1383.56 1237.59,1416.13 1239.94,1445.08 1242.3,1422.85 1244.65,1397.15 1247,1520.36 1249.35,1355.07 1251.7,1401.19 1254.05,1514.61 1256.4,1416.89 1258.75,1246.99 1261.1,1336.35 1263.45,1310.82 1265.8,1316.48 1268.15,1271.62 1270.5,1460.7 1272.85,1290.74 1275.2,1346.25 1277.55,1313.15 1279.9,1574.96 1282.25,1511.73 1284.6,1492.5 1286.95,1572.44 1289.3,1381.83 1291.66,1507.12 1294.01,1341.55 1296.36,1451.47 1298.71,1411.09 1301.06,1533.75 1303.41,1399.27 1305.76,1458.51 1308.11,1359.81 1310.46,1418.53 1312.81,1398.19 1315.16,1681.54 1317.51,1500.34 1319.86,1558.95 1322.21,1356.33 1324.56,1604.12 1326.91,1645.55 1329.26,1573.74 1331.61,1460.15 1333.96,1466.73 1336.31,1366.24 1338.66,1459.52 1341.02,1458.86 1343.37,1376.62 1345.72,1374.84 1348.07,1443.2 1350.42,1443.89 1352.77,1508.23 1355.12,1471.92 1357.47,1425.12 1359.82,1492.84 1362.17,1394.27 1364.52,1501.47 1366.87,1343.32 1369.22,1338.89 1371.57,1246.33 1373.92,1582.33 1376.27,1476.34 1378.62,1340.94 1380.97,1417.39 1383.32,1543.01 1385.67,1333.65 1388.02,1467.38 1390.38,1479.79 1392.73,1531.21 1395.08,1286.38 1397.43,1407.63 1399.78,1572.15 1402.13,1518.79 1404.48,1479.59 1406.83,1442.23 1409.18,1371.12 1411.53,1342.55 1413.88,1289.25 1416.23,1462.51 1418.58,1363.63 1420.93,1282.62 1423.28,1266.53 1425.63,1498.53 1427.98,1530.45 1430.33,1240.37 1432.68,1303.72 1435.03,1427.1 1437.38,1220.98 1439.74,1420.75 1442.09,1394.74 1444.44,1386.58 1446.79,1554.63 1449.14,1345.11 1451.49,1498.49 1453.84,1220.6 1456.19,1341.88 1458.54,1585.31 1460.89,1473.01 1463.24,1573.84 1465.59,1392.97 1467.94,1495.53 1470.29,1288.53 1472.64,1378.88 1474.99,1447.69 1477.34,1563.78 1479.69,1529.31 1482.04,1397.65 1484.39,1275.65 1486.74,1459.94 1489.1,1288.49 1491.45,1501.27 1493.8,1279 1496.15,1380.83 1498.5,1381.14 1500.85,1409.82 1503.2,1537.15 1505.55,1443.21 1507.9,1585.12 1510.25,1525.27 1512.6,1429.72 1514.95,1496.64 1517.3,1260.51 1519.65,1471.89 1522,1311.74 1524.35,1330.79 1526.7,1243.22 1529.05,1344.51 1531.4,1602.48 1533.75,1278.69 1536.1,1271.91 1538.45,1410.78 1540.81,1430.22 1543.16,1173.45 1545.51,1392.22 1547.86,1390.86 1550.21,1440.84 1552.56,1453.61 1554.91,1654.08 1557.26,1435.59 1559.61,1298.61 1561.96,1401.66 1564.31,1528.55 1566.66,1435.36 1569.01,1529.43 1571.36,1504.35 1573.71,1550.84 1576.06,1481.67 1578.41,1410.82 1580.76,1403.9 1583.11,1629.96 1585.46,1413.02 1587.81,1387.48 1590.17,1479.58 1592.52,1276.04 1594.87,1655.16 1597.22,1371.85 1599.57,1499.09 1601.92,1319.85 1604.27,1456.44 1606.62,1304.39 1608.97,1404.28 1611.32,1278.09 1613.67,1480.61 1616.02,1439.42 1618.37,1376.4 1620.72,1506.66 1623.07,1317.47 1625.42,1396.43 1627.77,1353.38 1630.12,1456.06 1632.47,1492.12 1634.82,1576.43 1637.17,1498.34 1639.53,1376.02 1641.88,1474.34 1644.23,1280.13 1646.58,1531.64 1648.93,1394.67 1651.28,1305.41 1653.63,1499.96 1655.98,1340.5 1658.33,1366.2 1660.68,1568.19 1663.03,1435.07 1665.38,1314.05 1667.73,1203.11 1670.08,1373.27 1672.43,1314.22 1674.78,1581.98 1677.13,1373.86 1679.48,1594.78 1681.83,1459.8 1684.18,1536.38 1686.53,1417.2 1688.89,1317.84 1691.24,1444.83 1693.59,1464.48 1695.94,1363.65 1698.29,1347.6 1700.64,1396.77 1702.99,1564.91 1705.34,1326.17 1707.69,1622.14 1710.04,1331.37 1712.39,1461.75 1714.74,1449.14 1717.09,1509.39 1719.44,1443.35 1721.79,1342.21 1724.14,1461.96 1726.49,1461.96 1728.84,1326.21 1731.19,1303.88 1733.54,1315.53 1735.89,1493.37 1738.25,1425.9 1740.6,1507.01 1742.95,1303.95 1745.3,1480.58 1747.65,1332.22 1750,1613.92 1752.35,1456.85 1754.7,1409.47 1757.05,1500.86 1759.4,1530.89 1761.75,1513.06 1764.1,1495.42 1766.45,1552.55 1768.8,1291.14 1771.15,1372.17 1773.5,1168.1 1775.85,1313.65 1778.2,1515.95 1780.55,1459.71 1782.9,1352.72 1785.25,1293.96 1787.6,1557.3 1789.96,1307.78 1792.31,1400.83 1794.66,1517.57 1797.01,1380.06 1799.36,1487.09 1801.71,1592.31 1804.06,1444.47 1806.41,1358.29 1808.76,1301.24 1811.11,1363.82 1813.46,1557.69 1815.81,1531.51 1818.16,1466.8 1820.51,1494.7 1822.86,1409.07 1825.21,1451.89 1827.56,1305.58 1829.91,1463.43 1832.26,1272.18 1834.61,1484.32 1836.96,1416.22 1839.32,1260.91 1841.67,1401.52 1844.02,1446.89 1846.37,1629.04 1848.72,1563.63 1851.07,1538.21 1853.42,1517.5 1855.77,1293.15 1858.12,1356.87 1860.47,1444.36 1862.82,1557.34 1865.17,1345.64 1867.52,1311.41 1869.87,1391.17 1872.22,1477.38 1874.57,1455.93 1876.92,1455.97 1879.27,1399.42 1881.62,1276.88 1883.97,1323.84 1886.32,1448.62 1888.68,1402.5 1891.03,1446.16 1893.38,1335.27 1895.73,1288.99 1898.08,1424.44 1900.43,1569.32 1902.78,1459.22 1905.13,1391.99 1907.48,1630.63 1909.83,1490.02 1912.18,1482.11 1914.53,1278.54 1916.88,1589.27 1919.23,1311.19 1921.58,1269 1923.93,1172.24 1926.28,1394.39 1928.63,1237.15 1930.98,1523.24 1933.33,1353.94 1935.68,1263.18 1938.04,1302.9 1940.39,1344.9 1942.74,1426.46 1945.09,1608.52 1947.44,1437.7 1949.79,1372.65 1952.14,1462.31 1954.49,1408.9 1956.84,1234.56 1959.19,1170.24 1961.54,1285.63 1963.89,1502.14 1966.24,1551.53 1968.59,1385.53 1970.94,1531.32 1973.29,1347.43 1975.64,1386.42 1977.99,1267.87 1980.34,1312.89 1982.69,1424.19 1985.04,1560.85 1987.4,1454.16 1989.75,1270.17 1992.1,1530.68 1994.45,1415.39 1996.8,1427.97 1999.15,1613.59 2001.5,1429 2003.85,1443.08 2006.2,1459.69 2008.55,1451.31 2010.9,1510.75 2013.25,1440.51 2015.6,1316.5 2017.95,1421.21 2020.3,1710.22 2022.65,1277.97 2025,1476.78 2027.35,1472.96 2029.7,1250.33 2032.05,1243.89 2034.4,1459.82 2036.76,1257.09 2039.11,1286.77 2041.46,1578.83 2043.81,1436.24 2046.16,1247.32 2048.51,1434.61 2050.86,1245.94 2053.21,1526.68 2055.56,1425.71 2057.91,1548.59 2060.26,1512.04 2062.61,1503.73 2064.96,1422.52 2067.31,1415.68 2069.66,1550.57 2072.01,1391.66 2074.36,1595.39 2076.71,1316.1 2079.06,1510.17 2081.41,1432.28 2083.76,1574.61 2086.11,1513.6 2088.47,1408.11 2090.82,1456.42 2093.17,1383.62 2095.52,1419.86 2097.87,1396.28 2100.22,1537.07 2102.57,1530.79 2104.92,1467.69 2107.27,1521.83 2109.62,1504.21 2111.97,1158.92 2114.32,1287.89 2116.67,1539.27 2119.02,1543.97 2121.37,1400.42 2123.72,1401.51 2126.07,1411.59 2128.42,1486.88 2130.77,1377.03 2133.12,1503.62 2135.47,1314.9 2137.83,1378.22 2140.18,1511.49 2142.53,1569.08 2144.88,1458.49 2147.23,1644.31 2149.58,1447.37 2151.93,1628.31 2154.28,1422.02 2156.63,1479 2158.98,1303.21 2161.33,1419.68 2163.68,1496.02 2166.03,1502.43 2168.38,1456.71 2170.73,1513.97 2173.08,1460.4 2175.43,1432.73 2177.78,1445.75 2180.13,1368.55 2182.48,1497.81 2184.83,1355.22 2187.19,1390.46 2189.54,1287.97 2191.89,1489.73 2194.24,1521.78 2196.59,1448.02 2198.94,1480.2 2201.29,1460.14 2203.64,1247.28 2205.99,1525.56 2208.34,1416.03 2210.69,1469.94 2213.04,1595.34 2215.39,1525.42 2217.74,1481.72 2220.09,1224.44 2222.44,1612.93 2224.79,1507.47 2227.14,1531.65 2229.49,1610.72 2231.84,1430.82 2234.19,1440.91 2236.55,1463.18 2238.9,1592.94 2241.25,1455.86 2243.6,1509.08 2245.95,1418.39 2248.3,1389.42 2250.65,1357.68 2253,1604.54 2255.35,1289.38 2257.7,1590.47 2260.05,1547.75 2262.4,1371.97 2264.75,1301.28 2267.1,1375.73 2269.45,1471.94 2271.8,1335.74 2274.15,1583.14 2276.5,1639.4 2278.85,1432.73 2281.2,1358.71 2283.55,1408.82 2285.91,1420.65 2288.26,1315.66 2290.61,1515.05 2292.96,1348.1 2295.31,1194.64 2297.66,1393.04 2300.01,1322.04 2302.36,1528.67 2304.71,1382.53 2307.06,1572.43 2309.41,1145.42 2311.76,1356.53 2314.11,1456.46 2316.46,1379.88 2318.81,1650.65 2321.16,1312.17 2323.51,1364.47 2325.86,1510.96 2328.21,1311.94 2330.56,1341.27 2332.91,1486.39 2335.27,1577.59 2337.62,1415.83 2339.97,1386.91 2342.32,1192.78 2344.67,1494.05 2347.02,1346.25 2349.37,1532.87 2351.72,1689.37 2354.07,1463.46 2356.42,1590.35 2358.77,1365.67 2361.12,1388.26 2363.47,1473.68 2365.82,1311.54 2368.17,1261.86 2370.52,1329.19 2372.87,1478.15 2375.22,1538.32 2377.57,1247.16 2379.92,1355.43 2382.27,1458.44 2384.62,1413.76 2386.98,1306.69 2389.33,1269.57 2391.68,1316.94 2394.03,1426.73 2396.38,1336.21 2398.73,1309.5 2401.08,1484.2 2403.43,1409.3 2405.78,1260.29 2408.13,1393.65 2410.48,1390.79 2412.83,1481.96 2415.18,1512.21 2417.53,1502.26 2419.88,1389.37 2422.23,1485.42 2424.58,1491.71 2426.93,1452.87 2429.28,1338.18 2431.63,1490.66 2433.98,1332.9 2436.34,1402.3 2438.69,1532.16 2441.04,1212.56 2443.39,1496.49 2445.74,1234.97 2448.09,1371.55 2450.44,1460.9 2452.79,1626.93 2455.14,1345.39 2457.49,1558.16 2459.84,1548.05 2462.19,1486.15 2464.54,1156.47 2466.89,1551.54 2469.24,1351.66 2471.59,1477.73 2473.94,1404.13 2476.29,1421.77 2478.64,1575.63 2480.99,1441.96 2483.34,1458.9 2485.7,1353.09 2488.05,1351.12 2490.4,1467.46 2492.75,1273.76 2495.1,1443.78 2497.45,1323.82 2499.8,1423.92 2502.15,1569.23 2504.5,1327.15 2506.85,1271.48 2509.2,1496.04 2511.55,1192.8 2513.9,1425.7 2516.25,1479.69 2518.6,1418.38 2520.95,1333.55 2523.3,1415.24 2525.65,1357.66 2528,1411.56 2530.35,1408.44 2532.7,1517.85 2535.06,1576.58 2537.41,1444.81 2539.76,1396.93 2542.11,1400.96 2544.46,1247.73 2546.81,1472.55 2549.16,1418.13 2551.51,1287.13 2553.86,1378.99 2556.21,1608.23 2558.56,1418.38 2560.91,1438.98 2563.26,1609.16 2565.61,1383.49 2567.96,1461.32 2570.31,1284.07 "></polyline>
<polyline clip-path="url(#clip722)" style="stroke:#e26f46; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,879.667 224.541,904.098 226.891,855.013 229.242,997.605 231.592,1000.62 233.943,1017.22 236.293,841.287 238.644,909.645 240.994,911.157 243.345,1017.34 245.695,703.167 248.046,1022.74 250.396,976.028 252.747,960.048 255.097,754.94 257.448,1071.78 259.798,868.5 262.148,849.455 264.499,1051.1 266.849,882.962 269.2,781.155 271.55,976.918 273.901,1001.67 276.251,885.729 278.602,907.19 280.952,987.268 283.303,850.037 285.653,983.417 288.004,839.13 290.354,1045.83 292.705,1032.12 295.055,1060.2 297.406,808.153 299.756,960.711 302.107,1098.58 304.457,782.692 306.807,976.443 309.158,912.925 311.508,729.34 313.859,974.265 316.209,1034.6 318.56,955.195 320.91,878.064 323.261,927.35 325.611,1137.66 327.962,888.479 330.312,1135.88 332.663,1002.8 335.013,996.984 337.364,936.618 339.714,1148.77 342.065,852.894 344.415,994.293 346.765,1062.55 349.116,1099.72 351.466,927.696 353.817,1050.9 356.167,804.833 358.518,884.359 360.868,932.347 363.219,686.892 365.569,872.783 367.92,871.171 370.27,759.123 372.621,894.779 374.971,922.052 377.322,799.246 379.672,877.133 382.023,739.352 384.373,895.415 386.724,1033.18 389.074,892.027 391.424,1004.87 393.775,880.08 396.125,841.588 398.476,746.657 400.826,1046.82 403.177,959.821 405.527,852.051 407.878,947.15 410.228,954.354 412.579,914.937 414.929,861.706 417.28,859.758 419.63,785.074 421.981,1006.36 424.331,1095.27 426.682,983.434 429.032,922.544 431.382,766.13 433.733,965.296 436.083,973.615 438.434,989.75 440.784,937.965 443.135,1051.66 445.485,691.293 447.836,914.339 450.186,1021.76 452.537,1042.14 454.887,913.457 457.238,843.889 459.588,844.622 461.939,992.717 464.289,1049.35 466.64,1019.87 468.99,891.914 471.341,834.402 473.691,822.257 476.041,1001.51 478.392,1022.93 480.742,987.177 483.093,1036.32 485.443,999.328 487.794,913.438 490.144,1023.77 492.495,926.974 494.845,1053.24 497.196,901.706 499.546,1071.75 501.897,866.846 504.247,1064.83 506.598,1056.62 508.948,868.944 511.299,866.246 513.649,757.336 515.999,1008.65 518.35,842.281 520.7,896.171 523.051,840.094 525.401,839.066 527.752,944.451 530.102,849.888 532.453,860.146 534.803,960.553 537.154,1015.02 539.504,963.703 541.855,955.834 544.205,801.463 546.556,928.65 548.906,1033.96 551.257,812.947 553.607,804.781 555.958,972.591 558.308,967.626 560.658,784.679 563.009,830.558 565.359,885.64 567.71,1088.68 570.06,805.181 572.411,1010.13 574.761,971.863 577.112,1090.65 579.462,853.187 581.813,886.133 584.163,884.979 586.514,936.912 588.864,945.769 591.215,829.992 593.565,960.678 595.916,967.715 598.266,1098.77 600.616,939.064 602.967,958.451 605.317,829.92 607.668,1023.68 610.018,929.687 612.369,1101.14 614.719,844.075 617.07,914.159 619.42,858.537 621.771,810.392 624.121,903.584 626.472,903.118 628.822,1055.88 631.173,913.107 633.523,924.614 635.874,817.881 638.224,831.146 640.575,947.922 642.925,790.415 645.275,840.209 647.626,958.701 649.976,947.102 652.327,935.979 654.677,1129.78 657.028,1008.8 659.378,823.609 661.729,731.956 664.079,864.283 666.43,959.383 668.78,1011.21 671.131,902.574 673.481,847.051 675.832,887.919 678.182,917.692 680.533,897.499 682.883,1038.42 685.233,1069.93 687.584,916.134 689.934,973.005 692.285,940.489 694.635,1108.14 696.986,785.571 699.336,942.99 701.687,887.15 704.037,660.651 706.388,822.427 708.738,762.052 711.089,1029.88 713.439,864.655 715.79,972.194 718.14,941.258 720.491,976.445 722.841,1032.01 725.192,974.872 727.542,817.778 729.892,955.974 732.243,891.267 734.593,954.884 736.944,1055.14 739.294,1091.16 741.645,1082.57 743.995,1070.33 746.346,969.969 748.696,838.625 751.047,855.242 753.397,879.612 755.748,836.881 758.098,1008.69 760.449,855.256 762.799,1003.33 765.15,794.398 767.5,998.201 769.85,779.266 772.201,969.847 774.551,1051.57 776.902,1097.79 779.252,1018.03 781.603,909.51 783.953,1022.43 786.304,906.798 788.654,883.765 791.005,964.961 793.355,785.975 795.706,938.801 798.056,637.507 800.407,864.648 802.757,905.487 805.108,812.882 807.458,811.353 809.809,902.163 812.159,826.794 814.509,761.031 816.86,869.086 819.21,944.879 821.561,838.513 823.911,838.779 826.262,1036.13 828.612,965.576 830.963,1042.53 833.313,975.529 835.664,1095.76 838.014,1010.7 840.365,984.195 842.715,857.855 845.066,1034.52 847.416,1090.71 849.767,1034.33 852.117,1019.68 854.467,874.861 856.818,902.074 859.168,1043.63 861.519,908.648 863.869,785.591 866.22,919.03 868.57,949.111 870.921,949.445 873.271,833.735 875.622,1060.73 877.972,1000.39 880.323,1099.08 882.673,1155 885.024,950.012 887.374,1092.88 889.725,1048.99 892.075,872.27 894.426,1215.79 896.776,844.713 899.126,914.736 901.477,1074.82 903.827,1022.11 906.178,852.363 908.528,659.253 910.879,1061.02 913.229,868.503 915.58,775.427 917.93,773.514 920.281,644.707 922.631,983.044 924.982,983.314 927.332,982.255 929.683,1033.97 932.033,1156.18 934.384,975.082 936.734,821.95 939.084,980.352 941.435,1098.08 943.785,720.482 946.136,1037.71 948.486,1100.03 950.837,959.326 953.187,920.845 955.538,1095.06 957.888,903.335 960.239,1024.28 962.589,949.036 964.94,847.984 967.29,890.134 969.641,797.486 971.991,890.566 974.342,779.194 976.692,979.487 979.043,784.778 981.393,886.946 983.743,836.133 986.094,813.136 988.444,899.918 990.795,1104.17 993.145,917.291 995.496,997.377 997.846,845.29 1000.2,822.721 1002.55,939.912 1004.9,960.613 1007.25,822.104 1009.6,1003.29 1011.95,994.713 1014.3,948.392 1016.65,816.704 1019,821.709 1021.35,1010.43 1023.7,952.319 1026.05,674.505 1028.4,896.043 1030.75,823.847 1033.1,835.055 1035.45,1144.55 1037.8,1014.47 1040.15,873.588 1042.51,944.046 1044.86,920.388 1047.21,904.087 1049.56,1036.66 1051.91,1101.19 1054.26,899.925 1056.61,1076.62 1058.96,911.206 1061.31,877.434 1063.66,884.924 1066.01,945.62 1068.36,1000.56 1070.71,756.414 1073.06,972.071 1075.41,968.334 1077.76,1054.44 1080.11,945.936 1082.46,841.317 1084.81,1078.05 1087.16,963.229 1089.51,972.097 1091.87,1092.96 1094.22,824.022 1096.57,841.797 1098.92,1042.32 1101.27,926.735 1103.62,1046.91 1105.97,1002.36 1108.32,650.929 1110.67,889.188 1113.02,926.644 1115.37,970.949 1117.72,855.686 1120.07,1086.04 1122.42,862.017 1124.77,963 1127.12,855.61 1129.47,946.345 1131.82,1104.47 1134.17,737.364 1136.52,1070.71 1138.87,833.694 1141.23,969.067 1143.58,965.121 1145.93,992.595 1148.28,979.647 1150.63,906.823 1152.98,835.095 1155.33,706.119 1157.68,1109 1160.03,760.409 1162.38,791.135 1164.73,983.496 1167.08,924.612 1169.43,892.338 1171.78,1170.35 1174.13,910.743 1176.48,1126.21 1178.83,941.605 1181.18,1073.86 1183.53,937.674 1185.88,938.1 1188.23,1205.06 1190.59,882.805 1192.94,903.677 1195.29,794.811 1197.64,929.091 1199.99,747.619 1202.34,1015.96 1204.69,996.987 1207.04,887.943 1209.39,935.779 1211.74,696.312 1214.09,775.111 1216.44,820.577 1218.79,986.54 1221.14,965.74 1223.49,945.592 1225.84,845.854 1228.19,934.97 1230.54,926.022 1232.89,914.614 1235.24,868.505 1237.59,872.136 1239.94,913.43 1242.3,981.184 1244.65,893.564 1247,1104.94 1249.35,880.574 1251.7,897.279 1254.05,920.537 1256.4,789.056 1258.75,841.091 1261.1,889.617 1263.45,932.839 1265.8,792.163 1268.15,1147.54 1270.5,905.507 1272.85,871.476 1275.2,791.494 1277.55,1000.65 1279.9,826.703 1282.25,836.361 1284.6,964.653 1286.95,989.893 1289.3,1078.83 1291.66,1083.42 1294.01,827.871 1296.36,950.416 1298.71,928.27 1301.06,1094.4 1303.41,1065.6 1305.76,977.134 1308.11,760.492 1310.46,888.289 1312.81,939.118 1315.16,937.362 1317.51,1198.27 1319.86,838.849 1322.21,878.473 1324.56,864.812 1326.91,873.101 1329.26,932.989 1331.61,825.105 1333.96,869.651 1336.31,888.292 1338.66,896.265 1341.02,1008.98 1343.37,898.32 1345.72,907.731 1348.07,761.173 1350.42,1008.35 1352.77,925.147 1355.12,917.49 1357.47,785.296 1359.82,956.186 1362.17,1009.94 1364.52,986.03 1366.87,1097.93 1369.22,1050.77 1371.57,1040.97 1373.92,1073.09 1376.27,979.131 1378.62,988.93 1380.97,954.336 1383.32,945.051 1385.67,974.083 1388.02,889.393 1390.38,945.169 1392.73,794.139 1395.08,883.292 1397.43,908.81 1399.78,766.737 1402.13,886.357 1404.48,974.211 1406.83,1044.82 1409.18,1050.66 1411.53,856.048 1413.88,982.371 1416.23,798.66 1418.58,829.315 1420.93,999.064 1423.28,1052.14 1425.63,774.68 1427.98,872.056 1430.33,961.209 1432.68,724.183 1435.03,892.424 1437.38,1110.07 1439.74,863.275 1442.09,845.363 1444.44,939.489 1446.79,707.933 1449.14,947.527 1451.49,1030.01 1453.84,1056.09 1456.19,975.159 1458.54,832.04 1460.89,1020.8 1463.24,953.573 1465.59,975.477 1467.94,1028.64 1470.29,917.946 1472.64,853.646 1474.99,950.243 1477.34,972.353 1479.69,971.765 1482.04,893.014 1484.39,997.817 1486.74,1034.45 1489.1,885.309 1491.45,956.411 1493.8,997.494 1496.15,1070.58 1498.5,1182.99 1500.85,848.417 1503.2,961.83 1505.55,930.563 1507.9,923.496 1510.25,808.05 1512.6,1217.73 1514.95,823.461 1517.3,846.226 1519.65,1001.79 1522,855.48 1524.35,858.691 1526.7,962.782 1529.05,994.542 1531.4,898.152 1533.75,887.805 1536.1,886.789 1538.45,929.726 1540.81,1004.57 1543.16,692.135 1545.51,826.299 1547.86,970.648 1550.21,890.162 1552.56,939.154 1554.91,887.471 1557.26,1117.31 1559.61,988.094 1561.96,971.832 1564.31,929.344 1566.66,712.171 1569.01,725.794 1571.36,831.469 1573.71,939.589 1576.06,1101.23 1578.41,1022.27 1580.76,887.325 1583.11,853.515 1585.46,930.881 1587.81,830.21 1590.17,847.216 1592.52,1006.65 1594.87,887.698 1597.22,1034.62 1599.57,773.581 1601.92,947.172 1604.27,954.451 1606.62,1001.4 1608.97,909.429 1611.32,1021.25 1613.67,975.888 1616.02,752.813 1618.37,1032.5 1620.72,912.042 1623.07,1045.41 1625.42,721.237 1627.77,844.298 1630.12,969.348 1632.47,1068.14 1634.82,850.073 1637.17,970.446 1639.53,962.95 1641.88,864.975 1644.23,935.133 1646.58,884.591 1648.93,1079.58 1651.28,1011.3 1653.63,1003.72 1655.98,851.901 1658.33,944.365 1660.68,805.735 1663.03,964.812 1665.38,990.587 1667.73,873.831 1670.08,926.023 1672.43,779.789 1674.78,850.179 1677.13,795.373 1679.48,924.985 1681.83,802.012 1684.18,774.275 1686.53,1039.64 1688.89,675.023 1691.24,754.374 1693.59,1040.72 1695.94,789.946 1698.29,1069.22 1700.64,913.483 1702.99,876.693 1705.34,991.616 1707.69,1055.29 1710.04,909.578 1712.39,948.114 1714.74,862.113 1717.09,951.93 1719.44,939.095 1721.79,905.797 1724.14,807.378 1726.49,983.668 1728.84,918.205 1731.19,938.586 1733.54,1053.25 1735.89,937.832 1738.25,984.597 1740.6,810.204 1742.95,940.993 1745.3,1074.61 1747.65,868.771 1750,934.411 1752.35,1133.32 1754.7,1005.08 1757.05,904.442 1759.4,1030.72 1761.75,889.104 1764.1,1058.8 1766.45,999.17 1768.8,758.954 1771.15,1033.07 1773.5,1123.38 1775.85,909.859 1778.2,887.193 1780.55,819.473 1782.9,826.142 1785.25,869.818 1787.6,1030.02 1789.96,922.302 1792.31,832.416 1794.66,924.423 1797.01,924.685 1799.36,1035.24 1801.71,905.478 1804.06,1138.78 1806.41,1080.02 1808.76,804.977 1811.11,979.836 1813.46,931.26 1815.81,862.007 1818.16,744.736 1820.51,1024.78 1822.86,923.451 1825.21,1083.32 1827.56,955.836 1829.91,1161.91 1832.26,930.082 1834.61,939.637 1836.96,964.312 1839.32,837.679 1841.67,1075.03 1844.02,785.346 1846.37,966.224 1848.72,1018.57 1851.07,804.74 1853.42,838.65 1855.77,1132.83 1858.12,1078.78 1860.47,1047.63 1862.82,882.286 1865.17,857.255 1867.52,915.272 1869.87,745.876 1872.22,918.883 1874.57,828.105 1876.92,975.768 1879.27,857.964 1881.62,867.662 1883.97,993.071 1886.32,982.818 1888.68,994.916 1891.03,914.727 1893.38,843.009 1895.73,1167.89 1898.08,925.369 1900.43,864.299 1902.78,787.147 1905.13,795.827 1907.48,999.399 1909.83,966.964 1912.18,1093.46 1914.53,772.791 1916.88,769.912 1919.23,896.806 1921.58,1051.31 1923.93,1009.77 1926.28,908.819 1928.63,947.909 1930.98,825.77 1933.33,782.749 1935.68,931.65 1938.04,1144.07 1940.39,863.29 1942.74,1058.97 1945.09,918.714 1947.44,797.225 1949.79,919.087 1952.14,811.829 1954.49,856.903 1956.84,1013.23 1959.19,850.069 1961.54,948.459 1963.89,685.424 1966.24,833.553 1968.59,853.267 1970.94,1082.91 1973.29,794.164 1975.64,1010.05 1977.99,851.085 1980.34,880.979 1982.69,795.828 1985.04,952.252 1987.4,874.983 1989.75,1074.16 1992.1,741.511 1994.45,812.58 1996.8,731.402 1999.15,963.98 2001.5,924.285 2003.85,1055.72 2006.2,982.171 2008.55,856.317 2010.9,1037.52 2013.25,875.641 2015.6,1020.51 2017.95,984.455 2020.3,734.751 2022.65,917.321 2025,953.965 2027.35,980.103 2029.7,880.425 2032.05,748.096 2034.4,1074.79 2036.76,926.83 2039.11,988.622 2041.46,808.457 2043.81,1027.79 2046.16,1025.47 2048.51,996.036 2050.86,909.657 2053.21,839.497 2055.56,1051.54 2057.91,1051.57 2060.26,842.65 2062.61,845.796 2064.96,887.244 2067.31,1158.38 2069.66,937.927 2072.01,932.554 2074.36,1011.51 2076.71,815.421 2079.06,1011.62 2081.41,958.122 2083.76,943.056 2086.11,902.545 2088.47,1027.27 2090.82,910.783 2093.17,928.549 2095.52,995.565 2097.87,864.772 2100.22,1083.94 2102.57,1014.9 2104.92,1087.51 2107.27,771.114 2109.62,948.941 2111.97,997.841 2114.32,845.246 2116.67,839.291 2119.02,895.031 2121.37,875.934 2123.72,852.365 2126.07,1019.31 2128.42,1033.07 2130.77,989.967 2133.12,778.479 2135.47,982.672 2137.83,844.056 2140.18,918.557 2142.53,893.913 2144.88,854.234 2147.23,906.299 2149.58,860.659 2151.93,875.062 2154.28,900.329 2156.63,982.672 2158.98,904.091 2161.33,932.756 2163.68,1004.43 2166.03,896.638 2168.38,964.91 2170.73,1006.06 2173.08,1062.24 2175.43,1011.96 2177.78,1132.37 2180.13,847.756 2182.48,774.758 2184.83,1024.99 2187.19,917.451 2189.54,895.314 2191.89,860.884 2194.24,807.485 2196.59,987.991 2198.94,911.671 2201.29,954.538 2203.64,905.884 2205.99,762.603 2208.34,807.725 2210.69,1060.35 2213.04,896.343 2215.39,889.912 2217.74,875.128 2220.09,1010 2222.44,933.01 2224.79,1004.16 2227.14,1030.43 2229.49,924.474 2231.84,1194.7 2234.19,988.001 2236.55,1001.38 2238.9,783.023 2241.25,852.371 2243.6,1094.29 2245.95,800.692 2248.3,966.783 2250.65,1024.87 2253,855.735 2255.35,820.877 2257.7,991.252 2260.05,981.144 2262.4,1075.79 2264.75,829.613 2267.1,834.769 2269.45,913.027 2271.8,943.814 2274.15,1005.92 2276.5,932.273 2278.85,963.978 2281.2,926.358 2283.55,1028.29 2285.91,901.645 2288.26,994.28 2290.61,920.182 2292.96,838.426 2295.31,929.801 2297.66,935.375 2300.01,769.711 2302.36,753.365 2304.71,1007.82 2307.06,909.337 2309.41,983.997 2311.76,1139.01 2314.11,997.039 2316.46,892.413 2318.81,935.975 2321.16,908.881 2323.51,963.233 2325.86,855.136 2328.21,883.14 2330.56,942.708 2332.91,907.858 2335.27,668.875 2337.62,869.652 2339.97,938.773 2342.32,911.924 2344.67,999.882 2347.02,970.424 2349.37,944.2 2351.72,1000.39 2354.07,974.819 2356.42,935.539 2358.77,841.054 2361.12,1079.48 2363.47,1112.44 2365.82,958.2 2368.17,1081.03 2370.52,1013.77 2372.87,871.096 2375.22,1004.13 2377.57,777.744 2379.92,972.115 2382.27,953.268 2384.62,1004.98 2386.98,1010.17 2389.33,793.585 2391.68,905.315 2394.03,760.223 2396.38,890.305 2398.73,1185.19 2401.08,749.792 2403.43,1048.9 2405.78,981.487 2408.13,981.208 2410.48,908.045 2412.83,876.279 2415.18,1153.34 2417.53,1108.94 2419.88,622.413 2422.23,969.095 2424.58,1020.1 2426.93,967.651 2429.28,830.716 2431.63,1046.71 2433.98,942.333 2436.34,811.16 2438.69,971.16 2441.04,998.46 2443.39,1007.38 2445.74,847.654 2448.09,1057.41 2450.44,917.453 2452.79,888.957 2455.14,1177.78 2457.49,1071.45 2459.84,947.697 2462.19,1041.62 2464.54,954.016 2466.89,964.063 2469.24,837.333 2471.59,999.235 2473.94,873.374 2476.29,941.337 2478.64,1001.17 2480.99,1160.7 2483.34,907.027 2485.7,940.007 2488.05,841.12 2490.4,832.555 2492.75,817.885 2495.1,1032.34 2497.45,794.973 2499.8,841.401 2502.15,952.636 2504.5,751.437 2506.85,804.587 2509.2,993.072 2511.55,1040.93 2513.9,1093.13 2516.25,890.126 2518.6,923.268 2520.95,960.886 2523.3,982.707 2525.65,1013.86 2528,927.736 2530.35,984.171 2532.7,925.61 2535.06,903.6 2537.41,971.882 2539.76,988.699 2542.11,939.287 2544.46,822.474 2546.81,963.198 2549.16,880.169 2551.51,856.181 2553.86,1019.75 2556.21,946.128 2558.56,886.86 2560.91,1032.59 2563.26,890.544 2565.61,821.953 2567.96,954.903 2570.31,870.482 "></polyline>
<polyline clip-path="url(#clip722)" style="stroke:#3da44d; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,654.93 224.541,429.606 226.891,281.987 229.242,261.333 231.592,364.595 233.943,456.125 236.293,445.77 238.644,433.548 240.994,457.028 243.345,398.077 245.695,343.652 248.046,540.132 250.396,558.527 252.747,292.361 255.097,392.716 257.448,541.904 259.798,597.467 262.148,396.232 264.499,556.224 266.849,406.5 269.2,456.004 271.55,477.27 273.901,535.055 276.251,474.903 278.602,530.707 280.952,503.754 283.303,406.651 285.653,405.028 288.004,322.232 290.354,466.335 292.705,528.831 295.055,384.277 297.406,185.964 299.756,533.691 302.107,452.383 304.457,403.806 306.807,614.607 309.158,454.552 311.508,288.203 313.859,489.649 316.209,669.978 318.56,523.918 320.91,349.04 323.261,515.527 325.611,659.784 327.962,281.178 330.312,401.046 332.663,395.913 335.013,410.743 337.364,562.136 339.714,409.869 342.065,437.555 344.415,646.879 346.765,424.263 349.116,460.903 351.466,449.722 353.817,334.337 356.167,306.935 358.518,538.959 360.868,350.49 363.219,398.335 365.569,343.248 367.92,453.787 370.27,542.578 372.621,437.416 374.971,344.696 377.322,607.601 379.672,373.904 382.023,300.193 384.373,746.655 386.724,433.13 389.074,488.715 391.424,488.901 393.775,307.181 396.125,465.409 398.476,488.553 400.826,341.91 403.177,615.545 405.527,496.586 407.878,380.169 410.228,520.655 412.579,355.198 414.929,366.711 417.28,425.901 419.63,399.83 421.981,383.554 424.331,549.827 426.682,479.591 429.032,381.577 431.382,484.687 433.733,273.73 436.083,601.142 438.434,347.691 440.784,382.784 443.135,417.455 445.485,505.499 447.836,451.54 450.186,182.401 452.537,424.357 454.887,581.506 457.238,283.766 459.588,278.799 461.939,229.22 464.289,353.761 466.64,377.6 468.99,535.809 471.341,376.745 473.691,440.586 476.041,290.227 478.392,318.613 480.742,284.451 483.093,423.247 485.443,485.266 487.794,577.719 490.144,485.332 492.495,96.8724 494.845,334.071 497.196,431.023 499.546,305.52 501.897,513.084 504.247,420.651 506.598,468.854 508.948,469.294 511.299,359.349 513.649,518.605 515.999,420.889 518.35,469.055 520.7,471.59 523.051,379.421 525.401,631.546 527.752,651.408 530.102,527.883 532.453,449.667 534.803,506.183 537.154,336.683 539.504,481.737 541.855,486.78 544.205,458.489 546.556,413.399 548.906,430.135 551.257,215.591 553.607,412.256 555.958,434.876 558.308,268.346 560.658,466.923 563.009,494.855 565.359,674.555 567.71,408.308 570.06,426.781 572.411,418.268 574.761,504.565 577.112,409.038 579.462,331.416 581.813,331.062 584.163,450.074 586.514,331.645 588.864,519.626 591.215,478.947 593.565,529.909 595.916,115.108 598.266,493.277 600.616,573.29 602.967,304.968 605.317,499.585 607.668,492.045 610.018,437.183 612.369,382.834 614.719,319.564 617.07,478.348 619.42,338.439 621.771,265.473 624.121,406.241 626.472,451.508 628.822,352.471 631.173,389.727 633.523,625.682 635.874,606.185 638.224,491.605 640.575,393.171 642.925,570.964 645.275,528.362 647.626,374.553 649.976,491.669 652.327,540.922 654.677,413.772 657.028,392.739 659.378,444.283 661.729,271.781 664.079,385.822 666.43,451.496 668.78,333.608 671.131,439.432 673.481,240.462 675.832,468.655 678.182,369.758 680.533,542.658 682.883,425.551 685.233,513.251 687.584,479.989 689.934,546.388 692.285,497.613 694.635,418.485 696.986,355.291 699.336,507.513 701.687,414.984 704.037,557.455 706.388,382.361 708.738,566.369 711.089,386.807 713.439,723.616 715.79,467.637 718.14,525.27 720.491,301.398 722.841,535.673 725.192,343.918 727.542,397.112 729.892,361.441 732.243,524.65 734.593,420.843 736.944,453.637 739.294,419.32 741.645,576.207 743.995,349.708 746.346,532.578 748.696,542.677 751.047,573.912 753.397,516.343 755.748,282.855 758.098,321.893 760.449,421.632 762.799,514.769 765.15,448.283 767.5,441.281 769.85,498.838 772.201,485.963 774.551,401.743 776.902,550.7 779.252,419.931 781.603,441.098 783.953,532.819 786.304,292.63 788.654,490.043 791.005,366.025 793.355,563.332 795.706,481.691 798.056,294.38 800.407,581.775 802.757,287.491 805.108,225.974 807.458,514.48 809.809,575.909 812.159,452.382 814.509,523.363 816.86,414.427 819.21,441.899 821.561,301.442 823.911,369.864 826.262,486.56 828.612,230.213 830.963,420.202 833.313,392.871 835.664,349.19 838.014,623.839 840.365,605.564 842.715,289.429 845.066,472.136 847.416,236.331 849.767,394.429 852.117,377.772 854.467,250.939 856.818,552.735 859.168,574.678 861.519,398.973 863.869,195.674 866.22,568.902 868.57,380.049 870.921,305.029 873.271,315.632 875.622,414.176 877.972,437.412 880.323,489.232 882.673,360.413 885.024,291.861 887.374,358.143 889.725,510.234 892.075,590.941 894.426,326.869 896.776,356.88 899.126,535.283 901.477,570.683 903.827,345.741 906.178,380.215 908.528,567.629 910.879,383.229 913.229,428.178 915.58,324.13 917.93,443.984 920.281,184.785 922.631,461.574 924.982,515.715 927.332,429.286 929.683,346.135 932.033,283.715 934.384,515.83 936.734,355.635 939.084,425.031 941.435,523.449 943.785,460.815 946.136,430.03 948.486,487.985 950.837,365.577 953.187,483.004 955.538,542.808 957.888,525.816 960.239,387.637 962.589,543.406 964.94,530.741 967.29,451.136 969.641,291.429 971.991,474.638 974.342,550.275 976.692,356.096 979.043,502.845 981.393,338.175 983.743,330.882 986.094,491.895 988.444,460.434 990.795,380.076 993.145,356.781 995.496,371.894 997.846,476.349 1000.2,570.622 1002.55,506.963 1004.9,742.245 1007.25,476.624 1009.6,291.117 1011.95,342.825 1014.3,401.902 1016.65,425.863 1019,362.541 1021.35,406.597 1023.7,352.535 1026.05,420.819 1028.4,518 1030.75,376.201 1033.1,429.665 1035.45,366.183 1037.8,318.943 1040.15,507.263 1042.51,496.956 1044.86,348.788 1047.21,524.696 1049.56,368.745 1051.91,483.42 1054.26,469.618 1056.61,451.993 1058.96,435.665 1061.31,417.449 1063.66,480.659 1066.01,585.155 1068.36,259.602 1070.71,323.874 1073.06,299.547 1075.41,494.199 1077.76,339.052 1080.11,454.111 1082.46,289.494 1084.81,445.808 1087.16,286.111 1089.51,493.489 1091.87,674.655 1094.22,391.996 1096.57,573.645 1098.92,542.322 1101.27,428.638 1103.62,564.682 1105.97,484.966 1108.32,522.805 1110.67,606.809 1113.02,427.338 1115.37,413.611 1117.72,538.423 1120.07,520.541 1122.42,452.095 1124.77,338.545 1127.12,561.431 1129.47,459.081 1131.82,263.854 1134.17,552.817 1136.52,514.029 1138.87,434.646 1141.23,395.426 1143.58,425.303 1145.93,563.393 1148.28,346.566 1150.63,274.034 1152.98,377.575 1155.33,324.402 1157.68,410.892 1160.03,599.084 1162.38,378.332 1164.73,515.313 1167.08,355.296 1169.43,445.291 1171.78,373.835 1174.13,432.75 1176.48,357.848 1178.83,286.808 1181.18,263.084 1183.53,331.89 1185.88,356.768 1188.23,403.55 1190.59,277.282 1192.94,409.929 1195.29,530.782 1197.64,316.122 1199.99,439.694 1202.34,317.246 1204.69,319.188 1207.04,696.186 1209.39,296.555 1211.74,480.599 1214.09,412.366 1216.44,252.831 1218.79,552.381 1221.14,413.305 1223.49,434.998 1225.84,446.426 1228.19,499.96 1230.54,503.326 1232.89,465.242 1235.24,490.595 1237.59,394.149 1239.94,339.74 1242.3,256.522 1244.65,370.908 1247,454.654 1249.35,401.118 1251.7,465.448 1254.05,505.705 1256.4,499.338 1258.75,395.423 1261.1,467.167 1263.45,323.674 1265.8,412.007 1268.15,435.78 1270.5,376.345 1272.85,434.677 1275.2,251.623 1277.55,377.035 1279.9,268.418 1282.25,344.091 1284.6,421.974 1286.95,377.546 1289.3,477.192 1291.66,424.788 1294.01,448.719 1296.36,427.802 1298.71,287.311 1301.06,401.814 1303.41,453.427 1305.76,405.015 1308.11,467.697 1310.46,423.102 1312.81,513.128 1315.16,391.934 1317.51,570.597 1319.86,364.171 1322.21,282.981 1324.56,291.969 1326.91,632.294 1329.26,314.852 1331.61,485.084 1333.96,267.924 1336.31,190.609 1338.66,487.384 1341.02,659.502 1343.37,300.191 1345.72,517.661 1348.07,436.428 1350.42,365.867 1352.77,270.422 1355.12,465.97 1357.47,497.289 1359.82,641.099 1362.17,389.589 1364.52,452.759 1366.87,372.391 1369.22,460.946 1371.57,514.944 1373.92,675.037 1376.27,520.435 1378.62,453.721 1380.97,403.507 1383.32,384.717 1385.67,481.649 1388.02,395.74 1390.38,500.532 1392.73,325.787 1395.08,411.695 1397.43,422.831 1399.78,435.785 1402.13,312.484 1404.48,381.904 1406.83,637.831 1409.18,544.037 1411.53,377.816 1413.88,522.105 1416.23,438.691 1418.58,401.753 1420.93,504.686 1423.28,386.482 1425.63,350.748 1427.98,506.057 1430.33,354.439 1432.68,535 1435.03,424.402 1437.38,500.37 1439.74,490.835 1442.09,323.872 1444.44,452.092 1446.79,507.392 1449.14,362.224 1451.49,338.275 1453.84,638.026 1456.19,478.073 1458.54,416.1 1460.89,440.598 1463.24,331.275 1465.59,273.641 1467.94,460.307 1470.29,480.075 1472.64,394.701 1474.99,641.457 1477.34,434.079 1479.69,333.9 1482.04,475.843 1484.39,565.097 1486.74,537.57 1489.1,374.509 1491.45,488.053 1493.8,426.964 1496.15,366.494 1498.5,429.998 1500.85,567.034 1503.2,252.981 1505.55,280.251 1507.9,455.9 1510.25,622.638 1512.6,573.19 1514.95,341.943 1517.3,285.925 1519.65,521.403 1522,361.412 1524.35,640.099 1526.7,458.988 1529.05,322.602 1531.4,411.064 1533.75,530.859 1536.1,482.413 1538.45,270.864 1540.81,412.019 1543.16,470.025 1545.51,465.756 1547.86,375.71 1550.21,564.975 1552.56,559.683 1554.91,392.301 1557.26,533.919 1559.61,522.628 1561.96,512.629 1564.31,533.395 1566.66,410.47 1569.01,495.852 1571.36,301.53 1573.71,478.318 1576.06,389.695 1578.41,562.114 1580.76,502.502 1583.11,480.604 1585.46,380.392 1587.81,458.828 1590.17,235.553 1592.52,561.993 1594.87,461.134 1597.22,423.846 1599.57,603.274 1601.92,448.524 1604.27,463.976 1606.62,404.007 1608.97,375.255 1611.32,319.792 1613.67,532.689 1616.02,526.443 1618.37,193.053 1620.72,343.355 1623.07,437.715 1625.42,335.779 1627.77,372.633 1630.12,534.955 1632.47,409.243 1634.82,474.245 1637.17,421.698 1639.53,476.765 1641.88,479.971 1644.23,438.66 1646.58,556.654 1648.93,285.206 1651.28,554.221 1653.63,644.286 1655.98,468.535 1658.33,553.598 1660.68,518.135 1663.03,563.352 1665.38,417.457 1667.73,594.596 1670.08,188.65 1672.43,465.804 1674.78,422.572 1677.13,366.073 1679.48,448.945 1681.83,317.427 1684.18,471.454 1686.53,506.989 1688.89,479.138 1691.24,451.61 1693.59,530.934 1695.94,268.385 1698.29,549.822 1700.64,572.551 1702.99,405.143 1705.34,438.258 1707.69,428.111 1710.04,374.393 1712.39,389.717 1714.74,351.585 1717.09,323.003 1719.44,166.453 1721.79,424.374 1724.14,448.485 1726.49,375.704 1728.84,311.032 1731.19,595.884 1733.54,611.729 1735.89,311.334 1738.25,401.781 1740.6,450.981 1742.95,400.11 1745.3,528.246 1747.65,508.626 1750,566.004 1752.35,475.251 1754.7,530.273 1757.05,312.947 1759.4,347.648 1761.75,413.435 1764.1,294.956 1766.45,462.61 1768.8,462.662 1771.15,271.956 1773.5,428.665 1775.85,311.203 1778.2,404.361 1780.55,431.447 1782.9,522.366 1785.25,289.914 1787.6,325.227 1789.96,352.949 1792.31,494.973 1794.66,567.776 1797.01,549.147 1799.36,752.829 1801.71,412.648 1804.06,394.485 1806.41,511.347 1808.76,488.75 1811.11,355.792 1813.46,376.924 1815.81,505.021 1818.16,608.996 1820.51,520.908 1822.86,329.376 1825.21,476.044 1827.56,503.513 1829.91,318.144 1832.26,461.398 1834.61,404.268 1836.96,446.819 1839.32,293.789 1841.67,509.871 1844.02,538.123 1846.37,509.072 1848.72,718.083 1851.07,203.915 1853.42,607.465 1855.77,485.328 1858.12,471.419 1860.47,207.263 1862.82,401.602 1865.17,370.761 1867.52,460.171 1869.87,478.277 1872.22,285.458 1874.57,386.433 1876.92,509.519 1879.27,431.729 1881.62,508.819 1883.97,411.667 1886.32,440.099 1888.68,534.039 1891.03,595.87 1893.38,581.056 1895.73,451.867 1898.08,286.48 1900.43,446.993 1902.78,386.984 1905.13,475.634 1907.48,381.581 1909.83,358.04 1912.18,418.065 1914.53,581.95 1916.88,398.65 1919.23,329.599 1921.58,491.69 1923.93,439.384 1926.28,526.051 1928.63,490.857 1930.98,467.409 1933.33,672.377 1935.68,423.002 1938.04,323.387 1940.39,528.607 1942.74,492.361 1945.09,363.441 1947.44,463.949 1949.79,577.712 1952.14,413.784 1954.49,561.006 1956.84,321.481 1959.19,192.234 1961.54,358.389 1963.89,513.102 1966.24,407.578 1968.59,572.466 1970.94,491.941 1973.29,410.047 1975.64,358.139 1977.99,293.085 1980.34,322.157 1982.69,365.745 1985.04,689.332 1987.4,398.235 1989.75,532.848 1992.1,494.628 1994.45,400.855 1996.8,567.431 1999.15,582.667 2001.5,444.608 2003.85,440.479 2006.2,415.342 2008.55,301.087 2010.9,612.775 2013.25,406.937 2015.6,386.871 2017.95,641.269 2020.3,520.971 2022.65,472.684 2025,487.358 2027.35,532.131 2029.7,560.559 2032.05,300.57 2034.4,446.956 2036.76,482.972 2039.11,470.567 2041.46,319.33 2043.81,496.003 2046.16,400.096 2048.51,437.411 2050.86,447.165 2053.21,325.105 2055.56,391.49 2057.91,265.188 2060.26,444.668 2062.61,562.178 2064.96,440.641 2067.31,301.22 2069.66,479.087 2072.01,462.387 2074.36,412.606 2076.71,594.858 2079.06,280.783 2081.41,514.014 2083.76,496.856 2086.11,566.276 2088.47,331.207 2090.82,455.867 2093.17,376.811 2095.52,410.2 2097.87,552.564 2100.22,562.738 2102.57,476.76 2104.92,450.108 2107.27,386.904 2109.62,489.175 2111.97,480.094 2114.32,429.488 2116.67,481.1 2119.02,421.034 2121.37,587.823 2123.72,369.034 2126.07,526.43 2128.42,405.946 2130.77,403.622 2133.12,460.212 2135.47,354.914 2137.83,308.7 2140.18,426.289 2142.53,377.637 2144.88,444.839 2147.23,446.912 2149.58,361.283 2151.93,500.681 2154.28,655.228 2156.63,710.556 2158.98,552.264 2161.33,466.131 2163.68,542.326 2166.03,677.874 2168.38,421.654 2170.73,439.272 2173.08,445.497 2175.43,324.726 2177.78,600.884 2180.13,479.925 2182.48,400.413 2184.83,330.952 2187.19,427.439 2189.54,296.817 2191.89,380.125 2194.24,351.304 2196.59,537.774 2198.94,532.004 2201.29,557.265 2203.64,464.301 2205.99,280.268 2208.34,336.569 2210.69,407.005 2213.04,405.085 2215.39,352.325 2217.74,433.063 2220.09,283.721 2222.44,490.21 2224.79,502.177 2227.14,469.771 2229.49,367.973 2231.84,434.512 2234.19,577.101 2236.55,500.758 2238.9,460.872 2241.25,546.697 2243.6,371.057 2245.95,683.469 2248.3,365.52 2250.65,449.601 2253,236.741 2255.35,548.52 2257.7,391.306 2260.05,361.159 2262.4,441.583 2264.75,369.405 2267.1,483.872 2269.45,419.145 2271.8,258.175 2274.15,447.348 2276.5,412.546 2278.85,462.861 2281.2,464.212 2283.55,374.562 2285.91,480.755 2288.26,425.186 2290.61,519.666 2292.96,457.132 2295.31,345.306 2297.66,390.335 2300.01,579.293 2302.36,443.59 2304.71,543.584 2307.06,405.374 2309.41,401.674 2311.76,374.722 2314.11,620.563 2316.46,397.232 2318.81,362.948 2321.16,464.071 2323.51,459.538 2325.86,518.309 2328.21,617.386 2330.56,421.805 2332.91,371.72 2335.27,388.951 2337.62,431.474 2339.97,421.056 2342.32,324.536 2344.67,429.861 2347.02,501.758 2349.37,526.396 2351.72,548.047 2354.07,331.914 2356.42,593.214 2358.77,577.697 2361.12,317.429 2363.47,436.657 2365.82,522.074 2368.17,352.147 2370.52,330.057 2372.87,474.181 2375.22,501.376 2377.57,428.723 2379.92,351.154 2382.27,312.123 2384.62,418.729 2386.98,554.009 2389.33,499.23 2391.68,498.739 2394.03,424.589 2396.38,431.781 2398.73,466.193 2401.08,239.525 2403.43,410.161 2405.78,568.064 2408.13,416.277 2410.48,377.368 2412.83,384.555 2415.18,484.486 2417.53,467.456 2419.88,357.723 2422.23,324.33 2424.58,417.912 2426.93,534.649 2429.28,531.976 2431.63,491.912 2433.98,454.855 2436.34,360.854 2438.69,484.514 2441.04,324.936 2443.39,356.944 2445.74,367.612 2448.09,218.316 2450.44,572.409 2452.79,365.691 2455.14,365.317 2457.49,381.045 2459.84,488.662 2462.19,219.818 2464.54,510.137 2466.89,307.679 2469.24,676.58 2471.59,489.922 2473.94,461.265 2476.29,337.884 2478.64,397.765 2480.99,313.35 2483.34,358.396 2485.7,342.036 2488.05,280.587 2490.4,432.041 2492.75,459.491 2495.1,486.332 2497.45,358.734 2499.8,414.909 2502.15,384.425 2504.5,556.303 2506.85,467.895 2509.2,383.119 2511.55,402.613 2513.9,420.426 2516.25,614.77 2518.6,357.551 2520.95,418.967 2523.3,287.826 2525.65,293.01 2528,435.633 2530.35,532.087 2532.7,262.122 2535.06,470.724 2537.41,343.107 2539.76,642.215 2542.11,344.728 2544.46,455.639 2546.81,421.107 2549.16,547.543 2551.51,586.192 2553.86,388.46 2556.21,551.085 2558.56,508.177 2560.91,619.803 2563.26,546.594 2565.61,477.071 2567.96,534.338 2570.31,410.754 "></polyline>
</svg>
</div>
</div>
<p>Look at that! Things are working; amazin’.</p>
<p>We can also exploit <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>’s parallel sampling capabilities:</p>
<div id="34" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run separate 4 chains for 10 000 iterations using threads to parallelize.</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>num_chains <span class="op">=</span> <span class="fl">4</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    model_with_grad,</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">MCMCThreads</span>(),</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>,</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    num_chains;</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Note we need to provide an initial state for every chain.</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>    initial_state<span class="op">=</span><span class="fu">fill</span>(state, num_chains),</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>samples_array <span class="op">=</span> <span class="fu">stack</span>(<span class="fu">map</span>(<span class="bu">Base</span>.<span class="fu">Fix1</span>(stack, sample <span class="op">-&gt;</span> sample.x), samples))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000×4 Array{Float64, 3}:
[:, :, 1] =
 -3.30104   -4.95024  -6.17664  -4.15235   …  -3.5983    -3.5983    -4.09271
 -0.228164  -1.79823  -2.01892   0.146312      0.743834   0.743834   1.13681
  2.1042     2.82713   3.46486   3.84053       4.30162    4.30162    6.79932

[:, :, 2] =
 -3.69368    -5.82009   -5.63234  -5.2008    …  -4.9915   -4.97924  -3.76931
 -0.0496205   0.577907  -1.57777   0.304751      1.0818    1.22143   0.778544
  1.94572     3.91538    3.49162   4.7053        4.00465   5.31675   4.2676

[:, :, 3] =
 -0.622857  -3.32815  -3.32815  -4.75507  …  -5.0308    -5.0308    -5.3272
  0.169944   1.07055   1.07055   2.66357      0.107262   0.107262   0.260786
  3.09929    4.79846   4.79846   3.47192      5.19172    5.19172    6.93928

[:, :, 4] =
 -1.76338   -3.21007   -3.92463   -4.51167  …  -6.66808  -5.39058  -4.18016
 -0.587082  -0.737595  -0.100613   0.36787     -1.21832  -1.2377    1.02373
  3.39939    4.7476     3.67417    3.24351      4.03506   4.27779   5.0096</code></pre>
</div>
</div>
<p>But the fact that we have to provide the <code>AbstractMCMC.sample</code> call, etc. with an <code>initial_state</code> to get started is a bit annoying. We can avoid this by also defining a <code>AbstractMCMC.step</code> <em>without</em> the <code>state</code> argument:</p>
<div id="36" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">::</span><span class="dt">MALA</span>;</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># </span><span class="al">NOTE</span><span class="co">: No state provided!</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just create the initial state by sampling using  a Gaussian.</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="fu">randn</span>(rng, LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(x), <span class="fu">MALAState</span>(x)</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Equipped with this, we no longer need to provide the <code>initial_state</code> everywhere:</p>
<div id="38" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -4.99361    1.00919
 -0.0231721  1.00776
  5.02032    0.995661</code></pre>
</div>
</div>
</section>
<section id="using-our-sampler-with-turing.jl" class="level2">
<h2 class="anchored" data-anchor-id="using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</h2>
<p>As we promised, all of this hassle of implementing our <code>MALA</code> sampler in a way that uses <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> and <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> gets us something more than <em>just</em> an “automatic” implementation of <code>AbstractMCMC.sample</code>.</p>
<p>It also enables use with Turing.jl through the <code>externalsampler</code>, but we need to do one final thing first: we need to tell Turing.jl how to extract a vector of parameters from the “sample” returned in our implementation of <code>AbstractMCMC.step</code>. In our case, the “sample” is a <code>MALASample</code>, so we just need the following line:</p>
<div id="40" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load Turing.jl.</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Turing</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Overload the `getparams` method for our "sample" type, which is just a vector.</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>Turing.Inference.<span class="fu">getparams</span>(<span class="op">::</span><span class="dt">Turing.Model</span>, sample<span class="op">::</span><span class="dt">MALASample</span>) <span class="op">=</span> sample.x</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And with that, we’re good to go!</p>
<div id="42" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Our previous model defined as a Turing.jl model.</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">mvnormal_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">MvNormal</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.], I)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate our model.</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">mvnormal_model</span>()</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Call `sample` but now we're passing in a Turing.jl `model` and wrapping</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co"># our `MALA` sampler in the `externalsampler` to tell Turing.jl that the sampler</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co"># expects something that implements LogDensityProblems.jl.</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×4×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 2.49 seconds
Compute duration  = 2.49 seconds
parameters        = x[1], x[2], x[3]
internals         = lp

Summary Statistics
  parameters      mean       std      mcse    ess_bulk    ess_tail      rhat   ⋯
      Symbol   Float64   Float64   Float64     Float64     Float64   Float64   ⋯

        x[1]   -5.0108    1.0055    0.0180   3132.1497   4921.3316    1.0003   ⋯
        x[2]    0.0012    1.0008    0.0174   3297.3336   5151.3502    0.9999   ⋯
        x[3]    5.0127    1.0104    0.0179   3170.7032   5451.7221    1.0003   ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

        x[1]   -6.9885   -5.6962   -5.0151   -4.3274   -3.0660
        x[2]   -2.0265   -0.6581    0.0134    0.6769    1.9409
        x[3]    2.9900    4.3451    5.0232    5.7155    6.9093</code></pre>
</div>
</div>
<p>Pretty neat, eh?</p>
<section id="models-with-constrained-parameters" class="level3">
<h3 class="anchored" data-anchor-id="models-with-constrained-parameters">Models with constrained parameters</h3>
<p>One thing we’ve sort of glossed over in all of the above is that MALA, at least how we’ve implemented it, requires <span class="math inline">\(x\)</span> to live in <span class="math inline">\(\mathbb{R}^d\)</span> for some <span class="math inline">\(d &gt; 0\)</span>. If some of the parameters were in fact constrained, e.g.&nbsp;we were working with a <code>Beta</code> distribution which has support on the interval <span class="math inline">\((0, 1)\)</span>, <em>not</em> on <span class="math inline">\(\mathbb{R}^d\)</span>, we could easily end up outside of the valid range <span class="math inline">\((0, 1)\)</span>.</p>
<div id="44" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">beta_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">beta_model</span>()</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 1.44 seconds
Compute duration  = 1.44 seconds
parameters        = x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse    ess_bulk    ess_tail      rhat   ⋯
      Symbol   Float64   Float64   Float64     Float64     Float64   Float64   ⋯

           x    0.5007    0.1872    0.0027   4690.7671   6120.0782    0.9999   ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

           x    0.1522    0.3598    0.5018    0.6416    0.8485</code></pre>
</div>
</div>
<p>Yep, that still works, but only because Turing.jl actually <em>transforms</em> the <code>turing_model</code> from constrained to unconstrained, so that the <code>sampler</code> provided to <code>externalsampler</code> is actually always working in unconstrained space! This is not always desirable, so we can turn this off:</p>
<div id="46" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 0.24 seconds
Compute duration  = 0.24 seconds
parameters        = x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse   ess_bulk   ess_tail      rhat   e ⋯
      Symbol   Float64   Float64   Float64    Float64    Float64   Float64     ⋯

           x    0.4880    0.2304    0.0437    25.2909        NaN    1.3962     ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

           x    0.1932    0.2247    0.4917    0.6929    0.8130</code></pre>
</div>
</div>
<p>The fun thing is that this still sort of works because</p>
<div id="48" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">logpdf</span>(<span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>), <span class="fl">10.0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-Inf</code></pre>
</div>
</div>
<p>and so the samples that fall outside of the range are always rejected. But do notice how much worse all the diagnostics are, e.g.&nbsp;<code>ess_tail</code> is very poor compared to when we use <code>unconstrained=true</code>. Moreover, in more complex cases this won’t just result in a “nice” <code>-Inf</code> log-density value, but instead will error:</p>
<div id="50" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="kw">function</span> <span class="fu">demo</span>()</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>    σ² <span class="op">~</span> <span class="fu">truncated</span>(<span class="fu">Normal</span>(), lower<span class="op">=</span><span class="fl">0</span>)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If we end up with negative values for `σ²`, the `Normal` will error.</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>    x <span class="op">~</span> <span class="fu">Normal</span>(<span class="fl">0</span>, σ²)</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 2.31 seconds
Compute duration  = 2.31 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse   ess_bulk   ess_tail      rhat   e ⋯
      Symbol   Float64   Float64   Float64    Float64    Float64   Float64     ⋯

          σ²    0.5313    0.0000    0.0000        NaN        NaN       NaN     ⋯
           x    2.2216    0.0000    0.0000        NaN        NaN       NaN     ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

          σ²    0.5313    0.5313    0.5313    0.5313    0.5313
           x    2.2216    2.2216    2.2216    2.2216    2.2216</code></pre>
</div>
</div>
<p>As expected, we run into a <code>DomainError</code> at some point, while if we set <code>unconstrained=true</code>, letting Turing.jl transform the model to a unconstrained form behind the scenes, everything works as expected:</p>
<div id="52" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 0.57 seconds
Compute duration  = 0.57 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse   ess_bulk   ess_tail      rhat   e ⋯
      Symbol   Float64   Float64   Float64    Float64    Float64   Float64     ⋯

          σ²    0.8266    0.5215    0.0225   335.9759   120.5654    1.0008     ⋯
           x   -0.0054    0.8812    0.0325   887.9107   677.8859    1.0010     ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

          σ²    0.1221    0.4150    0.7287    1.1452    2.0486
           x   -1.9988   -0.4330   -0.0192    0.4170    1.9315</code></pre>
</div>
</div>
<p>Neat!</p>
<p>Similarly, which automatic differentiation backend one should use can be specified through the <code>adtype</code> keyword argument too. For example, if we want to use <a href="https://github.com/JuliaDiff/ReverseDiff.jl">ReverseDiff.jl</a> instead of the default <a href="https://github.com/JuliaDiff/ForwardDiff.jl">ForwardDiff.jl</a>:</p>
<div id="54" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">ReverseDiff</span>: ReverseDiff</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify that we want to use `AutoReverseDiff`.</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">demo</span>(),</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>, adtype<span class="op">=</span><span class="fu">AutoReverseDiff</span>()),</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>;</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 2.98 seconds
Compute duration  = 2.98 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse   ess_bulk   ess_tail      rhat   e ⋯
      Symbol   Float64   Float64   Float64    Float64    Float64   Float64     ⋯

          σ²    0.8455    0.5525    0.0271   287.5989    86.6380    1.0046     ⋯
           x    0.0116    0.9908    0.0491   508.5951   346.3335    1.0007     ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

          σ²    0.1102    0.4040    0.7524    1.1785    2.1338
           x   -2.1479   -0.4255    0.0072    0.4397    2.3451</code></pre>
</div>
</div>
<p>Double-neat.</p>
</section>
</section>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<p>At this point it’s worth maybe reminding ourselves what we did and also <em>why</em> we did it:</p>
<ol type="1">
<li>We define our models in the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface because it makes the sampler agnostic to how the underlying model is implemented.</li>
<li>We implement our sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> interface, which just means that our sampler is a subtype of <code>AbstractMCMC.AbstractSampler</code> and we implement the MCMC transition in <code>AbstractMCMC.step</code>.</li>
<li>Points 1 and 2 makes it so our sampler can be used with a wide range of model implementations, amongst them being models implemented in both Turing.jl and Stan. This gives you, the inference implementer, a large collection of models to test your inference method on, in addition to allowing users of Turing.jl and Stan to try out your inference method with minimal effort.</li>
</ol>


</section>


<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a><div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>We’re going with the leapfrog formulation because in a future version of this tutorial we’ll add a section extending this simple “baseline” MALA sampler to more complex versions. See <a href="https://github.com/TuringLang/docs/issues/479">issue #479</a> for progress on this.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>There is no such thing as a proper interface in Julia (at least not officially), and so we use the word “interface” here to mean a few minimal methods that needs to be implemented by any type that we treat as a target model.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/turinglang\.org\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../tutorials/docs-07-for-developers-variational-inference/index.html" class="pagination-link" aria-label="Variational Inference">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Variational Inference</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Turing is created by <a href="http://mlg.eng.cam.ac.uk/hong/" target="_blank">Hong Ge</a>, and lovingly maintained by the <a href="https://github.com/TuringLang/Turing.jl/graphs/contributors" target="_blank">core team</a> of volunteers. <br> The contents of this website are © 2024 under the terms of the <a href="https://github.com/TuringLang/Turing.jl/blob/master/LICENCE" target="_blank">MIT License</a>.</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/TuringLang/docs/edit/master/tutorials/docs-17-implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/docs/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://x.com/TuringLang">
      <i class="bi bi-twitter" role="img" aria-label="Turing Twitter">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/TuringLang/Turing.jl">
      <i class="bi bi-github" role="img" aria-label="Turing GitHub">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




<script src="../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>