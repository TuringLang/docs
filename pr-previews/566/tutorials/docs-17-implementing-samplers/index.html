<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.3">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Implementing samplers – Turing.jl</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../tutorials/docs-07-for-developers-variational-inference/index.html" rel="prev">
<link href="../../assets/favicon.ico" rel="icon">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-81b5c3e63835cfde897ecd3d35a35a41.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark-c634bf5241e7a0f0add955421922332b.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-5870358ca908ec11c7112509c02a969e.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark-44ada009216185fff2c787be4097b66f.min.css" rel="prefetch" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<style>
  a {
    text-decoration: none;
  }
  a:hover {
    text-decoration: underline;
  }
</style>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../theming/styles.css">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="https://turinglang.org/" class="navbar-brand navbar-brand-logo">
    <img src="../../assets/images/turing-logo.svg" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="https://turinglang.org/">
    <span class="navbar-title">Turing.jl</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../tutorials/docs-00-getting-started/"> 
<span class="menu-text">Get Started</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../tutorials/00-introduction/"> 
<span class="menu-text">Tutorials</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/library/"> 
<span class="menu-text">Libraries</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/news/"> 
<span class="menu-text">News</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/team/"> 
<span class="menu-text">Team</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-v0.35" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">v0.35</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-v0.35">    
        <li>
    <a class="dropdown-item" href="https://turinglang.org/docs/changelog.html">
 <span class="dropdown-text">Changelog</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://turinglang.org/docs/versions.html">
 <span class="dropdown-text">All Versions</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools tools-wide">
    <a href="https://x.com/TuringLang" title="Turing Twitter" class="quarto-navigation-tool px-1" aria-label="Turing Twitter"><i class="bi bi-twitter"></i></a>
    <a href="https://github.com/TuringLang/Turing.jl" title="Turing GitHub" class="quarto-navigation-tool px-1" aria-label="Turing GitHub"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Developers</li><li class="breadcrumb-item"><a href="../../tutorials/docs-06-for-developers-interface/index.html">Inference (note: outdated)</a></li><li class="breadcrumb-item"><a href="../../tutorials/docs-17-implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false">
 <span class="menu-text">Users</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-00-getting-started/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Getting Started</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-12-using-turing-guide/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Core Functionality</span></a>
  </div>
</li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false">
 <span class="menu-text">Usage Tips</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-10-using-turing-autodiff/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Automatic Differentiation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/usage-custom-distribution/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Custom Distributions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/usage-probability-interface/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Querying Model Probabilities</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/usage-modifying-logprob/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Modifying the Log Probability</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/usage-generated-quantities/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Generated Quantities</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-17-mode-estimation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Mode Estimation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-13-using-turing-performance-tips/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Performance Tips</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-15-using-turing-sampler-viz/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Sampler Visualization</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-11-using-turing-dynamichmc/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using DynamicHMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-16-using-turing-external-samplers/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using External Samplers</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false">
 <span class="menu-text">Tutorials</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/00-introduction/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction: Coin Flipping</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/01-gaussian-mixture-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Mixture Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/02-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/03-bayesian-neural-network/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Neural Networks</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/04-hidden-markov-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Hidden Markov Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/05-linear-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Linear Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/06-infinite-mixture-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Infinite Mixture Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/07-poisson-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Poisson Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/08-multinomial-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Multinomial Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/09-variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/10-bayesian-differential-equations/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Differential Equations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/11-probabilistic-pca/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Probabilistic PCA</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/13-seasonal-time-series/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Time Series Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/15-gaussian-processes/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction to Gaussian Processes</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/12-gplvm/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Process Latent Variable Models</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Developers</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false">
 <span class="menu-text">Contributing</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-01-contributing-guide/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">How to Contribute</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="false">
 <span class="menu-text">DynamicPPL in Depth</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/dev-model-manual/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Manually Defining a Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-05-for-developers-compiler/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Turing Compiler Design</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/14-minituring/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation I: Compiler</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/16-contexts/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation II: Contexts</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true">
 <span class="menu-text">Inference (note: outdated)</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-06-for-developers-interface/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Interface Guide</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-04-for-developers-abstractmcmc-turing/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">How Turing implements AbstractMCMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-07-for-developers-variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-17-implementing-samplers/index.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Implementing Samplers</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of Contents</h2>
   
  <ul>
  <li><a href="#quick-overview-of-mala" id="toc-quick-overview-of-mala" class="nav-link active" data-scroll-target="#quick-overview-of-mala">Quick overview of MALA</a></li>
  <li><a href="#what-we-need-from-a-model-logdensityproblems.jl" id="toc-what-we-need-from-a-model-logdensityproblems.jl" class="nav-link" data-scroll-target="#what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: LogDensityProblems.jl</a></li>
  <li><a href="#implementing-mala-in-abstractmcmc.jl" id="toc-implementing-mala-in-abstractmcmc.jl" class="nav-link" data-scroll-target="#implementing-mala-in-abstractmcmc.jl">Implementing MALA in AbstractMCMC.jl</a></li>
  <li><a href="#using-our-sampler-with-turing.jl" id="toc-using-our-sampler-with-turing.jl" class="nav-link" data-scroll-target="#using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</a>
  <ul class="collapse">
  <li><a href="#models-with-constrained-parameters" id="toc-models-with-constrained-parameters" class="nav-link" data-scroll-target="#models-with-constrained-parameters">Models with constrained parameters</a></li>
  </ul></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/TuringLang/docs/edit/master/tutorials/docs-17-implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/docs/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Developers</li><li class="breadcrumb-item"><a href="../../tutorials/docs-06-for-developers-interface/index.html">Inference (note: outdated)</a></li><li class="breadcrumb-item"><a href="../../tutorials/docs-17-implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Implementing samplers</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>In this tutorial, we’ll go through step-by-step how to implement a “simple” sampler in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> in such a way that it can be easily applied to Turing.jl models.</p>
<p>In particular, we’re going to implement a version of <strong>Metropolis-adjusted Langevin (MALA)</strong>.</p>
<p>Note that we will implement this sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> framework, completely “ignoring” Turing.jl until the very end of the tutorial, at which point we’ll use a single line of code to make the resulting sampler available to Turing.jl. This is to really drive home the point that one can implement samplers in a way that is accessible to all of Turing.jl’s users without having to use Turing.jl yourself.</p>
<section id="quick-overview-of-mala" class="level2">
<h2 class="anchored" data-anchor-id="quick-overview-of-mala">Quick overview of MALA</h2>
<p>We can view MALA as a single step of the leapfrog intergrator with resampling of momentum <span class="math inline">\(p\)</span> at every step.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> To make that statement a bit more concrete, we first define the <em>extended</em> target <span class="math inline">\(\bar{\gamma}(x, p)\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\log \bar{\gamma}(x, p) \propto \log \gamma(x) + \log \gamma_{\mathcal{N}(0, M)}(p)
\end{equation*}\]</span></p>
<p>where <span class="math inline">\(\gamma_{\mathcal{N}(0, M)}\)</span> denotes the density for a zero-centered Gaussian with covariance matrix <span class="math inline">\(M\)</span>. We then consider targeting this joint distribution over both <span class="math inline">\(x\)</span> and <span class="math inline">\(p\)</span> as follows. First we define the map</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  L_{\epsilon}: \quad &amp; \mathbb{R}^d \times \mathbb{R}^d \to \mathbb{R}^d \times \mathbb{R}^d \\
  &amp; (x, p) \mapsto (\tilde{x}, \tilde{p}) := L_{\epsilon}(x, p)
\end{split}
\end{equation*}\]</span></p>
<p>as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p_{1 / 2} &amp;:= p + \frac{\epsilon}{2} \nabla \log \gamma(x) \\
  \tilde{x} &amp;:= x + \epsilon M^{-1} p_{1 /2 } \\
  p_1 &amp;:= p_{1 / 2} + \frac{\epsilon}{2} \nabla \log \gamma(\tilde{x}) \\
  \tilde{p} &amp;:= - p_1
\end{split}
\end{equation*}\]</span></p>
<p>This might be familiar for some readers as a single step of the Leapfrog integrator. We then define the MALA kernel as follows: given the current iterate <span class="math inline">\(x_i\)</span>, we sample the next iterate <span class="math inline">\(x_{i + 1}\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p &amp;\sim \mathcal{N}(0, M) \\
  (\tilde{x}, \tilde{p}) &amp;:= L_{\epsilon}(x_i, p) \\
  \alpha &amp;:= \min \left\{ 1, \frac{\bar{\gamma}(\tilde{x}, \tilde{p})}{\bar{\gamma}(x_i, p)} \right\} \\
  x_{i + 1} &amp;:=
  \begin{cases}
    \tilde{x} \quad &amp; \text{ with prob. } \alpha \\
    x_i       \quad &amp; \text{ with prob. } 1 - \alpha
  \end{cases}
\end{split}
\end{equation*}\]</span></p>
<p>i.e.&nbsp;we accept the proposal <span class="math inline">\(\tilde{x}\)</span> with probability <span class="math inline">\(\alpha\)</span> and reject it, thus sticking with our current iterate, with probability <span class="math inline">\(1 - \alpha\)</span>.</p>
</section>
<section id="what-we-need-from-a-model-logdensityproblems.jl" class="level2">
<h2 class="anchored" data-anchor-id="what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a></h2>
<p>There are a few things we need from the “target” / “model” / density that we want to sample from:</p>
<ol type="1">
<li>We need access to log-density <em>evaluations</em> <span class="math inline">\(\log \gamma(x)\)</span> so we can compute the acceptance ratio involving <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>We need access to log-density <em>gradients</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span> so we can compute the Leapfrog steps <span class="math inline">\(L_{\epsilon}(x, p)\)</span>.</li>
<li>We also need access to the “size” of the model so we can determine the size of <span class="math inline">\(M\)</span>.</li>
</ol>
<p>Luckily for us, there is a package called <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> which provides an interface for <em>exactly</em> this!</p>
<p>To demonstrate how one can implement the “<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface”<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> we will use a simple Gaussian model as an example:</p>
<div id="4" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblems</span>: LogDensityProblems;</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's define some type that represents the model.</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> IsotropicNormalModel{M<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"mean of the isotropic Gaussian"</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    mean<span class="op">::</span><span class="dt">M</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Specifies what input length the model expects.</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">dimension</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> <span class="fu">length</span>(model.mean)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Implementation of the log-density evaluation of the model.</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x<span class="op">::</span><span class="dt">AbstractVector{&lt;:Real}</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">-</span> <span class="fu">sum</span>(abs2, x <span class="op">.-</span> model.mean) <span class="op">/</span> <span class="fl">2</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This gives us all of the properties we want for our MALA sampler with the exception of the computation of the <em>gradient</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span>. There is the method <code>LogDensityProblems.logdensity_and_gradient</code> which should return a 2-tuple where the first entry is the evaluation of the logdensity <span class="math inline">\(\log \gamma(x)\)</span> and the second entry is the gradient <span class="math inline">\(\nabla \log \gamma(x)\)</span>.</p>
<p>There are two ways to “implement” this method: 1) we implement it by hand, which is feasible in the case of our <code>IsotropicNormalModel</code>, or b) we defer the implementation of this to a automatic differentiation backend.</p>
<p>To implement it by hand we can simply do</p>
<div id="6" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl that first-order, i.e. gradient information, is available.</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{1}</span>()</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Implement `logdensity_and_gradient`.</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    logγ_x <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="op">-</span>x <span class="op">.*</span> (x <span class="op">-</span> model.mean)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> logγ_x, ∇logγ_x</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s just try it out:</p>
<div id="8" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate the problem.</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> <span class="fu">IsotropicNormalModel</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.])</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create some example input that we can test on.</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>x_example <span class="op">=</span> <span class="fu">randn</span>(LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate!</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-28.78859894753279</code></pre>
</div>
</div>
<p>To defer it to an automatic differentiation backend, we can do</p>
<div id="10" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl we only have access to 0-th order information.</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{0}</span>()</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Use `LogDensityProblemsAD`'s `ADgradient` in combination with some AD backend to implement `logdensity_and_gradient`.</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblemsAD</span>, <span class="bu">ADTypes</span>, <span class="bu">ForwardDiff</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>model_with_grad <span class="op">=</span> <span class="fu">ADgradient</span>(<span class="fu">AutoForwardDiff</span>(), model)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model_with_grad, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-28.78859894753279</code></pre>
</div>
</div>
<p>We’ll continue with the second approach in this tutorial since this is typically what one does in practice, because there are better hobbies to spend time on than deriving gradients by hand.</p>
<p>At this point, one might wonder how we’re going to tie this back to Turing.jl in the end. Effectively, when working with inference methods that only require log-density evaluations and / or higher-order information of the log-density, Turing.jl actually converts the user-provided <code>Model</code> into an object implementing the above methods for <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>. As a result, most samplers provided by Turing.jl are actually implemented to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, enabling their use both <em>within</em> Turing.jl and <em>outside</em> of Turing.jl! Morever, there exists similar conversions for Stan through BridgeStan and Stan<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, which means that a sampler supporting the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface can easily be used on both Turing.jl <em>and</em> Stan models (in addition to user-provided models, as our <code>IsotropicNormalModel</code> above)!</p>
<p>Anyways, let’s move on to actually implementing the sampler.</p>
</section>
<section id="implementing-mala-in-abstractmcmc.jl" class="level2">
<h2 class="anchored" data-anchor-id="implementing-mala-in-abstractmcmc.jl">Implementing MALA in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a></h2>
<p>Now that we’ve established that a model implementing the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface provides us with all the information we need from <span class="math inline">\(\log \gamma(x)\)</span>, we can address the question: given an object that implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, how can we define a sampler for it?</p>
<p>We’re going to do this by making our sampler a sub-type of <code>AbstractMCMC.AbstractSampler</code> in addition to implementing a few methods from <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>. Why? Because it gets us <em>a lot</em> of functionality for free, as we will see later.</p>
<p>Moreover, <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> provides a very natural interface for MCMC algorithms.</p>
<p>First, we’ll define our <code>MALA</code> type</p>
<div id="12" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">AbstractMCMC</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALA{T,A} <span class="op">&lt;:</span><span class="dt"> AbstractMCMC.AbstractSampler</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"stepsize used in the leapfrog step"</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    ϵ_init<span class="op">::</span><span class="dt">T</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"covariance matrix used for the momentum"</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    M_init<span class="op">::</span><span class="dt">A</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notice how we’ve added the suffix <code>_init</code> to both the stepsize and the covariance matrix. We’ve done this because a <code>AbstractMCMC.AbstractSampler</code> should be <em>immutable</em>. Of course there might be many scenarios where we want to allow something like the stepsize and / or the covariance matrix to vary between iterations, e.g.&nbsp;during the burn-in / adaptation phase of the sampling process we might want to adjust the parameters using statistics computed from these initial iterations. But information which can change between iterations <em>should not go in the sampler itself</em>! Instead, this information should go in the sampler <em>state</em>.</p>
<p>The sampler state should at the very least contain all the necessary information to perform the next MCMC iteration, but usually contains further information, e.g.&nbsp;quantities and statistics useful for evaluating whether the sampler has converged.</p>
<p>We will use the following sampler state for our <code>MALA</code> sampler:</p>
<div id="14" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALAState{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This might seem overly redundant: we’re defining a type <code>MALAState</code> and it only contains a simple vector of reals. In this particular case we indeed could have dropped this and simply used a <code>AbstractVector{&lt;:Real}</code> as our sampler state, but typically, as we will see later, one wants to include other quantities in the sampler state. For example, if we also wanted to adapt the parameters of our <code>MALA</code>, e.g.&nbsp;alter the stepsize depending on acceptance rates, in which case we should also put <code>ϵ</code> in the state, but for now we’ll keep things simple.</p>
<p>Moreover, we also want a <em>sample</em> type, which is a type meant for “public consumption”, i.e.&nbsp;the end-user. This is generally going to contain a subset of the information present in the state. But in such a simple scenario as this, we similarly only have a <code>AbstractVector{&lt;:Real}</code>:</p>
<div id="16" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALASample{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We currently have three things:</p>
<ol type="1">
<li>A <code>AbstractMCMC.AbstractSampler</code> implementation called <code>MALA</code>.</li>
<li>A state <code>MALAState</code> for our sampler <code>MALA</code>.</li>
<li>A sample <code>MALASample</code> for our sampler <code>MALA</code>.</li>
</ol>
<p>That means that we’re ready to implement the only thing that really matters: <code>AbstractMCMC.step</code>.</p>
<p><code>AbstractMCMC.step</code> defines the MCMC iteration of our <code>MALA</code> given the current <code>MALAState</code>. Specifically, the signature of the function is as follows:</p>
<div id="18" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The RNG to ensure reproducibility.</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The model that defines our target.</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.AbstractModel</span>,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The sampler for which we're taking a `step`.</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">AbstractMCMC.AbstractSampler</span>,</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The current sampler `state`.</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    state;</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Additional keyword arguments that we may or may not need.</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Moreover, there is a specific <code>AbstractMCMC.AbstractModel</code> which is used to indicate that the model that is provided implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface: <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Since, as we discussed earlier, in our case we’re indeed going to work with types that support the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, we’ll define <code>AbstractMCMC.step</code> for such a <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Note that <code>AbstractMCMC.LogDensityModel</code> has no other purpose; it has a single field called <code>logdensity</code>, and it does nothing else. But by wrapping the model in <code>AbstractMCMC.LogDensityModel</code>, it allows samplers that want to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> to define their <code>AbstractMCMC.step</code> on this type without running into method ambiguities.</p>
<p>All in all, that means that the signature for our <code>AbstractMCMC.step</code> is going to be the following:</p>
<div id="20" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># `LogDensityModel` so we know we're working with LogDensityProblems.jl model.</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler.</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler state.</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Great! Now let’s actually implement the full <code>AbstractMCMC.step</code> for our <code>MALA</code>.</p>
<p>Let’s remind ourselves what we’re going to do:</p>
<ol type="1">
<li>Sample a new momentum <span class="math inline">\(p\)</span>.</li>
<li>Compute the log-density of the extended target <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>Take a single leapfrog step <span class="math inline">\((\tilde{x}, \tilde{p}) = L_{\epsilon}(x, p)\)</span>.</li>
<li>Accept or reject the proposed <span class="math inline">\((\tilde{x}, \tilde{p})\)</span>.</li>
</ol>
<p>All in all, this results in the following:</p>
<div id="22" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>: Random</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Distributions</span>  <span class="co"># so we get the `MvNormal`</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the wrapped model which implements LogDensityProblems.jl.</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just extract the sampler parameters to make our lives easier.</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    ϵ <span class="op">=</span> sampler.ϵ_init</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    M <span class="op">=</span> sampler.M_init</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the current parameters.</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> state.x</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sample the momentum.</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>    p_dist <span class="op">=</span> <span class="fu">MvNormal</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)), M)</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> <span class="fu">rand</span>(rng, p_dist)</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Propose using a single leapfrog step.</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>    x̃, p̃ <span class="op">=</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Accept or reject proposal.</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>    logp <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p)</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>    logp̃ <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x̃) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p̃)</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>    logα <span class="op">=</span> logp̃ <span class="op">-</span> logp</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>    state_new <span class="op">=</span> <span class="cf">if</span> <span class="fu">log</span>(<span class="fu">rand</span>(rng)) <span class="op">&lt;</span> logα</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Accept.</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x̃)</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Reject.</span></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x)</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return the "sample" and the sampler state.</span></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(state_new.x), state_new</span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Fairly straight-forward.</p>
<p>Of course, we haven’t defined the <code>leapfrog_step</code> method yet, so let’s do that:</p>
<div id="24" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p` using "position" `x`.</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x))</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    p1 <span class="op">=</span> p <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update the "position" `x` using momentum `p1`.</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    x̃ <span class="op">=</span> x <span class="op">+</span> ϵ <span class="op">.*</span> (M <span class="op">\</span> p1)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p1` using position `x̃`</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x̃ <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x̃))</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    p2 <span class="op">=</span> p1 <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x̃</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Flip momentum `p2`.</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    p̃ <span class="op">=</span> <span class="op">-</span>p2</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x̃, p̃</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>leapfrog_step (generic function with 1 method)</code></pre>
</div>
</div>
<p>With all of this, we’re technically ready to sample!</p>
<div id="26" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>, <span class="bu">LinearAlgebra</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>rng <span class="op">=</span> <span class="bu">Random</span>.<span class="fu">default_rng</span>()</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>sampler <span class="op">=</span> <span class="fu">MALA</span>(<span class="fl">1</span>, I)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>state <span class="op">=</span> <span class="fu">MALAState</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)))</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>x_next, state_next <span class="op">=</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    rng,</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    AbstractMCMC.<span class="fu">LogDensityModel</span>(model),</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    state</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>(MALASample{Vector{Float64}}([0.0, 0.0, 0.0]), MALAState{Vector{Float64}}([0.0, 0.0, 0.0]))</code></pre>
</div>
</div>
<p>Great, it works!</p>
<p>And I promised we would get quite some functionality for free if we implemented <code>AbstractMCMC.step</code>, and so we can now simply call <code>sample</code> to perform standard MCMC sampling:</p>
<div id="28" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform 1000 iterations with our `MALA` sampler.</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; initial_state<span class="op">=</span>state, progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Concatenate into a matrix.</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000 Matrix{Float64}:
 -4.26181  -4.61668   -5.05085  -4.28447   …  -6.46905   -7.37913   -7.81984
  1.1649   -0.978109  -0.79085   0.480023      0.172021  -0.300586   0.221203
  2.3117    5.57746    6.33017   5.40481       4.17038    5.44245    4.30245</code></pre>
</div>
</div>
<div id="30" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the marginal means and standard deviations.</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -4.9841      0.996227
 -0.00690917  0.988358
  4.98096     1.00319</code></pre>
</div>
</div>
<p>Let’s visualize the samples</p>
<div id="32" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">StatsPlots</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">transpose</span>(samples_matrix[<span class="op">:</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">:</span><span class="kw">end</span>]), alpha<span class="op">=</span><span class="fl">0.5</span>, legend<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<!--?xml version="1.0" encoding="utf-8"?-->
<svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" width="672" height="480" viewbox="0 0 2688 1920">
<defs>
  <clippath id="clip910">
    <rect x="0" y="0" width="2688" height="1920"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip910)" d="M0 1920 L2688 1920 L2688 0 L0 0  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip911">
    <rect x="537" y="0" width="1883" height="1883"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip910)" d="M196.816 1800.78 L2640.76 1800.78 L2640.76 47.2441 L196.816 47.2441  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip912">
    <rect x="196" y="47" width="2445" height="1755"></rect>
  </clippath>
</defs>
<polyline clip-path="url(#clip912)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="263.676,1800.78 263.676,47.2441 "></polyline>
<polyline clip-path="url(#clip912)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="840.654,1800.78 840.654,47.2441 "></polyline>
<polyline clip-path="url(#clip912)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1417.63,1800.78 1417.63,47.2441 "></polyline>
<polyline clip-path="url(#clip912)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1994.61,1800.78 1994.61,47.2441 "></polyline>
<polyline clip-path="url(#clip912)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="2571.59,1800.78 2571.59,47.2441 "></polyline>
<polyline clip-path="url(#clip912)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,1689.02 2640.76,1689.02 "></polyline>
<polyline clip-path="url(#clip912)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,1441.58 2640.76,1441.58 "></polyline>
<polyline clip-path="url(#clip912)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,1194.13 2640.76,1194.13 "></polyline>
<polyline clip-path="url(#clip912)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,946.686 2640.76,946.686 "></polyline>
<polyline clip-path="url(#clip912)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,699.239 2640.76,699.239 "></polyline>
<polyline clip-path="url(#clip912)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,451.793 2640.76,451.793 "></polyline>
<polyline clip-path="url(#clip912)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,204.347 2640.76,204.347 "></polyline>
<polyline clip-path="url(#clip910)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1800.78 2640.76,1800.78 "></polyline>
<polyline clip-path="url(#clip910)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="263.676,1800.78 263.676,1781.88 "></polyline>
<polyline clip-path="url(#clip910)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="840.654,1800.78 840.654,1781.88 "></polyline>
<polyline clip-path="url(#clip910)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1417.63,1800.78 1417.63,1781.88 "></polyline>
<polyline clip-path="url(#clip910)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1994.61,1800.78 1994.61,1781.88 "></polyline>
<polyline clip-path="url(#clip910)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="2571.59,1800.78 2571.59,1781.88 "></polyline>
<path clip-path="url(#clip910)" d="M263.676 1834 Q260.065 1834 258.236 1837.57 Q256.431 1841.11 256.431 1848.24 Q256.431 1855.34 258.236 1858.91 Q260.065 1862.45 263.676 1862.45 Q267.31 1862.45 269.116 1858.91 Q270.945 1855.34 270.945 1848.24 Q270.945 1841.11 269.116 1837.57 Q267.31 1834 263.676 1834 M263.676 1830.3 Q269.486 1830.3 272.542 1834.9 Q275.621 1839.49 275.621 1848.24 Q275.621 1856.96 272.542 1861.57 Q269.486 1866.15 263.676 1866.15 Q257.866 1866.15 254.787 1861.57 Q251.732 1856.96 251.732 1848.24 Q251.732 1839.49 254.787 1834.9 Q257.866 1830.3 263.676 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip910)" d="M804.346 1861.55 L820.666 1861.55 L820.666 1865.48 L798.721 1865.48 L798.721 1861.55 Q801.383 1858.79 805.967 1854.16 Q810.573 1849.51 811.754 1848.17 Q813.999 1845.65 814.879 1843.91 Q815.782 1842.15 815.782 1840.46 Q815.782 1837.71 813.837 1835.97 Q811.916 1834.23 808.814 1834.23 Q806.615 1834.23 804.161 1835 Q801.731 1835.76 798.953 1837.31 L798.953 1832.59 Q801.777 1831.46 804.231 1830.88 Q806.684 1830.3 808.721 1830.3 Q814.092 1830.3 817.286 1832.98 Q820.481 1835.67 820.481 1840.16 Q820.481 1842.29 819.67 1844.21 Q818.883 1846.11 816.777 1848.7 Q816.198 1849.37 813.096 1852.59 Q809.995 1855.78 804.346 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip910)" d="M830.527 1830.92 L848.883 1830.92 L848.883 1834.86 L834.809 1834.86 L834.809 1843.33 Q835.828 1842.98 836.846 1842.82 Q837.865 1842.64 838.883 1842.64 Q844.67 1842.64 848.05 1845.81 Q851.43 1848.98 851.43 1854.4 Q851.43 1859.97 847.957 1863.08 Q844.485 1866.15 838.166 1866.15 Q835.99 1866.15 833.721 1865.78 Q831.476 1865.41 829.069 1864.67 L829.069 1859.97 Q831.152 1861.11 833.374 1861.66 Q835.596 1862.22 838.073 1862.22 Q842.078 1862.22 844.416 1860.11 Q846.754 1858.01 846.754 1854.4 Q846.754 1850.78 844.416 1848.68 Q842.078 1846.57 838.073 1846.57 Q836.198 1846.57 834.323 1846.99 Q832.471 1847.4 830.527 1848.28 L830.527 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip910)" d="M870.642 1834 Q867.031 1834 865.203 1837.57 Q863.397 1841.11 863.397 1848.24 Q863.397 1855.34 865.203 1858.91 Q867.031 1862.45 870.642 1862.45 Q874.277 1862.45 876.082 1858.91 Q877.911 1855.34 877.911 1848.24 Q877.911 1841.11 876.082 1837.57 Q874.277 1834 870.642 1834 M870.642 1830.3 Q876.453 1830.3 879.508 1834.9 Q882.587 1839.49 882.587 1848.24 Q882.587 1856.96 879.508 1861.57 Q876.453 1866.15 870.642 1866.15 Q864.832 1866.15 861.754 1861.57 Q858.698 1856.96 858.698 1848.24 Q858.698 1839.49 861.754 1834.9 Q864.832 1830.3 870.642 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip910)" d="M1377.25 1830.92 L1395.61 1830.92 L1395.61 1834.86 L1381.53 1834.86 L1381.53 1843.33 Q1382.55 1842.98 1383.57 1842.82 Q1384.59 1842.64 1385.61 1842.64 Q1391.39 1842.64 1394.77 1845.81 Q1398.15 1848.98 1398.15 1854.4 Q1398.15 1859.97 1394.68 1863.08 Q1391.21 1866.15 1384.89 1866.15 Q1382.71 1866.15 1380.44 1865.78 Q1378.2 1865.41 1375.79 1864.67 L1375.79 1859.97 Q1377.88 1861.11 1380.1 1861.66 Q1382.32 1862.22 1384.8 1862.22 Q1388.8 1862.22 1391.14 1860.11 Q1393.48 1858.01 1393.48 1854.4 Q1393.48 1850.78 1391.14 1848.68 Q1388.8 1846.57 1384.8 1846.57 Q1382.92 1846.57 1381.05 1846.99 Q1379.19 1847.4 1377.25 1848.28 L1377.25 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip910)" d="M1417.37 1834 Q1413.75 1834 1411.93 1837.57 Q1410.12 1841.11 1410.12 1848.24 Q1410.12 1855.34 1411.93 1858.91 Q1413.75 1862.45 1417.37 1862.45 Q1421 1862.45 1422.81 1858.91 Q1424.63 1855.34 1424.63 1848.24 Q1424.63 1841.11 1422.81 1837.57 Q1421 1834 1417.37 1834 M1417.37 1830.3 Q1423.18 1830.3 1426.23 1834.9 Q1429.31 1839.49 1429.31 1848.24 Q1429.31 1856.96 1426.23 1861.57 Q1423.18 1866.15 1417.37 1866.15 Q1411.56 1866.15 1408.48 1861.57 Q1405.42 1856.96 1405.42 1848.24 Q1405.42 1839.49 1408.48 1834.9 Q1411.56 1830.3 1417.37 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip910)" d="M1447.53 1834 Q1443.92 1834 1442.09 1837.57 Q1440.28 1841.11 1440.28 1848.24 Q1440.28 1855.34 1442.09 1858.91 Q1443.92 1862.45 1447.53 1862.45 Q1451.16 1862.45 1452.97 1858.91 Q1454.8 1855.34 1454.8 1848.24 Q1454.8 1841.11 1452.97 1837.57 Q1451.16 1834 1447.53 1834 M1447.53 1830.3 Q1453.34 1830.3 1456.39 1834.9 Q1459.47 1839.49 1459.47 1848.24 Q1459.47 1856.96 1456.39 1861.57 Q1453.34 1866.15 1447.53 1866.15 Q1441.72 1866.15 1438.64 1861.57 Q1435.58 1856.96 1435.58 1848.24 Q1435.58 1839.49 1438.64 1834.9 Q1441.72 1830.3 1447.53 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip910)" d="M1952.89 1830.92 L1975.11 1830.92 L1975.11 1832.91 L1962.56 1865.48 L1957.68 1865.48 L1969.48 1834.86 L1952.89 1834.86 L1952.89 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip910)" d="M1984.27 1830.92 L2002.63 1830.92 L2002.63 1834.86 L1988.56 1834.86 L1988.56 1843.33 Q1989.58 1842.98 1990.59 1842.82 Q1991.61 1842.64 1992.63 1842.64 Q1998.42 1842.64 2001.8 1845.81 Q2005.18 1848.98 2005.18 1854.4 Q2005.18 1859.97 2001.7 1863.08 Q1998.23 1866.15 1991.91 1866.15 Q1989.74 1866.15 1987.47 1865.78 Q1985.22 1865.41 1982.82 1864.67 L1982.82 1859.97 Q1984.9 1861.11 1987.12 1861.66 Q1989.34 1862.22 1991.82 1862.22 Q1995.83 1862.22 1998.16 1860.11 Q2000.5 1858.01 2000.5 1854.4 Q2000.5 1850.78 1998.16 1848.68 Q1995.83 1846.57 1991.82 1846.57 Q1989.95 1846.57 1988.07 1846.99 Q1986.22 1847.4 1984.27 1848.28 L1984.27 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip910)" d="M2024.39 1834 Q2020.78 1834 2018.95 1837.57 Q2017.14 1841.11 2017.14 1848.24 Q2017.14 1855.34 2018.95 1858.91 Q2020.78 1862.45 2024.39 1862.45 Q2028.02 1862.45 2029.83 1858.91 Q2031.66 1855.34 2031.66 1848.24 Q2031.66 1841.11 2029.83 1837.57 Q2028.02 1834 2024.39 1834 M2024.39 1830.3 Q2030.2 1830.3 2033.26 1834.9 Q2036.33 1839.49 2036.33 1848.24 Q2036.33 1856.96 2033.26 1861.57 Q2030.2 1866.15 2024.39 1866.15 Q2018.58 1866.15 2015.5 1861.57 Q2012.45 1856.96 2012.45 1848.24 Q2012.45 1839.49 2015.5 1834.9 Q2018.58 1830.3 2024.39 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip910)" d="M2516.11 1861.55 L2523.75 1861.55 L2523.75 1835.18 L2515.44 1836.85 L2515.44 1832.59 L2523.71 1830.92 L2528.38 1830.92 L2528.38 1861.55 L2536.02 1861.55 L2536.02 1865.48 L2516.11 1865.48 L2516.11 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip910)" d="M2555.47 1834 Q2551.85 1834 2550.03 1837.57 Q2548.22 1841.11 2548.22 1848.24 Q2548.22 1855.34 2550.03 1858.91 Q2551.85 1862.45 2555.47 1862.45 Q2559.1 1862.45 2560.9 1858.91 Q2562.73 1855.34 2562.73 1848.24 Q2562.73 1841.11 2560.9 1837.57 Q2559.1 1834 2555.47 1834 M2555.47 1830.3 Q2561.28 1830.3 2564.33 1834.9 Q2567.41 1839.49 2567.41 1848.24 Q2567.41 1856.96 2564.33 1861.57 Q2561.28 1866.15 2555.47 1866.15 Q2549.66 1866.15 2546.58 1861.57 Q2543.52 1856.96 2543.52 1848.24 Q2543.52 1839.49 2546.58 1834.9 Q2549.66 1830.3 2555.47 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip910)" d="M2585.63 1834 Q2582.02 1834 2580.19 1837.57 Q2578.38 1841.11 2578.38 1848.24 Q2578.38 1855.34 2580.19 1858.91 Q2582.02 1862.45 2585.63 1862.45 Q2589.26 1862.45 2591.07 1858.91 Q2592.9 1855.34 2592.9 1848.24 Q2592.9 1841.11 2591.07 1837.57 Q2589.26 1834 2585.63 1834 M2585.63 1830.3 Q2591.44 1830.3 2594.49 1834.9 Q2597.57 1839.49 2597.57 1848.24 Q2597.57 1856.96 2594.49 1861.57 Q2591.44 1866.15 2585.63 1866.15 Q2579.82 1866.15 2576.74 1861.57 Q2573.68 1856.96 2573.68 1848.24 Q2573.68 1839.49 2576.74 1834.9 Q2579.82 1830.3 2585.63 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip910)" d="M2615.79 1834 Q2612.18 1834 2610.35 1837.57 Q2608.54 1841.11 2608.54 1848.24 Q2608.54 1855.34 2610.35 1858.91 Q2612.18 1862.45 2615.79 1862.45 Q2619.42 1862.45 2621.23 1858.91 Q2623.06 1855.34 2623.06 1848.24 Q2623.06 1841.11 2621.23 1837.57 Q2619.42 1834 2615.79 1834 M2615.79 1830.3 Q2621.6 1830.3 2624.65 1834.9 Q2627.73 1839.49 2627.73 1848.24 Q2627.73 1856.96 2624.65 1861.57 Q2621.6 1866.15 2615.79 1866.15 Q2609.98 1866.15 2606.9 1861.57 Q2603.84 1856.96 2603.84 1848.24 Q2603.84 1839.49 2606.9 1834.9 Q2609.98 1830.3 2615.79 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip910)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1800.78 196.816,47.2441 "></polyline>
<polyline clip-path="url(#clip910)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1689.02 215.714,1689.02 "></polyline>
<polyline clip-path="url(#clip910)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1441.58 215.714,1441.58 "></polyline>
<polyline clip-path="url(#clip910)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1194.13 215.714,1194.13 "></polyline>
<polyline clip-path="url(#clip910)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,946.686 215.714,946.686 "></polyline>
<polyline clip-path="url(#clip910)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,699.239 215.714,699.239 "></polyline>
<polyline clip-path="url(#clip910)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,451.793 215.714,451.793 "></polyline>
<polyline clip-path="url(#clip910)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,204.347 215.714,204.347 "></polyline>
<path clip-path="url(#clip910)" d="M50.5475 1689.48 L80.2233 1689.48 L80.2233 1693.41 L50.5475 1693.41 L50.5475 1689.48 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip910)" d="M89.1352 1671.74 L111.357 1671.74 L111.357 1673.74 L98.8111 1706.3 L93.9269 1706.3 L105.732 1675.68 L89.1352 1675.68 L89.1352 1671.74 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip910)" d="M120.478 1700.43 L125.362 1700.43 L125.362 1706.3 L120.478 1706.3 L120.478 1700.43 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip910)" d="M135.593 1671.74 L153.95 1671.74 L153.95 1675.68 L139.876 1675.68 L139.876 1684.15 Q140.894 1683.8 141.913 1683.64 Q142.931 1683.46 143.95 1683.46 Q149.737 1683.46 153.116 1686.63 Q156.496 1689.8 156.496 1695.22 Q156.496 1700.8 153.024 1703.9 Q149.552 1706.98 143.232 1706.98 Q141.056 1706.98 138.788 1706.61 Q136.542 1706.24 134.135 1705.49 L134.135 1700.8 Q136.218 1701.93 138.441 1702.49 Q140.663 1703.04 143.14 1703.04 Q147.144 1703.04 149.482 1700.93 Q151.82 1698.83 151.82 1695.22 Q151.82 1691.61 149.482 1689.5 Q147.144 1687.39 143.14 1687.39 Q141.265 1687.39 139.39 1687.81 Q137.538 1688.23 135.593 1689.11 L135.593 1671.74 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip910)" d="M49.5521 1442.03 L79.2279 1442.03 L79.2279 1445.96 L49.5521 1445.96 L49.5521 1442.03 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip910)" d="M89.3667 1424.3 L107.723 1424.3 L107.723 1428.23 L93.6491 1428.23 L93.6491 1436.71 Q94.6676 1436.36 95.6861 1436.2 Q96.7047 1436.01 97.7232 1436.01 Q103.51 1436.01 106.89 1439.18 Q110.269 1442.35 110.269 1447.77 Q110.269 1453.35 106.797 1456.45 Q103.325 1459.53 97.0056 1459.53 Q94.8297 1459.53 92.5612 1459.16 Q90.3158 1458.79 87.9084 1458.05 L87.9084 1453.35 Q89.9917 1454.48 92.2139 1455.04 Q94.4361 1455.59 96.913 1455.59 Q100.918 1455.59 103.256 1453.49 Q105.593 1451.38 105.593 1447.77 Q105.593 1444.16 103.256 1442.05 Q100.918 1439.95 96.913 1439.95 Q95.038 1439.95 93.163 1440.36 Q91.3112 1440.78 89.3667 1441.66 L89.3667 1424.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip910)" d="M119.482 1452.98 L124.367 1452.98 L124.367 1458.86 L119.482 1458.86 L119.482 1452.98 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip910)" d="M144.552 1427.38 Q140.941 1427.38 139.112 1430.94 Q137.306 1434.48 137.306 1441.61 Q137.306 1448.72 139.112 1452.28 Q140.941 1455.83 144.552 1455.83 Q148.186 1455.83 149.991 1452.28 Q151.82 1448.72 151.82 1441.61 Q151.82 1434.48 149.991 1430.94 Q148.186 1427.38 144.552 1427.38 M144.552 1423.67 Q150.362 1423.67 153.417 1428.28 Q156.496 1432.86 156.496 1441.61 Q156.496 1450.34 153.417 1454.95 Q150.362 1459.53 144.552 1459.53 Q138.741 1459.53 135.663 1454.95 Q132.607 1450.34 132.607 1441.61 Q132.607 1432.86 135.663 1428.28 Q138.741 1423.67 144.552 1423.67 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip910)" d="M50.5475 1194.58 L80.2233 1194.58 L80.2233 1198.52 L50.5475 1198.52 L50.5475 1194.58 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip910)" d="M94.3436 1207.48 L110.663 1207.48 L110.663 1211.41 L88.7186 1211.41 L88.7186 1207.48 Q91.3806 1204.72 95.9639 1200.09 Q100.57 1195.44 101.751 1194.1 Q103.996 1191.57 104.876 1189.84 Q105.779 1188.08 105.779 1186.39 Q105.779 1183.63 103.834 1181.9 Q101.913 1180.16 98.8111 1180.16 Q96.6121 1180.16 94.1584 1180.93 Q91.7278 1181.69 88.9501 1183.24 L88.9501 1178.52 Q91.7741 1177.38 94.2278 1176.81 Q96.6815 1176.23 98.7185 1176.23 Q104.089 1176.23 107.283 1178.91 Q110.478 1181.6 110.478 1186.09 Q110.478 1188.22 109.668 1190.14 Q108.881 1192.04 106.774 1194.63 Q106.195 1195.3 103.094 1198.52 Q99.9917 1201.71 94.3436 1207.48 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip910)" d="M120.478 1205.53 L125.362 1205.53 L125.362 1211.41 L120.478 1211.41 L120.478 1205.53 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip910)" d="M135.593 1176.85 L153.95 1176.85 L153.95 1180.79 L139.876 1180.79 L139.876 1189.26 Q140.894 1188.91 141.913 1188.75 Q142.931 1188.56 143.95 1188.56 Q149.737 1188.56 153.116 1191.74 Q156.496 1194.91 156.496 1200.32 Q156.496 1205.9 153.024 1209 Q149.552 1212.08 143.232 1212.08 Q141.056 1212.08 138.788 1211.71 Q136.542 1211.34 134.135 1210.6 L134.135 1205.9 Q136.218 1207.04 138.441 1207.59 Q140.663 1208.15 143.14 1208.15 Q147.144 1208.15 149.482 1206.04 Q151.82 1203.94 151.82 1200.32 Q151.82 1196.71 149.482 1194.61 Q147.144 1192.5 143.14 1192.5 Q141.265 1192.5 139.39 1192.92 Q137.538 1193.33 135.593 1194.21 L135.593 1176.85 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip910)" d="M99.3204 932.484 Q95.7093 932.484 93.8806 936.049 Q92.075 939.591 92.075 946.72 Q92.075 953.827 93.8806 957.392 Q95.7093 960.933 99.3204 960.933 Q102.955 960.933 104.76 957.392 Q106.589 953.827 106.589 946.72 Q106.589 939.591 104.76 936.049 Q102.955 932.484 99.3204 932.484 M99.3204 928.781 Q105.131 928.781 108.186 933.387 Q111.265 937.97 111.265 946.72 Q111.265 955.447 108.186 960.054 Q105.131 964.637 99.3204 964.637 Q93.5102 964.637 90.4315 960.054 Q87.376 955.447 87.376 946.72 Q87.376 937.97 90.4315 933.387 Q93.5102 928.781 99.3204 928.781 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip910)" d="M119.482 958.086 L124.367 958.086 L124.367 963.966 L119.482 963.966 L119.482 958.086 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip910)" d="M144.552 932.484 Q140.941 932.484 139.112 936.049 Q137.306 939.591 137.306 946.72 Q137.306 953.827 139.112 957.392 Q140.941 960.933 144.552 960.933 Q148.186 960.933 149.991 957.392 Q151.82 953.827 151.82 946.72 Q151.82 939.591 149.991 936.049 Q148.186 932.484 144.552 932.484 M144.552 928.781 Q150.362 928.781 153.417 933.387 Q156.496 937.97 156.496 946.72 Q156.496 955.447 153.417 960.054 Q150.362 964.637 144.552 964.637 Q138.741 964.637 135.663 960.054 Q132.607 955.447 132.607 946.72 Q132.607 937.97 135.663 933.387 Q138.741 928.781 144.552 928.781 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip910)" d="M94.3436 712.584 L110.663 712.584 L110.663 716.519 L88.7186 716.519 L88.7186 712.584 Q91.3806 709.829 95.9639 705.2 Q100.57 700.547 101.751 699.205 Q103.996 696.681 104.876 694.945 Q105.779 693.186 105.779 691.496 Q105.779 688.742 103.834 687.006 Q101.913 685.269 98.8111 685.269 Q96.6121 685.269 94.1584 686.033 Q91.7278 686.797 88.9501 688.348 L88.9501 683.626 Q91.7741 682.492 94.2278 681.913 Q96.6815 681.334 98.7185 681.334 Q104.089 681.334 107.283 684.019 Q110.478 686.705 110.478 691.195 Q110.478 693.325 109.668 695.246 Q108.881 697.144 106.774 699.737 Q106.195 700.408 103.094 703.626 Q99.9917 706.82 94.3436 712.584 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip910)" d="M120.478 710.64 L125.362 710.64 L125.362 716.519 L120.478 716.519 L120.478 710.64 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip910)" d="M135.593 681.959 L153.95 681.959 L153.95 685.894 L139.876 685.894 L139.876 694.367 Q140.894 694.019 141.913 693.857 Q142.931 693.672 143.95 693.672 Q149.737 693.672 153.116 696.843 Q156.496 700.015 156.496 705.431 Q156.496 711.01 153.024 714.112 Q149.552 717.191 143.232 717.191 Q141.056 717.191 138.788 716.82 Q136.542 716.45 134.135 715.709 L134.135 711.01 Q136.218 712.144 138.441 712.7 Q140.663 713.255 143.14 713.255 Q147.144 713.255 149.482 711.149 Q151.82 709.042 151.82 705.431 Q151.82 701.82 149.482 699.714 Q147.144 697.607 143.14 697.607 Q141.265 697.607 139.39 698.024 Q137.538 698.441 135.593 699.32 L135.593 681.959 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip910)" d="M89.3667 434.513 L107.723 434.513 L107.723 438.448 L93.6491 438.448 L93.6491 446.92 Q94.6676 446.573 95.6861 446.411 Q96.7047 446.226 97.7232 446.226 Q103.51 446.226 106.89 449.397 Q110.269 452.568 110.269 457.985 Q110.269 463.564 106.797 466.666 Q103.325 469.744 97.0056 469.744 Q94.8297 469.744 92.5612 469.374 Q90.3158 469.003 87.9084 468.263 L87.9084 463.564 Q89.9917 464.698 92.2139 465.253 Q94.4361 465.809 96.913 465.809 Q100.918 465.809 103.256 463.703 Q105.593 461.596 105.593 457.985 Q105.593 454.374 103.256 452.267 Q100.918 450.161 96.913 450.161 Q95.038 450.161 93.163 450.578 Q91.3112 450.994 89.3667 451.874 L89.3667 434.513 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip910)" d="M119.482 463.193 L124.367 463.193 L124.367 469.073 L119.482 469.073 L119.482 463.193 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip910)" d="M144.552 437.592 Q140.941 437.592 139.112 441.156 Q137.306 444.698 137.306 451.828 Q137.306 458.934 139.112 462.499 Q140.941 466.041 144.552 466.041 Q148.186 466.041 149.991 462.499 Q151.82 458.934 151.82 451.828 Q151.82 444.698 149.991 441.156 Q148.186 437.592 144.552 437.592 M144.552 433.888 Q150.362 433.888 153.417 438.494 Q156.496 443.078 156.496 451.828 Q156.496 460.554 153.417 465.161 Q150.362 469.744 144.552 469.744 Q138.741 469.744 135.663 465.161 Q132.607 460.554 132.607 451.828 Q132.607 443.078 135.663 438.494 Q138.741 433.888 144.552 433.888 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip910)" d="M89.1352 187.067 L111.357 187.067 L111.357 189.057 L98.8111 221.627 L93.9269 221.627 L105.732 191.002 L89.1352 191.002 L89.1352 187.067 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip910)" d="M120.478 215.747 L125.362 215.747 L125.362 221.627 L120.478 221.627 L120.478 215.747 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip910)" d="M135.593 187.067 L153.95 187.067 L153.95 191.002 L139.876 191.002 L139.876 199.474 Q140.894 199.127 141.913 198.965 Q142.931 198.779 143.95 198.779 Q149.737 198.779 153.116 201.951 Q156.496 205.122 156.496 210.539 Q156.496 216.117 153.024 219.219 Q149.552 222.298 143.232 222.298 Q141.056 222.298 138.788 221.927 Q136.542 221.557 134.135 220.816 L134.135 216.117 Q136.218 217.252 138.441 217.807 Q140.663 218.363 143.14 218.363 Q147.144 218.363 149.482 216.256 Q151.82 214.15 151.82 210.539 Q151.82 206.928 149.482 204.821 Q147.144 202.715 143.14 202.715 Q141.265 202.715 139.39 203.131 Q137.538 203.548 135.593 204.428 L135.593 187.067 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip912)" style="stroke:#009af9; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="265.984,1368.51 268.292,1463.02 270.6,1404.1 272.908,1300.48 275.216,1358.58 277.524,1499.37 279.832,1474.62 282.139,1474.78 284.447,1470.6 286.755,1327.98 289.063,1472.21 291.371,1414.83 293.679,1527 295.987,1482.09 298.295,1226.57 300.603,1350.76 302.911,1377.57 305.219,1325.35 307.527,1498.49 309.834,1468.67 312.142,1297.42 314.45,1513.39 316.758,1493.36 319.066,1346.04 321.374,1380.76 323.682,1432.84 325.99,1438.48 328.298,1450.21 330.606,1518.88 332.914,1338.6 335.221,1546.87 337.529,1616.69 339.837,1568.1 342.145,1376.56 344.453,1443.9 346.761,1291.53 349.069,1502.46 351.377,1359.92 353.685,1507.22 355.993,1621.32 358.301,1333.19 360.608,1420.81 362.916,1332.31 365.224,1442.94 367.532,1410.96 369.84,1453.76 372.148,1457.29 374.456,1341.88 376.764,1503.82 379.072,1338.83 381.38,1294.18 383.688,1430.49 385.996,1529.53 388.303,1442.96 390.611,1321.16 392.919,1434.44 395.227,1509.36 397.535,1474.55 399.843,1348.08 402.151,1490.71 404.459,1441.72 406.767,1536.69 409.075,1417.24 411.383,1498.74 413.69,1173.3 415.998,1628.92 418.306,1544.92 420.614,1498.43 422.922,1448.13 425.23,1451.14 427.538,1437.52 429.846,1392.24 432.154,1385.3 434.462,1597 436.77,1440.84 439.077,1433.65 441.385,1422.02 443.693,1498.38 446.001,1501.34 448.309,1338.54 450.617,1252.87 452.925,1533.5 455.233,1474.52 457.541,1368.64 459.849,1524.08 462.157,1349.29 464.465,1429.78 466.772,1327.11 469.08,1580.46 471.388,1641.71 473.696,1436.16 476.004,1355.83 478.312,1529.76 480.62,1371.79 482.928,1406.1 485.236,1579.51 487.544,1151.99 489.852,1684.38 492.159,1325.25 494.467,1569.93 496.775,1491.94 499.083,1478.12 501.391,1495.35 503.699,1407.35 506.007,1360.77 508.315,1642.24 510.623,1415.09 512.931,1390.58 515.239,1407.36 517.546,1442.21 519.854,1421.32 522.162,1438.37 524.47,1541.5 526.778,1308.02 529.086,1448.16 531.394,1437.35 533.702,1265.64 536.01,1382.7 538.318,1523.46 540.626,1389.37 542.933,1450.02 545.241,1321.75 547.549,1343.77 549.857,1484.96 552.165,1621.02 554.473,1519.05 556.781,1446.74 559.089,1378.91 561.397,1542.78 563.705,1307.78 566.013,1529.25 568.321,1456.74 570.628,1359.97 572.936,1499.6 575.244,1665.54 577.552,1416.15 579.86,1478.26 582.168,1479.04 584.476,1391.95 586.784,1500.41 589.092,1484.61 591.4,1638.18 593.708,1491.26 596.015,1576.06 598.323,1305.76 600.631,1505.89 602.939,1300.39 605.247,1300.92 607.555,1617.69 609.863,1544.85 612.171,1358.42 614.479,1325.32 616.787,1593.6 619.095,1460.17 621.402,1552.81 623.71,1582.29 626.018,1486.9 628.326,1690.78 630.634,1312.19 632.942,1528.09 635.25,1629.71 637.558,1468.7 639.866,1371.97 642.174,1262.09 644.482,1464.82 646.79,1365.86 649.097,1479.33 651.405,1537.51 653.713,1368.77 656.021,1324.43 658.329,1331.1 660.637,1411.51 662.945,1559.48 665.253,1475.07 667.561,1428.7 669.869,1487.84 672.177,1519.49 674.484,1359.24 676.792,1554.92 679.1,1491.46 681.408,1565.15 683.716,1384.26 686.024,1280.03 688.332,1491.67 690.64,1438.85 692.948,1643.39 695.256,1421.91 697.564,1373.61 699.871,1353.35 702.179,1400.2 704.487,1371.53 706.795,1343.71 709.103,1407.08 711.411,1387.66 713.719,1414.83 716.027,1407.35 718.335,1481.65 720.643,1456.12 722.951,1290.66 725.259,1331.46 727.566,1441.21 729.874,1650.34 732.182,1334.89 734.49,1385.8 736.798,1459.15 739.106,1594.34 741.414,1357.93 743.722,1497.56 746.03,1512.78 748.338,1568.14 750.646,1518.85 752.953,1513.35 755.261,1442.61 757.569,1342.28 759.877,1377.23 762.185,1475.13 764.493,1308.99 766.801,1421.04 769.109,1622.34 771.417,1590.49 773.725,1364.8 776.033,1373.89 778.34,1545.68 780.648,1368.72 782.956,1653.92 785.264,1299.58 787.572,1386.84 789.88,1511.25 792.188,1537.53 794.496,1333.01 796.804,1360.31 799.112,1531.71 801.42,1570.48 803.728,1542.44 806.035,1437.55 808.343,1476.51 810.651,1466.45 812.959,1413.29 815.267,1476.92 817.575,1555.11 819.883,1228.21 822.191,1347.45 824.499,1311.99 826.807,1572.33 829.115,1511.65 831.422,1588.51 833.73,1302.22 836.038,1305.32 838.346,1545.01 840.654,1510.48 842.962,1278.6 845.27,1382.34 847.578,1512.78 849.886,1561.95 852.194,1439.26 854.502,1304.78 856.809,1572.6 859.117,1407.07 861.425,1401.32 863.733,1319.59 866.041,1617.73 868.349,1470.39 870.657,1523.62 872.965,1609.66 875.273,1445.53 877.581,1406.09 879.889,1411.5 882.197,1561.53 884.504,1424.86 886.812,1624.19 889.12,1591.81 891.428,1492.87 893.736,1374.26 896.044,1361.02 898.352,1426 900.66,1586.65 902.968,1517.19 905.276,1399.74 907.584,1377.23 909.891,1575.09 912.199,1571.04 914.507,1242.1 916.815,1386.16 919.123,1347.38 921.431,1433.53 923.739,1670.79 926.047,1378.52 928.355,1496.09 930.663,1602.98 932.971,1472.87 935.278,1473.16 937.586,1251.19 939.894,1330.4 942.202,1462.72 944.51,1327.14 946.818,1390.09 949.126,1157.27 951.434,1272.97 953.742,1531.73 956.05,1508.04 958.358,1281.31 960.665,1411.7 962.973,1519.24 965.281,1552.69 967.589,1327.83 969.897,1336.16 972.205,1506.86 974.513,1543.53 976.821,1540.81 979.129,1539.45 981.437,1272.09 983.745,1325.19 986.053,1593.56 988.36,1424.01 990.668,1605.1 992.976,1539.7 995.284,1338.72 997.592,1363.48 999.9,1408.11 1002.21,1357.56 1004.52,1484.23 1006.82,1266.72 1009.13,1447.76 1011.44,1439.61 1013.75,1395.33 1016.06,1401.76 1018.36,1327.53 1020.67,1549.72 1022.98,1396.96 1025.29,1454.93 1027.59,1409.95 1029.9,1668.4 1032.21,1431.22 1034.52,1535.93 1036.83,1363.75 1039.13,1505.2 1041.44,1539.21 1043.75,1424.32 1046.06,1439.6 1048.37,1485.36 1050.67,1574.88 1052.98,1392.71 1055.29,1415.01 1057.6,1296.12 1059.91,1487.55 1062.21,1440.98 1064.52,1430.03 1066.83,1614.51 1069.14,1349.32 1071.45,1676.54 1073.75,1419.82 1076.06,1398.69 1078.37,1696.66 1080.68,1538.88 1082.98,1352.65 1085.29,1435.63 1087.6,1414.84 1089.91,1478.67 1092.22,1417.24 1094.52,1493.25 1096.83,1436.87 1099.14,1466.21 1101.45,1502.15 1103.76,1346.86 1106.06,1467.51 1108.37,1409.37 1110.68,1415.42 1112.99,1478.5 1115.3,1428.29 1117.6,1345.37 1119.91,1467.01 1122.22,1453.52 1124.53,1505.62 1126.84,1241.13 1129.14,1104.98 1131.45,1353.14 1133.76,1321.59 1136.07,1432.62 1138.37,1493.95 1140.68,1441.42 1142.99,1327.39 1145.3,1577.31 1147.61,1370.13 1149.91,1476.07 1152.22,1535.49 1154.53,1480.92 1156.84,1585.07 1159.15,1353.62 1161.45,1425.99 1163.76,1420.26 1166.07,1486.68 1168.38,1364.45 1170.69,1421.98 1172.99,1435.84 1175.3,1414.61 1177.61,1461.51 1179.92,1481.44 1182.23,1437.31 1184.53,1352.67 1186.84,1487.33 1189.15,1505.54 1191.46,1482.51 1193.76,1411.89 1196.07,1528.12 1198.38,1506.48 1200.69,1394.96 1203,1598.38 1205.3,1339.53 1207.61,1540.43 1209.92,1357.84 1212.23,1442.94 1214.54,1510.06 1216.84,1408.3 1219.15,1377.69 1221.46,1542.5 1223.77,1414.6 1226.08,1459.09 1228.38,1639.19 1230.69,1394.13 1233,1557.28 1235.31,1552.45 1237.61,1426.96 1239.92,1480.17 1242.23,1337.7 1244.54,1592.94 1246.85,1228.2 1249.15,1339.91 1251.46,1474.59 1253.77,1444.75 1256.08,1470.08 1258.39,1459.61 1260.69,1356.98 1263,1399.64 1265.31,1315.75 1267.62,1298.16 1269.93,1413.51 1272.23,1396.62 1274.54,1492.63 1276.85,1463.46 1279.16,1396.68 1281.47,1485.1 1283.77,1588.08 1286.08,1363.08 1288.39,1260.61 1290.7,1494.08 1293,1392.03 1295.31,1429.02 1297.62,1326.32 1299.93,1431.87 1302.24,1678.19 1304.54,1560.65 1306.85,1289.72 1309.16,1413.56 1311.47,1343.96 1313.78,1375.25 1316.08,1208.33 1318.39,1519.27 1320.7,1465.48 1323.01,1354.65 1325.32,1454.47 1327.62,1433.84 1329.93,1445.69 1332.24,1401.83 1334.55,1469.81 1336.86,1435.66 1339.16,1293.54 1341.47,1470.33 1343.78,1329.49 1346.09,1309.64 1348.39,1185.2 1350.7,1221.19 1353.01,1479.67 1355.32,1517.62 1357.63,1539.49 1359.93,1394.39 1362.24,1388.72 1364.55,1315.9 1366.86,1477.13 1369.17,1353.67 1371.47,1355.97 1373.78,1464.63 1376.09,1283.7 1378.4,1630.79 1380.71,1489.65 1383.01,1422.99 1385.32,1550.47 1387.63,1505.58 1389.94,1395.9 1392.24,1381.75 1394.55,1345.04 1396.86,1524.24 1399.17,1643.03 1401.48,1376.84 1403.78,1461.02 1406.09,1280.91 1408.4,1530.93 1410.71,1489.41 1413.02,1544.36 1415.32,1449.57 1417.63,1436.72 1419.94,1425.77 1422.25,1539.5 1424.56,1359.7 1426.86,1350.13 1429.17,1644.03 1431.48,1527.69 1433.79,1334.27 1436.1,1464.53 1438.4,1499.67 1440.71,1522.64 1443.02,1259.65 1445.33,1748.53 1447.63,1566.52 1449.94,1426.94 1452.25,1338.44 1454.56,1450.89 1456.87,1445.82 1459.17,1618.39 1461.48,1501.74 1463.79,1472.51 1466.1,1484.85 1468.41,1384.75 1470.71,1398.37 1473.02,1333.72 1475.33,1462.34 1477.64,1519.14 1479.95,1399.28 1482.25,1418.11 1484.56,1590.47 1486.87,1488.16 1489.18,1276.2 1491.49,1445.22 1493.79,1311.74 1496.1,1291.63 1498.41,1389.38 1500.72,1470.88 1503.02,1445.02 1505.33,1437.87 1507.64,1445.04 1509.95,1504.88 1512.26,1547.54 1514.56,1443.77 1516.87,1528.73 1519.18,1478.42 1521.49,1454.86 1523.8,1390.7 1526.1,1655.74 1528.41,1555.66 1530.72,1370.76 1533.03,1594.23 1535.34,1348.15 1537.64,1385.85 1539.95,1409.16 1542.26,1425.39 1544.57,1355.27 1546.88,1473.93 1549.18,1529.66 1551.49,1292.72 1553.8,1383.2 1556.11,1403.22 1558.41,1412.64 1560.72,1522.98 1563.03,1274.24 1565.34,1332.65 1567.65,1590.45 1569.95,1569.58 1572.26,1381.97 1574.57,1573.49 1576.88,1388.82 1579.19,1494.13 1581.49,1512.41 1583.8,1406.51 1586.11,1564.31 1588.42,1405.18 1590.73,1493.61 1593.03,1559.74 1595.34,1391.37 1597.65,1496.35 1599.96,1471.8 1602.26,1401.45 1604.57,1229.9 1606.88,1419.33 1609.19,1460.79 1611.5,1478.79 1613.8,1591.18 1616.11,1226.94 1618.42,1318.36 1620.73,1507.37 1623.04,1513.62 1625.34,1353.7 1627.65,1471.65 1629.96,1414.45 1632.27,1401.52 1634.58,1447.28 1636.88,1526.43 1639.19,1526.86 1641.5,1533.16 1643.81,1417.82 1646.12,1276.12 1648.42,1353.7 1650.73,1490.38 1653.04,1341.07 1655.35,1390.11 1657.65,1442.22 1659.96,1319.28 1662.27,1434.52 1664.58,1511 1666.89,1458.9 1669.19,1391.83 1671.5,1369.07 1673.81,1365.54 1676.12,1349.57 1678.43,1377.65 1680.73,1207.23 1683.04,1554.76 1685.35,1407.72 1687.66,1411.43 1689.97,1236.81 1692.27,1441.95 1694.58,1355.25 1696.89,1439.82 1699.2,1473.47 1701.51,1593 1703.81,1396.18 1706.12,1491.34 1708.43,1557.9 1710.74,1372.27 1713.04,1368.97 1715.35,1440.42 1717.66,1540.35 1719.97,1391.92 1722.28,1420.44 1724.58,1590.88 1726.89,1486.46 1729.2,1461.02 1731.51,1355.35 1733.82,1690 1736.12,1364.13 1738.43,1373.8 1740.74,1430.32 1743.05,1535.68 1745.36,1600.67 1747.66,1492.94 1749.97,1450.71 1752.28,1508.49 1754.59,1332.58 1756.9,1448.79 1759.2,1510.9 1761.51,1530.22 1763.82,1502.4 1766.13,1315.79 1768.43,1399.58 1770.74,1405.44 1773.05,1430.75 1775.36,1360.72 1777.67,1454.91 1779.97,1638.24 1782.28,1562.45 1784.59,1332.12 1786.9,1250.62 1789.21,1465.38 1791.51,1358.13 1793.82,1305.42 1796.13,1566.59 1798.44,1438.19 1800.75,1317.56 1803.05,1377.49 1805.36,1412.23 1807.67,1425.36 1809.98,1599.64 1812.28,1459.79 1814.59,1424 1816.9,1321.66 1819.21,1485.59 1821.52,1492.95 1823.82,1583.21 1826.13,1406.52 1828.44,1415.79 1830.75,1467.07 1833.06,1493.41 1835.36,1331.07 1837.67,1346.72 1839.98,1529.77 1842.29,1413.56 1844.6,1653.39 1846.9,1421.18 1849.21,1401.84 1851.52,1456.48 1853.83,1612.28 1856.14,1386.34 1858.44,1470.21 1860.75,1467.04 1863.06,1455.25 1865.37,1377.56 1867.67,1616.43 1869.98,1320.5 1872.29,1352.87 1874.6,1377.1 1876.91,1465.07 1879.21,1389.35 1881.52,1420.71 1883.83,1429.33 1886.14,1301.7 1888.45,1457.37 1890.75,1429.51 1893.06,1472.76 1895.37,1483.01 1897.68,1508.48 1899.99,1244.93 1902.29,1464.39 1904.6,1412.8 1906.91,1534.95 1909.22,1217.35 1911.53,1286.81 1913.83,1193.94 1916.14,1463.23 1918.45,1574.34 1920.76,1504.76 1923.06,1506.77 1925.37,1554.17 1927.68,1476.37 1929.99,1473.15 1932.3,1469.96 1934.6,1362.36 1936.91,1392.96 1939.22,1521.34 1941.53,1357.27 1943.84,1163.52 1946.14,1400.92 1948.45,1376.37 1950.76,1495.21 1953.07,1406.8 1955.38,1430.56 1957.68,1448.16 1959.99,1511.3 1962.3,1407.42 1964.61,1422.59 1966.91,1273.36 1969.22,1471.39 1971.53,1449.78 1973.84,1396.96 1976.15,1403.4 1978.45,1421.27 1980.76,1546.97 1983.07,1556.03 1985.38,1245.51 1987.69,1218.28 1989.99,1467.21 1992.3,1508.82 1994.61,1581.18 1996.92,1510.73 1999.23,1403.01 2001.53,1668.17 2003.84,1387.84 2006.15,1441.6 2008.46,1347.28 2010.77,1551.62 2013.07,1317.54 2015.38,1304.75 2017.69,1502.56 2020,1441.9 2022.3,1321.97 2024.61,1658.68 2026.92,1469.75 2029.23,1509.7 2031.54,1376.01 2033.84,1588.2 2036.15,1385.06 2038.46,1336.5 2040.77,1451.52 2043.08,1490.62 2045.38,1482.21 2047.69,1409.93 2050,1391.54 2052.31,1567.93 2054.62,1346.03 2056.92,1355.36 2059.23,1409.22 2061.54,1551.89 2063.85,1491.2 2066.16,1471.41 2068.46,1324.76 2070.77,1348.34 2073.08,1344.2 2075.39,1379.47 2077.69,1290.03 2080,1568.97 2082.31,1479.22 2084.62,1377 2086.93,1570.61 2089.23,1485.83 2091.54,1398.51 2093.85,1534.81 2096.16,1502.51 2098.47,1553.9 2100.77,1456.74 2103.08,1367.94 2105.39,1556.39 2107.7,1310.35 2110.01,1392.94 2112.31,1450.22 2114.62,1540.38 2116.93,1291.77 2119.24,1500.05 2121.55,1547.56 2123.85,1499.95 2126.16,1464.47 2128.47,1336.46 2130.78,1431.54 2133.08,1502.89 2135.39,1450.41 2137.7,1537.48 2140.01,1551.21 2142.32,1586.94 2144.62,1249.9 2146.93,1567.73 2149.24,1555.54 2151.55,1620.82 2153.86,1434.04 2156.16,1350.26 2158.47,1383.32 2160.78,1283.94 2163.09,1460.45 2165.4,1525.82 2167.7,1563.49 2170.01,1385.95 2172.32,1583.72 2174.63,1329.35 2176.93,1438.52 2179.24,1350.82 2181.55,1443.65 2183.86,1542.79 2186.17,1395.18 2188.47,1199.64 2190.78,1459.91 2193.09,1494.52 2195.4,1423.57 2197.71,1508.43 2200.01,1433.87 2202.32,1678.47 2204.63,1452.31 2206.94,1292.03 2209.25,1512.24 2211.55,1543.68 2213.86,1495.92 2216.17,1414.99 2218.48,1430.14 2220.79,1350.52 2223.09,1451.26 2225.4,1404.96 2227.71,1321.65 2230.02,1471.07 2232.32,1541.31 2234.63,1484.77 2236.94,1462.09 2239.25,1676.53 2241.56,1358.22 2243.86,1499.42 2246.17,1412.52 2248.48,1298.23 2250.79,1398.89 2253.1,1340.51 2255.4,1337.87 2257.71,1476.66 2260.02,1302.36 2262.33,1468.23 2264.64,1432.03 2266.94,1461.68 2269.25,1410.39 2271.56,1488.19 2273.87,1751.15 2276.18,1505.75 2278.48,1451.56 2280.79,1516.42 2283.1,1497.31 2285.41,1606.17 2287.71,1524.6 2290.02,1421.53 2292.33,1536.1 2294.64,1321.28 2296.95,1424.49 2299.25,1341.16 2301.56,1587.27 2303.87,1595.96 2306.18,1364.39 2308.49,1561.03 2310.79,1464.29 2313.1,1461.77 2315.41,1349.92 2317.72,1488.8 2320.03,1548.83 2322.33,1507.11 2324.64,1417.7 2326.95,1316.1 2329.26,1543.51 2331.56,1314.14 2333.87,1487.19 2336.18,1397.84 2338.49,1472.95 2340.8,1534.99 2343.1,1411.81 2345.41,1324.05 2347.72,1429.57 2350.03,1325.06 2352.34,1487.33 2354.64,1420.49 2356.95,1506.24 2359.26,1293.68 2361.57,1476.27 2363.88,1423.33 2366.18,1558.06 2368.49,1428.31 2370.8,1382.2 2373.11,1345.54 2375.42,1406.67 2377.72,1469.74 2380.03,1405.34 2382.34,1505.52 2384.65,1627.16 2386.95,1466.46 2389.26,1435.69 2391.57,1287.83 2393.88,1290.03 2396.19,1454.37 2398.49,1592.43 2400.8,1318.9 2403.11,1373.87 2405.42,1590.31 2407.73,1405.09 2410.03,1634.92 2412.34,1417.05 2414.65,1465.76 2416.96,1256.16 2419.27,1381.47 2421.57,1391.25 2423.88,1554.31 2426.19,1463.47 2428.5,1592.06 2430.81,1342.95 2433.11,1473.17 2435.42,1571.8 2437.73,1437.99 2440.04,1411.49 2442.34,1572.89 2444.65,1390.19 2446.96,1333.11 2449.27,1295.11 2451.58,1684.55 2453.88,1480.44 2456.19,1361.86 2458.5,1490.36 2460.81,1468.54 2463.12,1571.62 2465.42,1425.86 2467.73,1583.79 2470.04,1433.49 2472.35,1383.4 2474.66,1470.74 2476.96,1455.1 2479.27,1626.12 2481.58,1503.53 2483.89,1422.96 2486.2,1597.32 2488.5,1474.48 2490.81,1350.66 2493.12,1371.86 2495.43,1463.24 2497.73,1614.37 2500.04,1475.38 2502.35,1344.8 2504.66,1479.21 2506.97,1409.77 2509.27,1492.15 2511.58,1373.73 2513.89,1463.48 2516.2,1401.54 2518.51,1467.56 2520.81,1452.9 2523.12,1313.43 2525.43,1309.49 2527.74,1505.3 2530.05,1448.45 2532.35,1418.84 2534.66,1460.14 2536.97,1515.08 2539.28,1587.88 2541.58,1410.06 2543.89,1393.48 2546.2,1481.56 2548.51,1460.55 2550.82,1405.93 2553.12,1448.07 2555.43,1485.14 2557.74,1424.28 2560.05,1679.07 2562.36,1417.4 2564.66,1541.99 2566.97,1444.21 2569.28,1332.96 2571.59,1425.39 "></polyline>
<polyline clip-path="url(#clip912)" style="stroke:#e26f46; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="265.984,831.386 268.292,845.278 270.6,1054.65 272.908,936.118 275.216,870.653 277.524,1020.52 279.832,995.207 282.139,927.602 284.447,1048.2 286.755,852.221 289.063,1002.12 291.371,828.798 293.679,862.958 295.987,880.239 298.295,953.88 300.603,945.906 302.911,1079.18 305.219,916.91 307.527,823.324 309.834,1084.69 312.142,913.13 314.45,888.205 316.758,913.639 319.066,889.13 321.374,908.994 323.682,894.196 325.99,827.984 328.298,1030.58 330.606,1055.29 332.914,936.207 335.221,814.378 337.529,1035.18 339.837,848.298 342.145,890.193 344.453,957.701 346.761,884.555 349.069,900.505 351.377,920.232 353.685,696.901 355.993,927.45 358.301,1031.59 360.608,892.338 362.916,1105.86 365.224,930.172 367.532,830.458 369.84,994.98 372.148,900.916 374.456,1038.01 376.764,867.982 379.072,1009.99 381.38,899.853 383.688,744.363 385.996,985.357 388.303,966.393 390.611,762.406 392.919,833.391 395.227,928.933 397.535,794.523 399.843,880.228 402.151,869.747 404.459,1121.26 406.767,964.235 409.075,1021.52 411.383,892.08 413.69,1018.59 415.998,935.684 418.306,955.77 420.614,984.277 422.922,1150.86 425.23,916.994 427.538,1059.41 429.846,954.562 432.154,854.7 434.462,910.605 436.77,1121.96 439.077,1034.44 441.385,946.659 443.693,835.38 446.001,830.181 448.309,737.453 450.617,1017.47 452.925,783.059 455.233,957.144 457.541,1046.21 459.849,822.404 462.157,890.896 464.465,904.12 466.772,862.541 469.08,952.658 471.388,879.422 473.696,1022.01 476.004,936.883 478.312,893.444 480.62,850.73 482.928,951.046 485.236,830.826 487.544,1094.79 489.852,831.573 492.159,898.955 494.467,832.978 496.775,1000.19 499.083,819.975 501.391,925.403 503.699,1128.26 506.007,854.791 508.315,672.046 510.623,1011.42 512.931,859.436 515.239,942.513 517.546,1052.49 519.854,922.574 522.162,999.709 524.47,986.303 526.778,827.156 529.086,957.552 531.394,945.344 533.702,924.997 536.01,1117.81 538.318,1109.23 540.626,878.636 542.933,928.78 545.241,994.145 547.549,1124.16 549.857,999.708 552.165,988.88 554.473,972.429 556.781,930.903 559.089,1020.12 561.397,1079.26 563.705,906.145 566.013,1002.52 568.321,995.947 570.628,1055.86 572.936,1106.35 575.244,906.603 577.552,888.799 579.86,974.24 582.168,1020.4 584.476,1094.19 586.784,864.591 589.092,754.677 591.4,1111.44 593.708,1038.83 596.015,1095.91 598.323,1085.12 600.631,720.53 602.939,805.608 605.247,1039.68 607.555,1094.54 609.863,762.514 612.171,1118.26 614.479,1143.4 616.787,986.372 619.095,1174.94 621.402,1037.66 623.71,951.709 626.018,980.3 628.326,785.891 630.634,851.377 632.942,1002.11 635.25,1055.41 637.558,1147.29 639.866,858.669 642.174,904.358 644.482,846.534 646.79,949.757 649.097,1057.78 651.405,938.61 653.713,885.721 656.021,939.616 658.329,858.658 660.637,910.885 662.945,1056.99 665.253,973.771 667.561,875.194 669.869,808.023 672.177,771.931 674.484,970.144 676.792,999.52 679.1,857.98 681.408,872.577 683.716,1064.21 686.024,1108.89 688.332,927.69 690.64,870.199 692.948,931.19 695.256,1012.36 697.564,933.996 699.871,873.049 702.179,948.112 704.487,841.244 706.795,1025.2 709.103,978.303 711.411,946.737 713.719,970.932 716.027,929.076 718.335,1024.58 720.643,929.453 722.951,1017.46 725.259,949.746 727.566,1179.92 729.874,798.947 732.182,928.997 734.49,809.846 736.798,889.261 739.106,950.054 741.414,975.226 743.722,1035.9 746.03,922.372 748.338,940.604 750.646,904.373 752.953,924.025 755.261,846.135 757.569,991.423 759.877,812.507 762.185,831.189 764.493,1150.11 766.801,873.389 769.109,1055.86 771.417,958.323 773.725,957.243 776.033,1161.1 778.34,918.975 780.648,852.571 782.956,920.411 785.264,1021.02 787.572,875.147 789.88,1018.47 792.188,966.901 794.496,717.946 796.804,958.709 799.112,1064.96 801.42,939.292 803.728,960.639 806.035,848.953 808.343,933.317 810.651,955.712 812.959,962.495 815.267,941.876 817.575,814.153 819.883,735.486 822.191,1135.83 824.499,945.036 826.807,1021.46 829.115,739.704 831.422,1025.12 833.73,994.296 836.038,884.854 838.346,833.057 840.654,889.264 842.962,997.036 845.27,843.899 847.578,1018.69 849.886,1057.65 852.194,963.011 854.502,952.259 856.809,902.049 859.117,882.374 861.425,855.474 863.733,888.727 866.041,831.181 868.349,1056.46 870.657,999.6 872.965,1018.57 875.273,964.445 877.581,1101.3 879.889,886.694 882.197,1007.63 884.504,1003.27 886.812,1100.32 889.12,849.018 891.428,946.711 893.736,846.889 896.044,1081.13 898.352,899.894 900.66,748.918 902.968,1021.71 905.276,994.653 907.584,1026.18 909.891,835.13 912.199,997.049 914.507,921.321 916.815,860.186 919.123,1237.78 921.431,773.451 923.739,922.824 926.047,1092.87 928.355,928.863 930.663,979.57 932.971,802.917 935.278,1052.83 937.586,978.805 939.894,1010.98 942.202,1033.27 944.51,971.115 946.818,957.952 949.126,959.95 951.434,765.1 953.742,906.186 956.05,916.46 958.358,873.989 960.665,746.378 962.973,978.057 965.281,982.947 967.589,1027.58 969.897,937.252 972.205,889.317 974.513,996.811 976.821,699.105 979.129,1037.6 981.437,946.615 983.745,854.708 986.053,813.561 988.36,1064.06 990.668,1121.71 992.976,1044.94 995.284,966.679 997.592,992.993 999.9,753.129 1002.21,982.2 1004.52,855.635 1006.82,948.698 1009.13,927.869 1011.44,1101.53 1013.75,1047.5 1016.06,958.025 1018.36,928.803 1020.67,810.851 1022.98,1125.8 1025.29,838.272 1027.59,875 1029.9,987.491 1032.21,1009.91 1034.52,1024.52 1036.83,865.049 1039.13,714.757 1041.44,868.37 1043.75,919.874 1046.06,952.298 1048.37,918.475 1050.67,972.024 1052.98,898.561 1055.29,946.164 1057.6,933.075 1059.91,868.515 1062.21,917.607 1064.52,772.096 1066.83,1023.98 1069.14,906.807 1071.45,826.548 1073.75,1029.09 1076.06,905.908 1078.37,759.527 1080.68,855.114 1082.98,710.245 1085.29,990.794 1087.6,844.269 1089.91,1122.42 1092.22,1073.59 1094.52,978.833 1096.83,779.817 1099.14,1086.6 1101.45,911.058 1103.76,944.311 1106.06,884.836 1108.37,1054.77 1110.68,1064.05 1112.99,1079.76 1115.3,928.929 1117.6,842.318 1119.91,843.607 1122.22,894.594 1124.53,942.324 1126.84,898.267 1129.14,931.094 1131.45,1048.95 1133.76,852.542 1136.07,947.763 1138.37,1036.71 1140.68,868.904 1142.99,1109.79 1145.3,1108.76 1147.61,751.334 1149.91,929.188 1152.22,945.632 1154.53,873.309 1156.84,979.494 1159.15,1047.92 1161.45,1021.52 1163.76,898.53 1166.07,819.75 1168.38,1018.04 1170.69,764.795 1172.99,845.707 1175.3,1031.26 1177.61,872.86 1179.92,1007.29 1182.23,905.967 1184.53,847.189 1186.84,1023.14 1189.15,933.21 1191.46,1006.89 1193.76,882.842 1196.07,926.18 1198.38,1154.84 1200.69,1083.17 1203,1018.42 1205.3,1089.17 1207.61,797.448 1209.92,969.371 1212.23,1088.75 1214.54,909.062 1216.84,1121.98 1219.15,1028.86 1221.46,806.495 1223.77,1049.12 1226.08,1037.88 1228.38,882.749 1230.69,992.783 1233,820.794 1235.31,891.268 1237.61,1026.32 1239.92,911.909 1242.23,1102.78 1244.54,787.245 1246.85,1041.68 1249.15,999.789 1251.46,898.859 1253.77,809.939 1256.08,988.712 1258.39,1011.83 1260.69,972.662 1263,982.835 1265.31,958.159 1267.62,1000.97 1269.93,887.818 1272.23,1026.11 1274.54,904.885 1276.85,1015.38 1279.16,935.939 1281.47,914.616 1283.77,1044.73 1286.08,792.257 1288.39,807.2 1290.7,1074.53 1293,1072.65 1295.31,955.428 1297.62,950.988 1299.93,1004.77 1302.24,937.024 1304.54,886.551 1306.85,902.06 1309.16,1054.42 1311.47,1113.3 1313.78,887.513 1316.08,1022.01 1318.39,1010.94 1320.7,877.594 1323.01,1054.56 1325.32,892.797 1327.62,895.934 1329.93,961.699 1332.24,1098.5 1334.55,896.417 1336.86,1004.27 1339.16,892.944 1341.47,973.389 1343.78,1066.4 1346.09,1052.61 1348.39,813.659 1350.7,932.084 1353.01,903.135 1355.32,804.358 1357.63,930.518 1359.93,940.449 1362.24,1126.4 1364.55,874.545 1366.86,985.04 1369.17,1028.03 1371.47,935.054 1373.78,892.072 1376.09,958.056 1378.4,956.401 1380.71,939.963 1383.01,862.441 1385.32,1065.04 1387.63,957.909 1389.94,845.39 1392.24,922.485 1394.55,873.585 1396.86,830.512 1399.17,720.835 1401.48,979.942 1403.78,1061.83 1406.09,1034.63 1408.4,928.563 1410.71,1181.65 1413.02,1001.54 1415.32,1110.33 1417.63,948.749 1419.94,1037.07 1422.25,989.055 1424.56,959.41 1426.86,870.548 1429.17,941.135 1431.48,986.471 1433.79,811.416 1436.1,849.159 1438.4,910.815 1440.71,997.416 1443.02,928.8 1445.33,964.368 1447.63,1139.91 1449.94,1107.25 1452.25,843.031 1454.56,926.434 1456.87,994.345 1459.17,1029.88 1461.48,1014.12 1463.79,774.331 1466.1,857.571 1468.41,930.859 1470.71,901.639 1473.02,916.912 1475.33,892.358 1477.64,867.438 1479.95,1048.05 1482.25,1039.94 1484.56,1087.84 1486.87,945.244 1489.18,884.628 1491.49,1088.74 1493.79,978.385 1496.1,1212.82 1498.41,1036.78 1500.72,1116.56 1503.02,893.407 1505.33,837.743 1507.64,713.391 1509.95,881.702 1512.26,886.22 1514.56,931.473 1516.87,919.742 1519.18,909.208 1521.49,998.01 1523.8,719.711 1526.1,1063.86 1528.41,923.814 1530.72,1090.92 1533.03,886.14 1535.34,1083.19 1537.64,918.643 1539.95,857.49 1542.26,971.882 1544.57,876.043 1546.88,1018.68 1549.18,870.838 1551.49,995.077 1553.8,768.989 1556.11,936.765 1558.41,1034.41 1560.72,873.15 1563.03,890.628 1565.34,935.3 1567.65,914.873 1569.95,915.782 1572.26,866.082 1574.57,1064.47 1576.88,1006.95 1579.19,1078.91 1581.49,929.637 1583.8,927.213 1586.11,1012.47 1588.42,870.27 1590.73,945.901 1593.03,1070.9 1595.34,1040.62 1597.65,768.998 1599.96,987.544 1602.26,910.626 1604.57,936.465 1606.88,1021 1609.19,961.997 1611.5,1077.77 1613.8,1097.89 1616.11,990.789 1618.42,800.51 1620.73,777.891 1623.04,1053.69 1625.34,894.149 1627.65,1063.44 1629.96,1113 1632.27,1151 1634.58,990.175 1636.88,962.97 1639.19,960.822 1641.5,1027.72 1643.81,1049.82 1646.12,1080.92 1648.42,765.921 1650.73,947.182 1653.04,879.376 1655.35,948.094 1657.65,1024.68 1659.96,1082.42 1662.27,862.593 1664.58,905.189 1666.89,935.795 1669.19,776.381 1671.5,905.591 1673.81,943.895 1676.12,983.964 1678.43,833.375 1680.73,975.827 1683.04,836.068 1685.35,893.429 1687.66,804.832 1689.97,1060.31 1692.27,1052.1 1694.58,924.164 1696.89,887.466 1699.2,916.26 1701.51,1063.84 1703.81,871.455 1706.12,989.185 1708.43,1032.55 1710.74,810.116 1713.04,972.274 1715.35,982.001 1717.66,873.199 1719.97,874.38 1722.28,1144.68 1724.58,852.68 1726.89,933.916 1729.2,1066.62 1731.51,959.477 1733.82,979.526 1736.12,909.097 1738.43,1000.45 1740.74,944.729 1743.05,1098.11 1745.36,913.821 1747.66,909.113 1749.97,910.041 1752.28,928.606 1754.59,821.155 1756.9,973.066 1759.2,868.206 1761.51,772.294 1763.82,965.796 1766.13,1015.41 1768.43,1040.15 1770.74,958.742 1773.05,896.998 1775.36,1120.91 1777.67,917.671 1779.97,919.487 1782.28,878.661 1784.59,1136.54 1786.9,980.625 1789.21,984.121 1791.51,931.725 1793.82,773.211 1796.13,989.013 1798.44,895.062 1800.75,1116.93 1803.05,925.593 1805.36,904.979 1807.67,994.083 1809.98,964.624 1812.28,877.403 1814.59,1195.98 1816.9,1053.08 1819.21,1056.03 1821.52,980.516 1823.82,1020.31 1826.13,992.127 1828.44,775.156 1830.75,985.122 1833.06,872.805 1835.36,1068.91 1837.67,1015.01 1839.98,904.833 1842.29,839.558 1844.6,795.18 1846.9,940.221 1849.21,1063.12 1851.52,1069.55 1853.83,938.788 1856.14,915.95 1858.44,880.409 1860.75,910.192 1863.06,879.942 1865.37,759.894 1867.67,1032.07 1869.98,913.797 1872.29,1190.22 1874.6,794.702 1876.91,899.062 1879.21,819.515 1881.52,756.055 1883.83,861.365 1886.14,958.52 1888.45,974.06 1890.75,849.732 1893.06,820.237 1895.37,1089.63 1897.68,960.164 1899.99,744.667 1902.29,951.385 1904.6,923.348 1906.91,1048.6 1909.22,849.058 1911.53,1075.26 1913.83,1157.46 1916.14,1011.62 1918.45,1006.55 1920.76,1007.5 1923.06,749.046 1925.37,956.261 1927.68,1018.07 1929.99,940.739 1932.3,810.825 1934.6,1026.28 1936.91,1191.4 1939.22,961.44 1941.53,902.775 1943.84,927.381 1946.14,924.907 1948.45,964.897 1950.76,769.883 1953.07,1021.78 1955.38,1122.44 1957.68,764.145 1959.99,780.747 1962.3,945.491 1964.61,821.313 1966.91,900.957 1969.22,1117.49 1971.53,979.092 1973.84,965.697 1976.15,830.691 1978.45,871.444 1980.76,889.737 1983.07,1067.57 1985.38,923.821 1987.69,819.352 1989.99,984.657 1992.3,1031.82 1994.61,875.334 1996.92,1012.14 1999.23,969.875 2001.53,867.48 2003.84,1081.59 2006.15,993.394 2008.46,944.161 2010.77,951.805 2013.07,838.053 2015.38,1172.71 2017.69,1112.28 2020,920.414 2022.3,817.639 2024.61,984.262 2026.92,1069.94 2029.23,839.67 2031.54,893.105 2033.84,923.747 2036.15,729.425 2038.46,1049.03 2040.77,922.357 2043.08,929.524 2045.38,851.441 2047.69,911.78 2050,836.595 2052.31,942.843 2054.62,1161.07 2056.92,1005 2059.23,1138.96 2061.54,898.891 2063.85,948.993 2066.16,1051.35 2068.46,920.428 2070.77,1019.88 2073.08,998.517 2075.39,975.754 2077.69,977.946 2080,845.938 2082.31,878.266 2084.62,1006.69 2086.93,1139.45 2089.23,947.053 2091.54,922.766 2093.85,1003.92 2096.16,891.486 2098.47,924.009 2100.77,1114.75 2103.08,1085.58 2105.39,824.842 2107.7,857.372 2110.01,851.749 2112.31,1022.32 2114.62,974.495 2116.93,1046.07 2119.24,830.46 2121.55,1010.76 2123.85,809.189 2126.16,970.136 2128.47,1010.78 2130.78,990.124 2133.08,998.576 2135.39,1004.71 2137.7,928.547 2140.01,810.144 2142.32,896.471 2144.62,985.4 2146.93,857.468 2149.24,944.073 2151.55,914.245 2153.86,880.215 2156.16,1020.89 2158.47,1064.89 2160.78,993.785 2163.09,934.608 2165.4,1086.55 2167.7,811.594 2170.01,834.01 2172.32,1036.76 2174.63,976.469 2176.93,1007.3 2179.24,950.537 2181.55,785.084 2183.86,968.742 2186.17,1144.07 2188.47,874.34 2190.78,978.933 2193.09,1027.43 2195.4,968.786 2197.71,963.764 2200.01,1008.6 2202.32,1070.72 2204.63,1051.92 2206.94,1066.93 2209.25,916.227 2211.55,1002.98 2213.86,947.355 2216.17,899.94 2218.48,916.162 2220.79,1086.79 2223.09,832.69 2225.4,1054.4 2227.71,930.763 2230.02,878.923 2232.32,1005.27 2234.63,987.296 2236.94,995.581 2239.25,974.402 2241.56,1004.87 2243.86,890.34 2246.17,737.067 2248.48,1026.5 2250.79,962.326 2253.1,1104.6 2255.4,616.701 2257.71,959.489 2260.02,964.419 2262.33,955.997 2264.64,851.238 2266.94,1021.5 2269.25,999.927 2271.56,1059.37 2273.87,906.508 2276.18,1043.52 2278.48,1025.29 2280.79,1060.83 2283.1,1010.78 2285.41,977.455 2287.71,905.331 2290.02,998.442 2292.33,878.391 2294.64,855.713 2296.95,1050 2299.25,1059.4 2301.56,943.777 2303.87,946.329 2306.18,832.334 2308.49,1018.39 2310.79,758.431 2313.1,1004.2 2315.41,920.771 2317.72,842.083 2320.03,964.655 2322.33,837.341 2324.64,1186.81 2326.95,805.81 2329.26,954.263 2331.56,1003.89 2333.87,847.628 2336.18,934.67 2338.49,830.925 2340.8,1061.51 2343.1,907.356 2345.41,813.416 2347.72,910.134 2350.03,1058.74 2352.34,1021.1 2354.64,998.077 2356.95,936.283 2359.26,806.607 2361.57,857.624 2363.88,981.473 2366.18,1072.58 2368.49,1034.84 2370.8,914.306 2373.11,902.16 2375.42,952.24 2377.72,1058.84 2380.03,1070.88 2382.34,1054.94 2384.65,904.345 2386.95,920.045 2389.26,1034.75 2391.57,724.053 2393.88,812.371 2396.19,840.498 2398.49,955.693 2400.8,982.449 2403.11,810.2 2405.42,922.799 2407.73,947.068 2410.03,901.71 2412.34,1017.83 2414.65,725.882 2416.96,950.054 2419.27,934.254 2421.57,804.94 2423.88,957.752 2426.19,866.093 2428.5,935.061 2430.81,864.721 2433.11,1098.32 2435.42,947.533 2437.73,1089.05 2440.04,912.242 2442.34,830.761 2444.65,882.037 2446.96,841.606 2449.27,1017.24 2451.58,966.549 2453.88,1073.16 2456.19,1075.63 2458.5,1113.98 2460.81,1024 2463.12,1004.44 2465.42,1005.72 2467.73,1039.06 2470.04,938.289 2472.35,979.653 2474.66,1074.46 2476.96,863.247 2479.27,931.383 2481.58,866.407 2483.89,840.637 2486.2,1010.64 2488.5,1004.53 2490.81,846.157 2493.12,912.191 2495.43,964.695 2497.73,935.691 2500.04,987.265 2502.35,1061.93 2504.66,883.038 2506.97,1082.63 2509.27,749.285 2511.58,775.313 2513.89,842.07 2516.2,909.289 2518.51,870.982 2520.81,1114.37 2523.12,1048.65 2525.43,1017.04 2527.74,888.216 2530.05,1033.24 2532.35,804.894 2534.66,844.043 2536.97,847.77 2539.28,1126.37 2541.58,972.831 2543.89,996.237 2546.2,961.604 2548.51,1046.46 2550.82,897.88 2553.12,1059.97 2555.43,848.057 2557.74,1031.68 2560.05,869.46 2562.36,931.66 2564.66,999.937 2566.97,895.823 2569.28,1019.53 2571.59,1017.82 "></polyline>
<polyline clip-path="url(#clip912)" style="stroke:#3da44d; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="265.984,717.877 268.292,640.403 270.6,424.346 272.908,452.041 275.216,522.213 277.524,269.302 279.832,353.514 282.139,406.211 284.447,402.908 286.755,430.344 289.063,183.834 291.371,399.028 293.679,662.216 295.987,465.605 298.295,437.398 300.603,451.977 302.911,427.822 305.219,253.862 307.527,487.173 309.834,495.083 312.142,311.952 314.45,580.187 316.758,457.492 319.066,501 321.374,301.106 323.682,505.893 325.99,540.981 328.298,588.07 330.606,376.585 332.914,520.958 335.221,459.807 337.529,453.423 339.837,303.579 342.145,720.043 344.453,401.542 346.761,466.678 349.069,451.359 351.377,418.453 353.685,601.621 355.993,378.263 358.301,398.671 360.608,281.929 362.916,388.039 365.224,423.359 367.532,493.718 369.84,571.803 372.148,482.678 374.456,415.957 376.764,420.995 379.072,694.57 381.38,399.847 383.688,370.357 385.996,208.897 388.303,328.147 390.611,524.848 392.919,473.277 395.227,590.514 397.535,363.573 399.843,334.225 402.151,670.192 404.459,430.766 406.767,399.936 409.075,613.289 411.383,442.337 413.69,420.402 415.998,433.377 418.306,477.145 420.614,380.69 422.922,278.989 425.23,493.933 427.538,500.974 429.846,454.259 432.154,238.574 434.462,518.98 436.77,450.235 439.077,356.323 441.385,410.487 443.693,412.914 446.001,407.451 448.309,387.281 450.617,657.547 452.925,269.532 455.233,301.228 457.541,559.095 459.849,453.095 462.157,475.947 464.465,459.663 466.772,306.152 469.08,503.06 471.388,363.356 473.696,353.89 476.004,305.215 478.312,456.693 480.62,370.874 482.928,619.166 485.236,491.296 487.544,388.654 489.852,589.342 492.159,275.105 494.467,476.143 496.775,409.665 499.083,454.05 501.391,502.868 503.699,335.417 506.007,447.676 508.315,386.566 510.623,539.91 512.931,450.592 515.239,506.581 517.546,444.534 519.854,359.457 522.162,517.144 524.47,434.194 526.778,271.497 529.086,374.289 531.394,463.803 533.702,488.588 536.01,524.842 538.318,487.342 540.626,532.311 542.933,725.801 545.241,525.586 547.549,414.79 549.857,383.956 552.165,510.291 554.473,345.008 556.781,640.214 559.089,412.762 561.397,563.089 563.705,443.776 566.013,421.483 568.321,513.506 570.628,367.527 572.936,458.278 575.244,331.712 577.552,585.777 579.86,490.279 582.168,481.424 584.476,560.965 586.784,457.291 589.092,457.73 591.4,504.587 593.708,527.599 596.015,422.853 598.323,503.54 600.631,292.319 602.939,435.9 605.247,419.909 607.555,410.835 609.863,483.071 612.171,466.774 614.479,582.468 616.787,580.688 619.095,427.073 621.402,353.254 623.71,460.295 626.018,346.947 628.326,549.204 630.634,643.68 632.942,358.347 635.25,450.672 637.558,442.343 639.866,559.617 642.174,628.967 644.482,471.501 646.79,521.043 649.097,339.524 651.405,354.239 653.713,361.308 656.021,353.69 658.329,410.792 660.637,454.105 662.945,638.713 665.253,520.914 667.561,351.49 669.869,472.383 672.177,325.595 674.484,496.859 676.792,437.688 679.1,418.435 681.408,499.332 683.716,509.047 686.024,381.935 688.332,565.521 690.64,447.346 692.948,463.76 695.256,303.82 697.564,398.645 699.871,270.361 702.179,476.242 704.487,366.886 706.795,473.994 709.103,442.895 711.411,549.935 713.719,598.7 716.027,386.239 718.335,668.289 720.643,340.427 722.951,431.59 725.259,269.119 727.566,427.743 729.874,554.958 732.182,493.499 734.49,360.108 736.798,491.654 739.106,466.925 741.414,313.371 743.722,523.752 746.03,322.643 748.338,354.037 750.646,552.638 752.953,468.349 755.261,490.697 757.569,685.96 759.877,500.567 762.185,374.777 764.493,424.726 766.801,451.007 769.109,442.96 771.417,583.126 773.725,408.518 776.033,448.747 778.34,519.848 780.648,401.991 782.956,475.957 785.264,445.374 787.572,372.358 789.88,517.092 792.188,510.022 794.496,480.108 796.804,542.565 799.112,343.384 801.42,494.271 803.728,532.952 806.035,401.448 808.343,391.795 810.651,433.796 812.959,508.09 815.267,275.102 817.575,364.169 819.883,408.149 822.191,454.704 824.499,251.379 826.807,497.524 829.115,423.465 831.422,435.96 833.73,639.955 836.038,504.53 838.346,350.81 840.654,381.624 842.962,504.901 845.27,572.196 847.578,636.769 849.886,475.551 852.194,473.579 854.502,318.236 856.809,551.945 859.117,473.684 861.425,611.423 863.733,448.286 866.041,540.536 868.349,605.658 870.657,595.437 872.965,448.694 875.273,479.466 877.581,590.296 879.889,455.76 882.197,511.438 884.504,525.755 886.812,561.901 889.12,692.049 891.428,519.029 893.736,412.456 896.044,417.186 898.352,570.157 900.66,547.505 902.968,437.552 905.276,346.998 907.584,563.32 909.891,401.929 912.199,271.619 914.507,504.573 916.815,470.629 919.123,236.815 921.431,533.317 923.739,428.661 926.047,570.632 928.355,607.531 930.663,495.232 932.971,437.345 935.278,440.06 937.586,401.968 939.894,553.426 942.202,549.044 944.51,257.147 946.818,446.781 949.126,423.257 951.434,493.068 953.742,330.909 956.05,474.375 958.358,327.466 960.665,451.808 962.973,498.476 965.281,394.222 967.589,253.773 969.897,528.022 972.205,434.835 974.513,299.848 976.821,527.612 979.129,462.747 981.437,350.854 983.745,445.138 986.053,433.106 988.36,420.738 990.668,400.141 992.976,402.157 995.284,365.871 997.592,576.859 999.9,529.852 1002.21,502.595 1004.52,387.289 1006.82,264.447 1009.13,442.34 1011.44,401.176 1013.75,281.952 1016.06,453.657 1018.36,603.453 1020.67,546.961 1022.98,649.718 1025.29,598.901 1027.59,414.605 1029.9,341.705 1032.21,626.788 1034.52,657.154 1036.83,497.791 1039.13,334.423 1041.44,300.641 1043.75,520.369 1046.06,615 1048.37,346.552 1050.67,426.498 1052.98,464.47 1055.29,475.778 1057.6,549.193 1059.91,533.324 1062.21,438.527 1064.52,543.214 1066.83,603.834 1069.14,544.854 1071.45,396.805 1073.75,414.311 1076.06,463.298 1078.37,682.059 1080.68,504.446 1082.98,440.833 1085.29,423.574 1087.6,397.641 1089.91,453.527 1092.22,599.574 1094.52,557.818 1096.83,367.912 1099.14,608.624 1101.45,442.314 1103.76,403.621 1106.06,364.544 1108.37,598.697 1110.68,612.59 1112.99,372.554 1115.3,491.236 1117.6,324.694 1119.91,403.163 1122.22,484.39 1124.53,416.038 1126.84,440.02 1129.14,473.136 1131.45,758.643 1133.76,509.682 1136.07,434.305 1138.37,546.881 1140.68,494.158 1142.99,439.201 1145.3,559.487 1147.61,573.634 1149.91,438.221 1152.22,521.615 1154.53,372.758 1156.84,413.307 1159.15,443.292 1161.45,476.469 1163.76,426.764 1166.07,538.45 1168.38,472.745 1170.69,516.423 1172.99,426.278 1175.3,444.847 1177.61,509.97 1179.92,485.307 1182.23,289.227 1184.53,629.09 1186.84,339.57 1189.15,573.848 1191.46,512.519 1193.76,553.014 1196.07,479.942 1198.38,518.847 1200.69,366.316 1203,405.756 1205.3,526.628 1207.61,402.125 1209.92,524.793 1212.23,508.962 1214.54,306.305 1216.84,422.509 1219.15,629.191 1221.46,387.609 1223.77,657.033 1226.08,430.767 1228.38,456.995 1230.69,365.935 1233,437.754 1235.31,441.718 1237.61,494.71 1239.92,505.132 1242.23,312.358 1244.54,538.065 1246.85,386.133 1249.15,420.207 1251.46,467.95 1253.77,434.515 1256.08,556.953 1258.39,553.313 1260.69,342.487 1263,368.857 1265.31,598.298 1267.62,523.871 1269.93,410.938 1272.23,556.952 1274.54,378.055 1276.85,392.027 1279.16,567.574 1281.47,580.813 1283.77,438.838 1286.08,526.767 1288.39,496.094 1290.7,387.805 1293,249.375 1295.31,410.954 1297.62,362.398 1299.93,512.753 1302.24,542.004 1304.54,634.453 1306.85,478.357 1309.16,353.785 1311.47,389.664 1313.78,358.715 1316.08,295.948 1318.39,508.673 1320.7,653.678 1323.01,525.028 1325.32,473.337 1327.62,296.449 1329.93,227.803 1332.24,393.319 1334.55,256.711 1336.86,500.185 1339.16,534.057 1341.47,438.672 1343.78,431.26 1346.09,333.194 1348.39,430.675 1350.7,368.878 1353.01,525.592 1355.32,473.338 1357.63,510.457 1359.93,471.868 1362.24,532.865 1364.55,636.795 1366.86,518.398 1369.17,438.016 1371.47,392.224 1373.78,429.531 1376.09,406.37 1378.4,493.913 1380.71,690.715 1383.01,444.283 1385.32,295.385 1387.63,364.236 1389.94,293.211 1392.24,464.02 1394.55,561.402 1396.86,393.836 1399.17,499.358 1401.48,550.331 1403.78,620.039 1406.09,493.46 1408.4,443.192 1410.71,540.29 1413.02,208.223 1415.32,348.664 1417.63,472.073 1419.94,418.103 1422.25,614.87 1424.56,547.03 1426.86,447.848 1429.17,404.507 1431.48,364.411 1433.79,426.667 1436.1,273.916 1438.4,439.196 1440.71,369.653 1443.02,494.996 1445.33,362.886 1447.63,289.598 1449.94,524.403 1452.25,279.16 1454.56,268.203 1456.87,576.59 1459.17,402.484 1461.48,429.408 1463.79,486.5 1466.1,320.847 1468.41,582.395 1470.71,440.018 1473.02,433.485 1475.33,314.738 1477.64,252.32 1479.95,393.527 1482.25,431.19 1484.56,385.06 1486.87,398.717 1489.18,476.807 1491.49,337.388 1493.79,501.294 1496.1,599.002 1498.41,388.918 1500.72,604.812 1503.02,461.372 1505.33,331.296 1507.64,428.712 1509.95,566.556 1512.26,355.71 1514.56,566.324 1516.87,467.435 1519.18,522.163 1521.49,465.154 1523.8,419.879 1526.1,300.948 1528.41,404.565 1530.72,463.825 1533.03,365.539 1535.34,441.225 1537.64,373.102 1539.95,655.979 1542.26,348.509 1544.57,604.838 1546.88,528.253 1549.18,491.117 1551.49,570.34 1553.8,521.909 1556.11,213.678 1558.41,139.497 1560.72,399.68 1563.03,345.683 1565.34,558.652 1567.65,523.971 1569.95,591.092 1572.26,596.739 1574.57,391.649 1576.88,547.878 1579.19,441.26 1581.49,343.63 1583.8,532.19 1586.11,471.197 1588.42,489.562 1590.73,400.441 1593.03,557.093 1595.34,588.597 1597.65,519.683 1599.96,392.095 1602.26,507.042 1604.57,473.965 1606.88,472.848 1609.19,573.982 1611.5,415.363 1613.8,355.289 1616.11,437.916 1618.42,563.857 1620.73,363.047 1623.04,431.137 1625.34,458.075 1627.65,609.369 1629.96,335.309 1632.27,486.936 1634.58,550.936 1636.88,441.922 1639.19,634.359 1641.5,465.877 1643.81,539.355 1646.12,570.608 1648.42,484.93 1650.73,534.793 1653.04,472.748 1655.35,463.081 1657.65,326.613 1659.96,703.005 1662.27,529.478 1664.58,212.804 1666.89,430.454 1669.19,536.173 1671.5,344.111 1673.81,430.426 1676.12,449.026 1678.43,530.441 1680.73,388.92 1683.04,332.431 1685.35,463.782 1687.66,548.747 1689.97,436.444 1692.27,316.539 1694.58,475.821 1696.89,333.874 1699.2,551.494 1701.51,437.465 1703.81,304.391 1706.12,481.38 1708.43,455.365 1710.74,343.737 1713.04,381.972 1715.35,489.33 1717.66,384.988 1719.97,344.706 1722.28,490.659 1724.58,649.188 1726.89,382.933 1729.2,354.662 1731.51,519.86 1733.82,344.925 1736.12,426.176 1738.43,376.763 1740.74,306.668 1743.05,437.874 1745.36,341.797 1747.66,371.346 1749.97,413.373 1752.28,363.12 1754.59,378.166 1756.9,342.582 1759.2,540.637 1761.51,219.868 1763.82,379.954 1766.13,514.046 1768.43,495.04 1770.74,509.008 1773.05,361.825 1775.36,336.619 1777.67,479.507 1779.97,382.389 1782.28,583.147 1784.59,416.084 1786.9,346.286 1789.21,119.736 1791.51,547.182 1793.82,515.141 1796.13,495.271 1798.44,421.818 1800.75,391.748 1803.05,315.088 1805.36,531.721 1807.67,654.252 1809.98,552.596 1812.28,447.374 1814.59,423.238 1816.9,372.231 1819.21,308.058 1821.52,545.277 1823.82,322.094 1826.13,352.678 1828.44,490.653 1830.75,433.761 1833.06,367.191 1835.36,440.887 1837.67,510.366 1839.98,550.834 1842.29,273.882 1844.6,692.759 1846.9,96.8724 1849.21,453.018 1851.52,529.294 1853.83,283.972 1856.14,354.708 1858.44,466.127 1860.75,449.039 1863.06,436.45 1865.37,510.906 1867.67,386.006 1869.98,485.287 1872.29,279.207 1874.6,505.24 1876.91,239.182 1879.21,343.799 1881.52,572.188 1883.83,537.012 1886.14,370.849 1888.45,422.105 1890.75,445.845 1893.06,388.741 1895.37,597.722 1897.68,326.083 1899.99,322.063 1902.29,440.361 1904.6,501.37 1906.91,301.392 1909.22,280.95 1911.53,329.686 1913.83,313.797 1916.14,595.372 1918.45,315.173 1920.76,380.41 1923.06,335.857 1925.37,423.78 1927.68,433.722 1929.99,492.26 1932.3,473.6 1934.6,549.379 1936.91,444.124 1939.22,462.681 1941.53,488.346 1943.84,584.274 1946.14,506.538 1948.45,481.629 1950.76,563.797 1953.07,533.268 1955.38,506.502 1957.68,459.865 1959.99,313.297 1962.3,544.833 1964.61,350.437 1966.91,502.782 1969.22,468.102 1971.53,514.843 1973.84,433.223 1976.15,507.358 1978.45,363.365 1980.76,510.826 1983.07,248.675 1985.38,393.247 1987.69,432.945 1989.99,406.646 1992.3,389.34 1994.61,491.991 1996.92,511.343 1999.23,350.705 2001.53,513.954 2003.84,652.202 2006.15,422.712 2008.46,375.503 2010.77,371.04 2013.07,407.074 2015.38,453.308 2017.69,540.271 2020,343.633 2022.3,486.643 2024.61,426.888 2026.92,481.173 2029.23,501.746 2031.54,327.846 2033.84,599.351 2036.15,318.812 2038.46,430.832 2040.77,532.681 2043.08,457.489 2045.38,699.391 2047.69,228.418 2050,578.829 2052.31,373.173 2054.62,567.221 2056.92,491.31 2059.23,479.032 2061.54,431.41 2063.85,484.388 2066.16,448.377 2068.46,448.825 2070.77,545.996 2073.08,611.634 2075.39,514.091 2077.69,531.821 2080,586.132 2082.31,532.712 2084.62,351.266 2086.93,412.823 2089.23,463.707 2091.54,499.667 2093.85,447.981 2096.16,676.138 2098.47,321.2 2100.77,376.432 2103.08,300.115 2105.39,485.502 2107.7,369.922 2110.01,321.455 2112.31,369.024 2114.62,496.921 2116.93,556.695 2119.24,484.711 2121.55,520.682 2123.85,524.619 2126.16,501.039 2128.47,714.905 2130.78,512.835 2133.08,227.523 2135.39,354.721 2137.7,471.539 2140.01,503.261 2142.32,384.78 2144.62,459.395 2146.93,486.292 2149.24,287.146 2151.55,504.762 2153.86,315.643 2156.16,574.37 2158.47,513.523 2160.78,532.181 2163.09,560.705 2165.4,502.582 2167.7,350.408 2170.01,313.125 2172.32,491.222 2174.63,345.841 2176.93,455.183 2179.24,461.52 2181.55,336.088 2183.86,428.751 2186.17,605.906 2188.47,455.831 2190.78,484.193 2193.09,380.687 2195.4,169.896 2197.71,468.346 2200.01,390.988 2202.32,559.299 2204.63,375.463 2206.94,484.721 2209.25,492.104 2211.55,588.215 2213.86,396.985 2216.17,360.366 2218.48,491.762 2220.79,560.533 2223.09,454.785 2225.4,211.872 2227.71,550.311 2230.02,682.574 2232.32,502.494 2234.63,468.085 2236.94,553.544 2239.25,368.886 2241.56,305.981 2243.86,481.219 2246.17,527.354 2248.48,602.754 2250.79,478.445 2253.1,464.547 2255.4,399.277 2257.71,379.392 2260.02,494.648 2262.33,558.498 2264.64,465.765 2266.94,429.517 2269.25,702.233 2271.56,286.542 2273.87,551.161 2276.18,419.123 2278.48,471.012 2280.79,451.533 2283.1,493.953 2285.41,466.323 2287.71,368.856 2290.02,429.314 2292.33,399.451 2294.64,265.948 2296.95,346.777 2299.25,593.814 2301.56,456.65 2303.87,512.28 2306.18,637.165 2308.49,308.862 2310.79,389.808 2313.1,494.424 2315.41,497.475 2317.72,408.409 2320.03,425.077 2322.33,525.307 2324.64,447.461 2326.95,642.974 2329.26,399.415 2331.56,354.264 2333.87,533.04 2336.18,442.815 2338.49,571.953 2340.8,434.941 2343.1,467.382 2345.41,363.625 2347.72,300.768 2350.03,346.878 2352.34,593.303 2354.64,467.032 2356.95,574.098 2359.26,614.519 2361.57,588.639 2363.88,686.619 2366.18,503.288 2368.49,301.926 2370.8,409.703 2373.11,429.768 2375.42,435.526 2377.72,547.197 2380.03,333.527 2382.34,534.63 2384.65,111.949 2386.95,312.284 2389.26,432.291 2391.57,440.231 2393.88,445.035 2396.19,333.549 2398.49,482.602 2400.8,345.55 2403.11,374.638 2405.42,306.342 2407.73,385.095 2410.03,537.723 2412.34,482.092 2414.65,286.778 2416.96,515.714 2419.27,335.353 2421.57,385.953 2423.88,550.713 2426.19,491.054 2428.5,387.291 2430.81,431.316 2433.11,382.687 2435.42,370.228 2437.73,284.961 2440.04,484.008 2442.34,558.358 2444.65,464.529 2446.96,517.221 2449.27,549.972 2451.58,564.433 2453.88,345.528 2456.19,617.428 2458.5,401.809 2460.81,356.435 2463.12,470.696 2465.42,534.635 2467.73,523.152 2470.04,476.997 2472.35,289.668 2474.66,724.131 2476.96,414.565 2479.27,403.034 2481.58,512.269 2483.89,449.574 2486.2,580.114 2488.5,453.777 2490.81,486.936 2493.12,436.064 2495.43,275.806 2497.73,418.279 2500.04,293.349 2502.35,405.482 2504.66,670.046 2506.97,378.715 2509.27,378.119 2511.58,535.905 2513.89,348.1 2516.2,380.328 2518.51,397.783 2520.81,740.654 2523.12,435.621 2525.43,469.949 2527.74,465.753 2530.05,528.796 2532.35,393.082 2534.66,429.18 2536.97,456.654 2539.28,591.339 2541.58,440.888 2543.89,576.015 2546.2,479.348 2548.51,424.723 2550.82,550.659 2553.12,378.22 2555.43,241.043 2557.74,446.601 2560.05,266.757 2562.36,349.939 2564.66,587.851 2566.97,418.795 2569.28,405.72 2571.59,389.076 "></polyline>
</svg>
</div>
</div>
<p>Look at that! Things are working; amazin’.</p>
<p>We can also exploit <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>’s parallel sampling capabilities:</p>
<div id="34" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run separate 4 chains for 10 000 iterations using threads to parallelize.</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>num_chains <span class="op">=</span> <span class="fl">4</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    model_with_grad,</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">MCMCThreads</span>(),</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>,</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    num_chains;</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Note we need to provide an initial state for every chain.</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>    initial_state<span class="op">=</span><span class="fu">fill</span>(state, num_chains),</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>samples_array <span class="op">=</span> <span class="fu">stack</span>(<span class="fu">map</span>(<span class="bu">Base</span>.<span class="fu">Fix1</span>(stack, sample <span class="op">-&gt;</span> sample.x), samples))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000×4 Array{Float64, 3}:
[:, :, 1] =
 -1.40125  -4.57548  -5.33819    -6.53001   …  -5.54394  -5.03691  -6.75652
  1.04963   1.11481  -0.0990121  -0.518113      1.34271   1.22735   0.52548
  2.7416    3.00718   4.11135     3.42796       4.01874   4.53662   5.30338

[:, :, 2] =
 -4.92661   -4.64141   -2.91088   …  -4.73897  -5.70035  -4.97
 -0.263146  -0.936008  -0.681652     -1.83594  -1.158    -0.683586
  2.9166     3.16043    4.96998       3.9232    4.84813   4.95997

[:, :, 3] =
 -2.91225   -2.59471   -3.28789  …  -4.44134   -3.86591   -3.86591
  0.539247  -0.319292   1.012       -0.267822  -0.905526  -0.905526
  2.49474    3.39817    3.85807      3.36164    3.3212     3.3212

[:, :, 4] =
 -1.20567   -2.71778   -4.39228  -4.39228  …  -4.34054  -2.90281   -3.21275
  0.372964   0.297077  -0.64311  -0.64311     -1.55632   0.266009   0.940887
  1.17727    3.07057    4.08199   4.08199      4.88412   4.41858    3.82078</code></pre>
</div>
</div>
<p>But the fact that we have to provide the <code>AbstractMCMC.sample</code> call, etc. with an <code>initial_state</code> to get started is a bit annoying. We can avoid this by also defining a <code>AbstractMCMC.step</code> <em>without</em> the <code>state</code> argument:</p>
<div id="36" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">::</span><span class="dt">MALA</span>;</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># </span><span class="al">NOTE</span><span class="co">: No state provided!</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just create the initial state by sampling using  a Gaussian.</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="fu">randn</span>(rng, LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(x), <span class="fu">MALAState</span>(x)</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Equipped with this, we no longer need to provide the <code>initial_state</code> everywhere:</p>
<div id="38" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -5.00345    0.995777
 -0.0133748  1.00542
  4.97235    1.00807</code></pre>
</div>
</div>
</section>
<section id="using-our-sampler-with-turing.jl" class="level2">
<h2 class="anchored" data-anchor-id="using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</h2>
<p>As we promised, all of this hassle of implementing our <code>MALA</code> sampler in a way that uses <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> and <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> gets us something more than <em>just</em> an “automatic” implementation of <code>AbstractMCMC.sample</code>.</p>
<p>It also enables use with Turing.jl through the <code>externalsampler</code>, but we need to do one final thing first: we need to tell Turing.jl how to extract a vector of parameters from the “sample” returned in our implementation of <code>AbstractMCMC.step</code>. In our case, the “sample” is a <code>MALASample</code>, so we just need the following line:</p>
<div id="40" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load Turing.jl.</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Turing</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Overload the `getparams` method for our "sample" type, which is just a vector.</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>Turing.Inference.<span class="fu">getparams</span>(<span class="op">::</span><span class="dt">Turing.Model</span>, sample<span class="op">::</span><span class="dt">MALASample</span>) <span class="op">=</span> sample.x</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And with that, we’re good to go!</p>
<div id="42" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Our previous model defined as a Turing.jl model.</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">mvnormal_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">MvNormal</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.], I)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate our model.</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">mvnormal_model</span>()</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Call `sample` but now we're passing in a Turing.jl `model` and wrapping</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co"># our `MALA` sampler in the `externalsampler` to tell Turing.jl that the sampler</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co"># expects something that implements LogDensityProblems.jl.</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×4×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 2.68 seconds
Compute duration  = 2.68 seconds
parameters        = x[1], x[2], x[3]
internals         = lp

Summary Statistics
  parameters      mean       std      mcse    ess_bulk    ess_tail      rhat   ⋯
      Symbol   Float64   Float64   Float64     Float64     Float64   Float64   ⋯

        x[1]   -5.0190    1.0157    0.0176   3340.3510   4756.2664    1.0000   ⋯
        x[2]   -0.0146    1.0108    0.0181   3121.9163   5268.7464    1.0015   ⋯
        x[3]    5.0305    1.0090    0.0180   3152.9078   4817.2675    1.0012   ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

        x[1]   -7.0073   -5.6973   -5.0230   -4.3368   -3.0272
        x[2]   -1.9634   -0.7080   -0.0190    0.6682    1.9511
        x[3]    3.0331    4.3502    5.0427    5.7194    6.9828</code></pre>
</div>
</div>
<p>Pretty neat, eh?</p>
<section id="models-with-constrained-parameters" class="level3">
<h3 class="anchored" data-anchor-id="models-with-constrained-parameters">Models with constrained parameters</h3>
<p>One thing we’ve sort of glossed over in all of the above is that MALA, at least how we’ve implemented it, requires <span class="math inline">\(x\)</span> to live in <span class="math inline">\(\mathbb{R}^d\)</span> for some <span class="math inline">\(d &gt; 0\)</span>. If some of the parameters were in fact constrained, e.g.&nbsp;we were working with a <code>Beta</code> distribution which has support on the interval <span class="math inline">\((0, 1)\)</span>, <em>not</em> on <span class="math inline">\(\mathbb{R}^d\)</span>, we could easily end up outside of the valid range <span class="math inline">\((0, 1)\)</span>.</p>
<div id="44" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">beta_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">beta_model</span>()</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 1.85 seconds
Compute duration  = 1.85 seconds
parameters        = x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse    ess_bulk    ess_tail      rhat   ⋯
      Symbol   Float64   Float64   Float64     Float64     Float64   Float64   ⋯

           x    0.5016    0.1907    0.0028   4438.5385   5555.0266    1.0000   ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

           x    0.1427    0.3616    0.5026    0.6454    0.8483</code></pre>
</div>
</div>
<p>Yep, that still works, but only because Turing.jl actually <em>transforms</em> the <code>turing_model</code> from constrained to unconstrained, so that the <code>sampler</code> provided to <code>externalsampler</code> is actually always working in unconstrained space! This is not always desirable, so we can turn this off:</p>
<div id="46" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 0.15 seconds
Compute duration  = 0.15 seconds
parameters        = x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse   ess_bulk   ess_tail      rhat   e ⋯
      Symbol   Float64   Float64   Float64    Float64    Float64   Float64     ⋯

           x    0.4302    0.2091    0.0325    35.2868    20.9937    1.1234     ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

           x    0.2000    0.2221    0.4272    0.5986    0.7385</code></pre>
</div>
</div>
<p>The fun thing is that this still sort of works because</p>
<div id="48" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">logpdf</span>(<span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>), <span class="fl">10.0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-Inf</code></pre>
</div>
</div>
<p>and so the samples that fall outside of the range are always rejected. But do notice how much worse all the diagnostics are, e.g.&nbsp;<code>ess_tail</code> is very poor compared to when we use <code>unconstrained=true</code>. Moreover, in more complex cases this won’t just result in a “nice” <code>-Inf</code> log-density value, but instead will error:</p>
<div id="50" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="kw">function</span> <span class="fu">demo</span>()</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>    σ² <span class="op">~</span> <span class="fu">truncated</span>(<span class="fu">Normal</span>(), lower<span class="op">=</span><span class="fl">0</span>)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If we end up with negative values for `σ²`, the `Normal` will error.</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>    x <span class="op">~</span> <span class="fu">Normal</span>(<span class="fl">0</span>, σ²)</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>DomainError: DomainError(-0.3317059040556385, "Normal: the condition σ &gt;= zero(σ) is not satisfied.")
DomainError with -0.3317059040556385:
Normal: the condition σ &gt;= zero(σ) is not satisfied.
Stacktrace:
  [1] #371
    @ ~/.julia/packages/Distributions/gGoCk/src/univariate/continuous/normal.jl:37 [inlined]
  [2] check_args
    @ ~/.julia/packages/Distributions/gGoCk/src/utils.jl:89 [inlined]
  [3] #Normal#370
    @ ~/.julia/packages/Distributions/gGoCk/src/univariate/continuous/normal.jl:37 [inlined]
  [4] Normal
    @ ~/.julia/packages/Distributions/gGoCk/src/univariate/continuous/normal.jl:36 [inlined]
  [5] Normal
    @ ~/.julia/packages/Distributions/gGoCk/src/univariate/continuous/normal.jl:42 [inlined]
  [6] macro expansion
    @ ~/.julia/packages/DynamicPPL/Jf0cM/src/compiler.jl:584 [inlined]
  [7] demo
    @ ~/work/docs/docs/tutorials/docs-17-implementing-samplers/index.qmd:593 [inlined]
  [8] _evaluate!!
    @ ~/.julia/packages/DynamicPPL/Jf0cM/src/model.jl:914 [inlined]
  [9] evaluate_threadsafe!!(model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, varinfo::DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, context::DynamicPPL.ValuesAsInModelContext{OrderedDict{Any, Any}, DynamicPPL.DefaultContext})
    @ DynamicPPL ~/.julia/packages/DynamicPPL/Jf0cM/src/model.jl:903
 [10] evaluate!!
    @ ~/.julia/packages/DynamicPPL/Jf0cM/src/model.jl:833 [inlined]
 [11] values_as_in_model
    @ ~/.julia/packages/DynamicPPL/Jf0cM/src/values_as_in_model.jl:196 [inlined]
 [12] values_as_in_model
    @ ~/.julia/packages/DynamicPPL/Jf0cM/src/values_as_in_model.jl:195 [inlined]
 [13] getparams(model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, vi::DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64})
    @ Turing.Inference ~/.julia/packages/Turing/nwmUC/src/mcmc/Inference.jl:383
 [14] Turing.Inference.Transition(model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, vi::DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, t::MALASample{Vector{Float64}})
    @ Turing.Inference ~/.julia/packages/Turing/nwmUC/src/mcmc/Inference.jl:258
 [15] transition_to_turing
    @ ~/.julia/packages/Turing/nwmUC/src/mcmc/abstractmcmc.jl:12 [inlined]
 [16] transition_to_turing(f::LogDensityProblemsADForwardDiffExt.ForwardDiffLogDensity{LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, Nothing}, ForwardDiff.Chunk{2}, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}, transition::MALASample{Vector{Float64}})
    @ Turing.Inference ~/.julia/packages/Turing/nwmUC/src/mcmc/abstractmcmc.jl:17
 [17] step(rng::TaskLocalRNG, model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, sampler_wrapper::DynamicPPL.Sampler{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}; initial_state::Nothing, initial_params::Nothing, kwargs::@Kwargs{})
    @ Turing.Inference ~/.julia/packages/Turing/nwmUC/src/mcmc/abstractmcmc.jl:147
 [18] macro expansion
    @ ~/.julia/packages/AbstractMCMC/FSyVk/src/sample.jl:0 [inlined]
 [19] macro expansion
    @ ~/.julia/packages/AbstractMCMC/FSyVk/src/logging.jl:16 [inlined]
 [20] mcmcsample(rng::TaskLocalRNG, model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, sampler::DynamicPPL.Sampler{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}, N::Int64; progress::Bool, progressname::String, callback::Nothing, num_warmup::Int64, discard_initial::Int64, thinning::Int64, chain_type::Type, initial_state::Nothing, kwargs::@Kwargs{})
    @ AbstractMCMC ~/.julia/packages/AbstractMCMC/FSyVk/src/sample.jl:142
 [21] sample(rng::TaskLocalRNG, model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, sampler::DynamicPPL.Sampler{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}, N::Int64; chain_type::Type, resume_from::Nothing, initial_state::Nothing, kwargs::@Kwargs{progress::Bool})
    @ DynamicPPL ~/.julia/packages/DynamicPPL/Jf0cM/src/sampler.jl:107
 [22] sample
    @ ~/.julia/packages/DynamicPPL/Jf0cM/src/sampler.jl:97 [inlined]
 [23] #sample#4
    @ ~/.julia/packages/Turing/nwmUC/src/mcmc/Inference.jl:305 [inlined]
 [24] sample
    @ ~/.julia/packages/Turing/nwmUC/src/mcmc/Inference.jl:296 [inlined]
 [25] #sample#3
    @ ~/.julia/packages/Turing/nwmUC/src/mcmc/Inference.jl:293 [inlined]
 [26] top-level scope
    @ ~/work/docs/docs/tutorials/docs-17-implementing-samplers/index.qmd:595</code></pre>
</div>
</div>
<p>As expected, we run into a <code>DomainError</code> at some point, while if we set <code>unconstrained=true</code>, letting Turing.jl transform the model to a unconstrained form behind the scenes, everything works as expected:</p>
<div id="52" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 1.89 seconds
Compute duration  = 1.89 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse   ess_bulk   ess_tail      rhat   e ⋯
      Symbol   Float64   Float64   Float64    Float64    Float64   Float64     ⋯

          σ²    0.8187    0.5977    0.0445    96.2627    27.8550    1.0192     ⋯
           x    0.0681    0.9168    0.0370   728.3085   539.1613    1.0086     ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

          σ²    0.1008    0.3464    0.6795    1.1806    2.3132
           x   -1.7920   -0.3384   -0.0375    0.4533    2.1973</code></pre>
</div>
</div>
<p>Neat!</p>
<p>Similarly, which automatic differentiation backend one should use can be specified through the <code>adtype</code> keyword argument too. For example, if we want to use <a href="https://github.com/JuliaDiff/ReverseDiff.jl">ReverseDiff.jl</a> instead of the default <a href="https://github.com/JuliaDiff/ForwardDiff.jl">ForwardDiff.jl</a>:</p>
<div id="54" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">ReverseDiff</span>: ReverseDiff</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify that we want to use `AutoReverseDiff`.</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">demo</span>(),</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>, adtype<span class="op">=</span><span class="fu">AutoReverseDiff</span>()),</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>;</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 3.57 seconds
Compute duration  = 3.57 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse   ess_bulk   ess_tail      rhat   e ⋯
      Symbol   Float64   Float64   Float64    Float64    Float64   Float64     ⋯

          σ²    4.4530    0.0000    0.0000        NaN        NaN       NaN     ⋯
           x   -0.5012    0.0000    0.0000        NaN        NaN       NaN     ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

          σ²    4.4530    4.4530    4.4530    4.4530    4.4530
           x   -0.5012   -0.5012   -0.5012   -0.5012   -0.5012</code></pre>
</div>
</div>
<p>Double-neat.</p>
</section>
</section>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<p>At this point it’s worth maybe reminding ourselves what we did and also <em>why</em> we did it:</p>
<ol type="1">
<li>We define our models in the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface because it makes the sampler agnostic to how the underlying model is implemented.</li>
<li>We implement our sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> interface, which just means that our sampler is a subtype of <code>AbstractMCMC.AbstractSampler</code> and we implement the MCMC transition in <code>AbstractMCMC.step</code>.</li>
<li>Points 1 and 2 makes it so our sampler can be used with a wide range of model implementations, amongst them being models implemented in both Turing.jl and Stan. This gives you, the inference implementer, a large collection of models to test your inference method on, in addition to allowing users of Turing.jl and Stan to try out your inference method with minimal effort.</li>
</ol>


</section>


<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a><div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>We’re going with the leapfrog formulation because in a future version of this tutorial we’ll add a section extending this simple “baseline” MALA sampler to more complex versions. See <a href="https://github.com/TuringLang/docs/issues/479">issue #479</a> for progress on this.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>There is no such thing as a proper interface in Julia (at least not officially), and so we use the word “interface” here to mean a few minimal methods that needs to be implemented by any type that we treat as a target model.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/turinglang\.org\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../tutorials/docs-07-for-developers-variational-inference/index.html" class="pagination-link" aria-label="Variational Inference">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Variational Inference</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Turing is created by <a href="http://mlg.eng.cam.ac.uk/hong/" target="_blank">Hong Ge</a>, and lovingly maintained by the <a href="https://github.com/TuringLang/Turing.jl/graphs/contributors" target="_blank">core team</a> of volunteers. <br> The contents of this website are © 2024 under the terms of the <a href="https://github.com/TuringLang/Turing.jl/blob/master/LICENCE" target="_blank">MIT License</a>.</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/TuringLang/docs/edit/master/tutorials/docs-17-implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/docs/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://x.com/TuringLang">
      <i class="bi bi-twitter" role="img" aria-label="Turing Twitter">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/TuringLang/Turing.jl">
      <i class="bi bi-github" role="img" aria-label="Turing GitHub">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




<script src="../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>