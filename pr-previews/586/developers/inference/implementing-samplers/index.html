<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.40">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Implementing Samplers – Turing.jl</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<link href="../../../developers/inference/variational-inference/index.html" rel="prev">
<link href="../../../assets/favicon.ico" rel="icon">
<script src="../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-549806ee2085284f45b00abea8c6df48.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-dark-8ea72dc5fed832574809a9c94082fbbb.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap-a904fe798f451b888977173a242a08b2.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../../site_libs/bootstrap/bootstrap-dark-6446c4a78ab5e6e6a879d0c742ae2904.min.css" rel="prefetch" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<style>
  a {
    text-decoration: none;
  }
  a:hover {
    text-decoration: underline;
  }
</style>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../../theming/styles.css">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="https://turinglang.org/" class="navbar-brand navbar-brand-logo">
    <img src="../../../assets/images/turing-logo.svg" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="https://turinglang.org/">
    <span class="navbar-title">Turing.jl</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../getting-started/"> 
<span class="menu-text">Get Started</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../tutorials/coin-flipping/"> 
<span class="menu-text">Tutorials</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/library/"> 
<span class="menu-text">Libraries</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/news/"> 
<span class="menu-text">News</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/team/"> 
<span class="menu-text">Team</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-v0.36" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">v0.36</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-v0.36">    
        <li>
    <a class="dropdown-item" href="https://turinglang.org/docs/changelog.html">
 <span class="dropdown-text">Changelog</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://turinglang.org/docs/versions.html">
 <span class="dropdown-text">All Versions</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools tools-wide">
    <a href="https://x.com/TuringLang" title="Turing Twitter" class="quarto-navigation-tool px-1" aria-label="Turing Twitter"><i class="bi bi-twitter"></i></a>
    <a href="https://github.com/TuringLang/Turing.jl" title="Turing GitHub" class="quarto-navigation-tool px-1" aria-label="Turing GitHub"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../../developers/contributing/index.html">Developers</a></li><li class="breadcrumb-item"><a href="../../../developers/inference/abstractmcmc-interface/index.html">Inference (note: outdated)</a></li><li class="breadcrumb-item"><a href="../../../developers/inference/implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../getting-started/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Getting Started</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../core-functionality/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Core Functionality</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false">
 <span class="menu-text">User Guide</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/automatic-differentiation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Automatic Differentiation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/custom-distribution/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Custom Distributions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/probability-interface/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Querying Model Probabilities</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/modifying-logprob/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Modifying the Log Probability</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/generated-quantities/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Generated Quantities</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/mode-estimation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Mode Estimation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/performance-tips/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Performance Tips</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/sampler-visualisation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Sampler Visualization</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/dynamichmc/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using DynamicHMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/external-samplers/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using External Samplers</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false">
 <span class="menu-text">Tutorials</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/coin-flipping/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction: Coin Flipping</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/gaussian-mixture-models/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Mixture Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-neural-networks/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Neural Networks</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/hidden-markov-models/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Hidden Markov Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-linear-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Linear Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/infinite-mixture-models/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Infinite Mixture Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-poisson-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Poisson Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/multinomial-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Multinomial Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-differential-equations/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Differential Equations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/probabilistic-pca/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Probabilistic PCA</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-time-series-analysis/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Time Series Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/gaussian-processes-introduction/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Processes: Introduction</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/gaussian-process-latent-variable-models/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Process Latent Variable Models</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Developers</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/contributing/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Contributing</span></a>
  </div>
</li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false">
 <span class="menu-text">DynamicPPL’s Compiler</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/compiler/model-manual/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Manually Defining a Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/compiler/minituring-compiler/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation I: Compiler</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/compiler/minituring-contexts/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation II: Contexts</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/compiler/design-overview/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Turing Compiler Design (Outdated)</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false">
 <span class="menu-text">Variable Transformations</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/transforms/distributions/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Distributions and the Jacobian</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/transforms/bijectors/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bijectors in MCMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/transforms/dynamicppl/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variable transformations in DynamicPPL</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true">
 <span class="menu-text">Inference (note: outdated)</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/inference/abstractmcmc-interface/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Interface Guide</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/inference/abstractmcmc-turing/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">How Turing Implements AbstractMCMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/inference/variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/inference/implementing-samplers/index.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Implementing Samplers</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of Contents</h2>
   
  <ul>
  <li><a href="#quick-overview-of-mala" id="toc-quick-overview-of-mala" class="nav-link active" data-scroll-target="#quick-overview-of-mala">Quick overview of MALA</a></li>
  <li><a href="#what-we-need-from-a-model-logdensityproblems.jl" id="toc-what-we-need-from-a-model-logdensityproblems.jl" class="nav-link" data-scroll-target="#what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: LogDensityProblems.jl</a></li>
  <li><a href="#implementing-mala-in-abstractmcmc.jl" id="toc-implementing-mala-in-abstractmcmc.jl" class="nav-link" data-scroll-target="#implementing-mala-in-abstractmcmc.jl">Implementing MALA in AbstractMCMC.jl</a></li>
  <li><a href="#using-our-sampler-with-turing.jl" id="toc-using-our-sampler-with-turing.jl" class="nav-link" data-scroll-target="#using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</a>
  <ul class="collapse">
  <li><a href="#models-with-constrained-parameters" id="toc-models-with-constrained-parameters" class="nav-link" data-scroll-target="#models-with-constrained-parameters">Models with constrained parameters</a></li>
  </ul></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/TuringLang/docs/edit/master/developers/inference/implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/docs/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../../developers/contributing/index.html">Developers</a></li><li class="breadcrumb-item"><a href="../../../developers/inference/abstractmcmc-interface/index.html">Inference (note: outdated)</a></li><li class="breadcrumb-item"><a href="../../../developers/inference/implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Implementing Samplers</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>In this tutorial, we’ll go through step-by-step how to implement a “simple” sampler in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> in such a way that it can be easily applied to Turing.jl models.</p>
<p>In particular, we’re going to implement a version of <strong>Metropolis-adjusted Langevin (MALA)</strong>.</p>
<p>Note that we will implement this sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> framework, completely “ignoring” Turing.jl until the very end of the tutorial, at which point we’ll use a single line of code to make the resulting sampler available to Turing.jl. This is to really drive home the point that one can implement samplers in a way that is accessible to all of Turing.jl’s users without having to use Turing.jl yourself.</p>
<section id="quick-overview-of-mala" class="level2">
<h2 class="anchored" data-anchor-id="quick-overview-of-mala">Quick overview of MALA</h2>
<p>We can view MALA as a single step of the leapfrog intergrator with resampling of momentum <span class="math inline">\(p\)</span> at every step.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> To make that statement a bit more concrete, we first define the <em>extended</em> target <span class="math inline">\(\bar{\gamma}(x, p)\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\log \bar{\gamma}(x, p) \propto \log \gamma(x) + \log \gamma_{\mathcal{N}(0, M)}(p)
\end{equation*}\]</span></p>
<p>where <span class="math inline">\(\gamma_{\mathcal{N}(0, M)}\)</span> denotes the density for a zero-centered Gaussian with covariance matrix <span class="math inline">\(M\)</span>. We then consider targeting this joint distribution over both <span class="math inline">\(x\)</span> and <span class="math inline">\(p\)</span> as follows. First we define the map</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  L_{\epsilon}: \quad &amp; \mathbb{R}^d \times \mathbb{R}^d \to \mathbb{R}^d \times \mathbb{R}^d \\
  &amp; (x, p) \mapsto (\tilde{x}, \tilde{p}) := L_{\epsilon}(x, p)
\end{split}
\end{equation*}\]</span></p>
<p>as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p_{1 / 2} &amp;:= p + \frac{\epsilon}{2} \nabla \log \gamma(x) \\
  \tilde{x} &amp;:= x + \epsilon M^{-1} p_{1 /2 } \\
  p_1 &amp;:= p_{1 / 2} + \frac{\epsilon}{2} \nabla \log \gamma(\tilde{x}) \\
  \tilde{p} &amp;:= - p_1
\end{split}
\end{equation*}\]</span></p>
<p>This might be familiar for some readers as a single step of the Leapfrog integrator. We then define the MALA kernel as follows: given the current iterate <span class="math inline">\(x_i\)</span>, we sample the next iterate <span class="math inline">\(x_{i + 1}\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p &amp;\sim \mathcal{N}(0, M) \\
  (\tilde{x}, \tilde{p}) &amp;:= L_{\epsilon}(x_i, p) \\
  \alpha &amp;:= \min \left\{ 1, \frac{\bar{\gamma}(\tilde{x}, \tilde{p})}{\bar{\gamma}(x_i, p)} \right\} \\
  x_{i + 1} &amp;:=
  \begin{cases}
    \tilde{x} \quad &amp; \text{ with prob. } \alpha \\
    x_i       \quad &amp; \text{ with prob. } 1 - \alpha
  \end{cases}
\end{split}
\end{equation*}\]</span></p>
<p>i.e.&nbsp;we accept the proposal <span class="math inline">\(\tilde{x}\)</span> with probability <span class="math inline">\(\alpha\)</span> and reject it, thus sticking with our current iterate, with probability <span class="math inline">\(1 - \alpha\)</span>.</p>
</section>
<section id="what-we-need-from-a-model-logdensityproblems.jl" class="level2">
<h2 class="anchored" data-anchor-id="what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a></h2>
<p>There are a few things we need from the “target” / “model” / density that we want to sample from:</p>
<ol type="1">
<li>We need access to log-density <em>evaluations</em> <span class="math inline">\(\log \gamma(x)\)</span> so we can compute the acceptance ratio involving <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>We need access to log-density <em>gradients</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span> so we can compute the Leapfrog steps <span class="math inline">\(L_{\epsilon}(x, p)\)</span>.</li>
<li>We also need access to the “size” of the model so we can determine the size of <span class="math inline">\(M\)</span>.</li>
</ol>
<p>Luckily for us, there is a package called <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> which provides an interface for <em>exactly</em> this!</p>
<p>To demonstrate how one can implement the “<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface”<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> we will use a simple Gaussian model as an example:</p>
<div id="4" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblems</span>: LogDensityProblems;</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's define some type that represents the model.</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> IsotropicNormalModel{M<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"mean of the isotropic Gaussian"</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    mean<span class="op">::</span><span class="dt">M</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Specifies what input length the model expects.</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">dimension</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> <span class="fu">length</span>(model.mean)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Implementation of the log-density evaluation of the model.</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x<span class="op">::</span><span class="dt">AbstractVector{&lt;:Real}</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">-</span> <span class="fu">sum</span>(abs2, x <span class="op">.-</span> model.mean) <span class="op">/</span> <span class="fl">2</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This gives us all of the properties we want for our MALA sampler with the exception of the computation of the <em>gradient</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span>. There is the method <code>LogDensityProblems.logdensity_and_gradient</code> which should return a 2-tuple where the first entry is the evaluation of the logdensity <span class="math inline">\(\log \gamma(x)\)</span> and the second entry is the gradient <span class="math inline">\(\nabla \log \gamma(x)\)</span>.</p>
<p>There are two ways to “implement” this method: 1) we implement it by hand, which is feasible in the case of our <code>IsotropicNormalModel</code>, or b) we defer the implementation of this to a automatic differentiation backend.</p>
<p>To implement it by hand we can simply do</p>
<div id="6" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl that first-order, i.e. gradient information, is available.</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{1}</span>()</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Implement `logdensity_and_gradient`.</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    logγ_x <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="op">-</span>x <span class="op">.*</span> (x <span class="op">-</span> model.mean)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> logγ_x, ∇logγ_x</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s just try it out:</p>
<div id="8" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate the problem.</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> <span class="fu">IsotropicNormalModel</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.])</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create some example input that we can test on.</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>x_example <span class="op">=</span> <span class="fu">randn</span>(LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate!</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-15.854719615281734</code></pre>
</div>
</div>
<p>To defer it to an automatic differentiation backend, we can do</p>
<div id="10" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl we only have access to 0-th order information.</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{0}</span>()</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Use `LogDensityProblemsAD`'s `ADgradient` in combination with some AD backend to implement `logdensity_and_gradient`.</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblemsAD</span>, <span class="bu">ADTypes</span>, <span class="bu">ForwardDiff</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>model_with_grad <span class="op">=</span> <span class="fu">ADgradient</span>(<span class="fu">AutoForwardDiff</span>(), model)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model_with_grad, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-15.854719615281734</code></pre>
</div>
</div>
<p>We’ll continue with the second approach in this tutorial since this is typically what one does in practice, because there are better hobbies to spend time on than deriving gradients by hand.</p>
<p>At this point, one might wonder how we’re going to tie this back to Turing.jl in the end. Effectively, when working with inference methods that only require log-density evaluations and / or higher-order information of the log-density, Turing.jl actually converts the user-provided <code>Model</code> into an object implementing the above methods for <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>. As a result, most samplers provided by Turing.jl are actually implemented to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, enabling their use both <em>within</em> Turing.jl and <em>outside</em> of Turing.jl! Morever, there exists similar conversions for Stan through BridgeStan and Stan<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, which means that a sampler supporting the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface can easily be used on both Turing.jl <em>and</em> Stan models (in addition to user-provided models, as our <code>IsotropicNormalModel</code> above)!</p>
<p>Anyways, let’s move on to actually implementing the sampler.</p>
</section>
<section id="implementing-mala-in-abstractmcmc.jl" class="level2">
<h2 class="anchored" data-anchor-id="implementing-mala-in-abstractmcmc.jl">Implementing MALA in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a></h2>
<p>Now that we’ve established that a model implementing the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface provides us with all the information we need from <span class="math inline">\(\log \gamma(x)\)</span>, we can address the question: given an object that implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, how can we define a sampler for it?</p>
<p>We’re going to do this by making our sampler a sub-type of <code>AbstractMCMC.AbstractSampler</code> in addition to implementing a few methods from <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>. Why? Because it gets us <em>a lot</em> of functionality for free, as we will see later.</p>
<p>Moreover, <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> provides a very natural interface for MCMC algorithms.</p>
<p>First, we’ll define our <code>MALA</code> type</p>
<div id="12" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">AbstractMCMC</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALA{T,A} <span class="op">&lt;:</span><span class="dt"> AbstractMCMC.AbstractSampler</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"stepsize used in the leapfrog step"</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    ϵ_init<span class="op">::</span><span class="dt">T</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"covariance matrix used for the momentum"</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    M_init<span class="op">::</span><span class="dt">A</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notice how we’ve added the suffix <code>_init</code> to both the stepsize and the covariance matrix. We’ve done this because a <code>AbstractMCMC.AbstractSampler</code> should be <em>immutable</em>. Of course there might be many scenarios where we want to allow something like the stepsize and / or the covariance matrix to vary between iterations, e.g.&nbsp;during the burn-in / adaptation phase of the sampling process we might want to adjust the parameters using statistics computed from these initial iterations. But information which can change between iterations <em>should not go in the sampler itself</em>! Instead, this information should go in the sampler <em>state</em>.</p>
<p>The sampler state should at the very least contain all the necessary information to perform the next MCMC iteration, but usually contains further information, e.g.&nbsp;quantities and statistics useful for evaluating whether the sampler has converged.</p>
<p>We will use the following sampler state for our <code>MALA</code> sampler:</p>
<div id="14" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALAState{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This might seem overly redundant: we’re defining a type <code>MALAState</code> and it only contains a simple vector of reals. In this particular case we indeed could have dropped this and simply used a <code>AbstractVector{&lt;:Real}</code> as our sampler state, but typically, as we will see later, one wants to include other quantities in the sampler state. For example, if we also wanted to adapt the parameters of our <code>MALA</code>, e.g.&nbsp;alter the stepsize depending on acceptance rates, in which case we should also put <code>ϵ</code> in the state, but for now we’ll keep things simple.</p>
<p>Moreover, we also want a <em>sample</em> type, which is a type meant for “public consumption”, i.e.&nbsp;the end-user. This is generally going to contain a subset of the information present in the state. But in such a simple scenario as this, we similarly only have a <code>AbstractVector{&lt;:Real}</code>:</p>
<div id="16" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALASample{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We currently have three things:</p>
<ol type="1">
<li>A <code>AbstractMCMC.AbstractSampler</code> implementation called <code>MALA</code>.</li>
<li>A state <code>MALAState</code> for our sampler <code>MALA</code>.</li>
<li>A sample <code>MALASample</code> for our sampler <code>MALA</code>.</li>
</ol>
<p>That means that we’re ready to implement the only thing that really matters: <code>AbstractMCMC.step</code>.</p>
<p><code>AbstractMCMC.step</code> defines the MCMC iteration of our <code>MALA</code> given the current <code>MALAState</code>. Specifically, the signature of the function is as follows:</p>
<div id="18" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The RNG to ensure reproducibility.</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The model that defines our target.</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.AbstractModel</span>,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The sampler for which we're taking a `step`.</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">AbstractMCMC.AbstractSampler</span>,</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The current sampler `state`.</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    state;</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Additional keyword arguments that we may or may not need.</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Moreover, there is a specific <code>AbstractMCMC.AbstractModel</code> which is used to indicate that the model that is provided implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface: <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Since, as we discussed earlier, in our case we’re indeed going to work with types that support the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, we’ll define <code>AbstractMCMC.step</code> for such a <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Note that <code>AbstractMCMC.LogDensityModel</code> has no other purpose; it has a single field called <code>logdensity</code>, and it does nothing else. But by wrapping the model in <code>AbstractMCMC.LogDensityModel</code>, it allows samplers that want to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> to define their <code>AbstractMCMC.step</code> on this type without running into method ambiguities.</p>
<p>All in all, that means that the signature for our <code>AbstractMCMC.step</code> is going to be the following:</p>
<div id="20" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># `LogDensityModel` so we know we're working with LogDensityProblems.jl model.</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler.</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler state.</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Great! Now let’s actually implement the full <code>AbstractMCMC.step</code> for our <code>MALA</code>.</p>
<p>Let’s remind ourselves what we’re going to do:</p>
<ol type="1">
<li>Sample a new momentum <span class="math inline">\(p\)</span>.</li>
<li>Compute the log-density of the extended target <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>Take a single leapfrog step <span class="math inline">\((\tilde{x}, \tilde{p}) = L_{\epsilon}(x, p)\)</span>.</li>
<li>Accept or reject the proposed <span class="math inline">\((\tilde{x}, \tilde{p})\)</span>.</li>
</ol>
<p>All in all, this results in the following:</p>
<div id="22" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>: Random</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Distributions</span>  <span class="co"># so we get the `MvNormal`</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the wrapped model which implements LogDensityProblems.jl.</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just extract the sampler parameters to make our lives easier.</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    ϵ <span class="op">=</span> sampler.ϵ_init</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    M <span class="op">=</span> sampler.M_init</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the current parameters.</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> state.x</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sample the momentum.</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>    p_dist <span class="op">=</span> <span class="fu">MvNormal</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)), M)</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> <span class="fu">rand</span>(rng, p_dist)</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Propose using a single leapfrog step.</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>    x̃, p̃ <span class="op">=</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Accept or reject proposal.</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>    logp <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p)</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>    logp̃ <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x̃) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p̃)</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>    logα <span class="op">=</span> logp̃ <span class="op">-</span> logp</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>    state_new <span class="op">=</span> <span class="cf">if</span> <span class="fu">log</span>(<span class="fu">rand</span>(rng)) <span class="op">&lt;</span> logα</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Accept.</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x̃)</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Reject.</span></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x)</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return the "sample" and the sampler state.</span></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(state_new.x), state_new</span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Fairly straight-forward.</p>
<p>Of course, we haven’t defined the <code>leapfrog_step</code> method yet, so let’s do that:</p>
<div id="24" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p` using "position" `x`.</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x))</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    p1 <span class="op">=</span> p <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update the "position" `x` using momentum `p1`.</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    x̃ <span class="op">=</span> x <span class="op">+</span> ϵ <span class="op">.*</span> (M <span class="op">\</span> p1)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p1` using position `x̃`</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x̃ <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x̃))</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    p2 <span class="op">=</span> p1 <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x̃</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Flip momentum `p2`.</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    p̃ <span class="op">=</span> <span class="op">-</span>p2</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x̃, p̃</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>leapfrog_step (generic function with 1 method)</code></pre>
</div>
</div>
<p>With all of this, we’re technically ready to sample!</p>
<div id="26" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>, <span class="bu">LinearAlgebra</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>rng <span class="op">=</span> <span class="bu">Random</span>.<span class="fu">default_rng</span>()</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>sampler <span class="op">=</span> <span class="fu">MALA</span>(<span class="fl">1</span>, I)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>state <span class="op">=</span> <span class="fu">MALAState</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)))</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>x_next, state_next <span class="op">=</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    rng,</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    AbstractMCMC.<span class="fu">LogDensityModel</span>(model),</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    state</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>(MALASample{Vector{Float64}}([-0.6595982525572299, -0.7130092743839238, 1.0810238677604276]), MALAState{Vector{Float64}}([-0.6595982525572299, -0.7130092743839238, 1.0810238677604276]))</code></pre>
</div>
</div>
<p>Great, it works!</p>
<p>And I promised we would get quite some functionality for free if we implemented <code>AbstractMCMC.step</code>, and so we can now simply call <code>sample</code> to perform standard MCMC sampling:</p>
<div id="28" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform 1000 iterations with our `MALA` sampler.</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; initial_state<span class="op">=</span>state, progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Concatenate into a matrix.</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000 Matrix{Float64}:
 -4.44596  -4.52453   -4.52453   …  -5.58474   -4.93142   -4.93142
 -0.99649  -0.326295  -0.326295      0.454933   0.414605   0.414605
  4.65135   4.93603    4.93603       4.29506    6.00925    6.00925</code></pre>
</div>
</div>
<div id="30" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the marginal means and standard deviations.</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -4.97956     0.994443
 -0.00817466  1.00769
  4.9756      0.992725</code></pre>
</div>
</div>
<p>Let’s visualize the samples</p>
<div id="32" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">StatsPlots</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">transpose</span>(samples_matrix[<span class="op">:</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">:</span><span class="kw">end</span>]), alpha<span class="op">=</span><span class="fl">0.5</span>, legend<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<!--?xml version="1.0" encoding="utf-8"?-->
<svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" width="672" height="480" viewbox="0 0 2688 1920">
<defs>
  <clippath id="clip300">
    <rect x="0" y="0" width="2688" height="1920"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip300)" d="M0 1920 L2688 1920 L2688 0 L0 0  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip301">
    <rect x="537" y="0" width="1883" height="1883"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip300)" d="M151.747 1800.78 L2640.76 1800.78 L2640.76 47.2441 L151.747 47.2441  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip302">
    <rect x="151" y="47" width="2490" height="1755"></rect>
  </clippath>
</defs>
<polyline clip-path="url(#clip302)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="219.84,1800.78 219.84,47.2441 "></polyline>
<polyline clip-path="url(#clip302)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="807.458,1800.78 807.458,47.2441 "></polyline>
<polyline clip-path="url(#clip302)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1395.08,1800.78 1395.08,47.2441 "></polyline>
<polyline clip-path="url(#clip302)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1982.69,1800.78 1982.69,47.2441 "></polyline>
<polyline clip-path="url(#clip302)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="2570.31,1800.78 2570.31,47.2441 "></polyline>
<polyline clip-path="url(#clip302)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,1534.5 2640.76,1534.5 "></polyline>
<polyline clip-path="url(#clip302)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,1227.54 2640.76,1227.54 "></polyline>
<polyline clip-path="url(#clip302)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,920.577 2640.76,920.577 "></polyline>
<polyline clip-path="url(#clip302)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,613.614 2640.76,613.614 "></polyline>
<polyline clip-path="url(#clip302)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,306.651 2640.76,306.651 "></polyline>
<polyline clip-path="url(#clip300)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1800.78 2640.76,1800.78 "></polyline>
<polyline clip-path="url(#clip300)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="219.84,1800.78 219.84,1781.88 "></polyline>
<polyline clip-path="url(#clip300)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="807.458,1800.78 807.458,1781.88 "></polyline>
<polyline clip-path="url(#clip300)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1395.08,1800.78 1395.08,1781.88 "></polyline>
<polyline clip-path="url(#clip300)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1982.69,1800.78 1982.69,1781.88 "></polyline>
<polyline clip-path="url(#clip300)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="2570.31,1800.78 2570.31,1781.88 "></polyline>
<path clip-path="url(#clip300)" d="M219.84 1834 Q216.229 1834 214.4 1837.57 Q212.595 1841.11 212.595 1848.24 Q212.595 1855.34 214.4 1858.91 Q216.229 1862.45 219.84 1862.45 Q223.474 1862.45 225.28 1858.91 Q227.108 1855.34 227.108 1848.24 Q227.108 1841.11 225.28 1837.57 Q223.474 1834 219.84 1834 M219.84 1830.3 Q225.65 1830.3 228.706 1834.9 Q231.784 1839.49 231.784 1848.24 Q231.784 1856.96 228.706 1861.57 Q225.65 1866.15 219.84 1866.15 Q214.03 1866.15 210.951 1861.57 Q207.896 1856.96 207.896 1848.24 Q207.896 1839.49 210.951 1834.9 Q214.03 1830.3 219.84 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip300)" d="M771.15 1861.55 L787.47 1861.55 L787.47 1865.48 L765.525 1865.48 L765.525 1861.55 Q768.187 1858.79 772.771 1854.16 Q777.377 1849.51 778.558 1848.17 Q780.803 1845.65 781.683 1843.91 Q782.585 1842.15 782.585 1840.46 Q782.585 1837.71 780.641 1835.97 Q778.72 1834.23 775.618 1834.23 Q773.419 1834.23 770.965 1835 Q768.535 1835.76 765.757 1837.31 L765.757 1832.59 Q768.581 1831.46 771.035 1830.88 Q773.488 1830.3 775.525 1830.3 Q780.896 1830.3 784.09 1832.98 Q787.285 1835.67 787.285 1840.16 Q787.285 1842.29 786.474 1844.21 Q785.687 1846.11 783.581 1848.7 Q783.002 1849.37 779.9 1852.59 Q776.798 1855.78 771.15 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip300)" d="M797.331 1830.92 L815.687 1830.92 L815.687 1834.86 L801.613 1834.86 L801.613 1843.33 Q802.632 1842.98 803.65 1842.82 Q804.669 1842.64 805.687 1842.64 Q811.474 1842.64 814.854 1845.81 Q818.233 1848.98 818.233 1854.4 Q818.233 1859.97 814.761 1863.08 Q811.289 1866.15 804.97 1866.15 Q802.794 1866.15 800.525 1865.78 Q798.28 1865.41 795.872 1864.67 L795.872 1859.97 Q797.956 1861.11 800.178 1861.66 Q802.4 1862.22 804.877 1862.22 Q808.882 1862.22 811.22 1860.11 Q813.558 1858.01 813.558 1854.4 Q813.558 1850.78 811.22 1848.68 Q808.882 1846.57 804.877 1846.57 Q803.002 1846.57 801.127 1846.99 Q799.275 1847.4 797.331 1848.28 L797.331 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip300)" d="M837.446 1834 Q833.835 1834 832.007 1837.57 Q830.201 1841.11 830.201 1848.24 Q830.201 1855.34 832.007 1858.91 Q833.835 1862.45 837.446 1862.45 Q841.081 1862.45 842.886 1858.91 Q844.715 1855.34 844.715 1848.24 Q844.715 1841.11 842.886 1837.57 Q841.081 1834 837.446 1834 M837.446 1830.3 Q843.256 1830.3 846.312 1834.9 Q849.391 1839.49 849.391 1848.24 Q849.391 1856.96 846.312 1861.57 Q843.256 1866.15 837.446 1866.15 Q831.636 1866.15 828.557 1861.57 Q825.502 1856.96 825.502 1848.24 Q825.502 1839.49 828.557 1834.9 Q831.636 1830.3 837.446 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip300)" d="M1354.69 1830.92 L1373.05 1830.92 L1373.05 1834.86 L1358.98 1834.86 L1358.98 1843.33 Q1360 1842.98 1361.01 1842.82 Q1362.03 1842.64 1363.05 1842.64 Q1368.84 1842.64 1372.22 1845.81 Q1375.6 1848.98 1375.6 1854.4 Q1375.6 1859.97 1372.12 1863.08 Q1368.65 1866.15 1362.33 1866.15 Q1360.16 1866.15 1357.89 1865.78 Q1355.64 1865.41 1353.24 1864.67 L1353.24 1859.97 Q1355.32 1861.11 1357.54 1861.66 Q1359.76 1862.22 1362.24 1862.22 Q1366.25 1862.22 1368.58 1860.11 Q1370.92 1858.01 1370.92 1854.4 Q1370.92 1850.78 1368.58 1848.68 Q1366.25 1846.57 1362.24 1846.57 Q1360.37 1846.57 1358.49 1846.99 Q1356.64 1847.4 1354.69 1848.28 L1354.69 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip300)" d="M1394.81 1834 Q1391.2 1834 1389.37 1837.57 Q1387.56 1841.11 1387.56 1848.24 Q1387.56 1855.34 1389.37 1858.91 Q1391.2 1862.45 1394.81 1862.45 Q1398.44 1862.45 1400.25 1858.91 Q1402.08 1855.34 1402.08 1848.24 Q1402.08 1841.11 1400.25 1837.57 Q1398.44 1834 1394.81 1834 M1394.81 1830.3 Q1400.62 1830.3 1403.68 1834.9 Q1406.75 1839.49 1406.75 1848.24 Q1406.75 1856.96 1403.68 1861.57 Q1400.62 1866.15 1394.81 1866.15 Q1389 1866.15 1385.92 1861.57 Q1382.87 1856.96 1382.87 1848.24 Q1382.87 1839.49 1385.92 1834.9 Q1389 1830.3 1394.81 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip300)" d="M1424.97 1834 Q1421.36 1834 1419.53 1837.57 Q1417.73 1841.11 1417.73 1848.24 Q1417.73 1855.34 1419.53 1858.91 Q1421.36 1862.45 1424.97 1862.45 Q1428.61 1862.45 1430.41 1858.91 Q1432.24 1855.34 1432.24 1848.24 Q1432.24 1841.11 1430.41 1837.57 Q1428.61 1834 1424.97 1834 M1424.97 1830.3 Q1430.78 1830.3 1433.84 1834.9 Q1436.92 1839.49 1436.92 1848.24 Q1436.92 1856.96 1433.84 1861.57 Q1430.78 1866.15 1424.97 1866.15 Q1419.16 1866.15 1416.08 1861.57 Q1413.03 1856.96 1413.03 1848.24 Q1413.03 1839.49 1416.08 1834.9 Q1419.16 1830.3 1424.97 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip300)" d="M1940.97 1830.92 L1963.19 1830.92 L1963.19 1832.91 L1950.65 1865.48 L1945.76 1865.48 L1957.57 1834.86 L1940.97 1834.86 L1940.97 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip300)" d="M1972.36 1830.92 L1990.71 1830.92 L1990.71 1834.86 L1976.64 1834.86 L1976.64 1843.33 Q1977.66 1842.98 1978.68 1842.82 Q1979.7 1842.64 1980.72 1842.64 Q1986.5 1842.64 1989.88 1845.81 Q1993.26 1848.98 1993.26 1854.4 Q1993.26 1859.97 1989.79 1863.08 Q1986.32 1866.15 1980 1866.15 Q1977.82 1866.15 1975.55 1865.78 Q1973.31 1865.41 1970.9 1864.67 L1970.9 1859.97 Q1972.98 1861.11 1975.21 1861.66 Q1977.43 1862.22 1979.9 1862.22 Q1983.91 1862.22 1986.25 1860.11 Q1988.59 1858.01 1988.59 1854.4 Q1988.59 1850.78 1986.25 1848.68 Q1983.91 1846.57 1979.9 1846.57 Q1978.03 1846.57 1976.15 1846.99 Q1974.3 1847.4 1972.36 1848.28 L1972.36 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip300)" d="M2012.47 1834 Q2008.86 1834 2007.03 1837.57 Q2005.23 1841.11 2005.23 1848.24 Q2005.23 1855.34 2007.03 1858.91 Q2008.86 1862.45 2012.47 1862.45 Q2016.11 1862.45 2017.91 1858.91 Q2019.74 1855.34 2019.74 1848.24 Q2019.74 1841.11 2017.91 1837.57 Q2016.11 1834 2012.47 1834 M2012.47 1830.3 Q2018.28 1830.3 2021.34 1834.9 Q2024.42 1839.49 2024.42 1848.24 Q2024.42 1856.96 2021.34 1861.57 Q2018.28 1866.15 2012.47 1866.15 Q2006.66 1866.15 2003.59 1861.57 Q2000.53 1856.96 2000.53 1848.24 Q2000.53 1839.49 2003.59 1834.9 Q2006.66 1830.3 2012.47 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip300)" d="M2514.84 1861.55 L2522.48 1861.55 L2522.48 1835.18 L2514.17 1836.85 L2514.17 1832.59 L2522.43 1830.92 L2527.11 1830.92 L2527.11 1861.55 L2534.75 1861.55 L2534.75 1865.48 L2514.84 1865.48 L2514.84 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip300)" d="M2554.19 1834 Q2550.58 1834 2548.75 1837.57 Q2546.94 1841.11 2546.94 1848.24 Q2546.94 1855.34 2548.75 1858.91 Q2550.58 1862.45 2554.19 1862.45 Q2557.82 1862.45 2559.63 1858.91 Q2561.46 1855.34 2561.46 1848.24 Q2561.46 1841.11 2559.63 1837.57 Q2557.82 1834 2554.19 1834 M2554.19 1830.3 Q2560 1830.3 2563.06 1834.9 Q2566.13 1839.49 2566.13 1848.24 Q2566.13 1856.96 2563.06 1861.57 Q2560 1866.15 2554.19 1866.15 Q2548.38 1866.15 2545.3 1861.57 Q2542.25 1856.96 2542.25 1848.24 Q2542.25 1839.49 2545.3 1834.9 Q2548.38 1830.3 2554.19 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip300)" d="M2584.35 1834 Q2580.74 1834 2578.91 1837.57 Q2577.11 1841.11 2577.11 1848.24 Q2577.11 1855.34 2578.91 1858.91 Q2580.74 1862.45 2584.35 1862.45 Q2587.99 1862.45 2589.79 1858.91 Q2591.62 1855.34 2591.62 1848.24 Q2591.62 1841.11 2589.79 1837.57 Q2587.99 1834 2584.35 1834 M2584.35 1830.3 Q2590.16 1830.3 2593.22 1834.9 Q2596.3 1839.49 2596.3 1848.24 Q2596.3 1856.96 2593.22 1861.57 Q2590.16 1866.15 2584.35 1866.15 Q2578.54 1866.15 2575.46 1861.57 Q2572.41 1856.96 2572.41 1848.24 Q2572.41 1839.49 2575.46 1834.9 Q2578.54 1830.3 2584.35 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip300)" d="M2614.51 1834 Q2610.9 1834 2609.07 1837.57 Q2607.27 1841.11 2607.27 1848.24 Q2607.27 1855.34 2609.07 1858.91 Q2610.9 1862.45 2614.51 1862.45 Q2618.15 1862.45 2619.95 1858.91 Q2621.78 1855.34 2621.78 1848.24 Q2621.78 1841.11 2619.95 1837.57 Q2618.15 1834 2614.51 1834 M2614.51 1830.3 Q2620.32 1830.3 2623.38 1834.9 Q2626.46 1839.49 2626.46 1848.24 Q2626.46 1856.96 2623.38 1861.57 Q2620.32 1866.15 2614.51 1866.15 Q2608.7 1866.15 2605.62 1861.57 Q2602.57 1856.96 2602.57 1848.24 Q2602.57 1839.49 2605.62 1834.9 Q2608.7 1830.3 2614.51 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip300)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1800.78 151.747,47.2441 "></polyline>
<polyline clip-path="url(#clip300)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1534.5 170.644,1534.5 "></polyline>
<polyline clip-path="url(#clip300)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1227.54 170.644,1227.54 "></polyline>
<polyline clip-path="url(#clip300)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,920.577 170.644,920.577 "></polyline>
<polyline clip-path="url(#clip300)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,613.614 170.644,613.614 "></polyline>
<polyline clip-path="url(#clip300)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,306.651 170.644,306.651 "></polyline>
<path clip-path="url(#clip300)" d="M49.5521 1534.95 L79.2279 1534.95 L79.2279 1538.89 L49.5521 1538.89 L49.5521 1534.95 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip300)" d="M99.8991 1532.64 Q96.7509 1532.64 94.8991 1534.79 Q93.0704 1536.94 93.0704 1540.69 Q93.0704 1544.42 94.8991 1546.6 Q96.7509 1548.75 99.8991 1548.75 Q103.047 1548.75 104.876 1546.6 Q106.728 1544.42 106.728 1540.69 Q106.728 1536.94 104.876 1534.79 Q103.047 1532.64 99.8991 1532.64 M109.181 1517.99 L109.181 1522.25 Q107.422 1521.41 105.617 1520.97 Q103.834 1520.53 102.075 1520.53 Q97.4454 1520.53 94.9917 1523.66 Q92.5612 1526.78 92.2139 1533.1 Q93.5797 1531.09 95.6398 1530.02 Q97.7 1528.94 100.177 1528.94 Q105.385 1528.94 108.394 1532.11 Q111.427 1535.25 111.427 1540.69 Q111.427 1546.02 108.279 1549.24 Q105.131 1552.45 99.8991 1552.45 Q93.9037 1552.45 90.7325 1547.87 Q87.5612 1543.26 87.5612 1534.54 Q87.5612 1526.34 91.45 1521.48 Q95.3389 1516.6 101.89 1516.6 Q103.649 1516.6 105.431 1516.94 Q107.237 1517.29 109.181 1517.99 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip300)" d="M50.3623 1227.99 L80.0381 1227.99 L80.0381 1231.93 L50.3623 1231.93 L50.3623 1227.99 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip300)" d="M104.297 1226.19 Q107.654 1226.9 109.529 1229.17 Q111.427 1231.44 111.427 1234.77 Q111.427 1239.89 107.908 1242.69 Q104.39 1245.49 97.9083 1245.49 Q95.7324 1245.49 93.4176 1245.05 Q91.126 1244.63 88.6723 1243.78 L88.6723 1239.26 Q90.6167 1240.4 92.9315 1240.98 Q95.2463 1241.56 97.7695 1241.56 Q102.168 1241.56 104.459 1239.82 Q106.774 1238.08 106.774 1234.77 Q106.774 1231.72 104.621 1230 Q102.492 1228.27 98.6722 1228.27 L94.6445 1228.27 L94.6445 1224.43 L98.8574 1224.43 Q102.306 1224.43 104.135 1223.06 Q105.964 1221.67 105.964 1219.08 Q105.964 1216.42 104.066 1215 Q102.191 1213.57 98.6722 1213.57 Q96.7509 1213.57 94.5519 1213.99 Q92.3528 1214.4 89.7139 1215.28 L89.7139 1211.12 Q92.376 1210.38 94.6908 1210 Q97.0287 1209.63 99.0889 1209.63 Q104.413 1209.63 107.515 1212.06 Q110.617 1214.47 110.617 1218.59 Q110.617 1221.46 108.973 1223.45 Q107.33 1225.42 104.297 1226.19 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip300)" d="M99.4824 906.375 Q95.8713 906.375 94.0426 909.94 Q92.2371 913.482 92.2371 920.611 Q92.2371 927.718 94.0426 931.283 Q95.8713 934.824 99.4824 934.824 Q103.117 934.824 104.922 931.283 Q106.751 927.718 106.751 920.611 Q106.751 913.482 104.922 909.94 Q103.117 906.375 99.4824 906.375 M99.4824 902.672 Q105.293 902.672 108.348 907.278 Q111.427 911.862 111.427 920.611 Q111.427 929.338 108.348 933.945 Q105.293 938.528 99.4824 938.528 Q93.6723 938.528 90.5936 933.945 Q87.538 929.338 87.538 920.611 Q87.538 911.862 90.5936 907.278 Q93.6723 902.672 99.4824 902.672 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip300)" d="M104.297 612.26 Q107.654 612.978 109.529 615.246 Q111.427 617.515 111.427 620.848 Q111.427 625.964 107.908 628.764 Q104.39 631.565 97.9083 631.565 Q95.7324 631.565 93.4176 631.126 Q91.126 630.709 88.6723 629.852 L88.6723 625.339 Q90.6167 626.473 92.9315 627.052 Q95.2463 627.63 97.7695 627.63 Q102.168 627.63 104.459 625.894 Q106.774 624.158 106.774 620.848 Q106.774 617.792 104.621 616.079 Q102.492 614.343 98.6722 614.343 L94.6445 614.343 L94.6445 610.501 L98.8574 610.501 Q102.306 610.501 104.135 609.135 Q105.964 607.746 105.964 605.153 Q105.964 602.491 104.066 601.079 Q102.191 599.644 98.6722 599.644 Q96.7509 599.644 94.5519 600.061 Q92.3528 600.478 89.7139 601.357 L89.7139 597.191 Q92.376 596.45 94.6908 596.079 Q97.0287 595.709 99.0889 595.709 Q104.413 595.709 107.515 598.14 Q110.617 600.547 110.617 604.667 Q110.617 607.538 108.973 609.528 Q107.33 611.496 104.297 612.26 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip300)" d="M99.8991 304.788 Q96.7509 304.788 94.8991 306.941 Q93.0704 309.094 93.0704 312.843 Q93.0704 316.57 94.8991 318.746 Q96.7509 320.899 99.8991 320.899 Q103.047 320.899 104.876 318.746 Q106.728 316.57 106.728 312.843 Q106.728 309.094 104.876 306.941 Q103.047 304.788 99.8991 304.788 M109.181 290.135 L109.181 294.395 Q107.422 293.561 105.617 293.121 Q103.834 292.682 102.075 292.682 Q97.4454 292.682 94.9917 295.807 Q92.5612 298.932 92.2139 305.251 Q93.5797 303.237 95.6398 302.172 Q97.7 301.084 100.177 301.084 Q105.385 301.084 108.394 304.256 Q111.427 307.404 111.427 312.843 Q111.427 318.168 108.279 321.385 Q105.131 324.603 99.8991 324.603 Q93.9037 324.603 90.7325 320.019 Q87.5612 315.413 87.5612 306.686 Q87.5612 298.492 91.45 293.631 Q95.3389 288.746 101.89 288.746 Q103.649 288.746 105.431 289.094 Q107.237 289.441 109.181 290.135 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip302)" style="stroke:#009af9; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,1375.49 224.541,1339.22 226.891,1449.01 229.242,1545.04 231.592,1371.93 233.943,1439.19 236.293,1527.43 238.644,1495.44 240.994,1531.59 243.345,1445.41 245.695,1515.11 248.046,1360.32 250.396,1409.14 252.747,1434.35 255.097,1386.27 257.448,1460.71 259.798,1638.26 262.148,1527.2 264.499,1430.82 266.849,1404.59 269.2,1355.56 271.55,1407.73 273.901,1479.98 276.251,1383.68 278.602,1403.38 280.952,1421.43 283.303,1504.73 285.653,1382.05 288.004,1439.38 290.354,1353.4 292.705,1430.89 295.055,1531.34 297.406,1339.28 299.756,1382.2 302.107,1414.4 304.457,1331.21 306.807,1529.55 309.158,1541.96 311.508,1507.72 313.859,1479.68 316.209,1295.16 318.56,1502.72 320.91,1427.82 323.261,1597.31 325.611,1495.85 327.962,1474.74 330.312,1482.27 332.663,1577.8 335.013,1531.07 337.364,1443.75 339.714,1418.07 342.065,1545.32 344.415,1452.71 346.765,1512.41 349.116,1235.49 351.466,1508.44 353.817,1440.73 356.167,1447.1 358.518,1490.51 360.868,1336.19 363.219,1525.94 365.569,1335.82 367.92,1520.29 370.27,1522.15 372.621,1398.96 374.971,1230.12 377.322,1377.23 379.672,1393.02 382.023,1499.8 384.373,1393.98 386.724,1392.57 389.074,1418.81 391.424,1388.41 393.775,1405.74 396.125,1531.61 398.476,1494.17 400.826,1320.3 403.177,1385.2 405.527,1498.91 407.878,1407.03 410.228,1416.58 412.579,1431.75 414.929,1589.64 417.28,1320.11 419.63,1508.05 421.981,1168.66 424.331,1364.19 426.682,1564.27 429.032,1514.35 431.382,1276.33 433.733,1339 436.083,1399.25 438.434,1556.92 440.784,1276.81 443.135,1400.76 445.485,1499.7 447.836,1247.63 450.186,1385.46 452.537,1264.68 454.887,1387.16 457.238,1384.42 459.588,1465.11 461.939,1358.21 464.289,1476.78 466.64,1414.59 468.99,1392.35 471.341,1479.89 473.691,1751.15 476.041,1547.7 478.392,1527.54 480.742,1485.05 483.093,1453.64 485.443,1525.38 487.794,1553.56 490.144,1492.03 492.495,1436.59 494.845,1342.82 497.196,1430.19 499.546,1644.73 501.897,1300.26 504.247,1473.6 506.598,1379.08 508.948,1538.59 511.299,1381.9 513.649,1480.95 515.999,1403.33 518.35,1596.64 520.7,1298.61 523.051,1370.78 525.401,1379.58 527.752,1504.25 530.102,1426.28 532.453,1255.38 534.803,1470.56 537.154,1362.11 539.504,1221.34 541.855,1530.92 544.205,1185.55 546.556,1453.06 548.906,1473.37 551.257,1429.78 553.607,1599.98 555.958,1355.71 558.308,1333.8 560.658,1461.71 563.009,1356.92 565.359,1382.25 567.71,1578.82 570.06,1500.48 572.411,1561.3 574.761,1402.77 577.112,1382.26 579.462,1420.96 581.813,1496.4 584.163,1262.38 586.514,1282.3 588.864,1489.64 591.215,1354.9 593.565,1467.39 595.916,1380.55 598.266,1279.25 600.616,1292.74 602.967,1418.11 605.317,1418.31 607.668,1321.33 610.018,1474.86 612.369,1386.53 614.719,1485.59 617.07,1407.72 619.42,1503.66 621.771,1408.25 624.121,1437.46 626.472,1315.51 628.822,1456.34 631.173,1282.41 633.523,1358.71 635.874,1399.83 638.224,1436.93 640.575,1378.13 642.925,1480.08 645.275,1455.9 647.626,1540.42 649.976,1433.47 652.327,1459.77 654.677,1341.95 657.028,1550.82 659.378,1367.7 661.729,1545.9 664.079,1605.19 666.43,1460.06 668.78,1439.38 671.131,1627.42 673.481,1341.03 675.832,1404.57 678.182,1433.6 680.533,1403.35 682.883,1534.67 685.233,1231.92 687.584,1624.59 689.934,1442.68 692.285,1450.09 694.635,1331 696.986,1449.04 699.336,1576.71 701.687,1388.07 704.037,1554.16 706.388,1498.87 708.738,1521.66 711.089,1589.93 713.439,1446.71 715.79,1482.14 718.14,1375.12 720.491,1541.19 722.841,1387.1 725.192,1399.65 727.542,1621.14 729.892,1519.76 732.243,1524.42 734.593,1283.37 736.944,1355.08 739.294,1396.73 741.645,1304.18 743.995,1556.29 746.346,1394.99 748.696,1647.12 751.047,1464.25 753.397,1397.31 755.748,1510.85 758.098,1544.92 760.449,1227.67 762.799,1470.37 765.15,1514.07 767.5,1360.1 769.85,1498.58 772.201,1431.05 774.551,1345.67 776.902,1357.54 779.252,1422.7 781.603,1580.42 783.953,1259.17 786.304,1476.22 788.654,1469.6 791.005,1498.58 793.355,1470.57 795.706,1219.52 798.056,1508.57 800.407,1509.87 802.757,1577.67 805.108,1523.74 807.458,1418.19 809.809,1158.15 812.159,1424.93 814.509,1553.1 816.86,1248.52 819.21,1481.44 821.561,1414.41 823.911,1295.14 826.262,1315.1 828.612,1627.91 830.963,1397 833.313,1573.96 835.664,1448.86 838.014,1453.94 840.365,1400.53 842.715,1504.46 845.066,1403.26 847.416,1486.37 849.767,1198.31 852.117,1481.06 854.467,1426.76 856.818,1554.33 859.168,1456.76 861.519,1508.82 863.869,1396.07 866.22,1521 868.57,1428.12 870.921,1396.61 873.271,1422.86 875.622,1610.65 877.972,1410.69 880.323,1577.95 882.673,1430.69 885.024,1337.44 887.374,1443.24 889.725,1505.32 892.075,1359 894.426,1358.62 896.776,1493.69 899.126,1415.61 901.477,1425.3 903.827,1378.86 906.178,1276.29 908.528,1488.21 910.879,1401.41 913.229,1357.56 915.58,1406.82 917.93,1348.08 920.281,1621 922.631,1490.19 924.982,1397.45 927.332,1538.67 929.683,1480.22 932.033,1360.65 934.384,1580.86 936.734,1595.21 939.084,1399.2 941.435,1545.89 943.785,1374.77 946.136,1427.88 948.486,1459.42 950.837,1418.17 953.187,1478.93 955.538,1319.65 957.888,1388.28 960.239,1541.63 962.589,1554.83 964.94,1517.35 967.29,1385.94 969.641,1338.71 971.991,1371.23 974.342,1317.83 976.692,1421.64 979.043,1472.14 981.393,1612.1 983.743,1387.98 986.094,1536.93 988.444,1526.39 990.795,1630.16 993.145,1388.62 995.496,1288.04 997.846,1222.98 1000.2,1456.16 1002.55,1357.8 1004.9,1475.93 1007.25,1422.84 1009.6,1409.97 1011.95,1430.16 1014.3,1463.31 1016.65,1433.7 1019,1604.15 1021.35,1448.41 1023.7,1496.18 1026.05,1607.26 1028.4,1507.62 1030.75,1477.73 1033.1,1498.79 1035.45,1697.51 1037.8,1310.24 1040.15,1340.95 1042.51,1222.2 1044.86,1326.51 1047.21,1436.05 1049.56,1416.87 1051.91,1566.37 1054.26,1544.26 1056.61,1375.39 1058.96,1565.82 1061.31,1324.4 1063.66,1427 1066.01,1365.34 1068.36,1448.96 1070.71,1391.54 1073.06,1376.32 1075.41,1409.96 1077.76,1412.18 1080.11,1453.45 1082.46,1303.15 1084.81,1466.82 1087.16,1604.07 1089.51,1470.66 1091.87,1525.57 1094.22,1522.35 1096.57,1438.99 1098.92,1423.33 1101.27,1503.7 1103.62,1484.62 1105.97,1469.27 1108.32,1414.86 1110.67,1264.23 1113.02,1408.92 1115.37,1301.78 1117.72,1645.28 1120.07,1342.05 1122.42,1302.84 1124.77,1447.67 1127.12,1376.9 1129.47,1492.71 1131.82,1291.11 1134.17,1541.87 1136.52,1322.14 1138.87,1312.28 1141.23,1405.94 1143.58,1466.74 1145.93,1555.51 1148.28,1522.06 1150.63,1397.09 1152.98,1675.2 1155.33,1144.28 1157.68,1323.81 1160.03,1522.39 1162.38,1354.88 1164.73,1305.54 1167.08,1518.03 1169.43,1398.65 1171.78,1431.67 1174.13,1385.84 1176.48,1411.02 1178.83,1365.06 1181.18,1425.03 1183.53,1427.47 1185.88,1432.8 1188.23,1525.64 1190.59,1455.45 1192.94,1538.1 1195.29,1379.06 1197.64,1261.26 1199.99,1699.89 1202.34,1311.9 1204.69,1305.35 1207.04,1527.67 1209.39,1698.05 1211.74,1327.55 1214.09,1604.94 1216.44,1519.2 1218.79,1456.44 1221.14,1486.53 1223.49,1564.54 1225.84,1383.45 1228.19,1403.01 1230.54,1408.54 1232.89,1463.15 1235.24,1484.84 1237.59,1396.65 1239.94,1491.25 1242.3,1473.55 1244.65,1483.49 1247,1350.24 1249.35,1531.11 1251.7,1362.29 1254.05,1248.77 1256.4,1518.45 1258.75,1360.36 1261.1,1407.79 1263.45,1324.67 1265.8,1460.94 1268.15,1582.75 1270.5,1489.43 1272.85,1560.7 1275.2,1216.15 1277.55,1492.25 1279.9,1293.78 1282.25,1454.99 1284.6,1302.3 1286.95,1490.9 1289.3,1606.19 1291.66,1605.24 1294.01,1624.8 1296.36,1581.17 1298.71,1374.79 1301.06,1490.54 1303.41,1434.38 1305.76,1588.93 1308.11,1261.62 1310.46,1329.96 1312.81,1350.26 1315.16,1579.93 1317.51,1517.55 1319.86,1513.3 1322.21,1497.46 1324.56,1497.72 1326.91,1669.04 1329.26,1423.28 1331.61,1503.39 1333.96,1533.89 1336.31,1388.13 1338.66,1398.99 1341.02,1261.65 1343.37,1346.57 1345.72,1307.04 1348.07,1611.3 1350.42,1422.22 1352.77,1495.08 1355.12,1533.02 1357.47,1463.13 1359.82,1398.31 1362.17,1303.7 1364.52,1389.41 1366.87,1450.77 1369.22,1435.59 1371.57,1329.95 1373.92,1442.97 1376.27,1318.98 1378.62,1377.2 1380.97,1259.72 1383.32,1313.74 1385.67,1464.84 1388.02,1404.62 1390.38,1540.1 1392.73,1411.28 1395.08,1264.88 1397.43,1384.31 1399.78,1675.7 1402.13,1428.9 1404.48,1342.79 1406.83,1528.07 1409.18,1309.3 1411.53,1416.97 1413.88,1568.69 1416.23,1594.88 1418.58,1495.52 1420.93,1544.39 1423.28,1329.63 1425.63,1326.71 1427.98,1451.66 1430.33,1254.5 1432.68,1424.62 1435.03,1565.13 1437.38,1370.78 1439.74,1368.31 1442.09,1479.4 1444.44,1436.17 1446.79,1336.29 1449.14,1223.94 1451.49,1491.78 1453.84,1224.39 1456.19,1373.9 1458.54,1370.96 1460.89,1355.5 1463.24,1560.06 1465.59,1476.84 1467.94,1260.06 1470.29,1431.98 1472.64,1385.57 1474.99,1452.37 1477.34,1498.57 1479.69,1114.2 1482.04,1452.96 1484.39,1523.42 1486.74,1419.02 1489.1,1411.44 1491.45,1345.55 1493.8,1321.39 1496.15,1457.05 1498.5,1365.26 1500.85,1323.29 1503.2,1665.2 1505.55,1484.86 1507.9,1416.12 1510.25,1302.07 1512.6,1496.44 1514.95,1270.44 1517.3,1351.52 1519.65,1446.6 1522,1342.34 1524.35,1375.99 1526.7,1296.7 1529.05,1620.04 1531.4,1441.6 1533.75,1271.94 1536.1,1413.65 1538.45,1660.52 1540.81,1395.73 1543.16,1572.67 1545.51,1348.44 1547.86,1296.49 1550.21,1494.31 1552.56,1293.3 1554.91,1381.57 1557.26,1406.95 1559.61,1254.79 1561.96,1677.57 1564.31,1511.91 1566.66,1661.9 1569.01,1313.54 1571.36,1299.54 1573.71,1433.12 1576.06,1514.43 1578.41,1363.02 1580.76,1552.34 1583.11,1390.29 1585.46,1290.16 1587.81,1541.14 1590.17,1542.6 1592.52,1500.82 1594.87,1481.14 1597.22,1450.2 1599.57,1488.5 1601.92,1247.09 1604.27,1556.66 1606.62,1413.43 1608.97,1404.82 1611.32,1328.63 1613.67,1300.02 1616.02,1431.22 1618.37,1459.52 1620.72,1313.04 1623.07,1321.41 1625.42,1514.94 1627.77,1612.24 1630.12,1431.28 1632.47,1415.08 1634.82,1568.67 1637.17,1423.58 1639.53,1529.68 1641.88,1623.54 1644.23,1491.27 1646.58,1636.95 1648.93,1300.36 1651.28,1507.14 1653.63,1443.61 1655.98,1385.03 1658.33,1531.07 1660.68,1357.86 1663.03,1506.65 1665.38,1470.44 1667.73,1503.78 1670.08,1440.81 1672.43,1509.5 1674.78,1264.57 1677.13,1509.96 1679.48,1529.45 1681.83,1579.49 1684.18,1120.22 1686.53,1328.84 1688.89,1563.88 1691.24,1324.67 1693.59,1440.32 1695.94,1372.14 1698.29,1480.17 1700.64,1503.64 1702.99,1675.41 1705.34,1370.99 1707.69,1320.03 1710.04,1409.75 1712.39,1316.34 1714.74,1312.54 1717.09,1505.16 1719.44,1400.07 1721.79,1393.23 1724.14,1510.5 1726.49,1417.79 1728.84,1450.34 1731.19,1224.32 1733.54,1442.72 1735.89,1563.05 1738.25,1513.08 1740.6,1385.17 1742.95,1476.34 1745.3,1583.54 1747.65,1502.82 1750,1551.69 1752.35,1324.02 1754.7,1599.4 1757.05,1442.56 1759.4,1428.84 1761.75,1206.52 1764.1,1419.8 1766.45,1446.9 1768.8,1410.69 1771.15,1359.24 1773.5,1379.18 1775.85,1256.94 1778.2,1470.84 1780.55,1471.85 1782.9,1526.48 1785.25,1518.31 1787.6,1243.55 1789.96,1525.93 1792.31,1192.59 1794.66,1592.19 1797.01,1356.9 1799.36,1541.11 1801.71,1381.4 1804.06,1236.88 1806.41,1321.59 1808.76,1474.7 1811.11,1432.3 1813.46,1546.87 1815.81,1265.58 1818.16,1454.35 1820.51,1460.42 1822.86,1594.49 1825.21,1545.3 1827.56,1481.22 1829.91,1422.05 1832.26,1392.1 1834.61,1344.77 1836.96,1662.81 1839.32,1471.01 1841.67,1335.05 1844.02,1512.5 1846.37,1305.3 1848.72,1398.47 1851.07,1375.28 1853.42,1533.77 1855.77,1460.35 1858.12,1473.28 1860.47,1328.76 1862.82,1404.57 1865.17,1317.7 1867.52,1234.84 1869.87,1480.82 1872.22,1375.26 1874.57,1320.74 1876.92,1420.71 1879.27,1303.45 1881.62,1376.57 1883.97,1415.67 1886.32,1536.26 1888.68,1439.79 1891.03,1507.38 1893.38,1438.83 1895.73,1233.92 1898.08,1336.51 1900.43,1399.26 1902.78,1329.48 1905.13,1523.43 1907.48,1501.79 1909.83,1748.44 1912.18,1498.91 1914.53,1415.28 1916.88,1526.93 1919.23,1377.64 1921.58,1443.95 1923.93,1358.11 1926.28,1452.98 1928.63,1355.75 1930.98,1540.15 1933.33,1545.84 1935.68,1201.17 1938.04,1556.34 1940.39,1276.92 1942.74,1515.24 1945.09,1616.63 1947.44,1368.66 1949.79,1350.47 1952.14,1457.34 1954.49,1386.16 1956.84,1618.07 1959.19,1451.41 1961.54,1525.51 1963.89,1555.48 1966.24,1476.72 1968.59,1392.77 1970.94,1339.76 1973.29,1358.7 1975.64,1311.78 1977.99,1420.48 1980.34,1515.84 1982.69,1541.92 1985.04,1547.07 1987.4,1501.18 1989.75,1599.21 1992.1,1485.73 1994.45,1455.59 1996.8,1357.86 1999.15,1388.13 2001.5,1491.49 2003.85,1389.05 2006.2,1388.18 2008.55,1590.44 2010.9,1447.24 2013.25,1372.75 2015.6,1670.52 2017.95,1425.61 2020.3,1574.43 2022.65,1418.05 2025,1297.17 2027.35,1355.45 2029.7,1374.84 2032.05,1454.85 2034.4,1335.24 2036.76,1322.04 2039.11,1338.49 2041.46,1440.43 2043.81,1317.72 2046.16,1482.48 2048.51,1522.33 2050.86,1298.6 2053.21,1441.93 2055.56,1443.46 2057.91,1485.72 2060.26,1286.76 2062.61,1352.1 2064.96,1390.22 2067.31,1352.11 2069.66,1443.67 2072.01,1374.37 2074.36,1349.28 2076.71,1368.71 2079.06,1454.31 2081.41,1389.95 2083.76,1466.99 2086.11,1330.35 2088.47,1335.78 2090.82,1496.84 2093.17,1304.95 2095.52,1418.45 2097.87,1476.97 2100.22,1488.25 2102.57,1377.84 2104.92,1378.12 2107.27,1665.91 2109.62,1318.53 2111.97,1560.28 2114.32,1349.82 2116.67,1504.8 2119.02,1402.58 2121.37,1555.96 2123.72,1399.3 2126.07,1566.55 2128.42,1504.99 2130.77,1475.33 2133.12,1548.97 2135.47,1430.09 2137.83,1280.1 2140.18,1538.16 2142.53,1340.41 2144.88,1471.83 2147.23,1433.67 2149.58,1468.64 2151.93,1409.71 2154.28,1493.21 2156.63,1597.59 2158.98,1289.63 2161.33,1577.49 2163.68,1162.68 2166.03,1364.56 2168.38,1471.25 2170.73,1503.84 2173.08,1214.59 2175.43,1499.69 2177.78,1399.98 2180.13,1342.69 2182.48,1380.08 2184.83,1290.3 2187.19,1261.32 2189.54,1307.97 2191.89,1371.6 2194.24,1598.43 2196.59,1398.37 2198.94,1422.16 2201.29,1274.1 2203.64,1376.71 2205.99,1487.03 2208.34,1351.16 2210.69,1336.37 2213.04,1565.63 2215.39,1496.73 2217.74,1441.88 2220.09,1448.31 2222.44,1399.1 2224.79,1275.12 2227.14,1446.69 2229.49,1534.24 2231.84,1448.57 2234.19,1220.22 2236.55,1574.61 2238.9,1487.14 2241.25,1471.41 2243.6,1413.52 2245.95,1436.94 2248.3,1413.15 2250.65,1538.26 2253,1563.29 2255.35,1402.01 2257.7,1391.46 2260.05,1349.45 2262.4,1549.12 2264.75,1353.95 2267.1,1437.76 2269.45,1409.89 2271.8,1217.13 2274.15,1411.01 2276.5,1464.92 2278.85,1391.77 2281.2,1385.25 2283.55,1182.68 2285.91,1422.49 2288.26,1412.97 2290.61,1376.42 2292.96,1545.86 2295.31,1345.24 2297.66,1252.63 2300.01,1400.88 2302.36,1466.54 2304.71,1437.96 2307.06,1575.71 2309.41,1272.11 2311.76,1515.88 2314.11,1363.69 2316.46,1432.5 2318.81,1429.5 2321.16,1355.52 2323.51,1535.13 2325.86,1294.4 2328.21,1433.78 2330.56,1461.94 2332.91,1406.2 2335.27,1603.8 2337.62,1413.63 2339.97,1512.46 2342.32,1463.17 2344.67,1362.32 2347.02,1557.63 2349.37,1419.76 2351.72,1443.13 2354.07,1444.43 2356.42,1426.33 2358.77,1375.13 2361.12,1482.32 2363.47,1336.57 2365.82,1481.79 2368.17,1491.99 2370.52,1528.9 2372.87,1519 2375.22,1382.25 2377.57,1639.95 2379.92,1587.61 2382.27,1438.69 2384.62,1389.81 2386.98,1412.36 2389.33,1382.24 2391.68,1425.23 2394.03,1373.28 2396.38,1353.39 2398.73,1512.22 2401.08,1433.23 2403.43,1603.47 2405.78,1472.5 2408.13,1432.33 2410.48,1498.68 2412.83,1339.24 2415.18,1359.03 2417.53,1427.48 2419.88,1522.02 2422.23,1340.6 2424.58,1550.75 2426.93,1275.46 2429.28,1561.6 2431.63,1246.38 2433.98,1263.56 2436.34,1420.91 2438.69,1537.4 2441.04,1480.49 2443.39,1659.85 2445.74,1518.64 2448.09,1317.88 2450.44,1475.68 2452.79,1330.01 2455.14,1629.94 2457.49,1479.99 2459.84,1585.6 2462.19,1238.86 2464.54,1411.93 2466.89,1439.55 2469.24,1352 2471.59,1418.32 2473.94,1407.58 2476.29,1340.94 2478.64,1578.59 2480.99,1440.8 2483.34,1383.33 2485.7,1445.78 2488.05,1453.52 2490.4,1473.44 2492.75,1291.79 2495.1,1313.73 2497.45,1444.45 2499.8,1410.45 2502.15,1398.43 2504.5,1530.69 2506.85,1362.35 2509.2,1421.42 2511.55,1332.55 2513.9,1410.92 2516.25,1288.86 2518.6,1554.3 2520.95,1315.4 2523.3,1450.35 2525.65,1555.64 2528,1368.79 2530.35,1423.4 2532.7,1476.75 2535.06,1574.09 2537.41,1442.25 2539.76,1448.49 2542.11,1378.92 2544.46,1390.43 2546.81,1491.7 2549.16,1567.26 2551.51,1530.82 2553.86,1432.76 2556.21,1346.56 2558.56,1256.27 2560.91,1618.96 2563.26,1357.81 2565.61,1648.25 2567.96,1561.64 2570.31,1321.78 "></polyline>
<polyline clip-path="url(#clip302)" style="stroke:#e26f46; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,1022.54 224.541,972.127 226.891,942.122 229.242,873.461 231.592,917.205 233.943,929.581 236.293,1010.96 238.644,725.076 240.994,959.384 243.345,921.766 245.695,954.458 248.046,890.212 250.396,1096.48 252.747,898.953 255.097,911.749 257.448,1015.77 259.798,944.997 262.148,758.245 264.499,909.15 266.849,773.49 269.2,854.105 271.55,1004.92 273.901,973.495 276.251,752.623 278.602,910.207 280.952,908.696 283.303,805.176 285.653,825.945 288.004,825.391 290.354,959.572 292.705,861.222 295.055,764.486 297.406,934.306 299.756,877.811 302.107,989.3 304.457,914.345 306.807,1028.67 309.158,935.305 311.508,942.25 313.859,954.548 316.209,987.552 318.56,993.529 320.91,947.792 323.261,885.393 325.611,896.715 327.962,1031.49 330.312,1028.77 332.663,1000.97 335.013,961.311 337.364,1115.6 339.714,931.089 342.065,801.615 344.415,780.386 346.765,827.328 349.116,1012.34 351.466,817.767 353.817,849.681 356.167,864.142 358.518,933.088 360.868,814.541 363.219,837.965 365.569,939.025 367.92,815.181 370.27,947.47 372.621,828.039 374.971,844.068 377.322,836.903 379.672,959.088 382.023,1054.32 384.373,797.991 386.724,880.348 389.074,952.757 391.424,831.881 393.775,979.556 396.125,776.735 398.476,877.955 400.826,1016.21 403.177,1034.67 405.527,830.077 407.878,947.191 410.228,925.636 412.579,924.403 414.929,1182.88 417.28,1024.42 419.63,942.266 421.981,902.625 424.331,868.649 426.682,799.879 429.032,880.715 431.382,1002.95 433.733,970.193 436.083,797.378 438.434,939.08 440.784,953.925 443.135,972.628 445.485,1103.13 447.836,886.496 450.186,1048.93 452.537,782.527 454.887,1089.35 457.238,778.255 459.588,1067.26 461.939,843.881 464.289,887.777 466.64,906.82 468.99,826.723 471.341,741.447 473.691,976.468 476.041,868.032 478.392,1023.69 480.742,891.23 483.093,900.388 485.443,964.513 487.794,873.728 490.144,879.891 492.495,1102.14 494.845,980.719 497.196,826.387 499.546,962.54 501.897,897.787 504.247,944.421 506.598,844.174 508.948,862.769 511.299,1026.57 513.649,780.387 515.999,1002.06 518.35,874.452 520.7,817.648 523.051,904.345 525.401,1073.19 527.752,931.554 530.102,977.994 532.453,990.924 534.803,898.569 537.154,904 539.504,801.642 541.855,904.467 544.205,763.629 546.556,1106.51 548.906,996.447 551.257,1071.14 553.607,733.894 555.958,975.252 558.308,990.623 560.658,901.097 563.009,959.957 565.359,1108.44 567.71,908.664 570.06,988.376 572.411,899.288 574.761,856.902 577.112,1035.16 579.462,882.025 581.813,953.235 584.163,1121.19 586.514,999.121 588.864,992.897 591.215,776.657 593.565,810.099 595.916,830.108 598.266,833.275 600.616,763.808 602.967,967.782 605.317,1165.59 607.668,973.717 610.018,954.389 612.369,913.459 614.719,919.401 617.07,819.668 619.42,973.593 621.771,857.831 624.121,890.643 626.472,931.695 628.822,1162.55 631.173,840.463 633.523,957.685 635.874,1011.72 638.224,1023.13 640.575,1111.77 642.925,1019.33 645.275,869.166 647.626,855.256 649.976,842.951 652.327,697.22 654.677,902.108 657.028,868.426 659.378,1025.12 661.729,875.521 664.079,997.278 666.43,912.684 668.78,931.316 671.131,958.332 673.481,847.772 675.832,865.06 678.182,997.686 680.533,965.099 682.883,846.097 685.233,799.333 687.584,828.497 689.934,852.785 692.285,1124.03 694.635,990.242 696.986,908.621 699.336,806.963 701.687,898.948 704.037,765.554 706.388,734.918 708.738,985.57 711.089,935.235 713.439,781.256 715.79,818.041 718.14,992.03 720.491,903.703 722.841,704.326 725.192,868.341 727.542,790.749 729.892,1040.06 732.243,1030.92 734.593,892.057 736.944,1116.23 739.294,977.099 741.645,966.024 743.995,924.303 746.346,981.904 748.696,1041.11 751.047,1075 753.397,1128.68 755.748,1017.14 758.098,1005.01 760.449,959.418 762.799,838.462 765.15,1088.39 767.5,770.888 769.85,925.301 772.201,795.747 774.551,765.938 776.902,828.193 779.252,904.489 781.603,860.844 783.953,777.178 786.304,745.682 788.654,993.117 791.005,976.533 793.355,983.068 795.706,916.127 798.056,867.818 800.407,999.042 802.757,957.001 805.108,995.821 807.458,720.875 809.809,942.909 812.159,742.516 814.509,862.83 816.86,930.202 819.21,921.599 821.561,936.866 823.911,777.405 826.262,907.628 828.612,942.726 830.963,827.917 833.313,869.647 835.664,920.409 838.014,981.913 840.365,848.668 842.715,996.82 845.066,754.432 847.416,790.237 849.767,837.394 852.117,799.82 854.467,784.079 856.818,895.096 859.168,872.518 861.519,858.828 863.869,780.182 866.22,928.722 868.57,1216.21 870.921,1016.9 873.271,1066.73 875.622,821.951 877.972,889.994 880.323,798.692 882.673,815.221 885.024,538.538 887.374,900.729 889.725,872.855 892.075,995.283 894.426,815.946 896.776,848.177 899.126,971.401 901.477,986.247 903.827,873.244 906.178,969.064 908.528,892.601 910.879,818.293 913.229,911.497 915.58,704.322 917.93,862.072 920.281,852.935 922.631,842.273 924.982,699.304 927.332,819.22 929.683,932.012 932.033,949.651 934.384,928.052 936.734,998.503 939.084,967.091 941.435,972.432 943.785,1035.36 946.136,850.081 948.486,916.964 950.837,741.869 953.187,1038.56 955.538,831.68 957.888,998.304 960.239,848.994 962.589,1035.86 964.94,893.51 967.29,774.827 969.641,926.754 971.991,857.772 974.342,852.042 976.692,765.373 979.043,1026.8 981.393,840.155 983.743,1184.49 986.094,1015.19 988.444,976.238 990.795,769.176 993.145,885.886 995.496,679.598 997.846,842.773 1000.2,1150.98 1002.55,787.07 1004.9,917.237 1007.25,979.519 1009.6,875.708 1011.95,974.926 1014.3,928.461 1016.65,742.973 1019,997.668 1021.35,885.22 1023.7,958.478 1026.05,907.474 1028.4,844.06 1030.75,887.096 1033.1,846.389 1035.45,821.831 1037.8,1010.49 1040.15,1052.5 1042.51,1093.78 1044.86,854.143 1047.21,1005.76 1049.56,957.513 1051.91,993.207 1054.26,855.553 1056.61,1008.56 1058.96,812.475 1061.31,946.66 1063.66,1038.85 1066.01,1072.1 1068.36,683.176 1070.71,1154.72 1073.06,910.003 1075.41,882.218 1077.76,939.164 1080.11,873.507 1082.46,890.894 1084.81,872.873 1087.16,1071.94 1089.51,904.113 1091.87,923.651 1094.22,1015.56 1096.57,880.527 1098.92,924.863 1101.27,855.725 1103.62,1001.39 1105.97,869.651 1108.32,923.29 1110.67,882.431 1113.02,1061.99 1115.37,1054 1117.72,839.857 1120.07,1000.74 1122.42,1105.04 1124.77,948.327 1127.12,1007.73 1129.47,732.157 1131.82,927.711 1134.17,832.699 1136.52,791.16 1138.87,883.918 1141.23,675.758 1143.58,719.689 1145.93,781.669 1148.28,856.542 1150.63,1087.57 1152.98,1067.18 1155.33,749.813 1157.68,1013.43 1160.03,932.292 1162.38,985.197 1164.73,952.996 1167.08,848.976 1169.43,969.811 1171.78,887.777 1174.13,1028.64 1176.48,778.214 1178.83,1161.46 1181.18,987.527 1183.53,1000.99 1185.88,902.148 1188.23,941.842 1190.59,1100.74 1192.94,806.096 1195.29,800.496 1197.64,1057.41 1199.99,764.904 1202.34,1040.61 1204.69,931.795 1207.04,822.36 1209.39,708.558 1211.74,822.062 1214.09,1196.02 1216.44,810.973 1218.79,861.247 1221.14,1109.27 1223.49,847.864 1225.84,947.102 1228.19,973.218 1230.54,854.294 1232.89,958.186 1235.24,1002.73 1237.59,864.164 1239.94,660.357 1242.3,795.718 1244.65,1107.08 1247,1009.5 1249.35,913.207 1251.7,849.318 1254.05,953.2 1256.4,1042.39 1258.75,961.957 1261.1,745.925 1263.45,839.713 1265.8,822.896 1268.15,923.755 1270.5,1077.86 1272.85,788.73 1275.2,923.013 1277.55,969.156 1279.9,855.26 1282.25,877.874 1284.6,831.751 1286.95,953.126 1289.3,853.284 1291.66,810.231 1294.01,1082.36 1296.36,1080.54 1298.71,874.156 1301.06,1024.22 1303.41,858.374 1305.76,818.114 1308.11,842.961 1310.46,963.443 1312.81,1059.18 1315.16,939.762 1317.51,709.473 1319.86,896.565 1322.21,818.995 1324.56,950.703 1326.91,857.396 1329.26,842.124 1331.61,896.558 1333.96,1055.37 1336.31,968.491 1338.66,1044.27 1341.02,928.793 1343.37,909.15 1345.72,789.547 1348.07,854.065 1350.42,1039 1352.77,842.527 1355.12,803.935 1357.47,989.623 1359.82,833.123 1362.17,847.525 1364.52,944.152 1366.87,829.08 1369.22,834.003 1371.57,842.052 1373.92,783.086 1376.27,963.039 1378.62,780.778 1380.97,936.125 1383.32,698.274 1385.67,937.559 1388.02,905.809 1390.38,920.984 1392.73,930.053 1395.08,927.174 1397.43,895.497 1399.78,1115.25 1402.13,855.193 1404.48,979.159 1406.83,1042.91 1409.18,942.978 1411.53,1219.02 1413.88,1177.75 1416.23,1055.9 1418.58,905.086 1420.93,867.515 1423.28,1048.56 1425.63,926.452 1427.98,1009 1430.33,994.623 1432.68,972.803 1435.03,807.399 1437.38,822.668 1439.74,920.018 1442.09,734.395 1444.44,745.849 1446.79,832.632 1449.14,930.858 1451.49,784.174 1453.84,1032.36 1456.19,928.677 1458.54,943.735 1460.89,917.082 1463.24,843.148 1465.59,981.284 1467.94,928.638 1470.29,940.62 1472.64,869.864 1474.99,823.649 1477.34,1045.76 1479.69,1102.78 1482.04,640.436 1484.39,883.96 1486.74,892.348 1489.1,984.871 1491.45,929.265 1493.8,1128.29 1496.15,765.49 1498.5,904.677 1500.85,1106.09 1503.2,972.905 1505.55,955.006 1507.9,912.321 1510.25,937.437 1512.6,895.774 1514.95,906.651 1517.3,974.401 1519.65,1063.59 1522,921.365 1524.35,1012.68 1526.7,921.946 1529.05,968.69 1531.4,948.787 1533.75,908.868 1536.1,1000.67 1538.45,864.54 1540.81,970.692 1543.16,1113.46 1545.51,800.684 1547.86,1009.61 1550.21,1093.75 1552.56,884.144 1554.91,962.673 1557.26,997.548 1559.61,1028.35 1561.96,929.52 1564.31,1019.53 1566.66,841.47 1569.01,885.477 1571.36,925.881 1573.71,909.99 1576.06,923.5 1578.41,897.095 1580.76,985.423 1583.11,1016.17 1585.46,933.206 1587.81,1162.55 1590.17,789.336 1592.52,885.552 1594.87,916.681 1597.22,931.437 1599.57,907.2 1601.92,1126.01 1604.27,953.559 1606.62,914.906 1608.97,958.527 1611.32,956.167 1613.67,946.688 1616.02,968.211 1618.37,807.422 1620.72,1211.01 1623.07,858.756 1625.42,1043.77 1627.77,851.474 1630.12,935.427 1632.47,810.712 1634.82,770.591 1637.17,958.757 1639.53,939.914 1641.88,1000.31 1644.23,986.831 1646.58,881.901 1648.93,1049.54 1651.28,1113.87 1653.63,874.813 1655.98,958.448 1658.33,961.27 1660.68,941.582 1663.03,884.404 1665.38,879.117 1667.73,923.679 1670.08,712.207 1672.43,1001.76 1674.78,1066.67 1677.13,939.126 1679.48,920.491 1681.83,908.625 1684.18,801.649 1686.53,883.593 1688.89,871.954 1691.24,1000.57 1693.59,911.212 1695.94,889.37 1698.29,928.717 1700.64,688.318 1702.99,854.523 1705.34,1034.37 1707.69,824.831 1710.04,971.086 1712.39,1024.8 1714.74,1114.12 1717.09,781.573 1719.44,673.292 1721.79,907.083 1724.14,1020.06 1726.49,904.353 1728.84,964.55 1731.19,972.137 1733.54,1049.29 1735.89,822.015 1738.25,1085.07 1740.6,876.082 1742.95,904.437 1745.3,852.034 1747.65,1016.85 1750,1128.21 1752.35,771.521 1754.7,827.416 1757.05,889.059 1759.4,885.573 1761.75,874.494 1764.1,860.694 1766.45,722.387 1768.8,869.211 1771.15,776.835 1773.5,823.721 1775.85,1172.59 1778.2,806.219 1780.55,932.542 1782.9,1017.59 1785.25,982.081 1787.6,906.843 1789.96,945.932 1792.31,732.046 1794.66,772.325 1797.01,1021.58 1799.36,965.038 1801.71,810.077 1804.06,844.068 1806.41,892.142 1808.76,872.785 1811.11,941.884 1813.46,816.707 1815.81,935.324 1818.16,940.307 1820.51,984.359 1822.86,1022.46 1825.21,880.234 1827.56,867.215 1829.91,998.429 1832.26,792.523 1834.61,964.452 1836.96,803.013 1839.32,899.531 1841.67,873.756 1844.02,840.783 1846.37,738.505 1848.72,811.205 1851.07,805.878 1853.42,1009.59 1855.77,889.499 1858.12,660.847 1860.47,777.706 1862.82,909.812 1865.17,793.318 1867.52,646.048 1869.87,976.796 1872.22,999.429 1874.57,908.118 1876.92,951.191 1879.27,1102.81 1881.62,902.146 1883.97,971.433 1886.32,1001.08 1888.68,844.64 1891.03,997.264 1893.38,873.816 1895.73,1060.84 1898.08,735.057 1900.43,755.881 1902.78,961.627 1905.13,982.894 1907.48,813.086 1909.83,845.095 1912.18,830.485 1914.53,1064.44 1916.88,802.42 1919.23,965.556 1921.58,978.663 1923.93,912.914 1926.28,869.227 1928.63,812.938 1930.98,895.369 1933.33,886.478 1935.68,1054 1938.04,799.01 1940.39,897.77 1942.74,607.796 1945.09,936.624 1947.44,816.366 1949.79,938.51 1952.14,860.511 1954.49,1082.18 1956.84,1056.89 1959.19,997.696 1961.54,1018.32 1963.89,1099.59 1966.24,747.535 1968.59,1054.48 1970.94,748.538 1973.29,903.082 1975.64,721.856 1977.99,785.367 1980.34,1033.62 1982.69,984.981 1985.04,1036.07 1987.4,975.744 1989.75,1040.68 1992.1,911.9 1994.45,845.808 1996.8,988.803 1999.15,832.626 2001.5,850.172 2003.85,846.829 2006.2,869.34 2008.55,1081.25 2010.9,910.826 2013.25,967.067 2015.6,781.019 2017.95,928.573 2020.3,929.674 2022.65,1031.25 2025,890.473 2027.35,1065.84 2029.7,974.232 2032.05,997.407 2034.4,851.415 2036.76,1075.59 2039.11,1087.66 2041.46,893.426 2043.81,809.995 2046.16,759.663 2048.51,793.85 2050.86,1050.16 2053.21,751.536 2055.56,912.85 2057.91,1038.1 2060.26,898.588 2062.61,1068.26 2064.96,926.618 2067.31,842.775 2069.66,778.629 2072.01,890.989 2074.36,922.481 2076.71,964.081 2079.06,1069.3 2081.41,801.792 2083.76,910.05 2086.11,836.432 2088.47,938.66 2090.82,918.524 2093.17,835.015 2095.52,836.759 2097.87,1002.41 2100.22,953.61 2102.57,935.647 2104.92,1096.95 2107.27,847.641 2109.62,958.232 2111.97,1038.11 2114.32,1002.89 2116.67,1066.36 2119.02,728.299 2121.37,940.706 2123.72,868.205 2126.07,850.236 2128.42,790.196 2130.77,799.684 2133.12,935.674 2135.47,1071.66 2137.83,905.539 2140.18,1142.6 2142.53,1048.67 2144.88,752.613 2147.23,975.105 2149.58,799.532 2151.93,859.099 2154.28,836.692 2156.63,1108.15 2158.98,869.229 2161.33,1042.02 2163.68,816.843 2166.03,978.966 2168.38,767.301 2170.73,922.448 2173.08,957.403 2175.43,1029.4 2177.78,900.276 2180.13,822.966 2182.48,873.944 2184.83,850.302 2187.19,837.254 2189.54,786.715 2191.89,965.969 2194.24,1049.54 2196.59,1000.63 2198.94,729.052 2201.29,669.972 2203.64,914.414 2205.99,953.337 2208.34,956.211 2210.69,1037.21 2213.04,1158.35 2215.39,913.61 2217.74,1196.56 2220.09,1047.19 2222.44,886.738 2224.79,1066.49 2227.14,954.362 2229.49,1033.81 2231.84,855.128 2234.19,1034.52 2236.55,882.215 2238.9,947.726 2241.25,1015.37 2243.6,994.339 2245.95,787.013 2248.3,1042.24 2250.65,1086.02 2253,784.174 2255.35,935.125 2257.7,1115.08 2260.05,845.586 2262.4,850.453 2264.75,865.884 2267.1,811.904 2269.45,934.748 2271.8,710.767 2274.15,931.46 2276.5,887.838 2278.85,750.519 2281.2,638.484 2283.55,1062.93 2285.91,860.627 2288.26,747.268 2290.61,1020.88 2292.96,994.884 2295.31,830.011 2297.66,1039.02 2300.01,830.168 2302.36,971.057 2304.71,964.155 2307.06,913.514 2309.41,872.966 2311.76,989.709 2314.11,919.566 2316.46,1056.95 2318.81,963.408 2321.16,876.907 2323.51,968.341 2325.86,1043.62 2328.21,861.384 2330.56,846.592 2332.91,904.627 2335.27,861.702 2337.62,741.975 2339.97,829.443 2342.32,766.625 2344.67,904.104 2347.02,961.186 2349.37,896.313 2351.72,1140.11 2354.07,937.259 2356.42,779.467 2358.77,802.694 2361.12,939.627 2363.47,971.218 2365.82,977.025 2368.17,882.878 2370.52,866.348 2372.87,838.058 2375.22,1034.26 2377.57,909.982 2379.92,829.892 2382.27,943.99 2384.62,930.069 2386.98,747.791 2389.33,984.683 2391.68,930.704 2394.03,893.357 2396.38,1014.39 2398.73,1027.14 2401.08,1126.38 2403.43,755.053 2405.78,882.531 2408.13,885.374 2410.48,945.291 2412.83,1054.29 2415.18,891.587 2417.53,879.335 2419.88,874.248 2422.23,878.742 2424.58,983.271 2426.93,875.596 2429.28,788.628 2431.63,940.466 2433.98,928.556 2436.34,972.746 2438.69,918.08 2441.04,960.365 2443.39,861.66 2445.74,899.69 2448.09,783.772 2450.44,936.096 2452.79,954.371 2455.14,869.277 2457.49,884.061 2459.84,991.63 2462.19,1058.1 2464.54,896.182 2466.89,884.646 2469.24,922.537 2471.59,799.238 2473.94,918.532 2476.29,741.962 2478.64,894.1 2480.99,855.264 2483.34,959.987 2485.7,1095.38 2488.05,876.4 2490.4,900.504 2492.75,817.525 2495.1,903.182 2497.45,941.59 2499.8,794.274 2502.15,922.19 2504.5,857.048 2506.85,793.466 2509.2,881.481 2511.55,972.919 2513.9,1056.5 2516.25,869.072 2518.6,852.069 2520.95,852.611 2523.3,877.557 2525.65,1075.88 2528,904.246 2530.35,1082.28 2532.7,808.874 2535.06,1004.39 2537.41,957.974 2539.76,766.089 2542.11,999.439 2544.46,1078.97 2546.81,953.989 2549.16,866.144 2551.51,828.922 2553.86,686.313 2556.21,899.773 2558.56,883.561 2560.91,898.925 2563.26,1025.84 2565.61,1019.19 2567.96,1107.92 2570.31,1079.13 "></polyline>
<polyline clip-path="url(#clip302)" style="stroke:#3da44d; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,444.647 224.541,453.735 226.891,368.186 229.242,462.109 231.592,495.154 233.943,158.637 236.293,327.688 238.644,375.431 240.994,581.427 243.345,509.991 245.695,414.927 248.046,451.767 250.396,243.585 252.747,444.651 255.097,416.103 257.448,339.201 259.798,323.344 262.148,411.825 264.499,375.52 266.849,321.854 269.2,350.951 271.55,413.514 273.901,411.727 276.251,196.424 278.602,462.249 280.952,324.768 283.303,347.543 285.653,470.618 288.004,338.299 290.354,344.513 292.705,440.784 295.055,422.692 297.406,390.337 299.756,227.362 302.107,412.101 304.457,489.841 306.807,406.139 309.158,414.996 311.508,648.625 313.859,373.735 316.209,549.598 318.56,472.402 320.91,536.206 323.261,286.088 325.611,404.635 327.962,614.336 330.312,301.607 332.663,488.669 335.013,414.763 337.364,333.15 339.714,413.893 342.065,306.768 344.415,582.696 346.765,414.198 349.116,274.794 351.466,503.429 353.817,283.313 356.167,426.249 358.518,498.642 360.868,353.074 363.219,396.083 365.569,580.48 367.92,565.613 370.27,659.535 372.621,562.11 374.971,438.352 377.322,407.402 379.672,434.806 382.023,430.255 384.373,367.204 386.724,429.635 389.074,502.264 391.424,389.133 393.775,361.8 396.125,544.429 398.476,480.743 400.826,363.597 403.177,429.226 405.527,362.209 407.878,505.354 410.228,515.804 412.579,321.778 414.929,516.614 417.28,466.222 419.63,141.47 421.981,293.689 424.331,363.689 426.682,454.76 429.032,453.151 431.382,554.748 433.733,314.51 436.083,547.267 438.434,203.426 440.784,444.607 443.135,428.483 445.485,448.041 447.836,519.836 450.186,359.663 452.537,546.677 454.887,319.567 457.238,225.832 459.588,293.972 461.939,412.961 464.289,501.11 466.64,427.871 468.99,383.384 471.341,220.422 473.691,371.211 476.041,382.415 478.392,561.903 480.742,283.659 483.093,391.66 485.443,386.512 487.794,519.3 490.144,296.849 492.495,521.949 494.845,513.539 497.196,301.754 499.546,387.402 501.897,384.892 504.247,292.44 506.598,357.776 508.948,424.784 511.299,509.686 513.649,556.81 515.999,457.945 518.35,459.892 520.7,352.112 523.051,314.188 525.401,366.589 527.752,509.734 530.102,632.318 532.453,486.862 534.803,469.083 537.154,426.582 539.504,492.511 541.855,445.963 544.205,433.607 546.556,383.073 548.906,512.134 551.257,567.606 553.607,448.489 555.958,533.252 558.308,333.162 560.658,491.785 563.009,275.74 565.359,304.568 567.71,249.645 570.06,391.017 572.411,251.536 574.761,453.918 577.112,439.263 579.462,289.958 581.813,382.767 584.163,413.895 586.514,253.942 588.864,236.274 591.215,481.524 593.565,389.652 595.916,229.813 598.266,651.632 600.616,382.262 602.967,496.681 605.317,318.752 607.668,561.037 610.018,469.986 612.369,375.615 614.719,357.286 617.07,268.189 619.42,360.473 621.771,383.674 624.121,104.115 626.472,524.184 628.822,243.384 631.173,373.385 633.523,308.215 635.874,506.361 638.224,531.579 640.575,490.396 642.925,420.221 645.275,501.103 647.626,369.196 649.976,367.106 652.327,403.696 654.677,398.395 657.028,453.293 659.378,386.402 661.729,500.697 664.079,259.186 666.43,270.836 668.78,516.635 671.131,419.121 673.481,505.085 675.832,486.718 678.182,483.294 680.533,302.757 682.883,498.49 685.233,328.178 687.584,525.757 689.934,317.522 692.285,238.788 694.635,654.514 696.986,419.05 699.336,420.275 701.687,466.549 704.037,421.877 706.388,353.101 708.738,466.692 711.089,430.86 713.439,258.091 715.79,211.73 718.14,441.287 720.491,304.021 722.841,303.165 725.192,360.292 727.542,494.706 729.892,251.456 732.243,608.818 734.593,329.923 736.944,412.355 739.294,441.699 741.645,197.074 743.995,558.752 746.346,434.762 748.696,618.034 751.047,636.664 753.397,409.981 755.748,416.414 758.098,389.162 760.449,484.734 762.799,321.361 765.15,471.643 767.5,412.194 769.85,302.971 772.201,351.599 774.551,509.959 776.902,554.77 779.252,301.464 781.603,500.833 783.953,333.607 786.304,480.106 788.654,557.666 791.005,325.774 793.355,426.543 795.706,400.925 798.056,400.448 800.407,376.943 802.757,472.12 805.108,531.283 807.458,430.045 809.809,369.454 812.159,415.443 814.509,417.238 816.86,333.193 819.21,449.121 821.561,669.852 823.911,269.658 826.262,255.106 828.612,380.853 830.963,187.395 833.313,421.983 835.664,506.889 838.014,449.335 840.365,296.832 842.715,440.512 845.066,256.141 847.416,383.814 849.767,476.486 852.117,496.791 854.467,525.134 856.818,318.732 859.168,293.498 861.519,338.671 863.869,387.285 866.22,540.42 868.57,367.874 870.921,660.486 873.271,415.316 875.622,417.766 877.972,514.359 880.323,479.692 882.673,539.139 885.024,362.395 887.374,302.593 889.725,414.471 892.075,490.318 894.426,540.171 896.776,295.011 899.126,479.743 901.477,463.682 903.827,442.643 906.178,421.485 908.528,219.325 910.879,585.19 913.229,431.061 915.58,523.764 917.93,305.101 920.281,453.897 922.631,466.661 924.982,367.164 927.332,410.828 929.683,402.083 932.033,311.279 934.384,326.173 936.734,190.606 939.084,381.323 941.435,408.419 943.785,401.699 946.136,298.588 948.486,285.855 950.837,617.682 953.187,386.945 955.538,348.105 957.888,282.664 960.239,266.64 962.589,443.688 964.94,466.758 967.29,379.421 969.641,534.517 971.991,411.95 974.342,257.891 976.692,230.174 979.043,352.824 981.393,381.903 983.743,439.594 986.094,477.726 988.444,397.916 990.795,404.025 993.145,563.235 995.496,421.743 997.846,457.895 1000.2,271.994 1002.55,445.314 1004.9,375.917 1007.25,497.169 1009.6,547.265 1011.95,472.744 1014.3,360.735 1016.65,529.832 1019,351.369 1021.35,512.153 1023.7,410.5 1026.05,417.734 1028.4,390.926 1030.75,358.046 1033.1,428.392 1035.45,409.931 1037.8,240.047 1040.15,458.345 1042.51,444.025 1044.86,354.671 1047.21,519.204 1049.56,347.168 1051.91,601.15 1054.26,469.175 1056.61,499.332 1058.96,378.027 1061.31,390.981 1063.66,365.435 1066.01,381.208 1068.36,436.815 1070.71,517.433 1073.06,579.795 1075.41,257.37 1077.76,463.478 1080.11,475.787 1082.46,325.596 1084.81,271.9 1087.16,445.221 1089.51,350.008 1091.87,455.049 1094.22,464.408 1096.57,627.185 1098.92,503.005 1101.27,464.854 1103.62,455.722 1105.97,417.364 1108.32,608.588 1110.67,367.38 1113.02,334.571 1115.37,479.898 1117.72,597.143 1120.07,346.281 1122.42,335.082 1124.77,369.313 1127.12,374.541 1129.47,369.504 1131.82,541.846 1134.17,587.511 1136.52,411.408 1138.87,372.475 1141.23,325.55 1143.58,422.134 1145.93,418.983 1148.28,387.626 1150.63,418.154 1152.98,410.935 1155.33,519.027 1157.68,481.064 1160.03,439.253 1162.38,253.655 1164.73,468.418 1167.08,336.606 1169.43,296.561 1171.78,381.076 1174.13,380.673 1176.48,356.966 1178.83,243.244 1181.18,389.048 1183.53,496.172 1185.88,365.024 1188.23,415.536 1190.59,523.229 1192.94,302.037 1195.29,426.637 1197.64,565.73 1199.99,444.373 1202.34,257.713 1204.69,396.955 1207.04,398.976 1209.39,320.153 1211.74,489.705 1214.09,300.795 1216.44,399.493 1218.79,391.107 1221.14,654.145 1223.49,463.506 1225.84,493.314 1228.19,310.318 1230.54,404.891 1232.89,267.658 1235.24,459.492 1237.59,393.814 1239.94,383.14 1242.3,404.019 1244.65,309.901 1247,458.438 1249.35,691.579 1251.7,305.008 1254.05,386.642 1256.4,418.655 1258.75,352.602 1261.1,431.319 1263.45,390.341 1265.8,492.693 1268.15,356.104 1270.5,432.709 1272.85,458.926 1275.2,512.935 1277.55,371.28 1279.9,316.235 1282.25,315.453 1284.6,257.354 1286.95,218.323 1289.3,521.736 1291.66,413.505 1294.01,411.049 1296.36,488.724 1298.71,457.113 1301.06,386.184 1303.41,472.284 1305.76,442.864 1308.11,364.468 1310.46,283.144 1312.81,419.236 1315.16,488.643 1317.51,471.551 1319.86,422.626 1322.21,413.328 1324.56,435.717 1326.91,425.833 1329.26,414.325 1331.61,417.715 1333.96,281.177 1336.31,440.963 1338.66,208.387 1341.02,508.589 1343.37,465.317 1345.72,570.53 1348.07,362.164 1350.42,468.935 1352.77,541.481 1355.12,291.221 1357.47,434.507 1359.82,480.057 1362.17,451.379 1364.52,353.449 1366.87,485.663 1369.22,303.029 1371.57,420.493 1373.92,406.553 1376.27,494.942 1378.62,276.205 1380.97,558.792 1383.32,525.04 1385.67,315.458 1388.02,250.389 1390.38,281.109 1392.73,307.049 1395.08,435.057 1397.43,296.703 1399.78,482.18 1402.13,327.05 1404.48,563.405 1406.83,289.371 1409.18,350.904 1411.53,417.105 1413.88,438.641 1416.23,123.623 1418.58,405.836 1420.93,412.486 1423.28,361.954 1425.63,357.119 1427.98,466.46 1430.33,286.183 1432.68,512.441 1435.03,279.391 1437.38,437.307 1439.74,264.591 1442.09,300.299 1444.44,514.592 1446.79,464.512 1449.14,360.149 1451.49,212.524 1453.84,363.813 1456.19,444.799 1458.54,524.133 1460.89,397.578 1463.24,444.456 1465.59,415.426 1467.94,582.843 1470.29,264.07 1472.64,390.008 1474.99,494.528 1477.34,381.101 1479.69,519.271 1482.04,365.459 1484.39,713.713 1486.74,209.175 1489.1,229.112 1491.45,283.963 1493.8,423.092 1496.15,96.8724 1498.5,312.817 1500.85,439.439 1503.2,460.307 1505.55,381.832 1507.9,282.167 1510.25,443.074 1512.6,398.69 1514.95,507.688 1517.3,306.706 1519.65,491.348 1522,379.048 1524.35,503.551 1526.7,597.44 1529.05,453.511 1531.4,227.563 1533.75,365.042 1536.1,255.869 1538.45,285.827 1540.81,607.39 1543.16,331.152 1545.51,484.042 1547.86,414.896 1550.21,366.924 1552.56,206.217 1554.91,215.488 1557.26,412.586 1559.61,451.216 1561.96,501.37 1564.31,318.409 1566.66,465.916 1569.01,493.078 1571.36,383.035 1573.71,600.931 1576.06,516.34 1578.41,262.27 1580.76,490.883 1583.11,408.619 1585.46,440.744 1587.81,534.98 1590.17,308.614 1592.52,292.184 1594.87,402.768 1597.22,498.865 1599.57,446.147 1601.92,558.534 1604.27,517.418 1606.62,368.864 1608.97,460.686 1611.32,576.691 1613.67,360.025 1616.02,394.371 1618.37,372.135 1620.72,468.678 1623.07,313.941 1625.42,449.217 1627.77,700.645 1630.12,342.962 1632.47,286.151 1634.82,503.297 1637.17,238.299 1639.53,390.204 1641.88,260.665 1644.23,405.818 1646.58,447.211 1648.93,398.305 1651.28,277.893 1653.63,667.122 1655.98,509.745 1658.33,362.524 1660.68,486.226 1663.03,415.779 1665.38,431.302 1667.73,431.63 1670.08,288.921 1672.43,409.489 1674.78,442.402 1677.13,292.708 1679.48,319.442 1681.83,429.226 1684.18,447.989 1686.53,490.597 1688.89,407.975 1691.24,360.025 1693.59,424.353 1695.94,425.773 1698.29,388.545 1700.64,298.537 1702.99,522.404 1705.34,342.529 1707.69,285.172 1710.04,633.21 1712.39,463.053 1714.74,452.466 1717.09,197.745 1719.44,544.067 1721.79,399.717 1724.14,221.405 1726.49,469.673 1728.84,447.9 1731.19,275.834 1733.54,337.729 1735.89,403.975 1738.25,411.555 1740.6,301.783 1742.95,382.032 1745.3,569.45 1747.65,201.018 1750,461.609 1752.35,400.6 1754.7,403.001 1757.05,388.548 1759.4,340.054 1761.75,514.144 1764.1,332.59 1766.45,266.506 1768.8,467.575 1771.15,124.801 1773.5,408.431 1775.85,190.083 1778.2,563.105 1780.55,476.072 1782.9,276.964 1785.25,289.886 1787.6,499.661 1789.96,434.131 1792.31,435.329 1794.66,238.092 1797.01,544.727 1799.36,376.118 1801.71,309.359 1804.06,460.178 1806.41,451.186 1808.76,448.517 1811.11,305.619 1813.46,446.784 1815.81,446.821 1818.16,511.305 1820.51,527.778 1822.86,328.634 1825.21,394.008 1827.56,456.258 1829.91,216.567 1832.26,280.025 1834.61,587.109 1836.96,315.382 1839.32,440.35 1841.67,363.964 1844.02,365.001 1846.37,207.975 1848.72,307.037 1851.07,346.698 1853.42,312.643 1855.77,500.651 1858.12,566.637 1860.47,456.281 1862.82,232.009 1865.17,388.445 1867.52,526.356 1869.87,297.797 1872.22,297.599 1874.57,489.587 1876.92,471.468 1879.27,401.643 1881.62,372.97 1883.97,323.338 1886.32,491.291 1888.68,238.667 1891.03,482.992 1893.38,368.855 1895.73,656.523 1898.08,394.743 1900.43,517.421 1902.78,354.352 1905.13,388.72 1907.48,465.896 1909.83,537.045 1912.18,400.432 1914.53,525.545 1916.88,587.744 1919.23,341.657 1921.58,485.325 1923.93,540.922 1926.28,382.45 1928.63,423.286 1930.98,404.84 1933.33,331.521 1935.68,579.721 1938.04,435.149 1940.39,454.399 1942.74,376.013 1945.09,296.945 1947.44,474.668 1949.79,419.023 1952.14,551.021 1954.49,244.334 1956.84,400.797 1959.19,397.538 1961.54,494.132 1963.89,315.079 1966.24,473.238 1968.59,459.613 1970.94,628.377 1973.29,364.59 1975.64,674.959 1977.99,321.117 1980.34,495.003 1982.69,556.536 1985.04,539.225 1987.4,458.135 1989.75,501.575 1992.1,373.252 1994.45,258.158 1996.8,417.691 1999.15,385.8 2001.5,443.845 2003.85,549.624 2006.2,409.643 2008.55,267.243 2010.9,354.623 2013.25,323.107 2015.6,420.516 2017.95,426.585 2020.3,515.272 2022.65,298.666 2025,218.793 2027.35,395.788 2029.7,385.406 2032.05,234.625 2034.4,400.732 2036.76,301.579 2039.11,430.818 2041.46,273.217 2043.81,455.697 2046.16,302.883 2048.51,480.216 2050.86,422.383 2053.21,570.746 2055.56,488.748 2057.91,396.199 2060.26,263.558 2062.61,433.227 2064.96,426.994 2067.31,324.829 2069.66,497.895 2072.01,485.077 2074.36,582.351 2076.71,647.471 2079.06,459.064 2081.41,302.459 2083.76,465.276 2086.11,541.209 2088.47,545.65 2090.82,331.107 2093.17,399.267 2095.52,347.027 2097.87,411.044 2100.22,408.223 2102.57,326.894 2104.92,375.971 2107.27,481.281 2109.62,453.769 2111.97,394.881 2114.32,287.591 2116.67,293.512 2119.02,438.637 2121.37,455.485 2123.72,459.454 2126.07,363.717 2128.42,310.846 2130.77,354.349 2133.12,291.853 2135.47,589.337 2137.83,495.681 2140.18,371.728 2142.53,410.043 2144.88,233.211 2147.23,286.436 2149.58,416.284 2151.93,473.769 2154.28,429.142 2156.63,319.35 2158.98,276.574 2161.33,454.626 2163.68,344.05 2166.03,329.934 2168.38,342.236 2170.73,559.928 2173.08,417.879 2175.43,387.426 2177.78,481.844 2180.13,420.591 2182.48,305.452 2184.83,329.142 2187.19,596.606 2189.54,392.156 2191.89,264.902 2194.24,191.05 2196.59,491.707 2198.94,213.227 2201.29,359.994 2203.64,491.057 2205.99,476.016 2208.34,484.242 2210.69,295.125 2213.04,593.957 2215.39,321.626 2217.74,466.419 2220.09,474.003 2222.44,380.381 2224.79,437.719 2227.14,621.711 2229.49,502.971 2231.84,511.764 2234.19,231.05 2236.55,381.072 2238.9,280.197 2241.25,395.162 2243.6,565.035 2245.95,321.556 2248.3,520.32 2250.65,269.076 2253,494.729 2255.35,341.462 2257.7,500.441 2260.05,507.778 2262.4,517.832 2264.75,482.894 2267.1,505.522 2269.45,473.19 2271.8,272.242 2274.15,418.558 2276.5,530.608 2278.85,378.515 2281.2,396.187 2283.55,361.902 2285.91,400.121 2288.26,531.281 2290.61,327.602 2292.96,332.638 2295.31,387.272 2297.66,555.478 2300.01,428.381 2302.36,268.838 2304.71,164.488 2307.06,314.898 2309.41,417.255 2311.76,388.073 2314.11,406.065 2316.46,547.337 2318.81,339.418 2321.16,407.132 2323.51,285.278 2325.86,388.988 2328.21,346.364 2330.56,435.501 2332.91,291.549 2335.27,530.029 2337.62,616.971 2339.97,484.829 2342.32,504.446 2344.67,524.605 2347.02,477.644 2349.37,362.619 2351.72,476.887 2354.07,441.893 2356.42,563.262 2358.77,362.885 2361.12,496.959 2363.47,345.297 2365.82,360.822 2368.17,525.702 2370.52,500.274 2372.87,181.881 2375.22,339.717 2377.57,540.798 2379.92,459.814 2382.27,257.168 2384.62,418.411 2386.98,243.395 2389.33,384.435 2391.68,496.076 2394.03,462.412 2396.38,629.287 2398.73,510.89 2401.08,312.315 2403.43,380.149 2405.78,416.285 2408.13,373.423 2410.48,391.213 2412.83,281.755 2415.18,423.899 2417.53,270.607 2419.88,285.644 2422.23,446.128 2424.58,280.372 2426.93,581.207 2429.28,395.234 2431.63,299.587 2433.98,259.35 2436.34,350.276 2438.69,360.168 2441.04,326.339 2443.39,348.813 2445.74,428.277 2448.09,421.649 2450.44,456.259 2452.79,339.504 2455.14,329.555 2457.49,312.623 2459.84,363.097 2462.19,494.428 2464.54,457.899 2466.89,418.797 2469.24,264.956 2471.59,390.665 2473.94,517.831 2476.29,383.214 2478.64,202.708 2480.99,247.647 2483.34,489.986 2485.7,320.142 2488.05,526.231 2490.4,423.26 2492.75,170.135 2495.1,583.282 2497.45,333.142 2499.8,302.132 2502.15,705.268 2504.5,339.082 2506.85,360.231 2509.2,448.319 2511.55,314.834 2513.9,310.86 2516.25,421.245 2518.6,526.832 2520.95,396.455 2523.3,477.946 2525.65,374.219 2528,419.104 2530.35,601.342 2532.7,342.483 2535.06,443.059 2537.41,453.262 2539.76,299.847 2542.11,477.57 2544.46,461.613 2546.81,350.614 2549.16,383.467 2551.51,494.895 2553.86,300.077 2556.21,374.589 2558.56,305.843 2560.91,463.677 2563.26,488.78 2565.61,467.939 2567.96,313.904 2570.31,276.688 "></polyline>
</svg>
</div>
</div>
<p>Look at that! Things are working; amazin’.</p>
<p>We can also exploit <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>’s parallel sampling capabilities:</p>
<div id="34" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run separate 4 chains for 10 000 iterations using threads to parallelize.</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>num_chains <span class="op">=</span> <span class="fl">4</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    model_with_grad,</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">MCMCThreads</span>(),</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>,</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    num_chains;</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Note we need to provide an initial state for every chain.</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>    initial_state<span class="op">=</span><span class="fu">fill</span>(state, num_chains),</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>samples_array <span class="op">=</span> <span class="fu">stack</span>(<span class="fu">map</span>(<span class="bu">Base</span>.<span class="fu">Fix1</span>(stack, sample <span class="op">-&gt;</span> sample.x), samples))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000×4 Array{Float64, 3}:
[:, :, 1] =
 -3.5933   -4.80722  -4.33635  -4.33668   …  -5.52     -4.7273    -4.48597
 -2.34248  -3.19118  -1.49902  -0.678444     -1.21033  -0.875968   1.261
  1.12247   3.70298   3.35851   4.38928       5.11559   5.40915    6.23838

[:, :, 2] =
 -0.465628  -2.38311    -3.3167    …  -4.97621   -5.90647   -6.62591
 -0.308811  -0.0578718  -0.699348     -0.304827   0.914104   1.14265
  3.0456     3.42974     4.0569        4.76371    5.64285    6.30114

[:, :, 3] =
 -1.78666  -3.11396  -4.25585  -5.41856  …  -4.84652  -4.85079   -4.85079
  1.44284   1.07914   1.57127   1.33528     -1.16452  -0.575829  -0.575829
  2.15948   2.77722   4.22342   6.73025      3.39175   3.95307    3.95307

[:, :, 4] =
 -1.79928   -2.88842    -5.88519  …  -4.53839   -4.6785   -2.76398
  0.744593   0.0799775  -1.05054      0.326417   1.58588   0.698365
  2.39046    4.08083     6.52698      3.03836    3.31368   3.27694</code></pre>
</div>
</div>
<p>But the fact that we have to provide the <code>AbstractMCMC.sample</code> call, etc. with an <code>initial_state</code> to get started is a bit annoying. We can avoid this by also defining a <code>AbstractMCMC.step</code> <em>without</em> the <code>state</code> argument:</p>
<div id="36" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">::</span><span class="dt">MALA</span>;</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># </span><span class="al">NOTE</span><span class="co">: No state provided!</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just create the initial state by sampling using  a Gaussian.</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="fu">randn</span>(rng, LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(x), <span class="fu">MALAState</span>(x)</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Equipped with this, we no longer need to provide the <code>initial_state</code> everywhere:</p>
<div id="38" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -5.01439    1.00972
 -0.0261086  0.990868
  4.97596    1.02228</code></pre>
</div>
</div>
</section>
<section id="using-our-sampler-with-turing.jl" class="level2">
<h2 class="anchored" data-anchor-id="using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</h2>
<p>As we promised, all of this hassle of implementing our <code>MALA</code> sampler in a way that uses <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> and <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> gets us something more than <em>just</em> an “automatic” implementation of <code>AbstractMCMC.sample</code>.</p>
<p>It also enables use with Turing.jl through the <code>externalsampler</code>, but we need to do one final thing first: we need to tell Turing.jl how to extract a vector of parameters from the “sample” returned in our implementation of <code>AbstractMCMC.step</code>. In our case, the “sample” is a <code>MALASample</code>, so we just need the following line:</p>
<div id="40" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load Turing.jl.</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Turing</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Overload the `getparams` method for our "sample" type, which is just a vector.</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>Turing.Inference.<span class="fu">getparams</span>(<span class="op">::</span><span class="dt">Turing.Model</span>, sample<span class="op">::</span><span class="dt">MALASample</span>) <span class="op">=</span> sample.x</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And with that, we’re good to go!</p>
<div id="42" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Our previous model defined as a Turing.jl model.</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">mvnormal_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">MvNormal</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.], I)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate our model.</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">mvnormal_model</span>()</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Call `sample` but now we're passing in a Turing.jl `model` and wrapping</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co"># our `MALA` sampler in the `externalsampler` to tell Turing.jl that the sampler</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co"># expects something that implements LogDensityProblems.jl.</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×4×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 2.85 seconds
Compute duration  = 2.85 seconds
parameters        = x[1], x[2], x[3]
internals         = lp

Summary Statistics
  parameters      mean       std      mcse    ess_bulk    ess_tail      rhat   ⋯
      Symbol   Float64   Float64   Float64     Float64     Float64   Float64   ⋯

        x[1]   -4.9647    1.0147    0.0173   3446.1189   5203.1924    0.9999   ⋯
        x[2]   -0.0013    0.9913    0.0170   3413.9369   4757.6974    0.9999   ⋯
        x[3]    5.0079    1.0086    0.0169   3546.5096   5063.5816    1.0000   ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

        x[1]   -6.9482   -5.6616   -4.9596   -4.2627   -3.0099
        x[2]   -1.9094   -0.6756   -0.0110    0.6607    1.9588
        x[3]    3.0687    4.3257    5.0051    5.6703    7.0148</code></pre>
</div>
</div>
<p>Pretty neat, eh?</p>
<section id="models-with-constrained-parameters" class="level3">
<h3 class="anchored" data-anchor-id="models-with-constrained-parameters">Models with constrained parameters</h3>
<p>One thing we’ve sort of glossed over in all of the above is that MALA, at least how we’ve implemented it, requires <span class="math inline">\(x\)</span> to live in <span class="math inline">\(\mathbb{R}^d\)</span> for some <span class="math inline">\(d &gt; 0\)</span>. If some of the parameters were in fact constrained, e.g.&nbsp;we were working with a <code>Beta</code> distribution which has support on the interval <span class="math inline">\((0, 1)\)</span>, <em>not</em> on <span class="math inline">\(\mathbb{R}^d\)</span>, we could easily end up outside of the valid range <span class="math inline">\((0, 1)\)</span>.</p>
<div id="44" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">beta_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">beta_model</span>()</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 1.91 seconds
Compute duration  = 1.91 seconds
parameters        = x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse    ess_bulk    ess_tail      rhat   ⋯
      Symbol   Float64   Float64   Float64     Float64     Float64   Float64   ⋯

           x    0.4999    0.1908    0.0029   4312.4065   5547.1597    1.0001   ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

           x    0.1483    0.3563    0.4969    0.6447    0.8597</code></pre>
</div>
</div>
<p>Yep, that still works, but only because Turing.jl actually <em>transforms</em> the <code>turing_model</code> from constrained to unconstrained, so that the <code>sampler</code> provided to <code>externalsampler</code> is actually always working in unconstrained space! This is not always desirable, so we can turn this off:</p>
<div id="46" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 0.18 seconds
Compute duration  = 0.18 seconds
parameters        = x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse   ess_bulk   ess_tail      rhat   e ⋯
      Symbol   Float64   Float64   Float64    Float64    Float64   Float64     ⋯

           x    0.4982    0.1529    0.0131   106.3535    61.3541    1.0377     ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

           x    0.2490    0.3645    0.5051    0.6294    0.7633</code></pre>
</div>
</div>
<p>The fun thing is that this still sort of works because</p>
<div id="48" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">logpdf</span>(<span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>), <span class="fl">10.0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-Inf</code></pre>
</div>
</div>
<p>and so the samples that fall outside of the range are always rejected. But do notice how much worse all the diagnostics are, e.g.&nbsp;<code>ess_tail</code> is very poor compared to when we use <code>unconstrained=true</code>. Moreover, in more complex cases this won’t just result in a “nice” <code>-Inf</code> log-density value, but instead will error:</p>
<div id="50" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="kw">function</span> <span class="fu">demo</span>()</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>    σ² <span class="op">~</span> <span class="fu">truncated</span>(<span class="fu">Normal</span>(), lower<span class="op">=</span><span class="fl">0</span>)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If we end up with negative values for `σ²`, the `Normal` will error.</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>    x <span class="op">~</span> <span class="fu">Normal</span>(<span class="fl">0</span>, σ²)</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>DomainError: DomainError(Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}}(-0.0012728612583665644,1.0,0.0), "Normal: the condition σ &gt;= zero(σ) is not satisfied.")
DomainError with Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}}(-0.0012728612583665644,1.0,0.0):
Normal: the condition σ &gt;= zero(σ) is not satisfied.
Stacktrace:
  [1] #371
    @ ~/.julia/packages/Distributions/tQhJE/src/univariate/continuous/normal.jl:37 [inlined]
  [2] check_args
    @ ~/.julia/packages/Distributions/tQhJE/src/utils.jl:89 [inlined]
  [3] #Normal#370
    @ ~/.julia/packages/Distributions/tQhJE/src/univariate/continuous/normal.jl:37 [inlined]
  [4] Normal
    @ ~/.julia/packages/Distributions/tQhJE/src/univariate/continuous/normal.jl:36 [inlined]
  [5] Normal
    @ ~/.julia/packages/Distributions/tQhJE/src/univariate/continuous/normal.jl:42 [inlined]
  [6] macro expansion
    @ ~/.julia/packages/DynamicPPL/senfM/src/compiler.jl:584 [inlined]
  [7] demo(__model__::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, __varinfo__::DynamicPPL.ThreadSafeVarInfo{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}, Vector{Set{DynamicPPL.Selector}}}}, ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}, Vector{Base.RefValue{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}, __context__::DynamicPPL.DefaultContext)
    @ Main.Notebook ~/work/docs/docs/developers/inference/implementing-samplers/index.qmd:595
  [8] _evaluate!!
    @ ~/.julia/packages/DynamicPPL/senfM/src/model.jl:936 [inlined]
  [9] evaluate_threadsafe!!(model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, varinfo::DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}, Vector{Set{DynamicPPL.Selector}}}}, ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}, context::DynamicPPL.DefaultContext)
    @ DynamicPPL ~/.julia/packages/DynamicPPL/senfM/src/model.jl:925
 [10] evaluate!!
    @ ~/.julia/packages/DynamicPPL/senfM/src/model.jl:855 [inlined]
 [11] logdensity
    @ ~/.julia/packages/DynamicPPL/senfM/src/logdensityfunction.jl:140 [inlined]
 [12] Fix1
    @ ./operators.jl:1127 [inlined]
 [13] vector_mode_dual_eval!(f::Base.Fix1{typeof(LogDensityProblems.logdensity), LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, Nothing}}, cfg::ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}, x::Vector{Float64})
    @ ForwardDiff ~/.julia/packages/ForwardDiff/UBbGT/src/apiutils.jl:24
 [14] vector_mode_gradient!
    @ ~/.julia/packages/ForwardDiff/UBbGT/src/gradient.jl:98 [inlined]
 [15] gradient!(result::DiffResults.MutableDiffResult{1, Float64, Tuple{Vector{Float64}}}, f::Base.Fix1{typeof(LogDensityProblems.logdensity), LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, Nothing}}, x::Vector{Float64}, cfg::ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}, ::Val{true})
    @ ForwardDiff ~/.julia/packages/ForwardDiff/UBbGT/src/gradient.jl:39
 [16] gradient!
    @ ~/.julia/packages/ForwardDiff/UBbGT/src/gradient.jl:36 [inlined]
 [17] logdensity_and_gradient
    @ ~/.julia/packages/LogDensityProblemsAD/9uEsH/ext/LogDensityProblemsADForwardDiffExt.jl:116 [inlined]
 [18] leapfrog_step(model::LogDensityProblemsADForwardDiffExt.ForwardDiffLogDensity{LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, Nothing}, ForwardDiff.Chunk{2}, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}, x::Vector{Float64}, p::Vector{Float64}, ϵ::Int64, M::UniformScaling{Bool})
    @ Main.Notebook ~/work/docs/docs/developers/inference/implementing-samplers/index.qmd:371
 [19] step(rng::TaskLocalRNG, model_wrapper::AbstractMCMC.LogDensityModel{LogDensityProblemsADForwardDiffExt.ForwardDiffLogDensity{LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, Nothing}, ForwardDiff.Chunk{2}, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}}, sampler::MALA{Int64, UniformScaling{Bool}}, state::MALAState{Vector{Float64}}; kwargs::@Kwargs{})
    @ Main.Notebook ~/work/docs/docs/developers/inference/implementing-samplers/index.qmd:336
 [20] step
    @ ~/work/docs/docs/developers/inference/implementing-samplers/index.qmd:318 [inlined]
 [21] #step#27
    @ ~/.julia/packages/Turing/oFGEb/src/mcmc/abstractmcmc.jl:117 [inlined]
 [22] step(rng::TaskLocalRNG, model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, sampler_wrapper::DynamicPPL.Sampler{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}, state::Turing.Inference.TuringState{MALAState{Vector{Float64}}, LogDensityProblemsADForwardDiffExt.ForwardDiffLogDensity{LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, Nothing}, ForwardDiff.Chunk{2}, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}})
    @ Turing.Inference ~/.julia/packages/Turing/oFGEb/src/mcmc/abstractmcmc.jl:106
 [23] macro expansion
    @ ~/.julia/packages/AbstractMCMC/FSyVk/src/sample.jl:217 [inlined]
 [24] macro expansion
    @ ~/.julia/packages/AbstractMCMC/FSyVk/src/logging.jl:16 [inlined]
 [25] mcmcsample(rng::TaskLocalRNG, model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, sampler::DynamicPPL.Sampler{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}, N::Int64; progress::Bool, progressname::String, callback::Nothing, num_warmup::Int64, discard_initial::Int64, thinning::Int64, chain_type::Type, initial_state::Nothing, kwargs::@Kwargs{})
    @ AbstractMCMC ~/.julia/packages/AbstractMCMC/FSyVk/src/sample.jl:142
 [26] sample(rng::TaskLocalRNG, model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, sampler::DynamicPPL.Sampler{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}, N::Int64; chain_type::Type, resume_from::Nothing, initial_state::Nothing, kwargs::@Kwargs{progress::Bool})
    @ DynamicPPL ~/.julia/packages/DynamicPPL/senfM/src/sampler.jl:107
 [27] sample
    @ ~/.julia/packages/DynamicPPL/senfM/src/sampler.jl:97 [inlined]
 [28] #sample#6
    @ ~/.julia/packages/Turing/oFGEb/src/mcmc/Inference.jl:321 [inlined]
 [29] sample
    @ ~/.julia/packages/Turing/oFGEb/src/mcmc/Inference.jl:312 [inlined]
 [30] #sample#5
    @ ~/.julia/packages/Turing/oFGEb/src/mcmc/Inference.jl:309 [inlined]
 [31] top-level scope
    @ ~/work/docs/docs/developers/inference/implementing-samplers/index.qmd:597</code></pre>
</div>
</div>
<p>As expected, we run into a <code>DomainError</code> at some point, while if we set <code>unconstrained=true</code>, letting Turing.jl transform the model to a unconstrained form behind the scenes, everything works as expected:</p>
<div id="52" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 0.57 seconds
Compute duration  = 0.57 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse   ess_bulk   ess_tail      rhat   e ⋯
      Symbol   Float64   Float64   Float64    Float64    Float64   Float64     ⋯

          σ²    0.9135    0.6207    0.0320   342.0145   175.8267    1.0019     ⋯
           x   -0.0147    1.0762    0.0741   288.2410   225.6630    1.0012     ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

          σ²    0.1370    0.4298    0.7834    1.2446    2.5022
           x   -2.5848   -0.4689   -0.0123    0.4189    2.4702</code></pre>
</div>
</div>
<p>Neat!</p>
<p>Similarly, which automatic differentiation backend one should use can be specified through the <code>adtype</code> keyword argument too. For example, if we want to use <a href="https://github.com/JuliaDiff/ReverseDiff.jl">ReverseDiff.jl</a> instead of the default <a href="https://github.com/JuliaDiff/ForwardDiff.jl">ForwardDiff.jl</a>:</p>
<div id="54" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">ReverseDiff</span>: ReverseDiff</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify that we want to use `AutoReverseDiff`.</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">demo</span>(),</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>, adtype<span class="op">=</span><span class="fu">AutoReverseDiff</span>()),</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>;</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 3.62 seconds
Compute duration  = 3.62 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse   ess_bulk   ess_tail      rhat   e ⋯
      Symbol   Float64   Float64   Float64    Float64    Float64   Float64     ⋯

          σ²    0.8958    0.5653    0.0250   476.2331   324.8099    1.0052     ⋯
           x    0.0429    0.9946    0.0419   669.9802   430.7197    1.0019     ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

          σ²    0.1441    0.4521    0.7869    1.2408    2.1985
           x   -1.9672   -0.3893    0.0033    0.4315    2.3599</code></pre>
</div>
</div>
<p>Double-neat.</p>
</section>
</section>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<p>At this point it’s worth maybe reminding ourselves what we did and also <em>why</em> we did it:</p>
<ol type="1">
<li>We define our models in the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface because it makes the sampler agnostic to how the underlying model is implemented.</li>
<li>We implement our sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> interface, which just means that our sampler is a subtype of <code>AbstractMCMC.AbstractSampler</code> and we implement the MCMC transition in <code>AbstractMCMC.step</code>.</li>
<li>Points 1 and 2 makes it so our sampler can be used with a wide range of model implementations, amongst them being models implemented in both Turing.jl and Stan. This gives you, the inference implementer, a large collection of models to test your inference method on, in addition to allowing users of Turing.jl and Stan to try out your inference method with minimal effort.</li>
</ol>


</section>


<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a><div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>We’re going with the leapfrog formulation because in a future version of this tutorial we’ll add a section extending this simple “baseline” MALA sampler to more complex versions. See <a href="https://github.com/TuringLang/docs/issues/479">issue #479</a> for progress on this.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>There is no such thing as a proper interface in Julia (at least not officially), and so we use the word “interface” here to mean a few minimal methods that needs to be implemented by any type that we treat as a target model.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/turinglang\.org\/docs\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../../developers/inference/variational-inference/index.html" class="pagination-link" aria-label="Variational Inference">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Variational Inference</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Turing is created by <a href="http://mlg.eng.cam.ac.uk/hong/" target="_blank">Hong Ge</a>, and lovingly maintained by the <a href="https://github.com/TuringLang/Turing.jl/graphs/contributors" target="_blank">core team</a> of volunteers. <br> The contents of this website are © 2024 under the terms of the <a href="https://github.com/TuringLang/Turing.jl/blob/master/LICENCE" target="_blank">MIT License</a>.</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/TuringLang/docs/edit/master/developers/inference/implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/docs/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://x.com/TuringLang">
      <i class="bi bi-twitter" role="img" aria-label="Turing Twitter">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/TuringLang/Turing.jl">
      <i class="bi bi-github" role="img" aria-label="Turing GitHub">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




<script src="../../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>