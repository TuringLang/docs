<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Implementing samplers – Turing.jl</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../tutorials/docs-07-for-developers-variational-inference/index.html" rel="prev">
<link href="../../assets/favicon.ico" rel="icon">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<style>
  a {
    text-decoration: none;
  }
  a:hover {
    text-decoration: underline;
  }
</style>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../theming/styles.css">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="https://turinglang.org/" class="navbar-brand navbar-brand-logo">
    <img src="../../assets/images/turing-logo.svg" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="https://turinglang.org/">
    <span class="navbar-title">Turing.jl</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../tutorials/docs-00-getting-started/"> 
<span class="menu-text">Get Started</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../tutorials/00-introduction/"> 
<span class="menu-text">Tutorials</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/library/"> 
<span class="menu-text">Libraries</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/news/"> 
<span class="menu-text">News</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/team/"> 
<span class="menu-text">Team</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-v0.34" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">v0.34</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-v0.34">    
        <li>
    <a class="dropdown-item" href="https://turinglang.org/docs/changelog.html">
 <span class="dropdown-text">Changelog</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://turinglang.org/docs/versions.html">
 <span class="dropdown-text">All Versions</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
    <a href="https://x.com/TuringLang" title="Turing Twitter" class="quarto-navigation-tool px-1" aria-label="Turing Twitter"><i class="bi bi-twitter"></i></a>
    <a href="https://github.com/TuringLang/Turing.jl" title="Turing GitHub" class="quarto-navigation-tool px-1" aria-label="Turing GitHub"><i class="bi bi-github"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Documentation</li><li class="breadcrumb-item"><a href="../../tutorials/docs-04-for-developers-abstractmcmc-turing/index.html">Developers: Inference</a></li><li class="breadcrumb-item"><a href="../../tutorials/docs-17-implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Documentation</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false">
 <span class="menu-text">Using Turing - Modelling Syntax and Interface</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-00-getting-started/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Getting Started</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-14-using-turing-quick-start/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Quick Start</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-12-using-turing-guide/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Guide</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-17-mode-estimation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Mode Estimation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-09-using-turing-advanced/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Advanced Usage</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-10-using-turing-autodiff/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Automatic Differentiation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-13-using-turing-performance-tips/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Performance Tips</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-11-using-turing-dynamichmc/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using DynamicHMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-15-using-turing-sampler-viz/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Sampler Visualization</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-16-using-turing-external-samplers/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">External Samplers</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false">
 <span class="menu-text">Using Turing - Tutorials</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/00-introduction/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction to Turing</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/01-gaussian-mixture-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Mixture Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/02-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/03-bayesian-neural-network/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Neural Networks</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/04-hidden-markov-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Hidden Markov Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/05-linear-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Linear Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/06-infinite-mixture-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Infinite Mixture Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/07-poisson-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Poisson Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/08-multinomial-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Multinomial Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/09-variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/10-bayesian-differential-equations/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Differential Equations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/11-probabilistic-pca/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Probabilistic PCA</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/13-seasonal-time-series/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Time Series Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/15-gaussian-processes/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction to Gaussian Processes</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/12-gplvm/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Process Latent Variable Models</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false">
 <span class="menu-text">Developers: Contributing</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-01-contributing-guide/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">How to Contribute</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false">
 <span class="menu-text">Developers: PPL</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-05-for-developers-compiler/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Turing Compiler Design</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/14-minituring/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation I: Compiler</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/16-contexts/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation II: Contexts</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-06-for-developers-interface/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Interface Guide</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true">
 <span class="menu-text">Developers: Inference</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-04-for-developers-abstractmcmc-turing/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">How Turing implements AbstractMCMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-07-for-developers-variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-17-implementing-samplers/index.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Implementing Samplers</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of Contents</h2>
   
  <ul>
  <li><a href="#quick-overview-of-mala" id="toc-quick-overview-of-mala" class="nav-link active" data-scroll-target="#quick-overview-of-mala">Quick overview of MALA</a></li>
  <li><a href="#what-we-need-from-a-model-logdensityproblems.jl" id="toc-what-we-need-from-a-model-logdensityproblems.jl" class="nav-link" data-scroll-target="#what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: LogDensityProblems.jl</a></li>
  <li><a href="#implementing-mala-in-abstractmcmc.jl" id="toc-implementing-mala-in-abstractmcmc.jl" class="nav-link" data-scroll-target="#implementing-mala-in-abstractmcmc.jl">Implementing MALA in AbstractMCMC.jl</a></li>
  <li><a href="#using-our-sampler-with-turing.jl" id="toc-using-our-sampler-with-turing.jl" class="nav-link" data-scroll-target="#using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</a>
  <ul class="collapse">
  <li><a href="#models-with-constrained-parameters" id="toc-models-with-constrained-parameters" class="nav-link" data-scroll-target="#models-with-constrained-parameters">Models with constrained parameters</a></li>
  </ul></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/TuringLang/docs/edit/master/tutorials/docs-17-implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/docs/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Documentation</li><li class="breadcrumb-item"><a href="../../tutorials/docs-04-for-developers-abstractmcmc-turing/index.html">Developers: Inference</a></li><li class="breadcrumb-item"><a href="../../tutorials/docs-17-implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Implementing samplers</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>In this tutorial, we’ll go through step-by-step how to implement a “simple” sampler in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> in such a way that it can be easily applied to Turing.jl models.</p>
<p>In particular, we’re going to implement a version of <strong>Metropolis-adjusted Langevin (MALA)</strong>.</p>
<p>Note that we will implement this sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> framework, completely “ignoring” Turing.jl until the very end of the tutorial, at which point we’ll use a single line of code to make the resulting sampler available to Turing.jl. This is to really drive home the point that one can implement samplers in a way that is accessible to all of Turing.jl’s users without having to use Turing.jl yourself.</p>
<section id="quick-overview-of-mala" class="level2">
<h2 class="anchored" data-anchor-id="quick-overview-of-mala">Quick overview of MALA</h2>
<p>We can view MALA as a single step of the leapfrog intergrator with resampling of momentum <span class="math inline">\(p\)</span> at every step.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> To make that statement a bit more concrete, we first define the <em>extended</em> target <span class="math inline">\(\bar{\gamma}(x, p)\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\log \bar{\gamma}(x, p) \propto \log \gamma(x) + \log \gamma_{\mathcal{N}(0, M)}(p)
\end{equation*}\]</span></p>
<p>where <span class="math inline">\(\gamma_{\mathcal{N}(0, M)}\)</span> denotes the density for a zero-centered Gaussian with covariance matrix <span class="math inline">\(M\)</span>. We then consider targeting this joint distribution over both <span class="math inline">\(x\)</span> and <span class="math inline">\(p\)</span> as follows. First we define the map</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  L_{\epsilon}: \quad &amp; \mathbb{R}^d \times \mathbb{R}^d \to \mathbb{R}^d \times \mathbb{R}^d \\
  &amp; (x, p) \mapsto (\tilde{x}, \tilde{p}) := L_{\epsilon}(x, p)
\end{split}
\end{equation*}\]</span></p>
<p>as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p_{1 / 2} &amp;:= p + \frac{\epsilon}{2} \nabla \log \gamma(x) \\
  \tilde{x} &amp;:= x + \epsilon M^{-1} p_{1 /2 } \\
  p_1 &amp;:= p_{1 / 2} + \frac{\epsilon}{2} \nabla \log \gamma(\tilde{x}) \\
  \tilde{p} &amp;:= - p_1
\end{split}
\end{equation*}\]</span></p>
<p>This might be familiar for some readers as a single step of the Leapfrog integrator. We then define the MALA kernel as follows: given the current iterate <span class="math inline">\(x_i\)</span>, we sample the next iterate <span class="math inline">\(x_{i + 1}\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p &amp;\sim \mathcal{N}(0, M) \\
  (\tilde{x}, \tilde{p}) &amp;:= L_{\epsilon}(x_i, p) \\
  \alpha &amp;:= \min \left\{ 1, \frac{\bar{\gamma}(\tilde{x}, \tilde{p})}{\bar{\gamma}(x_i, p)} \right\} \\
  x_{i + 1} &amp;:=
  \begin{cases}
    \tilde{x} \quad &amp; \text{ with prob. } \alpha \\
    x_i       \quad &amp; \text{ with prob. } 1 - \alpha
  \end{cases}
\end{split}
\end{equation*}\]</span></p>
<p>i.e.&nbsp;we accept the proposal <span class="math inline">\(\tilde{x}\)</span> with probability <span class="math inline">\(\alpha\)</span> and reject it, thus sticking with our current iterate, with probability <span class="math inline">\(1 - \alpha\)</span>.</p>
</section>
<section id="what-we-need-from-a-model-logdensityproblems.jl" class="level2">
<h2 class="anchored" data-anchor-id="what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a></h2>
<p>There are a few things we need from the “target” / “model” / density that we want to sample from:</p>
<ol type="1">
<li>We need access to log-density <em>evaluations</em> <span class="math inline">\(\log \gamma(x)\)</span> so we can compute the acceptance ratio involving <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>We need access to log-density <em>gradients</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span> so we can compute the Leapfrog steps <span class="math inline">\(L_{\epsilon}(x, p)\)</span>.</li>
<li>We also need access to the “size” of the model so we can determine the size of <span class="math inline">\(M\)</span>.</li>
</ol>
<p>Luckily for us, there is a package called <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> which provides an interface for <em>exactly</em> this!</p>
<p>To demonstrate how one can implement the “<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface”<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> we will use a simple Gaussian model as an example:</p>
<div id="4" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblems</span>: LogDensityProblems;</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's define some type that represents the model.</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> IsotropicNormalModel{M<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"mean of the isotropic Gaussian"</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    mean<span class="op">::</span><span class="dt">M</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Specifies what input length the model expects.</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">dimension</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> <span class="fu">length</span>(model.mean)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Implementation of the log-density evaluation of the model.</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x<span class="op">::</span><span class="dt">AbstractVector{&lt;:Real}</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">-</span> <span class="fu">sum</span>(abs2, x <span class="op">.-</span> model.mean) <span class="op">/</span> <span class="fl">2</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This gives us all of the properties we want for our MALA sampler with the exception of the computation of the <em>gradient</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span>. There is the method <code>LogDensityProblems.logdensity_and_gradient</code> which should return a 2-tuple where the first entry is the evaluation of the logdensity <span class="math inline">\(\log \gamma(x)\)</span> and the second entry is the gradient <span class="math inline">\(\nabla \log \gamma(x)\)</span>.</p>
<p>There are two ways to “implement” this method: 1) we implement it by hand, which is feasible in the case of our <code>IsotropicNormalModel</code>, or b) we defer the implementation of this to a automatic differentiation backend.</p>
<p>To implement it by hand we can simply do</p>
<div id="6" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl that first-order, i.e. gradient information, is available.</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{1}</span>()</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Implement `logdensity_and_gradient`.</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    logγ_x <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="op">-</span>x <span class="op">.*</span> (x <span class="op">-</span> model.mean)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> logγ_x, ∇logγ_x</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s just try it out:</p>
<div id="8" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate the problem.</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> <span class="fu">IsotropicNormalModel</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.])</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create some example input that we can test on.</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>x_example <span class="op">=</span> <span class="fu">randn</span>(LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate!</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-28.386595365029173</code></pre>
</div>
</div>
<p>To defer it to an automatic differentiation backend, we can do</p>
<div id="10" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl we only have access to 0-th order information.</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{0}</span>()</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Use `LogDensityProblemsAD`'s `ADgradient` in combination with some AD backend to implement `logdensity_and_gradient`.</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblemsAD</span>, <span class="bu">ADTypes</span>, <span class="bu">ForwardDiff</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>model_with_grad <span class="op">=</span> <span class="fu">ADgradient</span>(<span class="fu">AutoForwardDiff</span>(), model)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model_with_grad, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-28.386595365029173</code></pre>
</div>
</div>
<p>We’ll continue with the second approach in this tutorial since this is typically what one does in practice, because there are better hobbies to spend time on than deriving gradients by hand.</p>
<p>At this point, one might wonder how we’re going to tie this back to Turing.jl in the end. Effectively, when working with inference methods that only require log-density evaluations and / or higher-order information of the log-density, Turing.jl actually converts the user-provided <code>Model</code> into an object implementing the above methods for <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>. As a result, most samplers provided by Turing.jl are actually implemented to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, enabling their use both <em>within</em> Turing.jl and <em>outside</em> of Turing.jl! Morever, there exists similar conversions for Stan through BridgeStan and Stan<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, which means that a sampler supporting the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface can easily be used on both Turing.jl <em>and</em> Stan models (in addition to user-provided models, as our <code>IsotropicNormalModel</code> above)!</p>
<p>Anyways, let’s move on to actually implementing the sampler.</p>
</section>
<section id="implementing-mala-in-abstractmcmc.jl" class="level2">
<h2 class="anchored" data-anchor-id="implementing-mala-in-abstractmcmc.jl">Implementing MALA in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a></h2>
<p>Now that we’ve established that a model implementing the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface provides us with all the information we need from <span class="math inline">\(\log \gamma(x)\)</span>, we can address the question: given an object that implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, how can we define a sampler for it?</p>
<p>We’re going to do this by making our sampler a sub-type of <code>AbstractMCMC.AbstractSampler</code> in addition to implementing a few methods from <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>. Why? Because it gets us <em>a lot</em> of functionality for free, as we will see later.</p>
<p>Moreover, <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> provides a very natural interface for MCMC algorithms.</p>
<p>First, we’ll define our <code>MALA</code> type</p>
<div id="12" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">AbstractMCMC</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALA{T,A} <span class="op">&lt;:</span><span class="dt"> AbstractMCMC.AbstractSampler</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"stepsize used in the leapfrog step"</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    ϵ_init<span class="op">::</span><span class="dt">T</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"covariance matrix used for the momentum"</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    M_init<span class="op">::</span><span class="dt">A</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notice how we’ve added the suffix <code>_init</code> to both the stepsize and the covariance matrix. We’ve done this because a <code>AbstractMCMC.AbstractSampler</code> should be <em>immutable</em>. Of course there might be many scenarios where we want to allow something like the stepsize and / or the covariance matrix to vary between iterations, e.g.&nbsp;during the burn-in / adaptation phase of the sampling process we might want to adjust the parameters using statistics computed from these initial iterations. But information which can change between iterations <em>should not go in the sampler itself</em>! Instead, this information should go in the sampler <em>state</em>.</p>
<p>The sampler state should at the very least contain all the necessary information to perform the next MCMC iteration, but usually contains further information, e.g.&nbsp;quantities and statistics useful for evaluating whether the sampler has converged.</p>
<p>We will use the following sampler state for our <code>MALA</code> sampler:</p>
<div id="14" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALAState{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This might seem overly redundant: we’re defining a type <code>MALAState</code> and it only contains a simple vector of reals. In this particular case we indeed could have dropped this and simply used a <code>AbstractVector{&lt;:Real}</code> as our sampler state, but typically, as we will see later, one wants to include other quantities in the sampler state. For example, if we also wanted to adapt the parameters of our <code>MALA</code>, e.g.&nbsp;alter the stepsize depending on acceptance rates, in which case we should also put <code>ϵ</code> in the state, but for now we’ll keep things simple.</p>
<p>Moreover, we also want a <em>sample</em> type, which is a type meant for “public consumption”, i.e.&nbsp;the end-user. This is generally going to contain a subset of the information present in the state. But in such a simple scenario as this, we similarly only have a <code>AbstractVector{&lt;:Real}</code>:</p>
<div id="16" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALASample{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We currently have three things:</p>
<ol type="1">
<li>A <code>AbstractMCMC.AbstractSampler</code> implementation called <code>MALA</code>.</li>
<li>A state <code>MALAState</code> for our sampler <code>MALA</code>.</li>
<li>A sample <code>MALASample</code> for our sampler <code>MALA</code>.</li>
</ol>
<p>That means that we’re ready to implement the only thing that really matters: <code>AbstractMCMC.step</code>.</p>
<p><code>AbstractMCMC.step</code> defines the MCMC iteration of our <code>MALA</code> given the current <code>MALAState</code>. Specifically, the signature of the function is as follows:</p>
<div id="18" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The RNG to ensure reproducibility.</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The model that defines our target.</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.AbstractModel</span>,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The sampler for which we're taking a `step`.</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">AbstractMCMC.AbstractSampler</span>,</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The current sampler `state`.</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    state;</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Additional keyword arguments that we may or may not need.</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Moreover, there is a specific <code>AbstractMCMC.AbstractModel</code> which is used to indicate that the model that is provided implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface: <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Since, as we discussed earlier, in our case we’re indeed going to work with types that support the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, we’ll define <code>AbstractMCMC.step</code> for such a <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Note that <code>AbstractMCMC.LogDensityModel</code> has no other purpose; it has a single field called <code>logdensity</code>, and it does nothing else. But by wrapping the model in <code>AbstractMCMC.LogDensityModel</code>, it allows samplers that want to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> to define their <code>AbstractMCMC.step</code> on this type without running into method ambiguities.</p>
<p>All in all, that means that the signature for our <code>AbstractMCMC.step</code> is going to be the following:</p>
<div id="20" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># `LogDensityModel` so we know we're working with LogDensityProblems.jl model.</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler.</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler state.</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Great! Now let’s actually implement the full <code>AbstractMCMC.step</code> for our <code>MALA</code>.</p>
<p>Let’s remind ourselves what we’re going to do:</p>
<ol type="1">
<li>Sample a new momentum <span class="math inline">\(p\)</span>.</li>
<li>Compute the log-density of the extended target <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>Take a single leapfrog step <span class="math inline">\((\tilde{x}, \tilde{p}) = L_{\epsilon}(x, p)\)</span>.</li>
<li>Accept or reject the proposed <span class="math inline">\((\tilde{x}, \tilde{p})\)</span>.</li>
</ol>
<p>All in all, this results in the following:</p>
<div id="22" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>: Random</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Distributions</span>  <span class="co"># so we get the `MvNormal`</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the wrapped model which implements LogDensityProblems.jl.</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just extract the sampler parameters to make our lives easier.</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    ϵ <span class="op">=</span> sampler.ϵ_init</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    M <span class="op">=</span> sampler.M_init</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the current parameters.</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> state.x</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sample the momentum.</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>    p_dist <span class="op">=</span> <span class="fu">MvNormal</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)), M)</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> <span class="fu">rand</span>(rng, p_dist)</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Propose using a single leapfrog step.</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>    x̃, p̃ <span class="op">=</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Accept or reject proposal.</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>    logp <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p)</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>    logp̃ <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x̃) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p̃)</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>    logα <span class="op">=</span> logp̃ <span class="op">-</span> logp</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>    state_new <span class="op">=</span> <span class="cf">if</span> <span class="fu">log</span>(<span class="fu">rand</span>(rng)) <span class="op">&lt;</span> logα</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Accept.</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x̃)</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Reject.</span></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x)</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return the "sample" and the sampler state.</span></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(state_new.x), state_new</span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Fairly straight-forward.</p>
<p>Of course, we haven’t defined the <code>leapfrog_step</code> method yet, so let’s do that:</p>
<div id="24" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p` using "position" `x`.</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x))</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    p1 <span class="op">=</span> p <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update the "position" `x` using momentum `p1`.</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    x̃ <span class="op">=</span> x <span class="op">+</span> ϵ <span class="op">.*</span> (M <span class="op">\</span> p1)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p1` using position `x̃`</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x̃ <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x̃))</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    p2 <span class="op">=</span> p1 <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x̃</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Flip momentum `p2`.</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    p̃ <span class="op">=</span> <span class="op">-</span>p2</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x̃, p̃</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>leapfrog_step (generic function with 1 method)</code></pre>
</div>
</div>
<p>With all of this, we’re technically ready to sample!</p>
<div id="26" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>, <span class="bu">LinearAlgebra</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>rng <span class="op">=</span> <span class="bu">Random</span>.<span class="fu">default_rng</span>()</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>sampler <span class="op">=</span> <span class="fu">MALA</span>(<span class="fl">1</span>, I)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>state <span class="op">=</span> <span class="fu">MALAState</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)))</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>x_next, state_next <span class="op">=</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    rng,</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    AbstractMCMC.<span class="fu">LogDensityModel</span>(model),</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    state</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>(MALASample{Vector{Float64}}([-0.41989839794524886, -0.4003599581825806, 0.971060608735984]), MALAState{Vector{Float64}}([-0.41989839794524886, -0.4003599581825806, 0.971060608735984]))</code></pre>
</div>
</div>
<p>Great, it works!</p>
<p>And I promised we would get quite some functionality for free if we implemented <code>AbstractMCMC.step</code>, and so we can now simply call <code>sample</code> to perform standard MCMC sampling:</p>
<div id="28" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform 1000 iterations with our `MALA` sampler.</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; initial_state<span class="op">=</span>state, progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Concatenate into a matrix.</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000 Matrix{Float64}:
 -4.14069   -4.99629   -2.619     …  -4.80409    -5.55892   -4.16862
 -0.707084  -0.758073  -0.657803      0.0169896   0.329993  -0.59991
  2.26419    3.91898    5.77883       4.54635     4.01987    4.85557</code></pre>
</div>
</div>
<div id="30" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the marginal means and standard deviations.</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -4.97538  0.999248
  0.02837  1.00174
  5.00065  0.997155</code></pre>
</div>
</div>
<p>Let’s visualize the samples</p>
<div id="32" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">StatsPlots</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">transpose</span>(samples_matrix[<span class="op">:</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">:</span><span class="kw">end</span>]), alpha<span class="op">=</span><span class="fl">0.5</span>, legend<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<!--?xml version="1.0" encoding="utf-8"?-->
<svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" width="672" height="480" viewbox="0 0 2688 1920">
<defs>
  <clippath id="clip530">
    <rect x="0" y="0" width="2688" height="1920"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip530)" d="M0 1920 L2688 1920 L2688 0 L0 0  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip531">
    <rect x="537" y="0" width="1883" height="1883"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip530)" d="M151.747 1800.78 L2640.76 1800.78 L2640.76 47.2441 L151.747 47.2441  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip532">
    <rect x="151" y="47" width="2490" height="1755"></rect>
  </clippath>
</defs>
<polyline clip-path="url(#clip532)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="219.84,1800.78 219.84,47.2441 "></polyline>
<polyline clip-path="url(#clip532)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="807.458,1800.78 807.458,47.2441 "></polyline>
<polyline clip-path="url(#clip532)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1395.08,1800.78 1395.08,47.2441 "></polyline>
<polyline clip-path="url(#clip532)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1982.69,1800.78 1982.69,47.2441 "></polyline>
<polyline clip-path="url(#clip532)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="2570.31,1800.78 2570.31,47.2441 "></polyline>
<polyline clip-path="url(#clip532)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,1499.11 2640.76,1499.11 "></polyline>
<polyline clip-path="url(#clip532)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,1193.78 2640.76,1193.78 "></polyline>
<polyline clip-path="url(#clip532)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,888.451 2640.76,888.451 "></polyline>
<polyline clip-path="url(#clip532)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,583.122 2640.76,583.122 "></polyline>
<polyline clip-path="url(#clip532)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,277.794 2640.76,277.794 "></polyline>
<polyline clip-path="url(#clip530)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1800.78 2640.76,1800.78 "></polyline>
<polyline clip-path="url(#clip530)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="219.84,1800.78 219.84,1781.88 "></polyline>
<polyline clip-path="url(#clip530)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="807.458,1800.78 807.458,1781.88 "></polyline>
<polyline clip-path="url(#clip530)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1395.08,1800.78 1395.08,1781.88 "></polyline>
<polyline clip-path="url(#clip530)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1982.69,1800.78 1982.69,1781.88 "></polyline>
<polyline clip-path="url(#clip530)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="2570.31,1800.78 2570.31,1781.88 "></polyline>
<path clip-path="url(#clip530)" d="M219.84 1834 Q216.229 1834 214.4 1837.57 Q212.595 1841.11 212.595 1848.24 Q212.595 1855.34 214.4 1858.91 Q216.229 1862.45 219.84 1862.45 Q223.474 1862.45 225.28 1858.91 Q227.108 1855.34 227.108 1848.24 Q227.108 1841.11 225.28 1837.57 Q223.474 1834 219.84 1834 M219.84 1830.3 Q225.65 1830.3 228.706 1834.9 Q231.784 1839.49 231.784 1848.24 Q231.784 1856.96 228.706 1861.57 Q225.65 1866.15 219.84 1866.15 Q214.03 1866.15 210.951 1861.57 Q207.896 1856.96 207.896 1848.24 Q207.896 1839.49 210.951 1834.9 Q214.03 1830.3 219.84 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip530)" d="M771.15 1861.55 L787.47 1861.55 L787.47 1865.48 L765.525 1865.48 L765.525 1861.55 Q768.187 1858.79 772.771 1854.16 Q777.377 1849.51 778.558 1848.17 Q780.803 1845.65 781.683 1843.91 Q782.585 1842.15 782.585 1840.46 Q782.585 1837.71 780.641 1835.97 Q778.72 1834.23 775.618 1834.23 Q773.419 1834.23 770.965 1835 Q768.535 1835.76 765.757 1837.31 L765.757 1832.59 Q768.581 1831.46 771.035 1830.88 Q773.488 1830.3 775.525 1830.3 Q780.896 1830.3 784.09 1832.98 Q787.285 1835.67 787.285 1840.16 Q787.285 1842.29 786.474 1844.21 Q785.687 1846.11 783.581 1848.7 Q783.002 1849.37 779.9 1852.59 Q776.798 1855.78 771.15 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip530)" d="M797.331 1830.92 L815.687 1830.92 L815.687 1834.86 L801.613 1834.86 L801.613 1843.33 Q802.632 1842.98 803.65 1842.82 Q804.669 1842.64 805.687 1842.64 Q811.474 1842.64 814.854 1845.81 Q818.233 1848.98 818.233 1854.4 Q818.233 1859.97 814.761 1863.08 Q811.289 1866.15 804.97 1866.15 Q802.794 1866.15 800.525 1865.78 Q798.28 1865.41 795.872 1864.67 L795.872 1859.97 Q797.956 1861.11 800.178 1861.66 Q802.4 1862.22 804.877 1862.22 Q808.882 1862.22 811.22 1860.11 Q813.558 1858.01 813.558 1854.4 Q813.558 1850.78 811.22 1848.68 Q808.882 1846.57 804.877 1846.57 Q803.002 1846.57 801.127 1846.99 Q799.275 1847.4 797.331 1848.28 L797.331 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip530)" d="M837.446 1834 Q833.835 1834 832.007 1837.57 Q830.201 1841.11 830.201 1848.24 Q830.201 1855.34 832.007 1858.91 Q833.835 1862.45 837.446 1862.45 Q841.081 1862.45 842.886 1858.91 Q844.715 1855.34 844.715 1848.24 Q844.715 1841.11 842.886 1837.57 Q841.081 1834 837.446 1834 M837.446 1830.3 Q843.256 1830.3 846.312 1834.9 Q849.391 1839.49 849.391 1848.24 Q849.391 1856.96 846.312 1861.57 Q843.256 1866.15 837.446 1866.15 Q831.636 1866.15 828.557 1861.57 Q825.502 1856.96 825.502 1848.24 Q825.502 1839.49 828.557 1834.9 Q831.636 1830.3 837.446 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip530)" d="M1354.69 1830.92 L1373.05 1830.92 L1373.05 1834.86 L1358.98 1834.86 L1358.98 1843.33 Q1360 1842.98 1361.01 1842.82 Q1362.03 1842.64 1363.05 1842.64 Q1368.84 1842.64 1372.22 1845.81 Q1375.6 1848.98 1375.6 1854.4 Q1375.6 1859.97 1372.12 1863.08 Q1368.65 1866.15 1362.33 1866.15 Q1360.16 1866.15 1357.89 1865.78 Q1355.64 1865.41 1353.24 1864.67 L1353.24 1859.97 Q1355.32 1861.11 1357.54 1861.66 Q1359.76 1862.22 1362.24 1862.22 Q1366.25 1862.22 1368.58 1860.11 Q1370.92 1858.01 1370.92 1854.4 Q1370.92 1850.78 1368.58 1848.68 Q1366.25 1846.57 1362.24 1846.57 Q1360.37 1846.57 1358.49 1846.99 Q1356.64 1847.4 1354.69 1848.28 L1354.69 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip530)" d="M1394.81 1834 Q1391.2 1834 1389.37 1837.57 Q1387.56 1841.11 1387.56 1848.24 Q1387.56 1855.34 1389.37 1858.91 Q1391.2 1862.45 1394.81 1862.45 Q1398.44 1862.45 1400.25 1858.91 Q1402.08 1855.34 1402.08 1848.24 Q1402.08 1841.11 1400.25 1837.57 Q1398.44 1834 1394.81 1834 M1394.81 1830.3 Q1400.62 1830.3 1403.68 1834.9 Q1406.75 1839.49 1406.75 1848.24 Q1406.75 1856.96 1403.68 1861.57 Q1400.62 1866.15 1394.81 1866.15 Q1389 1866.15 1385.92 1861.57 Q1382.87 1856.96 1382.87 1848.24 Q1382.87 1839.49 1385.92 1834.9 Q1389 1830.3 1394.81 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip530)" d="M1424.97 1834 Q1421.36 1834 1419.53 1837.57 Q1417.73 1841.11 1417.73 1848.24 Q1417.73 1855.34 1419.53 1858.91 Q1421.36 1862.45 1424.97 1862.45 Q1428.61 1862.45 1430.41 1858.91 Q1432.24 1855.34 1432.24 1848.24 Q1432.24 1841.11 1430.41 1837.57 Q1428.61 1834 1424.97 1834 M1424.97 1830.3 Q1430.78 1830.3 1433.84 1834.9 Q1436.92 1839.49 1436.92 1848.24 Q1436.92 1856.96 1433.84 1861.57 Q1430.78 1866.15 1424.97 1866.15 Q1419.16 1866.15 1416.08 1861.57 Q1413.03 1856.96 1413.03 1848.24 Q1413.03 1839.49 1416.08 1834.9 Q1419.16 1830.3 1424.97 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip530)" d="M1940.97 1830.92 L1963.19 1830.92 L1963.19 1832.91 L1950.65 1865.48 L1945.76 1865.48 L1957.57 1834.86 L1940.97 1834.86 L1940.97 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip530)" d="M1972.36 1830.92 L1990.71 1830.92 L1990.71 1834.86 L1976.64 1834.86 L1976.64 1843.33 Q1977.66 1842.98 1978.68 1842.82 Q1979.7 1842.64 1980.72 1842.64 Q1986.5 1842.64 1989.88 1845.81 Q1993.26 1848.98 1993.26 1854.4 Q1993.26 1859.97 1989.79 1863.08 Q1986.32 1866.15 1980 1866.15 Q1977.82 1866.15 1975.55 1865.78 Q1973.31 1865.41 1970.9 1864.67 L1970.9 1859.97 Q1972.98 1861.11 1975.21 1861.66 Q1977.43 1862.22 1979.9 1862.22 Q1983.91 1862.22 1986.25 1860.11 Q1988.59 1858.01 1988.59 1854.4 Q1988.59 1850.78 1986.25 1848.68 Q1983.91 1846.57 1979.9 1846.57 Q1978.03 1846.57 1976.15 1846.99 Q1974.3 1847.4 1972.36 1848.28 L1972.36 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip530)" d="M2012.47 1834 Q2008.86 1834 2007.03 1837.57 Q2005.23 1841.11 2005.23 1848.24 Q2005.23 1855.34 2007.03 1858.91 Q2008.86 1862.45 2012.47 1862.45 Q2016.11 1862.45 2017.91 1858.91 Q2019.74 1855.34 2019.74 1848.24 Q2019.74 1841.11 2017.91 1837.57 Q2016.11 1834 2012.47 1834 M2012.47 1830.3 Q2018.28 1830.3 2021.34 1834.9 Q2024.42 1839.49 2024.42 1848.24 Q2024.42 1856.96 2021.34 1861.57 Q2018.28 1866.15 2012.47 1866.15 Q2006.66 1866.15 2003.59 1861.57 Q2000.53 1856.96 2000.53 1848.24 Q2000.53 1839.49 2003.59 1834.9 Q2006.66 1830.3 2012.47 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip530)" d="M2514.84 1861.55 L2522.48 1861.55 L2522.48 1835.18 L2514.17 1836.85 L2514.17 1832.59 L2522.43 1830.92 L2527.11 1830.92 L2527.11 1861.55 L2534.75 1861.55 L2534.75 1865.48 L2514.84 1865.48 L2514.84 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip530)" d="M2554.19 1834 Q2550.58 1834 2548.75 1837.57 Q2546.94 1841.11 2546.94 1848.24 Q2546.94 1855.34 2548.75 1858.91 Q2550.58 1862.45 2554.19 1862.45 Q2557.82 1862.45 2559.63 1858.91 Q2561.46 1855.34 2561.46 1848.24 Q2561.46 1841.11 2559.63 1837.57 Q2557.82 1834 2554.19 1834 M2554.19 1830.3 Q2560 1830.3 2563.06 1834.9 Q2566.13 1839.49 2566.13 1848.24 Q2566.13 1856.96 2563.06 1861.57 Q2560 1866.15 2554.19 1866.15 Q2548.38 1866.15 2545.3 1861.57 Q2542.25 1856.96 2542.25 1848.24 Q2542.25 1839.49 2545.3 1834.9 Q2548.38 1830.3 2554.19 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip530)" d="M2584.35 1834 Q2580.74 1834 2578.91 1837.57 Q2577.11 1841.11 2577.11 1848.24 Q2577.11 1855.34 2578.91 1858.91 Q2580.74 1862.45 2584.35 1862.45 Q2587.99 1862.45 2589.79 1858.91 Q2591.62 1855.34 2591.62 1848.24 Q2591.62 1841.11 2589.79 1837.57 Q2587.99 1834 2584.35 1834 M2584.35 1830.3 Q2590.16 1830.3 2593.22 1834.9 Q2596.3 1839.49 2596.3 1848.24 Q2596.3 1856.96 2593.22 1861.57 Q2590.16 1866.15 2584.35 1866.15 Q2578.54 1866.15 2575.46 1861.57 Q2572.41 1856.96 2572.41 1848.24 Q2572.41 1839.49 2575.46 1834.9 Q2578.54 1830.3 2584.35 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip530)" d="M2614.51 1834 Q2610.9 1834 2609.07 1837.57 Q2607.27 1841.11 2607.27 1848.24 Q2607.27 1855.34 2609.07 1858.91 Q2610.9 1862.45 2614.51 1862.45 Q2618.15 1862.45 2619.95 1858.91 Q2621.78 1855.34 2621.78 1848.24 Q2621.78 1841.11 2619.95 1837.57 Q2618.15 1834 2614.51 1834 M2614.51 1830.3 Q2620.32 1830.3 2623.38 1834.9 Q2626.46 1839.49 2626.46 1848.24 Q2626.46 1856.96 2623.38 1861.57 Q2620.32 1866.15 2614.51 1866.15 Q2608.7 1866.15 2605.62 1861.57 Q2602.57 1856.96 2602.57 1848.24 Q2602.57 1839.49 2605.62 1834.9 Q2608.7 1830.3 2614.51 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip530)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1800.78 151.747,47.2441 "></polyline>
<polyline clip-path="url(#clip530)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1499.11 170.644,1499.11 "></polyline>
<polyline clip-path="url(#clip530)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1193.78 170.644,1193.78 "></polyline>
<polyline clip-path="url(#clip530)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,888.451 170.644,888.451 "></polyline>
<polyline clip-path="url(#clip530)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,583.122 170.644,583.122 "></polyline>
<polyline clip-path="url(#clip530)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,277.794 170.644,277.794 "></polyline>
<path clip-path="url(#clip530)" d="M49.5521 1499.56 L79.2279 1499.56 L79.2279 1503.49 L49.5521 1503.49 L49.5521 1499.56 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip530)" d="M99.8991 1497.24 Q96.7509 1497.24 94.8991 1499.4 Q93.0704 1501.55 93.0704 1505.3 Q93.0704 1509.03 94.8991 1511.2 Q96.7509 1513.36 99.8991 1513.36 Q103.047 1513.36 104.876 1511.2 Q106.728 1509.03 106.728 1505.3 Q106.728 1501.55 104.876 1499.4 Q103.047 1497.24 99.8991 1497.24 M109.181 1482.59 L109.181 1486.85 Q107.422 1486.02 105.617 1485.58 Q103.834 1485.14 102.075 1485.14 Q97.4454 1485.14 94.9917 1488.26 Q92.5612 1491.39 92.2139 1497.71 Q93.5797 1495.69 95.6398 1494.63 Q97.7 1493.54 100.177 1493.54 Q105.385 1493.54 108.394 1496.71 Q111.427 1499.86 111.427 1505.3 Q111.427 1510.62 108.279 1513.84 Q105.131 1517.06 99.8991 1517.06 Q93.9037 1517.06 90.7325 1512.48 Q87.5612 1507.87 87.5612 1499.14 Q87.5612 1490.95 91.45 1486.09 Q95.3389 1481.2 101.89 1481.2 Q103.649 1481.2 105.431 1481.55 Q107.237 1481.9 109.181 1482.59 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip530)" d="M50.3623 1194.23 L80.0381 1194.23 L80.0381 1198.17 L50.3623 1198.17 L50.3623 1194.23 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip530)" d="M104.297 1192.43 Q107.654 1193.14 109.529 1195.41 Q111.427 1197.68 111.427 1201.01 Q111.427 1206.13 107.908 1208.93 Q104.39 1211.73 97.9083 1211.73 Q95.7324 1211.73 93.4176 1211.29 Q91.126 1210.87 88.6723 1210.02 L88.6723 1205.5 Q90.6167 1206.64 92.9315 1207.22 Q95.2463 1207.8 97.7695 1207.8 Q102.168 1207.8 104.459 1206.06 Q106.774 1204.32 106.774 1201.01 Q106.774 1197.96 104.621 1196.24 Q102.492 1194.51 98.6722 1194.51 L94.6445 1194.51 L94.6445 1190.67 L98.8574 1190.67 Q102.306 1190.67 104.135 1189.3 Q105.964 1187.91 105.964 1185.32 Q105.964 1182.66 104.066 1181.24 Q102.191 1179.81 98.6722 1179.81 Q96.7509 1179.81 94.5519 1180.23 Q92.3528 1180.64 89.7139 1181.52 L89.7139 1177.36 Q92.376 1176.61 94.6908 1176.24 Q97.0287 1175.87 99.0889 1175.87 Q104.413 1175.87 107.515 1178.3 Q110.617 1180.71 110.617 1184.83 Q110.617 1187.7 108.973 1189.69 Q107.33 1191.66 104.297 1192.43 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip530)" d="M99.4824 874.25 Q95.8713 874.25 94.0426 877.814 Q92.2371 881.356 92.2371 888.486 Q92.2371 895.592 94.0426 899.157 Q95.8713 902.698 99.4824 902.698 Q103.117 902.698 104.922 899.157 Q106.751 895.592 106.751 888.486 Q106.751 881.356 104.922 877.814 Q103.117 874.25 99.4824 874.25 M99.4824 870.546 Q105.293 870.546 108.348 875.152 Q111.427 879.736 111.427 888.486 Q111.427 897.212 108.348 901.819 Q105.293 906.402 99.4824 906.402 Q93.6723 906.402 90.5936 901.819 Q87.538 897.212 87.538 888.486 Q87.538 879.736 90.5936 875.152 Q93.6723 870.546 99.4824 870.546 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip530)" d="M104.297 581.768 Q107.654 582.486 109.529 584.754 Q111.427 587.023 111.427 590.356 Q111.427 595.472 107.908 598.273 Q104.39 601.074 97.9083 601.074 Q95.7324 601.074 93.4176 600.634 Q91.126 600.217 88.6723 599.361 L88.6723 594.847 Q90.6167 595.981 92.9315 596.56 Q95.2463 597.139 97.7695 597.139 Q102.168 597.139 104.459 595.402 Q106.774 593.666 106.774 590.356 Q106.774 587.301 104.621 585.588 Q102.492 583.852 98.6722 583.852 L94.6445 583.852 L94.6445 580.009 L98.8574 580.009 Q102.306 580.009 104.135 578.643 Q105.964 577.254 105.964 574.662 Q105.964 572 104.066 570.588 Q102.191 569.153 98.6722 569.153 Q96.7509 569.153 94.5519 569.569 Q92.3528 569.986 89.7139 570.866 L89.7139 566.699 Q92.376 565.958 94.6908 565.588 Q97.0287 565.217 99.0889 565.217 Q104.413 565.217 107.515 567.648 Q110.617 570.055 110.617 574.176 Q110.617 577.046 108.973 579.037 Q107.33 581.004 104.297 581.768 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip530)" d="M99.8991 275.931 Q96.7509 275.931 94.8991 278.083 Q93.0704 280.236 93.0704 283.986 Q93.0704 287.713 94.8991 289.889 Q96.7509 292.042 99.8991 292.042 Q103.047 292.042 104.876 289.889 Q106.728 287.713 106.728 283.986 Q106.728 280.236 104.876 278.083 Q103.047 275.931 99.8991 275.931 M109.181 261.278 L109.181 265.537 Q107.422 264.704 105.617 264.264 Q103.834 263.824 102.075 263.824 Q97.4454 263.824 94.9917 266.949 Q92.5612 270.074 92.2139 276.394 Q93.5797 274.38 95.6398 273.315 Q97.7 272.227 100.177 272.227 Q105.385 272.227 108.394 275.398 Q111.427 278.546 111.427 283.986 Q111.427 289.31 108.279 292.528 Q105.131 295.745 99.8991 295.745 Q93.9037 295.745 90.7325 291.162 Q87.5612 286.556 87.5612 277.829 Q87.5612 269.634 91.45 264.773 Q95.3389 259.889 101.89 259.889 Q103.649 259.889 105.431 260.236 Q107.237 260.584 109.181 261.278 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip532)" style="stroke:#009af9; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,1309.87 224.541,1595.39 226.891,1286.67 229.242,1470.38 231.592,1392.05 233.943,1251.29 236.293,1613.58 238.644,1408.91 240.994,1358.37 243.345,1401.29 245.695,1173.01 248.046,1249.39 250.396,1391.52 252.747,1364.81 255.097,1464.29 257.448,1192.08 259.798,1349.55 262.148,1436.92 264.499,1295.53 266.849,1281.87 269.2,1254 271.55,1430.15 273.901,1401.43 276.251,1381.67 278.602,1439.28 280.952,1227.68 283.303,1272.15 285.653,1473.19 288.004,1335.42 290.354,1366.85 292.705,1421.26 295.055,1534.15 297.406,1554.86 299.756,1430.24 302.107,1276.4 304.457,1385.98 306.807,1364.32 309.158,1551.42 311.508,1343.2 313.859,1558.17 316.209,1335.68 318.56,1390.16 320.91,1287.75 323.261,1349.12 325.611,1516.39 327.962,1360.66 330.312,1327.49 332.663,1421.38 335.013,1363.25 337.364,1434.01 339.714,1131.7 342.065,1524.72 344.415,1485.87 346.765,1420.77 349.116,1439.58 351.466,1418.78 353.817,1430.42 356.167,1485.43 358.518,1533.24 360.868,1230.42 363.219,1383.98 365.569,1335.85 367.92,1311.37 370.27,1557.21 372.621,1247.51 374.971,1397.58 377.322,1279.96 379.672,1355.88 382.023,1583.96 384.373,1317.86 386.724,1298.66 389.074,1283.35 391.424,1287.33 393.775,1427.18 396.125,1318.44 398.476,1494.88 400.826,1444.19 403.177,1294.72 405.527,1351.93 407.878,1432.45 410.228,1441.63 412.579,1556.62 414.929,1371.62 417.28,1353.29 419.63,1343.6 421.981,1422.23 424.331,1333.62 426.682,1237.58 429.032,1330.42 431.382,1480.18 433.733,1364.14 436.083,1352.29 438.434,1343.59 440.784,1514.85 443.135,1494.21 445.485,1411.63 447.836,1421.05 450.186,1448.43 452.537,1364.05 454.887,1359.71 457.238,1328.84 459.588,1336.47 461.939,1313.52 464.289,1398.23 466.64,1390.77 468.99,1380.94 471.341,1432.84 473.691,1338.29 476.041,1259.48 478.392,1392.29 480.742,1422.93 483.093,1584.71 485.443,1571.32 487.794,1416.54 490.144,1471.14 492.495,1290.85 494.845,1340.28 497.196,1391.06 499.546,1372.98 501.897,1252.68 504.247,1420.25 506.598,1195.43 508.948,1354.44 511.299,1412.19 513.649,1496.57 515.999,1349.54 518.35,1502.25 520.7,1391.17 523.051,1415.67 525.401,1538.79 527.752,1244.1 530.102,1366.35 532.453,1459.03 534.803,1526.29 537.154,1494.27 539.504,1413.22 541.855,1520.41 544.205,1436.15 546.556,1389.6 548.906,1437 551.257,1368.82 553.607,1323.1 555.958,1399.87 558.308,1436.59 560.658,1495.18 563.009,1345.49 565.359,1405.18 567.71,1513.42 570.06,1550.36 572.411,1442.8 574.761,1585.13 577.112,1277.94 579.462,1574.66 581.813,1229.95 584.163,1375.72 586.514,1501.23 588.864,1452 591.215,1511.04 593.565,1408.99 595.916,1514.31 598.266,1379.34 600.616,1294.51 602.967,1380.26 605.317,1601.21 607.668,1418.72 610.018,1416.63 612.369,1382.18 614.719,1318.85 617.07,1429.59 619.42,1405.46 621.771,1251.77 624.121,1235.05 626.472,1390.29 628.822,1314.89 631.173,1227.09 633.523,1479.27 635.874,1316.94 638.224,1408.4 640.575,1459.66 642.925,1643.94 645.275,1493.14 647.626,1364.25 649.976,1376.55 652.327,1484.85 654.677,1598.95 657.028,1471.34 659.378,1430.65 661.729,1342.98 664.079,1433.92 666.43,1513.36 668.78,1396.35 671.131,1318.52 673.481,1617.97 675.832,1410.28 678.182,1259.97 680.533,1433.13 682.883,1359.93 685.233,1364.29 687.584,1393.69 689.934,1375.45 692.285,1478.48 694.635,1454.51 696.986,1321.92 699.336,1608.29 701.687,1559.55 704.037,1298.9 706.388,1281.71 708.738,1198.24 711.089,1389.8 713.439,1338.13 715.79,1480.27 718.14,1464.41 720.491,1346.06 722.841,1273.17 725.192,1324.95 727.542,1381.69 729.892,1143.99 732.243,1279.53 734.593,1237.95 736.944,1274.23 739.294,1257.31 741.645,1454.53 743.995,1298.64 746.346,1430.12 748.696,1589.89 751.047,1673.22 753.397,1236.06 755.748,1360.38 758.098,1404.77 760.449,1343.23 762.799,1392.71 765.15,1576.16 767.5,1419.68 769.85,1325.95 772.201,1391.88 774.551,1378 776.902,1315.63 779.252,1260.88 781.603,1310.33 783.953,1494.16 786.304,1219.53 788.654,1424.67 791.005,1586.22 793.355,1319.1 795.706,1462.02 798.056,1280.71 800.407,1331.52 802.757,1538.2 805.108,1469.87 807.458,1497.12 809.809,1353.51 812.159,1382.72 814.509,1366.48 816.86,1390.68 819.21,1465.94 821.561,1308.11 823.911,1373.07 826.262,1533.03 828.612,1362.97 830.963,1470.88 833.313,1240.75 835.664,1343.5 838.014,1266 840.365,1308.45 842.715,1290.11 845.066,1391.1 847.416,1509.54 849.767,1424.29 852.117,1414.27 854.467,1532.2 856.818,1369.09 859.168,1410.44 861.519,1436.16 863.869,1475.96 866.22,1499.53 868.57,1307.23 870.921,1409.5 873.271,1565.87 875.622,1432.39 877.972,1361.86 880.323,1394.59 882.673,1503.19 885.024,1434.36 887.374,1289.74 889.725,1372.93 892.075,1341.07 894.426,1327.31 896.776,1403.97 899.126,1325.58 901.477,1404.01 903.827,1356.66 906.178,1406.65 908.528,1438.51 910.879,1452.02 913.229,1212.8 915.58,1408.25 917.93,1500.87 920.281,1423.71 922.631,1168.84 924.982,1372.54 927.332,1465.97 929.683,1326.01 932.033,1399.11 934.384,1378.57 936.734,1295.54 939.084,1366.71 941.435,1502.62 943.785,1245.28 946.136,1469.8 948.486,1196.99 950.837,1430.74 953.187,1469.95 955.538,1352.54 957.888,1484.13 960.239,1359.55 962.589,1316.11 964.94,1306.81 967.29,1490.68 969.641,1484.42 971.991,1519.07 974.342,1316.73 976.692,1367.33 979.043,1447.71 981.393,1364.07 983.743,1398.3 986.094,1222.71 988.444,1333.62 990.795,1450.25 993.145,1451.22 995.496,1391.87 997.846,1439.94 1000.2,1337.01 1002.55,1196.68 1004.9,1522.4 1007.25,1420.69 1009.6,1377.64 1011.95,1430.77 1014.3,1251.99 1016.65,1464.44 1019,1473.7 1021.35,1345.92 1023.7,1516.3 1026.05,1373.14 1028.4,1500.17 1030.75,1472.67 1033.1,1396.26 1035.45,1380.38 1037.8,1612.9 1040.15,1247.92 1042.51,1256.63 1044.86,1447.21 1047.21,1451.66 1049.56,1402.3 1051.91,1382.09 1054.26,1340.07 1056.61,1232.64 1058.96,1404.98 1061.31,1289.43 1063.66,1512.12 1066.01,1267.09 1068.36,1449.71 1070.71,1409.69 1073.06,1210.91 1075.41,1510.74 1077.76,1393.5 1080.11,1414.6 1082.46,1463.86 1084.81,1533.59 1087.16,1476.03 1089.51,1537.42 1091.87,1440.63 1094.22,1414.17 1096.57,1450.27 1098.92,1413.43 1101.27,1356 1103.62,1558.54 1105.97,1426.82 1108.32,1307.55 1110.67,1445.8 1113.02,1460.42 1115.37,1415.49 1117.72,1323.7 1120.07,1452.8 1122.42,1334.35 1124.77,1242.42 1127.12,1415.39 1129.47,1337 1131.82,1505.14 1134.17,1455.56 1136.52,1447.8 1138.87,1420.36 1141.23,1416.29 1143.58,1348.81 1145.93,1387.92 1148.28,1300.26 1150.63,1405.53 1152.98,1456.17 1155.33,1421.33 1157.68,1284.11 1160.03,1429.29 1162.38,1483.7 1164.73,1453.14 1167.08,1326 1169.43,1371.96 1171.78,1220.44 1174.13,1448.63 1176.48,1401.46 1178.83,1382.83 1181.18,1253.57 1183.53,1287.39 1185.88,1407.13 1188.23,1455.68 1190.59,1263.64 1192.94,1407.22 1195.29,1442.49 1197.64,1383.92 1199.99,1453.69 1202.34,1453.62 1204.69,1425.68 1207.04,1097.02 1209.39,1494.52 1211.74,1202.22 1214.09,1460.15 1216.44,1471.95 1218.79,1357.56 1221.14,1579.84 1223.49,1556.16 1225.84,1259.35 1228.19,1374.3 1230.54,1371.41 1232.89,1432.57 1235.24,1467.94 1237.59,1361.52 1239.94,1401 1242.3,1416.22 1244.65,1524.66 1247,1320.68 1249.35,1318.16 1251.7,1383.58 1254.05,1431.87 1256.4,1416.14 1258.75,1419.63 1261.1,1513.07 1263.45,1344.26 1265.8,1397.94 1268.15,1239 1270.5,1377.59 1272.85,1276.6 1275.2,1568.15 1277.55,1405.61 1279.9,1351.73 1282.25,1340.77 1284.6,1353.45 1286.95,1397.54 1289.3,1448.55 1291.66,1410.73 1294.01,1405.68 1296.36,1422.18 1298.71,1374.71 1301.06,1247.56 1303.41,1564.39 1305.76,1397.26 1308.11,1441.23 1310.46,1288.51 1312.81,1461.67 1315.16,1282.12 1317.51,1174.48 1319.86,1341.91 1322.21,1336.77 1324.56,1272.65 1326.91,1349.04 1329.26,1422.68 1331.61,1428.29 1333.96,1425.47 1336.31,1436.64 1338.66,1385.05 1341.02,1270.52 1343.37,1392.97 1345.72,1339.39 1348.07,1275.22 1350.42,1469.45 1352.77,1316.04 1355.12,1514.68 1357.47,1303.18 1359.82,1321.72 1362.17,1325.18 1364.52,1446.31 1366.87,1463.15 1369.22,1292.86 1371.57,1306.93 1373.92,1356.38 1376.27,1445.23 1378.62,1444.59 1380.97,1361.03 1383.32,1370.54 1385.67,1521.83 1388.02,1419.21 1390.38,1234.64 1392.73,1384.74 1395.08,1356.91 1397.43,1367.92 1399.78,1334.42 1402.13,1300.55 1404.48,1302.62 1406.83,1542.82 1409.18,1197.69 1411.53,1246.63 1413.88,1356.42 1416.23,1568.7 1418.58,1459.54 1420.93,1340.06 1423.28,1252.81 1425.63,1364.28 1427.98,1455.09 1430.33,1473.39 1432.68,1340.63 1435.03,1515.53 1437.38,1513.81 1439.74,1437.96 1442.09,1472.35 1444.44,1346.27 1446.79,1460.87 1449.14,1391.34 1451.49,1139.65 1453.84,1457.72 1456.19,1391.04 1458.54,1448.63 1460.89,1451.8 1463.24,1379.37 1465.59,1394.73 1467.94,1544.3 1470.29,1609.08 1472.64,1514.32 1474.99,1502.07 1477.34,1390.89 1479.69,1415.07 1482.04,1369.67 1484.39,1356.42 1486.74,1572.5 1489.1,1374.24 1491.45,1389.69 1493.8,1399.41 1496.15,1373.69 1498.5,1522.6 1500.85,1470.08 1503.2,1253.5 1505.55,1488.49 1507.9,1323.09 1510.25,1517.73 1512.6,1515.99 1514.95,1089.31 1517.3,1525.69 1519.65,1584.15 1522,1334.61 1524.35,1331.19 1526.7,1575.18 1529.05,1332.84 1531.4,1509.87 1533.75,1415.86 1536.1,1396.18 1538.45,1273.69 1540.81,1323.15 1543.16,1469.31 1545.51,1561.44 1547.86,1411.3 1550.21,1292.18 1552.56,1389.91 1554.91,1618.62 1557.26,1366.82 1559.61,1598.87 1561.96,1329.7 1564.31,1376.9 1566.66,1324.55 1569.01,1443.38 1571.36,1361.61 1573.71,1339.71 1576.06,1248.28 1578.41,1479.2 1580.76,1534.61 1583.11,1464.59 1585.46,1340.91 1587.81,1299.14 1590.17,1321.28 1592.52,1238.76 1594.87,1332.91 1597.22,1567.99 1599.57,1232.22 1601.92,1497.84 1604.27,1315.88 1606.62,1386.4 1608.97,1523.59 1611.32,1492.52 1613.67,1348.73 1616.02,1592.79 1618.37,1400.5 1620.72,1400.83 1623.07,1346.49 1625.42,1389.61 1627.77,1502.77 1630.12,1423.67 1632.47,1402.26 1634.82,1519.55 1637.17,1345.8 1639.53,1423.98 1641.88,1485.79 1644.23,1477.42 1646.58,1519.94 1648.93,1528.04 1651.28,1460.03 1653.63,1363.17 1655.98,1467.85 1658.33,1336.18 1660.68,1422.95 1663.03,1211.58 1665.38,1312.22 1667.73,1323.02 1670.08,1427.93 1672.43,1430.89 1674.78,1327.3 1677.13,1488.1 1679.48,1381.08 1681.83,1271.75 1684.18,1435 1686.53,1321.89 1688.89,1371.82 1691.24,1457.81 1693.59,1491.09 1695.94,1490.86 1698.29,1321.71 1700.64,1145.58 1702.99,1380.99 1705.34,1349.08 1707.69,1534.83 1710.04,1276.75 1712.39,1320.94 1714.74,1300.02 1717.09,1543.34 1719.44,1484.55 1721.79,1493.08 1724.14,1308.7 1726.49,1442.24 1728.84,1541.81 1731.19,1147.27 1733.54,1288.12 1735.89,1499.29 1738.25,1354.01 1740.6,1312.84 1742.95,1465.36 1745.3,1454.04 1747.65,1305.38 1750,1386.89 1752.35,1268.89 1754.7,1500.49 1757.05,1417.13 1759.4,1489.46 1761.75,1424.2 1764.1,1273.86 1766.45,1355.66 1768.8,1189.62 1771.15,1529.73 1773.5,1513.04 1775.85,1501.72 1778.2,1286.24 1780.55,1226.53 1782.9,1432.39 1785.25,1334.75 1787.6,1281.55 1789.96,1344.06 1792.31,1405.78 1794.66,1471.52 1797.01,1481.56 1799.36,1239.42 1801.71,1626.17 1804.06,1383.23 1806.41,1455.36 1808.76,1181.03 1811.11,1555.98 1813.46,1599.8 1815.81,1416.14 1818.16,1428.6 1820.51,1609.58 1822.86,1281.23 1825.21,1621.79 1827.56,1601.76 1829.91,1510.23 1832.26,1417.37 1834.61,1282.89 1836.96,1330.64 1839.32,1751.15 1841.67,1198.75 1844.02,1366.37 1846.37,1346.09 1848.72,1396.42 1851.07,1387.14 1853.42,1433.18 1855.77,1424.4 1858.12,1382.08 1860.47,1510.59 1862.82,1343.36 1865.17,1526.14 1867.52,1457.12 1869.87,1409.96 1872.22,1213.72 1874.57,1373.57 1876.92,1506.69 1879.27,1321.75 1881.62,1632.23 1883.97,1479.02 1886.32,1248.82 1888.68,1313.97 1891.03,1345.16 1893.38,1351.3 1895.73,1415.36 1898.08,1404.39 1900.43,1344.81 1902.78,1159.61 1905.13,1409.33 1907.48,1299.06 1909.83,1318.53 1912.18,1596.91 1914.53,1460.1 1916.88,1323.5 1919.23,1594.65 1921.58,1353.52 1923.93,1455.57 1926.28,1381.22 1928.63,1365.15 1930.98,1426.74 1933.33,1561.18 1935.68,1446.03 1938.04,1356.97 1940.39,1368.72 1942.74,1508.71 1945.09,1351.14 1947.44,1273.2 1949.79,1494.39 1952.14,1391.58 1954.49,1397.84 1956.84,1466.17 1959.19,1292.65 1961.54,1360.81 1963.89,1350.61 1966.24,1526.31 1968.59,1195.01 1970.94,1486.86 1973.29,1143.19 1975.64,1378.91 1977.99,1328.76 1980.34,1368.41 1982.69,1354.63 1985.04,1248.55 1987.4,1425.03 1989.75,1516.47 1992.1,1398.31 1994.45,1472.97 1996.8,1437.65 1999.15,1469.43 2001.5,1267.06 2003.85,1431.36 2006.2,1380.19 2008.55,1292.04 2010.9,1451.43 2013.25,1405.31 2015.6,1450.79 2017.95,1467.43 2020.3,1662.41 2022.65,1540.96 2025,1357.82 2027.35,1432.54 2029.7,1365.87 2032.05,1324.93 2034.4,1393.34 2036.76,1604.74 2039.11,1291.61 2041.46,1263.54 2043.81,1202.14 2046.16,1362.49 2048.51,1380.02 2050.86,1452.91 2053.21,1182.9 2055.56,1206.9 2057.91,1472.87 2060.26,1338.43 2062.61,1420.42 2064.96,1302.14 2067.31,1294.53 2069.66,1646.34 2072.01,1532.39 2074.36,1253.94 2076.71,1193.32 2079.06,1397.73 2081.41,1334.13 2083.76,1494.35 2086.11,1308.97 2088.47,1400.82 2090.82,1512.46 2093.17,1421.3 2095.52,1294.36 2097.87,1260.39 2100.22,1446.21 2102.57,1169.85 2104.92,1481.19 2107.27,1417.4 2109.62,1452.48 2111.97,1399.5 2114.32,1335.39 2116.67,1492.08 2119.02,1244.09 2121.37,1427.72 2123.72,1318.88 2126.07,1423.99 2128.42,1540.55 2130.77,1465.52 2133.12,1469.24 2135.47,1360.94 2137.83,1451.89 2140.18,1472.48 2142.53,1299.58 2144.88,1181.9 2147.23,1355.49 2149.58,1413.02 2151.93,1379.34 2154.28,1226.48 2156.63,1349.65 2158.98,1405.79 2161.33,1422.86 2163.68,1556.67 2166.03,1274.47 2168.38,1341.43 2170.73,1509.44 2173.08,1337.48 2175.43,1374.3 2177.78,1361.07 2180.13,1319.19 2182.48,1392.7 2184.83,1421.33 2187.19,1400.07 2189.54,1315.77 2191.89,1609.12 2194.24,1387.62 2196.59,1365.35 2198.94,1294.18 2201.29,1430.55 2203.64,1291.55 2205.99,1253.29 2208.34,1310.92 2210.69,1517.63 2213.04,1380.29 2215.39,1448.03 2217.74,1355.72 2220.09,1327.09 2222.44,1378.58 2224.79,1324.67 2227.14,1514.36 2229.49,1363.23 2231.84,1319.68 2234.19,1401.72 2236.55,1279.21 2238.9,1454.85 2241.25,1509.45 2243.6,1350.74 2245.95,1290.46 2248.3,1521.85 2250.65,1534.05 2253,1386.33 2255.35,1465.77 2257.7,1287.36 2260.05,1257.43 2262.4,1419.88 2264.75,1364.91 2267.1,1390.52 2269.45,1385.98 2271.8,1398.47 2274.15,1522.18 2276.5,1477.29 2278.85,1394.13 2281.2,1478.5 2283.55,1521.5 2285.91,1274.5 2288.26,1309.23 2290.61,1384.39 2292.96,1321.31 2295.31,1340.4 2297.66,1289.23 2300.01,1590.87 2302.36,1364.68 2304.71,1309.19 2307.06,1367.56 2309.41,1405.99 2311.76,1503.04 2314.11,1566.47 2316.46,1381.74 2318.81,1305.34 2321.16,1251.53 2323.51,1271.05 2325.86,1384.18 2328.21,1360.08 2330.56,1342.78 2332.91,1585.35 2335.27,1314.54 2337.62,1539.34 2339.97,1394.54 2342.32,1462.06 2344.67,1353.43 2347.02,1403.99 2349.37,1477.55 2351.72,1260.42 2354.07,1514.14 2356.42,1478.38 2358.77,1398.71 2361.12,1157.09 2363.47,1364.16 2365.82,1384.91 2368.17,1461.78 2370.52,1442.77 2372.87,1325.69 2375.22,1137.54 2377.57,1350.5 2379.92,1593.84 2382.27,1410.93 2384.62,1431.07 2386.98,1486.94 2389.33,1331.16 2391.68,1546.21 2394.03,1599.41 2396.38,1619.94 2398.73,1342.04 2401.08,1351.19 2403.43,1298.08 2405.78,1245.18 2408.13,1449.65 2410.48,1470.43 2412.83,1371.72 2415.18,1421.11 2417.53,1200.27 2419.88,1327.36 2422.23,1462.89 2424.58,1470.98 2426.93,1347.01 2429.28,1516.51 2431.63,1341.25 2433.98,1412.94 2436.34,1330.39 2438.69,1284.99 2441.04,1330.99 2443.39,1500.4 2445.74,1389.1 2448.09,1325.5 2450.44,1363.44 2452.79,1385.22 2455.14,1227.55 2457.49,1297.05 2459.84,1468.2 2462.19,1371.92 2464.54,1382.45 2466.89,1384.58 2469.24,1378.66 2471.59,1582.8 2473.94,1161.8 2476.29,1397.25 2478.64,1321.52 2480.99,1487.23 2483.34,1620.57 2485.7,1293.92 2488.05,1444.04 2490.4,1281.68 2492.75,1545.74 2495.1,1389.62 2497.45,1260.46 2499.8,1462.94 2502.15,1298.27 2504.5,1239.32 2506.85,1553.37 2509.2,1423.6 2511.55,1511.9 2513.9,1321.72 2516.25,1432.79 2518.6,1529.09 2520.95,1380.98 2523.3,1385.08 2525.65,1483.81 2528,1559.5 2530.35,1443.23 2532.7,1420.14 2535.06,1566.59 2537.41,1108.26 2539.76,1414.51 2542.11,1607.62 2544.46,1398.73 2546.81,1512.67 2549.16,1437.48 2551.51,1527.57 2553.86,1374.15 2556.21,1221.21 2558.56,1385.54 2560.91,1373.17 2563.26,1344.74 2565.61,1443.7 2567.96,1370.4 2570.31,1561.97 "></polyline>
<polyline clip-path="url(#clip532)" style="stroke:#e26f46; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,960.415 224.541,937.732 226.891,914.871 229.242,919.138 231.592,816.519 233.943,965.662 236.293,1088.15 238.644,781.424 240.994,846.367 243.345,852.738 245.695,981.058 248.046,892.124 250.396,808.31 252.747,793.021 255.097,989.808 257.448,935.342 259.798,881.448 262.148,782.165 264.499,1030.67 266.849,1069.57 269.2,752.887 271.55,659.434 273.901,689.424 276.251,817.918 278.602,836.809 280.952,759.95 283.303,896.876 285.653,1030 288.004,783.703 290.354,824.928 292.705,996.298 295.055,687.113 297.406,1017.19 299.756,868.97 302.107,816.713 304.457,1041.68 306.807,836.631 309.158,730.161 311.508,855.738 313.859,898.736 316.209,840.191 318.56,859.493 320.91,879.065 323.261,1042.9 325.611,649.569 327.962,810.738 330.312,1057.38 332.663,828.295 335.013,994.429 337.364,920.899 339.714,892.14 342.065,975.5 344.415,995.681 346.765,884.717 349.116,983.512 351.466,773.347 353.817,799.244 356.167,786.883 358.518,1025.07 360.868,866.014 363.219,780.058 365.569,725.293 367.92,849.041 370.27,990.804 372.621,917.076 374.971,886.204 377.322,968.275 379.672,983.639 382.023,925.376 384.373,795.225 386.724,844.209 389.074,854.606 391.424,885.883 393.775,1022.11 396.125,957.301 398.476,919.932 400.826,725.853 403.177,920.858 405.527,958.977 407.878,856.421 410.228,919.298 412.579,1094.77 414.929,922.273 417.28,916.564 419.63,740.363 421.981,903.171 424.331,795.588 426.682,812.778 429.032,1101.65 431.382,727.533 433.733,810.881 436.083,955.305 438.434,969.014 440.784,826.756 443.135,864.831 445.485,903.741 447.836,833.42 450.186,844.961 452.537,968.814 454.887,1090.01 457.238,1026.26 459.588,818.031 461.939,965.438 464.289,938.335 466.64,824.353 468.99,938.108 471.341,890.988 473.691,742.368 476.041,898.585 478.392,925.145 480.742,750.529 483.093,829.963 485.443,916.796 487.794,904.912 490.144,924.552 492.495,777.912 494.845,788.299 497.196,961.664 499.546,724.198 501.897,624.982 504.247,813.26 506.598,850.544 508.948,978.678 511.299,980.398 513.649,994.749 515.999,867.715 518.35,901.914 520.7,935.356 523.051,867.069 525.401,869.621 527.752,978.03 530.102,895.005 532.453,966.479 534.803,912.068 537.154,959.029 539.504,956.461 541.855,839.767 544.205,953.464 546.556,817.54 548.906,872.108 551.257,869.343 553.607,872.857 555.958,940.282 558.308,1043.48 560.658,868.406 563.009,734.907 565.359,1002.14 567.71,825.346 570.06,805.817 572.411,882.844 574.761,932.399 577.112,1143.44 579.462,832.448 581.813,847.959 584.163,983.116 586.514,786.737 588.864,1029.76 591.215,619.085 593.565,787.124 595.916,1153.14 598.266,760.999 600.616,1014.71 602.967,753.409 605.317,945.521 607.668,787.906 610.018,888.688 612.369,912.123 614.719,793.373 617.07,828.684 619.42,846.124 621.771,801.846 624.121,794.108 626.472,869.546 628.822,829.892 631.173,872.974 633.523,793.783 635.874,903.543 638.224,828.076 640.575,743.374 642.925,947.07 645.275,899.864 647.626,1105.1 649.976,746.431 652.327,941.957 654.677,857.756 657.028,824.942 659.378,903.342 661.729,929.912 664.079,901.547 666.43,1007.38 668.78,919.46 671.131,769.666 673.481,855.355 675.832,859.515 678.182,882.958 680.533,886.451 682.883,887.122 685.233,756.106 687.584,788.557 689.934,753.224 692.285,1053.64 694.635,793.327 696.986,931.946 699.336,962.544 701.687,1000.33 704.037,880.781 706.388,1159.46 708.738,823.179 711.089,803.4 713.439,930.862 715.79,768.764 718.14,825.813 720.491,986.92 722.841,703.485 725.192,750.156 727.542,1006.76 729.892,821.869 732.243,777.907 734.593,795.287 736.944,825.978 739.294,901.955 741.645,815.459 743.995,1012.19 746.346,960.396 748.696,876.213 751.047,672.224 753.397,994.28 755.748,1016.86 758.098,993.871 760.449,881.126 762.799,902.925 765.15,862.82 767.5,727.557 769.85,978.306 772.201,996.732 774.551,892.627 776.902,947.143 779.252,876.527 781.603,1047.64 783.953,1017.86 786.304,913.808 788.654,965.869 791.005,929.198 793.355,839.55 795.706,934.224 798.056,876.203 800.407,651.411 802.757,783.865 805.108,991.869 807.458,763.07 809.809,999.026 812.159,852.516 814.509,1012.39 816.86,744.228 819.21,883.01 821.561,1134.45 823.911,883.641 826.262,986.819 828.612,726.24 830.963,871.931 833.313,1168.35 835.664,989.425 838.014,984.639 840.365,918.66 842.715,791.364 845.066,1052.13 847.416,824.241 849.767,1003.34 852.117,1026.89 854.467,969.497 856.818,943.715 859.168,922.719 861.519,841.449 863.869,878.409 866.22,746.275 868.57,815.335 870.921,905.392 873.271,867.602 875.622,912.437 877.972,1077.66 880.323,899.82 882.673,643.348 885.024,890.863 887.374,973.585 889.725,762.843 892.075,958.577 894.426,918.962 896.776,807.902 899.126,843.118 901.477,695.652 903.827,964.855 906.178,1006.14 908.528,810.34 910.879,923.826 913.229,1040.96 915.58,937.388 917.93,833.739 920.281,926.673 922.631,785.995 924.982,814.888 927.332,952.935 929.683,1057.34 932.033,770.278 934.384,985.871 936.734,1043.07 939.084,911.856 941.435,812.423 943.785,817.174 946.136,643.818 948.486,846.249 950.837,856.158 953.187,1119.5 955.538,945.763 957.888,911.93 960.239,784.155 962.589,838.221 964.94,846.49 967.29,978.608 969.641,737.719 971.991,682.588 974.342,899.619 976.692,872.841 979.043,909.489 981.393,957.332 983.743,968.545 986.094,885.538 988.444,875.539 990.795,914.657 993.145,1117.13 995.496,986.397 997.846,777.322 1000.2,712.749 1002.55,1002.04 1004.9,939.671 1007.25,848.939 1009.6,909.761 1011.95,892.048 1014.3,858.573 1016.65,845.321 1019,859.623 1021.35,845.879 1023.7,904.433 1026.05,928.47 1028.4,842.95 1030.75,849.921 1033.1,853.578 1035.45,942.102 1037.8,851.707 1040.15,1136.99 1042.51,923.843 1044.86,896.618 1047.21,957.668 1049.56,752.943 1051.91,965.842 1054.26,806.263 1056.61,1028.12 1058.96,977.467 1061.31,1012.08 1063.66,714.293 1066.01,966.83 1068.36,839.486 1070.71,867.668 1073.06,819.391 1075.41,893.684 1077.76,801.671 1080.11,899.506 1082.46,853.063 1084.81,938.652 1087.16,792.411 1089.51,675.338 1091.87,911.993 1094.22,1033.56 1096.57,783.383 1098.92,898.231 1101.27,911.873 1103.62,911.511 1105.97,1002.13 1108.32,918.608 1110.67,935.236 1113.02,888.104 1115.37,908.504 1117.72,1098.06 1120.07,909.978 1122.42,881.288 1124.77,994.037 1127.12,880.196 1129.47,945.806 1131.82,853.052 1134.17,705.25 1136.52,907.633 1138.87,863.046 1141.23,867.435 1143.58,945.423 1145.93,1017.97 1148.28,1057.88 1150.63,996.809 1152.98,916.958 1155.33,891.001 1157.68,810.1 1160.03,859.228 1162.38,893.688 1164.73,936.99 1167.08,817.371 1169.43,1024.99 1171.78,828.197 1174.13,866.729 1176.48,723.242 1178.83,848.979 1181.18,736.356 1183.53,760.052 1185.88,810.718 1188.23,949.229 1190.59,1034.02 1192.94,762.178 1195.29,871.817 1197.64,958.281 1199.99,819.181 1202.34,875.296 1204.69,1030.73 1207.04,939.691 1209.39,942.139 1211.74,821.652 1214.09,856.374 1216.44,941.704 1218.79,1006.39 1221.14,945.971 1223.49,818.781 1225.84,745.139 1228.19,740.14 1230.54,756.445 1232.89,890.095 1235.24,692.255 1237.59,1035.35 1239.94,975.722 1242.3,816.06 1244.65,828.676 1247,905.344 1249.35,774.725 1251.7,869.326 1254.05,709.181 1256.4,842.087 1258.75,860.399 1261.1,882.368 1263.45,1011.85 1265.8,752.382 1268.15,834.643 1270.5,864.259 1272.85,985.493 1275.2,900.056 1277.55,1022.2 1279.9,893.248 1282.25,673.02 1284.6,1000.05 1286.95,634.345 1289.3,843.838 1291.66,842.319 1294.01,878.349 1296.36,742.991 1298.71,847.251 1301.06,712.178 1303.41,774.433 1305.76,899.357 1308.11,843.451 1310.46,933.663 1312.81,906.943 1315.16,801.618 1317.51,797.524 1319.86,824.527 1322.21,889.699 1324.56,794.13 1326.91,727.666 1329.26,855.78 1331.61,802.11 1333.96,920.55 1336.31,759.576 1338.66,926.294 1341.02,1027.02 1343.37,926.448 1345.72,912.587 1348.07,893.869 1350.42,957.275 1352.77,969.836 1355.12,1037.43 1357.47,940.264 1359.82,826.684 1362.17,898.569 1364.52,950.226 1366.87,1108.97 1369.22,741.431 1371.57,847.161 1373.92,781.098 1376.27,1054.34 1378.62,870.001 1380.97,929.934 1383.32,1021.41 1385.67,783.284 1388.02,919.893 1390.38,926.141 1392.73,781.764 1395.08,826.941 1397.43,703.196 1399.78,616.506 1402.13,832.479 1404.48,831.6 1406.83,834.433 1409.18,1033.46 1411.53,948.392 1413.88,886.742 1416.23,1036.22 1418.58,851.001 1420.93,633.607 1423.28,770.732 1425.63,759.727 1427.98,945.127 1430.33,1008.36 1432.68,841.013 1435.03,867.839 1437.38,923.494 1439.74,807.608 1442.09,868.792 1444.44,965.565 1446.79,825.235 1449.14,832.878 1451.49,887.33 1453.84,877.611 1456.19,1040.92 1458.54,907.587 1460.89,883.455 1463.24,924.395 1465.59,780.823 1467.94,990.081 1470.29,1033.8 1472.64,729.587 1474.99,709.309 1477.34,941.008 1479.69,895.735 1482.04,944.346 1484.39,895.294 1486.74,758.277 1489.1,785.857 1491.45,1001.53 1493.8,767.052 1496.15,792.703 1498.5,865.326 1500.85,809.659 1503.2,938.801 1505.55,731.151 1507.9,898.61 1510.25,1028.14 1512.6,941.124 1514.95,967.162 1517.3,948.035 1519.65,812.39 1522,896.841 1524.35,754.514 1526.7,969.027 1529.05,1037.26 1531.4,899.36 1533.75,1125.57 1536.1,849.961 1538.45,885.4 1540.81,740.364 1543.16,1041.28 1545.51,925.103 1547.86,908.463 1550.21,751.834 1552.56,1032.84 1554.91,876.223 1557.26,901.784 1559.61,828.277 1561.96,1095.77 1564.31,744.567 1566.66,837.919 1569.01,1046.47 1571.36,915.26 1573.71,1096.18 1576.06,983.668 1578.41,957.602 1580.76,829.367 1583.11,880.645 1585.46,860.994 1587.81,878.297 1590.17,854.273 1592.52,840.575 1594.87,853.909 1597.22,856.255 1599.57,902.522 1601.92,989.997 1604.27,825.529 1606.62,761.217 1608.97,1035.17 1611.32,1052.95 1613.67,1038.1 1616.02,791.617 1618.37,922.638 1620.72,943.157 1623.07,835.996 1625.42,698.811 1627.77,883.528 1630.12,900.278 1632.47,914.174 1634.82,926.204 1637.17,805.543 1639.53,908.95 1641.88,680.564 1644.23,960.338 1646.58,1027.24 1648.93,891.742 1651.28,817.633 1653.63,925.301 1655.98,945.576 1658.33,858.574 1660.68,903.926 1663.03,870.438 1665.38,851.815 1667.73,731.395 1670.08,929.561 1672.43,821.707 1674.78,786.2 1677.13,1078.21 1679.48,1074.53 1681.83,788.888 1684.18,891.431 1686.53,941.749 1688.89,858.38 1691.24,793.46 1693.59,880.62 1695.94,797.976 1698.29,927.874 1700.64,868.05 1702.99,772.401 1705.34,709.138 1707.69,870.684 1710.04,1033.79 1712.39,785.427 1714.74,802.13 1717.09,858.489 1719.44,756.232 1721.79,712.64 1724.14,897.326 1726.49,903.636 1728.84,1035.94 1731.19,910.059 1733.54,693.222 1735.89,703.997 1738.25,825.505 1740.6,737.099 1742.95,786.91 1745.3,893.719 1747.65,880.181 1750,949.662 1752.35,949.695 1754.7,856.886 1757.05,919.298 1759.4,645.887 1761.75,675.712 1764.1,1091.12 1766.45,847.72 1768.8,857.434 1771.15,835.32 1773.5,853.778 1775.85,833.247 1778.2,1049.03 1780.55,992.419 1782.9,859.905 1785.25,863.826 1787.6,990.711 1789.96,987.263 1792.31,830.983 1794.66,1001.63 1797.01,813.91 1799.36,637.488 1801.71,929.735 1804.06,985.05 1806.41,713.559 1808.76,924.003 1811.11,738.911 1813.46,953.979 1815.81,911.75 1818.16,950.047 1820.51,865.836 1822.86,817.313 1825.21,857.724 1827.56,824.55 1829.91,756.236 1832.26,894.001 1834.61,566.185 1836.96,1059.66 1839.32,715.162 1841.67,637.451 1844.02,821.028 1846.37,896.111 1848.72,689.657 1851.07,984.513 1853.42,1064.41 1855.77,986.17 1858.12,1054.31 1860.47,846.2 1862.82,803.229 1865.17,681.64 1867.52,826.119 1869.87,967.743 1872.22,936.114 1874.57,665.986 1876.92,871.043 1879.27,831.042 1881.62,715.737 1883.97,731.761 1886.32,875.548 1888.68,761.562 1891.03,759.268 1893.38,970.623 1895.73,855.956 1898.08,898.641 1900.43,843.488 1902.78,901.336 1905.13,829.986 1907.48,822.772 1909.83,763.08 1912.18,801.926 1914.53,730.695 1916.88,866.313 1919.23,986.966 1921.58,1015.48 1923.93,861.002 1926.28,934.988 1928.63,1028.98 1930.98,863.732 1933.33,937.656 1935.68,894.429 1938.04,822.128 1940.39,907.287 1942.74,888.528 1945.09,904.139 1947.44,1019.3 1949.79,927.827 1952.14,960.802 1954.49,1019.97 1956.84,850.099 1959.19,1022.14 1961.54,905.352 1963.89,883.201 1966.24,992.251 1968.59,723.077 1970.94,784.811 1973.29,876.272 1975.64,849.665 1977.99,731.274 1980.34,948.562 1982.69,807.455 1985.04,657.64 1987.4,786.182 1989.75,887.756 1992.1,972.879 1994.45,1028.33 1996.8,847.371 1999.15,1124.2 2001.5,891.775 2003.85,1068.13 2006.2,877.77 2008.55,755.328 2010.9,1090.05 2013.25,533.235 2015.6,705.697 2017.95,882.162 2020.3,815.777 2022.65,984.458 2025,804.375 2027.35,849.371 2029.7,989.739 2032.05,966.562 2034.4,913.04 2036.76,999.803 2039.11,887.355 2041.46,824.796 2043.81,898.319 2046.16,787.336 2048.51,769.88 2050.86,962.124 2053.21,845.166 2055.56,916.867 2057.91,698.308 2060.26,1015.57 2062.61,901.254 2064.96,1075.68 2067.31,853.045 2069.66,929.42 2072.01,784.961 2074.36,840.728 2076.71,818.221 2079.06,938.642 2081.41,764.697 2083.76,877.075 2086.11,926.238 2088.47,875.85 2090.82,875.73 2093.17,872 2095.52,910.566 2097.87,739.957 2100.22,806.391 2102.57,860.835 2104.92,765.868 2107.27,830.244 2109.62,1018.06 2111.97,813.8 2114.32,870.082 2116.67,961.886 2119.02,1040.94 2121.37,958.197 2123.72,1005.23 2126.07,888.84 2128.42,912.255 2130.77,976.687 2133.12,1005.63 2135.47,992.669 2137.83,713.988 2140.18,674.881 2142.53,738.611 2144.88,945.35 2147.23,943.152 2149.58,710.644 2151.93,786.201 2154.28,839.271 2156.63,903.597 2158.98,925.027 2161.33,667.725 2163.68,676.205 2166.03,702.754 2168.38,708.06 2170.73,870.518 2173.08,854.102 2175.43,904.697 2177.78,1018.51 2180.13,1073.55 2182.48,698.816 2184.83,790.755 2187.19,953.337 2189.54,1012.16 2191.89,616.566 2194.24,927.68 2196.59,771.385 2198.94,799.478 2201.29,900.52 2203.64,958.139 2205.99,795.873 2208.34,659.006 2210.69,930.03 2213.04,680.949 2215.39,800.846 2217.74,938.93 2220.09,818.965 2222.44,969.107 2224.79,836.271 2227.14,821.905 2229.49,998.615 2231.84,914.546 2234.19,749.096 2236.55,833.88 2238.9,945.236 2241.25,1118.64 2243.6,868.646 2245.95,974.736 2248.3,781.962 2250.65,856.513 2253,734.943 2255.35,770.967 2257.7,804.287 2260.05,1035.76 2262.4,834.986 2264.75,800.344 2267.1,955.679 2269.45,777.712 2271.8,1029.28 2274.15,872.259 2276.5,1007.83 2278.85,848.861 2281.2,939.874 2283.55,880.729 2285.91,994.449 2288.26,997.969 2290.61,865.325 2292.96,939.412 2295.31,1077.35 2297.66,836.404 2300.01,909.667 2302.36,1016.1 2304.71,758.378 2307.06,1010.21 2309.41,847.027 2311.76,820.845 2314.11,777.309 2316.46,951.84 2318.81,958.259 2321.16,897.783 2323.51,1027.81 2325.86,792.688 2328.21,1128.54 2330.56,761.919 2332.91,715.077 2335.27,868.12 2337.62,913.418 2339.97,875.919 2342.32,979.787 2344.67,872.928 2347.02,938.856 2349.37,796.187 2351.72,742.425 2354.07,806.285 2356.42,805.081 2358.77,820.645 2361.12,790.601 2363.47,978.742 2365.82,1054.02 2368.17,951.181 2370.52,800.241 2372.87,967.648 2375.22,825.333 2377.57,923.021 2379.92,792.689 2382.27,865.642 2384.62,709.273 2386.98,1024.09 2389.33,923.773 2391.68,805.794 2394.03,762.044 2396.38,976.805 2398.73,982.093 2401.08,840.115 2403.43,874.592 2405.78,754.26 2408.13,914.71 2410.48,1052.89 2412.83,881.455 2415.18,840.424 2417.53,844.549 2419.88,840.514 2422.23,898.683 2424.58,934.803 2426.93,763.282 2429.28,864.196 2431.63,935.494 2433.98,887.158 2436.34,882.926 2438.69,823.844 2441.04,785.949 2443.39,891.769 2445.74,703.308 2448.09,931.101 2450.44,919.598 2452.79,770.304 2455.14,852.479 2457.49,884.637 2459.84,979.048 2462.19,1082.94 2464.54,925.851 2466.89,821.517 2469.24,711.177 2471.59,916.705 2473.94,943.658 2476.29,1033.63 2478.64,941.3 2480.99,772.102 2483.34,975.698 2485.7,786.914 2488.05,913.563 2490.4,829.231 2492.75,742.737 2495.1,927.379 2497.45,907.276 2499.8,872.9 2502.15,835.261 2504.5,899.53 2506.85,720.992 2509.2,923.791 2511.55,914.909 2513.9,1073.51 2516.25,774.367 2518.6,869.856 2520.95,850.403 2523.3,635.046 2525.65,887.897 2528,793.913 2530.35,679.993 2532.7,863.455 2535.06,1092.09 2537.41,802.086 2539.76,801.967 2542.11,984.059 2544.46,825.265 2546.81,947.371 2549.16,955.352 2551.51,842.578 2553.86,711.372 2556.21,867.048 2558.56,911.389 2560.91,870.996 2563.26,907.716 2565.61,950.534 2567.96,765.185 2570.31,725.321 "></polyline>
<polyline clip-path="url(#clip532)" style="stroke:#3da44d; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,658.01 224.541,306.909 226.891,377.572 229.242,260.085 231.592,420.955 233.943,335.59 236.293,410.555 238.644,375.731 240.994,288.322 243.345,317.503 245.695,267.014 248.046,454.318 250.396,289.16 252.747,267.03 255.097,316.911 257.448,479.425 259.798,381.236 262.148,438.25 264.499,448.624 266.849,115.535 269.2,355.79 271.55,502.234 273.901,364.795 276.251,467.399 278.602,497.836 280.952,362.572 283.303,495.614 285.653,451.753 288.004,376.873 290.354,407.145 292.705,355.365 295.055,280.621 297.406,386.73 299.756,452.102 302.107,452.902 304.457,508.905 306.807,253.081 309.158,436.128 311.508,401.235 313.859,420.027 316.209,216.348 318.56,421.236 320.91,428.066 323.261,364.101 325.611,479.492 327.962,435.905 330.312,125.148 332.663,355.625 335.013,176.845 337.364,273.201 339.714,382.239 342.065,449.77 344.415,378.204 346.765,182.682 349.116,390.4 351.466,435.559 353.817,432.118 356.167,382.231 358.518,186.334 360.868,438.889 363.219,342.491 365.569,459.08 367.92,296.208 370.27,408.782 372.621,352.449 374.971,236.19 377.322,487.489 379.672,366.847 382.023,497.093 384.373,405.823 386.724,238.112 389.074,162.48 391.424,337.69 393.775,470.03 396.125,239.554 398.476,648.619 400.826,348.268 403.177,196.268 405.527,549.518 407.878,318.429 410.228,440.233 412.579,356.195 414.929,336.447 417.28,260.747 419.63,537.045 421.981,318.244 424.331,595.645 426.682,441.993 429.032,168.519 431.382,507.617 433.733,275.188 436.083,680.916 438.434,360.945 440.784,256.582 443.135,360.43 445.485,387.918 447.836,315.24 450.186,417.907 452.537,291.806 454.887,370.537 457.238,476.278 459.588,329.144 461.939,356.845 464.289,336.521 466.64,372.577 468.99,472.066 471.341,408.043 473.691,424.179 476.041,364.476 478.392,185.38 480.742,430.245 483.093,372.109 485.443,342.552 487.794,308.808 490.144,362.959 492.495,417.182 494.845,328.084 497.196,531.678 499.546,433.902 501.897,393.762 504.247,457.728 506.598,589.647 508.948,439.131 511.299,495.639 513.649,516.645 515.999,598.924 518.35,409.804 520.7,317.33 523.051,334.176 525.401,307.765 527.752,453.653 530.102,415.876 532.453,195.528 534.803,441.471 537.154,229.302 539.504,253.85 541.855,391.885 544.205,533.231 546.556,452.15 548.906,364.022 551.257,451.504 553.607,326.814 555.958,286.344 558.308,414.983 560.658,330.391 563.009,531.989 565.359,332.722 567.71,241.082 570.06,318.172 572.411,404.659 574.761,334.816 577.112,608.946 579.462,352.28 581.813,184.196 584.163,213.798 586.514,523.643 588.864,382.778 591.215,377.442 593.565,411.713 595.916,353.309 598.266,386.753 600.616,528.221 602.967,405.92 605.317,272.929 607.668,329.954 610.018,401.027 612.369,388.954 614.719,297.905 617.07,388.035 619.42,324.72 621.771,331.054 624.121,430.91 626.472,315.556 628.822,329.623 631.173,347.408 633.523,529.247 635.874,444.162 638.224,558.906 640.575,492.924 642.925,254.807 645.275,358.328 647.626,196.008 649.976,433.242 652.327,395.995 654.677,399.348 657.028,500.338 659.378,399.306 661.729,466.536 664.079,338.948 666.43,271.161 668.78,372.23 671.131,347.304 673.481,220.099 675.832,135.685 678.182,372.619 680.533,511.211 682.883,417.458 685.233,536.314 687.584,324.18 689.934,249.526 692.285,390.499 694.635,393.272 696.986,389.681 699.336,427.301 701.687,410.187 704.037,371.614 706.388,366.387 708.738,211.784 711.089,439.555 713.439,270.222 715.79,391.09 718.14,315.95 720.491,470.111 722.841,513.75 725.192,380.535 727.542,351.443 729.892,452.005 732.243,494.441 734.593,406.75 736.944,259.037 739.294,228.798 741.645,457.581 743.995,452.597 746.346,344.676 748.696,563.307 751.047,227.762 753.397,325.085 755.748,293.972 758.098,261.327 760.449,242.898 762.799,434.668 765.15,318.351 767.5,380.363 769.85,230.519 772.201,261.798 774.551,369.037 776.902,436.33 779.252,413.775 781.603,427.904 783.953,395.43 786.304,327.303 788.654,245.353 791.005,302.108 793.355,404.216 795.706,379.173 798.056,304.961 800.407,257.073 802.757,472.469 805.108,323.527 807.458,481.075 809.809,262.503 812.159,217.807 814.509,452.325 816.86,198.119 819.21,465.764 821.561,563.679 823.911,382.334 826.262,394.989 828.612,437.723 830.963,291.831 833.313,323.355 835.664,312.151 838.014,407.045 840.365,198.228 842.715,394.895 845.066,389.261 847.416,287.906 849.767,574.973 852.117,416.539 854.467,240.326 856.818,453.556 859.168,250.688 861.519,399.997 863.869,299.321 866.22,389.898 868.57,345.415 870.921,465.502 873.271,462.797 875.622,477.708 877.972,262.871 880.323,438.03 882.673,269.699 885.024,436.066 887.374,603.483 889.725,450.02 892.075,419.891 894.426,193.138 896.776,424.634 899.126,442.283 901.477,470.064 903.827,395.149 906.178,451.769 908.528,321.865 910.879,242.246 913.229,362.986 915.58,453.696 917.93,430.359 920.281,380.999 922.631,279.014 924.982,240.088 927.332,303.956 929.683,221.134 932.033,278.26 934.384,394.753 936.734,321.361 939.084,492.03 941.435,417.096 943.785,576.868 946.136,274.222 948.486,363.542 950.837,474.51 953.187,347.238 955.538,471.179 957.888,582.401 960.239,364.607 962.589,378.222 964.94,303.221 967.29,282.838 969.641,389.054 971.991,391.086 974.342,273.271 976.692,515.017 979.043,385.928 981.393,470.083 983.743,243.861 986.094,437.988 988.444,394.874 990.795,310.391 993.145,281.14 995.496,466.581 997.846,323.442 1000.2,362.498 1002.55,380.203 1004.9,373.129 1007.25,549.486 1009.6,464.016 1011.95,393.856 1014.3,440.992 1016.65,282.915 1019,329.768 1021.35,168.628 1023.7,262.357 1026.05,357.607 1028.4,419.067 1030.75,395.544 1033.1,379.716 1035.45,416.691 1037.8,361.535 1040.15,456.075 1042.51,335.093 1044.86,260.138 1047.21,373.243 1049.56,199.836 1051.91,363.067 1054.26,452.819 1056.61,605.569 1058.96,312.248 1061.31,449.912 1063.66,395.551 1066.01,453.327 1068.36,486.817 1070.71,397.849 1073.06,332.758 1075.41,454.536 1077.76,368.032 1080.11,170.92 1082.46,554.303 1084.81,335.807 1087.16,380.031 1089.51,535.345 1091.87,223.715 1094.22,289.964 1096.57,402.968 1098.92,408.761 1101.27,307.121 1103.62,219.723 1105.97,443.552 1108.32,379.7 1110.67,392.962 1113.02,451.085 1115.37,367.41 1117.72,537.666 1120.07,390.631 1122.42,456.521 1124.77,398.596 1127.12,342.207 1129.47,417.141 1131.82,403.239 1134.17,405.562 1136.52,449.753 1138.87,345.934 1141.23,380.649 1143.58,217.646 1145.93,501.615 1148.28,412.866 1150.63,414.054 1152.98,502.976 1155.33,400.069 1157.68,351.77 1160.03,466.804 1162.38,366.432 1164.73,215.881 1167.08,357.732 1169.43,510.069 1171.78,433.876 1174.13,469.105 1176.48,365.327 1178.83,378.481 1181.18,368.661 1183.53,277.195 1185.88,334.858 1188.23,411.567 1190.59,236.037 1192.94,310.447 1195.29,508.313 1197.64,359.343 1199.99,326.567 1202.34,360.66 1204.69,131.117 1207.04,460.647 1209.39,512.705 1211.74,342.534 1214.09,444.86 1216.44,469.954 1218.79,424.517 1221.14,409.36 1223.49,585.817 1225.84,347.044 1228.19,410.974 1230.54,339.18 1232.89,429.45 1235.24,226.168 1237.59,446.635 1239.94,311.336 1242.3,249.186 1244.65,460.571 1247,435.545 1249.35,312.266 1251.7,463.412 1254.05,195.878 1256.4,428.147 1258.75,501.624 1261.1,424.84 1263.45,363.428 1265.8,260.79 1268.15,292.312 1270.5,491.55 1272.85,436.742 1275.2,303.776 1277.55,457.769 1279.9,272.312 1282.25,336.177 1284.6,437.182 1286.95,197.483 1289.3,308.927 1291.66,338.001 1294.01,473.765 1296.36,302.198 1298.71,422.432 1301.06,342.291 1303.41,303.001 1305.76,192.586 1308.11,370.677 1310.46,363.201 1312.81,384.767 1315.16,489.704 1317.51,408.761 1319.86,216.621 1322.21,441.439 1324.56,399.696 1326.91,354.202 1329.26,325.315 1331.61,457.461 1333.96,417.394 1336.31,439.55 1338.66,354.966 1341.02,531.701 1343.37,391.952 1345.72,239.07 1348.07,436.185 1350.42,303.823 1352.77,465.86 1355.12,365.719 1357.47,336.016 1359.82,477.99 1362.17,313.555 1364.52,367.248 1366.87,407.089 1369.22,169.457 1371.57,377.996 1373.92,549.615 1376.27,506.961 1378.62,432.01 1380.97,480.436 1383.32,485.389 1385.67,256.103 1388.02,220.697 1390.38,499.222 1392.73,224.834 1395.08,342.378 1397.43,450.402 1399.78,398.222 1402.13,397.052 1404.48,342.528 1406.83,448.482 1409.18,420.274 1411.53,212.681 1413.88,514.628 1416.23,321.72 1418.58,309.328 1420.93,327.764 1423.28,213.632 1425.63,239.102 1427.98,347.307 1430.33,436.415 1432.68,392.96 1435.03,360.287 1437.38,406.877 1439.74,449.23 1442.09,456.517 1444.44,479.701 1446.79,498.309 1449.14,517.091 1451.49,439.574 1453.84,372.921 1456.19,363.294 1458.54,280.376 1460.89,377.86 1463.24,316.468 1465.59,437.917 1467.94,96.8724 1470.29,324.239 1472.64,515.721 1474.99,291.075 1477.34,415.264 1479.69,204.98 1482.04,328.71 1484.39,383.856 1486.74,443.329 1489.1,516.757 1491.45,362.278 1493.8,185.726 1496.15,316.112 1498.5,393.241 1500.85,312.465 1503.2,207.9 1505.55,372.213 1507.9,260.395 1510.25,434.881 1512.6,215.337 1514.95,269.6 1517.3,560.522 1519.65,456.5 1522,225.841 1524.35,293.576 1526.7,343.695 1529.05,325.699 1531.4,323.261 1533.75,333.822 1536.1,372.67 1538.45,449.348 1540.81,349.347 1543.16,298.344 1545.51,442.191 1547.86,455.19 1550.21,221.22 1552.56,254.878 1554.91,464.538 1557.26,384.588 1559.61,414.421 1561.96,445.731 1564.31,536.55 1566.66,339.025 1569.01,428.619 1571.36,253.978 1573.71,299.968 1576.06,292.167 1578.41,436.343 1580.76,295.884 1583.11,296.001 1585.46,571.824 1587.81,215.311 1590.17,469.009 1592.52,361.518 1594.87,354.435 1597.22,351.301 1599.57,284.365 1601.92,448.575 1604.27,316.74 1606.62,335.931 1608.97,483.178 1611.32,454.124 1613.67,336.199 1616.02,268.237 1618.37,498.709 1620.72,416.797 1623.07,413.591 1625.42,400.767 1627.77,406.365 1630.12,168.265 1632.47,428.32 1634.82,208.142 1637.17,477.207 1639.53,373.808 1641.88,373.559 1644.23,243.555 1646.58,583.468 1648.93,171.505 1651.28,387.763 1653.63,495.758 1655.98,365.946 1658.33,319.222 1660.68,263.437 1663.03,420.121 1665.38,466.826 1667.73,425.867 1670.08,431.141 1672.43,425.217 1674.78,185.705 1677.13,456.729 1679.48,577.572 1681.83,272.189 1684.18,291.259 1686.53,452.634 1688.89,498.882 1691.24,268.738 1693.59,165.762 1695.94,437.15 1698.29,347.138 1700.64,440.561 1702.99,418.588 1705.34,348.737 1707.69,461.653 1710.04,522.745 1712.39,415.421 1714.74,443.755 1717.09,237.213 1719.44,445.355 1721.79,455.835 1724.14,345.323 1726.49,425.068 1728.84,166.824 1731.19,255.22 1733.54,480.286 1735.89,256.363 1738.25,405.05 1740.6,198.86 1742.95,364.97 1745.3,425.518 1747.65,575.855 1750,185.866 1752.35,357.04 1754.7,390.943 1757.05,335.818 1759.4,415.079 1761.75,490.033 1764.1,320.457 1766.45,207.268 1768.8,499.162 1771.15,442.305 1773.5,485.522 1775.85,485.937 1778.2,552.381 1780.55,532.743 1782.9,449.596 1785.25,207.675 1787.6,129.31 1789.96,275.468 1792.31,603.476 1794.66,534.173 1797.01,524.306 1799.36,278.34 1801.71,306.213 1804.06,442.34 1806.41,285.141 1808.76,327.469 1811.11,200.388 1813.46,377.79 1815.81,207.953 1818.16,396.358 1820.51,192.345 1822.86,340.916 1825.21,266.928 1827.56,388.08 1829.91,297.186 1832.26,195.501 1834.61,230.837 1836.96,572.678 1839.32,442.575 1841.67,466.928 1844.02,386.916 1846.37,405.313 1848.72,229.097 1851.07,312.489 1853.42,559.991 1855.77,300.788 1858.12,447.281 1860.47,161.173 1862.82,407.832 1865.17,525.326 1867.52,370.786 1869.87,355.973 1872.22,342.378 1874.57,206.894 1876.92,433.749 1879.27,347.683 1881.62,310.102 1883.97,382.37 1886.32,282.268 1888.68,380.777 1891.03,291.74 1893.38,284.622 1895.73,528.804 1898.08,423.165 1900.43,141.856 1902.78,226.271 1905.13,517.569 1907.48,434.349 1909.83,430.993 1912.18,367.164 1914.53,348.511 1916.88,416.439 1919.23,195.414 1921.58,363.635 1923.93,311.039 1926.28,274.277 1928.63,340.454 1930.98,489.591 1933.33,303.797 1935.68,469.77 1938.04,390.401 1940.39,361.481 1942.74,334.873 1945.09,425.258 1947.44,253.837 1949.79,360.546 1952.14,337.678 1954.49,271.423 1956.84,428.448 1959.19,339.249 1961.54,539.535 1963.89,244.349 1966.24,367.405 1968.59,510.508 1970.94,448.663 1973.29,434.948 1975.64,320.921 1977.99,386.289 1980.34,329.742 1982.69,456.105 1985.04,464.852 1987.4,283.172 1989.75,237.363 1992.1,293.793 1994.45,488.518 1996.8,495.443 1999.15,388.319 2001.5,526.456 2003.85,344.626 2006.2,413.704 2008.55,459.309 2010.9,481.468 2013.25,472.992 2015.6,303.562 2017.95,375.571 2020.3,264.523 2022.65,261.651 2025,251.67 2027.35,380.671 2029.7,453.746 2032.05,221.039 2034.4,385.385 2036.76,621.474 2039.11,446.211 2041.46,485.45 2043.81,269.921 2046.16,299.765 2048.51,269.985 2050.86,388.793 2053.21,297.205 2055.56,334.909 2057.91,373.619 2060.26,161.017 2062.61,654.149 2064.96,333.717 2067.31,398.979 2069.66,400.104 2072.01,472.755 2074.36,426.605 2076.71,412.398 2079.06,272.059 2081.41,456.23 2083.76,392.937 2086.11,222.488 2088.47,503.913 2090.82,500.491 2093.17,322.88 2095.52,270.558 2097.87,251.047 2100.22,359.135 2102.57,232.417 2104.92,472.295 2107.27,470.583 2109.62,239.519 2111.97,507.735 2114.32,208.303 2116.67,354.549 2119.02,278.115 2121.37,350.056 2123.72,390.224 2126.07,477.478 2128.42,359.151 2130.77,487.083 2133.12,496.929 2135.47,420.682 2137.83,550.51 2140.18,311.486 2142.53,426.539 2144.88,346.052 2147.23,250.347 2149.58,456.772 2151.93,378.738 2154.28,334.383 2156.63,314.809 2158.98,453.502 2161.33,434.55 2163.68,536.789 2166.03,544.109 2168.38,380.909 2170.73,228.888 2173.08,422.85 2175.43,202.388 2177.78,428.135 2180.13,400.659 2182.48,326.735 2184.83,401.227 2187.19,247.268 2189.54,454.763 2191.89,440.799 2194.24,275.799 2196.59,256.449 2198.94,180.962 2201.29,460.335 2203.64,270.223 2205.99,354.791 2208.34,324.959 2210.69,322.998 2213.04,392.835 2215.39,658.787 2217.74,360.41 2220.09,179.388 2222.44,207.48 2224.79,374.787 2227.14,443.954 2229.49,364.535 2231.84,397.544 2234.19,357.526 2236.55,513.884 2238.9,491.64 2241.25,408.208 2243.6,433.78 2245.95,437.033 2248.3,377.276 2250.65,326.056 2253,419.579 2255.35,284.249 2257.7,394.532 2260.05,249.289 2262.4,355.811 2264.75,300.072 2267.1,419.815 2269.45,450.649 2271.8,384.95 2274.15,620.527 2276.5,344.967 2278.85,293.209 2281.2,348.794 2283.55,321.424 2285.91,460.284 2288.26,426.41 2290.61,270.557 2292.96,363.748 2295.31,323.937 2297.66,136.512 2300.01,609.422 2302.36,331.87 2304.71,379.443 2307.06,380.008 2309.41,368.394 2311.76,472.368 2314.11,420.974 2316.46,413.854 2318.81,342.009 2321.16,303.667 2323.51,441.698 2325.86,292.923 2328.21,301.393 2330.56,190.755 2332.91,288.779 2335.27,534.255 2337.62,299.161 2339.97,287.33 2342.32,222.548 2344.67,378.924 2347.02,362.61 2349.37,371.888 2351.72,380.92 2354.07,325.747 2356.42,420.885 2358.77,425.09 2361.12,318.102 2363.47,479.291 2365.82,449.859 2368.17,443.951 2370.52,360.931 2372.87,534.807 2375.22,517.929 2377.57,364.59 2379.92,153.97 2382.27,345.243 2384.62,275.557 2386.98,233.761 2389.33,328.135 2391.68,356.731 2394.03,289.251 2396.38,481.599 2398.73,378.743 2401.08,409.077 2403.43,336.82 2405.78,398.64 2408.13,415.814 2410.48,437.433 2412.83,289.826 2415.18,317.668 2417.53,186.127 2419.88,309.464 2422.23,493.058 2424.58,239.761 2426.93,345.574 2429.28,300.391 2431.63,333.833 2433.98,437.03 2436.34,514.922 2438.69,422.115 2441.04,425.857 2443.39,350.633 2445.74,637.303 2448.09,513.806 2450.44,333.067 2452.79,498.542 2455.14,254.949 2457.49,518.82 2459.84,421.282 2462.19,349.212 2464.54,309.622 2466.89,530.638 2469.24,428.4 2471.59,503.899 2473.94,319.375 2476.29,162.449 2478.64,381.595 2480.99,368.181 2483.34,247.747 2485.7,553.602 2488.05,390.259 2490.4,342.163 2492.75,332.395 2495.1,353.479 2497.45,389.646 2499.8,421.738 2502.15,520.745 2504.5,437.266 2506.85,291.596 2509.2,420.49 2511.55,416.531 2513.9,183.983 2516.25,346.518 2518.6,510.049 2520.95,469.977 2523.3,447.383 2525.65,461.428 2528,417.091 2530.35,247.076 2532.7,349.061 2535.06,281.758 2537.41,484.151 2539.76,301.963 2542.11,432.556 2544.46,407.179 2546.81,389.108 2549.16,431.688 2551.51,397.312 2553.86,289.239 2556.21,374.025 2558.56,428.415 2560.91,498.108 2563.26,319.995 2565.61,462.777 2567.96,242.431 2570.31,435.416 "></polyline>
</svg>
</div>
</div>
<p>Look at that! Things are working; amazin’.</p>
<p>We can also exploit <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>’s parallel sampling capabilities:</p>
<div id="34" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run separate 4 chains for 10 000 iterations using threads to parallelize.</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>num_chains <span class="op">=</span> <span class="fl">4</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    model_with_grad,</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">MCMCThreads</span>(),</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>,</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    num_chains;</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Note we need to provide an initial state for every chain.</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>    initial_state<span class="op">=</span><span class="fu">fill</span>(state, num_chains),</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>samples_array <span class="op">=</span> <span class="fu">stack</span>(<span class="fu">map</span>(<span class="bu">Base</span>.<span class="fu">Fix1</span>(stack, sample <span class="op">-&gt;</span> sample.x), samples))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000×4 Array{Float64, 3}:
[:, :, 1] =
 -1.69949   -3.11543   -5.86225  -5.82704  …  -5.30826  -6.24995   -5.40554
 -0.749978  -0.103649   1.75687   1.23189     -1.65028  -0.484039   0.241094
  2.26431    2.98351    4.68815   5.02496      3.66583   4.21693    6.21446

[:, :, 2] =
 -2.08342   -3.00633   -3.7725    -3.6184    …  -5.77272  -5.27223   -4.70792
  0.158335  -0.431816  -0.776052   0.577083      1.22584   0.168849  -0.88874
  3.60759    4.81794    5.0319     5.63508       5.2984    6.19602    4.41973

[:, :, 3] =
 -3.2861    -2.86105   -3.33491    …  -3.89581   -4.19578   -2.87476
 -0.266507  -0.554296  -0.0588986     -0.702727  -0.309399  -0.783952
  3.12552    6.02099    4.82011        4.17115    2.43179    2.84139

[:, :, 4] =
 -2.5338   -3.71184    -2.18602   -3.85823  …  -4.90414  -4.85155  -4.12743
  1.28977  -0.0898571   0.449318   1.29184      1.18888   2.21501   0.688786
  1.38782   2.43841     2.80436    4.37098      5.58636   6.23621   6.26818</code></pre>
</div>
</div>
<p>But the fact that we have to provide the <code>AbstractMCMC.sample</code> call, etc. with an <code>initial_state</code> to get started is a bit annoying. We can avoid this by also defining a <code>AbstractMCMC.step</code> <em>without</em> the <code>state</code> argument:</p>
<div id="36" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">::</span><span class="dt">MALA</span>;</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># </span><span class="al">NOTE</span><span class="co">: No state provided!</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just create the initial state by sampling using  a Gaussian.</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="fu">randn</span>(rng, LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(x), <span class="fu">MALAState</span>(x)</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Equipped with this, we no longer need to provide the <code>initial_state</code> everywhere:</p>
<div id="38" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -4.97036     1.00591
  0.00937749  1.00959
  4.98347     1.01847</code></pre>
</div>
</div>
</section>
<section id="using-our-sampler-with-turing.jl" class="level2">
<h2 class="anchored" data-anchor-id="using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</h2>
<p>As we promised, all of this hassle of implementing our <code>MALA</code> sampler in a way that uses <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> and <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> gets us something more than <em>just</em> an “automatic” implementation of <code>AbstractMCMC.sample</code>.</p>
<p>It also enables use with Turing.jl through the <code>externalsampler</code>, but we need to do one final thing first: we need to tell Turing.jl how to extract a vector of parameters from the “sample” returned in our implementation of <code>AbstractMCMC.step</code>. In our case, the “sample” is a <code>MALASample</code>, so we just need the following line:</p>
<div id="40" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load Turing.jl.</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Turing</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Overload the `getparams` method for our "sample" type, which is just a vector.</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>Turing.Inference.<span class="fu">getparams</span>(<span class="op">::</span><span class="dt">Turing.Model</span>, sample<span class="op">::</span><span class="dt">MALASample</span>) <span class="op">=</span> sample.x</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And with that, we’re good to go!</p>
<div id="42" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Our previous model defined as a Turing.jl model.</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">mvnormal_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">MvNormal</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.], I)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate our model.</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">mvnormal_model</span>()</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Call `sample` but now we're passing in a Turing.jl `model` and wrapping</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co"># our `MALA` sampler in the `externalsampler` to tell Turing.jl that the sampler</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co"># expects something that implements LogDensityProblems.jl.</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×4×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 2.49 seconds
Compute duration  = 2.49 seconds
parameters        = x[1], x[2], x[3]
internals         = lp

Summary Statistics
  parameters      mean       std      mcse    ess_bulk    ess_tail      rhat   ⋯
      Symbol   Float64   Float64   Float64     Float64     Float64   Float64   ⋯

        x[1]   -5.0154    1.0136    0.0177   3299.0401   5389.6598    1.0004   ⋯
        x[2]    0.0099    1.0047    0.0169   3546.9374   4865.8191    1.0000   ⋯
        x[3]    5.0068    1.0063    0.0179   3158.2120   5317.4986    1.0001   ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

        x[1]   -6.9922   -5.7018   -5.0226   -4.3183   -3.0390
        x[2]   -1.9985   -0.6705    0.0216    0.6839    1.9562
        x[3]    3.0990    4.3241    4.9812    5.6875    7.0157</code></pre>
</div>
</div>
<p>Pretty neat, eh?</p>
<section id="models-with-constrained-parameters" class="level3">
<h3 class="anchored" data-anchor-id="models-with-constrained-parameters">Models with constrained parameters</h3>
<p>One thing we’ve sort of glossed over in all of the above is that MALA, at least how we’ve implemented it, requires <span class="math inline">\(x\)</span> to live in <span class="math inline">\(\mathbb{R}^d\)</span> for some <span class="math inline">\(d &gt; 0\)</span>. If some of the parameters were in fact constrained, e.g.&nbsp;we were working with a <code>Beta</code> distribution which has support on the interval <span class="math inline">\((0, 1)\)</span>, <em>not</em> on <span class="math inline">\(\mathbb{R}^d\)</span>, we could easily end up outside of the valid range <span class="math inline">\((0, 1)\)</span>.</p>
<div id="44" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">beta_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">beta_model</span>()</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 1.46 seconds
Compute duration  = 1.46 seconds
parameters        = x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse    ess_bulk    ess_tail      rhat   ⋯
      Symbol   Float64   Float64   Float64     Float64     Float64   Float64   ⋯

           x    0.4999    0.1909    0.0029   4147.9540   5358.7341    1.0000   ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

           x    0.1439    0.3553    0.5000    0.6449    0.8497</code></pre>
</div>
</div>
<p>Yep, that still works, but only because Turing.jl actually <em>transforms</em> the <code>turing_model</code> from constrained to unconstrained, so that the <code>sampler</code> provided to <code>externalsampler</code> is actually always working in unconstrained space! This is not always desirable, so we can turn this off:</p>
<div id="46" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 0.25 seconds
Compute duration  = 0.25 seconds
parameters        = x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse   ess_bulk   ess_tail      rhat   e ⋯
      Symbol   Float64   Float64   Float64    Float64    Float64   Float64     ⋯

           x    0.8974    0.0604    0.0020   921.2022        NaN    1.0009     ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

           x    0.8993    0.8993    0.8993    0.8993    0.8993</code></pre>
</div>
</div>
<p>The fun thing is that this still sort of works because</p>
<div id="48" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">logpdf</span>(<span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>), <span class="fl">10.0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-Inf</code></pre>
</div>
</div>
<p>and so the samples that fall outside of the range are always rejected. But do notice how much worse all the diagnostics are, e.g.&nbsp;<code>ess_tail</code> is very poor compared to when we use <code>unconstrained=true</code>. Moreover, in more complex cases this won’t just result in a “nice” <code>-Inf</code> log-density value, but instead will error:</p>
<div id="50" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="kw">function</span> <span class="fu">demo</span>()</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>    σ² <span class="op">~</span> <span class="fu">truncated</span>(<span class="fu">Normal</span>(), lower<span class="op">=</span><span class="fl">0</span>)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If we end up with negative values for `σ²`, the `Normal` will error.</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>    x <span class="op">~</span> <span class="fu">Normal</span>(<span class="fl">0</span>, σ²)</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>DomainError: DomainError(Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}}(-2.243598275988519,1.0,0.0), "Normal: the condition σ &gt;= zero(σ) is not satisfied.")
DomainError with Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}}(-2.243598275988519,1.0,0.0):
Normal: the condition σ &gt;= zero(σ) is not satisfied.
Stacktrace:
  [1] #371
    @ ~/.julia/packages/Distributions/nmUhn/src/univariate/continuous/normal.jl:37 [inlined]
  [2] check_args
    @ ~/.julia/packages/Distributions/nmUhn/src/utils.jl:89 [inlined]
  [3] #Normal#370
    @ ~/.julia/packages/Distributions/nmUhn/src/univariate/continuous/normal.jl:37 [inlined]
  [4] Normal
    @ ~/.julia/packages/Distributions/nmUhn/src/univariate/continuous/normal.jl:36 [inlined]
  [5] Normal
    @ ~/.julia/packages/Distributions/nmUhn/src/univariate/continuous/normal.jl:42 [inlined]
  [6] macro expansion
    @ ~/.julia/packages/DynamicPPL/MjWTB/src/compiler.jl:579 [inlined]
  [7] demo(__model__::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, __varinfo__::DynamicPPL.ThreadSafeVarInfo{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}, Vector{Set{DynamicPPL.Selector}}}}, ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}, Vector{Base.RefValue{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}, __context__::DynamicPPL.DefaultContext)
    @ Main.Notebook ~/work/docs/docs/tutorials/docs-17-implementing-samplers/index.qmd:592
  [8] _evaluate!!
    @ ~/.julia/packages/DynamicPPL/MjWTB/src/model.jl:973 [inlined]
  [9] evaluate_threadsafe!!(model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, varinfo::DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}, Vector{Set{DynamicPPL.Selector}}}}, ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}, context::DynamicPPL.DefaultContext)
    @ DynamicPPL ~/.julia/packages/DynamicPPL/MjWTB/src/model.jl:962
 [10] evaluate!!
    @ ~/.julia/packages/DynamicPPL/MjWTB/src/model.jl:892 [inlined]
 [11] logdensity
    @ ~/.julia/packages/DynamicPPL/MjWTB/src/logdensityfunction.jl:140 [inlined]
 [12] Fix1
    @ ./operators.jl:1118 [inlined]
 [13] vector_mode_dual_eval!(f::Base.Fix1{typeof(LogDensityProblems.logdensity), LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, Nothing}}, cfg::ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}, x::Vector{Float64})
    @ ForwardDiff ~/.julia/packages/ForwardDiff/PcZ48/src/apiutils.jl:24
 [14] vector_mode_gradient!(result::DiffResults.MutableDiffResult{1, Float64, Tuple{Vector{Float64}}}, f::Base.Fix1{typeof(LogDensityProblems.logdensity), LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, Nothing}}, x::Vector{Float64}, cfg::ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}})
    @ ForwardDiff ~/.julia/packages/ForwardDiff/PcZ48/src/gradient.jl:96
 [15] gradient!
    @ ~/.julia/packages/ForwardDiff/PcZ48/src/gradient.jl:37 [inlined]
 [16] gradient!
    @ ~/.julia/packages/ForwardDiff/PcZ48/src/gradient.jl:35 [inlined]
 [17] logdensity_and_gradient
    @ ~/.julia/packages/LogDensityProblemsAD/rBlLq/ext/LogDensityProblemsADForwardDiffExt.jl:118 [inlined]
 [18] leapfrog_step(model::LogDensityProblemsADForwardDiffExt.ForwardDiffLogDensity{LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, Nothing}, ForwardDiff.Chunk{2}, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}, x::Vector{Float64}, p::Vector{Float64}, ϵ::Int64, M::UniformScaling{Bool})
    @ Main.Notebook ~/work/docs/docs/tutorials/docs-17-implementing-samplers/index.qmd:369
 [19] step(rng::TaskLocalRNG, model_wrapper::AbstractMCMC.LogDensityModel{LogDensityProblemsADForwardDiffExt.ForwardDiffLogDensity{LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, Nothing}, ForwardDiff.Chunk{2}, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}}, sampler::MALA{Int64, UniformScaling{Bool}}, state::MALAState{Vector{Float64}}; kwargs::@Kwargs{})
    @ Main.Notebook ~/work/docs/docs/tutorials/docs-17-implementing-samplers/index.qmd:334
 [20] step
    @ ~/work/docs/docs/tutorials/docs-17-implementing-samplers/index.qmd:316 [inlined]
 [21] #step#107
    @ ~/.julia/packages/Turing/Bv30p/src/mcmc/abstractmcmc.jl:155 [inlined]
 [22] step(rng::TaskLocalRNG, model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, sampler_wrapper::DynamicPPL.Sampler{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}, state::Turing.Inference.TuringState{MALAState{Vector{Float64}}, LogDensityProblemsADForwardDiffExt.ForwardDiffLogDensity{LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, Nothing}, ForwardDiff.Chunk{2}, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}})
    @ Turing.Inference ~/.julia/packages/Turing/Bv30p/src/mcmc/abstractmcmc.jl:144
 [23] macro expansion
    @ ~/.julia/packages/AbstractMCMC/YrmkI/src/sample.jl:176 [inlined]
 [24] macro expansion
    @ ~/.julia/packages/AbstractMCMC/YrmkI/src/logging.jl:16 [inlined]
 [25] mcmcsample(rng::TaskLocalRNG, model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, sampler::DynamicPPL.Sampler{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}, N::Int64; progress::Bool, progressname::String, callback::Nothing, discard_initial::Int64, thinning::Int64, chain_type::Type, initial_state::Nothing, kwargs::@Kwargs{})
    @ AbstractMCMC ~/.julia/packages/AbstractMCMC/YrmkI/src/sample.jl:120
 [26] sample(rng::TaskLocalRNG, model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, sampler::DynamicPPL.Sampler{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}, N::Int64; chain_type::Type, resume_from::Nothing, initial_state::Nothing, kwargs::@Kwargs{progress::Bool})
    @ DynamicPPL ~/.julia/packages/DynamicPPL/MjWTB/src/sampler.jl:93
 [27] sample
    @ ~/.julia/packages/DynamicPPL/MjWTB/src/sampler.jl:83 [inlined]
 [28] #sample#4
    @ ~/.julia/packages/Turing/Bv30p/src/mcmc/Inference.jl:276 [inlined]
 [29] sample
    @ ~/.julia/packages/Turing/Bv30p/src/mcmc/Inference.jl:267 [inlined]
 [30] #sample#3
    @ ~/.julia/packages/Turing/Bv30p/src/mcmc/Inference.jl:264 [inlined]
 [31] top-level scope
    @ ~/work/docs/docs/tutorials/docs-17-implementing-samplers/index.qmd:594</code></pre>
</div>
</div>
<p>As expected, we run into a <code>DomainError</code> at some point, while if we set <code>unconstrained=true</code>, letting Turing.jl transform the model to a unconstrained form behind the scenes, everything works as expected:</p>
<div id="52" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 0.56 seconds
Compute duration  = 0.56 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse   ess_bulk   ess_tail      rhat   e ⋯
      Symbol   Float64   Float64   Float64    Float64    Float64   Float64     ⋯

          σ²    0.1779    0.0000       NaN        NaN        NaN       NaN     ⋯
           x   -0.6679    0.0000    0.0000        NaN        NaN       NaN     ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

          σ²    0.1779    0.1779    0.1779    0.1779    0.1779
           x   -0.6679   -0.6679   -0.6679   -0.6679   -0.6679</code></pre>
</div>
</div>
<p>Neat!</p>
<p>Similarly, which automatic differentiation backend one should use can be specified through the <code>adtype</code> keyword argument too. For example, if we want to use <a href="https://github.com/JuliaDiff/ReverseDiff.jl">ReverseDiff.jl</a> instead of the default <a href="https://github.com/JuliaDiff/ForwardDiff.jl">ForwardDiff.jl</a>:</p>
<div id="54" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">ReverseDiff</span>: ReverseDiff</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify that we want to use `AutoReverseDiff`.</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">demo</span>(),</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>, adtype<span class="op">=</span><span class="fu">AutoReverseDiff</span>()),</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>;</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 2.97 seconds
Compute duration  = 2.97 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse   ess_bulk   ess_tail      rhat   e ⋯
      Symbol   Float64   Float64   Float64    Float64    Float64   Float64     ⋯

          σ²    0.8439    0.5665    0.0478    86.4816    28.9941    1.0222     ⋯
           x    0.0213    1.0624    0.0798   309.7548   125.8744    1.0305     ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

          σ²    0.0676    0.3846    0.7646    1.2010    2.1040
           x   -2.2244   -0.3919   -0.0071    0.4011    2.4057</code></pre>
</div>
</div>
<p>Double-neat.</p>
</section>
</section>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<p>At this point it’s worth maybe reminding ourselves what we did and also <em>why</em> we did it:</p>
<ol type="1">
<li>We define our models in the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface because it makes the sampler agnostic to how the underlying model is implemented.</li>
<li>We implement our sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> interface, which just means that our sampler is a subtype of <code>AbstractMCMC.AbstractSampler</code> and we implement the MCMC transition in <code>AbstractMCMC.step</code>.</li>
<li>Points 1 and 2 makes it so our sampler can be used with a wide range of model implementations, amongst them being models implemented in both Turing.jl and Stan. This gives you, the inference implementer, a large collection of models to test your inference method on, in addition to allowing users of Turing.jl and Stan to try out your inference method with minimal effort.</li>
</ol>


</section>


<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a><div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>We’re going with the leapfrog formulation because in a future version of this tutorial we’ll add a section extending this simple “baseline” MALA sampler to more complex versions. See <a href="https://github.com/TuringLang/docs/issues/479">issue #479</a> for progress on this.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>There is no such thing as a proper interface in Julia (at least not officially), and so we use the word “interface” here to mean a few minimal methods that needs to be implemented by any type that we treat as a target model.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/turinglang\.org\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../tutorials/docs-07-for-developers-variational-inference/index.html" class="pagination-link" aria-label="Variational Inference">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Variational Inference</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Turing is created by <a href="http://mlg.eng.cam.ac.uk/hong/" target="_blank">Hong Ge</a>, and lovingly maintained by the <a href="https://github.com/TuringLang/Turing.jl/graphs/contributors" target="_blank">core team</a> of volunteers. <br> The contents of this website are © 2024 under the terms of the <a href="https://github.com/TuringLang/Turing.jl/blob/master/LICENCE" target="_blank">MIT License</a>.</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/TuringLang/docs/edit/master/tutorials/docs-17-implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/docs/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://x.com/TuringLang">
      <i class="bi bi-twitter" role="img" aria-label="Turing Twitter">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/TuringLang/Turing.jl">
      <i class="bi bi-github" role="img" aria-label="Turing GitHub">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




<script src="../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>