<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Implementing Samplers – Turing.jl</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<link href="../../../developers/inference/variational-inference/index.html" rel="prev">
<link href="../../../assets/favicon.ico" rel="icon">
<script src="../../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-dark-2fef5ea3f8957b3e4ecc936fc74692ca.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap-8ca65573be89ab5a614a0758d6e79fa7.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../../site_libs/bootstrap/bootstrap-dark-e4bf857d3af38d284e31ad2f58e22145.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="../../../site_libs/bootstrap/bootstrap-8ca65573be89ab5a614a0758d6e79fa7.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<style>
  a {
    text-decoration: none;
  }
  a:hover {
    text-decoration: underline;
  }
</style>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../../theming/styles.css">
</head>

<body class="nav-sidebar floating nav-fixed quarto-light"><script id="quarto-html-before-body" type="application/javascript">
    const toggleBodyColorMode = (bsSheetEl) => {
      const mode = bsSheetEl.getAttribute("data-mode");
      const bodyEl = window.document.querySelector("body");
      if (mode === "dark") {
        bodyEl.classList.add("quarto-dark");
        bodyEl.classList.remove("quarto-light");
      } else {
        bodyEl.classList.add("quarto-light");
        bodyEl.classList.remove("quarto-dark");
      }
    }
    const toggleBodyColorPrimary = () => {
      const bsSheetEl = window.document.querySelector("link#quarto-bootstrap:not([rel=disabled-stylesheet])");
      if (bsSheetEl) {
        toggleBodyColorMode(bsSheetEl);
      }
    }
    const setColorSchemeToggle = (alternate) => {
      const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
      for (let i=0; i < toggles.length; i++) {
        const toggle = toggles[i];
        if (toggle) {
          if (alternate) {
            toggle.classList.add("alternate");
          } else {
            toggle.classList.remove("alternate");
          }
        }
      }
    };
    const toggleColorMode = (alternate) => {
      // Switch the stylesheets
      const primaryStylesheets = window.document.querySelectorAll('link.quarto-color-scheme:not(.quarto-color-alternate)');
      const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
      manageTransitions('#quarto-margin-sidebar .nav-link', false);
      if (alternate) {
        // note: dark is layered on light, we don't disable primary!
        enableStylesheet(alternateStylesheets);
        for (const sheetNode of alternateStylesheets) {
          if (sheetNode.id === "quarto-bootstrap") {
            toggleBodyColorMode(sheetNode);
          }
        }
      } else {
        disableStylesheet(alternateStylesheets);
        enableStylesheet(primaryStylesheets)
        toggleBodyColorPrimary();
      }
      manageTransitions('#quarto-margin-sidebar .nav-link', true);
      // Switch the toggles
      setColorSchemeToggle(alternate)
      // Hack to workaround the fact that safari doesn't
      // properly recolor the scrollbar when toggling (#1455)
      if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
        manageTransitions("body", false);
        window.scrollTo(0, 1);
        setTimeout(() => {
          window.scrollTo(0, 0);
          manageTransitions("body", true);
        }, 40);
      }
    }
    const disableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        stylesheet.rel = 'disabled-stylesheet';
      }
    }
    const enableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        if(stylesheet.rel !== 'stylesheet') { // for Chrome, which will still FOUC without this check
          stylesheet.rel = 'stylesheet';
        }
      }
    }
    const manageTransitions = (selector, allowTransitions) => {
      const els = window.document.querySelectorAll(selector);
      for (let i=0; i < els.length; i++) {
        const el = els[i];
        if (allowTransitions) {
          el.classList.remove('notransition');
        } else {
          el.classList.add('notransition');
        }
      }
    }
    const isFileUrl = () => {
      return window.location.protocol === 'file:';
    }
    const hasAlternateSentinel = () => {
      let styleSentinel = getColorSchemeSentinel();
      if (styleSentinel !== null) {
        return styleSentinel === "alternate";
      } else {
        return false;
      }
    }
    const setStyleSentinel = (alternate) => {
      const value = alternate ? "alternate" : "default";
      if (!isFileUrl()) {
        window.localStorage.setItem("quarto-color-scheme", value);
      } else {
        localAlternateSentinel = value;
      }
    }
    const getColorSchemeSentinel = () => {
      if (!isFileUrl()) {
        const storageValue = window.localStorage.getItem("quarto-color-scheme");
        return storageValue != null ? storageValue : localAlternateSentinel;
      } else {
        return localAlternateSentinel;
      }
    }
    const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
      const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
      const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
      let newTheme = '';
      if(authorPrefersDark) {
        newTheme = isAlternate ? baseTheme : alternateTheme;
      } else {
        newTheme = isAlternate ? alternateTheme : baseTheme;
      }
      const changeGiscusTheme = () => {
        // From: https://github.com/giscus/giscus/issues/336
        const sendMessage = (message) => {
          const iframe = document.querySelector('iframe.giscus-frame');
          if (!iframe) return;
          iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
        }
        sendMessage({
          setConfig: {
            theme: newTheme
          }
        });
      }
      const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
      if (isGiscussLoaded) {
        changeGiscusTheme();
      }
    };
    const authorPrefersDark = false;
    const darkModeDefault = authorPrefersDark;
      document.querySelector('link#quarto-text-highlighting-styles.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
      document.querySelector('link#quarto-bootstrap.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
    let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
    // Dark / light mode switch
    window.quartoToggleColorScheme = () => {
      // Read the current dark / light value
      let toAlternate = !hasAlternateSentinel();
      toggleColorMode(toAlternate);
      setStyleSentinel(toAlternate);
      toggleGiscusIfUsed(toAlternate, darkModeDefault);
      window.dispatchEvent(new Event('resize'));
    };
    // Switch to dark mode if need be
    if (hasAlternateSentinel()) {
      toggleColorMode(true);
    } else {
      toggleColorMode(false);
    }
  </script>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="https://turinglang.org/" class="navbar-brand navbar-brand-logo">
    <img src="../../../assets/images/turing-logo.svg" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="https://turinglang.org/">
    <span class="navbar-title">Turing.jl</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../getting-started/"> 
<span class="menu-text">Get Started</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../tutorials/coin-flipping/"> 
<span class="menu-text">Tutorials</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/library/"> 
<span class="menu-text">Libraries</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/news/"> 
<span class="menu-text">News</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/team/"> 
<span class="menu-text">Team</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-v0.39" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">v0.39</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-v0.39">    
        <li>
    <a class="dropdown-item" href="https://turinglang.org/docs/changelog.html">
 <span class="dropdown-text">Changelog</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://turinglang.org/docs/versions.html">
 <span class="dropdown-text">All Versions</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools tools-wide">
    <a href="https://x.com/TuringLang" title="Turing Twitter" class="quarto-navigation-tool px-1" aria-label="Turing Twitter"><i class="bi bi-twitter"></i></a>
    <a href="https://github.com/TuringLang/Turing.jl" title="Turing GitHub" class="quarto-navigation-tool px-1" aria-label="Turing GitHub"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../../developers/contributing/index.html">Developers</a></li><li class="breadcrumb-item"><a href="../../../developers/inference/variational-inference/index.html">Inference in Detail</a></li><li class="breadcrumb-item"><a href="../../../developers/inference/implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../getting-started/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Getting Started</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../core-functionality/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Core Functionality</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false">
 <span class="menu-text">User Guide</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/automatic-differentiation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Automatic Differentiation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/submodels/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Submodels</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/custom-distribution/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Custom Distributions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/probability-interface/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Querying Model Probabilities</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/modifying-logprob/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Modifying the Log Probability</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/tracking-extra-quantities/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Tracking Extra Quantities</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/mode-estimation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Mode Estimation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/performance-tips/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Performance Tips</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/sampler-visualisation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Sampler Visualization</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/dynamichmc/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using DynamicHMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/external-samplers/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using External Samplers</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/troubleshooting/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Troubleshooting</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false">
 <span class="menu-text">Tutorials</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/coin-flipping/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction: Coin Flipping</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/gaussian-mixture-models/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Mixture Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-neural-networks/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Neural Networks</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/hidden-markov-models/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Hidden Markov Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-linear-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Linear Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/infinite-mixture-models/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Infinite Mixture Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-poisson-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Poisson Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/multinomial-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Multinomial Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-differential-equations/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Differential Equations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/probabilistic-pca/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Probabilistic PCA</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-time-series-analysis/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Time Series Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/gaussian-processes-introduction/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Processes: Introduction</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/gaussian-process-latent-variable-models/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Process Latent Variable Models</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Developers</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/contributing/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Contributing</span></a>
  </div>
</li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false">
 <span class="menu-text">DynamicPPL’s Compiler</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/compiler/model-manual/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Manually Defining a Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/compiler/minituring-compiler/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation I: Compiler</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/compiler/minituring-contexts/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation II: Contexts</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/compiler/design-overview/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Turing Compiler Design (Outdated)</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false">
 <span class="menu-text">DynamicPPL Contexts</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/contexts/submodel-condition/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Conditioning and fixing in submodels</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="false">
 <span class="menu-text">Variable Transformations</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/transforms/distributions/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Distributions and the Jacobian</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/transforms/bijectors/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bijectors in MCMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/transforms/dynamicppl/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variable transformations in DynamicPPL</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true">
 <span class="menu-text">Inference in Detail</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/inference/variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/inference/implementing-samplers/index.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Implementing Samplers</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of Contents</h2>
   
  <ul>
  <li><a href="#quick-overview-of-mala" id="toc-quick-overview-of-mala" class="nav-link active" data-scroll-target="#quick-overview-of-mala">Quick overview of MALA</a></li>
  <li><a href="#what-we-need-from-a-model-logdensityproblems.jl" id="toc-what-we-need-from-a-model-logdensityproblems.jl" class="nav-link" data-scroll-target="#what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: LogDensityProblems.jl</a></li>
  <li><a href="#implementing-mala-in-abstractmcmc.jl" id="toc-implementing-mala-in-abstractmcmc.jl" class="nav-link" data-scroll-target="#implementing-mala-in-abstractmcmc.jl">Implementing MALA in AbstractMCMC.jl</a></li>
  <li><a href="#using-our-sampler-with-turing.jl" id="toc-using-our-sampler-with-turing.jl" class="nav-link" data-scroll-target="#using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</a>
  <ul class="collapse">
  <li><a href="#models-with-constrained-parameters" id="toc-models-with-constrained-parameters" class="nav-link" data-scroll-target="#models-with-constrained-parameters">Models with constrained parameters</a></li>
  </ul></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/TuringLang/docs/edit/main/developers/inference/implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/docs/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">


<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../../developers/contributing/index.html">Developers</a></li><li class="breadcrumb-item"><a href="../../../developers/inference/variational-inference/index.html">Inference in Detail</a></li><li class="breadcrumb-item"><a href="../../../developers/inference/implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Implementing Samplers</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>In this tutorial, we’ll go through step-by-step how to implement a “simple” sampler in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> in such a way that it can be easily applied to Turing.jl models.</p>
<p>In particular, we’re going to implement a version of <strong>Metropolis-adjusted Langevin (MALA)</strong>.</p>
<p>Note that we will implement this sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> framework, completely “ignoring” Turing.jl until the very end of the tutorial, at which point we’ll use a single line of code to make the resulting sampler available to Turing.jl. This is to really drive home the point that one can implement samplers in a way that is accessible to all of Turing.jl’s users without having to use Turing.jl yourself.</p>
<section id="quick-overview-of-mala" class="level2">
<h2 class="anchored" data-anchor-id="quick-overview-of-mala">Quick overview of MALA</h2>
<p>We can view MALA as a single step of the leapfrog intergrator with resampling of momentum <span class="math inline">\(p\)</span> at every step.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> To make that statement a bit more concrete, we first define the <em>extended</em> target <span class="math inline">\(\bar{\gamma}(x, p)\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\log \bar{\gamma}(x, p) \propto \log \gamma(x) + \log \gamma_{\mathcal{N}(0, M)}(p)
\end{equation*}\]</span></p>
<p>where <span class="math inline">\(\gamma_{\mathcal{N}(0, M)}\)</span> denotes the density for a zero-centered Gaussian with covariance matrix <span class="math inline">\(M\)</span>. We then consider targeting this joint distribution over both <span class="math inline">\(x\)</span> and <span class="math inline">\(p\)</span> as follows. First we define the map</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  L_{\epsilon}: \quad &amp; \mathbb{R}^d \times \mathbb{R}^d \to \mathbb{R}^d \times \mathbb{R}^d \\
  &amp; (x, p) \mapsto (\tilde{x}, \tilde{p}) := L_{\epsilon}(x, p)
\end{split}
\end{equation*}\]</span></p>
<p>as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p_{1 / 2} &amp;:= p + \frac{\epsilon}{2} \nabla \log \gamma(x) \\
  \tilde{x} &amp;:= x + \epsilon M^{-1} p_{1 /2 } \\
  p_1 &amp;:= p_{1 / 2} + \frac{\epsilon}{2} \nabla \log \gamma(\tilde{x}) \\
  \tilde{p} &amp;:= - p_1
\end{split}
\end{equation*}\]</span></p>
<p>This might be familiar for some readers as a single step of the Leapfrog integrator. We then define the MALA kernel as follows: given the current iterate <span class="math inline">\(x_i\)</span>, we sample the next iterate <span class="math inline">\(x_{i + 1}\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p &amp;\sim \mathcal{N}(0, M) \\
  (\tilde{x}, \tilde{p}) &amp;:= L_{\epsilon}(x_i, p) \\
  \alpha &amp;:= \min \left\{ 1, \frac{\bar{\gamma}(\tilde{x}, \tilde{p})}{\bar{\gamma}(x_i, p)} \right\} \\
  x_{i + 1} &amp;:=
  \begin{cases}
    \tilde{x} \quad &amp; \text{ with prob. } \alpha \\
    x_i       \quad &amp; \text{ with prob. } 1 - \alpha
  \end{cases}
\end{split}
\end{equation*}\]</span></p>
<p>i.e.&nbsp;we accept the proposal <span class="math inline">\(\tilde{x}\)</span> with probability <span class="math inline">\(\alpha\)</span> and reject it, thus sticking with our current iterate, with probability <span class="math inline">\(1 - \alpha\)</span>.</p>
</section>
<section id="what-we-need-from-a-model-logdensityproblems.jl" class="level2">
<h2 class="anchored" data-anchor-id="what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a></h2>
<p>There are a few things we need from the “target” / “model” / density that we want to sample from:</p>
<ol type="1">
<li>We need access to log-density <em>evaluations</em> <span class="math inline">\(\log \gamma(x)\)</span> so we can compute the acceptance ratio involving <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>We need access to log-density <em>gradients</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span> so we can compute the Leapfrog steps <span class="math inline">\(L_{\epsilon}(x, p)\)</span>.</li>
<li>We also need access to the “size” of the model so we can determine the size of <span class="math inline">\(M\)</span>.</li>
</ol>
<p>Luckily for us, there is a package called <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> which provides an interface for <em>exactly</em> this!</p>
<p>To demonstrate how one can implement the “<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface”<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> we will use a simple Gaussian model as an example:</p>
<div id="4" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblems</span>: LogDensityProblems;</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's define some type that represents the model.</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> IsotropicNormalModel{M<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"mean of the isotropic Gaussian"</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    mean<span class="op">::</span><span class="dt">M</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Specifies what input length the model expects.</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">dimension</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> <span class="fu">length</span>(model.mean)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Implementation of the log-density evaluation of the model.</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x<span class="op">::</span><span class="dt">AbstractVector{&lt;:Real}</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">-</span> <span class="fu">sum</span>(abs2, x <span class="op">.-</span> model.mean) <span class="op">/</span> <span class="fl">2</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This gives us all of the properties we want for our MALA sampler with the exception of the computation of the <em>gradient</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span>. There is the method <code>LogDensityProblems.logdensity_and_gradient</code> which should return a 2-tuple where the first entry is the evaluation of the logdensity <span class="math inline">\(\log \gamma(x)\)</span> and the second entry is the gradient <span class="math inline">\(\nabla \log \gamma(x)\)</span>.</p>
<p>There are two ways to “implement” this method: 1) we implement it by hand, which is feasible in the case of our <code>IsotropicNormalModel</code>, or b) we defer the implementation of this to a automatic differentiation backend.</p>
<p>To implement it by hand we can simply do</p>
<div id="6" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl that first-order, i.e. gradient information, is available.</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{1}</span>()</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Implement `logdensity_and_gradient`.</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    logγ_x <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="op">-</span>x <span class="op">.*</span> (x <span class="op">-</span> model.mean)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> logγ_x, ∇logγ_x</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s just try it out:</p>
<div id="8" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate the problem.</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> <span class="fu">IsotropicNormalModel</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.])</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create some example input that we can test on.</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>x_example <span class="op">=</span> <span class="fu">randn</span>(LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate!</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-25.867924964225004</code></pre>
</div>
</div>
<p>To defer it to an automatic differentiation backend, we can do</p>
<div id="10" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl we only have access to 0-th order information.</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{0}</span>()</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Use `LogDensityProblemsAD`'s `ADgradient` in combination with some AD backend to implement `logdensity_and_gradient`.</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblemsAD</span>, <span class="bu">ADTypes</span>, <span class="bu">ForwardDiff</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>model_with_grad <span class="op">=</span> <span class="fu">ADgradient</span>(<span class="fu">AutoForwardDiff</span>(), model)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model_with_grad, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-25.867924964225004</code></pre>
</div>
</div>
<p>We’ll continue with the second approach in this tutorial since this is typically what one does in practice, because there are better hobbies to spend time on than deriving gradients by hand.</p>
<p>At this point, one might wonder how we’re going to tie this back to Turing.jl in the end. Effectively, when working with inference methods that only require log-density evaluations and / or higher-order information of the log-density, Turing.jl actually converts the user-provided <code>Model</code> into an object implementing the above methods for <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>. As a result, most samplers provided by Turing.jl are actually implemented to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, enabling their use both <em>within</em> Turing.jl and <em>outside</em> of Turing.jl! Morever, there exists similar conversions for Stan through BridgeStan and Stan<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, which means that a sampler supporting the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface can easily be used on both Turing.jl <em>and</em> Stan models (in addition to user-provided models, as our <code>IsotropicNormalModel</code> above)!</p>
<p>Anyways, let’s move on to actually implementing the sampler.</p>
</section>
<section id="implementing-mala-in-abstractmcmc.jl" class="level2">
<h2 class="anchored" data-anchor-id="implementing-mala-in-abstractmcmc.jl">Implementing MALA in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a></h2>
<p>Now that we’ve established that a model implementing the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface provides us with all the information we need from <span class="math inline">\(\log \gamma(x)\)</span>, we can address the question: given an object that implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, how can we define a sampler for it?</p>
<p>We’re going to do this by making our sampler a sub-type of <code>AbstractMCMC.AbstractSampler</code> in addition to implementing a few methods from <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>. Why? Because it gets us <em>a lot</em> of functionality for free, as we will see later.</p>
<p>Moreover, <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> provides a very natural interface for MCMC algorithms.</p>
<p>First, we’ll define our <code>MALA</code> type</p>
<div id="12" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">AbstractMCMC</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALA{T,A} <span class="op">&lt;:</span><span class="dt"> AbstractMCMC.AbstractSampler</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"stepsize used in the leapfrog step"</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    ϵ_init<span class="op">::</span><span class="dt">T</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"covariance matrix used for the momentum"</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    M_init<span class="op">::</span><span class="dt">A</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notice how we’ve added the suffix <code>_init</code> to both the stepsize and the covariance matrix. We’ve done this because a <code>AbstractMCMC.AbstractSampler</code> should be <em>immutable</em>. Of course there might be many scenarios where we want to allow something like the stepsize and / or the covariance matrix to vary between iterations, e.g.&nbsp;during the burn-in / adaptation phase of the sampling process we might want to adjust the parameters using statistics computed from these initial iterations. But information which can change between iterations <em>should not go in the sampler itself</em>! Instead, this information should go in the sampler <em>state</em>.</p>
<p>The sampler state should at the very least contain all the necessary information to perform the next MCMC iteration, but usually contains further information, e.g.&nbsp;quantities and statistics useful for evaluating whether the sampler has converged.</p>
<p>We will use the following sampler state for our <code>MALA</code> sampler:</p>
<div id="14" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALAState{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This might seem overly redundant: we’re defining a type <code>MALAState</code> and it only contains a simple vector of reals. In this particular case we indeed could have dropped this and simply used a <code>AbstractVector{&lt;:Real}</code> as our sampler state, but typically, as we will see later, one wants to include other quantities in the sampler state. For example, if we also wanted to adapt the parameters of our <code>MALA</code>, e.g.&nbsp;alter the stepsize depending on acceptance rates, in which case we should also put <code>ϵ</code> in the state, but for now we’ll keep things simple.</p>
<p>Moreover, we also want a <em>sample</em> type, which is a type meant for “public consumption”, i.e.&nbsp;the end-user. This is generally going to contain a subset of the information present in the state. But in such a simple scenario as this, we similarly only have a <code>AbstractVector{&lt;:Real}</code>:</p>
<div id="16" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALASample{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We currently have three things:</p>
<ol type="1">
<li>A <code>AbstractMCMC.AbstractSampler</code> implementation called <code>MALA</code>.</li>
<li>A state <code>MALAState</code> for our sampler <code>MALA</code>.</li>
<li>A sample <code>MALASample</code> for our sampler <code>MALA</code>.</li>
</ol>
<p>That means that we’re ready to implement the only thing that really matters: <code>AbstractMCMC.step</code>.</p>
<p><code>AbstractMCMC.step</code> defines the MCMC iteration of our <code>MALA</code> given the current <code>MALAState</code>. Specifically, the signature of the function is as follows:</p>
<div id="18" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The RNG to ensure reproducibility.</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The model that defines our target.</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.AbstractModel</span>,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The sampler for which we're taking a `step`.</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">AbstractMCMC.AbstractSampler</span>,</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The current sampler `state`.</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    state;</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Additional keyword arguments that we may or may not need.</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Moreover, there is a specific <code>AbstractMCMC.AbstractModel</code> which is used to indicate that the model that is provided implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface: <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Since, as we discussed earlier, in our case we’re indeed going to work with types that support the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, we’ll define <code>AbstractMCMC.step</code> for such a <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Note that <code>AbstractMCMC.LogDensityModel</code> has no other purpose; it has a single field called <code>logdensity</code>, and it does nothing else. But by wrapping the model in <code>AbstractMCMC.LogDensityModel</code>, it allows samplers that want to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> to define their <code>AbstractMCMC.step</code> on this type without running into method ambiguities.</p>
<p>All in all, that means that the signature for our <code>AbstractMCMC.step</code> is going to be the following:</p>
<div id="20" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># `LogDensityModel` so we know we're working with LogDensityProblems.jl model.</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler.</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler state.</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Great! Now let’s actually implement the full <code>AbstractMCMC.step</code> for our <code>MALA</code>.</p>
<p>Let’s remind ourselves what we’re going to do:</p>
<ol type="1">
<li>Sample a new momentum <span class="math inline">\(p\)</span>.</li>
<li>Compute the log-density of the extended target <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>Take a single leapfrog step <span class="math inline">\((\tilde{x}, \tilde{p}) = L_{\epsilon}(x, p)\)</span>.</li>
<li>Accept or reject the proposed <span class="math inline">\((\tilde{x}, \tilde{p})\)</span>.</li>
</ol>
<p>All in all, this results in the following:</p>
<div id="22" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>: Random</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Distributions</span>  <span class="co"># so we get the `MvNormal`</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the wrapped model which implements LogDensityProblems.jl.</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just extract the sampler parameters to make our lives easier.</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    ϵ <span class="op">=</span> sampler.ϵ_init</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    M <span class="op">=</span> sampler.M_init</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the current parameters.</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> state.x</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sample the momentum.</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>    p_dist <span class="op">=</span> <span class="fu">MvNormal</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)), M)</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> <span class="fu">rand</span>(rng, p_dist)</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Propose using a single leapfrog step.</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>    x̃, p̃ <span class="op">=</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Accept or reject proposal.</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>    logp <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p)</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>    logp̃ <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x̃) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p̃)</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>    logα <span class="op">=</span> logp̃ <span class="op">-</span> logp</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>    state_new <span class="op">=</span> <span class="cf">if</span> <span class="fu">log</span>(<span class="fu">rand</span>(rng)) <span class="op">&lt;</span> logα</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Accept.</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x̃)</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Reject.</span></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x)</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return the "sample" and the sampler state.</span></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(state_new.x), state_new</span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Fairly straight-forward.</p>
<p>Of course, we haven’t defined the <code>leapfrog_step</code> method yet, so let’s do that:</p>
<div id="24" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p` using "position" `x`.</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x))</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    p1 <span class="op">=</span> p <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update the "position" `x` using momentum `p1`.</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    x̃ <span class="op">=</span> x <span class="op">+</span> ϵ <span class="op">.*</span> (M <span class="op">\</span> p1)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p1` using position `x̃`</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x̃ <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x̃))</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    p2 <span class="op">=</span> p1 <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x̃</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Flip momentum `p2`.</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    p̃ <span class="op">=</span> <span class="op">-</span>p2</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x̃, p̃</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>leapfrog_step (generic function with 1 method)</code></pre>
</div>
</div>
<p>With all of this, we’re technically ready to sample!</p>
<div id="26" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>, <span class="bu">LinearAlgebra</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>rng <span class="op">=</span> <span class="bu">Random</span>.<span class="fu">default_rng</span>()</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>sampler <span class="op">=</span> <span class="fu">MALA</span>(<span class="fl">1</span>, I)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>state <span class="op">=</span> <span class="fu">MALAState</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)))</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>x_next, state_next <span class="op">=</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    rng,</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    AbstractMCMC.<span class="fu">LogDensityModel</span>(model),</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    state</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>(MALASample{Vector{Float64}}([0.6963461759993919, 0.6186798607988345, 0.9683821401542144]), MALAState{Vector{Float64}}([0.6963461759993919, 0.6186798607988345, 0.9683821401542144]))</code></pre>
</div>
</div>
<p>Great, it works!</p>
<p>And I promised we would get quite some functionality for free if we implemented <code>AbstractMCMC.step</code>, and so we can now simply call <code>sample</code> to perform standard MCMC sampling:</p>
<div id="28" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform 1000 iterations with our `MALA` sampler.</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; initial_state<span class="op">=</span>state, progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Concatenate into a matrix.</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000 Matrix{Float64}:
 -2.31675    -4.70659  -7.84638   …  -5.34761   -5.34761   -5.34761
  0.0679182   1.23129   0.807272     -0.431818  -0.431818  -0.431818
  3.49735     2.53781   4.28194       4.00721    4.00721    4.00721</code></pre>
</div>
</div>
<div id="30" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the marginal means and standard deviations.</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -5.0013      0.985578
 -0.00558098  0.994932
  5.0278      0.98988</code></pre>
</div>
</div>
<p>Let’s visualize the samples</p>
<div id="32" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">StatsPlots</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">transpose</span>(samples_matrix[<span class="op">:</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">:</span><span class="kw">end</span>]), alpha<span class="op">=</span><span class="fl">0.5</span>, legend<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<!--?xml version="1.0" encoding="utf-8"?-->
<svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" width="672" height="480" viewbox="0 0 2688 1920">
<defs>
  <clippath id="clip440">
    <rect x="0" y="0" width="2688" height="1920"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip440)" d="M0 1920 L2688 1920 L2688 0 L0 0  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip441">
    <rect x="537" y="0" width="1883" height="1883"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip440)" d="M151.747 1800.78 L2640.76 1800.78 L2640.76 47.2441 L151.747 47.2441  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip442">
    <rect x="151" y="47" width="2490" height="1755"></rect>
  </clippath>
</defs>
<polyline clip-path="url(#clip442)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="219.84,1800.78 219.84,47.2441 "></polyline>
<polyline clip-path="url(#clip442)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="807.458,1800.78 807.458,47.2441 "></polyline>
<polyline clip-path="url(#clip442)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1395.08,1800.78 1395.08,47.2441 "></polyline>
<polyline clip-path="url(#clip442)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1982.69,1800.78 1982.69,47.2441 "></polyline>
<polyline clip-path="url(#clip442)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="2570.31,1800.78 2570.31,47.2441 "></polyline>
<polyline clip-path="url(#clip442)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,1532.83 2640.76,1532.83 "></polyline>
<polyline clip-path="url(#clip442)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,1227.83 2640.76,1227.83 "></polyline>
<polyline clip-path="url(#clip442)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,922.827 2640.76,922.827 "></polyline>
<polyline clip-path="url(#clip442)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,617.824 2640.76,617.824 "></polyline>
<polyline clip-path="url(#clip442)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,312.821 2640.76,312.821 "></polyline>
<polyline clip-path="url(#clip440)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1800.78 2640.76,1800.78 "></polyline>
<polyline clip-path="url(#clip440)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="219.84,1800.78 219.84,1781.88 "></polyline>
<polyline clip-path="url(#clip440)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="807.458,1800.78 807.458,1781.88 "></polyline>
<polyline clip-path="url(#clip440)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1395.08,1800.78 1395.08,1781.88 "></polyline>
<polyline clip-path="url(#clip440)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1982.69,1800.78 1982.69,1781.88 "></polyline>
<polyline clip-path="url(#clip440)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="2570.31,1800.78 2570.31,1781.88 "></polyline>
<path clip-path="url(#clip440)" d="M219.84 1834 Q216.229 1834 214.4 1837.57 Q212.595 1841.11 212.595 1848.24 Q212.595 1855.34 214.4 1858.91 Q216.229 1862.45 219.84 1862.45 Q223.474 1862.45 225.28 1858.91 Q227.108 1855.34 227.108 1848.24 Q227.108 1841.11 225.28 1837.57 Q223.474 1834 219.84 1834 M219.84 1830.3 Q225.65 1830.3 228.706 1834.9 Q231.784 1839.49 231.784 1848.24 Q231.784 1856.96 228.706 1861.57 Q225.65 1866.15 219.84 1866.15 Q214.03 1866.15 210.951 1861.57 Q207.896 1856.96 207.896 1848.24 Q207.896 1839.49 210.951 1834.9 Q214.03 1830.3 219.84 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip440)" d="M771.15 1861.55 L787.47 1861.55 L787.47 1865.48 L765.525 1865.48 L765.525 1861.55 Q768.187 1858.79 772.771 1854.16 Q777.377 1849.51 778.558 1848.17 Q780.803 1845.65 781.683 1843.91 Q782.585 1842.15 782.585 1840.46 Q782.585 1837.71 780.641 1835.97 Q778.72 1834.23 775.618 1834.23 Q773.419 1834.23 770.965 1835 Q768.535 1835.76 765.757 1837.31 L765.757 1832.59 Q768.581 1831.46 771.035 1830.88 Q773.488 1830.3 775.525 1830.3 Q780.896 1830.3 784.09 1832.98 Q787.285 1835.67 787.285 1840.16 Q787.285 1842.29 786.474 1844.21 Q785.687 1846.11 783.581 1848.7 Q783.002 1849.37 779.9 1852.59 Q776.798 1855.78 771.15 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip440)" d="M797.331 1830.92 L815.687 1830.92 L815.687 1834.86 L801.613 1834.86 L801.613 1843.33 Q802.632 1842.98 803.65 1842.82 Q804.669 1842.64 805.687 1842.64 Q811.474 1842.64 814.854 1845.81 Q818.233 1848.98 818.233 1854.4 Q818.233 1859.97 814.761 1863.08 Q811.289 1866.15 804.97 1866.15 Q802.794 1866.15 800.525 1865.78 Q798.28 1865.41 795.872 1864.67 L795.872 1859.97 Q797.956 1861.11 800.178 1861.66 Q802.4 1862.22 804.877 1862.22 Q808.882 1862.22 811.22 1860.11 Q813.558 1858.01 813.558 1854.4 Q813.558 1850.78 811.22 1848.68 Q808.882 1846.57 804.877 1846.57 Q803.002 1846.57 801.127 1846.99 Q799.275 1847.4 797.331 1848.28 L797.331 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip440)" d="M837.446 1834 Q833.835 1834 832.007 1837.57 Q830.201 1841.11 830.201 1848.24 Q830.201 1855.34 832.007 1858.91 Q833.835 1862.45 837.446 1862.45 Q841.081 1862.45 842.886 1858.91 Q844.715 1855.34 844.715 1848.24 Q844.715 1841.11 842.886 1837.57 Q841.081 1834 837.446 1834 M837.446 1830.3 Q843.256 1830.3 846.312 1834.9 Q849.391 1839.49 849.391 1848.24 Q849.391 1856.96 846.312 1861.57 Q843.256 1866.15 837.446 1866.15 Q831.636 1866.15 828.557 1861.57 Q825.502 1856.96 825.502 1848.24 Q825.502 1839.49 828.557 1834.9 Q831.636 1830.3 837.446 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip440)" d="M1354.69 1830.92 L1373.05 1830.92 L1373.05 1834.86 L1358.98 1834.86 L1358.98 1843.33 Q1360 1842.98 1361.01 1842.82 Q1362.03 1842.64 1363.05 1842.64 Q1368.84 1842.64 1372.22 1845.81 Q1375.6 1848.98 1375.6 1854.4 Q1375.6 1859.97 1372.12 1863.08 Q1368.65 1866.15 1362.33 1866.15 Q1360.16 1866.15 1357.89 1865.78 Q1355.64 1865.41 1353.24 1864.67 L1353.24 1859.97 Q1355.32 1861.11 1357.54 1861.66 Q1359.76 1862.22 1362.24 1862.22 Q1366.25 1862.22 1368.58 1860.11 Q1370.92 1858.01 1370.92 1854.4 Q1370.92 1850.78 1368.58 1848.68 Q1366.25 1846.57 1362.24 1846.57 Q1360.37 1846.57 1358.49 1846.99 Q1356.64 1847.4 1354.69 1848.28 L1354.69 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip440)" d="M1394.81 1834 Q1391.2 1834 1389.37 1837.57 Q1387.56 1841.11 1387.56 1848.24 Q1387.56 1855.34 1389.37 1858.91 Q1391.2 1862.45 1394.81 1862.45 Q1398.44 1862.45 1400.25 1858.91 Q1402.08 1855.34 1402.08 1848.24 Q1402.08 1841.11 1400.25 1837.57 Q1398.44 1834 1394.81 1834 M1394.81 1830.3 Q1400.62 1830.3 1403.68 1834.9 Q1406.75 1839.49 1406.75 1848.24 Q1406.75 1856.96 1403.68 1861.57 Q1400.62 1866.15 1394.81 1866.15 Q1389 1866.15 1385.92 1861.57 Q1382.87 1856.96 1382.87 1848.24 Q1382.87 1839.49 1385.92 1834.9 Q1389 1830.3 1394.81 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip440)" d="M1424.97 1834 Q1421.36 1834 1419.53 1837.57 Q1417.73 1841.11 1417.73 1848.24 Q1417.73 1855.34 1419.53 1858.91 Q1421.36 1862.45 1424.97 1862.45 Q1428.61 1862.45 1430.41 1858.91 Q1432.24 1855.34 1432.24 1848.24 Q1432.24 1841.11 1430.41 1837.57 Q1428.61 1834 1424.97 1834 M1424.97 1830.3 Q1430.78 1830.3 1433.84 1834.9 Q1436.92 1839.49 1436.92 1848.24 Q1436.92 1856.96 1433.84 1861.57 Q1430.78 1866.15 1424.97 1866.15 Q1419.16 1866.15 1416.08 1861.57 Q1413.03 1856.96 1413.03 1848.24 Q1413.03 1839.49 1416.08 1834.9 Q1419.16 1830.3 1424.97 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip440)" d="M1940.97 1830.92 L1963.19 1830.92 L1963.19 1832.91 L1950.65 1865.48 L1945.76 1865.48 L1957.57 1834.86 L1940.97 1834.86 L1940.97 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip440)" d="M1972.36 1830.92 L1990.71 1830.92 L1990.71 1834.86 L1976.64 1834.86 L1976.64 1843.33 Q1977.66 1842.98 1978.68 1842.82 Q1979.7 1842.64 1980.72 1842.64 Q1986.5 1842.64 1989.88 1845.81 Q1993.26 1848.98 1993.26 1854.4 Q1993.26 1859.97 1989.79 1863.08 Q1986.32 1866.15 1980 1866.15 Q1977.82 1866.15 1975.55 1865.78 Q1973.31 1865.41 1970.9 1864.67 L1970.9 1859.97 Q1972.98 1861.11 1975.21 1861.66 Q1977.43 1862.22 1979.9 1862.22 Q1983.91 1862.22 1986.25 1860.11 Q1988.59 1858.01 1988.59 1854.4 Q1988.59 1850.78 1986.25 1848.68 Q1983.91 1846.57 1979.9 1846.57 Q1978.03 1846.57 1976.15 1846.99 Q1974.3 1847.4 1972.36 1848.28 L1972.36 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip440)" d="M2012.47 1834 Q2008.86 1834 2007.03 1837.57 Q2005.23 1841.11 2005.23 1848.24 Q2005.23 1855.34 2007.03 1858.91 Q2008.86 1862.45 2012.47 1862.45 Q2016.11 1862.45 2017.91 1858.91 Q2019.74 1855.34 2019.74 1848.24 Q2019.74 1841.11 2017.91 1837.57 Q2016.11 1834 2012.47 1834 M2012.47 1830.3 Q2018.28 1830.3 2021.34 1834.9 Q2024.42 1839.49 2024.42 1848.24 Q2024.42 1856.96 2021.34 1861.57 Q2018.28 1866.15 2012.47 1866.15 Q2006.66 1866.15 2003.59 1861.57 Q2000.53 1856.96 2000.53 1848.24 Q2000.53 1839.49 2003.59 1834.9 Q2006.66 1830.3 2012.47 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip440)" d="M2514.84 1861.55 L2522.48 1861.55 L2522.48 1835.18 L2514.17 1836.85 L2514.17 1832.59 L2522.43 1830.92 L2527.11 1830.92 L2527.11 1861.55 L2534.75 1861.55 L2534.75 1865.48 L2514.84 1865.48 L2514.84 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip440)" d="M2554.19 1834 Q2550.58 1834 2548.75 1837.57 Q2546.94 1841.11 2546.94 1848.24 Q2546.94 1855.34 2548.75 1858.91 Q2550.58 1862.45 2554.19 1862.45 Q2557.82 1862.45 2559.63 1858.91 Q2561.46 1855.34 2561.46 1848.24 Q2561.46 1841.11 2559.63 1837.57 Q2557.82 1834 2554.19 1834 M2554.19 1830.3 Q2560 1830.3 2563.06 1834.9 Q2566.13 1839.49 2566.13 1848.24 Q2566.13 1856.96 2563.06 1861.57 Q2560 1866.15 2554.19 1866.15 Q2548.38 1866.15 2545.3 1861.57 Q2542.25 1856.96 2542.25 1848.24 Q2542.25 1839.49 2545.3 1834.9 Q2548.38 1830.3 2554.19 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip440)" d="M2584.35 1834 Q2580.74 1834 2578.91 1837.57 Q2577.11 1841.11 2577.11 1848.24 Q2577.11 1855.34 2578.91 1858.91 Q2580.74 1862.45 2584.35 1862.45 Q2587.99 1862.45 2589.79 1858.91 Q2591.62 1855.34 2591.62 1848.24 Q2591.62 1841.11 2589.79 1837.57 Q2587.99 1834 2584.35 1834 M2584.35 1830.3 Q2590.16 1830.3 2593.22 1834.9 Q2596.3 1839.49 2596.3 1848.24 Q2596.3 1856.96 2593.22 1861.57 Q2590.16 1866.15 2584.35 1866.15 Q2578.54 1866.15 2575.46 1861.57 Q2572.41 1856.96 2572.41 1848.24 Q2572.41 1839.49 2575.46 1834.9 Q2578.54 1830.3 2584.35 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip440)" d="M2614.51 1834 Q2610.9 1834 2609.07 1837.57 Q2607.27 1841.11 2607.27 1848.24 Q2607.27 1855.34 2609.07 1858.91 Q2610.9 1862.45 2614.51 1862.45 Q2618.15 1862.45 2619.95 1858.91 Q2621.78 1855.34 2621.78 1848.24 Q2621.78 1841.11 2619.95 1837.57 Q2618.15 1834 2614.51 1834 M2614.51 1830.3 Q2620.32 1830.3 2623.38 1834.9 Q2626.46 1839.49 2626.46 1848.24 Q2626.46 1856.96 2623.38 1861.57 Q2620.32 1866.15 2614.51 1866.15 Q2608.7 1866.15 2605.62 1861.57 Q2602.57 1856.96 2602.57 1848.24 Q2602.57 1839.49 2605.62 1834.9 Q2608.7 1830.3 2614.51 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip440)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1800.78 151.747,47.2441 "></polyline>
<polyline clip-path="url(#clip440)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1532.83 170.644,1532.83 "></polyline>
<polyline clip-path="url(#clip440)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1227.83 170.644,1227.83 "></polyline>
<polyline clip-path="url(#clip440)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,922.827 170.644,922.827 "></polyline>
<polyline clip-path="url(#clip440)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,617.824 170.644,617.824 "></polyline>
<polyline clip-path="url(#clip440)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,312.821 170.644,312.821 "></polyline>
<path clip-path="url(#clip440)" d="M49.5521 1533.28 L79.2279 1533.28 L79.2279 1537.22 L49.5521 1537.22 L49.5521 1533.28 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip440)" d="M99.8991 1530.97 Q96.7509 1530.97 94.8991 1533.12 Q93.0704 1535.28 93.0704 1539.03 Q93.0704 1542.75 94.8991 1544.93 Q96.7509 1547.08 99.8991 1547.08 Q103.047 1547.08 104.876 1544.93 Q106.728 1542.75 106.728 1539.03 Q106.728 1535.28 104.876 1533.12 Q103.047 1530.97 99.8991 1530.97 M109.181 1516.32 L109.181 1520.58 Q107.422 1519.74 105.617 1519.3 Q103.834 1518.86 102.075 1518.86 Q97.4454 1518.86 94.9917 1521.99 Q92.5612 1525.11 92.2139 1531.43 Q93.5797 1529.42 95.6398 1528.35 Q97.7 1527.27 100.177 1527.27 Q105.385 1527.27 108.394 1530.44 Q111.427 1533.59 111.427 1539.03 Q111.427 1544.35 108.279 1547.57 Q105.131 1550.78 99.8991 1550.78 Q93.9037 1550.78 90.7325 1546.2 Q87.5612 1541.59 87.5612 1532.87 Q87.5612 1524.67 91.45 1519.81 Q95.3389 1514.93 101.89 1514.93 Q103.649 1514.93 105.431 1515.28 Q107.237 1515.62 109.181 1516.32 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip440)" d="M50.3623 1228.28 L80.0381 1228.28 L80.0381 1232.22 L50.3623 1232.22 L50.3623 1228.28 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip440)" d="M104.297 1226.48 Q107.654 1227.19 109.529 1229.46 Q111.427 1231.73 111.427 1235.06 Q111.427 1240.18 107.908 1242.98 Q104.39 1245.78 97.9083 1245.78 Q95.7324 1245.78 93.4176 1245.34 Q91.126 1244.92 88.6723 1244.07 L88.6723 1239.55 Q90.6167 1240.69 92.9315 1241.27 Q95.2463 1241.85 97.7695 1241.85 Q102.168 1241.85 104.459 1240.11 Q106.774 1238.37 106.774 1235.06 Q106.774 1232.01 104.621 1230.3 Q102.492 1228.56 98.6722 1228.56 L94.6445 1228.56 L94.6445 1224.72 L98.8574 1224.72 Q102.306 1224.72 104.135 1223.35 Q105.964 1221.96 105.964 1219.37 Q105.964 1216.71 104.066 1215.3 Q102.191 1213.86 98.6722 1213.86 Q96.7509 1213.86 94.5519 1214.28 Q92.3528 1214.69 89.7139 1215.57 L89.7139 1211.41 Q92.376 1210.67 94.6908 1210.3 Q97.0287 1209.93 99.0889 1209.93 Q104.413 1209.93 107.515 1212.36 Q110.617 1214.76 110.617 1218.88 Q110.617 1221.75 108.973 1223.74 Q107.33 1225.71 104.297 1226.48 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip440)" d="M99.4824 908.626 Q95.8713 908.626 94.0426 912.191 Q92.2371 915.732 92.2371 922.862 Q92.2371 929.968 94.0426 933.533 Q95.8713 937.075 99.4824 937.075 Q103.117 937.075 104.922 933.533 Q106.751 929.968 106.751 922.862 Q106.751 915.732 104.922 912.191 Q103.117 908.626 99.4824 908.626 M99.4824 904.922 Q105.293 904.922 108.348 909.529 Q111.427 914.112 111.427 922.862 Q111.427 931.589 108.348 936.195 Q105.293 940.778 99.4824 940.778 Q93.6723 940.778 90.5936 936.195 Q87.538 931.589 87.538 922.862 Q87.538 914.112 90.5936 909.529 Q93.6723 904.922 99.4824 904.922 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip440)" d="M104.297 616.47 Q107.654 617.187 109.529 619.456 Q111.427 621.724 111.427 625.058 Q111.427 630.173 107.908 632.974 Q104.39 635.775 97.9083 635.775 Q95.7324 635.775 93.4176 635.335 Q91.126 634.919 88.6723 634.062 L88.6723 629.548 Q90.6167 630.683 92.9315 631.261 Q95.2463 631.84 97.7695 631.84 Q102.168 631.84 104.459 630.104 Q106.774 628.368 106.774 625.058 Q106.774 622.002 104.621 620.289 Q102.492 618.553 98.6722 618.553 L94.6445 618.553 L94.6445 614.711 L98.8574 614.711 Q102.306 614.711 104.135 613.345 Q105.964 611.956 105.964 609.363 Q105.964 606.701 104.066 605.289 Q102.191 603.854 98.6722 603.854 Q96.7509 603.854 94.5519 604.271 Q92.3528 604.688 89.7139 605.567 L89.7139 601.4 Q92.376 600.66 94.6908 600.289 Q97.0287 599.919 99.0889 599.919 Q104.413 599.919 107.515 602.35 Q110.617 604.757 110.617 608.877 Q110.617 611.748 108.973 613.738 Q107.33 615.706 104.297 616.47 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip440)" d="M99.8991 310.958 Q96.7509 310.958 94.8991 313.11 Q93.0704 315.263 93.0704 319.013 Q93.0704 322.74 94.8991 324.916 Q96.7509 327.069 99.8991 327.069 Q103.047 327.069 104.876 324.916 Q106.728 322.74 106.728 319.013 Q106.728 315.263 104.876 313.11 Q103.047 310.958 99.8991 310.958 M109.181 296.305 L109.181 300.564 Q107.422 299.731 105.617 299.291 Q103.834 298.851 102.075 298.851 Q97.4454 298.851 94.9917 301.976 Q92.5612 305.101 92.2139 311.421 Q93.5797 309.407 95.6398 308.342 Q97.7 307.254 100.177 307.254 Q105.385 307.254 108.394 310.425 Q111.427 313.573 111.427 319.013 Q111.427 324.337 108.279 327.555 Q105.131 330.772 99.8991 330.772 Q93.9037 330.772 90.7325 326.189 Q87.5612 321.583 87.5612 312.856 Q87.5612 304.661 91.45 299.8 Q95.3389 294.916 101.89 294.916 Q103.649 294.916 105.431 295.263 Q107.237 295.61 109.181 296.305 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip442)" style="stroke:#009af9; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,1158.37 224.541,1591.14 226.891,1396.93 229.242,1497.47 231.592,1357.77 233.943,1136.73 236.293,1451.99 238.644,1403.7 240.994,1378.17 243.345,1415.9 245.695,1426.54 248.046,1435.83 250.396,1287.5 252.747,1574.18 255.097,1436.89 257.448,1487.4 259.798,1343.12 262.148,1175 264.499,1392.02 266.849,1391.86 269.2,1561.47 271.55,1414.2 273.901,1556.17 276.251,1558.12 278.602,1401.23 280.952,1466.48 283.303,1391 285.653,1325.92 288.004,1570.96 290.354,1389.33 292.705,1439.19 295.055,1496.93 297.406,1524.35 299.756,1415.48 302.107,1385.16 304.457,1640.04 306.807,1497.4 309.158,1452.39 311.508,1272.77 313.859,1421.64 316.209,1437.78 318.56,1390.11 320.91,1615.87 323.261,1408.97 325.611,1441.12 327.962,1375.16 330.312,1590.15 332.663,1607.07 335.013,1322.85 337.364,1315.14 339.714,1352.17 342.065,1444.41 344.415,1400.57 346.765,1605.66 349.116,1591.24 351.466,1546.23 353.817,1343.23 356.167,1314.83 358.518,1368.93 360.868,1285.61 363.219,1097.14 365.569,1500.3 367.92,1573.42 370.27,1343.39 372.621,1418.36 374.971,1342.38 377.322,1392.09 379.672,1464.84 382.023,1270.71 384.373,1335.18 386.724,1332.06 389.074,1394.66 391.424,1437.35 393.775,1507.25 396.125,1578.7 398.476,1751.15 400.826,1495.31 403.177,1478.17 405.527,1458.12 407.878,1398.98 410.228,1471.77 412.579,1489.11 414.929,1495.74 417.28,1309.74 419.63,1412.46 421.981,1474.32 424.331,1299.48 426.682,1226.26 429.032,1446.48 431.382,1604.14 433.733,1561.2 436.083,1555.79 438.434,1463.48 440.784,1327.77 443.135,1475.77 445.485,1342.07 447.836,1470.61 450.186,1296.74 452.537,1384.84 454.887,1371.42 457.238,1232.95 459.588,1320.94 461.939,1426.72 464.289,1197.33 466.64,1278.87 468.99,1371.19 471.341,1385.95 473.691,1358.64 476.041,1335.45 478.392,1426.26 480.742,1403.65 483.093,1607.26 485.443,1298.52 487.794,1429.75 490.144,1261.81 492.495,1475.76 494.845,1601.45 497.196,1445.2 499.546,1432.12 501.897,1477.67 504.247,1539.98 506.598,1275.86 508.948,1511.86 511.299,1381.44 513.649,1485.88 515.999,1590.85 518.35,1457.1 520.7,1317.99 523.051,1470.61 525.401,1246.21 527.752,1378.2 530.102,1320.29 532.453,1221.46 534.803,1324.8 537.154,1391.29 539.504,1321.07 541.855,1430.31 544.205,1572.38 546.556,1555.77 548.906,1317.07 551.257,1373.77 553.607,1559.01 555.958,1584.6 558.308,1571.85 560.658,1189.53 563.009,1427.51 565.359,1444.3 567.71,1462.55 570.06,1454.36 572.411,1480.69 574.761,1487.89 577.112,1476.28 579.462,1466.75 581.813,1415.1 584.163,1392.27 586.514,1321.82 588.864,1258.07 591.215,1360.4 593.565,1379.36 595.916,1405.92 598.266,1402.3 600.616,1345.91 602.967,1474.22 605.317,1411.14 607.668,1228.85 610.018,1336.12 612.369,1514.71 614.719,1388.9 617.07,1612.83 619.42,1289.98 621.771,1385.68 624.121,1571.07 626.472,1410.48 628.822,1493.07 631.173,1313.97 633.523,1156.82 635.874,1557.55 638.224,1434.66 640.575,1392.91 642.925,1471.22 645.275,1463.54 647.626,1509.99 649.976,1465.28 652.327,1495.71 654.677,1455.64 657.028,1303.34 659.378,1436.7 661.729,1503.96 664.079,1603.71 666.43,1444.65 668.78,1421.34 671.131,1241.15 673.481,1576.89 675.832,1474.85 678.182,1609.65 680.533,1361.1 682.883,1322.1 685.233,1451.62 687.584,1275.98 689.934,1495.02 692.285,1422.59 694.635,1428.68 696.986,1542.67 699.336,1494.13 701.687,1485.81 704.037,1455.43 706.388,1603.88 708.738,1460.93 711.089,1600.13 713.439,1274.51 715.79,1366.93 718.14,1384.76 720.491,1487.24 722.841,1481.46 725.192,1482.47 727.542,1326.99 729.892,1605.6 732.243,1562.67 734.593,1327.16 736.944,1562.78 739.294,1308.78 741.645,1384.77 743.995,1394.46 746.346,1262.01 748.696,1378.69 751.047,1573.33 753.397,1528.19 755.748,1366.34 758.098,1374.87 760.449,1667.06 762.799,1269.89 765.15,1368.94 767.5,1364.4 769.85,1358.01 772.201,1362.84 774.551,1401.39 776.902,1538.12 779.252,1702.35 781.603,1483.98 783.953,1293.92 786.304,1321.5 788.654,1488.91 791.005,1485 793.355,1629.19 795.706,1478.24 798.056,1601.44 800.407,1301.1 802.757,1103.5 805.108,1409.7 807.458,1442.24 809.809,1282.42 812.159,1509.09 814.509,1464.87 816.86,1370.85 819.21,1475.85 821.561,1534.87 823.911,1471.32 826.262,1410.67 828.612,1555.53 830.963,1520.58 833.313,1501.34 835.664,1386.29 838.014,1399.24 840.365,1424.24 842.715,1403.61 845.066,1374.91 847.416,1445.76 849.767,1413.48 852.117,1508.56 854.467,1466.99 856.818,1501.81 859.168,1534.38 861.519,1422.58 863.869,1482.74 866.22,1544.58 868.57,1523.44 870.921,1494.78 873.271,1562.6 875.622,1408.5 877.972,1256.81 880.323,1520.05 882.673,1487.54 885.024,1401.39 887.374,1500.43 889.725,1523.48 892.075,1410.31 894.426,1245.97 896.776,1262.81 899.126,1562.11 901.477,1440.9 903.827,1439.5 906.178,1412.24 908.528,1503.53 910.879,1692.12 913.229,1449.64 915.58,1449.49 917.93,1502.65 920.281,1517.57 922.631,1363.3 924.982,1292.74 927.332,1501.7 929.683,1420.96 932.033,1518.75 934.384,1284.98 936.734,1461.98 939.084,1316.77 941.435,1451.34 943.785,1482.32 946.136,1403.38 948.486,1432.99 950.837,1377.16 953.187,1532.28 955.538,1434.16 957.888,1303.27 960.239,1329.28 962.589,1430.39 964.94,1492.12 967.29,1604.7 969.641,1513.21 971.991,1300.67 974.342,1340.41 976.692,1357.8 979.043,1553.49 981.393,1426.39 983.743,1532.7 986.094,1543.91 988.444,1269.07 990.795,1495.11 993.145,1447.39 995.496,1536.92 997.846,1515.41 1000.2,1380.57 1002.55,1696.27 1004.9,1340.26 1007.25,1285.33 1009.6,1390.88 1011.95,1315.44 1014.3,1402.71 1016.65,1350.42 1019,1405.9 1021.35,1224.05 1023.7,1517.34 1026.05,1521.17 1028.4,1614.26 1030.75,1450.25 1033.1,1610.3 1035.45,1575.53 1037.8,1346.89 1040.15,1391.5 1042.51,1562.88 1044.86,1252.2 1047.21,1599.93 1049.56,1482.36 1051.91,1443.76 1054.26,1339.98 1056.61,1384.9 1058.96,1533.54 1061.31,1359.45 1063.66,1644.42 1066.01,1513.22 1068.36,1411.18 1070.71,1408.88 1073.06,1505.5 1075.41,1330.11 1077.76,1378.96 1080.11,1534.87 1082.46,1269.6 1084.81,1372.43 1087.16,1405.99 1089.51,1457.25 1091.87,1424.07 1094.22,1458.23 1096.57,1322.98 1098.92,1521.11 1101.27,1363.25 1103.62,1689.37 1105.97,1443.48 1108.32,1350.98 1110.67,1319.25 1113.02,1131.49 1115.37,1455.24 1117.72,1485.26 1120.07,1400.53 1122.42,1503.93 1124.77,1507.91 1127.12,1290.77 1129.47,1514.37 1131.82,1392.09 1134.17,1536.04 1136.52,1495.34 1138.87,1343.45 1141.23,1590.36 1143.58,1510.51 1145.93,1398.22 1148.28,1486.01 1150.63,1383.51 1152.98,1291.1 1155.33,1489.5 1157.68,1472.81 1160.03,1404.05 1162.38,1627.56 1164.73,1499.33 1167.08,1328.76 1169.43,1631.76 1171.78,1600.84 1174.13,1449.3 1176.48,1427.23 1178.83,1455.89 1181.18,1349.18 1183.53,1292.23 1185.88,1206.03 1188.23,1327.07 1190.59,1399.53 1192.94,1331.99 1195.29,1625.91 1197.64,1483.15 1199.99,1230.84 1202.34,1385.98 1204.69,1520.99 1207.04,1456.44 1209.39,1314.22 1211.74,1442.12 1214.09,1517.56 1216.44,1461.63 1218.79,1543.37 1221.14,1491.61 1223.49,1473.96 1225.84,1539.11 1228.19,1413.92 1230.54,1515.51 1232.89,1319.59 1235.24,1334.19 1237.59,1510.35 1239.94,1189.85 1242.3,1448.84 1244.65,1354.39 1247,1517.64 1249.35,1388.18 1251.7,1566.08 1254.05,1442.89 1256.4,1571.38 1258.75,1246.37 1261.1,1536.8 1263.45,1525.29 1265.8,1558.81 1268.15,1440.95 1270.5,1401.55 1272.85,1535.84 1275.2,1507.21 1277.55,1284.76 1279.9,1304.2 1282.25,1549.34 1284.6,1364.91 1286.95,1535.25 1289.3,1300.05 1291.66,1543.29 1294.01,1591.44 1296.36,1581.17 1298.71,1463.42 1301.06,1429.96 1303.41,1420.49 1305.76,1399.04 1308.11,1534.29 1310.46,1570.3 1312.81,1425.21 1315.16,1471.48 1317.51,1571.57 1319.86,1438.61 1322.21,1461.01 1324.56,1445.54 1326.91,1544.42 1329.26,1367.68 1331.61,1337.69 1333.96,1469 1336.31,1324.75 1338.66,1422.33 1341.02,1414.29 1343.37,1508.64 1345.72,1337.1 1348.07,1530.57 1350.42,1389.24 1352.77,1301.72 1355.12,1448.63 1357.47,1504.65 1359.82,1466.16 1362.17,1462.74 1364.52,1610.3 1366.87,1576.59 1369.22,1424.18 1371.57,1356.57 1373.92,1502.72 1376.27,1465.83 1378.62,1371.87 1380.97,1408.03 1383.32,1414.8 1385.67,1495.28 1388.02,1349.28 1390.38,1314.73 1392.73,1396.98 1395.08,1495.87 1397.43,1268.84 1399.78,1485.14 1402.13,1528.49 1404.48,1682.17 1406.83,1470.65 1409.18,1439.36 1411.53,1400.58 1413.88,1546.16 1416.23,1359.74 1418.58,1504.93 1420.93,1436.3 1423.28,1289.38 1425.63,1392.05 1427.98,1423.79 1430.33,1423.04 1432.68,1304.97 1435.03,1551.09 1437.38,1294.17 1439.74,1369.59 1442.09,1224.35 1444.44,1637.42 1446.79,1435.99 1449.14,1147.35 1451.49,1388.67 1453.84,1413.75 1456.19,1366.67 1458.54,1304.48 1460.89,1352.15 1463.24,1407.88 1465.59,1286.13 1467.94,1359.96 1470.29,1513.72 1472.64,1380.25 1474.99,1423.43 1477.34,1399.95 1479.69,1594.62 1482.04,1352.09 1484.39,1464.07 1486.74,1352.72 1489.1,1217.96 1491.45,1428.56 1493.8,1592.6 1496.15,1322.44 1498.5,1391.41 1500.85,1426.76 1503.2,1178.39 1505.55,1521.17 1507.9,1479.02 1510.25,1483.1 1512.6,1400.21 1514.95,1405.43 1517.3,1410.95 1519.65,1503.12 1522,1398.2 1524.35,1393.08 1526.7,1395.66 1529.05,1225.9 1531.4,1464.99 1533.75,1254.16 1536.1,1609.06 1538.45,1426.97 1540.81,1496.97 1543.16,1311.5 1545.51,1425.18 1547.86,1307.5 1550.21,1316.65 1552.56,1378.64 1554.91,1489.12 1557.26,1451.43 1559.61,1397.63 1561.96,1420.94 1564.31,1489.06 1566.66,1359.56 1569.01,1344.28 1571.36,1517.32 1573.71,1292.5 1576.06,1373.96 1578.41,1539.31 1580.76,1482.57 1583.11,1396.61 1585.46,1353.14 1587.81,1578.1 1590.17,1578.26 1592.52,1423.22 1594.87,1355.74 1597.22,1311.38 1599.57,1341.62 1601.92,1547.67 1604.27,1337.92 1606.62,1331.2 1608.97,1399.89 1611.32,1347.44 1613.67,1389.77 1616.02,1377.82 1618.37,1325.91 1620.72,1432.83 1623.07,1319.44 1625.42,1319.91 1627.77,1574.5 1630.12,1461.95 1632.47,1346.83 1634.82,1527.46 1637.17,1571.82 1639.53,1457.1 1641.88,1371.66 1644.23,1391.7 1646.58,1368.37 1648.93,1238.99 1651.28,1671.52 1653.63,1636.38 1655.98,1434.39 1658.33,1460.67 1660.68,1291.37 1663.03,1215.17 1665.38,1457.79 1667.73,1401.35 1670.08,1599.38 1672.43,1395.71 1674.78,1454.6 1677.13,1591.37 1679.48,1457.49 1681.83,1501.42 1684.18,1627.28 1686.53,1619.33 1688.89,1522.56 1691.24,1406.39 1693.59,1472.52 1695.94,1544.3 1698.29,1436.45 1700.64,1447.12 1702.99,1449.73 1705.34,1389.96 1707.69,1451.41 1710.04,1627.04 1712.39,1326.47 1714.74,1439.81 1717.09,1399.99 1719.44,1583.59 1721.79,1312.27 1724.14,1384.21 1726.49,1518.87 1728.84,1531.86 1731.19,1494.63 1733.54,1490.8 1735.89,1503.84 1738.25,1329.93 1740.6,1277.55 1742.95,1400.9 1745.3,1350.89 1747.65,1397.16 1750,1270.03 1752.35,1417.87 1754.7,1331.16 1757.05,1554.73 1759.4,1562 1761.75,1320.35 1764.1,1627.5 1766.45,1413.2 1768.8,1242.46 1771.15,1382 1773.5,1335.8 1775.85,1303.35 1778.2,1544.97 1780.55,1429.39 1782.9,1578.6 1785.25,1310.39 1787.6,1445.69 1789.96,1303.02 1792.31,1315.05 1794.66,1373.74 1797.01,1456.09 1799.36,1461.77 1801.71,1303.69 1804.06,1358.34 1806.41,1505.89 1808.76,1408.48 1811.11,1251.45 1813.46,1315.51 1815.81,1342.75 1818.16,1418.75 1820.51,1257.23 1822.86,1416.99 1825.21,1425.14 1827.56,1465.53 1829.91,1449.7 1832.26,1484.49 1834.61,1250.51 1836.96,1483.31 1839.32,1337.67 1841.67,1609.91 1844.02,1624.05 1846.37,1482.3 1848.72,1419.44 1851.07,1422.8 1853.42,1320.27 1855.77,1314.79 1858.12,1381.57 1860.47,1358.32 1862.82,1498.71 1865.17,1387.12 1867.52,1442.14 1869.87,1559.49 1872.22,1399.53 1874.57,1335.45 1876.92,1447.69 1879.27,1427.99 1881.62,1465.36 1883.97,1361.77 1886.32,1447.37 1888.68,1355.56 1891.03,1292.63 1893.38,1433.92 1895.73,1322.08 1898.08,1304.56 1900.43,1446.77 1902.78,1322.78 1905.13,1343.06 1907.48,1622.36 1909.83,1449.22 1912.18,1330.63 1914.53,1330.65 1916.88,1345.01 1919.23,1285.31 1921.58,1459.58 1923.93,1275.7 1926.28,1533.18 1928.63,1465.25 1930.98,1497.82 1933.33,1456.62 1935.68,1401.24 1938.04,1485.65 1940.39,1417.94 1942.74,1226.53 1945.09,1437.93 1947.44,1449.01 1949.79,1497.16 1952.14,1405.15 1954.49,1490.45 1956.84,1363.98 1959.19,1482.65 1961.54,1516.99 1963.89,1452.93 1966.24,1516.3 1968.59,1589.94 1970.94,1465.97 1973.29,1438.41 1975.64,1490.78 1977.99,1444.3 1980.34,1343.45 1982.69,1340.81 1985.04,1493.6 1987.4,1499.27 1989.75,1404.03 1992.1,1448.4 1994.45,1560.47 1996.8,1379.52 1999.15,1477.37 2001.5,1452.32 2003.85,1442.82 2006.2,1396.86 2008.55,1473.01 2010.9,1234.48 2013.25,1301.85 2015.6,1343.19 2017.95,1287.2 2020.3,1603.63 2022.65,1327.1 2025,1336.42 2027.35,1329.23 2029.7,1381.81 2032.05,1395.82 2034.4,1532.95 2036.76,1611.46 2039.11,1476.13 2041.46,1438.64 2043.81,1374.24 2046.16,1366.49 2048.51,1327.02 2050.86,1391.62 2053.21,1584.74 2055.56,1480.59 2057.91,1494.36 2060.26,1342.99 2062.61,1531.54 2064.96,1373.66 2067.31,1573.84 2069.66,1402.05 2072.01,1562.46 2074.36,1419.25 2076.71,1245.18 2079.06,1654.38 2081.41,1447.56 2083.76,1395.03 2086.11,1454.41 2088.47,1407.73 2090.82,1505.33 2093.17,1378.28 2095.52,1712.99 2097.87,1325.82 2100.22,1232.7 2102.57,1559.79 2104.92,1315.33 2107.27,1572.26 2109.62,1510.21 2111.97,1623.24 2114.32,1273.09 2116.67,1580.56 2119.02,1410.31 2121.37,1603.9 2123.72,1369.3 2126.07,1298.68 2128.42,1297.07 2130.77,1408.61 2133.12,1534.76 2135.47,1464.25 2137.83,1569.64 2140.18,1438.75 2142.53,1411.91 2144.88,1426.43 2147.23,1477.46 2149.58,1437.37 2151.93,1619.27 2154.28,1433.56 2156.63,1233.05 2158.98,1385.35 2161.33,1560.02 2163.68,1585.39 2166.03,1369.25 2168.38,1447.19 2170.73,1609.56 2173.08,1291.46 2175.43,1365.62 2177.78,1443.78 2180.13,1488.7 2182.48,1554.29 2184.83,1439.31 2187.19,1302.43 2189.54,1597.11 2191.89,1443.66 2194.24,1496.33 2196.59,1603.63 2198.94,1357.61 2201.29,1336.56 2203.64,1348.53 2205.99,1533.57 2208.34,1638.82 2210.69,1433.13 2213.04,1409.39 2215.39,1383.43 2217.74,1524.72 2220.09,1415.82 2222.44,1315.22 2224.79,1420.15 2227.14,1401.83 2229.49,1222.09 2231.84,1315.16 2234.19,1553.95 2236.55,1239.97 2238.9,1412.11 2241.25,1368.04 2243.6,1404.21 2245.95,1444.13 2248.3,1237.55 2250.65,1528.44 2253,1431.9 2255.35,1475.97 2257.7,1238.69 2260.05,1391.13 2262.4,1468.73 2264.75,1180.7 2267.1,1531.66 2269.45,1642.15 2271.8,1352.06 2274.15,1437.24 2276.5,1451.03 2278.85,1520.51 2281.2,1540.99 2283.55,1405.43 2285.91,1517.12 2288.26,1558.93 2290.61,1443.71 2292.96,1413.91 2295.31,1312.16 2297.66,1353.42 2300.01,1326.29 2302.36,1419.86 2304.71,1551.18 2307.06,1382.19 2309.41,1566.34 2311.76,1411.03 2314.11,1542.78 2316.46,1373.99 2318.81,1453.55 2321.16,1396.56 2323.51,1306.75 2325.86,1353.85 2328.21,1437.64 2330.56,1372.58 2332.91,1318.04 2335.27,1368.82 2337.62,1533.55 2339.97,1317.9 2342.32,1525.01 2344.67,1393.16 2347.02,1381.58 2349.37,1326.35 2351.72,1293.78 2354.07,1553.82 2356.42,1313.06 2358.77,1495.53 2361.12,1330.92 2363.47,1521.58 2365.82,1408.57 2368.17,1346.8 2370.52,1517.9 2372.87,1425.68 2375.22,1396.32 2377.57,1550.75 2379.92,1563.3 2382.27,1454.78 2384.62,1582.24 2386.98,1377.02 2389.33,1443.78 2391.68,1485.8 2394.03,1478.88 2396.38,1478.97 2398.73,1612.68 2401.08,1290.18 2403.43,1448.49 2405.78,1456.46 2408.13,1457.84 2410.48,1453.23 2412.83,1296.95 2415.18,1373.39 2417.53,1252.29 2419.88,1343.38 2422.23,1398.35 2424.58,1568.12 2426.93,1476.43 2429.28,1387.29 2431.63,1168.2 2433.98,1492.79 2436.34,1419.07 2438.69,1406.39 2441.04,1437.06 2443.39,1583.85 2445.74,1390.01 2448.09,1388.38 2450.44,1412.64 2452.79,1538.77 2455.14,1535.26 2457.49,1128.79 2459.84,1316.98 2462.19,1450.33 2464.54,1290.73 2466.89,1263.34 2469.24,1322.01 2471.59,1394.01 2473.94,1452.43 2476.29,1544.59 2478.64,1426.28 2480.99,1377.76 2483.34,1442.55 2485.7,1690.41 2488.05,1555.06 2490.4,1499.19 2492.75,1517.57 2495.1,1382.51 2497.45,1390.94 2499.8,1395.03 2502.15,1455.69 2504.5,1363.91 2506.85,1498.18 2509.2,1705.08 2511.55,1379.77 2513.9,1578.28 2516.25,1328.64 2518.6,1415.82 2520.95,1428.52 2523.3,1430.86 2525.65,1355 2528,1376.55 2530.35,1375.2 2532.7,1611.82 2535.06,1531.64 2537.41,1675.81 2539.76,1447.96 2542.11,1291.82 2544.46,1549.39 2546.81,1349.37 2549.16,1254.83 2551.51,1421.31 2553.86,1468.91 2556.21,1255.99 2558.56,1486.34 2560.91,1548.02 2563.26,1198.32 2565.61,1548.38 2567.96,1364.45 2570.31,1404.02 "></polyline>
<polyline clip-path="url(#clip442)" style="stroke:#e26f46; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,915.922 224.541,926.61 226.891,1135.33 229.242,1066 231.592,723.414 233.943,965.555 236.293,1009.22 238.644,1040.67 240.994,953.587 243.345,917.464 245.695,1006.68 248.046,828.358 250.396,897.961 252.747,938.411 255.097,889.936 257.448,960.122 259.798,1004.23 262.148,863.622 264.499,770.215 266.849,859.768 269.2,1068.65 271.55,1097.92 273.901,888.225 276.251,932.614 278.602,1004.75 280.952,943.537 283.303,981.39 285.653,847.344 288.004,840.635 290.354,890.517 292.705,877.831 295.055,864.909 297.406,762.44 299.756,849.929 302.107,1078.69 304.457,883.418 306.807,1135.58 309.158,1057.66 311.508,788.979 313.859,886.705 316.209,730.78 318.56,927.881 320.91,854.452 323.261,811.296 325.611,1002.66 327.962,976.957 330.312,811.386 332.663,985.119 335.013,923.416 337.364,843.063 339.714,1026.93 342.065,960.879 344.415,955.114 346.765,863.724 349.116,836.63 351.466,890.781 353.817,912.608 356.167,1124.55 358.518,927.817 360.868,834.764 363.219,976.737 365.569,1105.89 367.92,946.106 370.27,895.968 372.621,977.83 374.971,882.787 377.322,947.654 379.672,930.962 382.023,894.851 384.373,859.545 386.724,1010.63 389.074,931.674 391.424,861.472 393.775,970.425 396.125,1067.76 398.476,796.761 400.826,953.978 403.177,984.052 405.527,799.255 407.878,943.363 410.228,1071.01 412.579,956.904 414.929,975.381 417.28,922.56 419.63,826.974 421.981,757.798 424.331,689.411 426.682,1135.78 429.032,1028.51 431.382,822.279 433.733,869.734 436.083,716.452 438.434,874.23 440.784,856.557 443.135,1033.97 445.485,1095.24 447.836,1015.78 450.186,1155.4 452.537,820.471 454.887,855.137 457.238,810.969 459.588,904.966 461.939,1045.47 464.289,1024.37 466.64,1232.71 468.99,845.487 471.341,996.646 473.691,818.368 476.041,1062.15 478.392,768.397 480.742,759.621 483.093,809.467 485.443,1108.04 487.794,927.452 490.144,712.316 492.495,824.017 494.845,951.141 497.196,859.099 499.546,928.107 501.897,1029.02 504.247,895.935 506.598,914.539 508.948,1105.16 511.299,977.105 513.649,1018.38 515.999,923.801 518.35,981.448 520.7,1036.47 523.051,891.304 525.401,911.092 527.752,698.022 530.102,890.348 532.453,761.748 534.803,845.481 537.154,956.365 539.504,760.756 541.855,1040.8 544.205,1018.09 546.556,960.715 548.906,983.578 551.257,1000.41 553.607,713.368 555.958,950.836 558.308,1079.3 560.658,859.194 563.009,983.724 565.359,952.567 567.71,855.29 570.06,897.978 572.411,897.574 574.761,1014.69 577.112,922.949 579.462,1044.32 581.813,805.633 584.163,939.423 586.514,1174.5 588.864,875.09 591.215,968.886 593.565,905.841 595.916,903.648 598.266,933.509 600.616,825.386 602.967,1013.77 605.317,1044.81 607.668,991.495 610.018,783.19 612.369,962.041 614.719,1167.02 617.07,993.32 619.42,944.449 621.771,827.764 624.121,649.931 626.472,918.141 628.822,949.465 631.173,941.149 633.523,769.566 635.874,869.973 638.224,948.108 640.575,897.599 642.925,911.478 645.275,791.7 647.626,827.023 649.976,996.555 652.327,943.142 654.677,953.346 657.028,781.728 659.378,727.584 661.729,998.768 664.079,904.465 666.43,1077.52 668.78,874.559 671.131,903.825 673.481,865.27 675.832,904.279 678.182,983.045 680.533,807.061 682.883,763.55 685.233,815.387 687.584,888.568 689.934,928.933 692.285,1067.01 694.635,830.081 696.986,1097.47 699.336,761.27 701.687,723.053 704.037,1135.77 706.388,1025.05 708.738,836.531 711.089,819.944 713.439,1016.37 715.79,866.288 718.14,889.932 720.491,980.057 722.841,1052.65 725.192,958.829 727.542,904.831 729.892,943.237 732.243,1023.63 734.593,826.618 736.944,1041.41 739.294,874.725 741.645,959.477 743.995,898.549 746.346,823.862 748.696,878.478 751.047,802.58 753.397,1000.68 755.748,1000.05 758.098,931.15 760.449,961.617 762.799,952.513 765.15,1014.55 767.5,916.186 769.85,1143.01 772.201,964.598 774.551,917.714 776.902,898.318 779.252,1020.8 781.603,798.05 783.953,1012.25 786.304,842.06 788.654,899.038 791.005,778.177 793.355,960.767 795.706,923.427 798.056,1012.97 800.407,829.84 802.757,865.732 805.108,910.152 807.458,1004.06 809.809,898.412 812.159,833.904 814.509,941.686 816.86,910.575 819.21,1010.65 821.561,856.723 823.911,1117.32 826.262,850.906 828.612,854.525 830.963,1050.64 833.313,787.508 835.664,1011.21 838.014,945.273 840.365,857.28 842.715,733.483 845.066,688.955 847.416,937.751 849.767,771.749 852.117,972.966 854.467,884.027 856.818,787.659 859.168,1070.65 861.519,951.629 863.869,987.108 866.22,811.154 868.57,754.816 870.921,867.176 873.271,899.969 875.622,769.337 877.972,1034.57 880.323,759.71 882.673,824.556 885.024,803.294 887.374,1198.42 889.725,976.576 892.075,968.775 894.426,682.909 896.776,984.913 899.126,885.005 901.477,926.666 903.827,1025.15 906.178,866.482 908.528,883.4 910.879,941.587 913.229,919.721 915.58,898.141 917.93,768.393 920.281,743.942 922.631,1095.12 924.982,967.658 927.332,994.81 929.683,822.271 932.033,855.794 934.384,988.337 936.734,1029.85 939.084,1047 941.435,987.694 943.785,863.647 946.136,817.848 948.486,861.855 950.837,951.746 953.187,811.167 955.538,1016.32 957.888,1028.99 960.239,967.201 962.589,1052.02 964.94,904.549 967.29,828.441 969.641,1011.38 971.991,780.916 974.342,836.103 976.692,920.496 979.043,837.966 981.393,1043.04 983.743,905.914 986.094,1008.64 988.444,916.503 990.795,934.713 993.145,945.926 995.496,1019.23 997.846,870.815 1000.2,876.186 1002.55,995.722 1004.9,914.412 1007.25,1017.16 1009.6,911.529 1011.95,787.683 1014.3,910.914 1016.65,907.894 1019,773.497 1021.35,1054.82 1023.7,1029.08 1026.05,983.103 1028.4,1164.02 1030.75,929.332 1033.1,737.609 1035.45,788.755 1037.8,755.312 1040.15,867.407 1042.51,1131.4 1044.86,1006.25 1047.21,784.306 1049.56,863.849 1051.91,815.845 1054.26,940.58 1056.61,938.961 1058.96,769.821 1061.31,1064.15 1063.66,866.154 1066.01,1036.15 1068.36,883.113 1070.71,765.815 1073.06,913.225 1075.41,994.288 1077.76,1063.38 1080.11,812.646 1082.46,970.869 1084.81,966.591 1087.16,838.344 1089.51,1028.69 1091.87,822.164 1094.22,987.385 1096.57,832.997 1098.92,746.567 1101.27,1116.42 1103.62,992.121 1105.97,989.709 1108.32,814.447 1110.67,889.725 1113.02,930.744 1115.37,954.796 1117.72,911.427 1120.07,864.005 1122.42,921.652 1124.77,848.74 1127.12,914.984 1129.47,900.761 1131.82,874.972 1134.17,838.4 1136.52,995.447 1138.87,921.85 1141.23,1006.76 1143.58,928.986 1145.93,907.075 1148.28,1008.53 1150.63,828.601 1152.98,1055.05 1155.33,980.438 1157.68,901.906 1160.03,866.73 1162.38,937.593 1164.73,951.158 1167.08,885.498 1169.43,858.646 1171.78,957.374 1174.13,1044.01 1176.48,773.999 1178.83,859.64 1181.18,794.612 1183.53,1028.92 1185.88,841.445 1188.23,863.527 1190.59,1120.13 1192.94,1005.85 1195.29,894.497 1197.64,902.488 1199.99,833.377 1202.34,781.527 1204.69,856.795 1207.04,885.561 1209.39,928.129 1211.74,929.182 1214.09,915.672 1216.44,1069.48 1218.79,888.905 1221.14,811.87 1223.49,998.722 1225.84,966.758 1228.19,880.867 1230.54,1019.79 1232.89,930.594 1235.24,981.039 1237.59,938.804 1239.94,975.635 1242.3,1011.9 1244.65,1027.73 1247,895.392 1249.35,1086.73 1251.7,913.947 1254.05,1084.61 1256.4,818.532 1258.75,903.7 1261.1,831.444 1263.45,840.724 1265.8,950.512 1268.15,864.788 1270.5,892.725 1272.85,836.617 1275.2,887.12 1277.55,943.364 1279.9,862.712 1282.25,905.856 1284.6,974.409 1286.95,841.653 1289.3,947.625 1291.66,904.01 1294.01,868.259 1296.36,814.018 1298.71,815.324 1301.06,936.131 1303.41,880.62 1305.76,832.63 1308.11,762.05 1310.46,855.577 1312.81,1123.28 1315.16,937.49 1317.51,966.656 1319.86,886.86 1322.21,688.956 1324.56,1002.89 1326.91,764.562 1329.26,952.312 1331.61,847.063 1333.96,1007.95 1336.31,928.663 1338.66,890.308 1341.02,1030.58 1343.37,927.528 1345.72,972.944 1348.07,998.735 1350.42,869.605 1352.77,651.93 1355.12,938.301 1357.47,985.313 1359.82,966.918 1362.17,952.553 1364.52,866.203 1366.87,898.183 1369.22,944.605 1371.57,964.992 1373.92,906.634 1376.27,983.884 1378.62,927.003 1380.97,828.071 1383.32,823.873 1385.67,905.417 1388.02,952.005 1390.38,1057.87 1392.73,849.538 1395.08,953.914 1397.43,1060.58 1399.78,819.122 1402.13,1103.02 1404.48,957.852 1406.83,1116.16 1409.18,977.44 1411.53,1040.89 1413.88,824.487 1416.23,900.593 1418.58,708.536 1420.93,912.458 1423.28,1035.58 1425.63,837.707 1427.98,985.763 1430.33,1076.44 1432.68,811.86 1435.03,887.028 1437.38,804.139 1439.74,818.105 1442.09,884.86 1444.44,932.351 1446.79,869.616 1449.14,916.392 1451.49,916.176 1453.84,1102.46 1456.19,1099.72 1458.54,789.75 1460.89,891.525 1463.24,872.904 1465.59,759.252 1467.94,892.733 1470.29,1089.83 1472.64,1037.09 1474.99,791.916 1477.34,972.412 1479.69,837.459 1482.04,1003.49 1484.39,901.15 1486.74,857.608 1489.1,949.36 1491.45,1053.35 1493.8,996.129 1496.15,1058.37 1498.5,992.863 1500.85,912.62 1503.2,958.175 1505.55,872.959 1507.9,901.765 1510.25,887.704 1512.6,1019.83 1514.95,802.957 1517.3,889.61 1519.65,850.89 1522,943.918 1524.35,915.114 1526.7,927.544 1529.05,1080.56 1531.4,928.213 1533.75,936.388 1536.1,797.784 1538.45,853.052 1540.81,1236.3 1543.16,1031.31 1545.51,994.546 1547.86,941.974 1550.21,994.244 1552.56,757.869 1554.91,1115.19 1557.26,919.085 1559.61,979.406 1561.96,1061.32 1564.31,991.643 1566.66,1037.54 1569.01,1153 1571.36,860.307 1573.71,731.8 1576.06,931.986 1578.41,975.668 1580.76,861.825 1583.11,903.133 1585.46,1117.92 1587.81,896.651 1590.17,897.286 1592.52,751.887 1594.87,824.957 1597.22,799.967 1599.57,940.006 1601.92,889.344 1604.27,851.03 1606.62,1000.32 1608.97,930.414 1611.32,823.214 1613.67,725.731 1616.02,772.031 1618.37,770.423 1620.72,862.201 1623.07,1036.39 1625.42,924.973 1627.77,966.459 1630.12,1052.53 1632.47,922.147 1634.82,1056.72 1637.17,997.371 1639.53,984.77 1641.88,994.554 1644.23,907.243 1646.58,899.148 1648.93,929.537 1651.28,1056.53 1653.63,824.887 1655.98,906.833 1658.33,1193.62 1660.68,989.816 1663.03,977.082 1665.38,924.332 1667.73,844.744 1670.08,873.415 1672.43,898.177 1674.78,865.208 1677.13,843.359 1679.48,812.224 1681.83,866.111 1684.18,824.325 1686.53,887.155 1688.89,838.49 1691.24,964.818 1693.59,969.797 1695.94,1014.73 1698.29,899.523 1700.64,1072.68 1702.99,976.464 1705.34,1028.59 1707.69,1006.46 1710.04,765.981 1712.39,950.513 1714.74,764.7 1717.09,922.706 1719.44,1001.31 1721.79,916.408 1724.14,948.304 1726.49,1036.4 1728.84,1028.59 1731.19,892.317 1733.54,851.459 1735.89,793.595 1738.25,811.911 1740.6,850.88 1742.95,994.341 1745.3,885.42 1747.65,853.035 1750,942.916 1752.35,898.696 1754.7,777.416 1757.05,1094.22 1759.4,907.065 1761.75,1041.71 1764.1,927.382 1766.45,938.399 1768.8,757.571 1771.15,965.516 1773.5,908.04 1775.85,1057.17 1778.2,880.687 1780.55,840.882 1782.9,1090.52 1785.25,925.92 1787.6,815.513 1789.96,987.253 1792.31,946.995 1794.66,770.68 1797.01,938.11 1799.36,826.06 1801.71,889.004 1804.06,836.13 1806.41,794.654 1808.76,908.72 1811.11,942.444 1813.46,952.294 1815.81,1103.2 1818.16,1097.19 1820.51,967.836 1822.86,1148.04 1825.21,946.955 1827.56,929.719 1829.91,890.82 1832.26,969.841 1834.61,726.328 1836.96,820.561 1839.32,1106.04 1841.67,947.254 1844.02,1081.77 1846.37,836.675 1848.72,999.426 1851.07,942.649 1853.42,943.802 1855.77,1065 1858.12,1152.51 1860.47,731.086 1862.82,921.202 1865.17,845.596 1867.52,887.189 1869.87,985.977 1872.22,736.86 1874.57,786.676 1876.92,720.255 1879.27,1012.17 1881.62,1011.01 1883.97,1067.36 1886.32,1236.16 1888.68,674.51 1891.03,890.183 1893.38,1049.98 1895.73,853.803 1898.08,991.219 1900.43,837.355 1902.78,887.481 1905.13,996.377 1907.48,1013.89 1909.83,867.971 1912.18,995.935 1914.53,786.26 1916.88,976.097 1919.23,934.758 1921.58,790.149 1923.93,1020.46 1926.28,849.222 1928.63,970.25 1930.98,1081.01 1933.33,895.284 1935.68,965.265 1938.04,1022.59 1940.39,1016.06 1942.74,975.423 1945.09,1106.62 1947.44,962.564 1949.79,1092.75 1952.14,825.496 1954.49,843.163 1956.84,966.705 1959.19,760.318 1961.54,954.979 1963.89,951.286 1966.24,967.601 1968.59,811.572 1970.94,944.934 1973.29,975.714 1975.64,873.395 1977.99,1225.53 1980.34,978.01 1982.69,883.882 1985.04,908.386 1987.4,1077.85 1989.75,919.554 1992.1,1117.5 1994.45,1050.47 1996.8,849.403 1999.15,1059.02 2001.5,925.516 2003.85,941.161 2006.2,944.91 2008.55,742.369 2010.9,1039.65 2013.25,942.175 2015.6,1076.89 2017.95,851.166 2020.3,931.742 2022.65,957.24 2025,996.95 2027.35,960.629 2029.7,867.918 2032.05,960.711 2034.4,1037.56 2036.76,934.851 2039.11,716.698 2041.46,937.1 2043.81,815.307 2046.16,1013.7 2048.51,1024.09 2050.86,987.168 2053.21,894.53 2055.56,986.366 2057.91,1096.68 2060.26,913.699 2062.61,798.922 2064.96,923.156 2067.31,869.368 2069.66,961.834 2072.01,829.041 2074.36,957.416 2076.71,816.132 2079.06,989.763 2081.41,813.807 2083.76,1108.61 2086.11,1100.93 2088.47,893.954 2090.82,823.276 2093.17,962.872 2095.52,888.74 2097.87,919.827 2100.22,931.916 2102.57,828.957 2104.92,903.83 2107.27,743.488 2109.62,1003.37 2111.97,998.627 2114.32,961.553 2116.67,1011.62 2119.02,976.44 2121.37,746.281 2123.72,1150.16 2126.07,849.983 2128.42,887.561 2130.77,804.804 2133.12,858.475 2135.47,998.198 2137.83,1177.53 2140.18,947.408 2142.53,864.015 2144.88,988.794 2147.23,913.902 2149.58,894.207 2151.93,978.088 2154.28,1074.31 2156.63,958.519 2158.98,977.887 2161.33,703.469 2163.68,635.511 2166.03,1086.91 2168.38,1129.35 2170.73,1035.4 2173.08,889.024 2175.43,964.925 2177.78,976.961 2180.13,875.08 2182.48,895.6 2184.83,1040.91 2187.19,757.347 2189.54,881.02 2191.89,1084.46 2194.24,768.653 2196.59,904.25 2198.94,711.293 2201.29,986.428 2203.64,1034.71 2205.99,842.986 2208.34,804.061 2210.69,929.495 2213.04,847.068 2215.39,984.191 2217.74,988.889 2220.09,934.269 2222.44,794.39 2224.79,918.608 2227.14,1065.82 2229.49,975.836 2231.84,940.005 2234.19,815.683 2236.55,1002.94 2238.9,862.259 2241.25,900.535 2243.6,881.628 2245.95,1063.66 2248.3,1018.08 2250.65,920.566 2253,965.835 2255.35,932.114 2257.7,876.744 2260.05,855.634 2262.4,943.028 2264.75,1008.73 2267.1,1029.24 2269.45,919.179 2271.8,963.927 2274.15,806.947 2276.5,975.7 2278.85,951.728 2281.2,941.898 2283.55,878.873 2285.91,982.147 2288.26,900.414 2290.61,950.907 2292.96,1026.49 2295.31,1245.38 2297.66,727.365 2300.01,766.117 2302.36,1041.71 2304.71,971.498 2307.06,1006.76 2309.41,914.254 2311.76,1012.14 2314.11,947.646 2316.46,871.405 2318.81,1020.48 2321.16,926.789 2323.51,907.546 2325.86,979.282 2328.21,971.381 2330.56,955.946 2332.91,965.71 2335.27,861.383 2337.62,789.004 2339.97,922.022 2342.32,953.23 2344.67,737.6 2347.02,1147.14 2349.37,882.387 2351.72,1085.28 2354.07,910.826 2356.42,949.985 2358.77,991.673 2361.12,823.714 2363.47,950.254 2365.82,975.641 2368.17,671.017 2370.52,986.883 2372.87,794.039 2375.22,916.82 2377.57,1040.06 2379.92,852.423 2382.27,1017.23 2384.62,771.359 2386.98,1048.4 2389.33,905.214 2391.68,1009.69 2394.03,1044.99 2396.38,1073.33 2398.73,856.304 2401.08,936.471 2403.43,1051.15 2405.78,915.498 2408.13,909.104 2410.48,1126.49 2412.83,1133.45 2415.18,944.303 2417.53,1018.64 2419.88,903.277 2422.23,1063.23 2424.58,721.612 2426.93,650.046 2429.28,785.23 2431.63,864.943 2433.98,834.383 2436.34,1000.05 2438.69,895.718 2441.04,786.051 2443.39,865.927 2445.74,909.231 2448.09,937.171 2450.44,714.339 2452.79,907.548 2455.14,878.301 2457.49,787.604 2459.84,791.632 2462.19,881.627 2464.54,968.056 2466.89,950.699 2469.24,1031.8 2471.59,786.333 2473.94,771.96 2476.29,954.218 2478.64,947.132 2480.99,874.262 2483.34,1059.53 2485.7,923.537 2488.05,936.254 2490.4,1103.6 2492.75,813.345 2495.1,956.756 2497.45,1088.56 2499.8,845.352 2502.15,1084.34 2504.5,1059.78 2506.85,1022.77 2509.2,912.047 2511.55,964.774 2513.9,996.697 2516.25,897.385 2518.6,852.854 2520.95,891.597 2523.3,760.662 2525.65,982.923 2528,930.958 2530.35,730.987 2532.7,775.256 2535.06,942.038 2537.41,999.462 2539.76,955.662 2542.11,959.721 2544.46,903.39 2546.81,784.993 2549.16,988.456 2551.51,1007.03 2553.86,950.344 2556.21,847.828 2558.56,870.724 2560.91,933.58 2563.26,806.892 2565.61,788.521 2567.96,1191.32 2570.31,957.914 "></polyline>
<polyline clip-path="url(#clip442)" style="stroke:#3da44d; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,567.26 224.541,498.004 226.891,310.075 229.242,493.634 231.592,334.108 233.943,314.946 236.293,445.157 238.644,341.607 240.994,353.93 243.345,449.566 245.695,429.811 248.046,508.058 250.396,458.295 252.747,528.724 255.097,484.53 257.448,657.535 259.798,305.593 262.148,619.259 264.499,550.851 266.849,367.293 269.2,377.822 271.55,352.204 273.901,393.659 276.251,375.675 278.602,352.185 280.952,301.881 283.303,572.102 285.653,487.062 288.004,352.784 290.354,466.184 292.705,410.578 295.055,327.154 297.406,437.465 299.756,550.046 302.107,349.532 304.457,447.098 306.807,394.147 309.158,416.253 311.508,480.659 313.859,531.032 316.209,476.52 318.56,378.189 320.91,301.031 323.261,217.012 325.611,173.578 327.962,296.38 330.312,386.558 332.663,256.955 335.013,457.216 337.364,354.261 339.714,392.986 342.065,397.788 344.415,413.983 346.765,343.457 349.116,598.115 351.466,430.615 353.817,295.259 356.167,616.35 358.518,509.37 360.868,583.725 363.219,483.837 365.569,670.765 367.92,660.607 370.27,450.282 372.621,298.098 374.971,301.941 377.322,444.544 379.672,557.431 382.023,321.706 384.373,523.244 386.724,360.739 389.074,279.506 391.424,598.728 393.775,351.237 396.125,542.843 398.476,407.046 400.826,419.626 403.177,687.262 405.527,356.935 407.878,276.166 410.228,359.893 412.579,418.051 414.929,548.952 417.28,241.957 419.63,300.066 421.981,393.925 424.331,496.718 426.682,353.901 429.032,383.441 431.382,509.418 433.733,437.51 436.083,555.413 438.434,392.846 440.784,570.147 443.135,403.053 445.485,609.167 447.836,307.378 450.186,385.799 452.537,226.314 454.887,226.679 457.238,487.911 459.588,417.302 461.939,286.163 464.289,274.053 466.64,496.369 468.99,416.905 471.341,263.981 473.691,337.391 476.041,250.364 478.392,409.782 480.742,291.937 483.093,286.09 485.443,563.712 487.794,398.081 490.144,465.965 492.495,283.19 494.845,531.23 497.196,439.905 499.546,470.62 501.897,538.823 504.247,353.946 506.598,424.308 508.948,502.319 511.299,471.591 513.649,320.966 515.999,365.629 518.35,509.073 520.7,350.662 523.051,700.658 525.401,539.13 527.752,454.463 530.102,448.736 532.453,482.668 534.803,391.139 537.154,192.379 539.504,489.97 541.855,493.987 544.205,374.005 546.556,294.025 548.906,274.84 551.257,551.102 553.607,394.651 555.958,578.717 558.308,222.547 560.658,356.586 563.009,390.912 565.359,280.805 567.71,237.196 570.06,358.298 572.411,177.325 574.761,374.792 577.112,411.236 579.462,438.047 581.813,504.007 584.163,357.229 586.514,384.761 588.864,420.831 591.215,258.706 593.565,233.097 595.916,475.953 598.266,318.802 600.616,390.173 602.967,260.385 605.317,394.415 607.668,349.137 610.018,215.531 612.369,252.828 614.719,400.264 617.07,358.006 619.42,555.986 621.771,301.432 624.121,407.874 626.472,313.218 628.822,365.766 631.173,306.664 633.523,315.164 635.874,463.073 638.224,651.213 640.575,492.104 642.925,495.569 645.275,443.829 647.626,395.114 649.976,389.419 652.327,404.498 654.677,293.378 657.028,466.415 659.378,468.122 661.729,447.153 664.079,574.888 666.43,180.269 668.78,509.022 671.131,310.232 673.481,540.363 675.832,413.491 678.182,510.725 680.533,368.166 682.883,336.315 685.233,417.434 687.584,430.093 689.934,431.026 692.285,255.336 694.635,343.881 696.986,431.221 699.336,298.827 701.687,558.077 704.037,389.558 706.388,659.951 708.738,465.786 711.089,219.604 713.439,500.405 715.79,492.592 718.14,375.605 720.491,442.363 722.841,369.339 725.192,483.485 727.542,360.565 729.892,528.197 732.243,600.565 734.593,284.381 736.944,251.472 739.294,422.391 741.645,310.403 743.995,367.183 746.346,463.205 748.696,463.749 751.047,274.517 753.397,488.681 755.748,374.254 758.098,431.656 760.449,547.126 762.799,315.979 765.15,457.275 767.5,566.055 769.85,398.155 772.201,421.928 774.551,466.074 776.902,523.316 779.252,457.173 781.603,491.931 783.953,567.278 786.304,395.827 788.654,490.761 791.005,423.377 793.355,352.534 795.706,491.534 798.056,432.082 800.407,425.348 802.757,343.315 805.108,380.572 807.458,426.934 809.809,305.443 812.159,314.773 814.509,324.743 816.86,521.204 819.21,293.274 821.561,281.094 823.911,468.833 826.262,468.806 828.612,416.706 830.963,689.663 833.313,360.388 835.664,301.389 838.014,307.281 840.365,379.038 842.715,501.056 845.066,328.379 847.416,304.095 849.767,323.089 852.117,478.099 854.467,241.715 856.818,371.762 859.168,344.518 861.519,341.888 863.869,408.796 866.22,469.127 868.57,474.92 870.921,505.087 873.271,318.212 875.622,391.208 877.972,334.216 880.323,379.372 882.673,337.942 885.024,349.81 887.374,420.341 889.725,450.237 892.075,547.205 894.426,608.581 896.776,323.238 899.126,381.321 901.477,472.15 903.827,223.546 906.178,451.095 908.528,464.21 910.879,323.581 913.229,322.813 915.58,461.659 917.93,285.886 920.281,384.554 922.631,321.444 924.982,469.297 927.332,337.441 929.683,347.122 932.033,436.156 934.384,394.457 936.734,382.949 939.084,428.757 941.435,329.341 943.785,433.069 946.136,474.942 948.486,360.966 950.837,189.865 953.187,379.629 955.538,207.386 957.888,439.328 960.239,363.423 962.589,337.011 964.94,483.709 967.29,475.671 969.641,437.596 971.991,459.259 974.342,370.311 976.692,270.314 979.043,508.015 981.393,406.546 983.743,301.927 986.094,343.619 988.444,384.603 990.795,332.673 993.145,360.823 995.496,325.632 997.846,363.491 1000.2,467.127 1002.55,473.577 1004.9,388.336 1007.25,343.333 1009.6,330.351 1011.95,557.212 1014.3,359.482 1016.65,434.118 1019,480.294 1021.35,330.542 1023.7,415.502 1026.05,356.216 1028.4,436.507 1030.75,410.598 1033.1,455.515 1035.45,461.3 1037.8,471.918 1040.15,398.342 1042.51,369.497 1044.86,424.14 1047.21,349.142 1049.56,580.357 1051.91,235.232 1054.26,372.735 1056.61,321.855 1058.96,357.43 1061.31,591.244 1063.66,402.577 1066.01,274.855 1068.36,201.976 1070.71,399.955 1073.06,408.73 1075.41,421.188 1077.76,491.567 1080.11,471.773 1082.46,391.644 1084.81,402.429 1087.16,449.585 1089.51,565.345 1091.87,167.627 1094.22,437.991 1096.57,327.818 1098.92,550.129 1101.27,549.741 1103.62,329.788 1105.97,534.965 1108.32,492.466 1110.67,512.864 1113.02,297.29 1115.37,397.048 1117.72,385.03 1120.07,473.005 1122.42,213.472 1124.77,608.281 1127.12,458.254 1129.47,323.872 1131.82,374.805 1134.17,343.856 1136.52,240.551 1138.87,269.768 1141.23,311.463 1143.58,344.428 1145.93,378.197 1148.28,529.201 1150.63,574.261 1152.98,429.311 1155.33,417.139 1157.68,498.961 1160.03,477.828 1162.38,227.474 1164.73,262.415 1167.08,495.424 1169.43,348.52 1171.78,462.319 1174.13,345.287 1176.48,548.561 1178.83,324.675 1181.18,290.845 1183.53,409.686 1185.88,433.945 1188.23,468.898 1190.59,362.341 1192.94,626.876 1195.29,516.483 1197.64,439.605 1199.99,449.079 1202.34,411.009 1204.69,424.837 1207.04,372.532 1209.39,571.923 1211.74,348.48 1214.09,487.177 1216.44,334.313 1218.79,357.061 1221.14,457.222 1223.49,421.986 1225.84,435.878 1228.19,229.442 1230.54,191.526 1232.89,488.557 1235.24,333.173 1237.59,485.609 1239.94,281.985 1242.3,347.881 1244.65,526.205 1247,572.752 1249.35,508.742 1251.7,428.677 1254.05,109.524 1256.4,415.596 1258.75,557.375 1261.1,358.893 1263.45,522.986 1265.8,390.064 1268.15,367.559 1270.5,342.295 1272.85,425.234 1275.2,449.547 1277.55,476.037 1279.9,374.194 1282.25,594.998 1284.6,375.69 1286.95,543.057 1289.3,187.894 1291.66,315.956 1294.01,430.863 1296.36,247.878 1298.71,209.043 1301.06,418.02 1303.41,684.423 1305.76,421.039 1308.11,382.224 1310.46,374.959 1312.81,473.957 1315.16,542.957 1317.51,360.449 1319.86,300.953 1322.21,456.749 1324.56,362.241 1326.91,261.285 1329.26,466.352 1331.61,364.792 1333.96,504.691 1336.31,505.612 1338.66,500.437 1341.02,439.983 1343.37,387.675 1345.72,495.696 1348.07,432.573 1350.42,387.857 1352.77,262.898 1355.12,408.395 1357.47,399.722 1359.82,330.139 1362.17,276.161 1364.52,232.724 1366.87,437.802 1369.22,459.641 1371.57,560.568 1373.92,550.536 1376.27,554.946 1378.62,461.209 1380.97,351.617 1383.32,535.454 1385.67,351.523 1388.02,378.526 1390.38,522.296 1392.73,365.386 1395.08,505.763 1397.43,507.225 1399.78,529.08 1402.13,339.745 1404.48,384.842 1406.83,517.09 1409.18,604.03 1411.53,554.886 1413.88,313.674 1416.23,458.157 1418.58,443.892 1420.93,200.126 1423.28,461.084 1425.63,415.337 1427.98,203.477 1430.33,397.463 1432.68,562.087 1435.03,328.603 1437.38,486.362 1439.74,300.379 1442.09,344.605 1444.44,446.569 1446.79,332.749 1449.14,531.873 1451.49,330.66 1453.84,374.954 1456.19,404.316 1458.54,446.94 1460.89,473.263 1463.24,438.944 1465.59,388.101 1467.94,467.599 1470.29,330.098 1472.64,359.113 1474.99,506.628 1477.34,541.131 1479.69,452.731 1482.04,379.802 1484.39,319.173 1486.74,570.393 1489.1,499.157 1491.45,397.103 1493.8,382.834 1496.15,384.33 1498.5,435.512 1500.85,352.198 1503.2,182.532 1505.55,252.079 1507.9,220.202 1510.25,400.574 1512.6,554.053 1514.95,344.875 1517.3,531.935 1519.65,465.12 1522,486.31 1524.35,271.994 1526.7,360.498 1529.05,430.715 1531.4,402.803 1533.75,592.375 1536.1,520.188 1538.45,146.699 1540.81,445.121 1543.16,344.887 1545.51,240.727 1547.86,464.953 1550.21,278.001 1552.56,523.233 1554.91,489.047 1557.26,396.837 1559.61,380.65 1561.96,539.361 1564.31,372.741 1566.66,547.875 1569.01,387.625 1571.36,616.408 1573.71,348.797 1576.06,290.776 1578.41,444.948 1580.76,399.686 1583.11,309.774 1585.46,415.307 1587.81,569.244 1590.17,413.76 1592.52,309.202 1594.87,385.797 1597.22,609.537 1599.57,630.484 1601.92,357.947 1604.27,481.897 1606.62,546.537 1608.97,572.144 1611.32,353.471 1613.67,541.076 1616.02,361.608 1618.37,441.961 1620.72,447.741 1623.07,444.809 1625.42,269.103 1627.77,364.457 1630.12,387.628 1632.47,559.515 1634.82,451.197 1637.17,284.817 1639.53,463.195 1641.88,297.849 1644.23,411.121 1646.58,401.81 1648.93,364.562 1651.28,341.239 1653.63,594.984 1655.98,544.109 1658.33,543.724 1660.68,441.098 1663.03,315.737 1665.38,457.704 1667.73,437.294 1670.08,350.034 1672.43,412.675 1674.78,444.076 1677.13,445.466 1679.48,341.884 1681.83,425.579 1684.18,629.583 1686.53,468.627 1688.89,470.451 1691.24,353.024 1693.59,370.984 1695.94,483.908 1698.29,529.479 1700.64,343.127 1702.99,312.931 1705.34,696.492 1707.69,381.087 1710.04,320.005 1712.39,464.424 1714.74,434.292 1717.09,410.206 1719.44,527.707 1721.79,464.238 1724.14,266.785 1726.49,518.694 1728.84,599.539 1731.19,595.615 1733.54,392.492 1735.89,423.234 1738.25,340.086 1740.6,569.066 1742.95,282.26 1745.3,469.738 1747.65,434.85 1750,434.496 1752.35,270.911 1754.7,384.141 1757.05,391.737 1759.4,321.283 1761.75,380.62 1764.1,223.229 1766.45,211.556 1768.8,522.921 1771.15,511.322 1773.5,374.114 1775.85,334.456 1778.2,477.476 1780.55,451.758 1782.9,422.527 1785.25,439.69 1787.6,141.697 1789.96,517.919 1792.31,451.375 1794.66,367.006 1797.01,617.958 1799.36,223.549 1801.71,339.867 1804.06,517.951 1806.41,482.326 1808.76,263.855 1811.11,288.803 1813.46,426.343 1815.81,518.639 1818.16,337.49 1820.51,495.326 1822.86,563.438 1825.21,536.305 1827.56,455.425 1829.91,479.989 1832.26,489.597 1834.61,290.149 1836.96,460.94 1839.32,413.202 1841.67,453.394 1844.02,440.926 1846.37,103.51 1848.72,343.005 1851.07,427.405 1853.42,425.325 1855.77,374.14 1858.12,406.528 1860.47,581.752 1862.82,452.35 1865.17,304.493 1867.52,487.413 1869.87,288.509 1872.22,367.654 1874.57,496.931 1876.92,384.716 1879.27,535.677 1881.62,363.569 1883.97,432.731 1886.32,467.28 1888.68,357.303 1891.03,217.774 1893.38,526.857 1895.73,466.337 1898.08,262.494 1900.43,637.43 1902.78,358.633 1905.13,317.969 1907.48,439.166 1909.83,396.87 1912.18,395.906 1914.53,332.101 1916.88,500.496 1919.23,347.418 1921.58,240.868 1923.93,432.687 1926.28,497.401 1928.63,365.472 1930.98,309.879 1933.33,266.524 1935.68,489.761 1938.04,240.85 1940.39,565.788 1942.74,366.273 1945.09,637.511 1947.44,356.909 1949.79,434.939 1952.14,475.297 1954.49,582.125 1956.84,478.303 1959.19,405.464 1961.54,430.647 1963.89,414.844 1966.24,354.655 1968.59,312.16 1970.94,391.182 1973.29,511.598 1975.64,443.264 1977.99,491.905 1980.34,349.296 1982.69,306.013 1985.04,485.825 1987.4,513.715 1989.75,518.58 1992.1,333.995 1994.45,366.399 1996.8,435.072 1999.15,621.772 2001.5,576.421 2003.85,542.393 2006.2,536.67 2008.55,336.202 2010.9,281.765 2013.25,409.912 2015.6,299.653 2017.95,358.921 2020.3,364.159 2022.65,350.259 2025,384.963 2027.35,321.484 2029.7,541.092 2032.05,553.167 2034.4,385.816 2036.76,250.853 2039.11,238.56 2041.46,384.33 2043.81,454.608 2046.16,349.297 2048.51,470.788 2050.86,373.831 2053.21,470.323 2055.56,359.957 2057.91,578.531 2060.26,448.394 2062.61,442.006 2064.96,718.637 2067.31,356.455 2069.66,422.117 2072.01,389.198 2074.36,270.568 2076.71,395.852 2079.06,397.805 2081.41,431.43 2083.76,450.688 2086.11,247.269 2088.47,427.542 2090.82,519.599 2093.17,507.938 2095.52,382.023 2097.87,472.798 2100.22,309.097 2102.57,434.809 2104.92,445.184 2107.27,499.277 2109.62,333.441 2111.97,298.535 2114.32,328.468 2116.67,321.375 2119.02,420.919 2121.37,426.594 2123.72,288.763 2126.07,533.978 2128.42,345.521 2130.77,456.651 2133.12,493.714 2135.47,506.951 2137.83,491.994 2140.18,305.117 2142.53,498.918 2144.88,498.801 2147.23,357.639 2149.58,488.627 2151.93,443.974 2154.28,582.991 2156.63,330.278 2158.98,327.749 2161.33,376.476 2163.68,415.981 2166.03,423.6 2168.38,498.676 2170.73,247.748 2173.08,321.216 2175.43,250.202 2177.78,335.328 2180.13,608.949 2182.48,280.904 2184.83,517.114 2187.19,365.862 2189.54,332.246 2191.89,531.619 2194.24,453.054 2196.59,170.471 2198.94,370.512 2201.29,295.192 2203.64,467.147 2205.99,339.359 2208.34,470.898 2210.69,688.073 2213.04,378.701 2215.39,424.699 2217.74,290.575 2220.09,231.782 2222.44,444.851 2224.79,467.319 2227.14,457.517 2229.49,471.638 2231.84,288.459 2234.19,517.224 2236.55,472.36 2238.9,263.253 2241.25,337.319 2243.6,252.989 2245.95,380.736 2248.3,506.546 2250.65,380.411 2253,530.205 2255.35,164.398 2257.7,515.704 2260.05,96.8724 2262.4,592.586 2264.75,290.718 2267.1,360.438 2269.45,447.124 2271.8,234.649 2274.15,382.637 2276.5,314.831 2278.85,586.372 2281.2,337.481 2283.55,416.952 2285.91,458.425 2288.26,447.571 2290.61,511.509 2292.96,431.623 2295.31,550.514 2297.66,380.352 2300.01,626.806 2302.36,294.14 2304.71,451.448 2307.06,331.568 2309.41,388.077 2311.76,429.695 2314.11,236.441 2316.46,303.276 2318.81,495.486 2321.16,342.316 2323.51,251.826 2325.86,526.842 2328.21,656.127 2330.56,460.857 2332.91,397.821 2335.27,291.169 2337.62,569.85 2339.97,522.53 2342.32,452.77 2344.67,384.955 2347.02,275.228 2349.37,535.409 2351.72,304.127 2354.07,398.654 2356.42,308.569 2358.77,524.411 2361.12,398.11 2363.47,184.052 2365.82,384.476 2368.17,255.72 2370.52,536.568 2372.87,289.322 2375.22,353.907 2377.57,398.715 2379.92,241.057 2382.27,418.382 2384.62,637.036 2386.98,440.618 2389.33,399.257 2391.68,402.546 2394.03,356.72 2396.38,465.564 2398.73,343.622 2401.08,482.221 2403.43,435.229 2405.78,583.196 2408.13,496.984 2410.48,272.55 2412.83,439.829 2415.18,545.847 2417.53,484.055 2419.88,436.543 2422.23,336.73 2424.58,293.855 2426.93,383.847 2429.28,383.577 2431.63,527.652 2433.98,363.368 2436.34,341.421 2438.69,535.484 2441.04,490.698 2443.39,346.085 2445.74,416.999 2448.09,342.589 2450.44,637.3 2452.79,352.585 2455.14,340.537 2457.49,642.159 2459.84,501.205 2462.19,483.371 2464.54,473.929 2466.89,246.115 2469.24,385.749 2471.59,524.723 2473.94,454.334 2476.29,299.388 2478.64,372.187 2480.99,361.909 2483.34,421.506 2485.7,453.021 2488.05,470.314 2490.4,675.419 2492.75,357.099 2495.1,366.678 2497.45,457.655 2499.8,410.109 2502.15,522.047 2504.5,378.249 2506.85,420.32 2509.2,330.038 2511.55,292.479 2513.9,256.46 2516.25,209.472 2518.6,364.098 2520.95,224.238 2523.3,298.134 2525.65,501.231 2528,417.854 2530.35,326.743 2532.7,380.624 2535.06,411.792 2537.41,515.143 2539.76,403.133 2542.11,311.651 2544.46,497.155 2546.81,667.628 2549.16,313.835 2551.51,371.723 2553.86,380.886 2556.21,289.24 2558.56,560.891 2560.91,391.462 2563.26,345.04 2565.61,575.697 2567.96,324.145 2570.31,468.717 "></polyline>
</svg>
</div>
</div>
<p>Look at that! Things are working; amazin’.</p>
<p>We can also exploit <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>’s parallel sampling capabilities:</p>
<div id="34" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run separate 4 chains for 10 000 iterations using threads to parallelize.</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>num_chains <span class="op">=</span> <span class="fl">4</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    model_with_grad,</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">MCMCThreads</span>(),</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>,</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    num_chains;</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Note we need to provide an initial state for every chain.</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>    initial_state<span class="op">=</span><span class="fu">fill</span>(state, num_chains),</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>samples_array <span class="op">=</span> <span class="fu">stack</span>(<span class="fu">map</span>(<span class="bu">Base</span>.<span class="fu">Fix1</span>(stack, sample <span class="op">-&gt;</span> sample.x), samples))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000×4 Array{Float64, 3}:
[:, :, 1] =
 -1.53649  -1.94388    -2.37192   …  -5.04036   -5.47249   -5.47249
  1.9283   -0.0993875  -0.973377      0.765895  -0.473822  -0.473822
  4.03525   5.02568     6.30452       3.73188    5.64892    5.64892

[:, :, 2] =
 -2.2687    -3.97534   -5.06125   …  -3.88371   -5.36088   -5.70459
 -0.777565   0.783517  -0.458823      0.257796  -0.181797  -0.74998
  3.08905    3.79279    4.36283       5.87207    5.5408     4.03861

[:, :, 3] =
 -2.06587  -3.40696   -3.45052  …  -5.8675    -4.77944   -4.92596
  1.11874  -0.830025  -1.57235     -0.521506  -0.225287   0.00321153
  1.2938    4.16611    4.12261      3.9217     4.77089    4.56218

[:, :, 4] =
 -3.1321    -3.1321    -2.24458   …  -4.91353   -5.30737  -4.96782
 -0.126835  -0.126835   0.017913      0.704264  -0.35732  -0.254011
  2.19692    2.19692    4.57494       4.38057    6.12515   5.75441</code></pre>
</div>
</div>
<p>But the fact that we have to provide the <code>AbstractMCMC.sample</code> call, etc. with an <code>initial_state</code> to get started is a bit annoying. We can avoid this by also defining a <code>AbstractMCMC.step</code> <em>without</em> the <code>state</code> argument:</p>
<div id="36" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">::</span><span class="dt">MALA</span>;</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># </span><span class="al">NOTE</span><span class="co">: No state provided!</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just create the initial state by sampling using  a Gaussian.</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="fu">randn</span>(rng, LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(x), <span class="fu">MALAState</span>(x)</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Equipped with this, we no longer need to provide the <code>initial_state</code> everywhere:</p>
<div id="38" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -4.96997     1.01056
 -0.00619469  1.01081
  4.98889     0.995153</code></pre>
</div>
</div>
</section>
<section id="using-our-sampler-with-turing.jl" class="level2">
<h2 class="anchored" data-anchor-id="using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</h2>
<p>As we promised, all of this hassle of implementing our <code>MALA</code> sampler in a way that uses <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> and <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> gets us something more than <em>just</em> an “automatic” implementation of <code>AbstractMCMC.sample</code>.</p>
<p>It also enables use with Turing.jl through the <code>externalsampler</code>, but we need to do one final thing first: we need to tell Turing.jl how to extract a vector of parameters from the “sample” returned in our implementation of <code>AbstractMCMC.step</code>. In our case, the “sample” is a <code>MALASample</code>, so we just need the following line:</p>
<div id="40" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Turing</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">DynamicPPL</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Overload the `getparams` method for our "sample" type, which is just a vector.</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>Turing.Inference.<span class="fu">getparams</span>(<span class="op">::</span><span class="dt">DynamicPPL.Model</span>, sample<span class="op">::</span><span class="dt">MALASample</span>) <span class="op">=</span> sample.x</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And with that, we’re good to go!</p>
<div id="42" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Our previous model defined as a Turing.jl model.</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">mvnormal_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">MvNormal</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.], I)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate our model.</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">mvnormal_model</span>()</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Call `sample` but now we're passing in a Turing.jl `model` and wrapping</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co"># our `MALA` sampler in the `externalsampler` to tell Turing.jl that the sampler</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co"># expects something that implements LogDensityProblems.jl.</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×4×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 2.92 seconds
Compute duration  = 2.92 seconds
parameters        = x[1], x[2], x[3]
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters  </span><span class="ansi-bold">    mean  </span><span class="ansi-bold">     std  </span><span class="ansi-bold">    mcse  </span><span class="ansi-bold">  ess_bulk  </span><span class="ansi-bold">  ess_tail  </span><span class="ansi-bold">    rhat  </span><span class="ansi-bold"> ⋯
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">   Float64  </span><span class="ansi-bright-black-fg ansi-bold">   Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> ⋯

        x[1]   -5.0349    1.0083    0.0179   3181.9705   5070.4641    1.0000   ⋯
        x[2]    0.0056    0.9913    0.0170   3392.5366   5207.3311    1.0004   ⋯
        x[3]    4.9748    1.0021    0.0173   3384.4827   4637.8186    1.0003   ⋯
</span><span class="ansi-cyan-fg ansi-bold">                                                                1 column omitted

Quantiles
 </span><span class="ansi-cyan-fg ansi-bold"> parameters  </span><span class="ansi-cyan-fg ansi-bold">    2.5%  </span><span class="ansi-cyan-fg ansi-bold">   25.0%  </span><span class="ansi-cyan-fg ansi-bold">   50.0%  </span><span class="ansi-cyan-fg ansi-bold">   75.0%  </span><span class="ansi-cyan-fg ansi-bold">   97.5%
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64

        x[1]   -7.0057   -5.7154   -5.0613   -4.3640   -3.0667
        x[2]   -1.9725   -0.6669    0.0178    0.6739    1.9552
        x[3]    3.0200    4.2983    4.9953    5.6540    6.9554
</span></pre>
</div>
</div>
</div>
<p>Pretty neat, eh?</p>
<section id="models-with-constrained-parameters" class="level3">
<h3 class="anchored" data-anchor-id="models-with-constrained-parameters">Models with constrained parameters</h3>
<p>One thing we’ve sort of glossed over in all of the above is that MALA, at least how we’ve implemented it, requires <span class="math inline">\(x\)</span> to live in <span class="math inline">\(\mathbb{R}^d\)</span> for some <span class="math inline">\(d &gt; 0\)</span>. If some of the parameters were in fact constrained, e.g.&nbsp;we were working with a <code>Beta</code> distribution which has support on the interval <span class="math inline">\((0, 1)\)</span>, <em>not</em> on <span class="math inline">\(\mathbb{R}^d\)</span>, we could easily end up outside of the valid range <span class="math inline">\((0, 1)\)</span>.</p>
<div id="44" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">beta_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">beta_model</span>()</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 1.71 seconds
Compute duration  = 1.71 seconds
parameters        = x
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters  </span><span class="ansi-bold">    mean  </span><span class="ansi-bold">     std  </span><span class="ansi-bold">    mcse  </span><span class="ansi-bold">  ess_bulk  </span><span class="ansi-bold">  ess_tail  </span><span class="ansi-bold">    rhat  </span><span class="ansi-bold"> ⋯
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">   Float64  </span><span class="ansi-bright-black-fg ansi-bold">   Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> ⋯

           x    0.5014    0.1916    0.0029   4164.2725   5286.9778    1.0003   ⋯
</span><span class="ansi-cyan-fg ansi-bold">                                                                1 column omitted

Quantiles
 </span><span class="ansi-cyan-fg ansi-bold"> parameters  </span><span class="ansi-cyan-fg ansi-bold">    2.5%  </span><span class="ansi-cyan-fg ansi-bold">   25.0%  </span><span class="ansi-cyan-fg ansi-bold">   50.0%  </span><span class="ansi-cyan-fg ansi-bold">   75.0%  </span><span class="ansi-cyan-fg ansi-bold">   97.5%
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64

           x    0.1445    0.3577    0.5027    0.6443    0.8618
</span></pre>
</div>
</div>
</div>
<p>Yep, that still works, but only because Turing.jl actually <em>transforms</em> the <code>turing_model</code> from constrained to unconstrained, so that the <code>sampler</code> provided to <code>externalsampler</code> is actually always working in unconstrained space! This is not always desirable, so we can turn this off:</p>
<div id="46" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 0.24 seconds
Compute duration  = 0.24 seconds
parameters        = x
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters  </span><span class="ansi-bold">    mean  </span><span class="ansi-bold">     std  </span><span class="ansi-bold">    mcse  </span><span class="ansi-bold"> ess_bulk  </span><span class="ansi-bold"> ess_tail  </span><span class="ansi-bold">    rhat  </span><span class="ansi-bold"> e ⋯
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">  Float64  </span><span class="ansi-bright-black-fg ansi-bold">  Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">   ⋯

           x    0.5506    0.1732    0.0281    33.7400        NaN    1.0820     ⋯
</span><span class="ansi-cyan-fg ansi-bold">                                                                1 column omitted

Quantiles
 </span><span class="ansi-cyan-fg ansi-bold"> parameters  </span><span class="ansi-cyan-fg ansi-bold">    2.5%  </span><span class="ansi-cyan-fg ansi-bold">   25.0%  </span><span class="ansi-cyan-fg ansi-bold">   50.0%  </span><span class="ansi-cyan-fg ansi-bold">   75.0%  </span><span class="ansi-cyan-fg ansi-bold">   97.5%
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64

           x    0.2375    0.4037    0.5502    0.6964    0.7923
</span></pre>
</div>
</div>
</div>
<p>The fun thing is that this still sort of works because</p>
<div id="48" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">logpdf</span>(<span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>), <span class="fl">10.0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-Inf</code></pre>
</div>
</div>
<p>and so the samples that fall outside of the range are always rejected. But do notice how much worse all the diagnostics are, e.g.&nbsp;<code>ess_tail</code> is very poor compared to when we use <code>unconstrained=true</code>. Moreover, in more complex cases this won’t just result in a “nice” <code>-Inf</code> log-density value, but instead will error:</p>
<div id="50" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="kw">function</span> <span class="fu">demo</span>()</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>    σ² <span class="op">~</span> <span class="fu">truncated</span>(<span class="fu">Normal</span>(), lower<span class="op">=</span><span class="fl">0</span>)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If we end up with negative values for `σ²`, the `Normal` will error.</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>    x <span class="op">~</span> <span class="fu">Normal</span>(<span class="fl">0</span>, σ²)</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre>DomainError with Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}}(-0.9070002778918036,1.0,0.0):
Normal: the condition σ &gt;= zero(σ) is not satisfied.
Stacktrace:
  [1] <span class="ansi-bold">#371</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/YQSrn/src/univariate/continuous/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">normal.jl:37</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [2] <span class="ansi-bold">check_args</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/YQSrn/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">utils.jl:89</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [3] <span class="ansi-bold">#Normal#370</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/YQSrn/src/univariate/continuous/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">normal.jl:37</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [4] <span class="ansi-bold">Normal</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/YQSrn/src/univariate/continuous/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">normal.jl:36</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [5] <span class="ansi-bold">Normal</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/YQSrn/src/univariate/continuous/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">normal.jl:42</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [6] <span class="ansi-bold">macro expansion</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/nxcz4/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">compiler.jl:558</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [7] <span class="ansi-bold">demo</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">__model__</span>::Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DefaultContext}</span>, <span class="ansi-bright-black-fg">__varinfo__</span>::DynamicPPL.ThreadSafeVarInfo<span class="ansi-bright-black-fg">{VarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{VarName{:σ², typeof(identity)}}, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}, x::DynamicPPL.Metadata{Dict{VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{VarName{:x, typeof(identity)}}, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}, ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}, Vector{Base.RefValue{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}</span>, <span class="ansi-bright-black-fg">__context__</span>::DefaultContext<span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-magenta-fg">Main.Notebook</span> <span class="ansi-bright-black-fg">~/work/docs/docs/developers/inference/implementing-samplers/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">index.qmd:457</span>
  [8] <span class="ansi-bold">_evaluate!!</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/nxcz4/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">model.jl:913</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [9] <span class="ansi-bold">evaluate_threadsafe!!</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">model</span>::Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DefaultContext}</span>, <span class="ansi-bright-black-fg">varinfo</span>::VarInfo<span class="ansi-bright-black-fg">{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{VarName{:σ², typeof(identity)}}, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}, x::DynamicPPL.Metadata{Dict{VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{VarName{:x, typeof(identity)}}, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}, ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}</span>, <span class="ansi-bright-black-fg">context</span>::DefaultContext<span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-cyan-fg">DynamicPPL</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/nxcz4/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">model.jl:902</span>
 [10] <span class="ansi-bold">evaluate!!</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/nxcz4/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">model.jl:832</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [11] <span class="ansi-bold">logdensity_at</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/nxcz4/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">logdensityfunction.jl:183</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [12] <span class="ansi-bold">FixTail</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DifferentiationInterface/D3LUI/src/utils/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">context.jl:169</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [13] <span class="ansi-bold">vector_mode_dual_eval!</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">f</span>::DifferentiationInterface.FixTail<span class="ansi-bright-black-fg">{typeof(DynamicPPL.logdensity_at), Tuple{Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DefaultContext}, VarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}, DefaultContext}}</span>, <span class="ansi-bright-black-fg">cfg</span>::ForwardDiff.GradientConfig<span class="ansi-bright-black-fg">{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}</span>, <span class="ansi-bright-black-fg">x</span>::Vector<span class="ansi-bright-black-fg">{Float64}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-green-fg">ForwardDiff</span> <span class="ansi-bright-black-fg">~/.julia/packages/ForwardDiff/UBbGT/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">apiutils.jl:24</span>
 [14] <span class="ansi-bold">vector_mode_gradient!</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/ForwardDiff/UBbGT/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">gradient.jl:98</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [15] <span class="ansi-bold">gradient!</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">result</span>::DiffResults.MutableDiffResult<span class="ansi-bright-black-fg">{1, Float64, Tuple{Vector{Float64}}}</span>, <span class="ansi-bright-black-fg">f</span>::DifferentiationInterface.FixTail<span class="ansi-bright-black-fg">{typeof(DynamicPPL.logdensity_at), Tuple{Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DefaultContext}, VarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}, DefaultContext}}</span>, <span class="ansi-bright-black-fg">x</span>::Vector<span class="ansi-bright-black-fg">{Float64}</span>, <span class="ansi-bright-black-fg">cfg</span>::ForwardDiff.GradientConfig<span class="ansi-bright-black-fg">{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}</span>, ::Val<span class="ansi-bright-black-fg">{false}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-green-fg">ForwardDiff</span> <span class="ansi-bright-black-fg">~/.julia/packages/ForwardDiff/UBbGT/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">gradient.jl:39</span>
 [16] <span class="ansi-bold">value_and_gradient</span><span class="ansi-bold">(</span>::typeof(DynamicPPL.logdensity_at), ::DifferentiationInterfaceForwardDiffExt.ForwardDiffGradientPrep<span class="ansi-bright-black-fg">{Tuple{typeof(DynamicPPL.logdensity_at), AutoForwardDiff{2, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}}, Vector{Float64}, Tuple{DifferentiationInterface.Constant{Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DefaultContext}}, DifferentiationInterface.Constant{VarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}}, DifferentiationInterface.Constant{DefaultContext}}}, ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}, Tuple{Nothing, Nothing, Nothing}}</span>, ::AutoForwardDiff<span class="ansi-bright-black-fg">{2, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}}</span>, ::Vector<span class="ansi-bright-black-fg">{Float64}</span>, ::DifferentiationInterface.Constant<span class="ansi-bright-black-fg">{Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DefaultContext}}</span>, ::DifferentiationInterface.Constant<span class="ansi-bright-black-fg">{VarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}}</span>, ::DifferentiationInterface.Constant<span class="ansi-bright-black-fg">{DefaultContext}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-yellow-fg">DifferentiationInterfaceForwardDiffExt</span> <span class="ansi-bright-black-fg">~/.julia/packages/DifferentiationInterface/D3LUI/ext/DifferentiationInterfaceForwardDiffExt/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">onearg.jl:419</span>
 [17] <span class="ansi-bold">logdensity_and_gradient</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">f</span>::LogDensityFunction<span class="ansi-bright-black-fg">{Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DefaultContext}, VarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}, DefaultContext, AutoForwardDiff{2, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}}}</span>, <span class="ansi-bright-black-fg">x</span>::Vector<span class="ansi-bright-black-fg">{Float64}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-cyan-fg">DynamicPPL</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/nxcz4/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">logdensityfunction.jl:234</span>
 [18] <span class="ansi-bold">leapfrog_step</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">model</span>::LogDensityFunction<span class="ansi-bright-black-fg">{Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DefaultContext}, VarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}, DefaultContext, AutoForwardDiff{2, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}}}</span>, <span class="ansi-bright-black-fg">x</span>::Vector<span class="ansi-bright-black-fg">{Float64}</span>, <span class="ansi-bright-black-fg">p</span>::Vector<span class="ansi-bright-black-fg">{Float64}</span>, <span class="ansi-bright-black-fg">ϵ</span>::Int64, <span class="ansi-bright-black-fg">M</span>::UniformScaling<span class="ansi-bright-black-fg">{Bool}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-magenta-fg">Main.Notebook</span> <span class="ansi-bright-black-fg">~/work/docs/docs/developers/inference/implementing-samplers/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">index.qmd:305</span>
 [19] <span class="ansi-bold">step</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">rng</span>::TaskLocalRNG, <span class="ansi-bright-black-fg">model_wrapper</span>::AbstractMCMC.LogDensityModel<span class="ansi-bright-black-fg">{LogDensityFunction{Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DefaultContext}, VarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}, DefaultContext, AutoForwardDiff{2, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}}}}</span>, <span class="ansi-bright-black-fg">sampler</span>::MALA<span class="ansi-bright-black-fg">{Int64, UniformScaling{Bool}}</span>, <span class="ansi-bright-black-fg">state</span>::MALAState<span class="ansi-bright-black-fg">{Vector{Float64}}</span>; <span class="ansi-bright-black-fg">kwargs</span>::@Kwargs<span class="ansi-bright-black-fg">{}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-magenta-fg">Main.Notebook</span> <span class="ansi-bright-black-fg">~/work/docs/docs/developers/inference/implementing-samplers/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">index.qmd:276</span>
 [20] <span class="ansi-bold">step</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">rng</span>::TaskLocalRNG, <span class="ansi-bright-black-fg">model_wrapper</span>::AbstractMCMC.LogDensityModel<span class="ansi-bright-black-fg">{LogDensityFunction{Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DefaultContext}, VarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}, DefaultContext, AutoForwardDiff{2, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}}}}</span>, <span class="ansi-bright-black-fg">sampler</span>::MALA<span class="ansi-bright-black-fg">{Int64, UniformScaling{Bool}}</span>, <span class="ansi-bright-black-fg">state</span>::MALAState<span class="ansi-bright-black-fg">{Vector{Float64}}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-magenta-fg">Main.Notebook</span> <span class="ansi-bright-black-fg">~/work/docs/docs/developers/inference/implementing-samplers/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">index.qmd:258</span>
 [21] <span class="ansi-bold">step</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">rng</span>::TaskLocalRNG, <span class="ansi-bright-black-fg">model</span>::Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DefaultContext}</span>, <span class="ansi-bright-black-fg">sampler_wrapper</span>::Sampler<span class="ansi-bright-black-fg">{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}</span>, <span class="ansi-bright-black-fg">state</span>::Turing.Inference.TuringState<span class="ansi-bright-black-fg">{MALAState{Vector{Float64}}, VarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}, Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DefaultContext}, VarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}, DefaultContext}</span>; <span class="ansi-bright-black-fg">kwargs</span>::@Kwargs<span class="ansi-bright-black-fg">{}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-magenta-fg">Turing.Inference</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/V6zn0/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">external_sampler.jl:205</span>
 [22] <span class="ansi-bold">step</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">rng</span>::TaskLocalRNG, <span class="ansi-bright-black-fg">model</span>::Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DefaultContext}</span>, <span class="ansi-bright-black-fg">sampler_wrapper</span>::Sampler<span class="ansi-bright-black-fg">{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}</span>, <span class="ansi-bright-black-fg">state</span>::Turing.Inference.TuringState<span class="ansi-bright-black-fg">{MALAState{Vector{Float64}}, VarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}, Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DefaultContext}, VarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}, DefaultContext}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-magenta-fg">Turing.Inference</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/V6zn0/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">external_sampler.jl:194</span>
 [23] <span class="ansi-bold">macro expansion</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/AbstractMCMC/7f1oY/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">sample.jl:232</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [24] <span class="ansi-bold">(::AbstractMCMC.var"#25#26"{Nothing, Int64, Int64, Int64, UnionAll, Nothing, @Kwargs{}, TaskLocalRNG, Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DefaultContext}, Sampler{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}, Int64, Float64, Int64, Int64})</span><span class="ansi-bold">(</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-cyan-fg">AbstractMCMC</span> <span class="ansi-bright-black-fg">~/.julia/packages/AbstractMCMC/7f1oY/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">logging.jl:134</span>
 [25] <span class="ansi-bold">with_logstate</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">f</span>::AbstractMCMC.var"#25#26"<span class="ansi-bright-black-fg">{Nothing, Int64, Int64, Int64, UnionAll, Nothing, @Kwargs{}, TaskLocalRNG, Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DefaultContext}, Sampler{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}, Int64, Float64, Int64, Int64}</span>, <span class="ansi-bright-black-fg">logstate</span>::Base.CoreLogging.LogState<span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">Base.CoreLogging</span> <span class="ansi-bright-black-fg">./logging/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">logging.jl:524</span>
 [26] <span class="ansi-bold">with_logger</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">f</span>::Function, <span class="ansi-bright-black-fg">logger</span>::LoggingExtras.TeeLogger<span class="ansi-bright-black-fg">{Tuple{LoggingExtras.EarlyFilteredLogger{TerminalLoggers.TerminalLogger, AbstractMCMC.var"#1#3"{Module}}, LoggingExtras.EarlyFilteredLogger{Base.CoreLogging.ConsoleLogger, AbstractMCMC.var"#2#4"{Module}}}}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">Base.CoreLogging</span> <span class="ansi-bright-black-fg">./logging/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">logging.jl:635</span>
 [27] <span class="ansi-bold">with_progresslogger</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">f</span>::Function, <span class="ansi-bright-black-fg">_module</span>::Module, <span class="ansi-bright-black-fg">logger</span>::Base.CoreLogging.ConsoleLogger<span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-cyan-fg">AbstractMCMC</span> <span class="ansi-bright-black-fg">~/.julia/packages/AbstractMCMC/7f1oY/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">logging.jl:157</span>
 [28] <span class="ansi-bold">macro expansion</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/AbstractMCMC/7f1oY/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">logging.jl:133</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [29] <span class="ansi-bold">mcmcsample</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">rng</span>::TaskLocalRNG, <span class="ansi-bright-black-fg">model</span>::Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DefaultContext}</span>, <span class="ansi-bright-black-fg">sampler</span>::Sampler<span class="ansi-bright-black-fg">{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}</span>, <span class="ansi-bright-black-fg">N</span>::Int64; <span class="ansi-bright-black-fg">progress</span>::Bool, <span class="ansi-bright-black-fg">progressname</span>::String, <span class="ansi-bright-black-fg">callback</span>::Nothing, <span class="ansi-bright-black-fg">num_warmup</span>::Int64, <span class="ansi-bright-black-fg">discard_initial</span>::Int64, <span class="ansi-bright-black-fg">thinning</span>::Int64, <span class="ansi-bright-black-fg">chain_type</span>::Type, <span class="ansi-bright-black-fg">initial_state</span>::Nothing, <span class="ansi-bright-black-fg">kwargs</span>::@Kwargs<span class="ansi-bright-black-fg">{}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-cyan-fg">AbstractMCMC</span> <span class="ansi-bright-black-fg">~/.julia/packages/AbstractMCMC/7f1oY/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">sample.jl:151</span>
 [30] <span class="ansi-bold">sample</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">rng</span>::TaskLocalRNG, <span class="ansi-bright-black-fg">model</span>::Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DefaultContext}</span>, <span class="ansi-bright-black-fg">sampler</span>::Sampler<span class="ansi-bright-black-fg">{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}</span>, <span class="ansi-bright-black-fg">N</span>::Int64; <span class="ansi-bright-black-fg">chain_type</span>::Type, <span class="ansi-bright-black-fg">resume_from</span>::Nothing, <span class="ansi-bright-black-fg">initial_state</span>::Nothing, <span class="ansi-bright-black-fg">kwargs</span>::@Kwargs<span class="ansi-bright-black-fg">{progress::Bool}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-cyan-fg">DynamicPPL</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/nxcz4/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">sampler.jl:102</span>
 [31] <span class="ansi-bold">sample</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/nxcz4/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">sampler.jl:92</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [32] <span class="ansi-bold">#sample#101</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/V6zn0/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">abstractmcmc.jl:29</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [33] <span class="ansi-bold">sample</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/V6zn0/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">abstractmcmc.jl:20</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [34] <span class="ansi-bold">#sample#100</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/V6zn0/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">abstractmcmc.jl:17</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [35] top-level scope
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/work/docs/docs/developers/inference/implementing-samplers/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">index.qmd:459</span></pre>
</div>
</div>
</div>
<p>As expected, we run into a <code>DomainError</code> at some point, while if we set <code>unconstrained=true</code>, letting Turing.jl transform the model to a unconstrained form behind the scenes, everything works as expected:</p>
<div id="52" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 0.64 seconds
Compute duration  = 0.64 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters  </span><span class="ansi-bold">    mean  </span><span class="ansi-bold">     std  </span><span class="ansi-bold">    mcse  </span><span class="ansi-bold"> ess_bulk  </span><span class="ansi-bold"> ess_tail  </span><span class="ansi-bold">    rhat  </span><span class="ansi-bold"> e ⋯
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">  Float64  </span><span class="ansi-bright-black-fg ansi-bold">  Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">   ⋯

          σ²    0.8582    0.5659    0.0237   386.6307   127.9542    1.0044     ⋯
           x   -0.0332    0.9648    0.0497   549.3902   418.7004    1.0039     ⋯
</span><span class="ansi-cyan-fg ansi-bold">                                                                1 column omitted

Quantiles
 </span><span class="ansi-cyan-fg ansi-bold"> parameters  </span><span class="ansi-cyan-fg ansi-bold">    2.5%  </span><span class="ansi-cyan-fg ansi-bold">   25.0%  </span><span class="ansi-cyan-fg ansi-bold">   50.0%  </span><span class="ansi-cyan-fg ansi-bold">   75.0%  </span><span class="ansi-cyan-fg ansi-bold">   97.5%
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64

          σ²    0.0685    0.3943    0.7433    1.1995    2.2027
           x   -2.1838   -0.4087   -0.0096    0.4048    1.9925
</span></pre>
</div>
</div>
</div>
<p>Neat!</p>
<p>Similarly, which automatic differentiation backend one should use can be specified through the <code>adtype</code> keyword argument too. For example, if we want to use <a href="https://github.com/JuliaDiff/ReverseDiff.jl">ReverseDiff.jl</a> instead of the default <a href="https://github.com/JuliaDiff/ForwardDiff.jl">ForwardDiff.jl</a>:</p>
<div id="54" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">ReverseDiff</span>: ReverseDiff</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify that we want to use `AutoReverseDiff`.</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">demo</span>(),</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>, adtype<span class="op">=</span><span class="fu">AutoReverseDiff</span>()),</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>;</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 2.9 seconds
Compute duration  = 2.9 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters  </span><span class="ansi-bold">    mean  </span><span class="ansi-bold">     std  </span><span class="ansi-bold">    mcse  </span><span class="ansi-bold"> ess_bulk  </span><span class="ansi-bold"> ess_tail  </span><span class="ansi-bold">    rhat  </span><span class="ansi-bold"> e ⋯
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">  Float64  </span><span class="ansi-bright-black-fg ansi-bold">  Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">   ⋯

          σ²    0.8187    0.6355    0.0481    97.4377    28.7965    1.0115     ⋯
           x    0.0822    0.9461    0.0521   341.8061   326.8082    1.0120     ⋯
</span><span class="ansi-cyan-fg ansi-bold">                                                                1 column omitted

Quantiles
 </span><span class="ansi-cyan-fg ansi-bold"> parameters  </span><span class="ansi-cyan-fg ansi-bold">    2.5%  </span><span class="ansi-cyan-fg ansi-bold">   25.0%  </span><span class="ansi-cyan-fg ansi-bold">   50.0%  </span><span class="ansi-cyan-fg ansi-bold">   75.0%  </span><span class="ansi-cyan-fg ansi-bold">   97.5%
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64

          σ²    0.1065    0.3274    0.6671    1.1729    2.4846
           x   -2.0788   -0.2966   -0.0278    0.4529    2.4218
</span></pre>
</div>
</div>
</div>
<p>Double-neat.</p>
</section>
</section>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<p>At this point it’s worth maybe reminding ourselves what we did and also <em>why</em> we did it:</p>
<ol type="1">
<li>We define our models in the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface because it makes the sampler agnostic to how the underlying model is implemented.</li>
<li>We implement our sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> interface, which just means that our sampler is a subtype of <code>AbstractMCMC.AbstractSampler</code> and we implement the MCMC transition in <code>AbstractMCMC.step</code>.</li>
<li>Points 1 and 2 makes it so our sampler can be used with a wide range of model implementations, amongst them being models implemented in both Turing.jl and Stan. This gives you, the inference implementer, a large collection of models to test your inference method on, in addition to allowing users of Turing.jl and Stan to try out your inference method with minimal effort.</li>
</ol>


</section>


<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a><div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>We’re going with the leapfrog formulation because in a future version of this tutorial we’ll add a section extending this simple “baseline” MALA sampler to more complex versions. See <a href="https://github.com/TuringLang/docs/issues/479">issue #479</a> for progress on this.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>There is no such thing as a proper interface in Julia (at least not officially), and so we use the word “interface” here to mean a few minimal methods that needs to be implemented by any type that we treat as a target model.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    // Ensure there is a toggle, if there isn't float one in the top right
    if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
      const a = window.document.createElement('a');
      a.classList.add('top-right');
      a.classList.add('quarto-color-scheme-toggle');
      a.href = "";
      a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
      const i = window.document.createElement("i");
      i.classList.add('bi');
      a.appendChild(i);
      window.document.body.appendChild(a);
    }
    setColorSchemeToggle(hasAlternateSentinel())
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/turinglang\.org\/docs\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../../developers/inference/variational-inference/index.html" class="pagination-link" aria-label="Variational Inference">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Variational Inference</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Turing is created by <a href="http://mlg.eng.cam.ac.uk/hong/" target="_blank">Hong Ge</a>, and lovingly maintained by the <a href="https://github.com/TuringLang/Turing.jl/graphs/contributors" target="_blank">core team</a> of volunteers. <br> The contents of this website are © 2018–2025 under the terms of the <a href="https://github.com/TuringLang/docs/blob/main/LICENCE" target="_blank">MIT License</a>.</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/TuringLang/docs/edit/main/developers/inference/implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/docs/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://x.com/TuringLang">
      <i class="bi bi-twitter" role="img" aria-label="Turing Twitter">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/TuringLang/Turing.jl">
      <i class="bi bi-github" role="img" aria-label="Turing GitHub">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




<script src="../../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>